(()=>{(function(){"use strict";function i(e,a){let s=e.selection.getContent({format:"text"});if(!s){e.windowManager.alert("Please select some text to process.");return}e.setProgressState(!0);let o=window.aipkit_post_enhancer?.nonce_process_text;if(!o){console.error("AIPKit Enhancer: Nonce not found for text processing."),e.setProgressState(!1),e.windowManager.alert("An error occurred: Security token missing.");return}let r=a.replace("%s",s),t={_ajax_nonce:o,text_to_process:s,final_prompt:r};if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Enhancer: aipkit_apiRequest function not available."),e.setProgressState(!1),e.windowManager.alert("An error occurred: API function missing.");return}window.aipkit_apiRequest("aipkit_process_enhancer_text",t).then(n=>{if(n.text)e.selection.setContent(n.text);else throw new Error("AI did not return any text.")}).catch(n=>{console.error("AIPKit Enhancer: Error during AI processing action.",n),e.windowManager.alert(`An error occurred: ${n.message||"Request failed."}`)}).finally(()=>{e.setProgressState(!1)})}tinymce.PluginManager.add("aipkit_assistant",function(e,a){e.addButton("aipkit_assistant_button",{text:"Content Assistant",icon:!1,type:"menubutton",menu:function(){let o=(window.aipkit_post_enhancer||{}).actions||[],r=[];return o.forEach(t=>{t.label&&t.prompt&&r.push({text:t.label,onclick:function(){i(e,t.prompt)}})}),r}()})})})();})();
