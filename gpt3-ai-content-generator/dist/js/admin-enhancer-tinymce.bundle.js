(()=>{(function(){"use strict";function m(e,u){let i=e.selection.getContent({format:"text"});if(!i){e.windowManager.alert("Please select some text to process.");return}e.setProgressState(!0);let o=window.aipkit_post_enhancer?.nonce_process_text;if(!o){console.error("AIPKit Enhancer: Nonce not found for text processing."),e.setProgressState(!1),e.windowManager.alert("An error occurred: Security token missing.");return}let s=u.replace("%s",i),r={_ajax_nonce:o,text_to_process:i,final_prompt:s};if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Enhancer: aipkit_apiRequest function not available."),e.setProgressState(!1),e.windowManager.alert("An error occurred: API function missing.");return}window.aipkit_apiRequest("aipkit_process_enhancer_text",r).then(a=>{if(!a.text)throw new Error("AI did not return any text.");let f=window.aipkit_post_enhancer||{},h=f.parse_html_formats!==void 0?!!f.parse_html_formats:!0,n=a.text;if(h){let c=document.createElement("div");c.innerHTML=n;let d=new Set(["STRONG","B","EM","I","U"]);(function p(l){let _=Array.from(l.childNodes);for(let t of _)if(t.nodeType===Node.ELEMENT_NODE){if(d.has(t.tagName))for(let g of Array.from(t.attributes))t.removeAttribute(g.name);else{for(p(t);t.firstChild;)l.insertBefore(t.firstChild,t);l.removeChild(t);continue}p(t)}})(c),n=c.innerHTML}else n=n.replace(/<[^>]*>/g,""),n=e.dom.encode(n);e.selection.setContent(n)}).catch(a=>{console.error("AIPKit Enhancer: Error during AI processing action.",a),e.windowManager.alert(`An error occurred: ${a.message||"Request failed."}`)}).finally(()=>{e.setProgressState(!1)})}tinymce.PluginManager.add("aipkit_assistant",function(e,u){e.addButton("aipkit_assistant_button",{text:"\u270D\uFE0F AIP Content Assistant",icon:!1,type:"menubutton",classes:"aipkit-tinymce-assistant-button",menu:function(){let o=(window.aipkit_post_enhancer||{}).actions||[],s=[];return s.push({text:"\u270D\uFE0F AIP CONTENT ASSISTANT",classes:"aipkit-tinymce-menu-header",disabled:!0}),o.length>0&&s.push({text:"-"}),o.forEach(r=>{r.label&&r.prompt&&s.push({text:r.label,classes:"aipkit-tinymce-menu-item",onclick:function(){m(e,r.prompt)}})}),s}()})})})();})();
