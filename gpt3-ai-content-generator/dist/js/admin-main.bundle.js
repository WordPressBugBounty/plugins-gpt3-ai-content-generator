(()=>{(function(){"use strict";function g(r,n){if(!r)return;let e=r.querySelector(".aipkit_btn-text");if(e){e.textContent=n;return}let i=r.querySelector(".aipkit_spinner"),s=Array.from(r.childNodes).find(c=>c.nodeType===Node.TEXT_NODE);s?s.textContent=n+(i?" ":""):r.insertBefore(document.createTextNode(n+(i?" ":"")),r.firstChild),i&&r.appendChild(i)}function a(r,n,e,i=4e3){if(!r)return;let s=r.dataset.baseClass||"aipkit_form-help";r.dataset.baseClass||(r.dataset.baseClass=s),r.messageTimeoutId&&(clearTimeout(r.messageTimeoutId),r.messageTimeoutId=null),r.textContent=e,r.className=s,r.classList.add(`aipkit_form-help-${n}`),r.style.opacity="1",r.style.display="block",r.messageTimeoutId=setTimeout(()=>{r.style.opacity="0",setTimeout(()=>{r.textContent===e&&(r.textContent="",r.className=s,r.style.display="",r.messageTimeoutId=null)},300)},i)}window.aipkit_setButtonText=g,window.aipkit_showTemporaryMessage=a})();(function(){"use strict";function g(r){return r===null||typeof r>"u"?"":String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function a(r){return g(r)}window.aipkit_escapeHtml=g,window.aipkit_escapeAttribute=a})();(function(){"use strict";function g(r){let n=document.createElement("div");if(n.textContent="Copied!",Object.assign(n.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:1000005,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)",pointerEvents:"none"}),document.body.appendChild(n),r){let{top:e,left:i,width:s}=r.getBoundingClientRect(),c=e+window.scrollY+2,t=i+window.scrollX+s+5;n.style.top=`${c}px`,n.style.left=`${t}px`;let d=n.getBoundingClientRect(),o=8,l=window.innerWidth-o;if(d.right>l){let _=i+window.scrollX-d.width-5,p=Math.max(window.scrollX+o,_);n.style.left=`${p}px`}}else n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateY(0)"}),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateY(-5px)",n.addEventListener("transitionend",()=>n.remove(),{once:!0}),setTimeout(()=>{n.parentNode&&n.remove()},500)},1e3)}async function a(r,n){if(r)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(r),g(n);return}throw new Error("Clipboard API not available")}catch(e){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",e);try{let i=document.createElement("textarea");i.value=r,i.style.position="fixed",i.style.top="-9999px",i.style.left="-9999px",i.style.opacity="0",i.setAttribute("readonly",""),document.body.appendChild(i),i.select(),i.setSelectionRange(0,99999);let s=document.execCommand("copy");if(document.body.removeChild(i),s)g(n);else throw new Error('document.execCommand("copy") failed.')}catch(i){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",i),window.prompt("Please copy the shortcode manually:",r)}}}window.aipkit_copyShortcode=a})();(function(){"use strict";function g(e){let i=Number(e);if(!i||isNaN(i))return"";try{let s=new Date(i*1e3);if(isNaN(s.getTime()))return"";let c=String(s.getHours()).padStart(2,"0"),t=String(s.getMinutes()).padStart(2,"0"),d=String(s.getSeconds()).padStart(2,"0");return`${c}:${t}:${d}`}catch(s){return console.error("Error formatting timestamp:",e,s),""}}function a(e){if(!e)return"";try{let i=new Date(e.replace(" ","T")+"Z");if(isNaN(i.getTime()))return"";let s=new Date,c=(i.getTime()-s.getTime())/1e3;if(c<0)return"In the past";if(c<60)return"in less than a minute";if(c<3600){let l=Math.round(c/60);return`in ${l} minute${l!==1?"s":""}`}let t=new Date(s.getFullYear(),s.getMonth(),s.getDate()),d=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1),o=new Date(i.getFullYear(),i.getMonth(),i.getDate());return o.getTime()===t.getTime()?`Today at ${i.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:o.getTime()===d.getTime()?`Tomorrow at ${i.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${i.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(i){return console.error("Error formatting relative time:",e,i),e}}function r(e){if(!e)return"N/A";try{let i=new Date(e.replace(" ","T")+"Z");return isNaN(i.getTime())?"Invalid Date":i.toLocaleString()}catch(i){return console.error("Error formatting UTC date string:",e,i),e}}function n(e){if(!e)return"N/A";try{let i=new Date(e.replace(" ","T")+"Z");if(isNaN(i.getTime()))return"Invalid Date";let s=Math.floor((Date.now()-i.getTime())/1e3);if(Number.isNaN(s)||s<0)return i.toLocaleString();if(s<60)return"Just now";let c=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],t=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let d of c)if(s>=d.seconds){let o=Math.floor(s/d.seconds);return t?t.format(-o,d.unit):`${o} ${d.unit}${o!==1?"s":""} ago`}return i.toLocaleString()}catch(i){return console.error("Error formatting relative date string:",e,i),e}}window.aipkit_formatTimestamp=g,window.aipkit_formatFriendlyFutureDate=a,window.aipkit_formatUtcDateTime=r,window.aipkit_formatRelativeDateTime=n})();(function(){"use strict";function g(a){return!a||typeof a!="string"?"":a.charAt(0).toUpperCase()+a.slice(1)}window.aipkit_ucfirst=g,window.ucfirst=g})();(function(){"use strict";function g(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let a=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&a.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=a,a}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=g})();(function(){"use strict";function g(a,r="",n="",e={}){if(!a)return"N/A";let i=a.toLowerCase();if(i.includes("text content submitted for indexing"))return"Text";if(i.includes("file content submitted for indexing")||i.includes("file content embedded and upserted")||i.includes("original filename:"))return"File Upload";if(i.includes("wordpress post content submitted for indexing"))return"Site Content";if(n==="openai")return"N/A";if(n==="pinecone"&&i.includes("vectors upserted")){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("pinecone_file_")||r.includes("file_"))return"File Upload"}if(n==="qdrant"){if(i.includes("points upserted to qdrant"))return e.post_id||i.includes("post id:")?"Site Content":"Text";if(i.includes("wordpress post content submitted for indexing"))return"Site Content"}if(r&&n==="pinecone"){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("file_")||r.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=g})();(function(){"use strict";async function g(n){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",n)}async function a(n,e){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));n.set("action",e);try{let c=n.get("provider")||"openai",t=n.has("file_to_upload")?"file_to_upload":n.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null,d=t?n.get(t):null;if(d&&typeof d.size=="number"){let o=["text/plain","text/csv","application/json","text/json","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/csv","text/comma-separated-values"],l=Array.isArray(window.aipkit_uploadLimits?.allowed_mime_types)&&window.aipkit_uploadLimits.allowed_mime_types.length?window.aipkit_uploadLimits.allowed_mime_types:o,_=Number(window.aipkit_effectiveUploadLimitBytes||0);(!Number.isFinite(_)||_<=0)&&(_=10*1024*1024),c==="openai"&&(_=Math.min(_,10*1024*1024));let p=[];if(d.size>_&&p.push(`File is too large (${r(d.size)}). Max allowed is ${r(_)}.`),d.type&&!l.map(f=>f.toLowerCase()).includes(String(d.type).toLowerCase())&&p.push(`Unsupported file type (${d.type}). Allowed: ${l.join(", ")}.`),p.length){let f=new Error(p.join(" "));throw f.code="client_validation_failed",f}}}catch(c){throw console.warn("[AIPKit] Client-side file validation failed",c),c}let i;try{let c=n.has("file_to_upload")?"file_to_upload":n.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null;if(c)try{let t=n.get(c);t&&console.debug("[AIPKit] File upload request",{action:e,fileField:c,name:t.name,size_bytes:t.size,type:t.type})}catch{}i=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:n,credentials:"same-origin"})}catch(c){throw console.error("[AIPKit] Network error during file upload",{action:e,error:c}),c}let s;try{s=await i.json()}catch(c){console.error("[AIPKit] Failed to parse JSON response for file upload",{action:e,status:i?.status,parseErr:c});let t=new Error(`Unexpected server response (status ${i?.status||"n/a"})`);throw t.status=i?.status,t}if(!i.ok||!s.success){let c=s?.data||{},t=new Error(c.message||`HTTP error! status: ${i.status}`);throw t.code=c.code,t.status=i.status,t.details=c.details||void 0,t.serverResponse=s,console.error("[AIPKit] File upload failed",{action:e,status:i.status,server:s}),t}return s.data}function r(n){if(!Number.isFinite(n))return`${n}`;let e=["B","KB","MB","GB"],i=0,s=n;for(;s>=1024&&i<e.length-1;)s/=1024,i++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:t=>t.toFixed(1)}).format(s)} ${e[i]}`}window.aipkit_api_upsertOpenAIText=g,window.aipkit_api_upsertFile=a})();(function(){"use strict";function g(a){let r=document.querySelector(a);if(!r)return;r.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(e=>{let i=e.id+"_value",s=null,c=e.closest(".aipkit_slider_wrapper");if(c&&(s=c.querySelector(".aipkit_slider_value")),!s)try{s=r.querySelector(`#${CSS.escape(i)}`)}catch{s=r.querySelector("#"+i)}if(s){let t=e.getAttribute("data-suffix")||(e.id.includes("confidence_threshold")?"%":"");s.textContent=e.value+t,e.hasAttribute("data-range-listener-attached")||(e.addEventListener("input",function(){s.textContent=this.value+t}),e.setAttribute("data-range-listener-attached","true"))}})}window.aipkit_attachRangeValueHandlers=g})();(function(){"use strict";function g(a){let r=document.querySelector(a);if(!r)return;let n="data-apikey-toggle-listener-attached";r.getAttribute(n)||(r.addEventListener("click",function(e){let i=e.target.closest(".aipkit_api-key-toggle");if(!i)return;let s=i.closest(".aipkit_api-key-wrapper");if(!s)return;let c=s.querySelector(".aipkit_form-input"),t=i.querySelector(".dashicons");!c||!t||(c.type==="password"?(c.type="text",t.classList.remove("dashicons-visibility"),t.classList.add("dashicons-hidden")):(c.type="password",t.classList.remove("dashicons-hidden"),t.classList.add("dashicons-visibility")))}),r.setAttribute(n,"true"))}window.aipkit_initApiKeyToggles=g})();(function(){"use strict";function g(a,r,n="Submit",e="Processing..."){if(!a)return;let i=a.querySelector(".aipkit_btn-text")||a.querySelector(".aipkit_btn_text"),s=a.querySelector(".aipkit_spinner"),c=a.querySelector(".dashicons");if(r){if(a.disabled=!0,!a.dataset.originalText)if(i)a.dataset.originalText=i.textContent;else{let d="";a.childNodes.forEach(o=>{o.nodeType===Node.TEXT_NODE&&(d+=o.textContent.trim())}),a.dataset.originalText=d.trim()}c&&(c.dataset.originalDisplay||(c.dataset.originalDisplay=c.style.display||"inline-block"),c.style.display="none");let t=n===""?"":a.dataset.loadingText||e;i?(a.dataset.originalText||(a.dataset.originalText=i.textContent),i.textContent=t):(!c||c.style.display==="none")&&t&&(Array.from(a.childNodes).forEach(d=>{d.nodeType===Node.TEXT_NODE&&d.remove()}),t&&a.insertBefore(document.createTextNode(t),a.firstChild)),s&&(s.style.display="inline-block")}else{a.disabled=!1;let t=n===""?"":a.dataset.originalText||n;c&&c.dataset.originalDisplay&&(c.style.display=c.dataset.originalDisplay,delete c.dataset.originalDisplay),i?i.textContent=t:n!==""&&(Array.from(a.childNodes).forEach(d=>{d.nodeType===Node.TEXT_NODE&&d.remove()}),t&&(c?c.insertAdjacentText("afterend"," "+t):a.insertBefore(document.createTextNode(t),a.firstChild))),s&&(s.style.display="none"),delete a.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=g})();(function(){"use strict";function g(a,r="info",n="aipkit_knowledge_base_global_status"){let e=document.getElementById(n);if(!e)return;e.messageTimeoutId&&clearTimeout(e.messageTimeoutId),e.messageTimeoutId=null;let i=a?String(a).trim():"";if(i===""){e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.style.opacity="0",e.classList.remove("aipkit-active");return}let s=e.classList.contains("aipkit_settings_message-error"),c=r;s&&r!=="error"&&(c="error"),e.className="aipkit_form-help",c==="success"?e.classList.add("aipkit_settings_message-success"):c==="error"?e.classList.add("aipkit_settings_message-error"):e.classList.add("aipkit_settings_message-info"),c==="error"&&e.textContent||s&&r!=="error"&&e.textContent?e.textContent=e.textContent+`
`+i:e.textContent=i,e.style.display="block",e.style.opacity="1",e.classList.add("aipkit-active"),c!=="error"&&(e.messageTimeoutId=setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.textContent.includes(i)&&(e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.classList.remove("aipkit-active"))},300)},5e3))}window.aipkit_showOpenAIVectorStatus=g})();(function(){"use strict";async function g(e,i,s,c){let t=document.getElementById("aipkit_nonce"),d=t&&t.value||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||void 0;return await window.aipkit_apiRequest("aipkit_get_chunk_logs_by_batch",{_ajax_nonce:d,provider:e,store_id:i,batch_id:s,page:c,per_page:10})}function a({snippetText:e="",fileId:i="",provider:s="",batchId:c="",storeId:t=""}={}){let d=window.aipkit_escapeHtml||function(u){return u},o=document.createElement("div");o.className="aipkit-snippet-modal-overlay";let l=document.createElement("div");l.className="aipkit-snippet-modal-content";let _=s?`${s} Indexed Snippet`:"Indexed Snippet",p=i?` (${d(i)})`:"",f=!!c&&!!t&&!!s;l.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${_}${p}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        ${f?`
          <div class="aipkit-chunks-list"></div>
          <div class="aipkit-chunks-pagination" style="margin-top:10px; display:flex; justify-content: space-between; align-items:center;">
            <button class="button button-secondary aipkit-chunks-prev">Prev</button>
            <span class="aipkit-chunks-page-info"></span>
            <button class="button button-secondary aipkit-chunks-next">Next</button>
          </div>
        `:`
          <pre class="aipkit-snippet-modal-content-text">${d(e)}</pre>
        `}
      </div>
    `,o.appendChild(l),document.body.appendChild(o);function m(){o.classList.remove("active"),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)}l.querySelector(".aipkit-snippet-modal-close").addEventListener("click",m),o.addEventListener("click",u=>{u.target===o&&m()});function k(u){u.key==="Escape"&&(m(),document.removeEventListener("keydown",k))}if(document.addEventListener("keydown",k),requestAnimationFrame(()=>{o.classList.add("active")}),f){let u=l.querySelector(".aipkit-chunks-list"),w=l.querySelector(".aipkit-chunks-page-info"),h=l.querySelector(".aipkit-chunks-prev"),v=l.querySelector(".aipkit-chunks-next"),C=1,x=1,b=y=>{if(!y||!y.length){u.innerHTML="<p>No chunks found.</p>";return}u.innerHTML=y.map(q=>{let E=q.indexed_content||"",S=q.file_id||"";return`<div class="aipkit-chunk-item" style="margin-bottom:12px;">
            <div class="aipkit-chunk-title" style="font-weight:600; margin-bottom:6px;">${d(S)}</div>
            <pre class="aipkit-chunk-text">${d(E)}</pre>
          </div>`}).join("")};async function I(y){u.innerHTML='<p><span class="aipkit_spinner" style="display:inline-block;"></span> Loading...</p>';try{let q=await g(s,t,c,y);b(q.chunks||[]),C=q.pagination?.current_page||y,x=q.pagination?.total_pages||1,w.textContent=`Page ${C} / ${x}`,h.disabled=C<=1,v.disabled=C>=x}catch(q){u.innerHTML=`<p class="aipkit_text-danger">${q&&q.message||"Failed to load chunks."}</p>`}}h.addEventListener("click",()=>{C>1&&I(C-1)}),v.addEventListener("click",()=>{C<x&&I(C+1)}),I(1)}}function r(e,i,s=""){return a({snippetText:e,fileId:i,provider:s})}function n(e,i=""){e&&e.querySelectorAll(".aipkit_view_snippet_icon").forEach(s=>{let c=s.cloneNode(!0);s.parentNode.replaceChild(c,s),c.addEventListener("click",t=>{t.preventDefault();let d=c.dataset.snippet,o=c.dataset.fileId,l=c.dataset.batchId||"",_=c.dataset.storeId||"";a({snippetText:d,fileId:o,provider:i,batchId:l,storeId:_})})})}window.aipkit_showSnippetModal=r,window.aipkit_showSnippetModalEnhanced=a,window.aipkit_attachSnippetModalListeners=n})();(function(){"use strict";function g(a,r,n){if(!a||!r||typeof n!="function"){r&&(r.innerHTML="");return}r.innerHTML="";let{total_logs:e,total_pages:i,current_page:s}=a,c=parseInt(s,10);if(!e||e<=0||!i||i<=1)return;let t=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,d=wp.i18n&&wp.i18n._n?wp.i18n._n:(m,k,u)=>u>1?k:m,o=document.createElement("span");o.className="aipkit_pagination-count",o.textContent=`${e.toLocaleString()} ${d("item","items",e)}`,r.appendChild(o);let l=document.createElement("span");l.className="aipkit_pagination-links";let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML="&laquo; "+t("Previous","gpt3-ai-content-generator"),_.disabled=c<=1,_.disabled||_.addEventListener("click",m=>{m.preventDefault(),n(c-1)}),l.appendChild(_);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${t("Page","gpt3-ai-content-generator")} ${c} ${t("of","gpt3-ai-content-generator")} ${i}`,l.appendChild(p);let f=document.createElement("button");f.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",f.innerHTML=t("Next","gpt3-ai-content-generator")+" &raquo;",f.disabled=c>=i,f.disabled||f.addEventListener("click",m=>{m.preventDefault(),n(c+1)}),l.appendChild(f),r.appendChild(l)}window.aipkit_renderLogsPagination=g})();(function(){"use strict";function g(a){let r=document.querySelector(a);if(!r)return;let n="data-restore-icon-listener-attached";r.getAttribute(n)||(r.addEventListener("click",function(e){let i=e.target.closest(".aipkit_restore-default-icon");if(!i)return;let s=i.getAttribute("data-target-input"),c=i.getAttribute("data-default-value");if(!s||c===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",i);return}let t=document.getElementById(s);if(t){if(t.value!==c){t.value=c;let o=new Event("change",{bubbles:!0,cancelable:!0}),l=new Event("blur",{bubbles:!0,cancelable:!0});if(t.dispatchEvent(o),t.dispatchEvent(l),t.type==="range"){let _=document.getElementById(`${s}_value`);_&&(_.textContent=c)}}}else console.warn(`AIPKit Restore Default: Target input element #${s} not found.`)}),r.setAttribute(n,"true"))}window.aipkit_initRestoreDefaultIcons=g})();(function(){"use strict";function g(e){!e||!e.parentNode||e.classList.contains("aipkit_message_fadeout")||(e.classList.add("aipkit_message_fadeout"),e.addEventListener("animationend",()=>{e.parentNode&&e.parentNode.removeChild(e)},{once:!0}),setTimeout(()=>{e&&e.parentNode&&e.parentNode.removeChild(e)},500))}function a(e,i,s){let c=document.getElementById(e);if(!c){console.error(`AIPKit Message Handler: Container #${e} not found.`);return}c.querySelectorAll(".aipkit_settings_message").forEach(m=>{m.dataset.timerId&&clearTimeout(parseInt(m.dataset.timerId,10)),m.remove()});let d=c.querySelector(".aipkit_saving-indicator");d&&d.remove();let o=document.createElement("div");o.className=`aipkit_settings_message aipkit_settings_message-${i}`;let l=i==="success"?"dashicons-yes-alt":i==="error"?"dashicons-warning":"dashicons-info-alt",_=document.createElement("span");_.className=`dashicons ${l}`,_.style.marginRight="5px",o.appendChild(_),o.appendChild(document.createTextNode(` ${s}`));let p=document.createElement("span");p.className="dashicons dashicons-dismiss aipkit_settings_message-close",p.setAttribute("aria-label","Dismiss message"),p.title="Dismiss message",o.appendChild(p),c.appendChild(o);let f=setTimeout(()=>{g(o)},5e3);o.dataset.timerId=f}function r(e){let i=document.getElementById(e);if(!i){console.error(`AIPKit Message Handler: Container #${e} not found for close button init.`);return}let s=`data-close-listener-${e}`;i.getAttribute(s)!=="true"&&(i.addEventListener("click",function(c){let t=c.target.closest(".aipkit_settings_message-close");if(t){let d=t.closest(".aipkit_settings_message");d&&(d.dataset.timerId&&clearTimeout(parseInt(d.dataset.timerId,10)),g(d))}}),i.setAttribute(s,"true"))}function n(e){let i=document.getElementById(e);if(i){let s=i.querySelector(".aipkit_saving-indicator");s&&s.remove(),i.querySelectorAll(".aipkit_settings_message").forEach(t=>{t.dataset.timerId&&clearTimeout(parseInt(t.dataset.timerId,10)),t.remove()})}else console.warn(`AIPKit Message Handler: Container #${e} not found for clearing messages.`)}window.aipkit_showMessage=a,window.aipkit_initMessageCloseButtons=r,window.aipkit_clearStatusMessages=n})();(function(){"use strict";function g(n,e){let i=document.getElementById(n);if(!i){console.error(`AIPKit Saving Indicator: Container #${n} not found.`);return}let s=i.querySelector(".aipkit_saving-indicator");if(e)if(!s)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(n):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),s=document.createElement("span"),s.className="aipkit_saving-indicator",s.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',i.appendChild(s),requestAnimationFrame(()=>{let c=i.querySelector(".aipkit_saving-indicator");c&&c.classList.add("aipkit_active")});else{s.style.display="inline-flex",s.classList.add("aipkit_active");let c=s.querySelector(".aipkit_spinner");c&&(c.style.display="inline-block")}else s&&(s.classList.remove("aipkit_active"),setTimeout(()=>{s&&s.parentNode&&s.remove()},200))}function a(n){r(n);let e=document.createElement("span");e.className="aipkit-title-spinner aipkit_spinner",e.style.display="inline-block",n.parentNode.insertBefore(e,n.nextSibling)}function r(n){let e=n.parentNode.querySelector(".aipkit-title-spinner");e&&e.remove()}window.aipkit_showSavingIndicator=g,window.aipkit_showLinkSpinner=a,window.aipkit_hideLinkSpinner=r})();(function(){"use strict";function g(n){let e=n.textContent;n.textContent="Copied!",n.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{n&&n.classList.contains("aipkit-placeholder--copied")&&(n.textContent=e,n.classList.remove("aipkit-placeholder--copied"))},1500)}function a(n){let e=n.target;if(!e.matches(".aipkit-placeholder"))return;n.preventDefault(),n.stopPropagation();let i=e.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(i).then(()=>{g(e)}).catch(s=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",s)})}function r(){let n=document.body;if(n){let e="data-placeholder-copy-listener-attached";n.getAttribute(e)||(n.addEventListener("click",a),n.setAttribute(e,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",r)})();(function(){"use strict";let g="select[data-aipkit-provider-notice-target]",a="a[data-aipkit-load-module]";function r(){let k=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return k&&typeof k=="object"?k:{}}function n(k){window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=k}function e(k){return k?String(k).trim().toLowerCase():""}function i(k,u){return!k||!u||!Object.prototype.hasOwnProperty.call(u,k)?null:!!u[k]}function s(k,u){if(!k)return"";let w=u?k.getAttribute(`data-message-${u}`):"";return w||k.getAttribute("data-message-default")||""}function c(k){k&&k.classList.add("aipkit_provider_notice--hidden")}function t(k){k&&k.classList.remove("aipkit_provider_notice--hidden")}function d(k,u){if(!k)return;let w=k.getAttribute("data-aipkit-provider-notice-target");if(!w)return;let h=document.getElementById(w);if(!h)return;if(k.getAttribute("data-aipkit-provider-notice-defer")==="1"&&k.dataset.aipkitProviderNoticeArmed!=="true"){c(h);return}let C=e(k.value);if(!C){c(h);return}let x=i(C,u);if(x===null){c(h);return}if(x){c(h);return}let b=h.querySelector(".aipkit_provider_notice_message");b&&(b.textContent=s(h,C)),t(h)}function o(k){return k?k.offsetParent!==null?!0:k.getClientRects().length>0:!1}function l(k){let u=r(),w=k||document,h=Array.from(w.querySelectorAll(g)),v=new Map;h.forEach(C=>{let x=C.getAttribute("data-aipkit-provider-notice-target");x&&(v.has(x)||v.set(x,[]),v.get(x).push(C))}),v.forEach(C=>{let x=C.find(o)||C[0];x&&d(x,u)})}function _(){let k={...r()},u=!1,w=V=>{let W=document.getElementById(V);if(W)return u=!0,String(W.value||"").trim()},h=w("aipkit_openai_api_key");h!==void 0&&(k.openai=h!=="");let v=w("aipkit_openrouter_api_key");v!==void 0&&(k.openrouter=v!=="");let C=w("aipkit_google_api_key");C!==void 0&&(k.google=C!=="");let x=w("aipkit_azure_api_key"),b=w("aipkit_azure_endpoint");(x!==void 0||b!==void 0)&&(k.azure=(x||"")!==""&&(b||"")!=="");let I=w("aipkit_claude_api_key");I!==void 0&&(k.claude=I!=="");let y=w("aipkit_deepseek_api_key");y!==void 0&&(k.deepseek=y!=="");let q=w("aipkit_ollama_base_url");q!==void 0&&(k.ollama=q!=="");let E=w("aipkit_replicate_api_key"),S=w("aipkit_task_cw_replicate_api_key");(E!==void 0||S!==void 0)&&(k.replicate=(E||"")!==""||(S||"")!=="");let A=w("aipkit_pinecone_api_key");A!==void 0&&(k.pinecone=A!=="");let T=w("aipkit_qdrant_api_key"),M=w("aipkit_qdrant_url");return(T!==void 0||M!==void 0)&&(k.qdrant=(T||"")!==""&&(M||"")!==""),u?(n(k),!0):!1}function p(){["aipkit_openai_api_key","aipkit_openrouter_api_key","aipkit_google_api_key","aipkit_azure_api_key","aipkit_azure_endpoint","aipkit_claude_api_key","aipkit_deepseek_api_key","aipkit_ollama_base_url","aipkit_replicate_api_key","aipkit_task_cw_replicate_api_key","aipkit_pinecone_api_key","aipkit_qdrant_api_key","aipkit_qdrant_url"].forEach(u=>{let w=document.getElementById(u);if(!w||w.dataset.aipkitProviderStatusBound==="true")return;let h=()=>{_()&&l(document)};w.addEventListener("input",h),w.addEventListener("change",h),w.dataset.aipkitProviderStatusBound="true"})}function f(k){(k||document).querySelectorAll(a).forEach(h=>{h.dataset.aipkitProviderNoticeLinkBound!=="true"&&(h.addEventListener("click",v=>{let C=h.getAttribute("data-aipkit-load-module");!C||typeof window.aipkit_loadModule!="function"||(v.preventDefault(),window.aipkit_loadModule(C))}),h.dataset.aipkitProviderNoticeLinkBound="true")})}function m(k){let u=k||document;u.querySelectorAll(g).forEach(h=>{h.dataset.aipkitProviderNoticeBound!=="true"&&(h.addEventListener("change",()=>{h.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(h.dataset.aipkitProviderNoticeArmed="true"),d(h,r())}),h.dataset.aipkitProviderNoticeBound="true")}),_(),l(u),p(),f(u)}window.aipkit_initProviderKeyNotices=m,document.addEventListener("DOMContentLoaded",function(){m(document)})})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelectorAll("[data-aipkit-popover-target]");if(!r.length)return;let n=null,e=null,i=!1,s=l=>l?a.querySelector(`#${l}`):null,c=(l,_)=>{if(!l||!_)return;let p=l.getBoundingClientRect(),f=_.getBoundingClientRect(),m=f.width||400,k=f.height||0,u=window.innerWidth,w=window.innerHeight,h=12;if(l.dataset.aipkitPopoverPlacement==="bottom"){let x=p.left;x+m>u-h&&(x=p.right-m),x=Math.max(h,Math.min(x,u-m-h));let b=p.bottom+8;b+k>w-h&&(b=p.top-k-8),b=Math.max(h,Math.min(b,w-k-h)),_.style.left=`${Math.round(x)}px`,_.style.top=`${Math.round(b)}px`;return}if(l.dataset.aipkitPopoverPlacement==="left"){let x=p.left-m-10;x<h&&(x=p.right+10),x=Math.max(h,Math.min(x,u-m-h));let b=p.top;b+k>w-h&&(b=w-k-h),b=Math.max(h,b),_.style.left=`${Math.round(x)}px`,_.style.top=`${Math.round(b)}px`;return}let v=p.right+10;v+m>u-h&&(v=p.right-m-10),v=Math.max(h,Math.min(v,u-m-h));let C=p.top;C+k>w-h&&(C=w-k-h),C=Math.max(h,C),_.style.left=`${Math.round(v)}px`,_.style.top=`${Math.round(C)}px`},t=()=>{!e||!n||i||(i=!0,window.requestAnimationFrame(()=>{let l=n.querySelector(".aipkit_model_settings_popover_panel");c(e,l),i=!1}))},d=()=>{if(!n)return;let l=n.id;n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),l==="aipkit_cw_template_picker_popover"&&typeof window.aipkit_resetTemplateActionsPanel=="function"&&window.aipkit_resetTemplateActionsPanel(),n=null,e=null},o=l=>{if(!l)return;let _=l.getAttribute("data-aipkit-popover-target"),p=s(_);if(!p)return;n&&n!==p&&d(),n=p,e=l,p.classList.add("aipkit-active"),p.setAttribute("aria-hidden","false"),l.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${_}`);let f=p.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{c(l,f)})};r.forEach(l=>{l.dataset.popoverListenerAttached!=="true"&&(l.addEventListener("click",_=>{if(_.preventDefault(),!(l.dataset.aipkitPopoverKeepOpen==="true")&&n&&e===l&&n.classList.contains("aipkit-active")){d();return}o(l)}),l.dataset.popoverListenerAttached="true")}),a.querySelectorAll(".aipkit_model_settings_popover").forEach(l=>{l.dataset.overlayListenerAttached!=="true"&&(l.addEventListener("click",p=>{p.target===l&&d()}),l.dataset.overlayListenerAttached="true");let _=l.querySelector(".aipkit_model_settings_popover_close");_&&_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",p=>{p.preventDefault(),d()}),_.dataset.popoverListenerAttached="true"),l.querySelectorAll("[data-aipkit-popover-close]").forEach(p=>{p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",f=>{f.preventDefault(),d()}),p.dataset.popoverListenerAttached="true")})}),a.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",l=>{l.key==="Escape"&&n&&d()}),a.dataset.escapeListenerAttached="true"),a.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),a.dataset.repositionListenersAttached="true")}window.aipkit_initContentWriterPopovers=g})();(function(){"use strict";let g=e=>{if(!e)return null;let i=e.querySelector("#aipkit_enhancer_editor_integration"),s=e.querySelector("#aipkit_enhancer_list_button"),c=e.querySelector('input[name="enhancer_insert_position_default"]:checked');return!i||!s||!c?null:{enhancer_editor_integration:i.checked?"1":"0",enhancer_list_button:s.checked?"1":"0",enhancer_insert_position_default:c.value||"replace"}},a=e=>e?JSON.stringify(e):"",r=async e=>{if(!e||typeof window.aipkit_apiRequest!="function")return;let i=g(e);if(!i)return;let s=e.dataset.assistantAutosaveBaseline||"",c=a(i);if(!c||c===s||e.dataset.assistantAutosaveBusy==="true")return;let t=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,d=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,o=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;e.dataset.assistantAutosaveBusy="true",t&&t("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",i),e.dataset.assistantAutosaveBaseline=c,d&&d("Updated")}catch(l){o&&o(`Error: ${l.message||"Failed to save."}`),console.error("Content Writer Assistant Settings Save Error:",l)}finally{e.dataset.assistantAutosaveBusy="false"}};function n(e){let i=e||document.getElementById("aipkit_content_writer_container"),s=document.getElementById("aipkit_cw_builder_sheet");if(!i||!s)return;let c=s.querySelector(".aipkit_builder_sheet_title"),t=s.querySelector(".aipkit_builder_sheet_description"),d=s.querySelectorAll(".aipkit_builder_sheet_section"),o=s.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'),l=s.querySelector(".aipkit_builder_sheet_close"),_=f=>{if(!f)return;let m=f.getAttribute("data-sheet-title")||"Sheet",k=f.getAttribute("data-sheet-description")||"",u=f.getAttribute("data-sheet-content")||"placeholder";c&&(c.textContent=m),t&&(t.textContent=k);let w=!1;if(d.forEach(h=>{h.dataset.sheet===u?(h.hidden=!1,w=!0):h.hidden=!0}),!w&&o&&(o.hidden=!1),s.classList.add("aipkit-active"),s.setAttribute("aria-hidden","false"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_cw_builder_sheet"),u==="assistant"&&(typeof window.aipkit_initMessageCloseButtons=="function"&&window.aipkit_initMessageCloseButtons("aipkit_content_writer_messages"),typeof window.aipkit_initEnhancerActionsUI=="function"&&window.aipkit_initEnhancerActionsUI(),!s.dataset.assistantAutosaveBound)){let h=g(s);s.dataset.assistantAutosaveBaseline=a(h),s.addEventListener("change",v=>{let C=v.target;!C||!C.matches("#aipkit_enhancer_editor_integration")&&!C.matches("#aipkit_enhancer_list_button")&&!C.matches('input[name="enhancer_insert_position_default"]')||r(s)}),s.dataset.assistantAutosaveBound="true"}l&&l.focus()},p=()=>{s.classList.remove("aipkit-active"),s.setAttribute("aria-hidden","true")};i.dataset.assistantSheetBound||(i.addEventListener("click",f=>{let m=f.target.closest(".aipkit_builder_sheet_trigger");m&&(f.preventDefault(),_(m))}),i.dataset.assistantSheetBound="true"),l&&l.dataset.assistantSheetBound!=="true"&&(l.addEventListener("click",p),l.dataset.assistantSheetBound="true"),s.dataset.assistantSheetBound||(s.addEventListener("click",f=>{f.target===s&&p()}),document.addEventListener("keydown",f=>{f.key==="Escape"&&s.classList.contains("aipkit-active")&&p()}),s.dataset.assistantSheetBound="true")}window.aipkit_initContentWriterAssistantSheet=n})();(function(){"use strict";let g=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],a=d=>{let o=g.findIndex(l=>l.key===d);return o===-1?1:o},r=(d,o)=>{let l=Number(d);if(!l||Number.isNaN(l))return"medium";let _="medium",p=1/0;return Object.keys(o).forEach(f=>{let m=Math.abs(l-o[f]);m<p&&(p=m,_=f)}),_},n=(d,o)=>{if(!d)return;let l=d.querySelector(".aipkit_ai_behavior_value"),_=d.querySelector(".aipkit_ai_behavior_hint"),p=d.querySelector(".aipkit_ai_length_slider"),f=g[a(o)];l&&(l.textContent=f.label),_&&(_.textContent=`Approx. ${f.words} words`),p&&(p.value=String(a(o)+1))},e=d=>{let o=d.querySelector(".aipkit_ai_temperature_control");if(!o)return;let l=o.querySelector(".aipkit_ai_temperature_slider"),_=o.querySelector(".aipkit_ai_behavior_value");if(!l||!_||l.dataset.enhancedListenerAttached==="true")return;let p=()=>{_.textContent=l.value};l.addEventListener("input",p),p(),l.dataset.enhancedListenerAttached="true"},i=d=>{let o=d.querySelectorAll(".aipkit_ai_reasoning_input"),l=d.querySelector("[data-aipkit-reasoning-select]");if(!o.length||!l||l.dataset.reasoningSyncAttached==="true")return;let _=f=>f==="minimal"?"low":f,p=f=>{let m=_(f);d.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>u.classList.remove("aipkit_ai_reasoning_option--selected"));let k=d.querySelector(`.aipkit_ai_reasoning_input[value="${m}"]`);if(k){k.checked=!0;let u=k.closest(".aipkit_ai_reasoning_option");u&&u.classList.add("aipkit_ai_reasoning_option--selected")}};o.forEach(f=>{f.dataset.reasoningListenerAttached!=="true"&&(f.addEventListener("change",()=>{f.checked&&(l.value=_(f.value),l.dispatchEvent(new Event("change",{bubbles:!0})),p(f.value))}),f.dataset.reasoningListenerAttached="true")}),l.addEventListener("change",()=>{p(l.value||"medium")}),p(l.value||"medium"),l.dataset.reasoningSyncAttached="true"},s=d=>{let o=d.querySelector(".aipkit_ai_length_control");if(!o)return;let l=o.querySelector(".aipkit_ai_length_slider"),_=o.querySelector("[data-aipkit-length-input]");if(!l||!_||l.dataset.lengthListenerAttached==="true")return;let p=o.dataset.aipkitLengthMode||"content_length",f={short:Number(o.dataset.aipkitLengthShort||2e3),medium:Number(o.dataset.aipkitLengthMedium||4e3),long:Number(o.dataset.aipkitLengthLong||6e3)},m=(u,w)=>{let h=g.some(v=>v.key===u)?u:"medium";if(n(o,h),p==="content_length")_.value!==h&&(_.value=h);else{let v=f[h]||f.medium;Number(_.value)!==v&&(_.value=String(v))}w&&_.dispatchEvent(new Event("change",{bubbles:!0}))},k=()=>{if(p==="content_length"){m(_.value||"medium",!1);return}let u=r(_.value,f);m(u,!1)};l.addEventListener("input",()=>{let u=Math.max(1,Math.min(3,Number(l.value||2)))-1,w=g[u]?.key||"medium";m(w,!0)}),_.addEventListener("change",k),k(),l.dataset.lengthListenerAttached="true"},c=d=>{!d||d.dataset.aiSettingsInit==="true"||(e(d),s(d),i(d),d.dataset.aiSettingsInit="true")};function t(d){let o=d||document.getElementById("aipkit_autogpt_container");o&&o.querySelectorAll(".aipkit_ai_settings_redesigned").forEach(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>t()):t(),window.aipkit_initAutogptAiSettingsRedesigned=t})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function g(a,r={},n={}){return new Promise((e,i)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return i(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let s=new FormData;s.append("action",a),!Object.prototype.hasOwnProperty.call(r,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&s.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let d in r)Object.prototype.hasOwnProperty.call(r,d)&&(Array.isArray(r[d])?r[d].forEach(o=>{s.append(d+"[]",o)}):s.append(d,r[d]));let c=new AbortController,t=setTimeout(()=>{c.abort()},n.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:s,credentials:"same-origin",signal:c.signal}).then(d=>(clearTimeout(t),d.json())).then(d=>{if(d.success)e(d.data);else{let o=d.data||{},l=o.message||"Unknown error",_=new Error(l);o.debug_error&&(_.debug=o.debug_error),_.data=o,o.code&&(_.code=o.code),o.details&&(_.details=o.details),i(_)}}).catch(d=>{clearTimeout(t),d.name==="AbortError"?i(new Error("Request timeout")):i(d)})})}window.aipkit_apiRequest=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_modulesMenu");if(a){let n=a.querySelector(".aipkit_dropdown-panel"),e=a.querySelector(".aipkit_menu-trigger");e&&e.addEventListener("click",function(i){i.stopPropagation(),a.classList.toggle("aipkit_show-menu")}),n&&n.addEventListener("click",function(i){i.stopPropagation()})}document.addEventListener("click",function(n){a&&a.classList.contains("aipkit_show-menu")&&(a.contains(n.target)||a.classList.remove("aipkit_show-menu"))});let r=document.getElementById("aipkit_modulesMenuMobile");if(r){r.addEventListener("click",function(e){e.stopPropagation(),r.classList.toggle("aipkit_show-menu")});let n=r.querySelector(".aipkit_dropdown-menu");n&&n.addEventListener("click",function(e){e.stopPropagation()})}}window.aipkit_initSettingsMenus=g})();(function(){"use strict";function g(){let n=document.getElementById("aipkit_upgradeBtn"),e=document.getElementById("aipkit_upgradeModal");!n||!e||(n.addEventListener("click",function(i){i.preventDefault(),a(e)}),e.querySelectorAll("[data-close-modal]").forEach(function(i){i.addEventListener("click",function(s){s.preventDefault(),r(e)})}),document.addEventListener("keydown",function(i){i.key==="Escape"&&e.classList.contains("aipkit_active")&&r(e)}),e.querySelector(".aipkit_modal").addEventListener("click",function(i){i.stopPropagation()}))}function a(n){n.classList.add("aipkit_active"),document.body.classList.add("aipkit_upgrade_modal_open");let e=n.querySelector('button, a, [tabindex]:not([tabindex="-1"])');e&&setTimeout(()=>e.focus(),100)}function r(n){n.classList.remove("aipkit_active"),document.body.classList.remove("aipkit_upgrade_modal_open")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g(),window.aipkit_initUpgradeModal=g})();(function(){"use strict";let g={settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",stats:"aipkit_initStats","image-generator":"aipkit_initImageGenerator",sources:"aipkit_initSources","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"};async function a(r,n,e){let i={};if(typeof n=="function"?e=n:typeof n=="object"&&n!==null&&(i=n),r==="chatbot"&&!i.force_active_bot_id&&!i.force_active_tab)try{let l=localStorage.getItem("aipkit_last_selected_chatbot");l&&(i.force_active_bot_id=l)}catch(l){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",l)}if(r==="chatbot"&&!i.layout)try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(i.layout="next")}catch(l){console.warn("AIPKit Loader: Failed to read chatbot layout flag from URL:",l)}document.querySelectorAll(".aipkit_module-link").forEach(l=>l.classList.remove("aipkit_active"));let c=document.querySelector(`.aipkit_module-link[data-module="${r}"]`);c&&c.classList.add("aipkit_active");let t=document.getElementById("aipkit_module-container");if(!t)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof e=="function"&&e(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));let d=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",r):`Loading ${r}...`;if(t.innerHTML=`
            <div class="aipkit_container aipkit_loading-placeholder">
                <div class="aipkit_container-body">
                    <p style="text-align: center; padding: 30px;">
                        <span class="aipkit_spinner"
                            style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                        </span>
                        ${d}
                    </p>
                </div>
            </div>
        `,typeof window.aipkit_apiRequest!="function"){let l="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${r}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(t,r,l),typeof e=="function"&&e(new Error(l)),Promise.reject(new Error(l))}let o={module:r,...i};try{let l=await window.aipkit_apiRequest("aipkit_dashboard_load_module",o);if(!l||typeof l.html!="string")throw new Error('Missing or invalid "html" in response data');t.innerHTML=l.html,r==="chatbot"&&l.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=l.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let _=g[r];if(_&&typeof window[_]=="function")try{window[_]()}catch(p){let f=`Error initializing ${r} module scripts.`;return console.error(`AIPKit Loader: Error executing initializer '${_}':`,p),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(t,r,f+` (Details: ${p.message})`),typeof e=="function"&&e(new Error(f+` (Details: ${p.message})`)),Promise.reject(new Error(f+` (Details: ${p.message})`))}return typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(t),typeof e=="function"&&e(),Promise.resolve()}catch(l){return l&&l.debug?console.error(`AIPKit Loader: Module loading error for '${r}':`,l.message,`
Server debug:`,l.debug):console.error(`AIPKit Loader: Module loading error for '${r}':`,l),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(t,r,l.message),typeof e=="function"&&e(l),Promise.reject(l)}}window.aipkit_loadModule=a})();(function(){"use strict";function g(a,r,n){if(!a)return;let e=window.aipkit_dashboard?.text||{},i=e.errorLoadingModuleTitle||"Error Loading Module",s=e.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",c=e.errorDetails||"Details:",t=s.replace("%s",r);a.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${i}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${t}</p>
                    <p><strong>${c}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${n||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_modulesMenu");if(!a)return;let r=a.querySelector(".aipkit_dropdown-panel");r&&(r.addEventListener("change",function(n){let e=n.target;if(e.matches&&e.matches(".aipkit_module-toggle")){let i=r.querySelectorAll(".aipkit_module-toggle");i.forEach(p=>p.disabled=!0),i.forEach(p=>p.disabled=!0);let s=e.getAttribute("data-module"),c=e.getAttribute("data-option-key"),t=e.getAttribute("data-icon"),d=e.getAttribute("data-label"),o=e.checked,l=document.querySelector(`.aipkit_module-link[data-module="${s}"]`);o?l?l.style.display="":console.log(`Module Toggle: Enabling '${s}'. Nav link will appear on refresh if needed.`):l&&(l.style.display="none");let _={moduleKey:c,enabled:o?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),e.checked=!o,l&&(l.style.display=o?"none":""),i.forEach(p=>p.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",_).then(()=>{console.log(`Module Toggle: '${s}' status updated successfully.`)}).catch(p=>{console.error("Error updating module setting:",p.message),alert(`Error updating module setting: ${p.message}`),e.checked=!o,l&&(l.style.display=o?"none":"")}).finally(()=>{i.forEach(p=>p.disabled=!1)})}}),r.addEventListener("click",function(n){let e=n.target.closest(".aipkit_module-item");if(e){let i=e.querySelector(".aipkit_toggle-switch");if(i&&!i.contains(n.target)){let s=e.querySelector(".aipkit_module-toggle");if(s&&!s.disabled){s.checked=!s.checked;let c=new Event("change",{bubbles:!0});s.dispatchEvent(c)}}}}))}window.aipkit_initModuleToggles=g})();(function(){"use strict";function g(){document.querySelectorAll(".aipkit_tabs").forEach(n=>{if(n.dataset.tabGroupListenerAttached==="true")return;let e=n.querySelectorAll(".aipkit_tab"),i=n.nextElementSibling;if(!i||!i.classList.contains("aipkit_tab_content_container")){let s=n.closest(".aipkit_container-body, .aipkit_container"),c=s?s.querySelector(".aipkit_tab_content_container"):null;if(!c)return;let t=c.querySelectorAll(".aipkit_tab-content");a(n,e,t)}else{let s=i.querySelectorAll(".aipkit_tab-content");a(n,e,s)}})}function a(r,n,e){n.forEach(i=>{i.addEventListener("click",function(){n.forEach(t=>t.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),e.forEach(t=>t.classList.remove("aipkit_active"));let s=this.getAttribute("data-tab"),c=Array.from(e).find(t=>t.id===s+"-content");c&&(c.classList.add("aipkit_active"),c.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),r.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=g})();document.addEventListener("DOMContentLoaded",function(){typeof window.aipkit_initSettingsMenus=="function"?window.aipkit_initSettingsMenus():console.error("AIPKit Main: aipkit_initSettingsMenus function not found."),typeof window.aipkit_initModuleToggles=="function"?window.aipkit_initModuleToggles():console.error("AIPKit Main: aipkit_initModuleToggles function not found.");let r=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(r)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let n=["settings","chatbot","content-writer","ai-forms","image-generator","sources"],e=Array.from(document.querySelectorAll(".aipkit_module-link")),i=null;for(let s=0;s<n.length;s++){let c=n[s];if(e.find(d=>d.getAttribute("data-module")===c&&d.offsetParent!==null)){i=c;break}}if(!i){let s=e.find(c=>c.offsetParent!==null);s&&(i=s.getAttribute("data-module"))}if(i)window.aipkit_loadModule(i);else if(e.find(c=>c.getAttribute("data-module")==="settings"))window.aipkit_loadModule("settings");else{let c=document.getElementById("aipkit_module-container");c&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(c,"initial","No modules enabled or accessible. Please activate modules via the top-right menu or check permissions."):c&&(c.innerHTML='<p style="text-align:center; padding: 30px;">No modules enabled. Activate modules via the top-right menu.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!r){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let n=document.getElementById("aipkit_module-container");n&&(n.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector("#aipkit_sources_settings_popover");if(!r)return;let n=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!n.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),i=r.querySelector(".aipkit_model_settings_popover_back"),s=a.querySelector("#aipkit_sources_settings_trigger"),c={root:r.dataset.titleRoot||"Settings",general:r.dataset.titleGeneral||"General","provider-credentials":r.dataset.titleProviderCredentials||"Provider credentials","document-chunking":r.dataset.titleDocumentChunking||"Document chunking"},t=null,d=o=>{let l=o||"root",_=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!_)return;let p=_.dataset.aipkitSettingsPanel||"root";p!==t&&(n.forEach(f=>{f.hidden=f!==_}),e&&(e.textContent=c[p]||c.root),i&&(i.hidden=p==="root"),t=p,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",o=>{let l=o.target.closest("[data-aipkit-panel-target]");if(!l)return;o.preventDefault();let _=l.dataset.aipkitPanelTarget;d(_)}),i&&i.addEventListener("click",o=>{o.preventDefault(),d("root")}),s&&s.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitSources_initSettingsPopoverPanels=g})();(function(){"use strict";let g=window.wp&&window.wp.i18n?window.wp.i18n:null,a=g&&typeof g.__=="function"?g.__:B=>B,r=g&&typeof g.sprintf=="function"?g.sprintf:(B,...$)=>B.replace(/%s/g,()=>$.shift()),n=g&&typeof g._n=="function"?g._n:(B,$,G)=>G===1?B:$,e=typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml:B=>String(B??""),i=60,s={openai:{singular:a("Vector store","gpt3-ai-content-generator"),plural:a("Vector stores","gpt3-ai-content-generator"),loading:a("Loading vector stores...","gpt3-ai-content-generator"),empty:a("No vector stores found.","gpt3-ai-content-generator")},pinecone:{singular:a("Index","gpt3-ai-content-generator"),plural:a("Indexes","gpt3-ai-content-generator"),loading:a("Loading indexes...","gpt3-ai-content-generator"),empty:a("No indexes found.","gpt3-ai-content-generator")},qdrant:{singular:a("Collection","gpt3-ai-content-generator"),plural:a("Collections","gpt3-ai-content-generator"),loading:a("Loading collections...","gpt3-ai-content-generator"),empty:a("No collections found.","gpt3-ai-content-generator")},default:{singular:a("Index","gpt3-ai-content-generator"),plural:a("Indexes","gpt3-ai-content-generator"),loading:a("Loading indexes...","gpt3-ai-content-generator"),empty:a("No indexes found.","gpt3-ai-content-generator")}},c={openai:{key:"openai",typeLabel:a("Vector stores","gpt3-ai-content-generator"),emptyLabel:a("No vector stores found.","gpt3-ai-content-generator"),loadingLabel:a("Loading vector stores...","gpt3-ai-content-generator"),listAction:"aipkit_list_vector_stores_openai",listKey:"stores",createAction:"aipkit_create_vector_store_openai",createKey:"store",nameLabel:a("Store name","gpt3-ai-content-generator"),namePlaceholder:a("e.g. Product FAQ","gpt3-ai-content-generator"),countSingular:a("store","gpt3-ai-content-generator"),countPlural:a("stores","gpt3-ai-content-generator"),needsDimension:!1},pinecone:{key:"pinecone",typeLabel:a("Indexes","gpt3-ai-content-generator"),emptyLabel:a("No indexes found.","gpt3-ai-content-generator"),loadingLabel:a("Loading indexes...","gpt3-ai-content-generator"),listAction:"aipkit_list_indexes_pinecone",listKey:"indexes",createAction:"aipkit_create_index_pinecone",createKey:"index",nameLabel:a("Index name","gpt3-ai-content-generator"),namePlaceholder:a("e.g. site-content","gpt3-ai-content-generator"),countSingular:a("index","gpt3-ai-content-generator"),countPlural:a("indexes","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536},qdrant:{key:"qdrant",typeLabel:a("Collections","gpt3-ai-content-generator"),emptyLabel:a("No collections found.","gpt3-ai-content-generator"),loadingLabel:a("Loading collections...","gpt3-ai-content-generator"),listAction:"aipkit_list_collections_qdrant",listKey:"collections",createAction:"aipkit_create_collection_qdrant",createKey:"collection",nameLabel:a("Collection name","gpt3-ai-content-generator"),namePlaceholder:a("e.g. docs","gpt3-ai-content-generator"),countSingular:a("collection","gpt3-ai-content-generator"),countPlural:a("collections","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536}},t={openai:"aipkit_vector_store_nonce_openai",pinecone:"aipkit_vector_store_pinecone_nonce_management",qdrant:"aipkit_vector_store_qdrant_nonce_management"},d={openai:{action:"aipkit_delete_vector_store_openai",param:"store_id",label:a("vector store","gpt3-ai-content-generator")},pinecone:{action:"aipkit_delete_index_pinecone",param:"index_name",label:a("index","gpt3-ai-content-generator")},qdrant:{action:"aipkit_delete_collection_qdrant",param:"collection_name",label:a("collection","gpt3-ai-content-generator")}},o="aipkit_sources_filters_v1";function l(){try{let B=window.localStorage.getItem(o);if(!B)return{};let $=JSON.parse(B);return $&&typeof $=="object"?$:{}}catch{return{}}}function _(B){try{window.localStorage.setItem(o,JSON.stringify(B))}catch{}}function p(B){if(!B)return[];try{let $=JSON.parse(B);return Array.isArray($)?$:[]}catch{return[]}}function f(B,$){return B?B.length>$?`${B.slice(0,$)}...`:B:""}function m(B){return String(B||"").trim().toLowerCase()}function k(B){return c[m(B)]||null}function u(B){return d[m(B)]||null}function w(B){let $=m(B);return s[$]||s.default}function h(){let B=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return B&&typeof B=="object"?B:{}}function v(B){let $=m(B),G=h();return Object.prototype.hasOwnProperty.call(G,$)?!!G[$]:null}function C(B){let $=v(B);return $===!0?{label:a("Connected","gpt3-ai-content-generator"),className:"aipkit_status-success"}:$===!1?{label:a("Needs setup","gpt3-ai-content-generator"),className:"aipkit_status-warning"}:{label:a("Unknown","gpt3-ai-content-generator"),className:"aipkit_status-info"}}function x(B,$){return!$||typeof $!="object"?"":B==="openai"?$.id||$.vector_store_id||"":B==="pinecone"?$.name||$.id||"":B==="qdrant"?$.name||$.id||$.collection_name||"":$.id||$.name||""}function b(B,$){let G=x(B,$);return!$||typeof $!="object"?G||"\u2014":$.name||$.vector_store_name||G||"\u2014"}function I(B){let $=String(B?.message||"").toLowerCase(),G=m(B?.provider||""),L=String(B?.file_id||""),K=!!B?.post_id;if($.includes("file content submitted for indexing")||$.includes("file content embedded and upserted")||$.includes("original filename:")||$.includes("file uploaded"))return{key:"file",label:a("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if((G==="pinecone"||G==="qdrant")&&L&&(L.includes("pinecone_file_")||L.includes("file_"))&&!L.startsWith("wp_post_")&&!L.startsWith("text_"))return{key:"file",label:a("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if($.includes("text content submitted for indexing"))return{key:"text",label:a("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(G==="qdrant"&&$.includes("points upserted to qdrant"))return K||$.includes("post id:")?{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"}:{key:"text",label:a("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(G==="pinecone"&&$.includes("vectors upserted")){if(L.startsWith("wp_post_"))return{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(L.startsWith("text_"))return{key:"text",label:a("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(L.includes("pinecone_file_")||L.includes("file_"))return{key:"file",label:a("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"}}if($.includes("wordpress post content submitted for indexing"))return{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(K)return{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(G==="pinecone"&&L){if(L.startsWith("wp_post_"))return{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(L.startsWith("text_"))return{key:"text",label:a("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"}}return{key:"na",label:a("N/A","gpt3-ai-content-generator"),className:""}}function y(B){let $=B||"";return $==="indexed"||$==="skipped_already_indexed"||$==="success"?{label:a("Trained","gpt3-ai-content-generator"),className:"aipkit_status-success"}:$==="failed"?{label:$.replace(/_/g," "),className:"aipkit_status-warning"}:$?{label:$.replace(/_/g," "),className:"aipkit_status-info"}:{label:"\u2014",className:"aipkit_status-info"}}function q(B){return B.post_title?String(B.post_title):B.post_id?`${a("Post","gpt3-ai-content-generator")} #${B.post_id}`:B.indexed_content?String(B.indexed_content):B.message?String(B.message):B.file_id?String(B.file_id):B.vector_store_name?String(B.vector_store_name):"\u2014"}function E(B){let $=m(B);return $?{openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"}[$]||String(B):"\u2014"}function S(B){let $=m(B);return $&&["openai","pinecone","qdrant"].includes($)?`aipkit_settings_select_picker_icon--${$}`:""}function A(B){return B.vector_store_name?String(B.vector_store_name):B.vector_store_id?String(B.vector_store_id):"\u2014"}function T(B,$,G){if(!B)return;let L=B.classList.contains("aipkit_training_status");if(B.textContent=$||"",L){B.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),$&&B.classList.add("is-visible"),G&&B.classList.add(`is-${G}`);return}B.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),G==="success"?B.classList.add("aipkit_form-help-success"):G==="error"&&B.classList.add("aipkit_form-help-error")}function M(B,$,G){B&&(B.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${e(G)}</td></tr>`,$&&($.innerHTML=""))}function V(B,$){if(!B)return;if(!Array.isArray($)||!$.length){M(B,null,a("No sources found.","gpt3-ai-content-generator"));return}let G=$.map(L=>{let K=I(L),H=y(L.status),ne=L.status==="processing"||L.status==="queued",ae=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(L.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(L.timestamp):L.timestamp||"\u2014",Z=E(L.provider),pe=S(L.provider),ve=pe?`<span class="aipkit_settings_select_picker_icon ${e(pe)}" aria-hidden="true"></span>`:"",De=A(L),Qe=f(De,40),$e=Z?`${Z} \xB7 ${De}`:De,lt=String(q(L)||"\u2014"),it=f(lt,i),we=L.indexed_content||"",at=[];return K.key==="site"&&L.post_id&&L.vector_store_id&&L.file_id&&at.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              data-post-id="${e(L.post_id||"")}"
              data-embedding-provider="${e(L.embedding_provider||"")}"
              data-embedding-model="${e(L.embedding_model||"")}"
              ${ne?'disabled aria-disabled="true"':""}
            >${e(a(ne?"Training...":"Retrain","gpt3-ai-content-generator"))}</button>`),K.key==="text"&&we&&L.vector_store_id&&L.file_id&&at.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              data-embedding-provider="${e(L.embedding_provider||"")}"
              data-embedding-model="${e(L.embedding_model||"")}"
              data-content="${e(encodeURIComponent(we))}"
              ${ne?'disabled aria-disabled="true"':""}
            >${e(a(ne?"Training...":"Edit","gpt3-ai-content-generator"))}</button>`),we&&at.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_view"
              data-snippet="${e(we)}"
              ${ne?'disabled aria-disabled="true"':""}
            >${e(a("View","gpt3-ai-content-generator"))}</button>`),L.file_id&&at.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              ${ne?'disabled aria-disabled="true"':""}
            >${e(a("Delete","gpt3-ai-content-generator"))}</button>`),`<tr data-log-id="${e(L.id||"")}">
          <td>${e(ae)}</td>
          <td title="${e($e)}">
            <span class="aipkit_popover_option_label_group">
              ${ve}
              <span>${e(Qe)}</span>
            </span>
          </td>
          <td><span class="aipkit_content-type-tag ${e(K.className)}">${e(K.label)}</span></td>
          <td title="${e(lt)}">${e(it)}</td>
          <td><span class="aipkit_status-tag ${e(H.className)}">${e(H.label)}</span></td>
          <td class="aipkit_actions_cell">
            <div class="aipkit-table-actions-group">${at.join("")}</div>
          </td>
        </tr>`}).join("");B.innerHTML=G}function W(B,$,G){if(!$)return;$.innerHTML="";let L=Number(B?.total_logs||0),K=Number(B?.total_pages||0),H=Number(B?.current_page||1);if(!L)return;let ne=document.createElement("span");if(ne.className="aipkit_pagination-count",ne.textContent=`${L.toLocaleString()} ${n("source","sources",L,"gpt3-ai-content-generator")}`,$.appendChild(ne),K<=1)return;let ae=document.createElement("span");ae.className="aipkit_pagination-links";let Z=document.createElement("button");Z.type="button",Z.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",Z.textContent=a("Prev","gpt3-ai-content-generator"),Z.disabled=H<=1,Z.addEventListener("click",()=>G(H-1));let pe=document.createElement("span");pe.className="aipkit_pagination-current",pe.textContent=`${H}/${K}`;let ve=document.createElement("button");ve.type="button",ve.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",ve.textContent=a("Next","gpt3-ai-content-generator"),ve.disabled=H>=K,ve.addEventListener("click",()=>G(H+1)),ae.appendChild(Z),ae.appendChild(pe),ae.appendChild(ve),$.appendChild(ae)}function R(){let B=document.getElementById("aipkit_sources_module_container");if(!B)return;let $=document.getElementById("aipkit_sources_table_body"),G=document.getElementById("aipkit_sources_pagination"),L=document.getElementById("aipkit_sources_status"),K=document.getElementById("aipkit_sources_provider_filter"),H=document.getElementById("aipkit_sources_index_filter"),ne=document.getElementById("aipkit_sources_status_filter"),ae=document.getElementById("aipkit_sources_type_filter"),Z=document.getElementById("aipkit_sources_search_input"),pe=document.getElementById("aipkit_sources_provider_popover_body"),ve=document.getElementById("aipkit_sources_settings_trigger"),De=document.getElementById("aipkit_sources_settings_popover"),Qe=document.getElementById("aipkit_sources_indexing_manage"),$e=B.querySelector('[data-aipkit-settings-action="indexing-controls"]'),lt=Qe||$e,it=document.getElementById("aipkit_sources_settings_save"),we=document.getElementById("aipkit_sources_settings_sheet"),at=we?we.querySelector(".aipkit_builder_sheet_close"):null,Zt=document.getElementById("aipkit_save_indexing_settings_btn"),$t=document.getElementById("aipkit_indexing_settings_messages"),li=document.getElementById("aipkit_sources_settings_sheet_messages"),ai=document.getElementById("aipkit_sources_semantic_manage"),se=B.querySelector('[data-aipkit-settings-action="semantic-search"]'),ke=ai||se,_e=document.getElementById("aipkit_sources_semantic_sheet"),Ce=_e?_e.querySelector(".aipkit_builder_sheet_close"):null,Pe=document.getElementById("aipkit_sources_semantic_vector_provider"),be=document.getElementById("aipkit_sources_semantic_target_id"),Oe=document.getElementById("aipkit_sources_semantic_target_label"),Re=document.getElementById("aipkit_sources_semantic_embedding_model"),_t=document.getElementById("aipkit_sources_semantic_embedding_provider"),Wt=document.getElementById("aipkit_sources_semantic_num_results"),ri=document.getElementById("aipkit_sources_semantic_no_results_text"),Ht=document.getElementById("aipkit_sources_semantic_shortcode_copy"),ht=document.getElementById("aipkit_sources_semantic_demo_form"),Be=document.getElementById("aipkit_sources_semantic_demo_input"),qe=document.getElementById("aipkit_sources_semantic_demo_results"),gt=document.getElementById("aipkit_sources_semantic_demo_submit"),Pt=document.getElementById("aipkit_sources_index_empty_action"),qt=document.getElementById("aipkit_sources_index_create_trigger"),We=document.getElementById("aipkit_sources_editor_modal"),xi=We?We.querySelector(".aipkit_sources_editor_textarea"):null,Li=We?We.querySelector(".aipkit_sources_editor_close"):null,Ft=We?We.querySelector(".aipkit_sources_editor_cancel"):null,bt=We?We.querySelector(".aipkit_sources_editor_save"):null,Qt=document.getElementById("aipkit_sources_view_modal"),Jt=Qt?Qt.querySelector(".aipkit_sources_view_textarea"):null,di=Qt?Qt.querySelector(".aipkit_sources_view_close"):null,Hi=Qt?Qt.querySelector(".aipkit_sources_view_close_btn"):null,ti=document.getElementById("aipkit_sources_delete_modal"),fe=ti?ti.querySelector(".aipkit_sources_delete_close"):null,Fe=ti?ti.querySelector(".aipkit_sources_delete_cancel"):null,ge=ti?ti.querySelector(".aipkit_sources_delete_confirm"):null;if(!$||typeof window.aipkit_apiRequest!="function")return;let Ge=l(),et=Ge.indexByProvider&&typeof Ge.indexByProvider=="object"?{...Ge.indexByProvider}:{},Nt=Ge.embeddingByProvider&&typeof Ge.embeddingByProvider=="object"?{...Ge.embeddingByProvider}:{};K&&typeof Ge.provider=="string"&&Array.from(K.options).some(te=>te.value===Ge.provider)&&(K.value=Ge.provider),ne&&typeof Ge.status=="string"&&Array.from(ne.options).some(te=>te.value===Ge.status)&&(ne.value=Ge.status),ae&&typeof Ge.type=="string"&&Array.from(ae.options).some(te=>te.value===Ge.type)&&(ae.value=Ge.type),typeof window.aipkit_initChatSelectPickers=="function"&&window.aipkit_initChatSelectPickers();let Gt=null,wt=null,Ot=null,Yt=null,pi=null,Ze=null,Ee={page:1,perPage:10,provider:K?K.value:"",status:ne?ne.value:"",type:ae?ae.value:"",search:Z?Z.value.trim():"",indexByProvider:et,embeddingByProvider:Nt,openIndexCreateOnOpen:!1},Lt={activeProvider:"",stores:{},syncTokens:{}},ft={nonce:B.dataset.settingsNonce||"",isPro:B.dataset.settingsIsPro==="1"||B.dataset.settingsIsPro==="true"},ui={initialized:!1,accordionsBound:!1,saveBound:!1,autosaveBound:!1,originalSettings:{}},Mt=null,cn=!1,ln=!1,Ci={nonce:B.dataset.semanticSearchNonce||"",pineconeIndexes:p(B.dataset.semanticPineconeIndexes),qdrantCollections:p(B.dataset.semanticQdrantCollections)},rt={initialized:!1,autosaveBound:!1,dirty:!1},dn=null,hi=!1,Rt=!1,pn={pinecone_api_key:B.dataset.pineconeApiKey||"",qdrant_api_key:B.dataset.qdrantApiKey||"",qdrant_url:B.dataset.qdrantUrl||""},Ti=null,Vt=()=>{Gt&&window.clearTimeout(Gt),Gt=window.setTimeout(()=>{T(L,"","")},3e3)},ao=()=>{Yt&&window.clearTimeout(Yt),Yt=window.setTimeout(()=>{T($t,"","")},3e3)},Vi=()=>!H||H.disabled?"":H.value||"",ei=()=>!H||!H.id?null:document.getElementById(`${H.id}_picker_btn`),ro=Q=>{if(!H)return;let te=!Q;H.hidden=te;let F=ei();F&&(F.hidden=te)},_n=(Q,te={})=>{if(!H)return;H.disabled=Q;let F=ei();F&&(te.disableTrigger!==!1?(F.disabled=Q,Q?F.setAttribute("aria-disabled","true"):F.removeAttribute("aria-disabled")):(F.disabled=!1,F.removeAttribute("aria-disabled")))},bi=(Q,te)=>{if(!Pt||!qt)return;Pt.hidden=!Q;let F=ei();if(F&&(Q?F.hidden=!0:(!H||!H.hidden)&&(F.hidden=!1)),!Q)return;let N=m(te),P=w(N);qt.textContent=r(a("Create new %s","gpt3-ai-content-generator"),P.singular.toLowerCase());let j=v(N),J=!!N&&j!==!1;qt.disabled=!J,J?(qt.removeAttribute("aria-disabled"),qt.removeAttribute("title")):(qt.setAttribute("aria-disabled","true"),qt.setAttribute("title",a("Add credentials to create.","gpt3-ai-content-generator")))},yi=Q=>{let te=ei();if(!te||!Q)return;let F=Q.getBoundingClientRect(),N={hidden:te.hidden,style:te.getAttribute("style")||""};te.hidden=!1,te.style.position="fixed",te.style.left=`${Math.round(F.left)}px`,te.style.top=`${Math.round(F.top)}px`,te.style.width=`${Math.round(F.width)}px`,te.style.height=`${Math.round(F.height)}px`,te.style.opacity="0",te.style.pointerEvents="none",te.click();let P=()=>{te.setAttribute("style",N.style),N.hidden&&(te.hidden=!0)};window.requestAnimationFrame(()=>{window.requestAnimationFrame(P)})},so=()=>!H||!H.id?null:document.getElementById(`${H.id}_picker_popover`),Ri=()=>{let Q=so();if(!Q)return null;Q.classList.add("aipkit_sources_index_picker_popover");let te=Q.querySelector(".aipkit_model_settings_popover_body");if(!te)return null;let F=te.querySelector(".aipkit_sources_index_picker_actions");return F||(F=document.createElement("div"),F.className="aipkit_sources_index_picker_actions",F.innerHTML=`
          <div class="aipkit_sources_index_action_list">
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_sources_index_new_btn">
              <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
              ${St(a("New","gpt3-ai-content-generator"))}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_delete_btn" disabled aria-disabled="true">
              <span class="dashicons dashicons-trash" aria-hidden="true"></span>
              ${St(a("Delete","gpt3-ai-content-generator"))}
            </button>
          </div>
          <div class="aipkit_sources_index_inline_form" style="display: none;">
            <div class="aipkit_popover_options_list">
              <div class="aipkit_popover_option_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label aipkit_sources_index_create_label" for="aipkit_sources_index_name_input">
                    ${St(a("Create","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="text"
                      id="aipkit_sources_index_name_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--vector-wide aipkit_popover_option_input--framed"
                      placeholder=""
                      data-aipkit-provider-name-input
                    >
                  </div>
                </div>
              </div>
              <div class="aipkit_popover_option_row aipkit_sources_index_dimension_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label" for="aipkit_sources_index_dimension_input">
                    ${St(a("Dimension","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="number"
                      id="aipkit_sources_index_dimension_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--compact aipkit_popover_option_input--framed"
                      min="1"
                      placeholder="${St(a("e.g. 1536","gpt3-ai-content-generator"))}"
                      data-aipkit-provider-dimension-input
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="aipkit_sources_index_inline_actions">
              <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_create">
                ${St(a("Cancel","gpt3-ai-content-generator"))}
              </button>
              <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_sources_index_create_btn">
                ${St(a("Create","gpt3-ai-content-generator"))}
              </button>
            </div>
          </div>
          <div class="aipkit_inline_confirm aipkit_sources_index_inline_confirm" style="display: none;">
            <div class="aipkit_inline_confirm_content">
              <p class="aipkit_builder_help_text aipkit_sources_index_delete_confirm_text"></p>
              <div class="aipkit_inline_confirm_actions">
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_confirm_delete">
                  ${St(a("Confirm","gpt3-ai-content-generator"))}
                </button>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_delete">
                  ${St(a("Cancel","gpt3-ai-content-generator"))}
                </button>
              </div>
            </div>
          </div>
          <p class="aipkit_form-help aipkit_sources_index_status" aria-live="polite" style="display: none;"></p>
        `,te.appendChild(F)),F},si=()=>{let Q=Ri();return Q?{footer:Q,actionList:Q.querySelector(".aipkit_sources_index_action_list"),newButton:Q.querySelector(".aipkit_sources_index_new_btn"),deleteButton:Q.querySelector(".aipkit_sources_index_delete_btn"),inlineForm:Q.querySelector(".aipkit_sources_index_inline_form"),createButton:Q.querySelector(".aipkit_sources_index_create_btn"),cancelCreate:Q.querySelector(".aipkit_sources_index_cancel_create"),nameInput:Q.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:Q.querySelector("[data-aipkit-provider-dimension-input]"),dimensionRow:Q.querySelector(".aipkit_sources_index_dimension_row"),createLabel:Q.querySelector(".aipkit_sources_index_create_label"),deleteConfirm:Q.querySelector(".aipkit_sources_index_inline_confirm"),deleteConfirmText:Q.querySelector(".aipkit_sources_index_delete_confirm_text"),confirmDelete:Q.querySelector(".aipkit_sources_index_confirm_delete"),cancelDelete:Q.querySelector(".aipkit_sources_index_cancel_delete"),statusEl:Q.querySelector(".aipkit_sources_index_status")}:null},un=(Q,te)=>{let F=si(),N=L||(F?F.statusEl:null);N&&(T(N,Q,te),F&&N===F.statusEl&&(N.style.display=Q?"block":"none"))},$i=()=>{Ot&&window.clearTimeout(Ot),Ot=window.setTimeout(()=>{un("","")},3e3)},gi=()=>{let Q=si();Q&&(Q.inlineForm&&(Q.inlineForm.style.display="none"),Q.deleteConfirm&&(Q.deleteConfirm.style.display="none"),Q.actionList&&(Q.actionList.style.display=""),Q.nameInput&&(Q.nameInput.value=""),Q.dimensionInput&&(Q.dimensionInput.value=""),un("",""))},Tt=Q=>{let te=si();if(!te)return;let F=m(Q),N=F?v(F):null,P=!!F&&N!==!1,j=P&&!!(H&&H.value);te.nameInput&&(te.nameInput.disabled=!P),te.dimensionInput&&(te.dimensionInput.disabled=!P),te.newButton&&(te.newButton.disabled=!P,P?te.newButton.removeAttribute("aria-disabled"):te.newButton.setAttribute("aria-disabled","true")),te.createButton&&(te.createButton.disabled=!P,P?te.createButton.removeAttribute("aria-disabled"):te.createButton.setAttribute("aria-disabled","true")),te.deleteButton&&(te.deleteButton.disabled=!j,j?te.deleteButton.removeAttribute("aria-disabled"):te.deleteButton.setAttribute("aria-disabled","true"))},Kn=Q=>{let te=si();if(!te||!te.dimensionInput)return;let F=m(Q),N=k(F);if(!N||!N.needsDimension)return;let P=N.defaultDimension||1536;te.dimensionInput.value||(te.dimensionInput.value=String(P))},vt=Q=>{let te=si();if(!te)return;let F=m(Q),N=k(F),P=w(F),j=N?N.namePlaceholder:"",J=N?N.nameLabel:P.singular;te.createLabel&&(te.createLabel.textContent=P.singular),te.nameInput&&(te.nameInput.placeholder=j,te.nameInput.setAttribute("aria-label",J)),te.dimensionRow&&(te.dimensionRow.style.display=N&&N.needsDimension?"":"none"),Tt(F)},En=()=>{let Q=si();if(!Q||Q.footer.dataset.indexActionsBound==="true")return;Q.newButton&&Q.newButton.addEventListener("click",()=>{gi(),Q.actionList&&(Q.actionList.style.display="none"),Q.inlineForm&&(Q.inlineForm.style.display=""),Kn(K?K.value:""),Q.nameInput&&(Q.nameInput.focus(),Q.nameInput.select())}),Q.cancelCreate&&Q.cancelCreate.addEventListener("click",()=>{gi()}),Q.deleteButton&&Q.deleteButton.addEventListener("click",()=>{let F=m(K?K.value:""),N=H?H.value:"";if(!F||!N){let oe=w(F);un(r(a("Select a %s to delete.","gpt3-ai-content-generator"),oe.singular.toLowerCase()),"error"),$i();return}let P=H&&H.selectedOptions?H.selectedOptions[0]:null,j=P?P.textContent:N,J=u(F),ie=J?J.label:w(F).singular.toLowerCase();Q.deleteConfirmText&&(Q.deleteConfirmText.textContent=r(a('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),ie,j)),Q.actionList&&(Q.actionList.style.display="none"),Q.inlineForm&&(Q.inlineForm.style.display="none"),Q.deleteConfirm&&(Q.deleteConfirm.style.display="")}),Q.cancelDelete&&Q.cancelDelete.addEventListener("click",()=>{gi()}),Q.createButton&&Q.createButton.addEventListener("click",async()=>{let F=m(K?K.value:"");if(!F)return;let N=await $n(F,Q.createButton,{root:Q.inlineForm,statusUpdater:un,clearStatusSoon:$i});Tt(F),N&&N.success&&gi()}),Q.confirmDelete&&Q.confirmDelete.addEventListener("click",async()=>{let F=m(K?K.value:""),N=H?H.value:"";if(!F||!N)return;let P=H&&H.selectedOptions?H.selectedOptions[0]:null,j=P?P.textContent:N,J=await Bn(F,N,j,Q.confirmDelete,{skipConfirm:!0,statusUpdater:un,clearStatusSoon:$i,defaultLabel:a("Confirm","gpt3-ai-content-generator")});Qi(),J&&(gi(),fi(1))}),Q.footer.dataset.indexActionsBound="true";let te=ei();te&&te.dataset.indexActionsBound!=="true"&&(te.addEventListener("click",()=>{gi(),vt(Ee.provider||""),Ee.openIndexCreateOnOpen&&(Ee.openIndexCreateOnOpen=!1,Q.actionList&&(Q.actionList.style.display="none"),Q.inlineForm&&(Q.inlineForm.style.display=""),Kn(Ee.provider||""),Q.nameInput&&(Q.nameInput.focus(),Q.nameInput.select()))}),te.dataset.indexActionsBound="true")},jn=(Q,te,F={})=>{if(!H)return;let N=m(Q),P=N&&Ee.indexByProvider[N]||"",j=w(N),J=!!N;ro(J),H.dataset.aipkitPickerTitle=j.singular;let ie=document.getElementById(`${H.id}_picker_title`);ie&&(ie.textContent=j.singular);let oe=document.getElementById(`${H.id}_picker_search`);if(oe){let ue=j.singular?`Search ${j.singular.toLowerCase()}...`:a("Search...","gpt3-ai-content-generator");oe.setAttribute("placeholder",ue)}if(H.innerHTML="",!J){let ue=document.createElement("option");ue.value="",ue.textContent=j.plural,H.appendChild(ue),H.value="",_n(!0),bi(!1,N),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),En(),vt(N);return}if(F.loading){let ue=document.createElement("option");ue.value="",ue.textContent=j.loading,ue.disabled=!0,H.appendChild(ue),H.value="",_n(!0,{disableTrigger:!1}),bi(!1,N),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),En(),vt(N);return}let U=Array.isArray(te)?te:[];if(!U.length){let ue=document.createElement("option");ue.value="",ue.textContent=F.emptyLabel||j.empty,ue.disabled=!0,H.appendChild(ue),H.value="",_n(!0,{disableTrigger:!1}),bi(!0,N),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),En(),vt(N);return}let O=document.createElement("option");O.value="",O.textContent=r(a("All %s","gpt3-ai-content-generator"),j.plural.toLowerCase()),H.appendChild(O),U.forEach(ue=>{let ye=x(N,ue),ze=b(N,ue);if(!ye)return;let st=document.createElement("option");st.value=ye,st.textContent=ze||ye,H.appendChild(st)});let Y=Ee.indexByProvider[N]||"",ce=Y?U.some(ue=>x(N,ue)===Y):!1;Y&&!ce&&(Ee.indexByProvider[N]=""),H.value=ce?Y:"",_n(!1),bi(!1,N),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),N&&P!==Ee.indexByProvider[N]&&_({provider:Ee.provider,status:Ee.status,type:Ee.type,indexByProvider:Ee.indexByProvider,embeddingByProvider:Ee.embeddingByProvider}),En(),vt(N)},Pi=()=>$t||L||(pe?pe.querySelector("#aipkit_sources_provider_panel_status"):null),At=(Q,te)=>{let F=Pi();T(F,Q,te)},Ki=()=>{wt&&window.clearTimeout(wt),wt=window.setTimeout(()=>{At("","")},3e3)},co=()=>{Qt&&(Qt.classList.remove("aipkit-active"),Qt.setAttribute("aria-hidden","true"),Jt&&(Jt.value=""))},Mi=Q=>{!Qt||!Jt||(Jt.value=Q||"",Jt.scrollTop=0,Qt.classList.add("aipkit-active"),Qt.setAttribute("aria-hidden","false"),Jt.focus())},Ne=()=>{We&&(We.classList.remove("aipkit-active"),We.setAttribute("aria-hidden","true"),We.dataset.provider="",We.dataset.storeId="",We.dataset.vectorId="",We.dataset.logId="",We.dataset.embeddingProvider="",We.dataset.embeddingModel="",xi&&(xi.value=""))},lo=Q=>{!We||!xi||(We.dataset.provider=Q.dataset.provider||"",We.dataset.storeId=Q.dataset.storeId||"",We.dataset.vectorId=Q.dataset.vectorId||"",We.dataset.logId=Q.dataset.logId||"",We.dataset.embeddingProvider=Q.dataset.embeddingProvider||"",We.dataset.embeddingModel=Q.dataset.embeddingModel||"",xi.value=Q.dataset.content?decodeURIComponent(Q.dataset.content):"",We.classList.add("aipkit-active"),We.setAttribute("aria-hidden","false"),setTimeout(()=>xi.focus(),0))},Si=()=>{ti&&(ti.classList.remove("aipkit-active"),ti.setAttribute("aria-hidden","true"),ti.dataset.provider="",ti.dataset.storeId="",ti.dataset.vectorId="",ti.dataset.logId="")},Ai=Q=>{ti&&(ti.dataset.provider=Q.provider||"",ti.dataset.storeId=Q.storeId||"",ti.dataset.vectorId=Q.vectorId||"",ti.dataset.logId=Q.logId||"",ti.classList.add("aipkit-active"),ti.setAttribute("aria-hidden","false"),ge&&(ge.disabled=!1))},Bt=Q=>{let te=document.getElementById(Q);return te?te.value:""},Xe=Q=>{let te=t[m(Q)];return te?Bt(te):""},_i=()=>{let Q={...h()};return Q.pinecone=!!pn.pinecone_api_key,Q.qdrant=!!(pn.qdrant_api_key&&pn.qdrant_url),window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=Q,Q};_i();let Lo=Q=>Q.startsWith("pinecone_")?"pinecone":Q.startsWith("qdrant_")?"qdrant":"",po=async()=>{if(!pe)return;let Q=pe.querySelectorAll("[data-aipkit-provider-config]");if(!Q.length)return;let te={},F=!1,N=new Set;if(Q.forEach(P=>{let j=P.dataset.aipkitProviderConfig;if(!j)return;let J=P.value.trim();if(te[j]=J,pn[j]!==J){F=!0;let ie=Lo(j);ie&&N.add(ie)}}),!!F){At(a("Saving...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",te),Object.keys(te).forEach(P=>{pn[P]=te[P]}),_i(),Qi(),N.forEach(P=>{v(P)!==!1&&(Lt.activeProvider===P?fn(P,{silent:!0}):Lt.stores[P]=null)}),At(a("Saved","gpt3-ai-content-generator"),"success"),Ki()}catch(P){let j=P&&P.message?P.message:a("Save failed.","gpt3-ai-content-generator");At(`${a("Error:","gpt3-ai-content-generator")} ${j}`,"error"),Ki()}}},_o=()=>{Ti&&window.clearTimeout(Ti),Ti=window.setTimeout(()=>{po()},600)},Zi=(Q=pe)=>Q?{nameInput:Q.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:Q.querySelector("[data-aipkit-provider-dimension-input]"),deleteButton:Q.querySelector("[data-aipkit-provider-delete-selected]")}:{},Qi=()=>{let Q=m(K?K.value:pe?.dataset.provider||""),te=H?H.value:"",F=!!Q&&!!te&&v(Q)===!0,{deleteButton:N}=Zi();N&&(N.disabled=!F,F?N.removeAttribute("aria-disabled"):N.setAttribute("aria-disabled","true")),Tt(Q)},Ui=(Q,te,F={})=>{let N=m(Q),P=m(K?K.value:"");if(!N){jn("",[]),Qi();return}N===P&&(jn(N,te,{loading:F.loading===!0,emptyLabel:F.emptyLabel}),Qi())},tn=(Q,te,F,N)=>{Q&&(te?(Q.disabled=!0,Q.setAttribute("aria-disabled","true"),Q.textContent=N):(Q.disabled=!1,Q.removeAttribute("aria-disabled"),Q.textContent=F))},fn=async(Q,te={})=>{let F=k(Q);if(!F)return;let N=m(Q),P=te.silent===!0;if(v(N)===!1){At(a("Add provider credentials to load stores.","gpt3-ai-content-generator"),"error"),Ki();return}let J=Xe(N);if(!J){At(a("Provider nonce missing.","gpt3-ai-content-generator"),"error"),Ki();return}let ie=`${N}-${Date.now()}`;Lt.syncTokens[N]=ie,Ui(N,Lt.stores[N],{loading:!0}),P||At(a("Syncing stores...","gpt3-ai-content-generator"),"");let oe={_ajax_nonce:J};N==="openai"&&(oe.limit=100,oe.order="desc");let U=te.triggerButton||(pe&&pe.dataset.provider===N?pe.querySelector(".aipkit_sources_provider_sync"):null);tn(U,!0,a("Sync","gpt3-ai-content-generator"),a("Syncing...","gpt3-ai-content-generator"));try{let O=await window.aipkit_apiRequest(F.listAction,oe);if(Lt.syncTokens[N]!==ie)return;let Y=Array.isArray(O[F.listKey])?O[F.listKey]:[];Lt.stores[N]=Y,N==="pinecone"?Ci.pineconeIndexes=Y:N==="qdrant"&&(Ci.qdrantCollections=Y),Pe&&m(Pe.value)===N&&on(N,{preserveValue:!0}),Lt.activeProvider===N&&Ui(N,Y),P||(At(O.message||a("Stores synced.","gpt3-ai-content-generator"),"success"),Ki())}catch(O){if(Lt.syncTokens[N]!==ie)return;let Y=O&&O.message?O.message:a("Sync failed.","gpt3-ai-content-generator");At(`${a("Error:","gpt3-ai-content-generator")} ${Y}`,"error"),Ki(),Ui(N,Lt.stores[N])}finally{tn(U,!1,a("Sync","gpt3-ai-content-generator"),a("Syncing...","gpt3-ai-content-generator"))}},Bn=async(Q,te,F,N,P={})=>{let j=u(Q);if(!j)return!1;let J=m(Q),ie=typeof P.statusUpdater=="function"?P.statusUpdater:At,oe=typeof P.clearStatusSoon=="function"?P.clearStatusSoon:Ki,U=P.defaultLabel||(N?N.textContent.trim():"")||a("Delete","gpt3-ai-content-generator"),O=P.loadingLabel||a("Deleting...","gpt3-ai-content-generator"),Y=!1;if(!te)return ie(a("Missing store identifier.","gpt3-ai-content-generator"),"error"),oe(),!1;let ce=F||te,ue=r(a('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),j.label,ce);if(P.skipConfirm!==!0&&!window.confirm(ue))return!1;let ye=Xe(J);if(!ye)return ie(a("Provider nonce missing.","gpt3-ai-content-generator"),"error"),oe(),!1;tn(N,!0,U,O),ie(a("Deleting...","gpt3-ai-content-generator"),"");let ze={_ajax_nonce:ye};ze[j.param]=te;try{let st=await window.aipkit_apiRequest(j.action,ze),ot=(Array.isArray(Lt.stores[J])?Lt.stores[J]:[]).filter(ut=>x(J,ut)!==te);Lt.stores[J]=ot,J==="pinecone"?Ci.pineconeIndexes=ot:J==="qdrant"&&(Ci.qdrantCollections=ot),Pe&&m(Pe.value)===J&&on(J,{preserveValue:!0}),Lt.activeProvider===J&&Ui(J,ot),ie(st.message||a("Deleted.","gpt3-ai-content-generator"),"success"),oe(),Y=!0}catch(st){let nt=st&&st.message?st.message:a("Delete failed.","gpt3-ai-content-generator");ie(`${a("Error:","gpt3-ai-content-generator")} ${nt}`,"error"),oe()}finally{tn(N,!1,U,O)}return Y},$n=async(Q,te,F={})=>{let N=k(Q);if(!N)return{success:!1,createdId:""};let P=m(Q),j=typeof F.statusUpdater=="function"?F.statusUpdater:At,J=typeof F.clearStatusSoon=="function"?F.clearStatusSoon:Ki,ie=!1,oe="";if(v(P)===!1)return j(a("Add provider credentials to create stores.","gpt3-ai-content-generator"),"error"),J(),{success:!1,createdId:""};let O=Xe(P);if(!O)return j(a("Provider nonce missing.","gpt3-ai-content-generator"),"error"),J(),{success:!1,createdId:""};let{nameInput:Y,dimensionInput:ce}=Zi(F.root||pe),ue=Y?Y.value.trim():"";if(!ue)return j(a("Name is required.","gpt3-ai-content-generator"),"error"),J(),{success:!1,createdId:""};let ye=0;if(N.needsDimension&&(ye=ce?parseInt(ce.value,10):0,!ye||Number.isNaN(ye)))return j(a("Dimension is required.","gpt3-ai-content-generator"),"error"),J(),{success:!1,createdId:""};tn(te,!0,a("Create","gpt3-ai-content-generator"),a("Creating...","gpt3-ai-content-generator")),j(a("Creating...","gpt3-ai-content-generator"),"");let ze={_ajax_nonce:O,name:ue};N.needsDimension&&(ze.dimension=ye),P==="openai"&&(ze.source_type="sources_module_create");try{let st=await window.aipkit_apiRequest(N.createAction,ze),nt=st[N.createKey];if(nt){let ot=Array.isArray(Lt.stores[P])?Lt.stores[P].slice():[];oe=x(P,nt),oe&&ot.some(ut=>x(P,ut)===oe)||ot.unshift(nt),Lt.stores[P]=ot,P==="pinecone"?Ci.pineconeIndexes=Lt.stores[P]:P==="qdrant"&&(Ci.qdrantCollections=Lt.stores[P]),Pe&&m(Pe.value)===P&&on(P,{preserveValue:!0}),Lt.activeProvider===P&&Ui(P,Lt.stores[P])}else await fn(P);Y&&(Y.value=""),ce&&(ce.value=""),j(st.message||a("Store created.","gpt3-ai-content-generator"),"success"),J(),ie=!0}catch(st){let nt=st&&st.message?st.message:a("Create failed.","gpt3-ai-content-generator");j(`${a("Error:","gpt3-ai-content-generator")} ${nt}`,"error"),J()}finally{tn(te,!1,a("Create","gpt3-ai-content-generator"),a("Creating...","gpt3-ai-content-generator"))}return{success:ie,createdId:oe}},Fn=Q=>{let te=m(Q);if(Lt.activeProvider=te,gi(),!te)jn("",[]);else{let F=Lt.stores[te];if(Array.isArray(F))Ui(te,F);else if(v(te))Ui(te,[],{loading:!0}),fn(te,{silent:!0});else{let N=w(te);Ui(te,[],{emptyLabel:r(a("Add credentials to load %s.","gpt3-ai-content-generator"),N.plural.toLowerCase())})}}Qi()},uo=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():`text_${Date.now()}`,nn=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now(),en=Q=>typeof CSS<"u"&&CSS.escape?CSS.escape(String(Q)):String(Q).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),Nn=async(Q,te,F,N,P)=>{let j=Q.toLowerCase();if(j==="openai"){let oe=Bt("aipkit_vector_store_nonce_openai");if(!oe)throw new Error(a("OpenAI nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:oe,target_store_id:te,text_content:F,source_type:"text_entry_global_form"});return}if(!N||!P)throw new Error(a("Select an embedding model.","gpt3-ai-content-generator"));let J=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:F,embedding_provider:N,embedding_model:P}),ie=J.embeddings&&J.embeddings.length?J.embeddings[0]:null;if(!ie)throw new Error(a("Failed to generate embedding.","gpt3-ai-content-generator"));if(j==="pinecone"){let oe=Bt("aipkit_vector_store_pinecone_nonce_management");if(!oe)throw new Error(a("Pinecone nonce missing.","gpt3-ai-content-generator"));let U=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:oe,vectors:JSON.stringify([{id:U,values:ie,metadata:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:F,vector_id:U}}]),embedding_provider:N,embedding_model:P,original_text_content:F,index_name:te});return}if(j==="qdrant"){let oe=Bt("aipkit_vector_store_qdrant_nonce_management");if(!oe)throw new Error(a("Qdrant nonce missing.","gpt3-ai-content-generator"));let U=nn(),O={_ajax_nonce:oe,vectors:JSON.stringify([{id:U,vector:ie,payload:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:F,vector_id:U}}]),embedding_provider:N,embedding_model:P,original_text_content:F,collection_name:te,source_context:"sources_module_edit"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",O);return}throw new Error(a("Unsupported provider for edit.","gpt3-ai-content-generator"))},St=window.aipkit_escapeHtml||(Q=>Q==null?"":String(Q)),To=(Q,te)=>{let F=document.createElement("div");F.className="aipkit_indexing_settings_section";let N=document.createElement("h5");N.textContent=a("Basic Labels","gpt3-ai-content-generator"),F.appendChild(N);let P=document.createElement("table");P.className="wp-list-table widefat striped",P.innerHTML=`
        <thead>
          <tr>
            <th>${St(a("Label Type","gpt3-ai-content-generator"))}</th>
            <th>${St(a("Custom Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let j=P.querySelector("tbody"),J=["source_url","title","excerpt","content"],ie=[a("Source URL","gpt3-ai-content-generator"),a("Title","gpt3-ai-content-generator"),a("Excerpt","gpt3-ai-content-generator"),a("Content","gpt3-ai-content-generator")];return J.forEach((oe,U)=>{let O=te&&te[oe]?te[oe]:ie[U],Y=ui.originalSettings?.[Q]?.basic_labels?.[oe]||O,ce=document.createElement("tr");ce.innerHTML=`
          <td><code>${St(ie[U])}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${St(Q)}][basic_labels][${St(oe)}]"
              value="${St(Y)}"
              placeholder="${St(O)}"
              ${ft.isPro?"":"disabled"}
            >
          </td>
        `,j.appendChild(ce)}),F.appendChild(P),F},Ji=(Q,te,F,N)=>{let P=document.createElement("div");if(P.className="aipkit_indexing_settings_section",!N||Object.keys(N).length===0)return P.innerHTML=`<p><em>${St(r(a("No %s found for this content type.","gpt3-ai-content-generator"),Q.toLowerCase()))}</em></p>`,P;let j=document.createElement("h5");j.textContent=Q,P.appendChild(j);let J=document.createElement("table");J.className="wp-list-table widefat striped",J.innerHTML=`
        <thead>
          <tr>
            <th class="check-column">
              <input type="checkbox" class="aipkit-indexing-select-all" ${ft.isPro?"":"disabled"} />
            </th>
            <th>${St(a("Field / Taxonomy","gpt3-ai-content-generator"))}</th>
            <th>${St(a("Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let ie=J.querySelector("tbody");Object.keys(N).forEach(U=>{let O=N[U],Y=ui.originalSettings?.[te]?.[F]?.[U]||{},ce=typeof Y.enabled=="boolean"?Y.enabled:!0,ue=Y.label||"",ye=document.createElement("tr");ye.innerHTML=`
          <th scope="row" class="check-column">
            <input
              type="checkbox"
              name="settings[${St(te)}][${St(F)}][${St(U)}][enabled]"
              value="1"
              ${ce?"checked":""}
              ${ft.isPro?"":"disabled"}
            >
          </th>
          <td><code>${St(U)}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${St(te)}][${St(F)}][${St(U)}][label]"
              value="${St(ue)}"
              placeholder="${St(O)}"
              ${ft.isPro?"":"disabled"}
            >
          </td>
        `,ie.appendChild(ye)});let oe=J.querySelector(".aipkit-indexing-select-all");return oe&&oe.addEventListener("change",U=>{ie.querySelectorAll('input[type="checkbox"]').forEach(O=>{O.checked=U.target.checked})}),P.appendChild(J),P},Po=(Q,te,F)=>{let N=document.createElement("div");N.className="aipkit_accordion";let P=document.createElement("div");P.className="aipkit_accordion-header",P.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${St(te)}`;let j=document.createElement("div");return j.className="aipkit_accordion-content",j.appendChild(To(Q,F.basic_labels||{})),j.appendChild(Ji(a("Custom Fields","gpt3-ai-content-generator"),Q,"fields",F.fields||{})),j.appendChild(Ji(a("Taxonomies","gpt3-ai-content-generator"),Q,"taxonomies",F.taxonomies||{})),Q==="product"&&F.woo_attributes&&j.appendChild(Ji(a("Product Data","gpt3-ai-content-generator"),Q,"woo_attributes",F.woo_attributes)),N.appendChild(P),N.appendChild(j),N},mn=async()=>{let Q=document.getElementById("aipkit_indexing_settings_form_container");if(Q){if(Q.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${St(a("Loading content types...","gpt3-ai-content-generator"))}</p>`,!ft.nonce){Q.innerHTML=`<p class="aipkit_text-danger">${St(a("Error: Security token is missing. Cannot load settings.","gpt3-ai-content-generator"))}</p>`;return}try{let te=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:ft.nonce}),F={},N={};if(te&&typeof te.success<"u"){if(!te.success)throw new Error(te.data||"Failed to load content types.");F=te.data?.cpt_data||{},N=te.data?.saved_settings||{}}else te&&(F=te.cpt_data||{},N=te.saved_settings||{});if(ui.originalSettings=N||{},Q.innerHTML="",!Object.keys(F).length){Q.innerHTML=`<p class="aipkit_text-center">${St(a("No content types found. Please add content and try again.","gpt3-ai-content-generator"))}</p>`;return}let P=document.createElement("div");P.className="aipkit_accordion-group",Object.keys(F).forEach(J=>{let ie=F[J];P.appendChild(Po(J,ie.label||J,ie))}),Q.appendChild(P);let j=document.getElementById("aipkit_indexing_settings_form");j&&!ui.accordionsBound&&(j.addEventListener("click",J=>{let ie=J.target.closest(".aipkit_accordion-header");ie&&(ie.classList.toggle("aipkit_active"),ie.nextElementSibling&&ie.nextElementSibling.classList.toggle("aipkit_active"))}),ui.accordionsBound=!0)}catch(te){Q.innerHTML=`<p class="aipkit_text-danger">${St(te&&te.message?te.message:a("Failed to load content types.","gpt3-ai-content-generator"))}</p>`}}},Mo=()=>{let Q=document.getElementById("aipkit_indexing_settings_form_container");if(!Q)return{};let te={},F=document.getElementById("aipkit_hide_user_uploads_checkbox");te.hide_user_uploads=F?F.checked:!0;let N=document.getElementById("aipkit_show_index_button_checkbox");te.show_index_button=N?N.checked:!0;let P=document.getElementById("aipkit_chunk_avg_chars_per_token"),j=document.getElementById("aipkit_chunk_max_tokens_per_chunk"),J=document.getElementById("aipkit_chunk_overlap_tokens");if(P&&j&&J){let ie=parseInt(P.value,10),oe=parseInt(j.value,10),U=parseInt(J.value,10);Number.isNaN(ie)||(te.chunk_avg_chars_per_token=ie),Number.isNaN(oe)||(te.chunk_max_tokens_per_chunk=oe),Number.isNaN(U)||(te.chunk_overlap_tokens=U)}return Q.querySelectorAll('input[type="checkbox"]').forEach(ie=>{let oe=ie.name.match(/[^[\]']+/g);if(oe&&oe.length===5&&oe[4]==="enabled"){let[,U,O,Y]=oe;te[U]||(te[U]={}),te[U][O]||(te[U][O]={}),te[U][O][Y]||(te[U][O][Y]={}),te[U][O][Y].enabled=ie.checked}}),Q.querySelectorAll('input[type="text"]').forEach(ie=>{let oe=ie.name.match(/[^[\]']+/g);if(oe&&oe.length===5&&oe[4]==="label"){let[,U,O,Y]=oe;te[U]||(te[U]={}),te[U][O]||(te[U][O]={}),te[U][O][Y]||(te[U][O][Y]={}),te[U][O][Y].label=ie.value.trim()}else if(oe&&oe.length===4&&oe[2]==="basic_labels"){let[,U,,O]=oe;te[U]||(te[U]={}),te[U].basic_labels||(te[U].basic_labels={}),te[U].basic_labels[O]=ie.value.trim()}}),te},gn=(Q,te)=>{if(!Q)return;Q.dataset.label||(Q.dataset.label=Q.textContent.trim());let F=Q.dataset.label||a("Save","gpt3-ai-content-generator"),N=Q.querySelector(".aipkit_spinner"),P=Q.querySelector(".aipkit_btn-text"),j=te?a("Saving...","gpt3-ai-content-generator"):F;P?P.textContent=j:Q.textContent=j,N&&(N.style.display=te?"inline-block":"none"),Q.disabled=te},zn=(Q,te)=>{if(!$t)return;T($t,te,{success:"success",error:"error",info:"loading"}[Q]||""),(Q==="success"||Q==="error")&&ao()},Qn=async(Q={})=>{let{button:te=null,mode:F="manual"}=Q;if(!ft.nonce)return;te&&gn(te,!0),F==="auto"&&zn("info",a("Auto-saving...","gpt3-ai-content-generator"));let N=Mo();try{let P=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:ft.nonce,settings:JSON.stringify(N)});ui.originalSettings=N;let j=P.message||a("Settings saved!","gpt3-ai-content-generator");zn("success",F==="auto"?a("Saved","gpt3-ai-content-generator"):j)}catch(P){let j=P&&P.message?P.message:a("Failed to save settings.","gpt3-ai-content-generator");zn("error",j)}finally{te&&gn(te,!1)}},Ni=Q=>{let te=document.getElementById("aipkit_upgradeBtn");if(te){te.click();return}let F=Q&&Q.dataset?Q.dataset.upgradeUrl:"";F&&window.open(F,"_blank","noopener")},fo=Q=>{Q.preventDefault();let te=Q.currentTarget;if(te&&te.dataset&&te.dataset.upgradeOnly==="1"){Ni(te);return}Qn({button:Q.currentTarget,mode:"manual"})},Gi=async()=>{if(cn){ln=!0;return}cn=!0,await Qn({mode:"auto"}),cn=!1,ln&&(ln=!1,Gi())},Jn=()=>{ft.nonce&&(Mt&&window.clearTimeout(Mt),Mt=window.setTimeout(()=>{Gi()},600))},On=()=>{if(ui.autosaveBound)return;[{element:document.getElementById("aipkit_hide_user_uploads_checkbox"),events:["change"]},{element:document.getElementById("aipkit_show_index_button_checkbox"),events:["change"]},{element:document.getElementById("aipkit_chunk_avg_chars_per_token"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_max_tokens_per_chunk"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_overlap_tokens"),events:["input","change"]}].forEach(({element:te,events:F})=>{te&&(F.forEach(N=>{te.addEventListener(N,Jn)}),te.addEventListener("blur",Jn))}),ui.autosaveBound=!0},Yn=()=>{if(ui.initialized)return!0;let Q=document.getElementById("indexing-settings-tab-content");return Q?Q.dataset.initialized==="true"?(ui.initialized=!0,!0):(mn(),ui.saveBound||(Zt&&Zt.addEventListener("click",fo),ui.saveBound=!0),On(),Q.dataset.initialized="true",ui.initialized=!0,!0):!1},xn=()=>{De&&(De.classList.remove("aipkit-active"),De.setAttribute("aria-hidden","true"),ve&&ve.setAttribute("aria-expanded","false"))},mo=()=>{we&&(we.classList.add("aipkit-active"),we.setAttribute("aria-hidden","false"),at&&at.focus())},ji=()=>{we&&(we.classList.remove("aipkit-active"),we.setAttribute("aria-hidden","true"))},Bo=()=>$t||L,kn=(Q,te)=>{let F=Bo();T(F,Q,te)},Cn=()=>{pi&&window.clearTimeout(pi),pi=window.setTimeout(()=>{kn("","")},3e3)},Rn=Q=>{if(!Oe)return;let te=w(Q);Oe.textContent=te.singular},on=(Q,te={})=>{if(!be)return;let F=m(Q),P=te.preserveValue===!0?be.value:"";be.innerHTML=`<option value="">${St(a("-- Select --","gpt3-ai-content-generator"))}</option>`;let j=[];if(F==="pinecone"?j=Ci.pineconeIndexes:F==="qdrant"&&(j=Ci.qdrantCollections),Array.isArray(j)&&j.forEach(J=>{let ie=J?.name||J?.id||(typeof J=="string"?J:"");if(!ie)return;let oe=document.createElement("option");oe.value=ie,oe.textContent=ie,be.appendChild(oe)}),P&&be.querySelector(`option[value="${en(P)}"]`))be.value=P;else if(P){let J=document.createElement("option");J.value=P,J.textContent=`${P} (${a("Manual","gpt3-ai-content-generator")})`,be.appendChild(J),be.value=P}},wn=()=>{if(!_t||!Re)return;let Q=Re.options[Re.selectedIndex];Q&&Q.dataset.provider&&(_t.value=Q.dataset.provider)},Dn=()=>({semantic_search_vector_provider:Pe?Pe.value:"",semantic_search_target_id:be?be.value:"",semantic_search_embedding_provider:_t?_t.value:"",semantic_search_embedding_model:Re?Re.value:"",semantic_search_num_results:Wt?Wt.value:"",semantic_search_no_results_text:ri?ri.value:""}),An=async(Q={})=>{let te=Q.mode||"auto";wn();let F=Dn();if(F.semantic_search_vector_provider){te==="auto"&&kn(a("Saving...","gpt3-ai-content-generator"),"loading");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",F),rt.dirty=!1,kn(a(te==="auto"?"Saved":"Settings saved!","gpt3-ai-content-generator"),"success"),Cn()}catch(N){let P=N&&N.message?N.message:a("Failed to save settings.","gpt3-ai-content-generator");kn(`${a("Error:","gpt3-ai-content-generator")} ${P}`,"error"),Cn()}}},Xn=async()=>{if(hi){Rt=!0;return}hi=!0,await An({mode:"auto"}),hi=!1,Rt&&(Rt=!1,Xn())},Yi=()=>{dn&&window.clearTimeout(dn),rt.dirty=!0,dn=window.setTimeout(()=>{Xn()},600)},go=()=>{if(rt.autosaveBound)return;let Q=(te,F=["change"])=>{te&&F.forEach(N=>te.addEventListener(N,Yi))};Q(Pe),Q(be),Q(Re),Q(Wt,["input","change"]),Q(ri,["input","change"]),rt.autosaveBound=!0},ko=()=>rt.initialized||!Pe||!be||!Re?!1:(Rn(Pe.value),on(Pe.value,{preserveValue:!0}),wn(),go(),rt.initialized=!0,!0),wo=()=>{_e&&(ko(),_e.classList.add("aipkit-active"),_e.setAttribute("aria-hidden","false"),Ce&&Ce.focus())},hn=()=>{_e&&(_e.classList.remove("aipkit-active"),_e.setAttribute("aria-hidden","true"))},Zn=Q=>{if(!gt)return;let te=gt.querySelector(".aipkit_spinner");te&&(te.style.display=Q?"inline-block":"none"),gt.disabled=Q,gt.setAttribute("aria-disabled",Q?"true":"false")},In=(Q,te="")=>{qe&&(qe.className="aipkit_sources_semantic_results aipkit_form-help",te&&qe.classList.add(`aipkit_form-help-${te}`),qe.textContent=Q)},qn=async Q=>{if(!qe)return;let te=Dn();if(!te.semantic_search_vector_provider||!te.semantic_search_target_id||!te.semantic_search_embedding_model){In(a("Complete semantic search settings before running a demo.","gpt3-ai-content-generator"));return}if(!Ci.nonce){In(a("Security token missing. Please reload.","gpt3-ai-content-generator"),"error");return}(rt.dirty||hi)&&await An({mode:"auto"}),Zn(!0),qe.innerHTML='<div class="aipkit-search-loading"><span class="aipkit_spinner"></span></div>';try{let F=await window.aipkit_apiRequest("aipkit_perform_semantic_search",{nonce:Ci.nonce,query:Q});qe.className="aipkit_sources_semantic_results",qe.innerHTML=F.html||`<p>${St(te.semantic_search_no_results_text||a("No results found.","gpt3-ai-content-generator"))}</p>`}catch(F){let N=F&&F.message?F.message:a("An error occurred while searching.","gpt3-ai-content-generator");In(`${a("Error:","gpt3-ai-content-generator")} ${N}`,"error")}finally{Zn(!1)}},fi=async(Q=1)=>{Ee.page=Q,T(L,"",""),$.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${St(a("Loading sources...","gpt3-ai-content-generator"))}</td></tr>`,G&&(G.innerHTML="");try{let te=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:Ee.page,per_page:Ee.perPage,provider:Ee.provider,status:Ee.status,type:Ee.type,search:Ee.search,store_id:Vi()});V($,te.logs||[]),W(te.pagination||{},G,fi)}catch(te){let F=te&&te.message?te.message:a("Error loading sources.","gpt3-ai-content-generator");M($,G,F),T(L,F,"error")}},Di=(()=>{let Q=document.getElementById("aipkit_sources_training_toggle"),te=document.getElementById("aipkit_sources_training_card");if(!Q||!te)return null;let F=te.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),N=te.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),P=te.querySelector(".aipkit_training_text_input"),j=te.querySelector("#aipkit_training_qa_question"),J=te.querySelector("#aipkit_training_qa_answer"),ie=te.querySelector("#aipkit_training_files_input"),oe=te.querySelector(".aipkit_training_files_button"),U=te.querySelector(".aipkit_builder_dropzone"),O=te.querySelector("#aipkit_training_file_list"),Y=te.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),ce=te.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),ue=te.querySelector(".aipkit_training_stop_btn"),ye=te.querySelector(".aipkit_training_action_row"),ze=te.querySelector("#aipkit_training_status")||L,st=document.getElementById("aipkit_sources_embedding_row"),nt=document.getElementById("aipkit_sources_embedding_model"),ot=te.querySelector("#aipkit_vs_wp_content_mode"),ut=te.querySelector("#aipkit_vs_wp_content_status"),Kt=te.querySelector("#aipkit_vs_wp_content_status_specific"),jt=te.querySelector("#aipkit_vs_wp_content_list_area"),ci=te.querySelector("#aipkit_vs_wp_content_pagination"),kt=te.querySelector("#aipkit_vs_wp_content_messages_area"),Xt=te.querySelector("#aipkit_vs_global_target_select"),It=te.querySelectorAll('input[name="aipkit_wp_content_mode"]'),ki=te.querySelector("#aipkit_wp_content_bulk_panel"),mi=te.querySelector("#aipkit_wp_content_specific_panel"),Bi=te.querySelector("#aipkit_wp_content_bulk_hint"),xe=te.querySelector("#aipkit_wp_content_specific_types_panel"),Me=te.querySelector("#aipkit_wp_content_status_wrap_bulk"),Je=te.querySelector("#aipkit_wp_content_status_wrap_specific"),He=new Map,Ke={page:1,selectedIds:new Set},Ye=null,Ve=null,dt=!1,zt=(D,z)=>{ze&&(ze.textContent=D||"",ze.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),D&&ze.classList.add("is-visible"),z&&ze.classList.add(`is-${z}`))},oi=(D=2500)=>{Ye&&window.clearTimeout(Ye),Ye=window.setTimeout(()=>{zt("","")},D)},Ii=(D,z="")=>{if(!kt)return;T(kt,D||"",z==="error"?"error":z==="success"?"success":"")},an=(D=2500)=>{Ve&&window.clearTimeout(Ve),Ve=window.setTimeout(()=>{Ii("","")},D)},zi=()=>{let D=m(K?K.value:""),z=H&&!H.disabled&&H.value||"";return!D||!z?null:{providerKey:D,storeId:z}},vn=()=>{let D=m(K?K.value:"");if(!D||D==="all")return zt(a("Select a provider first.","gpt3-ai-content-generator"),"error"),oi(),!1;let z=zi();if(!z||!z.storeId){let X=w(D);return zt(r(a("Select a %s first.","gpt3-ai-content-generator"),X.singular),"error"),oi(),!1}return!0},bn=D=>{if(!Number.isFinite(D))return"";let z=["B","KB","MB","GB"],X=D,re=0;for(;X>=1024&&re<z.length-1;)X/=1024,re+=1;let de=re===0?0:1;return`${X.toFixed(de)} ${z[re]}`},Ln=()=>{U&&(U.style.display=He.size>0&&dt?"none":"")},yo=(D=1500)=>{O&&window.setTimeout(()=>{He.clear(),O.innerHTML="",Ln()},D)},vo=D=>{if(!O||!D)return null;let z=`${D.name}_${D.size}_${D.lastModified}`;if(He.has(z))return He.get(z);let X=document.createElement("div");X.className="aipkit_training_file_row",X.dataset.fileKey=z;let re=document.createElement("div");re.className="aipkit_training_file_meta";let de=document.createElement("span");de.className="aipkit_training_file_name",de.textContent=D.name;let le=document.createElement("span");le.className="aipkit_training_file_size",le.textContent=bn(D.size);let me=document.createElement("span");return me.className="aipkit_training_file_status",me.textContent=a("Queued","gpt3-ai-content-generator"),re.appendChild(de),re.appendChild(le),X.appendChild(re),X.appendChild(me),O.appendChild(X),He.set(z,X),X},qi=(D,z,X)=>{let re=vo(D);if(!re)return;let de=re.querySelector(".aipkit_training_file_status");de&&(de.textContent=z||"",de.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),X&&de.classList.add(`is-${X}`))},Ei=async(D,z,X)=>{if(!D||!D.name||typeof window.aipkit_apiRequest!="function")return!1;let re=m(z);if(!re)return!1;let de=String(D.name||"").trim();if(!de)return!1;let le=Ue=>String(Ue||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),me=le(de),he=de.replace(/\.[^/.]+$/,""),Te=[de,me,he&&he!==de?he:""].filter(Boolean),Ie=async(Ue,Ut)=>{let mt=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:1,per_page:Ut,provider:re,store_id:X||"",type:"file",search:Ue||""});return Array.isArray(mt.logs)?mt.logs:[]},Le=(Ue,Ut)=>{if(!Ue.length)return null;let mt=Ut.map(le).filter(Boolean);return Ue.find(Et=>{let yt=le(Et.message),Ae=le(Et.post_title),tt=le(Et.file_id);return mt.some(ct=>yt&&yt.includes(ct)||Ae&&Ae.includes(ct)||tt&&tt.includes(ct))})||null};try{for(let mt of Te){let Et=await Ie(mt,10),yt=Le(Et,[mt,me]);if(yt){let Ae=String(yt.status||"").toLowerCase();if(Ae==="indexed"||Ae==="skipped_already_indexed"||Ae==="success")return qi(D,a("Trained","gpt3-ai-content-generator"),"success"),!0;if(Ae==="failed")return qi(D,a("Failed","gpt3-ai-content-generator"),"error"),!0;if(Ae==="processing"||Ae==="queued")return qi(D,a("Processing","gpt3-ai-content-generator"),"loading"),!0}}let Ue=await Ie("",20),Ut=Le(Ue,Te);if(Ut){let mt=String(Ut.status||"").toLowerCase();if(mt==="indexed"||mt==="skipped_already_indexed"||mt==="success")return qi(D,a("Trained","gpt3-ai-content-generator"),"success"),!0;if(mt==="failed")return qi(D,a("Failed","gpt3-ai-content-generator"),"error"),!0;if(mt==="processing"||mt==="queued")return qi(D,a("Processing","gpt3-ai-content-generator"),"loading"),!0}}catch{}return!1},Tn=(D,z,X,re=0)=>{if(!D||!z||!X)return;if(re>=30){Ei(X,"openai",D).then(me=>{me||qi(X,a("Queued","gpt3-ai-content-generator"),"warning")});return}let le=Bt("aipkit_vector_store_nonce_openai");if(!le||typeof window.aipkit_apiRequest!="function"){Ei(X,"openai",D);return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:D,batch_id:z,_ajax_nonce:le}).then(me=>{let he=(me.status||"").toLowerCase();if(he==="completed"){qi(X,a("Trained","gpt3-ai-content-generator"),"success"),fi(1);return}if(he==="failed"||he==="cancelled"){qi(X,a("Failed","gpt3-ai-content-generator"),"error");return}qi(X,a("Processing","gpt3-ai-content-generator"),"loading"),setTimeout(()=>{Tn(D,z,X,re+1)},2500)}).catch(()=>{setTimeout(()=>{Tn(D,z,X,re+1)},3e3)})},eo=D=>D?Array.isArray(D)?D.flatMap(z=>{if(Array.isArray(z))return z;if(z&&typeof z=="object"){if(Array.isArray(z.models))return z.models;if(Array.isArray(z.items))return z.items;if(z.id)return[z]}return[]}):typeof D=="object"?Object.values(D).flatMap(z=>Array.isArray(z)?z:[]):[]:[],rn=D=>{let z=window.aipkit_dashboard?.embeddingModels||{};return eo(z[D]||[])},Wi=(D,z)=>{if(!z)return null;let re=rn(D).find(me=>me&&me.id===z),de=re?.dimensions||re?.dimension||re?.output_dimensionality||re?.outputDimensionality||re?.output_dimension,le=de?Number(de):NaN;if(Number.isFinite(le)&&le>0)return le;if(re&&typeof re.name=="string"){let me=re.name.match(/\((\d{3,5})\)/);if(me)return Number(me[1])}return D==="google"?768:1536},to=D=>{if(!nt)return;let z=m(D),X=z&&Ee.embeddingByProvider?Ee.embeddingByProvider[z]:"";if(!X)return;let re=en(X);nt.querySelector(`option[value="${re}"]`)&&(nt.value=X)},vi=()=>{if(!nt)return;let D=nt.value||"",z=["openai","google","azure"],X={openai:a("OpenAI","gpt3-ai-content-generator"),google:a("Google","gpt3-ai-content-generator"),azure:a("Azure","gpt3-ai-content-generator")};nt.innerHTML="";let re=document.createElement("option");re.value="",re.textContent=a("Select embedding model","gpt3-ai-content-generator"),nt.appendChild(re);let de=!1;if(z.forEach(me=>{let he=rn(me);if(!he.length)return;let Te=document.createElement("optgroup");Te.label=X[me]||me,he.forEach(Ie=>{let Le=Ie.id||"";if(!Le)return;let Ue=document.createElement("option");Ue.value=`${me}::${Le}`,Ue.textContent=Ie.name||Le,Ue.dataset.provider=me,Ue.dataset.model=Le,Te.appendChild(Ue)}),Te.children.length&&(nt.appendChild(Te),de=!0)}),!de){nt.innerHTML="";let me=document.createElement("option");me.value="",me.textContent=a("No embedding models found.","gpt3-ai-content-generator"),nt.appendChild(me),nt.disabled=!0;return}if(nt.disabled=!1,D){let me=en(D);if(nt.querySelector(`option[value="${me}"]`)){nt.value=D;return}}let le=nt.querySelector("optgroup option");le&&(nt.value=le.value)},$o=()=>{if(!nt)return null;let D=nt.options[nt.selectedIndex],z=D&&D.dataset.provider||"",X=D&&D.dataset.model||"";if(!z||!X){let re=nt.value||"";if(re&&re.includes("::")){let[de,le]=re.split("::");z=de||"",X=le||""}}return!z||!X?null:{provider:z,model:X,dimension:Wi(z,X)}},Hn=D=>{!ue||!ce||(D?(ue.hidden=!1,ue.disabled=!1,ce.disabled=!0):(ue.hidden=!0,ue.disabled=!1,ce.disabled=!1))},Pn=()=>{let D=zi(),z=m(K?K.value:D?.providerKey||"");if(Y.forEach(X=>{X.disabled=!1,X.removeAttribute("aria-disabled")}),st){let X=z==="pinecone"||z==="qdrant";st.hidden=!X,X&&to(z)}if(Xt){let X=D?D.storeId:"";Xt.innerHTML=X?`<option value="${St(X)}">${St(X)}</option>`:'<option value=""></option>',Xt.value=X}},io=D=>{if(!F||!D)return;F.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(X=>{let re=X.dataset.aipkitTab===D;X.classList.toggle("is-active",re),X.setAttribute("aria-selected",re?"true":"false")}),N.forEach(X=>{let re=X.dataset.aipkitPanel===D;X.classList.toggle("is-active",re),X.hidden=!re}),ce&&(ce.style.display=D==="files"?"none":""),ye&&ye.classList.toggle("aipkit_builder_action_row--end",D==="files")},Fo=()=>{let D=F?F.querySelector(".aipkit_builder_tab.is-active"):null;return D?D.dataset.aipkitTab:""},Sn=()=>ot&&ot.value||"bulk",bo=D=>{let z=D==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",X=document.getElementById(z);return X?Array.from(X.selectedOptions).map(re=>re.value).filter(Boolean):[]},Vn=D=>{let z=D==="specific"?Kt:ut;return z&&z.value||"publish"},So=()=>jt?Array.from(jt.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(D=>D.value):[],No=(D,z,X)=>{if(!z)return;z.innerHTML="";let re=Number(D?.total_posts||0),de=Number(D?.total_pages||0),le=Number(D?.current_page||1);if(!re)return;let me=document.createElement("span");if(me.className="aipkit_pagination-count",me.textContent=`${re.toLocaleString()} ${n("item","items",re,"gpt3-ai-content-generator")}`,z.appendChild(me),de<=1)return;let he=document.createElement("span");he.className="aipkit_pagination-links";let Te=document.createElement("button");Te.type="button",Te.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Te.textContent=a("Prev","gpt3-ai-content-generator"),Te.disabled=le<=1,Te.addEventListener("click",()=>X(le-1));let Ie=document.createElement("span");Ie.className="aipkit_pagination-current",Ie.textContent=`${le}/${de}`;let Le=document.createElement("button");Le.type="button",Le.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Le.textContent=a("Next","gpt3-ai-content-generator"),Le.disabled=le>=de,Le.addEventListener("click",()=>X(le+1)),he.appendChild(Te),he.appendChild(Ie),he.appendChild(Le),z.appendChild(he)},Ro=(D,z)=>{if(!jt)return;if(jt.innerHTML="",!Array.isArray(D)||!D.length){jt.innerHTML=`<p class="aipkit_builder_help_text">${St(a("No posts found for selection.","gpt3-ai-content-generator"))}</p>`,ci&&(ci.innerHTML="");return}let X=document.createElement("ul"),re=document.createElement("div");re.className="aipkit_wp_content_select_all_wrapper";let de=document.createElement("label");de.className="aipkit_training_site_option";let le=document.createElement("input");le.type="checkbox",le.checked=D.every(me=>Ke.selectedIds.has(String(me.id))),de.appendChild(le),de.appendChild(document.createTextNode(a("Select all","gpt3-ai-content-generator"))),re.appendChild(de),jt.appendChild(re),jt.appendChild(X),D.forEach(me=>{let he=document.createElement("li");he.className="aipkit_wp_content_list_item";let Te=document.createElement("input");Te.type="checkbox",Te.name="wp_content_to_index[]",Te.value=String(me.id),Te.checked=Ke.selectedIds.has(String(me.id)),Te.addEventListener("change",()=>{Te.checked?Ke.selectedIds.add(String(me.id)):Ke.selectedIds.delete(String(me.id)),le.checked=D.every(Ut=>Ke.selectedIds.has(String(Ut.id)))});let Ie=document.createElement("a");Ie.className="aipkit_wp_content_title",Ie.href=me.edit_link||"#",Ie.target="_blank",Ie.rel="noopener noreferrer",Ie.textContent=me.title||a("Untitled","gpt3-ai-content-generator");let Le=document.createElement("span");Le.className="aipkit_wp_content_type",Le.textContent=me.type_label||"";let Ue=document.createElement("span");Ue.className="aipkit_wp_content_indexed_status",Ue.textContent=me.is_already_indexed?a("Indexed","gpt3-ai-content-generator"):"",he.appendChild(Te),he.appendChild(Ie),he.appendChild(Le),he.appendChild(Ue),X.appendChild(he)}),le.addEventListener("change",()=>{le.checked?D.forEach(me=>Ke.selectedIds.add(String(me.id))):D.forEach(me=>Ke.selectedIds.delete(String(me.id))),jt.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(me=>{me.checked=le.checked})}),No(z,ci,sn)},sn=async D=>{if(!jt)return;let z=zi(),X=Sn(),re=bo(X);if(!re.length){jt.innerHTML="",ci&&(ci.innerHTML=""),Ii(a("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let de=Bt("aipkit_wp_content_fetch_nonce");if(!de){Ii(a("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let le=Vn(X);try{Ii(a("Loading content...","gpt3-ai-content-generator"),"");let me=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:de,post_types:re,post_status:le,target_store_id:z?z.storeId:"",paged:D});Ke.page=D,Ro(me.posts||[],me.pagination||{}),Ii("","")}catch(me){Ii(me&&me.message?me.message:a("Failed to load content.","gpt3-ai-content-generator"),"error")}},Eo=D=>{ot&&(ot.value=D),ki&&(ki.hidden=D!=="bulk"),xe&&(xe.hidden=D!=="specific"),mi&&(mi.hidden=D!=="specific"),Me&&(Me.hidden=D!=="bulk"),Je&&(Je.hidden=D!=="specific"),Bi&&(Bi.hidden=D!=="bulk"),D==="specific"&&sn(1)},xo=()=>{te.querySelectorAll(".aipkit_training_site_dropdown").forEach(z=>{let X=z.querySelector(".aipkit_training_site_dropdown_btn"),re=z.querySelector(".aipkit_training_site_dropdown_label"),de=z.querySelector(".aipkit_training_site_dropdown_panel"),me=z.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",he=document.getElementById(me);if(!X||!de||!he)return;let Te=()=>{let Le=de.querySelectorAll('input[type="checkbox"]:checked'),Ue=z.dataset.placeholder||a("Select types","gpt3-ai-content-generator"),Ut=z.dataset.selectedLabel||a("selected","gpt3-ai-content-generator");re&&(Le.length?re.textContent=`${Le.length} ${Ut}`:re.textContent=Ue)},Ie=()=>{let Le=Array.from(de.querySelectorAll('input[type="checkbox"]:checked')).map(Ue=>Ue.value);Array.from(he.options).forEach(Ue=>{Ue.selected=Le.includes(Ue.value)})};X.addEventListener("click",()=>{let Le=X.getAttribute("aria-expanded")==="true";X.setAttribute("aria-expanded",Le?"false":"true"),de.hidden=Le}),de.addEventListener("change",()=>{Ie(),Te(),Sn()==="specific"&&sn(1)}),document.addEventListener("click",Le=>{z.contains(Le.target)||(X.setAttribute("aria-expanded","false"),de.hidden=!0)}),Ie(),Te()})},no=async(D,z,X)=>{let re=Bt("aipkit_wp_content_fetch_nonce");if(!re)throw new Error("WP content fetch nonce missing.");let de=[],le=1,me=1;do{let he=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:re,post_types:D,post_status:z,target_store_id:X||"",paged:le});(Array.isArray(he?.posts)?he.posts:[]).forEach(Le=>{de.push({id:String(Le.id),title:Le.title||r(a("Post %s","gpt3-ai-content-generator"),Le.id)})});let Ie=parseInt(he?.pagination?.total_pages||1,10);me=Number.isNaN(Ie)?1:Ie,le+=1}while(le<=me);return de},Oo=()=>jt?Array.from(jt.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(D=>{let z=D.closest(".aipkit_wp_content_list_item"),X=z?z.querySelector(".aipkit_wp_content_title"):null;return{id:String(D.value||""),title:X&&X.textContent.trim()||r(a("Post %s","gpt3-ai-content-generator"),D.value)}}):[],oo=(D,z,X,re)=>{let de=r(a("Post %s","gpt3-ai-content-generator"),D),le=re&&re.get(String(D))||de;return r(a("Training: %s (%d/%d)","gpt3-ai-content-generator"),le,z+1,X)},Un=async(D,z)=>{if(!window.aipkit_dashboard?.ajaxurl)throw new Error(a("AJAX configuration is missing.","gpt3-ai-content-generator"));D.set("action",z);let X=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:D,credentials:"same-origin"}),re=await X.json();if(!X.ok||!re.success){let de=re?.data?.message||a("Upload failed.","gpt3-ai-content-generator");throw new Error(de)}return re.data},Gn=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`text_${Date.now()}`,Co=()=>{let D=$o();return D||(zt(a("Select an embedding model.","gpt3-ai-content-generator"),"warning"),oi(),null)},Ao=async(D,z)=>{if(!window.aipkit_dashboard?.nonce)throw new Error(a("Embedding nonce missing.","gpt3-ai-content-generator"));let X=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:D,embedding_provider:z.provider,embedding_model:z.model,_ajax_nonce:window.aipkit_dashboard.nonce}),re=X.embeddings&&X.embeddings.length?X.embeddings[0]:null;if(!re)throw new Error(a("Failed to generate embedding.","gpt3-ai-content-generator"));return re},Io=async({content:D,indexName:z,embedding:X,metadata:re})=>{let de=Bt("aipkit_vector_store_pinecone_nonce_management");if(!de)throw new Error(a("Pinecone nonce missing.","gpt3-ai-content-generator"));let le=await Ao(D,X);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:de,vectors:JSON.stringify([{id:re.vector_id,values:le,metadata:re}]),embedding_provider:X.provider,embedding_model:X.model,original_text_content:D,index_name:z})},qo=async({content:D,collectionName:z,embedding:X,metadata:re,sourceContext:de})=>{let le=Bt("aipkit_vector_store_qdrant_nonce_management");if(!le)throw new Error(a("Qdrant nonce missing.","gpt3-ai-content-generator"));let me=await Ao(D,X),he={_ajax_nonce:le,vectors:JSON.stringify([{id:re.vector_id,vector:me,payload:re}]),embedding_provider:X.provider,embedding_model:X.model,original_text_content:D,collection_name:z,source_context:de||"sources_module"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",he)},ee=async()=>{if(dt)return;let D=zi();if(!D){zt(a("Select a provider and index first.","gpt3-ai-content-generator"),"warning"),oi();return}let z=Fo(),X="",re=[],de=null,le="text_entry_global_form",me="file_upload_global_form";if(z==="text"){if(X=P?P.value.trim():"",!X){zt(a("Add text to train.","gpt3-ai-content-generator"),"warning"),oi();return}}else if(z==="qa"){let Te=j?j.value.trim():"",Ie=J?J.value.trim():"";if(!Te||!Ie){zt(a("Add a question and answer to train.","gpt3-ai-content-generator"),"warning"),oi();return}X=`Q: ${Te}
A: ${Ie}`}else if(z==="files"){if(re=ie?Array.from(ie.files||[]):[],!re.length){ie&&ie.click(),zt(a("Choose files to upload.","gpt3-ai-content-generator"),"warning"),oi();return}}else if(z==="website"){let Te=Sn(),Ie=Vn(Te),Le=bo(Te),Ue=So();if(Te==="specific"&&!Ue.length){zt(a("Select content to train.","gpt3-ai-content-generator"),"warning"),oi();return}if(Te==="bulk"&&!Le.length){zt(a("Select at least one post type.","gpt3-ai-content-generator"),"warning"),oi();return}de={mode:Te,statusValue:Ie,postTypes:Le,selectedPostIds:Ue}}else{zt(a("Select a training tab to continue.","gpt3-ai-content-generator"),"warning"),oi();return}let he=null;if(!((D.providerKey==="pinecone"||D.providerKey==="qdrant")&&(he=Co(),!he))){dt=!0,Hn(!0),Y.forEach(Te=>{Te.disabled=!0}),zt(a("Preparing training...","gpt3-ai-content-generator"),"loading");try{if(z==="files"){Ln();for(let Te=0;Te<re.length;Te+=1){let Ie=re[Te];zt(r(a("Uploading %1$d of %2$d...","gpt3-ai-content-generator"),Te+1,re.length),"loading"),qi(Ie,a("Uploading","gpt3-ai-content-generator"),"loading");try{let Le=new FormData;if(D.providerKey==="openai"){let Ue=Bt("aipkit_vector_store_nonce_openai");if(!Ue)throw new Error(a("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));Le.append("aipkit_vs_global_file_to_submit",Ie),Le.append("target_store_id",D.storeId),Le.append("source_type",me),Le.append("_ajax_nonce",Ue);let Ut=await Un(Le,"aipkit_upload_and_add_file_to_store_direct_openai");qi(Ie,a("Processing","gpt3-ai-content-generator"),"loading");let mt=Ut?.batch?.id;Ei(Ie,D.providerKey,D.storeId).then(Et=>{if(!Et){if(mt){Tn(D.storeId,mt,Ie);return}qi(Ie,a("Queued","gpt3-ai-content-generator"),"warning")}})}else if(D.providerKey==="pinecone"){let Ue=Bt("aipkit_vector_store_pinecone_nonce_management");if(!Ue)throw new Error(a("Pinecone nonce missing.","gpt3-ai-content-generator"));Le.append("file_to_upload",Ie),Le.append("index_name",D.storeId),Le.append("embedding_provider",he.provider),Le.append("embedding_model",he.model),Le.append("_ajax_nonce",Ue),await Un(Le,"aipkit_upload_file_and_upsert_to_pinecone"),qi(Ie,a("Trained","gpt3-ai-content-generator"),"success")}else if(D.providerKey==="qdrant"){let Ue=Bt("aipkit_vector_store_qdrant_nonce_management");if(!Ue)throw new Error(a("Qdrant nonce missing.","gpt3-ai-content-generator"));Le.append("file_to_upload",Ie),Le.append("target_store_id",D.storeId),Le.append("embedding_provider",he.provider),Le.append("embedding_model",he.model),Le.append("source_context","sources_module_file_upload"),Le.append("_ajax_nonce",Ue),await Un(Le,"aipkit_upload_file_and_upsert_to_qdrant"),qi(Ie,a("Trained","gpt3-ai-content-generator"),"success")}}catch(Le){throw qi(Ie,a("Failed","gpt3-ai-content-generator"),"error"),Le}}ie&&(ie.value=""),Ln(),zt(a("Saved","gpt3-ai-content-generator"),"success"),Ii(a("Saved","gpt3-ai-content-generator"),"success"),an(),oi(),yo(),fi(1);return}if(z==="website"&&de){let{mode:Te,statusValue:Ie,postTypes:Le}=de,Ue=[],Ut=new Map;if(Te==="bulk"){zt(a("Preparing website content...","gpt3-ai-content-generator"),"loading");let mt=await no(Le,Ie,D.storeId);if(Ue=mt.map(Et=>Et.id),Ut=new Map(mt.map(Et=>[String(Et.id),Et.title])),!Ue.length){Ii(a("No posts found for selection.","gpt3-ai-content-generator"),"error"),zt(a("Nothing to train.","gpt3-ai-content-generator"),"warning"),oi();return}}if(Te!=="bulk"){let mt=Oo();Ue=mt.map(Et=>Et.id),Ut=new Map(mt.map(Et=>[String(Et.id),Et.title]))}if(zt(a("Training...","gpt3-ai-content-generator"),"loading"),Ii(r(a("Training %d item(s)...","gpt3-ai-content-generator"),Ue.length),""),D.providerKey==="openai"){let mt=Bt("aipkit_wp_content_index_nonce");if(!mt)throw new Error(a("WP content index nonce missing.","gpt3-ai-content-generator"));for(let Et=0;Et<Ue.length;Et+=1){let yt=Ue[Et];Ii(oo(yt,Et,Ue.length,Ut),""),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{_ajax_nonce:mt,post_ids:[yt],target_store_id:D.storeId,provider:"openai"})}}else if(D.providerKey==="pinecone")for(let mt=0;mt<Ue.length;mt+=1){let Et=Ue[mt];Ii(oo(Et,mt,Ue.length,Ut),"");let yt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Bt("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[Et]}),Ae=yt.posts_content&&yt.posts_content[Et]?yt.posts_content[Et]:null;if(!Ae||!Ae.content)continue;let tt=nn(),ct={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Et,title:Ae.title||"",url:Ae.edit_link||"",vector_id:tt};ct.vector_id=tt,await Io({content:Ae.content,indexName:D.storeId,embedding:he,metadata:ct})}else if(D.providerKey==="qdrant")for(let mt=0;mt<Ue.length;mt+=1){let Et=Ue[mt];Ii(oo(Et,mt,Ue.length,Ut),"");let yt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Bt("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[Et]}),Ae=yt.posts_content&&yt.posts_content[Et]?yt.posts_content[Et]:null;if(!Ae||!Ae.content)continue;let tt=Gn(),ct={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Et,title:Ae.title||"",url:Ae.edit_link||"",vector_id:tt};await qo({content:Ae.content,collectionName:D.storeId,embedding:he,metadata:ct,sourceContext:"sources_module_website"})}zt(a("Saved","gpt3-ai-content-generator"),"success"),oi(),fi(1);return}if(D.providerKey==="openai"){let Te=Bt("aipkit_vector_store_nonce_openai");if(!Te)throw new Error(a("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:Te,target_store_id:D.storeId,text_content:X,source_type:le})}else if(D.providerKey==="pinecone"){let Te=nn(),Ie={source:le,created_at:new Date().toISOString(),original_content:X,vector_id:Te};await Io({content:X,indexName:D.storeId,embedding:he,metadata:Ie})}else if(D.providerKey==="qdrant"){let Te=nn(),Ie={source:le,created_at:new Date().toISOString(),original_content:X,vector_id:Te};await qo({content:X,collectionName:D.storeId,embedding:he,metadata:Ie,sourceContext:"sources_module_training"})}z==="text"&&P&&(P.value=""),z==="qa"&&(j&&(j.value=""),J&&(J.value="")),zt(a("Saved","gpt3-ai-content-generator"),"success"),oi(),fi(1)}catch(Te){zt(r(a("Error: %s","gpt3-ai-content-generator"),Te?.message||a("Training failed.","gpt3-ai-content-generator")),"error")}finally{dt=!1,Hn(!1),Pn(),Ln()}}};if(Q.addEventListener("click",()=>{let D=te.hidden;te.hidden=!D,Q.setAttribute("aria-expanded",D?"true":"false"),D&&(Pn(),vi(),to(K?K.value:""))}),F){let D=F.querySelector(".aipkit_builder_tab.is-active");D&&io(D.dataset.aipkitTab),F.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(z=>{z.addEventListener("click",()=>{io(z.dataset.aipkitTab)})})}return oe&&ie&&oe.addEventListener("click",()=>{vn()&&ie.click()}),ie&&ie.addEventListener("change",()=>{if(!vn()){ie.value="";return}let D=Array.from(ie.files||[]);D.length&&(D.forEach(z=>{vo(z),qi(z,a("Queued","gpt3-ai-content-generator"))}),Ln(),ee())}),Y.forEach(D=>{D.addEventListener("click",ee)}),ue&&ue.addEventListener("click",()=>{dt&&(ue.disabled=!0,zt(a("Stopping...","gpt3-ai-content-generator"),"warning"))}),nt&&nt.addEventListener("change",()=>{let D=m(K?K.value:"");D&&(Ee.embeddingByProvider[D]=nt.value||"",_({provider:Ee.provider,status:Ee.status,type:Ee.type,indexByProvider:Ee.indexByProvider,embeddingByProvider:Ee.embeddingByProvider}))}),It.length&&It.forEach(D=>{D.addEventListener("change",()=>{D.checked&&Eo(D.value)})}),ut&&ut.addEventListener("change",()=>{Sn()==="specific"&&sn(1)}),Kt&&Kt.addEventListener("change",()=>{Sn()==="specific"&&sn(1)}),xo(),Pn(),vi(),to(K?K.value:""),Eo(Sn()),{updateTargetState:Pn}})();K&&K.addEventListener("change",()=>{Ee.provider=K.value,Fn(Ee.provider),Di?.updateTargetState?.(),_({provider:Ee.provider,status:Ee.status,type:Ee.type,indexByProvider:Ee.indexByProvider,embeddingByProvider:Ee.embeddingByProvider}),fi(1)}),qt&&qt.addEventListener("click",()=>{m(K?K.value:"")&&(Ee.openIndexCreateOnOpen=!0,yi(qt))}),ne&&ne.addEventListener("change",()=>{Ee.status=ne.value,_({provider:Ee.provider,status:Ee.status,type:Ee.type,indexByProvider:Ee.indexByProvider,embeddingByProvider:Ee.embeddingByProvider}),fi(1)}),ae&&ae.addEventListener("change",()=>{Ee.type=ae.value,_({provider:Ee.provider,status:Ee.status,type:Ee.type,indexByProvider:Ee.indexByProvider,embeddingByProvider:Ee.embeddingByProvider}),fi(1)});let yn=()=>{if(!Z)return;let Q=Z.value.trim();Q!==Ee.search&&(Ee.search=Q,fi(1))},ho=()=>{Z&&(Ze&&window.clearTimeout(Ze),Ze=window.setTimeout(()=>{yn()},300))};if(Z&&(Z.addEventListener("input",ho),Z.addEventListener("search",yn),Z.addEventListener("keydown",Q=>{Q.key==="Enter"&&(Q.preventDefault(),Ze&&window.clearTimeout(Ze),yn())})),H&&H.addEventListener("change",()=>{let Q=m(K?K.value:"");Q&&(Ee.indexByProvider[Q]=H.value||"",_({provider:Ee.provider,status:Ee.status,type:Ee.type,indexByProvider:Ee.indexByProvider,embeddingByProvider:Ee.embeddingByProvider}),Qi(),Di?.updateTargetState?.(),fi(1))}),pe&&pe.dataset.configListenersAttached!=="true"){let Q=te=>{te.target.closest("[data-aipkit-provider-config]")&&_o()};pe.addEventListener("input",Q),pe.addEventListener("change",Q),pe.dataset.configListenersAttached="true"}Li&&Li.addEventListener("click",Ne),Ft&&Ft.addEventListener("click",Ne),We&&!We.dataset.bound&&(document.addEventListener("keydown",Q=>{Q.key==="Escape"&&We.classList.contains("aipkit-active")&&Ne()}),We.dataset.bound="1"),di&&di.addEventListener("click",co),Hi&&Hi.addEventListener("click",co),fe&&fe.addEventListener("click",Si),Fe&&Fe.addEventListener("click",Si),ge&&ge.addEventListener("click",async()=>{if(!ti)return;let Q=ti.dataset.provider||"",te=ti.dataset.storeId||"",F=ti.dataset.vectorId||"",N=ti.dataset.logId||"";if(!Q||!te||!F||!N){T(L,a("Missing source details.","gpt3-ai-content-generator"),"error"),Vt(),Si();return}Si();let P=null,j=[];if($){let J=en(N);if(P=$.querySelector(`tr[data-log-id="${J}"]`),P){j=Array.from(P.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")),j.forEach(oe=>{oe.disabled=!0,oe.setAttribute("aria-disabled","true")});let ie=P.querySelector(".aipkit_sources_action_delete");ie&&(ie.textContent=a("Deleting...","gpt3-ai-content-generator"))}}ge&&(ge.disabled=!0),T(L,a("Deleting...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:Q,store_id:te,vector_id:F,log_id:N}),T(L,a("Deleted","gpt3-ai-content-generator"),"success"),Vt(),fi(Ee.page||1)}catch(J){let ie=J&&J.message?J.message:a("Failed to delete source.","gpt3-ai-content-generator");T(L,`${a("Error:","gpt3-ai-content-generator")} ${ie}`,"error"),Vt(),j.forEach(U=>{U.disabled=!1,U.removeAttribute("aria-disabled")});let oe=P?P.querySelector(".aipkit_sources_action_delete"):null;oe&&(oe.textContent=a("Delete","gpt3-ai-content-generator"))}finally{ge&&(ge.disabled=!1)}}),bt&&bt.addEventListener("click",async()=>{if(!We||!xi)return;let Q=xi.value.trim();if(!Q){T(L,a("Text cannot be empty.","gpt3-ai-content-generator"),"error"),Vt();return}let te=We.dataset.provider||"",F=We.dataset.storeId||"",N=We.dataset.vectorId||"",P=We.dataset.logId||"",j=We.dataset.embeddingProvider||"",J=We.dataset.embeddingModel||"";if(!te||!F||!N||!P){T(L,a("Missing source details.","gpt3-ai-content-generator"),"error"),Vt();return}Ne();let ie=[];if($&&P){let oe=en(P),U=$.querySelector(`tr[data-log-id="${oe}"]`);ie=U?Array.from(U.querySelectorAll(".aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[],ie.forEach(O=>{O.disabled=!0,O.setAttribute("aria-disabled","true"),O.classList.contains("aipkit_sources_action_edit")&&(O.textContent=a("Training...","gpt3-ai-content-generator"))})}T(L,a("Training...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:te,store_id:F,vector_id:N,log_id:P}),await Nn(te,F,Q,j,J),T(L,a("Trained","gpt3-ai-content-generator"),"success"),Vt(),fi(Ee.page||1)}catch(oe){let U=oe&&oe.message?oe.message:a("Failed to save source.","gpt3-ai-content-generator");T(L,`${a("Error:","gpt3-ai-content-generator")} ${U}`,"error"),Vt(),ie.forEach(O=>{O.disabled=!1,O.removeAttribute("aria-disabled"),O.classList.contains("aipkit_sources_action_edit")&&(O.textContent=a("Edit","gpt3-ai-content-generator"))})}}),B.addEventListener("click",async Q=>{let te=Q.target.closest(".aipkit_sources_provider_create");if(te){let ie=te.dataset.provider||"";ie&&$n(ie,te);return}let F=Q.target.closest(".aipkit_sources_provider_delete_selected");if(F){let ie=m(K?K.value:F.dataset.provider||""),oe=H?H.value:"";if(!ie||!oe){let Y=w(ie);At(r(a("Select a %s to delete.","gpt3-ai-content-generator"),Y.singular.toLowerCase()),"error"),Ki();return}let U=H&&H.selectedOptions?H.selectedOptions[0]:null,O=U?U.textContent:oe;Bn(ie,oe,O,F);return}let N=Q.target.closest(".aipkit_sources_action_edit");if(N){lo(N);return}let P=Q.target.closest(".aipkit_sources_action_view");if(P){let ie=P.dataset.snippet||"";if(!ie){T(L,a("No preview available for this source.","gpt3-ai-content-generator"),"error"),Vt();return}Mi(ie);return}let j=Q.target.closest(".aipkit_sources_action_delete");if(j){let ie=j.dataset.provider||"",oe=j.dataset.storeId||"",U=j.dataset.vectorId||"",O=j.dataset.logId||"";if(!ie||!oe||!U||!O){T(L,a("Missing source details.","gpt3-ai-content-generator"),"error"),Vt();return}Ai({provider:ie,storeId:oe,vectorId:U,logId:O});return}let J=Q.target.closest(".aipkit_sources_action_retrain");if(J){let ie=J.dataset.provider||"",oe=J.dataset.storeId||"",U=J.dataset.vectorId||"",O=J.dataset.logId||"",Y=J.dataset.postId||"",ce=J.dataset.embeddingProvider||"",ue=J.dataset.embeddingModel||"";if(!ie||!oe||!U||!O||!Y){T(L,a("Missing source details.","gpt3-ai-content-generator"),"error"),Vt();return}let ye=J.closest("tr"),ze=ye?Array.from(ye.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[];ze.forEach(st=>{st.disabled=!0,st.setAttribute("aria-disabled","true")}),J.textContent=a("Training...","gpt3-ai-content-generator"),T(L,a("Retraining...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:ie,store_id:oe,vector_id:U,log_id:O,post_id:Y,embedding_provider:ce,embedding_model:ue}),T(L,a("Retrained","gpt3-ai-content-generator"),"success"),Vt(),fi(Ee.page||1)}catch(st){let nt=st&&st.message?st.message:a("Failed to retrain source.","gpt3-ai-content-generator");T(L,`${a("Error:","gpt3-ai-content-generator")} ${nt}`,"error"),Vt(),ze.forEach(ot=>{ot.disabled=!1,ot.removeAttribute("aria-disabled")}),J.textContent=a("Retrain","gpt3-ai-content-generator")}}}),ve&&ve.addEventListener("click",()=>{Yn()}),lt&&lt.addEventListener("click",Q=>{Q.preventDefault(),Yn(),xn(),mo()}),ke&&ke.addEventListener("click",Q=>{Q.preventDefault(),xn(),wo()}),at&&at.addEventListener("click",Q=>{Q.preventDefault(),ji()}),we&&we.addEventListener("click",Q=>{Q.target===we&&ji()}),Ce&&Ce.addEventListener("click",Q=>{Q.preventDefault(),hn()}),_e&&_e.addEventListener("click",Q=>{Q.target===_e&&hn()}),document.addEventListener("keydown",Q=>{Q.key==="Escape"&&we&&we.classList.contains("aipkit-active")&&ji(),Q.key==="Escape"&&_e&&_e.classList.contains("aipkit-active")&&hn()}),Pe&&Pe.addEventListener("change",()=>{let Q=Pe.value;Rn(Q),on(Q),be&&(be.value=""),Yi()}),be&&be.addEventListener("change",Yi),Re&&Re.addEventListener("change",()=>{wn(),Yi()}),Wt&&(Wt.addEventListener("input",Yi),Wt.addEventListener("change",Yi)),ri&&(ri.addEventListener("input",Yi),ri.addEventListener("change",Yi)),Ht&&Ht.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode("[aipkit_semantic_search]",Ht)}),ht&&ht.addEventListener("submit",Q=>{if(Q.preventDefault(),!Be)return;let te=Be.value.trim();te&&qn(te)}),$t&&li&&(li.innerHTML=""),Fn(K?K.value:""),typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(B),typeof window.aipkitSources_initSettingsPopoverPanels=="function"&&window.aipkitSources_initSettingsPopoverPanels(B),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_sources_module_container"),fi(1)}window.aipkit_initSources=R})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector("#aipkit_stats_settings_popover");if(!r)return;let n=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!n.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),i=r.querySelector(".aipkit_model_settings_popover_back"),s=a.querySelector("#aipkit_stats_settings_trigger"),c={root:r.dataset.titleRoot||"Log Settings","log-retention":r.dataset.titleLogRetention||"Log retention"},t=null,d=o=>{let l=o||"root",_=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!_)return;let p=_.dataset.aipkitSettingsPanel||"root";p!==t&&(n.forEach(f=>{f.hidden=f!==_}),e&&(e.textContent=c[p]||c.root),i&&(i.hidden=p==="root"),t=p,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",o=>{let l=o.target.closest("[data-aipkit-panel-target]");if(!l)return;o.preventDefault();let _=l.dataset.aipkitPanelTarget;d(_)}),i&&i.addEventListener("click",o=>{o.preventDefault(),d("root")}),s&&s.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitStats_initSettingsPopoverPanels=g})();(function(){"use strict";let r="aipkit_stats_overview_open",n=d=>typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml(d):(d==null?"":String(d)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),e=d=>{let o=Number(d||0);return Number.isNaN(o)?"0":o.toLocaleString()},i=d=>{let o=Number(d);if(!o)return"";let l=new Date(o*1e3);return Number.isNaN(l.getTime())?"":l.toLocaleString()},s=d=>{let o=Number(d);if(!o)return"";let l=Date.now()/1e3,_=Math.floor(l-o);if(Number.isNaN(_)||_<0)return i(o);if(_<60)return"Just now";let p=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],f=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let m of p)if(_>=m.seconds){let k=Math.floor(_/m.seconds);return f?f.format(-k,m.unit):`${k} ${m.unit}${k!==1?"s":""} ago`}return i(o)},c=d=>{if(typeof d=="string")return d;if(d==null)return"";try{return JSON.stringify(d,null,2)}catch{return String(d)}};function t(){let d=document.getElementById("aipkit_stats_container");if(!d)return;typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(d),typeof window.aipkitStats_initSettingsPopoverPanels=="function"&&window.aipkitStats_initSettingsPopoverPanels(d);let o={days:parseInt(d.dataset.defaultDays||30,10)||30,perPage:20,page:1,search:"",botId:"",module:"",selectedLogId:null},l=wp.i18n&&wp.i18n.__?wp.i18n.__:se=>se,_={page:1,search:"",botTitles:{}},p=null,f=null,m=null,k=!1,u={status:d.querySelector("#aipkit_stats_status"),overviewPanel:d.querySelector("#aipkit_stats_overview_panel"),overviewToggle:d.querySelector("#aipkit_stats_overview_toggle"),overviewPeriod:d.querySelector("#aipkit_stats_period_label"),totalConversations:d.querySelector("#aipkit_stats_total_conversations"),totalMessages:d.querySelector("#aipkit_stats_total_messages"),uniqueUsers:d.querySelector("#aipkit_stats_unique_users"),avgTokens:d.querySelector("#aipkit_stats_avg_tokens"),daysFilter:d.querySelector("#aipkit_stats_days_filter"),botFilter:d.querySelector("#aipkit_stats_bot_filter"),moduleFilter:d.querySelector("#aipkit_stats_module_filter"),searchInput:d.querySelector("#aipkit_stats_search_input"),exportBtn:d.querySelector("#aipkit_stats_export_btn"),deleteAllBtn:d.querySelector("#aipkit_stats_delete_all_btn"),tableMenu:d.querySelector("#aipkit_stats_table_menu"),tableMenuTrigger:d.querySelector("#aipkit_stats_table_menu_trigger"),tableBody:d.querySelector("#aipkit_stats_table_body"),pagination:d.querySelector("#aipkit_stats_pagination"),detailPanel:d.querySelector("#aipkit_stats_detail_panel"),conversationChart:d.querySelector("#aipkit_stats_conversation_chart"),moduleChart:d.querySelector("#aipkit_stats_module_chart"),settingsToggle:document.getElementById("aipkit_stats_auto_delete_toggle"),retentionSelect:document.getElementById("aipkit_stats_retention_days"),retentionRow:d.querySelector("[data-aipkit-stats-retention-row]"),cronRow:d.querySelector("[data-aipkit-stats-cron-row]"),cronStatus:document.getElementById("aipkit_stats_cron_status"),cronText:document.getElementById("aipkit_stats_cron_text"),cronLastRun:document.getElementById("aipkit_stats_cron_last_run"),settingsPopover:document.getElementById("aipkit_stats_settings_popover"),settingsTrigger:document.getElementById("aipkit_stats_settings_trigger"),settingsUsersNav:d.querySelector('[data-aipkit-settings-action="users"]'),userSheet:document.getElementById("aipkit_stats_user_sheet"),userSheetClose:document.getElementById("aipkit_stats_user_sheet_close"),userSearchInput:document.getElementById("aipkit_stats_user_search"),userTableBody:document.getElementById("aipkit_stats_user_table_body"),userTableFoot:document.querySelector("#aipkit_stats_user_sheet tfoot"),userPagination:document.getElementById("aipkit_stats_user_pagination"),userNoResults:document.getElementById("aipkit_stats_user_no_results"),shortcodeSnippet:document.getElementById("aipkit_stats_shortcode_snippet"),shortcodeToggle:document.getElementById("aipkit_stats_shortcode_toggle"),shortcodeConfig:document.getElementById("aipkit_stats_shortcode_config"),shortcodeOptions:d.querySelectorAll(".aipkit_stats_shortcode_option")},w=(()=>{try{let se=d.dataset.moduleLabels||"{}";return JSON.parse(se)}catch{return{}}})(),h=d.dataset.isPro==="1",v=d.dataset.userCreditsNonce||"",C=(se,ke="")=>{if(!u.status)return;let _e=u.status,Ce=_e.classList.contains("aipkit_training_status");if(_e.textContent=se||"",_e.classList.remove("aipkit_status_error","aipkit_status_success","aipkit_status_warning","aipkit_status_loading"),Ce){_e.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),se&&_e.classList.add("is-visible"),ke&&_e.classList.add(`is-${ke}`);return}_e.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),ke==="success"?_e.classList.add("aipkit_form-help-success"):ke==="error"&&_e.classList.add("aipkit_form-help-error")},x=()=>{try{return localStorage.getItem(r)==="1"}catch{return!1}},b=se=>{u.retentionRow&&(u.retentionRow.hidden=!se),u.cronRow&&(u.cronRow.hidden=!se),u.retentionSelect&&(u.retentionSelect.disabled=!se||!h)},I=se=>{!se||!u.cronStatus||(se.state&&u.cronStatus.setAttribute("data-state",se.state),u.cronText&&se.status_text&&(u.cronText.textContent=se.status_text),u.cronLastRun&&se.last_run_label&&(u.cronLastRun.textContent=se.last_run_label))},y=se=>{u.tableBody&&(u.tableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${n(se)}</td>
                </tr>
            `)},q=se=>{u.userTableBody&&(u.userTableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${n(se)}</td>
                </tr>
            `,u.userNoResults&&(u.userNoResults.hidden=!0))},E=se=>{if(!se)return l("N/A","gpt3-ai-content-generator");let ke=new Date(se*1e3);return Number.isNaN(ke.getTime())?l("N/A","gpt3-ai-content-generator"):ke.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},S=(se,ke)=>{let _e=Array.isArray(se)?se:[],Ce='<ul class="aipkit_stats_usage_list">';return _e.length?(_e.forEach((Pe,be)=>{let Oe=be>=2;Ce+=`<li class="${Oe?"aipkit_stats_usage_extra":""}"${Oe?" hidden":""}>${Pe}</li>`}),Ce+="</ul>",{html:Ce,hasToggle:_e.length>2}):(Ce+=`<li>${n(ke)}</li>`,Ce+="</ul>",{html:Ce,hasToggle:!1})},A=(se,ke)=>{if(!u.userTableBody)return;if(u.userTableBody.innerHTML="",!Array.isArray(se)||se.length===0){u.userNoResults&&(u.userNoResults.hidden=!1);return}u.userNoResults&&(u.userNoResults.hidden=!0);let _e=ke||{};se.forEach(Ce=>{let Pe=document.createElement("tr");Pe.dataset.userId=Ce.id;let be=document.createElement("td");be.textContent=`${Ce.display_name} (${Ce.email})`,Pe.appendChild(be);let Oe=document.createElement("td"),Re=document.createElement("input");Re.type="number",Re.className="aipkit_form-input aipkit_stats_credits_balance_input",Re.value=Ce.token_balance||0,Re.dataset.userId=Ce.id,Re.dataset.originalValue=Ce.token_balance||0,Re.setAttribute("min","0"),Re.setAttribute("step","1"),Re.title=l("Press Enter or blur to save changes","gpt3-ai-content-generator"),Oe.appendChild(Re);let _t=document.createElement("span");_t.className="aipkit_stats_credits_balance_status",Oe.appendChild(_t),Pe.appendChild(Oe);let Wt=document.createElement("td");Wt.textContent=e(Ce.total_used_all_bots||0),Pe.appendChild(Wt);let ri=document.createElement("td"),Ht=[],ht=Ce.tokens_used||{},Be=Ce.image_usage||{used:0};Be.used>0&&Ht.push(`<strong>${n(l("Image Generator","gpt3-ai-content-generator"))}:</strong> ${e(Be.used)}`),Object.keys(ht||{}).sort((bt,Qt)=>Number(bt)-Number(Qt)).forEach(bt=>{let Qt=ht[bt]||0;if(Qt<=0)return;let Jt=_e[bt]||`Bot #${bt}`;Ht.push(`<strong>${n(Jt)}:</strong> ${e(Qt)}`)});let qe=S(Ht,"-");ri.innerHTML=qe.html+(qe.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${n(l("Show more","gpt3-ai-content-generator"))}...</button>`:""),Pe.appendChild(ri);let gt=document.createElement("td"),Pt=[],qt=Ce.last_reset||{};Be.used>0&&Pt.push(`<strong>${n(l("Image Generator","gpt3-ai-content-generator"))}:</strong> ${n(E(Be.last_reset))}`);let We=new Set([...Object.keys(ht||{}),...Object.keys(qt||{})]);Array.from(We).sort((bt,Qt)=>Number(bt)-Number(Qt)).forEach(bt=>{if((ht||{})[bt]<=0)return;let Qt=_e[bt]||`Bot #${bt}`;Pt.push(`<strong>${n(Qt)}:</strong> ${n(E(qt[bt]||0))}`)});let xi=Ht.length>0?l("N/A","gpt3-ai-content-generator"):"-",Li=S(Pt,xi);gt.innerHTML=Li.html+(Li.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${n(l("Show more","gpt3-ai-content-generator"))}...</button>`:""),Pe.appendChild(gt);let Ft=document.createElement("td");if(Ft.className="aipkit_stats_user_actions_cell",Ce.purchase_history&&Ce.purchase_history.length){let bt=document.createElement("button");bt.type="button",bt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_stats_purchase_history_btn",bt.title=l("View purchase history","gpt3-ai-content-generator"),bt.innerHTML='<span class="dashicons dashicons-cart" aria-hidden="true"></span>',bt.dataset.userName=Ce.display_name,bt.dataset.history=JSON.stringify(Ce.purchase_history),Ft.appendChild(bt)}else Ft.textContent="-";Pe.appendChild(Ft),u.userTableBody.appendChild(Pe)})},T=se=>{if(!u.userPagination||!u.userTableFoot)return;u.userPagination.innerHTML="";let ke=Number(se?.total_users||0),_e=Number(se?.total_pages||0),Ce=Number(se?.current_page||1);if(!ke){u.userTableFoot.hidden=!0;return}let Pe=document.createElement("span");if(Pe.className="aipkit_pagination-count",Pe.textContent=`${ke.toLocaleString()} ${l("users","gpt3-ai-content-generator")}`,u.userPagination.appendChild(Pe),_e<=1){u.userTableFoot.hidden=!0;return}let be=document.createElement("span");be.className="aipkit_pagination-links";let Oe=document.createElement("button");Oe.type="button",Oe.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Oe.textContent=`\xAB ${l("Previous","gpt3-ai-content-generator")}`,Oe.disabled=Ce<=1,Oe.addEventListener("click",()=>M(Ce-1,_.search));let Re=document.createElement("span");Re.className="aipkit_pagination-current",Re.textContent=`${l("Page","gpt3-ai-content-generator")} ${Ce} ${l("of","gpt3-ai-content-generator")} ${_e}`;let _t=document.createElement("button");_t.type="button",_t.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_t.textContent=`${l("Next","gpt3-ai-content-generator")} \xBB`,_t.disabled=Ce>=_e,_t.addEventListener("click",()=>M(Ce+1,_.search)),be.appendChild(Oe),be.appendChild(Re),be.appendChild(_t),u.userPagination.appendChild(be),u.userTableFoot.hidden=!1},M=async(se=1,ke="")=>{if(!(!u.userTableBody||typeof window.aipkit_apiRequest!="function")){q(l("Loading user credits...","gpt3-ai-content-generator")),_.page=se,_.search=ke;try{let _e=await window.aipkit_apiRequest("aipkit_get_user_credits_data",{page:se,search:ke});_.botTitles=_e.bot_titles||{},A(_e.users_data||[],_.botTitles),T(_e.pagination||{})}catch(_e){u.userTableBody&&(u.userTableBody.innerHTML=`
                        <tr>
                            <td colspan="6" class="aipkit_stats_table_placeholder aipkit_text-danger">${n(_e.message||l("Error loading user credits.","gpt3-ai-content-generator"))}</td>
                        </tr>
                    `),u.userNoResults&&(u.userNoResults.hidden=!0),u.userTableFoot&&(u.userTableFoot.hidden=!0)}}},V=()=>{u.settingsPopover&&(u.settingsPopover.classList.remove("aipkit-active"),u.settingsPopover.setAttribute("aria-hidden","true"),u.settingsTrigger&&u.settingsTrigger.setAttribute("aria-expanded","false"))},W=()=>{u.userSheet&&(u.userSheet.classList.add("aipkit-active"),u.userSheet.setAttribute("aria-hidden","false"),M(_.page,_.search),u.userSearchInput&&u.userSearchInput.focus())},R=()=>{u.userSheet&&(u.userSheet.classList.remove("aipkit-active"),u.userSheet.setAttribute("aria-hidden","true"))},B=()=>{if(!u.shortcodeSnippet||!u.shortcodeOptions)return;let se=!0,ke=!0,_e=!0;u.shortcodeOptions.forEach(be=>{be.name==="cfg_show_chatbot"&&(se=be.checked),be.name==="cfg_show_aiforms"&&(ke=be.checked),be.name==="cfg_show_imagegenerator"&&(_e=be.checked)});let Ce=[];se||Ce.push('chatbot="false"'),ke||Ce.push('aiforms="false"'),_e||Ce.push('imagegenerator="false"');let Pe="[aipkit_token_usage";Ce.length&&(Pe+=` ${Ce.join(" ")}`),Pe+="]",u.shortcodeSnippet.textContent=Pe},$=(se,ke)=>{let _e=Array.isArray(se)?se:[],Ce=document.createElement("div");Ce.className="aipkit-modal-overlay aipkit-active";let Pe=()=>_e.length?_e.map(Oe=>{let Re=Oe?.date?.date?new Date(Oe.date.date):null,_t=Re&&!Number.isNaN(Re.getTime())?Re.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"",Wt=(Oe.products||[]).map(ri=>`
                                <div class="aipkit_stats_purchase_product">
                                    <span class="aipkit_stats_purchase_product_name">${n(ri.name)}</span>
                                    <span class="aipkit_stats_purchase_product_meta">
                                        ${ri.quantity>1?`${Number(ri.quantity)}x `:""}
                                        ${e(ri.tokens_per_item)} ${n(l("tokens","gpt3-ai-content-generator"))}
                                    </span>
                                </div>
                            `).join("");return`
                            <div class="aipkit_stats_purchase_item">
                                <div class="aipkit_stats_purchase_header">
                                    <div class="aipkit_stats_purchase_date">${n(_t)}</div>
                                    <div class="aipkit_stats_purchase_summary">
                                        <span class="aipkit_stats_purchase_tokens">+${e(Oe.tokens_granted)}</span>
                                        <span class="aipkit_stats_purchase_amount">${n(Oe.total_amount)} ${n(Oe.currency)}</span>
                                    </div>
                                </div>
                                <div class="aipkit_stats_purchase_order">${n(l("Order #","gpt3-ai-content-generator"))}${n(Oe.order_id)}</div>
                                ${Wt?`<div class="aipkit_stats_purchase_products">${Wt}</div>`:""}
                            </div>
                        `}).join(""):`<p>${n(l("No purchase history found for this user.","gpt3-ai-content-generator"))}</p>`;Ce.innerHTML=`
                <div class="aipkit-modal-content aipkit_stats_purchase_modal">
                    <div class="aipkit-modal-header">
                        <h3 class="aipkit-modal-title">${n(l("Purchase History for","gpt3-ai-content-generator"))} ${n(ke||"")}</h3>
                        <button class="aipkit-modal-close-btn" type="button" aria-label="${n(l("Close","gpt3-ai-content-generator"))}">&times;</button>
                    </div>
                    <div class="aipkit-modal-body">
                        <div class="aipkit_stats_purchase_history_list">${Pe()}</div>
                    </div>
                </div>
            `;let be=()=>{Ce.classList.remove("aipkit-active"),window.setTimeout(()=>{Ce.parentNode&&Ce.parentNode.removeChild(Ce)},200)};Ce.addEventListener("click",Oe=>{Oe.target===Ce&&be()}),Ce.querySelector(".aipkit-modal-close-btn")?.addEventListener("click",be),document.body.appendChild(Ce)},G=se=>{if(!se)return;let ke=se.dataset.userId,_e=se.parentElement?se.parentElement.querySelector(".aipkit_stats_credits_balance_status"):null,Ce=se.dataset.originalValue||se.defaultValue,Pe=se.value;if(String(Pe)!==String(Ce)){if(!v){_e&&(_e.textContent="ERR");return}_e&&(_e.innerHTML='<span class="aipkit_spinner"></span>'),clearTimeout(m),m=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",{_ajax_nonce:v,user_id:ke,balance:Pe}).then(be=>{_e&&(_e.textContent="OK"),se.dataset.originalValue=be.new_balance,window.setTimeout(()=>{_e&&(_e.textContent="")},1500)}).catch(()=>{_e&&(_e.textContent="ERR"),se.value=Ce,window.setTimeout(()=>{_e&&(_e.textContent="")},2500)})},400)}},L=se=>{if(!u.conversationChart)return;u.conversationChart.innerHTML="";let ke=Object.entries(se||{});if(!ke.length){u.conversationChart.innerHTML=`<div class="aipkit_stats_table_placeholder">${n("No data available.")}</div>`;return}let _e=Math.max(...ke.map(([,Ht])=>Number(Ht)||0),1),Ce=document.createElement("div");Ce.className="aipkit_stats_chart_wrapper";let Pe=document.createElement("div");Pe.className="aipkit_stats_y_axis";let be=4;for(let Ht=be;Ht>=0;Ht--){let ht=document.createElement("span");ht.className="aipkit_stats_y_label";let Be=Math.round(_e/be*Ht);ht.textContent=Be>=1e3?`${(Be/1e3).toFixed(1)}k`:Be,Pe.appendChild(ht)}Ce.appendChild(Pe);let Oe=document.createElement("div");Oe.className="aipkit_stats_bars_container";for(let Ht=0;Ht<be;Ht++){let ht=document.createElement("div");ht.className="aipkit_stats_grid_line",ht.style.bottom=`${(Ht+1)/be*100}%`,Oe.appendChild(ht)}let Re=document.createElement("div");Re.className="aipkit_stats_bars_wrapper",ke.forEach(([Ht,ht])=>{let Be=document.createElement("div");Be.className="aipkit_stats_bar_group";let qe=document.createElement("div"),gt=Math.max(2,Math.round(Number(ht)/_e*100));qe.className="aipkit_stats_bar",qe.style.height=`${gt}%`,qe.title=`${Ht}: ${ht}`,Be.appendChild(qe),Re.appendChild(Be)}),Oe.appendChild(Re),Ce.appendChild(Oe);let _t=document.createElement("div");_t.className="aipkit_stats_x_axis";let Wt=Math.min(ke.length,7),ri=Math.max(1,Math.floor(ke.length/Wt));ke.forEach(([Ht],ht)=>{let Be=document.createElement("span");if(Be.className="aipkit_stats_x_label",ht%ri===0||ht===ke.length-1){let qe=Ht.split("-");Be.textContent=qe.length>=3?`${qe[1]}/${qe[2]}`:Ht}_t.appendChild(Be)}),Ce.appendChild(_t),u.conversationChart.appendChild(Ce)},K=se=>{if(u.moduleChart){if(typeof window.aipkit_renderTokenUsageChart!="function"){u.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${n("Chart renderer unavailable.")}</p>`;return}if(!se||Object.keys(se).length===0){u.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${n("No data available.")}</p>`;return}window.aipkit_renderTokenUsageChart(u.moduleChart,se)}},H=se=>se?w[se]?w[se]:se.replace(/[_-]/g," ").replace(/\b\w/g,ke=>ke.toUpperCase()):w.chatbot||"Chatbot",ne=se=>{if(!u.tableBody)return;if(!Array.isArray(se)||!se.length){y("No logs found.");return}let ke=se.map(_e=>{let Ce=_e.last_message_content?String(_e.last_message_content):"",Pe=s(_e.last_message_ts),be=i(_e.last_message_ts),Oe=e(_e.total_conversation_tokens||0),Re=Number(_e.id);return`
                    <tr class="aipkit_stats_row${o.selectedLogId===Re?" aipkit_stats_row_active":""}" data-log-id="${n(_e.id)}">
                        <td title="${n(be)}">${n(Pe)}</td>
                        <td>${n(_e.user_display_name||"\u2014")}</td>
                        <td>${n(_e.bot_name||H(_e.module))}</td>
                        <td>${n(e(_e.message_count||0))}</td>
                        <td>${n(Oe)}</td>
                        <td><span class="aipkit_stats_preview">${n(Ce)}</span></td>
                    </tr>
                `});u.tableBody.innerHTML=ke.join("")},ae=()=>({days:o.days,bot_id:o.botId,module:o.module,search:o.search}),Z=(se,ke)=>{let _e=new Blob([se],{type:"text/csv;charset=utf-8;"}),Ce=URL.createObjectURL(_e),Pe=document.createElement("a");Pe.href=Ce,Pe.download=ke||"aipkit-logs.csv",document.body.appendChild(Pe),Pe.click(),Pe.remove(),URL.revokeObjectURL(Ce)},pe=async se=>{if(!(!se||!window.confirm("Delete this conversation?"))){C("Deleting conversation...");try{let _e=await window.aipkit_apiRequest("aipkit_stats_delete_log",{log_id:se});C(_e.message||"Conversation deleted."),o.selectedLogId===Number(se)&&(o.selectedLogId=null,lt(null)),at(),window.setTimeout(()=>C(""),2e3)}catch(_e){C(_e.message||"Failed to delete conversation.","error")}}},ve=async()=>{if(window.confirm("Delete all logs that match the current filters?")){C("Deleting logs...");try{let ke=await window.aipkit_apiRequest("aipkit_stats_delete_logs",ae());C(ke.message||"Logs deleted."),o.selectedLogId=null,lt(null),at(),window.setTimeout(()=>C(""),2500)}catch(ke){C(ke.message||"Failed to delete logs.","error")}}},De=async()=>{C("Preparing export...");try{let se=await window.aipkit_apiRequest("aipkit_stats_export_logs",ae());if(!se||!se.csv)throw new Error("Export failed.");Z(se.csv,se.filename),C(se.message||"Export ready."),window.setTimeout(()=>C(""),2e3)}catch(se){C(se.message||"Failed to export logs.","error")}},Qe=se=>{if(!u.tableMenu||!u.tableMenuTrigger)return;let ke=se??u.tableMenu.hidden;u.tableMenu.hidden=!ke,u.tableMenuTrigger.setAttribute("aria-expanded",ke?"true":"false")},$e=se=>{if(u.pagination){if(typeof window.aipkit_renderLogsPagination=="function"){window.aipkit_renderLogsPagination(se,u.pagination,ke=>{o.page=ke,at()});return}u.pagination.innerHTML=""}},lt=se=>{if(!u.detailPanel)return;if(!se){u.detailPanel.innerHTML=`
                    <div class="aipkit_stats_detail_empty">
                        <div>
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.4; margin-bottom: 12px;">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <div>${n("Select a conversation to view details.")}</div>
                        </div>
                    </div>
                `;return}let ke=Be=>{let qe=(Be||"").toLowerCase();return qe==="assistant"||qe==="model"||qe==="bot"?"bot":qe==="user"?"user":qe||"unknown"},_e=(Be,qe)=>{for(let gt=qe+1;gt<Be.length;gt+=1)if(ke(Be[gt]?.role)==="bot")return Be[gt];return null},Ce=Be=>Be>=85?"is-excellent":Be>=70?"is-good":Be>=50?"is-fair":"is-poor",Pe=`
                <div class="aipkit_stats_detail_header">
                    <div class="aipkit_stats_detail_title">${n(se.user_display_name||"User")}</div>
                    <div class="aipkit_stats_detail_meta">
                        ${n(se.bot_name||H(se.module))}
                        &middot; ${n(i(se.last_message_ts))}
                        &middot; ${n(e(se.message_count||0))} ${n("messages")}
                        ${se.ip_address?`&middot; ${n(`IP ${se.ip_address}`)}`:""}
                    </div>
                </div>
            `,be=Array.isArray(se.messages)?se.messages:[],Oe=String(se.module||"").toLowerCase().replace(/[\s-]+/g,"_"),Re=(()=>{if(typeof window.markdownit!="function")return null;let Be=window.markdownit({html:!1,linkify:!0,typographer:!0});return window.hljs&&typeof window.markdownitHighlight=="function"&&Be.use(window.markdownitHighlight,{hljs:window.hljs}),Be})(),_t=Be=>{let qe=String(Be||"").trim().toLowerCase();return qe?qe.startsWith("generate ")||qe.startsWith("content writer request"):!1},Wt=Be=>{if(!Be||typeof Be!="object")return null;let qe=Be.payload_sent;if(!qe||typeof qe!="object")return null;let gt=Array.isArray(qe.messages)?qe.messages:Array.isArray(qe.input)?qe.input:null;if(!Array.isArray(gt))return null;let Pt=gt.find(qt=>qt&&qt.role==="user"&&typeof qt.content=="string"&&qt.content.trim());return Pt?Pt.content.trim():null},ri=(Be,qe)=>{if(!Be||typeof Be!="object")return null;let gt={"generate excerpt":"custom_excerpt_prompt","generate tags":"custom_tags_prompt","generate meta description":"custom_meta_prompt","generate focus keyword":"custom_keyword_prompt","generate image prompt":"image_prompt","generate featured image":"featured_image_prompt","generate title":"custom_title_prompt"},Pt=String(qe||"").trim().toLowerCase(),qt=gt[Pt];if(!qt||typeof Be[qt]!="string")return null;let We=Be[qt].trim();return We||null},Ht=Be=>{if(!Be||typeof Be!="object")return null;for(let qe in Be){if(!Object.prototype.hasOwnProperty.call(Be,qe)||!/_prompt$/i.test(qe))continue;let gt=Be[qe];if(typeof gt=="string"&&gt.trim())return gt.trim()}return null};if(Oe==="content_writer"&&Array.isArray(be)&&be.length)for(let Be=0;Be<be.length;Be+=1){let qe=be[Be];if(!qe||qe.role!=="user"||typeof qe.content!="string")continue;let gt=qe.content.trim();if(!gt||!_t(gt))continue;let Pt=null,qt=be[Be+1]?.request_payload;qt&&(Pt=Wt(qt)),!Pt&&qe.request_payload&&(Pt=Wt(qe.request_payload)),!Pt&&qe.request_payload&&(Pt=ri(qe.request_payload,gt)),!Pt&&qe.request_payload&&(Pt=Ht(qe.request_payload)),Pt&&(qe.original_content=qe.content,qe.content=Pt)}let ht=be.map((Be,qe)=>{let gt=ke(Be.role),Pt=i(Be.timestamp),qt=c(Be.content),We=gt==="user"?"User":gt==="bot"?"Assistant":gt,Li=String(Be.message_id||`msg_${qe}`).replace(/[^a-zA-Z0-9_-]/g,"")||`msg_${qe}`,Ft=[],bt="",Qt="",Jt="";if(gt==="user"){let Ge=_e(be,qe),et=Ge?.provider||"",Nt=Ge?.model||"",Gt=Ge?.usage?.total_tokens??Ge?.usage?.totalTokenCount??null;et&&Ft.push(et),Nt&&Ft.push(Nt),typeof Gt=="number"&&Gt>0&&Ft.push(`${e(Gt)} tokens`);let wt=Ge?.request_payload||null;if(Ft.length||wt)if(wt){let Ot=`aipkit_stats_payload_${Li}`,Yt=Ft.length?Ft.join(" / "):"Request payload";bt=`
                                <button type="button" class="aipkit_stats_meta_toggle" data-aipkit-stats-toggle="${Ot}" aria-expanded="false">
                                    <span>${n(Yt)}</span>
                                    <span class="aipkit_stats_meta_chevron" aria-hidden="true"></span>
                                </button>
                            `,Jt+=`
                                <div class="aipkit_stats_expandable" id="${Ot}" hidden>
                                    <div class="aipkit_stats_expandable_header">${n("Request Payload")}</div>
                                    <div class="aipkit_stats_expandable_body">
                                        <pre class="aipkit_stats_payload">${n(JSON.stringify(wt,null,2))}</pre>
                                    </div>
                                </div>
                            `}else Ft.length&&(bt=`<div class="aipkit_stats_meta_info">${n(Ft.join(" / "))}</div>`)}if(gt==="bot"){let Ge=Array.isArray(Be.vector_search_scores)?Be.vector_search_scores:[];if(Ge.length>0){let et=Ge.reduce((Yt,pi)=>{let Ze=Number(Yt?.score??0);return Number(pi?.score??0)>Ze?pi:Yt},Ge[0]),Nt=et?.score!==void 0?Math.round(Number(et.score)*100):0,Gt=Ce(Nt),wt=`aipkit_stats_scores_${Li}`;Qt=`
                            <button type="button" class="aipkit_stats_score_badge ${Gt}" data-aipkit-stats-toggle="${wt}" aria-expanded="false">
                                ${n(`Score ${Nt}%`)}
                            </button>
                        `;let Ot=Ge.map(Yt=>{let pi=Yt?.provider||"Unknown",Ze="";if(pi==="OpenAI")Ze=Yt.store_name||Yt.store_id?` \xB7 ${Yt.store_name||Yt.store_id}`:"";else if(pi==="Pinecone"){let ui=Yt.namespace?` \xB7 ${Yt.namespace}`:"";Ze=Yt.index_name?` \xB7 ${Yt.index_name}${ui}`:ui}else pi==="Qdrant"&&(Ze=Yt.collection_name?` \xB7 ${Yt.collection_name}`:"");let Ee=Yt?.score!==void 0?Math.round(Number(Yt.score)*100):null,Lt=Ee!==null?Ce(Ee):"is-poor",ft=Yt?.content_preview||"";return`
                                <div class="aipkit_stats_score_item">
                                    <div class="aipkit_stats_score_title">${n(pi)}${n(Ze)}</div>
                                    <div class="aipkit_stats_score_value ${Lt}">
                                        ${n(Ee!==null?`${Ee}%`:"\u2014")}
                                    </div>
                                    <div class="aipkit_stats_score_preview">${n(ft)}</div>
                                </div>
                            `}).join("");Jt+=`
                            <div class="aipkit_stats_expandable" id="${wt}" hidden>
                                <div class="aipkit_stats_expandable_header">${n("Vector Search Results")}</div>
                                <div class="aipkit_stats_expandable_body aipkit_stats_scores_list">
                                    ${Ot}
                                </div>
                            </div>
                        `}}let di=!!bt,Hi=!!Qt,fe=di||Hi?`
                    <div class="aipkit_stats_meta_bar${di&&!Hi||!di&&Hi?" aipkit_stats_meta_bar--compact":""}">
                        ${di?bt:""}
                        <div class="aipkit_stats_meta_actions">
                            ${Qt||""}
                        </div>
                    </div>
                `:"",Fe=!!(Re&&typeof qt=="string"),ge=Fe?Re.render(qt):n(qt);return`
                    <div class="aipkit_stats_message aipkit_stats_message--${n(gt)}" style="animation-delay: ${qe*.05}s">
                        <div class="aipkit_stats_message_meta">${n(We)}${Pt?` \xB7 ${n(Pt)}`:""}</div>
                        <div class="aipkit_stats_message_body${Fe?" aipkit_stats_message_body--markdown":""}">${ge}</div>
                        ${fe}
                        ${Jt}
                    </div>
                `}).join("");u.detailPanel.innerHTML=`
                ${Pe}
                <div class="aipkit_stats_detail_messages">
                    ${ht||`<div class="aipkit_stats_table_placeholder">${n("No messages found.")}</div>`}
                    <div class="aipkit_stats_detail_footer">
                        <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_stats_detail_delete" data-log-id="${n(se.id)}">
                            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                            ${n("Delete")}
                        </button>
                    </div>
                </div>
            `},it=async()=>{C("Loading stats...");try{let se=await window.aipkit_apiRequest("aipkit_stats_get_overview",{days:o.days});u.totalConversations.textContent=e(se.summary?.total_conversations||0),u.totalMessages.textContent=e(se.summary?.total_messages||0),u.uniqueUsers.textContent=e(se.summary?.unique_users||0),u.avgTokens.textContent=e(se.summary?.avg_tokens||0),u.overviewPeriod&&(u.overviewPeriod.textContent=se.summary?.period_label||""),L(se.charts?.daily_conversations||{}),K(se.charts?.daily_tokens||{}),C("")}catch(se){C(se.message||"Failed to load stats.","error")}},we=(se,ke=!0)=>{if(u.overviewPanel){if(u.overviewPanel.hidden=!se,u.overviewToggle&&(u.overviewToggle.setAttribute("aria-expanded",se?"true":"false"),u.overviewToggle.classList.toggle("is-active",se)),ke)try{localStorage.setItem(r,se?"1":"0")}catch{}se&&it()}},at=async()=>{y("Loading logs...");try{let se=await window.aipkit_apiRequest("aipkit_stats_get_logs",{days:o.days,page:o.page,per_page:o.perPage,bot_id:o.botId,module:o.module,search:o.search}),ke=Array.isArray(se.logs)?se.logs:[];!o.selectedLogId&&!k&&ke.length&&(o.selectedLogId=Number(ke[0].id),k=!0),ne(ke),$e(se.pagination||{}),o.selectedLogId&&k&&Zt(o.selectedLogId)}catch(se){y(se.message||"Failed to load logs.")}},Zt=async se=>{if(!se){lt(null);return}u.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${n("Loading conversation...")}</div>`;try{let ke=await window.aipkit_apiRequest("aipkit_stats_get_log_detail",{log_id:se});lt(ke)}catch(ke){u.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${n(ke.message||"Failed to load conversation.")}</div>`}},$t=se=>{o.search=se.trim(),o.page=1,p&&clearTimeout(p),p=window.setTimeout(()=>{at()},300)},li=async()=>{if(u.cronStatus)try{let se=await window.aipkit_apiRequest("aipkit_stats_get_log_cron_status",{});I(se)}catch{}},ai=async()=>{if(!u.settingsToggle||!u.retentionSelect)return;let se=u.settingsToggle.checked?"1":"0",ke=parseInt(u.retentionSelect.value,10)||90;C("Saving settings...","loading");try{let _e=await window.aipkit_apiRequest("aipkit_stats_save_settings",{enable_pruning:se,retention_period_days:ke});b(u.settingsToggle.checked),C(_e.message||"Settings saved.","success"),li(),window.setTimeout(()=>C(""),2e3)}catch(_e){C(_e.message||"Failed to save settings.","error")}};if(u.daysFilter&&(u.daysFilter.value=String(o.days),u.daysFilter.addEventListener("change",()=>{o.days=parseInt(u.daysFilter.value,10)||30,o.page=1,u.overviewPanel&&!u.overviewPanel.hidden&&it(),at()})),u.botFilter&&u.botFilter.addEventListener("change",()=>{o.botId=u.botFilter.value,o.page=1,at()}),u.moduleFilter&&u.moduleFilter.addEventListener("change",()=>{o.module=u.moduleFilter.value,o.page=1,at()}),u.searchInput&&u.searchInput.addEventListener("input",se=>{$t(se.target.value||"")}),u.overviewToggle&&u.overviewPanel&&u.overviewToggle.addEventListener("click",()=>{let se=!u.overviewPanel.hidden;we(!se)}),u.tableBody&&u.tableBody.addEventListener("click",se=>{let ke=se.target.closest("tr[data-log-id]");if(!ke)return;let _e=ke.getAttribute("data-log-id");_e&&(o.selectedLogId=Number(_e),u.tableBody.querySelectorAll("tr").forEach(Ce=>{Ce.classList.toggle("aipkit_stats_row_active",Ce===ke)}),Zt(_e))}),u.detailPanel&&u.detailPanel.addEventListener("click",se=>{let ke=se.target.closest(".aipkit_stats_detail_delete");if(!ke){let _e=se.target.closest("[data-aipkit-stats-toggle]");if(!_e)return;let Ce=_e.getAttribute("data-aipkit-stats-toggle");if(!Ce)return;let Pe=document.getElementById(Ce);if(!Pe)return;let be=_e.getAttribute("aria-expanded")==="true";Pe.hidden=be,_e.setAttribute("aria-expanded",be?"false":"true"),_e.classList.toggle("is-expanded",!be);return}pe(ke.getAttribute("data-log-id"))}),u.tableMenuTrigger&&u.tableMenu&&u.tableMenuTrigger.addEventListener("click",se=>{se.preventDefault(),se.stopPropagation(),Qe(u.tableMenu.hidden)}),document.addEventListener("click",se=>{!u.tableMenu||u.tableMenu.hidden||se.target.closest("#aipkit_stats_table_menu")||se.target.closest("#aipkit_stats_table_menu_trigger")||Qe(!1)}),document.addEventListener("keydown",se=>{se.key!=="Escape"||!u.tableMenu||u.tableMenu.hidden||Qe(!1)}),u.deleteAllBtn&&u.deleteAllBtn.addEventListener("click",()=>{Qe(!1),ve()}),u.exportBtn&&u.exportBtn.addEventListener("click",()=>{Qe(!1),De()}),u.settingsToggle&&u.settingsToggle.addEventListener("change",()=>{if(!h){u.settingsToggle.checked=!1,C("Upgrade to Pro to enable auto-delete.","error");return}b(u.settingsToggle.checked),ai()}),u.retentionSelect&&u.retentionSelect.addEventListener("change",()=>{h&&ai()}),u.shortcodeToggle&&u.shortcodeConfig&&u.shortcodeToggle.addEventListener("click",se=>{se.preventDefault();let ke=!u.shortcodeConfig.hidden;u.shortcodeConfig.hidden=ke,u.shortcodeToggle.setAttribute("aria-expanded",ke?"false":"true"),u.shortcodeToggle.classList.toggle("is-active",!ke)}),u.shortcodeOptions&&u.shortcodeOptions.length&&(u.shortcodeOptions.forEach(se=>{se.addEventListener("change",B)}),B()),u.shortcodeSnippet&&u.shortcodeSnippet.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(u.shortcodeSnippet.textContent,u.shortcodeSnippet)}),u.settingsUsersNav&&u.settingsUsersNav.addEventListener("click",se=>{se.preventDefault(),V(),W()}),u.userSheetClose&&u.userSheetClose.addEventListener("click",se=>{se.preventDefault(),R()}),u.userSheet&&u.userSheet.addEventListener("click",se=>{se.target===u.userSheet&&R()}),u.userSearchInput&&(u.userSearchInput.addEventListener("input",()=>{clearTimeout(f);let se=u.userSearchInput.value.trim();f=window.setTimeout(()=>{M(1,se)},350)}),u.userSearchInput.addEventListener("keydown",se=>{if(se.key==="Enter"){se.preventDefault(),clearTimeout(f);let ke=u.userSearchInput.value.trim();M(1,ke),u.userSearchClear&&(u.userSearchClear.hidden=ke.length===0)}})),u.userSearchClear&&u.userSearchClear.addEventListener("click",()=>{u.userSearchInput&&(u.userSearchInput.value=""),u.userSearchClear.hidden=!0,M(1,"")}),u.userTableBody){let se="data-user-credits-listeners";u.userTableBody.getAttribute(se)||(u.userTableBody.addEventListener("change",ke=>{ke.target.matches(".aipkit_stats_credits_balance_input")&&G(ke.target)}),u.userTableBody.addEventListener("keypress",ke=>{ke.key==="Enter"&&ke.target.matches(".aipkit_stats_credits_balance_input")&&(ke.preventDefault(),ke.target.blur())}),u.userTableBody.addEventListener("click",ke=>{let _e=ke.target.closest(".aipkit_stats_usage_toggle");if(_e){ke.preventDefault();let Pe=_e.closest("td");if(Pe){let be=Pe.querySelectorAll(".aipkit_stats_usage_extra");if(be.length){let Oe=be[0].hidden;be.forEach(Re=>{Re.hidden=!Oe}),_e.textContent=Oe?l("Show less","gpt3-ai-content-generator"):`${l("Show more","gpt3-ai-content-generator")}...`}}return}let Ce=ke.target.closest(".aipkit_stats_purchase_history_btn");if(Ce){ke.preventDefault();let Pe=Ce.dataset.history?JSON.parse(Ce.dataset.history):[];$(Pe,Ce.dataset.userName||"")}}),u.userTableBody.setAttribute(se,"true"))}document.addEventListener("keydown",se=>{se.key==="Escape"&&u.userSheet&&u.userSheet.classList.contains("aipkit-active")&&R()}),we(x(),!1),at(),b(!!u.settingsToggle?.checked)}window.aipkit_initStats=t})();(function(){"use strict";function g(){let a={},r=document.getElementById("aipkit_settings_container");return r&&r.querySelectorAll("input[name], select[name], textarea[name]").forEach(e=>{e.type==="checkbox"?a[e.name]=e.checked?"1":"0":e.type==="radio"?e.checked&&(a[e.name]=e.value):a[e.name]=e.value}),a}window.aipkit_getCurrentFormData=g})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function g(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let a=window.aipkit_getCurrentFormData(),r=window.aipkit_lastSavedData||{};if(JSON.stringify(a)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let n="aipkit_settings_messages";window.aipkit_showSavingIndicator(n,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",a),window.aipkit_showSavingIndicator(n,!1),window.aipkit_showMessage(n,"success","Settings saved!"),window.aipkit_lastSavedData=a,typeof window.aipkit_queueProviderAutoSync=="function"&&window.aipkit_queueProviderAutoSync(r,a)}catch(e){window.aipkit_showSavingIndicator(n,!1),window.aipkit_showMessage(n,"error","Save failed: "+e.message),console.error("AIPKit Auto-Save Error:",e)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=g})();(function(){"use strict";function g(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let n="data-autosave-listener-attached";r.getAttribute(n)||(r.addEventListener("change",function(e){let i=e.target;i.matches(".aipkit_autosave_trigger")&&i.id!=="aipkit_provider"&&(i.tagName.toLowerCase()==="select"||i.type==="checkbox"||i.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),r.addEventListener("blur",function(e){let i=e.target;if(i.matches(".aipkit_autosave_trigger")&&i.id!=="aipkit_provider"){let s=i.tagName.toLowerCase();(s==="input"||s==="textarea")&&i.type!=="range"&&i.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),r.setAttribute(n,"true"))}function a(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=g,window.aipkit_updateLastSavedData=a})();(function(){"use strict";function g(r){try{return new Date(r+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return r}}function a(r){return typeof r!="number"?r:r.toLocaleString()}window.aipkit_formatChartDate=g,window.aipkit_formatChartNumber=a})();(function(){"use strict";let g=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],a="#B0BEC5",r={};function n(i){r={};let s=0;i.forEach(c=>{if(c==="Other")r[c]=a;else{let t;do t=g[s%g.length],s++;while(t===a&&g.length>1);r[c]=t}})}function e(i){return r[i]||"#cccccc"}window.aipkit_assignModuleColors=n,window.aipkit_getModuleColor=e})();(function(){"use strict";function g(e,i){if(!i||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let s=e.target,c=s.getAttribute("data-date"),t=s.getAttribute("data-module"),d=parseInt(s.getAttribute("data-value"),10),o=parseInt(s.getAttribute("data-daily-total"),10),l=window.aipkit_getModuleColor(t),_=t?a(t.replace(/[-_]/g," ")):"Unknown";i.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(c)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${l}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${_}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(d)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(o)} tokens)</span>
        `,i.classList.add("aipkit_active"),r(e,i)}function a(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function r(e,i){if(!i)return;let s=i.parentElement;if(!s)return;let c=s.getBoundingClientRect(),t=e.clientX-c.left,d=e.clientY-c.top,o=i.offsetWidth,l=i.offsetHeight,_=t+15,p=d-l-10;_+o>c.width-5&&(_=t-o-15),_<5&&(_=5),p<5&&(p=d+15),p+l>c.height-5&&(p=c.height-l-5),i.style.left=`${_}px`,i.style.top=`${p}px`,i.style.transform="translate(0, 0)"}function n(e){e&&e.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=g,window.aipkit_moveChartTooltip=r,window.aipkit_hideChartTooltip=n})();(function(){"use strict";let g="http://www.w3.org/2000/svg";function a(n,e){if(n.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),n.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let i=Object.keys(e);if(i.length===0){n.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let s=new Set;i.forEach(E=>{Object.keys(e[E]).forEach(S=>s.add(S))});let c=Array.from(s);c.sort((E,S)=>{if(E==="Other")return 1;if(S==="Other")return-1;let A=T=>T?r(T.replace(/[-_]/g," ")):"Unknown";return A(E).localeCompare(A(S))}),window.aipkit_assignModuleColors(c);let t=1;i.forEach(E=>{let S=Object.values(e[E]).reduce((A,T)=>A+T,0);S>t&&(t=S)}),t=t*1.05;let d=i.length,o=250,l=c.length>0?Math.max(40,Math.ceil(c.length/3)*20):0,_={top:20,right:20,bottom:30+l,left:50},p=n.clientWidth-_.left-_.right,f=o-_.top-_.bottom,m=Math.max(1,p/d*.8),k=Math.max(0,p/d*.2),u=document.createElementNS(g,"svg");u.setAttribute("viewBox",`0 0 ${n.clientWidth} ${o}`),u.setAttribute("preserveAspectRatio","xMidYMid meet"),u.setAttribute("class","aipkit_token_usage_chart_svg"),u.setAttribute("aria-label","Token usage per module per day chart");let w=document.createElementNS(g,"g");w.setAttribute("transform",`translate(${_.left}, ${_.top})`),u.appendChild(w);let h=document.createElement("div");h.className="aipkit_chart_tooltip",n.style.position="relative",n.appendChild(h);let v=document.createElementNS(g,"g");v.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),w.appendChild(v);let C=document.createElementNS(g,"line");C.setAttribute("x1",0),C.setAttribute("y1",0),C.setAttribute("x2",0),C.setAttribute("y2",f),v.appendChild(C);let x=5;for(let E=0;E<x;E++){let S=Math.round(t*(E/(x-1))),A=f-f*(E/(x-1)),T=document.createElementNS(g,"text");T.setAttribute("x",-5),T.setAttribute("y",A+3),T.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),T.textContent=window.aipkit_formatChartNumber(S),v.appendChild(T);let M=document.createElementNS(g,"line");M.setAttribute("x1",0),M.setAttribute("y1",A),M.setAttribute("x2",p),M.setAttribute("y2",A),M.setAttribute("class","aipkit_chart_grid_line"),w.insertBefore(M,w.firstChild)}let b=document.createElementNS(g,"g");b.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),b.setAttribute("transform",`translate(0, ${f})`),w.appendChild(b);let I=document.createElementNS(g,"line");I.setAttribute("x1",0),I.setAttribute("y1",0),I.setAttribute("x2",p),I.setAttribute("y2",0),b.appendChild(I);let y=Math.max(1,Math.ceil(d/(p/60)));i.forEach((E,S)=>{if(S%y===0||S===d-1){let A=S*(m+k)+m/2+k/2,T=document.createElementNS(g,"text");T.setAttribute("x",A),T.setAttribute("y",_.bottom-l-10),T.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),T.textContent=window.aipkit_formatChartDate(E),b.appendChild(T)}});let q=document.createElementNS(g,"g");if(w.appendChild(q),i.forEach((E,S)=>{let A=e[E],T=f,M=0;c.filter(R=>A[R]>0).forEach(R=>{let B=A[R]||0;M+=B;let $=B/t*f;T-=$;let G=S*(m+k)+k/2,L=document.createElementNS(g,"rect");L.setAttribute("x",G),L.setAttribute("y",T),L.setAttribute("width",m),L.setAttribute("height",Math.max(.1,$)),L.setAttribute("class","aipkit_chart_bar"),L.setAttribute("fill",window.aipkit_getModuleColor(R)),L.setAttribute("data-date",E),L.setAttribute("data-module",R),L.setAttribute("data-value",B),L.setAttribute("data-daily-total",0),L.addEventListener("mouseenter",K=>window.aipkit_showStackedTooltip(K,h)),L.addEventListener("mousemove",K=>window.aipkit_moveChartTooltip(K,h)),L.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(h)),q.appendChild(L)}),q.querySelectorAll(`rect[data-date="${E}"]`).forEach(R=>R.setAttribute("data-daily-total",M))}),c.length>0){let E=document.createElementNS(g,"g");E.setAttribute("class","aipkit_chart_legend"),E.setAttribute("transform",`translate(0, ${f+_.bottom-l+5})`),w.appendChild(E);let S=0,A=0,T=20,M=p,V=35;c.forEach(W=>{let R=r(W.replace(/[-_]/g," ")),$=R.length*7+25+V;S>0&&S+$>M&&(S=0,A+=T);let G=document.createElementNS(g,"g");G.setAttribute("transform",`translate(${S}, ${A})`);let L=document.createElementNS(g,"rect");L.setAttribute("width",10),L.setAttribute("height",10),L.setAttribute("y",-5),L.setAttribute("fill",window.aipkit_getModuleColor(W)),G.appendChild(L);let K=document.createElementNS(g,"text");K.setAttribute("x",15),K.setAttribute("y",0),K.setAttribute("class","aipkit_chart_legend_label"),K.textContent=R,G.appendChild(K),E.appendChild(G),S+=$})}n.appendChild(u)}function r(n){return n?n.charAt(0).toUpperCase()+n.slice(1):""}window.aipkit_renderTokenUsageChart=a})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_token_usage_chart_container");if(!r){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let n=r.querySelector(".aipkit_chart_loading_placeholder"),e=r.querySelector(".aipkit_chart_error_placeholder"),i=r.querySelector(".aipkit_chart_nodata_placeholder");e&&(e.style.display="none"),i&&(i.style.display="none"),n&&(n.style.display="flex");let s=[3,7,14,30,90],c=parseInt(a,10);if(!c||isNaN(c)){try{let d=localStorage.getItem("aipkit_stats_period_days"),o=parseInt(d,10);d&&!isNaN(o)&&s.includes(o)&&(c=o)}catch{}let t=document.getElementById("aipkit_stats_period_select");if(t){let d=parseInt(t.value,10);(!c||isNaN(c))&&(c=!isNaN(d)&&s.includes(d)?d:3),s.includes(c)&&String(t.value)!==String(c)&&(t.value=String(c))}else r.dataset.defaultDays?c=parseInt(r.dataset.defaultDays,10)||3:c=3}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:c}).then(t=>{if(n&&(n.style.display="none"),t&&t.daily_token_data){let d=t.daily_token_data;if(d&&typeof d=="object"&&Object.values(d).some(l=>l&&typeof l=="object"&&Object.values(l).some(_=>Number(_)>0)))window.aipkit_renderTokenUsageChart(r,d);else{let l=t.notice||window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.",_=t.manage_logs_url,p=e||i;if(p){p.textContent="";let f=document.createTextNode(l+" ");if(p.appendChild(f),_){let m=document.createElement("a");m.href=_,m.target="_blank",m.rel="noopener noreferrer",m.textContent=window.aipkit_dashboard?.text?.manageLogs||"View stats",p.appendChild(m)}p.style.display="flex"}else{let f=document.createElement("div");f.className="aipkit_chart_error_placeholder",f.textContent=l,r.innerHTML="",r.appendChild(f)}}}else throw new Error("Invalid data received for chart.")}).catch(t=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",t),n&&(n.style.display="none"),e)e.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,e.style.display="flex";else{let d=document.createElement("div");d.className="aipkit_chart_error_placeholder",d.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,r.innerHTML="",r.appendChild(d)}})}window.aipkit_loadTokenUsageChart=g,document.addEventListener("change",function(a){let r=a.target;if(r&&r.id==="aipkit_stats_period_select"){let n=parseInt(r.value,10)||7;typeof window.aipkit_loadTokenUsageChart=="function"&&window.aipkit_loadTokenUsageChart(n);try{[3,7,14,30,90].includes(n)&&localStorage.setItem("aipkit_stats_period_days",String(n))}catch{}}})})();(function(){"use strict";let g=window.wp?.i18n?.__||function(r){return r};function a(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openai=r);let n=document.getElementById("aipkit_openai_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openai_model"]');if(!n&&e.length===0){console.warn("OpenAI Sync: No OpenAI model selects found (#aipkit_openai_model or chat selects).");return}let i=window.aipkit_dashboard?.recommendedModels?.openai||[],s=Array.isArray(i)?i:[],c=k=>{if(!k)return[];let u=g("Recommended","gpt3-ai-content-generator"),w=Array.from(k.querySelectorAll("optgroup")).find(h=>h.label===u||h.label==="Recommended");return w?Array.from(w.querySelectorAll("option")).map(h=>({id:h.value,name:h.textContent.trim()||h.value})).filter(h=>h.id):[]};if(s.length===0){let k=n||e[0];s=c(k)}let t=new Set(s.map(k=>k?.id).filter(Boolean)),d=r&&typeof r=="object"?r:{},o=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],l=Object.keys(d),_=o.filter(k=>l.includes(k)).concat(l.filter(k=>!o.includes(k)).sort()),p=k=>{let u=k.value;k.innerHTML="";let w=!1,h=!1;if(s.length>0){let v=document.createElement("optgroup");v.label=g("Recommended","gpt3-ai-content-generator"),s.forEach(C=>{if(!C||typeof C!="object"||!C.id)return;let x=new Option(C.name||C.id,C.id);C.id===u&&(x.selected=!0,w=!0),v.appendChild(x)}),v.children.length>0&&(k.appendChild(v),h=!0)}if(_.forEach(v=>{let C=Array.isArray(d[v])?d[v].slice():[];if(C.length===0)return;C.sort((b,I)=>(b.name||b.id||"").localeCompare(I.name||I.id||""));let x=document.createElement("optgroup");x.label=v,C.forEach(b=>{let I=b?.id||"";if(!I||t.has(I))return;let y=new Option(b.name||I,I);I===u&&(y.selected=!0,w=!0),x.appendChild(y)}),x.children.length>0&&(k.appendChild(x),h=!0)}),!h){k.appendChild(new Option("No models found.",""));return}if(!w&&u&&!k.querySelector(`option[value="${CSS.escape(u)}"]`)){let v=new Option(u+" (manual)",u,!1,!0);k.insertBefore(v,k.firstChild),k.value=u,w=!0}if(k.options.length>0&&k.selectedIndex===-1){let v=-1;for(let C=0;C<k.options.length;C++)if(!k.options[C].disabled&&k.options[C].value){v=C;break}k.selectedIndex=v!==-1?v:0}};n&&p(n),e.forEach(p);let f=document.getElementById("aipkit_content_writer_provider"),m=document.getElementById("aipkit_content_writer_model");f&&m&&f.value==="openai"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(f,m)}window.aipkit_updateOpenAIModels=a})();(function(){"use strict";let g=window.wp?.i18n?.__||function(r){return r};function a(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openrouter=Array.isArray(r)?r:[]);let n=document.getElementById("aipkit_openrouter_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openrouter_model"]');if(!n&&e.length===0){console.warn("OpenRouter Sync: No OpenRouter model selects found (#aipkit_openrouter_model or chat selects).");return}let i=window.aipkit_dashboard?.recommendedModels?.openrouter||[],s=Array.isArray(i)?i:[],c=o=>{if(!o)return[];let l=g("Recommended","gpt3-ai-content-generator"),_=Array.from(o.querySelectorAll("optgroup")).find(p=>p.label===l||p.label==="Recommended");return _?Array.from(_.querySelectorAll("option")).map(p=>({id:p.value,name:p.textContent.trim()||p.value})).filter(p=>p.id):[]};if(s.length===0){let o=n||e[0];s=c(o)}let t=new Set(s.map(o=>o?.id).filter(Boolean)),d=o=>{let l=o.value;o.innerHTML="";let _=!1,p=!1;if(s.length>0){let k=document.createElement("optgroup");k.label=g("Recommended","gpt3-ai-content-generator"),s.forEach(u=>{if(u&&typeof u=="object"&&u.id){let w=new Option(u.name||u.id,u.id);u.id===l&&(w.selected=!0,_=!0),k.appendChild(w)}}),k.children.length>0&&(o.appendChild(k),p=!0)}if(!r||!r.length){p||o.appendChild(new Option("No models found.",""));return}let f={};if(r.forEach(k=>{if(!k||!k.id||t.has(k.id))return;let u=k.id.split("/"),w=(u.length>1?u[0]:"other").toLowerCase();f[w]||(f[w]=[]),f[w].push(k)}),Object.keys(f).sort().forEach(k=>{let u=document.createElement("optgroup");u.label=k.charAt(0).toUpperCase()+k.slice(1),f[k].sort((w,h)=>(w.name||"").localeCompare(h.name||"")),f[k].forEach(w=>{let h=new Option(w.name||w.id,w.id);w.id===l&&(h.selected=!0,_=!0),u.appendChild(h)}),u.children.length>0&&(o.appendChild(u),p=!0)}),!_&&l&&!o.querySelector(`option[value="${CSS.escape(l)}"]`)){let k=new Option(l+" (manual)",l,!1,!0);o.insertBefore(k,o.firstChild)}if(!_&&o.options.length>0&&o.selectedIndex===-1){let k=-1;for(let u=0;u<o.options.length;u++)if(!o.options[u].disabled&&o.options[u].value){k=u;break}o.selectedIndex=k!==-1?k:0}};n&&d(n),e.forEach(d)}window.aipkit_updateOpenRouterModels=a})();(function(){"use strict";let g=window.wp?.i18n?.__||function(r){return r};function a(r){let n=document.getElementById("aipkit_google_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_google_model"]');if(!n&&e.length===0){console.warn("Google Sync: No Google model selects found (#aipkit_google_model or chat selects).");return}let i=window.aipkit_dashboard?.recommendedModels?.google||[],s=Array.isArray(i)?i:[],c=l=>{if(!l)return[];let _=g("Recommended","gpt3-ai-content-generator"),p=Array.from(l.querySelectorAll("optgroup")).find(f=>f.label===_||f.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(s.length===0){let l=n||e[0];s=c(l)}let t=new Set(s.map(l=>l?.id).filter(Boolean)),d=Array.isArray(r)?r.slice():[];d.sort((l,_)=>(l.name||l.id||"").localeCompare(_.name||_.id||""));let o=l=>{let _=l.value;l.innerHTML="";let p=!1,f=!1,m=s.length>0?document.createElement("optgroup"):null;if(m&&(m.label=g("All models","gpt3-ai-content-generator")),s.length>0){let k=document.createElement("optgroup");k.label=g("Recommended","gpt3-ai-content-generator"),s.forEach(u=>{if(u&&typeof u=="object"&&u.id){let w=new Option(u.name||u.id,u.id);(u.id===_||`models/${u.id}`===_)&&(w.selected=!0,p=!0),k.appendChild(w)}}),k.children.length>0&&(l.appendChild(k),f=!0)}if(!d.length){f||l.appendChild(new Option("No models found.",""));return}if(d.forEach(k=>{let u=k.id||"",w=k.name||u;if(!u||t.has(u))return;let h=new Option(w,u);(u===_||`models/${u}`===_)&&(h.selected=!0,p=!0),m?m.appendChild(h):(l.appendChild(h),f=!0)}),m&&m.children.length>0&&(l.appendChild(m),f=!0),!p&&_){let k=_.startsWith("models/")?_.substring(7):_;if(!l.querySelector(`option[value="${CSS.escape(k)}"]`)){let u=k,w=new Option(u+" (manual)",_,!1,!0);l.insertBefore(w,l.firstChild),l.value=_}}if(l.options.length>0&&l.selectedIndex===-1){let k=-1;for(let u=0;u<l.options.length;u++)if(!l.options[u].disabled&&l.options[u].value){k=u;break}l.selectedIndex=k!==-1?k:0}};n&&o(n),e.forEach(o)}window.aipkit_updateGoogleModels=a})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_azure_deployment"),n=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_azure_deployment"]');if(!r&&n.length===0){console.warn("Azure Sync: No Azure deployment selects found (#aipkit_azure_deployment or chat selects).");return}let e=i=>{let s=i.value;i.innerHTML="";let c=a&&typeof a=="object"&&!Array.isArray(a)&&(a["Chat Models"]||a["Embedding Models"]||a["Image Models"]);if(!a||Array.isArray(a)&&!a.length||c&&Object.keys(a).length===0){if(r.appendChild(new Option("No deployments found.","")),s){let d=new Option(s+" (manual)",s,!1,!0);r.appendChild(d),r.value=s}return}let t=!1;if(c)Object.keys(a).forEach(d=>{let o=a[d];if(o&&Array.isArray(o)&&o.length>0){let l=document.createElement("optgroup");l.label=d,o.sort((_,p)=>(_.id||"").localeCompare(p.id||"")),o.forEach(_=>{let p=_.id||"",f=_.name||p;if(!p)return;let m=p+(f&&f!==p?` (model: ${f})`:""),k=new Option(m,p);p===s&&(k.selected=!0,t=!0),l.appendChild(k)}),i.appendChild(l)}});else{let d=Array.isArray(a)?a:[];d.sort((o,l)=>(o.id||"").localeCompare(l.id||"")),d.forEach(o=>{let l=o.id||"",_=o.name||l;if(!l)return;let p=l+(_&&_!==l?` (model: ${_})`:""),f=new Option(p,l);l===s&&(f.selected=!0,t=!0),i.appendChild(f)})}if(!t&&i.value&&!i.querySelector(`option[value="${CSS.escape(i.value)}"]`)){let d=new Option(i.value+" (not in synced list)",i.value,!1,!0);i.appendChild(d),t=!0}if(!t&&i.options.length>0&&i.selectedIndex===-1){let d=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){d=o;break}i.selectedIndex=d!==-1?d:0}};r&&e(r),n.forEach(e)}window.aipkit_updateAzureDeployments=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(r){return r};function a(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.claude=Array.isArray(r)?r:[]);let n=document.getElementById("aipkit_claude_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_claude_model"]');if(!n&&e.length===0){console.warn("Claude Sync: No Claude model selects found (#aipkit_claude_model or chat selects).");return}let i=window.aipkit_dashboard?.recommendedModels?.claude||[],s=Array.isArray(i)?i:[],c=p=>{if(!p)return[];let f=g("Recommended","gpt3-ai-content-generator"),m=Array.from(p.querySelectorAll("optgroup")).find(k=>k.label===f||k.label==="Recommended");return m?Array.from(m.querySelectorAll("option")).map(k=>({id:k.value,name:k.textContent.trim()||k.value})).filter(k=>k.id):[]};if(s.length===0){let p=n||e[0];s=c(p)}let t=new Set(s.map(p=>p?.id).filter(Boolean)),d=Array.isArray(r)?r.slice():[];d.sort((p,f)=>(p.name||p.id||"").localeCompare(f.name||f.id||""));let o=p=>{let f=p.value;p.innerHTML="";let m=!1,k=!1,u=s.length>0?document.createElement("optgroup"):null;if(u&&(u.label=g("All models","gpt3-ai-content-generator")),s.length>0){let w=document.createElement("optgroup");w.label=g("Recommended","gpt3-ai-content-generator"),s.forEach(h=>{if(!h||typeof h!="object"||!h.id)return;let v=new Option(h.name||h.id,h.id);h.id===f&&(v.selected=!0,m=!0),w.appendChild(v)}),w.children.length>0&&(p.appendChild(w),k=!0)}if(d.forEach(w=>{let h=w?.id||"",v=w?.name||h;if(!h||t.has(h))return;let C=new Option(v,h);h===f&&(C.selected=!0,m=!0),u?u.appendChild(C):(p.appendChild(C),k=!0)}),u&&u.children.length>0&&(p.appendChild(u),k=!0),!k){p.appendChild(new Option("No models found.",""));return}if(!m&&f&&!p.querySelector(`option[value="${CSS.escape(f)}"]`)){let w=new Option(f+" (manual)",f,!1,!0);p.insertBefore(w,p.firstChild),p.value=f}if(p.options.length>0&&p.selectedIndex===-1){let w=-1;for(let h=0;h<p.options.length;h++)if(!p.options[h].disabled&&p.options[h].value){w=h;break}p.selectedIndex=w!==-1?w:0}};n&&o(n),e.forEach(o);let l=document.getElementById("aipkit_content_writer_provider"),_=document.getElementById("aipkit_content_writer_model");l&&_&&l.value==="claude"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(l,_)}window.aipkit_updateClaudeModels=a})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_deepseek_model"),n=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_deepseek_model"]');if(!r&&n.length===0){console.warn("DeepSeek Sync: No DeepSeek model selects found (#aipkit_deepseek_model or chat selects).");return}let e=i=>{let s=i.value;if(i.innerHTML="",!a||!a.length){r.appendChild(new Option("No models found.",""));return}let c=!1;if(a.sort((t,d)=>(t.name||t.id||"").localeCompare(d.name||d.id||"")),a.forEach(t=>{let d=t.id||"",o=t.name||d;if(!d)return;let l=new Option(o,d);d===s&&(l.selected=!0,c=!0),i.appendChild(l)}),!c&&i.value&&!i.querySelector(`option[value="${CSS.escape(i.value)}"]`)){let t=new Option(i.value+" (manual)",i.value,!1,!0);i.insertBefore(t,i.firstChild)}!c&&i.options.length>0&&i.selectedIndex===-1&&(i.selectedIndex=0)};r&&e(r),n.forEach(e)}window.aipkit_updateDeepSeekModels=g})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_ollama_model"),n=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_ollama_model"]');if(!r&&n.length===0){console.warn("Ollama Sync: No Ollama model selects found (#aipkit_ollama_model or chat selects).");return}let e=i=>{let s=i.value;if(i.innerHTML="",!a||!a.length){r.appendChild(new Option("No models found.",""));return}a.sort((t,d)=>(t.name||t.id||"").localeCompare(d.name||d.id||""));let c=!1;if(a.forEach(t=>{let d=t.id||"",o=t.name||d;if(!d)return;let l=new Option(o,d);d===s&&(l.selected=!0,c=!0),i.appendChild(l)}),!c&&i.value&&!i.querySelector(`option[value="${CSS.escape(i.value)}"]`)){let t=new Option(i.value+" (manual)",i.value,!1,!0);i.insertBefore(t,i.firstChild)}i.options.length>0&&i.selectedIndex===-1&&(i.selectedIndex=0)};r&&e(r),n.forEach(e)}window.aipkit_updateOllamaModels=g})();(function(){"use strict";function g(n,e){let i=Array.isArray(e)?e:[],s=JSON.stringify(i),t=`[id^="${n==="models"?"aipkit_elevenlabs_models_json_":"aipkit_elevenlabs_voices_json_"}"]`;document.querySelectorAll(t).forEach(d=>{n==="models"?d.dataset.models=s:d.dataset.voices=s})}function a(n,e="aipkit_elevenlabs_voice_id"){let i=Array.isArray(n)?n:[];g("voices",i);let s=document.getElementById(e);if(!s){console.warn(`ElevenLabs Sync (Voices): Select element #${e} not found.`);return}if(typeof e=="string"&&e.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){window.aipkit_chatTts_updateElevenLabsVoiceSelect(e,i,s.value||"");return}let c=s.value;if(s.innerHTML="",s.appendChild(new Option("-- Select a Voice (Optional) --","")),!i.length){c&&c!==""&&(s.appendChild(new Option(c+" (manual/not synced)",c,!1,!0)),s.value=c);return}let t=!1;if(i.sort((d,o)=>(d.name||d.id||"").localeCompare(o.name||o.id||"")),i.forEach(d=>{let o=d.id||"",l=d.name||o;if(!o)return;let _=new Option(l,o);o===c&&(_.selected=!0,t=!0),s.appendChild(_)}),!t&&c&&c!==""&&!s.querySelector(`option[value="${CSS.escape(c)}"]`)){let d=new Option(c+" (manual/not synced)",c,!1,!0);s.appendChild(d),s.value=c}}function r(n,e="aipkit_elevenlabs_tts_model_id"){let i=Array.isArray(n)?n:[];g("models",i);let s=document.getElementById(e);if(!s){console.warn(`ElevenLabs Sync (Models): Select element #${e} not found.`);return}if(typeof e=="string"&&e.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){window.aipkit_chatTts_updateElevenLabsModelsSelect(e,i,s.value||"");return}let c=s.value;if(s.innerHTML="",s.appendChild(new Option("-- Select a Model (Optional) --","")),!i.length){c&&c!==""&&(s.appendChild(new Option(c+" (manual/not synced)",c,!1,!0)),s.value=c);return}let t=!1;if(i.sort((d,o)=>(d.name||d.id||"").localeCompare(o.name||o.id||"")),i.forEach(d=>{let o=d.id||"",l=d.name||o;if(!o)return;let _=new Option(l,o);o===c&&(_.selected=!0,t=!0),s.appendChild(_)}),!t&&c&&c!==""&&!s.querySelector(`option[value="${CSS.escape(c)}"]`)){let d=new Option(c+" (manual/not synced)",c,!1,!0);s.appendChild(d),s.value=c}}window.aipkit_updateElevenLabsVoices=a,window.aipkit_updateElevenLabsModelsSelect=r})();(function(){"use strict";function g(a,r="aipkit_pinecone_default_index"){let n=document.getElementById(r);if(!n){console.warn(`Pinecone Sync: Select element #${r} not found.`);return}let e=n.value;if(n.innerHTML="",n.appendChild(new Option("-- Select Default Index --","")),!a||!a.length){n.appendChild(new Option("(No indexes found - Sync again)","")),e&&e!==""&&(n.appendChild(new Option(e+" (manual)",e,!1,!0)),n.value=e);return}let i=!1;if(a.sort((s,c)=>(s.name||s.id||"").localeCompare(c.name||c.id||"")),a.forEach(s=>{let c=s.name||s.id||(typeof s=="string"?s:"");if(!c)return;let t=new Option(c,c);c===e&&(t.selected=!0,i=!0),n.appendChild(t)}),!i&&e&&e!==""&&!n.querySelector(`option[value="${CSS.escape(e)}"]`)){let s=new Option(e+" (manual)",e,!1,!0);n.appendChild(s),n.value=e}}window.aipkit_updatePineconeIndexes=g})();(function(){"use strict";function g(a,r="aipkit_qdrant_default_collection"){let n=document.getElementById(r);if(!n){console.warn(`Qdrant Sync: Select element #${r} not found.`);return}let e=n.multiple,i=e?Array.from(n.selectedOptions).map(c=>c.value).filter(Boolean):[n.value];if(n.innerHTML="",e||n.appendChild(new Option("-- Select Collection (Optional) --","")),!a||!a.length){n.appendChild(new Option("(No collections found - Sync again)","")),i.length&&(i.forEach(c=>{c&&n.appendChild(new Option(c+" (manual)",c,!1,!0))}),!e&&i[0]&&(n.value=i[0]));return}let s=new Set;if(a.sort((c,t)=>(c.name||c.id||"").localeCompare(t.name||t.id||"")),a.forEach(c=>{let t=c.name||c.id||"";if(!t)return;let d=i.includes(t),o=new Option(t,t,!1,d);d&&s.add(t),n.appendChild(o)}),i.forEach(c=>{if(c&&!s.has(c)&&!n.querySelector(`option[value="${CSS.escape(c)}"]`)){let t=new Option(c+" (manual)",c,!1,!0);n.appendChild(t)}}),!e&&i[0]&&!n.value&&(n.value=i[0]),typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let c=n.closest(".aipkit_popover_options_list")||n.closest(".aipkit_popover_option_main")||document;window.aipkit_populateQdrantCollectionsMultiSelect(c)}}window.aipkit_updateQdrantCollections=g})();(function(){"use strict";function g(a,r=""){let n=r||"aipkit_replicate_model",e=document.getElementById(n);if(window.aipkit_dashboard&&window.aipkit_dashboard.imageGeneratorModels&&(window.aipkit_dashboard.imageGeneratorModels.replicate=a),window.aipkit_image_generator_config_public&&(window.aipkit_image_generator_config_public.replicate_models=a),!e){r&&console.warn(`Replicate Sync: Select element #${n} not found.`);return}let i=e.value;if(e.innerHTML="",!a||!a.length){e.appendChild(new Option("(No models found - Sync again)","")),i&&i!==""&&(e.appendChild(new Option(i+" (manual/not synced)",i,!1,!0)),e.value=i);return}let s=!1;if(a.sort((c,t)=>(c.name||c.id||"").localeCompare(t.name||t.id||"")),a.forEach(c=>{let t=c.id||"",d=c.name||t;if(!t)return;let o=new Option(d,t);t===i&&(o.selected=!0,s=!0),e.appendChild(o)}),!s&&i&&i!==""&&!e.querySelector(`option[value="${CSS.escape(i)}"]`)){let c=new Option(i+" (manual)",i,!1,!0);e.insertBefore(c,e.firstChild),e.value=i}if(!e.value&&e.options.length>0){let c=-1;for(let t=0;t<e.options.length;t++)if(!e.options[t].disabled&&e.options[t].value){c=t;break}e.selectedIndex=c!==-1?c:0}}window.aipkit_updateReplicateModels=g})();(function(){"use strict";function g(f,m,k={}){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function")return console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing."),null;let u=k&&typeof k=="object"?k:{},w=!!u.silent,h=u.showErrors!==!1,v=!!f,C=(W,R="")=>{let B=Array.isArray(W)?W:[],$=document.getElementById("aipkit_google_tts_voices_json_main");$&&($.dataset.voices=JSON.stringify(B));let G=R||document.querySelector('select[name="tts_google_voice_id"]')?.id||"";if(G&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let L=document.getElementById(G);window.aipkit_updateGoogleVoiceSelect(G,B,L&&L.value||"")}},x={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,GoogleTtsVoices:C,Azure:window.aipkit_updateAzureDeployments,Claude:window.aipkit_updateClaudeModels,DeepSeek:window.aipkit_updateDeepSeekModels,Ollama:window.aipkit_updateOllamaModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof x[m]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${m}.`),alert(`AIPKit Error: Cannot update UI for ${m}.`);return}let b="aipkit_settings_messages",I=v?!!f.closest(".aipkit_popover_options_list"):!1;!w&&!I&&document.getElementById(b)&&(window.aipkit_clearStatusMessages(b),window.aipkit_showSavingIndicator(b,!1));let y=v?f.querySelector(".aipkit_btn-text"):null,q=v?f.getAttribute("data-target-select"):u.targetSelectId||"",E=null;if(I){let R=f.closest(".aipkit_popover_flyout_body")?.closest(".aipkit-modal-content")?.querySelector(".aipkit_popover_flyout_header")||f.closest(".aipkit_popover_context_flyout")?.querySelector(".aipkit_popover_flyout_header")||f.closest(".aipkit_popover_flyout_header");if(R&&(E=R.querySelector(".aipkit_popover_status_inline")),!E){let B=f.closest(".aipkit_model_settings_popover");B&&(E=B.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline.aipkit_model_sync_status"))}if(!E){let B=f.closest(".aipkit_popover_option_row");B&&(E=B.querySelector(".aipkit_popover_status_inline"))}if(!E){let B=f.closest(".aipkit_model_settings_panel");B&&(E=B.querySelector(".aipkit_popover_status_inline.aipkit_model_sync_status"))}}else{let W=v?f.closest(".aipkit_chatbot_model_field"):null,R=v?f.closest(".aipkit_chatbot_builder"):null;R&&R.getAttribute("data-aipkit-chatbot-layout")==="next"&&(E=R.querySelector(".aipkit_builder_card_status .aipkit_model_sync_status")),E||(E=W?W.querySelector(".aipkit_model_sync_status"):null)}if(!E&&m){let W=document.querySelector(`.aipkit_chatbot_model_field[data-provider="${m}"]`);W&&(E=W.querySelector(".aipkit_model_sync_status"))}let S=(W,R,B)=>{if(!E)return;let $=E.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_save_status_container");$&&W&&($.textContent="",$.className="aipkit_save_status_container"),E.textContent=W||"",E.classList.remove("success","error","loading"),R&&E.classList.add(R),B?E.setAttribute("title",B):E.removeAttribute("title"),E.classList.contains("aipkit_popover_status_inline")&&(E.style.display=W?"inline-block":"none")};S("Syncing\u2026","loading");let A=y?y.textContent:m.includes("ElevenLabs")||m.includes("Pinecone")||m.includes("Qdrant")||m.includes("Replicate")?"Sync Items":"Sync Models";y&&(y.textContent="");let T=null;return v&&(T=f.querySelector(".aipkit_spinner"),T||(T=document.createElement("span"),T.className="aipkit_spinner",f.appendChild(T)),T.style.display="inline-block",f.classList.add("aipkit_loading"),f.disabled=!0),(m==="GoogleTtsVoices"?window.aipkit_apiRequest("aipkit_sync_google_tts_voices"):window.aipkit_apiRequest("aipkit_sync_models",{provider:m})).then(W=>{let R=m==="GoogleTtsVoices"?W.voices:W.models;u.skipUpdate||(q?x[m](R,q):x[m](R)),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers(),(m==="PineconeIndexes"||m==="QdrantCollections")&&typeof window.aipkit_refreshTrainingSourcesCount=="function"&&window.aipkit_refreshTrainingSourcesCount(),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():w||console.warn("Model Sync Init: Cannot update autosave baseline.");let B="models";m==="ElevenLabs"||m==="GoogleTtsVoices"?B="voices":m==="ElevenLabsModels"?B="synthesis models":m==="PineconeIndexes"?B="indexes":m==="QdrantCollections"&&(B="collections"),!w&&!I&&document.getElementById(b)&&window.aipkit_showMessage(b,"success",`${m.replace(/Indexes|Collections|Models/,"")} ${B} synced!`),S("Saved","success"),E&&setTimeout(()=>S("",null),2500)}).catch(W=>{let R=W?.message||"Sync failed.";if(h&&!I&&document.getElementById(b)&&window.aipkit_showMessage(b,"error",`Sync failed: ${R}`),console.error(`AIPKit Sync Error (${m}):`,W),S(R,"error",R),E&&setTimeout(()=>S("",null),5e3),u.propagateError)throw W}).finally(()=>{if(v){f.disabled=!1,f.classList.remove("aipkit_loading");let W=f.querySelector(".aipkit_spinner");W&&(W.style.display="none"),y&&(y.textContent=A)}})}function a(f){if(!f)return;let m="data-sync-listener-attached";f.getAttribute(m)||(f.addEventListener("click",function(k){let u=k.target.closest(".aipkit_sync_btn");if(!u||u.disabled)return;k.preventDefault();let w=u.getAttribute("data-provider")||"";if(!w){let h=u.closest(".aipkit_chatbot_model_field");h&&h.getAttribute("data-provider")&&(w=h.getAttribute("data-provider"))}w?g(u,w):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",u)}),f.setAttribute(m,"true"))}function r(){a(document.getElementById("aipkit_module-container")),a(document.getElementById("aipkit_chatbot_main_tab_content_container"))}let n=[],e=!1;function i(f,m){if(!f||typeof f!="object")return"";let k=f[m];return k==null?"":String(k).trim()}function s(f,m,k){return k.some(u=>i(f,u)!==i(m,u))}function c(f){return i(f,"azure_api_key")!==""&&i(f,"azure_endpoint")!==""}function t(f,m){return[{provider:"OpenAI",keys:["openai_api_key"],ready:u=>i(u,"openai_api_key")!==""},{provider:"OpenRouter",keys:["openrouter_api_key"],ready:u=>i(u,"openrouter_api_key")!==""},{provider:"Google",keys:["google_api_key"],ready:u=>i(u,"google_api_key")!==""},{provider:"GoogleTtsVoices",keys:["google_api_key"],ready:u=>i(u,"google_api_key")!==""},{provider:"Azure",keys:["azure_api_key","azure_endpoint"],ready:u=>c(u)},{provider:"Claude",keys:["claude_api_key"],ready:u=>i(u,"claude_api_key")!==""},{provider:"DeepSeek",keys:["deepseek_api_key"],ready:u=>i(u,"deepseek_api_key")!==""},{provider:"ElevenLabs",keys:["elevenlabs_api_key"],ready:u=>i(u,"elevenlabs_api_key")!==""},{provider:"ElevenLabsModels",keys:["elevenlabs_api_key"],ready:u=>i(u,"elevenlabs_api_key")!==""},{provider:"Replicate",keys:["replicate_api_key"],ready:u=>i(u,"replicate_api_key")!==""},{provider:"PineconeIndexes",keys:["pinecone_api_key"],ready:u=>i(u,"pinecone_api_key")!==""},{provider:"QdrantCollections",keys:["qdrant_url","qdrant_api_key"],ready:u=>i(u,"qdrant_url")!==""&&i(u,"qdrant_api_key")!==""}].filter(u=>s(f,m,u.keys)&&u.ready(m)).map(u=>u.provider)}function d(f){return f?document.querySelector(`.aipkit_sync_btn[data-provider="${f}"]`):null}let o=null;function l(){if(e)return;let f=n.shift();if(!f)return;e=!0;let{provider:m,options:k,resolve:u,reject:w}=f,h=d(m),v=g(h,m,k);o={provider:m,promise:v},v&&typeof v.finally=="function"?v.then(C=>{typeof u=="function"&&u(C)}).catch(C=>{typeof w=="function"&&w(C)}).finally(()=>{o=null,e=!1,l()}):(o=null,typeof u=="function"&&u(null),e=!1,l())}function _(f,m={}){if(!f)return null;if(o&&o.provider===f&&o.promise)return o.promise;if(n.some(v=>v.provider===f)){let v=n.find(C=>C.provider===f);return v&&v.promise?v.promise:null}let u,w,h=new Promise((v,C)=>{u=v,w=C});return n.push({provider:f,options:m,resolve:u,reject:w,promise:h}),l(),h}function p(f,m){if(!f||!m)return;t(f,m).forEach(u=>_(u,{silent:!0}))}window.aipkit_initSyncButtons=r,window.aipkit_syncModels=g,window.aipkit_queueProviderSync=_,window.aipkit_queueProviderAutoSync=p})();(function(){"use strict";let g=window.wp?.i18n?.__||function(x){return x},a="#aipkit_settings_container .aipkit_settings-form-row--provider-model select.aipkit_form-input",r=null,n=null,e=!1,i=x=>{if(!x)return"";let b=x.getAttribute("data-aipkit-picker-title");if(b)return b;let I=x.id&&document.querySelector(`label[for="${x.id}"]`)||x.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return I?I.textContent.trim():""},s=x=>{if(!x)return"";let b=x.selectedOptions&&x.selectedOptions.length?x.selectedOptions[0]:x.querySelector("option[selected]");if(b)return b.textContent.trim();let I=x.querySelector("option");return I?I.textContent.trim():""},c=x=>x&&x.id==="aipkit_provider",t=x=>String(x||"").trim().toLowerCase(),d=(x,b)=>{if(!x)return;let I="aipkit_settings_select_picker_icon--";x.classList.forEach(q=>{q.startsWith(I)&&x.classList.remove(q)});let y=t(b);y&&x.classList.add(`${I}${y}`)},o=x=>({buttonId:`${x}_picker_btn`,labelId:`${x}_picker_label`,popoverId:`${x}_picker_popover`,titleId:`${x}_picker_title`,searchId:`${x}_picker_search`,listId:`${x}_picker_list`}),l=x=>{if(!x||!x.id)return null;let b=o(x.id),I=document.getElementById("aipkit_settings_container");if(!I)return null;let y=document.getElementById(b.buttonId),q=c(x)||!!x.closest(".aipkit_settings-form-col--model-select");if(!y){y=document.createElement("button"),y.type="button",y.id=b.buttonId,y.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",y.setAttribute("data-aipkit-popover-target",b.popoverId),y.setAttribute("aria-controls",b.popoverId),y.setAttribute("aria-expanded","false");let S=document.createElement("span");if(S.className="aipkit_settings_select_picker_label",S.id=b.labelId,S.textContent=s(x)||g("Select","gpt3-ai-content-generator"),c(x)){let T=document.createElement("span");T.className="aipkit_settings_select_picker_icon",T.setAttribute("aria-hidden","true"),d(T,x.value),y.classList.add("aipkit_settings_select_picker_btn--provider"),y.appendChild(T)}let A=document.createElement("span");A.className="dashicons dashicons-arrow-down-alt2",A.setAttribute("aria-hidden","true"),y.appendChild(S),y.appendChild(A),x.insertAdjacentElement("beforebegin",y)}if(c(x)){let S=y.querySelector(".aipkit_settings_select_picker_icon")||(()=>{let A=document.createElement("span");return A.className="aipkit_settings_select_picker_icon",A.setAttribute("aria-hidden","true"),y.classList.add("aipkit_settings_select_picker_btn--provider"),y.insertBefore(A,y.firstChild),A})();d(S,x.value)}q&&(y.dataset.aipkitPopoverPlacement="bottom"),x.classList.contains("screen-reader-text")||x.classList.add("screen-reader-text");let E=document.getElementById(b.popoverId);if(!E){let S=c(x);E=document.createElement("div"),E.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",S&&E.classList.add("aipkit_settings_select_picker_popover--provider","aipkit_settings_select_picker_popover--provider-anchor"),E.id=b.popoverId,E.setAttribute("aria-hidden","true");let A=document.createElement("div");A.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",S&&A.classList.add("aipkit_settings_select_picker_popover_panel--provider-anchor"),A.setAttribute("role","dialog"),A.setAttribute("aria-labelledby",b.titleId);let T=document.createElement("div");T.className="aipkit_model_settings_popover_header";let M=document.createElement("span");M.className="aipkit_model_settings_popover_title",M.id=b.titleId,M.textContent=i(x)||g("Select","gpt3-ai-content-generator");let V=document.createElement("button");V.type="button",V.className="aipkit_model_settings_popover_close",V.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),V.innerHTML='<span class="dashicons dashicons-no-alt"></span>',T.appendChild(M),T.appendChild(V);let W=document.createElement("div");W.className="aipkit_model_settings_popover_body";let R=document.createElement("div");R.className="aipkit_settings_select_picker_search";let B=document.createElement("input");B.type="search",B.id=b.searchId,B.className="aipkit_form-input";let $=i(x),G=$?`Search ${$.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");B.setAttribute("placeholder",G),R.appendChild(B);let L=document.createElement("div");L.className="aipkit_settings_select_picker_list",L.id=b.listId,L.setAttribute("role","listbox"),W.appendChild(R),W.appendChild(L),A.appendChild(T),A.appendChild(W),E.appendChild(A),(S&&x.closest(".aipkit_settings-form-col--provider-select")||I).appendChild(E),S&&(R.hidden=!0)}return{ids:b,button:y,popover:E,label:document.getElementById(b.labelId),search:document.getElementById(b.searchId),list:document.getElementById(b.listId)}},_=x=>{let b=[];return x&&Array.from(x.children).forEach(y=>{if(y.tagName==="OPTGROUP"){let q=Array.from(y.children).filter(E=>E.tagName==="OPTION").map(E=>({value:E.value,label:E.textContent.trim(),disabled:E.disabled,selected:E.selected}));b.push({groupLabel:y.label||"",options:q})}else y.tagName==="OPTION"&&b.push({groupLabel:"",options:[{value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}]})}),b},p=(x,b,I="")=>{if(!x||!b)return;let y=I.trim().toLowerCase();b.innerHTML="";let q=_(x),E=!1;if(q.forEach(S=>{let A=S.options.filter(T=>y?T.label.toLowerCase().includes(y):!0);if(A.length){if(S.groupLabel){let T=document.createElement("div");T.className="aipkit_settings_select_picker_group_label",T.textContent=S.groupLabel,b.appendChild(T)}A.forEach(T=>{let M=document.createElement("button");M.type="button",M.className="aipkit_settings_select_picker_item",M.setAttribute("role","option"),M.dataset.value=T.value,M.dataset.label=T.label,T.disabled&&(M.classList.add("is-disabled"),M.setAttribute("aria-disabled","true")),x.value===T.value?(M.classList.add("is-active"),M.setAttribute("aria-selected","true")):M.setAttribute("aria-selected","false");let V=document.createElement("span");V.className="aipkit_settings_select_picker_text",V.textContent=T.label;let W=document.createElement("span");if(W.className="dashicons dashicons-yes aipkit_settings_select_picker_check",c(x)){M.classList.add("aipkit_settings_select_picker_item--provider");let R=document.createElement("span");R.className="aipkit_settings_select_picker_icon",R.setAttribute("aria-hidden","true"),d(R,T.value),M.appendChild(R)}M.appendChild(V),M.appendChild(W),b.appendChild(M),E=!0})}}),!E){let S=document.createElement("div");S.className="aipkit_settings_select_picker_empty",S.textContent=g(y?"No matches found.":"No options available.","gpt3-ai-content-generator"),b.appendChild(S)}},f=(x,b)=>{if(!x||!b)return;let I=s(x);if(b.textContent=I||g("Select","gpt3-ai-content-generator"),c(x)){let y=b.closest("button"),q=y?y.querySelector(".aipkit_settings_select_picker_icon"):null;d(q,x.value)}},m=(x,b)=>{if(!x||!b)return;if(b.closest(".aipkit_settings_select_picker_popover")?.classList.contains("aipkit_settings_select_picker_popover--provider-anchor")){b.style.left="",b.style.top="";return}let I=x.getBoundingClientRect(),y=b.getBoundingClientRect(),q=y.width||320,E=y.height||0,S=window.innerWidth,A=window.innerHeight,T=12;if(x.dataset.aipkitPopoverPlacement==="bottom"){let W=I.left;W+q>S-T&&(W=I.right-q),W=Math.max(T,Math.min(W,S-q-T));let R=I.bottom+8;R+E>A-T&&(R=I.top-E-8),R=Math.max(T,Math.min(R,A-E-T)),b.style.left=`${Math.round(W)}px`,b.style.top=`${Math.round(R)}px`;return}let M=I.right+10;M+q>S-T&&(M=I.left-q-10),M=Math.max(T,Math.min(M,S-q-T));let V=I.top;V+E>A-T&&(V=A-E-T),V=Math.max(T,V),b.style.left=`${Math.round(M)}px`,b.style.top=`${Math.round(V)}px`},k=()=>{!r||!n||e||(e=!0,window.requestAnimationFrame(()=>{let x=r.querySelector(".aipkit_model_settings_popover_panel");m(n,x),e=!1}))},u=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),r=null,n=null)},w=(x,b,I)=>{if(!x||!b)return;r&&r!==b&&u(),r=b,n=x,b.classList.add("aipkit-active"),b.setAttribute("aria-hidden","false"),x.setAttribute("aria-expanded","true");let y=b.querySelector(".aipkit_settings_select_picker_search input"),q=b.querySelector(".aipkit_settings_select_picker_list");q&&p(I,q,y?y.value:""),y&&y.offsetParent!==null&&(y.focus(),y.select());let E=b.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{m(x,E)})},h=(x,b)=>{if(!x||!b)return;let{button:I,popover:y,list:q,search:E}=b;if(I&&I.dataset.pickerListenerAttached!=="true"&&(I.addEventListener("click",S=>{if(S.preventDefault(),r===y){u();return}w(I,y,x)}),I.dataset.pickerListenerAttached="true"),y&&y.dataset.overlayListenerAttached!=="true"){y.addEventListener("click",A=>{A.target===y&&u()});let S=y.querySelector(".aipkit_model_settings_popover_close");S&&S.addEventListener("click",A=>{A.preventDefault(),u()}),y.dataset.overlayListenerAttached="true"}if(q&&q.dataset.pickerListenerAttached!=="true"&&(q.addEventListener("click",S=>{let A=S.target.closest(".aipkit_settings_select_picker_item");if(!A||A.classList.contains("is-disabled"))return;let T=A.dataset.value??"";x.value=T,x.dispatchEvent(new Event("change",{bubbles:!0})),f(x,b.label),p(x,q,E?E.value:""),u()}),q.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("input",()=>{p(x,q,E.value)}),E.dataset.pickerListenerAttached="true"),x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("change",()=>{f(x,b.label),p(x,q,E?E.value:"")}),x.dataset.pickerListenerAttached="true"),x&&x.dataset.pickerObserverAttached!=="true"){let S=!1;new MutationObserver(()=>{S||(S=!0,window.requestAnimationFrame(()=>{f(x,b.label),p(x,q,E?E.value:""),S=!1}))}).observe(x,{childList:!0,subtree:!0}),x.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitSettingsPickerEscapeBound||(document.addEventListener("keydown",S=>{S.key==="Escape"&&r&&u()}),document.body.dataset.aipkitSettingsPickerEscapeBound="true"),document.body.dataset.aipkitSettingsPickerOutsideBound||(document.addEventListener("mousedown",S=>{if(!r||!r.classList.contains("aipkit_settings_select_picker_popover--provider-anchor"))return;let A=S.target;r.contains(A)||n&&n.contains(A)||u()}),document.body.dataset.aipkitSettingsPickerOutsideBound="true"),document.body.dataset.aipkitSettingsPickerRepositionBound||(window.addEventListener("resize",k),window.addEventListener("scroll",k,!0),document.body.dataset.aipkitSettingsPickerRepositionBound="true")};function v(){let x=document.getElementById("aipkit_settings_container");if(!x)return;let b=x.querySelectorAll(a);b.length&&b.forEach(I=>{if(!I.id||I.dataset.aipkitPickerInit==="true")return;let y=l(I);y&&(f(I,y.label),p(I,y.list,y.search?y.search.value:""),h(I,y),I.dataset.aipkitPickerInit="true")})}function C(){let x=document.getElementById("aipkit_settings_container");if(!x)return;x.querySelectorAll(a).forEach(I=>{if(!I.id)return;let y=l(I);y&&(f(I,y.label),p(I,y.list,y.search?y.search.value:""),h(I,y),I.dataset.aipkitPickerInit="true")})}window.aipkit_initSettingsSelectPickers=v,window.aipkit_refreshSettingsSelectPickers=C})();(function(){"use strict";let g=!1,a=window.aipkit_escapeHtml||(k=>k||""),r={},n={},e=120,i="aipkit_content_writer_messages";function s(k,u){if(!k||typeof k!="string")return"";if(k.length<=u)return k;let w=k.substring(0,u-1);return w.substring(0,w.lastIndexOf(" ")).trim()+"\u2026"}function c(k){let u={"":n.use_default_position||"Default",default:n.use_default_position||"Default",replace:n.replace_selection||"Replace",after:n.insert_after||"After",before:n.insert_before||"Before"};return u[k]||u[""]}function t(k){let u=document.createElement("div");u.className="aipkit_assistant_action_card",u.dataset.actionId=k.id,u.dataset.label=k.label,u.dataset.prompt=k.prompt,u.dataset.insertPosition=k.insert_position||"";let w=a(k.prompt),h=s(w,e),v=w.length>e;return u.innerHTML=`
      <div class="aipkit_assistant_action_drag" draggable="true" title="Drag to reorder">
        <span class="dashicons dashicons-move" aria-hidden="true"></span>
      </div>
      <div class="aipkit_assistant_action_content">
        <div class="aipkit_assistant_action_label">${a(k.label)}</div>
        <div class="aipkit_assistant_action_prompt ${v?"":"aipkit_assistant_action_prompt--full"}">${v?h:w}</div>
        ${v?'<button type="button" class="aipkit-enhancer-prompt-toggle" style="background:none;border:none;padding:0;color:#2271b1;font-size:11px;cursor:pointer;text-decoration:underline;">Show more</button>':""}
      </div>
      <div class="aipkit_assistant_action_controls">
        <button type="button" class="aipkit_assistant_action_btn_small aipkit-enhancer-edit-action-btn" aria-label="${a(n.edit_action||"Edit")}">
          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
        </button>
        <button type="button" class="aipkit_assistant_action_btn_small aipkit_assistant_action_btn_small--danger aipkit-enhancer-delete-action-btn" aria-label="${a(n.delete_action||"Delete")}">
          <span class="dashicons dashicons-trash" aria-hidden="true"></span>
        </button>
      </div>
    `,u}function d(k,u=!1){let w=(k.insert_position||"").trim();return`
      <div class="aipkit_assistant_action_edit_form">
        <div class="aipkit_assistant_action_edit_row">
          <div>
            <label class="aipkit_assistant_action_edit_label">${a(n.action_label||"Label")}</label>
            <input type="text" class="aipkit-edit-label" value="${a(k.label)}" placeholder="${a(n.action_label||"Action name")}" maxlength="50">
          </div>
          <div>
            <label class="aipkit_assistant_action_edit_label">${a(n.insert_position||"Position")}</label>
            <select class="aipkit-edit-position">
              <option value="" ${w===""?"selected":""}>${a(n.use_default_position||"Use default")}</option>
              <option value="replace" ${w==="replace"?"selected":""}>${a(n.replace_selection||"Replace selection")}</option>
              <option value="after" ${w==="after"?"selected":""}>${a(n.insert_after||"Insert after")}</option>
              <option value="before" ${w==="before"?"selected":""}>${a(n.insert_before||"Insert before")}</option>
            </select>
          </div>
        </div>
        <div>
          <label class="aipkit_assistant_action_edit_label">${a(n.action_prompt||"Prompt")}</label>
          <textarea class="aipkit-edit-prompt" rows="3" placeholder="${a("Enter prompt. Use %s for selected text.")}">${a(k.prompt)}</textarea>
        </div>
        <div class="aipkit_assistant_action_edit_actions">
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--secondary aipkit-enhancer-cancel-action-btn">
            ${a(n.cancel||"Cancel")}
          </button>
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--primary aipkit-enhancer-save-action-btn">
            ${a(n.save||"Save")}
          </button>
        </div>
      </div>
    `}function o(k){let u={id:k.dataset.actionId,label:k.dataset.label,prompt:k.dataset.prompt,insert_position:k.dataset.insertPosition||""};k.classList.add("aipkit_assistant_action_card--editing"),k.innerHTML=d(u);let w=k.querySelector(".aipkit-edit-prompt");w&&(w.value=u.prompt);let h=k.querySelector(".aipkit-edit-label");h&&(h.focus(),h.select())}function l(k,u){k.dataset.actionId=u.id,k.dataset.label=u.label,k.dataset.prompt=u.prompt,k.dataset.insertPosition=u.insert_position||"",k.classList.remove("aipkit_assistant_action_card--editing");let w=t(u);k.innerHTML=w.innerHTML}function _(k){if(k.querySelectorAll(".aipkit_assistant_action_card").length>=10){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",n.max_actions_reached||"Maximum of 10 actions reached.");return}if(k.querySelector('[data-action-id^="new-"]'))return;let w=document.createElement("div");w.className="aipkit_assistant_action_card aipkit_assistant_action_card--editing",w.dataset.actionId=`new-${Date.now()}`,w.dataset.label="",w.dataset.prompt="",w.dataset.insertPosition="",w.innerHTML=d({id:w.dataset.actionId,label:"",prompt:"",insert_position:""},!0),k.prepend(w);let h=w.querySelector(".aipkit-edit-label");h&&h.focus()}async function p(k){if(g)return;let u=k.querySelector(".aipkit-edit-label"),w=k.querySelector(".aipkit-edit-prompt"),h=k.querySelector(".aipkit-edit-position");if(!u||!w)return;k.querySelectorAll(".aipkit_form-help-error").forEach(q=>q.remove()),u.style.borderColor="",w.style.borderColor="";let v=u.value.trim(),C=w.value.trim(),x=h?h.value:"",b=k.dataset.actionId,I=!1;if(!v){u.style.borderColor="#dc2626";let q=document.createElement("div");q.className="aipkit_form-help aipkit_form-help-error",q.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",q.textContent=n.label_required||"Label is required",u.parentNode.appendChild(q),I=!0}if(!C){w.style.borderColor="#dc2626";let q=document.createElement("div");q.className="aipkit_form-help aipkit_form-help-error",q.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",q.textContent=n.prompt_required||"Prompt is required",w.parentNode.appendChild(q),I=!0}if(I)return;g=!0;let y=k.querySelector(".aipkit-enhancer-save-action-btn");y&&(y.textContent=n.saving_action||"Saving...",y.disabled=!0);try{let q=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:b,label:v,prompt:C,insert_position:x,_ajax_nonce:r.nonce_manage_actions});l(k,q.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"success",n.action_saved||"Action saved successfully")}catch(q){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",`${n.error||"Error"}: ${q.message}`),y&&(y.textContent=n.save||"Save",y.disabled=!1)}finally{g=!1}}async function f(k){let u=k.querySelector("#aipkit_enhancer_actions_list");u.innerHTML=`
      <div class="aipkit_assistant_loading" style="text-align:center;padding:24px;color:#64748b;">
        <span class="dashicons dashicons-update" style="animation:spin 1s linear infinite;"></span>
        <span style="margin-left:8px;">${a(n.loading_actions||"Loading actions...")}</span>
      </div>
    `;try{let w=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions});u.innerHTML="";let h=w.actions||[];h.length===0?u.innerHTML=`
          <div class="aipkit_assistant_empty_state">
            <div class="aipkit_assistant_empty_state_icon">
              <span class="dashicons dashicons-edit-large" aria-hidden="true"></span>
            </div>
            <div class="aipkit_assistant_empty_state_text">
              ${a(n.no_actions||'No actions yet. Click "Add Action" to create one.')}
            </div>
          </div>
        `:h.forEach(v=>{u.appendChild(t(v))})}catch(w){u.innerHTML="",typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",w.message||n.loading_failed||"Failed to load actions.")}}function m(){let k=document.getElementById("aipkit_enhancer_actions_container");if(!k)return;let u=k.closest(".aipkit_assistant_settings_redesigned")||k;if(u.dataset.listenerAttached==="true")return;u.dataset.listenerAttached="true",k.dataset.listenerAttached="true";let w=k.closest(".aipkit_assistant_settings_redesigned")||u;r=window.aipkit_post_enhancer||{},n=r.text||{};let h=k.querySelector("#aipkit_enhancer_actions_list");if(!h)return;let v=w.querySelectorAll(".aipkit_assistant_position_option"),C=()=>{v.forEach(y=>{let q=y.querySelector("input[type=radio]");y.classList.toggle("aipkit_assistant_position_option--active",!!(q&&q.checked))})};C(),v.forEach(y=>{let q=y.querySelector("input[type=radio]");q&&q.addEventListener("change",C)});let x=null,b=null,I=async()=>{if(g)return;let y=Array.from(h.querySelectorAll(".aipkit_assistant_action_card")).map(A=>A.dataset.actionId).filter(A=>A&&!A.startsWith("new-"));if(!y.length)return;let q=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,E=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,S=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;g=!0,q&&q(n.saving_order||"Saving order...");try{await window.aipkit_apiRequest("aipkit_reorder_enhancer_actions",{order:y,_ajax_nonce:r.nonce_manage_actions}),E&&E(n.order_saved||"Order saved.")}catch(A){S?S(`${n.error||"Error"}: ${A.message}`):typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",`${n.error||"Error"}: ${A.message}`)}finally{g=!1}};h.addEventListener("dragstart",y=>{let q=y.target.closest(".aipkit_assistant_action_drag");if(!q)return;let E=q.closest(".aipkit_assistant_action_card");if(!E||E.classList.contains("aipkit_assistant_action_card--editing")){y.preventDefault();return}x=E,E.classList.add("aipkit_dragging");try{y.dataTransfer.effectAllowed="move",y.dataTransfer.setData("text/plain",E.dataset.actionId||"")}catch{}}),h.addEventListener("dragend",async()=>{x&&x.classList.remove("aipkit_dragging"),x=null,b=null,await I()}),h.addEventListener("dragover",y=>{if(!x)return;let q=y.target.closest(".aipkit_assistant_action_card");if(!q||q===x)return;y.preventDefault();let E=q.getBoundingClientRect(),A=y.clientY<E.top+E.height/2?q:q.nextSibling;(b!==q||x.nextSibling!==A)&&(h.insertBefore(x,A),b=q)}),h.addEventListener("drop",async y=>{x&&(y.preventDefault(),await I())}),u.addEventListener("click",async y=>{let q=y.target.closest(".aipkit-enhancer-add-new-btn"),E=y.target.closest(".aipkit-enhancer-reset-actions-btn"),S=y.target.closest(".aipkit-enhancer-edit-action-btn"),A=y.target.closest(".aipkit-enhancer-delete-action-btn"),T=y.target.closest(".aipkit-enhancer-save-action-btn"),M=y.target.closest(".aipkit-enhancer-cancel-action-btn"),V=y.target.closest(".aipkit-enhancer-prompt-toggle");if(q)_(h);else if(E){if(!confirm(n.confirm_reset_actions||"Reset all actions to defaults? This cannot be undone."))return;try{await window.aipkit_apiRequest("aipkit_reset_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions}),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"success",n.actions_reset||"Actions reset to defaults."),f(k)}catch(W){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",`${n.error||"Error"}: ${W.message}`)}}else if(V){let W=V.closest(".aipkit_assistant_action_card"),R=W.querySelector(".aipkit_assistant_action_prompt"),B=W.dataset.prompt;V.textContent.toLowerCase().includes("more")?(R.textContent=a(B),R.classList.add("aipkit_assistant_action_prompt--full"),V.textContent="Show less"):(R.textContent=s(a(B),e),R.classList.remove("aipkit_assistant_action_prompt--full"),V.textContent="Show more")}else if(S)o(S.closest(".aipkit_assistant_action_card"));else if(T)await p(T.closest(".aipkit_assistant_action_card"));else if(M){let W=M.closest(".aipkit_assistant_action_card");W.dataset.actionId.startsWith("new-")?W.remove():l(W,{id:W.dataset.actionId,label:W.dataset.label,prompt:W.dataset.prompt,insert_position:W.dataset.insertPosition})}else if(A){if(g)return;let W=A.closest(".aipkit_assistant_action_card"),R=W.dataset.actionId;if(!confirm(n.confirm_delete_action||"Delete this action? This cannot be undone."))return;g=!0,A.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:R,_ajax_nonce:r.nonce_manage_actions}),W.style.transition="opacity 0.2s, transform 0.2s",W.style.opacity="0",W.style.transform="translateX(-10px)",setTimeout(()=>W.remove(),200),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"success",n.action_deleted||"Action deleted.")}catch(B){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",`${n.error||"Error"}: ${B.message}`),A.disabled=!1}finally{g=!1}}}),u.addEventListener("keydown",y=>{if(y.key==="Enter"&&y.target.matches("input[type=text]")){y.preventDefault();let q=y.target.closest(".aipkit_assistant_action_card--editing");q&&p(q)}}),window.aipkit_enhancer_reload_actions=()=>f(k),f(k)}window.aipkit_initEnhancerActionsUI=m})();(function(){"use strict";let g=[],a=[];function r(i){let s=document.getElementById("aipkit_semantic_search_target_id");if(!s)return;let c=s.value;s.innerHTML='<option value="">-- Select --</option>';let t=[];i==="pinecone"?t=g:i==="qdrant"&&(t=a),Array.isArray(t)&&t.forEach(d=>{let o=d.name||d.id||(typeof d=="string"?d:null);if(o){let l=document.createElement("option");l.value=o,l.textContent=o,s.appendChild(l)}}),s.querySelector(`option[value="${CSS.escape(c)}"]`)&&(s.value=c)}function n(i){let s=document.getElementById("aipkit_semantic_search_embedding_provider");if(!s||!i)return;let c=i.options[i.selectedIndex];c&&c.dataset.provider&&(s.value=c.dataset.provider)}function e(){let i=document.getElementById("aipkit_settings_container");if(!i)return;let s="data-semantic-search-listener-attached";if(i.getAttribute(s))return;let c=document.getElementById("aipkit_semantic_search_vector_provider"),t=document.getElementById("aipkit_pinecone_indexes_json_main"),d=document.getElementById("aipkit_qdrant_collections_json_main"),o=document.getElementById("aipkit_semantic_search_embedding_model");if(c){if(t&&t.dataset.indexes)try{g=JSON.parse(t.dataset.indexes)||[]}catch(l){console.error("Error parsing Pinecone indexes JSON:",l)}if(d&&d.dataset.collections)try{a=JSON.parse(d.dataset.collections)||[]}catch(l){console.error("Error parsing Qdrant collections JSON:",l)}c&&(c.addEventListener("change",l=>{if(r(l.target.value),typeof window.aipkit_handleAutoSave=="function"){let _=document.getElementById("aipkit_semantic_search_target_id");_&&(_.value=""),window.aipkit_handleAutoSave()}}),r(c.value)),o&&(o.addEventListener("change",l=>{n(l.target)}),n(o)),i.setAttribute(s,"true")}}window.aipkit_initSemanticSearchUI=e})();(function(){"use strict";function g(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let n=r.querySelector("#aipkit_provider");if(!n)return;let e=n.value,i=e.toLowerCase(),s=r.querySelectorAll(".aipkit_api_key_field"),c=r.querySelectorAll(".aipkit_model_field"),t=r.querySelectorAll(".aipkit_advanced_settings_provider"),d=r.querySelector("#aipkit_safety_settings_accordion"),o=r.querySelector(".aipkit_openai_store_field"),l=r.querySelectorAll(".aipkit_param_not_openai");s.forEach(m=>m.style.display="none"),c.forEach(m=>m.style.display="none"),t.forEach(m=>m.style.display="none"),d&&(d.style.display="none"),o&&(o.style.display="none"),r.querySelectorAll(`.aipkit_api_key_field[data-provider="${e}"]`).forEach(m=>m.style.display="block"),r.querySelectorAll(`.aipkit_model_field[data-provider="${e}"]`).forEach(m=>m.style.display="block");let f=r.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${e}"]`);f&&(f.style.display="block"),e==="Google"?d&&(d.style.display="block"):e==="OpenAI"&&o&&(o.style.display="block"),e==="OpenAI"||e==="Google"?l.forEach(m=>m.style.display="none"):l.forEach(m=>m.style.display="block"),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function a(){let r=document.getElementById("aipkit_provider");if(r){let n="data-provider-listener-attached";if(r.getAttribute(n)==="true")return;r.addEventListener("change",function(){g(),typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found.")}),r.setAttribute(n,"true"),g()}}window.aipkit_toggleProviderFields=g,window.aipkit_initProviderSelectListener=a})();(function(){"use strict";function g(t){let d=t?t.dataset:{};return{notSet:d.textNotSet||"Not set",notSelected:d.textNotSelected||"Not selected",statusSet:d.textSet||"Set",statusMissing:d.textMissing||"Missing",statusIncomplete:d.textIncomplete||"Incomplete",labelApiKey:d.labelApiKey||"API Key",labelApiKeyEndpoint:d.labelApiKeyEndpoint||"API Key & Endpoint",labelBaseUrl:d.labelBaseUrl||"Base URL"}}function a(t,d){let o=t.querySelector(d);return o?String(o.value||"").trim():""}function r(t,d){return d?t.querySelector(`.aipkit_model_field[data-provider="${d}"] select`):null}function n(t,d){if(!t)return d.notSelected;let o=String(t.value||"").trim();if(!o)return d.notSelected;let l=t.selectedOptions&&t.selectedOptions[0]?t.selectedOptions[0]:null;return(l?String(l.textContent||"").trim():o)||d.notSelected}function e(){let t=document.getElementById("aipkit_settings_container");if(!t)return;let d=t.querySelector("#aipkit_settings_summary_card");if(!d)return;let o=g(d),l=t.querySelector("#aipkit_provider"),_=l?l.value:"",p=l&&l.selectedOptions&&l.selectedOptions[0]?String(l.selectedOptions[0].textContent||"").trim():"",f=d.querySelector('[data-aipkit-summary="provider"]');f&&(f.textContent=p||o.notSet);let m=d.querySelector('[data-aipkit-summary="model"]');if(m){let C=r(t,_);m.textContent=n(C,o)}let k=d.querySelector('[data-aipkit-summary-label="connection"]'),u=d.querySelector('[data-aipkit-summary="connection-status"]'),w=o.labelApiKey,h=o.statusMissing,v="aipkit_status-warning";if(_==="Azure"){w=o.labelApiKeyEndpoint;let C=a(t,"#aipkit_azure_api_key"),x=a(t,"#aipkit_azure_endpoint");C&&x?(h=o.statusSet,v="aipkit_status-success"):h=o.statusIncomplete}else if(_==="Ollama")w=o.labelBaseUrl,a(t,"#aipkit_ollama_base_url")&&(h=o.statusSet,v="aipkit_status-success");else if(_){let x={OpenAI:"#aipkit_openai_api_key",OpenRouter:"#aipkit_openrouter_api_key",Google:"#aipkit_google_api_key",Claude:"#aipkit_claude_api_key",DeepSeek:"#aipkit_deepseek_api_key"}[_];x&&a(t,x)&&(h=o.statusSet,v="aipkit_status-success")}k&&(k.textContent=w),u&&(u.textContent=h,u.classList.remove("aipkit_status-success","aipkit_status-warning","aipkit_status-info"),u.classList.add(v))}function i(){let t=document.getElementById("aipkit_settings_container");if(!t||!t.querySelector("#aipkit_settings_summary_card"))return;let o="data-summary-listener-attached";if(t.getAttribute(o)!=="true"){let l="#aipkit_provider, .aipkit_model_field select, .aipkit_api_key_field input",_=p=>{p.target.matches(l)&&e()};t.addEventListener("change",_),t.addEventListener("input",_),t.setAttribute(o,"true")}e()}function s(){let t=document.getElementById("aipkit_settings_container");if(!t)return;let d=t.querySelector("#aipkit_settings_advanced_popover");if(!d)return;let o=t.querySelectorAll(".aipkit_settings_advanced_btn");if(!o.length)return;let l=d.querySelector(".aipkit_model_settings_popover_panel"),_=d.querySelector(".aipkit_model_settings_popover_close"),p=null,f=!1,m=v=>{if(!l||!v)return;let C=v.getBoundingClientRect(),x=l.getBoundingClientRect(),b=x.width||400,I=x.height||0,y=window.innerWidth,q=window.innerHeight,E=12,S=C.right+10;S+b>y-E&&(S=C.left-b-10),S=Math.max(E,Math.min(S,y-b-E));let A=C.top;A+I>q-E&&(A=q-I-E),A=Math.max(E,A),l.style.left=`${Math.round(S)}px`,l.style.top=`${Math.round(A)}px`},k=()=>{!p||!d.classList.contains("aipkit-active")||f||(f=!0,window.requestAnimationFrame(()=>{m(p),f=!1}))},u=v=>{v&&(p=v,d.classList.add("aipkit-active"),d.setAttribute("aria-hidden","false"),o.forEach(C=>{C.setAttribute("aria-expanded",C===v?"true":"false")}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_advanced_popover"),window.requestAnimationFrame(()=>{m(v)}))},w=()=>{d.classList.remove("aipkit-active"),d.setAttribute("aria-hidden","true"),o.forEach(v=>{v.setAttribute("aria-expanded","false")}),p=null},h=v=>{v&&v.preventDefault();let C=v?v.currentTarget:null;if(d.classList.contains("aipkit-active")&&p===C){w();return}u(C)};o.forEach(v=>{v.dataset.popoverListenerAttached!=="true"&&(v.addEventListener("click",h),v.dataset.popoverListenerAttached="true")}),_&&_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",w),_.dataset.popoverListenerAttached="true"),d.dataset.overlayListenerAttached!=="true"&&(d.addEventListener("click",v=>{v.target===d&&w()}),d.dataset.overlayListenerAttached="true"),d.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",v=>{v.key==="Escape"&&d.classList.contains("aipkit-active")&&w()}),d.dataset.escapeListenerAttached="true"),d.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",k),window.addEventListener("scroll",k,!0),d.dataset.repositionListenersAttached="true")}function c(){typeof window.aipkit_initMessageCloseButtons=="function"?window.aipkit_initMessageCloseButtons("aipkit_settings_messages"):console.error("Settings Init: aipkit_initMessageCloseButtons not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),typeof window.aipkit_initSettingsSelectPickers=="function"?window.aipkit_initSettingsSelectPickers():console.error("Settings Init: aipkit_initSettingsSelectPickers not found."),s(),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(d=>{d.dataset.accordionListenerAttached!=="true"&&(d.addEventListener("click",function(){let o=this.nextElementSibling;if(o){this.classList.toggle("aipkit_active"),o.classList.toggle("aipkit_active");let l=this.closest(".aipkit_accordion");l?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(l.style.display="block")}}),d.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found."),typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found."),i()}window.aipkit_initSettings=c,window.aipkit_updateSettingsSummary=e,window.aipkit_initSettingsSummary=i})();(function(){"use strict";let g=!1;function a(){let r=document.getElementById("aipkit_role_manager_container");if(!r){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let n=r.querySelector("#aipkit_save_roles_btn"),e=r.querySelector("#aipkit_role_manager_form"),i=r.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),i&&(i.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let s=window.aipkit_role_manager_config,c=s.text||{};if(!n||!e||!i){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let t="data-role-save-listener";n.getAttribute(t)||(n.addEventListener("click",function(d){if(d.preventDefault(),g)return;g=!0;let o=n.querySelector(".aipkit_btn-text"),l=n.querySelector(".aipkit_spinner");n.disabled=!0,l&&(l.style.display="inline-block"),o&&(o.textContent=c.saving||"Saving..."),i.innerHTML="",i.className="aipkit_settings_messages";let _=new FormData(e);_.append("action","aipkit_save_role_permissions"),fetch(s.ajaxurl,{method:"POST",body:_,credentials:"same-origin"}).then(p=>p.ok?p.json():p.json().then(f=>{throw new Error(f.data.message||`HTTP error! status: ${p.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${p.status}`)})).then(p=>{if(!p.success){let f=p.data&&p.data.message?p.data.message:"An unknown error occurred.";throw new Error(f)}return p.data}).then(p=>{let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-success",f.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${p.message||c.success||"Permissions saved!"}`,i.appendChild(f),setTimeout(()=>{f.remove()},4e3)}).catch(p=>{console.error("AIPKit Role Manager Save Error:",p);let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-error",f.innerHTML=`<span class="dashicons dashicons-warning"></span> ${p.message||c.fail||"Failed to save permissions."}`,i.appendChild(f),setTimeout(()=>{f.remove()},6e3)}).finally(()=>{g=!1,n.disabled=!1,l&&(l.style.display="none"),o&&(o.textContent=c.saveButton||"Save Permissions")})}),n.setAttribute(t,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&a()}),window.aipkit_initRoleManager=a})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}a.addEventListener("change",function(n){let e=n.target,i=e.closest(".aipkit_chatbot-settings-area");if(!i)return;if(e.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(i),window.aipkit_toggleOpenAISpecificSettingsVisibility(i),window.aipkit_toggleGoogleSpecificSettingsVisibility(i),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(i);return}if(e.matches('select[name$="_model"]')||e.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(i);return}let s=e.closest(".aipkit_stt_provider_select");if(s){let f=s.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f?window.aipkit_toggleSttModelFields(f):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",s);return}let c=e.closest(".aipkit_vector_store_toggle_switch");if(c){let f=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");if(f){window.aipkit_toggleVectorStoreSettingsVisibility(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="vector_store"]');m&&(m.disabled=!c.checked,m.title=c.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let t=e.closest(".aipkit_vector_store_provider_select");if(t){let f=t.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&(window.aipkit_toggleVectorStoreProviderFields(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f));return}let d=e.closest(".aipkit_vector_embedding_provider_select");if(d){let f=d.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_populateVectorEmbeddingModelSelect(f);return}let o=e.closest(".aipkit_openai_web_search_enable_toggle");if(o){let f=o.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleOpenAIWebSearchSubSettings(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');m&&(m.disabled=!o.checked)}return}let l=e.closest(".aipkit_openai_web_search_loc_type_select");if(l){let f=l.closest(".aipkit_chatbot-settings-area");f&&window.aipkit_toggleOpenAIWebSearchLocationDetails(f);return}let _=e.closest(".aipkit_google_search_grounding_enable_toggle");if(_){let f=_.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleGoogleSearchGroundingSubSettings(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');m&&(m.disabled=!_.checked)}return}let p=e.closest(".aipkit_google_grounding_mode_select");if(p){let f=p.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_toggleGoogleGroundingDynamicThreshold(f);return}}),a.querySelectorAll(".aipkit_chatbot-settings-area").forEach(n=>{n.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(n),window.aipkit_toggleOpenAISpecificSettingsVisibility(n),window.aipkit_toggleGoogleSpecificSettingsVisibility(n)),n.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(n),n.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(n),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(n));let e=n.querySelector(".aipkit_openai_web_search_enable_toggle"),i=n.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');i&&e&&(i.disabled=!e.checked,i.title=e.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure");let s=n.querySelector(".aipkit_google_search_grounding_enable_toggle"),c=n.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');c&&s&&(c.disabled=!s.checked,c.title=s.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")})}window.aipkit_initProviderSelectToggles=g})();(function(){"use strict";function g(a){if(!a){console.warn("AIPKit Chat Fields: No settings area provided to toggle model fields.");return}let r=a.querySelector(".aipkit_chatbot_provider_select");if(!r){console.warn("AIPKit Chat Fields: Provider select not found in the given settings area.");return}let n=r.value,e=["OpenAI","Google","Claude","OpenRouter","Azure","Ollama","DeepSeek"];a.querySelectorAll(".aipkit_chatbot_model_field").forEach(c=>{c.style.display="none";let t=c.querySelector(".aipkit_cb_web_search_toggle");t&&(t.style.display="none");let d=c.querySelector(".aipkit_cb_stateful_conv_toggle");d&&(d.style.display="none");let o=c.querySelector(".aipkit_cb_image_upload_toggle");o&&(o.style.display="none");let l=c.querySelector(".aipkit_cb_voice_input_toggle");l&&(l.style.display="none")});let s=a.querySelector(`.aipkit_chatbot_model_field[data-provider="${n}"]`);if(s){s.style.display="block";let c=a.querySelector("#aipkit_chatbot_global_save_status_container");if(c){let p=s.querySelector(".aipkit_model_status_slot");p&&!p.contains(c)&&p.appendChild(c)}a.querySelectorAll(".aipkit_feature_toggle_item").forEach(p=>{let f=(p.dataset.providers||"").trim();if(!f||f==="*"){p.style.display="";return}let m=f.split(/\s+/);p.style.display=m.includes(n)?"":"none"}),typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(a),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(a);let d=s.querySelector(".aipkit_cb_web_search_toggle");d&&(d.dataset.provider||"").split(" ").includes(n)&&(d.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(a));let o=s.querySelector(".aipkit_cb_stateful_conv_toggle");o&&n==="OpenAI"&&(o.style.display="inline-flex");let l=s.querySelector(".aipkit_cb_image_upload_toggle");l&&(n==="OpenAI"||n==="Claude"?(l.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(a)):l.style.display="none");let _=s.querySelector(".aipkit_cb_voice_input_toggle");_&&(_.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(a)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(a)}}window.aipkit_toggleChatbotModelFields=g})();(function(){"use strict";function g(a){a&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(a)}window.aipkit_toggleOpenAISpecificSettingsVisibility=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let n=r?.value==="OpenAI",e=a.querySelector(".aipkit_openai_web_search_enable_toggle");e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let i=a.querySelector(".aipkit_openai_web_search_conditional_settings");if(!e||!i)return;let s=e.tagName==="SELECT"?e.value==="1":e.checked;if(i.style.display=n&&s?"block":"none",n&&s)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(a);else{let c=a.querySelector(".aipkit_openai_web_search_location_details");c&&(c.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector(".aipkit_openai_web_search_enable_toggle");r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let n=a.querySelector(".aipkit_openai_web_search_loc_type_select"),e=a.querySelector(".aipkit_openai_web_search_location_details");if(!n||!e){e&&(e.style.display="none");return}let i=r?r.tagName==="SELECT"?r.value==="1":r.checked:!1,s=(n.value||"")==="approximate";e.style.display=i&&s?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=g})();(function(){"use strict";function g(a){a&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(a)}window.aipkit_toggleGoogleSpecificSettingsVisibility=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let n=r?.value==="Google",e=a.querySelector(".aipkit_google_search_grounding_enable_toggle");e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let i=a.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!e||!i)return;let s=e.tagName==="SELECT"?e.value==="1":e.checked,c=n&&s;i.style.display=c?"block":"none",c?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(a):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(a,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=g})();(function(){"use strict";function g(a,r=null){if(!a)return;let n=a.querySelector(".aipkit_google_grounding_mode_select"),e=a.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),i=a.querySelector(".aipkit_google_search_grounding_enable_toggle");i||(i=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),i||(i=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let s=a.querySelector(".aipkit_google_search_grounding_conditional_settings"),c=s&&s.style.display==="none";if(!n||!e||!i){e&&(e.style.display="none");return}if(c){e.style.display="none";return}let t=r!==null?r:(i.tagName==="SELECT"?i.value==="1":i.checked)&&n.value==="MODE_DYNAMIC";e.style.display=t?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector(".aipkit_stt_provider_select");if(!r)return;let n=r.value;a.querySelectorAll(".aipkit_stt_model_field").forEach(i=>{i.style.display=i.getAttribute("data-stt-provider")===n?"block":"none"})}window.aipkit_toggleSttModelFields=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector(".aipkit_vector_store_toggle_switch");r||(r=a.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let n=a.querySelector(".aipkit_vector_store_settings_conditional_row"),e=a.querySelector(".aipkit_vector_store_top_k_field"),i=a.querySelector(".aipkit_vector_store_confidence_field");if(!r||!n)return;let s=r.tagName==="SELECT"?r.value==="1":r.checked;n.style.display=s?"block":"none",e&&(e.style.display=s?"block":"none"),i&&(i.style.display=s?"block":"none"),s?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(a):a.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_pinecone_key_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_qdrant_url_field, .aipkit_vector_store_qdrant_key_field, .aipkit_vector_store_embedding_config_row").forEach(c=>c.style.display="none")}window.aipkit_toggleVectorStoreSettingsVisibility=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector(".aipkit_vector_store_provider_select"),n=a.querySelector(".aipkit_vector_store_toggle_switch");if(n||(n=a.querySelector(".aipkit_vector_store_enable_select")),n||(n=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select")),!r||!n)return;let e=r.value,i=n.tagName==="SELECT"?n.value==="1":n.checked,s=a.querySelector(".aipkit_vector_store_openai_field"),c=a.querySelector(".aipkit_vector_store_pinecone_field"),t=a.querySelector(".aipkit_vector_store_pinecone_key_field"),d=a.querySelector(".aipkit_vector_store_qdrant_field"),o=a.querySelector(".aipkit_vector_store_qdrant_url_field"),l=a.querySelector(".aipkit_vector_store_qdrant_key_field"),_=a.querySelector(".aipkit_vector_store_embedding_config_row"),p=a.querySelector(".aipkit_vector_store_top_k_field"),f=a.querySelector(".aipkit_vector_store_confidence_field"),m=["openai","pinecone","qdrant"].includes(e);s&&(s.style.display=i&&e==="openai"?"block":"none"),c&&(c.style.display=i&&e==="pinecone"?"block":"none"),t&&(t.style.display=i&&e==="pinecone"?"block":"none"),d&&(d.style.display=i&&e==="qdrant"?"block":"none"),o&&(o.style.display=i&&e==="qdrant"?"block":"none"),l&&(l.style.display=i&&e==="qdrant"?"block":"none"),_&&(_.style.display=i&&(e==="pinecone"||e==="qdrant")?"block":"none"),p&&(p.style.display=i&&m?"block":"none"),f&&(f.style.display=i&&m?"block":"none"),i&&e==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(a):i&&(e==="pinecone"||e==="qdrant")&&(e==="pinecone"&&typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(a),e==="qdrant"&&typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"&&window.aipkit_populateQdrantCollectionsMultiSelect(a),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(a),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(a))}window.aipkit_toggleVectorStoreProviderFields=g})();(function(){"use strict";function g(a){let r=a.querySelector('select[name="openai_vector_store_ids[]"]'),n=window.aipkit_escapeHtml||function(w){return w};if(!r)return;let e=a.querySelector("[data-aipkit-vector-stores-dropdown]"),i=e?e.querySelector(".aipkit_popover_multiselect_btn"):null,s=e?e.querySelector(".aipkit_popover_multiselect_label"):null,c=e?e.querySelector(".aipkit_popover_multiselect_panel"):null,t=e?e.querySelector(".aipkit_popover_multiselect_options"):null,d=e?.dataset.placeholder||"Select stores",o=e?.dataset.selectedLabel||"selected",l=window.aipkit_chat_config?.openaiVectorStores||[],_=Array.from(r.options).filter(w=>w.selected).map(w=>w.value);if(r.innerHTML="",l.length>0){let w=1;l.forEach(h=>{if(h&&h.id){let v="(Files: N/A)";h.file_counts&&typeof h.file_counts.total=="number"?v=`(${h.file_counts.total} ${h.file_counts.total===1?"File":"Files"})`:h.file_counts&&(v="(Files: ?)");let C=h.name||`Untitled store ${w}`,x=`${n(C)} ${v}`,b=document.createElement("option");b.value=h.id,b.textContent=x,_.includes(h.id)&&(b.selected=!0),r.appendChild(b),w+=1}})}let p=1;_.forEach(w=>{if(!l.some(v=>v.id===w)&&!r.querySelector(`option[value="${CSS.escape(w)}"]`)){let v=document.createElement("option");v.value=w,v.textContent=`Manual store ${p} (not synced)`,v.selected=!0,r.appendChild(v),p+=1}}),r.options.length===0&&(r.innerHTML='<option value="" disabled>-- No Stores Found (Sync in AI Training) --</option>');let f=()=>{if(!s)return;let w=Array.from(r.options).filter(v=>v.selected&&v.value);if(!w.length){s.textContent=d;return}let h=w.map(v=>v.textContent.trim()).filter(Boolean);if(h.length<=2){s.textContent=h.join(", ");return}s.textContent=`${h.length} ${o}`},m=()=>{if(!t)return;let w=Array.from(t.querySelectorAll('input[type="checkbox"]:checked'));if(w.length>2){let v=w[w.length-1];v&&(v.checked=!1)}let h=Array.from(t.querySelectorAll('input[type="checkbox"]:checked')).map(v=>v.value);Array.from(r.options).forEach(v=>{v.selected=h.includes(v.value)}),r.dispatchEvent(new Event("change",{bubbles:!0})),f()},k=()=>{if(!t)return;t.innerHTML="";let w=Array.from(r.options),h=w.filter(v=>v.value);if(!h.length){let v=document.createElement("div");v.className="aipkit_popover_multiselect_empty",v.textContent=w[0]?.textContent||"-- No Stores Found --",t.appendChild(v),f();return}h.forEach(v=>{let C=document.createElement("label");C.className="aipkit_popover_multiselect_item";let x=document.createElement("input");x.type="checkbox",x.value=v.value,x.checked=v.selected,x.disabled=v.disabled;let b=document.createElement("span");b.className="aipkit_popover_multiselect_text",b.textContent=v.textContent,C.appendChild(x),C.appendChild(b),t.appendChild(C)}),f()},u=w=>{!e||!i||(e.classList.toggle("is-open",w),i.setAttribute("aria-expanded",w?"true":"false"),c&&(c.hidden=!w))};e&&i&&!e.dataset.listenerAttached&&(i.addEventListener("click",w=>{w.preventDefault(),u(!e.classList.contains("is-open"))}),document.addEventListener("click",w=>{e.classList.contains("is-open")&&(e.contains(w.target)||u(!1))}),i.addEventListener("keydown",w=>{w.key==="Escape"&&u(!1)}),e.dataset.listenerAttached="true"),t&&!t.dataset.listenerAttached&&(t.addEventListener("change",m),t.dataset.listenerAttached="true"),k()}window.aipkit_populateOpenAIVectorStoresMultiSelect=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector('select[name="qdrant_collection_names[]"]');if(!r)return;let n=a.querySelector("[data-aipkit-qdrant-collections-dropdown]"),e=n?n.querySelector(".aipkit_popover_multiselect_btn"):null,i=n?n.querySelector(".aipkit_popover_multiselect_label"):null,s=n?n.querySelector(".aipkit_popover_multiselect_panel"):null,c=n?n.querySelector(".aipkit_popover_multiselect_options"):null;if(!n||!c)return;let t=n.dataset.placeholder||"Select collections",d=n.dataset.selectedLabel||"selected",o=()=>{if(!i)return;let f=Array.from(r.options).filter(k=>k.selected&&k.value);if(!f.length){i.textContent=t;return}let m=f.map(k=>k.textContent.trim()).filter(Boolean);if(m.length<=2){i.textContent=m.join(", ");return}i.textContent=`${m.length} ${d}`},l=()=>{let f=Array.from(c.querySelectorAll('input[type="checkbox"]:checked')).map(m=>m.value);Array.from(r.options).forEach(m=>{m.selected=f.includes(m.value)}),r.dispatchEvent(new Event("change",{bubbles:!0})),o()},_=()=>{c.innerHTML="";let f=Array.from(r.options),m=f.filter(k=>k.value);if(!m.length){let k=document.createElement("div");k.className="aipkit_popover_multiselect_empty",k.textContent=f[0]?.textContent||"-- No Collections Found --",c.appendChild(k),o();return}m.forEach(k=>{let u=document.createElement("label");u.className="aipkit_popover_multiselect_item";let w=document.createElement("input");w.type="checkbox",w.value=k.value,w.checked=k.selected,w.disabled=k.disabled;let h=document.createElement("span");h.className="aipkit_popover_multiselect_text",h.textContent=k.textContent,u.appendChild(w),u.appendChild(h),c.appendChild(u)}),o()},p=f=>{!n||!e||(n.classList.toggle("is-open",f),e.setAttribute("aria-expanded",f?"true":"false"),s&&(s.hidden=!f))};n&&e&&!n.dataset.listenerAttached&&(e.addEventListener("click",f=>{f.preventDefault(),p(!n.classList.contains("is-open"))}),document.addEventListener("click",f=>{n.classList.contains("is-open")&&(n.contains(f.target)||p(!1))}),e.addEventListener("keydown",f=>{f.key==="Escape"&&p(!1)}),n.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",l),c.dataset.listenerAttached="true"),_()}window.aipkit_populateQdrantCollectionsMultiSelect=g})();(function(){"use strict";function g(a){let r=a.querySelector('select[name="pinecone_index_name"]'),n=window.aipkit_escapeHtml||function(s){return s};if(!r)return;let e=window.aipkit_chat_config?.pineconeIndexes||[],i=r.value;if(r.innerHTML="",r.appendChild(new Option(n("-- Select Index --"),"")),e.length>0&&e.forEach(s=>{let c=s.name||s.id||"",t=s.name||c,d=s.total_vector_count!==void 0&&s.total_vector_count!==null&&s.total_vector_count!=="Error"&&s.total_vector_count!=="No Host"?` (Vectors: ${Number(s.total_vector_count).toLocaleString()})`:(s.total_vector_count||"")==="Error"||(s.total_vector_count||"")==="No Host"?" (Stats Err)":" (Vectors: ?)",o=n(t+d),l=new Option(o,c);c===i&&(l.selected=!0),r.appendChild(l)}),i&&!r.querySelector(`option[value="${CSS.escape(i)}"]`)){let s=new Option(n(i)+" (Manual/Not Synced)",i,!1,!0);r.appendChild(s),r.value=i}r.options.length<=1&&(r.innerHTML='<option value="" disabled>-- No Indexes Found (Sync in AI Settings) --</option>')}window.aipkit_populatePineconeIndexSelect=g})();(function(){"use strict";function g(a){let r=a.querySelector('select[name="vector_embedding_provider"]');r&&(r.value===""&&(r.value="openai"),r.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=g})();(function(){"use strict";function g(a){let r=a.querySelector('select[name="vector_embedding_provider"]'),n=a.querySelector('select[name="vector_embedding_model"]'),e=window.aipkit_escapeHtml||function(t){return t};if(!r||!n)return;let i=r.value,s=n.value;n.innerHTML="",n.appendChild(new Option(e("-- Select Model --"),""));let c=[];if(i==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?c=window.aipkit_chat_config.openaiEmbeddingModels:i==="google"&&window.aipkit_chat_config?.googleEmbeddingModels?c=window.aipkit_chat_config.googleEmbeddingModels:i==="azure"&&window.aipkit_chat_config?.azureEmbeddingModels&&(c=window.aipkit_chat_config.azureEmbeddingModels),c.length>0&&c.forEach(t=>{if(t&&t.id){let d=new Option(e(t.name||t.id),t.id);t.id===s&&(d.selected=!0),n.appendChild(d)}}),s&&!n.querySelector(`option[value="${CSS.escape(s)}"]`)){let t=new Option(e(s)+" (Manual/Not Synced)",s,!1,!0);n.appendChild(t),n.value=s}n.options.length<=1&&(n.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector(".aipkit_vector_store_toggle_switch");r||(r=a.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let n=a.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),e=a.querySelector(".aipkit_vector_store_provider_select"),i=a.querySelector(".aipkit_chatbot_provider_select"),s=a.querySelector(".aipkit_file_upload_field_group");if(!r||!n||!s)return;let c=r.tagName==="SELECT"?r.value==="1":r.checked,t=n.dataset.isProPlan==="true",d=e?e.value:"",o=i?i.value:"",l=d==="claude_files",_=o==="Claude";if(l&&!_&&e){let k=Array.from(e.options||[]).find(w=>w&&w.value&&w.value!=="claude_files"),u=k?k.value:"openai";if(e.value!==u){e.value=u,e.dispatchEvent(new Event("change",{bubbles:!0}));return}}let f=t&&c&&(!l||_),m="";t?l&&!_?m='Claude Files requires the chatbot "Provider" to be set to Claude.':c||(m='File upload requires "Enable Vector Store" to be active for this bot.'):m="File upload is a paid feature. Please upgrade.",f?(n.disabled=!1,s.classList.remove("aipkit_dimmed_row"),s.style&&(s.style.opacity=""),s.removeAttribute("title")):(n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change",{bubbles:!0}))),n.disabled=!0,s.classList.add("aipkit_dimmed_row"),s.style&&s.style.opacity&&(s.style.opacity=""),s.setAttribute("title",m))}window.aipkit_toggleFileUploadAvailability=g})();(function(){"use strict";function g(r){if(!r)return;let n=r.querySelector('select[name="theme"]'),e=r.querySelector('input[name="theme"]:checked'),i=()=>n?n.value:e?e.value:"",s=r.querySelector(".aipkit_custom_theme_config_btn, .aipkit_open_custom_theme_modal_btn"),c=i()==="custom";s&&(s.style.display=c?"inline-flex":"none")}function a(){let r=document.querySelector(".aipkit_chatbot_module_container")||document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Theme Toggle: Module container not found.");return}r.dataset.themeSettingsListenerAttached||(r.addEventListener("click",function(n){n.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(n):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),r.addEventListener("change",function(n){let e=n.target;if(e.matches&&e.matches('select[name="theme"]')||e.matches&&e.matches('input[name="theme"]')){let i=e.closest('.aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]')||e.closest(".aipkit_chatbot-settings-area")||r;if(i){g(i);let s=i.querySelector(".aipkit_open_custom_theme_modal_btn");if(s&&e.value==="custom"&&typeof window.aipkit_openChatbotSettingsModalById=="function"){let c=s.getAttribute("data-modal-target");c&&window.aipkit_openChatbotSettingsModalById(c)}}}}),r.dataset.themeSettingsListenerAttached="true"),document.documentElement.dataset.aipkitResetListenerAttached||(document.addEventListener("click",function(n){n.target.closest(".aipkit_chatbot_settings_modal .aipkit_reset_custom_theme_btn")&&typeof window.aipkit_handleResetCustomTheme=="function"&&window.aipkit_handleResetCustomTheme(n)}),document.documentElement.dataset.aipkitResetListenerAttached="true"),r.querySelectorAll('.aipkit_chatbot-settings-area, .aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]').forEach(n=>{g(n)})}window.aipkit_initChatThemeSettingsToggle=a})();(function(){"use strict";function g(a){let r=a.target.closest(".aipkit_reset_custom_theme_btn");if(!r)return;let n=r.dataset.botId,e=document.getElementById("aipkit_chatbot_main_tab_content_container"),i=document.getElementById(`aipkit_bot_${n}_custom_theme_settings_container`)||(e?e.querySelector(`#aipkit_bot_${n}_custom_theme_settings_container`):null),s=document.getElementById(`aipkit_reset_theme_status_${n}`)||(e?e.querySelector(`#aipkit_reset_theme_status_${n}`):null);if(!i||!s){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",n);return}let c=i.dataset.defaults;if(!c){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(s,"error","Error: Defaults not found.",2e3);return}try{let t=JSON.parse(c);i.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(o=>{let _=o.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(_&&_[1]){let p=_[1];if(Object.prototype.hasOwnProperty.call(t,p)){o.type==="checkbox"?o.checked=String(t[p])==="1":o.value=t[p]!==null?String(t[p]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});o.dispatchEvent(f)}else if(Object.prototype.hasOwnProperty.call(t,p+"_placeholder")){o.type==="checkbox"?o.checked=String(t[p+"_placeholder"])==="1":o.value=t[p+"_placeholder"]!==null?String(t[p+"_placeholder"]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});o.dispatchEvent(f)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(s,"success","\u2714 Reverted.",2e3)}catch(t){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",t),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(s,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=g})();(function(){"use strict";function g(c){let t=new Event("input",{bubbles:!0,cancelable:!0}),d=new Event("change",{bubbles:!0,cancelable:!0});c.dispatchEvent(t),c.dispatchEvent(d)}function a(c,t,d){let o=c.querySelector(`input[name="custom_theme_settings[${t}]"], select[name="custom_theme_settings[${t}]"]`);if(o){if(o.type==="checkbox"){let l=d==="1";o.checked!==l&&(o.checked=l,g(o));return}o.value!==d&&(o.value=d,g(o))}}function r(c){let t=c.closest(".aipkit_chatbot_settings_form");if(!t)return;let d=t.querySelector('input[name="theme"][value="custom"]');d&&!d.checked&&(d.checked=!0,g(d))}function n(c){let t=c.closest(".aipkit_custom_theme_settings_container");if(t)return t;let d=c.dataset.botId||c.closest("[data-bot-id]")?.dataset.botId;return d?document.getElementById(`aipkit_bot_${d}_custom_theme_settings_container`):null}function e(c){let t=c.closest(".aipkit_custom_theme_presets");t&&t.querySelectorAll(".aipkit_custom_theme_preset").forEach(d=>{let o=d===c;d.classList.toggle("is-selected",o),d.setAttribute("aria-pressed",o?"true":"false")})}function i(c){let t=c.dataset.primary,d=c.dataset.secondary;if(!t||!d)return;let o=n(c);o&&(r(c),a(o,"primary_color",t),a(o,"secondary_color",d),a(o,"auto_text_contrast","1"),e(c))}function s(){document.documentElement.dataset.aipkitCustomThemePresetsBound||(document.addEventListener("click",c=>{let t=c.target.closest(".aipkit_custom_theme_preset");t&&(c.preventDefault(),i(t))}),document.documentElement.dataset.aipkitCustomThemePresetsBound="1")}window.aipkit_initCustomThemePresets=s})();(function(){"use strict";let g=".aipkit_builder_theme_row_content",a=".aipkit_builder_theme_row",r=".aipkit_theme_scroll_btn",n=".aipkit_theme_scroll_btn--prev",e=".aipkit_theme_scroll_btn--next";function i(_){let p=_.closest(a);return p?{row:p,prev:p.querySelector(n),next:p.querySelector(e)}:null}function s(_){return Math.max(180,Math.round(_.clientWidth*.75))}function c(_){let p=i(_);if(!p||!p.prev||!p.next)return;let f=Math.max(0,_.scrollWidth-_.clientWidth),m=_.scrollLeft<=1,k=_.scrollLeft>=f-1;p.prev.disabled=f===0||m,p.next.disabled=f===0||k}function t(_){let p=_.target.closest(r);if(!p||p.disabled)return;let f=p.closest(a),m=f?f.querySelector(g):null;if(!m)return;let k=p.classList.contains("aipkit_theme_scroll_btn--next")?1:-1;m.scrollBy({left:k*s(m),behavior:"smooth"})}function d(_){let p=_.target;!(p instanceof HTMLElement)||!p.matches(g)||c(p)}function o(){document.querySelectorAll(g).forEach(_=>{c(_)})}function l(_){let p=document.documentElement;p.dataset.aipkitThemeRowScrollBound||(document.addEventListener("click",t),document.addEventListener("scroll",d,!0),window.addEventListener("resize",o),p.dataset.aipkitThemeRowScrollBound="1"),_&&o()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>l(!0)):l(!0),window.aipkit_initThemeRowScroll=function(){l(!0)}})();(function(){"use strict";function g(i){if(!i)return;let s=i.querySelector(".aipkit_chatbot_provider_select");s||(s=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let c=i.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');c||(c=document.querySelector('#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_model_field[data-provider="OpenAI"] select'));let t=i.querySelector(".aipkit_reasoning_effort_field"),d=t?t.querySelector(".aipkit_reasoning_effort_slider"):null,o=t?t.querySelector('input[name="reasoning_effort"]'):null,l=t?t.querySelector(".aipkit_reasoning_effort_label"):null,_=null;if(t?_=t.closest('section[data-section="reasoning"], .aipkit_reasoning_section'):_=i.querySelector(".aipkit_reasoning_section"),!t)return;let p=t.querySelector('select[name="reasoning_effort"]'),f=()=>{t.classList.add("aipkit_hidden"),_&&_.classList.add("aipkit_hidden"),p&&(p.disabled=!0),t.style.opacity="",t.removeAttribute("title")},m=()=>{t.classList.remove("aipkit_hidden"),_&&_.classList.remove("aipkit_hidden"),p&&(p.disabled=!1),t.style.opacity="",t.removeAttribute("title")};if(!s||!c){f();return}let k=(s.value||"").toLowerCase(),w=(c.value||"").toLowerCase(),h=w.startsWith("o1")||w.startsWith("o3")||w.startsWith("o4"),v=w.includes("gpt-5");k==="openai"&&(h||v)?(m(),a(d,o,l,w)):f()}function a(i,s,c,t){if(!i||!s)return;let d=r(t),o=d.allowed,l=o.map(f=>f==="medium"?"med":f);i.dataset.reasoningValues=JSON.stringify(o),i.dataset.reasoningLabels=JSON.stringify(l),i.max=String(Math.max(0,o.length-1));let _=s.value||"";_==="minimal"&&(_="low"),o.includes(_)||(_=d.defaultValue),o.includes(_)||(_=o[0]||""),_&&(s.value=_);let p=Math.max(0,o.indexOf(_));i.value=String(p),c&&(c.textContent=l[p]||l[0]||""),i.dispatchEvent(new Event("input",{bubbles:!0}))}function r(i){return e(i)?{allowed:["high"],defaultValue:"high"}:i.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(i)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(i){let s=i.match(/gpt-5\.(\d+)/);if(s)return Number.parseInt(s[1],10)>=2;let c=i.match(/gpt-(\d+)/);return c?Number.parseInt(c[1],10)>=6:!1}function e(i){return/gpt-5(\.\d+)?-pro/.test(i)}window.aipkit_toggleReasoningEffort=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(b){return b},a="#aipkit_chatbot_builder_bot_select, #aipkit_sources_provider_filter, #aipkit_sources_index_filter, .aipkit_builder_ai_model .aipkit_chatbot_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_model_field select",r=null,n=null,e=!1,i=b=>!!(b&&(b.classList.contains("aipkit_chatbot_provider_select")||b.id==="aipkit_sources_provider_filter")),s=b=>!!(b&&b.id==="aipkit_chatbot_builder_bot_select"),c=b=>String(b||"").trim().toLowerCase(),t=(b,I)=>{if(!b)return;let y="aipkit_settings_select_picker_icon--";b.classList.forEach(E=>{E.startsWith(y)&&b.classList.remove(E)}),b.classList.remove("is-hidden");let q=c(I);if(!q){b.classList.add("is-hidden");return}b.classList.add(`${y}${q}`)},d=b=>{if(!b)return"";let I=b.getAttribute("data-aipkit-picker-title");if(I)return I;let y=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return y?y.textContent.trim():""},o=b=>{if(!b)return"";let I=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(I)return I.textContent.trim();let y=b.querySelector("option");return y?y.textContent.trim():""},l=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),_=b=>{if(!b||!b.id)return null;let I=l(b.id),y=b.closest(".aipkit_chatbot_builder");if(!y)return null;let q=document.getElementById(I.buttonId);if(!q){if(q=document.createElement("button"),q.type="button",q.id=I.buttonId,q.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",q.setAttribute("data-aipkit-popover-target",I.popoverId),q.setAttribute("aria-controls",I.popoverId),q.setAttribute("aria-expanded","false"),q.dataset.aipkitPopoverPlacement="bottom",i(b)){q.classList.add("aipkit_settings_select_picker_btn--provider");let T=document.createElement("span");T.className="aipkit_settings_select_picker_icon",T.setAttribute("aria-hidden","true"),t(T,b.value),q.appendChild(T)}let S=document.createElement("span");S.className="aipkit_settings_select_picker_label",S.id=I.labelId,S.textContent=o(b)||g("Select","gpt3-ai-content-generator");let A=document.createElement("span");A.className="dashicons dashicons-arrow-down-alt2",A.setAttribute("aria-hidden","true"),q.appendChild(S),q.appendChild(A),b.insertAdjacentElement("beforebegin",q)}b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let E=document.getElementById(I.popoverId);if(!E){E=document.createElement("div"),E.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",i(b)&&E.classList.add("aipkit_settings_select_picker_popover--provider"),E.id=I.popoverId,E.setAttribute("aria-hidden","true");let S=document.createElement("div");S.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",S.setAttribute("role","dialog"),S.setAttribute("aria-labelledby",I.titleId);let A=document.createElement("div");A.className="aipkit_model_settings_popover_header";let T=document.createElement("span");T.className="aipkit_model_settings_popover_title",T.id=I.titleId,T.textContent=d(b)||g("Select","gpt3-ai-content-generator");let M=document.createElement("button");M.type="button",M.className="aipkit_model_settings_popover_close",M.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),M.innerHTML='<span class="dashicons dashicons-no-alt"></span>',A.appendChild(T),A.appendChild(M);let V=document.createElement("div");V.className="aipkit_model_settings_popover_body";let W=document.createElement("div");W.className="aipkit_settings_select_picker_search";let R=document.createElement("input");R.type="search",R.id=I.searchId,R.className="aipkit_form-input";let B=d(b),$=B?`Search ${B.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");R.setAttribute("placeholder",$),W.appendChild(R);let G=document.createElement("div");G.className="aipkit_settings_select_picker_list",G.id=I.listId,G.setAttribute("role","listbox"),V.appendChild(W),V.appendChild(G),S.appendChild(A),S.appendChild(V),E.appendChild(S),y.appendChild(E),(i(b)||s(b))&&(W.style.display="none")}return{ids:I,button:q,popover:E,label:document.getElementById(I.labelId),search:document.getElementById(I.searchId),list:document.getElementById(I.listId)}},p=b=>{let I=[];return b&&Array.from(b.children).forEach(q=>{if(q.tagName==="OPTGROUP"){let E=Array.from(q.children).filter(S=>S.tagName==="OPTION").map(S=>({value:S.value,label:S.textContent.trim(),disabled:S.disabled,selected:S.selected}));I.push({groupLabel:q.label||"",options:E})}else q.tagName==="OPTION"&&I.push({groupLabel:"",options:[{value:q.value,label:q.textContent.trim(),disabled:q.disabled,selected:q.selected}]})}),I},f=(b,I,y="")=>{if(!b||!I)return;let q=y.trim().toLowerCase();if(I.innerHTML="",s(b)){let A=Array.from(b.options).map(B=>({value:B.value,label:B.textContent.trim(),disabled:B.disabled,selected:B.selected})),T=B=>B.disabled&&B.value===""&&/^-+$/.test(B.label.replace(/\s+/g,"")),M=A.filter(B=>B.value==="__new__"),V=A.filter(B=>B.value!=="__new__"&&!T(B)),W=q?V.filter(B=>B.label.toLowerCase().includes(q)):V,R=B=>{let $=document.createElement("button");$.type="button",$.className="aipkit_settings_select_picker_item",$.setAttribute("role","option"),$.dataset.value=B.value,$.dataset.label=B.label,B.disabled&&($.classList.add("is-disabled"),$.setAttribute("aria-disabled","true")),b.value===B.value?($.classList.add("is-active"),$.setAttribute("aria-selected","true")):$.setAttribute("aria-selected","false");let G=document.createElement("span");G.className="aipkit_settings_select_picker_text",G.textContent=B.label;let L=document.createElement("span");L.className="dashicons dashicons-yes aipkit_settings_select_picker_check",$.appendChild(G),$.appendChild(L),I.appendChild($)};if(M.forEach(R),W.forEach(R),!M.length&&!W.length){let B=document.createElement("div");B.className="aipkit_settings_select_picker_empty",B.textContent=g(q?"No matches found.":"No options available.","gpt3-ai-content-generator"),I.appendChild(B)}return}let E=p(b),S=!1;if(E.forEach(A=>{let T=A.options.filter(M=>q?M.label.toLowerCase().includes(q):!0);if(T.length){if(A.groupLabel){let M=document.createElement("div");M.className="aipkit_settings_select_picker_group_label",M.textContent=A.groupLabel,I.appendChild(M)}T.forEach(M=>{let V=document.createElement("button");if(V.type="button",V.className="aipkit_settings_select_picker_item",V.setAttribute("role","option"),V.dataset.value=M.value,V.dataset.label=M.label,M.disabled&&(V.classList.add("is-disabled"),V.setAttribute("aria-disabled","true")),b.value===M.value?(V.classList.add("is-active"),V.setAttribute("aria-selected","true")):V.setAttribute("aria-selected","false"),i(b)){V.classList.add("aipkit_settings_select_picker_item--provider");let B=document.createElement("span");B.className="aipkit_settings_select_picker_icon",B.setAttribute("aria-hidden","true"),t(B,M.value),V.appendChild(B)}let W=document.createElement("span");W.className="aipkit_settings_select_picker_text",W.textContent=M.label;let R=document.createElement("span");R.className="dashicons dashicons-yes aipkit_settings_select_picker_check",V.appendChild(W),V.appendChild(R),I.appendChild(V),S=!0})}}),!S){let A=document.createElement("div");A.className="aipkit_settings_select_picker_empty",A.textContent=g(q?"No matches found.":"No options available.","gpt3-ai-content-generator"),I.appendChild(A)}},m=(b,I)=>{if(!b||!I)return;let y=o(b);if(I.textContent=y||g("Select","gpt3-ai-content-generator"),i(b)){let q=I.closest("button"),E=q?q.querySelector(".aipkit_settings_select_picker_icon"):null;t(E,b.value)}},k=(b,I)=>{if(!b||!I)return;let y=b.getBoundingClientRect(),q=I.getBoundingClientRect(),E=q.width||320,S=q.height||0,A=window.innerWidth,T=window.innerHeight,M=12,V=y.left;V+E>A-M&&(V=y.right-E),V=Math.max(M,Math.min(V,A-E-M));let W=y.bottom+8;W+S>T-M&&(W=y.top-S-8),W=Math.max(M,Math.min(W,T-S-M)),I.style.left=`${Math.round(V)}px`,I.style.top=`${Math.round(W)}px`},u=()=>{!r||!n||e||(e=!0,window.requestAnimationFrame(()=>{let b=r.querySelector(".aipkit_model_settings_popover_panel");k(n,b),e=!1}))},w=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),r=null,n=null)},h=(b,I,y)=>{if(!b||!I)return;r&&r!==I&&w(),r=I,n=b,I.classList.add("aipkit-active"),I.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let q=I.querySelector(".aipkit_settings_select_picker_search input"),E=I.querySelector(".aipkit_settings_select_picker_list");E&&f(y,E,q?q.value:""),q&&q.offsetParent!==null&&(q.focus(),q.select());let S=I.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{k(b,S)})},v=(b,I)=>{if(!b||!I)return;let{button:y,popover:q,list:E,search:S}=I;if(y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("click",A=>{if(A.preventDefault(),r===q){w();return}h(y,q,b)}),y.dataset.pickerListenerAttached="true"),q&&q.dataset.overlayListenerAttached!=="true"){q.addEventListener("click",T=>{T.target===q&&w()});let A=q.querySelector(".aipkit_model_settings_popover_close");A&&A.addEventListener("click",T=>{T.preventDefault(),w()}),q.dataset.overlayListenerAttached="true"}if(E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("click",A=>{let T=A.target.closest(".aipkit_settings_select_picker_item");if(!T||T.classList.contains("is-disabled"))return;let M=T.dataset.value??"";b.value=M,b.dispatchEvent(new Event("change",{bubbles:!0})),m(b,I.label),f(b,E,S?S.value:""),w()}),E.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("input",()=>{f(b,E,S.value)}),S.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{m(b,I.label),f(b,E,S?S.value:""),r===q&&w()}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let A=!1;new MutationObserver(()=>{A||(A=!0,window.requestAnimationFrame(()=>{m(b,I.label),f(b,E,S?S.value:""),A=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitChatPickerEscapeBound||(document.addEventListener("keydown",A=>{A.key==="Escape"&&r&&w()}),document.body.dataset.aipkitChatPickerEscapeBound="true"),document.body.dataset.aipkitChatPickerRepositionBound||(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),document.body.dataset.aipkitChatPickerRepositionBound="true")};function C(){let b=document.querySelector(".aipkit_chatbot_builder");if(!b)return;let I=b.querySelectorAll(a);I.length&&I.forEach(y=>{if(!y.id||y.dataset.aipkitPickerInit==="true")return;let q=_(y);q&&(m(y,q.label),f(y,q.list,q.search?q.search.value:""),v(y,q),y.dataset.aipkitPickerInit="true")})}function x(){let b=document.querySelector(".aipkit_chatbot_builder");if(!b)return;b.querySelectorAll(a).forEach(y=>{if(!y.id)return;let q=_(y);q&&(m(y,q.label),f(y,q.list,q.search?q.search.value:""),v(y,q),y.dataset.aipkitPickerInit="true")})}window.aipkit_initChatSelectPickers=C,window.aipkit_refreshChatSelectPickers=x})();(function(){"use strict";let g={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"};function a(n){let e=g[n];if(!e)return!0;let i=window.aipkit_dashboard?.providerStatus?.[e];return typeof i>"u"?!0:!!i}function r(n,e={}){return n?typeof window.aipkit_queueProviderSync!="function"?(console.warn("AIPKit Chatbot Sync: aipkit_queueProviderSync is not available."),!1):a(n)?(window.aipkit_queueProviderSync(n,e),!0):!1:!1}window.aipkit_requestChatbotModelSync=r})();(function(){"use strict";function g(r,n,e){let i=document.getElementById(r);if(!i)return;if(i.innerHTML="",!n||n.length===0){i.appendChild(new Option("(No voices found - Sync again)",""));return}i.appendChild(new Option("-- Select Voice --",""));let s={};n.forEach(t=>{let d=t.languageCodes[0]||"und";s[d]||(s[d]=[]),s[d].push(t)}),Object.keys(s).sort().forEach(t=>{let d=document.createElement("optgroup");try{let o=new Intl.DisplayNames(["en"],{type:"language"}).of(t.split("-")[0]);d.label=`${o} (${t})`}catch{d.label=t}s[t].sort((o,l)=>o.name.localeCompare(l.name)),s[t].forEach(o=>{let l=new Option(o.name,o.id);o.id===e&&(l.selected=!0),d.appendChild(l)}),i.appendChild(d)}),e&&!i.value&&(Array.from(i.options).some(d=>d.value===e)?i.value=e:console.warn(`AIPKit TTS: Saved Google voice ID "${e}" not found in synced list for ${r}.`))}function a(r){let n=r.getAttribute("data-target-select"),e=r.querySelector(".aipkit_spinner"),i=r.closest(".aipkit_popover_audio_flyout"),s=i?i.querySelector(".aipkit_tts_sync_status"):null;if(!s){let o=r.closest(".aipkit_popover_option_row");s=o?o.querySelector(".aipkit_tts_sync_status"):null}if(!s){let o=r.closest(".aipkit_form-group");s=o?o.querySelector(".aipkit_form-help"):null}if(!n){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(s||console.error("AIPKit TTS Sync (Google): Could not find message container for button:",r),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}let c=s&&s.classList.contains("aipkit_popover_status_inline"),t=(o,l)=>{!s||!c||(s.textContent=o||"",s.classList.remove("success","error","loading"),l&&s.classList.add(l),s.style.display=o?"inline-block":"none")};if(r.disabled=!0,r.classList.add("aipkit_loading"),e&&(e.style.display="inline-block"),s){let o=s.dataset.baseClass||s.className||"aipkit_form-help";s.dataset.baseClass||(s.dataset.baseClass=o),s.textContent="",s.className=o,s.style.display=o.includes("aipkit_popover_status_inline")?"none":""}c&&t("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(o=>{if(o&&o.voices){let l=document.getElementById(n),_=l?l.value:"";g(n,o.voices,_);let p=document.getElementById("aipkit_google_tts_voices_json_main");p&&(p.dataset.voices=JSON.stringify(o.voices)),s&&(c?t(o.message||"Sync successful!","success"):window.aipkit_showTemporaryMessage(s,"success",o.message||"Sync successful!"))}else throw new Error("Invalid response received from voice sync.")}).catch(o=>{console.error("AIPKit TTS Sync Error (Google):",o),s&&(c?t(`Sync failed: ${o.message||"Unknown error"}`,"error"):window.aipkit_showTemporaryMessage(s,"error",`Sync failed: ${o.message||"Unknown error"}`))}).finally(()=>{r.disabled=!1,r.classList.remove("aipkit_loading"),e&&(e.style.display="none")})}window.aipkit_updateGoogleVoiceSelect=g,window.aipkit_handleSyncGoogleVoices=a})();(function(){"use strict";function g(r,n,e){let i=document.getElementById(r);if(!i){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${r} not found.`);return}if(i.innerHTML="",!n||n.length===0){if(i.appendChild(new Option("(No voices found - Sync voices to load)","")),e){let c=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(c),i.value=e}return}i.appendChild(new Option("-- Select Voice --","")),n.sort((c,t)=>(c.name||c.id||"").localeCompare(t.name||t.id||""));let s=!1;if(n.forEach(c=>{let t=new Option(c.name,c.id);c.id===e&&(t.selected=!0,s=!0),i.appendChild(t)}),e&&!s){let c=!1;for(let t=0;t<i.options.length;t++)if(i.options[t].value===e){c=!0,i.value=e;break}if(!c){let t=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(t),i.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${e}" not found in synced list for #${r}, added as manual.`)}}else!e&&i.options.length>0&&(i.value="")}function a(r,n,e){let i=document.getElementById(r);if(!i){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${r} not found.`);return}if(i.innerHTML="",!n||n.length===0){if(i.appendChild(new Option("(No models found - Sync models to load)","")),e){let c=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(c),i.value=e}return}i.appendChild(new Option("-- Select Model --","")),n.sort((c,t)=>(c.name||c.id||"").localeCompare(t.name||t.id||""));let s=!1;if(n.forEach(c=>{let t=c.id||"",d=c.name||t;if(!t)return;let o=new Option(d,t);t===e&&(o.selected=!0,s=!0),i.appendChild(o)}),e&&!s){let c=!1;for(let t=0;t<i.options.length;t++)if(i.options[t].value===e){c=!0,i.value=e;break}if(!c){let t=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(t),i.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${e}" not found in synced list for #${r}, added as manual.`)}}else!e&&i.options.length>0&&(i.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=g,window.aipkit_chatTts_updateElevenLabsModelsSelect=a})();(function(){"use strict";function g(n,e){let i=n.querySelector(".aipkit_tts_conditional_settings"),s=n.querySelector(".aipkit_tts_auto_play_container");i&&(i.style.display=e?"block":"none"),s&&(s.style.display=e?"block":"none")}function a(n){let e=n.querySelector(".aipkit_tts_provider_select");if(!e)return;let i=e.value;n.querySelectorAll(".aipkit_tts_provider_settings").forEach(c=>{if(c.getAttribute("data-provider")===i){if(c.style.display="block",i==="OpenAI"){let t=c.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');t&&(t.style.display="block")}}else c.style.display="none"})}function r(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit TTS Settings: Main content container not found.");return}let e=typeof window.aipkit_updateGoogleVoiceSelect=="function",i=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",s=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",c=typeof window.aipkit_handleSyncGoogleVoices=="function";e||console.error("AIPKit TTS Settings: Google voice update function missing."),i||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),s||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),c||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),n.addEventListener("change",function(d){let o=d.target.closest(".aipkit_tts_toggle_switch"),l=d.target.closest(".aipkit_tts_provider_select");if(o){let _=o.closest(".aipkit_accordion-content");_&&(g(_,o.checked),o.checked&&a(_))}else if(l){let _=l.closest(".aipkit_accordion-content");_&&a(_)}}),n.addEventListener("click",function(d){let o=d.target.closest(".aipkit_sync_tts_voices_btn");o&&o.getAttribute("data-provider")==="Google"&&c&&window.aipkit_handleSyncGoogleVoices(o)}),n.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(d=>{let o=d.querySelector(".aipkit_tts_toggle_switch");o&&(g(d,o.checked),o.checked&&a(d));let l=d.querySelector('select[name="tts_google_voice_id"]');l&&!e&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),l&&l.options.length<=1&&(l.innerHTML='<option value="">(Sync voices to load)</option>');let _=d.querySelector('select[name="tts_elevenlabs_voice_id"]');if(_&&i){let m="";if(_&&_.id){let w=_.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);w&&w[1]&&(m=w[1])}let k=m?document.getElementById(`aipkit_elevenlabs_voices_json_${m}`):null,u=k?k.dataset.voices:null;try{let w=u?JSON.parse(u):[],h=_.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(_.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",w),_.options.length<=1&&(_.innerHTML='<option value="">(Sync voices to load)</option>')}}else _&&_.options.length<=1&&(_.innerHTML='<option value="">(Sync voices to load)</option>');let p=d.querySelector('select[name="tts_elevenlabs_model_id"]');if(p&&s){let m="";if(p&&p.id){let w=p.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);w&&w[1]&&(m=w[1])}let k=m?document.getElementById(`aipkit_elevenlabs_models_json_${m}`):null,u=k?k.dataset.models:null;try{let w=u?JSON.parse(u):[],h=p.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(p.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",w),p.options.length<=1&&(p.innerHTML='<option value="">(Sync models to load)</option>')}}else p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync models to load)</option>');let f=d.querySelector('select[name="tts_openai_model_id"]');f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync models to load)</option>')})}window.aipkit_initTtsSettingsUI=r})();(function(){"use strict";function g(){let a=document.getElementById("chatbot-create-new-content");if(!a)return;let r=a.querySelector("#aipkit_create_new_bot_btn"),n=a.querySelector("#aipkit_new_bot_name"),e=a.querySelector("#aipkit_create_bot_message");if(!r||!n||!e)return;let i=r.querySelector(".aipkit_spinner");r.addEventListener("click",function(){let s=n.value.trim();if(!s){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Please enter a name for the chatbot."):(e.textContent="Please enter a name for the chatbot.",e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),n.focus();return}r.disabled=!0,i&&(i.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(r,"Creating..."):r.textContent="Creating...",e.textContent="",e.className="aipkit_form-help",aipkit_apiRequest("aipkit_create_chatbot",{bot_name:s}).then(c=>{let t=c.message||"Chatbot created!";typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"success",t):(e.textContent=t,e.style.color="green",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),n.value="";let d=c.bot_id;if(!d){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Creation succeeded but failed to get bot ID. Please reload."):(e.textContent="Creation succeeded but failed to get bot ID. Please reload.",e.style.color="red");return}aipkit_loadModule("chatbot",{force_active_bot_id:d},function(o){if(o){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Bot created, but UI failed to refresh. Please reload."):(e.textContent="Bot created, but UI failed to refresh. Please reload.",e.style.color="red");return}if(typeof window.aipkit_requestChatbotModelSync=="function"){let l=document.querySelector(".aipkit_chatbot_provider_select"),_=l&&l.value||"";_&&window.aipkit_requestChatbotModelSync(_,{silent:!0})}setTimeout(()=>{typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(d)},50)})}).catch(c=>{let t="Error: "+(c.message||"Unknown error during creation.");typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error",t):(e.textContent=t,e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3))}).finally(()=>{r.disabled=!1,i&&(i.style.display="none"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(r,"Start Creating"):(r.textContent="Start Creating",i&&r.appendChild(i))})})}window.aipkit_initCreateNewBot=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}a.addEventListener("submit",function(r){let n=r.target.closest(".aipkit_chatbot_settings_form");if(!n)return;r.preventDefault();let e=n.getAttribute("data-bot-id"),i=n.querySelector(".aipkit_save_bot_settings_btn");i||(i=document.getElementById("aipkit_chatbot_header_save_btn"));let s=document.getElementById("aipkit_chatbot_global_save_status_container"),c=n.querySelector(`#aipkit_action_feedback_${e}`);if(!e||!i||!s){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",n),s||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}c&&(c.innerHTML=""),s.textContent="",s.className="aipkit_save_status_container",i.disabled=!0,i.classList.add("aipkit_loading");let t=i.querySelector(".aipkit_spinner");t||(t=document.createElement("span"),t.className="aipkit_spinner",i.appendChild(t)),t.style.display="inline-block";let d=new FormData(n),o={};for(let[_,p]of d.entries())if(_.endsWith("[]")){let f=_.slice(0,-2);o[f]=d.getAll(_)}else o.hasOwnProperty(_)||(o[_]=p);o.bot_id=e,function(){let p=document.getElementById(`aipkit_bot_${e}_custom_theme_settings_container`);if(!p)return;p.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["], textarea[name^="custom_theme_settings["]').forEach(m=>{let k=m.getAttribute("name");if(!k)return;let u=!0;(m.type==="checkbox"||m.type==="radio")&&(u=m.checked),u?o[k]=m.value:m.type==="checkbox"&&(o[k]="0")})}(),function(){let p=document.getElementById(`aipkit_bot_${e}_ai_params_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p;["temperature","max_completion_tokens","reasoning_effort"].forEach(k=>{let u=f.querySelector(`[name="${k}"]`);u&&(o[k]=u.value)})}(),function(){let p=document.getElementById(`aipkit_bot_${e}_web_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=k=>f.querySelector(`[name="${k}"]`);["openai_web_search_context_size","openai_web_search_loc_type","openai_web_search_loc_country","openai_web_search_loc_city","openai_web_search_loc_region","openai_web_search_loc_timezone"].forEach(k=>{let u=m(k);u&&(o[k]=u.value)}),["google_grounding_mode","google_grounding_dynamic_threshold"].forEach(k=>{let u=m(k);u&&(o[k]=u.value)}),["claude_web_search_max_uses","claude_web_search_loc_type","claude_web_search_loc_country","claude_web_search_loc_city","claude_web_search_loc_region","claude_web_search_loc_timezone","claude_web_search_allowed_domains","claude_web_search_blocked_domains","claude_web_search_cache_ttl"].forEach(k=>{let u=m(k);u&&(o[k]=u.value)})}(),function(){let p=document.getElementById(`aipkit_bot_${e}_vector_store_modal`);if(!p)return;let f=C=>p.querySelector(C),m=p.querySelector(".aipkit_modal_body")||p,k=m.querySelector('input[name="enable_vector_store"]');k&&(o.enable_vector_store=k.checked?"1":"0");let u=f('select[name="vector_store_provider"]');if(u&&(o.vector_store_provider=u.value),o.vector_store_provider==="openai"){let C=f('select[name="openai_vector_store_ids[]"]');C?o.openai_vector_store_ids=Array.from(C.selectedOptions).map(x=>x.value):o.openai_vector_store_ids=[]}else delete o.openai_vector_store_ids;if(o.vector_store_provider==="pinecone"){let C=f('select[name="pinecone_index_name"]');C&&(o.pinecone_index_name=C.value)}else delete o.pinecone_index_name;if(o.vector_store_provider==="qdrant"){let C=f('select[name="qdrant_collection_names[]"]');if(C){let x=Array.from(C.selectedOptions).map(b=>b.value);o.qdrant_collection_names=x,o.qdrant_collection_name=x[0]||""}else o.qdrant_collection_names=[],o.qdrant_collection_name=""}else delete o.qdrant_collection_names,delete o.qdrant_collection_name;if(o.vector_store_provider==="pinecone"||o.vector_store_provider==="qdrant"){let C=f('select[name="vector_embedding_provider"]'),x=f('select[name="vector_embedding_model"]');C&&(o.vector_embedding_provider=C.value),x&&(o.vector_embedding_model=x.value)}else delete o.vector_embedding_provider,delete o.vector_embedding_model;let w=f('input[name="vector_store_top_k"]');w&&(o.vector_store_top_k=w.value);let h=f('input[name="vector_store_confidence_threshold"]');h&&(o.vector_store_confidence_threshold=h.value);let v=m.querySelector('input[name="content_aware_enabled"]');v&&(o.content_aware_enabled=v.checked?"1":"0")}(),function(){let p=document.getElementById(`aipkit_bot_${e}_conversations_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=f.querySelector('input[name="stream_enabled"]');m&&(o.stream_enabled=m.checked?"1":"0");let k=f.querySelector('input[name="openai_conversation_state_enabled"]');k&&(o.openai_conversation_state_enabled=k.checked?"1":"0");let u=f.querySelector('input[name="max_messages"]');u&&(o.max_messages=u.value);let w=f.querySelector('select[name="reasoning_effort"]');w&&(o.reasoning_effort=w.value)}(),function(){let p=document.getElementById(`aipkit_bot_${e}_images_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=f.querySelector('select[name="chat_image_model_id"]'),k=f.querySelector('input[name="image_triggers"]');m&&(o.chat_image_model_id=m.value),k&&(o.image_triggers=k.value);let u=f.querySelector('input[name="enable_image_upload"]');u&&(o.enable_image_upload=u.checked?"1":"0")}(),function(){let p=document.getElementById(`aipkit_bot_${e}_audio_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=w=>f.querySelector(`[name="${w}"]`);function k(w){let h=m(w);h&&(o[w]=h.checked?"1":"0")}function u(w){let h=m(w);h&&(o[w]=h.value)}k("enable_voice_input"),u("stt_provider"),u("stt_openai_model_id"),k("tts_enabled"),u("tts_provider"),u("tts_google_voice_id"),u("tts_openai_voice_id"),u("tts_openai_model_id"),u("tts_elevenlabs_voice_id"),u("tts_elevenlabs_model_id"),k("tts_auto_play"),k("enable_realtime_voice"),k("direct_voice_mode"),k("input_audio_noise_reduction"),u("realtime_model"),u("realtime_voice"),u("turn_detection"),u("input_audio_format"),u("output_audio_format"),u("speed")}(),function(){let p=document.getElementById(`aipkit_bot_${e}_token_mgmt_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,m=f.querySelector('input[name="token_guest_limit"]'),k=f.querySelector('input[name="token_user_limit"]'),u=f.querySelector('select[name="token_limit_mode"]'),w=f.querySelector('select[name="token_reset_period"]'),h=f.querySelector('input[name="token_limit_message"]');m&&(o.token_guest_limit=m.value),k&&(o.token_user_limit=k.value),u&&(o.token_limit_mode=u.value),w&&(o.token_reset_period=w.value),h&&(o.token_limit_message=h.value),f.querySelectorAll('input[name^="token_role_limits["]').forEach(C=>{let x=C.getAttribute("name");x&&(o[x]=C.value)})}(),function(){let p=document.getElementById("aipkit_starters_flyout");if(!p)return;let f=p.querySelector('textarea[name="conversation_starters"]');f&&(o.conversation_starters=f.value)}(),function(){let p=document.getElementById(`aipkit_bot_${e}_popup_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p;function m(ne){return f.querySelector(`[name="${ne}"]`)}function k(ne){return f.querySelector(`[name="${ne}"]:checked`)}function u(ne,ae){typeof ae<"u"&&ae!==null&&(o[ne]=ae)}let w=m("popup_position");w&&u("popup_position",w.value);let h=m("popup_delay");h&&u("popup_delay",h.value);let v=m("site_wide_enabled");v&&u("site_wide_enabled",v.checked?"1":"0");let C=m("popup_icon_style");if(C)u("popup_icon_style",C.value);else{let ne=k("popup_icon_style");ne&&u("popup_icon_style",ne.value)}let x=m("popup_icon_size");x&&u("popup_icon_size",x.value);let b=m("popup_icon_type");if(b)u("popup_icon_type",b.value);else{let ne=k("popup_icon_type");ne&&u("popup_icon_type",ne.value)}let I=k("popup_icon_default");I&&u("popup_icon_default",I.value);let y=m("popup_icon_custom_url");y&&u("popup_icon_custom_url",y.value);let q=m("header_avatar_type");if(q)u("header_avatar_type",q.value);else{let ne=k("header_avatar_type");ne&&u("header_avatar_type",ne.value)}let E=k("header_avatar_default");E&&u("header_avatar_default",E.value);let S=m("header_avatar_url");S&&u("header_avatar_url",S.value);let A=m("header_online_text");A&&u("header_online_text",A.value);let T=m("popup_label_enabled");T&&u("popup_label_enabled",T.checked?"1":"0");let M=m("popup_label_text");M&&u("popup_label_text",M.value);let V=m("popup_label_mode");V&&u("popup_label_mode",V.value);let W=m("popup_label_size");W&&u("popup_label_size",W.value);let R=m("popup_label_delay_seconds");R&&u("popup_label_delay_seconds",R.value);let B=m("popup_label_auto_hide_seconds");B&&u("popup_label_auto_hide_seconds",B.value);let $=m("popup_label_dismissible");$&&u("popup_label_dismissible",$.checked?"1":"0");let G=m("popup_label_show_on_desktop");G&&u("popup_label_show_on_desktop",G.checked?"1":"0");let L=m("popup_label_show_on_mobile");L&&u("popup_label_show_on_mobile",L.checked?"1":"0");let K=m("popup_label_frequency");K&&u("popup_label_frequency",K.value);let H=m("popup_label_version");H&&u("popup_label_version",H.value)}();let l=o.provider;if(l==="OpenAI")o.model=o.openai_model;else if(l==="OpenRouter")o.model=o.openrouter_model;else if(l==="Google")o.model=o.google_model;else if(l==="Azure")o.model=o.azure_deployment;else if(l==="Claude")o.model=o.claude_model;else if(l==="DeepSeek")o.model=o.deepseek_model;else if(l==="Ollama"){let _=n.querySelector('select[name="ollama_model"]'),p=typeof o.ollama_model<"u"?o.ollama_model:_?_.value:"";o.model=p||""}else o.model="";delete o.openai_model,delete o.openrouter_model,delete o.google_model,delete o.azure_deployment,delete o.claude_model,delete o.deepseek_model,delete o.ollama_model,function(){let p=document.getElementById(`aipkit_bot_${e}_vector_store_modal`),f=k=>p?p.querySelector(k):null,m=k=>n.querySelector(k);if(o.vector_store_provider==="openai"){let k=f('select[name="openai_vector_store_ids[]"]')||m('select[name="openai_vector_store_ids[]"]');k?o.openai_vector_store_ids=Array.from(k.selectedOptions).map(u=>u.value):o.openai_vector_store_ids=[]}else o.hasOwnProperty("openai_vector_store_ids")&&delete o.openai_vector_store_ids;if(o.vector_store_provider==="pinecone"||o.vector_store_provider==="qdrant"){if(o.vector_store_provider==="qdrant"){let w=f('select[name="qdrant_collection_names[]"]')||m('select[name="qdrant_collection_names[]"]');if(w){let h=Array.from(w.selectedOptions).map(v=>v.value);o.qdrant_collection_names=h,o.qdrant_collection_name=h[0]||""}else o.qdrant_collection_names=[],o.qdrant_collection_name=""}else if(o.vector_store_provider==="pinecone"){let w=f('select[name="pinecone_index_name"]')||m('select[name="pinecone_index_name"]');w&&(o.pinecone_index_name=w.value)}let k=f('select[name="vector_embedding_provider"]')||m('select[name="vector_embedding_provider"]');k&&(o.vector_embedding_provider=k.value);let u=f('select[name="vector_embedding_model"]')||m('select[name="vector_embedding_model"]');u&&(o.vector_embedding_model=u.value)}else delete o.pinecone_index_name,delete o.qdrant_collection_name,delete o.qdrant_collection_names,delete o.vector_embedding_provider,delete o.vector_embedding_model}(),aipkit_apiRequest("aipkit_save_chatbot_settings",o).then(_=>{s.textContent=_.message||"Settings Saved!",s.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(e)}).catch(_=>{s.textContent="Error: "+_.message,s.classList.add("error")}).finally(()=>{i.disabled=!1,i.classList.remove("aipkit_loading");let _=i.querySelector(".aipkit_spinner");if(_&&(_.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(i,"Save");else{let p=Array.from(i.childNodes).find(f=>f.nodeType===Node.TEXT_NODE);p?p.textContent="Save":i.insertBefore(document.createTextNode("Save"),i.firstChild),_&&i.appendChild(_)}setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=g})();(function(){"use strict";function g(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");n||console.warn("AIPKit Chat Deleter: Main content container not found."),n&&n.querySelectorAll(".aipkit_delete_bot_btn").forEach(i=>{i.getAttribute("data-is-default")==="1"&&(i.disabled=!0)}),n&&n.addEventListener("click",function(i){let s=i.target.closest(".aipkit_delete_bot_btn");if(!s||s.disabled)return;let c=s.getAttribute("data-bot-id"),t=s.getAttribute("data-bot-name"),d=s.closest(".aipkit_chatbot_settings_form"),l=document.getElementById("aipkit_header_action_feedback")||(d?d.querySelector(`#aipkit_action_feedback_${c}`):null),_=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!l){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",s);return}let p=`aipkit_delete_confirmation_${c}`,f=l.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_delete_confirmation",f.style.display="none",l.insertBefore(f,l.firstChild));let m=`aipkit_action_status_${c}`,k=l.querySelector(`#${m}`);if(k||(k=document.createElement("div"),k.id=m,k.className="aipkit_action_status_message",l.appendChild(k)),f.style.display!=="none"&&f.innerHTML!=="")return;_&&(_.textContent="",_.className="aipkit_save_status_container");let u=l.querySelector(".aipkit_reset_confirmation");u&&(u.style.display="none"),k.textContent="",k.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let w=f.querySelector(".aipkit_delete_confirm_btn"),h=f.querySelector(".aipkit_delete_cancel_btn"),v=()=>{f.innerHTML="",f.style.display="none",a(s,c,k,_)},C=()=>{f.innerHTML="",f.style.display="none"};w.addEventListener("click",v,{once:!0}),h.addEventListener("click",C,{once:!0})});let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(i){let s=i.target.closest(".aipkit_header_delete_btn");if(!s)return;let c=s.closest(".aipkit_tab_dropdown_menu");c&&(c.style.display="none");let t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),d=t?.dataset?.botId,o=t?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",_=document.getElementById("aipkit_header_action_feedback")||(t?t.querySelector(`#aipkit_action_feedback_${d}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!d||!_)return;if(o){_.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{_.innerHTML=""},3e3);return}let f=`aipkit_delete_confirmation_${d}`,m=_.querySelector(`#${f}`);m||(m=document.createElement("div"),m.id=f,m.className="aipkit_confirmation_message aipkit_delete_confirmation",m.style.display="none",_.insertBefore(m,_.firstChild));let k=`aipkit_action_status_${d}`,u=_.querySelector(`#${k}`);u||(u=document.createElement("div"),u.id=k,u.className="aipkit_action_status_message",_.appendChild(u)),p&&(p.textContent="",p.className="aipkit_save_status_container");let w=_.querySelector(".aipkit_reset_confirmation");w&&(w.style.display="none"),u.textContent="",u.className="aipkit_action_status_message",m.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
          </div>`,m.style.display="block";let h=m.querySelector(".aipkit_delete_confirm_btn"),v=m.querySelector(".aipkit_delete_cancel_btn");h?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none",a(s,d,u,p)},{once:!0}),v?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none"},{once:!0})})}function a(n,e,i,s){let c=n.querySelector(".aipkit_spinner"),t=document.getElementById("aipkit_chatbot_main_selector_container");s&&(s.textContent="",s.className="aipkit_save_status_container"),i.textContent="",i.className="aipkit_action_status_message",n.disabled=!0,n.classList.add("aipkit_loading"),c&&(c.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(n,"Deleting..."):n.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:e}).then(d=>{i.textContent=d.message||"Chatbot deleted successfully.",i.classList.add("success");let o=!1;if(t){let _=t.querySelector(`.aipkit_tab_button[data-bot-id="${e}"]`),p=t.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${e}"]`);if(_)o=_.classList.contains("aipkit_active"),_.remove();else if(p){o=p.classList.contains("aipkit_active"),p.remove();let f=t.querySelector(".aipkit_tab_dropdown_menu");if(f&&f.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let k=f.closest(".aipkit_tab_dropdown_container");k&&k.remove()}}}let l=document.getElementById(`chatbot-${e}-content`);if(l&&l.remove(),setTimeout(()=>{let _=document.getElementById(`aipkit_action_status_${e}`);_&&(_.textContent="",_.className="aipkit_action_status_message")},4e3),o){let _=t?.querySelector(".aipkit_tab_button_default");if(_)_.click();else{let p=t?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(p)p.click();else{let f=t?.querySelector(".aipkit_tab_dropdown_item");if(f)f.click();else{let m=t?.querySelector(".aipkit_create-new-button");if(m)m.click();else{let k=document.getElementById("aipkit_admin_chat_preview_container");k&&(k.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(d=>{i.textContent="Error: "+(d.message||"Failed to delete chatbot."),i.classList.add("error"),n.disabled=!1,n.classList.remove("aipkit_loading"),c&&(c.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(n,"Delete"),setTimeout(()=>{i&&(i.textContent="",i.className="aipkit_action_status_message")},5e3)})}function r(n){if(!n)return"";let e=document.createElement("div");return e.textContent=n,e.innerHTML}window.aipkit_initDeleteBot=g})();(function(){"use strict";function g(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");n||console.warn("AIPKit Chat Resetter: Main content container not found."),n&&n.addEventListener("click",function(i){let s=i.target.closest(".aipkit_reset_bot_btn");if(!s||s.disabled)return;let c=s.getAttribute("data-bot-id"),t=s.getAttribute("data-bot-name"),d=s.closest(".aipkit_chatbot_settings_form"),l=document.getElementById("aipkit_header_action_feedback")||(d?d.querySelector(`#aipkit_action_feedback_${c}`):null),_=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!l){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",s);return}let p=`aipkit_reset_confirmation_${c}`,f=l.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",l.insertBefore(f,l.firstChild));let m=`aipkit_action_status_${c}`,k=l.querySelector(`#${m}`);if(k||(k=document.createElement("div"),k.id=m,k.className="aipkit_action_status_message",l.appendChild(k)),f.style.display!=="none"&&f.innerHTML!=="")return;_&&(_.textContent="",_.className="aipkit_save_status_container");let u=l.querySelector(".aipkit_delete_confirmation");u&&(u.style.display="none"),k.textContent="",k.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let w=f.querySelector(".aipkit_reset_confirm_btn"),h=f.querySelector(".aipkit_reset_cancel_btn"),v=()=>{f.innerHTML="",f.style.display="none",a(s,c,k,_)},C=()=>{f.innerHTML="",f.style.display="none"};w.addEventListener("click",v,{once:!0}),h.addEventListener("click",C,{once:!0})});let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(i){let s=i.target.closest(".aipkit_header_reset_btn");if(!s)return;let c=s.closest(".aipkit_tab_dropdown_menu");c&&(c.style.display="none");let t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),d=t?.dataset?.botId,l=document.getElementById("aipkit_header_action_feedback")||(t?t.querySelector(`#aipkit_action_feedback_${d}`):null),_=document.getElementById("aipkit_chatbot_global_save_status_container");if(!d||!l)return;let p=`aipkit_reset_confirmation_${d}`,f=l.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",l.insertBefore(f,l.firstChild));let m=`aipkit_action_status_${d}`,k=l.querySelector(`#${m}`);k||(k=document.createElement("div"),k.id=m,k.className="aipkit_action_status_message",l.appendChild(k)),_&&(_.textContent="",_.className="aipkit_save_status_container");let u=l.querySelector(".aipkit_delete_confirmation");u&&(u.style.display="none"),k.textContent="",k.className="aipkit_action_status_message",f.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Reset</button>
          </div>`,f.style.display="block";let w=f.querySelector(".aipkit_reset_confirm_btn"),h=f.querySelector(".aipkit_reset_cancel_btn");w?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none",a(s,d,k,_)},{once:!0}),h?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none"},{once:!0})})}function a(n,e,i,s){let c=n.querySelector(".aipkit_spinner");s&&(s.textContent="",s.className="aipkit_save_status_container"),i.textContent="",i.className="aipkit_action_status_message",n.disabled=!0,n.classList.add("aipkit_loading"),c&&(c.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(n,"Resetting..."):n.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:e}).then(t=>{i.textContent=t.message||"Chatbot reset successfully!",i.classList.add("success"),aipkit_loadModule("chatbot",{force_active_bot_id:e},function(d){d&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",d),i.textContent="Reset OK, but UI refresh failed. Reload page.",i.classList.add("error"))}),setTimeout(()=>{let d=document.getElementById(`aipkit_action_status_${e}`);d&&(d.textContent="",d.className="aipkit_action_status_message")},4e3)}).catch(t=>{i.textContent="Error: "+(t.message||"Failed to reset chatbot."),i.classList.add("error"),n.disabled=!1,n.classList.remove("aipkit_loading"),c&&(c.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(n,"Reset"),setTimeout(()=>{i&&(i.textContent="",i.className="aipkit_action_status_message")},5e3)})}function r(n){if(!n)return"";let e=document.createElement("div");return e.textContent=n,e.innerHTML}window.aipkit_initResetBot=g})();(function(){"use strict";function g(n,e=5,i=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(n)}catch(s){console.error("AIPKit Chat Preview: Error during chat initialization.",s),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else e>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${i}ms... (${e} retries left)`),setTimeout(()=>{g(n,e-1,i)},i)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function a(){let n=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),e=document.getElementById("aipkit_admin_chat_preview_container"),i=document.querySelector(".aipkit_chatbot-preview-column"),s=window.aipkit_dashboard?.text||{};if(!e||!i){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(e.innerHTML="",i.classList.remove("aipkit_loading"),n){let c=n.getAttribute("data-tab-type"),t=n.getAttribute("data-bot-id");c==="bot"&&t?r(t):c==="create"?e.innerHTML=`<p class="aipkit_preview_placeholder">${s.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:c==="settings"?e.innerHTML=`<p class="aipkit_preview_placeholder">${s.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${s.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?e.innerHTML=`<p class="aipkit_preview_placeholder">${s.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${s.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function r(n){let e=document.getElementById("aipkit_admin_chat_preview_container"),i=document.querySelector(".aipkit_chatbot-preview-column");if(!e||!i){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}i.classList.add("aipkit_loading"),e.innerHTML="";let s=new URL(window.aipkit_dashboard.ajaxurl);s.searchParams.append("action","aipkit_get_chatbot_shortcode"),s.searchParams.append("bot_id",n),s.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(s).then(c=>c.json()).then(c=>{if(c.success&&c.data&&c.data.html){e.innerHTML=c.data.html;let t=e.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");if(t){e.classList.toggle("aipkit-preview-inline",t.classList.contains("aipkit_chat_container")),e.classList.toggle("aipkit-preview-popup",t.classList.contains("aipkit_popup_wrapper"));let o=window.getComputedStyle(t).getPropertyValue("--aipkit-chat-container-border-radius").trim();o&&o!=="initial"&&o!=="inherit"&&o!=="unset"?e.style.setProperty("--aipkit-chat-container-border-radius",o):e.style.removeProperty("--aipkit-chat-container-border-radius"),g(t)}else console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${n} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,c.data.html),e.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>'}else{let t=c.data&&c.data.message?c.data.message:"Invalid response received for shortcode preview.";throw new Error(t)}}).catch(c=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${n}:`,c),e.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${c.message}</p>`}).finally(()=>{i.classList.remove("aipkit_loading")})}window.aipkit_loadInitialChatPreview=a,window.aipkit_refreshChatPreview=r})();(function(){"use strict";function g(){let s=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!s)return;let c=function(t){let d=t.target.closest(".aipkit_popup_toggle_switch");if(d){let m=d.closest(".aipkit_chatbot-settings-area");if(m){a(m,d.checked),n(m,d);let k=m.querySelector(".aipkit_popup_config_btn_placeholder");k&&(k.disabled=!d.checked,k.title=d.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let o=t.target.closest('select[name="popup_icon_type"]');if(o){let m=o.closest(".aipkit_chatbot-settings-area");m&&r(m,o.value);return}let l=t.target.closest('input[name="popup_icon_type"]');if(l){let m=l.closest(".aipkit_chatbot-settings-area");m&&r(m,l.value);return}let _=t.target.closest(".aipkit_popup_hint_toggle_switch");if(_){let m=_.closest(".aipkit_chatbot-settings-area");m&&i(m,_.checked);return}let p=t.target.closest(".aipkit_starters_toggle_switch");if(p){let m=p.closest(".aipkit_chatbot-settings-area");if(m){let k=m.querySelector(".aipkit_starters_config_btn");k&&(k.disabled=!p.checked,k.title=p.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let f=t.target.closest(".aipkit_voice_input_toggle_switch");if(f){let m=f.closest(".aipkit_chatbot-settings-area");m&&e(m,f.checked);return}};s.addEventListener("change",c),s.querySelectorAll(".aipkit_chatbot-settings-area").forEach(t=>{let d=t.querySelector(".aipkit_popup_toggle_switch");if(d){a(t,d.checked),n(t,d);let m=t.querySelector(".aipkit_popup_config_btn_placeholder");m&&(m.disabled=!d.checked,m.title=d.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}let o=t.querySelector('select[name="popup_icon_type"]');if(o)r(t,o.value);else{let m=t.querySelector('input[name="popup_icon_type"]:checked');m?r(t,m.value):t.querySelector('input[name="popup_icon_type"][value="default"]')&&r(t,"default")}let l=t.querySelector(".aipkit_voice_input_toggle_switch");l&&e(t,l.checked);let _=t.querySelector(".aipkit_popup_hint_toggle_switch");_&&i(t,_.checked);let p=t.querySelector(".aipkit_starters_toggle_switch"),f=t.querySelector(".aipkit_starters_config_btn");if(f){let m=p?p.checked:!1;f.disabled=!m,f.title=m?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}})}function a(s,c){let t=s.querySelector(".aipkit_popup_settings_accordion");if(t&&(t.style.display=c?"block":"none",!c)){let o=t.querySelector(".aipkit_accordion-header"),l=t.querySelector(".aipkit_accordion-content");o&&o.classList.remove("aipkit_active"),l&&l.classList.remove("aipkit_active")}let d=s.querySelector(".aipkit_popup_icon_options_container");d&&(d.style.display=c?"block":"none")}function r(s,c){let t=s.querySelector(".aipkit_popup_icon_default_selector_container"),d=s.querySelector(".aipkit_popup_icon_custom_input_container");t&&(t.style.display=c==="default"?"block":"none"),d&&(d.style.display=c==="custom"?"block":"none")}function n(s,c){let t=c.checked,d=c.getAttribute("data-sidebar-target"),o=s.querySelector("#"+d);if(!o)return;let l=o.querySelector(".aipkit_sidebar_toggle_switch"),_=o.querySelector("label");if(!l||!_)return;let p=o.getAttribute("data-tooltip-disabled")||"";t?(l.getAttribute("data-original-state")===null&&l.setAttribute("data-original-state",l.checked?"checked":"unchecked"),l.checked=!1,l.disabled=!0,o.setAttribute("title",p),o.classList.add("aipkit-disabled-tooltip"),_.style.opacity="0.6"):(l.disabled=!1,o.removeAttribute("title"),o.classList.remove("aipkit-disabled-tooltip"),_.style.opacity="1",l.getAttribute("data-original-state")==="checked"&&(l.checked=!0),l.removeAttribute("data-original-state"))}function e(s,c){let t=s.querySelector(".aipkit_stt_provider_conditional_row");t&&(t.style.display=c?"block":"none")}function i(s,c){let t=s.querySelector(".aipkit_popup_hint_conditional_row");t&&(t.style.display=c?"block":"none");let d=s.querySelectorAll(".aipkit_popup_hint_extra");d&&d.length&&d.forEach(o=>{o.style.display=c?"":"none"})}window.aipkit_initAppearanceToggles=g,window.aipkit_togglePopupDependentSettingsVisibility=a,window.aipkit_toggleSidebarCheckboxState=n,window.aipkit_togglePopupIconValueInputs=r,window.aipkit_toggleSttSettingsVisibility=e,window.aipkit_togglePopupHintSettingsVisibility=i})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");a&&(a.addEventListener("change",function(r){let n=r.target.closest(".aipkit_starters_toggle_switch");if(!n)return;let e=n.closest(".aipkit_chatbot-settings-area");if(!e)return;let i=e.querySelector(".aipkit_starters_conditional_row");i&&(i.style.display=n.checked?"block":"none")}),a.querySelectorAll(".aipkit_chatbot-settings-area").forEach(r=>{let n=r.querySelector(".aipkit_starters_toggle_switch"),e=r.querySelector(".aipkit_starters_conditional_row");n&&e&&(e.style.display=n.checked?"block":"none")}))}window.aipkit_initConversationStartersToggle=g})();(function(){"use strict";let g="aipkit_last_selected_chatbot",a=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now();function r(e){let i=document.getElementById("aipkit_admin_chat_preview_container");if(!i)return;i.classList.remove("aipkit-preview-inline","aipkit-preview-popup");let s=document.createElement("p");s.className="aipkit_preview_placeholder",s.textContent=e,i.innerHTML="",i.appendChild(s)}function n(){let e=document.querySelector(".aipkit_chatbot_builder");if(!e||e.dataset.aipkitContext==="sources")return;let i=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:F=>F,s=window.wp&&window.wp.i18n&&window.wp.i18n._n?window.wp.i18n._n:(F,N,P)=>P===1?F:N,c=e.getAttribute("data-aipkit-chatbot-layout")||"next",t=e.dataset.openaiApiKeySet==="true",d=e.dataset.pineconeApiKeySet==="true",o=e.dataset.qdrantApiKeySet==="true",l=e.dataset.qdrantUrlSet==="true",_=e.dataset.googleApiKeySet==="true",p=e.dataset.azureApiKeySet==="true",f=e.dataset.claudeApiKeySet==="true",m=e.querySelector("#aipkit_chatbot_builder_bot_select"),k=e.getAttribute("data-active-bot-id")||m&&m.value||"";if(k)try{localStorage.setItem(g,k)}catch{}let u=document.getElementById("aipkit_builder_new_bot_modal"),w=e.querySelector(".aipkit_builder_new_bot_btn"),h=null,v=u?u.querySelector(".aipkit_builder_new_bot_close"):null,C=document.getElementById("aipkit_builder_sheet"),x=C?C.querySelector(".aipkit_builder_sheet_panel"):null,b=document.getElementById("aipkit_model_settings_popover"),I=b?b.querySelector(".aipkit_model_settings_popover_panel"):null,y=b?b.querySelector(".aipkit_model_settings_popover_close"):null,q=b?b.querySelector(".aipkit_model_settings_popover_title"):null,E=b?b.querySelector(".aipkit_model_settings_popover_back"):null,S=b?b.querySelector(".aipkit_model_settings_popover_footer"):null,A=null,T=document.getElementById("aipkit_deploy_settings_popover"),M=T?T.querySelector(".aipkit_deploy_settings_popover_panel"):null,V=T?T.querySelector(".aipkit_deploy_settings_popover_close"):null,W=null,R="root",B=C?C.querySelector(".aipkit_builder_sheet_title"):null,$=C?C.querySelector(".aipkit_builder_sheet_description"):null,G=C?C.querySelector(".aipkit_builder_sheet_body"):null,L=C?C.querySelectorAll(".aipkit_builder_sheet_section"):[],K=C?C.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'):null,H=C?C.querySelector(".aipkit_builder_sheet_close"):null,ne=e.querySelector(".aipkit_builder_rename_btn"),ae=document.getElementById("aipkit_builder_rename_bot_modal"),Z=ae?ae.querySelector(".aipkit_builder_rename_bot_close"):null,pe=ae?ae.querySelector("#aipkit_rename_bot_name"):null,ve=ae?ae.querySelector("#aipkit_rename_bot_btn"):null,De=ae?ae.querySelector("#aipkit_rename_bot_message"):null,Qe=e.querySelector(".aipkit_bot_name_input"),$e=e.querySelector('textarea[name="instructions"]'),lt=e.querySelector(".aipkit_builder_instructions_expand"),it=document.getElementById("aipkit_builder_instructions_modal"),we=it?it.querySelector(".aipkit_builder_instructions_close"):null,at=it?it.querySelector(".aipkit_builder_instructions_modal_textarea"):null,Zt=it?it.querySelector(".aipkit_builder_instructions_count"):null,$t=e.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),li=e.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),ai=e.querySelector(".aipkit_training_text_input"),se=e.querySelector("#aipkit_training_qa_question"),ke=e.querySelector("#aipkit_training_qa_answer"),_e=e.querySelector("#aipkit_training_files_input"),Ce=e.querySelector(".aipkit_training_files_button"),Pe=e.querySelector(".aipkit_builder_dropzone"),be=e.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),Oe=e.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),Re=e.querySelector(".aipkit_training_stop_btn"),_t=e.querySelector(".aipkit_builder_card--training .aipkit_builder_action_row"),Wt=e.querySelector("#aipkit_training_status"),ri=e.querySelector("#aipkit_training_file_list"),Ht=new Map,ht=null,Be={page:1,selectedIds:new Set},qe=e.querySelector(".aipkit_training_sources_btn"),gt=e.querySelector("#aipkit_vs_wp_content_messages_area"),Pt=e.querySelector("#aipkit_vs_wp_content_mode"),qt=e.querySelector("#aipkit_vs_load_wp_content_btn"),We=e.querySelector("#aipkit_vs_global_target_select"),xi=e.querySelector("#aipkit_vs_wp_content_status"),Li=e.querySelector("#aipkit_vs_wp_content_status_specific"),Ft=e.querySelector("#aipkit_vs_wp_content_list_area"),bt=e.querySelector("#aipkit_vs_wp_content_pagination"),Qt=e.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Jt=e.querySelector("#aipkit_wp_content_bulk_panel"),di=e.querySelector("#aipkit_wp_content_specific_panel"),Hi=e.querySelector("#aipkit_wp_content_bulk_hint"),ti=e.querySelector("#aipkit_wp_content_specific_types_panel"),fe=e.querySelector("#aipkit_wp_content_status_wrap_bulk"),Fe=e.querySelector("#aipkit_wp_content_status_wrap_specific"),ge=C?C.querySelector('.aipkit_builder_sheet_section[data-sheet="sources"]'):null,Ge=ge?ge.querySelector("#aipkit_sources_table_body"):null,et=ge?ge.querySelector(".aipkit_sources_search_input"):null,Nt=ge?ge.querySelector(".aipkit_sources_filter_select"):null,Gt=ge?ge.querySelector(".aipkit_sources_refresh_btn"):null,wt=ge?ge.querySelector("#aipkit_sources_pagination"):null,Ot=ge?ge.querySelector("#aipkit_sources_status"):null,Yt=ge?ge.querySelector("#aipkit_sources_provider_label"):null,pi=ge?ge.querySelector("#aipkit_sources_store_label"):null,Ze=document.getElementById("aipkit_sources_editor_modal"),Ee=Ze?Ze.querySelector(".aipkit_sources_editor_textarea"):null,Lt=Ze?Ze.querySelector(".aipkit_sources_editor_close"):null,ft=Ze?Ze.querySelector(".aipkit_sources_editor_cancel"):null,ui=Ze?Ze.querySelector(".aipkit_sources_editor_save"):null,Mt=document.getElementById("aipkit_sources_delete_modal"),cn=Mt?Mt.querySelector(".aipkit_sources_delete_close"):null,ln=Mt?Mt.querySelector(".aipkit_sources_delete_cancel"):null,Ci=Mt?Mt.querySelector(".aipkit_sources_delete_confirm"):null,rt=document.getElementById("aipkit_image_settings_flyout"),dn=rt?rt.querySelector(".aipkit_popover_flyout_close"):null,hi=null,Rt=document.getElementById("aipkit_parameters_flyout"),pn=Rt?Rt.querySelector(".aipkit_popover_flyout_close"):null,Ti=null,Vt=document.getElementById("aipkit_popup_hint_flyout"),ao=Vt?Vt.querySelector(".aipkit_popover_flyout_close"):null,Vi=null,ei=document.getElementById("aipkit_security_privacy_flyout"),ro=ei?ei.querySelector(".aipkit_popover_flyout_close"):null,_n=I?I.querySelector('[data-aipkit-settings-panel="safety"]'):null,bi=null,yi=document.getElementById("aipkit_starters_flyout"),so=yi?yi.querySelector(".aipkit_popover_flyout_close"):null,Ri=null,si=document.getElementById("aipkit_custom_theme_flyout"),un=si?si.querySelector(".aipkit_popover_flyout_close"):null,$i=null,gi=null,Tt=document.getElementById("aipkit_builder_web_settings_modal"),Kn=Tt?Tt.querySelector(".aipkit_builder_web_settings_close"):null,vt=document.getElementById("aipkit_builder_context_settings_modal"),En=vt?vt.querySelector(".aipkit_builder_context_settings_close"):null,jn=I?I.querySelector('[data-aipkit-settings-panel="context"]'):null,Pi=null,At=document.getElementById("aipkit_builder_token_limits_modal"),Ki=At?At.querySelector(".aipkit_builder_token_limits_close"):null,co=I?I.querySelector('[data-aipkit-settings-panel="limits"]'):null,Mi=null,Ne=document.getElementById("aipkit_builder_audio_settings_modal"),lo=Ne?Ne.querySelector(".aipkit_builder_audio_settings_close"):null,Si=null,Ai=e.querySelector("#aipkit_builder_popup_settings_panel"),Bt=document.getElementById("aipkit_chatbot_global_save_status_container"),Xe=(F,N)=>{if(!Bt)return;let P=Bt.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_model_sync_status");P&&F&&(P.textContent="",P.classList.remove("success","error","loading")),Bt.textContent=F,Bt.className="aipkit_save_status_container",N&&Bt.classList.add(N)},_i=()=>{Bt&&setTimeout(()=>{Bt.textContent="",Bt.className="aipkit_save_status_container"},2500)},Lo=()=>{let F=rt&&rt.querySelector('input[name="replicate_api_key"]')||I&&I.querySelector('input[name="replicate_api_key"]')||C?.querySelector('input[name="replicate_api_key"]');return F?String(F.value||"").trim():""},po=F=>{if(!(F!==void 0?String(F||"").trim():Lo())||typeof window.aipkit_queueProviderSync!="function")return null;Xe("Syncing models...","loading");let P=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return P&&typeof P.then=="function"&&P.then(()=>{Xe("Models synced!","success"),_i()}).catch(j=>{Xe(`Error: ${j?.message||"Sync failed."}`,"error"),_i()}),P},_o=e.dataset.modelSettingsTitle||"Settings",Zi=F=>{if(!I||!F)return;let N=F.getBoundingClientRect(),P=I.getBoundingClientRect(),j=P.width||420,J=P.height||0,ie=window.innerWidth,oe=window.innerHeight,U=12,O=N.right+10;O+j>ie-U&&(O=N.left-j-10),O=Math.max(U,Math.min(O,ie-j-U));let Y=N.top;Y+J>oe-U&&(Y=oe-J-U),Y=Math.max(U,Y),I.style.left=`${Math.round(O)}px`,I.style.top=`${Math.round(Y)}px`,Rt&&Rt.classList.contains("is-open")&&Ti&&tn(Ti),rt&&rt.classList.contains("is-open")&&hi&&fn(hi),Tt&&Tt.classList.contains("is-open")&&gi&&nn(gi),vt&&vt.classList.contains("is-open")&&Pi&&en(Pi),At&&At.classList.contains("is-open")&&Mi&&Nn(Mi),Ne&&Ne.classList.contains("is-open")&&Si&&St(Si)},Qi=F=>{if(!M||!F)return;let N=F.getBoundingClientRect(),P=M.getBoundingClientRect(),j=P.width||420,J=P.height||0,ie=window.innerWidth,oe=window.innerHeight,U=12,O=N.right+10;O+j>ie-U&&(O=N.left-j-10),O=Math.max(U,Math.min(O,ie-j-U));let Y=N.top;Y+J>oe-U&&(Y=oe-J-U),Y=Math.max(U,Y),M.style.left=`${Math.round(O)}px`,M.style.top=`${Math.round(Y)}px`},Ui=F=>{if(!b)return;let N=Array.from(b.querySelectorAll("[data-aipkit-settings-panel]"));if(!N.length)return;let P=F||"root",j=b.querySelector(`[data-aipkit-settings-panel="${P}"]`)||b.querySelector('[data-aipkit-settings-panel="root"]');if(!j)return;let J=j.dataset.aipkitSettingsPanel||"root";if(J!==R&&((()=>{Rt&&(Rt.classList.remove("is-open"),Rt.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),rt&&(rt.classList.remove("is-open"),rt.setAttribute("aria-hidden","true")),hi&&(hi.setAttribute("aria-expanded","false"),hi=null),ei&&(ei.classList.remove("is-open"),ei.setAttribute("aria-hidden","true")),bi&&(bi.setAttribute("aria-expanded","false"),bi=null),Tt&&(Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true")),gi&&(gi.setAttribute("aria-expanded","false"),gi=null),vt&&(vt.classList.remove("is-open"),vt.setAttribute("aria-hidden","true")),Pi&&(Pi.setAttribute("aria-expanded","false"),Pi=null),At&&(At.classList.remove("is-open"),At.setAttribute("aria-hidden","true")),Mi&&(Mi.setAttribute("aria-expanded","false"),Mi=null),Ne&&(Ne.classList.remove("is-open"),Ne.setAttribute("aria-hidden","true")),Si&&(Si.setAttribute("aria-expanded","false"),Si=null),yi&&(yi.classList.remove("is-open"),yi.setAttribute("aria-hidden","true")),Ri&&(Ri.setAttribute("aria-expanded","false"),Ri=null),si&&(si.classList.remove("is-open"),si.setAttribute("aria-hidden","true")),$i&&($i.setAttribute("aria-expanded","false"),$i=null)})(),R=J),N.forEach(oe=>{oe.hidden=oe!==j}),q){let oe={root:b.dataset.titleRoot||"Settings",appearance:b.dataset.titleAppearance||"Appearance",behavior:b.dataset.titleBehavior||"Behavior",context:b.dataset.titleContext||"Context",tools:b.dataset.titleTools||"Tools",safety:b.dataset.titleSafety||"Safety",limits:b.dataset.titleLimits||"Limits"};q.textContent=oe[J]||oe.root}E&&(E.hidden=J==="root"),S&&(S.hidden=J!=="root"),J==="behavior"&&In(j),J==="limits"&&on(),b.classList.contains("aipkit-active")&&A&&window.requestAnimationFrame(()=>{Zi(A)})},tn=F=>{if(!Rt||!F)return;let N=F.getBoundingClientRect(),P=I?I.getBoundingClientRect():null,j=P&&P.width>0&&P.height>0,J=Rt.getBoundingClientRect(),ie=J.width||320,oe=J.height||260,U=window.innerWidth,O=window.innerHeight,Y=12,ce=(P?P.right:N.right)+8;ce+ie>U-Y&&(ce=(P?P.left:N.left)-ie-8),ce=Math.max(Y,Math.min(ce,U-ie-Y));let ue=P?P.top:N.top-8;ue+oe>O-Y&&(ue=O-oe-Y),ue<Y&&(ue=Y),Rt.style.left=`${Math.round(ce)}px`,Rt.style.top=`${Math.round(ue)}px`},fn=F=>{if(!rt||!F)return;let N=F.getBoundingClientRect(),P=I?I.getBoundingClientRect():null,j=rt.getBoundingClientRect(),J=j.width||340,ie=j.height||220,oe=window.innerWidth,U=window.innerHeight,O=12,Y=(P?P.right:N.right)+8;Y+J>oe-O&&(Y=(P?P.left:N.left)-J-8),Y=Math.max(O,Math.min(Y,oe-J-O));let ce=P?P.top:N.top-8;ce+ie>U-O&&(ce=U-ie-O),ce<O&&(ce=O),rt.style.left=`${Math.round(Y)}px`,rt.style.top=`${Math.round(ce)}px`},Bn=F=>{if(!Vt||!F)return;let N=F.getBoundingClientRect(),P=M?M.getBoundingClientRect():null,j=Vt.getBoundingClientRect(),J=j.width||320,ie=j.height||240,oe=window.innerWidth,U=window.innerHeight,O=12,Y=(usePanelRect?P.right:N.right)+8;Y+J>oe-O&&(Y=(usePanelRect?P.left:N.left)-J-8),Y=Math.max(O,Math.min(Y,oe-J-O));let ce=usePanelRect?P.top:N.top-8;ce+ie>U-O&&(ce=U-ie-O),ce<O&&(ce=O),Vt.style.left=`${Math.round(Y)}px`,Vt.style.top=`${Math.round(ce)}px`},$n=F=>{if(!yi||!F)return;let N=F.getBoundingClientRect(),P=I?I.getBoundingClientRect():null,j=yi.getBoundingClientRect(),J=j.width||400,ie=j.height||240,oe=window.innerWidth,U=window.innerHeight,O=12,Y=(P?P.right:N.right)+8;Y+J>oe-O&&(Y=(P?P.left:N.left)-J-8),Y=Math.max(O,Math.min(Y,oe-J-O));let ce=P?P.top:N.top-8;ce+ie>U-O&&(ce=U-ie-O),ce<O&&(ce=O),yi.style.left=`${Math.round(Y)}px`,yi.style.top=`${Math.round(ce)}px`},Fn=F=>{if(!ei||!F)return;let N=F.getBoundingClientRect(),P=I?I.getBoundingClientRect():null,j=P&&P.width>0&&P.height>0,ie=ei.getBoundingClientRect().width||400,oe=window.innerWidth,U=window.innerHeight,O=12,Y=(j?P.right:N.right)+8;Y+ie>oe-O&&(Y=(j?P.left:N.left)-ie-8),Y=Math.max(O,Math.min(Y,oe-ie-O));let ce=j?U-P.bottom:U-N.bottom,ue=Math.max(O,ce);ei.style.left=`${Math.round(Y)}px`,ei.style.top="auto",ei.style.bottom=`${Math.round(ue)}px`},uo=F=>{if(!si||!F)return;let N=F.getBoundingClientRect();if(N.width===0&&N.height===0&&e){let ye=e.querySelector('.aipkit_theme_choice_card input[name="theme"][value="custom"]')?.closest(".aipkit_theme_choice_card");if(ye){let ze=ye.getBoundingClientRect();(ze.width>0||ze.height>0)&&(N=ze)}}let P=I?I.getBoundingClientRect():null,j=P&&P.width>0&&P.height>0,J=si.getBoundingClientRect(),ie=J.width||400,oe=J.height||260,U=window.innerWidth,O=window.innerHeight,Y=12,ce=(j?P.right:N.right)+8;ce+ie>U-Y&&(ce=(j?P.left:N.left)-ie-8),ce=Math.max(Y,Math.min(ce,U-ie-Y));let ue=j?P.top:N.top-8;ue+oe>O-Y&&(ue=O-oe-Y),ue<Y&&(ue=Y),si.style.left=`${Math.round(ce)}px`,si.style.top=`${Math.round(ue)}px`},nn=F=>{if(!Tt||!F)return;let N=I?I.getBoundingClientRect():null,P=F.getBoundingClientRect(),j=Tt.querySelector(".aipkit-modal-content"),J=j?j.getBoundingClientRect():null,ie=J?J.width:520,oe=window.innerWidth,U=window.innerHeight,O=12,Y=(N?N.right:P.right)+8;Y+ie>oe-O&&(Y=(N?N.left:P.left)-ie-8),Y=Math.max(O,Math.min(Y,oe-ie-O));let ce=N?U-N.bottom:O,ue=Math.max(O,ce);Tt.style.left=`${Math.round(Y)}px`,Tt.style.top="auto",Tt.style.bottom=`${Math.round(ue)}px`},en=F=>{if(!vt||!F)return;let N=I?I.getBoundingClientRect():null,P=F.getBoundingClientRect(),j=vt.querySelector(".aipkit-modal-content"),J=j?j.getBoundingClientRect():null,ie=J?J.width:560,oe=window.innerWidth,U=12,O=(N?N.right:P.right)+8;O+ie>oe-U&&(O=(N?N.left:P.left)-ie-8),O=Math.max(U,Math.min(O,oe-ie-U));let Y=N?N.top:U;vt.style.left=`${Math.round(O)}px`,vt.style.top=`${Math.round(Y)}px`},Nn=F=>{if(!At||!F)return;let N=I?I.getBoundingClientRect():null,P=F.getBoundingClientRect(),j=At.querySelector(".aipkit-modal-content"),J=j?j.getBoundingClientRect():null,ie=J?J.width:620,oe=J?J.height:400,U=window.innerWidth,O=12,Y=(N?N.right:P.right)+8;Y+ie>U-O&&(Y=(N?N.left:P.left)-ie-8),Y=Math.max(O,Math.min(Y,U-ie-O));let ce=N?N.bottom-oe:P.top-12;ce<O&&(ce=O),At.style.left=`${Math.round(Y)}px`,At.style.top=`${Math.round(ce)}px`},St=F=>{if(!Ne||!F)return;let N=I?I.getBoundingClientRect():null,P=F.getBoundingClientRect(),j=Ne.querySelector(".aipkit-modal-content"),J=j?j.getBoundingClientRect():null,ie=J?J.width:520,oe=window.innerWidth,U=window.innerHeight,O=12,Y=(N?N.right:P.right)+8;Y+ie>oe-O&&(Y=(N?N.left:P.left)-ie-8),Y=Math.max(O,Math.min(Y,oe-ie-O));let ce=N?U-N.bottom:O,ue=Math.max(O,ce);Ne.style.left=`${Math.round(Y)}px`,Ne.style.top="auto",Ne.style.bottom=`${Math.round(ue)}px`},To=F=>{!b||!I||!F||(C&&C.classList.contains("aipkit-active")&&(C.classList.remove("aipkit-active"),C.setAttribute("aria-hidden","true")),T&&T.classList.contains("aipkit-active")&&mn(),Ui("root"),A=F,b.classList.add("aipkit-active"),b.setAttribute("aria-hidden","false"),F.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_model_settings_popover"),In(I),gn(),qn(),Rn(),window.requestAnimationFrame(()=>{Zi(F)}))},Ji=()=>{b&&(Ui("root"),Tt&&(Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true")),gi&&(gi.setAttribute("aria-expanded","false"),gi=null),vt&&(vt.classList.remove("is-open"),vt.setAttribute("aria-hidden","true")),Pi&&(Pi.setAttribute("aria-expanded","false"),Pi=null),At&&(At.classList.remove("is-open"),At.setAttribute("aria-hidden","true")),Mi&&(Mi.setAttribute("aria-expanded","false"),Mi=null),Ne&&(Ne.classList.remove("is-open"),Ne.setAttribute("aria-hidden","true")),Si&&(Si.setAttribute("aria-expanded","false"),Si=null),Rt&&(Rt.classList.remove("is-open"),Rt.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),rt&&(rt.classList.remove("is-open"),rt.setAttribute("aria-hidden","true")),hi&&(hi.setAttribute("aria-expanded","false"),hi=null),ei&&(ei.classList.remove("is-open"),ei.setAttribute("aria-hidden","true")),bi&&(bi.setAttribute("aria-expanded","false"),bi=null),b.classList.remove("aipkit-active"),b.setAttribute("aria-hidden","true"),A&&A.setAttribute("aria-expanded","false"),A=null)},Po=F=>{!T||!M||!F||(C&&C.classList.contains("aipkit-active")&&(C.classList.remove("aipkit-active"),C.setAttribute("aria-hidden","true")),b&&b.classList.contains("aipkit-active")&&Ji(),W=F,T.classList.add("aipkit-active"),T.setAttribute("aria-hidden","false"),F.setAttribute("aria-expanded","true"),window.requestAnimationFrame(()=>{Qi(F)}))},mn=()=>{T&&(An(),T.classList.remove("aipkit-active"),T.setAttribute("aria-hidden","true"),W&&(W.setAttribute("aria-expanded","false"),W=null))},Mo=()=>{if(!I)return;let F=e.querySelector(".aipkit_chatbot_provider_select"),N=F?F.value:"",P=I.querySelector(".aipkit_web_search_toggle_openai"),j=I.querySelector(".aipkit_web_search_toggle_google"),J=I.querySelector(".aipkit_web_search_toggle_claude");P&&(P.style.display=N==="OpenAI"?"":"none"),j&&(j.style.display=N==="Google"?"":"none"),J&&(J.style.display=N==="Claude"?"":"none");let ie=I.querySelector(".aipkit_openai_web_search_enable_toggle"),oe=I.querySelector(".aipkit_google_search_grounding_enable_toggle"),U=I.querySelector(".aipkit_claude_web_search_enable_toggle"),O=I.querySelector('.aipkit_web_search_config_btn[data-web-provider="openai"]'),Y=I.querySelector('.aipkit_web_search_config_btn[data-web-provider="google"]'),ce=I.querySelector('.aipkit_web_search_config_btn[data-web-provider="claude"]'),ue=ye=>ye?ye.tagName==="SELECT"?ye.value==="1":ye.type==="checkbox"?ye.checked:ye.value==="1":!1;O&&(O.style.display=ue(ie)?"":"none"),Y&&(Y.style.display=ue(oe)?"":"none"),ce&&(ce.style.display=ue(U)?"":"none")},gn=()=>{let F=ie=>ie?ie.tagName==="SELECT"?ie.value==="1":ie.type==="checkbox"?ie.checked:ie.value==="1":!1,N=ie=>{if(!ie)return;let oe=I&&I.querySelector(".aipkit_claude_web_search_enable_toggle")||ie.querySelector(".aipkit_claude_web_search_enable_toggle"),U=F(oe),O=ie.querySelector(".aipkit_claude_web_search_conditional_settings");O&&(O.style.display=U?"":"none");let Y=ie.querySelector(".aipkit_claude_web_search_loc_type_select"),ce=ie.querySelector(".aipkit_claude_web_search_location_details");ce&&(ce.style.display=U&&Y&&Y.value==="approximate"?"":"none")},P=e.querySelector(".aipkit_chatbot_provider_select"),j=P?P.value:"",J=Tt||C;if(J){let ie=J.querySelector(".aipkit_web_modal_section_openai"),oe=J.querySelector(".aipkit_web_modal_section_google"),U=J.querySelector(".aipkit_web_modal_section_claude");ie&&(ie.style.display=j==="OpenAI"?"":"none"),oe&&(oe.style.display=j==="Google"?"":"none"),U&&(U.style.display=j==="Claude"?"":"none"),typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(J),typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(J),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(J),typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(J),N(J)}Mo()},zn=()=>{let F=I&&I.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return F?F.tagName==="SELECT"?F.value==="1"?"1":"0":F.checked?"1":"0":"0"},Qn=()=>{if(!I)return"0";let F=I.querySelector(".aipkit_file_upload_toggle_select");return!F||F.disabled?"0":F.tagName==="SELECT"?F.value==="1"?"1":"0":F.checked?"1":"0"},Ni=()=>jn||vt,fo=()=>co||At,Gi=()=>{let F=Ni();return F?{providerSelect:F.querySelector('[name="vector_store_provider"]'),openaiStoresSelect:F.querySelector('select[name="openai_vector_store_ids[]"]'),pineconeIndexSelect:F.querySelector('[name="pinecone_index_name"]'),qdrantCollectionsSelect:F.querySelector('select[name="qdrant_collection_names[]"]'),pineconeKeyInput:F.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:F.querySelector('[name="qdrant_url"]'),qdrantKeyInput:F.querySelector('[name="qdrant_api_key"]')}:{}},Jn=F=>F?Array.from(F.options).filter(N=>!N.disabled&&N.value):[],On=F=>F?(F.selectedOptions?Array.from(F.selectedOptions):[]).some(P=>!P.disabled&&P.value):!1,Yn=F=>{if(!F)return!1;let N=F.options[F.selectedIndex];if(N&&!N.disabled&&N.value)return!0;let P=Jn(F)[0];return P?(F.value=P.value,F.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},xn=F=>{if(!F)return!1;if(On(F))return!0;let N=Jn(F)[0];return N?(N.selected=!0,F.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},mo=F=>{if(!I)return;let N=I.querySelector(".aipkit_vector_store_popover_row .aipkit_popover_warning");if(N){if(!F){N.classList.remove("is-visible"),N.setAttribute("aria-hidden","true"),N.setAttribute("data-tooltip",""),N.removeAttribute("aria-label");return}N.classList.add("is-visible"),N.setAttribute("aria-hidden","false"),N.setAttribute("data-tooltip",F),N.setAttribute("aria-label",F)}},ji=()=>{if(Qn()!=="1"){mo("");return}let{providerSelect:F,openaiStoresSelect:N,pineconeIndexSelect:P,qdrantCollectionsSelect:j,pineconeKeyInput:J,qdrantUrlInput:ie,qdrantKeyInput:oe}=Gi(),U=F?F.value:"",O=e.querySelector(".aipkit_chatbot_provider_select"),Y=O?O.value:"",ce=!!(J&&J.value.trim()),ue=!!(ie&&ie.value.trim()),ye=!!(oe&&oe.value.trim()),ze=On(N),st=On(P),nt=On(j),ot="";U?U==="openai"?t?ze||(ot="No OpenAI vector stores found. Create a vector store."):ot="Add your OpenAI API key to enable OpenAI vector stores.":U==="pinecone"?ce?st||(ot="No Pinecone indexes found. Create an index."):ot="Add your Pinecone API key to enable Pinecone.":U==="qdrant"?!ue&&!ye?ot="Add your Qdrant URL and API key to enable Qdrant.":ue?ye?nt||(ot="No Qdrant collections found. Create a collection."):ot="Add your Qdrant API key to enable Qdrant.":ot="Add your Qdrant URL to enable Qdrant.":U==="claude_files"?Y!=="Claude"?ot="Claude Files requires the chatbot provider to be Claude.":f||(ot="Add your Claude API key to enable Claude Files."):ot="Select and configure a vector provider to use file uploads.":ot="Select and configure a vector provider to use file uploads.",mo(ot)},Bo=()=>{let F=Ni();if(!I||!F)return;let N=I.querySelector(".aipkit_vector_store_enable_select");N&&!N.checked&&(N.checked=!0,N.dispatchEvent(new Event("change",{bubbles:!0})));let{providerSelect:P,openaiStoresSelect:j,pineconeIndexSelect:J,qdrantCollectionsSelect:ie,pineconeKeyInput:oe,qdrantUrlInput:U,qdrantKeyInput:O}=Gi(),Y=!!(oe&&oe.value.trim()),ce=!!(U&&U.value.trim()),ue=!!(O&&O.value.trim()),ye="";t?ye="openai":Y?ye="pinecone":(ue||ce)&&(ye="qdrant"),P&&ye&&P.value!==ye&&(P.value=ye,P.dispatchEvent(new Event("change",{bubbles:!0}))),ye==="openai"?xn(j):ye==="pinecone"?Yn(J):ye==="qdrant"&&xn(ie),ji()},kn=()=>{if(!I)return;let F=I.querySelector(".aipkit_file_upload_toggle_select");if(!F)return;let N=F.closest(".aipkit_popover_option_row"),P=N?N.querySelector(".aipkit_popover_option_label"):null,j=F.dataset.isProPlan==="true",J=j,ie=F.dataset.tooltipDefault||"",oe=Ni(),U=oe?oe.querySelector('[name="vector_store_provider"]'):null,O=U?U.value:"",Y=e.querySelector(".aipkit_chatbot_provider_select"),ce=Y?Y.value:"";if(U&&O==="claude_files"&&ce!=="Claude"){let ye=Array.from(U.options||[]).find(st=>st&&st.value&&st.value!=="claude_files"),ze=ye?ye.value:"openai";if(U.value!==ze){U.value=ze,U.dispatchEvent(new Event("change",{bubbles:!0}));return}}j?O==="claude_files"&&ce!=="Claude"&&(ie="Claude Files requires the chatbot provider to be Claude.",J=!1):(ie=F.dataset.tooltipUpgrade||ie,J=!1),N&&N.classList.toggle("aipkit_popover_option_row--disabled",!J),F.disabled=!J,P&&P.setAttribute("data-tooltip",ie);let ue=F.tagName==="SELECT"?F.value==="1":F.checked;!J&&ue&&(F.tagName==="SELECT"?F.value="0":F.checked=!1,F.dispatchEvent(new Event("change",{bubbles:!0})))},Cn=()=>{let F=Ni();F&&(typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(F),typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(F))},Rn=()=>{if(!I)return;let F=zn()==="1",N=I.querySelector(".aipkit_file_upload_toggle_select");!F&&N&&!N.disabled&&(N.tagName==="SELECT"?N.value==="1":N.checked)&&(N.tagName==="SELECT"?N.value="0":N.checked=!1,N.dispatchEvent(new Event("change",{bubbles:!0}))),Cn(),kn(),ji()},on=()=>{let F=fo();if(!F)return;let N=F.querySelector(".aipkit_token_limit_mode_select"),P=F.querySelector(".aipkit_token_general_user_limit_field"),j=F.querySelector(".aipkit_token_role_limits_container");if(!N||!P||!j)return;let J=N.value;P.style.display=J==="general"?"block":"none",j.style.display=J==="role_based"?"block":"none"},wn=()=>{if(!Ne)return;let F=Ne.querySelector(".aipkit_voice_input_toggle_switch"),N=ut=>ut?ut.tagName==="SELECT"?ut.value==="1":ut.type==="checkbox"?ut.checked:ut.value==="1":!1,P=Ne.querySelector(".aipkit_stt_provider_conditional_row"),j=Ne.querySelector(".aipkit_stt_provider_row"),J=j&&j.dataset.sttControlsHidden==="1";if(F){let ut=N(F);if(j&&(j.style.display=ut&&!J?"block":"none"),P&&(P.style.display=ut&&!J?"flex":"none"),ut&&J&&j){let Kt=j.dataset.sttDefaultProvider,jt=j.dataset.sttDefaultModel,ci=Ne.querySelector(".aipkit_stt_provider_select"),kt=Ne.querySelector('[name="stt_openai_model_id"]'),Xt=(It,ki,mi)=>{if(!It||!ki)return;if(!Array.from(It.options).some(xe=>xe.value===ki)){let xe=new Option(mi||ki,ki,!0,!0);It.add(xe)}It.value=ki};Xt(ci,Kt),Xt(kt,jt,"whisper-1")}}typeof window.aipkit_toggleSttModelFields=="function"&&window.aipkit_toggleSttModelFields(Ne);let ie=Ne.querySelector(".aipkit_tts_toggle_switch"),oe=Ne.querySelector(".aipkit_tts_conditional_settings"),U=Ne.querySelector(".aipkit_tts_provider_row"),O=Ne.querySelector(".aipkit_tts_auto_play_container"),Y=!1;ie&&(Y=N(ie),U&&(U.style.display=Y?"block":"none"),oe&&(oe.style.display=Y?"flex":"none"),O&&(O.style.display=Y?"block":"none"));let ce=Ne.querySelector(".aipkit_tts_provider_select");if(ce){let ut=ce.value;Ne.querySelectorAll(".aipkit_tts_field").forEach(It=>{let ki=It.getAttribute("data-provider");It.style.display=Y&&ki===ut?"block":"none"});let Kt=Ne.querySelector(".aipkit_tts_google_voice_inline"),jt=Ne.querySelector(".aipkit_tts_openai_voice_inline"),ci=Ne.querySelector(".aipkit_tts_openai_model_inline"),kt=Ne.querySelector(".aipkit_tts_elevenlabs_voice_inline"),Xt=Ne.querySelector(".aipkit_tts_elevenlabs_model_inline");Kt&&(Kt.style.display=Y&&ut==="Google"?"block":"none"),jt&&(jt.style.display=Y&&ut==="OpenAI"?"block":"none"),ci&&(ci.style.display=Y&&ut==="OpenAI"?"block":"none"),kt&&(kt.style.display=Y&&ut==="ElevenLabs"?"block":"none"),Xt&&(Xt.style.display=Y&&ut==="ElevenLabs"?"block":"none")}else if(Y===!1){Ne.querySelectorAll(".aipkit_tts_field").forEach(Xt=>{Xt.style.display="none"});let ut=Ne.querySelector(".aipkit_tts_google_voice_inline");ut&&(ut.style.display="none");let Kt=Ne.querySelector(".aipkit_tts_openai_voice_inline");Kt&&(Kt.style.display="none");let jt=Ne.querySelector(".aipkit_tts_openai_model_inline");jt&&(jt.style.display="none");let ci=Ne.querySelector(".aipkit_tts_elevenlabs_voice_inline");ci&&(ci.style.display="none");let kt=Ne.querySelector(".aipkit_tts_elevenlabs_model_inline");kt&&(kt.style.display="none")}let ue=Ne.querySelector(".aipkit_enable_realtime_voice_toggle"),ye=Ne.querySelector(".aipkit_realtime_voice_settings_container"),ze=Ne.querySelector(".aipkit_realtime_voice_inline_controls"),st=Ne.querySelector(".aipkit_realtime_voice_inline_row"),ot=ye&&ye.getAttribute("data-force-visible")==="1"||ue&&N(ue);ye&&(ye.style.display=ot?"block":"none"),st&&(st.style.display=ot?"block":"none"),ze&&(ze.style.display=ot?"flex":"none"),Ne.querySelectorAll(".aipkit_rt_dependent").forEach(ut=>{ut.style.display=ot?"":"none"})},Dn=()=>{if(!Ai)return;let F=Ai.querySelector('select[name="popup_icon_type"]');if(F){let U=Ai.querySelector(".aipkit_popup_icon_default_selector_container"),O=Ai.querySelector(".aipkit_popup_icon_custom_input_container");U&&(F.value==="default"?U.removeAttribute("hidden"):U.setAttribute("hidden","")),O&&(F.value==="custom"?O.removeAttribute("hidden"):O.setAttribute("hidden",""));let Y=Ai.querySelectorAll('input[name="popup_icon_type"]');Y.length&&Y.forEach(ce=>{ce.checked=ce.value===F.value})}let N=Ai.querySelector('select[name="header_avatar_type"]');if(N){let U=Ai.querySelector(".aipkit_header_avatar_default_selector_container"),O=Ai.querySelector(".aipkit_header_avatar_custom_input_container");U&&(N.value==="default"?U.removeAttribute("hidden"):U.setAttribute("hidden","")),O&&(N.value==="custom"?O.removeAttribute("hidden"):O.setAttribute("hidden",""));let Y=Ai.querySelectorAll('input[name="header_avatar_type"]');Y.length&&Y.forEach(ce=>{ce.checked=ce.value===N.value})}let P=Ai.querySelector('select[name="popup_icon_style"]');if(P){let U=Ai.querySelectorAll('input[name="popup_icon_style"]');U.length&&U.forEach(O=>{O.checked=O.value===P.value})}let j=Ai.querySelector(".aipkit_popup_hint_toggle_switch"),J=j?j.checked:!1,ie=Ai.querySelector(".aipkit_popup_hint_config_btn");ie&&(ie.style.display=J?"":"none",J||ie.setAttribute("aria-expanded","false")),!J&&Vt&&Vt.classList.contains("is-open")&&An();let oe=Vt||Ai;if(oe){oe.querySelectorAll(".aipkit_popup_hint_extra").forEach(O=>{J?O.removeAttribute("hidden"):O.setAttribute("hidden","")});let U=oe.querySelector(".aipkit_popup_hint_conditional_row");U&&(J?U.removeAttribute("hidden"):U.setAttribute("hidden",""))}},An=()=>{Vt&&(Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true"),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null))},Xn=()=>{ei&&(ei.classList.remove("is-open"),ei.setAttribute("aria-hidden","true"),bi&&(bi.setAttribute("aria-expanded","false"),bi=null))},Yi=()=>{let F=_n||ei;if(!F)return;let N=F.querySelector('input[name="enable_consent_compliance"]'),P=N?N.checked:!1;F.querySelectorAll(".aipkit_consent_field_row").forEach(j=>{P?j.removeAttribute("hidden"):j.setAttribute("hidden","")}),b&&b.classList.contains("aipkit-active")&&A&&requestAnimationFrame(()=>{Zi(A)})},go=()=>{let F=_n||ei;if(!F)return;let N=F.querySelector('input[name="openai_moderation_enabled"]'),P=N?N.checked:!1;F.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(j=>{P?j.removeAttribute("hidden"):j.setAttribute("hidden","")}),b&&b.classList.contains("aipkit-active")&&A&&requestAnimationFrame(()=>{Zi(A)})},ko=()=>{let F=_n||ei;if(!F)return;let N=e.querySelector(".aipkit_chatbot_provider_select"),j=(N?N.value:"")==="OpenAI";if(F.querySelectorAll(".aipkit_openai_moderation_row").forEach(ie=>{ie.style.display=j?"":"none"}),j){go();return}F.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(ie=>{ie.setAttribute("hidden","")})},wo=()=>{yi&&(yi.classList.remove("is-open"),yi.setAttribute("aria-hidden","true"),Ri&&(Ri.setAttribute("aria-expanded","false"),Ri=null))},hn=()=>{si&&(si.classList.remove("is-open"),si.setAttribute("aria-hidden","true"),$i&&($i.setAttribute("aria-expanded","false"),$i=null))},Zn=F=>{if(!si||!F)return;si.classList.contains("is-open")||(si.classList.add("is-open"),si.setAttribute("aria-hidden","false")),$i&&$i!==F&&$i.setAttribute("aria-expanded","false"),F.setAttribute&&F.setAttribute("aria-expanded","true"),$i=F,window.requestAnimationFrame(()=>{uo(F)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_custom_theme_flyout")},In=F=>{if(!F)return;let N=F.querySelector(".aipkit_reasoning_effort_slider"),P=F.querySelector(".aipkit_reasoning_effort_label"),j=F.querySelector('input[name="reasoning_effort"]');if(!N||!P||!j)return;let J=()=>{let ie=[],oe=[];try{N.dataset.reasoningValues&&(ie=JSON.parse(N.dataset.reasoningValues)),N.dataset.reasoningLabels&&(oe=JSON.parse(N.dataset.reasoningLabels))}catch{ie=[],oe=[]}(!Array.isArray(ie)||ie.length===0)&&(ie=["none","low","medium","high","xhigh"]),(!Array.isArray(oe)||oe.length===0)&&(oe=ie.slice());let U=parseInt(N.value,10),O=Number.isNaN(U)?0:Math.min(ie.length-1,Math.max(0,U)),Y=ie[O]||ie[0],ce=oe[O]||Y;j.value=Y,P.textContent=ce};J(),N.dataset.reasoningBound||(N.addEventListener("input",J),N.addEventListener("change",J),N.dataset.reasoningBound="1")},qn=()=>{if(!I)return;let F=e.querySelector(".aipkit_chatbot_provider_select"),N=F?F.value:"",P=N==="OpenAI",j=N==="OpenAI"||N==="Claude",J=I.querySelector(".aipkit_stateful_convo_checkbox"),ie=I.querySelector(".aipkit_stateful_convo_group");J&&(J.disabled=!P),ie&&(ie.style.display=P?"":"none",ie.removeAttribute("title"));let oe=I&&I.querySelector(".aipkit_reasoning_effort_field")||Rt&&Rt.querySelector(".aipkit_reasoning_effort_field");oe&&(oe.style.display=P?"":"none");let U=I&&I.querySelector(".aipkit_image_analysis_popover_row")||rt&&rt.querySelector(".aipkit_image_analysis_popover_row");U&&(U.style.display=j?"":"none"),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(Rt||I);let O=I.querySelector(".aipkit_model_settings_panel:not([hidden])"),Y=O?O.querySelector(".aipkit_popover_options_list"):I.querySelector(".aipkit_popover_options_list");if(Y){let ce=Y.querySelectorAll(".aipkit_popover_option_row");ce.forEach(ye=>ye.classList.remove("aipkit_last_visible_row"));let ue=null;ce.forEach(ye=>{ye.style.display!=="none"&&(ue=ye)}),ue&&ue.classList.add("aipkit_last_visible_row")}b&&b.classList.contains("aipkit-active")&&A&&Zi(A)};if(e.dataset.shortcodeCopyBound||(e.addEventListener("click",F=>{let N=F.target.closest(".aipkit_shortcode_pill");if(!N)return;let P=N.dataset.shortcode||N.querySelector(".aipkit_shortcode_text")?.textContent||"";P&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(P,N)}),e.dataset.shortcodeCopyBound="1"),e.dataset.embedCopyBound||(e.addEventListener("click",F=>{let N=F.target.closest(".aipkit_copy_embed_code_btn");if(!N)return;let P=N.dataset.target;if(!P)return;let j=document.getElementById(P);if(!j)return;let J=j.value||j.textContent||"";J&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(J,N)}),e.dataset.embedCopyBound="1"),b&&e.querySelectorAll(".aipkit_cb_ai_settings_toggle").forEach(N=>{N.classList.add("aipkit_model_settings_popover_trigger"),N.setAttribute("aria-haspopup","dialog"),N.setAttribute("aria-expanded","false"),N.setAttribute("aria-controls","aipkit_model_settings_popover"),N.setAttribute("aria-label",_o),N.setAttribute("title",_o)}),m){let F=m.value||"";m.addEventListener("change",()=>{let N=m.value;if(N){if(N==="__new__"){typeof h=="function"&&h();let P=F||e.getAttribute("data-active-bot-id")||"";if(P)m.value=P;else{let j=Array.from(m.options).find(J=>J.value&&J.value!=="__new__"&&!J.disabled);j&&(m.value=j.value,F=j.value)}return}F=N;try{localStorage.setItem(g,N)}catch(P){console.warn("AIPKit Chat Builder: Failed to store selected chatbot:",P)}typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:N,layout:c})}})}if(u&&!u.dataset.bound){let F=u.querySelector("#aipkit_new_bot_name");h=()=>{u.classList.add("aipkit-active"),u.setAttribute("aria-hidden","false"),F&&F.focus()};let N=()=>{u.classList.remove("aipkit-active"),u.setAttribute("aria-hidden","true")};w&&w.addEventListener("click",h),v&&v.addEventListener("click",N),u.addEventListener("click",P=>{P.target===u&&N()}),document.addEventListener("keydown",P=>{P.key==="Escape"&&u.classList.contains("aipkit-active")&&N()}),u.dataset.bound="1"}if(ne&&ae&&!ae.dataset.bound){let F=()=>{if(ne.disabled)return;let P=m&&m.options[m.selectedIndex]?.text||"";pe&&(pe.value=P,pe.focus(),pe.select()),De&&(De.textContent="",De.className="aipkit_form-help"),ae.classList.add("aipkit-active"),ae.setAttribute("aria-hidden","false")},N=()=>{ae.classList.remove("aipkit-active"),ae.setAttribute("aria-hidden","true")};ne.addEventListener("click",F),Z&&Z.addEventListener("click",N),ae.addEventListener("click",P=>{P.target===ae&&N()}),document.addEventListener("keydown",P=>{P.key==="Escape"&&ae.classList.contains("aipkit-active")&&N()}),ve&&ve.addEventListener("click",()=>{let P=m&&m.value||e.getAttribute("data-active-bot-id"),j=pe?pe.value.trim():"";if(!P||!j){De&&(De.textContent=j===""?"Please enter a bot name.":"Select a bot to rename.",De.className="aipkit_form-help aipkit_form-help-error");return}if(typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(ve,"Saving..."),ve.disabled=!0,typeof window.aipkit_apiRequest!="function"){De&&(De.textContent="API unavailable.",De.className="aipkit_form-help aipkit_form-help-error"),ve.disabled=!1;return}window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:P,new_name:j}).then(J=>{let ie=J.new_name||j;if(m){let oe=m.options[m.selectedIndex];oe&&(oe.text=ie)}De&&(De.textContent=J.message||"Renamed successfully.",De.className="aipkit_form-help aipkit_form-help-success"),N()}).catch(J=>{De&&(De.textContent=J.message||"Could not rename the bot.",De.className="aipkit_form-help aipkit_form-help-error")}).finally(()=>{ve.disabled=!1,typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(ve,"Save Name"):ve.textContent="Save Name"})}),ae.dataset.bound="1"}if(C&&!e.dataset.sheetBound){let F=P=>{if(!C)return;b&&b.classList.contains("aipkit-active")&&Ji(),T&&T.classList.contains("aipkit-active")&&mn();let j=P.dataset.sheetTitle||"Sheet",J=P.dataset.sheetDescription||"Settings will appear here.",ie=P.dataset.sheetContent||"placeholder";if(B&&(B.textContent=j),$&&($.textContent=J),L.length){let oe=!1;L.forEach(U=>{let O=U.dataset.sheet===ie;U.hidden=!O,O&&(oe=!0)}),!oe&&K&&(K.hidden=!1)}if(Di&&(Di.textContent="",Di.classList.remove("success","error","loading"),Di.style.display="none"),ie==="triggers"&&typeof window.aipkit_initTriggerBuilderUI=="function"){let oe=m&&m.value||e.getAttribute("data-active-bot-id");oe&&window.aipkit_initTriggerBuilderUI(oe)}C.classList.add("aipkit-active"),C.setAttribute("aria-hidden","false"),H&&H.focus(),ie==="sources"&&typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_sheet"),gn(),wn(),qn(),Dn()},N=()=>{C.classList.remove("aipkit-active"),C.setAttribute("aria-hidden","true")};e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_builder_sheet_trigger");j&&(P.preventDefault(),F(j))}),H&&H.addEventListener("click",N),C.addEventListener("click",P=>{P.target===C&&N()}),document.addEventListener("keydown",P=>{P.key==="Escape"&&C.classList.contains("aipkit-active")&&N()}),e.dataset.sheetBound="1"}if(b&&!e.dataset.modelPopoverBound){e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_model_settings_popover_trigger");if(j){if(P.preventDefault(),P.stopPropagation(),b.classList.contains("aipkit-active")&&A===j){Ji();return}To(j)}}),e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_deploy_settings_trigger");if(j){if(P.preventDefault(),P.stopPropagation(),T&&T.classList.contains("aipkit-active")&&W===j){mn();return}Po(j)}}),e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_style_settings_trigger");if(!j)return;P.preventDefault(),P.stopPropagation();let J=j.dataset.aipkitPanelTarget||"appearance";Ui(J)}),e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_popover_params_config_btn");if(!j||(P.preventDefault(),!Rt))return;let J=!Rt.classList.contains("is-open");Rt.classList.toggle("is-open",J),Rt.setAttribute("aria-hidden",J?"false":"true"),Ti&&Ti!==j&&Ti.setAttribute("aria-expanded","false"),j.setAttribute("aria-expanded",J?"true":"false"),Ti=J?j:null,J&&(window.requestAnimationFrame(()=>{tn(j)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_parameters_flyout"),In(Rt),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(Rt))}),e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_image_settings_config_btn");if(!j||(P.preventDefault(),!rt))return;let J=!rt.classList.contains("is-open");rt.classList.toggle("is-open",J),rt.setAttribute("aria-hidden",J?"false":"true"),hi&&hi!==j&&hi.setAttribute("aria-expanded","false"),j.setAttribute("aria-expanded",J?"true":"false"),hi=J?j:null,J&&(window.requestAnimationFrame(()=>{fn(j)}),po())}),e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_popup_hint_config_btn");if(!j||(P.preventDefault(),!Vt))return;let J=!Vt.classList.contains("is-open");Vt.classList.toggle("is-open",J),Vt.setAttribute("aria-hidden",J?"false":"true"),Vi&&Vi!==j&&Vi.setAttribute("aria-expanded","false"),j.setAttribute("aria-expanded",J?"true":"false"),Vi=J?j:null,J&&window.requestAnimationFrame(()=>{Bn(j)})}),e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_starters_config_btn");if(!j||(P.preventDefault(),!yi))return;let J=!yi.classList.contains("is-open");yi.classList.toggle("is-open",J),yi.setAttribute("aria-hidden",J?"false":"true"),Ri&&Ri!==j&&Ri.setAttribute("aria-expanded","false"),j.setAttribute("aria-expanded",J?"true":"false"),Ri=J?j:null,J&&window.requestAnimationFrame(()=>{$n(j)})}),e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_security_privacy_config_btn");if(!j||(P.preventDefault(),!ei))return;let J=!ei.classList.contains("is-open");ei.classList.toggle("is-open",J),ei.setAttribute("aria-hidden",J?"false":"true"),bi&&bi!==j&&bi.setAttribute("aria-expanded","false"),j.setAttribute("aria-expanded",J?"true":"false"),bi=J?j:null,J&&(window.requestAnimationFrame(()=>{Fn(j)}),Yi(),ko())}),e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_theme_choice_card");if(!j)return;let J=j.querySelector('input[name="theme"]');!J||J.disabled||J.value!=="custom"||Zn(j)});let F=()=>{rt&&(rt.classList.remove("is-open"),rt.setAttribute("aria-hidden","true"),hi&&(hi.setAttribute("aria-expanded","false"),hi=null))};dn&&dn.addEventListener("click",P=>{P.preventDefault(),F()}),ao&&ao.addEventListener("click",P=>{P.preventDefault(),An()}),ro&&ro.addEventListener("click",P=>{P.preventDefault(),Xn()}),so&&so.addEventListener("click",P=>{P.preventDefault(),wo()}),un&&un.addEventListener("click",P=>{P.preventDefault(),hn()}),document.addEventListener("click",P=>{!rt||!rt.classList.contains("is-open")||P.target.closest(".aipkit_image_settings_config_btn")||P.target.closest("#aipkit_image_settings_flyout")||F()}),document.addEventListener("click",P=>{!Vt||!Vt.classList.contains("is-open")||P.target.closest(".aipkit_popup_hint_config_btn")||P.target.closest("#aipkit_popup_hint_flyout")||An()}),document.addEventListener("click",P=>{!ei||!ei.classList.contains("is-open")||P.target.closest(".aipkit_security_privacy_config_btn")||P.target.closest("#aipkit_security_privacy_flyout")||Xn()}),document.addEventListener("click",P=>{!yi||!yi.classList.contains("is-open")||P.target.closest(".aipkit_starters_config_btn")||P.target.closest("#aipkit_starters_flyout")||wo()}),document.addEventListener("click",P=>{!si||!si.classList.contains("is-open")||P.target.closest(".aipkit_theme_choice_group")||P.target.closest("#aipkit_custom_theme_flyout")||hn()});let N=()=>{Rt&&(Rt.classList.remove("is-open"),Rt.setAttribute("aria-hidden","true"),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null))};if(pn&&pn.addEventListener("click",P=>{P.preventDefault(),N()}),document.addEventListener("click",P=>{!Rt||!Rt.classList.contains("is-open")||P.target.closest(".aipkit_popover_params_config_btn")||P.target.closest("#aipkit_parameters_flyout")||N()}),y&&y.addEventListener("click",Ji),E&&E.addEventListener("click",()=>{Ui("root")}),b.addEventListener("click",P=>{P.target===b&&Ji()}),V&&V.addEventListener("click",mn),T&&T.addEventListener("click",P=>{P.target===T&&mn()}),document.addEventListener("keydown",P=>{P.key==="Escape"&&b.classList.contains("aipkit-active")&&Ji(),P.key==="Escape"&&T&&T.classList.contains("aipkit-active")&&mn()}),I&&!I.dataset.footerActionsBound){let P=e.getAttribute("data-default-bot-id")||"",j=()=>m&&m.value||e.getAttribute("data-active-bot-id")||"";I.addEventListener("click",J=>{let ie=J.target.closest(".aipkit_popover_footer_btn");if(!ie)return;J.preventDefault();let oe=ie.getAttribute("data-action"),U=j();if(!(!oe||!U||typeof window.aipkit_apiRequest!="function")){if(oe==="delete"){if(ie.disabled||U===P)return;Xe("Deleting...",""),window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:U}).then(O=>{Xe(O.message||"Deleted","success");try{P&&localStorage.setItem(g,P)}catch{}typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:P||U,layout:c}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(P||U),_i()}).catch(O=>{Xe(`Error: ${O.message||"Failed to delete."}`,"error"),_i()});return}oe==="reset"&&(Xe("Resetting...",""),window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:U}).then(O=>{Xe(O.message||"Saved","success"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:U,layout:c}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(U),_i()}).catch(O=>{Xe(`Error: ${O.message||"Failed to reset."}`,"error"),_i()}))}}),I.dataset.footerActionsBound="1"}window.addEventListener("resize",()=>{b.classList.contains("aipkit-active")&&A&&Zi(A),T&&T.classList.contains("aipkit-active")&&W&&Qi(W),Tt&&Tt.classList.contains("is-open")&&gi&&nn(gi),vt&&vt.classList.contains("is-open")&&Pi&&en(Pi),At&&At.classList.contains("is-open")&&Mi&&Nn(Mi),Ne&&Ne.classList.contains("is-open")&&Si&&St(Si),rt&&rt.classList.contains("is-open")&&hi&&fn(hi),Vt&&Vt.classList.contains("is-open")&&Vi&&Bn(Vi),ei&&ei.classList.contains("is-open")&&bi&&Fn(bi),yi&&yi.classList.contains("is-open")&&Ri&&$n(Ri),si&&si.classList.contains("is-open")&&$i&&uo($i)}),window.addEventListener("scroll",()=>{b.classList.contains("aipkit-active")&&A&&Zi(A),T&&T.classList.contains("aipkit-active")&&W&&Qi(W),Tt&&Tt.classList.contains("is-open")&&gi&&nn(gi),vt&&vt.classList.contains("is-open")&&Pi&&en(Pi),At&&At.classList.contains("is-open")&&Mi&&Nn(Mi),Ne&&Ne.classList.contains("is-open")&&Si&&St(Si),rt&&rt.classList.contains("is-open")&&hi&&fn(hi),Vt&&Vt.classList.contains("is-open")&&Vi&&Bn(Vi),ei&&ei.classList.contains("is-open")&&bi&&Fn(bi),yi&&yi.classList.contains("is-open")&&Ri&&$n(Ri),si&&si.classList.contains("is-open")&&$i&&uo($i)},!0),e.dataset.modelPopoverBound="1"}if($e&&Bt&&!$e.dataset.autosaveBound){let F=$e.value,N=!1,P=null,j=O=>{Zt&&(Zt.textContent=`${O.length.toLocaleString()} characters`)},J=O=>{at&&(at.value=O,j(O))},ie=O=>{let Y=m&&m.value||e.getAttribute("data-active-bot-id");Y&&(N=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_instructions",{bot_id:Y,instructions:O}).then(ce=>{F=O,$e.dataset.dirty="0",Xe(ce.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Y),_i()}).catch(ce=>{Xe(`Error: ${ce.message||"Failed to save."}`,"error"),$e.dataset.dirty="1"}).finally(()=>{if(N=!1,P!==null&&P!==F){let ce=P;P=null,ie(ce)}else P=null}))},oe=()=>{!it||!at||(J($e.value),it.classList.add("aipkit-active"),it.setAttribute("aria-hidden","false"),setTimeout(()=>at.focus(),0))},U=O=>{if(!it||(it.classList.remove("aipkit-active"),it.setAttribute("aria-hidden","true"),!O||!at))return;let Y=at.value;if(Y!==$e.value&&($e.value=Y,$e.dataset.dirty="1"),$e.dataset.dirty==="1"){if(N){P=$e.value;return}ie($e.value)}};at&&!at.dataset.bound&&(at.addEventListener("input",()=>{j(at.value),$e.dataset.dirty="1"}),at.dataset.bound="1"),it&&!it.dataset.bound&&(lt&&lt.addEventListener("click",oe),we&&we.addEventListener("click",()=>{U(!0)}),document.addEventListener("keydown",O=>{O.key==="Escape"&&it.classList.contains("aipkit-active")&&U(!0)}),it.dataset.bound="1"),$e.addEventListener("input",()=>{$e.dataset.dirty="1"}),$e.addEventListener("blur",()=>{let O=$e.value;if($e.dataset.dirty==="1"){if(O===F){$e.dataset.dirty="0";return}if(N){P=O;return}ie(O)}}),$e.dataset.autosaveBound="1"}if($t){let F=$t.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]"),N=j=>{j&&(F.forEach(J=>{let ie=J.dataset.aipkitTab===j;J.classList.toggle("is-active",ie),J.setAttribute("aria-selected",ie?"true":"false")}),li.forEach(J=>{let ie=J.dataset.aipkitPanel===j;J.classList.toggle("is-active",ie),J.hidden=!ie}),Oe&&(Oe.style.display=j==="files"?"none":""),_t&&_t.classList.toggle("aipkit_builder_action_row--end",j==="files"))},P=$t.querySelector(".aipkit_builder_tab.is-active");P&&N(P.dataset.aipkitTab),F.forEach(j=>{j.addEventListener("click",()=>{N(j.dataset.aipkitTab)})})}let fi=C?C.querySelector('textarea[name="triggers_json"]'):null,Wn=C?C.querySelector(".aipkit_trigger_builder_container"):null,Di=C?C.querySelector(".aipkit_triggers_status"):null;if((fi||Wn)&&Bt&&!e.dataset.triggersAutosaveBound){let F=fi?fi.value:"[]",N=!1,P=null,j=null,J=()=>{let ue=m&&m.value||e.getAttribute("data-active-bot-id");if(!ue)return null;let ye="";if(typeof window.aipkit_getTriggerBuilderState=="function"){let ze=window.aipkit_getTriggerBuilderState(ue);ze&&Array.isArray(ze.triggers)&&(typeof window.aipkit_updateTriggersJsonForSave=="function"&&window.aipkit_updateTriggersJsonForSave(ue,ze.triggers),ye=fi?fi.value:JSON.stringify(ze.triggers,null,2))}return!ye&&fi&&(ye=fi.value),ye||(ye="[]"),{botId:ue,triggersJson:ye}},ie=(ue,ye)=>{Di&&(Di.textContent=ue||"",Di.classList.remove("success","error","loading"),ye&&Di.classList.add(ye),Di.style.display=ue?"inline-block":"none")},oe=()=>{Di&&setTimeout(()=>{Di.textContent="",Di.classList.remove("success","error","loading"),Di.style.display="none"},2500)},U=(ue,ye)=>{ye&&(N=!0,Xe("Auto-saving...",""),ie("Saving...","loading"),window.aipkit_apiRequest("aipkit_update_chatbot_triggers",{bot_id:ye,triggers_json:ue}).then(ze=>{F=ue,Xe(ze.message||"Saved","success"),ie("Saved","success"),_i(),oe()}).catch(ze=>{Xe(`Error: ${ze.message||"Failed to save."}`,"error"),ie("Error","error"),oe()}).finally(()=>{if(N=!1,P!==null&&P!==F){let ze=P;P=null;let st=J();st&&U(ze,st.botId)}else P=null}))},O=ue=>{if(ue===F)return;if(N){P=ue;return}let ye=J();ye&&U(ue,ye.botId)},Y=()=>{j&&clearTimeout(j),j=setTimeout(()=>{let ue=J();ue&&O(ue.triggersJson)},900)};typeof window.aipkit_requestTriggerAutosave!="function"&&(window.aipkit_requestTriggerAutosave=Y);let ce=ue=>{ue.target&&ue.target.closest(".aipkit_trigger_builder_container")&&Y()};Wn&&(Wn.addEventListener("input",ce),Wn.addEventListener("change",ce),Wn.addEventListener("click",ce)),fi&&(fi.addEventListener("input",Y),fi.addEventListener("blur",Y)),e.dataset.triggersAutosaveBound="1"}if(Tt&&!Tt.dataset.bound){let F=P=>{!Tt||!P||(Tt.classList.add("is-open"),Tt.setAttribute("aria-hidden","false"),P.setAttribute("aria-expanded","true"),gi=P,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_web_settings_modal"),gn(),window.requestAnimationFrame(()=>{nn(P)}))},N=()=>{Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true"),gi&&(gi.setAttribute("aria-expanded","false"),gi=null)};e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_web_search_config_btn");if(j){if(P.preventDefault(),Tt.classList.contains("is-open")&&gi===j){N();return}F(j)}}),Kn&&Kn.addEventListener("click",N),document.addEventListener("click",P=>{Tt.classList.contains("is-open")&&(P.target.closest(".aipkit_web_search_config_btn")||P.target.closest("#aipkit_builder_web_settings_modal")||N())}),document.addEventListener("keydown",P=>{P.key==="Escape"&&Tt.classList.contains("is-open")&&N()}),Tt.dataset.bound="1"}if(vt&&!vt.dataset.bound){let F=P=>{!vt||!P||(vt.classList.add("is-open"),vt.setAttribute("aria-hidden","false"),P.setAttribute("aria-expanded","true"),Pi=P,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_context_settings_modal"),Cn(),window.requestAnimationFrame(()=>{en(P)}))},N=()=>{vt.classList.remove("is-open"),vt.setAttribute("aria-hidden","true"),Pi&&(Pi.setAttribute("aria-expanded","false"),Pi=null)};e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_vector_store_config_btn");if(j){if(P.preventDefault(),vt.classList.contains("is-open")&&Pi===j){N();return}F(j)}}),En&&En.addEventListener("click",N),document.addEventListener("click",P=>{vt.classList.contains("is-open")&&(P.target.closest(".aipkit_vector_store_config_btn")||P.target.closest("#aipkit_builder_context_settings_modal")||N())}),document.addEventListener("keydown",P=>{P.key==="Escape"&&vt.classList.contains("is-open")&&N()}),vt.dataset.bound="1"}if(At&&!At.dataset.bound){let F=P=>{!At||!P||(At.classList.add("is-open"),At.setAttribute("aria-hidden","false"),P.setAttribute("aria-expanded","true"),Mi=P,on(),window.requestAnimationFrame(()=>{Nn(P)}))},N=()=>{At.classList.remove("is-open"),At.setAttribute("aria-hidden","true"),Mi&&(Mi.setAttribute("aria-expanded","false"),Mi=null)};e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_limit_usage_config_btn");if(j){if(P.preventDefault(),At.classList.contains("is-open")&&Mi===j){N();return}F(j)}}),Ki&&Ki.addEventListener("click",N),document.addEventListener("click",P=>{At.classList.contains("is-open")&&(P.target.closest(".aipkit_limit_usage_config_btn")||P.target.closest("#aipkit_builder_token_limits_modal")||N())}),document.addEventListener("keydown",P=>{P.key==="Escape"&&At.classList.contains("is-open")&&N()}),At.dataset.bound="1"}if(Ne&&!Ne.dataset.bound){let F=P=>{!Ne||!P||(Ne.classList.add("is-open"),Ne.setAttribute("aria-hidden","false"),P.setAttribute("aria-expanded","true"),Si=P,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_audio_settings_modal"),wn(),typeof window.aipkit_syncAudioTtsOnOpen=="function"&&window.aipkit_syncAudioTtsOnOpen().catch(()=>{}),window.requestAnimationFrame(()=>{St(P)}))},N=()=>{Ne.classList.remove("is-open"),Ne.setAttribute("aria-hidden","true"),Si&&(Si.setAttribute("aria-expanded","false"),Si=null)};e.addEventListener("click",P=>{let j=P.target.closest(".aipkit_audio_settings_config_btn");if(j){if(P.preventDefault(),Ne.classList.contains("is-open")&&Si===j){N();return}F(j)}}),lo&&lo.addEventListener("click",N),document.addEventListener("click",P=>{Ne.classList.contains("is-open")&&(P.target.closest(".aipkit_audio_settings_config_btn")||P.target.closest("#aipkit_builder_audio_settings_modal")||N())}),document.addEventListener("keydown",P=>{P.key==="Escape"&&Ne.classList.contains("is-open")&&N()}),Ne.dataset.bound="1"}if(Qe&&Bt&&!Qe.dataset.autosaveBound){let F=Qe.value.trim(),N=!1,P=null,j=ie=>{if(!m)return;let oe=m.options[m.selectedIndex];oe&&(oe.text=ie)},J=ie=>{let oe=m&&m.value||e.getAttribute("data-active-bot-id");oe&&(N=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:oe,new_name:ie}).then(U=>{let O=(U.new_name||ie).trim();F=O,Qe.value=O,j(O),Xe("Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(oe),_i()}).catch(U=>{Xe(`Error: ${U.message||"Failed to save."}`,"error")}).finally(()=>{if(N=!1,P!==null&&P!==F){let U=P;P=null,J(U)}else P=null}))};Qe.addEventListener("keydown",ie=>{ie.key==="Enter"&&(ie.preventDefault(),Qe.blur())}),Qe.addEventListener("blur",()=>{let ie=Qe.value.trim();if(!ie){Qe.value=F,Xe("Name cannot be empty.","error");return}if(ie!==F){if(N){P=ie;return}J(ie)}}),Qe.dataset.autosaveBound="1"}if(Bt&&!e.dataset.modelAutosaveBound){let F=e.querySelector(".aipkit_chatbot_provider_select");if(F){let N=!1,P=null,j=O=>{if(!O)return"";let Y=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${O}"]`);if(!Y)return"";let ce=Y.querySelector("select");return ce?ce.value:""},J=F.value||"",ie=j(J),oe=(O,Y)=>{let ce=m&&m.value||e.getAttribute("data-active-bot-id");ce&&(N=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_model_settings",{bot_id:ce,provider:O,model:Y}).then(ue=>{if(J=O,ie=Y,Xe(ue.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ce),_i(),typeof window.aipkit_requestChatbotModelSync=="function"){let ye=F?F.value||"":O,ze=j(ye);ye===O&&ze===Y&&window.aipkit_requestChatbotModelSync(O,{silent:!0})}}).catch(ue=>{Xe(`Error: ${ue.message||"Failed to save."}`,"error")}).finally(()=>{if(N=!1,P){let{provider:ue,model:ye}=P;P=null,(ue!==J||ye!==ie)&&oe(ue,ye)}}))},U=(O,Y)=>{if(!(O===J&&Y===ie)){if(N){P={provider:O,model:Y};return}oe(O,Y)}};e.addEventListener("change",O=>{let Y=O.target;if(!Y)return;if(Y.matches(".aipkit_chatbot_provider_select")){let ue=Y.value||"",ye=j(ue);U(ue,ye),b&&b.classList.contains("aipkit-active")&&Ji(),gn(),qn(),ko(),kn(),ji();return}let ce=Y.closest(".aipkit_chatbot_model_field select");if(ce){let ue=F.value||"",ye=ce.value||"";U(ue,ye),qn()}})}e.dataset.modelAutosaveBound="1"}if(Bt&&!e.dataset.deployWizardBound){let F=e.querySelector(".aipkit_deploy_wizard");if(F){let N=Array.from(F.querySelectorAll('input[name="aipkit_deploy_scope"]')),P=Array.from(F.querySelectorAll('input[name="aipkit_deploy_mode"]')),j=Array.from(F.querySelectorAll('input[name="aipkit_deploy_popup_scope"]')),J=F.querySelector('select[name="aipkit_deploy_scope"]'),ie=F.querySelector('select[name="aipkit_deploy_mode"]'),oe=F.querySelector('select[name="aipkit_deploy_popup_scope"]'),U=F.querySelector(".aipkit_deploy_row_mode"),O=F.querySelector(".aipkit_deploy_row_popup_scope"),Y=Array.from(F.querySelectorAll("[data-deploy-panel]")),ce=F.querySelector("[data-deploy-popup-shortcode]"),ue=F.querySelector('textarea[name="embed_allowed_domains"]'),ye=(He,Ke)=>{let Ye=He.find(Ve=>Ve.checked);return Ye?Ye.value:Ke},ze=()=>J?J.value||"site":ye(N,"site"),st=()=>ie?ie.value||"inline":ye(P,"inline"),nt=()=>oe?oe.value||"page":ye(j,"page"),ot=He=>{let Ke=b||C;if(!Ke)return;let Ye=Ke.querySelector(".aipkit_sidebar_toggle_group");if(!Ye)return;let Ve=Ye.querySelector(".aipkit_sidebar_toggle_switch"),dt=Ye.querySelector("label");if(!Ve||!dt)return;let zt=Ye.getAttribute("data-tooltip-disabled")||"";He?(Ve.getAttribute("data-original-state")===null&&Ve.setAttribute("data-original-state",Ve.checked?"checked":"unchecked"),Ve.checked=!1,Ve.disabled=!0,Ye.setAttribute("title",zt),Ye.classList.add("aipkit-disabled-tooltip"),dt.style.opacity="0.6"):(Ve.disabled=!1,Ye.removeAttribute("title"),Ye.classList.remove("aipkit-disabled-tooltip"),dt.style.opacity="1",Ve.getAttribute("data-original-state")==="checked"&&(Ve.checked=!0),Ve.removeAttribute("data-original-state"))},ut=He=>{let Ke=b||C;if(!Ke)return;let Ye=Ke.querySelectorAll('[data-popup-only="header-identity"]');Ye.length&&Ye.forEach(Ve=>{Ve.hidden=!He})},Kt=()=>{let He=ze(),Ke=st(),Ye=nt();U&&(U.hidden=He!=="site"),O&&(O.hidden=!(He==="site"&&Ke==="popup")),Y.forEach(dt=>{let zt=dt.dataset.deployPanel,oi=!1;zt==="external"?oi=He==="external":zt==="inline"?oi=He==="site"&&Ke==="inline":zt==="popup"&&(oi=He==="site"&&Ke==="popup"),dt.hidden=!oi}),j.forEach(dt=>{dt.disabled=He!=="site"||Ke!=="popup"}),oe&&(oe.disabled=He!=="site"||Ke!=="popup"),ie&&(ie.disabled=He!=="site"),ce&&(ce.hidden=!(He==="site"&&Ke==="popup"&&Ye==="page"));let Ve=He==="site"&&Ke==="popup";ot(Ve),ut(Ve),W&&window.requestAnimationFrame(()=>{Qi(W)})},jt=ze()==="site"?{popup_enabled:st()==="popup"?"1":"0",site_wide_enabled:st()==="popup"&&nt()==="sitewide"?"1":"0"}:null,ci=!1,kt=null,Xt=()=>{if(ze()!=="site")return null;let He=st()==="popup"?"1":"0",Ke=He==="1"&&nt()==="sitewide"?"1":"0";return{popup_enabled:He,site_wide_enabled:Ke}},It=He=>{let Ke=m&&m.value||e.getAttribute("data-active-bot-id");!Ke||!He||(ci=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",{bot_id:Ke,popup_enabled:He.popup_enabled,site_wide_enabled:He.site_wide_enabled}).then(Ye=>{jt=He,Xe(Ye.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Ke),_i()}).catch(Ye=>{Xe(`Error: ${Ye.message||"Failed to save."}`,"error")}).finally(()=>{if(ci=!1,kt){let Ye=kt;kt=null,(!jt||JSON.stringify(Ye)!==JSON.stringify(jt))&&It(Ye)}}))},ki=He=>{if(He&&!(jt&&JSON.stringify(He)===JSON.stringify(jt))){if(ci){kt=He;return}It(He)}},mi=ue?ue.value:"",Bi=!1,xe=null,Me=He=>{let Ke=m&&m.value||e.getAttribute("data-active-bot-id");Ke&&(Bi=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",{bot_id:Ke,embed_allowed_domains:He}).then(Ye=>{mi=He,Xe(Ye.message||"Saved","success"),_i()}).catch(Ye=>{Xe(`Error: ${Ye.message||"Failed to save."}`,"error")}).finally(()=>{if(Bi=!1,xe!==null){let Ye=xe;xe=null,Ye!==mi&&Me(Ye)}}))},Je=He=>{if(He!==mi){if(Bi){xe=He;return}Me(He)}};F.addEventListener("change",He=>{let Ke=He.target;Ke&&(Ke.matches('input[name="aipkit_deploy_scope"]')||Ke.matches('input[name="aipkit_deploy_mode"]')||Ke.matches('input[name="aipkit_deploy_popup_scope"]')||Ke.matches('select[name="aipkit_deploy_scope"]')||Ke.matches('select[name="aipkit_deploy_mode"]')||Ke.matches('select[name="aipkit_deploy_popup_scope"]'))&&(Kt(),ki(Xt()))}),ue&&(ue.addEventListener("blur",()=>{Je(ue.value)}),ue.addEventListener("change",()=>{Je(ue.value)})),Kt(),e.dataset.deployWizardBound="1"}}if(I&&Bt&&!e.dataset.aiParamsAutosaveBound){let F=!1,N=null,P=()=>{let Y=ze=>Rt&&Rt.querySelector(ze)||I.querySelector(ze),ce=Y('[name="temperature"]'),ue=Y('[name="max_completion_tokens"]'),ye=Y('[name="max_messages"]');return{temperature:ce?ce.value:"",maxTokens:ue?ue.value:"",maxMessages:ye?ye.value:""}},{temperature:j,maxTokens:J,maxMessages:ie}=P(),oe=(Y,ce,ue)=>{let ye=m&&m.value||e.getAttribute("data-active-bot-id");!ye||Y===""||ce===""||ue===""||(F=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_ai_parameters",{bot_id:ye,temperature:Y,max_completion_tokens:ce,max_messages:ue}).then(ze=>{j=Y,J=ce,ie=ue,Xe(ze.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ye),_i()}).catch(ze=>{Xe(`Error: ${ze.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N){let{temperature:ze,maxTokens:st,maxMessages:nt}=N;N=null,(ze!==j||st!==J||nt!==ie)&&oe(ze,st,nt)}}))},U=(Y,ce,ue)=>{if(!(Y===j&&ce===J&&ue===ie)){if(F){N={temperature:Y,maxTokens:ce,maxMessages:ue};return}oe(Y,ce,ue)}},O=Y=>{let ce=Y.target;if(ce&&(ce.matches('[name="temperature"]')||ce.matches('[name="max_completion_tokens"]')||ce.matches('[name="max_messages"]'))){let{temperature:ue,maxTokens:ye,maxMessages:ze}=P();U(ue,ye,ze)}};I.addEventListener("change",O),Rt&&Rt.addEventListener("change",O),e.dataset.aiParamsAutosaveBound="1"}if((Tt||I)&&Bt&&!e.dataset.webSettingsAutosaveBound){let F=!1,N=null,P=()=>{let U=Y=>{let ce=Tt?Tt.querySelector(Y):null;return ce?ce.value:""},O=Y=>{let ce=I&&I.querySelector(Y)||e&&e.querySelector(Y)||Tt&&Tt.querySelector(Y);return ce?ce.tagName==="SELECT"?ce.value==="1"?"1":"0":ce.checked?"1":"0":"0"};return{openai_web_search_enabled:O(".aipkit_openai_web_search_enable_toggle"),openai_web_search_context_size:U('[name="openai_web_search_context_size"]'),openai_web_search_loc_type:U('[name="openai_web_search_loc_type"]'),openai_web_search_loc_country:U('[name="openai_web_search_loc_country"]'),openai_web_search_loc_city:U('[name="openai_web_search_loc_city"]'),openai_web_search_loc_region:U('[name="openai_web_search_loc_region"]'),openai_web_search_loc_timezone:U('[name="openai_web_search_loc_timezone"]'),claude_web_search_enabled:O(".aipkit_claude_web_search_enable_toggle"),claude_web_search_max_uses:U('[name="claude_web_search_max_uses"]'),claude_web_search_loc_type:U('[name="claude_web_search_loc_type"]'),claude_web_search_loc_country:U('[name="claude_web_search_loc_country"]'),claude_web_search_loc_city:U('[name="claude_web_search_loc_city"]'),claude_web_search_loc_region:U('[name="claude_web_search_loc_region"]'),claude_web_search_loc_timezone:U('[name="claude_web_search_loc_timezone"]'),claude_web_search_allowed_domains:U('[name="claude_web_search_allowed_domains"]'),claude_web_search_blocked_domains:U('[name="claude_web_search_blocked_domains"]'),claude_web_search_cache_ttl:U('[name="claude_web_search_cache_ttl"]'),google_search_grounding_enabled:O(".aipkit_google_search_grounding_enable_toggle"),google_grounding_mode:U('[name="google_grounding_mode"]'),google_grounding_dynamic_threshold:U('[name="google_grounding_dynamic_threshold"]')}},j=P(),J=U=>{let O=m&&m.value||e.getAttribute("data-active-bot-id");O&&(F=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_web_settings",{bot_id:O,...U}).then(Y=>{j=U,Xe(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),_i()}).catch(Y=>{Xe(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N){let Y=N;N=null,JSON.stringify(Y)!==JSON.stringify(j)&&J(Y)}}))},ie=U=>{if(JSON.stringify(U)!==JSON.stringify(j)){if(F){N=U;return}J(U)}},oe=U=>{let O=U.target;O&&(O.matches(".aipkit_openai_web_search_enable_toggle")||O.matches(".aipkit_openai_web_search_loc_type_select")||O.matches('[name="openai_web_search_context_size"]')||O.matches('[name="openai_web_search_loc_country"]')||O.matches('[name="openai_web_search_loc_city"]')||O.matches('[name="openai_web_search_loc_region"]')||O.matches('[name="openai_web_search_loc_timezone"]')||O.matches(".aipkit_claude_web_search_enable_toggle")||O.matches(".aipkit_claude_web_search_loc_type_select")||O.matches('[name="claude_web_search_max_uses"]')||O.matches('[name="claude_web_search_loc_country"]')||O.matches('[name="claude_web_search_loc_city"]')||O.matches('[name="claude_web_search_loc_region"]')||O.matches('[name="claude_web_search_loc_timezone"]')||O.matches('[name="claude_web_search_allowed_domains"]')||O.matches('[name="claude_web_search_blocked_domains"]')||O.matches('[name="claude_web_search_cache_ttl"]')||O.matches(".aipkit_google_search_grounding_enable_toggle")||O.matches(".aipkit_google_grounding_mode_select")||O.matches('[name="google_grounding_dynamic_threshold"]'))&&(gn(),ie(P()))};I&&I.addEventListener("change",oe),Tt&&Tt.addEventListener("change",oe),e.dataset.webSettingsAutosaveBound="1"}if((vt||I)&&Bt&&!e.dataset.contextSettingsAutosaveBound){let F=!1,N=null,P=()=>{let ee=X=>{let re=Ni(),de=re?re.querySelector(X):null;return de?de.value:""},D=X=>{let re=I&&I.querySelector(X)||e&&e.querySelector(X)||vt&&vt.querySelector(X);return re?re.tagName==="SELECT"?re.value==="1"?"1":"0":re.checked?"1":"0":"0"},z=X=>{let re=Ni(),de=re?re.querySelector(X):null;return de?Array.from(de.selectedOptions).map(le=>le.value).filter(Boolean):[]};return{enable_vector_store:D(".aipkit_vector_store_enable_select"),vector_store_provider:ee('[name="vector_store_provider"]'),openai_vector_store_ids:z('select[name="openai_vector_store_ids[]"]'),pinecone_index_name:ee('[name="pinecone_index_name"]'),qdrant_collection_names:z('select[name="qdrant_collection_names[]"]'),vector_embedding_provider:ee('[name="vector_embedding_provider"]'),vector_embedding_model:ee('[name="vector_embedding_model"]'),vector_store_top_k:ee('[name="vector_store_top_k"]'),vector_store_confidence_threshold:ee('[name="vector_store_confidence_threshold"]'),content_aware_enabled:D(".aipkit_content_aware_enable_select")}},j=P(),J=I&&I.closest(".aipkit_model_settings_popover")?.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline")||vt&&vt.querySelector(".aipkit_popover_flyout_header .aipkit_popover_status_inline")||vt&&vt.querySelector(".aipkit_popover_status_inline")||I&&I.querySelector(".aipkit_popover_status_inline")||null,ie=(ee,D)=>{J&&(J.textContent=ee||"",J.classList.remove("success","error","loading"),D&&J.classList.add(D),J.style.display=ee?"inline-block":"none")},oe=()=>{J&&setTimeout(()=>{J.textContent="",J.classList.remove("success","error","loading"),J.style.display="none"},2500)},U=!1,O=null,Y={},ce=Ni();ce&&ce.querySelectorAll('[name="pinecone_api_key"], [name="qdrant_url"], [name="qdrant_api_key"]').forEach(ee=>{Y[ee.name]=ee.value});let ue=()=>{let{pineconeKeyInput:ee,qdrantUrlInput:D,qdrantKeyInput:z}=Gi(),X=!!(ee&&ee.value.trim()||d),re=!!(D&&D.value.trim()||l),de=!!(z&&z.value.trim()||o);return{pinecone:X,qdrant:re&&de}},ye=0,ze=(ee,D)=>ee?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(ee,{silent:!0,showErrors:!1,targetSelectId:D,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,ee,{silent:!0,showErrors:!1,targetSelectId:D,propagateError:!0}):null:null,st=(ee,D)=>{let z=++ye;ie("Syncing...","loading");let X=ze(ee,D);if(X&&typeof X.then=="function"){X.then(()=>{ye===z&&(ie("Synced","success"),oe())}).catch(re=>{ye===z&&ie(`Error: ${re.message||"Sync failed."}`,"error")});return}oe()},nt=ee=>{let D=ue();if(ee==="pinecone"&&D.pinecone){let{pineconeIndexSelect:z}=Gi();st("PineconeIndexes",z?z.id:"")}else if(ee==="qdrant"&&D.qdrant){let{qdrantCollectionsSelect:z}=Gi();st("QdrantCollections",z?z.id:"")}},ot=ee=>{!ee||!Object.keys(ee).length||(U=!0,ie("Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",ee).then(D=>{Object.keys(ee).forEach(z=>{Y[z]=ee[z]}),Object.prototype.hasOwnProperty.call(ee,"pinecone_api_key")&&nt("pinecone"),(Object.prototype.hasOwnProperty.call(ee,"qdrant_url")||Object.prototype.hasOwnProperty.call(ee,"qdrant_api_key"))&&nt("qdrant"),ie(D.message||"Saved","success"),oe()}).catch(D=>{ie(`Error: ${D.message||"Failed to save."}`,"error")}).finally(()=>{if(U=!1,O){let D=O;O=null,ot(D)}}))},ut=ee=>{if(!ee)return;let D=Object.keys(ee).reduce((z,X)=>(ee[X]!==Y[X]&&(z[X]=ee[X]),z),{});if(Object.keys(D).length){if(U){O={...O||{},...D};return}ot(D)}},Kt=ee=>{let D=m&&m.value||e.getAttribute("data-active-bot-id");D&&(F=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_context_settings",{bot_id:D,...ee}).then(z=>{j=ee,Xe(z.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(D),_i()}).catch(z=>{Xe(`Error: ${z.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N){let z=N;N=null,JSON.stringify(z)!==JSON.stringify(j)&&Kt(z)}}))},jt=ee=>{if(JSON.stringify(ee)!==JSON.stringify(j)){if(F){N=ee;return}Kt(ee)}},ci=ee=>{let D=ee.target;if(D){if(D.matches('[name="pinecone_api_key"]')||D.matches('[name="qdrant_url"]')||D.matches('[name="qdrant_api_key"]')){let z=D.value||"";ut({[D.name]:z}),ji(),Wi(P());return}if(D.matches(".aipkit_vector_store_enable_select")||D.matches(".aipkit_vector_store_provider_select")||D.matches('select[name="openai_vector_store_ids[]"]')||D.matches('select[name="qdrant_collection_names[]"]')||D.matches('[name="pinecone_index_name"]')||D.matches(".aipkit_vector_embedding_select")||D.matches('[name="vector_embedding_provider"]')||D.matches('[name="vector_embedding_model"]')||D.matches('[name="vector_store_top_k"]')||D.matches('[name="vector_store_confidence_threshold"]')||D.matches('[name="content_aware_enabled"]')){if(D.matches(".aipkit_vector_embedding_select")&&Eo(D),D.matches(".aipkit_vector_store_enable_select")&&(Rn(),nt(P().vector_store_provider)),D.matches(".aipkit_vector_store_provider_select")&&(Cn(),nt(D.value||""),kn(),ji()),D.matches('[name="vector_embedding_provider"]')){let X=Ni();X&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(X),sn(X)}if(D.matches('[name="vector_embedding_model"]')){let X=Ni();sn(X)}let z=P();jt(z),ji(),Wi(z),ki(z),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(1)}}};I&&I.addEventListener("change",ci),vt&&vt.addEventListener("change",ci);let kt=(ee,D)=>{Wt&&(Wt.textContent=ee||"",Wt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ee&&Wt.classList.add("is-visible"),D&&Wt.classList.add(`is-${D}`))},Xt=(ee=2500)=>{Wt&&setTimeout(()=>{Wt.textContent="",Wt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading")},ee)},It=(ee,D="info")=>{if(gt){if(typeof window.aipkit_showOpenAIVectorStatus=="function"){window.aipkit_showOpenAIVectorStatus(ee||"",D,gt.id);return}gt.textContent=ee||""}},ki=(ee=null)=>{if(!We)return;let D=ee||P();if(!D||D.enable_vector_store!=="1"){We.innerHTML='<option value=""></option>',We.value="";return}let z="";D.vector_store_provider==="openai"?z=(Array.isArray(D.openai_vector_store_ids)?D.openai_vector_store_ids.filter(Boolean):[])[0]||"":D.vector_store_provider==="pinecone"?z=D.pinecone_index_name||"":D.vector_store_provider==="qdrant"&&(z=(Array.isArray(D.qdrant_collection_names)?D.qdrant_collection_names.filter(Boolean):[])[0]||""),We.innerHTML=z?`<option value="${z}">${z}</option>`:'<option value=""></option>',We.value=z,We.dispatchEvent(new Event("change"))},mi=()=>Pt&&Pt.value||"bulk",Bi=ee=>{let D=ee==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",z=document.getElementById(D);return z?Array.from(z.selectedOptions).map(X=>X.value).filter(Boolean):[]},xe=ee=>{let D=ee==="specific"?Li:xi;return D&&D.value||"publish"},Me=()=>{let ee=document.getElementById("aipkit_vs_wp_content_list_area");return ee?Array.from(ee.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(D=>D.value):[]},Je=(ee,D,z)=>{if(!D)return;D.innerHTML="";let X=Number(ee?.total_posts||0),re=Number(ee?.total_pages||0),de=Number(ee?.current_page||1);if(!X)return;let le=document.createElement("span");if(le.className="aipkit_pagination-count",le.textContent=`${X.toLocaleString()} ${s("item","items",X,"gpt3-ai-content-generator")}`,D.appendChild(le),re<=1)return;let me=document.createElement("span");me.className="aipkit_pagination-links";let he=document.createElement("button");he.type="button",he.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",he.textContent=i("Prev","gpt3-ai-content-generator"),he.disabled=de<=1,he.addEventListener("click",()=>z(de-1));let Te=document.createElement("span");Te.className="aipkit_pagination-current",Te.textContent=`${de}/${re}`;let Ie=document.createElement("button");Ie.type="button",Ie.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Ie.textContent=i("Next","gpt3-ai-content-generator"),Ie.disabled=de>=re,Ie.addEventListener("click",()=>z(de+1)),me.appendChild(he),me.appendChild(Te),me.appendChild(Ie),D.appendChild(me)},He=(ee,D)=>{if(!Ft)return;if(Ft.innerHTML="",!Array.isArray(ee)||!ee.length){let le=document.createElement("p");le.className="aipkit_builder_help_text",le.textContent=i("No posts found for selection.","gpt3-ai-content-generator"),Ft.appendChild(le),bt&&(bt.innerHTML="");return}let z=document.createElement("ul"),X=document.createElement("div");X.className="aipkit_wp_content_select_all_wrapper";let re=document.createElement("label");re.className="aipkit_training_site_option";let de=document.createElement("input");de.type="checkbox",de.checked=ee.every(le=>Be.selectedIds.has(String(le.id))),re.appendChild(de),re.appendChild(document.createTextNode(i("Select all","gpt3-ai-content-generator"))),X.appendChild(re),Ft.appendChild(X),Ft.appendChild(z),ee.forEach(le=>{let me=document.createElement("li");me.className="aipkit_wp_content_list_item";let he=document.createElement("input");he.type="checkbox",he.name="wp_content_to_index[]",he.value=String(le.id),he.checked=Be.selectedIds.has(String(le.id)),he.addEventListener("change",()=>{he.checked?Be.selectedIds.add(String(le.id)):Be.selectedIds.delete(String(le.id)),de.checked=ee.every(Ue=>Be.selectedIds.has(String(Ue.id)))});let Te=document.createElement("a");Te.className="aipkit_wp_content_title",Te.href=le.edit_link||"#",Te.target="_blank",Te.rel="noopener noreferrer",Te.textContent=le.title||i("Untitled","gpt3-ai-content-generator");let Ie=document.createElement("span");Ie.className="aipkit_wp_content_type",Ie.textContent=le.type_label||"";let Le=document.createElement("span");Le.className="aipkit_wp_content_indexed_status",Le.textContent=le.is_already_indexed?i("Indexed","gpt3-ai-content-generator"):"",me.appendChild(he),me.appendChild(Te),me.appendChild(Ie),me.appendChild(Le),z.appendChild(me)}),de.addEventListener("change",()=>{de.checked?ee.forEach(le=>Be.selectedIds.add(String(le.id))):ee.forEach(le=>Be.selectedIds.delete(String(le.id))),Ft.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(le=>{le.checked=de.checked})}),Je(D,bt,Ke)},Ke=async ee=>{if(!Ft)return;let D=mi(),z=Bi(D);if(!z.length){Ft.innerHTML="",bt&&(bt.innerHTML=""),It(i("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let X=vi("aipkit_wp_content_fetch_nonce");if(!X){It(i("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let re=xe(D),de=We&&We.value||"";try{It(i("Loading content...","gpt3-ai-content-generator"),"");let le=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:X,post_types:z,post_status:re,target_store_id:de,paged:ee});Be.page=ee,He(le.posts||[],le.pagination||{}),It("","")}catch(le){It(le&&le.message?le.message:i("Failed to load content.","gpt3-ai-content-generator"),"error")}},Ye=ee=>{Pt&&(Pt.value=ee),Jt&&(Jt.hidden=ee!=="bulk"),ti&&(ti.hidden=ee!=="specific"),di&&(di.hidden=ee!=="specific"),fe&&(fe.hidden=ee!=="bulk"),Fe&&(Fe.hidden=ee!=="specific"),Hi&&(Hi.hidden=ee!=="bulk"),ee==="specific"&&Ke(1)},Ve=()=>{e.querySelectorAll(".aipkit_training_site_dropdown").forEach(D=>{let z=D.querySelector(".aipkit_training_site_dropdown_btn"),X=D.querySelector(".aipkit_training_site_dropdown_label"),re=D.querySelector(".aipkit_training_site_dropdown_panel"),le=D.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",me=document.getElementById(le);if(!z||!re||!me)return;let he=()=>{let Ie=re.querySelectorAll('input[type="checkbox"]:checked'),Le=D.dataset.placeholder||i("Select types","gpt3-ai-content-generator"),Ue=D.dataset.selectedLabel||i("selected","gpt3-ai-content-generator");X&&(Ie.length?X.textContent=`${Ie.length} ${Ue}`:X.textContent=Le)},Te=()=>{let Ie=Array.from(re.querySelectorAll('input[type="checkbox"]:checked')).map(Le=>Le.value);Array.from(me.options).forEach(Le=>{Le.selected=Ie.includes(Le.value)})};z.addEventListener("click",()=>{let Ie=z.getAttribute("aria-expanded")==="true";z.setAttribute("aria-expanded",Ie?"false":"true"),re.hidden=Ie}),re.addEventListener("change",()=>{Te(),he(),mi()==="specific"&&Ke(1)}),document.addEventListener("click",Ie=>{D.contains(Ie.target)||(z.setAttribute("aria-expanded","false"),re.hidden=!0)}),Te(),he()})},dt=async(ee,D,z)=>{let X=vi("aipkit_wp_content_fetch_nonce");if(!X||!ee.length)return{total:0};let re=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:X,post_types:ee,post_status:D,target_store_id:z||"",paged:1}),de=parseInt(re?.pagination?.total_posts||0,10);return{total:Number.isNaN(de)?0:de,totalPages:parseInt(re?.pagination?.total_pages||1,10)}},zt=async(ee,D,z)=>{let X=vi("aipkit_wp_content_fetch_nonce");if(!X)throw new Error("WP content fetch nonce missing.");let re=[],de=1,le=1;do{let me=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:X,post_types:ee,post_status:D,target_store_id:z||"",paged:de}),he=Array.isArray(me?.posts)?me.posts:[];he.length&&(window.aipkit_wpContentTitleMap=window.aipkit_wpContentTitleMap||{},he.forEach(Ie=>{Ie&&Ie.id&&(window.aipkit_wpContentTitleMap[String(Ie.id)]=Ie.title||window.aipkit_wpContentTitleMap[String(Ie.id)]||"")})),re.push(...he.map(Ie=>String(Ie.id)));let Te=parseInt(me?.pagination?.total_pages||1,10);le=Number.isNaN(Te)?1:Te,It(`Preparing... collected ${re.length} item(s).`,"info"),de+=1}while(de<=le);return re},oi=(ee,D)=>ee<=200||D!=="publish"?Promise.resolve(!1):new Promise(z=>{let X=document.getElementById("aipkit_background_indexing_confirm"),re=document.getElementById("aipkit_background_indexing_message"),de=document.getElementById("aipkit_background_indexing_yes"),le=document.getElementById("aipkit_background_indexing_no"),me=document.getElementById("aipkit_wp_content_bulk_hint");if(!X||!re||!de||!le){z(window.confirm(`You're about to index ${ee} items. Run in the background?`));return}re.textContent=`You're about to index ${ee} items. Run in the background?`,me&&(me.hidden=!0),X.hidden=!1;let he=()=>{X.hidden=!0,me&&(me.hidden=!1),de.removeEventListener("click",Te),le.removeEventListener("click",Ie)},Te=()=>{he(),z(!0)},Ie=()=>{he(),z(!1)};de.addEventListener("click",Te),le.addEventListener("click",Ie)}),Ii=async({botId:ee,postTypes:D,provider:z,targetStoreId:X,embeddingProvider:re,embeddingModel:de})=>{let le=window.aipkit_chat_config?.automationsNonce||"";if(!le)throw new Error("Automations nonce missing.");let me=`Chatbot ${ee} website indexing`,he={_ajax_nonce:le,task_id:0,task_name:me,task_type:"content_indexing",task_status:"active",task_frequency:"one-time",index_existing_now_flag:"1",only_new_updated_flag:"0",post_types:D,target_store_provider:z,target_store_id:X};return(z==="pinecone"||z==="qdrant")&&(he.embedding_provider=re||"",he.embedding_model=de||""),window.aipkit_apiRequest("aipkit_save_automated_task",he)};if(Pt&&!e.dataset.trainingWebsiteBound){if(typeof window.aipkit_initWpContentModeToggle=="function"&&window.aipkit_initWpContentModeToggle(),qt&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&!qt.dataset.listenerAttached&&(qt.addEventListener("click",()=>{window.aipkit_fetchWordPressContentForTraining(1)}),qt.dataset.listenerAttached="true"),typeof window.aipkit_updatePostTypeCounts=="function"&&(window.aipkit_updatePostTypeCounts(),xi&&!xi.dataset.listenerAttached&&(xi.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),xi.dataset.listenerAttached="true"),We&&!We.dataset.listenerAttached&&(We.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),We.dataset.listenerAttached="true")),ki(P()),Ve(),Qt.length){Qt.forEach(D=>{D.dataset.listenerAttached||(D.addEventListener("change",()=>{Ye(D.value)}),D.dataset.listenerAttached="true")});let ee=Array.from(Qt).find(D=>D.checked);Ye(ee?ee.value:mi())}else Ye(mi());Li&&!Li.dataset.listenerAttached&&(Li.addEventListener("change",()=>{mi()==="specific"&&Ke(1)}),Li.dataset.listenerAttached="true"),We&&!We.dataset.websiteListenerAttached&&(We.addEventListener("change",()=>{mi()==="specific"&&Ke(1)}),We.dataset.websiteListenerAttached="true"),e.dataset.trainingWebsiteBound="1"}let an=ee=>`${ee.name}::${ee.size}::${ee.lastModified}`,zi=ee=>{if(!Number.isFinite(ee)||ee<=0)return"0 KB";let D=["B","KB","MB","GB"],z=ee,X=0;for(;z>=1024&&X<D.length-1;)z/=1024,X+=1;let re=X===0?0:1;return`${z.toFixed(re)} ${D[X]}`},vn=()=>ri&&ri.dataset.upgradeUrl||"",bn=()=>{if(!Pe)return;let ee=Ht.size>0;Pe.style.display=ee?"none":""},Ln=(ee=1500)=>{ri&&(ht&&window.clearTimeout(ht),ht=window.setTimeout(()=>{Ht.clear(),ri.innerHTML="",_e&&(_e.value=""),bn(),ht=null},ee))},yo=()=>Ht.size?Array.from(Ht.values()).every(ee=>{let D=ee.querySelector(".aipkit_training_file_status");return D?D.classList.contains("is-success")||D.classList.contains("is-error"):!1}):!1,vo=()=>{ht&&!yo()&&(window.clearTimeout(ht),ht=null),yo()&&Ln(),bn()},qi=ee=>{if(!ri)return null;let D=an(ee);if(Ht.has(D))return Ht.get(D);let z=document.createElement("div");z.className="aipkit_training_file_row",z.dataset.fileKey=D;let X=document.createElement("div");X.className="aipkit_training_file_meta";let re=document.createElement("span");re.className="aipkit_training_file_name",re.textContent=ee.name;let de=document.createElement("span");de.className="aipkit_training_file_size",de.textContent=zi(ee.size);let le=document.createElement("span");return le.className="aipkit_training_file_status",le.textContent="Queued",X.appendChild(re),X.appendChild(de),z.appendChild(X),z.appendChild(le),ri.appendChild(z),Ht.set(D,z),z},Ei=(ee,D,z)=>{let X=qi(ee);if(!X)return;let re=X.querySelector(".aipkit_training_file_status");if(re){if(re.textContent="",re.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),z&&re.classList.add(`is-${z}`),D==="Upgrade"&&vn()){re.classList.add("is-upgrade");let de=document.createElement("a");de.className="aipkit_training_file_upgrade",de.href=vn(),de.textContent=D,re.appendChild(de)}else re.textContent=D;vo()}},Tn=async(ee,D=null)=>{if(!ee||!ee.name||typeof window.aipkit_apiRequest!="function")return!1;let z=m&&m.value||e.getAttribute("data-active-bot-id");if(!z)return!1;let X=D||P();if(!X||X.enable_vector_store!=="1")return!1;let re=String(ee.name||"").trim();if(!re)return!1;let de=Le=>String(Le||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),le=de(re),me=re.replace(/\.[^/.]+$/,""),he=[re,le,me&&me!==re?me:""].filter(Boolean),Te=async(Le,Ue)=>{let Ut=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",{bot_id:z,page:1,per_page:Ue,search:Le||"",enable_vector_store:X.enable_vector_store,vector_store_provider:X.vector_store_provider,openai_vector_store_ids:X.openai_vector_store_ids||[],pinecone_index_name:X.pinecone_index_name,qdrant_collection_names:X.qdrant_collection_names||[]});return Array.isArray(Ut.logs)?Ut.logs:[]},Ie=(Le,Ue)=>{if(!Le.length)return null;let Ut=Ue.map(de).filter(Boolean);return Le.find(mt=>{let Et=de(mt.message),yt=de(mt.post_title),Ae=de(mt.file_id);return Ut.some(tt=>Et&&Et.includes(tt)||yt&&yt.includes(tt)||Ae&&Ae.includes(tt))})||null};try{for(let Ut of he){let mt=await Te(Ut,10),Et=Ie(mt,[Ut,le]);if(Et){let yt=String(Et.status||"").toLowerCase();if(yt==="indexed"||yt==="skipped_already_indexed")return Ei(ee,"Trained","success"),!0;if(yt==="failed")return Ei(ee,"Failed","error"),!0;if(yt==="processing"||yt==="queued")return Ei(ee,"Processing","loading"),!0}}let Le=await Te("",20),Ue=Ie(Le,he);if(Ue){let Ut=String(Ue.status||"").toLowerCase();if(Ut==="indexed"||Ut==="skipped_already_indexed")return Ei(ee,"Trained","success"),!0;if(Ut==="failed")return Ei(ee,"Failed","error"),!0;if(Ut==="processing"||Ut==="queued")return Ei(ee,"Processing","loading"),!0}}catch{}return!1},eo=(ee,D,z,X=0)=>{if(!ee||!D||!z)return;if(X>=30){Tn(z,P()).then(le=>{le||Ei(z,"Queued","warning")});return}let de=vi("aipkit_vector_store_nonce_openai");if(!de||typeof window.aipkit_apiRequest!="function"){Tn(z,P());return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:ee,batch_id:D,_ajax_nonce:de}).then(le=>{let me=(le.status||"").toLowerCase();if(me==="completed"){Ei(z,"Trained","success"),Wi(P()),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}if(me==="failed"||me==="cancelled"){Ei(z,"Failed","error");return}Ei(z,"Processing","loading"),setTimeout(()=>{eo(ee,D,z,X+1)},2500)}).catch(()=>{setTimeout(()=>{eo(ee,D,z,X+1)},3e3)})},rn=ee=>{if(!qe)return;let D=qe.dataset.baseLabel||qe.querySelector(".aipkit_training_sources_label")?.textContent.trim()||qe.textContent.replace(/\(\d+\)/,"").trim(),z=Number.isFinite(ee)?ee:0,X=qe.querySelector(".aipkit_training_sources_count");X?(X.textContent=String(z),qe.setAttribute("aria-label",`${D} (${z})`)):qe.textContent=`${D} (${z})`},Wi=async(ee=null)=>{if(!qe||typeof window.aipkit_apiRequest!="function")return;if(ee&&ee.enable_vector_store!=="1"){rn(0);return}let D=ee?ee.vector_store_provider:"";if(D==="openai"&&!(Array.isArray(ee.openai_vector_store_ids)?ee.openai_vector_store_ids:[]).length){rn(0);return}if(D==="pinecone"&&!ee.pinecone_index_name){rn(0);return}if(D==="qdrant"&&!(Array.isArray(ee.qdrant_collection_names)?ee.qdrant_collection_names:[]).length){rn(0);return}let z=m&&m.value||e.getAttribute("data-active-bot-id");if(!z){rn(0);return}try{let X={bot_id:z};ee&&(X.enable_vector_store=ee.enable_vector_store,X.vector_store_provider=ee.vector_store_provider,X.openai_vector_store_ids=ee.openai_vector_store_ids||[],X.pinecone_index_name=ee.pinecone_index_name,X.qdrant_collection_names=ee.qdrant_collection_names||[]);let re=await window.aipkit_apiRequest("aipkit_get_chatbot_training_source_count",X),de=Number(re.count||0);rn(Number.isNaN(de)?0:de)}catch{}};window.aipkit_refreshTrainingSourcesCount=()=>{Wi(P())};let to=()=>{if(!qe||e.dataset.trainingAutoSync)return;let ee=()=>{document.visibilityState==="visible"&&Wi(P())},D=window.setInterval(ee,6e4);e.dataset.trainingAutoSync="1",e.dataset.trainingAutoSyncInterval=String(D),document.addEventListener("visibilitychange",ee)},vi=ee=>{let D=document.getElementById(ee);return D?D.value:""},$o=ee=>{let D=String(ee),z=window.aipkit_wpContentTitleMap||{};if(z&&z[D])return z[D];if(Ft){let X=Ft.querySelector(`input[name="wp_content_to_index[]"][value="${D}"]`);if(X){let re=X.closest(".aipkit_wp_content_list_item"),de=re?re.querySelector(".aipkit_wp_content_title"):null,le=de?de.textContent.trim():"";if(le)return le}}return`${i("Post","gpt3-ai-content-generator")} ${D}`},Hn=(ee,D,z)=>{let X=$o(ee);return`${i("Training","gpt3-ai-content-generator")}: ${X} (${D+1}/${z})`},Pn=async ee=>{let D=vi("aipkit_wp_content_fetch_nonce");if(!D)throw new Error("WP content fetch nonce missing.");let z=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:D,get_content_for_ids:[String(ee)]});return(z&&z.posts_content?z.posts_content:{})[String(ee)]||null},io=async(ee,D,z)=>{if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let X=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ee,embedding_provider:D,embedding_model:z,_ajax_nonce:window.aipkit_dashboard.nonce}),re=X.embeddings&&X.embeddings.length?X.embeddings[0]:null;if(!re)throw new Error("Failed to generate embedding.");return re},Fo=async(ee,D)=>{let z=Array.isArray(ee)?ee:[];if(z.length)for(let X=0;X<z.length;X+=1){if(window.aipkit_isIndexingStopped){It(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let re=z[X];It(Hn(re,X,z.length),"info"),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{...D,post_ids:[re]})}},Sn=async(ee,D)=>{let z=Array.isArray(ee)?ee:[];if(z.length)for(let X=0;X<z.length;X+=1){if(window.aipkit_isIndexingStopped){It(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let re=z[X]||{},de=re.postId||re.id;if(!de)continue;It(Hn(de,X,z.length),"info");let le=await Pn(de);if(!le||!le.content)continue;let me=re.metadata&&re.metadata.vector_id||`wp_post_${de}`,he={source:"wordpress_post",created_at:new Date().toISOString(),post_id:de,title:le.title||"",url:le.edit_link||"",vector_id:me},Te=await io(le.content,D.embedding_provider,D.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:D._ajax_nonce,vectors:JSON.stringify([{id:me,values:Te,metadata:he}]),embedding_provider:D.embedding_provider,embedding_model:D.embedding_model,original_text_content:le.content,index_name:D.index_name})}},bo=async(ee,D)=>{let z=Array.isArray(ee)?ee:[];if(z.length)for(let X=0;X<z.length;X+=1){if(window.aipkit_isIndexingStopped){It(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let re=z[X]||{},de=re.postId||re.id;if(!de)continue;It(Hn(de,X,z.length),"info");let le=await Pn(de);if(!le||!le.content)continue;let me=a(),he={source:"wordpress_post",created_at:new Date().toISOString(),post_id:de,title:le.title||"",url:le.edit_link||"",vector_id:me},Te=await io(le.content,D.embedding_provider,D.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",{_ajax_nonce:D._ajax_nonce,vectors:JSON.stringify([{id:me,vector:Te,payload:he}]),embedding_provider:D.embedding_provider,embedding_model:D.embedding_model,original_text_content:le.content,collection_name:D.collection_name,source_context:"chatbot_settings_website"})}};typeof window.aipkit_indexOpenAIBatch!="function"&&(window.aipkit_indexOpenAIBatch=Fo),typeof window.aipkit_indexPineconeBatch!="function"&&(window.aipkit_indexPineconeBatch=Sn),typeof window.aipkit_indexQdrantBatch!="function"&&(window.aipkit_indexQdrantBatch=bo);let Vn=ee=>ee?Array.isArray(ee)?ee.flatMap(D=>{if(Array.isArray(D))return D;if(D&&typeof D=="object"){if(Array.isArray(D.models))return D.models;if(Array.isArray(D.items))return D.items;if(D.id)return[D]}return[]}):typeof ee=="object"?Object.values(ee).flatMap(D=>Array.isArray(D)?D:[]):[]:[],So=ee=>{let D=window.aipkit_chat_config||{};return ee==="openai"?Vn(D.openaiEmbeddingModels):ee==="google"?Vn(D.googleEmbeddingModels):ee==="azure"?Vn(D.azureEmbeddingModels):[]},No=(ee,D)=>!ee||!D?"":`${ee}::${D}`,Ro=ee=>{let D=(ee||"").split("::"),z=D.shift()||"",X=D.join("::")||"";return{provider:z,model:X}},sn=ee=>{if(!ee)return;let D=ee.querySelector(".aipkit_vector_embedding_select");if(!D)return;let z=ee.querySelector('[name="vector_embedding_provider"]'),X=ee.querySelector('[name="vector_embedding_model"]'),re=z?z.value:"",de=X?X.value:"",le=No(re,de);if(!le||D.value===le)return;let me=typeof CSS<"u"&&CSS.escape?CSS.escape(le):le.replace(/"/g,'\\"');D.querySelector(`option[value="${me}"]`)&&(D.value=le)},Eo=ee=>{let D=Ni();if(!D||!ee)return;let z=D.querySelector('[name="vector_embedding_provider"]'),X=D.querySelector('[name="vector_embedding_model"]'),re=ee.selectedOptions[0],de=re&&re.dataset.provider||"",le=ee.value||"";z&&(z.value=de),X&&(X.value=le),z&&X&&de&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&(X.value=le,window.aipkit_populateVectorEmbeddingModelSelect(D),le&&(X.value=le))},xo=(ee,D)=>{if(!D)return null;let X=So(ee).find(le=>le&&le.id===D),re=X?.dimensions||X?.dimension||X?.output_dimensionality||X?.outputDimensionality||X?.output_dimension,de=re?Number(re):NaN;if(Number.isFinite(de)&&de>0)return de;if(X&&typeof X.name=="string"){let le=X.name.match(/\((\d{3,5})\)/);if(le)return Number(le[1])}return ee==="google"?768:1536},no=()=>{let{pineconeKeyInput:ee,qdrantUrlInput:D,qdrantKeyInput:z}=Gi(),X=!!(ee&&ee.value.trim()||d),re=!!(D&&D.value.trim()||l),de=!!(z&&z.value.trim()||o);return{openai:t,pinecone:X,qdrant:re&&de}},Oo=()=>{let ee=no();return ee.openai?"openai":ee.pinecone?"pinecone":ee.qdrant?"qdrant":""},oo=()=>t?"openai":_?"google":p?"azure":"",Un=()=>{let ee=Ni();if(!ee)return{provider:"",model:""};let D=ee.querySelector('[name="vector_embedding_provider"]'),z=ee.querySelector('[name="vector_embedding_model"]'),X=D?D.value:"";X||(X=oo(),D&&X&&(D.value=X,typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(ee)));let re=z?z.value:"";if(!re&&X){let de=So(X);re=de.length?de[0].id:"",z&&re&&(z.value=re)}return sn(ee),{provider:X,model:re}},Gn=ee=>{if(!ee)return"";let z=(ee.selectedOptions?Array.from(ee.selectedOptions):[]).find(X=>X&&X.value);return z?z.value:""},Co=(ee,D)=>{!ee||!D||Array.from(ee.options).forEach(z=>{z.selected=z.value===D})},Ao=async ee=>{let{openaiStoresSelect:D}=Gi(),z=Gn(D);if(!z&&D&&(xn(D),z=Gn(D)),!z){let X=vi("aipkit_vector_store_nonce_openai");if(!X)throw new Error("OpenAI vector store nonce missing.");let re=`Chatbot ${ee} ${Date.now()}`,de=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:X,name:re,source_type:"chatbot_training_text"}),le=de.store||de;if(!le||!le.id)throw new Error("OpenAI vector store creation failed.");if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]),window.aipkit_chat_config.openaiVectorStores.some(he=>he&&he.id===le.id)||window.aipkit_chat_config.openaiVectorStores.push(le),typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"){let he=Ni();he&&window.aipkit_populateOpenAIVectorStoresMultiSelect(he)}D&&Co(D,le.id),z=le.id}return z},Io=async(ee,D)=>{let{pineconeIndexSelect:z}=Gi(),X=z?z.value:"";if(!X&&z&&(Yn(z),X=z.value),!X){let re=vi("aipkit_vector_store_pinecone_nonce_management");if(!re)throw new Error("Pinecone nonce missing.");let de=`chatbot-${ee}-${Date.now()}`,le=await window.aipkit_apiRequest("aipkit_create_index_pinecone",{_ajax_nonce:re,name:de,dimension:D,metric:"cosine"}),me=le.index||le,he=me?.name||de;if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.pineconeIndexes)||(window.aipkit_chat_config.pineconeIndexes=[]),window.aipkit_chat_config.pineconeIndexes.some(Ie=>Ie&&Ie.name===he||Ie===he)||window.aipkit_chat_config.pineconeIndexes.push(me||he),typeof window.aipkit_populatePineconeIndexSelect=="function"){let Ie=Ni();Ie&&window.aipkit_populatePineconeIndexSelect(Ie)}z&&(z.value=he),X=he}return X},qo=async(ee,D)=>{let{qdrantCollectionsSelect:z}=Gi(),X=Gn(z);if(!X&&z&&(xn(z),X=Gn(z)),!X){let re=vi("aipkit_vector_store_qdrant_nonce_management");if(!re)throw new Error("Qdrant nonce missing.");let de=`chatbot-${ee}-${Date.now()}`;if(await window.aipkit_apiRequest("aipkit_create_collection_qdrant",{_ajax_nonce:re,name:de,dimension:D,metric:"Cosine"}),window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.qdrantCollections)||(window.aipkit_chat_config.qdrantCollections=[]),window.aipkit_chat_config.qdrantCollections.some(me=>me&&me.name===de||me===de||me?.id===de)||window.aipkit_chat_config.qdrantCollections.push({name:de}),z){if(!Array.from(z.options).some(he=>he.value===de)){let he=document.createElement("option");he.value=de,he.textContent=de,z.appendChild(he)}Co(z,de)}if(typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let me=Ni();me&&window.aipkit_populateQdrantCollectionsMultiSelect(me)}X=de}return X};if(be.length&&!e.dataset.trainingTextBound){let ee=!1,D=le=>{!Re||!Oe||(le?(Re.hidden=!1,Re.disabled=!1,Oe.disabled=!0):(Re.hidden=!0,Re.disabled=!1,Oe.disabled=!1))},z=()=>{let le=$t?$t.querySelector(".aipkit_builder_tab.is-active"):null;return le?le.dataset.aipkitTab:""},X=()=>{let le=I?I.querySelector(".aipkit_file_upload_toggle_select"):null;return le?le.dataset.isProPlan==="true":window.aipkit_chat_config?.isProPlan===!0||window.aipkit_dashboard?.isProPlan===!0};Ce&&_e&&Ce.addEventListener("click",()=>{_e.click()});let re=async()=>{if(ee)return;let le=z(),me="",he="chatbot_training_text",Te=[],Ie=null;if(le==="text"){if(me=ai?ai.value.trim():"",!me){kt("Add text to train.","warning"),Xt();return}}else if(le==="qa"){let Ae=se?se.value.trim():"",tt=ke?ke.value.trim():"";if(!Ae||!tt){kt("Add a question and answer to train.","warning"),Xt();return}me=`Q: ${Ae}
A: ${tt}`,he="chatbot_training_qa"}else if(le==="files"){if(!X()){kt("Upgrade to use file uploads.","warning");return}if(Te=_e?Array.from(_e.files||[]):[],!Te.length){_e&&_e.click(),kt("Choose files to upload.","warning"),Xt();return}he="chatbot_training_file"}else if(le==="website"){let Ae=mi(),tt=xe(Ae),ct=Bi(Ae),Se=Me();if(Ae==="specific"){if(!Se.length){kt("Select content to train.","warning"),Xt();return}}else if(!ct.length){kt("Select at least one post type.","warning"),Xt();return}Ie={mode:Ae,statusValue:tt,postTypes:ct,selectedPostIds:Se}}else{kt("Select a training tab to continue.","warning"),Xt();return}let Le=m&&m.value||e.getAttribute("data-active-bot-id");if(!Le){kt("Select a chatbot before training.","error"),Xt();return}let Ue=Gi(),Ut=Ue?Ue.providerSelect:null,mt=Ut?Ut.value:"";if(mt==="claude_files"){kt("Claude Files is available for frontend chat upload only. Use OpenAI, Pinecone, or Qdrant for training.","warning"),Xt();return}let Et=["openai","pinecone","qdrant"],yt="";if(mt&&Et.includes(mt)?yt=mt:yt=Oo(),!yt){kt("Add an OpenAI, Pinecone, or Qdrant key to train.","error");return}ee=!0,D(!0),be.forEach(Ae=>{Ae.disabled=!0}),kt("Preparing training...","loading");try{let Ae=I&&I.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");Ae&&(Ae.tagName==="SELECT"?Ae.value="1":Ae.checked=!0),Ut&&(Ut.value=yt),Rn(),Cn();let tt="",ct="",Se="",xt="",ii="";if(yt==="openai"){if(!t)throw new Error("OpenAI API key missing.");Se=await Ao(Le)}else if(yt==="pinecone"){if(!no().pinecone)throw new Error("Pinecone API key missing.");let pt=Un();if(tt=pt.provider,ct=pt.model,!tt||!ct)throw new Error("Select an embedding provider and model.");let je=xo(tt,ct);xt=await Io(Le,je)}else if(yt==="qdrant"){if(!no().qdrant)throw new Error("Qdrant URL and API key are required.");let pt=Un();if(tt=pt.provider,ct=pt.model,!tt||!ct)throw new Error("Select an embedding provider and model.");let je=xo(tt,ct);ii=await qo(Le,je)}if(jt(P()),ji(),ki(P()),le==="files"){bn();for(let Dt=0;Dt<Te.length;Dt+=1){let pt=Te[Dt];kt(`Uploading ${Dt+1} of ${Te.length}...`,"loading"),Ei(pt,"Uploading","loading");try{let je=new FormData;if(yt==="openai"){let Ct=vi("aipkit_vector_store_nonce_openai");if(!Ct)throw new Error("OpenAI vector store nonce missing.");je.append("aipkit_vs_global_file_to_submit",pt),je.append("target_store_id",Se),je.append("source_type",he),je.append("_ajax_nonce",Ct);let ni=await window.aipkit_api_upsertFile(je,"aipkit_upload_and_add_file_to_store_direct_openai");Ei(pt,"Processing","loading");let wi=ni?.batch?.id;Tn(pt,P()).then(Oi=>{if(!Oi){if(wi){eo(Se,wi,pt);return}Ei(pt,"Queued","warning")}})}else if(yt==="pinecone"){let Ct=vi("aipkit_vector_store_pinecone_nonce_management");if(!Ct)throw new Error("Pinecone nonce missing.");je.append("file_to_upload",pt),je.append("index_name",xt),je.append("embedding_provider",tt),je.append("embedding_model",ct),je.append("_ajax_nonce",Ct),await window.aipkit_api_upsertFile(je,"aipkit_upload_file_and_upsert_to_pinecone"),Ei(pt,"Trained","success")}else if(yt==="qdrant"){let Ct=vi("aipkit_vector_store_qdrant_nonce_management");if(!Ct)throw new Error("Qdrant nonce missing.");je.append("file_to_upload",pt),je.append("target_store_id",ii),je.append("embedding_provider",tt),je.append("embedding_model",ct),je.append("source_context","chatbot_settings_file_upload"),je.append("_ajax_nonce",Ct),await window.aipkit_api_upsertFile(je,"aipkit_upload_file_and_upsert_to_qdrant"),Ei(pt,"Trained","success")}}catch(je){throw Ei(pt,"Failed","error"),je}}_e&&(_e.value=""),bn(),kt("Saved","success"),Xt(),Wi(),ee=!1,D(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}else if(le==="website"&&Ie){let{mode:Dt,statusValue:pt,postTypes:je,selectedPostIds:Ct}=Ie,ni=Ct,wi=ni.length;if(Dt==="bulk"){if(kt("Preparing website content...","loading"),wi=(await dt(je,pt,Se)).total,!wi){It("No posts found for selection.","error"),kt("Nothing to train.","warning"),Xt();return}if(await oi(wi,pt)){await Ii({botId:Le,postTypes:je,provider:yt,targetStoreId:yt==="openai"?Se:yt==="pinecone"?xt:ii,embeddingProvider:tt,embeddingModel:ct}),It("Queued in the background. You can monitor it in the Automate module. You can close this page.","success"),kt("Queued","success"),Xt(),Wi(P()),ee=!1,D(!1);return}if(wi>200&&pt!=="publish"&&It("Background indexing supports published content only.","info"),ni=await zt(je,pt,Se),!ni.length){It("No posts found for selection.","error"),kt("Nothing to train.","warning"),Xt();return}}kt("Training...","loading"),It(`Training ${wi||ni.length} item(s)...`,"info"),window.aipkit_isIndexingStopped=!1;let Oi=gt?gt.id:"aipkit_training_wp_status";if(yt==="openai"){let Fi=vi("aipkit_wp_content_index_nonce");if(!Fi)throw new Error("WP content index nonce missing.");await window.aipkit_indexOpenAIBatch(ni,{_ajax_nonce:Fi,target_store_id:Se,provider:"openai",source_type:"wordpress_content"},Oi)}else if(yt==="pinecone"){let Fi=vi("aipkit_vector_store_pinecone_nonce_management");if(!Fi)throw new Error("Pinecone nonce missing.");let Xi=ni.map(Mn=>({id:`wp_post_${Mn}`,postId:Mn,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${Mn}`}}));await window.aipkit_indexPineconeBatch(Xi,{_ajax_nonce:Fi,index_name:xt,embedding_provider:tt,embedding_model:ct,source_type:"wordpress_content"},Oi)}else if(yt==="qdrant"){let Fi=vi("aipkit_vector_store_qdrant_nonce_management");if(!Fi)throw new Error("Qdrant nonce missing.");let Xi=ni.map(Mn=>({id:typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`wp_post_${Mn}`,postId:Mn,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${Mn}`}}));await window.aipkit_indexQdrantBatch(Xi,{_ajax_nonce:Fi,collection_name:ii,embedding_provider:tt,embedding_model:ct,source_type:"wordpress_content"},Oi)}kt("Saved","success"),Xt(),Wi(P()),ee=!1,D(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}else{if(kt("Training...","loading"),yt==="openai"){let Dt=vi("aipkit_vector_store_nonce_openai");if(!Dt)throw new Error("OpenAI vector store nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:Dt,target_store_id:Se,text_content:me,source_type:he})}else if(yt==="pinecone"){let Dt=vi("aipkit_vector_store_pinecone_nonce_management");if(!Dt)throw new Error("Pinecone nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let pt=`text_${Date.now()}`,je={source:he,created_at:new Date().toISOString(),original_content:me,vector_id:pt},Ct=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:me,embedding_provider:tt,embedding_model:ct,_ajax_nonce:window.aipkit_dashboard.nonce}),ni=Ct.embeddings&&Ct.embeddings.length?Ct.embeddings[0]:null;if(!ni)throw new Error("Failed to generate embedding.");await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:Dt,vectors:JSON.stringify([{id:pt,values:ni,metadata:je}]),embedding_provider:tt,embedding_model:ct,original_text_content:me,index_name:xt})}else if(yt==="qdrant"){let Dt=vi("aipkit_vector_store_qdrant_nonce_management");if(!Dt)throw new Error("Qdrant nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let pt=a(),je={source:he,created_at:new Date().toISOString(),original_content:me,vector_id:pt},Ct=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:me,embedding_provider:tt,embedding_model:ct,_ajax_nonce:window.aipkit_dashboard.nonce}),ni=Ct.embeddings&&Ct.embeddings.length?Ct.embeddings[0]:null;if(!ni)throw new Error("Failed to generate embedding.");let wi={_ajax_nonce:Dt,vectors:JSON.stringify([{id:pt,vector:ni,payload:je}]),embedding_provider:tt,embedding_model:ct,original_text_content:me,collection_name:ii,source_context:"chatbot_settings_training"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",wi)}le==="text"&&ai&&(ai.value=""),le==="qa"&&(se&&(se.value=""),ke&&(ke.value="")),kt("Saved","success"),Xt(),Wi(),ee=!1,D(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}}catch(Ae){kt(`Error: ${Ae.message||"Training failed."}`,"error")}finally{ee=!1,D(!1),be.forEach(Ae=>{Ae.disabled=!1}),bn()}},de=()=>{if(!_e)return;let le=Array.from(_e.files||[]);if(le.length){if(le.forEach(me=>{qi(me),Ei(me,"Queued")}),bn(),!X()){kt("Upgrade to use file uploads.","warning"),le.forEach(me=>{Ei(me,"Upgrade","warning")});return}re()}};_e&&_e.addEventListener("change",de),be.forEach(le=>{le.addEventListener("click",re)}),Re&&!Re.dataset.listenerAttached&&(Re.addEventListener("click",()=>{ee&&(window.aipkit_isIndexingStopped=!0,Re.disabled=!0,kt("Stopping...","warning"))}),Re.dataset.listenerAttached="true"),Wi(),to(),e.dataset.trainingTextBound="1"}if(ge&&!e.dataset.sourcesSheetBound){let ee=window.aipkit_escapeHtml||function(Ae){return Ae},D={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant",claude_files:"Claude Files"},z={page:1,search:"",status:""},X=null,re=(Ae,tt)=>{Ot&&(Ot.textContent=Ae||"",Ot.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),tt==="success"&&Ot.classList.add("aipkit_form-help-success"),tt==="error"&&Ot.classList.add("aipkit_form-help-error"))},de=()=>{Ot&&setTimeout(()=>{Ot.textContent="",Ot.classList.remove("aipkit_form-help-success","aipkit_form-help-error")},2500)},le=(Ae,tt)=>{Yt&&(Yt.textContent=Ae||"\u2014"),pi&&(pi.textContent=tt||"\u2014")},me=()=>{let Ae=P(),tt=Ae.vector_store_provider||"",ct=D[tt]||"",Se=[],xt="",ii=Ni(),Dt=ii?ii.querySelector('select[name="openai_vector_store_ids[]"]'):null;if(tt==="openai"){if(Se=Array.isArray(Ae.openai_vector_store_ids)?Ae.openai_vector_store_ids.filter(Boolean):[],Dt){let pt=Array.from(Dt.selectedOptions).map(je=>je.textContent.trim()).filter(Boolean);pt.length&&(xt=pt.join(", "))}xt||(xt=Se.join(", "))}else tt==="pinecone"?Ae.pinecone_index_name&&(Se=[Ae.pinecone_index_name],xt=Ae.pinecone_index_name):tt==="qdrant"&&(Se=Array.isArray(Ae.qdrant_collection_names)?Ae.qdrant_collection_names.filter(Boolean):[],xt=Se.join(", "));return{contextSettings:Ae,providerKey:tt,providerLabel:ct,storeIds:Se,storeLabel:xt}},he=Ae=>{Ge&&(Ge.innerHTML=`<tr><td colspan="5" class="aipkit_text-center">${ee(Ae)}</td></tr>`,wt&&(wt.innerHTML=""))},Te=(Ae,tt)=>{if(!Ge)return;if(!Ae.length){he("No sources found.");return}let ct=Ae.map(Se=>{let xt=(Se.provider||tt||"").toLowerCase(),ii=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(Se.message||"",Se.file_id||"",xt,Se):"N/A",Dt=ii==="Text"?"aipkit_type-text":ii==="File Upload"?"aipkit_type-file":ii==="Site Content"?"aipkit_type-site":"aipkit_type-na",pt=Se.status==="indexed"||Se.status==="skipped_already_indexed"||Se.status==="success"?"aipkit_status-success":Se.status==="failed"?"aipkit_status-warning":"aipkit_status-info",je="\u2014";Se.status&&(je=Se.status==="indexed"||Se.status==="skipped_already_indexed"||Se.status==="success"?"Trained":Se.status.replace(/_/g," "));let Ct=Se.status==="processing"||Se.status==="queued",ni=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(Se.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(Se.timestamp):Se.timestamp||"\u2014",wi=Se.indexed_content||"",Oi=Se.post_title||(Se.post_id?`Post #${Se.post_id}`:"")||wi||Se.message||Se.file_id||"\u2014",Fi=Oi.length>60?`${Oi.substring(0,60)}...`:Oi,Xi=[];return ii==="Site Content"&&Se.post_id&&Xi.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
                    data-provider="${ee(Se.provider||tt)}"
                    data-store-id="${ee(Se.vector_store_id||"")}"
                    data-vector-id="${ee(Se.file_id||"")}"
                    data-log-id="${ee(Se.id||"")}"
                    data-post-id="${ee(Se.post_id||"")}"
                    data-embedding-provider="${ee(Se.embedding_provider||"")}"
                    data-embedding-model="${ee(Se.embedding_model||"")}"
                    ${Ct?'disabled aria-disabled="true"':""}
                  >${Ct?"Training...":"Retrain"}</button>`),ii==="Text"&&wi&&Xi.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
                    data-provider="${ee(Se.provider||tt)}"
                    data-store-id="${ee(Se.vector_store_id||"")}"
                    data-vector-id="${ee(Se.file_id||"")}"
                    data-log-id="${ee(Se.id||"")}"
                    data-embedding-provider="${ee(Se.embedding_provider||"")}"
                    data-embedding-model="${ee(Se.embedding_model||"")}"
                    data-content="${encodeURIComponent(wi)}"
                    ${Ct?'disabled aria-disabled="true"':""}
                  >${Ct?"Training...":"Edit"}</button>`),wi&&Xi.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_view_snippet_icon"
                    data-file-id="${ee(Se.id||"")}"
                    data-snippet="${ee(wi)}"
                    ${Se.batch_id?`data-batch-id="${ee(Se.batch_id)}" data-store-id="${ee(Se.vector_store_id||"")}"`:""}
                    ${Ct?'disabled aria-disabled="true"':""}
                  >View</button>`),Se.file_id&&Xi.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
                    data-provider="${ee(Se.provider||tt)}"
                    data-store-id="${ee(Se.vector_store_id||"")}"
                    data-vector-id="${ee(Se.file_id||"")}"
                    data-log-id="${ee(Se.id||"")}"
                    ${Ct?'disabled aria-disabled="true"':""}
                  >Delete</button>`),`<tr data-log-id="${ee(Se.id||"")}">
                <td style="white-space: nowrap;">${ee(ni)}</td>
                <td><span class="aipkit_content-type-tag ${Dt}">${ee(ii)}</span></td>
                <td title="${ee(Oi)}">${ee(Fi)}</td>
                <td style="white-space: nowrap;"><span class="aipkit_status-tag ${pt}">${ee(je)}</span></td>
                <td class="aipkit_actions_cell">
                  <div class="aipkit-table-actions-group">${Xi.join("")}</div>
                </td>
              </tr>`}).join("");Ge.innerHTML=ct,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(Ge,tt)},Ie=async(Ae=1)=>{if(!Ge||typeof window.aipkit_apiRequest!="function")return;let tt=m&&m.value||e.getAttribute("data-active-bot-id");if(!tt){he("Select a chatbot to view sources.");return}let{contextSettings:ct,providerKey:Se,providerLabel:xt,storeIds:ii,storeLabel:Dt}=me();if(le(xt,Dt),ct.enable_vector_store!=="1"){he("Enable a knowledge base to view sources.");return}if(!Se||!ii.length){he("Select a knowledge base store to view sources.");return}Ge.innerHTML='<tr><td colspan="5" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading sources...</td></tr>',wt&&(wt.innerHTML="");try{let pt={bot_id:tt,page:Ae,search:z.search,status:z.status,enable_vector_store:ct.enable_vector_store,vector_store_provider:ct.vector_store_provider,openai_vector_store_ids:ct.openai_vector_store_ids||[],pinecone_index_name:ct.pinecone_index_name,qdrant_collection_names:ct.qdrant_collection_names||[]},je=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",pt);z.page=Ae,Te(je.logs||[],xt),typeof window.aipkit_renderLogsPagination=="function"&&je.pagination&&wt&&window.aipkit_renderLogsPagination(je.pagination,wt,Ct=>Ie(Ct))}catch(pt){he(`Error loading sources: ${ee(pt.message||"Unknown error")}`)}},Le=(Ae=1)=>{!C||!C.classList.contains("aipkit-active")||ge.hidden||Ie(Ae)};window.aipkit_refreshSourcesSheet=Le;let Ue=()=>{Ze&&(Ze.classList.remove("aipkit-active"),Ze.setAttribute("aria-hidden","true"),Ze.dataset.provider="",Ze.dataset.storeId="",Ze.dataset.vectorId="",Ze.dataset.logId="",Ze.dataset.embeddingProvider="",Ze.dataset.embeddingModel="",Ee&&(Ee.value=""))},Ut=Ae=>{!Ze||!Ee||(Ze.dataset.provider=Ae.dataset.provider||"",Ze.dataset.storeId=Ae.dataset.storeId||"",Ze.dataset.vectorId=Ae.dataset.vectorId||"",Ze.dataset.logId=Ae.dataset.logId||"",Ze.dataset.embeddingProvider=Ae.dataset.embeddingProvider||"",Ze.dataset.embeddingModel=Ae.dataset.embeddingModel||"",Ee.value=Ae.dataset.content?decodeURIComponent(Ae.dataset.content):"",Ze.classList.add("aipkit-active"),Ze.setAttribute("aria-hidden","false"),setTimeout(()=>Ee.focus(),0))},mt=()=>{Mt&&(Mt.classList.remove("aipkit-active"),Mt.setAttribute("aria-hidden","true"),Mt.dataset.provider="",Mt.dataset.storeId="",Mt.dataset.vectorId="",Mt.dataset.logId="")},Et=Ae=>{Mt&&(Mt.dataset.provider=Ae.providerLabel||"",Mt.dataset.storeId=Ae.storeId||"",Mt.dataset.vectorId=Ae.vectorId||"",Mt.dataset.logId=Ae.logId||"",Mt.classList.add("aipkit-active"),Mt.setAttribute("aria-hidden","false"),Ci&&(Ci.disabled=!1))},yt=async(Ae,tt,ct,Se,xt)=>{let ii=Ae.toLowerCase();if(ii==="openai"){let je=vi("aipkit_vector_store_nonce_openai");if(!je)throw new Error("OpenAI nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:je,target_store_id:tt,text_content:ct,source_type:"chatbot_training_text"});return}if(!Se||!xt){let je=P();Se=Se||je.vector_embedding_provider,xt=xt||je.vector_embedding_model}if(!Se||!xt)throw new Error("Select an embedding provider and model.");let Dt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ct,embedding_provider:Se,embedding_model:xt}),pt=Dt.embeddings&&Dt.embeddings.length?Dt.embeddings[0]:null;if(!pt)throw new Error("Failed to generate embedding.");if(ii==="pinecone"){let je=vi("aipkit_vector_store_pinecone_nonce_management");if(!je)throw new Error("Pinecone nonce missing.");let Ct=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:je,vectors:JSON.stringify([{id:Ct,values:pt,metadata:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:ct,vector_id:Ct}}]),embedding_provider:Se,embedding_model:xt,original_text_content:ct,index_name:tt});return}if(ii==="qdrant"){let je=vi("aipkit_vector_store_qdrant_nonce_management");if(!je)throw new Error("Qdrant nonce missing.");let Ct=a(),ni={_ajax_nonce:je,vectors:JSON.stringify([{id:Ct,vector:pt,payload:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:ct,vector_id:Ct}}]),embedding_provider:Se,embedding_model:xt,original_text_content:ct,collection_name:tt,source_context:"chatbot_settings_sources_sheet"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",ni)}};et&&et.addEventListener("input",()=>{X&&window.clearTimeout(X),X=window.setTimeout(()=>{z.search=et.value.trim(),Le(1)},300)}),Nt&&Nt.addEventListener("change",()=>{z.status=Nt.value,Le(1)}),Gt&&Gt.addEventListener("click",()=>{Le(z.page||1)}),Lt&&Lt.addEventListener("click",Ue),ft&&ft.addEventListener("click",Ue),Ze&&!Ze.dataset.bound&&(document.addEventListener("keydown",Ae=>{Ae.key==="Escape"&&Ze.classList.contains("aipkit-active")&&Ue()}),Ze.dataset.bound="1"),ui&&ui.addEventListener("click",async()=>{if(!Ze||!Ee)return;let Ae=Ee.value.trim();if(!Ae){re("Text cannot be empty.","error"),de();return}let tt=Ze.dataset.provider||"",ct=Ze.dataset.storeId||"",Se=Ze.dataset.vectorId||"",xt=Ze.dataset.logId||"",ii=Ze.dataset.embeddingProvider||"",Dt=Ze.dataset.embeddingModel||"";if(!tt||!ct||!Se||!xt){re("Missing source details.","error"),de();return}if(Ue(),Ge&&xt){let pt=typeof CSS<"u"&&CSS.escape?CSS.escape(String(xt)):String(xt).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),je=Ge.querySelector(`tr[data-log-id="${pt}"]`),Ct=je?je.querySelector(".aipkit_sources_action_edit"):null,ni=je?je.querySelector(".aipkit_view_snippet_icon"):null,wi=je?je.querySelector(".aipkit_sources_action_delete"):null;Ct&&(Ct.disabled=!0,Ct.setAttribute("aria-disabled","true"),Ct.textContent="Training..."),ni&&(ni.disabled=!0,ni.setAttribute("aria-disabled","true")),wi&&(wi.disabled=!0,wi.setAttribute("aria-disabled","true"))}re("Training...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:tt,store_id:ct,vector_id:Se,log_id:xt}),await yt(tt,ct,Ae,ii,Dt),re("Trained","success"),de(),Ue(),Le(z.page||1),Wi(P())}catch(pt){re(`Error: ${pt.message||"Failed to save."}`,"error")}}),cn&&cn.addEventListener("click",mt),ln&&ln.addEventListener("click",mt),Ci&&Ci.addEventListener("click",async()=>{if(!Mt)return;let Ae=Mt.dataset.provider||"",tt=Mt.dataset.storeId||"",ct=Mt.dataset.vectorId||"",Se=Mt.dataset.logId||"";if(!Ae||!tt||!ct||!Se){re("Missing source details.","error"),de(),mt();return}mt();let xt=null,ii=null,Dt=null,pt=null,je=null;if(Ge&&Se){let Ct=typeof CSS<"u"&&CSS.escape?CSS.escape(String(Se)):String(Se).replace(/[^a-zA-Z0-9_-]/g,"\\$&");xt=Ge.querySelector(`tr[data-log-id="${Ct}"]`),xt&&(ii=xt.querySelector(".aipkit_sources_action_edit"),Dt=xt.querySelector(".aipkit_sources_action_retrain"),pt=xt.querySelector(".aipkit_view_snippet_icon"),je=xt.querySelector(".aipkit_sources_action_delete"),[ii,Dt,pt,je].forEach(ni=>{ni&&(ni.disabled=!0,ni.setAttribute("aria-disabled","true"))}),je&&(je.textContent="Deleting..."))}Ci&&(Ci.disabled=!0),re("Deleting...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:Ae,store_id:tt,vector_id:ct,log_id:Se}),re("Deleted","success"),de(),Le(z.page||1),Wi(P())}catch(Ct){re(`Error: ${Ct.message||"Failed to delete."}`,"error"),[ii,Dt,pt,je].forEach(ni=>{ni&&(ni.disabled=!1,ni.removeAttribute("aria-disabled"))}),je&&(je.textContent="Delete")}finally{Ci&&(Ci.disabled=!1)}}),Mt&&!Mt.dataset.bound&&(document.addEventListener("keydown",Ae=>{Ae.key==="Escape"&&Mt.classList.contains("aipkit-active")&&mt()}),Mt.dataset.bound="1"),ge.addEventListener("click",async Ae=>{let tt=Ae.target.closest(".aipkit_sources_action_edit");if(tt){Ut(tt);return}let ct=Ae.target.closest(".aipkit_sources_action_delete");if(ct){let xt=ct.dataset.provider||"",ii=ct.dataset.storeId||"",Dt=ct.dataset.vectorId||"",pt=ct.dataset.logId||"";if(!xt||!ii||!Dt||!pt){re("Missing source details.","error"),de();return}Et({providerLabel:xt,storeId:ii,vectorId:Dt,logId:pt});return}let Se=Ae.target.closest(".aipkit_sources_action_retrain");if(Se){let xt=Se.dataset.provider||"",ii=Se.dataset.storeId||"",Dt=Se.dataset.vectorId||"",pt=Se.dataset.logId||"",je=Se.dataset.postId||"",Ct=Se.dataset.embeddingProvider||"",ni=Se.dataset.embeddingModel||"";if(!xt||!ii||!Dt||!pt||!je){re("Missing source details.","error"),de();return}Se.disabled=!0,Se.setAttribute("aria-disabled","true"),Se.textContent="Training...";let wi=Se.closest("tr"),Oi=wi?wi.querySelector(".aipkit_view_snippet_icon"):null,Fi=wi?wi.querySelector(".aipkit_sources_action_delete"):null;Oi&&(Oi.disabled=!0,Oi.setAttribute("aria-disabled","true")),Fi&&(Fi.disabled=!0,Fi.setAttribute("aria-disabled","true")),re("Retraining...","");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:xt,store_id:ii,vector_id:Dt,log_id:pt,post_id:je,embedding_provider:Ct,embedding_model:ni}),re("Retrained","success"),de(),Le(z.page||1),Wi(P())}catch(Xi){re(`Error: ${Xi.message||"Failed to retrain."}`,"error"),Se.disabled=!1,Se.removeAttribute("aria-disabled"),Se.textContent="Retrain",Oi&&(Oi.disabled=!1,Oi.removeAttribute("aria-disabled")),Fi&&(Fi.disabled=!1,Fi.removeAttribute("aria-disabled"))}}}),e.dataset.sourcesSheetBound="1"}e.dataset.contextSettingsAutosaveBound="1"}let yn=fo();if(yn&&Bt&&!e.dataset.tokenLimitsAutosaveBound){let F=!1,N=null,P=()=>{let U=yn.querySelectorAll('input[name^="token_role_limits["]'),O={};return U.forEach(Y=>{let ce=Y.getAttribute("name");ce&&(O[ce]=Y.value)}),O},j=()=>{let U=O=>{let Y=yn.querySelector(O);return Y?Y.value:""};return{token_guest_limit:U('[name="token_guest_limit"]'),token_user_limit:U('[name="token_user_limit"]'),token_limit_mode:U('[name="token_limit_mode"]'),token_reset_period:U('[name="token_reset_period"]'),token_limit_message:U('[name="token_limit_message"]'),role_limits:P()}},J=j(),ie=U=>{let O=m&&m.value||e.getAttribute("data-active-bot-id");if(!O)return;F=!0,Xe("Auto-saving...","");let Y={bot_id:O,token_guest_limit:U.token_guest_limit,token_user_limit:U.token_user_limit,token_limit_mode:U.token_limit_mode,token_reset_period:U.token_reset_period,token_limit_message:U.token_limit_message};Object.entries(U.role_limits).forEach(([ce,ue])=>{Y[ce]=ue}),window.aipkit_apiRequest("aipkit_update_chatbot_token_limits",Y).then(ce=>{J=U,Xe(ce.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),_i()}).catch(ce=>{Xe(`Error: ${ce.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N){let ce=N;N=null,JSON.stringify(ce)!==JSON.stringify(J)&&ie(ce)}})},oe=U=>{if(JSON.stringify(U)!==JSON.stringify(J)){if(F){N=U;return}ie(U)}};yn.addEventListener("change",U=>{let O=U.target;if(O){if(O.matches(".aipkit_token_limit_mode_select")){on(),oe(j());return}(O.matches('[name="token_guest_limit"]')||O.matches('[name="token_user_limit"]')||O.matches('[name="token_reset_period"]')||O.matches('[name="token_limit_message"]')||O.matches('input[name^="token_role_limits["]'))&&oe(j())}}),e.dataset.tokenLimitsAutosaveBound="1"}let ho=b?b.querySelector('[data-aipkit-settings-panel="appearance"]'):null;if(ho&&Bt&&!e.dataset.styleSettingsAutosaveBound){let F=ho;if(F){let N=!1,P=null,j=()=>{let U={},O=ut=>{let Kt=F.querySelector(ut);return!Kt||Kt.disabled?null:Kt.value||""},Y=F.querySelector('select[name="theme"]');if(Y&&!Y.disabled)U.theme=Y.value||"light";else{let ut=F.querySelector('input[name="theme"]:checked');if(ut&&!ut.disabled)U.theme=ut.value||"light";else{let Kt=e.querySelector('input[name="theme"]:checked, select[name="theme"]');Kt&&!Kt.disabled&&(U.theme=Kt.value||"light")}}let ce=O('input[name="greeting"]');ce!==null&&(U.greeting=ce);let ue=O('input[name="subgreeting"]');ue!==null&&(U.subgreeting=ue);let ye=O('input[name="input_placeholder"]');ye!==null&&(U.input_placeholder=ye);let ze=O('input[name="footer_text"]');ze!==null&&(U.footer_text=ze);let st=O('input[name="custom_typing_text"]');st!==null&&(U.custom_typing_text=st);let nt=ut=>{let Kt=F.querySelector(`input[name="${ut}"]`);!Kt||Kt.disabled||(U[ut]=Kt.checked?"1":"0")};nt("enable_download"),nt("enable_copy_button"),nt("enable_fullscreen"),nt("enable_feedback"),nt("enable_conversation_sidebar"),nt("enable_conversation_starters");let ot=m&&m.value||e.getAttribute("data-active-bot-id");if(ot){let ut=document.getElementById(`aipkit_bot_${ot}_enable_consent_compliance`);ut&&!ut.disabled&&(U.enable_consent_compliance=ut.checked?"1":"0");let Kt=document.getElementById(`aipkit_bot_${ot}_enable_ip_anonymization`);Kt&&!Kt.disabled&&(U.enable_ip_anonymization=Kt.checked?"1":"0");let jt=document.getElementById(`aipkit_bot_${ot}_consent_title`);jt&&!jt.disabled&&(U.consent_title=jt.value||"");let ci=document.getElementById(`aipkit_bot_${ot}_consent_message`);ci&&!ci.disabled&&(U.consent_message=ci.value||"");let kt=document.getElementById(`aipkit_bot_${ot}_consent_button`);kt&&!kt.disabled&&(U.consent_button=kt.value||"");let Xt=document.getElementById(`aipkit_bot_${ot}_openai_moderation_enabled`);Xt&&!Xt.disabled&&(U.openai_moderation_enabled=Xt.checked?"1":"0");let It=document.getElementById(`aipkit_bot_${ot}_openai_moderation_message`);It&&!It.disabled&&(U.openai_moderation_message=It.value||"");let ki=document.getElementById(`aipkit_bot_${ot}_banned_words`);ki&&!ki.disabled&&(U.banned_words=ki.value||"");let mi=document.getElementById(`aipkit_bot_${ot}_banned_words_message`);mi&&!mi.disabled&&(U.banned_words_message=mi.value||"");let Bi=document.getElementById(`aipkit_bot_${ot}_banned_ips`);Bi&&!Bi.disabled&&(U.banned_ips=Bi.value||"");let xe=document.getElementById(`aipkit_bot_${ot}_banned_ips_message`);xe&&!xe.disabled&&(U.banned_ips_message=xe.value||"");let Me=document.getElementById(`aipkit_bot_${ot}_custom_theme_settings_container`);Me&&Me.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(He=>{let Ke=He.getAttribute("name");Ke&&(He.type==="checkbox"?U[Ke]=He.checked?"1":"0":He.type==="radio"?He.checked&&(U[Ke]=He.value):U[Ke]=He.value)});let Je=document.getElementById(`aipkit_bot_${ot}_conversation_starters`);Je&&!Je.disabled&&(U.conversation_starters=Je.value||"")}return U},J=j(),ie=U=>{let O=m&&m.value||e.getAttribute("data-active-bot-id");O&&(N=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_style_settings",{bot_id:O,...U}).then(Y=>{J=U,Xe(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),_i()}).catch(Y=>{Xe(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(N=!1,P){let Y=P;P=null,JSON.stringify(Y)!==JSON.stringify(J)&&ie(Y)}}))},oe=U=>{if(JSON.stringify(U)!==JSON.stringify(J)){if(N){P=U;return}ie(U)}};F.addEventListener("change",U=>{let O=U.target;if(O&&(O.matches('input[name="greeting"]')||O.matches('input[name="subgreeting"]')||O.matches('input[name="input_placeholder"]')||O.matches('input[name="footer_text"]')||O.matches('input[name="custom_typing_text"]')||O.matches('input[name="enable_download"]')||O.matches('input[name="enable_copy_button"]')||O.matches('input[name="enable_fullscreen"]')||O.matches('input[name="enable_feedback"]')||O.matches('input[name="enable_conversation_sidebar"]')||O.matches('input[name="enable_conversation_starters"]')||O.matches('select[name="theme"]')||O.matches('input[name="theme"]'))){if((O.matches('select[name="theme"]')||O.matches('input[name="theme"]'))&&typeof hn=="function")if(O.value!=="custom")hn();else{let Y=O.closest(".aipkit_theme_choice_card")||O;Zn(Y)}oe(j())}}),e.addEventListener("change",U=>{let O=U.target;!O||!O.matches||!O.matches('select[name="theme"]')&&!O.matches('input[name="theme"]')||F.contains(O)||oe(j())}),e.dataset.customThemeAutosaveBound||(document.addEventListener("change",U=>{let O=U.target;O&&O.matches&&O.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')&&oe(j())}),e.dataset.customThemeAutosaveBound="1"),F.addEventListener("blur",U=>{let O=U.target;O&&(O.matches('input[name="greeting"]')||O.matches('input[name="subgreeting"]')||O.matches('input[name="input_placeholder"]')||O.matches('input[name="footer_text"]')||O.matches('input[name="custom_typing_text"]'))&&oe(j())},!0),document.addEventListener("change",U=>{let O=U.target;O&&O.matches('textarea[name="conversation_starters"], input[name="enable_consent_compliance"], input[name="enable_ip_anonymization"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_enabled"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&(O.matches('input[name="enable_consent_compliance"]')&&Yi(),O.matches('input[name="openai_moderation_enabled"]')&&go(),oe(j()))}),document.addEventListener("blur",U=>{let O=U.target;O&&O.matches('textarea[name="conversation_starters"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&oe(j())},!0),e.dataset.styleSettingsAutosaveBound="1"}}if(C&&Bt&&!e.dataset.imageSettingsAutosaveBound){let F=!1,N=null,P=()=>{let U=rt&&rt.querySelector('select[name="chat_image_model_id"]')||I&&I.querySelector('select[name="chat_image_model_id"]')||C.querySelector('select[name="chat_image_model_id"]'),O=rt&&rt.querySelector('input[name="image_triggers"]')||rt&&rt.querySelector('textarea[name="image_triggers"]')||I&&I.querySelector('input[name="image_triggers"]')||I&&I.querySelector('textarea[name="image_triggers"]')||C.querySelector('input[name="image_triggers"]')||C.querySelector('textarea[name="image_triggers"]');if(!U||!O)return null;let Y=rt&&rt.querySelector(".aipkit_image_analysis_select")||I&&I.querySelector(".aipkit_image_analysis_select")||C.querySelector(".aipkit_image_analysis_select"),ce=rt&&rt.querySelector(".aipkit_image_analysis_checkbox")||I&&I.querySelector(".aipkit_image_analysis_checkbox")||C.querySelector(".aipkit_image_analysis_checkbox"),ue=Y&&Y.value!==""?Y.value:ce&&ce.checked?"1":"0";return{chat_image_model_id:U.value||"",image_triggers:O.value||"",enable_image_upload:ue}},j=P()||{},J=U=>{let O=m&&m.value||e.getAttribute("data-active-bot-id");O&&(F=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_image_settings",{bot_id:O,...U}).then(Y=>{j=U,Xe(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),_i()}).catch(Y=>{Xe(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N){let Y=N;N=null,JSON.stringify(Y)!==JSON.stringify(j)&&J(Y)}}))},ie=U=>{if(U&&JSON.stringify(U)!==JSON.stringify(j)){if(F){N=U;return}J(U)}},oe=U=>{let O=U.target;O&&(O.matches('select[name="chat_image_model_id"]')||O.matches('input[name="image_triggers"]')||O.matches('textarea[name="image_triggers"]')||O.matches(".aipkit_image_analysis_checkbox")||O.matches(".aipkit_image_analysis_select"))&&ie(P())};C.addEventListener("change",oe),I&&I.addEventListener("change",oe),rt&&rt.addEventListener("change",oe),e.dataset.imageSettingsAutosaveBound="1"}if(C&&Bt&&!e.dataset.replicateKeyAutosaveBound){let N=rt&&rt.querySelector('input[name="replicate_api_key"]')||I&&I.querySelector('input[name="replicate_api_key"]')||C.querySelector('input[name="replicate_api_key"]');if(N){let P=!1,j=null,J=N.value||"",ie=O=>{P=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:O}).then(Y=>{J=O,Xe(Y.message||"Saved","success"),_i(),po(O)}).catch(Y=>{Xe(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(P=!1,j!==null){let Y=j;j=null,Y!==J&&ie(Y)}})},oe=O=>{if(O!==J){if(P){j=O;return}ie(O)}},U=O=>{let Y=O.target;!Y||!Y.matches('input[name="replicate_api_key"]')||oe(Y.value||"")};C.addEventListener("change",U),C.addEventListener("blur",U,!0),I&&(I.addEventListener("change",U),I.addEventListener("blur",U,!0)),rt&&(rt.addEventListener("change",U),rt.addEventListener("blur",U,!0)),e.dataset.replicateKeyAutosaveBound="1"}}if(Ne&&Bt&&!e.dataset.audioSettingsAutosaveBound){let F=!1,N=null,P=()=>{let xe=Ve=>{let dt=Ne.querySelector(Ve);return dt?dt.value:null},Me=Ve=>{let dt=Ne.querySelector(Ve);return dt?dt.tagName==="SELECT"?dt.value:dt.type==="checkbox"?dt.checked?"1":"0":dt.value?dt.value:"0":null},Je={},He=Me(".aipkit_voice_input_toggle_switch");if(He!==null){Je.enable_voice_input=He;let Ve=xe('[name="stt_provider"]');Ve!==null&&(Je.stt_provider=Ve);let dt=xe('[name="stt_openai_model_id"]');dt!==null&&(Je.stt_openai_model_id=dt)}let Ke=Me(".aipkit_tts_toggle_switch");if(Ke!==null){Je.tts_enabled=Ke;let Ve=Me('[name="tts_auto_play"]');Ve!==null&&(Je.tts_auto_play=Ve);let dt=xe('[name="tts_provider"]');dt!==null&&(Je.tts_provider=dt);let zt=xe('[name="tts_google_voice_id"]');zt!==null&&(Je.tts_google_voice_id=zt);let oi=xe('[name="tts_openai_voice_id"]');oi!==null&&(Je.tts_openai_voice_id=oi);let Ii=xe('[name="tts_openai_model_id"]');Ii!==null&&(Je.tts_openai_model_id=Ii);let an=xe('[name="tts_elevenlabs_voice_id"]');an!==null&&(Je.tts_elevenlabs_voice_id=an);let zi=xe('[name="tts_elevenlabs_model_id"]');zi!==null&&(Je.tts_elevenlabs_model_id=zi)}let Ye=Me(".aipkit_enable_realtime_voice_toggle");if(Ye!==null){Je.enable_realtime_voice=Ye;let Ve=Me('[name="direct_voice_mode"]');Ve!==null&&(Je.direct_voice_mode=Ve);let dt=Me('[name="input_audio_noise_reduction"]');dt!==null&&(Je.input_audio_noise_reduction=dt);let zt=xe('[name="realtime_model"]');zt!==null&&(Je.realtime_model=zt);let oi=xe('[name="realtime_voice"]');oi!==null&&(Je.realtime_voice=oi);let Ii=xe('[name="turn_detection"]');Ii!==null&&(Je.turn_detection=Ii);let an=xe('[name="input_audio_format"]');an!==null&&(Je.input_audio_format=an);let zi=xe('[name="output_audio_format"]');zi!==null&&(Je.output_audio_format=zi);let vn=xe('[name="speed"]');vn!==null&&(Je.speed=vn)}return Je},j=P(),ie=(()=>{let xe=Ne.querySelector('[name="elevenlabs_api_key"]');return xe?xe.value:""})(),oe=!1,U=null,O=!1,Y=Ne.querySelector(".aipkit_tts_sync_status"),ce=(xe,Me,Je)=>{Y&&(Y.textContent=xe||"",Y.classList.remove("success","error","loading"),Me&&Y.classList.add(Me),Je?Y.setAttribute("title",Je):Y.removeAttribute("title"),Y.style.display=xe?"inline-block":"none")},ue=(xe=2500)=>{Y&&setTimeout(()=>{ce("")},xe)},ye=()=>{let xe=Ne.querySelector('[name="tts_provider"]');return xe?xe.value:""},ze=()=>{let xe=Ne.querySelector(".aipkit_tts_toggle_switch");return xe?xe.checked:!1},st=()=>{let xe=Ne.querySelector('select[name="tts_google_voice_id"]');return!xe||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_updateGoogleVoiceSelect!="function"||O?Promise.resolve():(O=!0,ce("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(Me=>{if(!Me||!Me.voices)throw new Error("Invalid response received from voice sync.");let Je=xe.value||"";window.aipkit_updateGoogleVoiceSelect(xe.id,Me.voices,Je);let He=document.getElementById("aipkit_google_tts_voices_json_main");He&&(He.dataset.voices=JSON.stringify(Me.voices)),ce(Me.message||"Synced","success"),ue()}).catch(Me=>{let Je=Me?.message||"Sync failed.";throw ce(Je,"error",Je),ue(5e3),Me}).finally(()=>{O=!1}))},nt=()=>{let xe=It();if(!xe||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect!="function"||typeof window.aipkit_chatTts_updateElevenLabsModelsSelect!="function")return Promise.resolve();let Me=Ne.querySelector('select[name="tts_elevenlabs_voice_id"]'),Je=Ne.querySelector('select[name="tts_elevenlabs_model_id"]');if(!Me&&!Je||O)return Promise.resolve();O=!0,ce("Syncing...","loading");let He=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabs"}).then(Ye=>{let Ve=Ye?.models||[];Me&&window.aipkit_chatTts_updateElevenLabsVoiceSelect(Me.id,Ve,Me.value||"");let dt=document.getElementById(`aipkit_elevenlabs_voices_json_${xe}`);dt&&(dt.dataset.voices=JSON.stringify(Ve))}),Ke=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabsModels"}).then(Ye=>{let Ve=Ye?.models||[];Je&&window.aipkit_chatTts_updateElevenLabsModelsSelect(Je.id,Ve,Je.value||"");let dt=document.getElementById(`aipkit_elevenlabs_models_json_${xe}`);dt&&(dt.dataset.models=JSON.stringify(Ve))});return Promise.allSettled([He,Ke]).then(Ye=>{let Ve=Ye.find(dt=>dt.status==="rejected");if(Ve){let dt=Ve.reason?.message||"Sync failed.";throw ce(dt,"error",dt),ue(5e3),Ve.reason}return ce("Synced","success"),ue(),Ye}).finally(()=>{O=!1})},ot=xe=>{try{let Me=xe?JSON.parse(xe):[];return Array.isArray(Me)&&Me.length>0}catch{return!1}},ut=xe=>xe?!!(xe.options&&xe.options.length>1):!1,Kt=()=>{let xe=Ne.querySelector('select[name="tts_google_voice_id"]'),Me=document.getElementById("aipkit_google_tts_voices_json_main");return!ot(Me?.dataset?.voices)||!ut(xe)},jt=()=>{let xe=It();if(!xe)return!1;let Me=Ne.querySelector('select[name="tts_elevenlabs_voice_id"]'),Je=Ne.querySelector('select[name="tts_elevenlabs_model_id"]'),He=document.getElementById(`aipkit_elevenlabs_voices_json_${xe}`),Ke=document.getElementById(`aipkit_elevenlabs_models_json_${xe}`),Ye=ot(He?.dataset?.voices),Ve=ot(Ke?.dataset?.models);return!Ye||!Ve||!ut(Me)||!ut(Je)},ci=()=>{if(!ze())return Promise.resolve();let xe=ye();return xe==="Google"?Kt()?st():Promise.resolve():xe==="ElevenLabs"&&jt()?nt():Promise.resolve()};window.aipkit_syncAudioTtsOnOpen=ci;let kt=xe=>{xe!=null&&(oe=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{elevenlabs_api_key:xe}).then(Me=>{ie=xe,Xe(Me.message||"Saved","success"),_i(),ye()==="ElevenLabs"&&ze()&&nt().catch(()=>{})}).catch(Me=>{Xe(`Error: ${Me.message||"Failed to save."}`,"error")}).finally(()=>{if(oe=!1,U!==null){let Me=U;U=null,Me!==ie&&kt(Me)}}))},Xt=xe=>{if(xe!=null&&xe!==ie){if(oe){U=xe;return}kt(xe)}},It=()=>m&&m.value||e.getAttribute("data-active-bot-id"),ki=()=>{let xe=It();Ne.querySelectorAll(".aipkit_audio_format_combo_select").forEach(Ye=>{let Ve=Ye.closest(".aipkit_popover_option_row"),dt=Ve?.querySelector('[name="input_audio_format"]'),zt=Ve?.querySelector('[name="output_audio_format"]'),oi=Ye.querySelector('option[value="current"]');!dt||!zt||!oi||(oi.textContent=`In: ${dt.value} / Out: ${zt.value}`,Ye.value="current")});let Je=Ne.querySelector('select[name="tts_google_voice_id"]');if(Je&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let Ye=document.getElementById("aipkit_google_tts_voices_json_main");try{let Ve=Ye?.dataset?.voices?JSON.parse(Ye.dataset.voices):[];window.aipkit_updateGoogleVoiceSelect(Je.id,Ve,Je.value||"")}catch(Ve){console.warn("AIPKit Builder: Failed to parse Google TTS voices data.",Ve)}}let He=Ne.querySelector('select[name="tts_elevenlabs_voice_id"]');if(xe&&He&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){let Ye=document.getElementById(`aipkit_elevenlabs_voices_json_${xe}`);try{let Ve=Ye?.dataset?.voices?JSON.parse(Ye.dataset.voices):[];window.aipkit_chatTts_updateElevenLabsVoiceSelect(He.id,Ve,He.value||"")}catch(Ve){console.warn("AIPKit Builder: Failed to parse ElevenLabs voices data.",Ve)}}let Ke=Ne.querySelector('select[name="tts_elevenlabs_model_id"]');if(xe&&Ke&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){let Ye=document.getElementById(`aipkit_elevenlabs_models_json_${xe}`);try{let Ve=Ye?.dataset?.models?JSON.parse(Ye.dataset.models):[];window.aipkit_chatTts_updateElevenLabsModelsSelect(Ke.id,Ve,Ke.value||"")}catch(Ve){console.warn("AIPKit Builder: Failed to parse ElevenLabs models data.",Ve)}}},mi=xe=>{let Me=It();Me&&(F=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_audio_settings",{bot_id:Me,...xe}).then(Je=>{j=xe,Xe(Je.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Me),_i()}).catch(Je=>{Xe(`Error: ${Je.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N){let Je=N;N=null,JSON.stringify(Je)!==JSON.stringify(j)&&mi(Je)}}))},Bi=xe=>{if(!(!xe||Object.keys(xe).length===0)&&JSON.stringify(xe)!==JSON.stringify(j)){if(F){N=xe;return}mi(xe)}};Ne.addEventListener("change",xe=>{let Me=xe.target;if(Me){if(Me.matches(".aipkit_audio_format_combo_select")){let Je=Me.closest(".aipkit_popover_option_row"),He=Je?.querySelector('[name="input_audio_format"]'),Ke=Je?.querySelector('[name="output_audio_format"]'),Ye=Me.querySelector('option[value="current"]'),Ve=Me.value||"";if(!He||!Ke||!Ye||!Ve)return;Ve.startsWith("in:")?He.value=Ve.replace("in:",""):Ve.startsWith("out:")&&(Ke.value=Ve.replace("out:","")),Ye.textContent=`In: ${He.value} / Out: ${Ke.value}`,Me.value="current",He.dispatchEvent(new Event("change",{bubbles:!0})),Ke.dispatchEvent(new Event("change",{bubbles:!0}));return}if(Me.matches('[name="elevenlabs_api_key"]')){Xt(Me.value);return}if((Me.matches(".aipkit_voice_input_toggle_switch")||Me.matches(".aipkit_stt_provider_select")||Me.matches('[name="stt_openai_model_id"]')||Me.matches(".aipkit_tts_toggle_switch")||Me.matches('[name="tts_auto_play"]')||Me.matches(".aipkit_tts_provider_select")||Me.matches('[name="tts_google_voice_id"]')||Me.matches('[name="tts_openai_voice_id"]')||Me.matches('[name="tts_openai_model_id"]')||Me.matches('[name="tts_elevenlabs_voice_id"]')||Me.matches('[name="tts_elevenlabs_model_id"]')||Me.matches(".aipkit_enable_realtime_voice_toggle")||Me.matches('[name="direct_voice_mode"]')||Me.matches('[name="input_audio_noise_reduction"]')||Me.matches('[name="realtime_model"]')||Me.matches('[name="realtime_voice"]')||Me.matches('[name="turn_detection"]')||Me.matches('[name="input_audio_format"]')||Me.matches('[name="output_audio_format"]')||Me.matches('[name="speed"]'))&&(wn(),Bi(P()),Me.matches(".aipkit_tts_provider_select")&&ze())){let Je=ye();Je==="Google"?st().catch(()=>{}):Je==="ElevenLabs"&&nt().catch(()=>{})}}}),wn(),ki(),e.dataset.audioSettingsAutosaveBound="1"}if(Ai&&Bt&&!e.dataset.popupSettingsAutosaveBound){let F=!1,N=null,P=()=>{let U=Ve=>Ai&&Ai.querySelector(Ve)||Vt&&Vt.querySelector(Ve),O=Ve=>{let dt=U(Ve);return dt?dt.value:null},Y=Ve=>{let dt=U(Ve);return dt?dt.checked?"1":"0":null},ce={},ue=O('[name="popup_position"]');ue!==null&&(ce.popup_position=ue);let ye=O('[name="popup_delay"]');ye!==null&&(ce.popup_delay=ye);let ze=O('[name="popup_icon_style"]');ze!==null&&(ce.popup_icon_style=ze);let st=O('[name="popup_icon_size"]');st!==null&&(ce.popup_icon_size=st);let nt=O('[name="popup_icon_type"]');nt!==null&&(ce.popup_icon_type=nt);let ot=O('[name="popup_icon_default"]:checked');ot!==null&&(ce.popup_icon_default=ot);let ut=O('[name="popup_icon_custom_url"]');ut!==null&&(ce.popup_icon_custom_url=ut);let Kt=O('[name="header_avatar_type"]');Kt!==null&&(ce.header_avatar_type=Kt);let jt=O('[name="header_avatar_default"]:checked');jt!==null&&(ce.header_avatar_default=jt);let ci=O('[name="header_avatar_url"]');ci!==null&&(ce.header_avatar_url=ci);let kt=O('[name="header_online_text"]');kt!==null&&(ce.header_online_text=kt);let Xt=Y('[name="popup_label_enabled"]');Xt!==null&&(ce.popup_label_enabled=Xt);let It=O('[name="popup_label_text"]');It!==null&&(ce.popup_label_text=It);let ki=O('[name="popup_label_mode"]');ki!==null&&(ce.popup_label_mode=ki);let mi=O('[name="popup_label_size"]');mi!==null&&(ce.popup_label_size=mi);let Bi=O('[name="popup_label_delay_seconds"]');Bi!==null&&(ce.popup_label_delay_seconds=Bi);let xe=O('[name="popup_label_auto_hide_seconds"]');xe!==null&&(ce.popup_label_auto_hide_seconds=xe);let Me=Y('[name="popup_label_dismissible"]');Me!==null&&(ce.popup_label_dismissible=Me);let Je=Y('[name="popup_label_show_on_desktop"]');Je!==null&&(ce.popup_label_show_on_desktop=Je);let He=Y('[name="popup_label_show_on_mobile"]');He!==null&&(ce.popup_label_show_on_mobile=He);let Ke=O('[name="popup_label_frequency"]');Ke!==null&&(ce.popup_label_frequency=Ke);let Ye=O('[name="popup_label_version"]');return Ye!==null&&(ce.popup_label_version=Ye),ce},j=P(),J=()=>m&&m.value||e.getAttribute("data-active-bot-id"),ie=U=>{let O=J();O&&(F=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_popup_settings",{bot_id:O,...U}).then(Y=>{j=U,Xe(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),_i()}).catch(Y=>{Xe(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N){let Y=N;N=null,JSON.stringify(Y)!==JSON.stringify(j)&&ie(Y)}}))},oe=U=>{if(!(!U||Object.keys(U).length===0)&&JSON.stringify(U)!==JSON.stringify(j)){if(F){N=U;return}ie(U)}};Ai.addEventListener("change",U=>{let O=U.target;O&&((O.matches('select[name="popup_icon_type"]')||O.matches('select[name="popup_icon_style"]')||O.matches('select[name="header_avatar_type"]')||O.matches(".aipkit_popup_hint_toggle_switch"))&&Dn(),(O.matches('[name="popup_position"]')||O.matches('[name="popup_delay"]')||O.matches('[name="popup_icon_style"]')||O.matches('[name="popup_icon_size"]')||O.matches('[name="popup_icon_type"]')||O.matches('[name="popup_icon_default"]')||O.matches('[name="popup_icon_custom_url"]')||O.matches('[name="header_avatar_type"]')||O.matches('[name="header_avatar_default"]')||O.matches('[name="header_avatar_url"]')||O.matches('[name="header_online_text"]')||O.matches('[name="popup_label_enabled"]')||O.matches('[name="popup_label_text"]')||O.matches('[name="popup_label_mode"]')||O.matches('[name="popup_label_size"]')||O.matches('[name="popup_label_delay_seconds"]')||O.matches('[name="popup_label_auto_hide_seconds"]')||O.matches('[name="popup_label_dismissible"]')||O.matches('[name="popup_label_show_on_desktop"]')||O.matches('[name="popup_label_show_on_mobile"]')||O.matches('[name="popup_label_frequency"]')||O.matches('[name="popup_label_version"]'))&&oe(P()))}),Vt&&Vt.addEventListener("change",U=>{let O=U.target;O&&(O.matches('[name="popup_label_text"]')||O.matches('[name="popup_label_mode"]')||O.matches('[name="popup_label_size"]')||O.matches('[name="popup_label_delay_seconds"]')||O.matches('[name="popup_label_auto_hide_seconds"]')||O.matches('[name="popup_label_dismissible"]')||O.matches('[name="popup_label_show_on_desktop"]')||O.matches('[name="popup_label_show_on_mobile"]')||O.matches('[name="popup_label_frequency"]')||O.matches('[name="popup_label_version"]'))&&oe(P())}),Dn(),e.dataset.popupSettingsAutosaveBound="1"}if(I&&Bt&&!e.dataset.conversationSettingsAutosaveBound){let F=!1,N=null,P=()=>{let U=Y=>{let ce=I&&I.querySelector(Y)||Rt&&Rt.querySelector(Y);return ce?ce.value:""},O=Y=>{let ce=I.querySelector(Y);return ce?ce.tagName==="SELECT"?ce.value==="1"?"1":"0":ce.checked?"1":"0":"0"};return{stream_enabled:O(".aipkit_stream_enable_toggle"),openai_conversation_state_enabled:O(".aipkit_stateful_convo_checkbox"),reasoning_effort:U('[name="reasoning_effort"]')}},j=P(),J=U=>{let O=m&&m.value||e.getAttribute("data-active-bot-id");O&&(F=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_conversation_settings",{bot_id:O,...U}).then(Y=>{j=U,Xe(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),_i()}).catch(Y=>{Xe(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N){let Y=N;N=null,JSON.stringify(Y)!==JSON.stringify(j)&&J(Y)}}))},ie=U=>{if(JSON.stringify(U)!==JSON.stringify(j)){if(F){N=U;return}J(U)}},oe=U=>{let O=U.target;O&&(O.matches(".aipkit_stream_enable_toggle")||O.matches(".aipkit_stateful_convo_checkbox")||O.matches(".aipkit_reasoning_effort_slider")||O.matches('[name="reasoning_effort"]'))&&(qn(),ie(P()))};I.addEventListener("change",oe),Rt&&Rt.addEventListener("change",oe),e.dataset.conversationSettingsAutosaveBound="1"}if(I&&Bt&&!e.dataset.fileUploadAutosaveBound){let F=!1,N=null,P=()=>{let oe=I.querySelector('[name="enable_file_upload"]');return!oe||oe.disabled?"":oe.tagName==="SELECT"?oe.value==="1"?"1":"0":oe.checked?"1":"0"},j=P(),J=oe=>{let U=m&&m.value||e.getAttribute("data-active-bot-id");!U||oe===""||(F=!0,Xe("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_file_upload_settings",{bot_id:U,enable_file_upload:oe}).then(O=>{j=oe,Xe(O.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(U),_i()}).catch(O=>{Xe(`Error: ${O.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,N!==null&&N!==j){let O=N;N=null,J(O)}else N=null}))},ie=oe=>{if(!(oe===""||oe===j)){if(F){N=oe;return}J(oe)}};I.addEventListener("change",oe=>{let U=oe.target;U&&U.matches('[name="enable_file_upload"]')&&(ie(P()),Qn()==="1"?Bo():ji())}),e.dataset.fileUploadAutosaveBound="1"}let Q=m&&m.value||e.getAttribute("data-active-bot-id");if(Q&&typeof window.aipkit_refreshChatPreview=="function"){window.aipkit_refreshChatPreview(Q);return}let te=window.aipkit_dashboard?.text?.previewPlaceholderSelect||"Select a bot to see the preview.";r(te)}window.aipkit_initChatbotBuilder=n})();(function(){"use strict";function g(r){if(!r)return;let n=r.querySelector(".aipkit_token_limit_mode_select"),e=r.querySelector(".aipkit_token_general_user_limit_field"),i=r.querySelector(".aipkit_token_role_limits_container");if(!n||!e||!i){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let s=n.value;e.style.display=s==="general"?"block":"none",i.style.display=s==="role_based"?"block":"none"}function a(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Token Management JS: Main content container not found.");return}r.addEventListener("change",function(e){let i=e.target.closest(".aipkit_token_limit_mode_select");if(!i)return;let s=i.closest(".aipkit_accordion-content");s?g(s):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",i)}),r.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(e=>{let i=e.querySelector(".aipkit_accordion-content");i&&g(i)})}window.aipkit_initTokenManagementUI=a})();(function(){"use strict";function g(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let n=document.querySelector(".aipkit_chatbot_module_container");n&&(n.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js.");let a=document.getElementById("aipkit_chatolia_notice");if(a){let n=a.querySelector(".aipkit_notification_bar__close");n&&n.addEventListener("click",()=>{a.style.display="none"});let e=document.getElementById("aipkit_dismiss_chatolia_notice_btn");e&&e.addEventListener("click",()=>{if(typeof window.aipkit_apiRequest!="function"){alert("Error: API function missing.");return}e.disabled=!0,e.textContent="Dismissing...",window.aipkit_apiRequest("aipkit_dismiss_chatolia_notice").then(()=>{a.style.display="none"}).catch(i=>{alert("Error dismissing notice: "+i.message),e.disabled=!1,e.textContent="Dont Show Again"})})}typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatSelectPickers=="function"?window.aipkit_initChatSelectPickers():console.error("AIPKit Chat Admin Main: aipkit_initChatSelectPickers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Chat Admin Main: aipkit_initSyncButtons function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles(".aipkit_chatbot_module_container"):console.error("AIPKit Chat Admin Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCustomThemePresets=="function"?window.aipkit_initCustomThemePresets():console.error("AIPKit Chat Admin Main: aipkit_initCustomThemePresets function not found."),typeof window.aipkit_initCreateNewBot=="function"?window.aipkit_initCreateNewBot():console.error("AIPKit Chat Admin Main: aipkit_initCreateNewBot function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initChatbotBuilder=="function"&&window.aipkit_initChatbotBuilder(),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found.");let r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(r){let n=r.dataset.botId,e=document.getElementById(`aipkit_trigger_builder_${n}`);n&&e&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(n):n&&e&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${n}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy(),function(){let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(i){if(i.target.closest(".aipkit_header_reset_btn, .aipkit_header_delete_btn, .aipkit_actions_dropdown_container .aipkit_tab_dropdown_trigger"))return;if(i.target.closest("#aipkit_chatbot_header_save_btn")){let d=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");d&&(typeof d.requestSubmit=="function"?d.requestSubmit():d.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})));return}if(i.target.closest(".aipkit_header_reset_btn")){let d=e.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");d&&(d.style.display="none");let l=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form")?.dataset.botId,_=e.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",p=e.querySelector("#aipkit_header_action_feedback");if(!l||!p)return;p.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_reset_confirmation" id="aipkit_reset_confirmation_${l}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_inline">Confirm</button>
              </div>
            </div>`,p.querySelector(".aipkit_reset_cancel_inline")?.addEventListener("click",()=>{p.innerHTML=""},{once:!0}),p.querySelector(".aipkit_reset_confirm_inline")?.addEventListener("click",()=>{p.innerHTML='<span class="aipkit_action_status_message">Resetting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:l}).then(f=>{p.innerHTML=`<span class="aipkit_action_status_message success">${f.message||"Chatbot reset successfully!"}</span>`,typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:l}),setTimeout(()=>{p.innerHTML=""},3e3)}).catch(f=>{p.innerHTML=`<span class="aipkit_action_status_message error">Error: ${f.message||"Failed to reset chatbot."}</span>`,setTimeout(()=>{p.innerHTML=""},4e3)})},{once:!0});return}if(i.target.closest(".aipkit_header_delete_btn")){let d=e.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");d&&(d.style.display="none");let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),l=o?.dataset.botId,_=o?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",p=e.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",f=e.querySelector("#aipkit_header_action_feedback");if(!l||!f)return;if(_){f.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{f.innerHTML=""},3e3);return}f.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_delete_confirmation" id="aipkit_delete_confirmation_${l}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_inline">Confirm</button>
              </div>
            </div>`,f.querySelector(".aipkit_delete_cancel_inline")?.addEventListener("click",()=>{f.innerHTML=""},{once:!0}),f.querySelector(".aipkit_delete_confirm_inline")?.addEventListener("click",()=>{f.innerHTML='<span class="aipkit_action_status_message">Deleting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:l}).then(m=>{f.innerHTML=`<span class="aipkit_action_status_message success">${m.message||"Chatbot deleted successfully."}</span>`;let k=null,u=document.getElementById("aipkit_chatbot_main_selector_container");if(u){let w=u.querySelector(".aipkit_tab_dropdown_item .dashicons-star-filled"),h=w?w.closest(".aipkit_tab_dropdown_item"):null;if(h)k=h.getAttribute("data-bot-id");else{let v=u.querySelector(`.aipkit_tab_dropdown_item[data-bot-id]:not([data-bot-id="${l}"])`);v&&(k=v.getAttribute("data-bot-id"))}}if(typeof window.aipkit_loadModule=="function"){let w=k?{force_active_bot_id:k}:{};window.aipkit_loadModule("chatbot",w)}setTimeout(()=>{f.innerHTML=""},3e3)}).catch(m=>{f.innerHTML=`<span class="aipkit_action_status_message error">Error: ${m.message||"Failed to delete chatbot."}</span>`,setTimeout(()=>{f.innerHTML=""},4e3)})},{once:!0});return}})}()}window.aipkit_initChatbot=g})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"modified",sortDirection:"desc",isLoading:!1}})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_ai_forms_list_tbody"),n=document.getElementById("aipkit_ai_forms_container"),e=window.aipkit_escapeHtml||(t=>t),i=wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,s=wp.i18n&&wp.i18n._n?wp.i18n._n:null,c=wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:null;r&&(r.innerHTML="",!(!a||a.length===0)&&a.forEach(t=>{let d=window.aipkit_dashboard?.isProPlan??!1,o=window.aipkit_dashboard?.upgradeUrl||"#",l="",_="";if(d)l=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label">${i("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="pdf_download" value="true">
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`;else{let S=i("This is a Pro feature. Please upgrade.","gpt3-ai-content-generator");l=`
              <div class="aipkit_popover_option_row aipkit_popover_option_row--disabled">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label" data-tooltip="${e(S)}">${i("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch" disabled>
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`,_=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main aipkit_popover_option_main--stacked">
                      <p class="aipkit_form-help">${i("Save as PDF is available on the Pro plan.","gpt3-ai-content-generator")}</p>
                      <a class="aipkit_btn aipkit_btn-primary" href="${e(o)}" target="_blank" rel="noopener noreferrer">
                        ${i("Upgrade to Pro","gpt3-ai-content-generator")}
                      </a>
                  </div>
              </div>`}let p=r.insertRow(),f=p.insertCell();f.classList.add("aipkit_ai_form_title_cell");let m=e(t.title||i("Untitled","gpt3-ai-content-generator")),k=t.updated_at||t.updatedAt||t.updated||"",u="",w="";k&&(typeof window.aipkit_formatRelativeDateTime=="function"?u=window.aipkit_formatRelativeDateTime(k):typeof window.aipkit_formatUtcDateTime=="function"?u=window.aipkit_formatUtcDateTime(k):u=k,typeof window.aipkit_formatUtcDateTime=="function"&&(w=window.aipkit_formatUtcDateTime(k)));let h=t.submissions_count??t.submission_count??t.submissionsCount??0,v=Number.isFinite(Number(h))?Number(h):0,C=[];if(u){let S=c?c(i("Updated %s","gpt3-ai-content-generator"),u):`${i("Updated","gpt3-ai-content-generator")} ${u}`,A=w?` title="${e(w)}"`:"";C.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_updated"${A}>${e(S)}</span>`)}if(v>0){let S=`${v} ${i(v===1?"submission":"submissions","gpt3-ai-content-generator")}`;s&&c&&(S=c(s("%s submission","%s submissions",v,"gpt3-ai-content-generator"),v)),C.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_count">${e(S)}</span>`)}let x=C.length?`
          <span class="aipkit_ai_form_meta">
            ${C.join('<span class="aipkit_ai_form_meta_sep" aria-hidden="true">&middot;</span>')}
          </span>
        `:"";f.innerHTML=`
        <span class="aipkit_ai_form_title_text" title="${m}">${m}</span>
        ${x}
      `;let b=p.insertCell();b.classList.add("aipkit_ai_form_model_cell");let I=t.model||i("Default","gpt3-ai-content-generator");b.textContent=I,b.title=I;let y=p.insertCell();y.classList.add("aipkit_shortcode_cell","aipkit_ai_form_shortcode_cell");let q=`aipkit_ai_form_theme_${t.id}`;y.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${t.id}" readonly value="${e(t.shortcode)}" data-aipkit-shortcode-display="${t.id}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${t.id}" title="${i("Shortcode settings","gpt3-ai-content-generator")}" aria-label="${i("Shortcode settings","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-shortcode" aria-hidden="true"></span>
              <span class="screen-reader-text">${i("Shortcode settings","gpt3-ai-content-generator")}</span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator aipkit_model_settings_popover_panel" id="aif-configurator-${t.id}" style="display: none;" role="dialog" aria-modal="false" aria-labelledby="aif-shortcode-title-${t.id}">
            <div class="aipkit_model_settings_popover_header">
                <span class="aipkit_model_settings_popover_title" id="aif-shortcode-title-${t.id}">
                  ${i("Shortcode Settings","gpt3-ai-content-generator")}
                </span>
                <button
                    type="button"
                    class="aipkit_model_settings_popover_close aipkit_aiform_shortcode_close"
                    aria-label="${i("Close","gpt3-ai-content-generator")}"
                >
                    <span class="dashicons dashicons-no-alt"></span>
                </button>
            </div>
            <div class="aipkit_model_settings_popover_body">
                <div class="aipkit_popover_options_list">
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Show Provider Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="show_provider" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Show Model Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="show_model" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Copy Button","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="copy_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Save as Post","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="save_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    ${l}
                    ${_}
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <label class="aipkit_popover_option_label" for="${q}">
                              ${i("Theme","gpt3-ai-content-generator")}
                            </label>
                            <div class="aipkit_popover_option_actions">
                                <select id="${q}" class="aipkit_popover_option_select aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="theme">
                                    <option value="light">${i("Light (default)","gpt3-ai-content-generator")}</option>
                                    <option value="dark">${i("Dark","gpt3-ai-content-generator")}</option>
                                    <option value="custom">${i("Custom","gpt3-ai-content-generator")}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Shortcode","gpt3-ai-content-generator")}</span>
                            <div class="aipkit_popover_option_actions">
                                <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" readonly value="${e(t.shortcode)}" data-aipkit-shortcode-display="${t.id}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="aipkit_popover_flyout_footer">
                <span class="aipkit_popover_flyout_footer_text">
                    ${i("Need help?","gpt3-ai-content-generator")}
                </span>
                <a
                    class="aipkit_popover_flyout_footer_link"
                    href="https://docs.aipower.org/docs/category/ai-forms"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    ${i("Documentation","gpt3-ai-content-generator")}
                </a>
            </div>
        </div>
      `,n&&typeof window.aipkitForms_applyStoredShortcodeConfig=="function"&&window.aipkitForms_applyStoredShortcodeConfig(t.id,n);let E=p.insertCell();E.classList.add("aipkit_form_actions_cell"),E.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_edit_ai_form_btn" data-form-id="${t.id}" title="${i("Edit","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            ${i("Edit","gpt3-ai-content-generator")}
          </button>
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_preview_ai_form_btn" data-form-id="${t.id}" data-form-title="${e(t.title||"")}" title="${i("Preview","gpt3-ai-content-generator")}" aria-label="${i("Preview","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-visibility" aria-hidden="true"></span>
            <span class="screen-reader-text">${i("Preview","gpt3-ai-content-generator")}</span>
          </button>
          <div class="aipkit_actions_menu">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_actions_menu_toggle" title="${i("More actions","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-ellipsis"></span>
            </button>
            <div class="aipkit_actions_dropdown_menu">
              <button type="button" class="aipkit_dropdown-item-btn aipkit_duplicate_ai_form_btn" data-form-id="${t.id}" title="${i("Duplicate","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-page"></span>
                <span>${i("Duplicate","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_export_ai_form_btn" data-form-id="${t.id}" title="${i("Export","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-download"></span>
                <span>${i("Export","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_dropdown-item--danger aipkit_delete_ai_form_btn" data-form-id="${t.id}" data-form-title="${e(t.title)}" title="${i("Delete","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-trash"></span>
                <span>${i("Delete","gpt3-ai-content-generator")}</span>
              </button>
            </div>
          </div>
        </div>
      `}))}window.aipkitForms_renderTable=g})();(function(){"use strict";function g(a){let r=window.aipkitAIFormsListState,n=document.getElementById("aipkit_ai_forms_pagination"),e=document.getElementById("aipkit_ai_forms_count_summary");if(!n||!a||!r)return;let i=wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o,s=wp.i18n&&wp.i18n._n?wp.i18n._n:(o,l,_)=>_===1?o:l;n.innerHTML="";let{total_forms:c,total_pages:t}=a,d=r.currentPage;if(e){let o=s("form","forms",c,"gpt3-ai-content-generator");e.textContent=`${c.toLocaleString()} ${o}`}if(!(c<=0)&&t>1){let o=document.createElement("span");o.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",l.innerHTML=`\xAB ${i("Previous","gpt3-ai-content-generator")}`,l.disabled=d<=1,o.appendChild(l);let _=document.createElement("span");_.className="aipkit_pagination-current",_.textContent=`${i("Page","gpt3-ai-content-generator")} ${d} ${i("of","gpt3-ai-content-generator")} ${t}`,o.appendChild(_);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",p.innerHTML=`${i("Next","gpt3-ai-content-generator")} \xBB`,p.disabled=d>=t,o.appendChild(p),n.appendChild(o)}}window.aipkitForms_renderPagination=g})();(function(){"use strict";function g(){let a=window.aipkitAIFormsListState;if(!a||a.isLoading)return;a.isLoading=!0;let r=document.getElementById("aipkit_ai_forms_list_tbody"),n=document.getElementById("aipkit_no_ai_forms_message"),e=document.getElementById("aipkit_ai_forms_pagination");r&&(r.innerHTML='<tr><td colspan="4" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),n&&(n.style.display="none"),e&&(e.innerHTML="");let s={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:a.currentPage,search:a.searchQuery,sort_by:a.sortColumn,sort_order:a.sortDirection};window.aipkit_apiRequest("aipkit_list_ai_forms",s).then(c=>{if(typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(c.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(c.pagination||{}),n&&(!c.forms||c.forms.length===0)){n.style.display="block";let t=!!a.searchQuery&&a.searchQuery.trim().length>0;n.textContent=t?"No forms found matching your search.":"No AI Forms have been created yet."}}).catch(c=>{r&&(r.innerHTML=`<tr><td colspan="4" style="color:red;text-align:center;">Error loading forms: ${c.message}</td></tr>`)}).finally(()=>{a.isLoading=!1})}window.aipkitForms_fetchForms=g})();(function(){"use strict";let g;function a(){let r=document.getElementById("aipkit_ai_forms_list_container");if(!r||r.dataset.listListenersAttached)return;r.dataset.listListenersAttached="true";let n=window.aipkitAIFormsListState;if(!n){console.error("AI Forms Events: List state object is not available.");return}r.addEventListener("click",function(i){let s=i.target,c=s.closest(".aipkit-sortable-col");if(c){let t=c.dataset.sortKey;n.sortColumn===t?n.sortDirection=n.sortDirection==="asc"?"desc":"asc":(n.sortColumn=t,n.sortDirection="asc"),n.currentPage=1,r.querySelectorAll(".aipkit-sortable-col").forEach(d=>d.removeAttribute("data-sort-direction")),c.setAttribute("data-sort-direction",n.sortDirection),window.aipkitForms_fetchForms();return}if(s.matches(".aipkit_pagination_prev")){n.currentPage>1&&(n.currentPage--,window.aipkitForms_fetchForms());return}if(s.matches(".aipkit_pagination_next")){n.currentPage++,window.aipkitForms_fetchForms();return}});let e=r.querySelector("#aipkit_ai_forms_search_input");e&&e.addEventListener("input",function(){clearTimeout(g),g=setTimeout(()=>{n.searchQuery=this.value,n.currentPage=1,window.aipkitForms_fetchForms()},400)})}window.aipkitForms_attachListEventListeners=a})();(function(){"use strict";function g(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=g})();(function(){"use strict";function g(a){let r=window.aipkitAIFormsState;if(!a){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let n=a.querySelector("#aipkit_ai_form_elements_palette"),e=a.querySelector("#aipkit_ai_form_designer_area"),i=a.querySelector("#aipkit_form_designer_placeholder");if(!n||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(n.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;n.querySelectorAll(".aipkit_form_element_item").forEach(c=>{c.dataset.dragStartListenerAttached!=="true"&&(c.addEventListener("dragstart",t=>{r.draggedElementType=t.target.dataset.elementType,t.dataTransfer.setData("text/plain",r.draggedElementType),t.dataTransfer.effectAllowed="copy",t.target.classList.add("aipkit-dragging"),r.draggedElement=null}),c.addEventListener("dragend",t=>{t.target.classList.remove("aipkit-dragging"),r.draggedElementType=null}),c.dataset.dragStartListenerAttached="true")}),n.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",c=>{c.target.classList.contains("aipkit_dropped_element")&&(r.draggedElement=c.target,c.dataTransfer.setData("text/element-id",c.target.id),c.dataTransfer.effectAllowed="move",setTimeout(()=>{r.draggedElement&&(r.draggedElement.style.opacity="0.5")},0),r.draggedElementType=null)}),e.addEventListener("dragend",c=>{r.draggedElement&&(r.draggedElement.style.opacity="1",r.draggedElement=null)}),e.addEventListener("dragover",c=>{c.preventDefault();let t=c.target.closest(".aipkit_dropped_element");e.classList.add("aipkit-drag-over"),r.draggedElement&&t&&r.draggedElement!==t?c.dataTransfer.dropEffect="move":c.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",c=>{e.contains(c.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",c=>{c.preventDefault(),e.classList.remove("aipkit-drag-over");let t=c.dataTransfer.getData("text/element-id");if(r.draggedElement&&t===r.draggedElement.id){let d=c.target.closest(".aipkit_dropped_element"),o=null;if(d&&d!==r.draggedElement){let l=d.getBoundingClientRect();o=c.clientY>l.top+l.height/2?d.nextSibling:d}e.insertBefore(r.draggedElement,o),r.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){if(i&&i.style.display!=="none"&&(i.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let d=window.aipkitForms_createNewFormElementData(r.draggedElementType);r.formStructure.push(d),window.aipkitForms_renderDroppedElement(e,d,null)}r.draggedElementType=null,r.draggedElement=null}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=g})();(function(){"use strict";function g(){let a=window.aipkitAIFormsState,r=document.getElementById("aipkit_ai_form_designer_area");if(!r)return;let n=[];r.querySelectorAll(".aipkit_layout_row").forEach(i=>{let s=i.id,c=a.formStructure.find(o=>o.internalId===s);if(!c)return;let t={internalId:s,type:"layout-row",columns:[]};i.querySelectorAll(".aipkit_layout_column").forEach(o=>{let l=o.id,_=c.columns.find(m=>m.internalId===l);if(!_)return;let p={internalId:l,width:_.width,elements:[]};o.querySelectorAll(".aipkit_dropped_element").forEach(m=>{let k=m.id,u=null;a.formStructure.forEach(w=>{w.columns.forEach(h=>{let v=h.elements.find(C=>C.internalId===k);v&&(u=v)})}),u&&p.elements.push(u)}),t.columns.push(p)}),n.push(t)}),a.formStructure=n}window.aipkitForms_updateFormStructureOrder=g})();(function(){"use strict";function g(r){let n=window.aipkitAIFormsState;n.droppedElementCounter++;let e=`field_${r.replace(/-/g,"_")}_${n.droppedElementCounter}`;switch(r){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:r,label:`New ${r.replace(/-/g," ").replace(/\b\w/g,c=>c.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:e,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let i,s;return r==="select"?(i="New Dropdown",s="select"):r==="radio-button"?(i="New Radio Buttons",s="radio"):(i="New Checkbox Group",s="checkbox"),{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:r,label:i,fieldId:`${s}_${n.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${n.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function a(r){let n=Date.now(),e=[];switch(r){case"1-col":e=[{internalId:`col-${n}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":e=[{internalId:`col-${n}-1`,width:"50%",elements:[]},{internalId:`col-${n}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":e=[{internalId:`col-${n}-1`,width:"33.33%",elements:[]},{internalId:`col-${n}-2`,width:"33.33%",elements:[]},{internalId:`col-${n}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":e=[{internalId:`col-${n}-1`,width:"30%",elements:[]},{internalId:`col-${n}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":e=[{internalId:`col-${n}-1`,width:"70%",elements:[]},{internalId:`col-${n}-2`,width:"30%",elements:[]}];break;default:e=[{internalId:`col-${n}-1`,width:"100%",elements:[]}]}return{internalId:`row-${n}`,type:"layout-row",columns:e}}window.aipkitForms_createNewFormElementData=g,window.aipkitForms_createNewLayoutData=a})();(function(){"use strict";function g(a,r,n=null){let e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,i=window.aipkit_escapeHtml||function(p){return p},s=document.createElement("div");s.className="aipkit_dropped_element",s.id=r.internalId,s.dataset.elementType=r.type;let c=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${e("Drag to reorder","gpt3-ai-content-generator")}"></span>`,t="",d=`${r.internalId}-field`,o="";switch(r.helpText&&(o=`<p class="aipkit_dropped_element_help_text">${i(r.helpText)}</p>`),r.type){case"text-input":t=`<label class="aipkit_dropped_element_label" for="${d}">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${d}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${i(r.placeholder)}" readonly>
                    ${o}`;break;case"textarea":t=`<label class="aipkit_dropped_element_label" for="${d}">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${d}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${i(r.placeholder)}" readonly></textarea>
                    ${o}`;break;case"select":let p="";r.options&&r.options.length>0?r.options.forEach(k=>{p+=`<option value="${i(k.value)}">${i(k.text)}</option>`}):p=`<option>${e("No options configured","gpt3-ai-content-generator")}</option>`,t=`<label class="aipkit_dropped_element_label" for="${d}">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${d}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${p}</select>
                    ${o}`;break;case"radio-button":let f="";r.options&&r.options.length>0?r.options.forEach((k,u)=>{let w=`${d}-${u}`;f+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${w}" class="aipkit_dropped_element_field" name="preview-${r.internalId}" disabled>
                                    <label for="${w}">${i(k.text)}</label>
                                </div>`}):f=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,t=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${f}
                    </fieldset>
                    ${o}`;break;case"checkbox":let m="";r.options&&r.options.length>0?r.options.forEach((k,u)=>{let w=`${d}-${u}`;m+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${w}" class="aipkit_dropped_element_field" name="preview-${r.internalId}-${u}" disabled>
                                    <label for="${w}">${i(k.text)}</label>
                                </div>`}):m=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,t=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${m}
                    </fieldset>
                    ${o}`;break;case"file-upload":t=`<label class="aipkit_dropped_element_label" for="${d}">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${d}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${o}`;break;default:t=`<p>${i(r.label)}</p>${o}`}let l=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${e("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,_=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${e("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;s.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${t}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${c}
            ${l}
            ${_}
        </div>
    `,n?a.insertBefore(s,n):a.appendChild(s)}window.aipkitForms_renderFieldInColumn=g,window.aipkitForms_renderDroppedElement=g})();(function(){"use strict";function g(a,r){let n=window.aipkitAIFormsState,e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c;if(!r){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let i=r.querySelector("#aipkit_ai_form_designer_area");if(!i){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let s=i.querySelector(`#${CSS.escape(a)}`);if(s&&(s.remove(),n.formStructure.forEach(c=>{c.columns.forEach(t=>{t.elements=t.elements.filter(d=>d.internalId!==a)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r),n.selectedDesignerElementId===a&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(r):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),i.querySelectorAll(".aipkit_dropped_element").length===0&&i.querySelectorAll(".aipkit_layout_row").length===0)){let c=i.querySelector("#aipkit_form_designer_placeholder");c||(c=document.createElement("div"),c.className="aipkit_form_designer_placeholder",c.id="aipkit_form_designer_placeholder",c.innerHTML=`<span class="dashicons dashicons-layout"></span>${e("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,i.appendChild(c)),c.style.display="flex"}}window.aipkitForms_deleteDroppedElement=g})();(function(){"use strict";function g(){let a=window.aipkitAIFormsState,r=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,n=document.getElementById("aipkit_form_editor_container");if(!n)return;let e=n.querySelector("#aipkit_ai_form_prompt_template"),i=n.querySelector("#aipkit_prompt_validation_results");if(!e||!i)return;let s=e.value,c=[],t=[],d=new Set;a.formStructure.forEach(m=>{m.columns.forEach(k=>{k.elements.forEach(u=>{u.fieldId&&d.add(u.fieldId)})})});let o=/{[a-zA-Z0-9_]+}/g,l=(s.match(o)||[]).map(m=>m.slice(1,-1)),_=new Set(l);l.forEach(m=>{d.has(m)||c.push(`Variable <code>{${m}}</code> is used in the prompt but not defined as a form field.`)}),d.forEach(m=>{_.has(m)||t.push(`Field <code>{${m}}</code> is defined but not used in the prompt.`)});let p=s;if(l.forEach(m=>{let k=new RegExp(`\\{${m}\\}`,"g");p=p.replace(k,"")}),/[{}]/.test(p)&&c.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),i.className="aipkit_form-help",i.innerHTML="",c.length>0){i.classList.add("aipkit-validation-error");let m=`<strong>${r("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;c.forEach(k=>{m+=`<li>${k}</li>`}),m+="</ul>",i.innerHTML=m}else{i.classList.add("aipkit-validation-success");let m=`<strong>${r("Validation Passed!","gpt3-ai-content-generator")}</strong> (${l.length} of ${d.size} fields used).`;t.length>0&&(m+=`<br><strong>${r("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,t.forEach(k=>{m+=`<li>${k}</li>`}),m+="</ul>"),i.innerHTML=m}i.style.display="block",i.dismissTimer&&clearTimeout(i.dismissTimer);let f=c.length>0?8e3:5e3;i.dismissTimer=setTimeout(()=>{i.style.display="none",i.innerHTML=""},f)}window.aipkitForms_validatePrompt=g})();(function(){"use strict";function g(a,r){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,s=window.aipkit_escapeHtml||function(p){return p};if(!r){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}r.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(p=>p.classList.remove("aipkit-element-selected"));let c=r.querySelector(`#${CSS.escape(a)}`);c&&c.classList.add("aipkit-element-selected"),n.selectedDesignerElementId=a;let t=null;for(let p of n.formStructure){for(let f of p.columns){let m=f.elements.find(k=>k.internalId===a);if(m){t=m;break}}if(t)break}if(!t){console.error(`showSettingsPanel: Could not find element data for ID ${a} in state.`,n.formStructure);return}let d=r.querySelector("#aipkit_ai_form_elements_palette"),o=r.querySelector("#aipkit_ai_form_element_settings_panel"),l=o?o.querySelector("#aipkit_settings_panel_fields"):null,_=o?o.querySelector("#aipkit_settings_panel_element_type"):null;if(!d||!o||!l||!_){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(_.textContent=`(${t.type.replace(/-/g," ").replace(/\b\w/g,p=>p.toUpperCase())})`,l.innerHTML="",l.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${t.internalId}">${i(e.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${t.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="label" value="${s(t.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${t.internalId}">${i(e.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${t.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="fieldId" value="${s(t.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${i("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${i(e.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(t.type==="text-input"||t.type==="textarea")&&(l.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${t.internalId}">${i(e.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${t.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="placeholder" value="${s(t.placeholder||"")}">
                </div>`),l.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${t.internalId}">
                    <input type="checkbox" id="setting-required-${t.internalId}" class="aipkit-setting-field" data-setting="required" ${t.required?"checked":""}>
                    ${i(e.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${t.internalId}">${i("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${t.internalId}" class="aipkit_form-input aipkit_builder_textarea aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${s(i("This text will appear under the field.","gpt3-ai-content-generator"))}">${s(t.helpText||"")}</textarea>
            </div>
        `,t.type==="select"||t.type==="radio-button"||t.type==="checkbox"){let p=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${i(e.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(t.options||[]).forEach((f,m)=>{p+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-value" data-option-index="${m}" value="${s(f.value)}" placeholder="${i(e.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-text" data-option-index="${m}" value="${s(f.text)}" placeholder="${i(e.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${i(e.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),p+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${i(e.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,l.innerHTML+=p}d.style.display="none",o.style.display="block"}window.aipkitForms_showSettingsPanel=g})();(function(){"use strict";function g(a){let r=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;if(!a){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let e=a.querySelector("#aipkit_ai_form_element_settings_panel");if(!e){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let i=e.querySelector("#aipkit_select_options_container");if(!i){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let s=i.querySelectorAll(".aipkit_select_option_row").length,c=document.createElement("div");c.className="aipkit_select_option_row",c.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${s}" placeholder="${n(r.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${s}" placeholder="${n(r.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${n(r.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,i.appendChild(c)}window.aipkitForms_addSelectOptionRow=g})();(function(){"use strict";function g(a){let r=window.aipkitAIFormsState;if(!a){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}a.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(i=>i.classList.remove("aipkit-element-selected")),r.selectedDesignerElementId=null;let n=a.querySelector("#aipkit_ai_form_elements_palette"),e=a.querySelector("#aipkit_ai_form_element_settings_panel");n&&(n.style.display="block"),e&&(e.style.display="none")}window.aipkitForms_hideSettingsPanel=g})();(function(){"use strict";function g(a,r){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f;if(!r){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let s=null;for(let f of n.formStructure){for(let m of f.columns){let k=m.elements.find(u=>u.internalId===a);if(k){s=k;break}}if(s)break}if(!s){console.error(`updateElementFromSettingsPanel: Element data for ID ${a} not found.`);return}let c=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!c){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let t=c.querySelector('input[data-setting="label"]');t&&(s.label=t.value);let d=c.querySelector('input[data-setting="fieldId"]');if(d){let f=d.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!f){let k=s.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");k||(k=s.type.replace(/-/g,"_")),f=`${k}_${a.split("-").pop()}`}let m=!0;e:for(let k of n.formStructure)for(let u of k.columns)if(u.elements.some(w=>w.internalId!==a&&w.fieldId===f)){m=!1;break e}m&&f.length>0?(s.fieldId=f,d.value=f,d.classList.remove("aipkit_input_error")):f.length>0&&d.classList.add("aipkit_input_error")}let o=c.querySelector('input[data-setting="required"]');o&&(s.required=o.checked);let l=c.querySelector('textarea[data-setting="helpText"]');if(l&&(s.helpText=l.value),s.type==="text-input"||s.type==="textarea"){let f=c.querySelector('input[data-setting="placeholder"]');f&&(s.placeholder=f.value)}(s.type==="select"||s.type==="radio-button"||s.type==="checkbox")&&(s.options=[],c.querySelectorAll(".aipkit_select_option_row").forEach(m=>{let k=m.querySelector('input[data-setting="option-value"]'),u=m.querySelector('input[data-setting="option-text"]');k&&u&&k.value.trim()!==""?s.options.push({value:k.value,text:u.value}):k&&u&&k.value.trim()===""&&u.value.trim()!==""&&s.options.push({value:u.value,text:u.value})}));let _=r.querySelector("#aipkit_ai_form_designer_area"),p=_?_.querySelector(`#${CSS.escape(a)}`):null;if(p&&_){let f=p.parentElement,m=_.scrollTop,k=p.classList.contains("aipkit-element-selected"),u=p.nextElementSibling;if(p.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(f,s,u):console.error("AI Forms updateElement: renderFieldInColumn function missing."),k){let w=_.querySelector(`#${CSS.escape(a)}`);w&&w.classList.add("aipkit-element-selected")}_.scrollTop=m}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r)}window.aipkitForms_updateElementFromSettingsPanel=g})();(function(){"use strict";function g(e){let i=window.aipkitAIFormsState;if(!e)return;let s=e.querySelector("#aipkit_prompt_snippets_container");if(!s)return;s.innerHTML="";let c=new Set;if(i.formStructure.forEach(t=>{t.columns.forEach(d=>{d.elements.forEach(o=>{o.fieldId&&c.add(o.fieldId)})})}),c.size>0){let t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:d=>d;c.forEach(d=>{let o=document.createElement("button");o.type="button",o.className="aipkit_prompt_snippet",o.dataset.fieldId=d,o.title=t("Click to copy","gpt3-ai-content-generator"),o.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${d}}`,s.appendChild(o)})}}function a(e){if(!e)return;let i=e.querySelector("#aipkit_form_editor_container");if(!i){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let s=i.querySelector("#aipkit_prompt_snippets_container");if(!s){console.warn("AI Forms: Prompt snippets container not found for init.");return}s.dataset.listenerAttached!=="true"&&(s.addEventListener("click",function(c){let t=c.target.closest(".aipkit_prompt_snippet");if(!t)return;let d=t.dataset.fieldId;d&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${d}}`,t)}),s.dataset.listenerAttached="true")}function r(e,i){if(!e)return;let s=e.querySelector("#aipkit_ai_form_ai_provider");s&&(s.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(i?s.dataset.aipkitProviderNoticeArmed="true":delete s.dataset.aipkitProviderNoticeArmed),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(e))}function n(e=null,i){let s=window.aipkitAIFormsState,c=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,d=window.aipkit_escapeHtml||function(m){return m};if(!i){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}s.currentFormId=e,s.droppedElementCounter=0,s.formStructure=[],s.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(i):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let o=i.querySelector("#aipkit_form_editor_container"),l=i.querySelector("#aipkit_ai_forms_list_container"),_=i.querySelector("#aipkit_ai_forms_editor_actions"),p=i.querySelector("#aipkit_create_new_ai_form_btn"),f=i.querySelector("#aipkit_ai_forms_settings_trigger");l.style.display="none",o.style.display="block",_&&(_.style.display="flex"),p&&(p.style.display="none"),f&&(f.style.display="none"),requestAnimationFrame(()=>{let m=()=>{typeof window.aipkitForms_refreshSelectPickers=="function"&&window.aipkitForms_refreshSelectPickers(i)},k=i.querySelector("#aipkit_ai_form_title"),u=o.querySelector("#aipkit_ai_form_prompt_template"),w=o.querySelector("#aipkit_ai_form_id"),h=o.querySelector("#aipkit_ai_form_designer_area"),v=o.querySelector("#aipkit_ai_form_ai_provider"),C=o.querySelector("#aipkit_ai_form_ai_model"),x=o.querySelector("#aipkit_ai_form_temperature"),b=o.querySelector("#aipkit_ai_form_temperature_value"),I=o.querySelector("#aipkit_ai_form_max_tokens"),y=o.querySelector("#aipkit_ai_form_max_tokens_value"),q=o.querySelector("#aipkit_ai_form_top_p"),E=o.querySelector("#aipkit_ai_form_top_p_value"),S=o.querySelector("#aipkit_ai_form_frequency_penalty"),A=o.querySelector("#aipkit_ai_form_frequency_penalty_value"),T=o.querySelector("#aipkit_ai_form_presence_penalty"),M=o.querySelector("#aipkit_ai_form_presence_penalty_value"),V=i.querySelector("#aipkit_preview_ai_form_btn"),W=()=>{let Z=document.createElement("div");return Z.className="aipkit_form_designer_placeholder",Z.id="aipkit_form_designer_placeholder",Z.innerHTML=`<span class="dashicons dashicons-layout"></span>${t("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,Z};if(!o||!l||!k||!u||!w||!h||!v||!C||!x||!I||!V||!b||!y||!q||!E||!S||!A||!T||!M){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:i.innerHTML.substring(0,500)});return}let R=i.querySelector("#aipkit_ai_forms_header_title_default"),B=i.querySelector("#aipkit_ai_forms_header_title_editor"),$=i.querySelector("#aipkit_ai_forms_title_display"),G=i.querySelector("#aipkit_ai_forms_title_text"),L=t("New Form","gpt3-ai-content-generator"),K=()=>{if(!G||!$||!k)return;let pe=k.value.trim()||L;G.textContent=pe,$.setAttribute("title",pe)},H=()=>{!$||!k||($.style.display="none",k.style.display="inline-block",k.focus(),k.select())},ne=()=>{!$||!k||(k.style.display="none",$.style.display="inline-flex",K())};R&&(R.style.display="none"),B&&(B.style.display="flex"),B&&B.dataset.inlineTitleBound!=="true"&&$&&k&&($.addEventListener("click",H),k.addEventListener("blur",ne),k.addEventListener("keydown",Z=>{Z.key==="Enter"&&(Z.preventDefault(),k.blur())}),k.addEventListener("input",K),B.dataset.inlineTitleBound="true"),k.value="",u.value="",w.value="",h.innerHTML="",h.appendChild(W()),ne(),g(i);let ae={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Engine",model_label:"Model"};if(o.querySelectorAll('input[name^="labels["]').forEach(Z=>{let pe=Z.name.match(/labels\[(.+)\]/),ve=pe?pe[1]:null;ve&&ae[ve]!==void 0?Z.value=ae[ve]:Z.value=""}),!e){if(v.value="OpenAI",x&&b){let Z=window.aipkit_dashboard?.ai_params?.temperature||1;x.value=Z,b.textContent=Z}if(I&&y){let Z=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;I.value=Z,y.textContent=Z}if(q&&E){let Z=window.aipkit_dashboard?.ai_params?.top_p||1;q.value=Z,E.textContent=Z}if(S&&A){let Z=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;S.value=Z,A.textContent=Z}if(T&&M){let Z=window.aipkit_dashboard?.ai_params?.presence_penalty||0;T.value=Z,M.textContent=Z}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(o)),typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(v.value,o),m(),r(o,!0)}e?(V.disabled=!1,w.value=e,h.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${t("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:e,_ajax_nonce:c.nonce_manage_forms}).then(Z=>{if(Z.form){k.value=Z.form.title||"",ne(),u.value=Z.form.prompt_template||"",v.value=Z.form.ai_provider||"OpenAI",x&&b&&(x.value=Z.form.temperature,b.textContent=Z.form.temperature),I&&y&&(I.value=Z.form.max_tokens,y.textContent=Z.form.max_tokens),q&&E&&(q.value=Z.form.top_p,E.textContent=Z.form.top_p),S&&A&&(S.value=Z.form.frequency_penalty,A.textContent=Z.form.frequency_penalty),T&&M&&(T.value=Z.form.presence_penalty,M.textContent=Z.form.presence_penalty);let pe=Z.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(Be=>{let qe=o.querySelector(`input[name="labels[${Be}]"]`);qe&&(qe.value=pe[Be]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(v.value,Z.form.ai_model);let De=o.querySelector("#aipkit_ai_form_reasoning_effort");De&&(De.value=Z.form.reasoning_effort||""),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(o);let Qe=o.querySelector('input[name="enable_vector_store"]'),$e=Qe?Qe.closest('[data-aipkit-settings-panel="context"]'):null;if($e){let Be=$e.querySelector('select[name="vector_store_provider"]'),qe=$e.querySelector('select[name="openai_vector_store_ids[]"]'),gt=$e.querySelector('select[name="pinecone_index_name"]'),Pt=$e.querySelector('select[name="qdrant_collection_name"]'),qt=$e.querySelector(".aipkit_vector_embedding_select"),We=$e.querySelector('select[name="vector_embedding_provider"]'),xi=$e.querySelector('select[name="vector_embedding_model"]'),Li=$e.querySelector('input[name="vector_store_top_k"]'),Ft=$e.querySelector("#aipkit_ai_form_vector_store_top_k_value"),bt=$e.querySelector('input[name="vector_store_confidence_threshold"]'),Qt=$e.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");if(Qe.checked=Z.form.enable_vector_store==="1",Be&&(Be.value=Z.form.vector_store_provider||"openai"),gt&&(gt.value=Z.form.pinecone_index_name||""),gt&&Z.form.pinecone_index_name&&!Array.from(gt.options).some(Jt=>Jt.value===Z.form.pinecone_index_name)){let Jt=new Option(`${Z.form.pinecone_index_name} (Manual)`,Z.form.pinecone_index_name,!1,!0);gt.appendChild(Jt),gt.value=Z.form.pinecone_index_name}if(Pt){let Jt=Array.isArray(Z.form.qdrant_collection_names)?Z.form.qdrant_collection_names[0]:Z.form.qdrant_collection_name||"";if(Jt&&!Array.from(Pt.options).some(di=>di.value===Jt)){let di=new Option(`${Jt} (Manual)`,Jt,!1,!0);Pt.appendChild(di)}Jt&&(Pt.value=Jt)}if(We&&(We.value=Z.form.vector_embedding_provider||"openai"),Li&&Ft){let Jt=Z.form.vector_store_top_k||3;Li.value=Jt,Ft.textContent=Jt}if(bt&&Qt){let Jt=Z.form.vector_store_confidence_threshold||20;bt.value=Jt,Qt.textContent=Jt+"%"}if(qe&&Z.form.openai_vector_store_ids&&Array.isArray(Z.form.openai_vector_store_ids)){let Jt=new Set(Array.from(qe.options).map(di=>di.value));Z.form.openai_vector_store_ids.forEach((di,Hi)=>{if(di&&!Jt.has(di)){let ti=new Option(`Manual store ${Hi+1}`,di,!1,!0);qe.appendChild(ti),Jt.add(di)}}),Array.from(qe.options).forEach(di=>{di.selected=Z.form.openai_vector_store_ids.includes(di.value)})}typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels($e),xi&&(xi.value=Z.form.vector_embedding_model||""),typeof window.aipkitForms_syncEmbeddingSelectFromInputs=="function"&&window.aipkitForms_syncEmbeddingSelectFromInputs($e,qt),Qe.dispatchEvent(new Event("change",{bubbles:!0}))}let lt=o.querySelector('input[name="openai_web_search_enabled"]'),it=o.querySelector('input[name="claude_web_search_enabled"]'),we=o.querySelector('input[name="google_search_grounding_enabled"]');lt&&(lt.checked=Z.form.openai_web_search_enabled==="1"),it&&(it.checked=Z.form.claude_web_search_enabled==="1"),we&&(we.checked=Z.form.google_search_grounding_enabled==="1");let at=o.querySelector('select[name="openai_web_search_context_size"]'),Zt=o.querySelector('select[name="openai_web_search_loc_type"]'),$t=o.querySelector('input[name="openai_web_search_loc_country"]'),li=o.querySelector('input[name="openai_web_search_loc_city"]'),ai=o.querySelector('input[name="openai_web_search_loc_region"]'),se=o.querySelector('input[name="openai_web_search_loc_timezone"]');at&&(at.value=Z.form.openai_web_search_context_size||"medium"),Zt&&(Zt.value=Z.form.openai_web_search_loc_type||"none"),$t&&($t.value=Z.form.openai_web_search_loc_country||""),li&&(li.value=Z.form.openai_web_search_loc_city||""),ai&&(ai.value=Z.form.openai_web_search_loc_region||""),se&&(se.value=Z.form.openai_web_search_loc_timezone||"");let ke=o.querySelector('input[name="claude_web_search_max_uses"]'),_e=o.querySelector('select[name="claude_web_search_loc_type"]'),Ce=o.querySelector('input[name="claude_web_search_loc_country"]'),Pe=o.querySelector('input[name="claude_web_search_loc_city"]'),be=o.querySelector('input[name="claude_web_search_loc_region"]'),Oe=o.querySelector('input[name="claude_web_search_loc_timezone"]'),Re=o.querySelector('input[name="claude_web_search_allowed_domains"]'),_t=o.querySelector('input[name="claude_web_search_blocked_domains"]'),Wt=o.querySelector('select[name="claude_web_search_cache_ttl"]');ke&&(ke.value=Z.form.claude_web_search_max_uses||"5"),_e&&(_e.value=Z.form.claude_web_search_loc_type||"none"),Ce&&(Ce.value=Z.form.claude_web_search_loc_country||""),Pe&&(Pe.value=Z.form.claude_web_search_loc_city||""),be&&(be.value=Z.form.claude_web_search_loc_region||""),Oe&&(Oe.value=Z.form.claude_web_search_loc_timezone||""),Re&&(Re.value=Z.form.claude_web_search_allowed_domains||""),_t&&(_t.value=Z.form.claude_web_search_blocked_domains||""),Wt&&(Wt.value=Z.form.claude_web_search_cache_ttl||"none");let ri=o.querySelector('select[name="google_grounding_mode"]'),Ht=o.querySelector('input[name="google_grounding_dynamic_threshold"]'),ht=o.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(ri&&(ri.value=Z.form.google_grounding_mode||"DEFAULT_MODE"),Ht){let Be=Z.form.google_grounding_dynamic_threshold||.3;Ht.value=Be,ht&&(ht.textContent=Be)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(v.value,o),lt&&lt.dispatchEvent(new Event("change",{bubbles:!0})),it&&it.dispatchEvent(new Event("change",{bubbles:!0})),we&&we.dispatchEvent(new Event("change",{bubbles:!0})),Z.form.structure&&Array.isArray(Z.form.structure))if(s.formStructure=Z.form.structure,h.innerHTML="",s.formStructure.length===0)h.appendChild(W());else{s.formStructure.forEach(qe=>{window.aipkitForms_renderLayoutRow(h,qe,null,i)});let Be=0;s.formStructure.forEach(qe=>{qe.columns.forEach(gt=>{gt.elements.forEach(Pt=>{let qt=Pt.internalId.split("-"),We=parseInt(qt[qt.length-1],10)||0;We>Be&&(Be=We)})})}),s.droppedElementCounter=Be}else h.innerHTML="",h.appendChild(W());m(),r(o,!0),g(i)}else throw new Error(Z.message||t("Could not load form data.","gpt3-ai-content-generator"))}).catch(Z=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(i,"error",Z.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(i):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):(V.disabled=!0,ne())})}window.aipkitForms_showFormEditor=n,window.aipkitForms_updatePromptSnippets=g,window.aipkitForms_initPromptSnippets=a})();(function(){"use strict";function g(a){let r=window.aipkitAIFormsState,n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p;if(!a){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}r.currentFormId=null,r.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(a):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let e=a.querySelector("#aipkit_form_editor_container"),i=a.querySelector("#aipkit_ai_forms_list_container"),s=a.querySelector("#aipkit_ai_forms_editor_actions"),c=a.querySelector("#aipkit_create_new_ai_form_btn"),t=a.querySelector("#aipkit_ai_forms_settings_trigger"),d=a.querySelector("#aipkit_ai_forms_header_title_default"),o=a.querySelector("#aipkit_ai_forms_header_title_editor");if(e&&(e.style.display="none"),i&&(i.style.display="block"),s&&(s.style.display="none"),c&&(c.style.display=""),t&&(t.style.display=""),d&&(d.style.display=""),o&&(o.style.display="none"),typeof window.aipkitForms_closePreviewSheet=="function"&&window.aipkitForms_closePreviewSheet(a),e){let p=e.querySelector("#aipkit_ai_form_ai_provider");p&&delete p.dataset.aipkitProviderNoticeArmed}let l=document.getElementById("aipkit_provider_notice_ai_forms");if(l&&l.classList.add("aipkit_provider_notice--hidden"),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(a),e){let p=e.querySelector("#aipkit_ai_form_preview_container");p&&(p.style.display="none",p.innerHTML="");let f=a.querySelector("#aipkit_preview_ai_form_btn");if(f&&f.classList.contains("aipkit-preview-active")){f.classList.remove("aipkit-preview-active");let m=f.querySelector(".aipkit_btn-text");m&&(m.textContent=n("Preview","gpt3-ai-content-generator"))}}let _=a.querySelector("#aipkit_ai_forms_messages");_&&(_.innerHTML="")}window.aipkitForms_hideFormEditor=g})();(function(){"use strict";function g(a,r){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:Oe=>Oe,s={value:null},c=()=>r.querySelector("#aipkit_ai_forms_status"),t=(Oe,Re)=>{let _t=c();if(!_t)return;let Wt=_t.classList.contains("aipkit_training_status");if(_t.textContent=Oe||"",Wt){_t.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),Oe&&_t.classList.add("is-visible"),Re&&_t.classList.add(`is-${Re}`);return}_t.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),Re==="success"?_t.classList.add("aipkit_form-help-success"):Re==="error"&&_t.classList.add("aipkit_form-help-error")},d=(Oe=2500)=>{s.value&&window.clearTimeout(s.value),s.value=window.setTimeout(()=>{t("","")},Oe)};if(!r){console.error("AI Forms saveForm: formsContainerElement not provided.");return}let o=r.querySelector("#aipkit_form_editor_container");if(!o){console.error("AI Forms saveForm: editorContainer not found in provided formsContainerElement.");return}let l=r.querySelector("#aipkit_ai_form_title"),_=o.querySelector("#aipkit_ai_form_prompt_template"),p=o.querySelector("#aipkit_ai_form_id"),f=o.querySelector("#aipkit_ai_form_ai_provider"),m=o.querySelector("#aipkit_ai_form_ai_model"),k=o.querySelector("#aipkit_ai_form_temperature"),u=o.querySelector("#aipkit_ai_form_max_tokens"),w=o.querySelector("#aipkit_ai_form_top_p"),h=o.querySelector("#aipkit_ai_form_frequency_penalty"),v=o.querySelector("#aipkit_ai_form_presence_penalty"),C=o.querySelector("#aipkit_ai_form_reasoning_effort"),x=o.querySelector('input[name="enable_vector_store"]'),b=o.querySelector('select[name="vector_store_provider"]'),I=o.querySelector('select[name="openai_vector_store_ids[]"]'),y=o.querySelector('select[name="pinecone_index_name"]'),q=o.querySelector('select[name="qdrant_collection_name"]'),E=o.querySelector('select[name="vector_embedding_provider"]'),S=o.querySelector('select[name="vector_embedding_model"]'),A=o.querySelector('input[name="vector_store_top_k"]'),T=o.querySelector('input[name="vector_store_confidence_threshold"]'),M=o.querySelector('input[name="openai_web_search_enabled"]'),V=o.querySelector('input[name="claude_web_search_enabled"]'),W=o.querySelector('input[name="google_search_grounding_enabled"]'),R=o.querySelector('select[name="openai_web_search_context_size"]'),B=o.querySelector('select[name="openai_web_search_loc_type"]'),$=o.querySelector('input[name="openai_web_search_loc_country"]'),G=o.querySelector('input[name="openai_web_search_loc_city"]'),L=o.querySelector('input[name="openai_web_search_loc_region"]'),K=o.querySelector('input[name="openai_web_search_loc_timezone"]'),H=o.querySelector('input[name="claude_web_search_max_uses"]'),ne=o.querySelector('select[name="claude_web_search_loc_type"]'),ae=o.querySelector('input[name="claude_web_search_loc_country"]'),Z=o.querySelector('input[name="claude_web_search_loc_city"]'),pe=o.querySelector('input[name="claude_web_search_loc_region"]'),ve=o.querySelector('input[name="claude_web_search_loc_timezone"]'),De=o.querySelector('input[name="claude_web_search_allowed_domains"]'),Qe=o.querySelector('input[name="claude_web_search_blocked_domains"]'),$e=o.querySelector('select[name="claude_web_search_cache_ttl"]'),lt=o.querySelector('select[name="google_grounding_mode"]'),it=o.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!l||!_||!p||!f||!m||!k||!u||!w||!h||!v){console.error("AI Forms saveForm: One or more critical form editor inputs not found in editorContainer.");return}let we=l.value.trim(),at=_.value.trim(),Zt=p.value;if(we||(we=i("New Form","gpt3-ai-content-generator"),l.value=we,l.dispatchEvent(new Event("input",{bubbles:!0}))),!at){alert(i(e.text.promptTemplateRequired||"Prompt template is required.","gpt3-ai-content-generator"));return}let $t=new Set,li=!0;e:for(let Oe of n.formStructure)for(let Re of Oe.columns)for(let _t of Re.elements){if(!_t.fieldId||!/^[a-zA-Z0-9_]+$/.test(_t.fieldId)){alert(i(`Invalid Field Variable Name: "${_t.fieldId||""}" for element "${_t.label}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(_t.internalId,r);let Wt=o.querySelector(`#setting-field-id-${_t.internalId}`);Wt&&Wt.focus(),li=!1;break e}if($t.has(_t.fieldId)){alert(i(`Duplicate Field Variable Name: "${_t.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(_t.internalId,r);let Wt=o.querySelector(`#setting-field-id-${_t.internalId}`);Wt&&Wt.focus(),li=!1;break e}$t.add(_t.fieldId)}if(!li)return;let ai=I?Array.from(I.selectedOptions).map(Oe=>Oe.value):[],se=o.querySelectorAll('input[name^="labels["]'),ke={};se.forEach(Oe=>{let Re=Oe.name.match(/\[(.*?)\]/);if(Re&&Re[1]){let _t=Re[1];ke[_t]=Oe.value}});let _e=JSON.stringify(ke),Ce={_ajax_nonce:e.nonce_manage_forms,form_id:Zt||null,title:we,prompt_template:at,form_structure:JSON.stringify(n.formStructure),ai_provider:f.value,ai_model:m.value,temperature:k.value,max_tokens:u.value,top_p:w.value,frequency_penalty:h.value,presence_penalty:v.value,reasoning_effort:C?.value,enable_vector_store:x?.checked?"1":"0",vector_store_provider:b?.value,openai_vector_store_ids:ai,pinecone_index_name:y?.value||"",qdrant_collection_name:q?.value||"",vector_embedding_provider:E?.value,vector_embedding_model:S?.value||"",vector_store_top_k:A?.value||3,vector_store_confidence_threshold:T?.value||20,openai_web_search_enabled:M?.checked?"1":"0",claude_web_search_enabled:V?.checked?"1":"0",google_search_grounding_enabled:W?.checked?"1":"0",openai_web_search_context_size:R?.value||"medium",openai_web_search_loc_type:B?.value||"none",openai_web_search_loc_country:$?.value||"",openai_web_search_loc_city:G?.value||"",openai_web_search_loc_region:L?.value||"",openai_web_search_loc_timezone:K?.value||"",claude_web_search_max_uses:H?.value||"5",claude_web_search_loc_type:ne?.value||"none",claude_web_search_loc_country:ae?.value||"",claude_web_search_loc_city:Z?.value||"",claude_web_search_loc_region:pe?.value||"",claude_web_search_loc_timezone:ve?.value||"",claude_web_search_allowed_domains:De?.value||"",claude_web_search_blocked_domains:Qe?.value||"",claude_web_search_cache_ttl:$e?.value||"none",google_grounding_mode:lt?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:it?.value||"0.30",labels:_e},Pe=a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent:a.textContent,be=a.querySelector(".aipkit_spinner");a.disabled=!0,be&&(be.style.display="inline-block"),a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent=i(e.text.savingForm||"Saving...","gpt3-ai-content-generator"):a.firstChild.textContent=i(e.text.savingForm||"Saving...","gpt3-ai-content-generator")+" ",t(i("Saving...","gpt3-ai-content-generator"),"loading"),window.aipkit_apiRequest("aipkit_save_ai_form",Ce).then(Oe=>{if(!Zt&&Oe.form_id){p&&(p.value=Oe.form_id),n.currentFormId=Oe.form_id;let Re=r.querySelector("#aipkit_preview_ai_form_btn");Re&&(Re.disabled=!1)}t(Oe.message||i(e.text.formSaved||"Form saved!","gpt3-ai-content-generator"),"success"),d(),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(Oe=>{t(Oe.message||i(e.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator"),"error"),d(4e3)}).finally(()=>{a.disabled=!1,be&&(be.style.display="none"),a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent=Pe:a.firstChild.textContent=Pe})}window.aipkitForms_saveForm=g})();(function(){"use strict";function g(a,r,n){let e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;if(!n){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let s={_ajax_nonce:e.nonce_manage_forms,form_id:a},c=r.textContent;r.disabled=!0,r.textContent=i(e.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",s).then(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",t.message||i(e.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",t.message||i(e.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let d=n.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${a}"]`);d&&(d.disabled=!1,d.textContent=c)})}window.aipkitForms_deleteForm=g})();(function(){"use strict";function g(a,r){let n=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;if(!r){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let i={_ajax_nonce:n.nonce_manage_forms},s=a.querySelector(".aipkit_btn-text")?.textContent||e("Delete All Forms","gpt3-ai-content-generator"),c=a.querySelector(".aipkit_spinner");a.disabled=!0,a.querySelector(".aipkit_btn-text")&&(a.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${e(n.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",i).then(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"success",t.message||e(n.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"error",t.message||e(n.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{a.querySelector(".aipkit_btn-text")&&(a.querySelector(".aipkit_btn-text").textContent=s),c&&(c.style.display="none"),a.disabled=!1})}window.aipkitForms_deleteAllForms=g})();(function(){"use strict";function g(a,r,n){let e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;if(!n){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let s={_ajax_nonce:e.nonce_manage_forms,form_id:a},c=r.textContent;r.disabled=!0,r.textContent=i(e.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",s).then(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",t.message||i("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",t.message||i(e.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let t=n.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${a}"]`);t&&(t.disabled=!1,t.textContent=c)})}window.aipkitForms_duplicateForm=g})();(function(){"use strict";async function g(a){let r=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:i=>i,e=a.textContent;a.disabled=!0,a.textContent=n("Exporting...","gpt3-ai-content-generator");try{let i=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:r.nonce_manage_forms});if(i.forms&&Array.isArray(i.forms)&&i.forms.length>0){let s=i.forms.map(p=>(delete p.id,delete p.status,p)),t=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,d=JSON.stringify(s,null,2),o=new Blob([d],{type:"application/json"}),l=URL.createObjectURL(o),_=document.createElement("a");_.href=l,_.download=t,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(l)}else throw new Error(n("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(i){alert(n("Error exporting forms: ","gpt3-ai-content-generator")+i.message)}finally{a.disabled=!1,a.textContent=e}}window.aipkitForms_exportAllForms=g})();(function(){"use strict";async function g(a,r){let n=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s,i=r.textContent;r.disabled=!0,r.textContent=e("Exporting...","gpt3-ai-content-generator");try{let s=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:a,_ajax_nonce:n.nonce_manage_forms});if(s.form){let c=s.form,t=c.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),d=`aipkit-form-${a}-${t}.json`;delete c.id,delete c.status;let o=JSON.stringify(c,null,2),l=new Blob([o],{type:"application/json"}),_=URL.createObjectURL(l),p=document.createElement("a");p.href=_,p.download=d,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(_)}else throw new Error(e("Form data not found in response.","gpt3-ai-content-generator"))}catch(s){alert(e("Error exporting form: ","gpt3-ai-content-generator")+s.message)}finally{r.disabled=!1,r.textContent=i}}window.aipkitForms_exportForm=g})();(function(){"use strict";let g=document.getElementById("aipkit_ai_forms_import_messages"),a;function r(i,s){if(!g)return;let c=window.aipkit_escapeHtml||(t=>t);g.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${i}">${c(s)}</div>`,a&&clearTimeout(a),a=setTimeout(()=>{g.innerHTML=""},8e3)}function n(){g&&(g.innerHTML=""),a&&clearTimeout(a)}async function e(i){let s=window.aipkit_ai_forms_config||{text:{}},c=window.wp?.i18n?.__||(l=>l),t=i.files;if(!t.length)return;let d=t[0];n(),r("info",c("Reading file...","gpt3-ai-content-generator"));let o=new FileReader;o.onload=async function(l){try{let _=l.target.result,p=JSON.parse(_);if(typeof p=="object"&&p!==null&&!Array.isArray(p)&&(p=[p]),!Array.isArray(p))throw new Error(c("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(p.length===0){r("warning",c("File contains no forms to import.","gpt3-ai-content-generator"));return}r("info",c("Importing...","gpt3-ai-content-generator"));let f=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:s.nonce_manage_forms,forms_json:JSON.stringify(p)});r(f.failed_count>0?"warning":"success",f.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(_){r("error",c("Error processing import file: ","gpt3-ai-content-generator")+_.message)}},o.onerror=function(){r("error",c("Error reading the selected file.","gpt3-ai-content-generator"))},o.readAsText(d)}window.aipkitForms_importForms=e})();(function(){"use strict";let g="aipkit_ai_forms_status",a=!1,r=null,n=null,e=null;function i(){return document.getElementById(g)}function s(w,h){let v=i();if(!v)return;let C=v.classList.contains("aipkit_training_status");if(v.textContent=w||"",C){v.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),w&&v.classList.add("is-visible"),h&&v.classList.add(`is-${h}`);return}v.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),h==="success"?v.classList.add("aipkit_form-help-success"):h==="error"&&v.classList.add("aipkit_form-help-error")}function c(w=2500){e&&window.clearTimeout(e),e=window.setTimeout(()=>{s("","")},w)}function t(){return document.getElementById("aipkit_ai_forms_settings_form")}function d(){let w=t();if(!w)return console.error("AI Forms Save Settings: Settings form not found."),null;let h=new FormData(w),v={};return h.forEach((C,x)=>{v[x]=C}),v}function o(w){if(!w)return"";let h={};return Object.keys(w).sort().forEach(v=>{h[v]=w[v]}),JSON.stringify(h)}function l(w){n=o(w)}function _(w){return o(w)!==n}async function p(w,h){let v=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:b=>b;if(typeof window.aipkit_apiRequest!="function"){console.error("AI Forms Save Settings: aipkit_apiRequest not found.");return}s(v("Saving...","gpt3-ai-content-generator"),"loading");let C="",x=null;h&&(C=h.querySelector(".aipkit_btn-text")?.textContent||v("Save AI Forms Settings","gpt3-ai-content-generator"),x=h.querySelector(".aipkit_spinner"),h.disabled=!0,x&&(x.style.display="inline-block"),h.querySelector(".aipkit_btn-text")&&(h.querySelector(".aipkit_btn-text").textContent=v("Saving...","gpt3-ai-content-generator")));try{let b=await window.aipkit_apiRequest("aipkit_save_ai_forms_settings",w);return s(b.message||v("Settings saved!","gpt3-ai-content-generator"),"success"),c(),l(w),b}catch(b){throw s(b.message||v("Failed to save settings.","gpt3-ai-content-generator"),"error"),c(4e3),console.error("AI Forms Save Settings Error:",b),b}finally{h&&(h.disabled=!1,x&&(x.style.display="none"),h.querySelector(".aipkit_btn-text")&&(h.querySelector(".aipkit_btn-text").textContent=C))}}function f(w,h){if(w){if(a){r=w;return}a=!0,p(w,h).catch(()=>{}).finally(()=>{if(a=!1,r){let v=r;r=null,_(v)&&f(v,null)}})}}function m(w){let h=d();f(h,w)}function k(){let w=d();!w||!_(w)||f(w,null)}function u(){let w=d();w&&l(w)}window.aipkitForms_saveAiFormsSettings=m,window.aipkitForms_handleSettingsAutosave=k,window.aipkitForms_updateSettingsAutosaveBaseline=u})();(function(){"use strict";function g(a,r,n){let e=window.aipkit_escapeHtml||function(s){return s};if(!a){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let i=a.querySelector("#aipkit_ai_forms_messages");i?(i.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${r}">${e(n)}</div>`,setTimeout(()=>{i.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=g})();(function(){"use strict";function g(r){if(!r){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let n=r.querySelector(".aipkit_token_limit_mode_select"),e=r.querySelector(".aipkit_token_general_user_limit_field"),i=r.querySelector(".aipkit_token_role_limits_container");if(!n||!e||!i){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let s=n.value;e.hidden=s!=="general",i.hidden=s!=="role_based"}function a(r){if(!r){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let n="data-token-listener-attached";r.getAttribute(n)!=="true"&&(r.addEventListener("change",function(e){e.target.closest(".aipkit_token_limit_mode_select")&&g(r)}),g(r),r.setAttribute(n,"true"))}window.aipkit_initAIFormsTokenManagementUI=a})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_ai_forms_container");return a||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=g})();(function(){"use strict";function g(a){let r=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e;a.dataset.clickListenerAttached!=="true"&&(a.addEventListener("click",function(e){let i=e.target,s=t=>i.closest(t),c=a.querySelector("#aipkit_form_editor_container");if(i.matches("#aipkit_create_new_ai_form_btn")||s("#aipkit_create_new_ai_form_btn"))e.preventDefault(),typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,a);else if(s(".aipkit_actions_menu_toggle")){e.preventDefault(),e.stopPropagation();let t=i.closest(".aipkit_actions_menu");if(!t)return;let d=t.querySelector(".aipkit_actions_dropdown_menu");if(!d)return;let o=d.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(l=>{l!==d&&(l.style.display="none")}),d.style.display=o?"none":"block",!o){let l=_=>{t.contains(_.target)||(d.style.display="none")};document.addEventListener("click",l,{once:!0,capture:!0})}}else if(s("#aipkit_import_ai_forms_btn")){e.preventDefault();let t=a.querySelector("#aipkit_ai_forms_import_file_input");t&&t.click()}else if(i.matches(".aipkit_edit_ai_form_btn")||s(".aipkit_edit_ai_form_btn")){e.preventDefault();let d=s(".aipkit_edit_ai_form_btn").dataset.formId;typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(d,a)}else if(s(".aipkit_preview_ai_form_btn")){e.preventDefault();let t=s(".aipkit_preview_ai_form_btn"),d=t.dataset.formId,o=t.dataset.formTitle||"";typeof window.aipkitForms_openPreviewSheet=="function"&&window.aipkitForms_openPreviewSheet(d,o,a)}else if(i.matches(".aipkit_duplicate_ai_form_btn")||s(".aipkit_duplicate_ai_form_btn")){e.preventDefault();let t=s(".aipkit_duplicate_ai_form_btn"),d=t.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(d,t,a)}else if(i.matches("#aipkit_export_all_ai_forms_btn")||s("#aipkit_export_all_ai_forms_btn")){e.preventDefault();let t=s("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(t)}else if(i.matches(".aipkit_export_ai_form_btn")||s(".aipkit_export_ai_form_btn")){e.preventDefault();let t=s(".aipkit_export_ai_form_btn"),d=t.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(d,t)}else if(i.matches(".aipkit_delete_ai_form_btn")||s(".aipkit_delete_ai_form_btn")){e.preventDefault();let t=s(".aipkit_delete_ai_form_btn"),d=t.dataset.formId,o=t.dataset.formTitle||`Form ID ${d}`,_=`${n(r.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${o}`,p=()=>{typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(d,t,a)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(_,{title:n("Confirm","gpt3-ai-content-generator"),confirmText:n("Delete","gpt3-ai-content-generator"),cancelText:n("Cancel","gpt3-ai-content-generator"),onConfirm:p});return}confirm(_)&&p()}else if(i.matches("#aipkit_delete_all_ai_forms_btn")||s("#aipkit_delete_all_ai_forms_btn")){e.preventDefault();let t=s("#aipkit_delete_all_ai_forms_btn"),d=n(r.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"),o=()=>{typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(t,a)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(d,{title:n("Confirm","gpt3-ai-content-generator"),confirmText:n("Delete","gpt3-ai-content-generator"),cancelText:n("Cancel","gpt3-ai-content-generator"),onConfirm:o});return}confirm(d)&&o()}else if(i.matches(".aipkit_form_shortcode_input"))e.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(i.value,i);else if(s(".aipkit_aiform_settings_toggle")){e.preventDefault();let t=s(".aipkit_aiform_settings_toggle"),d=t.dataset.formId,o=a.querySelector(`#aif-configurator-${d}`);if(!o)return;let l=o.closest("tr"),_=()=>{let m=t.getBoundingClientRect(),k=o.getBoundingClientRect(),u=k.width||400,w=k.height||0,h=window.innerWidth,v=window.innerHeight,C=12,x=m.left;x+u>h-C&&(x=m.right-u),x=Math.max(C,Math.min(x,h-u-C));let b=m.bottom+8;b+w>v-C&&(b=m.top-w-8),b=Math.max(C,Math.min(b,v-w-C)),o.style.left=`${Math.round(x)}px`,o.style.top=`${Math.round(b)}px`};a.querySelectorAll(".aipkit_shortcode_configurator").forEach(m=>{m!==o&&(m.style.display="none");let k=m.closest("tr");k&&k.classList.remove("aipkit_shortcode_row_open")});let f=o.style.display==="flex";if(o.style.display=f?"none":"flex",l&&l.classList.toggle("aipkit_shortcode_row_open",!f),!f){_();let m=k=>{!o.contains(k.target)&&!t.contains(k.target)&&(o.style.display="none",l&&l.classList.remove("aipkit_shortcode_row_open"),document.removeEventListener("click",m,!0))};setTimeout(()=>{document.addEventListener("click",m,{capture:!0,once:!0})},0)}}else if(s(".aipkit_aiform_shortcode_close")){e.preventDefault();let d=s(".aipkit_aiform_shortcode_close").closest(".aipkit_shortcode_configurator");if(d){d.style.display="none";let o=d.closest("tr");o&&o.classList.remove("aipkit_shortcode_row_open")}}else if(i.matches("#aipkit_validate_prompt_btn")||s("#aipkit_validate_prompt_btn"))e.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(i.matches("#aipkit_save_ai_form_btn")||s("#aipkit_save_ai_form_btn")){e.preventDefault();let t=s("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(t,a)}else if(i.matches("#aipkit_cancel_edit_ai_form_btn")||s("#aipkit_cancel_edit_ai_form_btn"))e.preventDefault(),typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(a);else if(i.matches("#aipkit_preview_ai_form_btn")||s("#aipkit_preview_ai_form_btn")){e.preventDefault();let t=c.querySelector("#aipkit_ai_form_id").value;if(!t){alert(n("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}let d=a.querySelector("#aipkit_ai_form_title"),o=d?d.value:"";typeof window.aipkitForms_openPreviewSheet=="function"?window.aipkitForms_openPreviewSheet(t,o,a):console.error("AI Forms Preview: Preview sheet helper not available.")}else if(s(".aipkit_dropped_element_settings_btn")){e.preventDefault();let t=s(".aipkit_dropped_element");t&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(t.id,a)}else if(s(".aipkit_dropped_element_delete_btn")){e.preventDefault();let t=s(".aipkit_dropped_element");t&&confirm(n(r.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(t.id,a)}else if(s(".aipkit_layout_row_delete_btn")){if(e.preventDefault(),confirm(n("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let t=s(".aipkit_layout_row");t&&(Array.from(t.querySelectorAll(".aipkit_dropped_element")).map(o=>o.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(a),t.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(a))}}else if(s("#aipkit_settings_panel_close_btn"))e.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(a);else if(s(".aipkit_remove_option_btn")){e.preventDefault();let t=s(".aipkit_select_option_row");t&&(t.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,a))}else s("#aipkit_add_select_option_btn")&&(e.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(a))}),a.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=g})();(function(){"use strict";let g="aipkit_ai_forms_shortcode_config_v1_";function a(s){if(!s||!window.localStorage)return null;try{let c=window.localStorage.getItem(`${g}${s}`);if(!c)return null;let t=JSON.parse(c);return t&&typeof t=="object"?t:null}catch{return null}}function r(s,c){if(!(!s||!window.localStorage))try{window.localStorage.setItem(`${g}${s}`,JSON.stringify(c))}catch{}}function n(s,c){if(!s)return;let t=c.querySelector(`#aif-configurator-${s}`),d=c.querySelector(`#aif-shortcode-input-${s}`);if(!t||!d)return;let o=t.querySelectorAll(".aipkit-aiform-config-input"),l=[],_={};o.forEach(m=>{let k=m.dataset.attrName;k&&(m.type==="checkbox"?(_[k]=!!m.checked,m.checked&&l.push(`${k}="true"`)):m.type==="select-one"&&(_[k]=m.value,m.value&&m.value!=="light"&&l.push(`${k}="${m.value}"`)))});let p=`[aipkit_ai_form id=${s}`;l.length>0&&(p+=" "+l.join(" ")),p+="]",d.value=p,c.querySelectorAll(`[data-aipkit-shortcode-display="${s}"]`).forEach(m=>{m&&"value"in m&&(m.value=p)}),r(s,_)}function e(s,c){if(!s||!c)return;let t=a(s);if(!t)return;let d=c.querySelector(`#aif-configurator-${s}`);if(!d)return;d.querySelectorAll(".aipkit-aiform-config-input").forEach(l=>{let _=l.dataset.attrName;_&&(l.type==="checkbox"?Object.prototype.hasOwnProperty.call(t,_)&&(l.checked=!!t[_]):l.type==="select-one"&&typeof t[_]=="string"&&(l.value=t[_]))}),n(s,c)}function i(s){s.dataset.changeListenerAttached!=="true"&&(s.addEventListener("change",function(c){let t=c.target;if(t.matches(".aipkit-aiform-config-input")){let d=t.dataset.formId;n(d,s)}else t.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(t),t.value="")}),s.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=i,window.aipkitForms_applyStoredShortcodeConfig=e})();(function(){"use strict";function g(a){let r=window.aipkitAIFormsState,n=a.querySelector("#aipkit_ai_form_element_settings_panel");if(!n){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(n.dataset.inputListenerAttached==="true")return;let e=()=>{r.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(r.selectedDesignerElementId,a)};n.addEventListener("input",i=>{i.target.matches(".aipkit-setting-field")&&e()}),n.addEventListener("change",i=>{i.target.matches('.aipkit-setting-field[type="checkbox"]')&&e()}),n.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=g})();(function(){"use strict";function g(a){let r=window.aipkitAIFormsState;if(!a){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let n=a.querySelector("#aipkit_ai_form_elements_palette"),e=a.querySelector("#aipkit_ai_form_designer_area");if(!n||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(n.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;n.querySelectorAll(".aipkit_form_element_item").forEach(s=>{s.dataset.dragStartListenerAttached!=="true"&&(s.addEventListener("dragstart",c=>{c.target.classList.add("aipkit-dragging"),r.draggedElement=null,c.target.dataset.layoutType?(r.draggedLayoutType=c.target.dataset.layoutType,r.draggedElementType=null,c.dataTransfer.setData("text/plain",r.draggedLayoutType),c.dataTransfer.effectAllowed="copy"):(r.draggedElementType=c.target.dataset.elementType,r.draggedLayoutType=null,c.dataTransfer.setData("text/plain",r.draggedElementType),c.dataTransfer.effectAllowed="copy")}),s.addEventListener("dragend",c=>{c.target.classList.remove("aipkit-dragging"),r.draggedElementType=null,r.draggedLayoutType=null}),s.dataset.dragStartListenerAttached="true")}),n.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",s=>{let c=s.target.closest(".aipkit_layout_row"),t=s.target.closest(".aipkit_dropped_element");if(c&&s.target.classList.contains("aipkit_layout_row_drag_handle"))r.draggedElement=c,s.dataTransfer.setData("text/row-id",c.id),s.dataTransfer.effectAllowed="move";else if(t&&s.target.classList.contains("aipkit_dropped_element_drag_handle"))r.draggedElement=t,s.dataTransfer.setData("text/element-id",t.id),s.dataTransfer.effectAllowed="move";else return;r.draggedElementType=null,r.draggedLayoutType=null,setTimeout(()=>{r.draggedElement&&r.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),e.addEventListener("dragend",s=>{r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null)}),e.addEventListener("dragover",s=>{s.preventDefault(),e.classList.add("aipkit-drag-over"),r.draggedElement?s.dataTransfer.dropEffect="move":s.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",s=>{e.contains(s.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",s=>{s.preventDefault(),s.stopPropagation(),e.classList.remove("aipkit-drag-over");let c=e.querySelector("#aipkit_form_designer_placeholder");if(r.draggedLayoutType){c&&(c.style.display="none");let t=window.aipkitForms_createNewLayoutData(r.draggedLayoutType);r.formStructure.push(t),window.aipkitForms_renderLayoutRow(e,t,null,a),r.draggedLayoutType=null}else if(r.draggedElement&&r.draggedElement.classList.contains("aipkit_layout_row")){let t=s.target.closest(".aipkit_layout_row");if(t&&t!==r.draggedElement){let d=t.getBoundingClientRect(),l=s.clientY>d.top+d.height/2?t.nextSibling:t;e.insertBefore(r.draggedElement,l)}window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){c&&(c.style.display="none");let t=window.aipkitForms_createNewLayoutData("1-col"),d=window.aipkitForms_createNewFormElementData(r.draggedElementType);t.columns[0].elements.push(d),r.formStructure.push(t),window.aipkitForms_renderLayoutRow(e,t,null,a),r.draggedElementType=null}r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(a)}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=g})();(function(){"use strict";function g(a){let r=a.querySelector("#aipkit_ai_forms_settings_form");r&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(r):console.error("AI Forms Init: Could not initialize token management UI for settings popover.")}window.aipkitForms_initializeTokenUI=g})();(function(){"use strict";function g(a){let r=(a||document).querySelector("#aipkit_ai_forms_settings_form");if(!r)return;let n="data-aipkit-aiforms-autosave-attached";if(r.getAttribute(n)==="true")return;let e=()=>{typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};r.addEventListener("change",i=>{let s=i.target;if(!s||!s.matches(".aipkit_autosave_trigger"))return;(s.tagName.toLowerCase()==="select"||s.type==="checkbox"||s.type==="range")&&e()}),r.addEventListener("blur",i=>{let s=i.target;if(!s||!s.matches(".aipkit_autosave_trigger"))return;let c=s.tagName.toLowerCase();(c==="input"||c==="textarea")&&s.type!=="range"&&s.type!=="checkbox"&&e()},!0),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),r.setAttribute(n,"true")}window.aipkitForms_initSettingsAutosave=g})();(function(){"use strict";function g(a){if(!a)return;let r="data-accordion-listener-attached";a.getAttribute(r)!=="true"&&(a.addEventListener("click",function(n){let e=n.target.closest(".aipkit_accordion-header");if(!e||!e.closest(".aipkit_ai_forms_container"))return;n.preventDefault();let i=e.closest(".aipkit_accordion-group"),s=e.dataset.aipkitContextAccordion==="1";if(i&&!e.classList.contains("aipkit_active")){let t=i.querySelector(".aipkit_accordion-header.aipkit_active");if(t){t.classList.remove("aipkit_active");let d=t.nextElementSibling;d&&d.classList.remove("aipkit_active")}}let c=e.nextElementSibling;c&&(e.classList.toggle("aipkit_active"),c.classList.toggle("aipkit_active"),s&&c.classList.contains("aipkit_active")&&typeof window.aipkitForms_refreshOpenaiStores=="function"&&window.aipkitForms_refreshOpenaiStores(c))}),a.setAttribute(r,"true"))}window.aipkitForms_initializeAccordions=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(t){return t};function a(t,d=""){let o=document.getElementById("aipkit_ai_form_ai_model"),l=window.aipkit_dashboard?.models||{};if(!o||!l)return;let _=t.toLowerCase(),p=l[_];(typeof p>"u"||p===null)&&(p=_==="openai"?{}:[]),o.innerHTML="",o.disabled=!1;let f=window.aipkit_dashboard?.recommendedModels?.[_]||[],m=Array.isArray(f)?f:[],k=new Set(m.map(w=>w?.id).filter(Boolean));if(!p||Array.isArray(p)&&p.length===0||!Array.isArray(p)&&Object.keys(p).length===0){let w=new Option("No models found. Sync in main settings.","");o.appendChild(w),o.disabled=!0;return}let u=!1;if(Array.isArray(p)){if(m.length>0){let h=document.createElement("optgroup");h.label=g("Recommended","gpt3-ai-content-generator"),m.forEach(v=>{if(v&&v.id){let C=new Option(v.name||v.id,v.id);v.id===d&&(C.selected=!0,u=!0),h.appendChild(C)}}),h.children.length>0&&o.appendChild(h)}let w=m.length>0?document.createElement("optgroup"):null;w&&(w.label=g("All models","gpt3-ai-content-generator")),p.forEach(h=>{if(h&&h.id&&k.has(h.id))return;let v=new Option(h.name,h.id);h.id===d&&(v.selected=!0,u=!0),w?w.appendChild(v):o.appendChild(v)}),w&&w.children.length>0&&o.appendChild(w)}else{if(m.length>0){let w=document.createElement("optgroup");w.label=g("Recommended","gpt3-ai-content-generator"),m.forEach(h=>{if(h&&h.id){let v=new Option(h.name||h.id,h.id);h.id===d&&(v.selected=!0,u=!0),w.appendChild(v)}}),w.children.length>0&&o.appendChild(w)}Object.keys(p).forEach(w=>{let h=document.createElement("optgroup");h.label=w,p[w].forEach(v=>{if(v&&v.id&&k.has(v.id))return;let C=new Option(v.name,v.id);v.id===d&&(C.selected=!0,u=!0),h.appendChild(C)}),h.children.length>0&&o.appendChild(h)})}if(!u&&d){let w=new Option(`${d} (Manual/Not Synced)`,d,!1,!0);o.insertBefore(w,o.firstChild),w.selected=!0}o.selectedIndex===-1&&o.options.length>0&&(o.options[0].selected=!0),o.options.length||(o.disabled=!0)}function r(t,d){let o=d||document,l=o.querySelector('input[name="openai_web_search_enabled"]'),_=o.querySelector('input[name="claude_web_search_enabled"]'),p=o.querySelector('input[name="google_search_grounding_enabled"]'),f=o.querySelector(".aipkit_ai_form_web_search_row--openai"),m=o.querySelector(".aipkit_ai_form_web_search_row--claude"),k=o.querySelector(".aipkit_ai_form_web_search_row--google"),u=o.querySelector(".aipkit_ai_form_openai_web_search_settings"),w=o.querySelector(".aipkit_ai_form_claude_web_search_settings"),h=o.querySelector(".aipkit_ai_form_google_search_grounding_settings"),v=o.querySelector(".aipkit_ai_form_openai_web_search_location_details"),C=o.querySelector(".aipkit_ai_form_claude_web_search_location_details"),x=o.querySelector(".aipkit_ai_form_web_search_empty_state"),b=t==="OpenAI";f&&(f.style.display=b?"block":"none"),!b&&l&&(l.checked=!1);let I=b&&l&&l.checked;u&&(u.style.display=I?"block":"none"),!I&&v?v.style.display="none":I&&typeof window.aipkitForms_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkitForms_toggleOpenAIWebSearchLocationDetails(o);let y=t==="Claude";m&&(m.style.display=y?"block":"none"),!y&&_&&(_.checked=!1);let q=y&&_&&_.checked;w&&(w.style.display=q?"block":"none"),!q&&C?C.style.display="none":q&&typeof window.aipkitForms_toggleClaudeWebSearchLocationDetails=="function"&&window.aipkitForms_toggleClaudeWebSearchLocationDetails(o);let E=t==="Google";k&&(k.style.display=E?"block":"none"),!E&&p&&(p.checked=!1);let S=E&&p&&p.checked;h&&(h.style.display=S?"block":"none"),S&&typeof window.aipkitForms_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkitForms_toggleGoogleGroundingDynamicThreshold(o),x&&(x.style.display=!b&&!y&&!E?"block":"none")}function n(t){let d=t.querySelector("#aipkit_ai_form_ai_provider"),o=t.querySelector("#aipkit_ai_form_ai_model"),l=t.querySelector(".aipkit_ai_form_reasoning_effort_field"),_=t.querySelector("#aipkit_ai_form_reasoning_effort");if(!d||!o||!l||!_){l&&(l.style.display="none");return}let p=d.value,m=(o.value||"").toLowerCase(),k=m.startsWith("o1")||m.startsWith("o3")||m.startsWith("o4"),u=m.includes("gpt-5");if(!(p==="OpenAI"&&(k||u))){l.style.display="none";return}l.style.display="block";let w=e(m),h=new Set(w.allowed),v=_.value||"";v==="minimal"&&(v="low"),Array.from(_.options).forEach(C=>{let x=h.has(C.value);C.hidden=!x,C.disabled=!x}),h.has(v)||(v=w.defaultValue),h.has(v)||(v=w.allowed[0]||""),v&&(_.value=v)}function e(t){return s(t)?{allowed:["high"],defaultValue:"high"}:t.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(t)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(t){let d=t.match(/gpt-5\.(\d+)/);if(d)return Number.parseInt(d[1],10)>=2;let o=t.match(/gpt-(\d+)/);return o?Number.parseInt(o[1],10)>=6:!1}function s(t){return/gpt-5(\.\d+)?-pro/.test(t)}function c(t){let d=t.querySelector("#aipkit_ai_form_ai_provider"),o=t.querySelector("#aipkit_ai_form_ai_model");!d||!o||(d.dataset.modelListenerAttached!=="true"&&(d.addEventListener("change",function(){a(this.value),r(this.value,t),n(t)}),d.dataset.modelListenerAttached="true"),o.dataset.reasoningListenerAttached!=="true"&&(o.addEventListener("change",function(){n(t)}),o.dataset.reasoningListenerAttached="true"),a(d.value),r(d.value,t),n(t))}window.aipkitForms_initAiConfig=c,window.aipkitForms_populateAiModels=a,window.aipkitForms_updateWebSearchVisibility=r,window.aipkitForms_toggleReasoningEffort=n})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(R){return R},a={loaded:!1,loading:!1},r={saving:!1,queued:null,last:{pinecone_api_key:"",qdrant_url:"",qdrant_api_key:""}},n=()=>{let R=window.wp&&window.wp.i18n?window.wp.i18n:null;return{__:R&&typeof R.__=="function"?R.__:$=>$}},e=()=>{let R=window.aipkit_ai_forms_config||{},B=R.vectorStores?R.vectorStores.openai:[];return Array.isArray(B)?B:[]},i=R=>{window.aipkit_ai_forms_config||(window.aipkit_ai_forms_config={}),window.aipkit_ai_forms_config.vectorStores||(window.aipkit_ai_forms_config.vectorStores={}),window.aipkit_ai_forms_config.vectorStores.openai=R},s=R=>R?R.querySelector('select[name="openai_vector_store_ids[]"]'):null,c=R=>R?Array.from(R.options).some(B=>B.value&&!B.disabled):!1,t=(R,B)=>{let $=R.id||R.vector_store_id||"",L=R.name||R.vector_store_name||""||`Untitled store ${B}`,K=R.file_counts?R.file_counts.total:null,H=" (Files: N/A)";return typeof K=="number"&&(H=` (${K} ${K===1?"File":"Files"})`),{id:$,label:`${L}${H}`}},d=(R,B,$={})=>{if(!R)return;let{__:G}=n(),K=$.preserveSelection===!0?new Set(Array.from(R.selectedOptions||[]).map(ae=>ae.value)):new Set;R.innerHTML="";let H=Array.isArray(B)?B:[],ne=1;if(H.forEach(ae=>{if(!ae||typeof ae!="object")return;let{id:Z,label:pe}=t(ae,ne);if(!Z)return;let ve=new Option(g(pe),Z);K.has(Z)&&(ve.selected=!0),R.appendChild(ve),ne+=1}),!R.options.length){let ae=new Option(G("No stores found.","gpt3-ai-content-generator"),"");ae.disabled=!0,R.appendChild(ae)}},o=R=>{R&&typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(R)},l=async(R,B={})=>{let $=s(R);if(!$)return;let{__:G}=n(),L=B.force===!0,K=e();if(K.length&&(!L||!a.loaded)){d($,K,{preserveSelection:!0}),o(R),a.loaded=!0;return}if(!L&&a.loaded&&c($)||a.loading)return;let H=document.getElementById("aipkit_vector_store_nonce_openai"),ne=H?H.value:"";if(!ne||typeof window.aipkit_apiRequest!="function")return;a.loading=!0,$.innerHTML="";let ae=new Option(G("Loading vector stores...","gpt3-ai-content-generator"),"");ae.disabled=!0,$.appendChild(ae);try{let Z=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:ne,limit:100,order:"desc"}),pe=Array.isArray(Z.stores)?Z.stores:[];i(pe),d($,pe,{preserveSelection:!0}),o(R),a.loaded=!0}catch(Z){let pe=Z&&Z.message?Z.message:G("Unable to load stores.","gpt3-ai-content-generator");$.innerHTML="";let ve=new Option(pe,"");ve.disabled=!0,$.appendChild(ve)}finally{a.loading=!1}},_=R=>{R&&l(R,{force:!0})},p=R=>{if(!R)return null;let B=R.closest(".aipkit_model_settings_popover");return B?B.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline"):null},f=(R,B,$)=>{let G=p(R);G&&(G.textContent=B||"",G.classList.remove("success","error","loading"),$&&G.classList.add($),G.style.display=B?"inline-block":"none")},m=(R,B=2500)=>{window.setTimeout(()=>{f(R,"","")},B)},k=R=>R?{pineconeKeyInput:R.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:R.querySelector('[name="qdrant_url"]'),qdrantKeyInput:R.querySelector('[name="qdrant_api_key"]')}:{},u=R=>{let B=R?.closest("#aipkit_ai_forms_container"),$=B?B.dataset:{},{pineconeKeyInput:G,qdrantUrlInput:L,qdrantKeyInput:K}=k(R),H=G?.value.trim(),ne=L?.value.trim(),ae=K?.value.trim(),Z=!!(H||$?.pineconeApiKeySet==="true"),pe=!!(ne||$?.qdrantUrlSet==="true")&&!!(ae||$?.qdrantApiKeySet==="true");return{pinecone:Z,qdrant:pe}},w=(R,B)=>R?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(R,{silent:!0,showErrors:!1,targetSelectId:B,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,R,{silent:!0,showErrors:!1,targetSelectId:B,propagateError:!0}):null:null,h=(R,B,$)=>{if(!B)return;f(R,"Syncing...","loading");let G=w(B,$);if(G&&typeof G.then=="function"){G.then(()=>{f(R,"Synced","success"),m(R)}).catch(L=>{f(R,`Error: ${L?.message||"Sync failed."}`,"error")});return}m(R)},v=(R,B)=>{if(!R||!B)return;if(B==="openai"){l(R);return}let $=u(R);B==="pinecone"&&$.pinecone?h(R,"PineconeIndexes","aipkit_ai_form_pinecone_index_name"):B==="qdrant"&&$.qdrant&&h(R,"QdrantCollections","aipkit_ai_form_qdrant_collection_name")},C=(R,B)=>{!B||!Object.keys(B).length||typeof window.aipkit_apiRequest=="function"&&(r.saving=!0,f(R,"Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",B).then($=>{Object.keys(B).forEach(L=>{r.last[L]=B[L]});let G=R.closest("#aipkit_ai_forms_container");G&&(Object.prototype.hasOwnProperty.call(B,"pinecone_api_key")&&(G.dataset.pineconeApiKeySet=B.pinecone_api_key?"true":"false"),Object.prototype.hasOwnProperty.call(B,"qdrant_url")&&(G.dataset.qdrantUrlSet=B.qdrant_url?"true":"false"),Object.prototype.hasOwnProperty.call(B,"qdrant_api_key")&&(G.dataset.qdrantApiKeySet=B.qdrant_api_key?"true":"false")),Object.prototype.hasOwnProperty.call(B,"pinecone_api_key")&&v(R,"pinecone"),(Object.prototype.hasOwnProperty.call(B,"qdrant_url")||Object.prototype.hasOwnProperty.call(B,"qdrant_api_key"))&&v(R,"qdrant"),f(R,$.message||"Saved","success"),m(R)}).catch($=>{f(R,`Error: ${$?.message||"Failed to save."}`,"error")}).finally(()=>{if(r.saving=!1,r.queued){let $=r.queued;r.queued=null,C(R,$)}}))},x=(R,B)=>{if(!B)return;let $=Object.keys(B).reduce((G,L)=>(B[L]!==r.last[L]&&(G[L]=B[L]),G),{});if(Object.keys($).length){if(r.saving){r.queued={...r.queued||{},...$};return}C(R,$)}},b=R=>{if(!R)return;let B=R.querySelector(".aipkit_vector_store_enable_select"),$=R.querySelector(".aipkit_vector_store_settings_conditional_row"),G=R.querySelector(".aipkit_vector_store_provider_select"),L=R.querySelector(".aipkit_vector_store_openai_field"),K=R.querySelector(".aipkit_vector_store_pinecone_field"),H=R.querySelector(".aipkit_vector_store_pinecone_key_field"),ne=R.querySelector(".aipkit_vector_store_qdrant_field"),ae=R.querySelector(".aipkit_vector_store_qdrant_url_field"),Z=R.querySelector(".aipkit_vector_store_qdrant_key_field"),pe=R.querySelector(".aipkit_vector_store_embedding_config_row");if(!B||!$||!G)return;let ve=B.tagName==="SELECT"?B.value==="1":B.checked;if($.style.display=ve?"block":"none",!ve){[L,K,H,ne,ae,Z,pe].forEach(Qe=>{Qe&&(Qe.style.display="none")});return}let De=G.value||"openai";L&&(L.style.display=De==="openai"?"block":"none"),K&&(K.style.display=De==="pinecone"?"block":"none"),H&&(H.style.display=De==="pinecone"?"block":"none"),ne&&(ne.style.display=De==="qdrant"?"block":"none"),ae&&(ae.style.display=De==="qdrant"?"block":"none"),Z&&(Z.style.display=De==="qdrant"?"block":"none"),pe&&(pe.style.display=De==="pinecone"||De==="qdrant"?"block":"none"),De==="openai"&&(l(R),o(R))},I=R=>{let B=(R||"").split("::"),$=B.shift()||"",G=B.join("::")||"";return{provider:$,model:G}},y=(R,B)=>!R||!B?"":`${R}::${B}`,q=(R,B,$)=>{if(!R||!B||!$)return;let G=y(B,$);if(!G)return;let L=typeof CSS<"u"&&CSS.escape?CSS.escape(G):G.replace(/"/g,'\\"');if(R.querySelector(`option[value="${L}"]`))return;let K=document.createElement("option");K.value=G,K.dataset.provider=B,K.textContent=`${$} (Manual)`,R.appendChild(K)},E=(R,B)=>{if(!R)return;let $=B||R.querySelector(".aipkit_vector_embedding_select");if(!$)return;let G=R.querySelector('select[name="vector_embedding_provider"]'),L=R.querySelector('select[name="vector_embedding_model"]'),K=G?G.value:"",H=L?L.value:"",ne=y(K,H);if(ne){q($,K,H),$.value=ne;return}$.value=""},S=(R,B)=>{if(!B||!R)return;let $=B.querySelector('select[name="vector_embedding_provider"]'),G=B.querySelector('select[name="vector_embedding_model"]'),{provider:L,model:K}=I(R.value);$&&($.value=L),$&&G&&typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(B),G&&(G.value=K)};function A(R){let B=R.querySelector(".aipkit_vector_embedding_provider_select"),$=R.querySelector(".aipkit_vector_embedding_model_select"),L=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!B||!$||!L)return;let H=B.value.toLowerCase(),ne=L[H]||[];$.innerHTML="",$.appendChild(new Option(`-- Select ${B.options[B.selectedIndex]?.text||""} Model --`,"")),ne&&Array.isArray(ne)&&ne.length>0?(ne.forEach(ae=>{$.appendChild(new Option(g(ae.name),ae.id))}),$.disabled=!1):($.appendChild(new Option("(No models found - Sync in Settings)","")),$.disabled=!0)}function T(R){let B=R||document,$=B.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),G=B.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!$||!G)return;let L=$.value==="approximate";G.style.display=L?"block":"none"}function M(R){let B=R||document,$=B.querySelector(".aipkit_ai_form_claude_web_search_loc_type_select"),G=B.querySelector(".aipkit_ai_form_claude_web_search_location_details");if(!$||!G)return;let L=$.value==="approximate";G.style.display=L?"block":"none"}function V(R){let B=R||document,$=B.querySelector(".aipkit_ai_form_google_grounding_mode_select"),G=B.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!$||!G)return;let L=$.value==="MODE_DYNAMIC";G.style.display=L?"block":"none"}function W(R){let B=R.querySelector("#aipkit_form_editor_container");if(!B)return;let $=B.querySelector("#aipkit_ai_form_settings_popover");if(!$)return;let G=$.querySelector('[data-aipkit-settings-panel="context"]'),L=$.querySelector('[data-aipkit-settings-panel="tools"]');if(!G)return;let K=B.querySelector("#aipkit_ai_form_ai_provider"),H=k(G);r.last={pinecone_api_key:H.pineconeKeyInput?.value||"",qdrant_url:H.qdrantUrlInput?.value||"",qdrant_api_key:H.qdrantKeyInput?.value||""};let ne="data-vector-config-listener-attached";if(G.getAttribute(ne)!=="true"&&(G.addEventListener("change",ae=>{let Z=ae.target;if(Z){if(Z.matches('[name="pinecone_api_key"]')||Z.matches('[name="qdrant_url"]')||Z.matches('[name="qdrant_api_key"]')){x(G,{[Z.name]:Z.value||""});return}if(Z.matches(".aipkit_vector_store_enable_select")||Z.matches(".aipkit_vector_store_provider_select")){b(G);let pe=G.querySelector(".aipkit_vector_store_provider_select"),ve=pe?pe.value:"";v(G,ve);return}if(Z.matches(".aipkit_vector_embedding_select")){S(Z,G);return}if(Z.matches(".aipkit_vector_embedding_provider_select")||Z.matches(".aipkit_vector_embedding_model_select")){typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(G),E(G);return}Z.matches('select[name="openai_vector_store_ids[]"]')&&o(G)}}),G.addEventListener("input",ae=>{let Z=ae.target;if(Z){if(Z.matches("#aipkit_ai_form_vector_store_top_k")){let pe=G.querySelector("#aipkit_ai_form_vector_store_top_k_value");pe&&(pe.textContent=Z.value)}else if(Z.matches("#aipkit_ai_form_vector_store_confidence_threshold")){let pe=G.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");pe&&(pe.textContent=Z.value+"%")}}}),G.setAttribute(ne,"true")),L){let ae="data-tools-config-listener-attached";L.getAttribute(ae)!=="true"&&(L.addEventListener("change",Z=>{let pe=Z.target;if(pe.matches(".aipkit_ai_form_openai_web_search_toggle")||pe.matches(".aipkit_ai_form_claude_web_search_toggle")||pe.matches(".aipkit_ai_form_google_search_grounding_toggle")){if(typeof window.aipkitForms_updateWebSearchVisibility=="function"){let ve=K?K.value:"";window.aipkitForms_updateWebSearchVisibility(ve,B)}}else pe.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?T(L):pe.matches(".aipkit_ai_form_claude_web_search_loc_type_select")?M(L):pe.matches(".aipkit_ai_form_google_grounding_mode_select")&&V(L)}),L.addEventListener("input",Z=>{let pe=Z.target;if(pe.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let ve=L.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");ve&&(ve.textContent=parseFloat(pe.value).toFixed(2))}}),L.setAttribute(ae,"true"))}typeof window.aipkitForms_updateWebSearchVisibility=="function"&&K&&window.aipkitForms_updateWebSearchVisibility(K.value,B),b(G),A(G),E(G),o(G)}window.aipkitForms_initVectorConfig=W,window.aipkitForms_populateVectorEmbeddingModels=A,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=T,window.aipkitForms_toggleClaudeWebSearchLocationDetails=M,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=V,window.aipkitForms_refreshOpenaiStores=_,window.aipkitForms_syncEmbeddingSelectFromInputs=E})();(function(){"use strict";function g(r,n,e,i){let s=window.aipkitAIFormsState,c=document.createElement("div");c.className="aipkit_layout_row",c.id=n.internalId;let t=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,d=document.createElement("div");d.className="aipkit_layout_row_columns_container",n.columns.forEach(o=>{let l=document.createElement("div");l.className="aipkit_layout_column",l.id=o.internalId,l.style.flexBasis=o.width,a(l,i),o.elements.forEach(_=>{window.aipkitForms_renderFieldInColumn(l,_)}),d.appendChild(l)}),c.innerHTML=t,c.appendChild(d),e?r.insertBefore(c,e):r.appendChild(c)}function a(r,n){let e=window.aipkitAIFormsState;r.addEventListener("dragover",i=>{i.preventDefault(),i.stopPropagation(),r.classList.add("aipkit-drag-over"),(e.draggedElement||e.draggedElementType)&&(i.dataTransfer.dropEffect=e.draggedElement?"move":"copy")}),r.addEventListener("dragleave",i=>{i.preventDefault(),i.stopPropagation(),r.classList.remove("aipkit-drag-over")}),r.addEventListener("drop",i=>{if(i.preventDefault(),r.classList.remove("aipkit-drag-over"),e.draggedElementType||e.draggedElement&&e.draggedElement.classList.contains("aipkit_dropped_element")){i.stopPropagation();let s=r.id;if(e.draggedElementType){let c=window.aipkitForms_createNewFormElementData(e.draggedElementType);e.formStructure.forEach(t=>{let d=t.columns.find(o=>o.internalId===s);d&&d.elements.push(c)}),window.aipkitForms_renderFieldInColumn(r,c,null,n)}else e.draggedElement&&(r.appendChild(e.draggedElement),window.aipkitForms_updateFormStructureOrder());e.draggedElementType=null,e.draggedElement&&(e.draggedElement.classList.remove("aipkit-row-dragging-source"),e.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector("#aipkit_ai_form_settings_popover");if(!r)return;let n=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!n.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),i=r.querySelector(".aipkit_model_settings_popover_back"),s=a.querySelector("#aipkit_ai_form_settings_trigger"),c={root:r.dataset.titleRoot||"Settings",parameters:r.dataset.titleParameters||"Parameters",context:r.dataset.titleContext||"Context",tools:r.dataset.titleTools||"Tools"},t=null,d=o=>{let l=o||"root",_=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!_)return;let p=_.dataset.aipkitSettingsPanel||"root";p!==t&&(n.forEach(f=>{f.hidden=f!==_}),e&&(e.textContent=c[p]||c.root),i&&(i.hidden=p==="root"),t=p,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",o=>{let l=o.target.closest("[data-aipkit-panel-target]");if(!l)return;o.preventDefault();let _=l.dataset.aipkitPanelTarget;d(_)}),i&&i.addEventListener("click",o=>{o.preventDefault(),d("root")}),s&&s.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitForms_initEditorSettingsPopover=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector("#aipkit_form_editor_container");if(!r)return;let n=r.querySelector("#aipkit_ai_form_prompt_template"),e=r.querySelector(".aipkit_ai_form_prompt_expand"),i=document.getElementById("aipkit_ai_form_prompt_modal");if(!n||!e||!i)return;let s=i.querySelector(".aipkit_ai_form_prompt_modal_textarea"),c=i.querySelector(".aipkit_ai_form_prompt_count"),t=i.querySelector(".aipkit_ai_form_prompt_modal_close");if(i.dataset.bound==="1")return;let d=p=>{c&&(c.textContent=`${p.length.toLocaleString()} characters`)},o=p=>{s&&(s.value=p,d(p))},l=()=>{s&&(o(n.value||""),i.classList.add("aipkit-active"),i.setAttribute("aria-hidden","false"),setTimeout(()=>s.focus(),0))},_=p=>{if(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),!p||!s)return;let f=s.value;f!==n.value&&(n.value=f,n.dispatchEvent(new Event("input",{bubbles:!0})))};e.addEventListener("click",p=>{p.preventDefault(),l()}),t&&t.addEventListener("click",()=>{_(!0)}),document.addEventListener("keydown",p=>{p.key==="Escape"&&i.classList.contains("aipkit-active")&&_(!0)}),s&&s.dataset.bound!=="1"&&(s.addEventListener("input",()=>{d(s.value)}),s.dataset.bound="1"),i.dataset.bound="1"}window.aipkitForms_initPromptModal=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.querySelector("#aipkit_ai_forms_settings_popover");if(!r)return;let n=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!n.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),i=r.querySelector(".aipkit_model_settings_popover_back"),s=r.querySelector(".aipkit_model_settings_popover_footer"),c=a.querySelector("#aipkit_ai_forms_settings_trigger"),t={root:r.dataset.titleRoot||"Settings",limits:r.dataset.titleLimits||"Limits","custom-css":r.dataset.titleCustomCss||"Custom CSS","provider-filtering":r.dataset.titleProviderFiltering||"Provider Filtering"},d=null,o=l=>{let _=l||"root",p=r.querySelector(`[data-aipkit-settings-panel="${_}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let f=p.dataset.aipkitSettingsPanel||"root";f!==d&&(n.forEach(m=>{m.hidden=m!==p}),e&&(e.textContent=t[f]||t.root),i&&(i.hidden=f==="root"),s&&(s.hidden=f==="root"),f==="limits"&&typeof window.aipkitForms_initializeTokenUI=="function"&&window.aipkitForms_initializeTokenUI(a),d=f,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",l=>{let _=l.target.closest("[data-aipkit-panel-target]");if(!_)return;l.preventDefault();let p=_.dataset.aipkitPanelTarget;o(p)}),i&&i.addEventListener("click",l=>{l.preventDefault(),o("root")}),c&&c.addEventListener("click",()=>{o("root")}),o("root"),r.dataset.panelsBound="true"}window.aipkitForms_initSettingsPopoverPanels=g})();(function(){"use strict";let g=[{key:"openai",label:"OpenAI"},{key:"google",label:"Google"},{key:"claude",label:"Claude"},{key:"openrouter",label:"OpenRouter"},{key:"azure",label:"Azure",keepWhenEmpty:!0,emptyMessage:"No Azure deployments found. Sync Azure models in main settings first."},{key:"ollama",label:"Ollama",requiresPro:!0},{key:"deepseek",label:"DeepSeek"}],a=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c,r=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(c,t)=>c.replace("%d",t),n=c=>{if(!c)return null;if(typeof c=="string")return{id:c,name:c};if(typeof c=="object"){let t=c.id||c.name||"";return t?{id:t,name:c.name||c.id||t}:null}return null},e=c=>{if(!c)return null;if(Array.isArray(c))return c.map(n).filter(Boolean);if(typeof c=="object"){let t={};return Object.keys(c).forEach(d=>{let l=(Array.isArray(c[d])?c[d]:[]).map(n).filter(Boolean);l.length&&(t[d]=l)}),t}return null},i=c=>c?Array.isArray(c)?c.length>0:Object.keys(c).length>0:!1;function s(c){let t=c||document,d=t.querySelector("#aipkit_ai_forms_models_selector");if(!d||d.dataset.enhanced==="true")return;let o=t.querySelector("#aipkit_aiforms_frontend_models"),l=t.querySelector("#aipkit_aiforms_frontend_providers");if(!o||!l)return;let _=a(),p=r(),m=(d.dataset.initialValue||o.value||"").split(",").map(y=>y.trim()).filter(Boolean),k=new Set(m),u=window.aipkit_dashboard||{},w=u.models||{},h=!!u.isProPlan,v=g.filter(y=>!y.requiresPro||h).map(y=>({...y,models:e(w[y.key])})).filter(y=>y.keepWhenEmpty||i(y.models));d.innerHTML="",d.classList.add("aipkit_models_selector--ready");let C=document.createElement("input");C.type="search",C.placeholder=_("Filter models...","gpt3-ai-content-generator"),C.className="aipkit_models_selector-search",d.appendChild(C);let x=document.createElement("div");x.className="aipkit_models_selector-summary",d.appendChild(x);let b=document.createElement("div");b.className="aipkit_models_selector-providers",d.appendChild(b);let I=y=>{let q=Array.from(d.querySelectorAll('.aipkit_models_selector-item input[type="checkbox"]:checked')),E=q.map(T=>T.value.trim()).filter(Boolean),S=new Set;q.forEach(T=>{T.dataset.providerName&&S.add(T.dataset.providerName)});let A=E.length?v.map(T=>T.label).filter(T=>S.has(T)).join(", "):"";o.value=E.join(", "),l.value=A,E.length===0?x.textContent=_("Showing all models (none selected)","gpt3-ai-content-generator"):E.length===1?x.textContent=_("1 model selected","gpt3-ai-content-generator"):x.textContent=p(_("%d models selected","gpt3-ai-content-generator"),E.length),y&&typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};v.forEach(y=>{let q=document.createElement("div");q.className="aipkit_models_selector-provider",q.dataset.provider=y.key;let E=document.createElement("div");E.className="aipkit_models_selector-provider-header",E.innerHTML=`<strong>${y.label}</strong>`;let S=document.createElement("div");S.className="aipkit_models_selector-provider-actions";let A=document.createElement("button");A.type="button",A.className="aipkit_btn aipkit_btn-xs",A.textContent=_("All","gpt3-ai-content-generator");let T=document.createElement("button");T.type="button",T.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",T.textContent=_("None","gpt3-ai-content-generator"),S.appendChild(A),S.appendChild(T),E.appendChild(S),q.appendChild(E);let M=document.createElement("div");M.className="aipkit_models_selector-models";let V=W=>{if(!W||!W.id)return;let R=document.createElement("label");R.className="aipkit_models_selector-item",R.title=W.id;let B=document.createElement("input");B.type="checkbox",B.value=W.id,B.checked=k.has(W.id),B.dataset.providerName=y.label,B.addEventListener("change",()=>I(!0));let $=document.createElement("span");$.textContent=W.name||W.id,R.appendChild(B),R.appendChild($),M.appendChild(R)};if(Array.isArray(y.models)?y.models.forEach(W=>V(W)):y.models&&typeof y.models=="object"&&Object.keys(y.models).forEach(W=>{let R=y.models[W]||[];if(!R.length)return;let B=document.createElement("div");B.className="aipkit_models_selector-subgroup",B.textContent=W.charAt(0).toUpperCase()+W.slice(1),M.appendChild(B),R.forEach($=>V($))}),!i(y.models)){let W=document.createElement("div");W.className="aipkit_models_selector-empty",W.textContent=_(y.emptyMessage||"No models found.","gpt3-ai-content-generator"),M.appendChild(W)}A.addEventListener("click",()=>{M.querySelectorAll('input[type="checkbox"]').forEach(W=>{W.checked=!0}),I(!0)}),T.addEventListener("click",()=>{M.querySelectorAll('input[type="checkbox"]').forEach(W=>{W.checked=!1}),I(!0)}),q.appendChild(M),b.appendChild(q)}),C.addEventListener("input",()=>{let y=C.value.toLowerCase();b.querySelectorAll(".aipkit_models_selector-provider").forEach(q=>{let E=!1;q.querySelectorAll(".aipkit_models_selector-item").forEach(S=>{let T=S.textContent.toLowerCase().includes(y);S.style.display=T?"":"none",T&&(E=!0)}),q.style.display=E||y===""?"":"none"})}),I(!1),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),d.dataset.enhanced="true"}window.aipkitForms_initAllowedModelsSelector=s})();(function(){"use strict";let g=window.wp?.i18n?.__||function(b){return b},a="#aipkit_ai_forms_container #aipkit_ai_form_ai_provider, #aipkit_ai_forms_container #aipkit_ai_form_ai_model, #aipkit_ai_forms_container #aipkit_ai_form_vector_store_provider",r=null,n=null,e=!1,i=b=>!!(b&&(b.id==="aipkit_ai_form_ai_provider"||b.id==="aipkit_ai_form_vector_store_provider")),s=b=>!!(b&&i(b)),c=(b,I)=>{if(!b)return!1;let y=t(I);return y?["openai","openrouter","google","azure","claude","deepseek","ollama","pinecone","qdrant"].includes(y):!1},t=b=>String(b||"").trim().toLowerCase(),d=(b,I,y)=>{if(!b)return;let q="aipkit_settings_select_picker_icon--";b.classList.forEach(A=>{A.startsWith(q)&&b.classList.remove(A)});let E=t(y),S=c(I,E);b.hidden=!S,S&&b.classList.add(`${q}${E}`)},o=b=>{if(!b)return"";let I=b.getAttribute("data-aipkit-picker-title");if(I)return I;let y=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return y?y.textContent.trim():""},l=b=>{if(!b)return"";let I=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(I)return I.textContent.trim();let y=b.querySelector("option");return y?y.textContent.trim():""},_=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),p=(b,I)=>{if(!b||!b.id||!I)return null;let y=_(b.id),q=document.getElementById(y.buttonId);if(!q){if(q=document.createElement("button"),q.type="button",q.id=y.buttonId,q.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",q.setAttribute("data-aipkit-popover-target",y.popoverId),q.setAttribute("aria-controls",y.popoverId),q.setAttribute("aria-expanded","false"),q.dataset.aipkitPopoverPlacement="bottom",i(b)){q.classList.add("aipkit_settings_select_picker_btn--provider");let T=document.createElement("span");T.className="aipkit_settings_select_picker_icon",T.setAttribute("aria-hidden","true"),d(T,b,b.value),q.appendChild(T)}let S=document.createElement("span");S.className="aipkit_settings_select_picker_label",S.id=y.labelId,S.textContent=l(b)||g("Select","gpt3-ai-content-generator");let A=document.createElement("span");A.className="dashicons dashicons-arrow-down-alt2",A.setAttribute("aria-hidden","true"),q.appendChild(S),q.appendChild(A),b.insertAdjacentElement("beforebegin",q)}b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let E=document.getElementById(y.popoverId);if(!E){E=document.createElement("div"),E.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",E.id=y.popoverId,E.setAttribute("aria-hidden","true"),i(b)&&E.classList.add("aipkit_settings_select_picker_popover--provider");let S=document.createElement("div");S.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",S.setAttribute("role","dialog"),S.setAttribute("aria-labelledby",y.titleId);let A=document.createElement("div");A.className="aipkit_model_settings_popover_header";let T=document.createElement("span");T.className="aipkit_model_settings_popover_title",T.id=y.titleId,T.textContent=o(b)||g("Select","gpt3-ai-content-generator");let M=document.createElement("button");M.type="button",M.className="aipkit_model_settings_popover_close",M.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),M.innerHTML='<span class="dashicons dashicons-no-alt"></span>',A.appendChild(T),A.appendChild(M);let V=document.createElement("div");V.className="aipkit_model_settings_popover_body";let W=document.createElement("div");W.className="aipkit_settings_select_picker_search";let R=document.createElement("input");R.type="search",R.id=y.searchId,R.className="aipkit_form-input";let B=o(b),$=B?`Search ${B.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");R.setAttribute("placeholder",$),W.appendChild(R);let G=document.createElement("div");G.className="aipkit_settings_select_picker_list",G.id=y.listId,G.setAttribute("role","listbox"),V.appendChild(W),V.appendChild(G),S.appendChild(A),S.appendChild(V),E.appendChild(S),I.appendChild(E),s(b)&&(W.style.display="none")}return{ids:y,button:q,popover:E,label:document.getElementById(y.labelId),search:document.getElementById(y.searchId),list:document.getElementById(y.listId)}},f=b=>{let I=[];return b&&Array.from(b.children).forEach(q=>{if(q.tagName==="OPTGROUP"){let E=Array.from(q.children).filter(S=>S.tagName==="OPTION").map(S=>({value:S.value,label:S.textContent.trim(),disabled:S.disabled,selected:S.selected}));I.push({label:q.label,options:E})}else q.tagName==="OPTION"&&I.push({label:"",options:[{value:q.value,label:q.textContent.trim(),disabled:q.disabled,selected:q.selected}]})}),I},m=(b,I,y="")=>{if(!b||!I)return;I.innerHTML="";let q=f(b),E=y.trim().toLowerCase(),S=!1;if(q.forEach(A=>{let T=A.options.filter(M=>E?M.label.toLowerCase().includes(E):!0);if(T.length){if(A.label){let M=document.createElement("div");M.className="aipkit_settings_select_picker_group_label",M.textContent=A.label,I.appendChild(M)}T.forEach(M=>{let V=document.createElement("button");if(V.type="button",V.className="aipkit_settings_select_picker_item",M.disabled&&V.classList.add("is-disabled"),M.selected&&V.classList.add("is-active"),V.dataset.value=M.value,i(b)&&c(b,M.value)){let B=document.createElement("span");B.className="aipkit_settings_select_picker_icon",B.setAttribute("aria-hidden","true"),d(B,b,M.value),V.appendChild(B)}let W=document.createElement("span");W.className="aipkit_settings_select_picker_text",W.textContent=M.label||M.value;let R=document.createElement("span");R.className="dashicons dashicons-yes aipkit_settings_select_picker_check",R.setAttribute("aria-hidden","true"),V.appendChild(W),V.appendChild(R),I.appendChild(V),S=!0})}}),!S){let A=document.createElement("div");A.className="aipkit_settings_select_picker_empty",A.textContent=g(E?"No matches found.":"No options available.","gpt3-ai-content-generator"),I.appendChild(A)}},k=(b,I)=>{if(!b||!I)return;let y=l(b);if(I.textContent=y||g("Select","gpt3-ai-content-generator"),i(b)){let q=I.closest("button"),E=q?q.querySelector(".aipkit_settings_select_picker_icon"):null;d(E,b,b.value)}},u=(b,I)=>{if(!b||!I)return;let y=b.getBoundingClientRect(),q=I.getBoundingClientRect(),E=q.width||320,S=q.height||0,A=window.innerWidth,T=window.innerHeight,M=12;if(b.dataset.aipkitPopoverPlacement==="bottom"){let R=y.left;R+E>A-M&&(R=y.right-E),R=Math.max(M,Math.min(R,A-E-M));let B=y.bottom+8;B+S>T-M&&(B=y.top-S-8),B=Math.max(M,Math.min(B,T-S-M)),I.style.left=`${Math.round(R)}px`,I.style.top=`${Math.round(B)}px`;return}let V=y.right+10;V+E>A-M&&(V=y.left-E-10),V=Math.max(M,Math.min(V,A-E-M));let W=y.top;W+S>T-M&&(W=T-S-M),W=Math.max(M,W),I.style.left=`${Math.round(V)}px`,I.style.top=`${Math.round(W)}px`},w=()=>{!r||!n||e||(e=!0,window.requestAnimationFrame(()=>{let b=r.querySelector(".aipkit_model_settings_popover_panel");u(n,b),e=!1}))},h=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),r=null,n=null)},v=(b,I,y)=>{if(!b||!I)return;r&&r!==I&&h(),r=I,n=b,I.classList.add("aipkit-active"),I.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let q=I.querySelector(".aipkit_settings_select_picker_search input"),E=I.querySelector(".aipkit_settings_select_picker_list");E&&m(y,E,q?q.value:""),q&&q.offsetParent!==null&&(q.focus(),q.select());let S=I.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(b,S)})},C=(b,I)=>{if(!b||!I)return;let{button:y,popover:q,list:E,search:S}=I;if(y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("click",A=>{if(A.preventDefault(),r===q){h();return}v(y,q,b)}),y.dataset.pickerListenerAttached="true"),q&&q.dataset.overlayListenerAttached!=="true"){q.addEventListener("click",T=>{T.target===q&&h()});let A=q.querySelector(".aipkit_model_settings_popover_close");A&&A.addEventListener("click",T=>{T.preventDefault(),h()}),q.dataset.overlayListenerAttached="true"}if(E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("click",A=>{let T=A.target.closest(".aipkit_settings_select_picker_item");if(!T||T.classList.contains("is-disabled"))return;let M=T.dataset.value??"";b.value=M,b.dispatchEvent(new Event("change",{bubbles:!0})),k(b,I.label),m(b,E,S?S.value:""),h()}),E.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("input",()=>{m(b,E,S.value)}),S.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{k(b,I.label),m(b,E,S?S.value:"")}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let A=!1;new MutationObserver(()=>{A||(A=!0,window.requestAnimationFrame(()=>{k(b,I.label),m(b,E,S?S.value:""),A=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitAiFormsPickerEscapeBound||(document.addEventListener("keydown",A=>{A.key==="Escape"&&r&&h()}),document.body.dataset.aipkitAiFormsPickerEscapeBound="true"),document.body.dataset.aipkitAiFormsPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitAiFormsPickerRepositionBound="true")};function x(b){let I=b||document.getElementById("aipkit_ai_forms_container");if(!I)return;let y=I.querySelectorAll(a);y.length&&y.forEach(q=>{if(!q.id||q.dataset.aipkitPickerInit==="true")return;let E=p(q,I);E&&(k(q,E.label),m(q,E.list,E.search?E.search.value:""),C(q,E),q.dataset.aipkitPickerInit="true")})}window.aipkitForms_initSelectPickers=x,window.aipkitForms_refreshSelectPickers=function(b){let I=b||document.getElementById("aipkit_ai_forms_container");if(!I)return;let y=I.querySelectorAll(a);y.length&&y.forEach(q=>{if(!q.id)return;let E=p(q,I);E&&(k(q,E.label),m(q,E.list,E.search?E.search.value:""),C(q,E),q.dataset.aipkitPickerInit="true")})}})();(function(){"use strict";let g={css:new Set,js:new Set},a=()=>{let l=typeof wp<"u"&&wp.i18n?wp.i18n:null;return{__:l&&typeof l.__=="function"?l.__:_=>_}},r=window.aipkit_escapeHtml||(l=>l),n=l=>{if(!l||g.css.has(l))return;if(document.querySelector(`link[href="${l}"]`)){g.css.add(l);return}let _=document.createElement("link");_.rel="stylesheet",_.href=l,document.head.appendChild(_),g.css.add(l)},e=l=>!l||g.js.has(l)?Promise.resolve():new Promise((_,p)=>{if(document.querySelector(`script[src="${l}"]`)){g.js.add(l),_();return}let f=document.createElement("script");f.src=l,f.async=!0,f.onload=()=>{g.js.add(l),_()},f.onerror=()=>p(new Error(`Failed to load script: ${l}`)),document.body.appendChild(f)}),i=(l,_,p="info")=>{if(!l)return;let f=p==="error"?"aipkit_ai_forms_preview_message aipkit_ai_forms_preview_message--error":"aipkit_ai_forms_preview_message",m=p==="error"?"":'<span class="aipkit_spinner" aria-hidden="true"></span>';l.innerHTML=`
      <div class="${f}">
        ${m}
        <span>${r(_)}</span>
      </div>
    `},s=(l,_,p={})=>{let{__:f}=a(),m=window.aipkit_ai_forms_config||{},k=p.loadingText||f("Loading preview...","gpt3-ai-content-generator");return _?l?typeof window.aipkit_apiRequest!="function"?(i(_,f("Preview loader is unavailable.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("API request helper missing."))):(i(_,k),window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:l,_ajax_nonce:m.nonce_manage_forms}).then(u=>(u.config&&(window.aipkit_ai_forms_public_config=u.config),u.models&&(window.aipkit_ai_forms_models=u.models),u.assets&&u.assets.css&&Object.values(u.assets.css).forEach(n),_.innerHTML=u.html||"",u.assets&&u.assets.js?Promise.all(Object.values(u.assets.js).map(e)):null)).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(u=>{let w=u&&u.message?u.message:"Unknown error.";throw i(_,`${f("Preview failed:","gpt3-ai-content-generator")} ${w}`,"error"),u})):(i(_,f("Missing form ID for preview.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("Form ID missing."))):Promise.reject(new Error("Preview container not found."))},c=l=>{let _=l||document.getElementById("aipkit_ai_forms_container");if(!_)return null;let p=_.querySelector("#aipkit_ai_forms_preview_sheet");return p?{container:_,overlay:p,panel:p.querySelector(".aipkit_builder_sheet_panel"),closeButton:p.querySelector("#aipkit_ai_forms_preview_sheet_close"),title:p.querySelector("#aipkit_ai_forms_preview_sheet_title"),description:p.querySelector("#aipkit_ai_forms_preview_sheet_description"),previewFrame:p.querySelector("#aipkit_ai_forms_preview_frame")}:null},t=(l,_,p)=>{let{__:f}=a(),m=c(p);if(!m)return;let k=_&&String(_).trim()||f("Untitled","gpt3-ai-content-generator");m.title&&(m.title.textContent=f("Preview","gpt3-ai-content-generator")),m.description&&(m.description.textContent="",m.description.removeAttribute("title"),m.description.setAttribute("hidden","true")),m.overlay.classList.add("aipkit-active"),m.overlay.setAttribute("aria-hidden","false"),m.previewFrame&&s(l,m.previewFrame).catch(()=>{}),m.closeButton&&m.closeButton.focus()},d=l=>{let _=c(l);_&&(_.overlay.classList.remove("aipkit-active"),_.overlay.setAttribute("aria-hidden","true"),_.previewFrame&&(_.previewFrame.innerHTML=""))},o=l=>{let _=c(l);!_||_.overlay.dataset.previewSheetInitialized==="true"||(_.closeButton&&_.closeButton.addEventListener("click",p=>{p.preventDefault(),d(_.container)}),_.overlay.addEventListener("click",p=>{p.target===_.overlay&&d(_.container)}),document.addEventListener("keydown",p=>{p.key==="Escape"&&_.overlay.classList.contains("aipkit-active")&&d(_.container)}),_.overlay.dataset.previewSheetInitialized="true")};window.aipkitForms_loadFormPreview=s,window.aipkitForms_openPreviewSheet=t,window.aipkitForms_closePreviewSheet=d,window.aipkitForms_initPreviewSheet=o})();(function(){"use strict";function g(){let a=window.aipkitForms_validateContainer();if(!a)return;let r=()=>{typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(a):console.error("AI Forms Init: aipkit_initContentWriterPopovers function not found.")};if(a.dataset.aipkitInitialized==="true"){r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"&&window.aipkitForms_initSettingsPopoverPanels(a),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(a),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(a),typeof window.aipkitForms_initSettingsAutosave=="function"&&window.aipkitForms_initSettingsAutosave(a),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(a),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(a),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(a),window.aipkitForms_initializeDragAndDrop(a),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(a),window.aipkitForms_initializeTokenUI(a);return}r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"?window.aipkitForms_initSettingsPopoverPanels(a):console.error("AI Forms Init: aipkitForms_initSettingsPopoverPanels function not found."),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(a),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(a),typeof window.aipkitForms_initSettingsAutosave=="function"?window.aipkitForms_initSettingsAutosave(a):console.error("AI Forms Init: aipkitForms_initSettingsAutosave function not found."),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(a),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(a),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(a),window.aipkitForms_attachClickEventListeners(a),window.aipkitForms_attachChangeEventListeners(a),window.aipkitForms_attachSettingsPanelListeners(a),window.aipkitForms_initializeAccordions(a),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(a):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(a),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(a),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(a):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(a):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),a.dataset.aipkitInitialized="true"}window.aipkit_initAiForms=g})();(function(){"use strict";let g="",a={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",status:"task_config_status",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",status:"task_config_status",prompts:"task_config_ai",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",status:"task_config_status",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",status:"task_config_status",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function r(){let s=document.getElementById("aipkit_automated_task_form"),c=document.getElementById("aipkit_provider_notice_autogpt");if(!s||!c)return;s.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"][data-aipkit-provider-notice-defer="1"]').forEach(_=>{delete _.dataset.aipkitProviderNoticeArmed});let d=Array.from(s.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"]')),o=_=>_&&(_.offsetParent!==null||_.getClientRects().length>0),l=d.filter(o);if(!l.length){c.classList.add("aipkit_provider_notice--hidden");return}l.forEach(_=>{_.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(_.dataset.aipkitProviderNoticeArmed="true")}),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(s)}function n(s){if(!s)return null;let c="content_writing";return s==="content_indexing"?c="content_indexing":s==="community_reply_comments"?c="community_reply_comments":s==="enhance_existing_content"&&(c="enhance_existing_content"),window.aipkit_wizardConfig[c]||null}function e(s){let c=document.querySelector(".aipkit_wizard_content_container"),t=document.getElementById("aipkit_save_task_btn");if(!c)return;let d=n(s);if(!d){c.querySelectorAll(".aipkit_wizard_content_step").forEach(l=>{l.style.display="none",l.classList.remove("aipkit_active")}),t&&(t.style.display="none"),r();return}let o=new Set(Object.values(d.contentMap));c.querySelectorAll(".aipkit_wizard_content_step").forEach(l=>{let _=l.dataset.contentId||"";o.has(_)?(l.style.display="block",l.classList.add("aipkit_active")):(l.style.display="none",l.classList.remove("aipkit_active"))}),t&&(t.style.display="inline-flex"),r()}function i(s){g=s,e(s)}window.aipkit_renderWizard=i,window.aipkit_initWizardNavigation=()=>{},window.aipkit_resetWizard=()=>{g="",e("")},window.aipkit_wizardConfig=a})();(function(){"use strict";function g(a){let r=window.aipkit_automated_tasks_config||{},n=r.text||{},e=window.aipkit_escapeHtml||function(t){return t},i=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!i)return Promise.resolve();i.innerHTML=`<option value="">${e(n.loading_stores||"Loading...")}</option>`,i.disabled=!0;let s=[],c=n.select_target_store||"-- Select Target Store --";return a==="openai"&&r.openai_vector_stores?s=r.openai_vector_stores:a==="pinecone"&&r.pinecone_indexes?(s=r.pinecone_indexes,c=n.select_target_index||"-- Select Target Index --"):a==="qdrant"&&r.qdrant_collections&&(s=r.qdrant_collections,c=n.select_target_collection||"-- Select Target Collection --"),i.innerHTML=`<option value="">${e(c)}</option>`,s&&Array.isArray(s)&&s.length>0?(s.forEach(t=>{let d=t.id||t.name,o=t.name||t.id,l=e(o);a==="openai"&&t.file_counts?.total!==void 0?l+=` (Files: ${t.file_counts.total})`:a==="pinecone"&&t.dimension!==void 0&&(l+=` (Dim: ${t.dimension})`),i.appendChild(new Option(l,d))}),i.disabled=!1):(i.appendChild(new Option(e(n.no_targets_found_configure||`No ${a} targets found. Configure in AI Training.`),"")),i.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=g})();(function(){"use strict";function g(){let a=window.aipkit_automated_tasks_config||{},r=a.text||{},n=window.aipkit_escapeHtml||function(l){return l},e=document.getElementById("aipkit_task_content_indexing_embedding_model"),i=window.aipkit_automated_tasks_form_state||{},s=i.pendingEmbeddingModelSelection;if(!e)return Promise.resolve();e.innerHTML=`<option value="">${n(r.select_embedding_model||"-- Select Model --")}</option>`;let c=a.openai_embedding_models||[],t=a.google_embedding_models||[],d=a.azure_embedding_models||[],o=(l,_,p)=>{let f=document.createElement("optgroup");return f.label=n(l),_&&_.length>0&&_.forEach(m=>{let k=`${p}:${m.id}`;f.appendChild(new Option(n(m.name||m.id),k))}),f};if(e.appendChild(o("OpenAI",c,"openai")),e.appendChild(o("Google",t,"google")),e.appendChild(o("Azure",d,"azure")),e.disabled=c.length===0&&t.length===0&&d.length===0,e.disabled&&(e.innerHTML=`<option value="">${n(r.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),s&&e.querySelector(`option[value="${CSS.escape(s)}"]`))e.value=s,i.pendingEmbeddingModelSelection=null;else if(e.options.length>1){let l=e.querySelector("optgroup");l&&l.options.length>0&&(e.value=l.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=g})();(function(){"use strict";function g(a){let r=a.target.value,n=document.getElementById("aipkit_task_content_indexing_embedding_model_group"),e=document.getElementById("aipkit_task_content_indexing_embedding_model_divider");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(r):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),n){let i=r==="pinecone"||r==="qdrant";n.style.display=i?"block":"none",e&&(e.style.display=i?"flex":"none"),i&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_autogpt_container");if(!a)return;let r=a.querySelector("#aipkit_task_content_indexing_target_store_provider");if(r){if(r.dataset.listenerAttached==="true")return;typeof window.aipkit_handleTargetStoreProviderChange=="function"?(r.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:r}),r.dataset.listenerAttached="true"):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found.")}}window.aipkit_initContentIndexingTaskFormUI=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n},a=window.wp?.i18n?.__||function(n){return n};function r(n,e){let i=n.value,s=i?i.toLowerCase():"",c=window.aipkit_dashboard?.models,t=window.aipkit_automated_tasks_form_state||{};if(!e)return;if(!c){e.innerHTML=`<option value="">${g("Error: Model data object not found")}</option>`,e.disabled=!0;return}let d=c[s];(typeof d>"u"||d===null)&&(console.warn(`AutoGPT Model Populator: No model data for provider '${s}'.`),d=s==="openai"?{}:[]);let o=t.pendingModelSelection||e.value;e.innerHTML="";let l=window.aipkit_dashboard?.recommendedModels?.[s]||[],_=Array.isArray(l)?l:[],p=new Set(_.map(f=>f?.id).filter(Boolean));if(s==="openai"&&typeof d=="object"&&!Array.isArray(d)){if(_.length>0){let f=document.createElement("optgroup");f.label=g(a("Recommended","gpt3-ai-content-generator")),_.forEach(m=>{m&&typeof m=="object"&&m.id&&f.appendChild(new Option(g(m.name||m.id),m.id))}),f.children.length>0&&e.appendChild(f)}Object.keys(d).forEach(f=>{let m=document.createElement("optgroup");m.label=g(f),Array.isArray(d[f])&&d[f].forEach(k=>{if(k&&k.id){if(p.has(k.id))return;m.appendChild(new Option(g(k.name||k.id),k.id))}}),e.appendChild(m)})}else if(Array.isArray(d)){if(_.length>0){let m=document.createElement("optgroup");m.label=g(a("Recommended","gpt3-ai-content-generator")),_.forEach(k=>{k&&typeof k=="object"&&k.id&&m.appendChild(new Option(g(k.name||k.id),k.id))}),m.children.length>0&&e.appendChild(m)}let f=_.length>0?document.createElement("optgroup"):null;f&&(f.label=g(a("All models","gpt3-ai-content-generator"))),d.forEach(m=>{if(m&&m.id){if(p.has(m.id))return;let k=new Option(g(m.name||m.id),m.id);f?f.appendChild(k):e.appendChild(k)}}),f&&f.children.length>0&&e.appendChild(f)}else console.warn(`AutoGPT Model Populator: Unexpected format for provider '${s}'.`),e.appendChild(new Option(g(`No models for ${i} (Format Error)`),""));if(e.options.length===0)e.appendChild(new Option(g(`No models for ${i}`),"")),e.disabled=!0;else{e.disabled=!1;let f=!1;if(o&&e.querySelector(`option[value="${CSS.escape(o)}"]`)&&(e.value=o,f=!0),!f&&e.options.length>0){let m=e.querySelector('option:not([value=""])');m&&(e.value=m.value)}}t&&(t.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort(),e&&e.dispatchEvent(new Event("change",{bubbles:!0}))}window.aipkit_task_cw_populateModels=r})();(function(){"use strict";function g(a){if(!a)return;let r=a.closest(".aipkit_slider_wrapper"),n=null;if(r&&(n=r.querySelector(".aipkit_slider_value")),!n){let e=a.closest(".aipkit_ai_temperature_control");e&&(n=e.querySelector(".aipkit_ai_behavior_value"))}n&&(n.textContent=a.value,a.dataset.listenerAttached||(a.addEventListener("input",()=>n.textContent=a.value),a.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=g})();(function(){"use strict";function g(a){if(!a)return;let r=a.closest(".aipkit_slider_wrapper"),n=r?r.querySelector(".aipkit_slider_value"):null;n&&(n.textContent=a.value,a.dataset.listenerAttached||(a.addEventListener("input",()=>n.textContent=a.value),a.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=g})();(function(){"use strict";function g(a){let r=a.target,n=r.closest(".aipkit_post_settings_redesigned")||r.closest(".aipkit_wizard_content_step")||document,e=n.querySelector("#aipkit_task_cw_schedule_options_wrapper"),i=n.querySelector("#aipkit_task_cw_smart_schedule_fields"),s=n.querySelector(".aipkit_task_schedule_from_input_option"),c=s?s.querySelector(".aipkit_post_schedule_radio_text"):null,t=s?s.querySelector(".aipkit_popover_warning[data-tooltip]"):null;if(!e)return;let d=r.value==="publish";e.style.display=d?"block":"none";let o=document.getElementById("aipkit_automated_task_type"),l=new Set(["content_writing_bulk","content_writing_csv","content_writing_gsheets"]),_=`Accepted formats: YYYY-MM-DD HH:MM[:SS], YYYY/MM/DD HH:MM, MM/DD/YYYY HH:MM, DD/MM/YYYY HH:MM, or ISO 8601.

Times use the site timezone unless an offset/Z is provided.`,p={content_writing_bulk:{label:"Use Dates from List",tooltip:`Use when your list includes a publish date on each line.

`+_},content_writing_csv:{label:"Use Dates from CSV",tooltip:`Use when your CSV includes a publish date column.

`+_},content_writing_gsheets:{label:"Use Dates from Sheets",tooltip:`Use when your Google Sheets includes a publish date column.

`+_}},f={label:"Use Dates from Input",tooltip:`Use when your input includes a publish date.

`+_},m=()=>{if(!o)return;let h=p[o.value]||f;c&&(c.textContent=h.label),t&&t.setAttribute("data-tooltip",h.tooltip)},k=o&&l.has(o.value);if(s&&(m(),s.style.display=k?"inline-flex":"none",!k)){let h=s.querySelector('input[name="schedule_mode"][value="from_input"]');if(h&&h.checked){let v=n.querySelector('input[name="schedule_mode"][value="immediate"]');v&&(v.checked=!0,v.dispatchEvent(new Event("change",{bubbles:!0})))}}o&&!o.dataset.fromInputCopyListener&&(o.addEventListener("change",()=>{m()}),o.dataset.fromInputCopyListener="true"),n.querySelectorAll('input[name="schedule_mode"]').forEach(h=>{h.dataset.listenerAttached||(h.addEventListener("change",function(){let v=o&&l.has(o.value);i&&(i.style.display=this.value==="smart"?"block":"none")}),h.dataset.listenerAttached="true")});let w=n.querySelector('input[name="schedule_mode"]:checked');w&&i&&(i.style.display=w.value==="smart"?"block":"none")}window.aipkit_toggleTaskCwScheduleFields=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||(d=>d);function a(d){if(!d)return;let o=d.querySelector(".aipkit_task_cw_vector_store_toggle"),l=d.querySelectorAll(".aipkit_task_cw_vector_store_settings_container");if(!o||!l.length)return;let _=o.checked;l.forEach(p=>{p.style.display=_?"block":"none"}),_&&r(d)}function r(d){if(!d)return;let o=d.querySelector(".aipkit_task_cw_vector_store_provider_select");if(!o)return;let l=o.value,_=d.querySelector(".aipkit_task_cw_vector_openai_field"),p=d.querySelector(".aipkit_task_cw_vector_pinecone_field"),f=d.querySelector(".aipkit_task_cw_vector_qdrant_field"),m=d.querySelector(".aipkit_task_cw_vector_embedding_config_row"),k=(u,w)=>{u&&(u.style.display=w?"block":"none")};if(k(_,l==="openai"),k(p,l==="pinecone"),k(f,l==="qdrant"),m){let u=l==="pinecone"||l==="qdrant";m.style.display=u?"block":"none",u&&n(d)}}function n(d){let o=d.querySelector("#aipkit_task_cw_vector_embedding_model");if(!o)return;let l=d.querySelector("#aipkit_task_cw_vector_embedding_provider"),_=l?l.value:"openai",p=window.aipkit_automated_tasks_config||{},f=window.aipkit_automated_tasks_form_state||{},m=[];if(_==="google"?m=p.google_embedding_models||[]:_==="azure"?m=p.azure_embedding_models||[]:m=p.openai_embedding_models||[],o.innerHTML="",m.length>0){o.add(new Option("-- Select Model --","")),m.forEach(u=>{o.add(new Option(g(u.name||u.id),u.id))}),o.disabled=!1;let k=f.pendingEmbeddingModelSelection;k&&Array.from(o.options).find(w=>w.value===k)&&(o.value=k,f.pendingEmbeddingModelSelection=null)}else o.add(new Option("No models found","")),o.disabled=!0}function e(d){if(!d)return;let o=d.getAttribute("aria-expanded")==="true",l=d.getAttribute("aria-controls"),_=document.getElementById(l);_&&(d.setAttribute("aria-expanded",(!o).toString()),_.setAttribute("aria-hidden",o?"true":"false"))}function i(d){if(!d)return;let o=document.getElementById(d.id+"_value");o&&(o.textContent=d.value)}function s(d){d&&(d.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(o=>{o.querySelector(".aipkit_task_cw_vector_store_toggle")&&(a(o),o.querySelectorAll(".aipkit_vector_slider").forEach(l=>{i(l)}))}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(d))}function c(){let d=document.getElementById("aipkit_autogpt_container");!d||d.dataset.kbListenerAttached==="true"||(d.addEventListener("change",o=>{let l=o.target;if(l.matches(".aipkit_task_cw_vector_store_toggle")){let _=l.closest(".aipkit_vector_settings_redesigned");a(_)}else if(l.matches(".aipkit_task_cw_vector_store_provider_select")){let _=l.closest(".aipkit_vector_settings_redesigned");r(_)}else if(l.matches(".aipkit_task_cw_vector_embedding_provider_select")){let _=l.closest(".aipkit_vector_settings_redesigned");n(_)}}),d.addEventListener("input",o=>{let l=o.target;l.matches(".aipkit_vector_slider")&&i(l)}),d.addEventListener("click",o=>{let l=o.target.closest(".aipkit_vector_settings_chunk_header--collapsible");if(!l)return;let _=l.closest(".aipkit_vector_settings_redesigned");!_||!_.querySelector(".aipkit_task_cw_vector_store_toggle")||(o.preventDefault(),e(l))}),s(d),d.dataset.kbListenerAttached="true")}function t(){let d=document.getElementById("aipkit_autogpt_container");d&&(c(),d.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(o=>{o.querySelector(".aipkit_task_cw_vector_store_toggle")&&(a(o),r(o),n(o))}))}window.aipkit_initCwKnowledgeBaseUI=c,window.aipkit_cw_task_populateEmbeddingModelSelect=n,window.aipkit_updateCwKnowledgeBaseUI=t})();(function(){"use strict";function g(){let n=document.getElementById("aipkit_automated_task_form");if(!n){console.warn("Content Writing UI Init: Could not find main form element.");return}let e=n.querySelector("#aipkit_task_cw_ai_provider"),i=n.querySelector("#aipkit_task_cw_ai_model");e&&i&&typeof window.aipkit_task_cw_populateModels=="function"&&(e.dataset.cwProviderListenerAttached||(e.addEventListener("change",()=>window.aipkit_task_cw_populateModels(e,i)),e.dataset.cwProviderListenerAttached="true"),i.dataset.cwModelListenerAttached||(i.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),i.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(e,i),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let s=n.querySelector("#aipkit_task_cw_ai_temperature");s&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(s);let c=n.querySelector("#aipkit_task_cw_post_status");c&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(c.dataset.cwStatusListenerAttached||(c.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),c.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:c})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect(n),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initTaskRssInputHandler=="function"?window.aipkit_initTaskRssInputHandler():typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let d=n.querySelector(".aipkit_task_cw_image_enable_toggle");d&&(d.dataset.cwImgListenerAttached||(d.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),d.dataset.cwImgListenerAttached="true"));let o=n.querySelector("#aipkit_task_cw_image_provider");o&&(o.dataset.cwImgListenerAttached||(o.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),o.dataset.cwImgListenerAttached="true"));let l=n.querySelector("#aipkit_task_cw_generate_featured_image");l&&(l.dataset.cwImgListenerAttached||(l.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),l.dataset.cwImgListenerAttached="true"));let _=n.querySelector(".aipkit_task_cw_image_placement_select");_&&(_.dataset.cwImgListenerAttached||(_.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),_.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100));let p=n.querySelector(".aipkit_image_settings_redesigned");p&&p.dataset.imageChunkListenerAttached!=="true"&&(p.addEventListener("click",v=>{let C=v.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!C)return;v.preventDefault();let x=C.getAttribute("aria-expanded")==="true",b=C.getAttribute("aria-controls");if(!b)return;let I=document.getElementById(b);C.setAttribute("aria-expanded",(!x).toString()),I&&I.setAttribute("aria-hidden",x?"true":"false")}),p.dataset.imageChunkListenerAttached="true");let f=async v=>{if(!v||!v.name)return;let C=v.value.trim(),x=v.dataset.apiKeyBaseline||"";if(C===x||v.dataset.apiKeySaving==="true"||typeof window.aipkit_apiRequest!="function")return;let b=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,I=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,y=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;v.dataset.apiKeySaving="true",v.dataset.apiKeyBaseline=C,b&&b("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[v.name]:C}),I&&I("Updated")}catch(q){v.dataset.apiKeyBaseline=x,y&&y(`Error: ${q.message||"Failed to save."}`)}finally{v.dataset.apiKeySaving="false"}};n.querySelectorAll(".aipkit_task_cw_stock_api_key, #aipkit_task_cw_replicate_api_key").forEach(v=>{if(v.dataset.apiKeyListenerAttached==="true")return;v.dataset.apiKeyBaseline=v.value.trim();let C=()=>{f(v)};v.addEventListener("change",C),v.addEventListener("blur",C),v.dataset.apiKeyListenerAttached="true"}),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let k=n.querySelector("#aipkit_task_cw_ai_settings_toggle"),u=n.querySelector("#aipkit_task_cw_ai_parameters_row");k&&u&&(k.dataset.cwAiSettingsListenerAttached||(k.addEventListener("click",()=>{let v=u.style.display==="none"||u.style.display==="";u.style.display=v?"block":"none",k.classList.toggle("aipkit_active",v),k.setAttribute("aria-expanded",v)}),k.dataset.cwAiSettingsListenerAttached="true"));let w=n.querySelector("#aipkit_task_config_ai");w&&(w.dataset.cwPromptListenerAttached||(w.addEventListener("click",v=>{let C=v.target.closest(".aipkit_textarea_toggle");if(!C)return;let x=C.dataset.target,b=document.getElementById(x),I=C.querySelector(".dashicons");if(!b||!I)return;b.classList.toggle("aipkit_collapsed")?(I.classList.remove("dashicons-minus"),I.classList.add("dashicons-plus-alt2"),C.title="Expand"):(I.classList.remove("dashicons-plus-alt2"),I.classList.add("dashicons-minus"),C.title="Collapse")}),w.dataset.cwPromptListenerAttached="true"));let h=n.querySelector("#aipkit_task_config_seo");h&&(h.dataset.cwSeoPromptListenerAttached||(h.addEventListener("click",v=>{let C=v.target.closest(".aipkit_textarea_toggle");if(!C)return;let x=C.dataset.target,b=document.getElementById(x),I=C.querySelector(".dashicons");if(!b||!I)return;b.classList.toggle("aipkit_collapsed")?(I.classList.remove("dashicons-minus"),I.classList.add("dashicons-plus-alt2"),C.title="Expand"):(I.classList.remove("dashicons-plus-alt2"),I.classList.add("dashicons-minus"),C.title="Collapse")}),h.dataset.cwSeoPromptListenerAttached="true"))}function a(){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=window.aipkit_debug||!1,i=n.querySelector(".aipkit_task_cw_image_enable_toggle"),s=n.querySelector("#aipkit_task_cw_generate_featured_image"),c=n.querySelector(".aipkit_task_cw_image_settings_container"),t=n.querySelector("#aipkit_task_cw_image_provider");if(!i||!s||!c||!t)return;let d=i.checked,o=s.checked,l=d||o,_=t.value,p=_==="pexels"||_==="pixabay";if(c.style.display=l?"block":"none",l){let f=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],m=n.querySelector(".aipkit_task_cw_image_placement_select"),k=n.querySelector(".aipkit_task_cw_image_placement_x_field"),u=n.querySelector("#aipkit_task_cw_pexels_options"),w=n.querySelector("#aipkit_task_cw_pixabay_options"),h=n.querySelector("#aipkit_task_cw_replicate_options"),v=n.querySelector(".aipkit_task_cw_image_display_chunk"),C=n.querySelector("#aipkit_task_cw_image_model_group"),x=n.querySelector("#aipkit_task_cw_image_model_divider");if(f.forEach(b=>{let I=n.querySelector(b);if(I){let y=I.closest(".aipkit_form-group");y&&(y.style.display=d?"block":"none")}}),v&&(v.style.display=d?"":"none"),m&&k){let b=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(m.value);k.style.display=d&&b?"block":"none"}u&&(u.style.display=l&&p&&_==="pexels"?"block":"none"),w&&(w.style.display=l&&p&&_==="pixabay"?"block":"none"),h&&(h.style.display=l&&_==="replicate"?"block":"none"),C&&(C.style.display=l&&!p?"":"none"),x&&(x.style.display=l&&!p?"":"none"),l&&!p&&typeof r=="function"&&r(_)}}function r(n){let e=document.getElementById("aipkit_task_cw_image_model");if(!e)return;let i=e.value,c=window.aipkit_dashboard?.imageGeneratorModels?.[n.toLowerCase()]||[],t=window.aipkit_escapeHtml||function(o){return o},d=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||e.value;if(e.innerHTML="",c.length>0?(c.forEach(o=>{e.appendChild(new Option(t(o.name),o.id))}),e.querySelector(`option[value="${CSS.escape(d)}"]`)&&(e.value=d)):e.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null),typeof window.aipkit_updateAutogptAiSummaries=="function"&&e.value!==i){let o=document.getElementById("aipkit_autogpt_container");window.aipkit_updateAutogptAiSummaries(o)}}window.aipkit_initContentWritingTaskFormUI=g,window.aipkit_updateTaskImageSettingsUI=a,window.aipkit_populateTaskImageModels=r})();(function(){"use strict";function g(){let a=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!a)return;let r=a.querySelector("#aipkit_task_cc_ai_provider"),n=a.querySelector("#aipkit_task_cc_ai_model");r&&n&&typeof window.aipkit_task_cw_populateModels=="function"&&(r.dataset.ccProviderListenerAttached||(r.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(r,n),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),r.dataset.ccProviderListenerAttached="true"),n.dataset.ccModelListenerAttached||(n.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),n.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(r,n),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let e=a.querySelector("#aipkit_task_cc_ai_temperature");e&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(e);let i=a.querySelector("#aipkit_task_cc_content_max_tokens");i&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(i);let s=a.querySelector("#aipkit_task_cc_ai_settings_toggle"),c=a.querySelector("#aipkit_task_cc_ai_parameters_row");s&&c&&(s.dataset.ccAiSettingsListenerAttached||(s.addEventListener("click",()=>{let t=c.style.display==="none"||c.style.display==="";c.style.display=t?"block":"none",s.classList.toggle("aipkit_active",t),s.setAttribute("aria-expanded",t)}),s.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=g})();(function(){"use strict";function g(r){if(!r)return;let n=r.querySelectorAll("[data-aipkit-popover-target]");if(!n.length)return;let e=null,i=null,s=!1,c=_=>_?r.querySelector(`#${_}`):null,t=(_,p)=>{if(!_||!p)return;let f=_.getBoundingClientRect(),m=p.getBoundingClientRect(),k=m.width||400,u=m.height||0,w=window.innerWidth,h=window.innerHeight,v=12;if(_.dataset.aipkitPopoverPlacement==="bottom"){let b=f.left;b+k>w-v&&(b=f.right-k),b=Math.max(v,Math.min(b,w-k-v));let I=f.bottom+8;I+u>h-v&&(I=f.top-u-8),I=Math.max(v,Math.min(I,h-u-v)),p.style.left=`${Math.round(b)}px`,p.style.top=`${Math.round(I)}px`;return}if(_.dataset.aipkitPopoverPlacement==="left"){let b=f.left-k-10;b<v&&(b=f.right+10),b=Math.max(v,Math.min(b,w-k-v));let I=f.top;I+u>h-v&&(I=h-u-v),I=Math.max(v,I),p.style.left=`${Math.round(b)}px`,p.style.top=`${Math.round(I)}px`;return}let C=f.right+10;C+k>w-v&&(C=f.right-k-10),C=Math.max(v,Math.min(C,w-k-v));let x=f.top;x+u>h-v&&(x=h-u-v),x=Math.max(v,x),p.style.left=`${Math.round(C)}px`,p.style.top=`${Math.round(x)}px`},d=()=>{!i||!e||s||(s=!0,window.requestAnimationFrame(()=>{let _=e.querySelector(".aipkit_model_settings_popover_panel");t(i,_),s=!1}))},o=()=>{e&&(e.classList.remove("aipkit-active"),e.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),e=null,i=null)},l=_=>{if(!_)return;let p=_.getAttribute("data-aipkit-popover-target"),f=c(p);if(!f)return;e&&e!==f&&o(),e=f,i=_,f.classList.add("aipkit-active"),f.setAttribute("aria-hidden","false"),_.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${p}`),typeof window.aipkit_initAutogptPromptFlyouts=="function"&&window.aipkit_initAutogptPromptFlyouts(r);let m=f.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{t(_,m)})};n.forEach(_=>{_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",p=>{if(p.preventDefault(),!(_.dataset.aipkitPopoverKeepOpen==="true")&&e&&i===_&&e.classList.contains("aipkit-active")){o();return}l(_)}),_.dataset.popoverListenerAttached="true")}),r.querySelectorAll(".aipkit_model_settings_popover").forEach(_=>{_.dataset.overlayListenerAttached!=="true"&&(_.addEventListener("click",f=>{f.target===_&&o()}),_.dataset.overlayListenerAttached="true");let p=_.querySelector(".aipkit_model_settings_popover_close");p&&p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",f=>{f.preventDefault(),o()}),p.dataset.popoverListenerAttached="true"),_.querySelectorAll("[data-aipkit-popover-close]").forEach(f=>{f.dataset.popoverListenerAttached!=="true"&&(f.addEventListener("click",m=>{m.preventDefault(),o()}),f.dataset.popoverListenerAttached="true")})}),r.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",_=>{_.key==="Escape"&&e&&o()}),r.dataset.escapeListenerAttached="true"),r.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",d),window.addEventListener("scroll",d,!0),r.dataset.repositionListenersAttached="true")}function a(){let r=document.getElementById("aipkit_autogpt_container");r&&g(r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a(),window.aipkit_initAutogptPopovers=g})();(function(){"use strict";let g=t=>{if(!t)return"";let d=t.options?t.options[t.selectedIndex]:null;return d?d.textContent.trim():""},a=t=>t?Array.from(t.selectedOptions||[]).map(d=>d.textContent.trim()).filter(Boolean):[],r=(t,d)=>{let o=t.filter(Boolean);return o.length?o.join(", "):d||""},n=(t,d)=>{if(!t)return;t.textContent=d,t.title=d;let o=t.dataset.aipkitPlaceholder||"",l="active";o&&d===o&&(l="placeholder"),t.dataset.aipkitSummaryState=l},e=(t,d)=>{if(!t)return;let o=d||document,l=t.dataset.aipkitAutogptSummary||"",_=t.dataset.aipkitAutogptProvider||"",p=t.dataset.aipkitAutogptModel||"",f=p?o.querySelector(p):null,m=g(f),k=t.dataset.aipkitPlaceholder||"Select";if(l==="images"){let u=t.dataset.aipkitDisabledLabel||k,w=t.dataset.aipkitAutogptToggle||"",h=t.dataset.aipkitAutogptFeaturedToggle||"",v=w?o.querySelector(w):null,C=h?o.querySelector(h):null;if(!(v&&v.checked||C&&C.checked)){n(t,u);return}let b=_?o.querySelector(_):null,I=b?b.value:"",y=g(b);if(["pexels","pixabay"].includes(I)){n(t,y||k);return}n(t,m||y||k);return}if(l==="vector"){let u=t.dataset.aipkitDisabledLabel||k,w=t.dataset.aipkitAutogptToggle||"",h=w?o.querySelector(w):null;if(!(h?h.checked:!0)){n(t,u);return}let C=_?o.querySelector(_):null,x=C?C.value:"",b=g(C),I=t.dataset.aipkitAutogptStore||"",y=t.dataset.aipkitAutogptOpenaiStore||"",q=t.dataset.aipkitAutogptPineconeStore||"",E=t.dataset.aipkitAutogptQdrantStore||"",S="";if(x==="openai"&&y){let A=o.querySelector(y);S=a(A).join(", ")}else x==="pinecone"&&q?S=g(o.querySelector(q)):x==="qdrant"&&E?S=g(o.querySelector(E)):I&&(S=g(o.querySelector(I)));n(t,r([S,b],k));return}n(t,m||k)},i=(t,d)=>{if(!t||t.dataset.aipkitAutogptSummaryBound==="true")return;let o=d||document,l=t.dataset.aipkitAutogptProvider||"",_=t.dataset.aipkitAutogptModel||"",p=t.dataset.aipkitAutogptToggle||"",f=t.dataset.aipkitAutogptFeaturedToggle||"",m=[t.dataset.aipkitAutogptStore||"",t.dataset.aipkitAutogptOpenaiStore||"",t.dataset.aipkitAutogptPineconeStore||"",t.dataset.aipkitAutogptQdrantStore||""].filter(Boolean),k=l?o.querySelector(l):null,u=_?o.querySelector(_):null,w=p?o.querySelector(p):null,h=f?o.querySelector(f):null,v=()=>e(t,o);k&&k.addEventListener("change",v),u&&u.addEventListener("change",v),w&&w.addEventListener("change",v),h&&h.addEventListener("change",v),m.forEach(C=>{let x=o.querySelector(C);x&&x.addEventListener("change",v)}),t.dataset.aipkitAutogptSummaryBound="true",e(t,o)};function s(t){let d=t||document.getElementById("aipkit_autogpt_container");if(!d)return;d.querySelectorAll("[data-aipkit-autogpt-summary]").forEach(l=>{i(l,d),e(l,d)})}function c(){let t=document.getElementById("aipkit_autogpt_container");t&&s(t)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.aipkit_updateAutogptAiSummaries=s})();(function(){"use strict";let g={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"]},a={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},r=o=>String(o??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),n=()=>{let o=document.getElementById("aipkit_automated_task_type"),l=o?o.value:"";return l==="content_writing"?"bulk":l&&l.startsWith("content_writing_")&&l.replace("content_writing_","")||"bulk"},e=(o,l)=>{let _=g[o]||[],p=a[l]||[],f=[..._,...p];return f.filter((m,k)=>f.indexOf(m)===k)},i=(o,l)=>{if(!o)return;let _=o.dataset.label||"Variables:",p=o.dataset.copyTitle||"Click to copy";o.innerHTML=`${r(_)} `,l.forEach((f,m)=>{let k=document.createElement("code");k.className="aipkit-placeholder",k.title=p,k.textContent=f,o.appendChild(k),m<l.length-1&&o.appendChild(document.createTextNode(" "))})},s=o=>{let l=o||document.getElementById("aipkit_autogpt_container");if(!l)return;let _=n(),p=l.querySelectorAll(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");p.length&&p.forEach(f=>{let m=f.dataset.promptType||"",k=e(m,_);k.length&&i(f,k)})};function c(o){let l=o.querySelectorAll(".aipkit_cw_prompt_library_select");l.length&&l.forEach(_=>{_.dataset.promptLibraryAttached!=="true"&&(_.addEventListener("change",()=>{let p=_.getAttribute("data-aipkit-prompt-target");if(!p||!_.value)return;let f=o.querySelector(`#${p}`);f&&(f.value=_.value,f.dispatchEvent(new Event("input",{bubbles:!0})))}),_.dataset.promptLibraryAttached="true")})}function t(o){if(!o)return;let l=o.querySelectorAll("[data-aipkit-flyout-target]");if(!l.length)return;let _=null,p=null,f=!1,m=v=>v?o.querySelector(`#${v}`):null,k=(v,C,x)=>{if(!v||!C||!_)return;let b=v.getBoundingClientRect(),I=x?x.getBoundingClientRect():b,y=C.getBoundingClientRect(),q=y.width||580,E=y.height||420,S=window.innerWidth,A=window.innerHeight,T=12,M=I.left-q-10;M<T&&(M=I.right+10),M=Math.max(T,Math.min(M,S-q-T));let V=I.top;V+E>A-T&&(V=A-E-T),V=Math.max(T,V),_.style.left=`${Math.round(M)}px`,_.style.top=`${Math.round(V)}px`},u=()=>{!_||!p||f||(f=!0,window.requestAnimationFrame(()=>{let v=_.querySelector(".aipkit_cw_prompt_panel"),C=p.closest(".aipkit_model_settings_popover_panel");k(p,v,C),f=!1}))},w=()=>{_&&(_.classList.remove("is-open"),_.setAttribute("aria-hidden","true"),p&&p.setAttribute("aria-expanded","false"),_=null,p=null)},h=v=>{let C=v.getAttribute("data-aipkit-flyout-target"),x=m(C);x&&(_&&_!==x&&w(),_=x,p=v,x.classList.add("is-open"),x.setAttribute("aria-hidden","false"),v.setAttribute("aria-expanded","true"),s(x),window.requestAnimationFrame(()=>{let b=x.querySelector(".aipkit_cw_prompt_panel"),I=v.closest(".aipkit_model_settings_popover_panel");k(v,b,I)}))};l.forEach(v=>{v.dataset.promptFlyoutListenerAttached!=="true"&&(v.addEventListener("click",C=>{if(C.preventDefault(),_&&p===v&&_.classList.contains("is-open")){w();return}h(v)}),v.dataset.promptFlyoutListenerAttached="true")}),o.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(v=>{v.dataset.overlayListenerAttached!=="true"&&(v.addEventListener("click",C=>{C.target===v&&w()}),v.dataset.overlayListenerAttached="true")}),o.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",v=>{v.key==="Escape"&&_&&w()}),o.dataset.promptFlyoutEscapeAttached="true"),o.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",v=>{if(!_)return;let C=v.target;C.closest(".aipkit_cw_prompt_flyout")||C.closest("[data-aipkit-flyout-target]")||w()}),o.dataset.promptFlyoutClickAttached="true"),o.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),o.dataset.promptFlyoutRepositionAttached="true")}function d(o){let l=o||document.getElementById("aipkit_autogpt_container");l&&(c(l),t(l),s(l))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>d()):d(),window.aipkit_initAutogptPromptFlyouts=d,window.aipkit_updateAutogptPromptPlaceholders=()=>{s()}})();(function(){"use strict";function g(){let i=document.querySelector("#aipkit_task_cw_ai_provider"),s=document.querySelector("#aipkit_task_cw_ai_model"),c=document.querySelector(".aipkit_task_cw_reasoning_effort_field"),t=c?c.closest(".aipkit_ai_settings_redesigned"):null;if(!i||!s||!c){c&&(c.style.display="none");return}let d=(i.value||"").toLowerCase(),l=(s.value||"").toLowerCase(),_=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),p=l.includes("gpt-5");d==="openai"&&(_||p)?(c.style.display="block",t&&a(t,l)):c.style.display="none"}function a(i,s){let c=i.querySelector("[data-aipkit-reasoning-select]"),t=i.querySelectorAll(".aipkit_ai_reasoning_option");if(!c||!t.length)return;let d=r(s),o=new Set(d.allowed);t.forEach(f=>{let m=f.querySelector(".aipkit_ai_reasoning_input");if(!m)return;let k=m.value==="minimal"?"low":m.value,u=o.has(k);f.style.display=u?"":"none",u||(m.checked=!1)});let l=c.value||"";l==="minimal"&&(l="low"),o.has(l)||(l=d.defaultValue),o.has(l)||(l=d.allowed[0]||"");let _=c.value;l&&(c.value=l);let p=i.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(p){p.checked=!0,i.querySelectorAll(".aipkit_ai_reasoning_option").forEach(m=>m.classList.remove("aipkit_ai_reasoning_option--selected"));let f=p.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}_!==c.value&&c.dispatchEvent(new Event("change",{bubbles:!0}))}function r(i){return e(i)?{allowed:["high"],defaultValue:"high"}:i.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(i)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(i){let s=i.match(/gpt-5\.(\d+)/);if(s)return Number.parseInt(s[1],10)>=2;let c=i.match(/gpt-(\d+)/);return c?Number.parseInt(c[1],10)>=6:!1}function e(i){return/gpt-5(\.\d+)?-pro/.test(i)}window.aipkit_autogpt_cw_toggleReasoningEffort=g})();(function(){"use strict";function g(){let i=document.querySelector("#aipkit_task_cc_ai_provider"),s=document.querySelector("#aipkit_task_cc_ai_model"),c=document.querySelector(".aipkit_task_cc_reasoning_effort_field"),t=c?c.closest(".aipkit_ai_settings_redesigned"):null;if(!i||!s||!c){c&&(c.style.display="none");return}let d=(i.value||"").toLowerCase(),l=(s.value||"").toLowerCase(),_=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),p=l.includes("gpt-5");d==="openai"&&(_||p)?(c.style.display="block",t&&a(t,l)):c.style.display="none"}function a(i,s){let c=i.querySelector("[data-aipkit-reasoning-select]"),t=i.querySelectorAll(".aipkit_ai_reasoning_option");if(!c||!t.length)return;let d=r(s),o=new Set(d.allowed);t.forEach(f=>{let m=f.querySelector(".aipkit_ai_reasoning_input");if(!m)return;let k=m.value==="minimal"?"low":m.value,u=o.has(k);f.style.display=u?"":"none",u||(m.checked=!1)});let l=c.value||"";l==="minimal"&&(l="low"),o.has(l)||(l=d.defaultValue),o.has(l)||(l=d.allowed[0]||"");let _=c.value;l&&(c.value=l);let p=i.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(p){p.checked=!0,i.querySelectorAll(".aipkit_ai_reasoning_option").forEach(m=>m.classList.remove("aipkit_ai_reasoning_option--selected"));let f=p.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}_!==c.value&&c.dispatchEvent(new Event("change",{bubbles:!0}))}function r(i){return e(i)?{allowed:["high"],defaultValue:"high"}:i.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(i)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(i){let s=i.match(/gpt-5\.(\d+)/);if(s)return Number.parseInt(s[1],10)>=2;let c=i.match(/gpt-(\d+)/);return c?Number.parseInt(c[1],10)>=6:!1}function e(i){return/gpt-5(\.\d+)?-pro/.test(i)}window.aipkit_autogpt_cc_toggleReasoningEffort=g})();(function(){"use strict";function g(a,r){let n=document.getElementById("aipkit_save_task_btn"),e=n?n.querySelector(".aipkit_btn-text"):null,i=a.elements.task_id,s=a.elements.task_name,c=a.elements.task_type,t=a.elements.task_status,d=document.getElementById("aipkit_cancel_edit_task_btn"),l=(window.aipkit_automated_tasks_config||{}).text||{},_=document.getElementById("aipkit_autogpt_header_title_default"),p=document.getElementById("aipkit_autogpt_header_title_editor"),f=document.getElementById("aipkit_autogpt_title_display"),m=document.getElementById("aipkit_autogpt_title_text"),k=document.getElementById("aipkit_autogpt_task_title_input"),u=m&&m.dataset.defaultLabel||k&&k.placeholder||"New Task",w=()=>{let x=(k?k.value.trim():"")||u;m&&(m.textContent=x),f&&f.setAttribute("title",x),s&&(s.value=x)},h=()=>{!f||!k||(f.style.display="none",k.style.display="inline-block",k.focus(),k.select())},v=()=>{!f||!k||(k.style.display="none",f.style.display="inline-flex",w())};_&&(_.style.display="none"),p&&(p.style.display="flex"),p&&p.dataset.inlineTitleBound!=="true"&&f&&k&&(f.addEventListener("click",h),k.addEventListener("blur",v),k.addEventListener("keydown",C=>{C.key==="Enter"&&(C.preventDefault(),k.blur())}),k.addEventListener("input",w),p.dataset.inlineTitleBound="true"),r?(e&&(e.textContent=l.save_task_button||"Save Task"),i&&(i.value=r.id||""),k&&(k.value=r.task_name||u),w(),c&&(c.value=r.task_type||"content_indexing"),t&&(t.value=r.status||"active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),d&&(d.style.display="inline-flex")):(e&&(e.textContent=l.save_task_button||"Save Task"),i&&(i.value=""),k&&(k.value=u),w(),c&&(c.value="content_indexing"),t&&(t.value="active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),d&&(d.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function a(r){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=n.elements["post_types[]"];e&&(Array.from(e.options).forEach(s=>s.selected=!1),(r.post_types||[]).forEach(s=>{let c=e.querySelector(`option[value="${g(s)}"]`);c&&(c.selected=!0)}));let i=n.elements.target_store_provider;i&&(i.value=r.target_store_provider||"openai",i.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(r.target_store_provider||"openai").then(()=>{let s=n.elements.target_store_id;s&&(s.value=r.target_store_id||"")}),n.elements.index_existing_now_flag&&(n.elements.index_existing_now_flag.checked=r.index_existing_now_flag==="1"),n.elements.only_new_updated_flag&&(n.elements.only_new_updated_flag.checked=r.only_new_updated_flag==="1"),(r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&r.embedding_provider&&r.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${r.embedding_provider}:${r.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),n.elements.task_frequency&&(n.elements.task_frequency.value=r.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=a})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function a(r){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=r.cw_generation_mode||"bulk";if(e==="bulk"||e==="single"||e==="task"){let C=n.elements.content_title_bulk;C&&(C.value=r.content_title||"")}else if(e==="csv"){let C=n.elements.content_title;C&&(C.value=r.content_title||"")}else if(e==="rss"){n.elements.rss_feeds&&(n.elements.rss_feeds.value=r.rss_feeds||""),n.elements.rss_include_keywords&&(n.elements.rss_include_keywords.value=r.rss_include_keywords||""),n.elements.rss_exclude_keywords&&(n.elements.rss_exclude_keywords.value=r.rss_exclude_keywords||"");let C=n.elements.rss_feeds;C&&(typeof window.aipkit_initTaskRssInputHandler=="function"&&window.aipkit_initTaskRssInputHandler(),C.dispatchEvent(new Event("input",{bubbles:!0})))}else if(e==="url")n.elements.url_list&&(n.elements.url_list.value=r.url_list||"");else if(e==="gsheets"){let C=n.elements.gsheets_credentials;if(C){let x=r.gsheets_credentials,b=C.closest(".aipkit_gsheets_section_container");typeof x=="object"&&x!==null?C.value=JSON.stringify(x,null,2):C.value=x||"",C.value?(C.dataset.filename="credentials.json",b&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(b),100)):(delete C.dataset.filename,b&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(b,"clear"))}n.elements.gsheets_sheet_id&&(n.elements.gsheets_sheet_id.value=r.gsheets_sheet_id||"")}n.elements.custom_title_prompt&&(n.elements.custom_title_prompt.value=r.custom_title_prompt||""),n.elements.custom_content_prompt&&(n.elements.custom_content_prompt.value=r.custom_content_prompt||"");let i=document.getElementById("aipkit_task_cw_ai_provider"),s=document.getElementById("aipkit_task_cw_ai_model");i&&(i.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",r.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&s&&window.aipkit_task_cw_populateModels(i,s));let c=document.getElementById("aipkit_task_cw_ai_temperature");if(c){c.value=r.ai_temperature||"1.0";let C=document.getElementById("aipkit_task_cw_ai_temperature_value");C&&(C.textContent=c.value)}let t=document.getElementById("aipkit_task_cw_content_length");t&&(t.value=r.content_length||"medium",t.dispatchEvent(new Event("change",{bubbles:!0})));let d=n.elements.reasoning_effort;if(d){let C=r.reasoning_effort||"";C&&(d.value=C==="minimal"?"low":C,d.dispatchEvent(new Event("change",{bubbles:!0})))}s&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>s.dispatchEvent(new Event("change",{bubbles:!0})),100),n.elements.generate_meta_description&&(n.elements.generate_meta_description.checked=r.generate_meta_description==="1"),n.elements.custom_meta_prompt&&(n.elements.custom_meta_prompt.value=r.custom_meta_prompt||""),n.elements.generate_focus_keyword&&(n.elements.generate_focus_keyword.checked=r.generate_focus_keyword==="1"),n.elements.custom_keyword_prompt&&(n.elements.custom_keyword_prompt.value=r.custom_keyword_prompt||""),n.elements.generate_excerpt&&(n.elements.generate_excerpt.checked=r.generate_excerpt==="1"),n.elements.custom_excerpt_prompt&&(n.elements.custom_excerpt_prompt.value=r.custom_excerpt_prompt||""),n.elements.generate_tags&&(n.elements.generate_tags.checked=r.generate_tags==="1"),n.elements.custom_tags_prompt&&(n.elements.custom_tags_prompt.value=r.custom_tags_prompt||""),n.elements.generate_toc&&(n.elements.generate_toc.checked=r.generate_toc==="1"),n.elements.generate_seo_slug&&(n.elements.generate_seo_slug.checked=r.generate_seo_slug==="1"),n.elements.post_type&&(n.elements.post_type.value=r.post_type||"post");let o=n.elements.post_author;o&&(o.value=r.post_author||window.aipkit_dashboard?.currentUserId||"1");let l=document.getElementById("aipkit_task_cw_post_status");l&&(l.value=r.post_status||"draft");let _=r.schedule_mode||"immediate",p=n.querySelector(`input[name="schedule_mode"][value="${_}"]`);p&&(p.checked=!0),n.elements.smart_schedule_start_datetime&&(n.elements.smart_schedule_start_datetime.value=r.smart_schedule_start_datetime||""),n.elements.smart_schedule_interval_value&&(n.elements.smart_schedule_interval_value.value=r.smart_schedule_interval_value||"1"),n.elements.smart_schedule_interval_unit&&(n.elements.smart_schedule_interval_unit.value=r.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:l});let f=document.getElementById("aipkit_task_cw_post_categories");f&&f.options&&(Array.from(f.options).forEach(x=>x.selected=!1),(Array.isArray(r.post_categories)?r.post_categories.map(String):[]).forEach(x=>{let b=f.querySelector(`option[value="${g(x)}"]`);b&&(b.selected=!0)}),f.dispatchEvent(new Event("change",{bubbles:!0}))),n.elements.generate_images_enabled&&(n.elements.generate_images_enabled.checked=r.generate_images_enabled==="1"),n.elements.image_provider&&(n.elements.image_provider.value=(r.image_provider||"openai").toLowerCase()),n.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=r.image_model),n.elements.image_prompt&&(n.elements.image_prompt.value=r.image_prompt||""),n.elements.image_count&&(n.elements.image_count.value=r.image_count||"1"),n.elements.image_placement&&(n.elements.image_placement.value=r.image_placement||"after_first_h2"),n.elements.image_placement_param_x&&(n.elements.image_placement_param_x.value=r.image_placement_param_x||"2"),n.elements.image_size&&(n.elements.image_size.value=r.image_size||"large"),n.elements.image_alignment&&(n.elements.image_alignment.value=r.image_alignment||"none"),n.elements.generate_featured_image&&(n.elements.generate_featured_image.checked=r.generate_featured_image==="1"),n.elements.featured_image_prompt&&(n.elements.featured_image_prompt.value=r.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let m=n.querySelector('input[name="enable_vector_store"]');m&&(m.checked=r.enable_vector_store==="1",m.dispatchEvent(new Event("change",{bubbles:!0})));let k=n.querySelector("#aipkit_task_cw_vector_store_provider");k&&(k.value=r.vector_store_provider||"openai",k.dispatchEvent(new Event("change",{bubbles:!0})));let u=n.querySelector("#aipkit_task_cw_vector_store_top_k");if(u){u.value=r.vector_store_top_k||"3";let C=n.querySelector("#aipkit_task_cw_vector_store_top_k_value");C&&(C.textContent=u.value)}let w=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(w&&w.options){let C=Array.isArray(r.openai_vector_store_ids)?r.openai_vector_store_ids.map(String):[];Array.from(w.options).forEach(x=>{x.selected=C.includes(x.value)}),w.dispatchEvent(new Event("change",{bubbles:!0}))}let h=document.getElementById("aipkit_task_cw_pinecone_index_name");h&&(h.value=r.pinecone_index_name||"");let v=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(v&&(v.value=r.qdrant_collection_name||""),r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant"){let C=document.getElementById("aipkit_task_cw_vector_embedding_provider");C&&(C.value=r.vector_embedding_provider||"openai",C.dispatchEvent(new Event("change",{bubbles:!0})))}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),r.vector_store_provider&&(r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant")&&r.vector_embedding_model&&setTimeout(()=>{window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=r.vector_embedding_model);let C=n.querySelector("#aipkit_autogpt_cw_vector_settings_popover")||n;C&&typeof window.aipkit_cw_task_populateEmbeddingModelSelect=="function"&&window.aipkit_cw_task_populateEmbeddingModelSelect(C)},150),n.elements.task_frequency&&(n.elements.task_frequency.value=r.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=a})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_automated_task_form");if(!r)return;let n=document.getElementById("aipkit_task_cc_ai_provider"),e=document.getElementById("aipkit_task_cc_ai_model");n&&e&&(n.value=a.ai_provider?a.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&a.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=a.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(n,e));let i=document.getElementById("aipkit_task_cc_ai_temperature");if(i){i.value=a.ai_temperature||1;let f=document.getElementById(i.id+"_value");f&&(f.textContent=i.value)}let s=document.getElementById("aipkit_task_cc_content_max_tokens");if(s){s.value=a.content_max_tokens||4e3;let f=document.getElementById(s.id+"_value");f&&(f.textContent=s.value),s.dispatchEvent(new Event("change",{bubbles:!0}))}let c=r.elements.cc_reasoning_effort;if(c){let f=a.reasoning_effort||"";f&&(c.value=f==="minimal"?"low":f,c.dispatchEvent(new Event("change",{bubbles:!0})))}e&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>e.dispatchEvent(new Event("change",{bubbles:!0})),100);let t=document.getElementById("aipkit_task_cc_custom_content_prompt");t&&(t.value=a.custom_content_prompt||"");let d=document.getElementById("aipkit_task_comment_reply_include_keywords");d&&(d.value=a.include_keywords||"");let o=document.getElementById("aipkit_task_comment_reply_exclude_keywords");o&&(o.value=a.exclude_keywords||"");let l=r.elements["post_types_for_comments[]"];l&&(Array.from(l.options).forEach(f=>f.selected=!1),(a.post_types_for_comments||[]).forEach(f=>{let m=l.querySelector(`option[value="${f}"]`);m&&(m.selected=!0)}));let _=r.elements.reply_action;_&&(_.value=a.reply_action||"approve");let p=r.elements.no_reply_to_replies;p&&(p.checked=a.no_reply_to_replies==="1"),r.elements.task_frequency&&(r.elements.task_frequency.value=a.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_automated_tasks_config||{},n=window.aipkit_dashboard||{},e=r.default_cw_prompts||{};if(!a)return;a.elements.custom_title_prompt&&(a.elements.custom_title_prompt.value=e.title||""),a.elements.custom_content_prompt&&(a.elements.custom_content_prompt.value=e.content||""),a.elements.custom_meta_prompt&&(a.elements.custom_meta_prompt.value=e.meta||""),a.elements.custom_keyword_prompt&&(a.elements.custom_keyword_prompt.value=e.keyword||""),a.elements.image_prompt&&(a.elements.image_prompt.value=e.image||""),a.elements.featured_image_prompt&&(a.elements.featured_image_prompt.value=e.featured_image||"");let i=document.getElementById("aipkit_task_cw_ai_provider"),s=document.getElementById("aipkit_task_cw_ai_model");if(i&&s){let t=(n.main_provider||"openai").toLowerCase();if(i.value=t,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(i,s);let d="",o=n?.models?.[t];switch(t){case"openai":d="gpt-4.1-mini";break;case"google":d="gemini-1.5-flash-latest";break;case"openrouter":d="anthropic/claude-3.5-sonnet";break;case"claude":d="claude-opus-4-6",Array.isArray(o)&&o.length>0&&(o.some(_=>_&&_.id==="claude-opus-4-6")||(d=o[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(o)&&o.length>0&&(d=o[0].id||"");break}s.querySelector(`option[value="${CSS.escape(d)}"]`)?s.value=d:console.warn(`Default model ${d} not found for provider ${t}.`)}}let c=document.getElementById("aipkit_task_cw_content_length");c&&(c.value="medium",c.dispatchEvent(new Event("change",{bubbles:!0}))),a.elements.generate_images_enabled&&(a.elements.generate_images_enabled.checked=!1),a.elements.image_provider&&(a.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{a.elements.image_model&&(a.elements.image_model.value="gpt-image-1")},0)),a.elements.image_count&&(a.elements.image_count.value="1"),a.elements.image_placement&&(a.elements.image_placement.value="after_first_h2"),a.elements.generate_featured_image&&(a.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_dashboard||{};if(!a)return;let n=document.getElementById("aipkit_task_cc_custom_content_prompt");n&&(n.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let e=document.getElementById("aipkit_task_cc_ai_provider"),i=document.getElementById("aipkit_task_cc_ai_model");if(e&&i){let c=(r.main_provider||"openai").toLowerCase();if(e.value=c,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(e,i);let t="",d=(r.models||{})[c]||{};switch(c){case"openai":t="gpt-4o-mini";break;case"google":t="gemini-1.5-flash-latest";break;case"openrouter":t="anthropic/claude-3.5-sonnet";break;case"claude":t="claude-opus-4-6",Array.isArray(d)&&d.length>0&&(d.some(l=>l&&l.id==="claude-opus-4-6")||(t=d[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(d)&&d.length>0&&(t=d[0].id||"");break}i.querySelector(`option[value="${CSS.escape(t)}"]`)&&(i.value=t)}}let s=document.getElementById("aipkit_task_cc_content_max_tokens");s&&(s.value="4000",s.dispatchEvent(new Event("change",{bubbles:!0})))}window.aipkit_form_setCommentReplyDefaults=g})();(function(){"use strict";function g(a,r,n,e=null){let i=document.getElementById("aipkit_automated_task_form"),s=document.getElementById("aipkit_automated_task_queue_wrapper");if(!i){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),i.reset(),i.elements.task_id&&(i.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),e){let l=((window.aipkit_automated_tasks_config||{}).task_types||{})[e.task_type];if(l){let _=i.elements.task_category;if(_){_.value=l.category;let p=new Event("change",{bubbles:!0});_.dispatchEvent(p)}}}else{let o=i.elements.task_category,l=i.elements.task_type;o&&l&&(o.value="content_creation",o.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{l.value="content_writing_bulk",l.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(i,e):console.error("Show Task Form: aipkit_form_populateCommonFields function is missing.");let c=i.elements.task_type;if(c&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:c}),e){let o=JSON.parse(e.task_config||"{}");e.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(o):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):e.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(o):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):e.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(o):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):e.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(o):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}a&&(a.style.display="block"),r&&(r.style.display="none"),s&&(s.style.display="none"),n&&(n.style.display="none");let t=document.getElementById("aipkit_autogpt_editor_actions");t&&(t.style.display="flex");let d=document.getElementById("aipkit_autogpt_cron_info");d&&(d.style.display="none"),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers()}window.aipkit_form_showAutomatedTaskForm=g})();(function(){"use strict";function g(a,r,n){let e=document.getElementById("aipkit_automated_task_queue_wrapper");a&&(a.style.display="none"),r&&(r.style.display="block"),e&&(e.style.display="block"),n&&(n.style.display="inline-flex");let i=document.getElementById("aipkit_autogpt_editor_actions");i&&(i.style.display="none");let s=document.getElementById("aipkit_autogpt_cron_info");s&&(s.style.display="inline-flex");let c=document.getElementById("aipkit_automated_task_form"),t=document.getElementById("aipkit_automated_task_id"),d=document.getElementById("aipkit_automated_task_category"),o=document.getElementById("aipkit_autogpt_header_title_default"),l=document.getElementById("aipkit_autogpt_header_title_editor"),_=document.getElementById("aipkit_autogpt_title_display"),p=document.getElementById("aipkit_autogpt_task_title_input");c&&c.reset(),t&&(t.value=""),o&&(o.style.display="block"),l&&(l.style.display="none"),_&&(_.style.display="inline-flex"),p&&(p.style.display="none"),d&&(d.value="",d.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=g})();(function(){"use strict";let g=()=>{typeof window.aipkit_updateAutogptPromptPlaceholders=="function"&&window.aipkit_updateAutogptPromptPlaceholders()};function a(i,s,c,t){if(!i||!s)return;i.innerHTML="";let d={content_writing_bulk:{icon:"dashicons-edit"},content_writing_csv:{icon:"dashicons-media-spreadsheet"},content_writing_rss:{icon:"dashicons-rss"},content_writing_url:{icon:"dashicons-admin-links"},content_writing_gsheets:{icon:"dashicons-analytics"}};c.forEach(([o,l])=>{let _=document.createElement("label");_.className="aipkit_cw_mode_card aipkit_autogpt_task_type_card",_.classList.toggle("is-active",o===t);let p=document.createElement("input");p.type="radio",p.name="aipkit_task_type_radio",p.value=o,p.checked=o===t,p.disabled=!!l.disabled,p.className="aipkit_task_type_input",p.addEventListener("change",()=>{p.checked&&(s.value=o,s.dispatchEvent(new Event("change",{bubbles:!0})),i.querySelectorAll(".aipkit_cw_mode_card").forEach(w=>w.classList.remove("is-active")),_.classList.add("is-active"))});let f=d[o]||{},m=document.createElement("span");m.className="aipkit_cw_mode_icon",m.innerHTML=`<span class="dashicons ${f.icon||"dashicons-admin-generic"}"></span>`;let k=document.createElement("span");k.className="aipkit_cw_mode_text";let u=document.createElement("span");u.className="aipkit_cw_mode_title",u.textContent=l.label,k.appendChild(u),l.disabled&&(_.classList.add("is-disabled"),_.setAttribute("aria-disabled","true")),_.appendChild(p),_.appendChild(m),_.appendChild(k),i.appendChild(_)})}function r(i,s){i&&i.querySelectorAll('input[name="aipkit_task_type_radio"]').forEach(c=>{let t=c.value===s;c.checked=t;let d=c.closest(".aipkit_cw_mode_card");d&&d.classList.toggle("is-active",t)})}function n(i){let s=i.target.value,c=document.querySelector(".aipkit_autogpt_form_right"),t=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;if(c){let h=!t&&s==="content_enhancement";c.style.display=h?"none":""}let d=document.getElementById("aipkit_automated_task_type"),o=document.getElementById("aipkit_automated_task_type_group"),l=document.getElementById("aipkit_automated_task_type_radios"),_=(window.aipkit_automated_tasks_config||{}).task_types||{},p=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),f=p.lastTaskTypeByCategory||{};p.lastTaskTypeByCategory=f;let m=window.aipkit_escapeHtml||function(h){return h};d.innerHTML="",d.disabled=!0,o&&(o.style.display="none"),l&&(l.innerHTML="");let k=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(k&&k.querySelectorAll(".aipkit_task_config_section").forEach(h=>{h.id==="aipkit_task_cw_input_modes_wrapper"&&h.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(v=>{v.style.display="none"}),h.style.display="none"}),!s){d.appendChild(new Option(m("-- Select a category first --"),"")),d.dispatchEvent(new Event("change",{bubbles:!0}));return}let u=Object.entries(_).filter(([h,v])=>v.category===s);if(u.length===0)d.appendChild(new Option(m("-- No tasks in this category --"),""));else if(u.length===1){let[h,v]=u[0],C=new Option(m(v.label),h);v.disabled&&(C.disabled=!0),d.appendChild(C),d.value=h,d.disabled=!0,o&&(o.style.display="none")}else d.appendChild(new Option(m("-- Select a Task Type --"),"")),u.forEach(([h,v])=>{let C=new Option(m(v.label),h);v.disabled&&(C.disabled=!0),d.appendChild(C)}),d.disabled=!1;if(u.length>1){let h=f[s];!h&&s==="content_creation"&&(h="content_writing_bulk"),!h&&u.length>0&&d.options.length&&(h=u[0][0]),h&&(d.value=h)}let w=!!l&&u.length>1&&s==="content_creation";o&&(o.style.display=w?"":"none"),l&&(w?a(l,d,u,d.value):l.innerHTML=""),d.dispatchEvent(new Event("change",{bubbles:!0}))}function e(i){let s=i.target.value,c=document.getElementById("aipkit_automated_task_type_radios");r(c,s);let t=document.getElementById("aipkit_automated_task_id"),d=!t||!t.value,o=document.getElementById("aipkit_wizard_next_btn"),l=o?o.querySelector(".aipkit_btn-text"):null,_=document.getElementById("aipkit_save_task_btn"),p=_?_.querySelector(".aipkit_btn-text"):null,f=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,k=((window.aipkit_automated_tasks_config||{}).task_types||{})[s],u=k&&k.pro===!0,w=(window.aipkit_automated_tasks_config||{}).text||{};if(k){let E=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),S=E.lastTaskTypeByCategory||{};S[k.category]=s,E.lastTaskTypeByCategory=S}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(s):console.error("Task Type Change: aipkit_renderWizard function is missing.");let h=document.querySelector(".aipkit_task_schedule_frequency"),v=document.getElementById("aipkit_automated_task_frequency");if(h&&v){let E=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={});s==="content_writing_bulk"||s==="content_writing_csv"?(!E.lastVisibleFrequency&&v.value&&(E.lastVisibleFrequency=v.value),v.value="one-time",h.style.display="none"):(h.style.display="",E.lastVisibleFrequency&&v.value==="one-time"&&(v.value=E.lastVisibleFrequency),E.lastVisibleFrequency=v.value)}let C=document.querySelectorAll("[data-aipkit-task-publishing]");if(C.length){let E=s&&s.startsWith("content_writing");C.forEach(S=>{S.style.display=E?"":"none"})}u&&!f?(l&&o&&(o.dataset.action="next",l.textContent=w.wizard_next_button||"Next",o.style.display="none"),p&&_&&(_.dataset.action="save",p.textContent=w.save_task_button||"Save Task",_.style.display="none")):(l&&o&&(o.dataset.action="next",l.textContent=w.wizard_next_button||"Next",o.style.display=""),p&&_&&(_.dataset.action="save",p.textContent=w.save_task_button||"Save Task",_.style.display=""));let x=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!x){console.error("Task Type Change: Could not find setup pane.");return}let b=x.querySelector("#aipkit_task_ci_source_wrapper"),I=x.querySelector("#aipkit_task_cw_input_modes_wrapper"),y=x.querySelector("#aipkit_task_cc_source_wrapper"),q=x.querySelector("#aipkit_task_ce_content_selection_wrapper");if(b&&(b.style.display="none"),I&&(I.style.display="none"),y&&(y.style.display="none"),q&&(q.style.display="none"),!!s){if(s==="content_indexing")b&&(b.style.display="block");else if(s.startsWith("content_writing")){if(g(),I){I.style.display="block";let E=s.replace("content_writing_",""),S=E==="content_writing"?"bulk":E,A=document.getElementById("aipkit_task_cw_generation_mode");A&&(A.value=S),I.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(T=>{T.id===`aipkit_task_cw_input_mode_${S}`?T.style.display="block":T.style.display="none"})}}else if(s==="community_reply_comments")y&&(y.style.display="block");else if(s==="enhance_existing_content"){q&&(q.style.display="block");let E=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),S=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(E&&S){let A=E.querySelector("#aipkit_task_ce_post_types");if(A&&!A.dataset.placeholderListenerAttached){let T=()=>{let V=Array.from(A.selectedOptions).map(R=>R.value).includes("product");S.querySelectorAll(".aipkit-product-placeholders").forEach(R=>{R.style.display=V?"inline":"none"})};A.addEventListener("change",T),A.dataset.placeholderListenerAttached="true",T()}}}d&&(s.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():s==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():s==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),s==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():s.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():s==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():s==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=n,window.aipkit_form_handleTaskTypeChange=e})();(function(){"use strict";function g(a,r="info"){let n=document.getElementById("aipkit_automated_task_form_status");if(!n)return;let e=n.classList.contains("aipkit_training_status");if(!a){n.textContent="",e?n.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):n.className="aipkit_form-help";return}if(n.textContent=a,e){let i=r==="info"?"loading":r;n.classList.remove("is-success","is-error","is-warning","is-loading"),n.classList.add("is-visible"),i&&n.classList.add(`is-${i}`)}else n.className=`aipkit_form-help aipkit_settings_message-${r}`;setTimeout(()=>{n.textContent===a&&(n.textContent="",e?n.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):n.className="aipkit_form-help")},5e3)}window.aipkit_form_showAutomatedTaskFormStatus=g})();(function(){"use strict";function g(a){let r=new FormData(a),n=Object.fromEntries(r.entries());return n.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:r,data:n}}window.aipkit_save_task_extractBaseData=g})();(function(){"use strict";function g(a,r){if(a.task_type==="content_indexing"){if(a.post_types=r.getAll("post_types[]"),a.target_store_provider=r.get("target_store_provider")||"openai",a.target_store_id=r.get("target_store_id")||"",a.target_store_provider==="pinecone"||a.target_store_provider==="qdrant"){let e=r.get("embedding_model")||"";if(e&&e.includes(":")){let[i,s]=e.split(":",2);a.embedding_provider=i,a.embedding_model=s}else a.embedding_provider="",a.embedding_model=e}else delete a.embedding_provider,delete a.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete a[e])}else delete a.post_types,delete a["post_types[]"],delete a.target_store_provider,delete a.target_store_id,delete a.index_existing_now_flag,delete a.only_new_updated_flag,delete a.embedding_model,delete a.embedding_provider;return a}window.aipkit_save_task_handleContentIndexing=g})();(function(){"use strict";function g(a,r){return a.task_type.startsWith("content_writing")?(a.post_categories=r.getAll("post_categories[]"),a.openai_vector_store_ids=r.getAll("openai_vector_store_ids[]"),delete a["post_categories[]"],delete a["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete a[e]),delete a.replicate_api_key,delete a.pexels_api_key,delete a.pixabay_api_key):(delete a.content_title,delete a.content_title_bulk,delete a.content_keywords,delete a.content_length,delete a.ai_temperature,delete a.post_type,delete a.post_author,delete a.post_status,delete a["post_categories[]"],delete a.post_categories,delete a.prompt_mode,delete a.custom_title_prompt,delete a.custom_content_prompt,delete a.generate_meta_description,delete a.custom_meta_prompt,delete a.generate_focus_keyword,delete a.custom_keyword_prompt,delete a.cw_generation_mode,delete a.rss_feeds,delete a.gsheets_sheet_id,delete a.gsheets_credentials,delete a.url_list,delete a.generate_toc,delete a.generate_images_enabled,delete a.image_provider,delete a.image_model,delete a.image_prompt,delete a.image_count,delete a.image_placement,delete a.image_placement_param_x,delete a.image_alignment,delete a.image_size,delete a.generate_featured_image,delete a.featured_image_prompt,delete a.pexels_orientation,delete a.pexels_size,delete a.pexels_color,delete a.pexels_api_key,delete a.pixabay_orientation,delete a.pixabay_image_type,delete a.pixabay_category,delete a.pixabay_api_key,delete a.replicate_api_key,delete a.enable_vector_store,delete a.vector_store_provider,delete a["openai_vector_store_ids[]"],delete a.openai_vector_store_ids,delete a.pinecone_index_name,delete a.qdrant_collection_name,delete a.vector_embedding_provider,delete a.vector_embedding_model,delete a.vector_store_top_k,delete a.rss_include_keywords,delete a.rss_exclude_keywords),a}window.aipkit_save_task_handleContentWriting=g})();(function(){"use strict";function g(a){let n=(window.aipkit_automated_tasks_config||{}).text||{};if(!a.task_name)return n.task_name_required||"Task name is required.";if(!a.task_category)return n.task_category_required||"Task category is required.";if(!a.task_type)return n.task_type_required||"Task type is required.";if(a.task_type==="content_indexing"){if(!a.target_store_id)return n.target_store_required||"A target vector store/index must be selected.";if(!a.post_types||a.post_types.length===0)return n.content_type_required||"Please select content types for indexing.";if(a.target_store_provider==="pinecone"||a.target_store_provider==="qdrant"){if(!a.embedding_provider)return n.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!a.embedding_model)return n.embedding_model_required||"Embedding model is required for this vector provider."}}if(a.task_type.startsWith("content_writing")){let e=a.cw_generation_mode||"bulk";if(e==="bulk"){if(!a.content_title_bulk?.trim())return n.content_title_required_cw_task||"At least one topic is required for Bulk mode."}else if(e==="csv"){if(!a.content_title?.trim())return n.csv_required_cw_task||"Please upload a CSV file."}else{if(e==="rss"&&!a.rss_feeds?.trim())return n.rss_required_cw_task||"Please add at least one RSS feed.";if(e==="url"&&!a.url_list?.trim())return n.url_required_cw_task||"Please add at least one URL.";if(e==="gsheets"){if(!a.gsheets_sheet_id?.trim())return n.gsheets_id_required_cw_task||"Please add a Google Sheet ID.";if(!a.gsheets_credentials?.trim())return n.gsheets_credentials_required_cw_task||"Please add Google Sheets credentials."}else if(e==="single"&&!a.content_title?.trim())return n.content_title_required_cw_task||"Please add a topic."}if(!a.custom_content_prompt?.trim())return"The Content Prompt cannot be empty.";if(!a.ai_provider||!a.ai_model)return n.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}if(a.task_type==="enhance_existing_content"){if(!a.post_types||a.post_types.length===0)return"Please select at least one post type to update.";if(a.update_title!=="1"&&a.update_excerpt!=="1"&&a.update_content!=="1"&&a.update_meta!=="1")return"Please select at least one field to update (Title, Excerpt, Content, or Meta Description)."}return!0}window.aipkit_save_task_validateData=g})();(function(){"use strict";async function g(a){let r=window.aipkit_automated_tasks_config||{},n={...a,_ajax_nonce:r.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",n)}window.aipkit_save_task_submitRequest=g})();(function(){"use strict";function g(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=g})();(function(){"use strict";async function g(a){if(a.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let r=a.target,n=document.getElementById("aipkit_save_task_btn");if(n&&n.dataset.action==="upgrade"){let s=window.aipkit_dashboard?.upgradeUrl;s?window.open(s,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let e=(window.aipkit_automated_tasks_config||{}).text||{},i=e.save_task_button||"Save Task";try{let{formData:s,data:c}=window.aipkit_save_task_extractBaseData(r),t;c.task_type==="content_indexing"?t=window.aipkit_save_task_handleContentIndexing(c,s):c.task_type.startsWith("content_writing")?t=window.aipkit_save_task_handleContentWriting(c,s):c.task_type==="enhance_existing_content"?t=window.aipkit_save_task_handleContentEnhancement(c,s):t=c;let d=window.aipkit_save_task_validateData(t);if(d!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(d,"error"),new Error("Validation failed: "+d);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!0,i,e.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(e.saving_task||"Saving task...","info");let o=await window.aipkit_save_task_submitRequest(t);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(o.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(s){console.error("Save Task Error:",s),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&s.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${s.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,i)}}window.aipkit_form_handleSaveTask=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_automated_task_form"),r=document.getElementById("aipkit_autogpt_task_status_toggle"),n=document.getElementById("aipkit_autogpt_task_status_input"),e=document.getElementById("aipkit_autogpt_task_status_label"),i=document.getElementById("aipkit_autogpt_task_status_card"),s=document.getElementById("aipkit_automated_task_category"),c=document.querySelector("[data-aipkit-autogpt-category-selector]"),t=c?Array.from(c.querySelectorAll(".aipkit_cw_mode_card")):[],d=document.getElementById("aipkit_automated_task_type"),o=document.getElementById("aipkit_cancel_edit_task_btn"),l=document.getElementById("aipkit_automated_task_form_wrapper"),_=document.getElementById("aipkit_automated_task_list_wrapper"),p=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),a&&typeof window.aipkit_form_handleSaveTask=="function"?a.addEventListener("submit",window.aipkit_form_handleSaveTask):a&&console.error("Automated Task Form Init: handleSaveTask function not found."),s&&typeof window.aipkit_form_handleCategoryChange=="function"?s.addEventListener("change",window.aipkit_form_handleCategoryChange):s&&console.error("Automated Task Form Init: handleCategoryChange function not found.");let f=k=>{t.length&&t.forEach(u=>{let w=u.dataset.category===k;u.classList.toggle("is-active",w),u.setAttribute("aria-pressed",w?"true":"false")})};s&&t.length&&(t.forEach(k=>{k.addEventListener("click",()=>{let u=k.dataset.category||"";!u||u===s.value||(s.value=u,s.dispatchEvent(new Event("change",{bubbles:!0})))})}),s.addEventListener("change",()=>{f(s.value)}),f(s.value||"")),d&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(d.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:d})):d&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),o&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?o.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(l,_,p)}):o&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI();let m=()=>{if(!r||!n||!e)return;let k=(n.value||"active")==="active";r.checked=k,e.textContent=k?"Active":"Paused",i&&(i.dataset.status=k?"active":"paused")};window.aipkit_syncTaskStatusToggle=m,r&&n&&e&&(r.dataset.statusListenerAttached||(r.addEventListener("change",()=>{n.value=r.checked?"active":"paused",m()}),r.dataset.statusListenerAttached="true"),m())}window.aipkit_form_initAutomatedTaskForm=g})();(function(){"use strict";let g=!1,a=null,r=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return g},set isSubmitting(e){g=e},get pendingModelSelection(){return a},set pendingModelSelection(e){a=e},get pendingEmbeddingModelSelection(){return r},set pendingEmbeddingModelSelection(e){r=e}};function n(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=n})();(function(){"use strict";function g(a,r){a&&(a.classList.toggle("aipkit_loading",!!r),a.disabled=!!r)}window.aipkit_setAutogptActionButtonLoading=g})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_automated_tasks_tbody"),n=window.aipkit_automated_tasks_config||{},e=n.text||{},i=window.aipkit_escapeHtml||function(o){return o},s=window.aipkit_ucfirst||function(o){return o?o.charAt(0).toUpperCase()+o.slice(1):""},c=n.frequencies||{},t=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(o=>{o.removeAttribute("data-sort-direction"),t&&o.dataset.sortBy===t.sortBy&&o.setAttribute("data-sort-direction",t.sortOrder.toLowerCase())}),!r){console.warn("Render Tasks Table: Table body not found.");return}if(r.innerHTML="",!a||a.length===0){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${e.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}a.forEach(o=>{let l=JSON.parse(o.task_config||"{}"),_=r.insertRow(),p=_.insertCell();p.textContent=i(o.task_name);let f=_.insertCell(),k=(n.task_types?.[o.task_type]||{}).label||s(o.task_type.replace(/_/g," "));f.innerHTML=`<span class="aipkit_task_type_badge" data-type="${i(o.task_type)}">${i(k)}</span>`;let u=l.indexing_frequency||l.task_frequency||"N/A",w=c[u]||s(u.replace(/_/g," "));_.insertCell().textContent=i(w);let h=_.insertCell();h.innerHTML=`<span class="aipkit_job_status_${i(o.status)}">${i(s(o.status))}</span>`;let v=_.insertCell(),C=o.last_run_time?new Date(o.last_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.never_run||"Never",x=o.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(o.next_run_time):o.next_run_time?new Date(o.next_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.not_scheduled||"Not Scheduled";v.innerHTML=`
        <div class="aipkit_task_timing">
          <div class="aipkit_task_timing_last">
            <span class="aipkit_task_timing_label">${e.last_label||"Last"}</span>
            <span class="aipkit_task_timing_value${o.last_run_time?"":" aipkit_never"}">${i(C)}</span>
          </div>
          <div class="aipkit_task_timing_next">
            <span class="aipkit_task_timing_label">${e.next_label||"Next"}</span>
            <span class="aipkit_task_timing_value">${i(x)}</span>
          </div>
        </div>
      `;let b=_.insertCell();b.className="aipkit_actions_cell",b.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="edit" data-task-id="${o.id}" title="${e.edit_button||"Edit"}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${e.edit_button||"Edit"}</span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="${o.status==="active"?"pause":"resume"}" data-task-id="${o.id}" title="${o.status==="active"?e.pause_button||"Pause":e.resume_button||"Resume"}">
            <span class="dashicons ${o.status==="active"?"dashicons-controls-pause":"dashicons-controls-play"}" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${o.status==="active"?e.pause_button||"Pause":e.resume_button||"Resume"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="run_now" data-task-id="${o.id}" ${o.status!=="active"?"disabled":""} title="${o.status!=="active"?e.task_not_active_run_title||"Task must be active to run":e.run_now_button||"Run Now"}">
            <span class="dashicons dashicons-controls-skipforward" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${e.run_now_button||"Run"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete" data-task-id="${o.id}" title="${e.delete_button||"Delete"}">
            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
          </button>
        </div>
      `})}window.aipkit_list_renderTasksTable=g})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_automated_task_list_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render List Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:i,total_pages:s,current_page:c}=a||{};if(!s||s<=1){i>0&&(r.innerHTML=`<span class="aipkit_pagination-count">${Number(i).toLocaleString()} ${Number(i)===1?e.task_singular||"task":e.task_plural||"tasks"}</span>`);return}let t=document.createElement("span");t.className="aipkit_pagination-count",t.textContent=`${Number(i).toLocaleString()} ${Number(i)===1?e.task_singular||"task":e.task_plural||"tasks"}`,r.appendChild(t);let d=document.createElement("span");d.className="aipkit_pagination-links";let o=document.createElement("button");o.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",o.innerHTML=`\xAB ${e.previous_button||"Previous"}`,o.disabled=Number(c)<=1,o.disabled||(o.dataset.page=Number(c)-1),d.appendChild(o);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`${e.page_label||"Page"} ${Number(c)} ${e.of_label||"of"} ${Number(s)}`,d.appendChild(l);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=`${e.next_button||"Next"} \xBB`,_.disabled=Number(c)>=Number(s),_.disabled||(_.dataset.page=Number(c)+1),d.appendChild(_),r.appendChild(d)}window.aipkit_list_renderListPagination=g})();(function(){"use strict";async function g(a=1){let r=document.getElementById("aipkit_automated_tasks_tbody"),n=window.aipkit_automated_tasks_list_state,e=window.aipkit_automated_tasks_config||{},i=e.text||{};if(!r){console.warn("Fetch Tasks: Table body not found.");return}r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${i.loading_tasks||"Loading tasks..."}</td></tr>`,n&&(n.page=a);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let s={page:a,search:n?n.search:"",orderby:n?n.sortBy:"created_at",order:n?n.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},c=await window.aipkit_apiRequest("aipkit_get_automated_tasks",s);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=c.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(c.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(c.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(s){console.error("Fetch Tasks Error:",s),r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${i.error_loading_tasks||"Error loading tasks:"} ${s.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=g})();(function(){"use strict";function g(a){if(!a){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),a):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=g})();(function(){"use strict";async function g(a,r){let n=window.aipkit_automated_tasks_config||{},e=n.text||{},i=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!0,e.delete_button||"Delete",e.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:r,_ajax_nonce:n.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_deleting_task||"Error deleting task:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!1,e.delete_button||"Delete")}},s=e.confirm_delete_task||"Are you sure you want to delete this task?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(s,{title:e.confirm_title||"Confirm",confirmText:e.delete_button||"Delete",cancelText:e.cancel_button||"Cancel",onConfirm:()=>{i()}});return}confirm(s)&&await i()}window.aipkit_handleDeleteTaskAction=g})();(function(){"use strict";async function g(a,r,n){let e=window.aipkit_automated_tasks_config||{},i=e.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(a,!0):(a.classList.add("aipkit_loading"),a.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:r,status:n,_ajax_nonce:e.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${i.task_status_updated||"Task status updated to"} ${n}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(s){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${i.error_updating_status||"Error updating task status:"} ${s.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(a,!1):(a.classList.remove("aipkit_loading"),a.disabled=!1)}}window.aipkit_handleToggleTaskStatusAction=g})();(function(){"use strict";async function g(a,r){let n=window.aipkit_automated_tasks_config||{},e=n.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(a,!0):(a.classList.add("aipkit_loading"),a.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:r,_ajax_nonce:n.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(i){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_initiating_run||"Error initiating task run:"} ${i.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(a,!1):(a.classList.remove("aipkit_loading"),a.disabled=!1)}}window.aipkit_handleRunNowTaskAction=g})();(function(){"use strict";async function g(a){let r=a.target.closest("button[data-action]");if(!r)return;let n=r.dataset.action,e=r.dataset.taskId;if(!e)return;let s=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(c=>c.id.toString()===e.toString());switch(n){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(s);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(r,e);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let c=n==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(r,e,c)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(r,e);break;default:console.warn(`Unknown task action: ${n}`);break}}window.aipkit_list_handleTaskActionClick=g})();(function(){"use strict";function g(a){let r=a.target.closest("button[data-page]");if(r&&!r.disabled){let n=parseInt(r.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(n):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=g})();(function(){"use strict";function g(a,r="info"){if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(a,r);return}let n=document.getElementById("aipkit_automated_task_form_status");n&&(n.textContent=a,n.className=`aipkit_form-help aipkit_settings_message-${r}`,setTimeout(()=>{n.textContent===a&&(n.textContent="",n.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_automated_task_list_wrapper"),r=document.getElementById("aipkit_automated_tasks_tbody"),n=document.getElementById("aipkit_add_new_task_btn"),e=document.getElementById("aipkit_automated_task_form_wrapper"),i=document.getElementById("aipkit_automated_task_list_pagination"),s=document.getElementById("aipkit_task_list_search_input"),c=a?a.querySelector(".aipkit_data-table"):null;if(n&&e&&a&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&n.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(e,a,n)}),r&&typeof window.aipkit_list_handleTaskActionClick=="function"&&r.addEventListener("click",window.aipkit_list_handleTaskActionClick),i&&typeof window.aipkit_list_handleListPaginationClick=="function"&&i.addEventListener("click",window.aipkit_list_handleListPaginationClick),s){let t;s.addEventListener("input",()=>{clearTimeout(t),t=setTimeout(()=>{let d=window.aipkit_automated_tasks_list_state;d&&(d.search=s.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}c&&c.addEventListener("click",t=>{let d=t.target.closest("th.aipkit-sortable-col");if(!d)return;let o=d.dataset.sortBy,l=window.aipkit_automated_tasks_list_state;if(!l)return;let _="DESC";l.sortBy===o&&(_=l.sortOrder==="DESC"?"ASC":"DESC"),l.sortBy=o,l.sortOrder=_,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=g})();(function(){"use strict";let g=[],a=1,r="",n="created_at",e="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...g]},set tasks(s){g=Array.isArray(s)?s:[]},get page(){return a},set page(s){a=s},get search(){return r},set search(s){r=s},get sortBy(){return n},set sortBy(s){n=s},get sortOrder(){return e},set sortOrder(s){e=s}};function i(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=i})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_automated_task_queue_tbody"),n=document.getElementById("aipkit_delete_queue_by_status_btn"),e=window.aipkit_automated_tasks_config||{},i=e.text||{},s=window.aipkit_escapeHtml||function(l){return l},c=window.aipkit_ucfirst||function(l){return l?l.charAt(0).toUpperCase()+l.slice(1):""},t=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(l=>{l.removeAttribute("data-sort-direction"),t&&l.dataset.sortBy===t.sortBy&&l.setAttribute("data-sort-direction",t.sortOrder.toLowerCase())}),!r){console.warn("Render Queue Table: Table body not found.");return}r.innerHTML="";let o=Array.isArray(a)&&a.length>0;if(n&&(n.disabled=!o,n.setAttribute("aria-disabled",o?"false":"true"),o?n.title=i.delete_filtered_title||"Delete filtered items":n.title=i.queue_empty_delete||"No queue items available to delete."),!o){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${i.queue_empty||"Task queue is currently empty."}</td></tr>`;return}a.forEach(l=>{let _=r.insertRow(),p=_.insertCell(),f=document.createElement("textarea");f.innerHTML=l.target_title||`${i.target_id_prefix||"ID:"} ${l.target_identifier}`;let m=f.value,k=l.task_type.startsWith("content_writing"),u=l.task_type==="enhance_existing_content",w=null;k&&l.status==="completed"&&l.generated_post_id?w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${l.generated_post_id}&action=edit`:u&&!isNaN(parseInt(l.target_identifier,10))&&(w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${l.target_identifier}&action=edit`),w?p.innerHTML=`<a href="${w}" target="_blank" title="${s(i.edit_generated_post_title||"View post")}">${s(m)}</a>`:p.textContent=m,_.insertCell().textContent=s(l.task_name||`${i.task_id_prefix||"Task"} ${l.task_id}`);let h=_.insertCell(),v=e.task_types&&e.task_types[l.task_type]?e.task_types[l.task_type].label:c(l.task_type.replace(/_/g," "));h.innerHTML=`<span class="aipkit_task_type_badge" data-type="${s(l.task_type)}">${s(v)}</span>`;let C=_.insertCell(),x=`<span class="aipkit_job_status_${s(l.status)}">${s(c(l.status))}`;l.status==="failed"&&l.attempts>1&&(x+=` <small>(${l.attempts}x)</small>`),x+="</span>",l.status==="failed"&&l.error_message&&(x+=`<span class="aipkit_queue_error_message" title="${s(l.error_message)}">${s(l.error_message)}</span>`),C.innerHTML=x;let b=_.insertCell();if(l.added_at){let q=new Date(l.added_at.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(l.added_at):q,S=`<div class="aipkit_queue_time_entry aipkit_queue_time_added" title="${s(q)}">${s(E)}</div>`;if(l.scheduled_gmt_time){let A=new Date(l.scheduled_gmt_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),T=typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(l.scheduled_gmt_time):A;S+=`<div class="aipkit_queue_time_entry aipkit_queue_time_scheduled" title="${s(A)}">${s(i.scheduled_for_label||"\u2192")} ${s(T)}</div>`}b.innerHTML=S}else b.textContent=i.not_applicable||"\u2014";let I=_.insertCell();I.className="aipkit_actions_cell";let y='<div class="aipkit-table-actions-group">';l.status==="failed"&&(y+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="retry_queue_item" data-item-id="${l.id}" title="${i.retry_button||"Retry"}"><span class="dashicons dashicons-controls-repeat" aria-hidden="true"></span><span class="aipkit_btn_label">${i.retry_button||"Retry"}</span></button>`),y+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete_queue_item" data-item-id="${l.id}" title="${i.delete_button||"Delete"}"><span class="dashicons dashicons-trash" aria-hidden="true"></span></button>`,y+="</div>",I.innerHTML=y})}window.aipkit_queue_renderQueueTable=g})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_automated_task_queue_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render Queue Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:i,total_pages:s,current_page:c}=a||{};if(!i||i<=0)return;let t=document.createElement("span");if(t.className="aipkit_pagination-count",t.textContent=`${Number(i).toLocaleString()} ${Number(i)===1?e.item_singular||"item":e.item_plural||"items"}`,r.appendChild(t),s>1){let d=document.createElement("span");d.className="aipkit_pagination-links";let o=document.createElement("button");o.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",o.innerHTML=`\xAB ${e.previous_button||"Previous"}`,o.disabled=Number(c)<=1,o.disabled||(o.dataset.page=Number(c)-1),d.appendChild(o);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`${e.page_label||"Page"} ${Number(c)} ${e.of_label||"of"} ${Number(s)}`,d.appendChild(l);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=`${e.next_button||"Next"} \xBB`,_.disabled=Number(c)>=Number(s),_.disabled||(_.dataset.page=Number(c)+1),d.appendChild(_),r.appendChild(d)}}window.aipkit_queue_renderQueuePagination=g})();(function(){"use strict";async function g(a=1){let r=window.aipkit_automated_tasks_queue_state;r?r.page=a:console.warn("Fetch/Render Queue: Queue state object not available.");let n=document.getElementById("aipkit_automated_task_queue_tbody"),e=window.aipkit_automated_tasks_config||{},i=e.text||{};if(!n){console.warn("Fetch/Render Queue: Table body not found.");return}n.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${i.loading_queue||"Loading queue items..."}</td></tr>`;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let s={page:a,search:r?r.search:"",status_filter:r?r.status:"all",orderby:r?r.sortBy:"q.added_at",order:r?r.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},c=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",s);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(c.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(c.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(s){console.error("Fetch/Render Queue Error:",s),n.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${i.error_loading_queue||"Error loading queue:"} ${s.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=g})();(function(){"use strict";async function g(a){let r=a.target.closest("button[data-action]");if(!r)return;let n=r.dataset.action,e=r.dataset.itemId;if(!e)return;let i=window.aipkit_automated_tasks_config||{},s=i.text||{},c=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1,t=(d,o)=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(d,o);return}typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(d,o)};if(n==="delete_queue_item"){let d=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,s.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:e,_ajax_nonce:i.nonce_manage_tasks}),t(s.queue_item_deleted||"Queue item deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(c)}catch(l){t(`${s.error_deleting_queue_item||"Error deleting item:"} ${l.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,s.delete_button||"Delete")}},o=s.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(o,{title:s.confirm_title||"Confirm",confirmText:s.delete_button||"Delete",cancelText:s.cancel_button||"Cancel",onConfirm:()=>{d()}});return}if(!confirm(o))return;await d()}else if(n==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,s.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:e,_ajax_nonce:i.nonce_manage_tasks}),t(s.item_marked_retry||"Item marked for retry. Queue processing will pick it up.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(c)}catch(d){t(`${s.error_retrying_item||"Error retrying item:"} ${d.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,s.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=g})();(function(){"use strict";async function g(){let a=document.getElementById("aipkit_delete_queue_by_status_btn"),r=document.getElementById("aipkit_task_queue_status_filter");if(!a||!r){console.error("Delete by status button or filter dropdown not found.");return}let n=r.value,e=r.options[r.selectedIndex].text.toLowerCase(),i=window.aipkit_automated_tasks_config||{},s=i.text||{},c=n==="all"?s.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(s.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",e),t=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(a,!0,s.delete_button||"Delete",s.deleting_task||"Deleting..."):a.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let d=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:n,_ajax_nonce:i.nonce_manage_tasks});typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(d.message||"Queue items deleted.","success"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(d.message||"Queue items deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(d){let o=`${s.errorDeletingAllItems||"Error deleting items:"} ${d.message||"Unknown error"}`;typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(o,"error"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(o,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(a,!1,s.delete_button||"Delete"):a.disabled=!1}};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(c,{title:s.confirm_title||"Confirm",confirmText:s.delete_button||"Delete",cancelText:s.cancel_button||"Cancel",onConfirm:()=>{t()}});return}confirm(c)&&await t()}window.aipkit_handleDeleteQueueByStatus=g})();(function(){"use strict";function g(a){let r=a.target.closest("button[data-page]");if(r&&!r.disabled){let n=parseInt(r.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(n):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_automated_task_queue_tbody"),r=document.getElementById("aipkit_refresh_task_queue_btn"),n=document.getElementById("aipkit_delete_queue_by_status_btn"),e=document.getElementById("aipkit_automated_task_queue_pagination"),i=document.getElementById("aipkit_task_queue_search_input"),s=document.getElementById("aipkit_task_queue_status_filter"),c=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(r&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&r.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),n&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&n.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),i){let t;i.addEventListener("input",()=>{clearTimeout(t),t=setTimeout(()=>{let d=window.aipkit_automated_tasks_queue_state;d&&(d.search=i.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}s&&s.addEventListener("change",()=>{let t=window.aipkit_automated_tasks_queue_state;t&&(t.status=s.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),c&&c.addEventListener("click",t=>{let d=t.target.closest("th.aipkit-sortable-col");if(!d)return;let o=d.dataset.sortBy,l=window.aipkit_automated_tasks_queue_state;if(!l)return;let _="DESC";l.sortBy===o&&(_=l.sortOrder==="DESC"?"ASC":"DESC"),l.sortBy=o,l.sortOrder=_,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),a&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&a.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),e&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&e.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=g})();(function(){"use strict";let g=1,a="",r="all",n="q.added_at",e="DESC";window.aipkit_automated_tasks_queue_state={get page(){return g},set page(s){g=s},get search(){return a},set search(s){a=s},get status(){return r},set status(s){r=s},get sortBy(){return n},set sortBy(s){n=s},get sortOrder(){return e},set sortOrder(s){e=s}};function i(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=i})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_autogpt_container");if(a&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():a&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),(()=>{if(!a)return;let n=a.querySelector("#aipkit_autogpt_cron_status [data-aipkit-cron-timestamp]");if(!n)return;let e=n.dataset.aipkitCronTimestamp,i=e?parseInt(e,10):0;if(!i||Number.isNaN(i))return;let s=new Date(i*1e3),c=s.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});n.textContent=c,n.title=s.toLocaleString()})(),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(n){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",n)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(n){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",n)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(n){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",n)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(n){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",n)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.");if(typeof window.aipkit_initAutogptPopovers=="function")try{window.aipkit_initAutogptPopovers(a)}catch(n){console.error("AIPKit AutoGPT: Error initializing settings popovers:",n)}if(typeof window.aipkit_updateAutogptAiSummaries=="function")try{window.aipkit_updateAutogptAiSummaries(a)}catch(n){console.error("AIPKit AutoGPT: Error updating AI summaries:",n)}if(typeof window.aipkit_initAutogptAiSettingsRedesigned=="function")try{window.aipkit_initAutogptAiSettingsRedesigned(a)}catch(n){console.error("AIPKit AutoGPT: Error initializing AI settings UI:",n)}if(typeof window.aipkit_initAutogptPromptFlyouts=="function")try{window.aipkit_initAutogptPromptFlyouts(a)}catch(n){console.error("AIPKit AutoGPT: Error initializing prompt flyouts:",n)}typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_autogpt_container"):console.warn("AIPKit AutoGPT: aipkit_initApiKeyToggles not found.")}window.aipkit_initAutogpt=g})();(function(){"use strict";let g=null;function a(c,t="",d=0){let o=document.getElementById("aipkit_content_writer_form_status");if(!o)return;g&&(clearTimeout(g),g=null);let l="aipkit_cw_status_badge",_=(p="")=>{o.className=p?`${l} ${p}`:l};switch(_(),c){case"progress":o.textContent=t,_("aipkit_settings_message-info");break;case"info":o.textContent=t,_("aipkit_settings_message-info");break;case"success":o.textContent=t,_("aipkit_settings_message-success");break;case"error":o.textContent=t,_("aipkit_settings_message-error");break;case"clear":default:o.textContent="",_();return}d&&(g=setTimeout(()=>{o.textContent===t&&r()},d))}function r(){a("clear")}function n(c){a("progress",c)}function e(c,t=3e3){a("info",c,t)}function i(c){a("success",c,3e3)}function s(c){a("error",c)}window.aipkit_updateGeneralStatus=a,window.aipkit_clearGeneralStatus=r,window.aipkit_showProgress=n,window.aipkit_showInfo=e,window.aipkit_showSuccess=i,window.aipkit_showError=s})();(function(){"use strict";window.aipkit_cw_isAutosaving=!1,window.aipkit_cw_lastSavedData=null;function g(){let e=window.aipkit_cw_template_state,i=e?.currentTemplateId;if(!i)return null;let s="";if(Array.isArray(e?.currentTemplates)){let t=e.currentTemplates.find(d=>String(d.id)===String(i));t?.template_name&&(s=t.template_name)}if(!s){let t=document.getElementById("aipkit_cw_template_select");t?.selectedOptions?.length&&(s=t.selectedOptions[0].textContent.trim())}let c=parseInt(i,10);return!s||Number.isNaN(c)?null:{id:c,name:s}}function a(){if(typeof window.aipkit_getContentWriterFormConfig!="function")return null;let e=document.getElementById("aipkit_content_writer_form");return e?window.aipkit_getContentWriterFormConfig(e):null}async function r(){if(window.aipkit_cw_autosave_suspended||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getContentWriterFormConfig!="function"||window.aipkit_cw_isAutosaving)return;let e=window.aipkit_cw_template_state;if(e?.isSavingOrDeleting)return;let i=a();if(!i)return;let s=window.aipkit_cw_lastSavedData||{};if(JSON.stringify(i)===JSON.stringify(s))return;let c=g();if(!c)return;let t=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,d=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,o=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_isAutosaving=!0,t&&t("Saving...");try{let l=document.getElementById("aipkit_content_writer_template_nonce_field");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:c.id,template_name:c.name,template_type:"content_writer",config:JSON.stringify(i),_ajax_nonce:l?l.value:""}),window.aipkit_cw_lastSavedData=i,e&&(e.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(i)),e.currentTemplateModified=!1),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(String(c.id)),d&&d("Updated")}catch(l){o&&o(`Error: ${l.message||"Failed to save."}`),console.error("Content Writer Auto-Save Error:",l)}finally{window.aipkit_cw_isAutosaving=!1}}function n(){let e=a();e&&(window.aipkit_cw_lastSavedData=e)}window.aipkit_handleContentWriterAutoSave=r,window.aipkit_updateContentWriterAutosaveBaseline=n})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_content_writer_form");if(!a)return;let r="data-aipkit-cw-autosave-attached";a.getAttribute(r)||(a.addEventListener("change",n=>{let e=n.target;if(!e||!e.matches(".aipkit_autosave_trigger"))return;(e.tagName.toLowerCase()==="select"||e.type==="checkbox"||e.type==="range")&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()}),a.addEventListener("blur",n=>{let e=n.target;if(!e||!e.matches(".aipkit_autosave_trigger"))return;let i=e.tagName.toLowerCase();(i==="input"||i==="textarea")&&e.type!=="range"&&e.type!=="checkbox"&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()},!0),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline(),a.setAttribute(r,"true"))}window.aipkit_initContentWriterAutosave=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.warn("Content Writer Accordions: Main container not found.");return}a.dataset.accordionListenerAttached!=="true"&&(a.addEventListener("click",function(r){let n=r.target.closest(".aipkit_accordion-header");if(!n)return;let e=n.closest(".aipkit_accordion");if(!e)return;let i=n.nextElementSibling;if(!i||!i.classList.contains("aipkit_accordion-content"))return;let s=e.closest(".aipkit_accordion-group");if(s&&!n.classList.contains("aipkit_active")){let c=s.querySelector(".aipkit_accordion-header.aipkit_active");if(c){c.classList.remove("aipkit_active");let t=c.nextElementSibling;t&&t.classList.remove("aipkit_active")}}n.classList.toggle("aipkit_active"),i.classList.toggle("aipkit_active")}),a.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(c){return c},a=null,r={title:"Title",content:"Content",image:"Image",meta:"Meta",keyword:"Keyword",tags:"Tags",excerpt:"Excerpt"},n=null;function e(c,t=""){if(a||(a=document.getElementById("aipkit_content_writer_form_status")),!a)return;n&&(clearTimeout(n),n=null),a.textContent=c;let d="aipkit_cw_status_badge";a.className=t?`${d} ${t}`:d}function i(c,t,d=""){let o=r[c]||"Step",l=d?g(d):"";switch(t){case"pending":break;case"generating":e(l||`Generating ${o}...`,"aipkit_settings_message-info");break;case"success":e(`${o} complete`,"aipkit_settings_message-success"),n=setTimeout(()=>{e("")},1400);break;case"error":e(`Error ${o}${l?": "+l:""}`,"aipkit_settings_message-error");break;case"skipped":l&&(e(`${o} skipped: ${l}`,"aipkit_settings_message-info"),n=setTimeout(()=>{e("")},1400));break}let _=document.getElementById(`aipkit_cw_status_${c}_generation`),p=_?_.querySelector(".aipkit_cw_status_icon"):null,f=_?_.querySelector(".status-text"):null;if(!(!_||!p||!f))switch(_.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),_.classList.add(`status-${t}`),t){case"pending":{f.textContent="Pending";let m="dashicons-text-page";c==="content"&&(m="dashicons-admin-post"),c==="image"&&(m="dashicons-format-image"),c==="excerpt"&&(m="dashicons-editor-quote"),c==="tags"&&(m="dashicons-tag"),c==="meta"&&(m="dashicons-search"),c==="keyword"&&(m="dashicons-flag"),p.className=`dashicons ${m} aipkit_cw_status_icon`;break}case"generating":f.textContent=l||"Generating...",p.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":f.textContent="Complete",p.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":f.textContent=`Error ${l?": "+l:""}`,p.className="dashicons dashicons-warning aipkit_cw_status_icon";break;case"skipped":f.textContent="Skipped",p.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function s(){e(""),["title","content","image","meta","keyword","excerpt","tags"].forEach(c=>{i(c,"pending")})}window.aipkit_updateCwGenerationStatus=i,window.aipkit_resetAllGenerationStatuses=s})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_content_writer_form_status");a&&(a.textContent="",a.className="aipkit_cw_status_badge"),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending"))}window.aipkit_resetGenerationStatusIndicators=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(l){return l},a=window.aipkit_escapeHtml||function(l){return l},r=(l,_)=>(l?.elements?.[_]?.value||"").trim(),n=l=>String(l||"").split(/\r?\n/).map(_=>_.trim()).filter(Boolean),e=l=>l.map(_=>_.split("|")[0].trim()).filter(Boolean),i=l=>{try{let _=new URL(l);return _.protocol==="http:"||_.protocol==="https:"}catch{return!1}},s=l=>{let _=l?.querySelector(".aipkit_gsheets_indicator");return _?_.classList.contains("aipkit_gsheets_indicator--success"):!0};function c(l,_){l&&(l.textContent=_||g("Please review your input.","gpt3-ai-content-generator"),l.id==="aipkit_cw_action_validation"?l.className="aipkit_cw_action_validation":l.className="aipkit_cw_status_badge aipkit_settings_message-error")}function t(l){l&&(l.textContent="",l.id==="aipkit_cw_action_validation"?l.className="aipkit_cw_action_validation":l.className="aipkit_cw_status_badge")}function d(l,_){let p=_||document.getElementById("aipkit_cw_mode_select")?.value||"task";if(p==="single"&&(p="task"),p==="task")return e(n(r(l,"content_title_bulk"))).length?{isValid:!0}:{isValid:!1,message:g("Please enter at least one topic.","gpt3-ai-content-generator")};if(p==="csv"){let f=document.getElementById("aipkit_cw_csv_data_holder");return(f?f.value.trim():"")?{isValid:!0}:{isValid:!1,message:g("Please upload and parse a CSV file first.","gpt3-ai-content-generator")}}if(p==="rss")return n(r(l,"rss_feeds")).filter(i).length?{isValid:!0}:{isValid:!1,message:g("Please enter at least one valid RSS feed URL.","gpt3-ai-content-generator")};if(p==="url")return n(r(l,"url_list")).filter(i).length?{isValid:!0}:{isValid:!1,message:g("Please enter at least one valid website URL.","gpt3-ai-content-generator")};if(p==="gsheets"){let f=r(l,"gsheets_sheet_id"),m=r(l,"gsheets_credentials");return!f||!m?{isValid:!1,message:g("Please provide a Google Sheet ID and credentials.","gpt3-ai-content-generator")}:s(l)?{isValid:!0}:{isValid:!1,message:g("Verify access before generating.","gpt3-ai-content-generator")}}return{isValid:!0}}async function o(l,_,p){let f=new FormData(l),m=Object.fromEntries(f.entries()),k=l.elements["openai_vector_store_ids[]"];m.openai_vector_store_ids=k?Array.from(k.selectedOptions).map(I=>I.value):[],delete m["openai_vector_store_ids[]"];let u=window.aipkit_dashboard?.text||{},w=document.getElementById("aipkit_cw_mode_select"),h=w?w.value:"task";h==="single"&&(h="task"),m.cw_generation_mode=h;let v=document.getElementById("aipkit_cw_action_validation"),C=d(l,h);if(!C.isValid){let I=p||v;c(I,C.message),I!==v&&t(v);return}if(t(p),t(v),h==="csv"){let I=document.getElementById("aipkit_cw_csv_data_holder");m.content_title=I?I.value:""}else h==="url"?(m.url_list=l.elements.url_list?.value||"",m.content_title=m.url_list):h==="task"&&(m.content_title=l.elements.content_title_bulk?l.elements.content_title_bulk.value:"");delete m.content_title_bulk,delete m.content_title_csv;let x=document.getElementById("aipkit_cw_template_select"),b="";if(x&&x.selectedIndex>0){let I=x.options[x.selectedIndex];I&&(b=I.text)}if(b&&b.trim()!=="")m.task_name=b.trim();else{let I=(m.content_title||m.rss_feeds||m.gsheets_sheet_id||m.url_list||"").split(`
`)[0].trim();m.task_name=I||"Automated Content Writing Task"}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(_,!0,"Create Task","Creating Task..."):(_.disabled=!0,_.textContent="Creating Task..."),p&&(p.textContent="Creating automated task...",p.className="aipkit_cw_status_badge aipkit_settings_message-info");try{let I=document.getElementById("aipkit_content_writer_nonce");if(m._ajax_nonce=I?I.value:"",!m._ajax_nonce)throw new Error("Security token missing for task creation.");let y=await window.aipkit_apiRequest("aipkit_content_writer_create_task",m);p&&(p.textContent="",p.className="aipkit_cw_status_badge"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("autogpt")}catch(I){console.error("Content Writer Create Task Error:",I),p&&(p.textContent=`Error creating task: ${a(I.message||"Unknown error")}`,p.className="aipkit_cw_status_badge aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(_,!1,"Create Task"):(_.disabled=!1,_.textContent="Create Task")}}window.aipkit_createContentWriterTask=o,window.aipkit_validateContentWriterInputs=d,window.aipkit_showContentWriterValidationError=c,window.aipkit_clearContentWriterValidationMessage=t})();(function(){"use strict";let g=()=>{let p=document.getElementById("aipkit_cw_mode_select"),f=p?p.value:"task";return f==="single"?"task":f},a=()=>{let p=g();return p==="task"||p==="csv"},r=p=>{!p?.frequencySelect||!p.frequencySelect.querySelector('option[value="one-time"]')||p.frequencySelect.value!=="one-time"&&(p.frequencySelect.value="one-time",p.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})))},n=()=>{let p=document.getElementById("aipkit_content_writer_container");if(!p)return null;let f=p.querySelector(".aipkit_cw_generate_split");if(!f)return null;let m=f.querySelector("#aipkit_content_writer_generate_btn"),k=f.querySelector(".aipkit_cw_generate_toggle"),u=f.querySelector(".aipkit_cw_generate_menu"),w=u?u.querySelector('[data-menu-panel="actions"]'):null,h=u?u.querySelector('[data-menu-panel="intervals"]'):null,v=w?Array.from(w.querySelectorAll("[data-action]")):[],C=h?Array.from(h.querySelectorAll("[data-interval]")):[],x=h?h.querySelector("[data-menu-back]"):null,b=p.querySelector("#aipkit_cw_task_frequency");return{container:p,split:f,generateBtn:m,toggleBtn:k,menu:u,menuActions:w,menuIntervals:h,actionItems:v,intervalItems:C,backBtn:x,frequencySelect:b}},e=p=>{!p?.menu||!p?.toggleBtn||(p.menu.hidden=!0,p.toggleBtn.setAttribute("aria-expanded","false"))},i=p=>{if(!p?.menu||!p?.split)return;let f=p.menu,m=p.split.getBoundingClientRect(),k=window.innerWidth,u=12;f.style.position="fixed",f.style.right="auto",f.style.bottom="auto",f.style.zIndex="100000",f.style.visibility="hidden";let w=f.getBoundingClientRect(),h=m.right-w.width;h=Math.max(u,Math.min(h,k-w.width-u));let v=m.bottom+6;f.style.left=`${Math.round(h)}px`,f.style.top=`${Math.round(v)}px`,f.style.visibility="visible"},s=p=>{!p?.menu||!p?.toggleBtn||(p.menu.hidden=!1,i(p),p.toggleBtn.setAttribute("aria-expanded","true"))},c=(p,f)=>{if(!p?.menuActions||!p?.menuIntervals)return;let m=f==="intervals";p.menuActions.hidden=m,p.menuIntervals.hidden=!m},t=(p,f)=>{p&&(p.split.dataset.aipkitCwAction=f||"generate",p.actionItems.forEach(m=>{let k=m.dataset.action===f;m.classList.toggle("is-active",k),m.setAttribute("aria-checked",k?"true":"false")}))},d=p=>{if(!p?.frequencySelect)return;let f=p.frequencySelect.value||p.frequencySelect.options[0]?.value||"";p.intervalItems.forEach(m=>{let k=m.dataset.interval===f;m.classList.toggle("is-active",k),m.setAttribute("aria-checked",k?"true":"false")})},o=(p,f)=>{p?.frequencySelect&&(p.frequencySelect.value=f,p.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})),d(p),e(p),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState())},l=p=>{let f=n();if(!f)return;let m=p||"generate",k=m==="create_task"&&a();if(k&&r(f),t(f,m),typeof window.aipkit_updateContentWriterActionState=="function"&&(f.menu&&m==="create_task"&&!k&&(f.menu.dataset.keepOpen="true"),window.aipkit_updateContentWriterActionState()),m==="create_task"&&f.menuIntervals&&!k){c(f,"intervals"),d(f),s(f);return}c(f,"actions"),e(f),k&&m==="create_task"&&f.generateBtn&&setTimeout(()=>{f.generateBtn.click()},0)},_=()=>{let p=n();p&&p.split.dataset.listenerAttached!=="true"&&(p.split.dataset.aipkitCwAction||(p.split.dataset.aipkitCwAction="generate"),t(p,p.split.dataset.aipkitCwAction),d(p),p.toggleBtn&&p.toggleBtn.addEventListener("click",f=>{if(f.preventDefault(),p.toggleBtn.disabled)return;(p.split.dataset.aipkitCwAction||"generate")==="create_task"&&!a()?(c(p,"intervals"),d(p)):c(p,"actions"),p.menu&&p.menu.hidden?s(p):e(p)}),p.actionItems.forEach(f=>{f.addEventListener("click",m=>{m.preventDefault(),!f.disabled&&l(f.dataset.action||"generate")})}),p.intervalItems.forEach(f=>{f.addEventListener("click",m=>{m.preventDefault(),!f.disabled&&o(p,f.dataset.interval||"")})}),p.backBtn&&p.backBtn.addEventListener("click",f=>{f.preventDefault(),c(p,"actions"),s(p)}),document.addEventListener("click",f=>{let m=f.target;!p.menu||p.menu.hidden||p.split.contains(m)||e(p)}),document.addEventListener("keydown",f=>{f.key==="Escape"&&(!p.menu||p.menu.hidden||e(p))}),p.split.dataset.listenerAttached="true")};window.aipkit_initContentWriterGenerateMenu=_,window.aipkit_setCwGenerateAction=l,window.aipkit_getCwGenerateAction=()=>n()?.split?.dataset.aipkitCwAction||"generate"})();(function(){"use strict";let g=window.wp?.i18n?.__||function(L){return L},a=100,r=[{key:"write",label:g("Writing","gpt3-ai-content-generator"),steps:["title","content"],isEnabled:()=>!0},{key:"optimize",label:g("Optimizing","gpt3-ai-content-generator"),steps:["meta","focus","excerpt","tags"],isEnabled:L=>L.generateMeta||L.generateFocus||L.generateExcerpt||L.generateTags},{key:"publish",label:g("Publishing","gpt3-ai-content-generator"),steps:["image","featured","save"],isEnabled:()=>!0}],n={waiting:g("Waiting","gpt3-ai-content-generator"),running:g("Running","gpt3-ai-content-generator"),done:g("Done","gpt3-ai-content-generator"),skipped:g("Skipped","gpt3-ai-content-generator"),error:g("Error","gpt3-ai-content-generator")},e=[{key:"title",label:g("Title","gpt3-ai-content-generator"),isEnabled:L=>!!L.customTitlePrompt},{key:"content",label:g("Content","gpt3-ai-content-generator"),isEnabled:()=>!0},{key:"meta",label:g("Meta","gpt3-ai-content-generator"),isEnabled:L=>L.generateMeta},{key:"focus",label:g("Focus","gpt3-ai-content-generator"),isEnabled:L=>L.generateFocus},{key:"excerpt",label:g("Excerpt","gpt3-ai-content-generator"),isEnabled:L=>L.generateExcerpt},{key:"tags",label:g("Tags","gpt3-ai-content-generator"),isEnabled:L=>L.generateTags},{key:"image",label:g("Image","gpt3-ai-content-generator"),isEnabled:L=>L.generateImages},{key:"featured",label:g("Featured","gpt3-ai-content-generator"),isEnabled:L=>L.generateFeatured},{key:"save",label:g("Save","gpt3-ai-content-generator"),isEnabled:()=>!0}],i={active:!1,stopRequested:!1,items:[],rows:[],totals:{processed:0,completed:0,failed:0}},s=(L,K)=>({customTitlePrompt:String(L.custom_title_prompt||"").trim(),generateMeta:L.generate_meta_description==="1",generateFocus:L.generate_focus_keyword==="1",generateExcerpt:L.generate_excerpt==="1",generateTags:L.generate_tags==="1",generateImages:K.generate_images_enabled==="1",generateFeatured:K.generate_featured_image==="1"}),c=L=>{let K={};return e.forEach(H=>{K[H.key]=H.isEnabled(L)?"waiting":"skipped"}),K},t=(L,K)=>{let H=document.createElement("span");H.className=`aipkit_cw_batch_step aipkit_cw_batch_step--${K}`,H.dataset.step=L.key,H.dataset.status=K;let ne=document.createElement("span");ne.className="aipkit_cw_batch_step_label",ne.textContent=L.label;let ae=document.createElement("span");return ae.className="aipkit_cw_batch_step_status",ae.textContent=n[K]||K,H.appendChild(ne),H.appendChild(ae),{wrapper:H,status:ae}},d=(L,K,H)=>{v(L,K,H)},o=L=>{L?.phases&&Object.keys(L.phases).forEach(K=>{let H=L.phases[K],ne=H.dataset.status;ne==="done"||ne==="skipped"||(H.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",H.dataset.status="error")})},l=()=>{let L=document.getElementById("aipkit_content_writer_container");if(!L)return null;let K=L.querySelector("#aipkit_cw_batch_queue"),H=K?K.querySelector(".aipkit_cw_batch_list"):null,ne=K?K.querySelector(".aipkit_cw_batch_count"):null,ae=K?K.querySelector(".aipkit_cw_batch_progress"):null,Z=K?K.querySelector(".aipkit_cw_batch_progress_bar"):null,pe=L.querySelector("#aipkit_content_writer_form_status"),ve=L.querySelector("#aipkit_content_writer_generate_btn"),De=L.querySelector(".aipkit_cw_generate_toggle"),Qe=L.querySelector(".aipkit_cw_generate_menu"),$e=Qe?Array.from(Qe.querySelectorAll(".aipkit_cw_generate_menu_item")):[],lt=L.querySelector("#aipkit_content_writer_stop_btn");return{container:L,queue:K,list:H,count:ne,progress:ae,progressBar:Z,status:pe,generateBtn:ve,generateToggle:De,generateMenu:Qe,generateMenuItems:$e,stopBtn:lt}},_=()=>{i.totals.processed=0,i.totals.completed=0,i.totals.failed=0},p=()=>{let L=l();if(!L||!L.count||!L.progressBar||!L.progress)return;let K=i.items.length,H=i.totals.completed;L.count.textContent=`${H}/${K}`;let ne=K>0?Math.round(H/K*100):0;L.progressBar.style.width=`${ne}%`,L.progress.setAttribute("aria-valuenow",String(ne))},f=(L,K)=>{let H=l();!H||!H.status||(H.status.textContent=L||"",H.status.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),K&&H.status.classList.add(`aipkit_settings_message-${K}`))},m=()=>{let L=l();!L||!L.list||(L.list.innerHTML="",i.rows=[],i.items=[],_(),p())},k=()=>{let L=l();L?.queue&&(L.queue.hidden=!1)},u=()=>{let L=l();L?.queue&&(L.queue.hidden=!0)},w=(L,K)=>{let H=document.createElement("div");H.className="aipkit_cw_batch_row";let ne=document.createElement("div");ne.className="aipkit_cw_batch_row_content";let ae=document.createElement("span");ae.className="aipkit_cw_batch_topic",ae.textContent=L.topic||"";let Z=document.createElement("div");Z.className="aipkit_cw_batch_phases";let pe={},ve=c(K),De={};r.forEach(we=>{let at=we.steps.some($t=>{let li=e.find(ai=>ai.key===$t);return li&&li.isEnabled(K)});if(!we.isEnabled(K)&&!at)return;let Zt=document.createElement("span");Zt.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--waiting",Zt.dataset.phase=we.key,Zt.dataset.status="waiting",Zt.setAttribute("title",we.label),Zt.setAttribute("aria-label",we.label),Z.appendChild(Zt),pe[we.key]=Zt,we.steps.forEach($t=>{De[$t]={wrapper:Zt,phaseKey:we.key,status:{textContent:""}}})});let Qe=document.createElement("span");Qe.className="aipkit_cw_batch_status aipkit_cw_batch_status--waiting",Qe.textContent=g("Waiting","gpt3-ai-content-generator");let $e=document.createElement("span");$e.className="aipkit_cw_batch_error",$e.hidden=!0;let lt=document.createElement("a");lt.className="aipkit_cw_batch_view",lt.textContent=g("View","gpt3-ai-content-generator"),lt.target="_blank",lt.rel="noopener noreferrer",lt.hidden=!0;let it=document.createElement("span");return it.className="aipkit_cw_batch_summary_text",ne.appendChild(ae),ne.appendChild(Z),ne.appendChild(Qe),ne.appendChild($e),ne.appendChild(lt),H.appendChild(ne),{row:H,topic:ae,summary:it,status:Qe,error:$e,view:lt,phases:pe,steps:De}},h=L=>{let K=e.find(H=>H.key===L);return K?K.label:L},v=(L,K,H)=>{if(!L?.phases)return;let ne=r.find(Z=>Z.steps.includes(K));if(!ne)return;let ae=L.phases[ne.key];ae&&(H==="running"?(ae.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--running",ae.dataset.status="running",L.status&&(L.status.textContent=`${ne.label} \xB7 ${h(K)}`)):H==="done"?(ae.dataset.status==="running"||K===ne.steps[ne.steps.length-1])&&(ae.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",ae.dataset.status="done"):H==="error"&&(ae.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",ae.dataset.status="error"))},C=(L,K)=>{let H=l();!H||!H.list||(H.list.innerHTML="",i.rows=L.map(ne=>{let ae=w(ne,K);return H.list.appendChild(ae.row),ae}))},x=(L,K,H={})=>{if(!L)return;L.row.classList.toggle("is-active",K==="running"),L.status.className=`aipkit_cw_batch_status aipkit_cw_batch_status--${K}`;let ne={waiting:g("Waiting","gpt3-ai-content-generator"),running:g("Generating","gpt3-ai-content-generator"),success:g("Done","gpt3-ai-content-generator"),error:g("Failed","gpt3-ai-content-generator"),stopped:g("Stopped","gpt3-ai-content-generator")};if(L.status.textContent=ne[K]||K,L.error&&(L.error.hidden=!0,L.error.textContent="",L.error.removeAttribute("title")),K==="success"&&L.phases&&Object.keys(L.phases).forEach(ae=>{let Z=L.phases[ae];Z.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",Z.dataset.status="done"}),H.summary!==void 0&&(L.summary.textContent=H.summary||""),H.viewLink?(L.view.href=H.viewLink,L.view.hidden=!1):K!=="success"&&(L.view.hidden=!0),K==="error"&&L.error){let ae=I(H.summary);ae&&(L.error.textContent=ae,L.error.title=b(H.summary),L.error.hidden=!1)}},b=L=>String(L||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),I=L=>{let K=b(L);return K?K.length>140?`${K.slice(0,137)}\u2026`:K:""},y=(L,K)=>{let H=b(K||L);return H?H.length>140?`${H.slice(0,140)}\u2026`:H:""},q=L=>{let K=new FormData(L),H=Object.fromEntries(K.entries()),ne=L.elements["openai_vector_store_ids[]"];H.openai_vector_store_ids=ne?Array.from(ne.selectedOptions).map(Z=>Z.value):[],delete H["openai_vector_store_ids[]"];let ae=document.getElementById("aipkit_content_writer_nonce");return ae&&ae.value&&(H._ajax_nonce=ae.value),H},E=L=>{let K=L.elements["post_categories[]"],H=K?Array.from(K.selectedOptions).map(ae=>ae.value):[],ne=L.querySelector('input[name="schedule_mode"]:checked')?.value||"immediate";return{ai_provider:L.elements.ai_provider?.value||"",ai_model:L.elements.ai_model?.value||"",ai_temperature:L.elements.ai_temperature?.value||"",reasoning_effort:L.elements.reasoning_effort?.value||"",cw_generation_mode:L.elements.cw_generation_mode?.value||"",post_type:L.elements.post_type?.value||"post",post_author:L.elements.post_author?.value||"",post_status:L.elements.post_status?.value||"draft",post_schedule_date:L.elements.post_schedule_date?.value||"",post_schedule_time:L.elements.post_schedule_time?.value||"",schedule_mode:ne,smart_schedule_start_datetime:L.elements.smart_schedule_start_datetime?.value||"",smart_schedule_interval_value:L.elements.smart_schedule_interval_value?.value||"",smart_schedule_interval_unit:L.elements.smart_schedule_interval_unit?.value||"",post_categories:H,generate_toc:L.elements.generate_toc?.checked?"1":"0",generate_seo_slug:L.elements.generate_seo_slug?.checked?"1":"0",generate_images_enabled:L.elements.generate_images_enabled?.checked?"1":"0",generate_featured_image:L.elements.generate_featured_image?.checked?"1":"0",image_provider:L.elements.image_provider?.value||"",image_model:L.elements.image_model?.value||"",image_prompt:L.elements.image_prompt?.value||"",featured_image_prompt:L.elements.featured_image_prompt?.value||"",image_count:L.elements.image_count?.value||"1",image_placement:L.elements.image_placement?.value||"after_first_h2",image_placement_param_x:L.elements.image_placement_param_x?.value||"",image_alignment:L.elements.image_alignment?.value||"none",image_size:L.elements.image_size?.value||"large",pexels_orientation:L.elements.pexels_orientation?.value||"",pexels_size:L.elements.pexels_size?.value||"",pexels_color:L.elements.pexels_color?.value||"",pixabay_orientation:L.elements.pixabay_orientation?.value||"",pixabay_image_type:L.elements.pixabay_image_type?.value||"",pixabay_category:L.elements.pixabay_category?.value||"",generate_image_title:L.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:L.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:L.elements.generate_image_caption?.checked?"1":"0",generate_image_description:L.elements.generate_image_description?.checked?"1":"0",image_title_prompt:L.elements.image_title_prompt?.value||"",image_alt_text_prompt:L.elements.image_alt_text_prompt?.value||"",image_caption_prompt:L.elements.image_caption_prompt?.value||"",image_description_prompt:L.elements.image_description_prompt?.value||""}},S=(L,K)=>{let H=K.content_title||K.topic||"",ne=K.inline_keywords||K.keywords||"",ae=ne?`${H} | ${ne}`:H,Z={...L,content_title:ae};return K.rss_description&&(Z.rss_description=K.rss_description),K.source_url&&(Z.source_url=K.source_url),K.url_content_context&&(Z.url_content_context=K.url_content_context),{data:Z,topic:H,keywords:ne}},A=(L,K,H,ne,ae,Z,pe)=>({original_topic:K,final_title:H,post_title:H,keywords:ne,excerpt:ae||"",image_provider:L.image_provider,image_model:L.image_model,image_prompt:L.image_prompt,image_alignment:L.image_alignment,image_size:L.image_size,featured_image_prompt:L.featured_image_prompt,pexels_orientation:L.pexels_orientation,pexels_size:L.pexels_size,pexels_color:L.pexels_color,pixabay_orientation:L.pixabay_orientation,pixabay_image_type:L.pixabay_image_type,pixabay_category:L.pixabay_category,generate_image_title:L.generate_image_title,generate_image_alt_text:L.generate_image_alt_text,generate_image_caption:L.generate_image_caption,generate_image_description:L.generate_image_description,image_title_prompt:L.image_title_prompt,image_alt_text_prompt:L.image_alt_text_prompt,image_caption_prompt:L.image_caption_prompt,image_description_prompt:L.image_description_prompt,ai_provider:L.ai_provider,ai_model:L.ai_model,ai_temperature:L.ai_temperature,reasoning_effort:L.reasoning_effort,cw_generation_mode:L.cw_generation_mode,_ajax_nonce:Z,generate_images_enabled:L.generate_images_enabled,image_count:L.image_count,generate_featured_image:L.generate_featured_image,image_placement:L.image_placement,image_placement_param_x:L.image_placement_param_x,conversation_uuid:pe}),T=(L,K,H,ne,ae,Z,pe)=>{let ve=window.aipkit_getMarkdownRenderer?window.aipkit_getMarkdownRenderer():null,De=ve?ve.render(ne):ne,Qe=Array.isArray(K.post_categories)&&K.post_categories.length?K.post_categories:L.post_categories;return{post_title:H,post_content:De,generated_excerpt:ae.excerpt||"",generated_tags:ae.tags||"",meta_description:ae.meta_description||"",focus_keyword:ae.focus_keyword||"",post_type:K.post_type||L.post_type,post_author:K.post_author||L.post_author,post_status:L.post_status,post_schedule_date:K.post_schedule_date||L.post_schedule_date,post_schedule_time:K.post_schedule_time||L.post_schedule_time,post_categories:Qe,generate_toc:L.generate_toc,generate_seo_slug:L.generate_seo_slug,image_data:Z?JSON.stringify(Z):"",image_alignment:L.image_alignment,image_size:L.image_size,_ajax_nonce:pe}},M=async(L,K,H,ne,ae)=>{let Z=L.item_config||{},{data:pe,topic:ve,keywords:De}=S(K,Z),Qe=ve,$e=pe.conversation_uuid||void 0;if(!!String(pe.custom_title_prompt||"").trim()){d(ne,"title","running");let ai=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",{...pe,conversation_uuid:$e});if(!ai?.new_title)throw new Error(g("Title generation failed","gpt3-ai-content-generator"));Qe=ai.new_title,$e=ai.conversation_uuid||$e,d(ne,"title","done")}else d(ne,"title","skipped");d(ne,"content","running");let we=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",{...pe,conversation_uuid:$e});if(!we?.content)throw new Error(g("Content generation failed","gpt3-ai-content-generator"));d(ne,"content","done"),$e=we.conversation_uuid||$e||void 0,d(ne,"meta",ae.generateMeta?"done":"skipped"),d(ne,"focus",ae.generateFocus?"done":"skipped"),d(ne,"excerpt",ae.generateExcerpt?"done":"skipped"),d(ne,"tags",ae.generateTags?"done":"skipped");let at=null;if(H.generate_images_enabled==="1"||H.generate_featured_image==="1"){ae.generateImages&&d(ne,"image","running"),ae.generateFeatured&&d(ne,"featured","running");let ai=we.focus_keyword||De||K.content_keywords||"",se=A(H,ve,Qe,ai,we.excerpt||"",K._ajax_nonce,$e),ke=H.generate_images_enabled==="1",_e=H.generate_featured_image==="1",Ce=ke&&_e,Pe=async(be={})=>{let Oe=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...se,...be});if(!Oe?.image_data)throw new Error(g("Image generation failed","gpt3-ai-content-generator"));return Oe.image_data};if(Ce){let be=null,Oe=Re=>{be||(be={...Re,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(ke){let Re=await Pe({generate_featured_image:"0"});Oe(Re),Array.isArray(Re.in_content_images)&&be.in_content_images.push(...Re.in_content_images),ae.generateImages&&d(ne,"image","done")}if(_e){let Re=await Pe({generate_images_enabled:"0",image_count:0});Oe(Re),Re.featured_image_id&&(be.featured_image_id=Re.featured_image_id),Re.featured_image_url&&(be.featured_image_url=Re.featured_image_url),ae.generateFeatured&&d(ne,"featured","done")}at=be}else at=await Pe(),ae.generateImages&&d(ne,"image","done"),ae.generateFeatured&&d(ne,"featured","done")}else d(ne,"image","skipped"),d(ne,"featured","skipped");d(ne,"save","running");let $t=T(H,Z,Qe,we.content,we,at,K._ajax_nonce),li=await window.aipkit_apiRequest("aipkit_content_writer_save_post",$t);return d(ne,"save","done"),{summary:y(we.content,we.excerpt),viewLink:li.view_link||li.edit_link}},V=()=>{let L=l();i.active=!1,i.stopRequested=!1,L?.generateBtn&&(typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():L.generateBtn.disabled=!1,L.generateBtn.removeAttribute("aria-disabled")),L?.generateToggle&&(L.generateToggle.disabled=!1,L.generateToggle.removeAttribute("aria-disabled")),L?.generateMenuItems?.length&&L.generateMenuItems.forEach(K=>{K.disabled=!1,K.removeAttribute("aria-disabled")}),L?.stopBtn&&(L.stopBtn.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()},W=()=>{i.active&&(i.stopRequested=!0,f(g("Stopping...","gpt3-ai-content-generator"),"info"))},R=L=>{i.items.slice(L).forEach((K,H)=>{let ne=i.rows[L+H];x(ne,"stopped")})},B=async()=>{for(let H=0;H<i.items.length;H+=1){if(i.stopRequested){R(H);break}let ne=i.rows[H];x(ne,"running");try{let ae=await M(i.items[H],i.baseData,i.postConfig,ne,i.stepContext);x(ne,"success",ae),i.totals.completed+=1}catch(ae){o(ne),x(ne,"error",{summary:ae?.message||g("Failed","gpt3-ai-content-generator")}),i.totals.failed+=1}i.totals.processed+=1,p()}let L=i.items.length,K=i.totals.completed;i.stopRequested?f(g("Generation stopped.","gpt3-ai-content-generator"),"error"):f(`${K}/${L} ${g("completed","gpt3-ai-content-generator")}`,"success"),V()},$=async(L,K)=>{if(!L||!K)return;if(!window.aipkit_apiRequest){console.error("Batch generation: aipkit_apiRequest not available.");return}let H=l();if(!H?.generateBtn)return;if(i.active){f(g("Generation already in progress.","gpt3-ai-content-generator"),"info");return}let ne=q(L),ae=E(L),Z=s(ne,ae);try{i.active=!0,i.stopRequested=!1,_(),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(H.generateBtn,!0,g("Generate","gpt3-ai-content-generator"),g("Preparing\u2026","gpt3-ai-content-generator")):H.generateBtn.disabled=!0,H.queue&&(H.queue.dataset.cwMode=K),f(g("Preparing items\u2026","gpt3-ai-content-generator"),"info");let pe=await window.aipkit_apiRequest("aipkit_content_writer_prepare_batch",{...ne,cw_generation_mode:K}),ve=Array.isArray(pe.items)?pe.items:[];if(!ve.length){f(g("No items found to generate.","gpt3-ai-content-generator"),"error"),V();return}m(),i.items=ve.slice(0,a),i.baseData=ne,i.postConfig=ae,i.stepContext=Z,C(i.items,Z),k(),p(),f(g("Generating content\u2026","gpt3-ai-content-generator"),"info"),await B()}catch(pe){f(pe?.message||g("Batch generation failed.","gpt3-ai-content-generator"),"error"),V()}},G=()=>{i.active=!1,i.stopRequested=!1,m(),u()};window.aipkit_cw_handleBatchGeneration=$,window.aipkit_cw_resetBatchQueue=G,window.aipkit_cw_requestBatchStop=W,window.aipkit_cw_isBatchActive=()=>i.active===!0})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n},a=window.wp?.i18n?.__||function(n){return n};function r(n,e){let i=n.value,s=i?i.toLowerCase():"",c=window.aipkit_dashboard?.models;if(!e){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!c){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),e.innerHTML='<option value="">'+g("Error: Model data object not found")+"</option>",e.disabled=!0;return}let t=c[s];(typeof t>"u"||t===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${s}'. Defaulting to empty.`),t=s==="openai"?{}:[]),e.innerHTML="";let d=window.aipkit_dashboard?.recommendedModels?.[s]||[],o=Array.isArray(d)?d:[],l=new Set(o.map(_=>_?.id).filter(Boolean));if(s==="openai"&&typeof t=="object"&&!Array.isArray(t)){if(o.length>0){let _=document.createElement("optgroup");_.label=g(a("Recommended","gpt3-ai-content-generator")),o.forEach(p=>{if(p&&typeof p=="object"&&p.id){let f=new Option(g(p.name||p.id),p.id);_.appendChild(f)}}),_.children.length>0&&e.appendChild(_)}Object.keys(t).forEach(_=>{let p=document.createElement("optgroup");p.label=g(_);let f=t[_];Array.isArray(f)?f.forEach(m=>{if(!(m&&typeof m=="object"&&m.id&&l.has(m.id)))if(m&&typeof m=="object"&&m.id){let k=new Option(g(m.name||m.id),m.id);p.appendChild(k)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${_}':`,m)}):console.warn(`Content Writer Model Populator: Items for group '${_}' under '${s}' is not an array.`),p.children.length>0&&e.appendChild(p)})}else if(Array.isArray(t)){if(o.length>0){let p=document.createElement("optgroup");p.label=g(a("Recommended","gpt3-ai-content-generator")),o.forEach(f=>{if(f&&typeof f=="object"&&f.id){let m=new Option(g(f.name||f.id),f.id);p.appendChild(m)}}),p.children.length>0&&e.appendChild(p)}let _=o.length>0?document.createElement("optgroup"):null;_&&(_.label=g(a("All models","gpt3-ai-content-generator"))),t.forEach(p=>{if(!(p&&typeof p=="object"&&p.id&&l.has(p.id)))if(p&&typeof p=="object"&&p.id){let f=new Option(g(p.name||p.id),p.id);_?_.appendChild(f):e.appendChild(f)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${s}':`,p)}),_&&_.children.length>0&&e.appendChild(_)}else console.warn(`Content Writer Model Populator: Data for provider '${s}' is not in expected format. Actual type: ${typeof t}`),e.appendChild(new Option(g(`No models for ${i} (Format Error)`),""));if(!e.options||typeof e.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),e.appendChild(new Option(g("Error loading models"),"")),e.disabled=!0;else if(e.options.length===0)e.appendChild(new Option(g(`No models for ${i} (Sync in settings)`),"")),e.disabled=!0;else{e.disabled=!1;let _=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let p=window.aipkit_cw_template_state.pendingModelSelection;e.querySelector(`option[value="${CSS.escape(p)}"]`)?_=p:console.warn(`Content Writer Model Populator: Pending model '${p}' not found in new list for provider '${i}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(_===null){let p=e.querySelector("optgroup");p&&p.options&&p.options.length>0&&p.options[0].value?_=p.options[0].value:e.options&&e.options.length>0&&e.options[0].value?_=e.options[0].value:_=""}e.value=_}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let _=document.getElementById("aipkit_content_writer_container");_&&window.aipkit_cw_toggleReasoningEffort(_)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}window.aipkit_populateModelsForContentWriter=r})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(l){return l},a=l=>l&&l!=="single"?l:"task",r=l=>typeof l=="string"&&l.startsWith("existing"),n=l=>l==="existing"?"existing-content":l,e={"existing-images":{title:{label:"Image Title",desc:"Optimize attachment title"},content:{label:"Description",desc:"Update image description"},excerpt:{label:"Caption",desc:"Short image caption"},keyword:{label:"Alt Text",desc:"Describe the image for accessibility"}},"existing-products":{title:{label:"Product Title",desc:"Generate product headline"},content:{label:"Product Description",desc:"Generate main product description"},meta:{label:"Meta Description",desc:"SEO meta for product pages"},keyword:{label:"Focus Keyword",desc:"Primary keyword for product SEO"},excerpt:{label:"Short Description",desc:"Short summary of the product"},tags:{label:"Tags",desc:"Auto-generate product tags"}}},i=l=>{let _=document.getElementById("aipkit_content_writer_container");if(!_)return;let p=_.querySelectorAll(".aipkit_prompt_toggle_card[data-prompt-key]");if(!p.length)return;let f=e[l]||null;p.forEach(m=>{let k=m.dataset.promptKey,u=m.querySelector(".aipkit_prompt_toggle_label"),w=m.querySelector(".aipkit_prompt_toggle_desc");if(!u||!w)return;m.dataset.defaultLabel||(m.dataset.defaultLabel=u.textContent||""),m.dataset.defaultDesc||(m.dataset.defaultDesc=w.textContent||"");let h=f&&k?f[k]:null;h?(u.textContent=h.label,w.textContent=h.desc):(u.textContent=m.dataset.defaultLabel,w.textContent=m.dataset.defaultDesc)})},s=l=>{let _=document.querySelectorAll(".aipkit_cw_prompt_flyout");if(!_.length)return;let p=l==="existing-images",f=l==="existing-products";_.forEach(m=>{let k=m.querySelector(".aipkit_cw_prompt_panel"),u=m.querySelector(".aipkit_cw_prompt_editor_title");if(!k||!u)return;if(!m.dataset.defaultTitle){let h=u.textContent||k.getAttribute("aria-label")||"";m.dataset.defaultTitle=h}let w=m.dataset.defaultTitle||"";p&&m.dataset.existingImagesTitle?w=m.dataset.existingImagesTitle:f&&m.dataset.existingProductsTitle&&(w=m.dataset.existingProductsTitle),w&&(u.textContent=w,k.setAttribute("aria-label",w))})};function c(l){if(!document.getElementById("aipkit_content_writer_form"))return;let p=a(l),f=n(p),m=document.getElementById("aipkit_cw_single_output_wrapper");m&&f!=="task"&&(m.style.display="none");let k=document.getElementById("aipkit_cw_output_card");if(k){let h=m&&m.style.display!=="none";k.style.display=f==="task"&&h?"block":"none"}let u=document.getElementById("aipkit_cw_content_prompt_placeholders");if(u){let h="Use placeholders: {topic}, {keywords}",v=r(f);f==="rss"?h+=", {description}, {source_url}":f==="url"&&(h+=", {url_content}"),h+=".";let C=h.replace(/(\{[a-zA-Z0-9_]+\})/g,x=>`<code class="aipkit-placeholder" title="Click to copy">${g(x)}</code>`);u.innerHTML=C,u.hidden=v}typeof window.aipkit_setContentWriterPromptMode=="function"&&window.aipkit_setContentWriterPromptMode(f),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState(f);let w=document.getElementById("aipkit_cw_batch_queue");if(w){let h=w.querySelector(".aipkit_cw_batch_list"),v=h?h.children.length>0:!1,C=typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive();w.hidden=!(C||v)}typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),f.startsWith("existing")&&typeof window.aipkit_fetchContentWriterExistingPosts=="function"&&window.aipkit_fetchContentWriterExistingPosts(1)}function t(l){let _=document.getElementById("aipkit_content_writer_form");if(!_)return;let p=document.getElementById("aipkit_content_writer_generate_btn"),f=p?p.querySelector(".aipkit_btn-text"):null,m=p?p.querySelector(".aipkit_cw_task_suffix"):null,k=document.querySelector(".aipkit_cw_post_summary_trigger"),u=document.querySelector(".aipkit_cw_generate_split"),w=u?u.querySelector(".aipkit_cw_generate_toggle"):null,h=u?u.querySelector(".aipkit_cw_generate_menu"):null,v=_.querySelector("#aipkit_cw_task_frequency"),C=h?Array.from(h.querySelectorAll(".aipkit_cw_generate_menu_item[data-action]")):[],x=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,b=new Set(["task","csv","rss","gsheets","url"]),I=new Set(["rss","gsheets","url"]),y=a(l||document.getElementById("aipkit_cw_mode_select")?.value||"task");y=n(y);let q=r(y),E=y==="existing-images",S=y==="existing-products",A=y==="existing-content",T=b.has(y),M=I.has(y),V=T&&(!M||x),W=y==="task"||y==="csv";_.classList.toggle("aipkit_cw_mode_existing",q),_.classList.toggle("aipkit_cw_mode_existing_images",E),_.classList.toggle("aipkit_cw_mode_existing_products",S),_.classList.toggle("aipkit_cw_mode_existing_content",A),_.querySelectorAll(".aipkit_model_settings_popover.aipkit-active").forEach(H=>{H.classList.remove("aipkit-active"),H.setAttribute("aria-hidden","true")}),_.querySelectorAll(".aipkit_cw_popover_trigger[aria-expanded='true']").forEach(H=>H.setAttribute("aria-expanded","false")),_.querySelectorAll("[data-aipkit-cw-mode-only]").forEach(H=>{let ae=H.dataset.aipkitCwModeOnly===y;H.hidden=!ae,H.setAttribute("aria-hidden",ae?"false":"true"),!ae&&H.classList.contains("aipkit_model_settings_popover")&&(H.classList.remove("aipkit-active"),H.setAttribute("aria-hidden","true")),!ae&&H.classList.contains("aipkit_cw_popover_trigger")&&H.setAttribute("aria-expanded","false")}),i(y),s(y),typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),(()=>{if(!r)return;let H=window.aipkit_cw_template_state;if(!H)return;let ae=(Array.isArray(H.currentTemplates)?H.currentTemplates.find(Z=>String(Z.id)===String(H.currentTemplateId||"")):null)?.config||H.initialConfigForSelectedTemplate;!ae||typeof ae!="object"||["generate_title","generate_content"].forEach(Z=>{if(!Object.prototype.hasOwnProperty.call(ae,Z))return;let pe=_.elements[Z];if(!pe)return;let ve=ae[Z];pe.checked=ve==="1"||ve===1||ve===!0})})(),v&&W&&Array.from(v.options).some(ne=>ne.value==="one-time")&&v.value!=="one-time"&&(v.value="one-time");let B=!1;if(y==="rss"){let H=document.getElementById("aipkit_cw_rss_items_count");B=H&&parseInt(H.value,10)>0}let $=u?.dataset?.aipkitCwAction||"generate";if(q?$=!x&&S?"upgrade":"update":(T||($="generate"),!V&&M&&($="upgrade")),!q&&y==="rss"&&V?B?$==="fetch_feeds"&&($="generate"):$="fetch_feeds":$==="fetch_feeds"&&($="generate"),!q&&$==="create_task"&&!V&&($="generate"),!q&&V&&$!=="generate"&&$!=="create_task"&&$!=="fetch_feeds"&&($="generate"),u&&(u.dataset.aipkitCwAction=$),C.forEach(H=>{let ne=H.dataset.action||"generate",ae=!T||M&&!x||q;ne==="create_task"&&(H.hidden=ae);let Z=ne===$;H.classList.toggle("is-active",Z),H.setAttribute("aria-checked",Z?"true":"false")}),w){let H=V&&!q&&!(y==="rss"&&!B);w.style.display=H?"":"none",w.disabled=!H}h&&(h.dataset.keepOpen==="true"||(h.hidden=!0),h.dataset.keepOpen="false"),u&&u.classList.toggle("is-single",!V||y==="rss"&&!B);let L={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",fetch_feeds:"Fetch Feeds",update:"Update"}[$]||"Generate";if(f?f.textContent=L:p&&(typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(p,L):p.textContent=L),p&&(p.dataset.action=$,q||(p.removeAttribute("aria-disabled"),p.dataset.aipkitExistingDisabled&&(p.disabled=!1,delete p.dataset.aipkitExistingDisabled))),m)if($==="create_task"&&v&&!W){let H=v.options[v.selectedIndex],ne=H?H.text:"";ne?(m.textContent=` / ${ne}`,m.hidden=!1):(m.textContent="",m.hidden=!0)}else m.textContent="",m.hidden=!0;if(k&&(k.hidden=q,k.setAttribute("aria-hidden",q?"true":"false"),q&&k.setAttribute("aria-expanded","false")),typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0);return}p?.dataset?.aipkitStopMode==="true"&&typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),typeof window.aipkit_cw_resetBatchQueue=="function"&&($!=="generate"||!T)&&window.aipkit_cw_resetBatchQueue()}let d={task:{label:"Manual Entry",icon:"dashicons-edit"},csv:{label:"Import CSV",icon:"dashicons-media-spreadsheet"},rss:{label:"RSS Feed",icon:"dashicons-rss"},url:{label:"Website URL",icon:"dashicons-admin-links"},gsheets:{label:"Google Sheets",icon:"dashicons-analytics"},existing:{label:"Update Content",icon:"dashicons-update"},"existing-content":{label:"Update Content",icon:"dashicons-update"},"existing-images":{label:"Optimize Images",icon:"dashicons-format-image"},"existing-products":{label:"Optimize Products",icon:"dashicons-cart"}};function o(l){if(!l){console.error("Content Writer Mode: Scope element not provided for initialization.");return}let _=l.querySelector("#aipkit_cw_mode_select"),p=Array.from(l.querySelectorAll(".aipkit_cw_mode_card")),f=Array.from(l.querySelectorAll(".aipkit_cw_bulk_source_tab")),m=Array.from(l.querySelectorAll("[data-aipkit-bulk-source-panel]")),k=l.querySelector(".aipkit_cw_tab_content_container"),u=l.querySelector("[data-aipkit-source-selector]"),w=u?.querySelector("[data-aipkit-source-trigger]"),h=u?.querySelector(".aipkit_cw_source_menu"),v=h?Array.from(h.querySelectorAll(".aipkit_cw_source_option")):[],C=w?.querySelector("[data-source-label]"),x=w?.querySelector("[data-source-icon]");if(!_||!k){console.warn("Content Writer Mode: Mode selector or content container not found within the provided scope.");return}let b=A=>{p.length&&p.forEach(T=>{let M=T.dataset.mode===A;T.classList.toggle("is-active",M),T.setAttribute("aria-pressed",M?"true":"false")})},I=A=>{!f.length||!m.length||(f.forEach(T=>{let M=T.dataset.source===A;T.classList.toggle("is-active",M),T.setAttribute("aria-pressed",M?"true":"false")}),m.forEach(T=>{let M=T.dataset.aipkitBulkSourcePanel===A;T.classList.toggle("is-hidden",!M),T.hidden=!M,T.setAttribute("aria-hidden",M?"false":"true")}))},y=A=>{if(!v.length)return;let T=n(A),M=r(T);v.forEach(W=>{let R=W.dataset.source===T;W.classList.toggle("is-active",R),W.setAttribute("aria-selected",R?"true":"false")});let V=d[T]||d.task;if(C&&(C.dataset.defaultLabel||(C.dataset.defaultLabel=C.textContent||""),C.textContent=M?V.label:C.dataset.defaultLabel),x){let W=x.querySelector(".dashicons");if(W&&!x.dataset.defaultIcon){let R=W.className.split(" ").find(B=>B!=="dashicons");x.dataset.defaultIcon=R||"dashicons-plus-alt2"}if(W){let R=M?V.icon:x.dataset.defaultIcon||"dashicons-plus-alt2";W.className="dashicons "+R}x.dataset.sourceIcon=M?T:"more"}w&&w.classList.toggle("is-active",M)},q=(A=!1)=>{if(!h||!w)return;let T=w.getAttribute("aria-expanded")==="true",M=A||T;w.setAttribute("aria-expanded",M?"false":"true"),h.hidden=M},E=A=>{let T=a(A),M=n(T),V=M.startsWith("existing")?"existing":M;_.value!==T&&(_.value=T),k.querySelectorAll(".aipkit_cw_tab_content").forEach(W=>{W.classList.toggle("aipkit_active",W.dataset.pane===V)}),b(M),I(T==="csv"?"csv":"task"),y(M),c(M)};_.addEventListener("change",function(A){E(A.target.value)}),w&&w.addEventListener("click",A=>{A.stopPropagation(),q()}),v.length&&v.forEach(A=>{A.addEventListener("click",()=>{let T=A.dataset.source||"task";_.value!==T&&(_.value=T,_.dispatchEvent(new Event("change",{bubbles:!0}))),q(!0)})}),document.addEventListener("click",A=>{u&&!u.contains(A.target)&&q(!0)}),document.addEventListener("keydown",A=>{A.key==="Escape"&&h&&!h.hidden&&(q(!0),w?.focus())}),p.length&&p.forEach(A=>{A.dataset.listenerAttached||(A.addEventListener("click",()=>{let T=A.dataset.mode||"task";_.value!==T&&(_.value=T,_.dispatchEvent(new Event("change",{bubbles:!0})))}),A.dataset.listenerAttached="true")}),f.length&&f.forEach(A=>{A.dataset.listenerAttached||(A.addEventListener("click",()=>{let M=(A.dataset.source||"task")==="csv"?"csv":"task";_.value!==M&&(_.value=M,_.dispatchEvent(new Event("change",{bubbles:!0})))}),A.dataset.listenerAttached="true")});let S=_.value||"task";E(S==="single"?"task":S)}window.aipkit_initContentWriterTabs=o,window.aipkit_updateContentWriterActionState=t})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(k){return String(k||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},a=["keyword","title","excerpt","content","meta","tags"],r={keyword:"Focus keyword",title:"Title",excerpt:"Excerpt",content:"Content",meta:"Meta description",tags:"Tags",slug:"URL"},e={"existing-content":{fieldOrder:a,fieldLabels:r,postTypeOverride:"",allowMeta:!0,allowTags:!0,allowSlug:!0},"existing-images":{fieldOrder:["keyword","title","excerpt","content"],fieldLabels:{keyword:"Alt text",title:"Image title",excerpt:"Caption",content:"Description"},postTypeOverride:"attachment",allowMeta:!1,allowTags:!1,allowSlug:!1,useImageMetadataPrompts:!0},"existing-products":{fieldOrder:a,fieldLabels:r,postTypeOverride:"product",allowMeta:!0,allowTags:!0,allowSlug:!0}},i=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}"],s=["{price}","{regular_price}","{sale_price}","{sku}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{product_categories}"],c={title:["{original_title}"],content:["{original_content}","{short_description}"],meta:["{original_title}","{short_description}","{original_content}"],keyword:["{original_title}","{original_content}"],excerpt:["{short_description}","{original_content}","{original_excerpt}"],tags:["{original_content}","{attributes}","{product_categories}"]},t=["{file_name}","{original_title}","{original_alt}","{original_caption}","{original_description}"],d=["Generate product titles, descriptions, and SEO fields.","Use product data like price, SKU, and attributes.","Bulk optimize selected products."],o={short:2e3,medium:4e3,long:6e3},l=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,_=window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.aipkit_dashboard.upgradeUrl:"",p=2400;function f(k=1){if(typeof window.aipkit_cw_existing_handleFetch=="function"){window.aipkit_cw_existing_handleFetch(k);return}window.aipkit_cw_existing_pendingFetch=k}function m(k){if(!k)return;let u=k.querySelector("[data-aipkit-existing-panel]");if(!u||u.dataset.init==="true")return;let w=u.querySelector("#aipkit_cw_existing_post_type"),h=u.querySelector("#aipkit_cw_existing_post_status"),v=u.querySelector("#aipkit_cw_existing_media_filter"),C=u.querySelector("#aipkit_cw_existing_search"),x=u.querySelector("#aipkit_cw_existing_refresh"),b=u.querySelector("#aipkit_cw_existing_select_all"),I=u.querySelector("#aipkit_cw_existing_posts_body"),y=u.querySelector("#aipkit_cw_existing_page_status"),q=u.querySelector("#aipkit_cw_existing_page_prev"),E=u.querySelector("#aipkit_cw_existing_page_next"),S=u.querySelector("#aipkit_cw_existing_selected_count"),A=document.getElementById("aipkit_content_writer_generate_btn")||u.querySelector("#aipkit_cw_existing_open_assistant"),T=document.getElementById("aipkit_cw_mode_select");if(!I)return;let M=document.getElementById("aipkit_content_writer_nonce"),V=10,W=1,R=1,B=null,$=!1,G=!1,L=!1,K=[],H=new Set,ne=new Map,ae=w?w.value:"",Z=!1,pe=A?A.querySelector(".aipkit_btn-text"):null,ve=A&&A.dataset.action||"generate",De=fe=>fe?fe==="existing"?"existing-content":fe.indexOf("existing-")===0?fe:"":"",Qe=()=>De(T?T.value:""),$e=()=>e[Qe()]||e["existing-content"],lt=()=>!!Qe(),it=document.getElementById("aipkit_content_writer_form_status"),we="",at=null,Zt=()=>{at&&(clearTimeout(at),at=null)},$t=(fe,Fe)=>{it&&(Zt(),it.textContent=fe||"",it.className="aipkit_cw_status_badge",Fe==="info"?it.classList.add("aipkit_settings_message-info"):Fe==="error"?it.classList.add("aipkit_settings_message-error"):Fe==="success"&&it.classList.add("aipkit_settings_message-success"),fe?it.dataset.cwUpdateStatus="1":delete it.dataset.cwUpdateStatus)},li=()=>{G&&(L=!0,$t("Stopping...","info"))},ai=()=>{it&&(Zt(),at=setTimeout(()=>{it.dataset.cwUpdateStatus==="1"&&$t("","")},4e3))},se=fe=>{if(!it){we="";return}if(!fe){it.dataset.cwProNotice==="1"&&(!we||it.textContent.startsWith(we))&&(it.textContent="",it.className="aipkit_cw_status_badge"),delete it.dataset.cwProNotice,we="";return}let Fe=_?` <a class="aipkit_popover_upgrade_link" href="${g(_)}" target="_blank" rel="noopener noreferrer">Upgrade</a>`:"";we=fe,it.dataset.cwProNotice="1",it.className="aipkit_cw_status_badge aipkit_settings_message-info",it.innerHTML=`${g(fe)}${Fe}`};if(w&&!l){let fe=w.querySelector('option[value="product"]');fe&&!fe.dataset.proLabel&&(fe.dataset.proLabel=fe.textContent||"Products")}let ke=fe=>{Z=!!fe,A&&(A.dataset.action=Z?"upgrade":ve,pe&&lt()&&(pe.textContent=Z?"Upgrade":"Update"))},_e=fe=>{let Fe=[],ge=[];return fe.forEach(Ge=>{let et=K.find(Nt=>Number(Nt.id)===Ge);et&&et.type==="product"?Fe.push(Ge):ge.push(Ge)}),{productIds:Fe,otherIds:ge}},Ce=()=>{if(!lt()||Qe()!=="existing-content"){ke(!1),se("");return}if(l){ke(!1),se("");return}let fe=Array.from(H),{productIds:Fe,otherIds:ge}=_e(fe);if(w&&w.value==="product"){ke(!0);return}if(Fe.length&&!ge.length){ke(!0);return}if(Fe.length&&ge.length){ke(!1);return}ke(!1),se("")},Pe=fe=>{I&&(I.innerHTML=`
        <tr class="aipkit_cw_existing_empty">
          <td colspan="7">${g(fe)}</td>
        </tr>
      `,be())},be=()=>{let fe=H.size;if(Ce(),S&&(S.textContent=`${fe} selected`),A&&lt()){let Fe=Z?G:fe===0||G;A.disabled=Fe,A.setAttribute("aria-disabled",Fe?"true":"false"),Fe?A.dataset.aipkitExistingDisabled="true":delete A.dataset.aipkitExistingDisabled}if(b){let Fe=K.length>0&&K.every(ge=>H.has(ge.id));b.checked=Fe}},Oe=()=>{y&&(y.textContent=`Page ${W} of ${R}`),q&&(q.disabled=W<=1),E&&(E.disabled=W>=R)},Re=(fe,Fe)=>{if(K=Array.isArray(fe)?fe:[],W=Fe?.page||1,R=Fe?.total_pages||1,!K.length){Pe("No posts found."),Oe(),be();return}let ge=Qe()==="existing-images",Ge=K.map(et=>{let Nt=Number(et.id),Gt=g(et.title||"(Untitled)"),wt=g(et.edit_link||"#"),Ot=g(et.type_label||""),Yt=g(et.status_label||""),pi=ge?g(et.alt_text||""):"",Ze=ge?g(et.caption||""):"",Ee=ge?g(et.description||""):"",Lt=ge?g(et.thumb_url||""):"",ft=H.has(Nt)?"checked":"",ui=g(et.type||"post"),Mt=Gt?` title="${Gt}"`:"",cn=pi?` title="${pi}"`:"",ln=Ze?` title="${Ze}"`:"",Ci=Ee?` title="${Ee}"`:"",rt=Lt?`<span class="aipkit_cw_existing_thumb"><img src="${Lt}" alt="" loading="lazy"></span>`:'<span class="aipkit_cw_existing_thumb aipkit_cw_existing_thumb--empty" aria-hidden="true"></span>',dn=ge?`
                <div class="aipkit_cw_existing_title_stack">
                  ${rt}
                  <div class="aipkit_cw_existing_title_meta">
                    <a class="row-title aipkit_cw_existing_truncate" href="${wt}" target="_blank" rel="noopener noreferrer"${Mt}>${Gt}</a>
                    <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                  </div>
                </div>
              `:`
                <div class="aipkit_cw_existing_title_inline">
                  <a class="row-title aipkit_cw_existing_truncate" href="${wt}" target="_blank" rel="noopener noreferrer"${Mt}>${Gt}</a>
                  <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                </div>
              `;return`
            <tr id="post-${Nt}" data-post-type="${ui}">
              <td class="aipkit_cw_existing_col_check">
                <input type="checkbox" class="aipkit_cw_existing_row_checkbox" value="${Nt}" ${ft}>
              </td>
              <td class="aipkit_cw_existing_title">
                ${dn}
              </td>
              <td class="aipkit_cw_existing_col_type">${Ot}</td>
              <td class="aipkit_cw_existing_col_status">${Yt}</td>
              <td class="aipkit_cw_existing_col_alt"><span class="aipkit_cw_existing_truncate"${cn}>${pi}</span></td>
              <td class="aipkit_cw_existing_col_caption"><span class="aipkit_cw_existing_truncate"${ln}>${Ze}</span></td>
              <td class="aipkit_cw_existing_col_description"><span class="aipkit_cw_existing_truncate"${Ci}>${Ee}</span></td>
            </tr>
          `}).join("");I.innerHTML=Ge,Oe(),be()},_t=fe=>{let Fe=String(fe||"").trim();return Fe||"(Untitled)"},Wt=(fe,Fe)=>{let ge=u.querySelector(`#post-${fe}`);if(!ge)return;let Ge=ge.querySelector(".row-title");if(!Ge)return;let et=_t(Fe);Ge.textContent=et,Ge.setAttribute("title",et);let Nt=K.find(Gt=>Number(Gt.id)===fe);Nt&&(Nt.title=et)},ri=(fe,Fe,ge)=>{let Ge=u.querySelector(`#post-${fe}`);if(!Ge)return;let et="",Nt="";if(Fe==="keyword")et=".aipkit_cw_existing_col_alt .aipkit_cw_existing_truncate",Nt="alt_text";else if(Fe==="excerpt")et=".aipkit_cw_existing_col_caption .aipkit_cw_existing_truncate",Nt="caption";else if(Fe==="content")et=".aipkit_cw_existing_col_description .aipkit_cw_existing_truncate",Nt="description";else return;let Gt=Ge.querySelector(et);if(!Gt)return;let wt=String(ge||"").trim();Gt.textContent=wt,wt?Gt.setAttribute("title",wt):Gt.removeAttribute("title");let Ot=K.find(Yt=>Number(Yt.id)===fe);Ot&&Nt&&(Ot[Nt]=wt)},Ht=fe=>{let Fe=ne.get(fe);Fe&&(clearTimeout(Fe),ne.delete(fe))},ht=(fe,Fe,ge)=>{let Ge=u.querySelector(`#post-${fe}`);if(!Ge)return;let et=Ge.querySelector(".aipkit_cw_existing_status");if(et){if(Ht(fe),et.classList.remove("is-visible","is-error","is-success","is-processing","is-queued"),!ge){et.textContent="";return}et.textContent=ge,et.classList.add("is-visible"),Fe==="error"&&et.classList.add("is-error"),Fe==="success"&&et.classList.add("is-success"),Fe==="processing"&&et.classList.add("is-processing"),Fe==="queued"&&et.classList.add("is-queued")}},Be=fe=>ht(fe,"",""),qe=fe=>{Ht(fe);let Fe=setTimeout(()=>Be(fe),p);ne.set(fe,Fe)},gt=fe=>{if(G=fe,A&&lt()){let Fe=A.dataset&&A.dataset.aipkitStopMode==="true",ge=Z?fe:H.size===0||fe&&!Fe;A.disabled=ge,A.setAttribute("aria-disabled",ge?"true":"false"),ge?A.dataset.aipkitExistingDisabled="true":delete A.dataset.aipkitExistingDisabled}if(x&&(x.disabled=fe),w){let Fe=$e();w.disabled=fe||!!Fe.postTypeOverride}h&&(h.disabled=fe),C&&(C.disabled=fe),q&&(q.disabled=fe||W<=1),E&&(E.disabled=fe||W>=R),b&&(b.disabled=fe),I.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Fe=>{Fe.disabled=fe})},Pt=()=>{let fe=$e();w&&(fe.postTypeOverride?(w.value=fe.postTypeOverride,w.disabled=!0):(w.disabled=!1,w.value=ae||"")),h&&fe.postTypeOverride==="attachment"&&(h.value="")},qt=fe=>{!A||!lt()||A.dataset&&A.dataset.aipkitStopMode==="true"||(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(A,fe,"Update","Updating..."):A.disabled=fe)},We=(fe,Fe)=>{let ge=`${Fe}_update`,Ge=fe&&fe[ge]||fe&&fe[Fe]||"";return String(Ge||"").trim()},xi=fe=>{let Fe=document.getElementById("aipkit_content_writer_form");if(!Fe||typeof window.aipkit_getContentWriterFormConfig!="function")return{error:"Content Writer form is not ready yet."};let ge=window.aipkit_getContentWriterFormConfig(Fe),Ge=!!fe.useImageMetadataPrompts;if(!l&&fe.postTypeOverride==="product")return{error:"Optimize Products is a Pro feature. Upgrade to continue."};let et=ft=>Ge?ft==="title"?ge.generate_image_title==="1":ft==="keyword"?ge.generate_image_alt_text==="1":ft==="excerpt"?ge.generate_image_caption==="1":ft==="content"?ge.generate_image_description==="1":!1:ft==="meta"&&!fe.allowMeta||ft==="tags"&&!fe.allowTags?!1:ft==="title"?ge.generate_title!=="0":ft==="content"?ge.generate_content!=="0":ft==="meta"?ge.generate_meta_description==="1":ft==="keyword"?ge.generate_focus_keyword==="1":ft==="excerpt"?ge.generate_excerpt==="1":ft==="tags"?ge.generate_tags==="1":!1,Nt=Ge?{title:et("title")?We(ge,"image_title_prompt"):"",content:et("content")?We(ge,"image_description_prompt"):"",meta:"",keyword:et("keyword")?We(ge,"image_alt_text_prompt"):"",excerpt:et("excerpt")?We(ge,"image_caption_prompt"):"",tags:""}:{title:et("title")?We(ge,"custom_title_prompt"):"",content:et("content")?We(ge,"custom_content_prompt"):"",meta:et("meta")?We(ge,"custom_meta_prompt"):"",keyword:et("keyword")?We(ge,"custom_keyword_prompt"):"",excerpt:et("excerpt")?We(ge,"custom_excerpt_prompt"):"",tags:et("tags")?We(ge,"custom_tags_prompt"):""},Gt=[],wt=ft=>fe.fieldLabels?.[ft]||r[ft]||ft;if(et("title")&&!Nt.title&&Gt.push(`${wt("title")} prompt is required.`),et("content")&&!Nt.content&&Gt.push(`${wt("content")} prompt is required.`),et("meta")&&!Nt.meta&&Gt.push(`${wt("meta")} prompt is required.`),et("keyword")&&!Nt.keyword&&Gt.push(`${wt("keyword")} prompt is required.`),et("excerpt")&&!Nt.excerpt&&Gt.push(`${wt("excerpt")} prompt is required.`),et("tags")&&!Nt.tags&&Gt.push(`${wt("tags")} prompt is required.`),Gt.length)return{error:Gt.join(" ")};let Ot=[],Yt=(ft,ui)=>ui.some(Mt=>ft.includes(Mt)),pi=ft=>Ge?t:fe.postTypeOverride==="product"&&c[ft]||i;if(fe.fieldOrder.forEach(ft=>{let ui=Nt[ft];if(!ui)return;let Mt=pi(ft);Yt(ui,Mt)||Ot.push(`${wt(ft)} prompt: add one of ${Mt.join(", ")}.`)}),Ot.length)return{error:`${Ge?"Image optimization":fe.postTypeOverride==="product"?"Product update":"Update"} works best when prompts include source placeholders.

${Ot.join(`
`)}`};let Ze=String(ge.content_length||"medium"),Ee=o[Ze]||o.medium,Lt={ai_provider:ge.ai_provider||"openai",ai_model:ge.ai_model||"",temperature:parseFloat(ge.ai_temperature||"1"),max_tokens:Ee,reasoning_effort:ge.reasoning_effort||"",generate_seo_slug:fe.allowSlug&&ge.generate_seo_slug||"0",enable_vector_store:ge.enable_vector_store||"0",vector_store_provider:ge.vector_store_provider||"openai",vector_store_top_k:ge.vector_store_top_k||"3",openai_vector_store_ids:ge.openai_vector_store_ids||[],pinecone_index_name:ge.pinecone_index_name||"",qdrant_collection_name:ge.qdrant_collection_name||"",vector_embedding_provider:ge.vector_embedding_provider||"",vector_embedding_model:ge.vector_embedding_model||""};return{prompts:Nt,baseConfig:Lt}},Li=(fe,Fe,ge)=>({[fe]:{prompt:Fe},ai_provider:ge.ai_provider,ai_model:ge.ai_model,temperature:ge.temperature,max_tokens:ge.max_tokens,reasoning_effort:ge.reasoning_effort,enable_vector_store:ge.enable_vector_store,vector_store_provider:ge.vector_store_provider,vector_store_top_k:ge.vector_store_top_k,openai_vector_store_ids:ge.openai_vector_store_ids,pinecone_index_name:ge.pinecone_index_name,qdrant_collection_name:ge.qdrant_collection_name,vector_embedding_provider:ge.vector_embedding_provider,vector_embedding_model:ge.vector_embedding_model}),Ft=async(fe=1)=>{if(!$){if(typeof window.aipkit_apiRequest!="function"){console.error("Content Writer Existing: aipkit_apiRequest not found.");return}$=!0,Pe("Loading posts...");try{let ge=$e().postTypeOverride||(w?w.value:""),Ge=await window.aipkit_apiRequest("aipkit_content_writer_fetch_existing_posts",{_ajax_nonce:M?M.value:"",post_type:ge,post_status:h?h.value:"",media_filter:v?v.value:"",search:C?C.value.trim():"",paged:fe,per_page:V});Re(Ge.posts||[],Ge.pagination||{})}catch(Fe){console.error("Content Writer Existing: fetch failed",Fe),Pe("Unable to load posts. Please try again.")}finally{$=!1}}},bt=()=>{H.clear(),be()};I.addEventListener("change",fe=>{let Fe=fe.target;if(!Fe||!Fe.classList.contains("aipkit_cw_existing_row_checkbox"))return;let ge=Number(Fe.value||0);ge&&(Fe.checked?H.add(ge):H.delete(ge),be())}),b&&b.addEventListener("change",()=>{let fe=b.checked;K.forEach(ge=>{fe?H.add(Number(ge.id)):H.delete(Number(ge.id))}),I.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(ge=>{ge.checked=fe}),be()}),q&&q.addEventListener("click",()=>{W>1&&Ft(W-1)}),E&&E.addEventListener("click",()=>{W<R&&Ft(W+1)}),x&&x.addEventListener("click",()=>{bt(),Ft(1)}),w&&w.addEventListener("change",()=>{$e().postTypeOverride||(ae=w.value),bt(),Ft(1)}),h&&h.addEventListener("change",()=>{bt(),Ft(1)}),v&&v.addEventListener("change",()=>{bt(),Ft(1)}),C&&C.addEventListener("input",()=>{B&&clearTimeout(B),B=setTimeout(()=>{bt(),Ft(1)},300)});let Qt=fe=>{typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(fe,{title:"Update existing"}):alert(fe)},Jt=()=>{let fe="Bulk image optimization is available on Pro. Select one image or upgrade.";if(typeof window.aipkit_showAlertModal=="function"){let Fe=[];_&&Fe.push({label:"Upgrade to Pro",href:_,className:"aipkit_btn aipkit_btn-primary"}),Fe.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(fe,{title:"Optimize Images",actions:Fe})}else alert(fe)},di=()=>{let fe="Optimize Products is a Pro feature.";if(typeof window.aipkit_showAlertModal=="function"){let Fe=[];_&&Fe.push({label:"Upgrade to Pro",href:_,className:"aipkit_btn aipkit_btn-primary"}),Fe.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(fe,{title:"Optimize Products",bullets:d,actions:Fe})}else alert(fe)},Hi=async(fe,Fe,ge,Ge,et)=>{let Nt=`cw-existing-${fe}-${Date.now()}`,Gt=!1;if(L)return ht(fe,"","Stopped"),qe(fe),{success:!1,stopped:!0};for(let wt of et.fieldOrder){let Ot=Fe[wt];if(!Ot)continue;if(L)return ht(fe,"","Stopped"),qe(fe),{success:!1,stopped:!0};ht(fe,"processing",`Updating ${et.fieldLabels[wt]||wt}...`);let Yt=Li(wt,Ot,ge),pi={_ajax_nonce:Ge,post_id:fe,field:wt,enhancements:JSON.stringify(Yt),conversation_uuid:Nt};try{let Ze=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",pi,{timeout:18e4});Ze&&Object.prototype.hasOwnProperty.call(Ze,"updated_value")&&(wt==="title"?Wt(fe,Ze.updated_value):ri(fe,wt,Ze.updated_value)),Gt=!0}catch(Ze){let Ee=Ze&&Ze.message||"Update failed. Please try again.";return ht(fe,"error",Ee),{success:!1}}}if(L)return ht(fe,"","Stopped"),qe(fe),{success:!1,stopped:!0};if(ge.generate_seo_slug==="1"&&Gt){ht(fe,"processing","Updating URL...");try{await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",{_ajax_nonce:Ge,post_id:fe,action_type:"update_slug"},{timeout:3e4})}catch{return ht(fe,"error","URL update failed."),{success:!1}}}return Gt?(ht(fe,"success","Updated"),qe(fe),{success:!0}):(ht(fe,"error","No prompts selected."),{success:!1})},ti=async()=>{if(G||!lt())return;let fe=Array.from(H);if(!fe.length)return;if(!l&&Qe()==="existing-content"){let{productIds:Ee,otherIds:Lt}=_e(fe);if(Ee.length&&!Lt.length){di(),be();return}Ee.length&&Lt.length&&(Ee.forEach(ft=>{ht(ft,"error","Skipped (Pro)"),qe(ft)}),fe=Lt)}if(!fe.length){be();return}if(!l&&Qe()==="existing-images"&&fe.length>1){Jt();return}if(typeof window.aipkit_apiRequest!="function"){Qt("Update service is not available yet.");return}let Fe=window.aipkit_post_enhancer?.nonce_generate_title;if(!Fe){Qt("Update permission is missing. Please reload the page.");return}let ge=$e(),{prompts:Ge,baseConfig:et,error:Nt}=xi(ge);if(Nt){!l&&ge.postTypeOverride==="product"?di():Qt(Nt);return}if(!ge.fieldOrder.some(Ee=>!!Ge[Ee])){Qt("No prompts selected for update.");return}L=!1,fe.forEach(Ee=>{ht(Ee,"queued","Queued")});let wt=0,Ot=0,Yt=fe.length,pi=null,Ze=()=>{let Ee=[];return Ee.push(`Updating ${Yt} item${Yt===1?"":"s"}...`),wt&&Ee.push(`${wt} done`),Ot&&Ee.push(`${Ot} error${Ot===1?"":"s"}`),Ee.join(" ")};$t(Ze(),"info"),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):qt(!0),gt(!0);for(let Ee=0;Ee<fe.length;Ee+=1){let Lt=fe[Ee];if(L){pi=Ee;break}let ft=await Hi(Lt,Ge,et,Fe,ge);if(ft&&ft.stopped){L=!0,pi=Ee+1;break}ft&&ft.success?wt+=1:Ot+=1,$t(Ze(),"info")}if(gt(!1),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():qt(!1),L){(pi!==null?fe.slice(pi):[]).forEach(ft=>{ht(ft,"","Stopped"),qe(ft)});let Lt=[`Update stopped: ${wt} done`];Ot&&Lt.push(`${Ot} error${Ot===1?"":"s"}`),$t(Lt.join(", ")+".","info")}else Ot?$t(`Update complete: ${wt} done, ${Ot} error${Ot===1?"":"s"}.`,"error"):$t(`Update complete: ${wt} done.`,"success");ai(),be()};u.dataset.init="true",window.aipkit_cw_existing_handleFetch=Ft,window.aipkit_runContentWriterExistingUpdate=ti,window.aipkit_cw_isExistingUpdateActive=()=>G,window.aipkit_cw_requestExistingUpdateStop=li,T&&!T.dataset.aipkitExistingListener&&(T.addEventListener("change",()=>{v&&(v.value=""),Pt(),bt()},!0),T.dataset.aipkitExistingListener="true"),Pt(),window.aipkit_cw_existing_pendingFetch&&(Ft(window.aipkit_cw_existing_pendingFetch),window.aipkit_cw_existing_pendingFetch=null)}window.aipkit_initContentWriterExistingContent=m,window.aipkit_fetchContentWriterExistingPosts=f})();(function(){"use strict";let g=[{key:"custom_title_prompt",textareaId:"aipkit_cw_custom_title_prompt",updateInputId:"aipkit_cw_custom_title_prompt_update"},{key:"custom_content_prompt",textareaId:"aipkit_cw_custom_content_prompt",updateInputId:"aipkit_cw_custom_content_prompt_update"},{key:"custom_meta_prompt",textareaId:"aipkit_cw_custom_meta_prompt",updateInputId:"aipkit_cw_custom_meta_prompt_update"},{key:"custom_keyword_prompt",textareaId:"aipkit_cw_custom_keyword_prompt",updateInputId:"aipkit_cw_custom_keyword_prompt_update"},{key:"custom_excerpt_prompt",textareaId:"aipkit_cw_custom_excerpt_prompt",updateInputId:"aipkit_cw_custom_excerpt_prompt_update"},{key:"custom_tags_prompt",textareaId:"aipkit_cw_custom_tags_prompt",updateInputId:"aipkit_cw_custom_tags_prompt_update"},{key:"image_prompt",textareaId:"aipkit_cw_image_prompt",updateInputId:"aipkit_cw_image_prompt_update"},{key:"featured_image_prompt",textareaId:"aipkit_cw_featured_image_prompt",updateInputId:"aipkit_cw_featured_image_prompt_update"},{key:"image_title_prompt",textareaId:"aipkit_cw_image_title_prompt",updateInputId:"aipkit_cw_image_title_prompt_update"},{key:"image_alt_text_prompt",textareaId:"aipkit_cw_image_alt_text_prompt",updateInputId:"aipkit_cw_image_alt_text_prompt_update"},{key:"image_caption_prompt",textareaId:"aipkit_cw_image_caption_prompt",updateInputId:"aipkit_cw_image_caption_prompt_update"},{key:"image_description_prompt",textareaId:"aipkit_cw_image_description_prompt",updateInputId:"aipkit_cw_image_description_prompt_update"}],a={create:{},update:{}},r={},n=[],e="create",i=!1,s=k=>k&&k!=="single"?k:"task",c=()=>{let k=document.getElementById("aipkit_cw_mode_select");return s(k?.value||"task")},t=k=>k&&k.indexOf("existing")===0?"update":"create",d=(k,u,w)=>{if(w)return String(k||"");let h=String(k||"").trim()?k:u||"";return String(h||"")},o=()=>{if(i)return;let k=e==="update";n.forEach(({key:u,textarea:w,updateInput:h})=>{if(!w)return;let v=w.value||"";if(!k){a.create[u]=v;return}r[u]&&(a.update[u]=v,h&&(h.value=v))})},l=()=>{i=!0;let k=e==="update";n.forEach(({key:u,textarea:w,updateInput:h})=>{if(!w)return;let v=a.create[u]||"",C=a.update[u]||"",x=!!r[u],b=k?d(C,v,x):v;w.value=b||"",k&&h&&(h.value=x?C:"")}),i=!1},_=k=>{let u=t(s(k));u!==e&&(o(),e=u,l())},p=k=>{!k||k.dataset.aipkitPromptModeInit==="true"||(n=g.map(u=>{let w=k.querySelector(`#${u.textareaId}`)||document.getElementById(u.textareaId),h=k.querySelector(`#${u.updateInputId}`)||document.getElementById(u.updateInputId);return{...u,textarea:w,updateInput:h}}),n.some(u=>u.textarea)&&(n.forEach(u=>{let w=u.textarea&&u.textarea.value||"";a.create[u.key]=w;let h=u.updateInput&&u.updateInput.value||"";a.update[u.key]=h,r[u.key]=!!h,u.textarea&&!u.textarea.dataset.aipkitPromptModeListener&&(u.textarea.addEventListener("input",()=>{if(i)return;let v=u.textarea.value||"";e==="update"?(a.update[u.key]=v,r[u.key]=!0,u.updateInput&&(u.updateInput.value=v)):a.create[u.key]=v}),u.textarea.dataset.aipkitPromptModeListener="true")}),k.dataset.aipkitPromptModeInit="true",_(c())))},f=k=>{if(!k||typeof k!="object")return;let u=w=>Object.prototype.hasOwnProperty.call(k,w);n.forEach(w=>{let h=w.key,v=`${h}_update`;if(u(h)&&(a.create[h]=k[h]||""),u(v)){let C=k[v]||"";a.update[h]=C,r[h]=!!C,w.updateInput&&(w.updateInput.value=r[h]?C:"")}}),l()},m=()=>({create:{...a.create},update:{...a.update}});window.aipkit_initContentWriterPromptModeManager=p,window.aipkit_setContentWriterPromptMode=_,window.aipkit_applyContentWriterPromptSets=f,window.aipkit_getContentWriterPromptSets=m})();(function(){"use strict";let g={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"],image_title:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_alt_text:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_caption:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_description:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"]},a=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}","{price}","{regular_price}","{sale_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{total_sales}","{product_categories}"],r={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},n={existing:{title:["{original_title}","{original_content}","{original_focus_keyword}"],content:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],meta:["{original_title}","{original_content}","{original_focus_keyword}","{original_tags}","{categories}"],keyword:["{original_title}","{original_content}"],excerpt:["{original_title}","{original_content}","{original_excerpt}"],tags:["{original_title}","{original_content}","{original_tags}","{categories}"],image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],featured_image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"]},"existing-images":{title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],content:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],excerpt:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],keyword:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_alt_text:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_caption:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_description:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],featured_image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"]},"existing-products":{title:a,content:a,meta:a,keyword:a,excerpt:a,tags:a}},e={aipkit_cw_image_title_prompt:"image_title",aipkit_cw_image_alt_text_prompt:"image_alt_text",aipkit_cw_image_caption_prompt:"image_caption",aipkit_cw_image_description_prompt:"image_description"},i=_=>String(_??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),s=()=>{let p=document.getElementById("aipkit_cw_mode_select")?.value||"task";return p==="single"&&(p="task"),p},c=(_,p)=>{let f=window.aipkit_content_writer_config?.default_prompts||{};if(p==="existing-images"){let m=`${_}_update`;if(f[m])return f[m]}return f[_]||""},t=(_,p)=>{let f=n[p]||(p.indexOf("existing")===0?n.existing:null);if(f&&f[_])return f[_];let m=g[_]||[],k=r[p]||[],u=[...m,...k];return u.filter((w,h)=>u.indexOf(w)===h)},d=(_,p)=>{if(!_)return;let f=_.dataset.label||"Variables:",m=_.dataset.copyTitle||"Click to copy";_.innerHTML=`${i(f)} `,p.forEach((k,u)=>{let w=document.createElement("code");w.className="aipkit-placeholder",w.title=m,w.textContent=k,_.appendChild(w),u<p.length-1&&_.appendChild(document.createTextNode(" "))})},o=_=>{let p=_?.querySelector(".aipkit_cw_prompt_editor_placeholders");if(!p)return;let f=p.dataset.promptType||"",m=s(),k=t(f,m);d(p,k)};function l(_){if(!_)return;let p=_.querySelectorAll("[data-aipkit-flyout-target]");if(!p.length)return;let f=_.querySelectorAll(".aipkit_cw_prompt_library_select"),m=y=>{f.length&&f.forEach(q=>{let E=q.getAttribute("data-aipkit-prompt-target"),S=e[E];if(!S)return;let A=q.options?q.options[0]:null;if(!A)return;if(Array.from(q.options).forEach((M,V)=>{let W=M.dataset.aipkitMode||"both",R=!0;V!==0&&(y==="existing-images"?R=W!=="create":R=W!=="update"),M.hidden=!R}),q.dataset.aipkitDefaultCreate||(q.dataset.aipkitDefaultCreate=A.value||""),y==="existing-images"){let M=c(S,y);M&&(q.dataset.aipkitDefaultUpdate=M,A.value=M)}else A.value=q.dataset.aipkitDefaultCreate||A.value||"";q.selectedOptions.length&&q.selectedOptions[0].hidden&&(q.selectedIndex=0)})},k=null,u=null,w=!1,h=y=>y?_.querySelector(`#${y}`):null,v=(y,q,E)=>{if(!y||!q)return;let S=y.getBoundingClientRect(),A=E?E.getBoundingClientRect():S,T=q.getBoundingClientRect(),M=T.width||440,V=T.height||0,W=window.innerWidth,R=window.innerHeight,B=12,$=A.left-M-10;$<B&&($=A.right+10),$=Math.max(B,Math.min($,W-M-B));let G=A.top;G+V>R-B&&(G=R-V-B),G=Math.max(B,G),k.style.left=`${Math.round($)}px`,k.style.top=`${Math.round(G)}px`},C=()=>{!u||!k||w||(w=!0,window.requestAnimationFrame(()=>{let y=k.querySelector(".aipkit_cw_prompt_panel"),q=u.closest(".aipkit_model_settings_popover_panel");v(u,y,q),w=!1}))},x=()=>{k&&(k.classList.remove("is-open"),k.setAttribute("aria-hidden","true"),u&&u.setAttribute("aria-expanded","false"),k=null,u=null)},b=y=>{let q=y.getAttribute("data-aipkit-flyout-target"),E=h(q);if(!E)return;k&&k!==E&&x(),k=E,u=y,E.classList.add("is-open"),E.setAttribute("aria-hidden","false"),y.setAttribute("aria-expanded","true"),o(E);let S=E.querySelector(".aipkit_cw_prompt_panel"),A=y.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{v(y,S,A)})};p.forEach(y=>{y.dataset.flyoutListenerAttached!=="true"&&(y.addEventListener("click",q=>{if(q.preventDefault(),k&&u===y&&k.classList.contains("is-open")){x();return}b(y)}),y.dataset.flyoutListenerAttached="true")});let I=s();if(m(I),f.forEach(y=>{let q=y.getAttribute("data-aipkit-prompt-target"),E=q?_.querySelector(`#${q}`):null;E&&typeof E.value=="string"&&E.value.trim()===""&&y.value&&(E.value=y.value),y.dataset.promptLibraryAttached!=="true"&&(y.addEventListener("change",()=>{let S=y.value;if(!S)return;let A=y.getAttribute("data-aipkit-prompt-target"),T=A?_.querySelector(`#${A}`):null;if(!T)return;T.value=S,T.dispatchEvent(new Event("input",{bubbles:!0})),typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave();let M=y.options?y.options[0]:null;M&&M.value===""&&(y.value="",y.selectedIndex=0)}),y.dataset.promptLibraryAttached="true")}),_.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(y=>{y.dataset.overlayListenerAttached!=="true"&&(y.addEventListener("click",E=>{E.target===y&&x()}),y.dataset.overlayListenerAttached="true");let q=y.querySelector(".aipkit_popover_flyout_close");q&&q.dataset.flyoutListenerAttached!=="true"&&(q.addEventListener("click",E=>{E.preventDefault(),x()}),q.dataset.flyoutListenerAttached="true")}),_.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",y=>{y.key==="Escape"&&k&&x()}),_.dataset.promptFlyoutEscapeAttached="true"),_.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",y=>{if(!k)return;let q=y.target;q.closest(".aipkit_cw_prompt_flyout")||q.closest("[data-aipkit-flyout-target]")||x()}),_.dataset.promptFlyoutClickAttached="true"),_.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",C),window.addEventListener("scroll",C,!0),_.dataset.promptFlyoutRepositionAttached="true"),_.dataset.promptFlyoutModeAttached!=="true"){let y=document.getElementById("aipkit_cw_mode_select");y&&y.addEventListener("change",()=>{m(s()),k&&o(k)}),_.dataset.promptFlyoutModeAttached="true"}window.aipkit_closeContentWriterPromptFlyout=x}window.aipkit_initContentWriterPromptFlyouts=l})();(function(){"use strict";let r=s=>String(s||"").replace(/\|/g," ").replace(/\r?\n/g," ").trim(),n=s=>{let c=String(s||"").trim();if(!c)return{value:"",raw:""};let t=c.match(/^(\d{4}-\d{2}-\d{2})(?:[T\s])(\d{2}:\d{2})(?::\d{2})?$/);return t?{value:`${t[1]}T${t[2]}`,raw:""}:{value:"",raw:c}},e=s=>s?s.replace("T"," ").trim():"";function i(s){let c=s||document.getElementById("aipkit_content_writer_container");if(!c)return;let t=c.querySelector("[data-aipkit-bulk-editor]");if(!t||t.dataset.bulkEditorAttached==="true")return;let d=t.querySelector("[data-aipkit-bulk-rows]"),o=t.querySelector("#aipkit_cw_bulk_row_template"),l=t.querySelector("#aipkit_cw_bulk_topics"),_=t.querySelector(".aipkit_cw_bulk_add_row"),p=t.querySelector(".aipkit_cw_bulk_toggle_raw"),f=t.querySelector("#aipkit_cw_bulk_raw"),m=t.querySelector(".aipkit_cw_bulk_grid"),k=t.querySelector(".aipkit_cw_bulk_toggle_details");if(!d||!o||!l)return;let u=!1,w,h=(M,V)=>M?M.querySelector(`[data-bulk-field="${V}"]`):null,v=()=>{Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")).forEach((V,W)=>{let R=V.querySelector(".aipkit_cw_bulk_row_number");R&&(R.textContent=W+1)})},C=M=>{let V=r(h(M,"topic")?.value||""),W=r(h(M,"keywords")?.value||""),R=r(h(M,"category")?.value||""),B=r(h(M,"author")?.value||""),$=r(h(M,"type")?.value||""),G=h(M,"schedule")?.value||"";return G?(G=e(G),M.dataset.rawSchedule=""):M.dataset.rawSchedule&&(G=M.dataset.rawSchedule),{topic:V,keywords:W,category:R,author:B,type:$,schedule:G}},x=(M,V)=>{if(!M||!V)return;let W=(B,$)=>{let G=h(M,B);G&&(G.value=$||"")};W("topic",V.topic||""),W("keywords",V.keywords||""),W("category",V.category||""),W("author",V.author||""),W("type",V.type||"");let R=h(M,"schedule");if(R){let B=n(V.schedule||"");R.value=B.value,M.dataset.rawSchedule=B.raw||""}},b=()=>{let M=Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")),V=[];return M.forEach(W=>{let{topic:R,keywords:B,category:$,author:G,type:L,schedule:K}=C(W);if(!R)return;let H=[R,B,$,G,L,K],ne=-1;H.forEach((ae,Z)=>{ae&&(ne=Z)}),ne!==-1&&V.push(H.slice(0,ne+1).join(" | "))}),V.join(`
`)},I=()=>{l&&(u=!0,l.value=b(),l.dispatchEvent(new Event("change",{bubbles:!0})),u=!1)},y=M=>{t.classList.toggle("is-details-open",M),k&&k.setAttribute("aria-expanded",M?"true":"false")},q=M=>{if(f){if(t.classList.toggle("is-raw-open",M),f.hidden=!M,p){p.setAttribute("aria-expanded",M?"true":"false");let V=M?p.dataset.labelGrid:p.dataset.labelRaw;if(V){let W=p.querySelector(".aipkit_cw_toggle_label");W?W.textContent=V:p.textContent=V}}m&&(m.hidden=M),_&&(_.hidden=M,_.disabled=M),k&&(k.hidden=M,M&&k.setAttribute("aria-expanded","false"))}},E=M=>{let W=document.importNode(o.content,!0).querySelector("[data-aipkit-bulk-row]");return W?(x(W,M||{}),W):null},S=()=>{let M=d.querySelectorAll("[data-aipkit-bulk-row]");if(M.length>=1)return;let V=1-M.length;for(let W=0;W<V;W++){let R=E();R&&d.appendChild(R)}},A=()=>{let M=Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")),V=M[M.length-1];if(!V)return;let W=C(V);if(Object.values(W).some(B=>B)&&M.length<100){let B=E();B&&(d.appendChild(B),v())}},T=()=>{let V=(l.value||"").split(/\r?\n/).filter(R=>R.trim()!=="");d.innerHTML="";let W=[];if(V.slice(0,100).forEach(R=>{let B=R.split("|").map(L=>L.trim()),$={topic:B[0]||"",keywords:B[1]||"",category:B[2]||"",author:B[3]||"",type:B[4]||"",schedule:B[5]||""},G=E($);G&&W.push(G)}),!W.length){S(),v(),I();return}W.forEach(R=>d.appendChild(R)),S(),v()};l.value.trim()?T():(S(),v(),I()),q(!f.hidden),k&&!k.dataset.listenerAttached&&(k.addEventListener("click",M=>{M.preventDefault();let V=t.classList.contains("is-details-open");y(!V)}),k.dataset.listenerAttached="true",y(!1)),d.addEventListener("input",M=>{let V=M.target;!V||!V.closest("[data-aipkit-bulk-row]")||(I(),A())}),d.addEventListener("change",M=>{let V=M.target;!V||!V.closest("[data-aipkit-bulk-row]")||(I(),A())}),d.addEventListener("click",M=>{let V=M.target.closest(".aipkit_cw_bulk_remove_row");if(!V)return;let W=V.closest("[data-aipkit-bulk-row]");if(!W)return;d.querySelectorAll("[data-aipkit-bulk-row]").length<=1?W.querySelectorAll("input, select").forEach(B=>{B.value=""}):W.remove(),I(),v(),A()}),_&&_.addEventListener("click",M=>{if(M.preventDefault(),d.querySelectorAll("[data-aipkit-bulk-row]").length>=100)return;let W=E();W&&d.appendChild(W),v()}),p&&f&&p.addEventListener("click",M=>{M.preventDefault();let V=!f.hidden;q(!V)}),l.addEventListener("input",()=>{u||(clearTimeout(w),w=setTimeout(()=>{T()},250))}),t.dataset.bulkEditorAttached="true"}window.aipkit_initContentWriterBulkEditor=i})();(function(){"use strict";let g=null,a=0;function r(){if(!g)return;let i=g;g=null,i.classList.remove("aipkit-active"),i.__aipkitAlertKeydown&&(document.removeEventListener("keydown",i.__aipkitAlertKeydown),i.__aipkitAlertKeydown=null);let s=()=>{i.parentNode&&i.parentNode.removeChild(i)};i.addEventListener("transitionend",s,{once:!0}),window.setTimeout(s,250)}function n(i,s={}){let c=s.title||"Notice",t=s.okText||"OK",d=s.okClass||"aipkit_btn-primary",o=Array.isArray(s.actions)?s.actions:null,l=Array.isArray(s.bullets)?s.bullets:null;g&&r();let _=document.createElement("div");_.className="aipkit-modal-overlay",_.addEventListener("click",b=>{b.target===_&&r()});let p=`aipkit_cw_alert_${Date.now()}_${a++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${p}_title`);let m=document.createElement("div");m.className="aipkit-modal-header";let k=document.createElement("h3");k.className="aipkit-modal-title",k.id=`${p}_title`,k.textContent=c;let u=document.createElement("button");u.type="button",u.className="aipkit-modal-close-btn",u.setAttribute("aria-label","Close"),u.textContent="\xD7",m.appendChild(k),m.appendChild(u);let w=document.createElement("div");w.className="aipkit-modal-body";let h=document.createElement("p");if(h.className="aipkit_cw_alert_modal_message",h.textContent=i||"",l&&l.length){let b=document.createElement("ul");b.className="aipkit_cw_alert_modal_list",l.forEach(I=>{let y=document.createElement("li");y.textContent=I,b.appendChild(y)}),w.appendChild(h),w.appendChild(b)}else w.appendChild(h);let v=document.createElement("div");v.className="aipkit_cw_alert_modal_actions";let C=null;if(o&&o.length)o.forEach((b,I)=>{let y=!!(b&&b.href),q=b?.label||(I===0?t:"Close"),E=b?.className||(I===0?"aipkit_btn aipkit_btn-primary":"aipkit_btn aipkit_btn-secondary"),S=document.createElement(y?"a":"button");S.className=E,S.textContent=q,y?(S.href=b.href,S.target=b.target||"_blank",S.rel=b.rel||"noopener noreferrer"):S.type="button";let A=()=>{typeof b?.onClick=="function"&&b.onClick(),b?.closeOnClick!==!1&&r()};S.addEventListener("click",A),v.appendChild(S),C||(C=S)});else{let b=document.createElement("button");b.type="button",b.className=`aipkit_btn ${d}`,b.textContent=t,b.addEventListener("click",r),v.appendChild(b),C=b}w.appendChild(v),f.appendChild(m),f.appendChild(w),_.appendChild(f),document.body.appendChild(_);let x=b=>{b.key==="Escape"&&r()};_.__aipkitAlertKeydown=x,document.addEventListener("keydown",x),u.addEventListener("click",r),window.requestAnimationFrame(()=>{_.classList.add("aipkit-active"),C&&C.focus()}),g=_}function e(i,s={}){let c=s.title||"Confirm",t=s.confirmText||"Confirm",d=s.cancelText||"Cancel",o=typeof s.onConfirm=="function"?s.onConfirm:null,l=typeof s.onCancel=="function"?s.onCancel:null;g&&r();let _=document.createElement("div");_.className="aipkit-modal-overlay",_.addEventListener("click",I=>{I.target===_&&(r(),l&&l())});let p=`aipkit_cw_confirm_${Date.now()}_${a++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${p}_title`);let m=document.createElement("div");m.className="aipkit-modal-header";let k=document.createElement("h3");k.className="aipkit-modal-title",k.id=`${p}_title`,k.textContent=c;let u=document.createElement("button");u.type="button",u.className="aipkit-modal-close-btn",u.setAttribute("aria-label","Close"),u.textContent="\xD7",m.appendChild(k),m.appendChild(u);let w=document.createElement("div");w.className="aipkit-modal-body";let h=document.createElement("p");h.className="aipkit_cw_alert_modal_message",h.textContent=i||"";let v=document.createElement("div");v.className="aipkit_cw_alert_modal_actions";let C=document.createElement("button");C.type="button",C.className="aipkit_btn aipkit_btn-secondary",C.textContent=d;let x=document.createElement("button");x.type="button",x.className="aipkit_btn aipkit_btn-primary",x.textContent=t,v.appendChild(C),v.appendChild(x),w.appendChild(h),w.appendChild(v),f.appendChild(m),f.appendChild(w),_.appendChild(f),document.body.appendChild(_);let b=I=>{I.key==="Escape"&&(r(),l&&l())};_.__aipkitAlertKeydown=b,document.addEventListener("keydown",b),u.addEventListener("click",()=>{r(),l&&l()}),C.addEventListener("click",()=>{r(),l&&l()}),x.addEventListener("click",()=>{r(),o&&o()}),window.requestAnimationFrame(()=>{_.classList.add("aipkit-active"),x.focus()}),g=_}window.aipkit_showAlertModal=n,window.aipkit_showConfirmModal=e,window.aipkit_closeAlertModal=r})();(function(){"use strict";function g(a,r){if(!a||!r||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(a.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(a,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(a,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary();else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let n=window.aipkit_escapeHtml||function(e){return e};r.innerHTML='<option value="">'+n("Models unavailable (Data Object Missing)")+"</option>",r.disabled=!0}}window.aipkit_handleProviderModelDropdowns=g})();(function(){"use strict";function g(a){if(!a){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let r=document.getElementById("aipkit_content_writer_temperature_value");r?a.dataset.listenerAttached||(a.addEventListener("input",()=>r.textContent=a.value),a.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=g})();(function(){"use strict";function g(a){if(!a){console.warn("Copy Button Handler: Button element not provided.");return}a.dataset.listenerAttached||(a.addEventListener("click",()=>{let r=document.getElementById("aipkit_cw_generated_title_display"),n=document.getElementById("aipkit_cw_generated_content_area"),e="";r&&r.style.display!=="none"&&(e+=r.textContent+`

`),n&&(e+=n.innerText),e.trim()&&navigator.clipboard.writeText(e.trim()).then(()=>{let i=a.querySelector(".dashicons");if(i){let s=i.className;i.className="dashicons dashicons-yes",setTimeout(()=>{i.className=s},1500)}}).catch(i=>console.error("Failed to copy: ",i))}),a.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=g})();(function(){"use strict";function g(){let r=document.getElementById("aipkit_cw_single_output_wrapper"),n=document.getElementById("aipkit_cw_output_card"),e=document.getElementById("aipkit_content_writer_output_display"),i=document.getElementById("aipkit_cw_generated_content_area"),s=document.querySelector(".aipkit_content_writer_output_actions"),c=document.getElementById("aipkit_cw_status_display_container"),t=document.getElementById("aipkit_cw_generated_title_display"),d=document.getElementById("aipkit_cw_meta_chunk"),o=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),l=document.getElementById("aipkit_cw_generated_meta_desc"),_=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),p=document.getElementById("aipkit_cw_generated_focus_keyword"),f=document.getElementById("aipkit_cw_excerpt_output_wrapper"),m=document.getElementById("aipkit_cw_generated_excerpt"),k=document.getElementById("aipkit_cw_tags_output_wrapper"),u=document.getElementById("aipkit_cw_generated_tags"),w=document.getElementById("aipkit_cw_image_data_holder"),h=document.getElementById("aipkit_content_writer_copy_btn"),v=document.getElementById("aipkit_content_writer_clear_btn");if(r&&(r.style.display="none"),n&&(n.style.display="none"),e&&i){i.classList.remove("is-streaming");let C=i.closest(".aipkit_cw_output_chunk--primary");C&&C.classList.remove("has-overflow"),i.innerHTML="",e.scrollTop=0,s&&(s.style.display="none"),h&&(h.disabled=!0),v&&(v.disabled=!0),typeof window.aipkit_resetContentWriterRawHtml=="function"&&window.aipkit_resetContentWriterRawHtml(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction();let x=document.getElementById("aipkit_content_writer_form_status");x&&(x.textContent=""),c&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():c&&(c.style.display="none"),t&&(t.style.display="none",t.textContent=""),d&&(d.style.display="none"),o&&(o.style.display="none"),l&&(l.value=""),_&&(_.style.display="none"),p&&(p.value=""),f&&(f.style.display="none"),m&&(m.value=""),k&&(k.style.display="none"),u&&(u.value=""),w&&(w.value=""),typeof window.aipkit_updateMetaCountBadge=="function"&&window.aipkit_updateMetaCountBadge(),typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_resetContentWriterPreviewCounter=="function"&&window.aipkit_resetContentWriterPreviewCounter()}}function a(r,n){if(!r){console.warn("Clear Button Handler: Button element not provided.");return}r.dataset.listenerAttached||(r.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),r.dataset.listenerAttached="true")}window.aipkit_handleClearButton=a,window.aipkit_clearContentWriterOutput=g})();(function(){"use strict";function g(){return document.getElementById("aipkit_cw_expand_preview_btn")}function a(d){return d?d.closest(".aipkit_cw_output_chunk--primary"):document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_chunk--primary")}function r(d,o,l){return d?o==="restore"?d.dataset.labelRestore||l:d.dataset.labelExpand||l:l}function n(d,o){if(!d)return;let l=d.querySelector(".aipkit_cw_expand_label"),_=d.querySelector(".dashicons"),p=o?r(d,"restore","Restore preview"):r(d,"expand","Expand preview");l&&(l.textContent=p),d.setAttribute("title",p),d.setAttribute("aria-pressed",o?"true":"false"),_&&(_.classList.toggle("dashicons-fullscreen-alt",!o),_.classList.toggle("dashicons-fullscreen-exit-alt",o))}function e(d){let o=document.getElementById("aipkit_content_writer_output_display");!o||!d||(o.scrollHeight>o.clientHeight?d.classList.add("has-overflow"):d.classList.remove("has-overflow"))}function i(d){let o=g(),l=a(o);!o||!l||(d?l.classList.add("is-expanded"):l.classList.remove("is-expanded"),n(o,d),requestAnimationFrame(()=>e(l)))}function s(d){let o=g();o&&(o.disabled=!d,o.setAttribute("aria-disabled",d?"false":"true"),d||i(!1))}function c(){i(!1)}function t(){document.body?.dataset?.aipkitPreviewToggleAttached!=="true"&&(document.addEventListener("click",d=>{let o=d.target.closest("#aipkit_cw_expand_preview_btn");if(!o||o.disabled)return;let l=a(o);if(!l)return;let _=l.classList.contains("is-expanded");i(!_)}),document.body&&(document.body.dataset.aipkitPreviewToggleAttached="true"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t(),window.aipkit_resetContentWriterPreviewSize=c,window.aipkit_setContentWriterPreviewExpandEnabled=s})();(function(){"use strict";let g=u=>!u||typeof u!="object"?"":u.media_library_url||u.url||u.src||u.image_url||u.preview_url||"",a=u=>u==null?"":String(u).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=()=>{if(typeof window.aipkit_getContentWriterRawHtml=="function")return window.aipkit_getContentWriterRawHtml()||"";let u=document.getElementById("aipkit_cw_generated_content_area");return u?u.innerHTML:""},n=()=>{let u=document.getElementById("aipkit_cw_generated_content_area");if(!u)return;let w=r();w&&(u.innerHTML=w)},e=()=>({preview:document.getElementById("aipkit_cw_image_preview"),featuredWrap:document.getElementById("aipkit_cw_featured_image"),featuredImg:document.getElementById("aipkit_cw_featured_image_img"),inlineToggle:document.getElementById("aipkit_cw_inline_images_toggle"),inlineCount:document.getElementById("aipkit_cw_inline_images_count"),inlineGrid:document.getElementById("aipkit_cw_inline_images_grid")}),i=(u,w,h="")=>{u&&(u.hidden=!w,w?u.style.display=h||"":u.style.display="none")},s=u=>{u&&(u.innerHTML="",i(u,!1,"grid"))},c=()=>{let u=e();u.preview&&(u.featuredImg&&u.featuredImg.removeAttribute("src"),i(u.featuredWrap,!1,"flex"),u.inlineToggle&&(u.inlineToggle.setAttribute("aria-expanded","false"),u.inlineToggle.classList.remove("is-open")),u.inlineCount&&(u.inlineCount.textContent="0"),s(u.inlineGrid),i(u.inlineToggle,!1,"inline-flex"),i(u.preview,!1,"flex"),n())},t=u=>{!u.inlineToggle||!u.inlineGrid||u.inlineToggle.dataset.listenerAttached!=="true"&&(u.inlineToggle.addEventListener("click",()=>{let w=u.inlineToggle.getAttribute("aria-expanded")==="true";u.inlineToggle.setAttribute("aria-expanded",w?"false":"true"),u.inlineToggle.classList.toggle("is-open",!w),i(u.inlineGrid,!w,"grid")}),u.inlineToggle.dataset.listenerAttached="true")},d=(u,w)=>{if(!u.inlineToggle||!u.inlineGrid||!w.length)return!1;s(u.inlineGrid);let h=document.createDocumentFragment();return w.forEach((v,C)=>{let x=document.createElement("div");x.className="aipkit_cw_inline_image";let b=document.createElement("img");b.src=v,b.alt=`Generated image ${C+1}`,b.loading="lazy",b.decoding="async",x.appendChild(b),h.appendChild(x)}),u.inlineGrid.appendChild(h),i(u.inlineGrid,!1,"grid"),i(u.inlineToggle,!0,"inline-flex"),u.inlineToggle.setAttribute("aria-expanded","false"),u.inlineToggle.classList.remove("is-open"),u.inlineCount&&(u.inlineCount.textContent=String(w.length)),t(u),!0},o=(u,w,h)=>{let v=g(u);if(!v)return"";let C=u.alt||u.revised_prompt||u.caption||"Image",x=[];return["left","right","center","none"].includes(w)&&x.push(`align${w}`),x.push(`size-${h||"large"}`),`<img class="${a(x.join(" "))}" src="${a(v)}" alt="${a(C)}" loading="lazy" decoding="async" />`},l=(u,w)=>w.length?`${u}

${w.join(`

`)}`:u,_=(u,w,h)=>{if(!w.length)return u;let v=w.shift(),C=u.toLowerCase(),x=`</${h}>`,b=C.indexOf(x);return b!==-1?u=u.slice(0,b+x.length)+`

${v}

`+u.slice(b+x.length):u+=`

${v}`,l(u,w)},p=(u,w,h,v)=>{if(!w.length)return u;if(!v||v<=0)return l(u,w);let C=u.split(new RegExp(`(</${h}>)`,"ig")),x="",b=0,I=0;for(let y=0;y<C.length;y+=1)x+=C[y],y%2===1&&(b+=1,b%v===0&&I<w.length&&(x+=`

${w[I]}

`,I+=1));for(;I<w.length;)x+=`

${w[I]}`,I+=1;return x},f=u=>{let w=document.getElementById("aipkit_cw_generated_content_area");if(!w)return;let h=Array.isArray(u?.in_content_images)?u.in_content_images:[];if(!h.length){n();return}let v=r();if(v||(v=w.innerHTML),!v)return;let C=document.getElementById("aipkit_content_writer_form"),x=u?.placement_settings?.placement||C?.elements.image_placement?.value||"after_first_h2",b=u?.placement_settings?.param_x||C?.elements.image_placement_param_x?.value||2,I=parseInt(b,10)||2,y=C?.elements.image_alignment?.value||"none",q=C?.elements.image_size?.value||"large",E=h.map(A=>o(A,y,q)).filter(Boolean);if(!E.length){n();return}let S=v;switch(x){case"after_first_h2":S=_(S,E,"h2");break;case"after_first_h3":S=_(S,E,"h3");break;case"after_every_x_h2":S=p(S,E,"h2",I);break;case"after_every_x_h3":S=p(S,E,"h3",I);break;case"after_every_x_p":S=p(S,E,"p",I);break;case"at_end":default:S=l(S,E);break}w.innerHTML=S,typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()},m=(u,w)=>!u.featuredWrap||!u.featuredImg||!w?!1:(u.featuredImg.src=w,i(u.featuredWrap,!0,"flex"),!0),k=u=>{let w=e();if(!w.preview)return;c();let h=u;if(typeof u=="string")try{h=JSON.parse(u)}catch{return}if(!h||typeof h!="object")return;let C=(Array.isArray(h.in_content_images)?h.in_content_images:[]).map(g).filter(Boolean),x=h.featured_image_url||g(h.featured_image)||g(h.featured_image_data),b=m(w,x),I=d(w,C);f(h),(b||I)&&i(w.preview,!0,"flex")};window.aipkit_renderContentWriterImagePreview=k,window.aipkit_clearContentWriterImagePreview=c})();(function(){"use strict";function g(){let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let n=r.elements.generate_meta_description,e=r.elements.generate_focus_keyword,i=r.elements.generate_excerpt,s=r.elements.generate_tags,c=r.querySelector(".aipkit_cw_prompt_row--meta"),t=r.querySelector(".aipkit_cw_prompt_row--keyword"),d=r.querySelector(".aipkit_cw_prompt_row--excerpt"),o=r.querySelector(".aipkit_cw_prompt_row--tags"),l=!!(n&&n.checked),_=!!(e&&e.checked),p=!!(i&&i.checked),f=!!(s&&s.checked),m=(u,w)=>{if(!u)return;u.classList.toggle("aipkit_popover_option_row--disabled",!w);let h=u.querySelector(".aipkit_cw_prompt_trigger");h&&(h.disabled=!w,h.setAttribute("aria-disabled",w?"false":"true"))};m(c,l),m(t,_),m(d,p),m(o,f);let k=r.querySelector(".aipkit_cw_prompt_flyout.is-open");if(k){let u=[];l||u.push("aipkit_cw_meta_prompt_flyout"),_||u.push("aipkit_cw_keyword_prompt_flyout"),p||u.push("aipkit_cw_excerpt_prompt_flyout"),f||u.push("aipkit_cw_tags_prompt_flyout"),u.includes(k.id)&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout()}}function a(){let r=document.getElementById("aipkit_content_writer_form");if(!r||r.dataset.optionToggleListenerAttached)return;let n=r.elements.generate_meta_description,e=r.elements.generate_focus_keyword,i=r.elements.generate_excerpt,s=r.elements.generate_tags;n&&n.addEventListener("change",g),e&&e.addEventListener("change",g),i&&i.addEventListener("change",g),s&&s.addEventListener("change",g),r.dataset.optionToggleListenerAttached="true",g()}window.aipkit_cw_toggleCustomOptionPrompts=g,window.aipkit_cw_initOptionPromptToggles=a})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.warn("Prompt Toggle Handler: Content writer container not found.");return}a.querySelectorAll(".aipkit_textarea_toggle").forEach(e=>{let i=e.dataset.target;if(!i)return;let s=`aipkit-cw-prompt-${i}-state`,c=localStorage.getItem(s),t=document.getElementById(i),d=e.querySelector(".dashicons");t&&d&&(c==="expanded"?(t.classList.remove("aipkit_collapsed"),d.classList.remove("dashicons-plus-alt2"),d.classList.add("dashicons-minus"),e.title="Collapse"):(t.classList.add("aipkit_collapsed"),d.classList.remove("dashicons-minus"),d.classList.add("dashicons-plus-alt2"),e.title="Expand"))});let n="data-prompt-toggle-listener-attached";a.getAttribute(n)||(a.addEventListener("click",function(e){let i=e.target.closest(".aipkit_textarea_toggle");if(!i)return;let s=i.dataset.target,c=document.getElementById(s),t=i.querySelector(".dashicons");if(!c||!t){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",i);return}let d=c.classList.toggle("aipkit_collapsed");d?(t.classList.remove("dashicons-minus"),t.classList.add("dashicons-plus-alt2"),i.title="Expand"):(t.classList.remove("dashicons-plus-alt2"),t.classList.add("dashicons-minus"),i.title="Collapse");let o=`aipkit-cw-prompt-${s}-state`;localStorage.setItem(o,d?"collapsed":"expanded")}),a.setAttribute(n,"true"))}window.aipkit_initPromptToggles=g})();(function(){"use strict";let g="";function a(_){g=typeof _=="string"?_:""}function r(){return g||""}function n(){g=""}function e(){let _=document.getElementById("aipkit_cw_meta_chunk");if(!_)return;let p=!1;_.querySelectorAll(".aipkit_cw_meta_field").forEach(m=>{window.getComputedStyle(m).display!=="none"&&(p=!0)}),_.style.display=p?"block":"none"}function i(){let _=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");_&&(_.style.display="flex")}function s(){let _=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");_&&(_.style.display="none")}function c(){let _=document.getElementById("aipkit_cw_article_counter"),p=document.getElementById("aipkit_cw_generated_content_area");if(!_||!p)return;if(p.querySelector(".aipkit_spinner")){_.textContent="",_.hidden=!0;return}let m=(p.textContent||"").trim(),k=m?m.split(/\s+/).length:0;if(!k){_.textContent="",_.hidden=!0;return}let u=k===1?"word":"words";_.textContent=`${k} ${u}`,_.hidden=!1}function t(){let _=document.getElementById("aipkit_cw_generated_content_area");if(!_)return;let p=!1,f=()=>{p||(p=!0,window.requestAnimationFrame(()=>{p=!1,c()}))};new MutationObserver(()=>{f()}).observe(_,{childList:!0,subtree:!0,characterData:!0}),f()}function d(){let _=document.getElementById("aipkit_cw_generated_meta_desc"),p=document.querySelector("#aipkit_content_writer_container .aipkit_cw_meta_char_count");if(!_||!p)return;function f(){let m=_.value.length,k=m>=120&&m<=160;p.textContent=`${m}/160`,p.style.color=k?"#16a34a":m>160?"#dc2626":"#94a3b8"}_.addEventListener("input",f),f()}function o(){if(!document.getElementById("aipkit_cw_meta_chunk"))return;let p=new MutationObserver(function(m){m.forEach(function(k){k.type==="attributes"&&k.attributeName==="style"&&e()})});["aipkit_cw_excerpt_output_wrapper","aipkit_cw_tags_output_wrapper","aipkit_cw_focus_keyword_output_wrapper","aipkit_cw_meta_desc_output_wrapper"].forEach(m=>{let k=document.getElementById(m);k&&p.observe(k,{attributes:!0,attributeFilter:["style"]})})}function l(){d(),o(),t()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),window.aipkit_updateMetaChunkVisibility=e,window.aipkit_showPrimaryAction=i,window.aipkit_hidePrimaryAction=s,window.aipkit_updateContentWriterPreviewCounter=c,window.aipkit_setContentWriterRawHtml=a,window.aipkit_getContentWriterRawHtml=r,window.aipkit_resetContentWriterRawHtml=n,window.aipkit_resetContentWriterPreviewCounter=function(){let _=document.getElementById("aipkit_cw_article_counter");_&&(_.textContent="",_.hidden=!0)}})();(function(){"use strict";function g(i){if(!i)return;let s=i.querySelector("#aipkit_content_writer_provider"),c=i.querySelector("#aipkit_content_writer_model"),t=i.querySelector(".aipkit_cw_reasoning_effort_field"),d=i.querySelector("#aipkit_content_writer_reasoning_effort");if(!s||!c||!t||!d){t&&(t.style.display="none");return}let o=(s.value||"").toLowerCase(),_=(c.value||"").toLowerCase(),p=_.startsWith("o1")||_.startsWith("o3")||_.startsWith("o4"),f=_.includes("gpt-5");o==="openai"&&(p||f)?(t.classList.contains("aipkit_popover_option_row")||t.classList.contains("aipkit_ai_behavior_control")?t.style.display="flex":t.style.display="block",a(i,_)):t.style.display="none"}function a(i,s){let c=i.querySelector("#aipkit_content_writer_reasoning_effort"),t=i.querySelectorAll(".aipkit_ai_reasoning_option");if(!c||!t.length)return;let d=r(s),o=new Set(d.allowed);t.forEach(m=>{let k=m.querySelector(".aipkit_ai_reasoning_input");if(!k)return;let u=k.value==="minimal"?"low":k.value,w=o.has(u);m.style.display=w?"":"none",w||(k.checked=!1)});let l=c.value||"";l==="minimal"&&(l="low");let _=i.querySelector(".aipkit_ai_reasoning_input:checked");!o.has(l)&&_&&(l=_.value),o.has(l)||(l=d.defaultValue),o.has(l)||(l=d.allowed[0]||"");let p=c.value;l&&(c.value=l);let f=i.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(f){f.checked=!0,i.querySelectorAll(".aipkit_ai_reasoning_option").forEach(k=>k.classList.remove("aipkit_ai_reasoning_option--selected"));let m=f.closest(".aipkit_ai_reasoning_option");m&&m.classList.add("aipkit_ai_reasoning_option--selected")}p!==c.value&&c.dispatchEvent(new Event("change",{bubbles:!0}))}function r(i){return e(i)?{allowed:["high"],defaultValue:"high"}:i.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(i)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(i){let s=i.match(/gpt-5\.(\d+)/);if(s)return Number.parseInt(s[1],10)>=2;let c=i.match(/gpt-(\d+)/);return c?Number.parseInt(c[1],10)>=6:!1}function e(i){return/gpt-5(\.\d+)?-pro/.test(i)}window.aipkit_cw_toggleReasoningEffort=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(k){return k},a=["pexels_api_key","pixabay_api_key"],r={},n={},e="",i=!1,s=!1,c="";function t(k){a.forEach(u=>{let w=k.querySelector(`.aipkit_cw_stock_api_key[name="${CSS.escape(u)}"]`);r[u]=w?w.value.trim():"",n[u]=!1})}function d(k){let u=k.querySelector("#aipkit_cw_replicate_api_key");e=u?u.value.trim():"",i=!1}async function o(k){if(!k||!k.name)return;let u=k.name;if(!a.includes(u))return;let w=k.value.trim(),h=r[u]||"";if(w===h||n[u]||typeof window.aipkit_apiRequest!="function")return;let v=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,C=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,x=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;n[u]=!0,r[u]=w,v&&v("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[u]:w}),C&&C("Updated")}catch(b){r[u]=h,x&&x(`Error: ${b.message||"Failed to save."}`),console.error("Content Writer Stock Image Key Save Error:",b)}finally{n[u]=!1}}async function l(k){if(!k)return;let u=k.value.trim(),w=e||"";if(u===w||i||typeof window.aipkit_apiRequest!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,v=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,C=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;i=!0,e=u,h&&h("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:u}),v&&v("Updated"),_(u,!0)}catch(x){e=w,C&&C(`Error: ${x.message||"Failed to save."}`),console.error("Content Writer Replicate Key Save Error:",x)}finally{i=!1}}function _(k,u=!1){let w=(k||"").trim();if(!w||s||!u&&w===c||typeof window.aipkit_queueProviderSync!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,v=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,C=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;s=!0,h&&h("Syncing models..."),window.aipkit_queueProviderSync("Replicate",{silent:!0,targetSelectId:"aipkit_cw_image_model",propagateError:!0}).then(()=>{c=w,v&&v("Models synced!")}).catch(x=>{C&&C(`Error: ${x.message||"Sync failed."}`),console.error("Content Writer Replicate Sync Error:",x)}).finally(()=>{s=!1})}function p(k){let u=document.getElementById("aipkit_cw_image_model");if(!u)return;let w=window.aipkit_dashboard?.imageGeneratorModels;if(!w){console.error("Image models data not found in aipkit_dashboard object."),u.innerHTML='<option value="">Error: Models not loaded</option>';return}let h=w[k.toLowerCase()]||[],v=window.aipkit_cw_template_state?.pendingImageModelSelection,C=u.value,x=v||C;u.innerHTML="",h.length>0?(h.forEach(b=>{u.appendChild(new Option(b.name,b.id))}),u.querySelector(`option[value="${CSS.escape(x)}"]`)?u.value=x:u.options.length>0&&(u.selectedIndex=0)):u.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function f(){let k=document.getElementById("aipkit_content_writer_container");if(!k)return;let u=k.querySelector(".aipkit_cw_image_enable_toggle"),w=k.querySelector("#aipkit_cw_generate_featured_image"),h=k.querySelector("#aipkit_cw_image_placement"),v=k.querySelector("#aipkit_cw_image_provider"),C=document.getElementById("aipkit_content_writer_form"),x=C?C.classList.contains("aipkit_cw_mode_existing_images"):!1,b=k.querySelectorAll(".aipkit_cw_image_settings_container"),I=k.querySelector(".aipkit_cw_prompt_row--image"),y=k.querySelector(".aipkit_cw_prompt_row--featured"),q=k.querySelector(".aipkit_cw_image_metadata_chunk"),E=Array.from(k.querySelectorAll(".aipkit_cw_image_metadata_subtoggle")).map(Z=>{let pe=Z.closest(".aipkit_image_toggle_card");return{toggle:Z,button:pe?pe.querySelector(".aipkit_cw_image_metadata_prompt_btn"):null}});if(!u||!w)return;let S=Z=>Z?Z.closest(".aipkit_popover_option_row")||Z.closest(".aipkit_form-group"):null,A=(Z,pe)=>{Z&&(pe?Z.style.display=Z.classList.contains("aipkit_popover_option_row")?"flex":"block":Z.style.display="none")},T=u.checked,M=w.checked,V=T||M||x,W=v?v.value:"",R=W==="pexels"||W==="pixabay";b.forEach(Z=>{Z.style.display=V?"block":"none"});let B=T&&!R,$=M&&!R,G=(Z,pe)=>{if(!Z)return;Z.style.display="",Z.classList.toggle("aipkit_popover_option_row--disabled",!pe);let ve=Z.querySelector(".aipkit_cw_prompt_trigger");ve&&(ve.disabled=!pe,ve.setAttribute("aria-disabled",pe?"false":"true"))};G(I,B),G(y,$);let L=x||V;if(q&&(q.style.display=L?"block":"none"),q){let Z=q.querySelector(".aipkit_image_settings_chunk_header--collapsible"),pe=q.querySelector(".aipkit_image_settings_chunk_body--collapsible");if(Z&&pe){let ve=x;Z.setAttribute("aria-expanded",ve?"true":"false"),pe.setAttribute("aria-hidden",ve?"false":"true")}}E.length>0&&E.forEach(({toggle:Z,button:pe})=>{let ve=L&&Z.checked;pe&&(pe.disabled=!ve,pe.setAttribute("aria-disabled",ve?"false":"true"))});let K=k.querySelector(".aipkit_cw_prompt_flyout.is-open"),H=K?k.querySelector(`.aipkit_cw_image_metadata_prompt_btn[data-aipkit-flyout-target="${CSS.escape(K.id)}"]`):null,ne=H?H.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_cw_image_metadata_subtoggle"):null,ae=ne&&L?ne.checked:!1;if(K&&(K.id==="aipkit_cw_image_prompt_flyout"&&!B||K.id==="aipkit_cw_featured_image_prompt_flyout"&&!$||ne&&!ae&&["aipkit_cw_image_title_prompt_flyout","aipkit_cw_image_alt_text_prompt_flyout","aipkit_cw_image_caption_prompt_flyout","aipkit_cw_image_description_prompt_flyout"].includes(K.id))&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),V){let Z=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],pe=k.querySelector("#aipkit_cw_replicate_options"),ve=k.querySelector("#aipkit_cw_pexels_options"),De=k.querySelector("#aipkit_cw_pixabay_options"),Qe=k.querySelector("#aipkit_cw_image_model_group");if(Z.forEach(lt=>{let it=k.querySelector(lt),we=S(it);A(we,T)}),h){let lt=k.querySelector(".aipkit_cw_image_placement_x_field");if(lt){let it=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(h.value);A(lt,T&&it)}}pe&&(pe.style.display=W==="replicate"?"block":"none"),ve&&(ve.style.display=R&&W==="pexels"?"block":"none"),De&&(De.style.display=R&&W==="pixabay"?"block":"none"),Qe&&(Qe.style.display=R?"none":"");let $e=k.querySelector("#aipkit_cw_image_model_wrapper");if($e&&($e.style.display=R?"none":""),!R&&W&&p(W),W==="replicate"){let lt=k.querySelector("#aipkit_cw_replicate_api_key");_(lt?lt.value:"",!1)}}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}function m(){let k=document.getElementById("aipkit_content_writer_container");k&&(k.dataset.imageHandlerAttached||(t(k),d(k),k.addEventListener("change",function(u){let w=u.target;if(w&&w.matches(".aipkit_cw_stock_api_key")){o(w);return}if(w&&w.matches(".aipkit_cw_replicate_api_key")){l(w);return}w.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider, .aipkit_cw_image_metadata_subtoggle")&&f()}),k.addEventListener("click",function(u){let w=u.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!w)return;let h=w.getAttribute("aria-expanded")==="true",v=w.getAttribute("aria-controls"),C=v?document.getElementById(v):null;w.setAttribute("aria-expanded",h?"false":"true"),C&&C.setAttribute("aria-hidden",h?"true":"false")}),f(),k.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=m,window.aipkit_updateImageSettingsUI=f})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(c){return c};function a(c){if(!c)return;let t=c.querySelector(".aipkit_cw_vector_store_toggle"),d=c.querySelectorAll(".aipkit_cw_vector_store_settings_container");if(t&&d.length>0){let o=t.checked;d.forEach(l=>{l.style.display=o?"block":"none"}),o&&r(c)}}function r(c){if(!c)return;let t=c.querySelector(".aipkit_cw_vector_store_provider_select");if(!t)return;let d=t.value,o=c.querySelector(".aipkit_cw_vector_openai_field"),l=c.querySelector(".aipkit_cw_vector_pinecone_field"),_=c.querySelector(".aipkit_cw_vector_qdrant_field"),p=c.querySelector(".aipkit_cw_vector_embedding_config_row"),f=(m,k)=>{m&&(m.style.display=k?"block":"none")};if(f(o,d==="openai"),f(l,d==="pinecone"),f(_,d==="qdrant"),p){let m=d==="pinecone"||d==="qdrant";if(p.style.display=m?"block":"none",m){let k=p.querySelector(".aipkit_cw_vector_embedding_provider_select");k&&n(k.value)}}}function n(c){let t=document.getElementById("aipkit_cw_vector_embedding_model");if(!t)return;let o=(window.aipkit_dashboard?.embeddingModels||{})[c.toLowerCase()]||[],l=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";t.innerHTML=`<option value="">${g("-- Select Model --")}</option>`,o.length>0?(o.forEach(_=>{if(_&&_.id){let p=new Option(g(_.name||_.id),_.id);_.id===l&&(p.selected=!0),t.appendChild(p)}}),t.disabled=!1):(t.disabled=!0,t.innerHTML=`<option value="">${g("-- No models found --")}</option>`)}function e(c){if(!c)return;let t=c.getAttribute("aria-expanded")==="true",d=c.getAttribute("aria-controls"),o=document.getElementById(d);o&&(c.setAttribute("aria-expanded",!t),o.setAttribute("aria-hidden",t))}function i(c){if(!c)return;let t=document.getElementById(c.id+"_value");if(!t)return;let d=c.value;c.id==="aipkit_cw_vector_store_confidence_threshold"&&(d=d+"%"),t.textContent=d}function s(){let c=document.getElementById("aipkit_content_writer_container");if(!c||c.dataset.vectorSettingsHandlerAttached)return;c.addEventListener("change",function(d){let o=d.target;if(o.matches(".aipkit_cw_vector_store_toggle")){let l=o.closest(".aipkit_vector_settings_redesigned")||o.closest(".aipkit_popover_options_list")||c;a(l)}else if(o.matches(".aipkit_cw_vector_store_provider_select")){let l=o.closest(".aipkit_vector_settings_redesigned")||o.closest(".aipkit_cw_vector_store_settings_container")||c;r(l)}else o.matches(".aipkit_cw_vector_embedding_provider_select")&&n(o.value);typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),c.addEventListener("input",function(d){let o=d.target;o.matches(".aipkit_vector_slider")&&i(o)}),c.addEventListener("click",function(d){let l=d.target.closest(".aipkit_vector_settings_chunk_header--collapsible");l&&(d.preventDefault(),e(l))}),c.querySelectorAll(".aipkit_vector_settings_redesigned, .aipkit_popover_options_list").forEach(d=>{d.querySelector(".aipkit_cw_vector_store_toggle")&&a(d)}),c.querySelectorAll(".aipkit_vector_slider").forEach(d=>{i(d)}),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),c.dataset.vectorSettingsHandlerAttached="true"}window.aipkit_initContentWriterVectorSettings=s,window.aipkit_cw_toggleVectorSettingsContainer=a,window.aipkit_cw_toggleProviderSpecificFields=r,window.aipkit_cw_populateEmbeddingModelSelect=n})();(function(){"use strict";function g(c){if(!c)return;let t=c.querySelector("#aipkit_content_writer_post_status"),d=c.querySelector(".aipkit_post_smart_schedule_container");if(!t)return;let o=t.value==="publish";d&&(d.style.display=o?"block":"none"),o&&a(c)}function a(c){if(!c)return;let t=c.querySelector('input[name="schedule_mode"]:checked'),d=c.querySelector(".aipkit_post_smart_schedule_fields");if(!d)return;let o=t&&t.value==="smart";d.style.display=o?"flex":"none"}function r(c){if(!c)return;let t=c.getAttribute("aria-expanded")==="true",d=c.getAttribute("aria-controls"),o=document.getElementById(d);o&&(c.setAttribute("aria-expanded",!t),o.setAttribute("aria-hidden",t))}function n(c){if(!c)return;let t=c.querySelector("#aipkit_content_writer_post_status");t&&(t.addEventListener("change",()=>{g(c)}),g(c)),c.querySelectorAll('input[name="schedule_mode"]').forEach(o=>{o.addEventListener("change",()=>{a(c)})}),a(c)}function e(){document.addEventListener("click",c=>{let t=c.target.closest(".aipkit_post_settings_chunk_header--collapsible");if(t){c.preventDefault(),r(t);return}}),document.addEventListener("keydown",c=>{if(c.key!=="Enter"&&c.key!==" ")return;let t=c.target.closest(".aipkit_post_settings_chunk_header--collapsible");t&&(c.preventDefault(),r(t))})}function i(c){let t=c.target;if(!t||!t.id||t.id!=="aipkit_cw_post_settings_popover")return;let d=t.querySelector(".aipkit_post_settings_redesigned");d&&!d.dataset.postSettingsInitialized&&(n(d),d.dataset.postSettingsInitialized="true")}function s(){e(),document.addEventListener("aipkit:popover:opened",i),document.querySelectorAll(".aipkit_post_settings_redesigned").forEach(d=>{d.dataset.postSettingsInitialized||(n(d),d.dataset.postSettingsInitialized="true")}),new MutationObserver(d=>{d.forEach(o=>{if(o.type==="attributes"&&o.attributeName==="aria-hidden"){let l=o.target.closest("#aipkit_cw_post_settings_popover");if(l&&o.target.getAttribute("aria-hidden")==="false"){let _=l.querySelector(".aipkit_post_settings_redesigned");_&&!_.dataset.postSettingsInitialized&&(n(_),_.dataset.postSettingsInitialized="true")}}})}).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["aria-hidden"]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s(),window.aipkit_initPostSettingsHandler=n})();(function(){"use strict";function g(a){let r=a||document.getElementById("aipkit_content_writer_container");if(!r)return;let n=r.querySelectorAll("[data-aipkit-vector-stores-dropdown]");n.length&&n.forEach(e=>{let i=e.closest(".aipkit_popover_option_main"),s=e.closest(".aipkit_cw_vector_openai_field"),c=i||s,t=c?c.querySelector(".aipkit_popover_multiselect_select"):null;if(!t)return;let d=e.querySelector(".aipkit_popover_multiselect_btn"),o=e.querySelector(".aipkit_popover_multiselect_label"),l=e.querySelector(".aipkit_popover_multiselect_panel"),_=e.querySelector(".aipkit_popover_multiselect_options"),p=e.dataset.placeholder||"Select stores",f=e.dataset.selectedLabel||"selected",m=()=>{if(!o)return;let v=Array.from(t.options).filter(x=>x.selected&&x.value);if(!v.length){o.textContent=p;return}let C=v.map(x=>x.textContent.trim()).filter(Boolean);if(C.length<=2){o.textContent=C.join(", ");return}o.textContent=`${C.length} ${f}`},k=()=>{if(!_)return;_.innerHTML="";let v=Array.from(t.options),C=v.filter(x=>x.value);if(!C.length){let x=document.createElement("div");x.className="aipkit_popover_multiselect_empty",x.textContent=v[0]?.textContent||"-- No Stores Found --",_.appendChild(x),m();return}C.forEach(x=>{let b=document.createElement("label");b.className="aipkit_popover_multiselect_item";let I=document.createElement("input");I.type="checkbox",I.value=x.value,I.checked=x.selected,I.disabled=x.disabled;let y=document.createElement("span");y.className="aipkit_popover_multiselect_text",y.textContent=x.textContent,b.appendChild(I),b.appendChild(y),_.appendChild(b)}),m()},u=()=>{if(!_){m();return}let v=new Set(Array.from(t.options).filter(C=>C.selected).map(C=>C.value));_.querySelectorAll('input[type="checkbox"]').forEach(C=>{C.checked=v.has(C.value)}),m()},w=v=>{if(!_)return;let C=Array.from(_.querySelectorAll('input[type="checkbox"]:checked'));if(C.length>2){let b=v&&v.target;if(b&&b.checked)b.checked=!1;else{let I=C[C.length-1];I&&(I.checked=!1)}}let x=Array.from(_.querySelectorAll('input[type="checkbox"]:checked')).map(b=>b.value);Array.from(t.options).forEach(b=>{b.selected=x.includes(b.value)}),t.dispatchEvent(new Event("change",{bubbles:!0})),m()},h=v=>{!e||!d||(e.classList.toggle("is-open",v),d.setAttribute("aria-expanded",v?"true":"false"),l&&(l.hidden=!v))};k(),u(),e.dataset.vectorStoreMultiselectAttached||(d&&(d.addEventListener("click",v=>{v.preventDefault(),h(!e.classList.contains("is-open"))}),d.addEventListener("keydown",v=>{v.key==="Escape"&&h(!1)})),document.addEventListener("click",v=>{e.classList.contains("is-open")&&(e.contains(v.target)||h(!1))}),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",w),_.dataset.listenerAttached="true"),t.dataset.listenerAttached||(t.addEventListener("change",u),t.dataset.listenerAttached="true"),e.dataset.vectorStoreMultiselectAttached="true")})}window.aipkit_initContentWriterVectorStoreMultiSelect=g})();(function(){"use strict";function g(a){let r=a||document.getElementById("aipkit_content_writer_container");if(!r)return;let n=r.querySelectorAll("[data-aipkit-categories-dropdown]");n.length&&n.forEach(e=>{let i=e.closest(".aipkit_popover_option_main"),s=e.closest(".aipkit_post_taxonomy_row"),c=i||s,t=c?c.querySelector('select[name="post_categories[]"]'):null;if(!t)return;let d=e.querySelector(".aipkit_popover_multiselect_btn"),o=e.querySelector(".aipkit_popover_multiselect_label"),l=e.querySelector(".aipkit_popover_multiselect_panel"),_=e.querySelector(".aipkit_popover_multiselect_options"),p=e.dataset.placeholder||"Select categories",f=e.dataset.selectedLabel||"selected",m=()=>{if(!o)return;let v=Array.from(t.options).filter(x=>x.selected&&x.value);if(!v.length){o.textContent=p;return}let C=v.map(x=>x.textContent.trim()).filter(Boolean);if(C.length<=2){o.textContent=C.join(", ");return}o.textContent=`${C.length} ${f}`},k=()=>{if(!_)return;_.innerHTML="";let v=Array.from(t.options),C=v.filter(x=>x.value);if(!C.length){let x=document.createElement("div");x.className="aipkit_popover_multiselect_empty",x.textContent=v[0]?.textContent||"-- No Categories --",_.appendChild(x),m();return}C.forEach(x=>{let b=document.createElement("label");b.className="aipkit_popover_multiselect_item";let I=document.createElement("input");I.type="checkbox",I.value=x.value,I.checked=x.selected,I.disabled=x.disabled;let y=document.createElement("span");y.className="aipkit_popover_multiselect_text",y.textContent=x.textContent,b.appendChild(I),b.appendChild(y),_.appendChild(b)}),m()},u=()=>{if(!_){m();return}let v=new Set(Array.from(t.options).filter(C=>C.selected).map(C=>C.value));_.querySelectorAll('input[type="checkbox"]').forEach(C=>{C.checked=v.has(C.value)}),m()},w=()=>{if(!_)return;let v=Array.from(_.querySelectorAll('input[type="checkbox"]:checked')).map(C=>C.value);Array.from(t.options).forEach(C=>{C.selected=v.includes(C.value)}),t.dispatchEvent(new Event("change",{bubbles:!0})),m()},h=v=>{!e||!d||(e.classList.toggle("is-open",v),d.setAttribute("aria-expanded",v?"true":"false"),l&&(l.hidden=!v))};k(),u(),e.dataset.categoriesMultiselectAttached||(d&&(d.addEventListener("click",v=>{v.preventDefault(),h(!e.classList.contains("is-open"))}),d.addEventListener("keydown",v=>{v.key==="Escape"&&h(!1)})),document.addEventListener("click",v=>{e.classList.contains("is-open")&&(e.contains(v.target)||h(!1))}),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",w),_.dataset.listenerAttached="true"),t.dataset.listenerAttached||(t.addEventListener("change",u),t.dataset.listenerAttached="true"),e.dataset.categoriesMultiselectAttached="true")})}window.aipkit_initContentWriterCategoriesMultiSelect=g})();(function(){"use strict";let g=" \xB7 ",a=d=>{if(!d)return"";let o=d.options?d.options[d.selectedIndex]:null;return o?o.textContent.trim():""},r=d=>!d||!d.options?[]:Array.from(d.options).filter(o=>o.selected&&o.value).map(o=>o.textContent.trim()).filter(Boolean),n=(d,o)=>{let l=d.filter(Boolean);return l.length?l.join(g):o},e=(d,o)=>{if(!d)return;d.textContent=o,d.title=o;let l=d.closest(".aipkit_cw_settings_summary_text");l&&(l.title=o);let _=d.dataset.aipkitPlaceholder,p=d.dataset.aipkitDisabledLabel,f="active";p&&o===p?f="disabled":_&&o===_&&(f="placeholder"),d.dataset.aipkitSummaryState=f},i=d=>String(d||"").trim().toLowerCase(),s=(d,o,l=null)=>{if(!d)return;let _="aipkit_settings_select_picker_icon--";d.classList.forEach(k=>{k.startsWith(_)&&d.classList.remove(k)});let p=i(o),f=!l||l.includes(p),m=!!(p&&f);d.hidden=!m,m&&d.classList.add(`${_}${p}`)},c=d=>{if(!d)return;let o=document.getElementById("aipkit_content_writer_form"),l=o?o.classList.contains("aipkit_cw_mode_existing_images"):!1,_=d.querySelector('[data-aipkit-cw-summary="ai"]');if(_){let k=_.dataset.aipkitPlaceholder||"Not set",u=a(d.querySelector("#aipkit_content_writer_provider")),w=a(d.querySelector("#aipkit_content_writer_model"));e(_,n([w],k));let h=d.querySelector("#aipkit_content_writer_provider")?.value,v=_.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon");s(v,h)}let p=d.querySelector('[data-aipkit-cw-summary="images"]');if(p){let k=p.dataset.aipkitPlaceholder||"Not set",u=p.dataset.aipkitDisabledLabel||"Disabled",w=["#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description"],h=d.querySelector("#aipkit_cw_generate_images_enabled"),v=d.querySelector("#aipkit_cw_generate_featured_image"),C=h&&h.checked||v&&v.checked,x=d.querySelector("#aipkit_cw_image_provider"),b=x?x.value:"",I=a(x),y=a(d.querySelector("#aipkit_cw_image_model")),q=p.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_settings_select_picker_icon"),E=["openai","google","azure","replicate"];if(s(q,b,E),l){s(q,"",E);let S=w.map(A=>{let T=d.querySelector(A);if(!T||!T.checked)return"";let M=T.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_image_toggle_label");return M?M.textContent.trim():""}).filter(Boolean);e(p,n(S,u||k))}else C?E.includes(b)?e(p,n([y],k)):["pexels","pixabay"].includes(b)?e(p,n([I],k)):e(p,n([I,y],k)):(s(q,"",E),e(p,u))}let f=d.querySelector('[data-aipkit-cw-summary="vector"]');if(f){let k=f.dataset.aipkitPlaceholder||"Not set",u=f.dataset.aipkitDisabledLabel||"Disabled",w=d.querySelector("#aipkit_cw_enable_vector_store"),h=f.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon"),v=["openai","pinecone","qdrant"];if(w&&!w.checked)s(h,"",v),e(f,u);else{let C=d.querySelector("#aipkit_cw_vector_store_provider"),x=C?C.value:"",b="";if(x==="openai"){let I=d.querySelector("#aipkit_cw_openai_vector_store_ids");b=r(I).join(", ")}else x==="pinecone"?b=a(d.querySelector("#aipkit_cw_pinecone_index_name")):x==="qdrant"&&(b=a(d.querySelector("#aipkit_cw_qdrant_collection_name")));s(h,x,v),e(f,n([b],k))}}let m=d.querySelector('[data-aipkit-cw-summary="post"]');if(m){let k=m.dataset.aipkitPlaceholder||"Not set",u=a(d.querySelector("#aipkit_content_writer_post_status"));e(m,n([u],k))}};function t(d){let o=d||document.getElementById("aipkit_content_writer_container");if(!o||o.dataset.cwSummaryAttached==="true")return;let l=["#aipkit_content_writer_provider","#aipkit_content_writer_model","#aipkit_cw_generate_images_enabled","#aipkit_cw_generate_featured_image","#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description","#aipkit_cw_image_provider","#aipkit_cw_image_model","#aipkit_cw_enable_vector_store","#aipkit_cw_vector_store_provider","#aipkit_cw_openai_vector_store_ids","#aipkit_cw_pinecone_index_name","#aipkit_cw_qdrant_collection_name","#aipkit_content_writer_categories","#aipkit_content_writer_post_author","#aipkit_content_writer_post_status"],_=p=>l.some(f=>p.matches(f));o.addEventListener("change",p=>{let f=p.target;!f||!_(f)||c(o)}),c(o),o.dataset.cwSummaryAttached="true"}window.aipkit_initContentWriterSettingsSummary=t,window.aipkit_updateContentWriterSettingsSummary=function(){let d=document.getElementById("aipkit_content_writer_container");c(d)}})();(function(){"use strict";let g=window.wp?.i18n?.__||function(S){return S},a="#aipkit_content_writer_provider, #aipkit_content_writer_model, #aipkit_cw_image_provider, #aipkit_cw_image_model, #aipkit_task_cw_image_provider, #aipkit_task_cw_image_model, #aipkit_cw_vector_store_provider, #aipkit_cw_vector_embedding_provider, #aipkit_task_cw_vector_store_provider, #aipkit_task_ce_vector_store_provider, #aipkit_task_cw_vector_embedding_provider, #aipkit_task_ce_vector_embedding_provider, #aipkit_task_content_indexing_target_store_provider, #aipkit_enhancer_insert_position_default, #aipkit_cw_pinecone_index_name, #aipkit_cw_qdrant_collection_name, #aipkit_cw_vector_embedding_model, #aipkit_task_cw_ai_provider, #aipkit_task_cw_ai_model, #aipkit_task_cc_ai_provider, #aipkit_task_cc_ai_model, #aipkit_task_ce_ai_provider, #aipkit_task_ce_ai_model",r=null,n=null,e=!1,i=new Set(["aipkit_content_writer_provider","aipkit_cw_image_provider","aipkit_cw_vector_store_provider","aipkit_cw_vector_embedding_provider","aipkit_task_cw_image_provider","aipkit_task_cw_vector_store_provider","aipkit_task_ce_vector_store_provider","aipkit_task_cw_vector_embedding_provider","aipkit_task_ce_vector_embedding_provider","aipkit_task_content_indexing_target_store_provider","aipkit_task_cw_ai_provider","aipkit_task_cc_ai_provider","aipkit_task_ce_ai_provider"]),s=S=>!!(S&&S.id&&i.has(S.id)),c=S=>!!(S&&S.dataset?.aipkitPickerIcons==="assistant-position"),t=S=>!!(S&&(s(S)||c(S)||S.id==="aipkit_cw_pinecone_index_name"||S.id==="aipkit_cw_qdrant_collection_name"||S.id==="aipkit_cw_vector_embedding_model")),d=(S,A)=>{if(!S)return!1;let T=o(A);return T?S.id==="aipkit_cw_image_provider"?["openai","google","azure","replicate"].includes(T):S.id==="aipkit_task_cw_image_provider"?["openai","google","azure","replicate"].includes(T):S.id==="aipkit_cw_vector_store_provider"?["openai","pinecone","qdrant"].includes(T):S.id==="aipkit_task_cw_vector_store_provider"||S.id==="aipkit_task_ce_vector_store_provider"||S.id==="aipkit_task_content_indexing_target_store_provider"?["openai","pinecone","qdrant"].includes(T):S.id==="aipkit_cw_vector_embedding_provider"?["openai","google","azure"].includes(T):S.id==="aipkit_task_cw_vector_embedding_provider"||S.id==="aipkit_task_ce_vector_embedding_provider"?["openai","google","azure"].includes(T):["openai","openrouter","claude","google","azure","deepseek","ollama"].includes(T):!1},o=S=>String(S||"").trim().toLowerCase(),l=(S,A,T)=>{if(!S)return;let M="aipkit_settings_select_picker_icon--";S.classList.forEach(R=>{R.startsWith(M)&&S.classList.remove(R)});let V=o(T),W=d(A,V);S.hidden=!W,W&&S.classList.add(`${M}${V}`)},_=(S,A)=>{if(!S)return;let T="aipkit_settings_select_picker_icon--assistant-";S.classList.forEach(V=>{V.startsWith(T)&&S.classList.remove(V)});let M=String(A||"").trim().toLowerCase();S.hidden=!M,M&&S.classList.add(`${T}${M}`)},p=S=>S&&(S.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:S.querySelector("option[selected]"))?.dataset?.icon||"",f=S=>{if(!S)return"";let A=S.getAttribute("data-aipkit-picker-title");if(A)return A;let T=S.id&&document.querySelector(`label[for="${S.id}"]`)||S.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return T?T.textContent.trim():""},m=S=>{if(!S)return"";let A=S.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:S.querySelector("option[selected]");if(A)return A.textContent.trim();let T=S.querySelector("option");return T?T.textContent.trim():""},k=S=>({buttonId:`${S}_picker_btn`,labelId:`${S}_picker_label`,popoverId:`${S}_picker_popover`,titleId:`${S}_picker_title`,searchId:`${S}_picker_search`,listId:`${S}_picker_list`}),u=S=>S?S.closest("#aipkit_cw_builder_sheet")||S.closest("#aipkit_content_writer_container")||S.closest("#aipkit_autogpt_container")||S.closest("#aipkit_ai_forms_container"):null,w=S=>{if(!S||!S.id)return null;let A=k(S.id),T=u(S);if(!T)return null;let M=document.getElementById(A.buttonId);if(!M){if(M=document.createElement("button"),M.type="button",M.id=A.buttonId,M.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",M.setAttribute("data-aipkit-popover-target",A.popoverId),M.setAttribute("aria-controls",A.popoverId),M.setAttribute("aria-expanded","false"),M.dataset.aipkitPopoverPlacement="bottom",s(S)){M.classList.add("aipkit_settings_select_picker_btn--provider");let B=document.createElement("span");B.className="aipkit_settings_select_picker_icon",B.setAttribute("aria-hidden","true"),l(B,S,S.value),M.appendChild(B)}else if(c(S)){let B=document.createElement("span");B.className="aipkit_settings_select_picker_icon",B.setAttribute("aria-hidden","true"),_(B,p(S)),M.appendChild(B)}let W=document.createElement("span");W.className="aipkit_settings_select_picker_label",W.id=A.labelId,W.textContent=m(S)||g("Select","gpt3-ai-content-generator");let R=document.createElement("span");R.className="dashicons dashicons-arrow-down-alt2",R.setAttribute("aria-hidden","true"),M.appendChild(W),M.appendChild(R),S.insertAdjacentElement("beforebegin",M)}S.classList.contains("screen-reader-text")||S.classList.add("screen-reader-text");let V=document.getElementById(A.popoverId);if(!V){V=document.createElement("div"),V.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",V.id=A.popoverId,V.setAttribute("aria-hidden","true"),s(S)&&V.classList.add("aipkit_settings_select_picker_popover--provider");let W=document.createElement("div");W.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",W.setAttribute("role","dialog"),W.setAttribute("aria-labelledby",A.titleId);let R=document.createElement("div");R.className="aipkit_model_settings_popover_header";let B=document.createElement("span");B.className="aipkit_model_settings_popover_title",B.id=A.titleId,B.textContent=f(S)||g("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',R.appendChild(B),R.appendChild($);let G=document.createElement("div");G.className="aipkit_model_settings_popover_body";let L=document.createElement("div");L.className="aipkit_settings_select_picker_search";let K=document.createElement("input");K.type="search",K.id=A.searchId,K.className="aipkit_form-input";let H=f(S),ne=H?`Search ${H.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");K.setAttribute("placeholder",ne),L.appendChild(K);let ae=document.createElement("div");ae.className="aipkit_settings_select_picker_list",ae.id=A.listId,ae.setAttribute("role","listbox"),G.appendChild(L),G.appendChild(ae),W.appendChild(R),W.appendChild(G),V.appendChild(W),T.appendChild(V),t(S)&&(L.style.display="none")}return{ids:A,button:M,popover:V,label:document.getElementById(A.labelId),search:document.getElementById(A.searchId),list:document.getElementById(A.listId)}},h=S=>{let A=[];return S&&Array.from(S.children).forEach(M=>{if(M.tagName==="OPTGROUP"){let V=Array.from(M.children).filter(W=>W.tagName==="OPTION").map(W=>({value:W.value,label:W.textContent.trim(),disabled:W.disabled,selected:W.selected,icon:W.dataset?.icon||""}));A.push({label:M.label,options:V})}else M.tagName==="OPTION"&&A.push({label:"",options:[{value:M.value,label:M.textContent.trim(),disabled:M.disabled,selected:M.selected,icon:M.dataset?.icon||""}]})}),A},v=(S,A,T="")=>{if(!S||!A)return;A.innerHTML="";let M=h(S),V=T.trim().toLowerCase(),W=!1;if(M.forEach(R=>{let B=R.options.filter($=>V?$.label.toLowerCase().includes(V):!0);if(B.length){if(R.label){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=R.label,A.appendChild($)}B.forEach($=>{let G=document.createElement("button");if(G.type="button",G.className="aipkit_settings_select_picker_item",$.disabled&&G.classList.add("is-disabled"),$.selected&&G.classList.add("is-active"),G.dataset.value=$.value,s(S)&&d(S,$.value)){let H=document.createElement("span");H.className="aipkit_settings_select_picker_icon",H.setAttribute("aria-hidden","true"),l(H,S,$.value),G.appendChild(H)}else if(c(S)&&$.icon){let H=document.createElement("span");H.className="aipkit_settings_select_picker_icon",H.setAttribute("aria-hidden","true"),_(H,$.icon),G.appendChild(H)}let L=document.createElement("span");L.className="aipkit_settings_select_picker_text",L.textContent=$.label||$.value;let K=document.createElement("span");K.className="dashicons dashicons-yes aipkit_settings_select_picker_check",K.setAttribute("aria-hidden","true"),G.appendChild(L),G.appendChild(K),A.appendChild(G),W=!0})}}),!W){let R=document.createElement("div");R.className="aipkit_settings_select_picker_empty",R.textContent=g(V?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild(R)}},C=(S,A)=>{if(!S||!A)return;let T=m(S);if(A.textContent=T||g("Select","gpt3-ai-content-generator"),s(S)){let M=A.closest("button"),V=M?M.querySelector(".aipkit_settings_select_picker_icon"):null;l(V,S,S.value)}else if(c(S)){let M=A.closest("button"),V=M?M.querySelector(".aipkit_settings_select_picker_icon"):null;_(V,p(S))}},x=(S,A)=>{if(!S||!A)return;let T=S.getBoundingClientRect(),M=A.getBoundingClientRect(),V=M.width||320,W=M.height||0,R=window.innerWidth,B=window.innerHeight,$=12;if(S.dataset.aipkitPopoverPlacement==="bottom"){let K=T.left;K+V>R-$&&(K=T.right-V),K=Math.max($,Math.min(K,R-V-$));let H=T.bottom+8;H+W>B-$&&(H=T.top-W-8),H=Math.max($,Math.min(H,B-W-$)),A.style.left=`${Math.round(K)}px`,A.style.top=`${Math.round(H)}px`;return}let G=T.right+10;G+V>R-$&&(G=T.left-V-10),G=Math.max($,Math.min(G,R-V-$));let L=T.top;L+W>B-$&&(L=B-W-$),L=Math.max($,L),A.style.left=`${Math.round(G)}px`,A.style.top=`${Math.round(L)}px`},b=()=>{!r||!n||e||(e=!0,window.requestAnimationFrame(()=>{let S=r.querySelector(".aipkit_model_settings_popover_panel");x(n,S),e=!1}))},I=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),r=null,n=null)},y=(S,A,T)=>{if(!S||!A)return;r&&r!==A&&I(),r=A,n=S,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),S.setAttribute("aria-expanded","true");let M=A.querySelector(".aipkit_settings_select_picker_search input"),V=A.querySelector(".aipkit_settings_select_picker_list");V&&v(T,V,M?M.value:""),M&&M.offsetParent!==null&&(M.focus(),M.select());let W=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{x(S,W)})},q=(S,A)=>{if(!S||!A)return;let{button:T,popover:M,list:V,search:W}=A;if(T&&T.dataset.pickerListenerAttached!=="true"&&(T.addEventListener("click",R=>{if(R.preventDefault(),r===M){I();return}y(T,M,S)}),T.dataset.pickerListenerAttached="true"),M&&M.dataset.overlayListenerAttached!=="true"){M.addEventListener("click",B=>{B.target===M&&I()});let R=M.querySelector(".aipkit_model_settings_popover_close");R&&R.addEventListener("click",B=>{B.preventDefault(),I()}),M.dataset.overlayListenerAttached="true"}if(V&&V.dataset.pickerListenerAttached!=="true"&&(V.addEventListener("click",R=>{let B=R.target.closest(".aipkit_settings_select_picker_item");if(!B||B.classList.contains("is-disabled"))return;let $=B.dataset.value??"";S.value=$,S.dispatchEvent(new Event("change",{bubbles:!0})),C(S,A.label),v(S,V,W?W.value:""),I()}),V.dataset.pickerListenerAttached="true"),W&&W.dataset.pickerListenerAttached!=="true"&&(W.addEventListener("input",()=>{v(S,V,W.value)}),W.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("change",()=>{C(S,A.label),v(S,V,W?W.value:"")}),S.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerObserverAttached!=="true"){let R=!1;new MutationObserver(()=>{R||(R=!0,window.requestAnimationFrame(()=>{C(S,A.label),v(S,V,W?W.value:""),R=!1}))}).observe(S,{childList:!0,subtree:!0}),S.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitContentWriterPickerEscapeBound||(document.addEventListener("keydown",R=>{R.key==="Escape"&&r&&I()}),document.body.dataset.aipkitContentWriterPickerEscapeBound="true"),document.body.dataset.aipkitContentWriterPickerRepositionBound||(window.addEventListener("resize",b),window.addEventListener("scroll",b,!0),document.body.dataset.aipkitContentWriterPickerRepositionBound="true")};function E(){let S=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);S.length&&S.forEach(A=>{let T=A.querySelectorAll(a);T.length&&T.forEach(M=>{if(!M.id||M.dataset.aipkitPickerInit==="true")return;let V=w(M);V&&(C(M,V.label),v(M,V.list,V.search?V.search.value:""),q(M,V),M.dataset.aipkitPickerInit="true")})})}window.aipkit_initContentWriterSelectPickers=E,window.aipkit_refreshContentWriterSelectPickers=function(){let S=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);S.length&&S.forEach(A=>{let T=A.querySelectorAll(a);T.length&&T.forEach(M=>{if(!M.id)return;let V=w(M);V&&(C(M,V.label),v(M,V.list,V.search?V.search.value:""),q(M,V),M.dataset.aipkitPickerInit="true")})})}})();(function(){"use strict";function g(c){c||(c=document.getElementById("aipkit_content_writer_container")),c&&(a(c),n(c),e(c))}function a(c){let t=c.querySelectorAll(".aipkit_ai_reasoning_input"),d=c.querySelector("#aipkit_content_writer_reasoning_effort");!t.length||!d||(t.forEach(o=>{o.addEventListener("change",function(){if(this.checked){d.value=this.value,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(p=>{p.classList.remove("aipkit_ai_reasoning_option--selected")});let l=this.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected");let _=new Event("change",{bubbles:!0});d.dispatchEvent(_)}})}),r(c))}function r(c){let t=c.querySelector("#aipkit_content_writer_reasoning_effort");if(!t)return;let d=t.value||"medium";d==="minimal"&&(d="low");let o=c.querySelector(`.aipkit_ai_reasoning_input[value="${d}"]`);if(o&&!o.checked){o.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>{_.classList.remove("aipkit_ai_reasoning_option--selected")});let l=o.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected")}}function n(c){let t=c.querySelector("#aipkit_content_writer_temperature"),d=c.querySelector("#aipkit_content_writer_temperature_value");!t||!d||t.dataset.enhancedListenerAttached!=="true"&&(t.addEventListener("input",function(){d.textContent=this.value}),t.dataset.enhancedListenerAttached="true")}function e(c){let t=c.querySelector("#aipkit_content_writer_content_length_slider"),d=c.querySelector("#aipkit_content_writer_content_length_value"),o=c.querySelector("#aipkit_content_writer_content_length_hint"),l=c.querySelector("#aipkit_content_writer_content_length");if(!t||!d||!o||!l||t.dataset.enhancedListenerAttached==="true")return;let _=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],p="medium",f=u=>{let w=_.findIndex(h=>h.key===u);return w===-1?_.findIndex(h=>h.key===p):w},m=u=>{let w=f(u),h=_[w];d.textContent=h.label,o.textContent=`Approx. ${h.words} words`,t.value=String(w+1)},k=(u,w=!1)=>{let h=_.some(v=>v.key===u)?u:p;l.value!==h&&(l.value=h),m(h),w&&l.dispatchEvent(new Event("change",{bubbles:!0}))};t.addEventListener("input",function(){let u=Math.max(1,Math.min(3,parseInt(this.value,10)))-1,w=_[u]?.key||p;k(w,!0)}),l.addEventListener("change",function(){k(this.value,!1)}),k(l.value||p,!1),t.dataset.enhancedListenerAttached="true"}function i(c,t){if(!c||!t)return;let d=c.querySelector("#aipkit_content_writer_reasoning_effort");d&&(d.value=t==="minimal"?"low":t);let o=c.querySelector(`.aipkit_ai_reasoning_input[value="${t==="minimal"?"low":t}"]`);if(o){o.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>{_.classList.remove("aipkit_ai_reasoning_option--selected")});let l=o.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected")}}function s(c){if(!c)return"medium";let t=c.querySelector(".aipkit_ai_reasoning_input:checked");if(t)return t.value;let d=c.querySelector("#aipkit_content_writer_reasoning_effort");return d?d.value:"medium"}window.aipkit_initAiSettingsRedesigned=g,window.aipkit_setReasoningEffort=i,window.aipkit_getReasoningEffort=s})();(function(){"use strict";function g(a,r,n,e,i,s){if(typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(a,r):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(n):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(i):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(s,i):console.error("Content Writer UI: handleClearButton function not found."),typeof window.aipkit_initContentWriterSettingsSummary=="function"?window.aipkit_initContentWriterSettingsSummary():console.error("Content Writer UI: initContentWriterSettingsSummary function not found."),typeof window.aipkit_initContentWriterSelectPickers=="function"?window.aipkit_initContentWriterSelectPickers():console.error("Content Writer UI: initContentWriterSelectPickers function not found."),typeof window.aipkit_initAiSettingsRedesigned=="function"){let c=document.getElementById("aipkit_content_writer_container");window.aipkit_initAiSettingsRedesigned(c)}}window.aipkit_initContentWriterUI=g})();(function(){"use strict";let g={intervalId:null,startTime:null};function a(c){let t=Math.floor(c/1e3),d=Math.floor(t/60),o=t%60;return`${d}:${String(o).padStart(2,"0")}`}function r(c){if(!c)return null;let t=c.querySelector(".aipkit_cw_btn_timer");if(t)return t;t=document.createElement("span"),t.className="aipkit_cw_btn_timer",t.setAttribute("aria-hidden","true"),t.hidden=!0;let d=c.querySelector(".aipkit_btn-text");return d?c.insertBefore(t,d):c.insertBefore(t,c.firstChild),t}function n(c){if(!c||g.intervalId)return;let t=r(c);if(!t)return;g.startTime=Date.now();let d=()=>{let o=Date.now()-g.startTime;t.textContent=a(o),t.hidden=!1};d(),g.intervalId=window.setInterval(d,1e3)}function e(c){g.intervalId&&(clearInterval(g.intervalId),g.intervalId=null),g.startTime=null;let t=r(c);t&&(t.hidden=!0,t.textContent="")}function i(c){let t=document.getElementById("aipkit_content_writer_generate_btn");if(!t)return;let d=t.closest(".aipkit_cw_generate_split"),o=d?d.querySelector(".aipkit_cw_generate_toggle"):null,l=d?d.querySelector(".aipkit_cw_generate_menu"):null,_=l?Array.from(l.querySelectorAll(".aipkit_cw_generate_menu_item")):[],p=document.getElementById("aipkit_content_writer_stop_btn");if(c){if(t.dataset.aipkitStopMode="true",d&&d.classList.add("is-single"),n(t),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(t,"Stop");else{let f=t.querySelector(".aipkit_btn-text");f?f.textContent="Stop":t.textContent="Stop"}t.disabled=!1,t.removeAttribute("aria-disabled"),t.style.display="inline-flex",o&&(o.style.display="none",o.disabled=!0),l&&(l.hidden=!0),_.length&&_.forEach(f=>{f.disabled=!0,f.setAttribute("aria-disabled","true")}),p&&(p.style.display="none");return}t.dataset.aipkitStopMode&&delete t.dataset.aipkitStopMode,e(t),d&&d.classList.remove("is-single"),o&&(o.style.display="",o.disabled=!1,o.removeAttribute("aria-disabled")),_.length&&_.forEach(f=>{f.disabled=!1,f.removeAttribute("aria-disabled")}),p&&(p.style.display="none")}function s(){let c=document.getElementById("aipkit_content_writer_generate_btn"),t=document.getElementById("aipkit_content_writer_stop_btn"),d=c?.dataset?.action||"generate",l={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",update:"Update"}[d]||"Generate";c&&(e(c),c.dataset.aipkitStopMode&&delete c.dataset.aipkitStopMode,typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(c,!1,l):(c.disabled=!1,c.textContent=l),c.style.display="inline-flex"),t&&(t.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()}window.aipkit_setContentWriterStopMode=i,window.aipkit_resetContentWriterButtons=s})();(function(){"use strict";function g(a){a.current&&(a.current.close(),a.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let r=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_content_writer_output_display"),e=document.querySelector(".aipkit_content_writer_output_actions"),i=document.getElementById("aipkit_content_writer_copy_btn"),s=document.getElementById("aipkit_content_writer_clear_btn");r&&(r.textContent.trim().length>0||!!r.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))&&(!n||!n.classList.contains("aipkit_content_writer_output_error"))?(e&&(e.style.display="flex"),i&&(i.disabled=!1),s&&(s.disabled=!1),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_showPrimaryAction=="function"&&window.aipkit_showPrimaryAction(),typeof window.aipkit_updateMetaChunkVisibility=="function"&&window.aipkit_updateMetaChunkVisibility(),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(e&&(e.style.display="none"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=g})();(function(){"use strict";function g(s,c,t,d){let o=s.querySelector("[data-csv-upload-zone]"),l=s.querySelector("[data-csv-status]"),_=s.querySelector("[data-csv-status-card]"),p=s.querySelector("[data-csv-status-icon]"),f=s.querySelector("[data-csv-file-name]"),m=s.querySelector("[data-csv-message]");if(!(!l||!_)){if(c==="idle"){o&&o.classList.remove("is-hidden"),l.hidden=!0;return}if(o&&o.classList.add("is-hidden"),l.hidden=!1,_.dataset.status=c,p){let k="dashicons-yes-alt";c==="loading"&&(k="dashicons-update"),c==="error"&&(k="dashicons-warning"),p.innerHTML=`<span class="dashicons ${k}" aria-hidden="true"></span>`;let u=p.querySelector(".dashicons");u&&c==="loading"&&(u.style.animation="aipkit_csv_spin 1s linear infinite")}f&&d?f.textContent=d:f&&(f.textContent=""),m&&(m.textContent=t||"")}}async function a(s){let c=s.target,t=c.closest(".aipkit_csv_import_container")||c.closest(".aipkit_form-group");if(!t)return;let d=t.querySelector("[data-csv-status]")!==null,o=t.querySelector(".aipkit_csv_analysis_results"),l=t.querySelector(".aipkit_csv_data_holder"),_=document.getElementById("aipkit_content_writer_nonce"),p=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,f=_?_.value:p;if(!l||!f){console.error("CSV Handler: Missing data holder or nonce field."),d?g(t,"error","Error: A required component is missing.",null):o&&(o.textContent="Error: A required UI component or security token is missing.",o.className="aipkit_form-help aipkit_settings_message-error");return}let m=c.files[0];if(!m){d?g(t,"idle",null,null):o&&(o.textContent="Please select a CSV file first.",o.className="aipkit_form-help aipkit_settings_message-error");return}if(!m.name.toLowerCase().endsWith(".csv")){d?g(t,"error","Invalid file type. Please upload a .csv file.",m.name):o&&(o.textContent="Invalid file type. Please upload a .csv file.",o.className="aipkit_form-help aipkit_settings_message-error");return}d?g(t,"loading","Parsing CSV...",m.name):o&&(o.textContent="Parsing CSV...",o.className="aipkit_form-help aipkit_settings_message-info");let k=new FormData;k.append("file",m),k.append("_ajax_nonce",f),k.append("action","aipkit_content_writer_parse_csv");try{let u=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:k,credentials:"same-origin"});if(!u.ok){let v=`Server returned status ${u.status}`;try{let C=await u.json();C&&C.data&&C.data.message&&(v=C.data.message)}catch{}throw new Error(v)}let w=await u.json();if(!w.success)throw new Error(w.data?.message||"Unknown server error.");let h=w.data;if(h.tasks_found>0){l.value=h.formatted_data;let C=c.id==="aipkit_task_cw_csv_file_input"||!!c.closest("#aipkit_autogpt_container")?`Found ${h.tasks_found} ${h.tasks_found===1?"topic":"topics"}. Ready to save the task.`:`Found ${h.tasks_found} ${h.tasks_found===1?"topic":"topics"}. Hit Generate to proceed.`;d?g(t,"success",C,m.name):o&&(o.textContent=`Success! Found ${h.tasks_found} topics in the CSV file. Ready.`,o.className="aipkit_form-help aipkit_settings_message-success")}else{l.value="";let v="No valid topics found in the CSV file.";d?g(t,"error",v,m.name):o&&(o.textContent=v,o.className="aipkit_form-help aipkit_settings_message-error")}}catch(u){l.value="";let w=u.message||"Failed to parse CSV file.";d?g(t,"error",w,m.name):o&&(o.textContent=`Error: ${w}`,o.className="aipkit_form-help aipkit_settings_message-error"),console.error("CSV Parse Error:",u)}}function r(s){let c=s.target.closest("[data-csv-clear]");if(!c)return;let t=c.closest(".aipkit_csv_import_container");if(!t)return;let d=t.querySelector("input[type='file']"),o=t.querySelector(".aipkit_csv_data_holder");d&&(d.value=""),o&&(o.value=""),g(t,"idle",null,null)}function n(s){if(!s||s.dataset.dragDropAttached==="true")return;let c=l=>{l.preventDefault(),l.stopPropagation()},t=()=>s.classList.add("is-dragover"),d=()=>s.classList.remove("is-dragover"),o=l=>{c(l),d();let p=l.dataTransfer.files;if(p.length>0){let f=s.querySelector("input[type='file']");if(f){let m=new DataTransfer;m.items.add(p[0]),f.files=m.files,f.dispatchEvent(new Event("change",{bubbles:!0}))}}};["dragenter","dragover","dragleave","drop"].forEach(l=>{s.addEventListener(l,c,!1)}),["dragenter","dragover"].forEach(l=>{s.addEventListener(l,t,!1)}),["dragleave","drop"].forEach(l=>{s.addEventListener(l,d,!1)}),s.addEventListener("drop",o,!1),s.dataset.dragDropAttached="true"}function e(){let s=document.getElementById("aipkit_cw_csv_file_input");if(!s||s.dataset.listenerAttached==="true")return;s.addEventListener("change",a),s.dataset.listenerAttached="true";let c=s.closest(".aipkit_csv_import_container");if(c){let t=c.querySelector(".aipkit_csv_dropzone");n(t);let d=c.querySelector("[data-csv-clear]");d&&d.dataset.listenerAttached!=="true"&&(d.addEventListener("click",r),d.dataset.listenerAttached="true")}}function i(){let s=document.getElementById("aipkit_task_cw_csv_file_input");if(!s||s.dataset.listenerAttached==="true")return;s.addEventListener("change",a),s.dataset.listenerAttached="true";let c=s.closest(".aipkit_csv_import_container");if(c){let t=c.querySelector(".aipkit_csv_dropzone");n(t);let d=c.querySelector("[data-csv-clear]");d&&d.dataset.listenerAttached!=="true"&&(d.addEventListener("click",r),d.dataset.listenerAttached="true")}}window.aipkit_initCsvUploadHandler=e,window.aipkit_initTaskCsvUploadHandler=i})();(function(){"use strict";function g(a,r){let n=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!n||!n.value)throw new Error("Security token missing for stream. Please reload.");let e=new URL(window.aipkit_dashboard.ajaxurl);e.searchParams.append("action","aipkit_frontend_chat_stream"),e.searchParams.append("cache_key",a),e.searchParams.append("_ajax_nonce",n.value),r.current&&r.current.close();try{let i=new EventSource(e.toString());return i.userStopped=!1,i}catch(i){throw console.error("EventSource Connection Setup: EventSource creation error:",i),new Error("Could not connect to stream. "+i.message)}}window.aipkit_stream_setupEventSourceConnection=g})();(function(){"use strict";function g(r){let n=r.parentElement,e=n?.closest(".aipkit_cw_output_chunk--primary");e&&(n.scrollHeight>n.clientHeight?e.classList.add("has-overflow"):e.classList.remove("has-overflow"))}function a(r,n,e,i){if(r.data)try{let s=JSON.parse(r.data);if(s.delta){if(n.fullContent+=s.delta,e.classList.contains("is-streaming")||e.classList.add("is-streaming"),!i&&typeof window.aipkit_getMarkdownRenderer=="function"&&(i=window.aipkit_getMarkdownRenderer()),i)e.innerHTML=i.render(n.fullContent);else{let t=e.textContent||"";e.textContent=t+s.delta}typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(e.innerHTML);let c=e.parentElement;c&&c.scrollTo({top:c.scrollHeight,behavior:"smooth"}),g(e),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()}}catch(s){console.error("Stream Message Handler: Error parsing event data.",s)}}window.aipkit_stream_handleMessage=a})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};async function a(r,n,e,i,s,c){if(n.isDone)return;n.isDone=!0,c&&c.current&&(c.current.close(),c.current=null),e.classList.contains("is-streaming")&&e.classList.remove("is-streaming"),!i&&typeof window.aipkit_getMarkdownRenderer=="function"&&(i=window.aipkit_getMarkdownRenderer()),i&&(e.innerHTML=i.render(n.fullContent)),typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(e.innerHTML),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let t=document.getElementById("aipkit_content_writer_form"),d=t?t.elements.generate_meta_description:null,o=t?t.elements.generate_focus_keyword:null,l=t?t.elements.generate_excerpt:null,_=t?t.elements.generate_tags:null,p=document.getElementById("aipkit_content_writer_nonce")?.value,f=t.elements.ai_provider?.value,m=t.elements.ai_model?.value,k=t.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",u=document.getElementById("aipkit_cw_generated_title_display"),w=u?u.textContent:t.elements.content_title?.value.split("|")[0].trim()||"Untitled",h=t.elements.content_keywords?.value.trim()||"",v="",C=document.getElementById("aipkit_content_writer_title");if(C){let E=C.value.split("|")||[];E.length>1&&(v=E[1].trim())}let x=v||h,b=x;if(o?.checked&&!x&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let E=t.elements.enable_vector_store,S=E&&E.checked?"1":"0",A=t.elements.vector_store_provider?.value,T=t.elements["openai_vector_store_ids[]"],M=T?Array.from(T.selectedOptions).map(L=>L.value):[],V=t.elements.pinecone_index_name?.value,W=t.elements.qdrant_collection_name?.value,R=t.elements.vector_store_top_k?.value,B=t.elements.vector_store_confidence_threshold?.value,$={generated_content:n.fullContent,final_title:w,provider:f,model:m,prompt_mode:k,custom_keyword_prompt:t.elements.custom_keyword_prompt.value,enable_vector_store:S,vector_store_provider:A,openai_vector_store_ids:M,pinecone_index_name:V,qdrant_collection_name:W,vector_store_top_k:R,vector_store_confidence_threshold:B,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},G=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",$);if(G&&G.focus_keyword){b=G.focus_keyword;let L=document.getElementById("aipkit_cw_generated_focus_keyword"),K=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");L&&K&&(L.value=b,K.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(E){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",E.message||"Failed")}}else if(x){let E=document.getElementById("aipkit_cw_generated_focus_keyword"),S=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");E&&S&&(E.value=x.split(",")[0].trim(),S.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let I=t?t.elements.generate_images_enabled:null,y=t?t.elements.generate_featured_image:null;if((I?.checked||y?.checked)&&n.fullContent.trim()!==""){let E=I?.checked,S=y?.checked,A=String(t.elements.image_provider?.value||"").toLowerCase(),T=String(t.elements.image_model?.value||"").toLowerCase(),M=A==="openai"&&T.startsWith("gpt-image-1"),V=E?parseInt(t.elements.image_count?.value,10)||1:0,W=document.getElementById("aipkit_cw_generated_excerpt"),R=V+(S?1:0),B=E&&S?V>1?`Generating ${V} content images and 1 featured image...`:"Generating 1 content image and 1 featured image...":S?"Generating featured image...":E?V>1?`Generating ${V} content images...`:"Generating content image...":R>1?`Generating ${R} images...`:R===1?"Generating 1 image...":"Generating images...",$={original_topic:C?C.value.split("|")[0].trim():w,final_title:w,post_title:w,keywords:b,excerpt:W?W.value:"",ai_provider:t.elements.ai_provider?.value,ai_model:t.elements.ai_model?.value,ai_temperature:t.elements.ai_temperature?.value,reasoning_effort:t.elements.reasoning_effort?.value,image_provider:t.elements.image_provider?.value,image_model:t.elements.image_model?.value,image_prompt:t.elements.image_prompt?.value,image_alignment:t.elements.image_alignment?.value,image_size:t.elements.image_size?.value,featured_image_prompt:t.elements.featured_image_prompt?.value,generate_image_title:t.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:t.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:t.elements.generate_image_caption?.checked?"1":"0",generate_image_description:t.elements.generate_image_description?.checked?"1":"0",image_title_prompt:t.elements.image_title_prompt?.value,image_alt_text_prompt:t.elements.image_alt_text_prompt?.value,image_caption_prompt:t.elements.image_caption_prompt?.value,image_description_prompt:t.elements.image_description_prompt?.value,pexels_orientation:t.elements.pexels_orientation?.value,pexels_size:t.elements.pexels_size?.value,pexels_color:t.elements.pexels_color?.value,pixabay_orientation:t.elements.pixabay_orientation?.value,pixabay_image_type:t.elements.pixabay_image_type?.value,pixabay_category:t.elements.pixabay_category?.value,_ajax_nonce:p,generate_images_enabled:E?"1":"0",image_count:V,generate_featured_image:S?"1":"0",image_placement:t.elements.image_placement?.value,image_placement_param_x:t.elements.image_placement_param_x?.value,cw_generation_mode:t.elements.cw_generation_mode?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0},G=K=>{let H=document.getElementById("aipkit_cw_image_data_holder");H&&(H.value=JSON.stringify(K)),typeof window.aipkit_renderContentWriterImagePreview=="function"&&window.aipkit_renderContentWriterImagePreview(K)},L=async(K={},H="")=>{typeof window.aipkit_updateCwGenerationStatus=="function"&&H&&window.aipkit_updateCwGenerationStatus("image","generating",H);let ne=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...$,...K});if(!ne?.image_data)throw new Error("Image generation failed or returned no data.");return ne.image_data};try{let K=E&&S,H=M&&E&&V>1,ne=null,ae=Z=>{ne||(ne={...Z,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(K){if(E&&V>0)if(H&&V>1)for(let Z=0;Z<V;Z++){let pe=await L({generate_featured_image:"0",image_count:1,image_start_index:Z+1},`Generating content image ${Z+1} of ${V}...`);ae(pe),Array.isArray(pe.in_content_images)&&ne.in_content_images.push(...pe.in_content_images),G(ne)}else{let Z=await L({generate_featured_image:"0"},V>1?`Generating ${V} content images...`:"Generating content image...");ae(Z),ne.in_content_images=Z.in_content_images||[],G(ne)}if(S){let Z=await L({generate_images_enabled:"0",image_count:0},"Generating featured image...");ae(Z),ne.featured_image_id=Z.featured_image_id||null,ne.featured_image_url=Z.featured_image_url||null}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",B),ne=await L();if(ne)G(ne),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success");else throw new Error("Image generation failed or returned no data.")}catch(K){typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",K.message||"Failed")}}else typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(l?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let E=t.elements.enable_vector_store,S=E&&E.checked?"1":"0",A=t.elements.vector_store_provider?.value,T=t.elements["openai_vector_store_ids[]"],M=T?Array.from(T.selectedOptions).map(L=>L.value):[],V=t.elements.pinecone_index_name?.value,W=t.elements.qdrant_collection_name?.value,R=t.elements.vector_store_top_k?.value,B=t.elements.vector_store_confidence_threshold?.value,$={generated_content:n.fullContent,final_title:w,keywords:b,provider:f,model:m,prompt_mode:k,custom_excerpt_prompt:t.elements.custom_excerpt_prompt.value,enable_vector_store:S,vector_store_provider:A,openai_vector_store_ids:M,pinecone_index_name:V,qdrant_collection_name:W,vector_store_top_k:R,vector_store_confidence_threshold:B,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},G=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",$);if(G&&G.excerpt){let L=document.getElementById("aipkit_cw_generated_excerpt"),K=document.getElementById("aipkit_cw_excerpt_output_wrapper");L&&K&&(L.value=G.excerpt,K.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(E){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",E.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(_?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let E=t.elements.enable_vector_store,S=E&&E.checked?"1":"0",A=t.elements.vector_store_provider?.value,T=t.elements["openai_vector_store_ids[]"],M=T?Array.from(T.selectedOptions).map(L=>L.value):[],V=t.elements.pinecone_index_name?.value,W=t.elements.qdrant_collection_name?.value,R=t.elements.vector_store_top_k?.value,B=t.elements.vector_store_confidence_threshold?.value,$={generated_content:n.fullContent,final_title:w,keywords:b,provider:f,model:m,prompt_mode:k,custom_tags_prompt:t.elements.custom_tags_prompt.value,enable_vector_store:S,vector_store_provider:A,openai_vector_store_ids:M,pinecone_index_name:V,qdrant_collection_name:W,vector_store_top_k:R,vector_store_confidence_threshold:B,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},G=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",$);if(G&&G.tags){let L=document.getElementById("aipkit_cw_generated_tags"),K=document.getElementById("aipkit_cw_tags_output_wrapper");L&&K&&(L.value=G.tags,K.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(E){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",E.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(d?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let E=t.elements.enable_vector_store,S=E&&E.checked?"1":"0",A=t.elements.vector_store_provider?.value,T=t.elements["openai_vector_store_ids[]"],M=T?Array.from(T.selectedOptions).map(L=>L.value):[],V=t.elements.pinecone_index_name?.value,W=t.elements.qdrant_collection_name?.value,R=t.elements.vector_store_top_k?.value,B=t.elements.vector_store_confidence_threshold?.value,$={generated_content:n.fullContent,final_title:w,keywords:b,provider:f,model:m,prompt_mode:k,custom_meta_prompt:t.elements.custom_meta_prompt.value,enable_vector_store:S,vector_store_provider:A,openai_vector_store_ids:M,pinecone_index_name:V,qdrant_collection_name:W,vector_store_top_k:R,vector_store_confidence_threshold:B,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},G=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",$);if(G&&G.meta_description){let L=document.getElementById("aipkit_cw_generated_meta_desc"),K=document.getElementById("aipkit_cw_meta_desc_output_wrapper");L&&K&&(L.value=G.meta_description,K.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(E){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",E.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c)}window.aipkit_stream_handleDone=a})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function a(r,n,e,i,s){if(n.isDone)return;if(s.current&&s.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(s);return}let c="Error during streaming.";if(r.data)try{c=JSON.parse(r.data).error||c}catch{}console.error("Stream Error Handler: Error event received:",r),e&&(e.textContent="",e.className="aipkit_cw_status_badge"),i&&i.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",c),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(s)}window.aipkit_stream_handleError=a})();(function(){"use strict";let g={current:null};function a(r,n){let e=document.getElementById("aipkit_content_writer_output_display"),i=document.getElementById("aipkit_cw_generated_content_area"),s=document.getElementById("aipkit_content_writer_form_status");if(!e||!i||!s){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let c=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let d of c)if(typeof window[d]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${d}`),s&&(s.textContent="",s.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let t={fullContent:"",isDone:!1};i.innerHTML="",e.classList.remove("aipkit_content_writer_output_error"),s&&(s.textContent="",s.className="aipkit_cw_status_badge"),window.aipkit_updateCwGenerationStatus("content","generating");try{n.current=window.aipkit_stream_setupEventSourceConnection(r,n);let d=window.aipkit_getMarkdownRenderer();n.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},n.current.onmessage=function(o){window.aipkit_stream_handleMessage(o,t,i,d)},n.current.addEventListener("done",function(o){window.aipkit_stream_handleDone(o,t,i,d,s,n)}),n.current.addEventListener("error",function(o){window.aipkit_stream_handleError(o,t,s,e,n)})}catch(d){console.error("EventSource Orchestrator: Error during setup:",d),s&&(s.textContent="",s.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=a,window.aipkit_contentWriterEventSourceInstanceRef=g})();(function(){"use strict";function g(a){a&&a.current&&a.current.close()}window.aipkit_stopContentWriterEventSource=g})();(function(){"use strict";async function g(a){let r=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_form_status"),i=document.getElementById("aipkit_cw_generated_content_area"),s=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn"),t=document.querySelector(".aipkit_content_writer_progress_bar_container"),d=document.querySelector(".aipkit_content_writer_output_actions"),o=function(m){if(!m)return"Error";let k=m.message||"Error",u=m.details||m.data?.details,w=u?.provider,h=u?.model;return w||h?`${k} (${[w,h].filter(Boolean).join(" \xB7 ")})`:k};if(!r||!n||!e||!i||!s||!c||!d){console.error("Handle SSE: Missing UI elements.");return}let l=new FormData(r),_=Object.fromEntries(l.entries()),p=r.elements["openai_vector_store_ids[]"];if(_.openai_vector_store_ids=p?Array.from(p.selectedOptions).map(m=>m.value):[],delete _["openai_vector_store_ids[]"],!_.conversation_uuid){let m=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();m&&(_.conversation_uuid=m)}if(!_.content_title){e.textContent="",e.className="aipkit_cw_status_badge";return}let f=document.getElementById("aipkit_content_writer_nonce");if(f&&f.value)_._ajax_nonce=f.value;else{e.textContent="",e.className="aipkit_cw_status_badge";return}typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0),t&&(t.style.display="none"),d.style.display="none",i&&(i.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'),s.disabled=!0,c.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),e.textContent="",e.className="aipkit_cw_status_badge";try{_.content_title=document.getElementById("aipkit_content_writer_title").value;let m=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",_);if(!m.cache_key)throw new Error(m.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=m.cache_key,m.conversation_uuid){window.aipkit_current_conversation_uuid=m.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",m.conversation_uuid)}catch{}}if(typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(m.cache_key,a);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(m){console.error("Content Writer Init Stream Error:",m),e&&(e.textContent=o(m),e.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),window.aipkit_setLoadingStateOpenAI(n,!1,"Generate"),typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),i&&(i.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n},a=function(n){if(!n)return"Error";let e=n.message||"Error",i=n.details||n.data?.details,s=i?.provider,c=i?.model;return s||c?`${e} (${[s,c].filter(Boolean).join(" \xB7 ")})`:e};async function r(){let n=document.getElementById("aipkit_content_writer_form"),e=document.getElementById("aipkit_content_writer_generate_btn"),i=document.getElementById("aipkit_content_writer_stop_btn"),s=document.getElementById("aipkit_content_writer_form_status"),c=document.getElementById("aipkit_cw_generated_content_area"),t=document.getElementById("aipkit_content_writer_copy_btn"),d=document.getElementById("aipkit_content_writer_clear_btn"),o=document.querySelector(".aipkit_content_writer_progress_bar_container"),l=o?o.querySelector(".aipkit_content_writer_progress_bar"):null,_=document.querySelector(".aipkit_content_writer_output_actions"),p=document.getElementById("aipkit_cw_status_display_container");if(!n||!e||!i||!s||!c||!t||!d){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),s.textContent="",s.className="aipkit_cw_status_badge";return}let f=new FormData(n),m=Object.fromEntries(f.entries()),k=n.elements["openai_vector_store_ids[]"];if(m.openai_vector_store_ids=k?Array.from(k.selectedOptions).map(x=>x.value):[],delete m["openai_vector_store_ids[]"],!m.conversation_uuid){let x=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();x&&(m.conversation_uuid=x)}if(!m.content_title){s.textContent="",s.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let u=document.getElementById("aipkit_content_writer_nonce");if(u&&u.value)m._ajax_nonce=u.value;else{s.textContent="",s.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}p&&(p.style.display="block");let w=document.getElementById("aipkit_cw_generate_meta_desc"),h=document.getElementById("aipkit_cw_generate_focus_keyword"),v=document.getElementById("aipkit_cw_generate_excerpt"),C=document.getElementById("aipkit_cw_generate_tags");typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",v?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",C?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",w?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",h?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(e,!0,"Generate","Generating..."),i.style.display="none",_&&(_.style.display="none"),c&&(c.innerHTML=""),t.disabled=!0,d.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),s.textContent="Generating content, please wait...",s.className="aipkit_cw_status_badge aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),o&&l&&(o.style.display="block",l.style.width="0%",l.classList.add("aipkit_indeterminate"));try{let x=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",m);if(x.content){if(x.conversation_uuid){window.aipkit_current_conversation_uuid=x.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",x.conversation_uuid)}catch{}}let b=window.aipkit_getMarkdownRenderer();if(c&&(b?c.innerHTML=b.render(x.content):c.textContent=x.content,typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(c.innerHTML)),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),_&&(_.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),t.disabled=!1,d.disabled=!1,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),x.content&&v?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let I=n.elements.enable_vector_store,y=I&&I.checked?"1":"0",q=n.elements.vector_store_provider?.value,E=n.elements["openai_vector_store_ids[]"],S=E?Array.from(E.selectedOptions).map(B=>B.value):[],A=n.elements.pinecone_index_name?.value,T=n.elements.qdrant_collection_name?.value,M=n.elements.vector_store_top_k?.value,V=n.elements.vector_store_confidence_threshold?.value,W={generated_content:x.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_excerpt_prompt:m.custom_excerpt_prompt,enable_vector_store:y,vector_store_provider:q,openai_vector_store_ids:S,pinecone_index_name:A,qdrant_collection_name:T,vector_store_top_k:M,vector_store_confidence_threshold:V,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},R=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",W);if(R&&R.excerpt){let B=document.getElementById("aipkit_cw_generated_excerpt"),$=document.getElementById("aipkit_cw_excerpt_output_wrapper");B&&$&&(B.value=R.excerpt,$.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(I){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",I.message||"Not returned")}}if(x.content&&C?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let I=n.elements.enable_vector_store,y=I&&I.checked?"1":"0",q=n.elements.vector_store_provider?.value,E=n.elements["openai_vector_store_ids[]"],S=E?Array.from(E.selectedOptions).map(B=>B.value):[],A=n.elements.pinecone_index_name?.value,T=n.elements.qdrant_collection_name?.value,M=n.elements.vector_store_top_k?.value,V=n.elements.vector_store_confidence_threshold?.value,W={generated_content:x.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_tags_prompt:m.custom_tags_prompt,enable_vector_store:y,vector_store_provider:q,openai_vector_store_ids:S,pinecone_index_name:A,qdrant_collection_name:T,vector_store_top_k:M,vector_store_confidence_threshold:V,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},R=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",W);if(R&&R.tags){let B=document.getElementById("aipkit_cw_generated_tags"),$=document.getElementById("aipkit_cw_tags_output_wrapper");B&&$&&(B.value=R.tags,$.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(I){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",I.message||"Not returned")}}if(x.meta_description){let I=document.getElementById("aipkit_cw_generated_meta_desc"),y=document.getElementById("aipkit_cw_meta_desc_output_wrapper");I&&y&&(I.value=x.meta_description,y.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else w?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(x.focus_keyword){let I=document.getElementById("aipkit_cw_generated_focus_keyword"),y=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");I&&y&&(I.value=x.focus_keyword,y.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else h?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(x.message||"No content received.")}catch(x){console.error("Content Writer AJAX Error:",x),s&&(s.textContent=a(x),s.className="aipkit_cw_status_badge aipkit_settings_message-error"),c&&(c.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",x.message),v?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),C?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),w?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),h?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),_&&(_.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Generate"),o&&(o.style.display="none"),l&&l.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=r})();(function(){"use strict";let g=window.wp?.i18n?.__||function(r){return r};function a(r){let n=document.getElementById("aipkit_content_writer_generate_btn"),e=()=>{if(n){if(typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(n,g("Stopping...","gpt3-ai-content-generator"));else{let s=n.querySelector(".aipkit_btn-text");s?s.textContent=g("Stopping...","gpt3-ai-content-generator"):n.textContent=g("Stopping...","gpt3-ai-content-generator")}n.disabled=!0,n.setAttribute("aria-disabled","true")}};if(typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){e(),typeof window.aipkit_cw_requestBatchStop=="function"&&window.aipkit_cw_requestBatchStop();return}if(typeof window.aipkit_cw_isExistingUpdateActive=="function"&&window.aipkit_cw_isExistingUpdateActive()){e(),typeof window.aipkit_cw_requestExistingUpdateStop=="function"&&window.aipkit_cw_requestExistingUpdateStop();return}if(!r||!r.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let i=document.getElementById("aipkit_content_writer_form_status");i&&(i.textContent=g("Stopping...","gpt3-ai-content-generator"),i.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),i.classList.add("aipkit_settings_message-info")),e(),r.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(r):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=a})();(function(){"use strict";let g={rss:["{description}"],url:["{url_content}"]},a=new Set(["task","csv","gsheets"]),r="{topic}",n=l=>{if(!l)return"Error";let _=l.message||"Error",p=l.details||l.data?.details,f=p?.provider,m=p?.model;return f||m?`${_} (${[f,m].filter(Boolean).join(" \xB7 ")})`:_},e=(l,_)=>{let p=l.querySelector(_);return p?String(p.value||""):""},i=(l,_)=>_.filter(p=>!l.includes(p)),s=(l,_,p)=>{let f=[],m=l==="rss"?"RSS":"URL";return _.length&&f.push(`Title prompt: missing ${_.join(", ")}.`),p.length&&f.push(`Content prompt: missing ${p.join(", ")}.`),f.length?`${m} mode works best when your prompts include the source placeholders.

${f.join(`
`)}

Please update your prompts and try again.`:""},c=(l,_)=>{let p=g[_];if(!p)return{shouldWarn:!1,message:""};let f=e(l,"#aipkit_cw_custom_title_prompt").trim(),m=e(l,"#aipkit_cw_custom_content_prompt").trim(),k=f?i(f,p):[],u=m?i(m,p):p.slice(),w=s(_,k,u);return{shouldWarn:!!w,message:w}},t=(l,_)=>_.length?`${l} mode requires ${r} in your prompts.

${_.join(`
`)}

Please update your prompts and try again.`:"",d=(l,_)=>{if(!a.has(_))return{shouldWarn:!1,message:""};let f={task:"Manual entry",csv:"CSV",gsheets:"Google Sheets"}[_]||"This",m=[{selector:"#aipkit_cw_custom_title_prompt",label:"Title prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_content_prompt",label:"Content prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_meta_prompt",label:"Meta description prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_meta_desc")?.checked},{selector:"#aipkit_cw_custom_keyword_prompt",label:"Focus keyword prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_focus_keyword")?.checked},{selector:"#aipkit_cw_custom_excerpt_prompt",label:"Excerpt prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_excerpt")?.checked},{selector:"#aipkit_cw_custom_tags_prompt",label:"Tags prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_tags")?.checked}],k=[];m.forEach(w=>{if(!w.enabled())return;let h=e(l,w.selector).trim();(h?i(h,[r]):[r]).length&&k.push(`${w.label}: missing ${r}.`)});let u=t(f,k);return{shouldWarn:!!u,message:u}};function o(l,_,p,f){l&&(l.dataset.listenerAttached||(l.addEventListener("click",async()=>{if(l.dataset.aipkitStopMode==="true"){typeof window.aipkit_handleStopGeneration=="function"&&window.aipkit_handleStopGeneration(f);return}try{delete window.aipkit_current_conversation_uuid,sessionStorage.removeItem("aipkit_current_conversation_uuid")}catch{}typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview();let m=document.getElementById("aipkit_cw_image_data_holder");if(m&&(m.value=""),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),l.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Upgrade URL not found. Please visit our website.",{title:"Upgrade"}):alert("Upgrade URL not found. Please visit our website.");return}if(l.dataset.action==="fetch_feeds"){typeof window.aipkit_handleRssFetchFromGenerateButton=="function"?window.aipkit_handleRssFetchFromGenerateButton(l):console.error("Fetch Feeds: Handler function not found.");return}let k=document.getElementById("aipkit_content_writer_form_status"),u=document.getElementById("aipkit_cw_action_validation"),w=l.dataset.action||"generate",h=w==="generate_single"?"generate":w,v=document.getElementById("aipkit_cw_mode_select"),C=v?v.value:"task";if(C==="single"&&(C="task"),C==="existing"||C.indexOf("existing-")===0){if(typeof window.aipkit_runContentWriterExistingUpdate=="function")window.aipkit_runContentWriterExistingUpdate();else{let H="Update panel is not ready yet. Please refresh the page and try again.";typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(H,{title:"Update existing"}):alert(H)}return}let x=H=>String(H||"").split(/\r?\n/).map(ne=>ne.trim()).filter(Boolean),b=H=>{let ne=String(H||"").split("|").map(ae=>ae.trim());return{topic:ne[0]||"",keywords:ne[1]||"",category:ne[2]||"",authorLogin:ne[3]||"",type:ne[4]||"",schedule:ne[5]||""}},I=()=>{let H=Array.from(_.querySelectorAll("[data-aipkit-bulk-row]"));for(let ne of H){let ae=ne.querySelector('[data-bulk-field="topic"]'),Z=ae?ae.value.trim():"";if(!Z)continue;let pe=ne.querySelector('[data-bulk-field="keywords"]')?.value.trim()||"",ve=ne.querySelector('[data-bulk-field="category"]')?.value.trim()||"",De=ne.querySelector('[data-bulk-field="author"]'),Qe=De?De.value.trim():"",$e=De?.selectedOptions?.[0]?.dataset?.userId||"",lt=ne.querySelector('[data-bulk-field="type"]')?.value.trim()||"",it=ne.querySelector('[data-bulk-field="schedule"]')?.value.trim()||"";return{topic:Z,keywords:pe,category:ve,authorLogin:Qe,authorId:$e,type:lt,schedule:it}}return null},y=H=>{if(!H||!H.topic)return;let ne=document.getElementById("aipkit_content_writer_title"),ae=H.keywords?`${H.topic} | ${H.keywords}`:H.topic;ne&&(ne.value=ae,ne.dispatchEvent(new Event("change",{bubbles:!0})));let Z=_.elements.post_type;Z&&H.type&&(Z.value=H.type,Z.dispatchEvent(new Event("change",{bubbles:!0})));let pe=_.elements["post_categories[]"];pe&&H.category&&(Array.from(pe.options).forEach(De=>{De.selected=De.value===H.category}),pe.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect());let ve=_.elements.post_author;if(ve){let De=H.authorId||"";if(!De&&H.authorLogin){let Qe=Array.from(ve.options).find($e=>$e.dataset.login===H.authorLogin||$e.value===H.authorLogin);Qe&&(De=Qe.value)}De&&(ve.value=De,ve.dispatchEvent(new Event("change",{bubbles:!0})))}};if(h!=="upgrade"){let H=typeof window.aipkit_validateContentWriterInputs=="function"?window.aipkit_validateContentWriterInputs(_,C):{isValid:!0};if(!H.isValid){typeof window.aipkit_showContentWriterValidationError=="function"?window.aipkit_showContentWriterValidationError(k||u,H.message):k&&(k.textContent=H.message||"",k.className="aipkit_cw_status_badge aipkit_settings_message-error");return}}if(typeof window.aipkit_clearContentWriterValidationMessage=="function"?(window.aipkit_clearContentWriterValidationMessage(k),window.aipkit_clearContentWriterValidationMessage(u)):u&&(u.textContent=""),h==="generate"||h==="create_task"){let{shouldWarn:H,message:ne}=c(_,C);if(H){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(ne,{title:"Update prompts",okText:"Review prompts"}):alert(ne);return}let ae=d(_,C);if(ae.shouldWarn){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(ae.message,{title:"Update prompts",okText:"Review prompts"}):alert(ae.message);return}}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let q=document.getElementById("aipkit_cw_status_display_container"),E=document.getElementById("aipkit_cw_generated_title_display"),S=document.getElementById("aipkit_content_writer_title");if(h==="create_task"){q&&(q.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(_,l,k):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),k&&(k.textContent="",k.className="aipkit_cw_status_badge"));return}let A=_.elements.content_title_bulk,T=x(A?A.value:""),M=h==="generate"&&C==="task"&&T.length===1;if(M){let H=I()||b(T[0]);y(H),typeof window.aipkit_cw_resetBatchQueue=="function"&&window.aipkit_cw_resetBatchQueue()}if(h==="generate"&&!M){typeof window.aipkit_cw_handleBatchGeneration=="function"?window.aipkit_cw_handleBatchGeneration(_,C):console.error("Generate Button Listener: aipkit_cw_handleBatchGeneration function not found.");return}let V=document.getElementById("aipkit_cw_single_output_wrapper"),W=document.getElementById("aipkit_cw_output_card");V&&(V.style.display="block"),W&&(W.style.display="block"),q&&(q.style.display="block");let R=document.getElementById("aipkit_content_writer_stream_mode"),$=_.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),p&&(p.style.display="flex");let G={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[H,ne]of Object.entries(G)){let ae=document.getElementById(ne);ae&&!ae.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(H,"skipped")}let L=document.getElementById("aipkit_cw_generate_images_enabled"),K=document.getElementById("aipkit_cw_generate_featured_image");if(L&&K&&!L.checked&&!K.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),$){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),E&&(E.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(l,!0,"Generate","Generating...");let H=new FormData(_),ne=Object.fromEntries(H.entries()),ae=_.elements["openai_vector_store_ids[]"];ne.openai_vector_store_ids=ae?Array.from(ae.selectedOptions).map(ve=>ve.value):[],delete ne["openai_vector_store_ids[]"];let Z=document.getElementById("aipkit_content_writer_nonce");ne._ajax_nonce=Z?Z.value:"",window.aipkit_current_conversation_uuid&&(ne.conversation_uuid=window.aipkit_current_conversation_uuid);let pe=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",ne);if(pe&&pe.new_title){if(pe.conversation_uuid){window.aipkit_current_conversation_uuid=pe.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",pe.conversation_uuid)}catch{}}E&&(E.textContent=pe.new_title,E.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success")}else throw new Error(pe.message||"Failed to generate new title.")}catch(H){console.error("Title Generation Error:",H),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",H.message),k&&(k.textContent=n(H),k.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),E&&S&&(E.textContent=S.value.split("|")[0].trim(),E.style.display="block");!R||R.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(f):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),l.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=o})();(function(){"use strict";function g(a,r){a&&(a.dataset.listenerAttached||(a.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(r):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),a.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=g})();(function(){"use strict";function g(a,r){if(a===r)return!0;if(a==null||typeof a!="object"||r==null||typeof r!="object")return!1;let n=Object.keys(a),e=Object.keys(r);if(n.length!==e.length)return!1;for(let i of n)if(!e.includes(i)||!g(a[i],r[i]))return!1;return!0}window.aipkit_deepEqual=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_content_writer_provider"),r=document.getElementById("aipkit_content_writer_temperature"),n=document.getElementById("aipkit_content_writer_post_author"),e=n?n.value:window.aipkit_dashboard?.currentUserId||"1",s=(a&&a.options.length>0?a.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),c=a?a.value.toLowerCase():s,t="",d=window.aipkit_dashboard?.models?.[c];switch(c){case"openai":t="gpt-4.1-mini";break;case"google":t="gemini-2.5-flash";break;case"openrouter":t="anthropic/claude-3.7-sonnet";break;case"claude":t="claude-opus-4-6",Array.isArray(d)&&d.length>0&&(d.some(p=>p&&p.id==="claude-opus-4-6")||(t=d[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(d)&&d.length>0?t=d[0].id||"":t="";break;default:t=""}let o=r&&r.defaultValue||"1.0",l=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:c,ai_model:t,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:o,reasoning_effort:"medium",post_type:"post",post_author:e,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:l.title,custom_content_prompt:l.content,generate_title:"1",generate_content:"1",generate_meta_description:"1",custom_meta_prompt:l.meta,generate_focus_keyword:"1",custom_keyword_prompt:l.keyword,generate_excerpt:"1",custom_excerpt_prompt:l.excerpt,generate_tags:"1",custom_tags_prompt:l.tags,custom_title_prompt_update:"",custom_content_prompt_update:"",custom_meta_prompt_update:"",custom_keyword_prompt_update:"",custom_excerpt_prompt_update:"",custom_tags_prompt_update:"",cw_generation_mode:"task",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"dall-e-3",image_prompt:l.image||"A high-quality, relevant image for an article about: {topic}",image_prompt_update:"",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",image_title_prompt:l.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt:l.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt:l.image_caption||"Write a short image caption based on: {topic}",image_description_prompt:l.image_description||"Write a brief image description based on: {topic}",image_title_prompt_update:l.image_title_update||l.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt_update:l.image_alt_text_update||l.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt_update:l.image_caption_update||l.image_caption||"Write a short image caption based on: {topic}",image_description_prompt_update:l.image_description_update||l.image_description||"Write a brief image description based on: {topic}",generate_featured_image:"0",featured_image_prompt:l.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",featured_image_prompt_update:"",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",vector_store_confidence_threshold:"20",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=g})();(function(){"use strict";function g(a){let r={};if(!a)return r;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","custom_title_prompt_update","custom_content_prompt_update","custom_meta_prompt_update","custom_keyword_prompt_update","custom_excerpt_prompt_update","custom_tags_prompt_update","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_prompt_update","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","image_title_prompt_update","image_alt_text_prompt_update","image_caption_prompt_update","image_description_prompt_update","featured_image_prompt","featured_image_prompt_update","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(x=>{a.elements[x]&&(r[x]=a.elements[x].value)});let e=a.elements.generate_meta_description;e?r.generate_meta_description=e.checked?"1":"0":r.generate_meta_description="0";let i=a.elements.generate_focus_keyword;i?r.generate_focus_keyword=i.checked?"1":"0":r.generate_focus_keyword="0";let s=a.elements.generate_excerpt;s?r.generate_excerpt=s.checked?"1":"0":r.generate_excerpt="0";let c=a.elements.generate_tags;c?r.generate_tags=c.checked?"1":"0":r.generate_tags="0";let t=a.elements.generate_title;t?r.generate_title=t.checked?"1":"0":r.generate_title="1";let d=a.elements.generate_content;d?r.generate_content=d.checked?"1":"0":r.generate_content="1";let o=a.elements.generate_toc;o?r.generate_toc=o.checked?"1":"0":r.generate_toc="0";let l=a.elements.generate_seo_slug;l?r.generate_seo_slug=l.checked?"1":"0":r.generate_seo_slug="0";let _=a.elements.generate_images_enabled;_?r.generate_images_enabled=_.checked?"1":"0":r.generate_images_enabled="0";let p=a.elements.generate_featured_image;p?r.generate_featured_image=p.checked?"1":"0":r.generate_featured_image="0",["generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(x=>{let b=a.elements[x];b?r[x]=b.checked?"1":"0":r[x]="1"});let f=a.elements.enable_vector_store;f?r.enable_vector_store=f.checked?"1":"0":r.enable_vector_store="0";let m=a.elements["openai_vector_store_ids[]"];m?r.openai_vector_store_ids=Array.from(m.selectedOptions).map(x=>x.value):r.openai_vector_store_ids=[];let k=a.querySelector("#aipkit_cw_prompt_mode_hidden_input");k?r.prompt_mode=k.value:r.prompt_mode="custom";let u=a.querySelector("#aipkit_cw_mode_select"),w=u?u.value:"task";r.cw_generation_mode=w==="single"?"task":w;let h=a.elements["post_categories[]"];h?r.post_categories=Array.from(h.selectedOptions).map(x=>x.value):r.post_categories=[];let v=["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt"],C=typeof window.aipkit_getContentWriterPromptSets=="function"?window.aipkit_getContentWriterPromptSets():null;return C&&C.create&&v.forEach(x=>{Object.prototype.hasOwnProperty.call(C.create,x)&&(r[x]=C.create[x])}),C&&C.update&&v.forEach(x=>{let b=`${x}_update`;Object.prototype.hasOwnProperty.call(C.update,x)&&(r[b]=C.update[x])}),r}window.aipkit_getContentWriterFormConfig=g})();(function(){"use strict";function g(a){if(!a||!a.value)return!1;let r=a.value,n=window.aipkit_cw_template_state.currentTemplates.find(e=>String(e.id)===String(r));return n&&String(n.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_content_writer_post_status"),r=document.getElementById("aipkit_cw_schedule_options_wrapper"),n=document.getElementById("aipkit_cw_smart_schedule_fields"),e=document.querySelector(".aipkit_schedule_from_input_help"),i=document.querySelector(".aipkit_schedule_from_input_option");if(!a||!r)return;let s=a.value==="publish";r.style.display=s?"block":"none";let c=document.getElementById("aipkit_cw_mode_select"),t=c?c.value:"task",d=new Set(["task","csv","gsheets"]),o=d.has(t);if(i){i.style.display=o?"inline-flex":"none";let p=i.querySelector('input[name="schedule_mode"]');if(!o&&p&&p.checked){let f=document.querySelector('input[name="schedule_mode"][value="immediate"]');f&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(p=>{p.dataset.listenerAttached||(p.addEventListener("change",function(){let f=document.getElementById("aipkit_cw_mode_select"),m=f?f.value:"task",k=d.has(m);n&&(n.style.display=this.value==="smart"?"block":"none"),e&&(e.style.display=this.value==="from_input"&&k?"block":"none")}),p.dataset.listenerAttached="true")});let _=document.querySelector('input[name="schedule_mode"]:checked');_&&n&&(n.style.display=_.value==="smart"?"block":"none"),_&&e&&(e.style.display=_.value==="from_input"&&o?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(i){return i},a={image_title_prompt:"aipkit_cw_image_title_prompt",image_alt_text_prompt:"aipkit_cw_image_alt_text_prompt",image_caption_prompt:"aipkit_cw_image_caption_prompt",image_description_prompt:"aipkit_cw_image_description_prompt"};function r(i){if(!i)return"";let s=document.querySelector(`.aipkit_cw_prompt_library_select[data-aipkit-prompt-target="${CSS.escape(i)}"]`);if(!s)return"";let c=s.querySelector("option");return c?c.value:""}function n(){let i=document.getElementById("aipkit_cw_single_output_wrapper"),s=document.getElementById("aipkit_cw_generated_title_display"),c=document.getElementById("aipkit_cw_generated_content_area"),t=document.getElementById("aipkit_cw_meta_chunk"),d=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),o=document.querySelector(".aipkit_content_writer_output_actions");i&&(i.style.display="none"),s&&(s.style.display="none",s.textContent=""),c&&(c.innerHTML=""),t&&(t.style.display="none"),d&&(d.style.display="none"),o&&(o.style.display="none"),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction()}function e(i,s=!1){let c=window.aipkit_cw_autosave_suspended===!0;window.aipkit_cw_autosave_suspended=!0;try{let t=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,d=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.currentTemplateId=i,i?sessionStorage.setItem("aipkit_cw_last_template_id",i):sessionStorage.removeItem("aipkit_cw_last_template_id");let o=window.aipkit_cw_template_state.currentTemplates.find(f=>String(f.id)===String(i)),l;if(o)l=JSON.parse(JSON.stringify(o.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),d&&!s&&d("Error: Cannot load default template.");return}l=window.aipkit_getDefaultContentWriterTemplateConfig()}let _=l&&l.template_scope==="prompts_only";_||(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(l)),window.aipkit_cw_template_state.currentTemplateModified=!1),n();let p=document.getElementById("aipkit_content_writer_form");if(!p){console.error("Apply Template: Content writer form not found.");return}if(!_&&l.ai_model&&p.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=l.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,l.image_model&&p.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=l.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,_){let f=document.getElementById("aipkit_cw_prompt_mode_hidden_input");f&&(f.value=l.prompt_mode||"custom"),["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt"].forEach(x=>{let b=Object.prototype.hasOwnProperty.call(l,x),I=p.elements[x];if(!I)return;let y=l[x]===null||typeof l[x]>"u"?"":l[x],q=!!a[x],E=typeof y=="string"?y.trim()==="":y==="";if((!b||E)&&q){I.value=r(a[x]);return}b&&(I.value=y)}),["generate_images_enabled","generate_featured_image","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(x=>{if(!Object.prototype.hasOwnProperty.call(l,x))return;let b=p.elements[x];if(!b)return;let I=l[x];b.checked=I==="1"||I===1||I===!0}),["generate_title","generate_content","generate_meta_description","generate_focus_keyword","generate_excerpt","generate_tags"].forEach(x=>{if(!Object.prototype.hasOwnProperty.call(l,x))return;let b=p.elements[x];if(!b)return;let I=l[x];b.checked=I==="1"||I===1||I===!0});let w=p.elements.content_length;w&&Object.prototype.hasOwnProperty.call(l,"content_length")&&(w.value=l.content_length||"medium",w.dispatchEvent(new Event("change",{bubbles:!0})));let h=p.elements.image_provider;h&&Object.prototype.hasOwnProperty.call(l,"image_provider")&&(h.value=l.image_provider||"",h.dispatchEvent(new Event("change",{bubbles:!0}))),["image_count","image_size","image_alignment","image_placement"].forEach(x=>{if(!Object.prototype.hasOwnProperty.call(l,x))return;let b=p.elements[x];if(!b)return;let I=l[x]===null||typeof l[x]>"u"?"":l[x];b.type==="checkbox"?b.checked=I==="1"||I===1||I===!0:b.value=I});let C=p.elements.image_model;if(C&&Object.prototype.hasOwnProperty.call(l,"image_model")){let x=l.image_model||"";x&&C.querySelector(`option[value="${CSS.escape(x)}"]`)&&(C.value=x)}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI()}else{["ai_provider","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(q=>{let E=p.elements[q];if(E){let S=Object.prototype.hasOwnProperty.call(l,q),A=l[q]===null||typeof l[q]>"u"?"":l[q],T=!!a[q],M=typeof A=="string"?A.trim()==="":A==="";if((!S||M)&&T){E.value=r(a[q]);return}if(q==="gsheets_credentials"&&typeof A=="object"&&A!==null)E.value=JSON.stringify(A,null,2);else if((q==="ai_temperature"||q==="vector_store_top_k"||q==="vector_store_confidence_threshold")&&E.type==="range"){E.value=A||(q==="ai_temperature"?"1.0":q==="vector_store_top_k"?"3":q==="vector_store_confidence_threshold"?"20":"");let V=document.getElementById(E.id+"_value");V&&(V.textContent=q==="vector_store_confidence_threshold"?E.value+"%":E.value)}else E.type==="checkbox"?E.checked=A==="1":E.value=A;q==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),q==="content_length"&&E.dispatchEvent(new Event("change",{bubbles:!0}))}});let m=p.elements.gsheets_credentials;if(m){let q=l.gsheets_credentials,E=m.closest(".aipkit_gsheets_section_container");m.value=typeof q=="object"&&q!==null?JSON.stringify(q,null,2):q||"",m.value?(m.dataset.filename="credentials.json",E&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(E),100)):(delete m.dataset.filename,E&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(E,"clear"))}let k={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",enable_vector_store:"0"};for(let[q,E]of Object.entries(k)){let S=p.elements[q];if(S){let A=Object.prototype.hasOwnProperty.call(l,q)?l[q]:E;S.checked=A==="1"||A===1||A===!0}}let u=document.getElementById("aipkit_cw_prompt_mode_hidden_input");u&&(u.value=l.prompt_mode||"custom");let w=p.querySelector("#aipkit_cw_mode_select"),h=l.cw_generation_mode||"task",v=h==="single"?"task":h;w&&(w.value=v,w.dispatchEvent(new Event("change",{bubbles:!0})));let C=p.elements["post_categories[]"];if(C){let q=Array.isArray(l.post_categories)?l.post_categories.map(E=>String(E)):[];Array.from(C.options).forEach(E=>{E.selected=q.includes(E.value)}),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect()}let x=p.elements["openai_vector_store_ids[]"];if(x){let q=Array.isArray(l.openai_vector_store_ids)?l.openai_vector_store_ids.map(String):[];Array.from(x.options).forEach(E=>{E.selected=q.includes(E.value)}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect()}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI();let b=p.elements.enable_vector_store;b&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(b.closest(".aipkit_popover_options_list")||b.closest(".aipkit_cw_settings_popover_body")||document.getElementById("aipkit_content_writer_container"));let I=p.elements.vector_store_provider;I&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(I.value=l.vector_store_provider||"openai",I.dispatchEvent(new Event("change",{bubbles:!0})));let y=p.elements.ai_provider;if(y){let q=y.value,E=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),S=(l.ai_provider||E).toLowerCase();if(q!==S)y.value=S,y.dispatchEvent(new Event("change",{bubbles:!0}));else{let A=p.elements.ai_model;A&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(y,A):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}y.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(i?y.dataset.aipkitProviderNoticeArmed="true":delete y.dataset.aipkitProviderNoticeArmed,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(p))}}if(typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts(),typeof window.aipkit_applyContentWriterPromptSets=="function"&&window.aipkit_applyContentWriterPromptSets(l),_&&(typeof window.aipkit_getContentWriterFormConfig=="function"&&(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=window.aipkit_getContentWriterFormConfig(p)),window.aipkit_cw_template_state.currentTemplateModified=!1),!s&&t&&t("Updated"),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(i),typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(i),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let f=document.getElementById("aipkit_content_writer_container");f&&window.aipkit_cw_toggleReasoningEffort(f)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers(),typeof window.aipkit_refreshUrlCounter=="function"&&window.aipkit_refreshUrlCounter(),typeof window.aipkit_refreshRssCounter=="function"&&window.aipkit_refreshRssCounter()}finally{c||(window.aipkit_cw_autosave_suspended=!1),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline()}}window.aipkit_applyContentWriterTemplate=e})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};async function a(r){if(!r){console.error("Fetch & Populate Templates: Select element is missing.");return}let n=document.getElementById("aipkit_content_writer_template_nonce_field"),e=typeof window.aipkit_clearGeneralStatus=="function"?window.aipkit_clearGeneralStatus:null,i=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;r.innerHTML=`<option value="">${g("Loading templates...")}</option>`,r.disabled=!0,e&&e();try{let s=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:n?n.value:""});window.aipkit_cw_template_state.currentTemplates=s.templates||[],r.innerHTML="";let c=new Option(g("-- Select Template --"),"");r.appendChild(c);let t=window.aipkit_cw_template_state.currentTemplates||[],d=window.aipkit_dashboard?.currentUserId?.toString(),o=null,l=[],_=[],p={};t.forEach(u=>{if(String(u.is_default)==="1"&&u.user_id.toString()===d&&(o=u.id),u.user_id.toString()===d)String(u.is_starter)==="1"||u.is_starter===!0?l.push(u):_.push(u);else{let w=u.display_name||`User ID: ${u.user_id}`;p[w]||(p[w]=[]),p[w].push(u)}});let f=u=>{if(u&&u.starter_order!==void 0&&u.starter_order!==null&&u.starter_order!==""){let C=Number(u.starter_order);if(Number.isFinite(C))return C}let h=(u&&u.template_name?String(u.template_name):"").match(/(\d[\d,]*)/);if(!h)return null;let v=parseInt(h[1].replace(/,/g,""),10);return Number.isFinite(v)?v:null};if(_.sort((u,w)=>u.is_default==="1"?-1:w.is_default==="1"?1:u.template_name.localeCompare(w.template_name)),l.sort((u,w)=>{let h=f(u),v=f(w);return h!==null&&v!==null?h-v:h!==null?-1:v!==null?1:u.template_name.localeCompare(w.template_name)}),l.length>0){let u=document.createElement("optgroup");u.label=g("Starter Templates"),l.forEach(w=>{u.appendChild(new Option(g(w.template_name),w.id))}),r.appendChild(u)}if(_.length>0){let u=document.createElement("optgroup");u.label=g("My Templates"),_.forEach(w=>{u.appendChild(new Option(g(w.template_name),w.id))}),r.appendChild(u)}Object.keys(p).sort().forEach(u=>{let w=document.createElement("optgroup");w.label=g(u),p[u].forEach(h=>{w.appendChild(new Option(g(h.template_name),h.id))}),r.appendChild(w)}),r.disabled=!1;let k=sessionStorage.getItem("aipkit_cw_last_template_id");k&&r.querySelector(`option[value="${CSS.escape(k)}"]`)?(r.value=k,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(k,!0)):o?(r.value=o,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(o,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}catch(s){console.error("Error fetching templates:",s),r.innerHTML=`<option value="">${g("Error loading templates")}</option>`,i&&i(`Error: ${s.message||"Failed to load templates."}`),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}}window.aipkit_fetchAndPopulateTemplates=a})();(function(){"use strict";async function g(a,r,n){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let e=document.getElementById("aipkit_content_writer_template_nonce_field"),i=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,s=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,c=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;i&&i("Updating...");try{let t=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:a,template_name:r,config:JSON.stringify(n),_ajax_nonce:e?e.value:""});s&&s("Updated"),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(t.template_config||n)),window.aipkit_cw_template_state.currentTemplateModified=!1,typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline();let d=document.getElementById("aipkit_cw_template_select"),o=t.template_id?String(t.template_id):"";o&&(window.aipkit_cw_template_state.currentTemplateId=o,sessionStorage.setItem("aipkit_cw_last_template_id",o)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&d&&(await window.aipkit_fetchAndPopulateTemplates(d),o&&(d.value=o,typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(o))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(o||window.aipkit_cw_template_state.currentTemplateId)}catch(t){console.error("Error saving template:",t),c&&c(`Error: ${t.message||"Failed to save template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=g})();(function(){"use strict";function g(a){let r=document.getElementById("aipkit_cw_rename_template_btn"),n=document.getElementById("aipkit_cw_delete_template_btn"),e=window.aipkit_dashboard||{},i=e.isAdmin||!1,s=e.currentUserId?String(e.currentUserId):"0",c=window.aipkit_cw_template_state.currentTemplates.find(l=>String(l.id)===String(a));if(!c){r&&(r.disabled=!0),n&&(n.disabled=!0);return}let t=String(c.user_id)===s,d=t||i,o=t||i;r&&(r.disabled=!d),n&&(n.disabled=!o)}window.aipkit_updateTemplateActionButtonsState=g})();(function(){"use strict";function g(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let a=document.getElementById("aipkit_content_writer_form");if(!a)return;let r=window.aipkit_getContentWriterFormConfig(a),n=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(r,n),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=g})();(function(){"use strict";function g(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function a(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),n=r.value,e=r.options[r.selectedIndex],i=e?e.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!n||n===""||window.aipkit_isDefaultTemplateSelected(e)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot rename the default template or no template is selected.",{title:"Template"}):alert("Cannot rename the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("rename",i)}window.aipkit_handleRenameContentWriterTemplate=a})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function a(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),n=r.value,e=r.options[r.selectedIndex],i=e?e.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete: core function missing.",{title:"Template"}):alert("Cannot delete: core function missing."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!n||n===""||window.aipkit_isDefaultTemplateSelected(e)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete the default template or no template is selected.",{title:"Template"}):alert("Cannot delete the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateDeleteConfirm(i)}window.aipkit_handleDeleteContentWriterTemplate=a})();(function(){"use strict";let g=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,a=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,r=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;async function n(){if(!window.aipkit_cw_template_state||window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_content_writer_template_nonce_field"),s=document.getElementById("aipkit_cw_template_select");window.aipkit_cw_template_state.isSavingOrDeleting=!0,g&&g("Resetting starter templates...");try{await window.aipkit_apiRequest("aipkit_reset_cw_starter_templates",{_ajax_nonce:i?i.value:""}),sessionStorage.removeItem("aipkit_cw_last_template_id"),s&&typeof window.aipkit_fetchAndPopulateTemplates=="function"&&await window.aipkit_fetchAndPopulateTemplates(s),a&&a("Starter templates reset."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover()}catch(c){console.error("Error resetting starter templates:",c),r&&r(`Error: ${c.message||"Failed to reset starter templates."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}function e(){let i="Reset starter templates to their original defaults?",s="Starter Templates";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(i,{title:s,confirmText:"Reset",cancelText:"Cancel",onConfirm:n});return}window.confirm(i)&&n()}window.aipkit_handleResetStarterTemplates=e})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(p){return p},a={short:"Quick reads, ideal for news or updates",medium:"Standard blog posts with good depth",long:"In-depth guides and pillar content"};function r(p){let f=p.toLowerCase();return f.includes("short")?a.short:f.includes("medium")?a.medium:f.includes("long")?a.long:/\b600\b/.test(f)?a.short:/\b1200\b/.test(f)?a.medium:/\b2000\b/.test(f)?a.long:""}function n(p,f){if(f){let m=p.template_name.toLowerCase();return m.includes("short")?"dashicons-text-page":m.includes("medium")?"dashicons-text":m.includes("long")?"dashicons-media-document":"dashicons-star-filled"}return p.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function e(){return{select:document.getElementById("aipkit_cw_template_select"),button:document.getElementById("aipkit_cw_template_picker_btn"),label:document.getElementById("aipkit_cw_template_picker_label"),list:document.getElementById("aipkit_cw_template_picker_list"),search:document.getElementById("aipkit_cw_template_picker_search"),searchClear:document.getElementById("aipkit_cw_template_picker_search_clear")}}function i(p,f){let m=[],k=[],u={};p.forEach(v=>{if(v.user_id.toString()===f)String(v.is_starter)==="1"||v.is_starter===!0?m.push(v):k.push(v);else{let C=v.display_name||`User ID: ${v.user_id}`;u[C]||(u[C]=[]),u[C].push(v)}});let w=v=>{if(v&&v.starter_order!==void 0&&v.starter_order!==null&&v.starter_order!==""){let I=Number(v.starter_order);if(Number.isFinite(I))return I}let x=(v&&v.template_name?String(v.template_name):"").match(/(\d[\d,]*)/);if(!x)return null;let b=parseInt(x[1].replace(/,/g,""),10);return Number.isFinite(b)?b:null};m.sort((v,C)=>{let x=w(v),b=w(C);return x!==null&&b!==null?x-b:x!==null?-1:b!==null?1:v.template_name.localeCompare(C.template_name)}),k.sort((v,C)=>v.is_default==="1"?-1:C.is_default==="1"?1:v.template_name.localeCompare(C.template_name));let h={};return Object.keys(u).sort().forEach(v=>{h[v]=u[v].sort((C,x)=>C.template_name.localeCompare(x.template_name))}),{starterTemplates:m,myTemplates:k,otherUsersTemplates:h}}function s(p){let{label:f,button:m}=e();if(!f||!m||!p)return;let k=p.options[p.selectedIndex],u=k?k.text:g("Select template");f.textContent=u||g("Select template")}function c(p,f){if(!p)return;let m=String(f||"");p.querySelectorAll(".aipkit_cw_template_list_item").forEach(k=>{let w=(k.dataset.templateId||"")===m;k.classList.toggle("is-active",w),k.setAttribute("aria-selected",w?"true":"false")})}function t(p,f=""){let{list:m}=e();if(!m||!p)return;let k=window.aipkit_cw_template_state?.currentTemplates||[],u=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!k.length){let y=p.disabled&&p.options.length&&p.options[0].text.toLowerCase().includes("loading"),q=document.createElement("div");q.className="aipkit_cw_template_picker_empty",q.textContent=g(y?"Loading templates...":"No templates found."),m.appendChild(q),s(p);return}let w=i(k,u),h=document.createDocumentFragment(),v=f.toLowerCase().trim(),C=(y,q)=>{let E=document.createElement("div");if(E.className="aipkit_cw_template_group_label",q){let A=document.createElement("span");A.className=`dashicons ${q}`,A.setAttribute("aria-hidden","true"),E.appendChild(A)}let S=document.createElement("span");return S.textContent=g(y),E.appendChild(S),E},x=(y,q)=>{let E=document.createElement("button");E.type="button",E.className="aipkit_cw_template_list_item",q&&E.classList.add("is-starter"),y.is_default==="1"&&E.classList.add("is-default"),E.dataset.templateId=String(y.id),E.dataset.templateLabel=y.template_name.toLowerCase(),E.setAttribute("role","option"),E.setAttribute("aria-selected","false");let S=n(y,q),A=document.createElement("span");A.className=`aipkit_cw_template_list_icon dashicons ${S}`,A.setAttribute("aria-hidden","true");let T=document.createElement("span");T.className="aipkit_cw_template_list_content";let M=document.createElement("span");if(M.className="aipkit_cw_template_list_name",M.textContent=g(y.template_name),T.appendChild(M),q){let W=r(y.template_name);if(W){let R=document.createElement("span");R.className="aipkit_cw_template_list_desc",R.textContent=g(W),T.appendChild(R)}}let V=document.createElement("span");return V.className="aipkit_cw_template_list_check dashicons dashicons-yes",V.setAttribute("aria-hidden","true"),E.appendChild(A),E.appendChild(T),E.appendChild(V),E},b=(y,q,E,S=!1)=>{let A=v?q.filter(M=>M.template_name.toLowerCase().includes(v)):q;if(!A.length)return 0;let T=document.createElement("div");return T.className="aipkit_cw_template_group",S&&T.classList.add("is-starter-group"),T.appendChild(C(y,E)),A.forEach(M=>{T.appendChild(x(M,S))}),h.appendChild(T),A.length},I=0;if(I+=b("Starter Templates",w.starterTemplates,"dashicons-star-filled",!0),I+=b("My Templates",w.myTemplates,"dashicons-admin-users",!1),Object.keys(w.otherUsersTemplates).forEach(y=>{I+=b(y,w.otherUsersTemplates[y],"dashicons-groups",!1)}),I===0){let y=document.createElement("div");y.className="aipkit_cw_template_picker_empty",y.textContent=g(v?"No templates match your search.":"No templates found."),m.appendChild(y)}else m.appendChild(h);s(p),c(m,p.value)}function d(p){let{select:f}=e();f&&t(f,p)}function o(){let{search:p,searchClear:f}=e();if(!p)return;let m=null;p.addEventListener("input",u=>{let w=u.target.value;f&&(f.style.display=w?"flex":"none"),clearTimeout(m),m=setTimeout(()=>{d(w)},150)}),f&&f.addEventListener("click",()=>{p.value="",f.style.display="none",d(""),p.focus()});let k=document.getElementById("aipkit_cw_template_picker_popover");k&&new MutationObserver(w=>{w.forEach(h=>{h.attributeName==="aria-hidden"&&k.getAttribute("aria-hidden")==="true"&&p.value&&(p.value="",f&&(f.style.display="none"),d(""))})}).observe(k,{attributes:!0})}function l(){let{select:p,list:f,button:m}=e();!p||!f||(o(),f.dataset.listenerAttached||(f.addEventListener("click",k=>{let u=k.target.closest(".aipkit_cw_template_list_item");if(!u||!p)return;let w=u.dataset.templateId||"";p.value=w,p.dispatchEvent(new Event("change",{bubbles:!0})),c(f,w),m&&m.click()}),f.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",()=>{s(p),c(f,p.value)}),p.dataset.listenerAttached="true"),t(p))}function _(p){let{select:f,list:m}=e();f&&(p!==void 0&&(f.value=p),s(f),c(m,f.value))}window.aipkit_initTemplatePicker=l,window.aipkit_renderTemplatePicker=t,window.aipkit_updateTemplatePickerSelection=_})();(function(){"use strict";function g(){let e=document.getElementById("aipkit_cw_template_action_list"),i=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_inline_delete_confirm"),c=document.getElementById("aipkit_cw_template_name_input");e&&(e.style.display=""),i&&(i.style.display="none",delete i.dataset.mode),s&&(s.style.display="none"),c&&(c.value="")}function a(){g()}function r(e,i=""){let s=document.getElementById("aipkit_cw_template_inline_form"),c=document.getElementById("aipkit_cw_template_name_input"),t=document.getElementById("aipkit_cw_template_action_list");!s||!c||(t&&(t.style.display="none"),s.style.display="flex",s.dataset.mode=e,c.value=i,c.focus())}function n(){let e=document.getElementById("aipkit_cw_template_inline_form"),i=document.getElementById("aipkit_cw_template_name_input");!e||!i||a()}window.aipkit_showTemplateNameForm=r,window.aipkit_hideTemplateNameForm=n,window.aipkit_closeTemplateActionsPopover=a,window.aipkit_resetTemplateActionsPanel=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function a(n){let e=document.getElementById("aipkit_cw_template_inline_form"),i=document.getElementById("aipkit_cw_template_inline_delete_confirm"),s=document.getElementById("aipkit_cw_template_delete_confirm_text"),c=document.getElementById("aipkit_cw_template_action_list");!e||!i||!s||(e.style.display="none",c&&(c.style.display="none"),i.style.display="flex",s.innerHTML=`Delete "<strong>${g(n)}</strong>"?`)}function r(){let n=document.getElementById("aipkit_cw_template_inline_delete_confirm"),e=document.getElementById("aipkit_cw_template_action_list");n&&(n.style.display="none",e&&(e.style.display=""),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover())}window.aipkit_showTemplateDeleteConfirm=a,window.aipkit_hideTemplateDeleteConfirm=r})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_cw_template_save_inline_btn"),r=document.getElementById("aipkit_cw_template_cancel_inline_btn"),n=document.getElementById("aipkit_cw_template_inline_form"),e=document.getElementById("aipkit_cw_template_name_input");if(!a||!r||!n||!e){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),a.addEventListener("click",async()=>{let i=n.dataset.mode,s=e.value.trim();if(!s){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}let c=document.getElementById("aipkit_content_writer_form"),t=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let d=window.aipkit_getContentWriterFormConfig(c);if(i==="new")await window.aipkit_saveContentWriterTemplate(0,s,d);else if(i==="rename"){let o=t.value;o&&await window.aipkit_saveContentWriterTemplate(parseInt(o),s,d)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_cw_template_confirm_delete_btn"),r=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!a||!r){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),a.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let n=document.getElementById("aipkit_cw_template_select"),e=n.value,i=document.getElementById("aipkit_content_writer_template_nonce_field"),s=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,c=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,t=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.isSavingOrDeleting=!0,s&&s("Updating...");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:e,_ajax_nonce:i?i.value:""}),c&&c("Updated"),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(n)}catch(d){console.error("Error deleting template:",d),t&&t(`Error: ${d.message||"Failed to delete template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_cw_template_select");if(!a){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(a):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?a.addEventListener("change",r=>window.aipkit_applyContentWriterTemplate(r.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_cw_save_as_template_btn");if(!a){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_cw_rename_template_btn");if(!a){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_cw_delete_template_btn");if(!a){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_cw_reset_starter_templates_btn");if(!a){console.warn("bindResetStarterTemplatesBtn: Button not found.");return}typeof window.aipkit_handleResetStarterTemplates=="function"?a.addEventListener("click",window.aipkit_handleResetStarterTemplates):console.error("bindResetStarterTemplatesBtn: handleResetStarterTemplates function missing.")}window.aipkit_bindResetStarterTemplatesBtn=g})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_content_writer_post_status");if(!a){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(a.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=g})();(function(){"use strict";function g(){let a=document.querySelector(".aipkit_content_writer_inputs");if(!a){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(a.addEventListener("input",window.aipkit_checkFormForModifications),a.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=g})();(function(){"use strict";function g(){let a=["aipkit_initTemplateSelect","aipkit_initTemplatePicker","aipkit_bindSaveAsTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindResetStarterTemplatesBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let n of a)if(typeof window[n]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${n}`);return}window.aipkit_initTemplateSelect(),window.aipkit_initTemplatePicker(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindResetStarterTemplatesBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let r=document.getElementById("aipkit_cw_template_select");r&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(r.value):r&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_cw_save_as_post_btn");if(!n){console.warn("Save as Post Handler: Button not found.");return}n.addEventListener("click",r)}async function r(){let n=document.getElementById("aipkit_content_writer_form"),e=document.getElementById("aipkit_cw_save_as_post_btn"),i=document.getElementById("aipkit_cw_generated_content_area"),s=document.getElementById("aipkit_content_writer_output_display"),c=document.getElementById("aipkit_cw_save_post_status");if(!n||!e||!i||!s||!c){console.error("Save as Post: Missing required UI elements.");return}let d=(typeof window.aipkit_getContentWriterRawHtml=="function"?window.aipkit_getContentWriterRawHtml():"")||i.innerHTML;if(!(i.textContent.trim().length>0||!!i.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))){c&&(c.textContent="Nothing to save. Please generate content first.",c.className="aipkit_cw_save_status aipkit_settings_message-error");return}let l=document.getElementById("aipkit_cw_generated_title_display"),_={post_title:l?l.textContent:"Untitled AI Post",post_content:d,generated_excerpt:n.elements.generated_excerpt?.value||"",generated_tags:n.elements.generated_tags?.value||"",meta_description:n.elements.meta_description?n.elements.meta_description.value:"",focus_keyword:n.elements.focus_keyword?n.elements.focus_keyword.value:"",post_type:n.elements.post_type?n.elements.post_type.value:"post",post_author:n.elements.post_author?n.elements.post_author.value:1,post_status:n.elements.post_status?n.elements.post_status.value:"draft",post_schedule_date:n.elements.post_schedule_date?n.elements.post_schedule_date.value:"",post_schedule_time:n.elements.post_schedule_time?n.elements.post_schedule_time.value:"",post_categories:n.elements["post_categories[]"]?Array.from(n.elements["post_categories[]"].selectedOptions).map(p=>p.value):[],generate_toc:n.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:n.elements.image_alignment?n.elements.image_alignment.value:"none",image_size:n.elements.image_size?n.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};c&&(c.textContent="Saving post...",c.className="aipkit_cw_save_status aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(e,!0,"Save","Saving...");try{let p=await window.aipkit_apiRequest("aipkit_content_writer_save_post",_);c&&(c.textContent=p.message||"Post saved successfully!",c.className="aipkit_cw_save_status aipkit_settings_message-success",p.edit_link&&(c.innerHTML+=` <a href="${g(p.edit_link)}" target="_blank">Edit Post</a>`))}catch(p){console.error("Error saving post:",p),c&&(c.textContent=`Error: ${p.message||"Failed to save post."}`,c.className="aipkit_cw_save_status aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Save as Post"),setTimeout(()=>{c&&(c.textContent="",c.className="aipkit_cw_save_status")},5e3)}}window.aipkit_initSaveAsPostButton=a})();(function(){"use strict";function g(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let r=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),i=document.getElementById("aipkit_content_writer_copy_btn"),s=document.getElementById("aipkit_content_writer_clear_btn"),c=document.getElementById("aipkit_content_writer_provider"),t=document.getElementById("aipkit_content_writer_model"),d=document.getElementById("aipkit_content_writer_temperature"),o=document.getElementById("aipkit_cw_save_as_post_btn"),l=document.querySelector(".aipkit_cw_generation_status_indicators");if(!r||!n||!e||!i||!s||!c||!t||!d||!o){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(a):console.error("Content Writer Main: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initContentWriterAssistantSheet=="function"&&window.aipkit_initContentWriterAssistantSheet(a),typeof window.aipkit_initContentWriterPromptFlyouts=="function"?window.aipkit_initContentWriterPromptFlyouts(a):console.error("Content Writer Main: aipkit_initContentWriterPromptFlyouts function not found."),typeof window.aipkit_initContentWriterPromptModeManager=="function"?window.aipkit_initContentWriterPromptModeManager(a):console.error("Content Writer Main: aipkit_initContentWriterPromptModeManager function not found."),typeof window.aipkit_initContentWriterBulkEditor=="function"?window.aipkit_initContentWriterBulkEditor(a):console.error("Content Writer Main: aipkit_initContentWriterBulkEditor function not found."),typeof window.aipkit_initContentWriterGenerateMenu=="function"?window.aipkit_initContentWriterGenerateMenu():console.error("Content Writer Main: aipkit_initContentWriterGenerateMenu function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_content_writer_container"),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(a):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_initContentWriterExistingContent=="function"?window.aipkit_initContentWriterExistingContent(a):console.error("Content Writer Main: aipkit_initContentWriterExistingContent function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(c.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(a)}),t.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(a)}),window.aipkit_cw_toggleReasoningEffort(a)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_content_writer_container"):console.error("Content Writer Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"?window.aipkit_initContentWriterVectorStoreMultiSelect(a):console.error("Content Writer Main: aipkit_initContentWriterVectorStoreMultiSelect function not found."),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"?window.aipkit_initContentWriterCategoriesMultiSelect(a):console.error("Content Writer Main: aipkit_initContentWriterCategoriesMultiSelect function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(c,t,d,n,i,s):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initContentWriterAutosave=="function"?window.aipkit_initContentWriterAutosave():console.error("Content Writer Main: aipkit_initContentWriterAutosave function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let _=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;_&&typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),_&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():_&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),_&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():_&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(n,r,l,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(e,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){o&&(o.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){o&&(o.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=g})();(function(){"use strict";let g=!1,a=null,r=null,n=null,e=!1,i=null,s="aipkit_image_generator_status",c="aipkit_image_gen_preview_theme",t=["dark","light"];function d(){let $=document.getElementById("aipkit_image_generator_container");if(!$){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if($.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(L){console.error("AIPKit Image Generator: Error calling public UI initializer:",L);let K=document.getElementById("aipkit_public_image_results");K&&(K.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let L=document.getElementById("aipkit_public_image_results");L&&(L.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}R($),V($),E($),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_image_generator_container"):console.error("AIPKit Image Generator: aipkit_initApiKeyToggles function not found.")}function o(){return document.getElementById(s)}function l($,G){let L=o();if(!L)return;let K=L.classList.contains("aipkit_training_status");if(L.textContent=$||"",K){L.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),$&&L.classList.add("is-visible"),G&&L.classList.add(`is-${G}`);return}L.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),G==="success"?L.classList.add("aipkit_form-help-success"):G==="error"&&L.classList.add("aipkit_form-help-error")}function _($=2500){n&&window.clearTimeout(n),n=window.setTimeout(()=>{l("","")},$)}function p($){window.aipkit_dashboard||(window.aipkit_dashboard={});let G=window.aipkit_dashboard.providerStatus||{};G.replicate=!!String($||"").trim(),window.aipkit_dashboard.providerStatus=G,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(document)}function f(){return document.getElementById("aipkit_image_generator_settings_form")}function m(){let $=f();if(!$)return console.error("AIPKit Image Settings: Settings form not found."),null;let G=new FormData($);if(G.has("frontend_models")){let K=$.querySelector("#aipkit_image_gen_frontend_models");K&&K.value===""&&G.set("frontend_models","")}else{let K=$.querySelector("#aipkit_image_gen_frontend_models");K&&G.append("frontend_models",K.value||"")}let L={};return G.forEach((K,H)=>{L[H]=K}),Object.prototype.hasOwnProperty.call(L,"replicate_api_key")&&delete L.replicate_api_key,L}function k($){if(!$)return"";let G={};return Object.keys($).sort().forEach(L=>{G[L]=$[L]}),JSON.stringify(G)}function u($){r=k($)}function w($){return k($)!==r}function h($){if(!($||"").trim()||typeof window.aipkit_queueProviderSync!="function")return null;let L=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:H=>H;l(L("Syncing models...","gpt3-ai-content-generator"),"loading");let K=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return K&&typeof K.then=="function"&&K.then(()=>{l(L("Models synced!","gpt3-ai-content-generator"),"success"),_()}).catch(H=>{l(H?.message||L("Sync failed.","gpt3-ai-content-generator"),"error"),_(4e3)}),K}async function v($){let G=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:L=>L;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Settings: aipkit_apiRequest not found.");return}l(G("Saving...","gpt3-ai-content-generator"),"loading");try{let L=await window.aipkit_apiRequest("aipkit_save_image_settings",$);return l(L.message||G("Settings saved!","gpt3-ai-content-generator"),"success"),_(),u($),L}catch(L){throw l(L.message||G("Failed to save settings.","gpt3-ai-content-generator"),"error"),_(4e3),console.error("AIPKit Image Settings Save Error:",L),L}}async function C($){let G=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:L=>L;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Generator: aipkit_apiRequest not found.");return}l(G("Saving...","gpt3-ai-content-generator"),"loading");try{let L=await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:$});return p($),l(L.message||G("Replicate key saved!","gpt3-ai-content-generator"),"success"),_(),h($),L}catch(L){throw l(L.message||G("Failed to save Replicate key.","gpt3-ai-content-generator"),"error"),_(4e3),console.error("AIPKit Replicate Key Save Error:",L),L}}function x($){if($){if(g){a=$;return}g=!0,v($).catch(()=>{}).finally(()=>{if(g=!1,a){let G=a;a=null,w(G)&&x(G)}})}}function b(){let $=m();!$||!w($)||x($)}function I(){let $=m();$&&u($)}function y($){if(!$)return;let G="data-aipkit-image-autosave-attached";if($.hasAttribute(G))return;let L=()=>{b()};$.addEventListener("change",K=>{let H=K.target;!H||!H.matches(".aipkit_autosave_trigger")||L()}),$.addEventListener("blur",K=>{let H=K.target;!H||!H.matches(".aipkit_autosave_trigger")||L()},!0),$.setAttribute(G,"true"),I()}function q($){let G=$.querySelector("#aipkit_replicate_api_key");if(!G)return;let L="data-replicate-autosave-attached";if(G.hasAttribute(L))return;i=G.value||"",p(i);let K=()=>{let H=G.value||"";H===i||e||(e=!0,C(H).then(()=>{i=H}).catch(()=>{}).finally(()=>{e=!1;let ne=m();ne&&u(ne)}))};G.addEventListener("change",K),G.addEventListener("blur",K),G.setAttribute(L,"true")}function E($){let G=$.querySelector("#aipkit_image_generator_settings_popover");if(!G)return;typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers($):console.error("AIPKit Image Generator: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),S(G);let L="data-token-listener-attached";G.hasAttribute(L)||(G.addEventListener("change",function(K){K.target.closest(".aipkit_token_limit_mode_select")&&A(G)}),G.setAttribute(L,"true")),A(G);try{T(G)}catch(K){console.error("AIPKit Image Settings: Failed to init model selector",K)}y(G),q(G)}function S($){let G=$.querySelector("#aipkit_image_generator_settings_panel");if(!G)return;let L=Array.from(G.querySelectorAll("[data-aipkit-settings-panel]"));if(!L.length||G.dataset.panelsBound==="true")return;let K=$.querySelector(".aipkit_model_settings_popover_title"),H=$.querySelector(".aipkit_model_settings_popover_back"),ne=document.getElementById("aipkit_image_generator_settings_trigger"),ae={root:G.dataset.titleRoot||"Settings","token-management":G.dataset.titleTokenManagement||"Token Management",replicate:G.dataset.titleReplicate||"Replicate","custom-css":G.dataset.titleCustomCss||"Custom CSS","provider-filtering":G.dataset.titleProviderFiltering||"Provider Filtering"},Z=null,pe=ve=>{let De=ve||"root",Qe=G.querySelector(`[data-aipkit-settings-panel="${De}"]`)||G.querySelector('[data-aipkit-settings-panel="root"]');if(!Qe)return;let $e=Qe.dataset.aipkitSettingsPanel||"root";if($e!==Z){if(L.forEach(lt=>{lt.hidden=lt!==Qe}),K&&(K.textContent=ae[$e]||ae.root),H&&(H.hidden=$e==="root"),$e==="token-management"&&A($),$e==="replicate"){let lt=$.querySelector("#aipkit_replicate_api_key");h(lt?lt.value:"")}Z=$e,$.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))})}};G.addEventListener("click",ve=>{let De=ve.target.closest("[data-aipkit-panel-target]");De&&(ve.preventDefault(),pe(De.dataset.aipkitPanelTarget))}),H&&H.addEventListener("click",ve=>{ve.preventDefault(),pe("root")}),ne&&ne.addEventListener("click",()=>{pe("root")}),pe("root"),G.dataset.panelsBound="true"}function A($){if(!$)return;let G=$.querySelector(".aipkit_token_limit_mode_select"),L=$.querySelector(".aipkit_token_general_user_limit_field"),K=$.querySelector(".aipkit_token_role_limits_container");if(!G||!L||!K)return;let H=G.value;L&&(L.hidden=H!=="general"),K&&(K.hidden=H!=="role_based")}function T($){let G=$.querySelector("#aipkit_image_gen_models_selector");if(!G||G.getAttribute("data-enhanced")==="true")return;let L=$.querySelector("#aipkit_image_gen_frontend_models"),K=G.dataset.initialValue||"",ne=!0&&K===""?[]:K.split(",").map(we=>we.trim()).filter(Boolean),ae=new Set(ne),Z=window.aipkit_image_generator_config_public||{},pe=Z.azure_models||[];if((!pe||pe.length===0)&&window.aipkit_dashboard_providers)try{Array.isArray(window.aipkit_dashboard_providers.AzureImage)&&(pe=window.aipkit_dashboard_providers.AzureImage.map(we=>typeof we=="string"?{id:we,name:we}:we))}catch{}let ve=[{key:"openai",label:"OpenAI",type:"flat",models:(Z.openai_models||[]).map(we=>({id:we.id,name:we.name}))},{key:"azure",label:"Azure",type:"flat",models:pe.map(we=>we.id?we:{id:we.id||we.name||we,name:we.name||we.id||we})},{key:"google",label:"Google",type:"grouped",models:Z.google_models||{}},{key:"replicate",label:"Replicate",type:"flat",models:(Z.replicate_models||[]).map(we=>we.id?we:{id:we.id||we.name||we,name:we.name||we.id||we})}].filter(we=>we.key==="azure"?!0:we.models&&(Array.isArray(we.models)?we.models.length:Object.keys(we.models).length));G.innerHTML="",G.classList.add("aipkit_models_selector--ready");let De=document.createElement("input");De.type="search",De.placeholder="Filter models...",De.className="aipkit_models_selector-search",G.appendChild(De);let Qe=document.createElement("div");Qe.className="aipkit_models_selector-summary",G.appendChild(Qe);let $e=document.createElement("div");$e.className="aipkit_models_selector-providers",G.appendChild($e),ve.forEach(we=>{let at=document.createElement("div");at.className="aipkit_models_selector-provider",at.dataset.provider=we.key;let Zt=document.createElement("div");Zt.className="aipkit_models_selector-provider-header",Zt.innerHTML=`<strong>${we.label}</strong>`;let $t=document.createElement("div");$t.className="aipkit_models_selector-provider-actions";let li=document.createElement("button");li.type="button",li.className="aipkit_btn aipkit_btn-xs",li.textContent="All";let ai=document.createElement("button");ai.type="button",ai.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",ai.textContent="None",$t.appendChild(li),$t.appendChild(ai),Zt.appendChild($t),at.appendChild(Zt);let se=document.createElement("div");se.className="aipkit_models_selector-models";let ke=_e=>{if(!_e||!_e.id)return;let Ce=_e.id,Pe=document.createElement("label");Pe.className="aipkit_models_selector-item",Pe.title=Ce;let be=document.createElement("input");be.type="checkbox",be.value=Ce,be.checked=ae.has(Ce),be.dataset.modelId=Ce,be.addEventListener("change",()=>{it(!0)});let Oe=document.createElement("span");Oe.textContent=_e.name||Ce,Pe.appendChild(be),Pe.appendChild(Oe),se.appendChild(Pe)};if(we.type==="grouped"?Object.keys(we.models).forEach(_e=>{let Ce=we.models[_e];if(!Array.isArray(Ce))return;let Pe=document.createElement("div");Pe.className="aipkit_models_selector-subgroup",Pe.textContent=_e.charAt(0).toUpperCase()+_e.slice(1),se.appendChild(Pe),Ce.forEach(be=>ke(be))}):we.models.forEach(_e=>ke(_e)),we.key==="azure"&&we.models.length===0){let _e=document.createElement("div");_e.className="aipkit_models_selector-empty",_e.textContent="No Azure image models found. Sync Azure Image models in the main Models settings first.",se.appendChild(_e)}li.addEventListener("click",()=>{se.querySelectorAll('input[type="checkbox"]').forEach(_e=>{_e.checked=!0}),it(!0)}),ai.addEventListener("click",()=>{se.querySelectorAll('input[type="checkbox"]').forEach(_e=>{_e.checked=!1}),it(!0)}),at.appendChild(se),$e.appendChild(at)}),De.addEventListener("input",()=>{let we=De.value.toLowerCase();$e.querySelectorAll(".aipkit_models_selector-item").forEach(at=>{let Zt=at.textContent.toLowerCase();at.style.display=Zt.includes(we)?"":"none"})}),G.setAttribute("data-enhanced","true"),lt();function lt(){let we=Array.from(G.querySelectorAll(".aipkit_models_selector-item input:checked")).map(at=>at.value);we.length===0?Qe.textContent="Showing all models (none selected)":Qe.textContent=`${we.length} model${we.length>1?"s":""} selected`}function it(we=!1){let at=Array.from(G.querySelectorAll(".aipkit_models_selector-item input:checked")).map(Zt=>Zt.value.trim()).filter(Boolean);L&&(L.value=at.join(", ")),lt(),we&&b()}window.aipkit_syncAllowedModelsHiddenField=it}function M($=!1){typeof window.aipkit_syncAllowedModelsHiddenField=="function"&&window.aipkit_syncAllowedModelsHiddenField($)}function V($){let G=$.querySelector("#aipkit_theme_switcher_toggle_btn"),L=$.querySelector(".aipkit_image_generator_admin_preview_wrapper");if(!G||!L){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",$);return}let K=t.indexOf(localStorage.getItem(c)||"dark");K===-1&&(K=t.indexOf("dark")),W(t[K],L,G),G.hasAttribute("data-listener-attached")||(G.addEventListener("click",function(){K=(K+1)%t.length;let H=t[K];W(H,L,G),localStorage.setItem(c,H)}),G.setAttribute("data-listener-attached","true"))}function W($,G,L){let K=G.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");K&&(t.forEach(ae=>K.classList.remove(`aipkit-theme-${ae}`)),K.classList.add(`aipkit-theme-${$}`));let H=$.charAt(0).toUpperCase()+$.slice(1),ne="Toggle Preview Theme";L.title=`${ne} (Current: ${H})`}function R($){let G=$.querySelector("#aipkit_image_generator_shortcode_snippet"),L=$.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),K=$.querySelector("#aipkit_image_generator_shortcode_configurator"),H=$.querySelector("#aipkit_image_generator_shortcode_configurator .aipkit_model_settings_popover_close"),ne=$.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!G||!L||!K||ne.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",$);return}L.hasAttribute("data-listener-attached")||(L.addEventListener("click",()=>{let ae=K.style.display==="none"||!K.style.display;K.style.display=ae?"flex":"none",L.classList.toggle("aipkit_active",ae),L.setAttribute("aria-expanded",ae.toString())}),H&&H.addEventListener("click",()=>{K.style.display="none",L.classList.remove("aipkit_active"),L.setAttribute("aria-expanded","false")}),ne.forEach(ae=>ae.addEventListener("change",()=>B($))),G.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(G.textContent,G):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),B($),L.setAttribute("data-listener-attached","true"))}function B($){let G=$.querySelector("#aipkit_image_generator_shortcode_snippet"),L=$.querySelector("#aipkit_image_generator_shortcode_configurator");if(!G||!L)return;let K=L.querySelector('input[name="cfg_show_provider"]').checked,H=L.querySelector('input[name="cfg_show_model"]').checked,ne=L.querySelector('input[name="cfg_show_history"]').checked,ae=L.querySelector('select[name="cfg_theme"]'),Z=L.querySelector('input[name="cfg_theme"]:checked'),pe=ae?ae.value:Z?Z.value:"dark",ve="[aipkit_image_generator";K||(ve+=' show_provider="false"'),H||(ve+=' show_model="false"'),ne&&(ve+=' history="true"'),pe!=="dark"&&(ve+=` theme="${pe}"`),ve+="]",G.textContent=ve}window.aipkit_initImageGenerator=d})();(function(){"use strict";function g(a,r,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,i=e?.nonce_generate_title,s=e?.text||{};if(!i){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,n);return}let c={_ajax_nonce:i,post_id:a};window.aipkit_apiRequest("aipkit_generate_title_suggestions",c).then(t=>{if(!t?.suggestions||t.suggestions.length===0)throw new Error(s.no_suggestions_title||"No title suggestions generated.");typeof r=="function"&&r(null,t.suggestions,n)}).catch(t=>{console.error("AIPKit Post Enhancer Fetcher (Title):",t),typeof r=="function"&&r(t,null,n)})}window.aipkit_fetchTitleSuggestions=g})();(function(){"use strict";let g=null;function a(){g&&(g.classList.remove("aipkit-active"),g.addEventListener("transitionend",()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},{once:!0}),setTimeout(()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function r(i,s,c){g&&a();let t=window.aipkit_escapeHtml||function(u){return u},d=window.aipkit_escapeAttribute||t,o=c?.default_ai_provider||"N/A",l=c?.default_ai_model||"N/A",_=c?.default_ai_params||{},p=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(s.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${t(o)}</strong>`).replace("%2$s",`<strong>${t(l)}</strong>`).replace("%3$s",t(p));g=document.createElement("div"),g.className="aipkit-modal-overlay",g.addEventListener("click",u=>{u.target===g&&a()});let k=document.createElement("div");return k.className="aipkit-modal-content",k.dataset.postId=i,k.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${t(s.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(s.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${t(s.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,g.appendChild(k),document.body.appendChild(g),k.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{g.classList.add("aipkit-active")}),g}function n(i,s){if(!g)return;let c=g.querySelector(".aipkit-modal-body");if(!c)return;let t=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||t;c.innerHTML=`
            <p>${t(s.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${i.map(l=>`<li data-new-title="${d(l)}">${t(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let o=c.querySelector(".aipkit-suggestions-list");o&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(o):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function e(i,s){if(!g)return;let c=g.querySelector(".aipkit-modal-body");if(!c)return;let t=window.aipkit_escapeHtml||function(d){return d};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${t(s.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${t(i)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=r,window.aipkit_updateModalWithSuggestions=n,window.aipkit_updateModalWithError=e,window.aipkit_closePostTitleModal=a})();(function(){"use strict";let g=!1;function a(){g=!1}function r(i){if(g)return;g=!0;let s=i.currentTarget,c=s.closest(".aipkit-modal-content"),t=c?.dataset.postId,d=s.dataset.newTitle,o=c?.querySelector(".aipkit-modal-status"),l=c?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!t||!d||!o||!l){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),o&&(o.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),g=!1;return}l.forEach(p=>p.classList.add("aipkit-disabled")),o.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_title||"Updating Title..."}`,o.style.color="",n(t,d,o,l,_)}function n(i,s,c,t,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',t.forEach(_=>_.classList.remove("aipkit-disabled")),g=!1;return}let o=window.aipkit_post_enhancer?.nonce_update_title;if(!o){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',t.forEach(_=>_.classList.remove("aipkit-disabled")),g=!1;return}let l={_ajax_nonce:o,post_id:i,new_value:s};window.aipkit_apiRequest("aipkit_update_post_title",l).then(_=>{let p=document.querySelector(`#post-${i} .row-title`);p?p.textContent=s:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${i}.`);let f=document.getElementById(`post-${i}`);if(f){let m=f.querySelector(`#inline_${i}`);if(m){let k=m.querySelector(".post_title");k?k.textContent=s:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${i}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${i}.`)}window.aipkit_closePostTitleModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Title):",_),c.innerHTML=`<span class="error">${_.message||d.error_updating_title||"Error updating title."}</span>`,t.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{g=!1})}function e(i){i&&i.addEventListener("click",function(s){let c=s.target.closest("li[data-new-title]");c&&r({currentTarget:c})})}window.aipkit_attachSuggestionClickListener=e,window.aipkit_resetTitleUpdateFlag=a})();(function(){"use strict";function g(a,r,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,i=e?.nonce_generate_excerpt,s=e?.text||{};if(!i){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,n);return}let c={_ajax_nonce:i,post_id:a};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",c).then(t=>{if(!t?.suggestions||t.suggestions.length===0)throw new Error(s.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof r=="function"&&r(null,t.suggestions,n)}).catch(t=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",t),typeof r=="function"&&r(t,null,n)})}window.aipkit_fetchExcerptSuggestions=g})();(function(){"use strict";let g=null;function a(){g&&(g.classList.remove("aipkit-active"),g.addEventListener("transitionend",()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},{once:!0}),setTimeout(()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function r(i,s,c){g&&a();let t=window.aipkit_escapeHtml||function(u){return u},d=window.aipkit_escapeAttribute||t,o=c?.default_ai_provider||"N/A",l=c?.default_ai_model||"N/A",_=c?.default_ai_params||{},p=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(s.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${t(o)}</strong>`).replace("%2$s",`<strong>${t(l)}</strong>`).replace("%3$s",t(p));g=document.createElement("div"),g.className="aipkit-modal-overlay",g.addEventListener("click",u=>{u.target===g&&a()});let k=document.createElement("div");return k.className="aipkit-modal-content",k.dataset.postId=i,k.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${t(s.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(s.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${t(s.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,g.appendChild(k),document.body.appendChild(g),k.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{g.classList.add("aipkit-active")}),g}function n(i,s){if(!g)return;let c=g.querySelector(".aipkit-modal-body");if(!c)return;let t=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||t;c.innerHTML=`
            <p>${t(s.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${i.map(l=>`<li data-new-excerpt="${d(l)}">${t(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let o=c.querySelector(".aipkit-suggestions-list");o&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(o):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function e(i,s){if(!g)return;let c=g.querySelector(".aipkit-modal-body");if(!c)return;let t=window.aipkit_escapeHtml||function(d){return d};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${t(s.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${t(i)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=r,window.aipkit_updateModalWithExcerptSuggestions=n,window.aipkit_updateModalWithErrorExcerpt=e,window.aipkit_closePostExcerptModal=a})();(function(){"use strict";let g=!1;function a(){g=!1}function r(i){if(g)return;g=!0;let s=i.currentTarget,c=s.closest(".aipkit-modal-content"),t=c?.dataset.postId,d=s.dataset.newExcerpt,o=c?.querySelector(".aipkit-modal-status"),l=c?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!t||d===void 0||!o||!l){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:t,newExcerpt:d,statusDiv:o,listItems:l}),o&&(o.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),g=!1;return}l.forEach(p=>p.classList.add("aipkit-disabled")),o.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_excerpt||"Updating Excerpt..."}`,o.style.color="",n(t,d,o,l,_)}function n(i,s,c,t,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',t.forEach(_=>_.classList.remove("aipkit-disabled")),g=!1;return}let o=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!o){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',t.forEach(_=>_.classList.remove("aipkit-disabled")),g=!1;return}let l={_ajax_nonce:o,post_id:i,new_value:s};window.aipkit_apiRequest("aipkit_update_post_excerpt",l).then(_=>{window.aipkit_closePostExcerptModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",_),c.innerHTML=`<span class="error">${_.message||d.error_updating_excerpt||"Error updating excerpt."}</span>`,t.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{g=!1})}function e(i){i&&i.addEventListener("click",function(s){let c=s.target.closest("li[data-new-excerpt]");c&&r({currentTarget:c})})}window.aipkit_attachExcerptSuggestionClickListener=e,window.aipkit_resetExcerptUpdateFlag=a})();(function(){"use strict";function g(a,r,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,i=e?.nonce_generate_meta,s=e?.text||{};if(!i){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,n);return}let c={_ajax_nonce:i,post_id:a};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",c).then(t=>{if(!t?.suggestions||t.suggestions.length===0)throw new Error(s.no_suggestions_meta||"No meta description suggestions generated.");typeof r=="function"&&r(null,t.suggestions,n)}).catch(t=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",t),typeof r=="function"&&r(t,null,n)})}window.aipkit_fetchMetaSuggestions=g})();(function(){"use strict";let g=null;function a(){g&&(g.classList.remove("aipkit-active"),g.addEventListener("transitionend",()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},{once:!0}),setTimeout(()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function r(i,s,c){g&&a();let t=window.aipkit_escapeHtml||function(u){return u},d=window.aipkit_escapeAttribute||t,o=c?.default_ai_provider||"N/A",l=c?.default_ai_model||"N/A",_=c?.default_ai_params||{},p=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(s.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${t(o)}</strong>`).replace("%2$s",`<strong>${t(l)}</strong>`).replace("%3$s",t(p));g=document.createElement("div"),g.className="aipkit-modal-overlay",g.addEventListener("click",u=>{u.target===g&&a()});let k=document.createElement("div");return k.className="aipkit-modal-content",k.dataset.postId=i,k.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${t(s.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(s.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${t(s.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,g.appendChild(k),document.body.appendChild(g),k.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{g.classList.add("aipkit-active")}),g}function n(i,s){if(!g)return;let c=g.querySelector(".aipkit-modal-body");if(!c)return;let t=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||t;c.innerHTML=`
            <p>${t(s.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${i.map(l=>`<li data-new-meta="${d(l)}">${t(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let o=c.querySelector(".aipkit-suggestions-list");o&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(o):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function e(i,s){if(!g)return;let c=g.querySelector(".aipkit-modal-body");if(!c)return;let t=window.aipkit_escapeHtml||function(d){return d};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${t(s.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${t(i)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=r,window.aipkit_updateModalWithMetaSuggestions=n,window.aipkit_updateModalWithErrorMeta=e,window.aipkit_closePostMetaModal=a})();(function(){"use strict";let g=!1;function a(){g=!1}function r(i){if(g)return;g=!0;let s=i.currentTarget,c=s.closest(".aipkit-modal-content"),t=c?.dataset.postId,d=s.dataset.newMeta,o=c?.querySelector(".aipkit-modal-status"),l=c?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!t||d===void 0||!o||!l){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:t,newMetaDesc:d,statusDiv:o,listItems:l}),o&&(o.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),g=!1;return}l.forEach(p=>p.classList.add("aipkit-disabled")),o.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_meta||"Updating Meta Desc..."}`,o.style.color="",n(t,d,o,l,_)}function n(i,s,c,t,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',t.forEach(_=>_.classList.remove("aipkit-disabled")),g=!1;return}let o=window.aipkit_post_enhancer?.nonce_update_meta;if(!o){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',t.forEach(_=>_.classList.remove("aipkit-disabled")),g=!1;return}let l={_ajax_nonce:o,post_id:i,new_value:s};window.aipkit_apiRequest("aipkit_update_post_meta_desc",l).then(_=>{try{let m=`${`#post-${i}`} .column-wpseo-metadesc`,k=document.querySelector(m);k&&(k.textContent=window.aipkit_escapeHtml(s),k.style.transition="background-color 0.1s ease-out",k.style.backgroundColor="#f0f7ff",setTimeout(()=>{k.style.backgroundColor=""},300))}catch(p){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",p)}window.aipkit_closePostMetaModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Meta):",_),c.innerHTML=`<span class="error">${_.message||d.error_updating_meta||"Error updating meta description."}</span>`,t.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{g=!1})}function e(i){i&&i.addEventListener("click",function(s){let c=s.target.closest("li[data-new-meta]");c&&r({currentTarget:c})})}window.aipkit_attachMetaSuggestionClickListener=e,window.aipkit_resetMetaUpdateFlag=a})();(function(){"use strict";function g(a,r,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,i=e?.nonce_generate_tags,s=e?.text||{};if(!i){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,n);return}let c={_ajax_nonce:i,post_id:a};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",c).then(t=>{if(!t?.suggestions||t.suggestions.length===0)throw new Error(s.no_suggestions_tags||"No tag suggestions generated.");typeof r=="function"&&r(null,t.suggestions,n)}).catch(t=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",t),typeof r=="function"&&r(t,null,n)})}window.aipkit_fetchTagsSuggestions=g})();(function(){"use strict";let g=null;function a(){g&&(g.classList.remove("aipkit-active"),g.addEventListener("transitionend",()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},{once:!0}),setTimeout(()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function r(i,s,c){g&&a();let t=window.aipkit_escapeHtml||(u=>u),d=window.aipkit_escapeAttribute||t,o=c?.default_ai_provider||"N/A",l=c?.default_ai_model||"N/A",_=c?.default_ai_params||{},p=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(s.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${t(o)}</strong>`).replace("%2$s",`<strong>${t(l)}</strong>`).replace("%3$s",t(p));g=document.createElement("div"),g.className="aipkit-modal-overlay",g.addEventListener("click",u=>{u.target===g&&a()});let k=document.createElement("div");return k.className="aipkit-modal-content",k.dataset.postId=i,k.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${t(s.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${d(s.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${t(s.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${m}</p>
            </div>
        </div>
    `,g.appendChild(k),document.body.appendChild(g),k.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>g.classList.add("aipkit-active")),g}function n(i,s){if(!g)return;let c=g.querySelector(".aipkit-modal-body");if(!c)return;let t=window.aipkit_escapeHtml||(l=>l),d=window.aipkit_escapeAttribute||t;c.innerHTML=`
        <p>${t(s.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${i.map(l=>`<li data-new-tags="${d(l)}">${t(l)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let o=c.querySelector(".aipkit-suggestions-list");o&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(o):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function e(i,s){if(!g)return;let c=g.querySelector(".aipkit-modal-body");if(!c)return;let t=window.aipkit_escapeHtml||(d=>d);c.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${t(s.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${t(i)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=r,window.aipkit_updateModalWithTagsSuggestions=n,window.aipkit_updateModalWithErrorTags=e,window.aipkit_closePostTagsModal=a})();(function(){"use strict";let g=!1;function a(){g=!1}function r(i){if(g)return;g=!0;let s=i.currentTarget,c=s.closest(".aipkit-modal-content"),t=c?.dataset.postId,d=s.dataset.newTags,o=c?.querySelector(".aipkit-modal-status"),l=c?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!t||d===void 0||!o||!l){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:t,newTags:d,statusDiv:o,listItems:l}),o&&(o.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),g=!1;return}l.forEach(p=>p.classList.add("aipkit-disabled")),o.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_tags||"Updating Tags..."}`,o.style.color="",n(t,d,o,l,_)}function n(i,s,c,t,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',t.forEach(_=>_.classList.remove("aipkit-disabled")),g=!1;return}let o=window.aipkit_post_enhancer?.nonce_update_tags;if(!o){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',t.forEach(_=>_.classList.remove("aipkit-disabled")),g=!1;return}let l={_ajax_nonce:o,post_id:i,new_value:s};window.aipkit_apiRequest("aipkit_update_post_tags",l).then(_=>{let p=document.getElementById(`post-${i}`);if(p){let f=p.querySelector(".column-tags");f&&(f.textContent=s.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Tags):",_),c.innerHTML=`<span class="error">${_.message||d.error_updating_tags||"Error updating tags."}</span>`,t.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{g=!1})}function e(i){i&&i.addEventListener("click",function(s){let c=s.target.closest("li[data-new-tags]");c&&r({currentTarget:c})})}window.aipkit_attachTagsSuggestionClickListener=e,window.aipkit_resetTagsUpdateFlag=a})();(function(){"use strict";function g(a,r,n){let i=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorTags(a.message||i.error_loading_tags,i):r?window.aipkit_updateModalWithTagsSuggestions(r,i):window.aipkit_updateModalWithErrorTags(i.error_loading_tags||"Unknown error occurred.",i)}window.aipkit_handleTagsSuggestionsResult=g})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function g(t,d=60){return t.length<=d?t:t.substring(0,d-3)+"..."}function a(t,d="info"){let o=document.getElementById("aipkit-enhancer-bulk-status-log");if(o){let l=document.createElement("div");l.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${d}`,l.textContent=t,o.appendChild(l),o.scrollTop=o.scrollHeight}}function r(){let t=document.getElementById("aipkit-enhancer-bulk-progress-bar"),d=document.getElementById("aipkit-enhancer-progress-text"),o=document.getElementById("aipkit-enhancer-progress-stats");if(t&&window.aipkit_enhancer_bulkState.total>0){let l=window.aipkit_enhancer_bulkState.completed,_=window.aipkit_enhancer_bulkState.failed,p=window.aipkit_enhancer_bulkState.total,f=l+_,m=Math.round(f/p*100);t.style.width=`${m}%`,d&&(f===p?d.textContent="Update complete!":d.textContent=`Processing ${f+1} of ${p}...`),o&&(_>0?o.innerHTML=`${m}% \u2022 <span style="color: #28a745;">${l} successful</span> \u2022 <span style="color: #dc3545;">${_} failed</span>`:o.textContent=`${m}%`)}}function n(t){let d=document.getElementById("aipkit-enhancer-bulk-status-log");if(!d)return;let l=(window.aipkit_enhancer_postTitles||{})[t]||`Post #${t}`;l=g(l,60);let _=document.createElement("div");_.className="aipkit_enhancer_post_steps",_.id=`aipkit_enhancer_post_${t}_steps`;let p=document.createElement("div");p.className="aipkit_enhancer_post_header",p.innerHTML=`<strong>${l}</strong>`;let f=document.createElement("div");f.className="aipkit_enhancer_steps_container",f.id=`aipkit_enhancer_steps_${t}`,_.appendChild(p),_.appendChild(f),d.appendChild(_),d.scrollTop=d.scrollHeight;let m=[],k=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(u=>{k[u]&&k[u].prompt&&m.push({field:u,display_name:u.charAt(0).toUpperCase()+u.slice(1).replace("_"," ")})}),k.generate_seo_slug==="1"&&m.push({field:"slug",display_name:"URL"}),m.forEach(u=>{let w=document.createElement("div");w.className="aipkit_enhancer_step aipkit_enhancer_step--pending",w.id=`aipkit_enhancer_step_${t}_${u.field}`,w.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${u.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,f.appendChild(w)})}function e(t,d,o,l=""){let _=document.getElementById(`aipkit_enhancer_step_${t}_${d}`);if(!_)return;_.className=`aipkit_enhancer_step aipkit_enhancer_step--${o}`;let p="\u23F3",f="Pending";switch(o){case"processing":p="\u{1F504}",f="Processing...";break;case"completed":p="\u2705",f="Completed";break;case"error":p="\u274C",f="Failed";break;case"pending":p="\u23F3",f="Pending";break}_.querySelector(".aipkit_enhancer_step_icon").textContent=p,_.querySelector(".aipkit_enhancer_step_status").textContent=f,l&&(_.title=l);let m=document.getElementById("aipkit-enhancer-bulk-status-log");m&&(m.scrollTop=m.scrollHeight)}function i(t,d,o){let l=document.getElementById(`aipkit_enhancer_steps_${t}`);if(!l||o.length===0)return;let _=d.length+o.length,p=document.createElement("div");p.className="aipkit_enhancer_completion_message",d.length===0?p.innerHTML=`<strong style="color: #dc3545;">\u274C All ${_} enhancement steps failed!</strong>`:p.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${d.length} of ${_} steps. ${o.length} failed.</strong>`,l.appendChild(p);let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}function s(t,d){let o=document.getElementById(`aipkit_enhancer_steps_${t}`);if(!o)return;d.forEach(f=>{let m=document.getElementById(`aipkit_enhancer_step_${t}_${f.field}`);if(m){m.className=`aipkit_enhancer_step aipkit_enhancer_step--${f.status}`;let k="\u23F3";switch(f.status){case"completed":k="\u2705";break;case"error":k="\u274C";break;case"processing":k="\u{1F504}";break;case"pending":k="\u23F3";break}m.querySelector(".aipkit_enhancer_step_icon").textContent=k,m.querySelector(".aipkit_enhancer_step_status").textContent=f.status.charAt(0).toUpperCase()+f.status.slice(1),f.message&&(m.title=f.message)}});let l=d.filter(f=>f.status==="completed").length,_=d.length;if(l!==_){let f=document.createElement("div");f.className="aipkit_enhancer_completion_message";let m=d.filter(k=>k.status==="error").length;f.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${l} of ${_} steps. ${m} failed.</strong>`,o.appendChild(f)}let p=document.getElementById("aipkit-enhancer-bulk-status-log");p&&(p.scrollTop=p.scrollHeight)}function c(t,d){let o=document.getElementById(`aipkit_enhancer_steps_${t}`);if(!o)return;o.querySelectorAll(".aipkit_enhancer_step").forEach(f=>{f.classList.contains("aipkit_enhancer_step--completed")||(f.className="aipkit_enhancer_step aipkit_enhancer_step--error",f.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",f.querySelector(".aipkit_enhancer_step_status").textContent="Failed",f.title=d)});let _=document.createElement("div");_.className="aipkit_enhancer_completion_message",_.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${d}</strong>`,o.appendChild(_);let p=document.getElementById("aipkit-enhancer-bulk-status-log");p&&(p.scrollTop=p.scrollHeight)}window.aipkit_enhancer_logToModal=a,window.aipkit_enhancer_updateProgressBar=r,window.aipkit_enhancer_initStepProgress=n,window.aipkit_enhancer_updateFieldStatus=e,window.aipkit_enhancer_showPostCompletion=i,window.aipkit_enhancer_displayStepResults=s,window.aipkit_enhancer_showStepError=c,window.aipkit_enhancer_truncateTitle=g})();(function(){"use strict";function g(r="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let n=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!n)return;r==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let e=n.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");e&&(e.textContent="Start");let i=n.querySelector("#aipkit_bulk_enhancer_start_btn");i&&(i.disabled=!1,i.hidden=!0),n.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let s=n.querySelector("#aipkit_bulk_enhancer_cancel_btn");s&&(s.hidden=!1),n.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!1}function a(){let r=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!r)return;window.aipkit_enhancer_bulkState.isRunning&&g("user"),r.querySelector("#aipkit-enhancer-bulk-config").hidden=!1,r.querySelector("#aipkit-enhancer-bulk-progress").hidden=!0;let n=r.querySelector("#aipkit_bulk_enhancer_start_btn");n&&(n.disabled=!1,n.hidden=!1);let e=r.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");e&&(e.textContent="Start"),r.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let i=r.querySelector("#aipkit_bulk_enhancer_cancel_btn");i&&(i.hidden=!1),r.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0;let s=r.querySelector("#aipkit-enhancer-bulk-status-log");s&&(s.innerHTML="");let c=r.querySelector("#aipkit-enhancer-bulk-progress-bar");c&&(c.style.width="0%");let t=r.querySelector("#aipkit-enhancer-progress-text");t&&(t.textContent="Processing posts...");let d=r.querySelector("#aipkit-enhancer-progress-stats");d&&(d.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=g,window.aipkit_enhancer_returnToSettings=a})();(function(){"use strict";function g(s){let c=s.querySelector("#aipkit_bulk_ai_provider"),t=s.querySelector("#aipkit_bulk_ai_model"),d=s.querySelector(".aipkit_enhancer_reasoning_effort_field"),o=s.querySelector("#aipkit_bulk_reasoning_effort");if(!c||!t||!d||!o){d&&(d.style.display="none");return}let l=(c.value||"").toLowerCase(),p=(t.value||"").toLowerCase(),f=p.startsWith("o1")||p.startsWith("o3")||p.startsWith("o4"),m=p.includes("gpt-5");if(!(l==="openai"&&(f||m))){d.style.display="none";return}d.style.display="block",a(s,p)}function a(s,c){let t=s.querySelector("#aipkit_bulk_reasoning_effort");if(!t)return;let d=r(c),o=new Set(d.allowed),l=t.value||"";l==="minimal"&&(l="low"),Array.from(t.options).forEach(_=>{let p=o.has(_.value);_.hidden=!p,_.disabled=!p}),o.has(l)||(l=d.defaultValue),o.has(l)||(l=d.allowed[0]||""),l&&(t.value=l)}function r(s){return e(s)?{allowed:["high"],defaultValue:"high"}:s.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(s)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(s){let c=s.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let t=s.match(/gpt-(\d+)/);return t?Number.parseInt(t[1],10)>=6:!1}function e(s){return/gpt-5(\.\d+)?-pro/.test(s)}function i(s,c){let t=s.value.toLowerCase(),o=(window.aipkit_dashboard?.models||{})[t]||[],l=window.aipkit_escapeHtml||(u=>u),_=window.wp?.i18n?.__||(u=>u),p=window.aipkit_dashboard?.recommendedModels?.[t]||[],f=Array.isArray(p)?p:[],m=new Set(f.map(u=>u?.id).filter(Boolean));if(c.innerHTML="",f.length>0){let u=document.createElement("optgroup");u.label=l(_("Recommended","gpt3-ai-content-generator")),f.forEach(w=>{w&&w.id&&u.appendChild(new Option(l(w.name||w.id),w.id))}),u.children.length>0&&c.appendChild(u)}if(t==="openai"&&typeof o=="object"&&!Array.isArray(o))Object.keys(o).forEach(u=>{let w=document.createElement("optgroup");w.label=l(u),Array.isArray(o[u])&&o[u].forEach(h=>{h&&h.id&&m.has(h.id)||h&&h.id&&w.appendChild(new Option(l(h.name||h.id),h.id))}),w.children.length>0&&c.appendChild(w)});else if(Array.isArray(o)){let u=f.length?document.createElement("optgroup"):null;u&&(u.label=l(_("All models","gpt3-ai-content-generator"))),o.forEach(w=>{if(!(w&&w.id&&m.has(w.id))&&w&&w.id){let h=new Option(l(w.name||w.id),w.id);u?u.appendChild(h):c.appendChild(h)}}),u&&u.children.length>0&&c.appendChild(u)}if(c.options.length===0)c.appendChild(new Option(l(`No models for ${s.value}`),"")),c.disabled=!0;else{c.disabled=!1;let u;switch(t){case"openai":u="gpt-4o-mini";break;case"google":u="gemini-1.5-flash-latest";break;case"openrouter":u="anthropic/claude-3.5-sonnet";break;case"claude":u="claude-opus-4-6",Array.isArray(o)&&o.length>0&&(o.some(h=>h&&h.id==="claude-opus-4-6")||(u=o[0].id||null));break;case"azure":case"deepseek":case"ollama":Array.isArray(o)&&o.length>0?u=o[0].id||null:u=null;break;default:u=null;break}u&&c.querySelector(`option[value="${CSS.escape(u)}"]`)?c.value=u:c.selectedIndex=0}let k=s.closest(".aipkit-enhancer-bulk-modal-overlay");k&&g(k)}window.aipkit_enhancer_populateBulkModels=i,window.aipkit_enhancer_toggleReasoningEffort=g})();(function(){"use strict";let g=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],a=i=>{let s=parseInt(i,10);if(Number.isFinite(s)){if(s>=1&&s<=g.length)return g[s-1];let c=g.find(t=>t.tokens===s);if(c)return c}return g[1]};async function r(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let i=window.aipkit_enhancer_bulkState.queue.shift();await n(i),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(r,200)}async function n(i){try{let s=`enhancer-bulk-${i}-${Date.now()}`;typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(i);let c=window.aipkit_post_enhancer?.nonce_generate_title;if(!c)throw new Error("Security nonce not found.");let t=window.aipkit_enhancer_bulkState.enhancementsConfig,d=["keyword","title","excerpt","content","meta","tags"],o=[];d.forEach(p=>{t[p]&&t[p].prompt&&o.push(p)});let l=[],_=[];for(let p of o){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,p,"processing");let f={_ajax_nonce:c,post_id:i,field:p,enhancer_source:"post_enhancer",enhancements:JSON.stringify({[p]:t[p],ai_provider:t.ai_provider,ai_model:t.ai_model,temperature:t.temperature,max_tokens:t.max_tokens,reasoning_effort:t.reasoning_effort,enable_vector_store:t.enable_vector_store,vector_store_provider:t.vector_store_provider,vector_store_top_k:t.vector_store_top_k,openai_vector_store_ids:t.openai_vector_store_ids,pinecone_index_name:t.pinecone_index_name,qdrant_collection_name:t.qdrant_collection_name,vector_embedding_provider:t.vector_embedding_provider,vector_embedding_model:t.vector_embedding_model}),conversation_uuid:s},m=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",f,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,p,"completed",m.message),l.push(p)}catch(f){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,p,"error",f.message||"Processing failed"),_.push(p),console.error(`Failed to process field ${p} for post ${i}:`,f)}}if(t.generate_seo_slug==="1"&&l.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","processing");let p={_ajax_nonce:c,post_id:i,action_type:"update_slug",enhancer_source:"post_enhancer"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",p,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(i,l,_),l.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let f=(window.aipkit_enhancer_postTitles||{})[i]||`Post #${i}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(f=window.aipkit_enhancer_truncateTitle(f,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${f}". No fields were processed successfully.`,"error")}}catch(s){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(i,s.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let t=(window.aipkit_enhancer_postTitles||{})[i]||`Post #${i}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(t=window.aipkit_enhancer_truncateTitle(t,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${t}": ${s.message||"Unknown error"}`,"error")}}}function e(i){let s=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!s)return;let c={},t=s.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(t.length===0){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select at least one field to update.","error");return}t.forEach(h=>{let v=h.value,C=s.querySelector(`#aipkit_bulk_prompt_${v}`);C&&(c[v]={prompt:C.value})});let d=s.querySelector("#aipkit_bulk_ai_provider").value,o=s.querySelector("#aipkit_bulk_ai_model").value,l=s.querySelector("#aipkit_bulk_ai_temperature").value,_=s.querySelector("#aipkit_bulk_content_max_tokens"),p=a(_?_.value:""),f=s.querySelector("#aipkit_bulk_reasoning_effort").value;if(!d||!o){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select an AI Provider and Model.","error");return}c.ai_provider=d,c.ai_model=o,c.temperature=l,c.max_tokens=p.tokens,c.reasoning_effort=f;let m=s.querySelector("#aipkit_bulk_generate_seo_slug");m&&(c.generate_seo_slug=m.checked?"1":"0");let k=s.querySelector('input[name="enable_vector_store"]');if(k&&k.checked){if(c.enable_vector_store="1",c.vector_store_provider=s.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",c.vector_store_top_k=s.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,c.vector_store_provider==="openai"){let h=s.querySelector("#aipkit_bulk_openai_vector_store_ids");h&&(c.openai_vector_store_ids=Array.from(h.selectedOptions).map(v=>v.value))}else c.vector_store_provider==="pinecone"?c.pinecone_index_name=s.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":c.vector_store_provider==="qdrant"&&(c.qdrant_collection_name=s.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(c.vector_store_provider==="pinecone"||c.vector_store_provider==="qdrant")&&(c.vector_embedding_provider=s.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",c.vector_embedding_model=s.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else c.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...i],isRunning:!0,completed:0,failed:0,total:i.length,enhancementsConfig:c},s.querySelector("#aipkit-enhancer-bulk-config").hidden=!0,s.querySelector("#aipkit-enhancer-bulk-progress").hidden=!1;let u=s.querySelector("#aipkit_bulk_enhancer_start_btn");u&&(u.disabled=!0,u.hidden=!0),s.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!1;let w=s.querySelector("#aipkit_bulk_enhancer_cancel_btn");w&&(w.hidden=!0),s.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0,typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),r()}window.aipkit_enhancer_startBulkProcess=e})();(function(){"use strict";let g={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,isAutosaving:!1,autosaveSuspended:!1,autosaveTimer:null,autosaveDelay:800,lastSavedConfig:null,headerStatusTimeout:null,modalElement:null},a="aipkit_bulk_enhancer_selected_template",r=window.aipkit_escapeHtml||function(E){return E},n=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],e=()=>String(window.aipkit_post_enhancer?.default_ai_provider||"").trim().toLowerCase(),i=E=>{let S=parseInt(E,10);if(Number.isFinite(S)){if(S>=1&&S<=n.length)return n[S-1];let A=n.find(T=>T.tokens===S);if(A)return A}return n[1]},s=E=>{let S=E?.content_max_tokens??E?.max_tokens??E?.max_completion_tokens??"",A=parseInt(S,10);if(Number.isFinite(A)){let W=A>=1&&A<=n.length,R=n.some(B=>B.tokens===A);return W||R?i(A):A<=n[0].tokens?n[0]:A<=n[1].tokens?n[1]:n[2]}let T=String(E?.content_length||"").trim().toLowerCase(),M=n.find(W=>W.key===T);if(M)return M;let V=parseInt(window.aipkit_post_enhancer?.default_ai_params?.max_completion_tokens??window.aipkit_post_enhancer?.default_ai_params?.max_tokens??"",10);return Number.isFinite(V)?V<=n[0].tokens?n[0]:V<=n[1].tokens?n[1]:n[2]:n[1]};function c(E){try{E&&String(E)!==""?localStorage.setItem(a,String(E)):localStorage.removeItem(a)}catch(S){console.warn("Failed to save template to localStorage:",S)}}function t(){try{return localStorage.getItem(a)}catch(E){return console.warn("Failed to load template from localStorage:",E),null}}function d(){let E=g.modalElement;if(!E)return{};let S={};["title","excerpt","content","meta","keyword","tags"].forEach(W=>{let R=E.querySelector(`#aipkit_bulk_enhance_${W}`),B=E.querySelector(`#aipkit_bulk_prompt_${W}`);R&&B&&(S[W]={enabled:R.checked?"1":"0",prompt:B.value})}),S.ai_provider=E.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",S.ai_model=E.querySelector("#aipkit_bulk_ai_model")?.value||"",S.ai_temperature=E.querySelector("#aipkit_bulk_ai_temperature")?.value;let T=E.querySelector("#aipkit_bulk_content_max_tokens"),M=i(T?T.value:"");S.content_max_tokens=String(M.tokens),S.reasoning_effort=E.querySelector("#aipkit_bulk_reasoning_effort")?.value||"",S.generate_seo_slug=E.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let V=E.querySelector('input[name="enable_vector_store"]');if(V&&V.checked){if(S.enable_vector_store="1",S.vector_store_provider=E.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",S.vector_store_top_k=E.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",S.vector_store_provider==="openai"){let W=E.querySelector("#aipkit_bulk_openai_vector_store_ids");W&&(S.openai_vector_store_ids=Array.from(W.selectedOptions).map(R=>R.value))}else S.vector_store_provider==="pinecone"?S.pinecone_index_name=E.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":S.vector_store_provider==="qdrant"&&(S.qdrant_collection_name=E.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(S.vector_store_provider==="pinecone"||S.vector_store_provider==="qdrant")&&(S.vector_embedding_provider=E.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",S.vector_embedding_model=E.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else S.enable_vector_store="0";return S}function o(E){g.autosaveSuspended=!0,g.currentTemplateId=E,c(E),window.aipkit_bulk_template_state&&(window.aipkit_bulk_template_state.currentTemplateId=E),typeof window.aipkit_updateBulkTemplatePickerSelection=="function"&&window.aipkit_updateBulkTemplatePickerSelection(E,g.modalElement);let S=g.templates.find(H=>String(H.id)===String(E)),A=S?JSON.parse(JSON.stringify(S.config)):{};if(!A.content_max_tokens&&A.content_length){let H=n.find(ne=>ne.key===String(A.content_length).toLowerCase());A.content_max_tokens=String(H?.tokens||n[1].tokens)}Object.prototype.hasOwnProperty.call(A,"content_length")&&delete A.content_length,g.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(A));let T=g.modalElement;if(!T)return;let M=T.querySelector("#aipkit_bulk_ai_provider"),V=T.querySelector("#aipkit_bulk_ai_model"),W=T.querySelector("#aipkit_bulk_ai_temperature"),R=T.querySelector("#aipkit_bulk_ai_temperature_value"),B=T.querySelector("#aipkit_bulk_content_max_tokens"),$=T.querySelector("#aipkit_bulk_content_max_tokens_value"),G=T.querySelector("#aipkit_bulk_reasoning_effort");if(M){let H=e();M.value=A.ai_provider||H||"openai",M.dispatchEvent(new Event("change",{bubbles:!0}))}if(V&&A.ai_model&&setTimeout(()=>{V.querySelector(`option[value="${CSS.escape(A.ai_model)}"]`)&&(V.value=A.ai_model,V.dispatchEvent(new Event("change")))},150),W&&(W.value=A.ai_temperature||"1.0"),R&&(R.textContent=A.ai_temperature||"1.0"),B){let H=s(A),ne=Math.max(0,n.findIndex(ae=>ae.key===H.key));B.value=String(ne+1),$&&($.textContent=`${H.words} words`)}G&&(G.value=A.reasoning_effort==="minimal"?"low":A.reasoning_effort||"",typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&window.aipkit_enhancer_toggleReasoningEffort(T)),["title","excerpt","content","meta","keyword","tags"].forEach(H=>{let ne=T.querySelector(`#aipkit_bulk_enhance_${H}`),ae=T.querySelector(`#aipkit_bulk_prompt_${H}`);if(ne&&ae){let Z=A[H]?.enabled==="1";ne.checked!==Z&&(ne.checked=Z,ne.dispatchEvent(new Event("change"))),ae.value=A[H]?.prompt||ae.defaultValue}});let L=T.querySelector("#aipkit_bulk_generate_seo_slug");if(L){let H=A.generate_seo_slug==="1";L.checked!==H&&(L.checked=H,L.dispatchEvent(new Event("change")))}let K=T.querySelector('input[name="enable_vector_store"]');if(K&&(K.checked=A.enable_vector_store==="1",K.dispatchEvent(new Event("change"))),A.enable_vector_store==="1"){let H=T.querySelector("#aipkit_bulk_vector_store_provider");H&&(H.value=A.vector_store_provider||"openai",H.dispatchEvent(new Event("change",{bubbles:!0})));let ne=T.querySelector("#aipkit_bulk_vector_store_top_k");if(ne){ne.value=A.vector_store_top_k||"3";let ae=T.querySelector("#aipkit_bulk_vector_store_top_k_value");ae&&(ae.textContent=ne.value)}setTimeout(()=>{if(A.vector_store_provider==="openai"){let ae=T.querySelector("#aipkit_bulk_openai_vector_store_ids");ae&&Array.isArray(A.openai_vector_store_ids)&&Array.from(ae.options).forEach(Z=>{Z.selected=A.openai_vector_store_ids.includes(Z.value)})}else if(A.vector_store_provider==="pinecone"){let ae=T.querySelector("#aipkit_bulk_pinecone_index_name");ae&&(ae.value=A.pinecone_index_name||"",ae.dispatchEvent(new Event("change",{bubbles:!0})))}else if(A.vector_store_provider==="qdrant"){let ae=T.querySelector("#aipkit_bulk_qdrant_collection_name");ae&&(ae.value=A.qdrant_collection_name||"",ae.dispatchEvent(new Event("change",{bubbles:!0})))}if(A.vector_store_provider==="pinecone"||A.vector_store_provider==="qdrant"){let ae=T.querySelector("#aipkit_bulk_vector_embedding_provider"),Z=T.querySelector("#aipkit_bulk_vector_embedding_model");ae&&(ae.value=A.vector_embedding_provider||"openai",ae.dispatchEvent(new Event("change"))),Z&&A.vector_embedding_model&&setTimeout(()=>{Z.value=A.vector_embedding_model,Z.dispatchEvent(new Event("change",{bubbles:!0}))},150)}},100)}g.currentTemplateModified=!1,_(),window.clearTimeout(g.autosaveTimer),g.autosaveTimer=null,window.setTimeout(()=>{g.lastSavedConfig=d(),g.autosaveSuspended=!1},200)}function l(){let E=d();g.currentTemplateModified=!window.aipkit_deepEqual(E,g.initialConfigForSelectedTemplate),_(),x()}function _(){let E=g.modalElement;if(!E)return;let S=E.querySelector("#aipkit_enhancer_template_select").value,A=S&&String(S)!=="";E.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!A,E.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!A}function p(){let E=g.modalElement;if(!E)return;let S=E.querySelector("#aipkit_enhancer_template_action_list"),A=E.querySelector("#aipkit_enhancer_template_inline_form"),T=E.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),M=E.querySelector("#aipkit_enhancer_template_name_input");S&&(S.style.display=""),A&&(A.style.display="none",delete A.dataset.mode),T&&(T.style.display="none"),M&&(M.value="")}function f(E,S=""){let A=g.modalElement;if(!A)return;let T=A.querySelector("#aipkit_enhancer_template_inline_form"),M=A.querySelector("#aipkit_enhancer_template_name_input"),V=A.querySelector("#aipkit_enhancer_template_action_list"),W=A.querySelector("#aipkit_enhancer_template_inline_delete_confirm");!T||!M||(V&&(V.style.display="none"),W&&(W.style.display="none"),T.style.display="flex",T.dataset.mode=E,M.value=S,M.focus())}function m(){p()}function k(E){let S=g.modalElement;if(!S)return;let A=S.querySelector("#aipkit_enhancer_template_inline_form"),T=S.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),M=S.querySelector("#aipkit_enhancer_template_delete_confirm_text"),V=S.querySelector("#aipkit_enhancer_template_action_list");!T||!M||(A&&(A.style.display="none"),V&&(V.style.display="none"),T.style.display="flex",M.innerHTML=`Delete "<strong>${r(E)}</strong>"?`)}function u(){p()}function w(E,S="info"){h(E,S)}function h(E,S="info"){let A=g.modalElement?.querySelector("#aipkit_bulk_autosave_status");if(A){if(g.headerStatusTimeout&&(clearTimeout(g.headerStatusTimeout),g.headerStatusTimeout=null),!E){A.textContent="",A.className="aipkit_cw_save_status aipkit_enhancer_modal_status";return}A.textContent=r(E),A.className=`aipkit_cw_save_status aipkit_enhancer_modal_status aipkit_settings_message-${S}`,S==="success"&&(g.headerStatusTimeout=setTimeout(()=>{A.textContent="",A.className="aipkit_cw_save_status aipkit_enhancer_modal_status"},2500))}}function v(){let E=g.currentTemplateId;if(!E)return null;let S="",A=g.templates.find(M=>String(M.id)===String(E));if(A?.template_name&&(S=A.template_name),!S){let M=g.modalElement?.querySelector("#aipkit_enhancer_template_select");M?.selectedOptions?.length&&(S=M.selectedOptions[0].textContent.trim())}let T=parseInt(E,10);return!S||Number.isNaN(T)?null:{id:T,name:S}}async function C(){if(g.autosaveSuspended||g.isSavingOrDeleting||g.isAutosaving)return;let E=d();if(!E||g.lastSavedConfig&&window.aipkit_deepEqual(E,g.lastSavedConfig))return;let S=v();if(S){g.isAutosaving=!0,h("Saving...","info");try{let A=window.aipkit_post_enhancer?.nonce_manage_templates;if(!A)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:S.id,template_name:S.name,config:JSON.stringify(E),template_type:"enhancer",_ajax_nonce:A}),g.lastSavedConfig=JSON.parse(JSON.stringify(E)),g.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(E)),g.currentTemplateModified=!1,_(),h("Saved","success")}catch(A){h(`Error: ${A.message||"Failed to save."}`,"error"),console.error("Bulk Enhancer Auto-Save Error:",A)}finally{g.isAutosaving=!1}}}function x(){g.autosaveSuspended||g.isSavingOrDeleting||g.currentTemplateId&&(g.autosaveTimer&&clearTimeout(g.autosaveTimer),g.autosaveTimer=setTimeout(()=>{g.autosaveTimer=null,C()},g.autosaveDelay))}async function b(){let E=g.modalElement.querySelector("#aipkit_enhancer_template_select");E.innerHTML='<option value="">Loading...</option>',E.disabled=!0;try{let S=window.aipkit_post_enhancer?.nonce_manage_templates;if(!S)throw new Error("Security nonce for templates not found.");let A=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:S});g.templates=A.templates||[],E.innerHTML='<option value="">-- Select Template --</option>',g.templates.forEach(M=>{E.appendChild(new Option(r(M.template_name),M.id))}),E.disabled=!1;let T=t();T&&(g.templates.some(V=>String(V.id)===String(T))?(E.value=T,o(T)):c(null)),window.aipkit_bulk_template_state={templates:g.templates,currentTemplateId:g.currentTemplateId},typeof window.aipkit_renderBulkTemplatePicker=="function"&&window.aipkit_renderBulkTemplatePicker(g.modalElement)}catch(S){w("Error loading templates: "+S.message,"error")}}async function I(E,S){if(!g.isSavingOrDeleting){g.isSavingOrDeleting=!0,w("Saving template...","info");try{let A=d(),T=window.aipkit_post_enhancer?.nonce_manage_templates;if(!T)throw new Error("Security nonce for templates not found.");let M=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:E,template_name:S,config:JSON.stringify(A),template_type:"enhancer",_ajax_nonce:T});w(M.message,"success"),await b(),g.modalElement.querySelector("#aipkit_enhancer_template_select").value=M.template_id,g.currentTemplateId=M.template_id,c(M.template_id),g.currentTemplateModified=!1,g.lastSavedConfig=JSON.parse(JSON.stringify(A)),g.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(A)),h("Saved","success"),_()}catch(A){w("Error saving: "+A.message,"error")}finally{g.isSavingOrDeleting=!1}}}async function y(){let E=g.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!E||g.isSavingOrDeleting)){g.isSavingOrDeleting=!0,w("Deleting...","info");try{let S=window.aipkit_post_enhancer?.nonce_manage_templates;if(!S)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:E,_ajax_nonce:S}),w("Template deleted.","success"),await b(),g.currentTemplateId=null;let A=t();A&&String(A)===String(E)&&c(null),g.lastSavedConfig=null,h("Template deleted","success"),_()}catch(S){w("Error deleting: "+S.message,"error")}finally{g.isSavingOrDeleting=!1}}}function q(E){g.modalElement=E;let S=E.querySelector("#aipkit_enhancer_template_select");S.addEventListener("change",$=>{h(""),p(),o($.target.value)}),E.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{f("new")}),E.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let $=S.options[S.selectedIndex];g.currentTemplateId&&$&&f("rename",$.text)}),E.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",()=>{let $=S.options[S.selectedIndex];$&&k($.text)});let A=E.querySelector("#aipkit_enhancer_template_inline_form"),T=E.querySelector("#aipkit_enhancer_template_save_inline_btn"),M=E.querySelector("#aipkit_enhancer_template_cancel_inline_btn"),V=E.querySelector("#aipkit_enhancer_template_name_input");T&&M&&A&&V&&(M.addEventListener("click",m),T.addEventListener("click",async()=>{let $=A.dataset.mode,G=V.value.trim();if(!G){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}if($==="new")await I(0,G);else if($==="rename"){let L=S.value;L&&await I(parseInt(L,10),G)}m()}));let W=E.querySelector("#aipkit_enhancer_template_confirm_delete_btn"),R=E.querySelector("#aipkit_enhancer_template_cancel_delete_btn");W&&R&&(R.addEventListener("click",u),W.addEventListener("click",async()=>{await y(),u()})),b(),typeof window.aipkit_initBulkTemplatePicker=="function"&&window.aipkit_initBulkTemplatePicker(E);let B=$=>{$.target?.id!=="aipkit_enhancer_template_select"&&l()};E.addEventListener("input",B),E.addEventListener("change",B)}window.aipkit_enhancer_initTemplateControls=q,window.aipkit_enhancer_setHeaderStatus=h})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(_){return _},a=_=>_||document.querySelector(".aipkit_enhancer_bulk_modal");function r(_){let p=a(_);return{root:p,select:p?.querySelector("#aipkit_enhancer_template_select")||null,button:p?.querySelector("#aipkit_enhancer_template_picker_btn")||null,label:p?.querySelector("#aipkit_enhancer_template_picker_label")||null,list:p?.querySelector("#aipkit_enhancer_template_picker_list")||null,search:p?.querySelector("#aipkit_enhancer_template_picker_search")||null,searchClear:p?.querySelector("#aipkit_enhancer_template_picker_search_clear")||null,popover:p?.querySelector("#aipkit_enhancer_template_picker_popover")||null}}function n(_,p){let f=[],m={};_.forEach(u=>{if(!(String(u.is_starter)==="1"||u.is_starter===!0))if(p&&u.user_id?.toString()===p)f.push(u);else{let h=u.display_name||`User ID: ${u.user_id}`;m[h]||(m[h]=[]),m[h].push(u)}}),f.sort((u,w)=>u.is_default==="1"?-1:w.is_default==="1"?1:u.template_name.localeCompare(w.template_name));let k={};return Object.keys(m).sort().forEach(u=>{k[u]=m[u].sort((w,h)=>w.template_name.localeCompare(h.template_name))}),{myTemplates:f,otherUsersTemplates:k}}function e(_){return _.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function i(_,p){let{label:f}=r(p);if(!f||!_)return;let m=_.options[_.selectedIndex],k=m?m.text:g("Select template");f.textContent=k||g("Select template")}function s(_,p){if(!_)return;let f=String(p||"");_.querySelectorAll(".aipkit_cw_template_list_item").forEach(m=>{let u=(m.dataset.templateId||"")===f;m.classList.toggle("is-active",u),m.setAttribute("aria-selected",u?"true":"false")})}function c(_,p=""){let{select:f,list:m}=r(_);if(!f||!m)return;let k=window.aipkit_bulk_template_state?.templates||[],u=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!k.length){let y=f.disabled&&f.options.length&&f.options[0].text.toLowerCase().includes("loading"),q=document.createElement("div");q.className="aipkit_cw_template_picker_empty",q.textContent=g(y?"Loading templates...":"No templates found."),m.appendChild(q),i(f,_);return}let w=n(k,u),h=document.createDocumentFragment(),v=p.toLowerCase().trim(),C=(y,q)=>{let E=document.createElement("div");if(E.className="aipkit_cw_template_group_label",q){let A=document.createElement("span");A.className=`dashicons ${q}`,A.setAttribute("aria-hidden","true"),E.appendChild(A)}let S=document.createElement("span");return S.textContent=g(y),E.appendChild(S),E},x=y=>{let q=document.createElement("button");q.type="button",q.className="aipkit_cw_template_list_item",y.is_default==="1"&&q.classList.add("is-default"),q.dataset.templateId=String(y.id),q.dataset.templateLabel=y.template_name.toLowerCase(),q.setAttribute("role","option"),q.setAttribute("aria-selected","false");let E=e(y),S=document.createElement("span");S.className=`aipkit_cw_template_list_icon dashicons ${E}`,S.setAttribute("aria-hidden","true");let A=document.createElement("span");A.className="aipkit_cw_template_list_content";let T=document.createElement("span");T.className="aipkit_cw_template_list_name",T.textContent=g(y.template_name),A.appendChild(T);let M=document.createElement("span");return M.className="aipkit_cw_template_list_check dashicons dashicons-yes",M.setAttribute("aria-hidden","true"),q.appendChild(S),q.appendChild(A),q.appendChild(M),q},b=(y,q,E)=>{let S=v?q.filter(T=>T.template_name.toLowerCase().includes(v)):q;if(!S.length)return 0;let A=document.createElement("div");return A.className="aipkit_cw_template_group",A.appendChild(C(y,E)),S.forEach(T=>{A.appendChild(x(T))}),h.appendChild(A),S.length},I=0;if(I+=b("My Templates",w.myTemplates,"dashicons-admin-users"),Object.keys(w.otherUsersTemplates).forEach(y=>{I+=b(y,w.otherUsersTemplates[y],"dashicons-groups")}),I===0){let y=document.createElement("div");y.className="aipkit_cw_template_picker_empty",y.textContent=g(v?"No templates match your search.":"No templates found."),m.appendChild(y)}else m.appendChild(h);i(f,_),s(m,f.value)}function t(_,p){c(_,p)}function d(_){let{search:p,searchClear:f,popover:m}=r(_);if(!p)return;let k=null;p.addEventListener("input",u=>{let w=u.target.value;f&&(f.style.display=w?"flex":"none"),clearTimeout(k),k=setTimeout(()=>{t(_,w)},150)}),f&&f.addEventListener("click",()=>{p.value="",f.style.display="none",t(_,""),p.focus()}),m&&new MutationObserver(w=>{w.forEach(h=>{h.attributeName==="aria-hidden"&&m.getAttribute("aria-hidden")==="true"&&p.value&&(p.value="",f&&(f.style.display="none"),t(_,""))})}).observe(m,{attributes:!0})}function o(_){let{select:p,list:f,button:m}=r(_);!p||!f||(d(_),f.dataset.listenerAttached||(f.addEventListener("click",k=>{let u=k.target.closest(".aipkit_cw_template_list_item");if(!u||!p)return;let w=u.dataset.templateId||"";p.value=w,p.dispatchEvent(new Event("change",{bubbles:!0})),s(f,w),m&&m.click()}),f.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",()=>{i(p,_),s(f,p.value)}),p.dataset.listenerAttached="true"),c(_))}function l(_,p){let{select:f,list:m}=r(p);f&&(_!==void 0&&(f.value=_),i(f,p),s(m,f.value))}window.aipkit_initBulkTemplatePicker=o,window.aipkit_renderBulkTemplatePicker=c,window.aipkit_updateBulkTemplatePickerSelection=l})();(function(){"use strict";function g(a){let{postCount:r,providerOptions:n,defaultPrompts:e,promptLibrary:i,postType:s}=a,c=h=>String(h??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=h=>c(h).replace(/"/g,"&quot;").replace(/'/g,"&#39;"),d=(h=[])=>h.map(v=>!v?.label||!v?.prompt?"":`<option value="${t(v.prompt)}">${c(v.label)}</option>`).join(""),o=i||{},l=`<option value="${t(e.title||"")}">Default</option>${d(o.title)}`,_=`<option value="${t(e.content||"")}">Default</option>${d(o.content)}`,p=`<option value="${t(e.meta||"")}">Default</option>${d(o.meta)}`,f=`<option value="${t(e.keyword||"")}">Default</option>${d(o.keyword)}`,m=`<option value="${t(e.excerpt||"")}">Default</option>${d(o.excerpt)}`,k=`<option value="${t(e.tags||"")}">Default</option>${d(o.tags)}`,u="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}, {original_tags}, {categories}.";s==="product"&&(u+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),u=u.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let w="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}, {original_tags}, {categories}.";return s==="product"&&(w+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),w=w.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div id="aipkit_enhancer_bulk_modal" class="aipkit-modal-content aipkit-enhancer-bulk-modal-content aipkit_enhancer_bulk_modal" data-post-type="${t(s)}">
          <div class="aipkit-modal-header aipkit_enhancer_modal_header">
            <div class="aipkit_enhancer_header_left">
              <span class="aipkit_enhancer_header_icon" aria-hidden="true">
                <span class="dashicons dashicons-edit-large"></span>
              </span>
              <div class="aipkit_enhancer_header_text">
                <h3 class="aipkit-modal-title">Content Assistant</h3>
                <span class="aipkit_enhancer_modal_subtitle">Bulk content update</span>
              </div>
            </div>
            <div class="aipkit_enhancer_header_center">
              <div
                id="aipkit_bulk_autosave_status"
                class="aipkit_cw_save_status aipkit_enhancer_modal_status"
                aria-live="polite"
              ></div>
            </div>
            <div class="aipkit_enhancer_header_right">
              <button type="button" class="aipkit-modal-close-btn aipkit_enhancer_close_btn" aria-label="Close">\xD7</button>
            </div>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <div class="aipkit_enhancer_section aipkit_enhancer_engine_card">
                <div class="aipkit_enhancer_engine_fields">
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Template</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <button
                          type="button"
                          id="aipkit_enhancer_template_picker_btn"
                          class="aipkit_popover_option_btn aipkit_settings_select_picker_btn"
                          data-aipkit-popover-target="aipkit_enhancer_template_picker_popover"
                          data-aipkit-popover-placement="bottom"
                          data-aipkit-bulk-popover="templates"
                          aria-controls="aipkit_enhancer_template_picker_popover"
                          aria-expanded="false"
                        >
                          <span class="aipkit_settings_select_picker_label" id="aipkit_enhancer_template_picker_label">Select template</span>
                          <span class="dashicons dashicons-arrow-down-alt2" aria-hidden="true"></span>
                        </button>
                        <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_enhancer_engine_select screen-reader-text">
                        <option value="">-- Select Template --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Provider</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_provider" class="aipkit_enhancer_engine_select">${n}</select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Model</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_model" class="aipkit_enhancer_engine_select">
                          <option value="">-- Select Provider --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field aipkit_enhancer_engine_field--action">
                    <button
                      type="button"
                      class="aipkit_enhancer_settings_btn"
                      data-aipkit-popover-target="aipkit_bulk_settings_popover"
                      data-aipkit-popover-placement="bottom"
                      data-aipkit-bulk-popover="settings"
                      aria-controls="aipkit_bulk_settings_popover"
                      aria-expanded="false"
                      title="Advanced settings"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="aipkit_enhancer_section aipkit_enhancer_prompt_section"
                id="aipkit_bulk_prompt_section"
              >
                <div class="aipkit_enhancer_section_header">
                  <h4>What to update</h4>
                </div>
                <div class="aipkit_prompts_redesigned">
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="title">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Title</span>
                        <span class="aipkit_prompt_toggle_desc">Post title</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_title_prompt_flyout"
                          aria-controls="aipkit_bulk_title_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="content">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Content</span>
                        <span class="aipkit_prompt_toggle_desc">Rewrite the main body</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_content_prompt_flyout"
                          aria-controls="aipkit_bulk_content_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="meta">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Meta Description</span>
                        <span class="aipkit_prompt_toggle_desc">SEO snippet for search</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_meta_prompt_flyout"
                          aria-controls="aipkit_bulk_meta_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="keyword">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Focus Keyword</span>
                        <span class="aipkit_prompt_toggle_desc">Primary SEO keyword</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_keyword_prompt_flyout"
                          aria-controls="aipkit_bulk_keyword_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="excerpt">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Excerpt</span>
                        <span class="aipkit_prompt_toggle_desc">Short summary text</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_excerpt_prompt_flyout"
                          aria-controls="aipkit_bulk_excerpt_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="tags">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Tags</span>
                        <span class="aipkit_prompt_toggle_desc">Suggested tags list</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_tags_prompt_flyout"
                          aria-controls="aipkit_bulk_tags_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="seo_slug">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Optimize URL</span>
                        <span class="aipkit_prompt_toggle_desc">Generate a new slug</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1" class="aipkit_toggle_switch">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_bulk_settings_popover" data-aipkit-bulk-popover="settings" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_model_settings_popover_panel--wide aipkit_model_settings_popover_panel--allow-overflow aipkit_cw_settings_popover_panel" role="dialog" aria-label="Settings">
                <div class="aipkit_model_settings_popover_header">
                  <span class="aipkit_model_settings_popover_title">Settings</span>
                  <button type="button" class="aipkit_model_settings_popover_close" aria-label="Close">
                    <span class="dashicons dashicons-no-alt"></span>
                  </button>
                </div>
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_enhancer_settings_popover">
                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <!-- Sliders Row (2 columns) -->
                        <div class="aipkit_enhancer_sliders_row">
                          <!-- Temperature Slider (Creativity) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_temperature_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_ai_temperature">Creativity</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_ai_temperature_value">1.0</span>
                            </div>
                            <div class="aipkit_enhancer_temperature_slider_wrapper">
                              <div class="aipkit_enhancer_temperature_labels">
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--low">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                  Focused
                                </span>
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--high">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                  Creative
                                </span>
                              </div>
                              <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_enhancer_temperature_slider" min="0" max="2" step="0.1" value="1.0">
                            </div>
                          </div>

                          <!-- Max Tokens Slider (Content Length) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_tokens_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_content_max_tokens">Content Length</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_content_max_tokens_value">1200-1600 words</span>
                            </div>
                            <div class="aipkit_enhancer_tokens_slider_wrapper">
                              <div class="aipkit_enhancer_tokens_labels">
                                <span class="aipkit_enhancer_tokens_label">Short</span>
                                <span class="aipkit_enhancer_tokens_label">Medium</span>
                                <span class="aipkit_enhancer_tokens_label">Long</span>
                              </div>
                              <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_enhancer_tokens_slider" min="1" max="3" step="1" value="2">
                            </div>
                          </div>
                        </div>

                        <div class="aipkit_popover_option_row aipkit_enhancer_reasoning_effort_field">
                          <div class="aipkit_popover_option_main">
                            <div class="aipkit_popover_option_text">
                              <label class="aipkit_popover_option_label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                              <span class="aipkit_popover_option_helper">Controls thinking effort for supported models.</span>
                            </div>
                            <div class="aipkit_popover_option_actions">
                              <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_popover_option_select">
                                <option value="none">None</option>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="xhigh">XHigh</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <div class="aipkit_enhancer_vector_settings">
                      <!-- Enable Toggle -->
                      <div class="aipkit_enhancer_vector_toggle_card">
                        <div class="aipkit_enhancer_vector_toggle_row">
                          <div class="aipkit_enhancer_vector_toggle_info">
                            <span class="aipkit_enhancer_vector_toggle_label">Knowledge Base</span>
                            <span class="aipkit_enhancer_vector_toggle_desc">Use your vector stores for RAG-enhanced content</span>
                          </div>
                          <div class="aipkit_enhancer_vector_toggle_controls">
                            <label class="aipkit_switch">
                              <input type="checkbox" name="enable_vector_store" value="1" class="aipkit_toggle_switch">
                              <span class="aipkit_switch_slider"></span>
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Source Selector (shown when enabled) -->
                      <div class="aipkit_cw_vector_store_settings_container aipkit_enhancer_vector_source_container" hidden>
                        <div class="aipkit_enhancer_vector_source_selector">
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_store_provider">Provider</label>
                            <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="pinecone">Pinecone</option>
                              <option value="qdrant">Qdrant</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <!-- OpenAI Stores (Multiselect) -->
                            <div class="aipkit_cw_vector_openai_field">
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_openai_vector_store_ids">Vector Store</label>
                              <div
                                class="aipkit_popover_multiselect aipkit_vector_multiselect aipkit_enhancer_vector_multiselect"
                                data-aipkit-vector-stores-dropdown
                                data-placeholder="Select stores"
                                data-selected-label="selected"
                              >
                                <button
                                  type="button"
                                  class="aipkit_popover_multiselect_btn aipkit_vector_multiselect_btn aipkit_enhancer_vector_multiselect_btn"
                                  aria-expanded="false"
                                  aria-controls="aipkit_bulk_openai_vector_store_panel"
                                >
                                  <span class="aipkit_popover_multiselect_label">Select stores</span>
                                </button>
                                <div
                                  id="aipkit_bulk_openai_vector_store_panel"
                                  class="aipkit_popover_multiselect_panel aipkit_enhancer_vector_multiselect_panel"
                                  role="menu"
                                  hidden
                                >
                                  <div class="aipkit_popover_multiselect_options"></div>
                                </div>
                              </div>
                              <select
                                id="aipkit_bulk_openai_vector_store_ids"
                                name="openai_vector_store_ids[]"
                                class="aipkit_popover_multiselect_select"
                                multiple
                                size="3"
                                hidden
                                aria-hidden="true"
                                tabindex="-1"
                              ></select>
                            </div>
                            
                            <!-- Pinecone Index -->
                            <div class="aipkit_cw_vector_pinecone_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_pinecone_index_name">Index</label>
                              <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                            
                            <!-- Qdrant Collection -->
                            <div class="aipkit_cw_vector_qdrant_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                              <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                          </div>
                        </div>

                        <!-- Embedding Config (for Pinecone/Qdrant) -->
                        <div class="aipkit_cw_vector_embedding_config_row aipkit_enhancer_vector_embedding_selector" hidden>
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_provider">Embedding</label>
                            <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="google">Google</option>
                              <option value="azure">Azure</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_model">Model</label>
                            <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_enhancer_vector_settings_select"></select>
                          </div>
                        </div>

                        <!-- Results Limit Slider -->
                        <div class="aipkit_vector_slider_group">
                          <div class="aipkit_vector_slider_header">
                            <label class="aipkit_vector_settings_label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                            <span class="aipkit_vector_slider_value" id="aipkit_bulk_vector_store_top_k_value">3</span>
                          </div>
                          <div class="aipkit_vector_slider_wrapper">
                            <div class="aipkit_vector_slider_labels">
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--min">
                                <span class="dashicons dashicons-minus" aria-hidden="true"></span>
                                Fewer
                              </span>
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--max">
                                More
                                <span class="dashicons dashicons-plus" aria-hidden="true"></span>
                              </span>
                            </div>
                            <input type="range" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_vector_slider" value="3" min="1" max="20" step="1">
                          </div>
                          <p class="aipkit_vector_slider_hint">Number of matching chunks to retrieve</p>
                        </div>
                      </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_enhancer_template_picker_popover" data-aipkit-bulk-popover="templates" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_cw_settings_popover_panel aipkit_cw_template_picker_popover_panel" role="dialog" aria-label="Templates">
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_cw_template_picker_search_wrap">
                    <span class="dashicons dashicons-search aipkit_cw_template_picker_search_icon" aria-hidden="true"></span>
                    <input
                      type="text"
                      id="aipkit_enhancer_template_picker_search"
                      class="aipkit_cw_template_picker_search"
                      placeholder="Search templates..."
                      autocomplete="off"
                    >
                    <button
                      type="button"
                      id="aipkit_enhancer_template_picker_search_clear"
                      class="aipkit_cw_template_picker_search_clear"
                      aria-label="Clear search"
                      style="display: none;"
                    >
                      <span class="dashicons dashicons-no-alt" aria-hidden="true"></span>
                    </button>
                  </div>
                  <div class="aipkit_cw_template_picker_list" id="aipkit_enhancer_template_picker_list" role="listbox" aria-label="Template list">
                    <div class="aipkit_cw_template_picker_empty">
                      Loading templates...
                    </div>
                  </div>
                  <div class="aipkit_cw_template_picker_actions">
                    <div class="aipkit_cw_template_action_list" id="aipkit_enhancer_template_action_list">
                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">
                        <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
                        New
                      </button>
                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        Rename
                      </button>
                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                        Delete
                      </button>
                    </div>
                    <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                      <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                    <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                      <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_title_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Title Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Title Prompt</span>
                    <select id="aipkit_bulk_title_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_title" title="Load template">
                      ${l}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_title" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(e.title||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="title" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_content_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Content Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Content Prompt</span>
                    <select id="aipkit_bulk_content_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_content" title="Load template">
                      ${_}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_content" class="aipkit_cw_prompt_editor_textarea" rows="10">${c(e.content||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="content" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_meta_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Meta Description Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Meta Description Prompt</span>
                    <select id="aipkit_bulk_meta_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_meta" title="Load template">
                      ${p}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_meta" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(e.meta||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="meta" data-label="Placeholders:" data-copy-title="Click to copy">${w}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_keyword_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Focus Keyword Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Focus Keyword Prompt</span>
                    <select id="aipkit_bulk_keyword_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_keyword" title="Load template">
                      ${f}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(e.keyword||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="keyword" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_excerpt_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Excerpt Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Excerpt Prompt</span>
                    <select id="aipkit_bulk_excerpt_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_excerpt" title="Load template">
                      ${m}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(e.excerpt||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="excerpt" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_tags_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Tags Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Tags Prompt</span>
                    <select id="aipkit_bulk_tags_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_tags" title="Load template">
                      ${k}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_tags" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(e.tags||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="tags" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div id="aipkit-enhancer-bulk-progress" hidden>
              <div class="aipkit_enhancer_progress_header">
                <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
              </div>
              <div class="aipkit_progress_bar_container">
                <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled"></div>
              </div>
              <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <div class="aipkit_enhancer_footer_info">
              <div class="aipkit_enhancer_selection_badge">
                <span class="aipkit_enhancer_selection_count">${r}</span>
                <span class="aipkit_enhancer_selection_label">item${r===1?"":"s"} selected</span>
              </div>
            </div>
            <div class="aipkit_enhancer_footer_actions">
              <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-ghost" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span>Back</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                <span>Stop</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-success">
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                <span class="aipkit_btn-text">Start Processing</span>
                <span class="aipkit_spinner" hidden></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=g})();(function(){"use strict";function g(a,r){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let n={};a.forEach(f=>{let m=document.querySelector(`tr#post-${f}`);if(m){let k=m.querySelector(".row-title")||m.querySelector("strong a")||m.querySelector(".title a")||m.querySelector("a.row-title")||m.querySelector(".column-title strong a")||m.querySelector(".column-title .row-title");k&&(n[f]=k.textContent.trim())}n[f]||(n[f]=`Post #${f}`)}),window.aipkit_enhancer_postTitles=n;let e=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},i=window.aipkit_post_enhancer?.prompt_library||{},s=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],c=window.aipkit_post_enhancer?.default_ai_provider||"",t=String(c||"").trim().toLowerCase(),d={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",claude:"Claude",deepseek:"DeepSeek",ollama:"Ollama"},o=s.map(f=>{let m=f.toLowerCase();return`<option value="${m}" ${t&&m===t?"selected":""}>${d[m]||f.toUpperCase()}</option>`}).join(""),l=window.aipkit_enhancer_getBulkModalHtml({postCount:a.length,providerOptions:o,defaultPrompts:e,promptLibrary:i,postType:r});document.body.insertAdjacentHTML("beforeend",l);let _=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(_,a):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available.");let p=_.querySelector("#aipkit_bulk_ai_provider");p&&t&&Array.from(p.options).some(m=>m.value===t)&&(p.value=t,p.dispatchEvent(new Event("change",{bubbles:!0}))),requestAnimationFrame(()=>{_.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(y){return y},a=".aipkit_enhancer_bulk_modal",r=["#aipkit_bulk_ai_provider","#aipkit_bulk_ai_model","#aipkit_bulk_vector_store_provider","#aipkit_bulk_vector_embedding_provider","#aipkit_bulk_pinecone_index_name","#aipkit_bulk_qdrant_collection_name","#aipkit_bulk_vector_embedding_model"].join(", "),n=null,e=null,i=!1,s=new Set(["aipkit_bulk_ai_provider","aipkit_bulk_vector_store_provider","aipkit_bulk_vector_embedding_provider"]),c=y=>!!(y&&y.id&&s.has(y.id)),t=y=>String(y||"").trim().toLowerCase(),d=(y,q)=>{if(!y)return;let E="aipkit_settings_select_picker_icon--";y.classList.forEach(A=>{A.startsWith(E)&&y.classList.remove(A)}),y.classList.remove("is-hidden");let S=t(q);if(!S){y.classList.add("is-hidden");return}y.classList.add(`${E}${S}`)},o=y=>{if(!y)return"";let q=y.getAttribute("data-aipkit-picker-title");if(q)return q;let E=y.id&&document.querySelector(`label[for="${y.id}"]`)||y.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return E?E.textContent.trim():""},l=y=>{if(!y)return"";let q=y.selectedOptions&&y.selectedOptions.length?y.selectedOptions[0]:y.querySelector("option[selected]");if(q)return q.textContent.trim();let E=y.querySelector("option");return E?E.textContent.trim():""},_=y=>({buttonId:`${y}_picker_btn`,labelId:`${y}_picker_label`,popoverId:`${y}_picker_popover`,titleId:`${y}_picker_title`,searchId:`${y}_picker_search`,listId:`${y}_picker_list`}),p=(y,q)=>{if(!y||!y.id||!q)return null;let E=_(y.id),S=q.querySelector(`#${E.buttonId}`);if(!S){if(S=document.createElement("button"),S.type="button",S.id=E.buttonId,S.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",S.setAttribute("data-aipkit-popover-target",E.popoverId),S.setAttribute("aria-controls",E.popoverId),S.setAttribute("aria-expanded","false"),S.dataset.aipkitPopoverPlacement="bottom",c(y)){S.classList.add("aipkit_settings_select_picker_btn--provider");let V=document.createElement("span");V.className="aipkit_settings_select_picker_icon",V.setAttribute("aria-hidden","true"),d(V,y.value),S.appendChild(V)}let T=document.createElement("span");T.className="aipkit_settings_select_picker_label",T.id=E.labelId,T.textContent=l(y)||g("Select","gpt3-ai-content-generator");let M=document.createElement("span");M.className="dashicons dashicons-arrow-down-alt2",M.setAttribute("aria-hidden","true"),S.appendChild(T),S.appendChild(M),y.insertAdjacentElement("beforebegin",S)}y.classList.contains("screen-reader-text")||y.classList.add("screen-reader-text");let A=q.querySelector(`#${E.popoverId}`);if(!A){A=document.createElement("div"),A.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",c(y)&&A.classList.add("aipkit_settings_select_picker_popover--provider"),A.id=E.popoverId,A.setAttribute("aria-hidden","true");let T=document.createElement("div");T.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",T.setAttribute("role","dialog"),T.setAttribute("aria-labelledby",E.titleId);let M=document.createElement("div");M.className="aipkit_model_settings_popover_header";let V=document.createElement("span");V.className="aipkit_model_settings_popover_title",V.id=E.titleId,V.textContent=o(y)||g("Select","gpt3-ai-content-generator");let W=document.createElement("button");W.type="button",W.className="aipkit_model_settings_popover_close",W.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),W.innerHTML='<span class="dashicons dashicons-no-alt"></span>',M.appendChild(V),M.appendChild(W);let R=document.createElement("div");R.className="aipkit_model_settings_popover_body";let B=document.createElement("div");B.className="aipkit_settings_select_picker_search";let $=document.createElement("input");$.type="search",$.id=E.searchId,$.className="aipkit_form-input";let G=o(y),L=G?`Search ${G.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");$.setAttribute("placeholder",L),B.appendChild($);let K=document.createElement("div");K.className="aipkit_settings_select_picker_list",K.id=E.listId,K.setAttribute("role","listbox"),R.appendChild(B),R.appendChild(K),T.appendChild(M),T.appendChild(R),A.appendChild(T),q.appendChild(A),c(y)&&(B.style.display="none")}return{ids:E,button:S,popover:A,label:q.querySelector(`#${E.labelId}`),search:q.querySelector(`#${E.searchId}`),list:q.querySelector(`#${E.listId}`)}},f=y=>{let q=[];return y&&Array.from(y.children).forEach(S=>{if(S.tagName==="OPTGROUP"){let A=Array.from(S.children).filter(T=>T.tagName==="OPTION").map(T=>({value:T.value,label:T.textContent.trim(),disabled:T.disabled,selected:T.selected}));q.push({groupLabel:S.label||"",options:A})}else S.tagName==="OPTION"&&q.push({groupLabel:"",options:[{value:S.value,label:S.textContent.trim(),disabled:S.disabled,selected:S.selected}]})}),q},m=(y,q,E="")=>{if(!y||!q)return;let S=E.trim().toLowerCase();q.innerHTML="";let A=f(y),T=!1;if(A.forEach(M=>{let V=M.options.filter(W=>S?W.label.toLowerCase().includes(S):!0);if(V.length){if(M.groupLabel){let W=document.createElement("div");W.className="aipkit_settings_select_picker_group_label",W.textContent=M.groupLabel,q.appendChild(W)}V.forEach(W=>{let R=document.createElement("button");if(R.type="button",R.className="aipkit_settings_select_picker_item",R.setAttribute("role","option"),R.dataset.value=W.value,R.dataset.label=W.label,W.disabled&&(R.classList.add("is-disabled"),R.setAttribute("aria-disabled","true")),y.value===W.value?(R.classList.add("is-active"),R.setAttribute("aria-selected","true")):R.setAttribute("aria-selected","false"),c(y)){R.classList.add("aipkit_settings_select_picker_item--provider");let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),d(G,W.value),R.appendChild(G)}let B=document.createElement("span");B.className="aipkit_settings_select_picker_text",B.textContent=W.label;let $=document.createElement("span");$.className="dashicons dashicons-yes aipkit_settings_select_picker_check",R.appendChild(B),R.appendChild($),q.appendChild(R),T=!0})}}),!T){let M=document.createElement("div");M.className="aipkit_settings_select_picker_empty",M.textContent=g(S?"No matches found.":"No options available.","gpt3-ai-content-generator"),q.appendChild(M)}},k=(y,q)=>{if(!y||!q)return;let E=l(y);if(q.textContent=E||g("Select","gpt3-ai-content-generator"),c(y)){let S=q.closest("button"),A=S?S.querySelector(".aipkit_settings_select_picker_icon"):null;d(A,y.value)}},u=(y,q)=>{if(!y||!q)return;let E=y.getBoundingClientRect(),S=q.getBoundingClientRect(),A=S.width||320,T=S.height||0,M=window.innerWidth,V=window.innerHeight,W=12,R=E.left;R+A>M-W&&(R=E.right-A),R=Math.max(W,Math.min(R,M-A-W));let B=E.bottom+8;B+T>V-W&&(B=E.top-T-8),B=Math.max(W,Math.min(B,V-T-W)),q.style.left=`${Math.round(R)}px`,q.style.top=`${Math.round(B)}px`},w=()=>{!n||!e||i||(i=!0,window.requestAnimationFrame(()=>{let y=n.querySelector(".aipkit_model_settings_popover_panel");u(e,y),i=!1}))},h=()=>{n&&(n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),n=null,e=null)},v=(y,q,E)=>{if(!y||!q)return;n&&n!==q&&h(),n=q,e=y,q.classList.add("aipkit-active"),q.setAttribute("aria-hidden","false"),y.setAttribute("aria-expanded","true");let S=q.querySelector(".aipkit_settings_select_picker_search input"),A=q.querySelector(".aipkit_settings_select_picker_list");A&&m(E,A,S?S.value:""),S&&S.offsetParent!==null&&(S.focus(),S.select());let T=q.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(y,T)})},C=(y,q)=>{if(!y||!q)return;let{button:E,popover:S,list:A,search:T}=q;if(E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("click",M=>{if(M.preventDefault(),n===S){h();return}v(E,S,y)}),E.dataset.pickerListenerAttached="true"),S&&S.dataset.overlayListenerAttached!=="true"){S.addEventListener("click",V=>{V.target===S&&h()});let M=S.querySelector(".aipkit_model_settings_popover_close");M&&M.addEventListener("click",V=>{V.preventDefault(),h()}),S.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",M=>{let V=M.target.closest(".aipkit_settings_select_picker_item");if(!V||V.classList.contains("is-disabled"))return;let W=V.dataset.value??"";y.value=W,y.dispatchEvent(new Event("change",{bubbles:!0})),k(y,q.label),m(y,A,T?T.value:""),h()}),A.dataset.pickerListenerAttached="true"),T&&T.dataset.pickerListenerAttached!=="true"&&(T.addEventListener("input",()=>{m(y,A,T.value)}),T.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("change",()=>{k(y,q.label),m(y,A,T?T.value:""),n===S&&h()}),y.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerObserverAttached!=="true"){let M=!1;new MutationObserver(()=>{M||(M=!0,window.requestAnimationFrame(()=>{k(y,q.label),m(y,A,T?T.value:""),M=!1}))}).observe(y,{childList:!0,subtree:!0}),y.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitBulkPickerEscapeBound||(document.addEventListener("keydown",M=>{M.key==="Escape"&&n&&h()}),document.body.dataset.aipkitBulkPickerEscapeBound="true"),document.body.dataset.aipkitBulkPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitBulkPickerRepositionBound="true")};function x(y){if(!y||y.dataset.aipkitBulkPickerInit==="true")return;let q=y.querySelectorAll(r);q.length&&(q.forEach(E=>{if(!E.id||E.dataset.aipkitPickerInit==="true")return;let S=p(E,y);S&&(k(E,S.label),m(E,S.list,S.search?S.search.value:""),C(E,S),E.dataset.aipkitPickerInit="true")}),y.dataset.aipkitBulkPickerInit="true")}function b(){document.querySelectorAll(a).forEach(x)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b):b(),new MutationObserver(b).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initBulkEnhancerSelectPickers=x})();(function(){"use strict";let g=window.aipkit_escapeHtml||(o=>String(o??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),a=["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],r=["{original_title}","{original_content}","{original_focus_keyword}","{original_meta_description}","{original_tags}","{categories}"],n=["{price}","{regular_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{purchase_note}","{product_categories}"],e=o=>o?.querySelector(".aipkit_enhancer_bulk_modal")?.dataset?.postType||"",i=(o,l)=>{let p=[...o==="meta"?r:a];return l==="product"&&p.push(...n),p.filter((f,m)=>p.indexOf(f)===m)},s=(o,l)=>{if(!o)return;let _=o.dataset.label||"Placeholders:",p=o.dataset.copyTitle||"Click to copy";o.innerHTML=`${g(_)} `,l.forEach((f,m)=>{let k=document.createElement("code");k.className="aipkit-placeholder",k.title=p,k.textContent=f,o.appendChild(k),m<l.length-1&&o.appendChild(document.createTextNode(" "))})},c=(o,l)=>{if(!o)return;let _=o.querySelector(".aipkit_bulk_prompt_placeholders");if(!_)return;let p=_.dataset.promptType||"",f=i(p,l);s(_,f)};function t(o){if(!o)return;let l=o.querySelectorAll("[data-aipkit-bulk-popover]");if(!l.length)return;let _=null,p=null,f=!1,m=v=>v?o.querySelector(`#${v}`):null,k=(v,C)=>{if(!v||!C)return;let x=v.getBoundingClientRect(),b=C.getBoundingClientRect(),I=b.width||400,y=b.height||0,q=window.innerWidth,E=window.innerHeight,S=12,A=x.left;A+I>q-S&&(A=x.right-I),A=Math.max(S,Math.min(A,q-I-S));let T=x.bottom+8;T+y>E-S&&(T=x.top-y-8),T=Math.max(S,Math.min(T,E-y-S)),C.style.left=`${Math.round(A)}px`,C.style.top=`${Math.round(T)}px`},u=()=>{!p||!_||f||(f=!0,window.requestAnimationFrame(()=>{let v=_.querySelector(".aipkit_model_settings_popover_panel");k(p,v),f=!1}))},w=()=>{_&&(_.classList.remove("aipkit-active"),_.setAttribute("aria-hidden","true"),p&&p.setAttribute("aria-expanded","false"),_?.dataset?.aipkitBulkPopover==="prompts"&&typeof window.aipkit_enhancer_closeBulkPromptFlyout=="function"&&window.aipkit_enhancer_closeBulkPromptFlyout(),_=null,p=null)},h=v=>{if(!v)return;let C=v.getAttribute("data-aipkit-popover-target"),x=m(C);if(!x)return;_&&_!==x&&w(),_=x,p=v,x.classList.add("aipkit-active"),x.setAttribute("aria-hidden","false"),v.setAttribute("aria-expanded","true");let b=x.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{k(v,b)})};l.forEach(v=>{v.dataset.popoverListenerAttached!=="true"&&(v.addEventListener("click",C=>{if(C.preventDefault(),_&&p===v){w();return}h(v)}),v.dataset.popoverListenerAttached="true")}),o.querySelectorAll(".aipkit_model_settings_popover[data-aipkit-bulk-popover]").forEach(v=>{v.dataset.overlayListenerAttached!=="true"&&(v.addEventListener("click",x=>{x.target===v&&w()}),v.dataset.overlayListenerAttached="true");let C=v.querySelector(".aipkit_model_settings_popover_close");C&&C.dataset.popoverListenerAttached!=="true"&&(C.addEventListener("click",x=>{x.preventDefault(),w()}),C.dataset.popoverListenerAttached="true")}),o.dataset.bulkPromptPopoverEscapeAttached!=="true"&&(document.addEventListener("keydown",v=>{v.key==="Escape"&&_&&w()}),o.dataset.bulkPromptPopoverEscapeAttached="true"),o.dataset.bulkPromptPopoverRepositionAttached!=="true"&&(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),o.dataset.bulkPromptPopoverRepositionAttached="true")}function d(o){if(!o)return;let l=o.querySelectorAll(".aipkit_prompt_edit_btn");if(!l.length)return;let _=e(o),p=null,f=null,m=!1,k=x=>x?o.querySelector(`#${x}`):null,u=(x,b,I)=>{if(!x||!b)return;let y=x.getBoundingClientRect(),q=b.getBoundingClientRect(),E=I?I.getBoundingClientRect():y,S=q.width||580,A=q.height||0,T=window.innerWidth,M=window.innerHeight,V=12,W=E.left-S-12;W<V&&(W=E.right+12),W=Math.max(V,Math.min(W,T-S-V));let R=E.top;R+A>M-V&&(R=M-A-V),R=Math.max(V,R),p.style.left=`${Math.round(W)}px`,p.style.top=`${Math.round(R)}px`},w=()=>{!f||!p||m||(m=!0,window.requestAnimationFrame(()=>{let x=p.querySelector(".aipkit_cw_prompt_panel"),b=f.closest(".aipkit_model_settings_popover_panel");u(f,x,b),m=!1}))},h=()=>{p&&(p.classList.remove("is-open"),p.setAttribute("aria-hidden","true"),f&&f.setAttribute("aria-expanded","false"),p=null,f=null)},v=x=>{let b=x.getAttribute("data-aipkit-flyout-target"),I=k(b);if(!I)return;p&&p!==I&&h(),p=I,f=x,I.classList.add("is-open"),I.setAttribute("aria-hidden","false"),x.setAttribute("aria-expanded","true"),c(I,_);let y=I.querySelector(".aipkit_cw_prompt_panel"),q=x.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(x,y,q)})};l.forEach(x=>{x.dataset.flyoutListenerAttached!=="true"&&(x.addEventListener("click",b=>{if(b.preventDefault(),p&&f===x){h();return}v(x)}),x.dataset.flyoutListenerAttached="true")}),o.querySelectorAll(".aipkit_cw_prompt_library_select").forEach(x=>{let b=x.getAttribute("data-aipkit-prompt-target"),I=b?o.querySelector(`#${b}`):null;I&&I.value.trim()===""&&x.value&&(I.value=x.value),x.dataset.promptLibraryAttached!=="true"&&(x.addEventListener("change",()=>{if(!x.value)return;let y=x.getAttribute("data-aipkit-prompt-target"),q=y?o.querySelector(`#${y}`):null;q&&(q.value=x.value,q.dispatchEvent(new Event("input",{bubbles:!0})))}),x.dataset.promptLibraryAttached="true")}),o.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(x=>{x.dataset.overlayListenerAttached!=="true"&&(x.addEventListener("click",b=>{b.target===x&&h()}),x.dataset.overlayListenerAttached="true")}),o.dataset.bulkPromptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",x=>{x.key==="Escape"&&p&&h()}),o.dataset.bulkPromptFlyoutEscapeAttached="true"),o.dataset.bulkPromptFlyoutClickAttached!=="true"&&(document.addEventListener("click",x=>{if(!p)return;let b=x.target;b.closest(".aipkit_cw_prompt_flyout")||b.closest("[data-aipkit-flyout-target]")||h()}),o.dataset.bulkPromptFlyoutClickAttached="true"),o.dataset.bulkPromptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),o.dataset.bulkPromptFlyoutRepositionAttached="true"),window.aipkit_enhancer_closeBulkPromptFlyout=h}window.aipkit_enhancer_initBulkPromptPopovers=t,window.aipkit_enhancer_initBulkPromptFlyouts=d})();(function(){"use strict";let g=window.aipkit_escapeHtml||(o=>o||""),a=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],r=o=>{let l=parseInt(o,10);if(Number.isFinite(l)){if(l>=1&&l<=a.length)return a[l-1];let _=a.find(p=>p.tokens===l);if(_)return _}return a[1]};function n(o,l){let _=window.aipkit_post_enhancer||{},p,f,m,k,u;o==="openai"?(p=l.querySelector("#aipkit_bulk_openai_vector_store_ids"),f=_.openai_vector_stores||[],m="id",k="name",u="No OpenAI stores found."):o==="pinecone"?(p=l.querySelector("#aipkit_bulk_pinecone_index_name"),f=_.pinecone_indexes||[],m="name",k="name",u="No Pinecone indexes found."):o==="qdrant"&&(p=l.querySelector("#aipkit_bulk_qdrant_collection_name"),f=_.qdrant_collections||[],m="name",k="name",u="No Qdrant collections found."),p&&(p.innerHTML="",f.length>0?p.multiple?f.forEach(w=>{p.add(new Option(g(w[k]),w[m]))}):(p.add(new Option("-- Select --","")),f.forEach(w=>{p.add(new Option(g(w[k]),w[m]))})):(p.add(new Option(u,"")),p.disabled=!0),o==="openai"&&e(l))}function e(o){let l=o.querySelector("[data-aipkit-vector-stores-dropdown]");if(!l)return;let _=l.closest(".aipkit_cw_vector_openai_field"),p=_?_.querySelector(".aipkit_popover_multiselect_select"):null;if(!p)return;let f=l.querySelector(".aipkit_popover_multiselect_btn"),m=l.querySelector(".aipkit_popover_multiselect_label"),k=l.querySelector(".aipkit_popover_multiselect_panel"),u=l.querySelector(".aipkit_popover_multiselect_options"),w=l.dataset.placeholder||"Select stores",h=l.dataset.selectedLabel||"selected",v=()=>{if(!m)return;let y=Array.from(p.options).filter(E=>E.selected&&E.value);if(!y.length){m.textContent=w;return}let q=y.map(E=>E.textContent.trim()).filter(Boolean);if(q.length<=2){m.textContent=q.join(", ");return}m.textContent=`${q.length} ${h}`},C=()=>{if(!u)return;u.innerHTML="";let y=Array.from(p.options),q=y.filter(E=>E.value);if(!q.length){let E=document.createElement("div");E.className="aipkit_popover_multiselect_empty",E.textContent=y[0]?.textContent||"-- No Stores Found --",u.appendChild(E),v();return}q.forEach(E=>{let S=document.createElement("label");S.className="aipkit_popover_multiselect_item";let A=document.createElement("input");A.type="checkbox",A.value=E.value,A.checked=E.selected,A.disabled=E.disabled;let T=document.createElement("span");T.className="aipkit_popover_multiselect_text",T.textContent=E.textContent,S.appendChild(A),S.appendChild(T),u.appendChild(S)}),v()},x=()=>{if(!u){v();return}let y=new Set(Array.from(p.options).filter(q=>q.selected).map(q=>q.value));u.querySelectorAll('input[type="checkbox"]').forEach(q=>{q.checked=y.has(q.value)}),v()},b=y=>{if(!u)return;let q=Array.from(u.querySelectorAll('input[type="checkbox"]:checked'));if(q.length>2){let S=y&&y.target;if(S&&S.checked)S.checked=!1;else{let A=q[q.length-1];A&&(A.checked=!1)}}let E=Array.from(u.querySelectorAll('input[type="checkbox"]:checked')).map(S=>S.value);Array.from(p.options).forEach(S=>{S.selected=E.includes(S.value)}),p.dispatchEvent(new Event("change",{bubbles:!0})),v()},I=y=>{!l||!f||(l.classList.toggle("is-open",y),f.setAttribute("aria-expanded",y?"true":"false"),k&&(k.hidden=!y))};C(),x(),l.dataset.vectorStoreMultiselectAttached||(f&&(f.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation(),I(!l.classList.contains("is-open"))}),f.addEventListener("keydown",y=>{y.key==="Escape"&&I(!1)})),document.addEventListener("click",y=>{l.classList.contains("is-open")&&(l.contains(y.target)||I(!1))}),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",b),u.dataset.listenerAttached="true"),p.dataset.listenerAttached||(p.addEventListener("change",x),p.dataset.listenerAttached="true"),l.dataset.vectorStoreMultiselectAttached="true")}function i(o,l){let _=l.querySelector("#aipkit_bulk_vector_embedding_model");if(!_)return;let p=window.aipkit_post_enhancer||{},f=[];o==="google"?f=p.googleEmbeddingModels||[]:o==="azure"?f=p.azureEmbeddingModels||[]:f=p.openaiEmbeddingModels||[],_.innerHTML="",f.length>0?(_.add(new Option("-- Select Model --","")),f.forEach(m=>{_.add(new Option(g(m.name||m.id),m.id))}),_.disabled=!1):(_.add(new Option("No models found","")),_.disabled=!0)}function s(o){let l=o.querySelector("#aipkit_bulk_vector_store_provider").value,_=o.querySelector(".aipkit_cw_vector_openai_field"),p=o.querySelector(".aipkit_cw_vector_pinecone_field"),f=o.querySelector(".aipkit_cw_vector_qdrant_field"),m=o.querySelector(".aipkit_cw_vector_embedding_config_row");_&&(_.hidden=!0),p&&(p.hidden=!0),f&&(f.hidden=!0),m&&(m.hidden=!0),l==="openai"?(_&&(_.hidden=!1),n("openai",o)):l==="pinecone"?(p&&(p.hidden=!1),m&&(m.hidden=!1),n("pinecone",o),i("openai",o)):l==="qdrant"&&(f&&(f.hidden=!1),m&&(m.hidden=!1),n("qdrant",o),i("openai",o))}function c(o){let l=o.querySelector('input[name="enable_vector_store"]'),_=o.querySelector(".aipkit_cw_vector_store_settings_container"),p=o.querySelector("#aipkit_bulk_vector_store_provider"),f=o.querySelector("#aipkit_bulk_vector_embedding_provider"),m=o.querySelector("#aipkit_bulk_vector_store_top_k"),k=o.querySelector("#aipkit_bulk_vector_store_top_k_value");if(!(!l||!_||!p)){if(l.addEventListener("change",()=>{_.hidden=!l.checked}),p.addEventListener("change",()=>s(o)),f&&f.addEventListener("change",u=>i(u.target.value,o)),m&&k){let u=()=>{k.textContent=m.value};m.addEventListener("input",u),u()}_.hidden=!l.checked,s(o)}}function t(o){let l=o.querySelectorAll(".aipkit_prompt_toggle_card, .aipkit_enhancer_prompt_card");l.length&&l.forEach(_=>{let p=_.querySelector('input[name="bulk_enhance_fields"], input[name="generate_seo_slug"]');if(!p)return;let f=()=>{_.classList.toggle("is-disabled",!p.checked)};f(),p.addEventListener("change",f),_.dataset.promptToggleAttached!=="true"&&(_.addEventListener("click",m=>{m.target.closest(".aipkit_prompt_edit_btn")||m.target.closest("a")||p.disabled||(m.target.closest(".aipkit_switch")&&m.preventDefault(),p.checked=!p.checked,p.dispatchEvent(new Event("change",{bubbles:!0})))}),_.dataset.promptToggleAttached="true")})}function d(o,l){if(!o)return;let _=o.querySelector("#aipkit-enhancer-bulk-config"),p=o.querySelector("#aipkit-enhancer-bulk-progress"),f=o.querySelector("#aipkit_bulk_enhancer_start_btn"),m=o.querySelector("#aipkit_bulk_enhancer_stop_btn"),k=o.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn");if(_&&(_.hidden=!1),p&&(p.hidden=!0),f){f.disabled=!1;let q=f.querySelector(".aipkit_btn-text");q&&(q.textContent="Start")}m&&(m.hidden=!0),k&&(k.hidden=!0);let u=o.querySelectorAll(".aipkit_enhancer_advanced_details");u.length&&u.forEach(q=>{if(q.dataset.toggleListenerAttached==="true")return;let E=q.querySelector("summary");E&&(E.addEventListener("click",S=>{S.preventDefault(),q.hasAttribute("open")?q.removeAttribute("open"):q.setAttribute("open","")}),q.dataset.toggleListenerAttached="true")});let w=o.querySelector(".aipkit_enhancer_settings_popover");w&&w.dataset.checkboxDelegateAttached!=="true"&&(w.addEventListener("click",q=>{let E=q.target?.closest?.(".aipkit_switch");if(E&&w.contains(E)){let T=E.querySelector('input[type="checkbox"]');if(!T||T.disabled)return;q.preventDefault(),T.checked=!T.checked,T.dispatchEvent(new Event("change",{bubbles:!0}));return}let S=q.target.closest(".aipkit_checkbox-label");if(!S||!w.contains(S))return;let A=S.querySelector('input[type="checkbox"]');!A||A.disabled||q.target!==A&&(q.preventDefault(),A.checked=!A.checked,A.dispatchEvent(new Event("change",{bubbles:!0})))}),w.dataset.checkboxDelegateAttached="true");function h(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),o&&(o.classList.remove("aipkit-active"),o.addEventListener("transitionend",()=>o.remove(),{once:!0}),setTimeout(()=>o?.remove(),500))}o.querySelector(".aipkit-modal-close-btn").addEventListener("click",h);let v=o.querySelector("#aipkit_bulk_ai_provider"),C=o.querySelector("#aipkit_bulk_ai_model"),x=o.querySelector("#aipkit_bulk_ai_temperature"),b=o.querySelector("#aipkit_bulk_ai_temperature_value"),I=o.querySelector("#aipkit_bulk_content_max_tokens"),y=o.querySelector("#aipkit_bulk_content_max_tokens_value");if(v&&C&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(v.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(v,C)),window.aipkit_enhancer_populateBulkModels(v,C)),C&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&C.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(o)),x&&b&&x.addEventListener("input",()=>b.textContent=x.value),I&&y){let q=()=>{let E=r(I.value);y.textContent=`${E.words} words`};I.addEventListener("input",q),q()}typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(o),t(o),typeof window.aipkit_enhancer_initBulkPromptPopovers=="function"&&window.aipkit_enhancer_initBulkPromptPopovers(o),typeof window.aipkit_enhancer_initBulkPromptFlyouts=="function"&&window.aipkit_enhancer_initBulkPromptFlyouts(o),o.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(l)}),o.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),o.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),c(o)}window.aipkit_enhancer_attachBulkModalListeners=d})();(function(){"use strict"})();(function(){"use strict";function g(a,r,n){let i=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithError(a.message||i.error_loading_title,i):r?window.aipkit_updateModalWithSuggestions(r,i):window.aipkit_updateModalWithError(i.error_loading_title||"Unknown error occurred.",i)}window.aipkit_handleTitleSuggestionsResult=g})();(function(){"use strict";function g(a,r,n){let i=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorExcerpt(a.message||i.error_loading_excerpt,i):r?window.aipkit_updateModalWithExcerptSuggestions(r,i):window.aipkit_updateModalWithErrorExcerpt(i.error_loading_excerpt||"Unknown error occurred.",i)}window.aipkit_handleExcerptSuggestionsResult=g})();(function(){"use strict";function g(a,r,n){let i=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorMeta(a.message||i.error_loading_meta,i):r?window.aipkit_updateModalWithMetaSuggestions(r,i):window.aipkit_updateModalWithErrorMeta(i.error_loading_meta||"Unknown error occurred.",i)}window.aipkit_handleMetaSuggestionsResult=g})();(function(){"use strict";function g(){}function a(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=a})();(function(){"use strict";function g(r){let n=r.target.closest(".aipkit_enhancer_item"),e=r.target.closest("#aipkit_bulk_enhance_btn");if(n){if(n.classList.contains("aipkit_enhancer_placeholder")){r.target.tagName==="A"&&r.preventDefault();return}r.preventDefault();let i=n.getAttribute("data-post-id"),s=n.getAttribute("data-action-type");if(!i||!s)return;let c=window.aipkit_post_enhancer||{},t=c.text||{};switch(s){case"title":window.aipkit_showLoadingModal(i,t,c),window.aipkit_fetchTitleSuggestions(i,window.aipkit_handleTitleSuggestionsResult,n);break;case"excerpt":window.aipkit_showLoadingExcerptModal(i,t,c),window.aipkit_fetchExcerptSuggestions(i,window.aipkit_handleExcerptSuggestionsResult,n);break;case"meta":window.aipkit_showLoadingMetaModal(i,t,c),window.aipkit_fetchMetaSuggestions(i,window.aipkit_handleMetaSuggestionsResult,n);break;case"tags":window.aipkit_showLoadingTagsModal(i,t,c),window.aipkit_fetchTagsSuggestions(i,window.aipkit_handleTagsSuggestionsResult,n);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${s}'.`);break}}else if(e){r.preventDefault();let i=document.querySelectorAll('input[name="post[]"]:checked');if(i.length===0){alert("Please select at least one post.");return}let s=Array.from(i).map(t=>t.value),c=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(s,c):alert("Error: Bulk processing feature is not available.")}}function a(){let r=document;if(!r)return;let n="data-post-enhancer-listener";document.body.getAttribute(n)||(r.addEventListener("click",g),document.body.setAttribute(n,"true"))}window.aipkit_initEnhancerEventListeners=a})();(function(){"use strict";function g(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(r=>typeof window[r]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),function(){let n=new WeakMap;function e(d){s(d),d.classList.add("aipkit-open")}function i(d){s(d);let o=setTimeout(()=>{d.classList.remove("aipkit-open")},180);n.set(d,o)}function s(d){let o=n.get(d);o&&(clearTimeout(o),n.delete(d))}function c(d){if(!d||d.dataset.aipkitHoverBound==="1")return;d.dataset.aipkitHoverBound="1",d.addEventListener("mouseenter",()=>e(d)),d.addEventListener("mouseleave",()=>i(d));let o=d.querySelector(".aipkit_enhancer_popover");o&&(o.addEventListener("mouseenter",()=>e(d)),o.addEventListener("mouseleave",()=>i(d)))}function t(){document.querySelectorAll(".aipkit_enhancer_action").forEach(c),new MutationObserver(l=>{for(let _ of l)_.addedNodes&&_.addedNodes.length&&_.addedNodes.forEach(p=>{p.nodeType===1&&(p.matches&&p.matches(".aipkit_enhancer_action")&&c(p),p.querySelectorAll&&p.querySelectorAll(".aipkit_enhancer_action").forEach(c))})}).observe(document.body,{childList:!0,subtree:!0})}t()}()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g(),window.aipkit_initPostEnhancer=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function a(){r()}function r(){let n=document.getElementById("aipkit_vpp_embedding_model_select");if(!n){console.error("VPP Embedding Util: Embedding model select not found.");return}let e=window.aipkit_vpp_config||{},i=e.text||{};n.innerHTML=`<option value="">${g(i.select_model||"-- Select Model --")}</option>`;let s=[{key:"openai",label:"OpenAI",models:e.openaiEmbeddingModels||[]},{key:"google",label:"Google",models:e.googleEmbeddingModels||[]},{key:"azure",label:"Azure",models:e.azureEmbeddingModels||[]}],c=!1;s.forEach(t=>{if(!t.models||t.models.length===0)return;c=!0;let d=document.createElement("optgroup");d.label=t.label,t.models.forEach(o=>{if(o&&o.id){let l=document.createElement("option");l.value=o.id,l.textContent=g(o.name||o.id),l.dataset.provider=t.key,d.appendChild(l)}}),d.children.length&&n.appendChild(d)}),c?(n.disabled=!1,n.options.length>1&&(n.selectedIndex=1)):(n.appendChild(new Option(g(i.no_embedding_models||"(No embedding models - Sync in AI Settings)"),"")),n.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=a,window.aipkit_vpp_populateEmbeddingModelSelect=r})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_vpp_openai_vector_store_id"),e=document.getElementById("aipkit_vpp_openai_store_status"),i=window.aipkit_vpp_config||{},s=i.text||{},c=i.openai_vector_stores||[];if(!n){console.error("VPP OpenAI Provider: Store select not found.");return}n.innerHTML="",e&&(e.textContent=""),c.length>0?(n.appendChild(new Option(`-- ${g(s.select_store||"Select Existing Store")} --`,"")),c.forEach(t=>{let d="(Files: N/A)";t.file_counts&&typeof t.file_counts.total=="number"?d=`(${t.file_counts.total} ${t.file_counts.total===1?"File":"Files"})`:t.file_counts&&(d="(Files: ?)");let o=`${g(t.name||t.id)} ${d}`,l=new Option(o,t.id);n.appendChild(l)})):n.appendChild(new Option(g(s.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),n.disabled=c.length===0}async function r(n,e,i,s){let c=window.aipkit_vpp_config||{},t=c.text||{},d=n.length,o=0,l=0,_=0,p=[];try{let f=c.nonce_index_posts;if(!f)throw new Error("Nonce for indexing posts is missing in config.");for(let k of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}o++;let u=document.querySelector(`#post-${k}`),w=u?u.querySelector(".title .row-title"):null,h=w?w.textContent.trim():`Post #${k}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(k,"processing","",h),typeof window.aipkit_vpp_updateProgress=="function"){let C=o/d*100,x=(t.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",o).replace("%2$d",d)+` "${g(h)}"`;window.aipkit_vpp_updateProgress(C,x)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let v={_ajax_nonce:f,post_ids:[k],post_type:s,target_store_id:e,new_store_name_openai:i||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",v),l++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(k,"success","",h)}catch(C){if(_++,p.push({id:k,title:h,error:C.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${k}:`,C),typeof window.aipkit_vpp_updateProgressItem=="function"){let x=C?.message||t.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(k,"error",x,h)}}}let m=`Indexing complete. ${l} successful, ${_} failed.`;window.aipkit_isIndexingStopped&&o<d?m=`Indexing stopped. ${l} successful, ${_} failed.`:_>0&&console.error("Failed Posts:",p),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,_>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${l}/${d}`)}catch(f){console.error("VPP OpenAI Provider: Indexing setup error:",f),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,t.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(f.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),_>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=a,window.aipkit_vpp_startIndexingOpenAI=r})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_vpp_pinecone_target_index_select"),e=document.getElementById("aipkit_vpp_pinecone_index_status"),i=window.aipkit_vpp_config||{},s=i.text||{},c=i.pinecone_indexes||[];if(!n){console.error("VPP Pinecone Provider: Index select not found.");return}n.innerHTML="",e&&(e.textContent=""),c.length>0?(n.appendChild(new Option(`-- ${g(s.select_pinecone_index||"Select Pinecone Index")} --`,"")),c.forEach(t=>{let d=t.name||t.id;if(d){let o=`${g(d)} (${t.dimension||"?"})`;n.appendChild(new Option(o,d))}})):n.appendChild(new Option(g(s.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),n.disabled=c.length===0}async function r(n,e,i,s,c){let t=window.aipkit_vpp_config||{},d=t.text||{},o=n.length,l=0,_=0,p=0,f=[];try{let m=t.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let u of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}l++;let w=document.querySelector(`#post-${u}`),h=w?w.querySelector(".title .row-title"):null,v=h?h.textContent.trim():`Post #${u}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"processing","",v),typeof window.aipkit_vpp_updateProgress=="function"){let x=l/o*100,b=(d.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",l).replace("%2$d",o)+` "${g(v)}"`;window.aipkit_vpp_updateProgress(x,b)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let C={_ajax_nonce:m,post_ids:[u],post_type:c,target_index_id:e,provider:"pinecone",embedding_provider:i,embedding_model:s};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",C),_++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"success","",v)}catch(x){if(p++,f.push({id:u,title:v,error:x.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${u}:`,x),typeof window.aipkit_vpp_updateProgressItem=="function"){let b=x?.message||d.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(u,"error",b,v)}}}let k=`Indexing complete. ${_} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&l<o?k=`Indexing stopped. ${_} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(k,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${_}/${o}`)}catch(m){console.error("VPP Pinecone Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,d.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=a,window.aipkit_vpp_startIndexingPinecone=r})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),e=document.getElementById("aipkit_vpp_qdrant_collection_status"),i=window.aipkit_vpp_config||{},s=i.text||{},c=i.qdrant_collections||[];if(!n){console.error("VPP Qdrant Provider: Collection select not found.");return}n.innerHTML="",e&&(e.textContent=""),c.length>0?(n.appendChild(new Option(`-- ${g(s.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),c.forEach(t=>{let d=t.name||t.id;d&&n.appendChild(new Option(g(d),d))})):n.appendChild(new Option(g(s.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),n.disabled=c.length===0}async function r(n,e,i,s,c){let t=window.aipkit_vpp_config||{},d=t.text||{},o=n.length,l=0,_=0,p=0,f=[];try{let m=t.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let u of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}l++;let w=document.querySelector(`#post-${u}`),h=w?w.querySelector(".title .row-title"):null,v=h?h.textContent.trim():`Post #${u}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"processing","",v),typeof window.aipkit_vpp_updateProgress=="function"){let x=l/o*100,b=(d.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",l).replace("%2$d",o)+` "${g(v)}"`;window.aipkit_vpp_updateProgress(x,b)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let C={_ajax_nonce:m,post_ids:[u],post_type:c,target_collection_name:e,provider:"qdrant",embedding_provider:i,embedding_model:s};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",C),_++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"success","",v)}catch(x){if(p++,f.push({id:u,title:v,error:x.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${u}:`,x),typeof window.aipkit_vpp_updateProgressItem=="function"){let b=x?.message||d.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(u,"error",b,v)}}}let k=`Indexing complete. ${_} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&l<o?k=`Indexing stopped. ${_} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(k,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${_}/${o}`)}catch(m){console.error("VPP Qdrant Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,d.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=a,window.aipkit_vpp_startIndexingQdrant=r})();(function(){"use strict";let g=window.wp?.i18n?.__||function(y){return y},a="#aipkit_vpp_modal",r=["#aipkit_vpp_vector_store_provider","#aipkit_vpp_openai_vector_store_id","#aipkit_vpp_pinecone_target_index_select","#aipkit_vpp_qdrant_target_collection_select","#aipkit_vpp_embedding_model_select"].join(", "),n=null,e=null,i=!1,s=new Set(["aipkit_vpp_vector_store_provider"]),c=y=>!!(y&&y.id&&s.has(y.id)),t=y=>String(y||"").trim().toLowerCase(),d=(y,q)=>{if(!y)return;let E="aipkit_settings_select_picker_icon--";y.classList.forEach(A=>{A.startsWith(E)&&y.classList.remove(A)}),y.classList.remove("is-hidden");let S=t(q);if(!S){y.classList.add("is-hidden");return}y.classList.add(`${E}${S}`)},o=y=>{if(!y)return"";let q=y.getAttribute("data-aipkit-picker-title");if(q)return q;let E=y.id&&document.querySelector(`label[for="${y.id}"]`)||y.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return E?E.textContent.trim():""},l=y=>{if(!y)return"";let q=y.selectedOptions&&y.selectedOptions.length?y.selectedOptions[0]:y.querySelector("option[selected]");if(q)return q.textContent.trim();let E=y.querySelector("option");return E?E.textContent.trim():""},_=y=>({buttonId:`${y}_picker_btn`,labelId:`${y}_picker_label`,popoverId:`${y}_picker_popover`,titleId:`${y}_picker_title`,searchId:`${y}_picker_search`,listId:`${y}_picker_list`}),p=(y,q)=>{if(!y||!y.id||!q)return null;let E=_(y.id),S=q.querySelector(`#${E.buttonId}`);if(!S){if(S=document.createElement("button"),S.type="button",S.id=E.buttonId,S.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",S.setAttribute("data-aipkit-popover-target",E.popoverId),S.setAttribute("aria-controls",E.popoverId),S.setAttribute("aria-expanded","false"),S.dataset.aipkitPopoverPlacement="bottom",c(y)){S.classList.add("aipkit_settings_select_picker_btn--provider");let V=document.createElement("span");V.className="aipkit_settings_select_picker_icon",V.setAttribute("aria-hidden","true"),d(V,y.value),S.appendChild(V)}let T=document.createElement("span");T.className="aipkit_settings_select_picker_label",T.id=E.labelId,T.textContent=l(y)||g("Select","gpt3-ai-content-generator");let M=document.createElement("span");M.className="dashicons dashicons-arrow-down-alt2",M.setAttribute("aria-hidden","true"),S.appendChild(T),S.appendChild(M),y.insertAdjacentElement("beforebegin",S)}S.disabled=y.disabled,y.classList.contains("screen-reader-text")||y.classList.add("screen-reader-text");let A=q.querySelector(`#${E.popoverId}`);if(!A){A=document.createElement("div"),A.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",c(y)&&A.classList.add("aipkit_settings_select_picker_popover--provider"),A.id=E.popoverId,A.setAttribute("aria-hidden","true");let T=document.createElement("div");T.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",T.setAttribute("role","dialog"),T.setAttribute("aria-labelledby",E.titleId);let M=document.createElement("div");M.className="aipkit_model_settings_popover_header";let V=document.createElement("span");V.className="aipkit_model_settings_popover_title",V.id=E.titleId,V.textContent=o(y)||g("Select","gpt3-ai-content-generator");let W=document.createElement("button");W.type="button",W.className="aipkit_model_settings_popover_close",W.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),W.innerHTML='<span class="dashicons dashicons-no-alt"></span>',M.appendChild(V),M.appendChild(W);let R=document.createElement("div");R.className="aipkit_model_settings_popover_body";let B=document.createElement("div");B.className="aipkit_settings_select_picker_search";let $=document.createElement("input");$.type="search",$.id=E.searchId,$.className="aipkit_form-input";let G=o(y),L=G?`Search ${G.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");$.setAttribute("placeholder",L),B.appendChild($);let K=document.createElement("div");K.className="aipkit_settings_select_picker_list",K.id=E.listId,K.setAttribute("role","listbox"),R.appendChild(B),R.appendChild(K),T.appendChild(M),T.appendChild(R),A.appendChild(T),q.appendChild(A),(c(y)||y.dataset.aipkitPickerSearch==="false")&&(B.style.display="none")}return{ids:E,button:S,popover:A,label:q.querySelector(`#${E.labelId}`),search:q.querySelector(`#${E.searchId}`),list:q.querySelector(`#${E.listId}`)}},f=y=>{let q=[];return y&&Array.from(y.children).forEach(S=>{if(S.tagName==="OPTGROUP"){let A=Array.from(S.children).filter(T=>T.tagName==="OPTION").map(T=>({value:T.value,label:T.textContent.trim(),disabled:T.disabled,selected:T.selected}));q.push({groupLabel:S.label||"",options:A})}else S.tagName==="OPTION"&&q.push({groupLabel:"",options:[{value:S.value,label:S.textContent.trim(),disabled:S.disabled,selected:S.selected}]})}),q},m=(y,q,E="")=>{if(!y||!q)return;let S=E.trim().toLowerCase();q.innerHTML="";let A=f(y),T=!1;if(A.forEach(M=>{let V=M.options.filter(W=>S?W.label.toLowerCase().includes(S):!0);if(V.length){if(M.groupLabel){let W=document.createElement("div");W.className="aipkit_settings_select_picker_group_label",W.textContent=M.groupLabel,q.appendChild(W)}V.forEach(W=>{let R=document.createElement("button");if(R.type="button",R.className="aipkit_settings_select_picker_item",R.setAttribute("role","option"),R.dataset.value=W.value,R.dataset.label=W.label,W.disabled&&(R.classList.add("is-disabled"),R.setAttribute("aria-disabled","true")),y.value===W.value?(R.classList.add("is-active"),R.setAttribute("aria-selected","true")):R.setAttribute("aria-selected","false"),c(y)){R.classList.add("aipkit_settings_select_picker_item--provider");let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),d(G,W.value),R.appendChild(G)}let B=document.createElement("span");B.className="aipkit_settings_select_picker_text",B.textContent=W.label;let $=document.createElement("span");$.className="dashicons dashicons-yes aipkit_settings_select_picker_check",R.appendChild(B),R.appendChild($),q.appendChild(R),T=!0})}}),!T){let M=document.createElement("div");M.className="aipkit_settings_select_picker_empty",M.textContent=g(S?"No matches found.":"No options available.","gpt3-ai-content-generator"),q.appendChild(M)}},k=(y,q,E)=>{if(!y||!q)return;let S=l(y);if(q.textContent=S||g("Select","gpt3-ai-content-generator"),E&&(E.disabled=y.disabled),c(y)){let A=E?E.querySelector(".aipkit_settings_select_picker_icon"):null;d(A,y.value)}},u=(y,q)=>{if(!y||!q)return;let E=y.getBoundingClientRect(),S=q.getBoundingClientRect(),A=S.width||320,T=S.height||0,M=window.innerWidth,V=window.innerHeight,W=12,R=E.left;R+A>M-W&&(R=E.right-A),R=Math.max(W,Math.min(R,M-A-W));let B=E.bottom+8;B+T>V-W&&(B=E.top-T-8),B=Math.max(W,Math.min(B,V-T-W)),q.style.left=`${Math.round(R)}px`,q.style.top=`${Math.round(B)}px`},w=()=>{!n||!e||i||(i=!0,window.requestAnimationFrame(()=>{let y=n.querySelector(".aipkit_model_settings_popover_panel");u(e,y),i=!1}))},h=()=>{n&&(n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),n=null,e=null)},v=(y,q,E)=>{if(!y||!q)return;n&&n!==q&&h(),n=q,e=y,q.classList.add("aipkit-active"),q.setAttribute("aria-hidden","false"),y.setAttribute("aria-expanded","true");let S=q.querySelector(".aipkit_settings_select_picker_search input"),A=q.querySelector(".aipkit_settings_select_picker_list");A&&m(E,A,S?S.value:""),S&&S.offsetParent!==null&&(S.focus(),S.select());let T=q.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(y,T)})},C=(y,q)=>{if(!y||!q)return;let{button:E,popover:S,list:A,search:T,label:M}=q;if(E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("click",V=>{if(V.preventDefault(),!E.disabled){if(n===S){h();return}v(E,S,y)}}),E.dataset.pickerListenerAttached="true"),S&&S.dataset.overlayListenerAttached!=="true"){S.addEventListener("click",W=>{W.target===S&&h()});let V=S.querySelector(".aipkit_model_settings_popover_close");V&&V.addEventListener("click",W=>{W.preventDefault(),h()}),S.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",V=>{let W=V.target.closest(".aipkit_settings_select_picker_item");if(!W||W.classList.contains("is-disabled"))return;let R=W.dataset.value??"";y.value=R,y.dispatchEvent(new Event("change",{bubbles:!0})),k(y,M,E),m(y,A,T?T.value:""),h()}),A.dataset.pickerListenerAttached="true"),T&&T.dataset.pickerListenerAttached!=="true"&&(T.addEventListener("input",()=>{m(y,A,T.value)}),T.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("change",()=>{k(y,M,E),m(y,A,T?T.value:""),n===S&&h()}),y.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerObserverAttached!=="true"){let V=!1;new MutationObserver(()=>{V||(V=!0,window.requestAnimationFrame(()=>{k(y,M,E),m(y,A,T?T.value:""),V=!1}))}).observe(y,{childList:!0,subtree:!0}),y.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitVppPickerEscapeBound||(document.addEventListener("keydown",V=>{V.key==="Escape"&&n&&h()}),document.body.dataset.aipkitVppPickerEscapeBound="true"),document.body.dataset.aipkitVppPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitVppPickerRepositionBound="true")};function x(y){if(!y||y.dataset.aipkitVppPickerInit==="true")return;let q=y.querySelectorAll(r);q.length&&(q.forEach(E=>{if(!E.id||E.dataset.aipkitPickerInit==="true")return;let S=p(E,y);S&&(k(E,S.label,S.button),m(E,S.list,S.search?S.search.value:""),C(E,S),E.dataset.aipkitPickerInit="true")}),y.dataset.aipkitVppPickerInit="true")}function b(){document.querySelectorAll(a).forEach(x)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b):b(),new MutationObserver(b).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initVppSelectPickers=x})();(function(){"use strict";let g="aipkit_vpp_modal",a=window.aipkit_escapeHtml||function(h){return h},r=window.aipkit_escapeAttribute||a,n=[],e="",i=!1,s=h=>{if(!h)return"Post";let v=window.aipkit_vpp_postTitles||{};if(v[h])return v[h];let C=document.querySelector(`#post-${h}`),x=C?C.querySelector(".title .row-title")||C.querySelector("strong a")||C.querySelector(".title a")||C.querySelector("a.row-title")||C.querySelector(".column-title strong a")||C.querySelector(".column-title .row-title"):null,b=x?x.textContent.trim():`Post #${h}`;return v[h]=b,window.aipkit_vpp_postTitles=v,b},c=h=>{let v=window.aipkit_vpp_config?.text||{};return{pending:v.status_pending||"Pending",processing:v.status_processing||"Processing",success:v.status_completed||"Completed",error:v.status_failed||"Failed",stopped:v.status_stopped||"Stopped"}[h]||h},t=(h,v)=>{let C=document.createElement("div");C.className="aipkit_vpp_progress_item aipkit_vpp_progress_item--pending",C.dataset.postId=h;let x=document.createElement("div");x.className="aipkit_vpp_progress_item_main";let b=document.createElement("div");b.className="aipkit_vpp_progress_item_title",b.textContent=v;let I=document.createElement("div");I.className="aipkit_vpp_progress_item_message",I.textContent="",I.style.display="none";let y=document.createElement("div");return y.className="aipkit_vpp_progress_item_status",y.textContent=c("pending"),x.appendChild(b),x.appendChild(I),C.appendChild(x),C.appendChild(y),C};function d(h,v){if(document.getElementById(g)){console.warn("VPP Modal UI: Modal already exists.");return}n=h,e=v,i=!1;let x=(window.aipkit_vpp_config||{}).text||{},b="",I=h.length;I===1?b=a(x.items_selected_singular||"You have selected %d item to index.").replace("%d",`<strong>${I}</strong>`):b=a(x.items_selected_plural||"You have selected %d items to index.").replace("%d",`<strong>${I}</strong>`);let y=document.createElement("div");y.id=g,y.className="aipkit-modal-overlay aipkit-active";let q=document.createElement("div");q.className="aipkit-modal-content aipkit_vpp_modal_content",q.innerHTML=`
            <div class="aipkit-modal-header aipkit_vpp_modal_header">
                <div class="aipkit_vpp_header_left">
                    <span class="aipkit_vpp_header_icon" aria-hidden="true">
                        <span class="dashicons dashicons-database"></span>
                    </span>
                    <div class="aipkit_vpp_header_text">
                        <h3 class="aipkit-modal-title">${a(x.modal_title||"Add Content to Vector Store")}</h3>
                        <span class="aipkit_vpp_header_subtitle">${a(x.modal_subtitle||"Index selected content for retrieval")}</span>
                    </div>
                </div>
                <button type="button" class="aipkit-modal-close-btn aipkit_vpp_close_btn" aria-label="${r(x.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body aipkit_vpp_modal_body">
                <div id="aipkit_vpp_status_message" class="aipkit_vpp_status_message" aria-live="polite"></div>

                <div class="aipkit_vpp_selection_card">
                    <span class="aipkit_vpp_selection_text">${b}</span>
                </div>

                <div class="aipkit_vpp_engine_card">
                    <div class="aipkit_enhancer_engine_card">
                        <div class="aipkit_enhancer_engine_fields">
                            <div class="aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_vector_store_provider">${a(x.provider_label||"Provider")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_vector_store_provider" class="aipkit_enhancer_engine_select">
                                            <option value="openai" selected>OpenAI</option>
                                            <option value="pinecone">Pinecone</option>
                                            <option value="qdrant">Qdrant</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_openai_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_openai_vector_store_id">${a(x.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_enhancer_engine_select">
                                            <option value="">${a(x.loading_stores||"Loading stores...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_pinecone_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_pinecone_target_index_select">${a(x.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${a(x.loading_indexes||"Loading indexes...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_qdrant_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_qdrant_target_collection_select">${a(x.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${a(x.loading_indexes||"Loading collections...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_embedding_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_embedding_model_select">${a(x.embedding_label||"Embedding")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_embedding_model_select" class="aipkit_enhancer_engine_select" data-aipkit-picker-search="false">
                                            <option value="">${a(x.select_model||"-- Select Model --")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="aipkit_vpp_progress_area" class="aipkit_vpp_section aipkit_vpp_section--progress" hidden>
                    <div class="aipkit_vpp_section_header">
                        <span class="aipkit_vpp_section_title">${a(x.section_progress_title||"Progress")}</span>
                    </div>
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <div id="aipkit_vpp_progress_text" class="aipkit_vpp_progress_text"></div>
                    <div id="aipkit_vpp_progress_log" class="aipkit_vpp_progress_log" role="list"></div>
                </div>
            </div>
            <div class="aipkit-modal-footer aipkit_vpp_modal_footer">
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${a(x.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" hidden></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                     <span class="aipkit_btn-text">${a(x.stop||"Stop")}</span>
                </button>
            </div>
        `,y.appendChild(q),document.body.appendChild(y),q.addEventListener("click",S=>{let A=S.target;A.closest(".aipkit-modal-close-btn")||A.closest(".aipkit_vpp_modal_close_btn")?l():A.closest("#aipkit_vpp_start_indexing_btn")?w():A.closest("#aipkit_vpp_stop_indexing_btn")&&o()}),y.addEventListener("click",S=>{S.target===y&&l()});let E=document.getElementById("aipkit_vpp_vector_store_provider");E&&(E.addEventListener("change",u),u({target:E}))}function o(){window.aipkit_isIndexingStopped=!0;let h=document.getElementById("aipkit_vpp_stop_indexing_btn"),v=window.aipkit_vpp_config?.text||{};if(h){h.disabled=!0;let C=h.querySelector(".aipkit_btn-text");C&&(C.textContent=v.stopping||"Stopping...")}}function l(){window.aipkit_isIndexingStopped=!0;let h=document.getElementById(g);h&&(h.classList.remove("aipkit-active"),setTimeout(()=>{h.parentNode&&h.parentNode.removeChild(h)},300))}function _(h,v){let C=document.querySelector(`#${g} .aipkit_vpp_progress_bar`),x=document.getElementById("aipkit_vpp_progress_text");C&&(C.style.width=`${Math.max(0,Math.min(100,h))}%`),x&&(x.textContent=v)}function p(h){let v=document.getElementById("aipkit_vpp_progress_log");if(!v)return;v.innerHTML="";let C=document.createDocumentFragment();(h||[]).forEach(x=>{let b=s(x);C.appendChild(t(x,b))}),v.appendChild(C),v.scrollTop=0}function f(h,v,C="",x=""){let b=document.getElementById("aipkit_vpp_progress_log");if(!b)return;let I=`.aipkit_vpp_progress_item[data-post-id="${h}"]`,y=b.querySelector(I);if(!y){let S=x||s(h);y=t(h,S),b.appendChild(y)}y.className=`aipkit_vpp_progress_item aipkit_vpp_progress_item--${v}`;let q=y.querySelector(".aipkit_vpp_progress_item_status"),E=y.querySelector(".aipkit_vpp_progress_item_message");q&&(q.textContent=c(v)),E&&(E.textContent=C||"",E.style.display=C?"":"none"),b.scrollTop=b.scrollHeight}function m(h,v="info"){let C=document.getElementById("aipkit_vpp_status_message");C&&(C.textContent=h,C.className=`aipkit_vpp_status_message aipkit_message-${v}`)}function k(){i=!1;let h=document.getElementById("aipkit_vpp_start_indexing_btn"),v=document.getElementById("aipkit_vpp_stop_indexing_btn"),C=document.querySelectorAll(`#${g} .aipkit-modal-close-btn, #${g} .aipkit_vpp_modal_close_btn`),x=window.aipkit_vpp_config?.text||{};if(h){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(h,x.start_indexing||"Start Indexing"),h.disabled=!1,h.hidden=!1;let I=h.querySelector(".aipkit_spinner");I&&(I.hidden=!0)}if(v){v.hidden=!0,v.disabled=!1;let I=v.querySelector(".aipkit_btn-text");I&&(I.textContent=x.stop||"Stop")}C.forEach(I=>I.disabled=!1);let b=document.getElementById("aipkit_vpp_progress_area");b&&(b.hidden=!1)}function u(h){let v=h.target.value,C=document.getElementById("aipkit_vpp_openai_options"),x=document.getElementById("aipkit_vpp_pinecone_options"),b=document.getElementById("aipkit_vpp_qdrant_options"),I=document.getElementById("aipkit_vpp_embedding_options");C&&(C.hidden=!0),x&&(x.hidden=!0),b&&(b.hidden=!0),I&&(I.hidden=!0),v==="openai"?(C&&(C.hidden=!1),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):v==="pinecone"?(x&&(x.hidden=!1),I&&(I.hidden=!1),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):v==="qdrant"&&(b&&(b.hidden=!1),I&&(I.hidden=!1),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function w(){if(i)return;window.aipkit_isIndexingStopped=!1;let h=document.getElementById("aipkit_vpp_vector_store_provider").value,v=window.aipkit_vpp_config?.text||{},C="",x={post_ids:n,post_type:e,provider:h};if(h==="openai"){if(C=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!C){m(v.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}x.target_store_id=C}else if(h==="pinecone"){if(C=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!C){m(v.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}x.target_index_id=C;let E=document.getElementById("aipkit_vpp_embedding_model_select"),S=E?.selectedOptions&&E.selectedOptions.length?E.selectedOptions[0]:null;if(x.embedding_model=E?E.value:"",x.embedding_provider=S&&S.dataset.provider||"",!x.embedding_provider||!x.embedding_model){m(v.error_no_embedding_config||"Please select an embedding model for Pinecone.","error");return}}else if(h==="qdrant"){if(C=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!C){m(v.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}x.target_collection_name=C;let E=document.getElementById("aipkit_vpp_embedding_model_select"),S=E?.selectedOptions&&E.selectedOptions.length?E.selectedOptions[0]:null;if(x.embedding_model=E?E.value:"",x.embedding_provider=S&&S.dataset.provider||"",!x.embedding_provider||!x.embedding_model){m(v.error_no_embedding_config||"Please select an embedding model for Qdrant.","error");return}}else{m(`Provider ${h} not yet supported for indexing.`,"error");return}i=!0;let b=document.getElementById("aipkit_vpp_start_indexing_btn"),I=document.getElementById("aipkit_vpp_stop_indexing_btn"),y=document.querySelectorAll(`#${g} .aipkit-modal-close-btn, #${g} .aipkit_vpp_modal_close_btn`);if(b&&(b.hidden=!0),I){I.hidden=!1,I.disabled=!1;let E=I.querySelector(".aipkit_btn-text");E&&(E.textContent=v.stop||"Stop")}let q=document.getElementById("aipkit_vpp_progress_area");q&&(q.hidden=!1),typeof window.aipkit_vpp_initProgressLog=="function"&&window.aipkit_vpp_initProgressLog(n),_(0,v.status_preparing||"Preparing..."),h==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(n,C,null,e):h==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(n,C,x.embedding_provider,x.embedding_model,e):h==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(n,C,x.embedding_provider,x.embedding_model,e)}window.aipkit_vpp_showModal=d,window.aipkit_vpp_closeModal=l,window.aipkit_vpp_updateProgress=_,window.aipkit_vpp_initProgressLog=p,window.aipkit_vpp_updateProgressItem=f,window.aipkit_vpp_updateStatus=m,window.aipkit_vpp_resetModalAfterProcessing=k})();(function(){"use strict";let g="aipkit_add_to_vector_store_btn";function r(){let i=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(i.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let s=Array.from(i).map(c=>c.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(s,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function n(){let i=document.getElementById(g);return i&&!i.dataset.vppBound?(i.addEventListener("click",r),i.dataset.vppBound="1",!0):!!(i&&i.dataset.vppBound)}function e(){if(n())return;let i=document.querySelector("#wpbody-content")||document.body,s=Date.now();if(!i)return;let c=new MutationObserver(()=>{(n()||Date.now()-s>15e3)&&c.disconnect()});c.observe(i,{childList:!0,subtree:!0});let t=setInterval(()=>{(n()||Date.now()-s>15e3)&&clearInterval(t)},300)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",e):e()})();})();
