(()=>{(function(){"use strict";function c(i,n){if(!i)return;let t=i.querySelector(".aipkit_btn-text");if(t){t.textContent=n;return}let e=i.querySelector(".aipkit_spinner"),o=Array.from(i.childNodes).find(a=>a.nodeType===Node.TEXT_NODE);o?o.textContent=n+(e?" ":""):i.insertBefore(document.createTextNode(n+(e?" ":"")),i.firstChild),e&&i.appendChild(e)}function r(i,n,t,e=4e3){if(!i)return;let o=i.dataset.baseClass||"aipkit_form-help";i.dataset.baseClass||(i.dataset.baseClass=o),i.messageTimeoutId&&(clearTimeout(i.messageTimeoutId),i.messageTimeoutId=null),i.textContent=t,i.className=o,i.classList.add(`aipkit_form-help-${n}`),i.style.opacity="1",i.style.display="block",i.messageTimeoutId=setTimeout(()=>{i.style.opacity="0",setTimeout(()=>{i.textContent===t&&(i.textContent="",i.className=o,i.style.display="",i.messageTimeoutId=null)},300)},e)}window.aipkit_setButtonText=c,window.aipkit_showTemporaryMessage=r})();(function(){"use strict";function c(i){return i===null||typeof i>"u"?"":String(i).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function r(i){return c(i)}window.aipkit_escapeHtml=c,window.aipkit_escapeAttribute=r})();(function(){"use strict";function c(i){let n=document.createElement("div");if(n.textContent="Copied!",Object.assign(n.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:9999,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)"}),document.body.appendChild(n),i){let{top:t,left:e,width:o}=i.getBoundingClientRect();n.style.top=`${t+window.scrollY+2}px`,n.style.left=`${e+window.scrollX+o+5}px`}else n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateY(0)"}),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateY(-5px)",n.addEventListener("transitionend",()=>n.remove(),{once:!0}),setTimeout(()=>{n.parentNode&&n.remove()},500)},1e3)}async function r(i,n){if(i)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(i),c(n);return}throw new Error("Clipboard API not available")}catch(t){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",t);try{let e=document.createElement("textarea");e.value=i,e.style.position="fixed",e.style.top="-9999px",e.style.left="-9999px",e.style.opacity="0",e.setAttribute("readonly",""),document.body.appendChild(e),e.select(),e.setSelectionRange(0,99999);let o=document.execCommand("copy");if(document.body.removeChild(e),o)c(n);else throw new Error('document.execCommand("copy") failed.')}catch(e){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",e),window.prompt("Please copy the shortcode manually:",i)}}}window.aipkit_copyShortcode=r})();(function(){"use strict";function c(i){let n=Number(i);if(!n||isNaN(n))return"";try{let t=new Date(n*1e3);if(isNaN(t.getTime()))return"";let e=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");return`${e}:${o}:${a}`}catch(t){return console.error("Error formatting timestamp:",i,t),""}}function r(i){if(!i)return"";try{let n=new Date(i.replace(" ","T")+"Z");if(isNaN(n.getTime()))return"";let t=new Date,e=(n.getTime()-t.getTime())/1e3;if(e<0)return"In the past";if(e<60)return"in less than a minute";if(e<3600){let l=Math.round(e/60);return`in ${l} minute${l!==1?"s":""}`}let o=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),s=new Date(n.getFullYear(),n.getMonth(),n.getDate());return s.getTime()===o.getTime()?`Today at ${n.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:s.getTime()===a.getTime()?`Tomorrow at ${n.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${n.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(n){return console.error("Error formatting relative time:",i,n),i}}window.aipkit_formatTimestamp=c,window.aipkit_formatFriendlyFutureDate=r})();(function(){"use strict";function c(r){return!r||typeof r!="string"?"":r.charAt(0).toUpperCase()+r.slice(1)}window.aipkit_ucfirst=c,window.ucfirst=c})();(function(){"use strict";function c(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let r=window.markdownit({html:!1,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&r.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=r,console.log("Markdown Renderer Utility: markdown-it initialized and set globally."),r}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=c})();(function(){"use strict";function c(r){let i=document.querySelector(r);if(!i)return;i.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(t=>{let e=t.id+"_value",o=i.querySelector(`#${CSS.escape(e)}`);o&&(o.textContent=t.value,t.hasAttribute("data-range-listener-attached")||(t.addEventListener("input",function(){o.textContent=this.value}),t.setAttribute("data-range-listener-attached","true")))})}window.aipkit_attachRangeValueHandlers=c})();(function(){"use strict";function c(r){let i=document.querySelector(r);if(!i)return;let n="data-apikey-toggle-listener-attached";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit_api-key-toggle");if(!e)return;let o=e.closest(".aipkit_api-key-wrapper");if(!o)return;let a=o.querySelector(".aipkit_form-input"),s=e.querySelector(".dashicons");!a||!s||(a.type==="password"?(a.type="text",s.classList.remove("dashicons-visibility"),s.classList.add("dashicons-hidden")):(a.type="password",s.classList.remove("dashicons-hidden"),s.classList.add("dashicons-visibility")))}),i.setAttribute(n,"true"))}window.aipkit_initApiKeyToggles=c})();(function(){"use strict";function c(r){let i=document.querySelector(r);if(!i)return;let n="data-restore-icon-listener-attached";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit_restore-default-icon");if(!e)return;let o=e.getAttribute("data-target-input"),a=e.getAttribute("data-default-value");if(!o||a===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",e);return}let s=document.getElementById(o);if(s){if(s.value!==a){s.value=a;let d=new Event("change",{bubbles:!0,cancelable:!0}),p=new Event("blur",{bubbles:!0,cancelable:!0});if(s.dispatchEvent(d),s.dispatchEvent(p),s.type==="range"){let _=document.getElementById(`${o}_value`);_&&(_.textContent=a)}}}else console.warn(`AIPKit Restore Default: Target input element #${o} not found.`)}),i.setAttribute(n,"true"))}window.aipkit_initRestoreDefaultIcons=c})();(function(){"use strict";function c(t){!t||!t.parentNode||t.classList.contains("aipkit_message_fadeout")||(t.classList.add("aipkit_message_fadeout"),t.addEventListener("animationend",()=>{t.parentNode&&t.parentNode.removeChild(t)},{once:!0}),setTimeout(()=>{t&&t.parentNode&&t.parentNode.removeChild(t)},500))}function r(t,e,o){let a=document.getElementById(t);if(!a){console.error(`AIPKit Message Handler: Container #${t} not found.`);return}a.querySelectorAll(".aipkit_settings_message").forEach(m=>{m.dataset.timerId&&clearTimeout(parseInt(m.dataset.timerId,10)),m.remove()});let l=a.querySelector(".aipkit_saving-indicator");l&&l.remove();let d=document.createElement("div");d.className=`aipkit_settings_message aipkit_settings_message-${e}`;let p=e==="success"?"dashicons-yes-alt":e==="error"?"dashicons-warning":"dashicons-info-alt",_=document.createElement("span");_.className=`dashicons ${p}`,_.style.marginRight="5px",d.appendChild(_),d.appendChild(document.createTextNode(` ${o}`));let u=document.createElement("span");u.className="dashicons dashicons-dismiss aipkit_settings_message-close",u.setAttribute("aria-label","Dismiss message"),u.title="Dismiss message",d.appendChild(u),a.appendChild(d);let f=setTimeout(()=>{c(d)},5e3);d.dataset.timerId=f}function i(t){let e=document.getElementById(t);if(!e){console.error(`AIPKit Message Handler: Container #${t} not found for close button init.`);return}let o=`data-close-listener-${t}`;e.getAttribute(o)!=="true"&&(e.addEventListener("click",function(a){let s=a.target.closest(".aipkit_settings_message-close");if(s){let l=s.closest(".aipkit_settings_message");l&&(l.dataset.timerId&&clearTimeout(parseInt(l.dataset.timerId,10)),c(l))}}),e.setAttribute(o,"true"))}function n(t){let e=document.getElementById(t);if(e){let o=e.querySelector(".aipkit_saving-indicator");o&&o.remove(),e.querySelectorAll(".aipkit_settings_message").forEach(s=>{s.dataset.timerId&&clearTimeout(parseInt(s.dataset.timerId,10)),s.remove()})}else console.warn(`AIPKit Message Handler: Container #${t} not found for clearing messages.`)}window.aipkit_showMessage=r,window.aipkit_initMessageCloseButtons=i,window.aipkit_clearStatusMessages=n})();(function(){"use strict";function c(n,t){let e=document.getElementById(n);if(!e){console.error(`AIPKit Saving Indicator: Container #${n} not found.`);return}let o=e.querySelector(".aipkit_saving-indicator");if(t)if(!o)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(n):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),o=document.createElement("span"),o.className="aipkit_saving-indicator",o.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',e.appendChild(o),requestAnimationFrame(()=>{let a=e.querySelector(".aipkit_saving-indicator");a&&a.classList.add("aipkit_active")});else{o.style.display="inline-flex",o.classList.add("aipkit_active");let a=o.querySelector(".aipkit_spinner");a&&(a.style.display="inline-block")}else o&&(o.classList.remove("aipkit_active"),setTimeout(()=>{o&&o.parentNode&&o.remove()},200))}function r(n){i(n);let t=document.createElement("span");t.className="aipkit-title-spinner aipkit_spinner",t.style.display="inline-block",n.parentNode.insertBefore(t,n.nextSibling)}function i(n){let t=n.parentNode.querySelector(".aipkit-title-spinner");t&&t.remove()}window.aipkit_showSavingIndicator=c,window.aipkit_showLinkSpinner=r,window.aipkit_hideLinkSpinner=i})();(function(){"use strict";function c(n){let t=n.textContent;n.textContent="Copied!",n.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{n&&n.classList.contains("aipkit-placeholder--copied")&&(n.textContent=t,n.classList.remove("aipkit-placeholder--copied"))},1500)}function r(n){let t=n.target;if(!t.matches(".aipkit-placeholder"))return;n.preventDefault(),n.stopPropagation();let e=t.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(e).then(()=>{c(t)}).catch(o=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",o)})}function i(){let n=document.body;if(n){let t="data-placeholder-copy-listener-attached";n.getAttribute(t)||(n.addEventListener("click",r),n.setAttribute(t,"true"),console.log("AIPKit Placeholder Copy: Delegated listener attached to document body."))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",i)})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function c(r,i={}){return new Promise((n,t)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return t(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let e=new FormData;e.append("action",r),!Object.prototype.hasOwnProperty.call(i,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&e.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let o in i)Object.prototype.hasOwnProperty.call(i,o)&&(Array.isArray(i[o])?i[o].forEach(a=>{e.append(o+"[]",a)}):e.append(o,i[o]));fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:e,credentials:"same-origin"}).then(o=>o.json()).then(o=>{if(o.success)n(o.data);else{let a=o.data&&o.data.message?o.data.message:"Unknown error";t(new Error(a))}}).catch(o=>{t(o)})})}window.aipkit_apiRequest=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_modulesMenu");if(r){let o=r.querySelector(".aipkit_dropdown-menu");r.addEventListener("click",function(a){a.stopPropagation(),r.classList.toggle("aipkit_show-menu"),o&&(o.style.display=r.classList.contains("aipkit_show-menu")?"block":"none")}),o&&o.addEventListener("click",function(a){a.stopPropagation()})}let i=document.getElementById("aipkit_top_nav"),n=document.querySelector(".aipkit_mobile-nav-toggle"),t=document.getElementById("aipkit_nav_links_container");n&&i&&t&&(n.addEventListener("click",function(o){o.stopPropagation(),i.classList.toggle("aipkit_nav-open");let a=i.classList.contains("aipkit_nav-open");n.setAttribute("aria-expanded",a.toString()),t.style.display=a?"flex":"none"}),t.addEventListener("click",function(o){o.target.closest(".aipkit_nav-item")&&i.classList.contains("aipkit_nav-open")&&(i.classList.remove("aipkit_nav-open"),n.setAttribute("aria-expanded","false"),t.style.display="none")})),document.addEventListener("click",function(o){if(r&&r.classList.contains("aipkit_show-menu")){let a=r.querySelector(".aipkit_dropdown-menu");r.contains(o.target)||(r.classList.remove("aipkit_show-menu"),a&&(a.style.display="none"))}i&&t&&i.classList.contains("aipkit_nav-open")&&(i.contains(o.target)||(i.classList.remove("aipkit_nav-open"),n&&n.setAttribute("aria-expanded","false"),t.style.display="none"))});let e=document.getElementById("aipkit_modulesMenuMobile");if(e){e.addEventListener("click",function(a){a.stopPropagation(),e.classList.toggle("aipkit_show-menu")});let o=e.querySelector(".aipkit_dropdown-menu");o&&o.addEventListener("click",function(a){a.stopPropagation()})}}window.aipkit_initSettingsMenus=c})();(function(){"use strict";let c={settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",addons:"aipkit_initAddons",logs:"aipkit_initLogs","user-credits":"aipkit_initUserCredits","image-generator":"aipkit_initImageGenerator","ai-training":"aipkit_initAiTraining","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"};async function r(i,n,t){let e={};typeof n=="function"?t=n:typeof n=="object"&&n!==null&&(e=n),document.querySelectorAll(".aipkit_module-link").forEach(p=>p.classList.remove("aipkit_active"));let a=document.querySelector(`.aipkit_module-link[data-module="${i}"]`);a&&a.classList.add("aipkit_active");let s=document.getElementById("aipkit_module-container");if(!s)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof t=="function"&&t(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));let l=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",i):`Loading ${i}...`;if(s.innerHTML=`
            <div class="aipkit_container aipkit_loading-placeholder">
                <div class="aipkit_container-body">
                    <p style="text-align: center; padding: 30px;">
                        <span class="aipkit_spinner"
                            style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                        </span>
                        ${l}
                    </p>
                </div>
            </div>
        `,typeof window.aipkit_apiRequest!="function"){let p="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${i}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(s,i,p),typeof t=="function"&&t(new Error(p)),Promise.reject(new Error(p))}let d={module:i,...e};try{let p=await window.aipkit_apiRequest("aipkit_dashboard_load_module",d);if(!p||typeof p.html!="string")throw new Error('Missing or invalid "html" in response data');s.innerHTML=p.html,i==="chatbot"&&p.openaiVectorStores&&(window.aipkit_chat_config?(window.aipkit_chat_config.openaiVectorStores=p.openaiVectorStores,console.log("AIPKit Loader: Updated aipkit_chat_config.openaiVectorStores for chatbot module.")):console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let _=c[i];if(_&&typeof window[_]=="function")try{console.log(`AIPKit Loader: Calling initializer window.${_}() for module '${i}'.`),window[_]()}catch(u){let f=`Error initializing ${i} module scripts.`;return console.error(`AIPKit Loader: Error executing initializer '${_}':`,u),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(s,i,f+` (Details: ${u.message})`),typeof t=="function"&&t(new Error(f+` (Details: ${u.message})`)),Promise.reject(new Error(f+` (Details: ${u.message})`))}else _&&console.log(`AIPKit Loader: No specific initializer function window.${_} defined for module '${i}'.`);return typeof t=="function"&&t(),Promise.resolve()}catch(p){return console.error(`AIPKit Loader: Module loading error for '${i}':`,p),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(s,i,p.message),typeof t=="function"&&t(p),Promise.reject(p)}}window.aipkit_loadModule=r})();(function(){"use strict";function c(r,i,n){if(!r)return;let t=window.aipkit_dashboard?.text||{},e=t.errorLoadingModuleTitle||"Error Loading Module",o=t.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",a=t.errorDetails||"Details:",s=o.replace("%s",i);r.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${e}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${s}</p>
                    <p><strong>${a}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${n||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_modulesMenu");if(!r)return;let i=r.querySelector(".aipkit_dropdown-menu");i&&(i.addEventListener("change",function(n){let t=n.target;if(t.matches&&t.matches(".aipkit_module-toggle")){let e=i.querySelectorAll(".aipkit_module-toggle");e.forEach(u=>u.disabled=!0);let o=t.getAttribute("data-module"),a=t.getAttribute("data-option-key"),s=t.getAttribute("data-icon"),l=t.getAttribute("data-label"),d=t.checked,p=document.querySelector(`.aipkit_module-link[data-module="${o}"]`);d?p?p.style.display="":console.log(`Module Toggle: Enabling '${o}'. Nav link will appear on refresh if needed.`):p&&(p.style.display="none");let _={moduleKey:a,enabled:d?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),t.checked=!d,p&&(p.style.display=d?"none":""),e.forEach(u=>u.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",_).then(()=>{console.log(`Module Toggle: '${o}' status updated successfully.`)}).catch(u=>{console.error("Error updating module setting:",u.message),alert(`Error updating module setting: ${u.message}`),t.checked=!d,p&&(p.style.display=d?"none":"")}).finally(()=>{e.forEach(u=>u.disabled=!1)})}}),console.log("AIPKit Module Toggles: Initialized."))}window.aipkit_initModuleToggles=c})();(function(){"use strict";function c(){let r=document.querySelectorAll(".aipkit_tab");r.forEach(i=>{i.dataset.tabListenerAttached!=="true"&&(i.addEventListener("click",function(){r.forEach(o=>o.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),document.querySelectorAll(".aipkit_tab-content").forEach(o=>o.classList.remove("aipkit_active"));let t=this.getAttribute("data-tab"),e=document.getElementById(t+"-content");e&&e.classList.add("aipkit_active")}),i.dataset.tabListenerAttached="true")})}window.aipkit_initializeTabs=c})();(function(){"use strict";function c(){let t=document.getElementById("aipkit_addons_container");if(!t){console.warn("AIPKit Addons: Container #aipkit_addons_container not found for event delegation.");return}let e="data-addon-listeners-attached";if(t.getAttribute(e)){console.log("AIPKit Addons: Listeners already attached."),n();return}t.addEventListener("click",function(o){let a=o.target.closest(".aipkit_addon_toggle_btn"),s=o.target.closest(".aipkit_filter_link");a?r(a):s&&i(s)}),t.setAttribute(e,"true"),console.log("AIPKit Addons: Toggle and filter listeners initialized via delegation (aipkit_initAddons)."),n()}function r(t){if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Addons: API request function missing."),alert("Error: Cannot update addon status.");return}let e=t.getAttribute("data-addon-key"),o=t.getAttribute("data-active")==="1",a=o?"0":"1",s=t.closest(".aipkit_stat-card"),l=s?s.querySelector(".aipkit_addon_status_msg"):null,d=t.querySelector(".aipkit_btn-text"),p=t.querySelector(".aipkit_spinner");if(!e||!s||!l||!d||!p){console.warn("AIPKit Addons: Missing required elements for toggle button:",t);return}t.disabled=!0,p.style.display="inline-block";let _=d.textContent;d.textContent=o?"Deactivating...":"Activating...",l.textContent="",l.className="aipkit_addon_status_msg",window.aipkit_apiRequest("aipkit_update_addon_status",{addonKey:e,active:a}).then(u=>{let f=o;t.setAttribute("data-active",a),s.setAttribute("data-status",a==="1"?"active":"inactive"),t.classList.toggle("aipkit_btn-primary",f),t.classList.toggle("aipkit_btn-secondary",!f),d.textContent=a==="1"?"Deactivate":"Activate",l.textContent=u.message||"Status updated!",l.style.color="green",setTimeout(()=>{l.textContent="",l.style.color=""},3e3),n()}).catch(u=>{console.error("Error updating addon status:",u),d.textContent=_,l.textContent="Error: "+(u.message||"Could not update status."),l.style.color="red",setTimeout(()=>{l.textContent="",l.style.color=""},5e3)}).finally(()=>{t.disabled=!1,p.style.display="none"})}function i(t){if(t.classList.contains("aipkit_active"))return;let e=t.closest(".aipkit_filter_group");e&&(e.querySelectorAll(".aipkit_filter_link").forEach(o=>o.classList.remove("aipkit_active")),t.classList.add("aipkit_active"),n())}function n(){let t=document.getElementById("aipkit_addons_container");if(!t)return;let e=t.querySelector('.aipkit_filter_group[data-filter-group="category"] .aipkit_filter_link.aipkit_active'),o=e?e.getAttribute("data-filter-value"):"all",a=document.getElementById("aipkit_addons_grid"),s=document.getElementById("aipkit_no_addons_message");if(!a||!s)return;let l=a.querySelectorAll(".aipkit_stat-card"),d=0;l.forEach(p=>{let u=(p.getAttribute("data-categories")||"").split(" ").filter(m=>m);o==="all"||u.includes(o)?(p.classList.remove("aipkit_hidden"),d++):p.classList.add("aipkit_hidden")}),s.style.display=d===0?"block":"none"}window.aipkit_initAddons=c})();document.addEventListener("DOMContentLoaded",function(){typeof window.aipkit_initSettingsMenus=="function"?window.aipkit_initSettingsMenus():console.error("AIPKit Main: aipkit_initSettingsMenus function not found."),typeof window.aipkit_initModuleToggles=="function"?window.aipkit_initModuleToggles():console.error("AIPKit Main: aipkit_initModuleToggles function not found.");let c=document.getElementById("aipkit_top_nav"),r=document.querySelector(".aipkit_mobile-nav-toggle");r&&c&&r.addEventListener("click",function(){c.classList.toggle("aipkit_nav-open")});let i=document.getElementById("aipkit_migration_notice");if(i){let o=i.querySelector(".aipkit_notification_bar__close");o&&o.addEventListener("click",()=>{i.style.display="none"});let a=document.getElementById("aipkit_dismiss_migration_notice_btn");a&&a.addEventListener("click",()=>{if(typeof window.aipkit_apiRequest!="function"){alert("Error: API function missing.");return}a.disabled=!0,a.textContent="Dismissing...",window.aipkit_apiRequest("aipkit_dismiss_migration_notice").then(()=>{i.style.display="none"}).catch(s=>{alert("Error dismissing notice: "+s.message),a.disabled=!1,a.textContent="Dismiss Forever"})})}let e=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(e)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let o=["settings","chatbot","content-writer","ai-forms","image-generator","ai-training","addons"],a=Array.from(document.querySelectorAll(".aipkit_module-link")),s=null;for(let l=0;l<o.length;l++){let d=o[l];if(a.find(_=>_.getAttribute("data-module")===d&&_.offsetParent!==null)){s=d;break}}if(!s){let l=a.find(d=>d.offsetParent!==null);l&&(s=l.getAttribute("data-module"))}if(s)console.log(`AIPKit Main: Loading initial module '${s}'.`),window.aipkit_loadModule(s);else if(console.warn("AIPKit Main: No visible modules found to load initially."),a.find(d=>d.getAttribute("data-module")==="settings"))console.log("AIPKit Main: Fallback - Loading 'settings' module."),window.aipkit_loadModule("settings");else{let d=document.getElementById("aipkit_module-container");d&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(d,"initial","No modules enabled or accessible. Please activate modules via the top-right menu or check permissions."):d&&(d.innerHTML='<p style="text-align:center; padding: 30px;">No modules enabled. Activate modules via the top-right menu.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!e){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let o=document.getElementById("aipkit_module-container");o&&(o.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function c(){let r={},i=document.getElementById("aipkit_settings_container");if(!i)return r;let n=document.getElementById("aipkit_provider"),t=n?n.value:"OpenAI",e=t.toLowerCase();return i.querySelectorAll("input, select, textarea").forEach(a=>{if(a.name&&a.closest(".aipkit_form-group, .aipkit_settings-section, .aipkit_accordion-content")){let s=!1,l=a.closest(".aipkit_accordion-content"),d=a.closest(".aipkit_model_field, .aipkit_advanced_settings_provider");if((l&&l.classList.contains("aipkit_active")||d&&d.style.display!=="none"||!l&&!d&&a.offsetParent!==null)&&(s=!0),!s)return;let p=a.name.toLowerCase(),_=a.name==="provider",u=["max_completion_tokens","temperature","top_p"].includes(a.name),f=p.startsWith(e+"_")||d&&d.dataset.provider===t||d&&d.dataset.providerSetting===t,m=p.startsWith("safety_")&&e==="google",g=a.name==="openai_store_conversation"||a.name==="openai_expiration_policy",k=a.name==="public_api_key",w=["banned_words","banned_words_message","banned_ips","banned_ips_message"].includes(a.name),b=["openai_moderation_enabled","openai_moderation_message"].includes(a.name),y=["consent_title","consent_message","consent_button"].includes(a.name),h=["elevenlabs_api_key","elevenlabs_voice_id","elevenlabs_model_id"].includes(a.name),v=["pinecone_api_key","pinecone_default_index"].includes(a.name),S=["qdrant_api_key","qdrant_url","qdrant_default_collection"].includes(a.name),I=["pexels_api_key"].includes(a.name),E=["pixabay_api_key"].includes(a.name),P=["replicate_api_key"].includes(a.name),T=["enhancer_editor_integration"].includes(a.name),x=["semantic_search_vector_provider","semantic_search_target_id","semantic_search_embedding_provider","semantic_search_embedding_model","semantic_search_num_results","semantic_search_no_results_text"].includes(a.name);(_||u||f||m||g||k||w||b||y||h||v||S||I||E||P||T||x)&&(a.type==="checkbox"?r[a.name]=a.checked?"1":"0":r[a.name]=a.value)}}),r}window.aipkit_getCurrentFormData=c})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function c(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let r=window.aipkit_getCurrentFormData();if(JSON.stringify(r)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let i="aipkit_settings_messages";window.aipkit_showSavingIndicator(i,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",r),window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"success","Settings saved!"),window.aipkit_lastSavedData=r}catch(n){window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"error","Save failed: "+n.message),console.error("AIPKit Auto-Save Error:",n)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=c})();(function(){"use strict";function c(){let i=document.getElementById("aipkit_settings_container");if(!i)return;let n="data-autosave-listener-attached";i.getAttribute(n)||(i.addEventListener("change",function(t){let e=t.target;e.matches(".aipkit_autosave_trigger")&&e.id!=="aipkit_provider"&&(e.tagName.toLowerCase()==="select"||e.type==="checkbox"||e.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),i.addEventListener("blur",function(t){let e=t.target;if(e.matches(".aipkit_autosave_trigger")&&e.id!=="aipkit_provider"){let o=e.tagName.toLowerCase();(o==="input"||o==="textarea")&&e.type!=="range"&&e.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),i.setAttribute(n,"true"),console.log("AIPKit Settings Autosave: Listeners attached."))}function r(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=c,window.aipkit_updateLastSavedData=r})();(function(){"use strict";function c(i){try{return new Date(i+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return i}}function r(i){return typeof i!="number"?i:i.toLocaleString()}window.aipkit_formatChartDate=c,window.aipkit_formatChartNumber=r})();(function(){"use strict";let c=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],r="#B0BEC5",i={};function n(e){i={};let o=0;e.forEach(a=>{if(a==="Other")i[a]=r;else{let s;do s=c[o%c.length],o++;while(s===r&&c.length>1);i[a]=s}})}function t(e){return i[e]||"#cccccc"}window.aipkit_assignModuleColors=n,window.aipkit_getModuleColor=t})();(function(){"use strict";function c(t,e){if(!e||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let o=t.target,a=o.getAttribute("data-date"),s=o.getAttribute("data-module"),l=parseInt(o.getAttribute("data-value"),10),d=parseInt(o.getAttribute("data-daily-total"),10),p=window.aipkit_getModuleColor(s),_=s?r(s.replace(/[-_]/g," ")):"Unknown";e.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(a)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${p}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${_}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(l)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(d)} tokens)</span>
        `,e.classList.add("aipkit_active"),i(t,e)}function r(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function i(t,e){if(!e)return;let o=e.parentElement;if(!o)return;let a=o.getBoundingClientRect(),s=t.clientX-a.left,l=t.clientY-a.top,d=e.offsetWidth,p=e.offsetHeight,_=s+15,u=l-p-10;_+d>a.width-5&&(_=s-d-15),_<5&&(_=5),u<5&&(u=l+15),u+p>a.height-5&&(u=a.height-p-5),e.style.left=`${_}px`,e.style.top=`${u}px`,e.style.transform="translate(0, 0)"}function n(t){t&&t.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=c,window.aipkit_moveChartTooltip=i,window.aipkit_hideChartTooltip=n})();(function(){"use strict";let c="http://www.w3.org/2000/svg";function r(n,t){if(n.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),n.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let e=Object.keys(t);if(e.length===0){n.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let o=new Set;e.forEach(T=>{Object.keys(t[T]).forEach(x=>o.add(x))});let a=Array.from(o);a.sort((T,x)=>{if(T==="Other")return 1;if(x==="Other")return-1;let A=C=>C?i(C.replace(/[-_]/g," ")):"Unknown";return A(T).localeCompare(A(x))}),window.aipkit_assignModuleColors(a);let s=1;e.forEach(T=>{let x=Object.values(t[T]).reduce((A,C)=>A+C,0);x>s&&(s=x)}),s=s*1.05;let l=e.length,d=250,p=a.length>0?Math.max(40,Math.ceil(a.length/3)*20):0,_={top:20,right:20,bottom:30+p,left:50},u=n.clientWidth-_.left-_.right,f=d-_.top-_.bottom,m=Math.max(1,u/l*.8),g=Math.max(0,u/l*.2),k=document.createElementNS(c,"svg");k.setAttribute("viewBox",`0 0 ${n.clientWidth} ${d}`),k.setAttribute("preserveAspectRatio","xMidYMid meet"),k.setAttribute("class","aipkit_token_usage_chart_svg"),k.setAttribute("aria-label","Token usage per module per day chart");let w=document.createElementNS(c,"g");w.setAttribute("transform",`translate(${_.left}, ${_.top})`),k.appendChild(w);let b=document.createElement("div");b.className="aipkit_chart_tooltip",n.style.position="relative",n.appendChild(b);let y=document.createElementNS(c,"g");y.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),w.appendChild(y);let h=document.createElementNS(c,"line");h.setAttribute("x1",0),h.setAttribute("y1",0),h.setAttribute("x2",0),h.setAttribute("y2",f),y.appendChild(h);let v=5;for(let T=0;T<v;T++){let x=Math.round(s*(T/(v-1))),A=f-f*(T/(v-1)),C=document.createElementNS(c,"text");C.setAttribute("x",-5),C.setAttribute("y",A+3),C.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),C.textContent=window.aipkit_formatChartNumber(x),y.appendChild(C);let q=document.createElementNS(c,"line");q.setAttribute("x1",0),q.setAttribute("y1",A),q.setAttribute("x2",u),q.setAttribute("y2",A),q.setAttribute("class","aipkit_chart_grid_line"),w.insertBefore(q,w.firstChild)}let S=document.createElementNS(c,"g");S.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),S.setAttribute("transform",`translate(0, ${f})`),w.appendChild(S);let I=document.createElementNS(c,"line");I.setAttribute("x1",0),I.setAttribute("y1",0),I.setAttribute("x2",u),I.setAttribute("y2",0),S.appendChild(I);let E=Math.max(1,Math.ceil(l/(u/60)));e.forEach((T,x)=>{if(x%E===0||x===l-1){let A=x*(m+g)+m/2+g/2,C=document.createElementNS(c,"text");C.setAttribute("x",A),C.setAttribute("y",_.bottom-p-10),C.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),C.textContent=window.aipkit_formatChartDate(T),S.appendChild(C)}});let P=document.createElementNS(c,"g");if(w.appendChild(P),e.forEach((T,x)=>{let A=t[T],C=f,q=0;a.filter(L=>A[L]>0).forEach(L=>{let $=A[L]||0;q+=$;let D=$/s*f;C-=D;let B=x*(m+g)+g/2,M=document.createElementNS(c,"rect");M.setAttribute("x",B),M.setAttribute("y",C),M.setAttribute("width",m),M.setAttribute("height",Math.max(.1,D)),M.setAttribute("class","aipkit_chart_bar"),M.setAttribute("fill",window.aipkit_getModuleColor(L)),M.setAttribute("data-date",T),M.setAttribute("data-module",L),M.setAttribute("data-value",$),M.setAttribute("data-daily-total",0),M.addEventListener("mouseenter",F=>window.aipkit_showStackedTooltip(F,b)),M.addEventListener("mousemove",F=>window.aipkit_moveChartTooltip(F,b)),M.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(b)),P.appendChild(M)}),P.querySelectorAll(`rect[data-date="${T}"]`).forEach(L=>L.setAttribute("data-daily-total",q))}),a.length>0){let T=document.createElementNS(c,"g");T.setAttribute("class","aipkit_chart_legend"),T.setAttribute("transform",`translate(0, ${f+_.bottom-p+5})`),w.appendChild(T);let x=0,A=0,C=20,q=u,N=35;a.forEach(O=>{let L=i(O.replace(/[-_]/g," ")),D=L.length*7+25+N;x>0&&x+D>q&&(x=0,A+=C);let B=document.createElementNS(c,"g");B.setAttribute("transform",`translate(${x}, ${A})`);let M=document.createElementNS(c,"rect");M.setAttribute("width",10),M.setAttribute("height",10),M.setAttribute("y",-5),M.setAttribute("fill",window.aipkit_getModuleColor(O)),B.appendChild(M);let F=document.createElementNS(c,"text");F.setAttribute("x",15),F.setAttribute("y",0),F.setAttribute("class","aipkit_chart_legend_label"),F.textContent=L,B.appendChild(F),T.appendChild(B),x+=D})}n.appendChild(k)}function i(n){return n?n.charAt(0).toUpperCase()+n.slice(1):""}window.aipkit_renderTokenUsageChart=r})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_token_usage_chart_container");if(!r){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let i=r.querySelector(".aipkit_chart_loading_placeholder"),n=r.querySelector(".aipkit_chart_error_placeholder"),t=r.querySelector(".aipkit_chart_nodata_placeholder");n&&(n.style.display="none"),t&&(t.style.display="none"),i&&(i.style.display="flex"),window.aipkit_apiRequest("aipkit_get_token_usage_chart_data").then(e=>{if(i&&(i.style.display="none"),e&&e.daily_token_data){let o=e.daily_token_data;if(Object.values(o).some(s=>Object.values(s).some(l=>l>0)))window.aipkit_renderTokenUsageChart(r,o);else if(t)t.style.display="flex";else{let s=document.createElement("div");s.className="aipkit_chart_nodata_placeholder",s.textContent=window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.",r.innerHTML="",r.appendChild(s)}}else throw new Error("Invalid data received for chart.")}).catch(e=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",e),i&&(i.style.display="none"),n)n.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${e.message})`,n.style.display="flex";else{let o=document.createElement("div");o.className="aipkit_chart_error_placeholder",o.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${e.message})`,r.innerHTML="",r.appendChild(o)}})}window.aipkit_loadTokenUsageChart=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_openai_model");if(!i){console.warn("OpenAI Sync: Select element #aipkit_openai_model not found.");return}let n=i.value;if(i.innerHTML="",!r||Object.keys(r).length===0){i.appendChild(new Option("No models found.",""));return}let t=!1,e=["GPT-4o","GPT-4 Turbo","GPT-4","GPT-3.5","Fine-tuned","Other"],o=Object.keys(r);if(e.filter(s=>o.includes(s)).concat(o.filter(s=>!e.includes(s)).sort()).forEach(s=>{let l=r[s]||[];if(l.length===0)return;let d=document.createElement("optgroup");d.label=s,l.sort((p,_)=>(p.name||p.id||"").localeCompare(_.name||_.id||"")),l.forEach(p=>{let _=new Option(p.name||p.id,p.id);p.id===n&&(_.selected=!0,t=!0),d.appendChild(_)}),i.appendChild(d)}),!t&&n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let s=new Option(n+" (manual)",n,!1,!0),l=i.querySelector('optgroup[label="Other"]');l?l.appendChild(s):i.insertBefore(s,i.firstChild),i.value=n,t=!0}if(!t&&i.options.length>0&&i.selectedIndex===-1){let s=-1;for(let l=0;l<i.options.length;l++)if(!i.options[l].disabled&&i.options[l].value){s=l;break}i.selectedIndex=s!==-1?s:0}}window.aipkit_updateOpenAIModels=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_openrouter_model");if(!i){console.warn("OpenRouter Sync: Select element #aipkit_openrouter_model not found.");return}let n=i.value;if(i.innerHTML="",!r||!r.length){i.appendChild(new Option("No models found.",""));return}let t=!1,e={};if(r.forEach(a=>{let s=a.id.split("/"),l=(s.length>1?s[0]:"other").toLowerCase();e[l]||(e[l]=[]),e[l].push(a)}),Object.keys(e).sort().forEach(a=>{let s=document.createElement("optgroup");s.label=a.charAt(0).toUpperCase()+a.slice(1),e[a].sort((l,d)=>(l.name||"").localeCompare(d.name||"")),e[a].forEach(l=>{let d=new Option(l.name,l.id);l.id===n&&(d.selected=!0,t=!0),s.appendChild(d)}),i.appendChild(s)}),!t&&n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let a=new Option(n+" (manual)",n,!1,!0);i.insertBefore(a,i.firstChild),i.value=n,t=!0}if(!t&&i.options.length>0&&i.selectedIndex===-1){let a=-1;for(let s=0;s<i.options.length;s++)if(!i.options[s].disabled&&i.options[s].value){a=s;break}i.selectedIndex=a!==-1?a:0}}window.aipkit_updateOpenRouterModels=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_google_model");if(!i){console.warn("Google Sync: Select element #aipkit_google_model not found.");return}let n=i.value;if(i.innerHTML="",!r||!r.length){i.appendChild(new Option("No models found.",""));return}let t=!1;if(r.sort((e,o)=>(e.name||e.id||"").localeCompare(o.name||o.id||"")),r.forEach(e=>{let o=e.id||"",a=e.name||o;if(!o)return;let s=new Option(a,o);(o===n||`models/${o}`===n)&&(s.selected=!0,t=!0),i.appendChild(s)}),!t&&n){let e=n.startsWith("models/")?n.substring(7):n;if(!i.querySelector(`option[value="${CSS.escape(e)}"]`)){let o=e,a=new Option(o+" (manual)",n,!1,!0);i.insertBefore(a,i.firstChild),i.value=n,t=!0}}if(!t&&i.options.length>0&&i.selectedIndex===-1){let e=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){e=o;break}i.selectedIndex=e!==-1?e:0}}window.aipkit_updateGoogleModels=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_azure_deployment");if(!i){console.warn("Azure Sync: Select element #aipkit_azure_deployment not found.");return}let n=i.value;if(i.innerHTML="",!r||!r.length){if(i.appendChild(new Option("No deployments found.","")),n){let e=new Option(n+" (manual)",n,!1,!0);i.appendChild(e),i.value=n}return}let t=!1;if(r.sort((e,o)=>(e.id||"").localeCompare(o.id||"")),r.forEach(e=>{let o=e.id||"",a=e.name||o;if(!o)return;let s=o+(a&&a!==o?` (model: ${a})`:""),l=new Option(s,o);o===n&&(l.selected=!0,t=!0),i.appendChild(l)}),!t&&n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let e=new Option(n+" (not in synced list)",n,!1,!0);i.appendChild(e),i.value=n,t=!0}if(!t&&i.options.length>0&&i.selectedIndex===-1){let e=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){e=o;break}i.selectedIndex=e!==-1?e:0}}window.aipkit_updateAzureDeployments=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_deepseek_model");if(!i){console.warn("DeepSeek Sync: Select element #aipkit_deepseek_model not found.");return}let n=i.value;if(i.innerHTML="",!r||!r.length){i.appendChild(new Option("No models found.",""));return}let t=!1;if(r.sort((e,o)=>(e.name||e.id||"").localeCompare(o.name||o.id||"")),r.forEach(e=>{let o=e.id||"",a=e.name||o;if(!o)return;let s=new Option(a,o);o===n&&(s.selected=!0,t=!0),i.appendChild(s)}),!t&&n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let e=new Option(n+" (manual)",n,!1,!0);i.insertBefore(e,i.firstChild),i.value=n,t=!0}if(!t&&i.options.length>0&&i.selectedIndex===-1){let e=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){e=o;break}i.selectedIndex=e!==-1?e:0}}window.aipkit_updateDeepSeekModels=c})();(function(){"useastrict";function c(i,n="aipkit_elevenlabs_voice_id"){let t=document.getElementById(n);if(!t){console.warn(`ElevenLabs Sync (Voices): Select element #${n} not found.`);return}let e=t.value;if(t.innerHTML="",t.appendChild(new Option("-- Select a Voice (Optional) --","")),!i||!i.length){e&&e!==""&&(t.appendChild(new Option(e+" (manual/not synced)",e,!1,!0)),t.value=e);return}let o=!1;if(i.sort((a,s)=>(a.name||a.id||"").localeCompare(s.name||s.id||"")),i.forEach(a=>{let s=a.id||"",l=a.name||s;if(!s)return;let d=new Option(l,s);s===e&&(d.selected=!0,o=!0),t.appendChild(d)}),!o&&e&&e!==""&&!t.querySelector(`option[value="${CSS.escape(e)}"]`)){let a=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(a),t.value=e}}function r(i,n="aipkit_elevenlabs_tts_model_id"){let t=document.getElementById(n);if(!t){console.warn(`ElevenLabs Sync (Models): Select element #${n} not found.`);return}let e=t.value;if(t.innerHTML="",t.appendChild(new Option("-- Select a Model (Optional) --","")),!i||!i.length){e&&e!==""&&(t.appendChild(new Option(e+" (manual/not synced)",e,!1,!0)),t.value=e);return}let o=!1;if(i.sort((a,s)=>(a.name||a.id||"").localeCompare(s.name||s.id||"")),i.forEach(a=>{let s=a.id||"",l=a.name||s;if(!s)return;let d=new Option(l,s);s===e&&(d.selected=!0,o=!0),t.appendChild(d)}),!o&&e&&e!==""&&!t.querySelector(`option[value="${CSS.escape(e)}"]`)){let a=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(a),t.value=e}}window.aipkit_updateElevenLabsVoices=c,window.aipkit_updateElevenLabsModelsSelect=r})();(function(){"use strict";function c(r,i="aipkit_pinecone_default_index"){let n=document.getElementById(i);if(!n){console.warn(`Pinecone Sync: Select element #${i} not found.`);return}let t=n.value;if(n.innerHTML="",n.appendChild(new Option("-- Select Default Index --","")),!r||!r.length){n.appendChild(new Option("(No indexes found - Sync again)","")),t&&t!==""&&(n.appendChild(new Option(t+" (manual/not synced)",t,!1,!0)),n.value=t);return}let e=!1;if(r.sort((o,a)=>(o.name||o.id||"").localeCompare(a.name||a.id||"")),r.forEach(o=>{let a=o.name||o.id||(typeof o=="string"?o:"");if(!a)return;let s=new Option(a,a);a===t&&(s.selected=!0,e=!0),n.appendChild(s)}),!e&&t&&t!==""&&!n.querySelector(`option[value="${CSS.escape(t)}"]`)){let o=new Option(t+" (manual/not synced)",t,!1,!0);n.appendChild(o),n.value=t}}window.aipkit_updatePineconeIndexes=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_qdrant_default_collection");if(!i){console.warn("Qdrant Sync: Select element #aipkit_qdrant_default_collection not found.");return}let n=i.value;if(i.innerHTML="",i.appendChild(new Option("-- Select Collection (Optional) --","")),!r||!r.length){i.appendChild(new Option("(No collections found - Sync again)","")),n&&n!==""&&(i.appendChild(new Option(n+" (manual/not synced)",n,!1,!0)),i.value=n);return}let t=!1;if(r.sort((e,o)=>(e.name||e.id||"").localeCompare(o.name||o.id||"")),r.forEach(e=>{let o=e.name||e.id||"";if(!o)return;let a=new Option(o,o);o===n&&(a.selected=!0,t=!0),i.appendChild(a)}),!t&&n&&n!==""&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let e=new Option(n+" (manual/not synced)",n,!1,!0);i.appendChild(e),i.value=n}}window.aipkit_updateQdrantCollections=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_replicate_model");if(!i){console.warn("Replicate Sync: Select element #aipkit_replicate_model not found.");return}let n=i.value;if(i.innerHTML="",!r||!r.length){i.appendChild(new Option("(No models found - Sync again)","")),n&&n!==""&&(i.appendChild(new Option(n+" (manual/not synced)",n,!1,!0)),i.value=n);return}let t=!1;if(r.sort((e,o)=>(e.name||e.id||"").localeCompare(o.name||o.id||"")),r.forEach(e=>{let o=e.id||"",a=e.name||o;if(!o)return;let s=new Option(a,o);o===n&&(s.selected=!0,t=!0),i.appendChild(s)}),!t&&n&&n!==""&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let e=new Option(n+" (manual)",n,!1,!0);i.insertBefore(e,i.firstChild),i.value=n}if(!i.value&&i.options.length>0){let e=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){e=o;break}i.selectedIndex=e!==-1?e:0}}window.aipkit_updateReplicateModels=c})();(function(){"use strict";function c(i,n){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing.");return}let t={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,Azure:window.aipkit_updateAzureDeployments,DeepSeek:window.aipkit_updateDeepSeekModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof t[n]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${n}.`),alert(`AIPKit Error: Cannot update UI for ${n}.`);return}let e="aipkit_settings_messages";window.aipkit_clearStatusMessages(e),window.aipkit_showSavingIndicator(e,!1);let o=i.querySelector(".aipkit_btn-text"),a=o?o.textContent:n.includes("ElevenLabs")||n.includes("Pinecone")||n.includes("Qdrant")||n.includes("Replicate")?"Sync Items":"Sync Models";o&&(o.textContent="");let s=i.querySelector(".aipkit_spinner");s||(s=document.createElement("span"),s.className="aipkit_spinner",i.appendChild(s)),s.style.display="inline-block",i.classList.add("aipkit_loading"),i.disabled=!0,window.aipkit_apiRequest("aipkit_sync_models",{provider:n}).then(l=>{t[n](l.models),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.warn("Model Sync Init: Cannot update autosave baseline.");let d="models";n==="ElevenLabs"?d="voices":n==="ElevenLabsModels"?d="synthesis models":n==="PineconeIndexes"?d="indexes":n==="QdrantCollections"&&(d="collections"),window.aipkit_showMessage(e,"success",`${n.replace(/Indexes|Collections|Models/,"")} ${d} synced!`)}).catch(l=>{window.aipkit_showMessage(e,"error",`Sync failed: ${l.message}`),console.error(`AIPKit Sync Error (${n}):`,l)}).finally(()=>{i.disabled=!1,i.classList.remove("aipkit_loading");let l=i.querySelector(".aipkit_spinner");l&&(l.style.display="none"),o&&(o.textContent=a)})}function r(){let i=document.getElementById("aipkit_module-container");if(!i){console.error("AIPKit Model Sync Init: Main module container not found.");return}let n="data-sync-listener-attached";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit_sync_btn");if(!e||e.disabled)return;t.preventDefault();let o=e.getAttribute("data-provider");o?c(e,o):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",e)}),i.setAttribute(n,"true"),console.log("AIPKit Model Sync: Delegated listener attached to main module container."))}window.aipkit_initSyncButtons=r})();(function(){"use strict";let c=!1,r=window.aipkit_escapeHtml||(u=>u||""),i={},n={},t=100;function e(u,f){if(!u||typeof u!="string")return"";if(u.length<=f)return u;let m=u.substring(0,f-1);return m.substring(0,m.lastIndexOf(" ")).trim()+"\u2026"}function o(u){let f=document.createElement("tr");f.dataset.actionId=u.id,f.dataset.label=u.label,f.dataset.prompt=u.prompt;let m=`
            <button type="button" class="button button-small aipkit-enhancer-edit-action-btn" aria-label="${r(n.edit_action||"Edit")}"><span class="dashicons dashicons-edit"></span></button>
            <button type="button" class="button button-small button-link-delete aipkit-enhancer-delete-action-btn" aria-label="${r(n.delete_action||"Delete")}"><span class="dashicons dashicons-trash"></span></button>
        `,g=r(u.prompt),k=`<span class="aipkit-enhancer-prompt-text">${g}</span>`;return g.length>t&&(k=`
          <span class="aipkit-enhancer-prompt-text">${e(g,t)}</span>
          <button type="button" class="aipkit-enhancer-prompt-toggle">Show more</button>
      `),f.innerHTML=`
            <td class="aipkit-action-label-cell"><strong>${r(u.label)}</strong></td>
            <td class="aipkit-action-prompt-cell"><div class="aipkit-enhancer-prompt-text-wrapper">${k}</div></td>
            <td class="aipkit_enhancer_action_buttons">${m}</td>
        `,f}function a(u){let f=u.querySelector(".aipkit-action-label-cell"),m=u.querySelector(".aipkit-action-prompt-cell"),g=u.querySelector(".aipkit_enhancer_action_buttons");if(!f||!m||!g)return;let k=u.dataset.label,w=u.dataset.prompt;f.innerHTML=`<input type="text" class="widefat" value="${r(k)}" maxlength="50">`,m.innerHTML="";let b=document.createElement("textarea");b.className="widefat",b.rows=3,b.value=w,m.appendChild(b),g.innerHTML=`
            <button type="button" class="button button-primary button-small aipkit-enhancer-save-action-btn">${r("Save")}</button>
            <button type="button" class="button button-secondary button-small aipkit-enhancer-cancel-action-btn">${r("Cancel")}</button>
        `,u.classList.add("is-editing"),f.querySelector("input").focus()}function s(u,f){u.dataset.actionId=f.id,u.dataset.label=f.label,u.dataset.prompt=f.prompt,u.classList.remove("is-editing");let m=o(f);u.innerHTML=m.innerHTML}function l(u){let f="aipkit_enhancer_actions_status";if(u.rows.length>=10){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(f,"error","Maximum of 10 actions (3 default + 7 custom) reached."):alert("Maximum of 10 actions reached.");return}if(u.querySelector('tr[data-action-id^="new-"]'))return;let m=document.createElement("tr");m.dataset.actionId=`new-${Date.now()}`,m.classList.add("is-editing"),m.innerHTML=`
            <td class="aipkit-action-label-cell">
                <input type="text" class="widefat" placeholder="New Label" maxlength="50">
            </td>
            <td class="aipkit-action-prompt-cell"><textarea class="widefat" rows="3" placeholder="Enter prompt. Use %s for selected text."></textarea></td>
            <td class="aipkit_enhancer_action_buttons">
                <button type="button" class="button button-primary button-small aipkit-enhancer-save-action-btn">${r("Save")}</button>
                <button type="button" class="button button-secondary button-small aipkit-enhancer-cancel-action-btn">${r("Cancel")}</button>
            </td>
        `,u.prepend(m),m.querySelector("input").focus()}async function d(u){if(c)return;let f=u.querySelector(".aipkit-action-label-cell"),m=u.querySelector(".aipkit-action-prompt-cell"),g=f.querySelector("input"),k=m.querySelector("textarea"),w="aipkit_enhancer_actions_status";if(!g||!k)return;f.querySelectorAll(".aipkit_form-help-error").forEach(I=>I.remove()),m.querySelectorAll(".aipkit_form-help-error").forEach(I=>I.remove()),g.style.borderColor="",k.style.borderColor="";let b=g.value.trim(),y=k.value.trim(),h=u.dataset.actionId,v=!1;if(!b){g.style.borderColor="red";let I=document.createElement("div");I.className="aipkit_form-help aipkit_form-help-error",I.textContent="Label cannot be empty.",f.appendChild(I),v=!0}if(!y){k.style.borderColor="red";let I=document.createElement("div");I.className="aipkit_form-help aipkit_form-help-error",I.textContent="Prompt cannot be empty.",m.appendChild(I),v=!0}if(v)return;c=!0;let S=u.querySelector(".aipkit-enhancer-save-action-btn");S&&(S.textContent=n.saving_action||"Saving...",S.disabled=!0);try{let I=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:h,label:b,prompt:y,_ajax_nonce:i.nonce_manage_actions});s(u,I.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(w,"success",n.action_saved||"Action saved.")}catch(I){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(w,"error",`Error: ${I.message}`):alert(`Error saving action: ${I.message}`),S&&(S.textContent="Save")}finally{S&&(S.disabled=!1),c=!1}}async function p(u){let f=u.querySelector("#aipkit_enhancer_actions_list"),m=u.querySelector("#aipkit_enhancer_actions_status");f.innerHTML=`<tr><td colspan="3" style="text-align:center;">${r(n.loading_actions||"Loading...")}</td></tr>`;try{let g=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:i.nonce_manage_actions});f.innerHTML="",(g.actions||[]).forEach(k=>{f.appendChild(o(k))})}catch(g){m.innerHTML=`<span class="error">${r(g.message||"Failed to load actions.")}</span>`}}function _(){let u=document.getElementById("aipkit_enhancer_actions_container");if(!u||u.dataset.listenerAttached)return;u.dataset.listenerAttached="true",i=window.aipkit_post_enhancer||{},n=i.text||{};let f=u.querySelector("#aipkit_enhancer_actions_list");u.addEventListener("click",async m=>{let g=m.target.closest(".aipkit-enhancer-add-new-btn"),k=m.target.closest(".aipkit-enhancer-edit-action-btn"),w=m.target.closest(".aipkit-enhancer-delete-action-btn"),b=m.target.closest(".aipkit-enhancer-save-action-btn"),y=m.target.closest(".aipkit-enhancer-cancel-action-btn"),h=m.target.closest(".aipkit-enhancer-prompt-toggle");if(g)l(f);else if(h){let S=h.closest(".aipkit-enhancer-prompt-text-wrapper").querySelector(".aipkit-enhancer-prompt-text"),I=h.closest("tr").dataset.prompt;h.textContent.toLowerCase().includes("more")?(S.textContent=r(I),h.textContent="Show less"):(S.textContent=e(r(I),t),h.textContent="Show more")}else if(k)a(k.closest("tr"));else if(b)await d(b.closest("tr"));else if(y){let v=y.closest("tr");v.dataset.actionId.startsWith("new-")?v.remove():s(v,{id:v.dataset.actionId,label:v.dataset.label,prompt:v.dataset.prompt,is_default:!1})}else if(w){if(c)return;let v=w.closest("tr"),S=v.dataset.actionId,I="aipkit_enhancer_actions_status";if(!confirm(n.confirm_delete_action||"Are you sure you want to delete this action? This cannot be undone."))return;c=!0,w.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:S,_ajax_nonce:i.nonce_manage_actions}),v.remove(),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(I,"success",n.action_deleted||"Action deleted.")}catch(E){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(I,"error",`Error: ${E.message}`):alert(`Error deleting: ${E.message}`),w.disabled=!1}finally{c=!1}}}),u.addEventListener("keydown",m=>{if(m.key==="Enter"&&m.target.matches("input[type=text]")&&!m.target.matches("textarea")){m.preventDefault();let g=m.target.closest("tr.is-editing");g&&d(g)}}),window.aipkit_enhancer_reload_actions=()=>p(u),p(u)}window.aipkit_initEnhancerActionsUI=_})();(function(){"use strict";let c=[],r=[];function i(e){let o=document.getElementById("aipkit_semantic_search_target_id");if(!o)return;let a=o.value;o.innerHTML='<option value="">-- Select --</option>';let s=[];e==="pinecone"?s=c:e==="qdrant"&&(s=r),Array.isArray(s)&&s.forEach(l=>{let d=l.name||l.id||(typeof l=="string"?l:null);if(d){let p=document.createElement("option");p.value=d,p.textContent=d,o.appendChild(p)}}),o.querySelector(`option[value="${CSS.escape(a)}"]`)&&(o.value=a)}function n(e){let o=document.getElementById("aipkit_semantic_search_embedding_provider");if(!o||!e)return;let a=e.options[e.selectedIndex];a&&a.dataset.provider&&(o.value=a.dataset.provider)}function t(){let e=document.getElementById("aipkit_settings_container");if(!e)return;let o="data-semantic-search-listener-attached";if(e.getAttribute(o))return;let a=document.getElementById("aipkit_semantic_search_vector_provider"),s=document.getElementById("aipkit_pinecone_indexes_json_main"),l=document.getElementById("aipkit_qdrant_collections_json_main"),d=document.getElementById("aipkit_semantic_search_embedding_model");if(a){if(s&&s.dataset.indexes)try{c=JSON.parse(s.dataset.indexes)||[]}catch(p){console.error("Error parsing Pinecone indexes JSON:",p)}if(l&&l.dataset.collections)try{r=JSON.parse(l.dataset.collections)||[]}catch(p){console.error("Error parsing Qdrant collections JSON:",p)}a&&(a.addEventListener("change",p=>{if(i(p.target.value),typeof window.aipkit_handleAutoSave=="function"){let _=document.getElementById("aipkit_semantic_search_target_id");_&&(_.value=""),window.aipkit_handleAutoSave()}}),i(a.value)),d&&(d.addEventListener("change",p=>{n(p.target)}),n(d)),e.setAttribute(o,"true"),console.log("AIPKit Semantic Search UI: Initialized.")}}window.aipkit_initSemanticSearchUI=t})();(function(){"use strict";function c(){let i=document.getElementById("aipkit_settings_container");if(!i)return;let n=i.querySelector("#aipkit_provider");if(!n)return;let t=n.value,e=t.toLowerCase(),o=i.querySelectorAll(".aipkit_api_key_field"),a=i.querySelectorAll(".aipkit_model_field"),s=i.querySelectorAll(".aipkit_advanced_settings_provider"),l=i.querySelector("#aipkit_safety_settings_accordion"),d=i.querySelector(".aipkit_openai_store_field"),p=i.querySelectorAll(".aipkit_param_not_openai");o.forEach(m=>m.style.display="none"),a.forEach(m=>m.style.display="none"),s.forEach(m=>m.style.display="none"),l&&(l.style.display="none"),d&&(d.style.display="none"),i.querySelectorAll(`.aipkit_api_key_field[data-provider="${t}"]`).forEach(m=>m.style.display="block"),i.querySelectorAll(`.aipkit_model_field[data-provider="${t}"]`).forEach(m=>m.style.display="block");let f=i.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${t}"]`);f&&(f.style.display="block"),t==="Google"?l&&(l.style.display="block"):t==="OpenAI"&&d&&(d.style.display="block"),t==="OpenAI"||t==="Google"?p.forEach(m=>m.style.display="none"):p.forEach(m=>m.style.display="block")}function r(){let i=document.getElementById("aipkit_provider");if(i){let n="data-provider-listener-attached";if(i.getAttribute(n)==="true")return;i.addEventListener("change",function(){c(),typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found.")}),i.setAttribute(n,"true"),c()}}window.aipkit_toggleProviderFields=c,window.aipkit_initProviderSelectListener=r})();(function(){"use strict";function c(){console.log("AIPKit Settings: Initializing..."),typeof window.aipkit_initMessageCloseButtons=="function"?window.aipkit_initMessageCloseButtons("aipkit_settings_messages"):console.error("Settings Init: aipkit_initMessageCloseButtons not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(o=>{o.dataset.accordionListenerAttached!=="true"&&(o.addEventListener("click",function(){let a=this.nextElementSibling;if(a){this.classList.toggle("aipkit_active"),a.classList.toggle("aipkit_active");let s=this.closest(".aipkit_accordion");s?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(s.style.display="block")}}),o.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found.");let i=document.getElementById("aipkit_elevenlabs_voice_id"),n=document.getElementById("aipkit_elevenlabs_voices_json_main");if(i&&n&&typeof window.aipkit_updateElevenLabsVoices=="function")try{let o=JSON.parse(n.dataset.voices||"[]"),a=i.value||"";window.aipkit_updateElevenLabsVoices(o,i.id)}catch(o){console.error("AIPKit Settings Init: Failed to parse initial ElevenLabs voices JSON from main settings.",o)}let t=document.getElementById("aipkit_elevenlabs_tts_model_id"),e=document.getElementById("aipkit_elevenlabs_models_json_main");if(t&&e&&typeof window.aipkit_updateElevenLabsModelsSelect=="function")try{let o=JSON.parse(e.dataset.models||"[]");window.aipkit_updateElevenLabsModelsSelect(o,t.id)}catch(o){console.error("AIPKit Settings Init: Failed to parse initial ElevenLabs models JSON from main settings.",o)}typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found."),console.log("AIPKit Settings: Initialization complete.")}window.aipkit_initSettings=c})();(function(){"use strict";function c(r,i,n){let t=document.getElementById("aipkit_user_credits_table_body");if(!t)return;let e=wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;if(t.innerHTML="",!r||r.length===0)return;let o=window.aipkit_escapeHtml||function(a){return a};r.forEach(a=>{let s=t.insertRow();s.dataset.userId=a.id,s.insertCell().textContent=`${a.display_name} (${a.email})`;let l=s.insertCell(),d=document.createElement("input");d.type="number",d.className="aipkit_form-input aipkit_user_credits_balance_input",d.value=a.token_balance||0,d.dataset.userId=a.id,d.dataset.originalValue=a.token_balance||0,d.setAttribute("min","0"),d.setAttribute("step","1"),d.title=e("Press Enter or blur to save changes","gpt3-ai-content-generator"),l.appendChild(d);let p=document.createElement("span");p.className="aipkit_user_credits_balance_status",l.appendChild(p);let _=a.total_used_all_bots||0;s.insertCell().textContent=_.toLocaleString();let u=s.insertCell(),f=[],m=a.tokens_used||{},g=a.image_usage||{used:0},k=e("Image Generator","gpt3-ai-content-generator");g.used>0&&f.push(`<li><strong>${o(k)}:</strong> ${g.used.toLocaleString()}</li>`),Object.keys(m).length>0&&Object.keys(m).sort((x,A)=>x-A).forEach(x=>{let A=n[x]||`Bot #${x}`,C=m[x]||0;f.push(`<li><strong>${o(A)}:</strong> ${C.toLocaleString()}</li>`)});let w='<ul class="aipkit_usage_detail_list">';f.length===0?w+="<li>-</li>":f.forEach((x,A)=>{A>=2?w+=x.replace("<li",'<li class="aipkit_usage_detail_extra" style="display: none;"'):w+=x}),w+="</ul>",f.length>2&&(w+=`<button type="button" class="aipkit_btn-as-link aipkit-show-more-details-btn">${e("Show more","gpt3-ai-content-generator")}...</button>`),u.innerHTML=w;let b=s.insertCell(),y=[],h=a.last_reset||{},v=g.last_reset||0,S=e("N/A","gpt3-ai-content-generator");if(g.used>0){let T=v>0?new Date(v*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):S;y.push(`<li><strong>${o(k)}:</strong> ${T}</li>`)}let I=new Set([...Object.keys(a.tokens_used||{}),...Object.keys(a.last_reset||{})]);I.size>0&&Array.from(I).sort((x,A)=>x-A).forEach(x=>{if((a.tokens_used||{})[x]>0){let A=n[x]||`Bot #${x}`,C=(a.last_reset||{})[x]||0,q=C>0?new Date(C*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):S;y.push(`<li><strong>${o(A)}:</strong> ${q}</li>`)}});let E='<ul class="aipkit_usage_detail_list">';y.length===0?f.length>0?E+=`<li>${S}</li>`:E+="<li>-</li>":y.forEach((x,A)=>{A>=2?E+=x.replace("<li",'<li class="aipkit_usage_detail_extra" style="display: none;"'):E+=x}),E+="</ul>",y.length>2&&(E+=`<button type="button" class="aipkit_btn-as-link aipkit-show-more-details-btn">${e("Show more","gpt3-ai-content-generator")}...</button>`),b.innerHTML=E;let P=s.insertCell();if(P.className="aipkit-user-credits-actions-cell",a.purchase_history&&a.purchase_history.length>0){let T=document.createElement("button");T.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit-view-purchase-history-btn",T.title=e("View Purchase History","gpt3-ai-content-generator"),T.innerHTML='<span class="dashicons dashicons-cart"></span>',T.dataset.userId=a.id,T.dataset.userName=a.display_name,T.dataset.history=JSON.stringify(a.purchase_history),P.appendChild(T)}else P.innerHTML="\u2013"})}window.aipkit_renderUserCreditsTable=c})();(function(){"use strict";function c(r,i,n){let t=document.getElementById("aipkit_user_credits_pagination");if(!t)return;t.innerHTML="";let{total_pages:e,total_users:o}=r;if(!e||e<=0||!o||o<=0){o===0&&n!==""?t.innerHTML=`<span class="aipkit_pagination-count">${o.toLocaleString()} user(s) found for search.</span>`:o===0&&(t.innerHTML='<span class="aipkit_pagination-count">No users found.</span>');return}let a=document.createElement("span");if(a.className="aipkit_pagination-count",a.textContent=`${o.toLocaleString()} user(s)`,t.appendChild(a),e>1){let s=document.createElement("span");s.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",l.innerHTML="\xAB Previous",l.disabled=i<=1,l.disabled||l.addEventListener("click",_=>{_.preventDefault(),typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(i-1,n):console.error("Pagination: Fetch function not found.")}),s.appendChild(l);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`Page ${i} of ${e}`,s.appendChild(d);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",p.innerHTML="Next \xBB",p.disabled=i>=e,p.disabled||p.addEventListener("click",_=>{_.preventDefault(),typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(i+1,n):console.error("Pagination: Fetch function not found.")}),s.appendChild(p),t.appendChild(s)}}window.aipkit_renderUserCreditsPagination=c})();(function(){"use strict";function c(r,i){let n=document.getElementById("aipkit_user_credits_stats_grid");if(!n)return;let t=n.querySelector("#aipkit_stat_total_users"),e=n.querySelector("#aipkit_stat_total_tokens"),o=n.querySelector("#aipkit_stat_avg_tokens"),a=i?.total_users??0,s=i?.per_page??r.length,l=r.length,d=0;r.forEach(m=>{d+=m.total_used_all_bots||0});let p=l>0?l:1,_=Math.round(d/p);t&&(t.textContent=a.toLocaleString());let u=a>s;e&&(e.textContent=d.toLocaleString()+(u?"*":"")),o&&(o.textContent=_.toLocaleString()+(u?"*":""));let f=n.querySelector(".aipkit_stats_note");u?(f||(f=document.createElement("p"),f.className="aipkit_form-help aipkit_stats_note",f.style.gridColumn="1 / -1",f.style.textAlign="center",f.style.marginTop="-10px",f.style.marginBottom="10px",n.appendChild(f)),f.textContent="* Token stats based on currently displayed users."):f&&f.remove()}window.aipkit_updateUserCreditsStats=c})();(function(){"use strict";let c=1,r="",i={};function n(t=1,e=""){if(typeof window.aipkit_renderUserCreditsTable!="function"||typeof window.aipkit_renderUserCreditsPagination!="function"||typeof window.aipkit_updateUserCreditsStats!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit User Credits Fetch: Missing required render, pagination, stats, or API functions.");return}let o=document.getElementById("aipkit_user_credits_table_body"),a=document.getElementById("aipkit_user_credits_pagination"),s=document.querySelector("#aipkit_user_credits_table tfoot"),l=document.getElementById("aipkit_user_credits_no_results"),d=document.getElementById("aipkit_user_credits_stats_grid"),p=window.aipkit_dashboard?.text||{},_=p.userCreditsLoading||"Loading user credits...";if(o&&(o.innerHTML=`<tr><td colspan="6" style="text-align: center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> ${_}</td></tr>`),l&&(l.style.display="none"),a&&(a.innerHTML=""),s&&(s.style.display="none"),d){d.querySelectorAll(".aipkit_stat-value").forEach(m=>m.textContent="-");let f=d.querySelector(".aipkit_stats_note");f&&f.remove()}c=t,r=e;let u={page:t,search:e};window.aipkit_apiRequest("aipkit_get_user_credits_data",u).then(f=>{i=f.bot_titles||{},o&&window.aipkit_renderUserCreditsTable(f.users_data||[],p,i),a&&s&&(window.aipkit_renderUserCreditsPagination(f.pagination||{},c,r),s.style.display=f.pagination&&f.pagination.total_pages>1?"":"table-footer-group"),l&&(l.style.display=!f.users_data||f.users_data.length===0?"block":"none",l.textContent=p.userCreditsNoUsers||"No user token data found."),window.aipkit_updateUserCreditsStats(f.users_data||[],f.pagination||{})}).catch(f=>{console.error("AIPKit User Credits: Error fetching data:",f);let m=f?.message||p.userCreditsError||"Error loading user credits.",g=(p.userCreditsError||"Error loading user credits.")+` (${m})`;o&&(o.innerHTML=`<tr><td colspan="6" style="text-align: center; padding: 20px; color: red;">${g}</td></tr>`),l&&(l.textContent=g,l.style.display="block")})}window.aipkit_fetchUserCreditsData=n,window.aipkit_getCurrentCreditsPage=()=>c,window.aipkit_getCurrentCreditsSearch=()=>r})();(function(){"use strict";let c;function r(){let i=document.getElementById("aipkit_user_search"),n=document.getElementById("aipkit_user_search_btn"),t=document.getElementById("aipkit_user_reset_search_btn");if(!i||!n||!t){console.warn("AIPKit User Credits Search: Missing search elements.");return}let e=()=>{clearTimeout(c);let o=i.value.trim();c=setTimeout(()=>{typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,o),t.style.display=o?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")},350)};n.addEventListener("click",()=>{clearTimeout(c);let o=i.value.trim();typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,o),t.style.display=o?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")}),i.addEventListener("input",e),i.addEventListener("keypress",o=>{if(o.key==="Enter"){clearTimeout(c),o.preventDefault();let a=i.value.trim();typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,a),t.style.display=a?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")}}),t.addEventListener("click",()=>{clearTimeout(c),i.value="",typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(1,""):console.error("Credits Search: Fetch function not found."),t.style.display="none"}),t.style.display=i.value.trim()?"inline-block":"none"}window.aipkit_initUserCreditsSearch=r})();(function(){"use strict";let c;function r(e,o,a){if(!e||e.length===0)return`<p>${o("No purchase history found for this user.","gpt3-ai-content-generator")}</p>`;let s="";return e.forEach(l=>{let p=new Date(l.date.date).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}),_=(l.products||[]).map(u=>`
        <div class="aipkit_purchase_product">
          <span class="aipkit_product_name">${a(u.name)}</span>
          <span class="aipkit_product_details">
            ${u.quantity>1?`${u.quantity}x `:""}
            ${parseInt(u.tokens_per_item,10).toLocaleString()} tokens = 
            ${parseInt(u.total_tokens,10).toLocaleString()} tokens
          </span>
        </div>
      `).join("");s+=`
        <div class="aipkit_purchase_item">
          <div class="aipkit_purchase_header">
            <div class="aipkit_purchase_date"><strong>${p}</strong></div>
            <div class="aipkit_purchase_summary_info">
              <span class="aipkit_purchase_tokens">+${parseInt(l.tokens_granted,10).toLocaleString()} ${o("tokens","gpt3-ai-content-generator")}</span>
              <span class="aipkit_purchase_amount">${l.total_amount} ${l.currency}</span>
            </div>
          </div>
          <div class="aipkit_purchase_details">
            <div class="aipkit_purchase_order_info">
              <span class="aipkit_purchase_order_id">${o("Order #","gpt3-ai-content-generator")}${l.order_id}</span>
            </div>
            ${_?`<div class="aipkit_purchase_products">${_}</div>`:""}
          </div>
        </div>
      `}),s}function i(e){let o=JSON.parse(e.dataset.history),a=e.dataset.userName,s=wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f,l=window.aipkit_escapeHtml||(f=>f||""),d=document.createElement("div");d.className="aipkit-modal-overlay aipkit-active";let p=r(o,s,l),_=`
          <div class="aipkit-modal-content aipkit_purchase_history_modal_content">
              <div class="aipkit-modal-header">
                  <h3 class="aipkit-modal-title">${l(s("Purchase History for","gpt3-ai-content-generator"))} ${l(a)}</h3>
                  <button class="aipkit-modal-close-btn">\xD7</button>
              </div>
              <div class="aipkit-modal-body">
                  <div class="aipkit_purchase_history_list">${p}</div>
              </div>
          </div>
      `;d.innerHTML=_,document.body.appendChild(d);let u=()=>{d.classList.remove("aipkit-active"),setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},200)};d.querySelector(".aipkit-modal-close-btn").addEventListener("click",u),d.addEventListener("click",f=>{f.target===d&&u()})}function n(e){let o=e.target,a=o.dataset.userId,s=o.parentElement.querySelector(".aipkit_user_credits_balance_status"),l=o.dataset.originalValue||o.defaultValue,d=o.value;if(d===l)return;s&&(s.innerHTML='<span class="aipkit_spinner" style="display:inline-block; width:14px; height:14px; border-width:2px; vertical-align:middle;"></span>');let p=document.getElementById("aipkit_user_credits_nonce_field")?.value;if(!p){console.error("User Credits Actions: Nonce field not found."),s&&(s.innerHTML="\u274C");return}let _={_ajax_nonce:p,user_id:a,balance:d};clearTimeout(c),c=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",_).then(u=>{s&&(s.innerHTML="\u2714",o.dataset.originalValue=u.new_balance),setTimeout(()=>{s&&(s.innerHTML="")},2e3)}).catch(u=>{console.error("Error updating token balance:",u),s&&(s.innerHTML="\u274C",o.value=l,setTimeout(()=>{s&&(s.innerHTML="")},4e3))})},500)}function t(){let e=document.getElementById("aipkit_refresh_credits_btn"),o=document.getElementById("aipkit_user_credits_table_body");if(e&&e.addEventListener("click",()=>{if(typeof window.aipkit_fetchUserCreditsData=="function"&&typeof window.aipkit_getCurrentCreditsPage=="function"&&typeof window.aipkit_getCurrentCreditsSearch=="function"){let a=window.aipkit_getCurrentCreditsPage(),s=window.aipkit_getCurrentCreditsSearch();window.aipkit_fetchUserCreditsData(a,s)}else console.error("Credits Actions: Fetch or state getter function not found for refresh.")}),o){let a="data-credits-action-listener-attached";o.getAttribute(a)||(o.addEventListener("change",s=>{s.target.matches(".aipkit_user_credits_balance_input")&&n(s)}),o.addEventListener("keypress",s=>{s.key==="Enter"&&s.target.matches(".aipkit_user_credits_balance_input")&&(s.preventDefault(),s.target.blur())}),o.addEventListener("click",s=>{let l=s.target.closest(".aipkit-show-more-details-btn"),d=s.target.closest(".aipkit-view-purchase-history-btn");if(l){s.preventDefault();let p=wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u,_=l.closest("td");if(_){let u=_.querySelectorAll(".aipkit_usage_detail_extra");if(u.length>0){let f=u[0].style.display==="none";u.forEach(m=>{m.style.display=f?"list-item":"none"}),l.textContent=f?p("Show less","gpt3-ai-content-generator"):p("Show more","gpt3-ai-content-generator")+"..."}}}else d&&(s.preventDefault(),i(d))}),o.setAttribute(a,"true"),console.log("AIPKit Credits Actions: Delegated listeners attached for balance updates and show more/history."))}else console.warn("AIPKit Credits Actions: Table body not found for attaching delegated listeners.")}window.aipkit_initUserCreditsActions=t})();(function(){"use strict";function c(){let i=document.getElementById("aipkit_token_usage_shortcode_configurator"),n=document.getElementById("aipkit_token_usage_shortcode_snippet");if(!i||!n)return;let t=i.querySelector('input[name="cfg_show_chatbot"]').checked,e=i.querySelector('input[name="cfg_show_aiforms"]').checked,o=i.querySelector('input[name="cfg_show_imagegenerator"]').checked,a=[];t||a.push('chatbot="false"'),e||a.push('aiforms="false"'),o||a.push('imagegenerator="false"');let s="[aipkit_token_usage";a.length>0&&(s+=" "+a.join(" ")),s+="]",n.textContent=s}function r(){let i=document.querySelector(".aipkit_user_credits_shortcode_config_wrapper");if(!i)return;let n=i.querySelector("#aipkit_token_usage_shortcode_settings_toggle"),t=i.querySelector("#aipkit_token_usage_shortcode_configurator"),e=i.querySelector("#aipkit_token_usage_shortcode_snippet"),o=t.querySelectorAll(".aipkit_config_input");if(!n||!t||!e||!o.length){console.warn("User Credits Shortcode Config: Missing one or more UI elements.");return}n.dataset.listenerAttached!=="true"&&(n.addEventListener("click",a=>{a.stopPropagation();let s=t.style.display==="none"||!t.style.display;t.style.display=s?"block":"none",n.classList.toggle("aipkit_active",s),n.setAttribute("aria-expanded",s)}),document.addEventListener("click",a=>{i.contains(a.target)||(t.style.display="none",n.classList.remove("aipkit_active"),n.setAttribute("aria-expanded","false"))}),o.forEach(a=>{a.addEventListener("change",c)}),e.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(e.textContent,e):console.error("aipkit_copyShortcode function not found.")}),c(),n.dataset.listenerAttached="true")}window.aipkit_initUserCreditsShortcodeConfig=r})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_token_usage_chart_container_credits");if(!r)return;if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit User Credits Chart: Missing required API or render functions."),r.innerHTML='<p style="color:red">Error: Chart components failed to load.</p>';return}let i=r.querySelector(".aipkit_chart_loading_placeholder"),n=r.querySelector(".aipkit_chart_error_placeholder"),t=r.querySelector(".aipkit_chart_nodata_placeholder");n&&(n.style.display="none"),t&&(t.style.display="none"),i&&(i.style.display="flex"),window.aipkit_apiRequest("aipkit_get_token_usage_chart_data").then(e=>{if(i&&(i.style.display="none"),e&&e.daily_token_data){let o=e.daily_token_data;Object.values(o).some(s=>Object.values(s).reduce((l,d)=>l+d,0)>0)?window.aipkit_renderTokenUsageChart(r,o):t&&(t.style.display="flex",t.textContent=window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.")}else throw new Error("Invalid data received for chart.")}).catch(e=>{console.error("AIPKit User Credits Chart: Error loading data:",e),i&&(i.style.display="none"),n&&(n.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${e.message})`,n.style.display="flex")})}window.aipkit_loadUserCreditsChart=c})();(function(){"use strict";function c(){if(console.log("AIPKit User Credits: Initializing..."),typeof window.aipkit_fetchUserCreditsData=="function")window.aipkit_fetchUserCreditsData(1);else{console.error("AIPKit User Credits Init: fetchUserCreditsData function not found.");let r=document.getElementById("aipkit_user_credits_table_body");r&&(r.innerHTML='<tr><td colspan="5" style="color:red;">Error: Could not load user data script.</td></tr>')}typeof window.aipkit_initUserCreditsSearch=="function"?window.aipkit_initUserCreditsSearch():console.error("AIPKit User Credits Init: initUserCreditsSearch function not found."),typeof window.aipkit_initUserCreditsActions=="function"?window.aipkit_initUserCreditsActions():console.error("AIPKit User Credits Init: initUserCreditsActions function not found."),typeof window.aipkit_initUserCreditsShortcodeConfig=="function"?window.aipkit_initUserCreditsShortcodeConfig():console.error("AIPKit User Credits Init: initUserCreditsShortcodeConfig function not found."),typeof window.aipkit_loadUserCreditsChart=="function"?window.aipkit_loadUserCreditsChart():console.error("AIPKit User Credits Init: aipkit_loadUserCreditsChart function not found."),console.log("AIPKit User Credits: Initialization complete.")}window.aipkit_initUserCredits=c})();(function(){"use strict";let c=!1;function r(){let i=document.getElementById("aipkit_role_manager_container");if(!i){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let n=i.querySelector("#aipkit_save_roles_btn"),t=i.querySelector("#aipkit_role_manager_form"),e=i.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),e&&(e.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let o=window.aipkit_role_manager_config,a=o.text||{};if(!n||!t||!e){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let s="data-role-save-listener";n.getAttribute(s)||(n.addEventListener("click",function(l){if(l.preventDefault(),c)return;c=!0;let d=n.querySelector(".aipkit_btn-text"),p=n.querySelector(".aipkit_spinner");n.disabled=!0,p&&(p.style.display="inline-block"),d&&(d.textContent=a.saving||"Saving..."),e.innerHTML="",e.className="aipkit_settings_messages";let _=new FormData(t);_.append("action","aipkit_save_role_permissions"),fetch(o.ajaxurl,{method:"POST",body:_,credentials:"same-origin"}).then(u=>u.ok?u.json():u.json().then(f=>{throw new Error(f.data.message||`HTTP error! status: ${u.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${u.status}`)})).then(u=>{if(!u.success){let f=u.data&&u.data.message?u.data.message:"An unknown error occurred.";throw new Error(f)}return u.data}).then(u=>{let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-success",f.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${u.message||a.success||"Permissions saved!"}`,e.appendChild(f),setTimeout(()=>{f.remove()},4e3)}).catch(u=>{console.error("AIPKit Role Manager Save Error:",u);let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-error",f.innerHTML=`<span class="dashicons dashicons-warning"></span> ${u.message||a.fail||"Failed to save permissions."}`,e.appendChild(f),setTimeout(()=>{f.remove()},6e3)}).finally(()=>{c=!1,n.disabled=!1,p&&(p.style.display="none"),d&&(d.textContent=a.saveButton||"Save Permissions")})}),n.setAttribute(s,"true"),console.log("AIPKit Role Manager: Save button initialized."))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&r()}),window.aipkit_initRoleManager=r})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat AI Settings Toggle: Main content container not found.");return}let i="data-cb-ai-settings-toggle-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(n){let t=n.target.closest(".aipkit_cb_ai_settings_toggle");if(!t)return;let e=t.closest(".aipkit_accordion-content");if(!e)return;let o=e.querySelector(".aipkit_cb_ai_parameters_row");if(!o)return;let a=o.style.display==="none";o.style.display=a?"block":"none",t.classList.toggle("aipkit_active",a),t.setAttribute("aria-expanded",a)}),r.setAttribute(i,"true"),console.log("AIPKit Chatbot: AI Settings Toggle Handler Initialized."))}window.aipkit_initChatAiSettingsToggle=c})();(function(){"use strict";function c(i){let n=i.querySelector(".aipkit_cb_web_search_toggle");if(!n||n.style.display==="none")return;let t=i.querySelector(".aipkit_chatbot_provider_select")?.value,e;t==="OpenAI"?e=i.querySelector(".aipkit_openai_web_search_enable_toggle"):t==="Google"&&(e=i.querySelector(".aipkit_google_search_grounding_enable_toggle")),e&&n.classList.toggle("aipkit_active",e.checked)}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-websearch-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit_cb_web_search_toggle");if(!e)return;let o=e.closest(".aipkit_chatbot-settings-area");if(!o)return;let a=o.querySelector(".aipkit_chatbot_provider_select")?.value,s;if(a==="OpenAI")s=o.querySelector(".aipkit_openai_web_search_enable_toggle");else if(a==="Google")s=o.querySelector(".aipkit_google_search_grounding_enable_toggle");else return;s&&(s.checked=!s.checked,e.classList.toggle("aipkit_active",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"),console.log("AIPKit Web Search Toggle Handler Initialized."))}window.aipkit_initWebSearchToggle=r,window.aipkit_setInitialWebSearchToggleState=c})();(function(){"use strict";function c(i){let n=i.querySelector(".aipkit_cb_stream_mode_toggle");if(!n)return;let t=i.querySelector(".aipkit_stream_enable_toggle");if(t){let e=t.checked;n.classList.toggle("aipkit_active",e),n.setAttribute("aria-pressed",e)}}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-stream-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit_cb_stream_mode_toggle");if(!e)return;let o=e.closest(".aipkit_chatbot-settings-area");if(!o)return;let a=o.querySelector(".aipkit_stream_enable_toggle");a&&(a.checked=!a.checked,e.classList.toggle("aipkit_active",a.checked),e.setAttribute("aria-pressed",a.checked),a.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"),console.log("AIPKit Stream Mode Toggle Handler Initialized."))}window.aipkit_initStreamModeToggle=r,window.aipkit_setInitialStreamToggleState=c})();(function(){"use strict";function c(i){let n=i.querySelector(".aipkit_cb_stateful_conv_toggle");if(!n)return;let t=i.querySelector(".aipkit_openai_conversation_state_enable_toggle");if(t){let e=t.checked;n.classList.toggle("aipkit_active",e),n.setAttribute("aria-pressed",e)}}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-stateful-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit_cb_stateful_conv_toggle");if(!e)return;let o=e.closest(".aipkit_chatbot-settings-area");if(!o)return;let a=o.querySelector(".aipkit_openai_conversation_state_enable_toggle");a&&(a.checked=!a.checked,e.classList.toggle("aipkit_active",a.checked),e.setAttribute("aria-pressed",a.checked),a.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"),console.log("AIPKit Stateful Conversation Toggle Handler Initialized."))}window.aipkit_initStatefulConvToggle=r,window.aipkit_setInitialStatefulConvState=c})();(function(){"use strict";function c(i){let n=i.querySelector(".aipkit_cb_image_upload_toggle");if(!n)return;let t=i.querySelector(".aipkit_image_upload_enable_toggle");if(t){let e=t.checked;n.classList.toggle("aipkit_active",e),n.setAttribute("aria-pressed",e)}}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-image-upload-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit_cb_image_upload_toggle");if(!e)return;let o=e.closest(".aipkit_chatbot-settings-area");if(!o)return;let a=o.querySelector(".aipkit_image_upload_enable_toggle");a&&(a.checked=!a.checked,e.classList.toggle("aipkit_active",a.checked),e.setAttribute("aria-pressed",a.checked),a.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"),console.log("AIPKit Image Upload Toggle Handler Initialized."))}window.aipkit_initImageUploadToggle=r,window.aipkit_setInitialImageUploadToggleState=c})();(function(){"use strict";function c(i){let n=i.querySelector(".aipkit_cb_voice_input_toggle");if(!n)return;let t=i.querySelector(".aipkit_voice_input_enable_toggle");if(t){let e=t.checked;n.classList.toggle("aipkit_active",e),n.setAttribute("aria-pressed",e)}}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-voice-input-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit_cb_voice_input_toggle");if(!e)return;let o=e.closest(".aipkit_chatbot-settings-area");if(!o)return;let a=o.querySelector(".aipkit_voice_input_enable_toggle");a&&(a.checked=!a.checked,e.classList.toggle("aipkit_active",a.checked),e.setAttribute("aria-pressed",a.checked),a.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"),console.log("AIPKit Voice Input Toggle Handler Initialized."))}window.aipkit_initVoiceInputToggle=r,window.aipkit_setInitialVoiceInputToggleState=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}typeof window.aipkit_initChatAiSettingsToggle=="function"?window.aipkit_initChatAiSettingsToggle():console.error("AIPKit Chat Fields: aipkit_initChatAiSettingsToggle function not found."),typeof window.aipkit_initWebSearchToggle=="function"?window.aipkit_initWebSearchToggle():console.error("AIPKit Chat Fields: aipkit_initWebSearchToggle function not found."),typeof window.aipkit_initStreamModeToggle=="function"?window.aipkit_initStreamModeToggle():console.error("AIPKit Chat Fields: aipkit_initStreamModeToggle function not found."),typeof window.aipkit_initStatefulConvToggle=="function"?window.aipkit_initStatefulConvToggle():console.error("AIPKit Chat Fields: aipkit_initStatefulConvToggle function not found."),typeof window.aipkit_initImageUploadToggle=="function"?window.aipkit_initImageUploadToggle():console.error("AIPKit Chat Fields: aipkit_initImageUploadToggle function not found."),typeof window.aipkit_initVoiceInputToggle=="function"?window.aipkit_initVoiceInputToggle():console.error("AIPKit Chat Fields: aipkit_initVoiceInputToggle function not found."),r.addEventListener("change",function(n){let t=n.target.closest(".aipkit_chatbot_provider_select");if(t){let u=t.closest(".aipkit_chatbot-settings-area");u?(window.aipkit_toggleChatbotModelFields(u),window.aipkit_toggleOpenAISpecificSettingsVisibility(u),window.aipkit_toggleGoogleSpecificSettingsVisibility(u)):console.warn("AIPKit Chat Fields: Could not find parent .aipkit_chatbot-settings-area for provider select:",t);return}let e=n.target.closest(".aipkit_stt_provider_select");if(e){let u=e.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u?window.aipkit_toggleSttModelFields(u):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",e);return}let o=n.target.closest(".aipkit_vector_store_toggle_switch");if(o){let u=o.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&(window.aipkit_toggleVectorStoreSettingsVisibility(u),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(u));return}let a=n.target.closest(".aipkit_vector_store_provider_select");if(a){let u=a.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_toggleVectorStoreProviderFields(u);return}let s=n.target.closest(".aipkit_vector_embedding_provider_select");if(s){let u=s.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_populateVectorEmbeddingModelSelect(u);return}let l=n.target.closest(".aipkit_openai_web_search_enable_toggle");if(l){let u=l.closest(".aipkit_chatbot-settings-area");u&&window.aipkit_toggleOpenAIWebSearchSubSettings(u);return}let d=n.target.closest(".aipkit_openai_web_search_loc_type_select");if(d){let u=d.closest(".aipkit_chatbot-settings-area");u&&window.aipkit_toggleOpenAIWebSearchLocationDetails(u);return}let p=n.target.closest(".aipkit_google_search_grounding_enable_toggle");if(p){let u=p.closest(".aipkit_chatbot-settings-area");u&&window.aipkit_toggleGoogleSearchGroundingSubSettings(u);return}let _=n.target.closest(".aipkit_google_grounding_mode_select");if(_){let u=_.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_toggleGoogleGroundingDynamicThreshold(u);return}}),r.querySelectorAll(".aipkit_chatbot-settings-area").forEach(n=>{n.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(n),window.aipkit_toggleOpenAISpecificSettingsVisibility(n),window.aipkit_toggleGoogleSpecificSettingsVisibility(n)),n.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(n),n.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(n),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(n))}),console.log("AIPKit Chat Fields: Delegated event listener initialized on #aipkit_chatbot_main_tab_content_container.")}window.aipkit_initProviderSelectToggles=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.querySelector(".aipkit_chatbot_provider_select");if(!i)return;let n=i.value;r.querySelectorAll(".aipkit_chatbot_model_field").forEach(o=>{o.style.display="none";let a=o.querySelector(".aipkit_cb_web_search_toggle");a&&(a.style.display="none");let s=o.querySelector(".aipkit_cb_stateful_conv_toggle");s&&(s.style.display="none");let l=o.querySelector(".aipkit_cb_image_upload_toggle");l&&(l.style.display="none");let d=o.querySelector(".aipkit_cb_voice_input_toggle");d&&(d.style.display="none")});let e=r.querySelector(`.aipkit_chatbot_model_field[data-provider="${n}"]`);if(e){e.style.display="block",typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(r),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(r);let o=e.querySelector(".aipkit_cb_web_search_toggle");o&&(o.dataset.provider||"").split(" ").includes(n)&&(o.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(r));let a=e.querySelector(".aipkit_cb_stateful_conv_toggle");a&&n==="OpenAI"&&(a.style.display="inline-flex");let s=e.querySelector(".aipkit_cb_image_upload_toggle");s&&(n==="OpenAI"?(s.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(r)):s.style.display="none");let l=e.querySelector(".aipkit_cb_voice_input_toggle");l&&(l.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(r))}}window.aipkit_toggleChatbotModelFields=c})();(function(){"use strict";function c(r){r&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(r)}window.aipkit_toggleOpenAISpecificSettingsVisibility=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.querySelector(".aipkit_chatbot_provider_select"),n=i?i.value==="OpenAI":!1,t=r.querySelector(".aipkit_openai_web_search_enable_toggle"),e=r.querySelector(".aipkit_openai_web_search_conditional_settings");if(!t||!e)return;let o=t.checked;if(e.style.display=n&&o?"block":"none",n&&o)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(r);else{let a=r.querySelector(".aipkit_openai_web_search_location_details");a&&(a.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.querySelector(".aipkit_openai_web_search_enable_toggle"),n=r.querySelector(".aipkit_openai_web_search_loc_type_select"),t=r.querySelector(".aipkit_openai_web_search_location_details");if(!i||!n||!t){t&&(t.style.display="none");return}let e=i.checked,o=n.value==="approximate";t.style.display=e&&o?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=c})();(function(){"use strict";function c(r){r&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(r)}window.aipkit_toggleGoogleSpecificSettingsVisibility=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.querySelector(".aipkit_chatbot_provider_select"),n=i?i.value==="Google":!1,t=r.querySelector(".aipkit_google_search_grounding_enable_toggle"),e=r.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!t||!e)return;let o=t.checked,a=n&&o;e.style.display=a?"block":"none",a?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(r):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(r,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=c})();(function(){"use strict";function c(r,i=null){if(!r)return;let n=r.querySelector(".aipkit_google_grounding_mode_select"),t=r.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),e=r.querySelector(".aipkit_google_search_grounding_enable_toggle"),o=r.querySelector(".aipkit_google_search_grounding_conditional_settings"),a=o&&o.style.display==="none";if(!n||!t||!e){t&&(t.style.display="none");return}if(a){t.style.display="none";return}let s=i!==null?i:e.checked&&n.value==="MODE_DYNAMIC";t.style.display=s?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.querySelector(".aipkit_stt_provider_select");if(!i)return;let n=i.value;r.querySelectorAll(".aipkit_stt_model_field").forEach(e=>{e.style.display=e.getAttribute("data-stt-provider")===n?"block":"none"})}window.aipkit_toggleSttModelFields=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.querySelector(".aipkit_vector_store_toggle_switch"),n=r.querySelector(".aipkit_vector_store_settings_conditional_row"),t=r.querySelector(".aipkit_vector_store_top_k_field");if(!i||!n)return;let e=i.checked;n.style.display=e?"block":"none",t&&(t.style.display=e?"block":"none"),e?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(r):r.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_embedding_config_row").forEach(o=>o.style.display="none")}window.aipkit_toggleVectorStoreSettingsVisibility=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.querySelector(".aipkit_vector_store_provider_select"),n=r.querySelector(".aipkit_vector_store_toggle_switch");if(!i||!n)return;let t=i.value,e=n.checked,o=r.querySelector(".aipkit_vector_store_openai_field"),a=r.querySelector(".aipkit_vector_store_pinecone_field"),s=r.querySelector(".aipkit_vector_store_qdrant_field"),l=r.querySelector(".aipkit_vector_store_embedding_config_row"),d=r.querySelector(".aipkit_vector_store_top_k_field");o&&(o.style.display=e&&t==="openai"?"block":"none"),a&&(a.style.display=e&&t==="pinecone"?"block":"none"),s&&(s.style.display=e&&t==="qdrant"?"block":"none"),l&&(l.style.display=e&&(t==="pinecone"||t==="qdrant")?"block":"none"),d&&(d.style.display=e?"block":"none"),e&&t==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(r):e&&t==="pinecone"&&(typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(r),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(r),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(r))}window.aipkit_toggleVectorStoreProviderFields=c})();(function(){"use strict";function c(r){let i=r.querySelector('select[name="openai_vector_store_ids[]"]'),n=window.aipkit_escapeHtml||function(o){return o};if(!i)return;let t=window.aipkit_chat_config?.openaiVectorStores||[],e=Array.from(i.options).filter(o=>o.selected).map(o=>o.value);i.innerHTML="",t.length>0&&t.forEach(o=>{if(o&&o.id){let a="(Files: N/A)";o.file_counts&&typeof o.file_counts.total=="number"?a=`(${o.file_counts.total} ${o.file_counts.total===1?"File":"Files"})`:o.file_counts&&(a="(Files: ?)");let s=`${n(o.name||o.id)} ${a}`,l=document.createElement("option");l.value=o.id,l.textContent=s+` (ID: ${n(o.id.substring(0,15))}...)`,e.includes(o.id)&&(l.selected=!0),i.appendChild(l)}}),e.forEach(o=>{if(!t.some(s=>s.id===o)&&!i.querySelector(`option[value="${CSS.escape(o)}"]`)){let s=document.createElement("option");s.value=o,s.textContent=`${n(o)} (Manual/Not Synced)`,s.selected=!0,i.appendChild(s)}}),i.options.length===0&&(i.innerHTML='<option value="" disabled>-- No Stores Found (Sync in AI Training) --</option>')}window.aipkit_populateOpenAIVectorStoresMultiSelect=c})();(function(){"use strict";function c(r){let i=r.querySelector('select[name="pinecone_index_name"]'),n=window.aipkit_escapeHtml||function(o){return o};if(!i)return;let t=window.aipkit_chat_config?.pineconeIndexes||[],e=i.value;if(i.innerHTML="",i.appendChild(new Option(n("-- Select Index --"),"")),t.length>0&&t.forEach(o=>{let a=o.name||o.id||"",s=o.name||a,l=o.total_vector_count!==void 0&&o.total_vector_count!==null&&o.total_vector_count!=="Error"&&o.total_vector_count!=="No Host"?` (Vectors: ${Number(o.total_vector_count).toLocaleString()})`:(o.total_vector_count||"")==="Error"||(o.total_vector_count||"")==="No Host"?" (Stats Err)":" (Vectors: ?)",d=n(s+l),p=new Option(d,a);a===e&&(p.selected=!0),i.appendChild(p)}),e&&!i.querySelector(`option[value="${CSS.escape(e)}"]`)){let o=new Option(n(e)+" (Manual/Not Synced)",e,!1,!0);i.appendChild(o),i.value=e}i.options.length<=1&&(i.innerHTML='<option value="" disabled>-- No Indexes Found (Sync in AI Settings) --</option>')}window.aipkit_populatePineconeIndexSelect=c})();(function(){"use strict";function c(r){let i=r.querySelector('select[name="vector_embedding_provider"]');i&&(i.value===""&&(i.value="openai"),i.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=c})();(function(){"use strict";function c(r){let i=r.querySelector('select[name="vector_embedding_provider"]'),n=r.querySelector('select[name="vector_embedding_model"]'),t=window.aipkit_escapeHtml||function(s){return s};if(!i||!n)return;let e=i.value,o=n.value;n.innerHTML="",n.appendChild(new Option(t("-- Select Model --"),""));let a=[];if(e==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?a=window.aipkit_chat_config.openaiEmbeddingModels:e==="google"&&window.aipkit_chat_config?.googleEmbeddingModels&&(a=window.aipkit_chat_config.googleEmbeddingModels),a.length>0&&a.forEach(s=>{if(s&&s.id){let l=new Option(t(s.name||s.id),s.id);s.id===o&&(l.selected=!0),n.appendChild(l)}}),o&&!n.querySelector(`option[value="${CSS.escape(o)}"]`)){let s=new Option(t(o)+" (Manual/Not Synced)",o,!1,!0);n.appendChild(s),n.value=o}n.options.length<=1&&(n.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.querySelector(".aipkit_vector_store_toggle_switch"),n=r.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),t=r.querySelector(".aipkit_file_upload_field_group");if(!i||!n||!t)return;let e=i.checked,o=n.dataset.isProPlan==="true",a=n.dataset.addonActive==="true",l=o&&a&&e,d="";o?a?e||(d='File upload requires "Enable Vector Store" to be active for this bot.'):d='The "File Upload" addon is not active. Please activate it in Add-ons.':d="File upload is a Pro feature. Please upgrade.",l?(n.disabled=!1,t.style.opacity="1",t.removeAttribute("title")):(n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change",{bubbles:!0}))),n.disabled=!0,t.style.opacity="0.5",t.setAttribute("title",d))}window.aipkit_toggleFileUploadAvailability=c})();(function(){"use strict";function c(i){if(!i)return;let n=i.querySelector('select[name="theme"]'),t=i.querySelector(".aipkit_custom_theme_settings_container");!n||!t||(t.style.display=n.value==="custom"?"block":"none")}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit Theme Toggle: Main content container not found.");return}i.dataset.themeSettingsListenerAttached||(i.addEventListener("click",function(n){n.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(n):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),i.addEventListener("change",function(n){let t=n.target;if(t.matches&&t.matches('select[name="theme"]')){let e=t.closest(".aipkit_chatbot-settings-area");e&&c(e)}}),i.dataset.themeSettingsListenerAttached="true"),i.querySelectorAll(".aipkit_chatbot-settings-area").forEach(n=>{c(n)}),console.log("AIPKit Theme Toggle & Reset: Initialized.")}window.aipkit_initChatThemeSettingsToggle=r})();(function(){"use strict";function c(r){let i=r.target.closest(".aipkit_reset_custom_theme_btn");if(!i)return;let n=i.dataset.botId,t=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!t){console.error("AIPKit Theme Reset: Main content container not found for bot",n);return}let e=t.querySelector(`#aipkit_bot_${n}_custom_theme_settings_container`),o=t.querySelector(`#aipkit_reset_theme_status_${n}`);if(!e||!o){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",n);return}let a=e.dataset.defaults;if(!a){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(o,"error","Error: Defaults not found.",2e3);return}try{let s=JSON.parse(a);e.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(d=>{let _=d.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(_&&_[1]){let u=_[1];if(Object.prototype.hasOwnProperty.call(s,u)){d.value=s[u]!==null?String(s[u]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});d.dispatchEvent(f)}else if(Object.prototype.hasOwnProperty.call(s,u+"_placeholder")){d.value=s[u+"_placeholder"]!==null?String(s[u+"_placeholder"]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});d.dispatchEvent(f)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(o,"success","\u2714 Reverted.",2e3)}catch(s){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",s),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(o,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=c})();(function(){"use strict";function c(i,n,t){let e=document.getElementById(i);if(!e)return;if(e.innerHTML="",!n||n.length===0){e.appendChild(new Option("(No voices found - Sync again)",""));return}e.appendChild(new Option("-- Select Voice --",""));let o={};n.forEach(s=>{let l=s.languageCodes[0]||"und";o[l]||(o[l]=[]),o[l].push(s)}),Object.keys(o).sort().forEach(s=>{let l=document.createElement("optgroup");try{let d=new Intl.DisplayNames(["en"],{type:"language"}).of(s.split("-")[0]);l.label=`${d} (${s})`}catch{l.label=s}o[s].sort((d,p)=>d.name.localeCompare(p.name)),o[s].forEach(d=>{let p=new Option(d.name,d.id);d.id===t&&(p.selected=!0),l.appendChild(p)}),e.appendChild(l)}),t&&!e.value&&(Array.from(e.options).some(l=>l.value===t)?e.value=t:console.warn(`AIPKit TTS: Saved Google voice ID "${t}" not found in synced list for ${i}.`))}function r(i){let n=i.getAttribute("data-target-select"),t=i.querySelector(".aipkit_spinner"),e=i.closest(".aipkit_form-group"),o=e?e.querySelector(".aipkit_form-help"):null;if(!n){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(o||console.error("AIPKit TTS Sync (Google): Could not find message container (.aipkit_form-help) for button:",i),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_setButtonText!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}i.disabled=!0,t&&(t.style.display="inline-block"),window.aipkit_setButtonText(i,"Syncing..."),o&&(o.textContent="",o.className="aipkit_form-help"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(s=>{if(s&&s.voices){let l=document.getElementById(n),d=l?l.value:"";c(n,s.voices,d);let p=document.getElementById("aipkit_google_tts_voices_json_main");p&&(p.dataset.voices=JSON.stringify(s.voices)),o&&window.aipkit_showTemporaryMessage(o,"success",s.message||"Sync successful!")}else throw new Error("Invalid response received from voice sync.")}).catch(s=>{console.error("AIPKit TTS Sync Error (Google):",s),o&&window.aipkit_showTemporaryMessage(o,"error",`Sync failed: ${s.message||"Unknown error"}`)}).finally(()=>{i.disabled=!1,t&&(t.style.display="none"),window.aipkit_setButtonText(i,"Sync Voices")})}window.aipkit_updateGoogleVoiceSelect=c,window.aipkit_handleSyncGoogleVoices=r})();(function(){"use strict";function c(i,n,t){let e=document.getElementById(i);if(!e){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${i} not found.`);return}if(e.innerHTML="",!n||n.length===0){if(e.appendChild(new Option("(No voices found - Sync in Main Settings)","")),t){let a=new Option(t+" (manual/not synced)",t,!1,!0);e.appendChild(a),e.value=t}return}e.appendChild(new Option("-- Select Voice --","")),n.sort((a,s)=>(a.name||a.id||"").localeCompare(s.name||s.id||""));let o=!1;if(n.forEach(a=>{let s=new Option(a.name,a.id);a.id===t&&(s.selected=!0,o=!0),e.appendChild(s)}),t&&!o){let a=!1;for(let s=0;s<e.options.length;s++)if(e.options[s].value===t){a=!0,e.value=t;break}if(!a){let s=new Option(t+" (manual/not synced)",t,!1,!0);e.appendChild(s),e.value=t,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${t}" not found in synced list for #${i}, added as manual.`)}}else!t&&e.options.length>0&&(e.value="")}function r(i,n,t){let e=document.getElementById(i);if(!e){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${i} not found.`);return}if(e.innerHTML="",!n||n.length===0){if(e.appendChild(new Option("(No models found - Sync in Main Settings)","")),t){let a=new Option(t+" (manual/not synced)",t,!1,!0);e.appendChild(a),e.value=t}return}e.appendChild(new Option("-- Select Model --","")),n.sort((a,s)=>(a.name||a.id||"").localeCompare(s.name||s.id||""));let o=!1;if(n.forEach(a=>{let s=a.id||"",l=a.name||s;if(!s)return;let d=new Option(l,s);s===t&&(d.selected=!0,o=!0),e.appendChild(d)}),t&&!o){let a=!1;for(let s=0;s<e.options.length;s++)if(e.options[s].value===t){a=!0,e.value=t;break}if(!a){let s=new Option(t+" (manual/not synced)",t,!1,!0);e.appendChild(s),e.value=t,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${t}" not found in synced list for #${i}, added as manual.`)}}else!t&&e.options.length>0&&(e.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=c,window.aipkit_chatTts_updateElevenLabsModelsSelect=r})();(function(){"use strict";function c(n,t){let e=n.querySelector(".aipkit_tts_conditional_settings"),o=n.querySelector(".aipkit_tts_auto_play_container");e&&(e.style.display=t?"block":"none"),o&&(o.style.display=t?"block":"none")}function r(n){let t=n.querySelector(".aipkit_tts_provider_select");if(!t)return;let e=t.value;n.querySelectorAll(".aipkit_tts_provider_settings").forEach(a=>{if(a.getAttribute("data-provider")===e){if(a.style.display="block",e==="OpenAI"){let s=a.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');s&&(s.style.display="block")}}else a.style.display="none"})}function i(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit TTS Settings: Main content container not found.");return}let t=typeof window.aipkit_updateGoogleVoiceSelect=="function",e=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",o=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",a=typeof window.aipkit_handleSyncGoogleVoices=="function";t||console.error("AIPKit TTS Settings: Google voice update function missing."),e||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),o||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),a||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),n.addEventListener("change",function(l){let d=l.target.closest(".aipkit_tts_toggle_switch"),p=l.target.closest(".aipkit_tts_provider_select");if(d){let _=d.closest(".aipkit_accordion-content");_&&(c(_,d.checked),d.checked&&r(_))}else if(p){let _=p.closest(".aipkit_accordion-content");_&&r(_)}}),n.addEventListener("click",function(l){let d=l.target.closest(".aipkit_sync_tts_voices_btn");d&&d.getAttribute("data-provider")==="Google"&&a&&window.aipkit_handleSyncGoogleVoices(d)}),n.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(l=>{let d=l.querySelector(".aipkit_tts_toggle_switch");d&&(c(l,d.checked),d.checked&&r(l));let p=l.querySelector('select[name="tts_google_voice_id"]');p&&!t&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync in Main Settings)</option>');let _=l.querySelector('select[name="tts_elevenlabs_voice_id"]');if(_&&e){let m="";if(_&&_.id){let w=_.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_voices_json_${m}`):null,k=g?g.dataset.voices:null;try{let w=k?JSON.parse(k):[],b=_.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(_.id,w,b)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",w),_.options.length<=1&&(_.innerHTML='<option value="">(Sync in Main Settings)</option>')}}else _&&_.options.length<=1&&(_.innerHTML='<option value="">(Sync in Main Settings)</option>');let u=l.querySelector('select[name="tts_elevenlabs_model_id"]');if(u&&o){let m="";if(u&&u.id){let w=u.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_models_json_${m}`):null,k=g?g.dataset.models:null;try{let w=k?JSON.parse(k):[],b=u.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(u.id,w,b)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",w),u.options.length<=1&&(u.innerHTML='<option value="">(Sync in Main Settings)</option>')}}else u&&u.options.length<=1&&(u.innerHTML='<option value="">(Sync in Main Settings)</option>');let f=l.querySelector('select[name="tts_openai_model_id"]');f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync models in Main Settings)</option>')}),console.log("AIPKit TTS Settings: Main UI Initialized.")}window.aipkit_initTtsSettingsUI=i})();(function(){"use strict";function c(r,i,n,t){let e=t||function(a){return a},o=`debug-pre-${e(n)}`;return`
            <div class="aipkit_log_debug_info" style="margin-top: 5px; border-top: 1px dashed #eee; padding-top: 4px;">
                <a href="#" class="aipkit_log_debug_toggle" aria-controls="${o}" aria-expanded="false" style="font-size: 0.9em; color: #555; text-decoration: none;">
                    <span class="dashicons dashicons-arrow-right-alt2"></span> ${e(r)}
                </a>
                <div id="${o}" style="display: none; margin-top: 3px; max-height: 150px; overflow: auto; background: #f0f0f0; padding: 5px; border-radius: 3px;">
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px; font-size: 0.85em; max-height: 120px; overflow-y: auto;">${e(i)}</pre>
                </div>
            </div>`}window.aipkit_createExpandableDetail=c})();(function(){"use strict";function c(r,i,n,t){let e=r.trigger_log_details||{},o=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(r.timestamp||null):r.timestamp||"N/A",a=`${r.message_id||"trigger"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,s='<div class="aipkit_single_trigger_log_entry">';if(s+=`<div class="aipkit_message_header">
                        <strong class="aipkit_trigger_log_main_title"><span class="dashicons dashicons-admin-generic"></span>Trigger Event</strong>`,o&&(s+=`<span class="aipkit_message_timestamp">${o}</span>`),s+="</div>",s+=`<div class="aipkit_trigger_log_summary">${t(r.content||"Trigger activity logged.")}</div>`,s+='<div class="aipkit_trigger_log_basic_details">',e.log_subtype!=="trigger_processing_start"&&(s+=`<div><strong>Trigger:</strong> ${t(e.trigger_name||"N/A")} (ID: ${t(e.trigger_id||"N/A")})</div>`),s+=`<div><strong>Processed Event:</strong> ${t(e.event_name_processed||"N/A")}</div>`,e.log_subtype==="trigger_evaluation")s+=`<div><strong>Conditions Met:</strong> ${e.conditions_met?"Yes":"No"}</div>`,e.conditions_summary&&typeof window.aipkit_createExpandableDetail=="function"?s+=window.aipkit_createExpandableDetail("Evaluation Summary",e.conditions_summary,`eval-${a}`,t):e.conditions_summary&&(s+=`<div><strong>Evaluation Summary:</strong> ${t(e.conditions_summary)}</div>`);else if(e.log_subtype==="action_execution_start"){let l=e.action_type?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(e.action_type.replace(/_/g," ")):e.action_type:"N/A";if(s+=`<div><strong>Action Started:</strong> ${t(l)}</div>`,e.action_payload_summary&&typeof window.aipkit_createExpandableDetail=="function"){let d="";typeof e.action_payload_summary=="object"?d=JSON.stringify(e.action_payload_summary,null,2):d=String(e.action_payload_summary),s+=window.aipkit_createExpandableDetail("Payload Summary",d,`payload-${a}`,t)}else e.action_payload_summary&&(s+=`<div><strong>Payload Summary:</strong> <pre>${t(JSON.stringify(e.action_payload_summary,null,2))}</pre></div>`)}else if(e.log_subtype==="action_execution_result"){let l=e.action_type?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(e.action_type.replace(/_/g," ")):e.action_type:"N/A",d=e.status?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(e.status):e.status:"N/A";s+=`<div><strong>Action Result:</strong> ${t(l)} - <strong>Status:</strong> ${t(d)}</div>`,e.result_summary&&typeof window.aipkit_createExpandableDetail=="function"?s+=window.aipkit_createExpandableDetail("Outcome Details",e.result_summary,`outcome-${a}`,t):e.result_summary&&(s+=`<div><strong>Outcome:</strong> ${t(e.result_summary)}</div>`),e.error_details&&(s+=`<div style="color: red;"><strong>Error Details:</strong> ${t(e.error_details)}</div>`)}else if(e.log_subtype==="form_submission_stored"&&(s+=`<div><strong>Form ID:</strong> ${t(e.form_id||"N/A")}</div>`,e.submitted_data_snapshot&&typeof window.aipkit_createExpandableDetail=="function")){let l="";typeof e.submitted_data_snapshot=="object"?l=JSON.stringify(e.submitted_data_snapshot,null,2):l=String(e.submitted_data_snapshot),s+=window.aipkit_createExpandableDetail("Submitted Form Data",l,`formdata-${a}`,t)}return s+="</div>",s+="</div>",s}window.aipkit_renderTriggerLogEntryHTML=c})();(function(){"use strict";function c(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}function r(i,n,t,e,o,a){let s=o||function(m){return m},l=a||c,d=window.aipkit_chat_config||{},p=d.isProPlan&&d.isTriggersAddonActive,_=null;if(typeof n=="object"&&n!==null&&Array.isArray(n.messages)?_=n.messages:Array.isArray(n)&&(_=n),!_||_.length===0){i.innerHTML=`<p style="text-align:center;padding:20px;font-style:italic;">${e.noLogsFound||"No conversation history found."}</p>`;return}let u=null;window.markdownit&&(u=window.markdownit({html:!1,linkify:!0,typographer:!0}),window.hljs&&typeof window.markdownitHighlight=="function"&&u.use(window.markdownitHighlight,{hljs:window.hljs}));let f="";for(let m=0;m<_.length;m++){let g=_[m],k=g.role==="assistant"||g.role==="model"?"bot":g.role||"unknown",w=g.message_id||"msg-"+Math.random().toString(16).slice(2)+m;if(k==="user"||k==="bot"){let b=g.content||"",y=g.provider||"",h=g.model||"",v=g.timestamp||null,S=g.feedback||null,I=g.usage||null,E=I?I.total_tokens??I.totalTokenCount??null:null,P=k==="bot"&&(g.request_payload||null),T=k==="bot"&&b.toLowerCase().startsWith("error:"),x="";k==="bot"?x=t.bot_name||e.logBotLabel||"Bot":k==="user"?x=t.user_display_name||e.logUserLabel||"User":x=l(k);let A=k==="bot"?"aipkit_message_bot":"aipkit_message_user";T&&(A+=" aipkit_message_error");let C=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(v):v||"",q=u?u.render(b):s(b).replace(/\n/g,"<br>");if(f+=`<div class="aipkit_message ${A}" id="${s(w)}">`,f+=`<div class="aipkit_message_header"><strong>${s(x)}:</strong>`,C&&(f+=`<span class="aipkit_message_timestamp">${C}</span>`),f+="</div>",f+=`<div>${q}</div>`,k==="bot"&&(y||h||E!==null)){let L=[];y&&L.push(`${y}`),h&&L.push(`${h}`),E!==null&&E>0&&L.push(`${Number(E).toLocaleString()} tokens`),L.length>0&&(f+=`<div class="aipkit_bot_model_label">${s(L.join(" / "))}</div>`)}if(S&&(f+=`<span class="dashicons ${S==="up"?"dashicons-thumbs-up":"dashicons-thumbs-down"} aipkit_log_detail_feedback_indicator ${S==="up"?"aipkit_feedback_up":"aipkit_feedback_down"}" title="${s(S==="up"?"Liked":"Disliked")}"></span>`),k==="bot"&&P&&typeof window.aipkit_createExpandableDetail=="function"){let L=`aipkit-debug-${w}`;f+=window.aipkit_createExpandableDetail("Request Payload",JSON.stringify(P,null,2),L,s)}f+="</div>";let N="",O=0;for(let L=m+1;L<_.length;L++){let $=_[L];if($.role==="system"&&$.event_sub_type==="trigger_log"&&$.trigger_log_details&&typeof window.aipkit_renderTriggerLogEntryHTML=="function")N+=window.aipkit_renderTriggerLogEntryHTML($,t,e,s),O++;else break}if(O>0&&p){let L=`trigger_details_for_${s(w)}`;f+='<div class="aipkit_message_related_triggers">',f+=`<a href="#" class="aipkit_trigger_activity_toggle" aria-controls="${L}" aria-expanded="false">
<span class="dashicons dashicons-arrow-right-alt2"></span>
${s(O===1?"Show Trigger Log":`Show ${O} Trigger Logs`)}
</a>`,f+=`<div class="aipkit_trigger_activity_details" id="${L}" style="display:none;">${N}</div>`,f+="</div>",m+=O}else O>0&&!p&&(m+=O)}else g.role==="system"&&g.event_sub_type==="trigger_log"&&g.trigger_log_details&&typeof window.aipkit_renderTriggerLogEntryHTML=="function"&&(f+=window.aipkit_renderTriggerLogEntryHTML(g,t,e,s))}i.innerHTML=f}window.aipkit_renderChatConversation=r})();(function(){"use strict";function c(r,i,n,t,e,o){let a=e||function(v){return v},s=window.aipkit_escapeAttribute||a,l=o||function(v){return v?v.charAt(0).toUpperCase()+v.slice(1):""},d=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)&&i.messages.length>0)d=i.messages[0];else{r.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">Invalid log data format for Image Generator.</p>';return}let p=d.request_payload||{},_=d.response_data||{},u=d.content||"",f=d.provider||"N/A",m=d.model||"N/A",g=d.timestamp||n.created_at,k=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(g):g||"N/A",w=u.startsWith("Error:"),b=p.prompt||"N/A",y=null;_.images&&_.images[0]&&_.images[0].revised_prompt&&(y=_.images[0].revised_prompt);let h='<div class="aipkit_log_image_gen_details" style="font-size: 13px;">';if(h+=`<p><strong>Time:</strong> ${a(k)}</p>`,h+=`<p><strong>Provider:</strong> ${a(f)}</p>`,h+=`<p><strong>Model:</strong> ${a(m)}</p>`,h+="<h5>Request Details:</h5><ul>",h+=`<li><strong>Prompt:</strong> ${a(b)}</li>`,h+=`<li><strong>Size:</strong> ${a(p.options?.size||"N/A")}</li>`,h+=`<li><strong>Number:</strong> ${a(p.options?.n||"N/A")}</li>`,p.options?.quality&&(h+=`<li><strong>Quality:</strong> ${a(p.options.quality)}</li>`),p.options?.style&&(h+=`<li><strong>Style:</strong> ${a(p.options.style)}</li>`),h+="</ul><h5>Response:</h5>",w?(h+=`<p style="color: red;">${a(u)}</p>`,_.error_code&&(h+=`<p><strong>Error Code:</strong> ${a(_.error_code)}</p>`)):(y&&(h+=`<p><strong>Revised Prompt:</strong><br><em style="font-size: 0.95em;">${a(y)}</em></p>`),_.images&&_.images.length>0?(h+='<div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">',_.images.forEach((v,S)=>{let I=v.media_library_url||v.url;h+='<div style="flex: 0 0 100px; border: 1px solid #ccc; padding: 5px; border-radius: 3px; text-align: center;">',I?h+=`<a href="${s(I)}" target="_blank" rel="noopener noreferrer"><img src="${s(I)}" alt="Generated Image ${S+1}" style="max-width: 90px; height: auto; display: block; margin: 0 auto 5px;"></a>`:v.has_b64?h+='<span style="font-size: 10px; color: #777;">(Base64 Image)</span>':h+='<span style="font-size: 10px; color: #777;">(No URL)</span>',h+="</div>"}),h+="</div>"):h+=`<p><em>${a(u)}</em></p>`),p&&typeof window.aipkit_createExpandableDetail=="function"){let v=`aipkit-debug-${d.message_id||"imgpayload"}`;h+=window.aipkit_createExpandableDetail("Request Data",JSON.stringify(p,null,2),v,a)}h+="</div>",r.innerHTML=h}window.aipkit_renderImageGeneratorLog=c})();(function(){"use strict";function c(r,i,n,t,e,o){let a=e||function(I){return I},s=o||function(I){return I?I.charAt(0).toUpperCase()+I.slice(1):""},l=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)&&i.messages.length>0)l=i.messages[0];else{r.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">Invalid log data format for Post Enhancer.</p>';return}let d=l.content||"",p=l.provider||"N/A",_=l.model||"N/A",u=l.timestamp||n.created_at,f=l.usage||null,m=f?f.total_tokens??f.totalTokenCount??null:null,g=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(u):u||"N/A",k=d.match(/Post ID: (\d+)/),w=k?k[1]:"N/A",b=d.match(/Prompt Snippet: (.*?)\.\.\./s),y=b?b[1]:"(Not found)",h=d.match(/Result:\n(.*)/s),v=h?h[1].trim():d,S='<div class="aipkit_log_enhancer_details">';if(S+=`<p><strong>Post ID:</strong> ${a(w)}</p>`,S+=`<p><strong>Time:</strong> ${a(g)}</p>`,S+=`<p><strong>Provider:</strong> ${a(p)}</p>`,S+=`<p><strong>Model:</strong> ${a(_)}</p>`,m!==null&&(S+=`<p><strong>Tokens Used:</strong> ${Number(m).toLocaleString()}</p>`),S+=`<h5>Prompt Snippet:</h5><pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px;">${a(y)}...</pre>`,S+="<h5>Result:</h5>",d.startsWith("Error:")?S+=`<p style="color: red;">${a(d)}</p>`:S+=`<pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px;">${a(v)}</pre>`,l.request_payload&&typeof window.aipkit_createExpandableDetail=="function"){let I=`aipkit-debug-${l.message_id||"enhancerpayload"}`;S+=window.aipkit_createExpandableDetail("Request Payload",JSON.stringify(l.request_payload,null,2),I,a)}S+="</div>",r.innerHTML=S}window.aipkit_renderPostEnhancerLog=c})();(function(){"use strict";function c(r,i,n,t,e,o){let a=e||function(u){return u},s=null;window.markdownit&&(s=window.markdownit({html:!1,linkify:!0,typographer:!0}),window.hljs&&typeof window.markdownitHighlight=="function"&&s.use(window.markdownitHighlight,{hljs:window.hljs}));let l=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)&&(l=i.messages),!l||l.length===0){r.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">No log data found.</p>';return}let d=l.find(u=>u.role==="user"),p=l.find(u=>u.role==="bot"),_='<div class="aipkit_log_generic_details">';if(d){let u=d.request_payload||{},f=d.content?d.content.replace("AI Form Submission (ID: "+(u.form_id||"")+"): ",""):"AI Form Submission",m=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(d.timestamp):d.timestamp||"";if(_+='<div class="aipkit_message aipkit_message_user">',_+=`<div class="aipkit_message_header"><strong>${a(f)}</strong>`,m&&(_+=`<span class="aipkit_message_timestamp">${m}</span>`),_+="</div>",u.inputs&&Object.keys(u.inputs).length>0){_+="<h5>Submitted Data:</h5><ul>";for(let g in u.inputs)if(Object.hasOwnProperty.call(u.inputs,g)){let k=u.inputs[g];_+=`<li><strong>${a(g)}:</strong> ${a(k)}</li>`}_+="</ul>"}u.constructed_prompt&&typeof window.aipkit_createExpandableDetail=="function"&&(_+=window.aipkit_createExpandableDetail("Constructed Prompt Sent to AI",u.constructed_prompt,`aipkit-debug-prompt-${d.message_id||"prompt"}`,a)),_+="</div>"}if(p){let u=p.provider||"N/A",f=p.model||"N/A",m=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(p.timestamp):p.timestamp||"",g=p.usage||null,k=g?g.total_tokens??g.totalTokenCount??null:null,w=p.content||"",b=w.toLowerCase().startsWith("error:"),y=s?s.render(w):a(w).replace(/\n/g,"<br>");_+=`<div class="aipkit_message aipkit_message_bot ${b?"aipkit_message_error":""}">`,_+='<div class="aipkit_message_header"><strong>AI Response:</strong>',m&&(_+=`<span class="aipkit_message_timestamp">${m}</span>`),_+="</div>";let v=[];u!=="N/A"&&v.push(`${u}`),f!=="N/A"&&v.push(`${f}`),k!==null&&k>0&&v.push(`${Number(k).toLocaleString()} tokens`),v.length>0&&(_+=`<div class="aipkit_bot_model_label">${a(v.join(" / "))}</div>`),_+=`<div>${y}</div>`,p.request_payload&&typeof window.aipkit_createExpandableDetail=="function"&&(_+=window.aipkit_createExpandableDetail("Full Request Payload",JSON.stringify(p.request_payload,null,2),`aipkit-debug-payload-${p.message_id||"payload"}`,a)),_+="</div>"}_+="</div>",r.innerHTML=_}window.aipkit_renderAiFormsLog=c})();(function(){"use strict";function c(r,i,n,t,e,o){let a=e||function(w){return w},s=o||function(w){return w?w.charAt(0).toUpperCase()+w.slice(1):""},l=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)&&i.messages.length>0)l=i.messages[0];else if(Array.isArray(i)&&i.length>0)l=i[0];else{r.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">Unknown log data format.</p>';return}let d=l.content||"(No Content)",p=l.provider||"N/A",_=l.model||"N/A",u=l.timestamp||n.created_at,f=l.usage||null,m=f?f.total_tokens??f.totalTokenCount??null:null,g=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(u):u||"N/A",k='<div class="aipkit_log_generic_details">';k+=`<p><strong>Time:</strong> ${a(g)}</p>`,k+=`<p><strong>Provider:</strong> ${a(p)}</p>`,k+=`<p><strong>Model:</strong> ${a(_)}</p>`,m!==null&&(k+=`<p><strong>Tokens Used:</strong> ${Number(m).toLocaleString()}</p>`),k+=`<h5>Log Content:</h5><pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px;">${a(d)}</pre>`,k+="</div>",r.innerHTML=k}window.aipkit_renderGenericLog=c})();(function(){"use strict";function c(r){r.querySelectorAll(".aipkit_log_debug_toggle").forEach(i=>{let n=i.cloneNode(!0),t=i.parentNode;t&&t.replaceChild(n,i),n.addEventListener("click",e=>{e.preventDefault();let o=n.getAttribute("aria-controls"),a=document.getElementById(o);if(a){let s=a.style.display==="block";a.style.display=s?"none":"block",n.setAttribute("aria-expanded",!s);let l=n.querySelector(".dashicons");l&&(l.className=s?"dashicons dashicons-arrow-right-alt2":"dashicons dashicons-arrow-down-alt2")}})})}window.aipkit_attachDebugToggleListeners=c})();(function(){"use strict";function c(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}function r(i){let n=document.getElementById("aipkit_log_detail_view");if(!n)return;let t=n.querySelector("#aipkit_log_detail_title"),e=n.querySelector("#aipkit_log_detail_ip"),o=n.querySelector("#aipkit_log_detail_conversation"),a=window.aipkit_dashboard?.text||{},s=window.aipkit_escapeHtml||function(g){return g},l=window.aipkit_ucfirst||c,d=i.user_display_name||(i.is_guest?a.guestLabel||"Guest":a.unknownUserLabel||"Unknown User"),p=i.bot_name;!p&&i.module?p=`(${l(i.module.replace(/_/g," "))})`:p||(p="(Unknown Source)"),t&&(t.textContent=`${d} with ${p}`);let _=a.logIpLabel||"IP";if(i.ip_address&&e?e.innerHTML=`<strong>${s(_)}:</strong> ${s(i.ip_address)}`:e&&(e.innerHTML=""),!o)return;let u=i.messages||"[]",f;try{f=JSON.parse(u)}catch(g){console.error("AIPKit Log Detail Renderer: Failed to parse messages JSON.",g),o.innerHTML='<p style="color:red;text-align:center;padding:15px;">Error parsing log data.</p>';return}let m=i.module||"chat";m==="image_generator"&&typeof window.aipkit_renderImageGeneratorLog=="function"?window.aipkit_renderImageGeneratorLog(o,f,i,a,s,l):m==="ai_forms"&&typeof window.aipkit_renderAiFormsLog=="function"?window.aipkit_renderAiFormsLog(o,f,i,a,s,l):(m==="chat"||m==="chat_trigger_system")&&typeof window.aipkit_renderChatConversation=="function"?window.aipkit_renderChatConversation(o,f,i,a,s,l):m==="ai_post_enhancer"&&typeof window.aipkit_renderPostEnhancerLog=="function"?window.aipkit_renderPostEnhancerLog(o,f,i,a,s,l):typeof window.aipkit_renderGenericLog=="function"?window.aipkit_renderGenericLog(o,f,i,a,s,l):o.innerHTML=`<p style="color:red;text-align:center;padding:15px;">Error: Log rendering function missing for module type '${m}'.</p>`,o.scrollTop=0,typeof window.aipkit_attachDebugToggleListeners=="function"&&window.aipkit_attachDebugToggleListeners(o),o.querySelectorAll(".aipkit_trigger_activity_toggle").forEach(g=>{let k=g.cloneNode(!0),w=g.parentNode;w&&w.replaceChild(k,g),k.addEventListener("click",b=>{b.preventDefault();let y=k.getAttribute("aria-controls"),h=document.getElementById(y);if(h){let v=h.style.display==="block";h.style.display=v?"none":"block",k.setAttribute("aria-expanded",!v);let S=k.querySelector(".dashicons"),I=k.childNodes[k.childNodes.length-1];if(S&&(S.className=v?"dashicons dashicons-arrow-right-alt2":"dashicons dashicons-arrow-down-alt2"),I&&I.nodeType===Node.TEXT_NODE){let E=I.textContent.trim();v?I.textContent=E.replace("Hide","Show"):I.textContent=E.replace("Show","Hide")}}})})}window.aipkit_displayLogDetails=r})();(function(){"use strict";function c(){let i=document.getElementById("aipkit_log_table_view"),n=document.getElementById("aipkit_log_detail_view");if(!i||!n){console.warn("AIPKit Log Row Handler: Missing containers for logs or detail view.");return}let t="data-log-row-listener-attached";i.getAttribute(t)||(i.addEventListener("click",r),i.setAttribute(t,"true"),console.log("AIPKit Log Row Handler: Row click listener attached."))}function r(i){let n=i.target.closest(".aipkit_log_row");if(!n)return;let t=n.getAttribute("data-conversation-uuid"),e=n.getAttribute("data-bot-id"),o=n.getAttribute("data-user-id"),a=n.getAttribute("data-session-id");if(!t){console.error("AIPKit Log Row Handler: Missing conversation UUID from clicked row.");return}if(!o&&!a){console.error("AIPKit Log Row Handler: Missing User ID and Session ID from clicked row data.");return}let s=document.getElementById("aipkit_log_table_view");if(s){let m=s.querySelector(".aipkit_log_row.aipkit_selected");m&&m.classList.remove("aipkit_selected"),n.classList.add("aipkit_selected")}let l=document.getElementById("aipkit_log_detail_view");if(!l)return;let d=l.querySelector("#aipkit_log_detail_title"),p=l.querySelector("#aipkit_log_detail_ip"),_=l.querySelector("#aipkit_log_detail_conversation"),u=window.aipkit_dashboard?.text||{};d&&(d.textContent=u.logLoading||"Loading..."),p&&(p.innerHTML=""),_&&(_.innerHTML='<div class="aipkit_detail_spinner"></div>');let f={bot_id:e||null,conversation_uuid:t,user_id:o||null,session_id:a||null};if(typeof window.aipkit_displayLogDetails!="function"){console.error("AIPKit Log Row Handler: aipkit_displayLogDetails function is not defined globally."),_&&(_.innerHTML='<p style="color:red;">Error: Detail rendering function missing.</p>');return}aipkit_apiRequest("aipkit_admin_get_conversation_history",f).then(m=>{if(m&&m.log_data)window.aipkit_displayLogDetails(m.log_data);else throw new Error("Received invalid data for log details.")}).catch(m=>{console.error("AIPKit Log Row Handler: Error fetching log details:",m),d&&(d.textContent=u.logErrorLoading||"Error"),p&&(p.innerHTML=""),_&&(_.innerHTML=`<p style="color:red;text-align:center;padding:15px;">${u.logErrorLoading||"Failed to load details:"} ${window.aipkit_escapeHtml(m.message||"Unknown error")}</p>`)})}window.aipkit_initLogRowClickListener=c})();(function(){"use strict";function c(i=1){let n=document.getElementById("aipkit_logs_container");if(!n){console.error("AIPKit Chat Logs Fetch: Main logs module container (#aipkit_logs_container) not found.");return}let t=n.querySelector("#aipkit_log_table_view"),e=n.querySelector("#aipkit_log_detail_view"),o=window.aipkit_dashboard?.text||{};if(!t||!e){console.error("AIPKit Chat Logs Fetch: Required log containers (#aipkit_log_table_view or #aipkit_log_detail_view) not found inside #aipkit_logs_container.");return}t.innerHTML=`
          <p style="text-align:center; padding:30px;">
            <span class="aipkit_spinner"
                  style="display:inline-block;width:20px;height:20px;border-width:3px;vertical-align:middle;margin-right:10px;"
            ></span>
            ${o.logLoading||"Loading logs..."}
          </p>`;let a=e.querySelector("#aipkit_log_detail_title"),s=e.querySelector("#aipkit_log_detail_ip"),l=e.querySelector("#aipkit_log_detail_conversation"),d=o.logViewTitle||"Chat Log Details";a&&(a.textContent=d),s&&(s.innerHTML=""),l&&(l.innerHTML='<div class="aipkit_detail_spinner"></div>');let p=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{},_={log_page:i,filter_user_name:p.user_name||"",filter_chatbot_id:p.chatbot_id||"",filter_message_like:p.message_like||""};aipkit_apiRequest("aipkit_get_chat_logs_html",_).then(u=>{if(u&&u.html){t.innerHTML=u.html,r(),typeof window.aipkit_initLogRowClickListener=="function"?window.aipkit_initLogRowClickListener():console.error("AIPKit Logs Fetch: Cannot initialize row click listener."),typeof window.aipkit_initLogFiltersUI=="function"?window.aipkit_initLogFiltersUI():console.error("AIPKit Logs Fetch: Cannot initialize filter UI.");let f=t.querySelector(".aipkit_log_row");f?setTimeout(()=>{let m=t.querySelector(".aipkit_log_row");m&&m===f&&!t.querySelector(".aipkit_log_row.aipkit_selected")&&f.click()},100):(a&&(a.textContent=d),s&&(s.innerHTML=""),l&&(l.innerHTML=`<p style="text-align:center; padding:20px; font-style:italic;">${o.noLogsFound||"No logs found matching your criteria."}</p>`))}else throw new Error("Invalid HTML content for logs.")}).catch(u=>{console.error("AIPKit Chat Logs Fetch: Error fetching logs:",u),t.innerHTML=`<p style="color:red; text-align:center; padding:20px;">${o.logErrorLoading||"Failed to load logs:"} ${aipkit_escapeHtml(u.message||"Unknown error")}</p>`,a&&(a.textContent=d),s&&(s.innerHTML=""),l&&(l.innerHTML=`<p style="color:red; text-align:center; padding:15px;">${o.logErrorLoading||"Error loading logs."}</p>`)})}function r(){let i=document.getElementById("aipkit_log_table_view");if(!i)return;let n="data-pagination-listener-attached";i.getAttribute(n)||(i.addEventListener("click",function(t){let e=t.target.closest(".aipkit-log-footer .aipkit_pagination-links a");if(!(!e||!e.href)){t.preventDefault();try{let a=new URL(e.href).searchParams.get("log_page")||1;c(parseInt(a,10))}catch(o){console.error("AIPKit Logs Fetch: Error parsing pagination URL:",o)}}}),i.setAttribute(n,"true"))}window.aipkit_fetchAndDisplayLogs=c,window.aipkit_initLogPagination=r})();(function(){"use strict";let c={user_name:"",chatbot_id:"",message_like:""};function r(){return{...c}}function i(){return!!(c.user_name||c.chatbot_id||c.message_like)}function n(){let l=document.getElementById("aipkit_log_table_view");if(!l)return;a(l),s(l);let d={chatbot:"chatbot_id",user:"user_name",message:"message_like"};l.querySelectorAll(".aipkit_log_filter_btn").forEach(_=>{let u=_.getAttribute("data-filter-type");if(u==="module")return;let f=d[u];f&&c[f]?_.querySelector(".dashicons").className="dashicons dashicons-image-rotate":_.querySelector(".dashicons").className="dashicons dashicons-filter"});let p="data-log-filter-outside-click";document.body.getAttribute(p)||(document.addEventListener("click",function(_){let u=document.querySelector('.aipkit_log_filter_box[style*="display: block"]');if(!u)return;let f=u.getAttribute("data-filter-box"),m=document.querySelector(`.aipkit_log_filter_btn[data-filter-type="${f}"]`);!u.contains(_.target)&&(!m||!m.contains(_.target))&&(u.style.display="none")},!0),document.body.setAttribute(p,"true"))}function t(){let l=document.getElementById("aipkit_log_table_view");if(!l)return;let d="data-log-filter-delegate-listener";if(l.getAttribute(d))return;console.log("AIPKit Chat Logs Filters: Attaching delegated filter listeners.");let p={chatbot:"chatbot_id",user:"user_name",message:"message_like"};l.addEventListener("click",function(_){let u=_.target.closest(".aipkit_log_filter_btn");if(!u)return;let f=u.getAttribute("data-filter-type");if(!f||f==="module")return;let m=p[f];if(m)if(c[m])c[m]="",typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1);else{let g=l.querySelector(`.aipkit_log_filter_box[data-filter-box="${f}"]`);if(!g)return;l.querySelectorAll(".aipkit_log_filter_box").forEach(w=>{w!==g&&w.style.display==="block"&&(w.style.display="none")});let k=g.style.display==="none"||!g.style.display;if(g.style.display=k?"block":"none",k){let w=g.querySelector(".aipkit_log_filter_input, .aipkit_log_filter_select");w&&w.focus()}}}),l.addEventListener("change",e),l.addEventListener("keydown",e),l.setAttribute(d,"true")}function e(l){let d=l.target;d.matches(".aipkit_log_filter_select")&&l.type==="change"?o(d):d.matches(".aipkit_log_filter_input")&&l.type==="keydown"&&l.key==="Enter"&&(l.preventDefault(),o(d))}function o(l){let d=l.getAttribute("data-filter-field");if(!d)return;let p=l.value.trim();c[d]!==p&&(c[d]=p,typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1));let _=l.closest(".aipkit_log_filter_box");_&&(_.style.display="none")}function a(l){let d=document.getElementById("aipkit_available_bots_json");if(!d)return;let p=d.getAttribute("data-bots")||"[]",_=[];try{_=JSON.parse(p)}catch(f){console.error("AIPKit Logs Filters: Failed to parse chatbot JSON for filter",f);return}let u=l.querySelector('select[data-filter-field="chatbot_id"]');if(u){for(;u.options.length>1;)u.remove(1);Array.isArray(_)&&_.forEach(f=>{let m=document.createElement("option");m.value=f.id,m.textContent=f.title,u.appendChild(m)})}}function s(l){l.querySelectorAll(".aipkit_log_filter_input, .aipkit_log_filter_select").forEach(p=>{let _=p.getAttribute("data-filter-field");_&&c.hasOwnProperty(_)&&(p.value=c[_])})}window.aipkit_initLogFiltersUI=n,window.aipkit_attachLogFilterDelegatedListeners=t,window.aipkit_getCurrentLogFilters=r})();(function(){"use strict";let c=!1,r=!1;function i(){let k=document.getElementById("aipkit_log_table_view"),w=document.getElementById("aipkit_logs_container");if(!w){console.warn("AIPKit Log Actions: Main Logs container (#aipkit_logs_container) not found.");return}let b="data-log-bulk-action-listener-attached";w.getAttribute(b)?console.log("AIPKit Log Actions: Listeners already attached to static container."):(console.log("AIPKit Log Actions: Attaching delegated listeners to static container."),w.addEventListener("click",n),document.addEventListener("click",o,!0),w.setAttribute(b,"true"))}function n(k){let w=k.target.closest("#aipkit_log_bulk_actions_btn"),b=k.target.closest('.aipkit_log_action_menu_item[data-action="export-all"]'),y=k.target.closest('.aipkit_log_action_menu_item[data-action="delete-all"]'),h=k.target.closest(".aipkit_log_export_confirm_btn"),v=k.target.closest(".aipkit_log_delete_confirm_btn"),S=k.target.closest(".aipkit_log_action_cancel_btn");if(w)k.stopPropagation(),t();else if(b){if(k.stopPropagation(),e(),c||r){console.warn("AIPKit Log Actions: Another bulk action is already in progress.");return}a(!1)}else if(y){if(k.stopPropagation(),e(),c||r){console.warn("AIPKit Log Actions: Another bulk action is already in progress.");return}s(!1)}else h?(l(),_()):v?(l(),m()):S&&l()}function t(){let k=document.getElementById("aipkit_log_bulk_action_menu"),w=document.getElementById("aipkit_log_bulk_actions_btn");if(k&&w){let b=w.getBoundingClientRect();k.style.display=k.style.display==="block"?"none":"block",k.style.display==="block"&&(k.style.top=`${b.bottom+window.scrollY+2}px`,k.style.left=`${b.left+window.scrollX}px`)}}function e(){let k=document.getElementById("aipkit_log_bulk_action_menu");k&&(k.style.display="none")}function o(k){let w=document.getElementById("aipkit_log_bulk_action_menu"),b=document.getElementById("aipkit_log_bulk_actions_btn");w&&w.style.display==="block"&&!w.contains(k.target)&&(!b||!b.contains(k.target))&&e();let y=document.getElementById("aipkit_log_bulk_action_confirmation_area");if(y&&y.style.display==="block"&&!y.contains(k.target)){let h=document.querySelector(".aipkit_log_action_menu_item");(!h||!h.contains(k.target))&&l()}}function a(k){let w=window.aipkit_dashboard?.text||{},b=document.getElementById("aipkit_log_bulk_action_confirmation_area"),y=document.getElementById("aipkit_log_bulk_actions_btn");if(!b||!y)return;let h=!1;if(k){let I=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};h=Object.values(I).some(E=>E&&E!=="")}let v=k&&h?w.logExportFilteredConfirmMsg||"Export all messages matching current filters?":w.logExportAllConfirmMsg||"Export all messages? This might take a while for large datasets.";b.innerHTML=`
            <p>${v}</p>
            <div class="aipkit_log_bulk_action_confirmation_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_log_action_cancel_btn">${w.cancel||"Cancel"}</button>
                <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_log_export_confirm_btn">${w.confirm||"Confirm"}</button>
            </div>`,b.style.display="block",b.setAttribute("data-action-type","export");let S=y.getBoundingClientRect();b.style.top=`${S.bottom+window.scrollY+2}px`,b.style.right="auto",b.style.left=`${S.left+window.scrollX}px`,p()}function s(k){let w=window.aipkit_dashboard?.text||{},b=document.getElementById("aipkit_log_bulk_action_confirmation_area"),y=document.getElementById("aipkit_log_bulk_actions_btn");if(!b||!y)return;let h=!1;if(k){let E=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};h=Object.values(E).some(P=>P&&P!=="")}let v=k&&h?w.logDeleteFilteredConfirmMsg||"Delete all messages matching current filters? This cannot be undone.":w.logDeleteAllConfirmMsg||"Delete ALL messages? This will remove ALL chat history and cannot be undone.",S=k&&h?w.confirmDeleteFiltered||"Confirm Delete Filtered":w.confirmDeleteAll||"Confirm Delete ALL";b.innerHTML=`
            <p style="color:#c53030;font-weight:bold;">${v}</p>
            <div class="aipkit_log_bulk_action_confirmation_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_log_action_cancel_btn">${w.cancel||"Cancel"}</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_log_delete_confirm_btn">${S}</button>
            </div>`,b.style.display="block",b.setAttribute("data-action-type","delete");let I=y.getBoundingClientRect();b.style.top=`${I.bottom+window.scrollY+2}px`,b.style.right="auto",b.style.left=`${I.left+window.scrollX}px`,p()}function l(){let k=document.getElementById("aipkit_log_bulk_action_confirmation_area");k&&(k.style.display="none")}function d(k,w,b="info"){let y=document.getElementById("aipkit_log_bulk_action_status_area"),h=y?.querySelector(".aipkit_log_bulk_action_spinner"),v=y?.querySelector(".aipkit_log_bulk_action_message");!y||!h||!v||(v.textContent=k,h.style.display=w?"inline-block":"none",y.style.display="inline-flex",y.className=`aipkit_log_bulk_action_status_area aipkit_status-${b}`)}function p(){let k=document.getElementById("aipkit_log_bulk_action_status_area");k&&(k.style.display="none")}function _(){if(c||r)return;c=!0;let k=window.aipkit_dashboard?.text||{};d(k.logExportStarting||"Starting...",!0);let w=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};u(0,w,"",-1)}function u(k,w,b,y){let h=window.aipkit_dashboard?.text||{},v={page:k,total_count:y,filter_user_name:w.user_name||"",filter_chatbot_id:w.chatbot_id??"",filter_message_like:w.message_like||""},S=y>0?(h.logExportProgress||"Exporting conversation %d / %d...").replace("%d",k*50).replace("%d",y):h.logExportStarting||"Starting...";d(S,!0),aipkit_apiRequest("aipkit_export_chat_logs",v).then(I=>{let E=I.total_count??-1;if(E===0&&k===0){d(h.logExportNoLogs||"No messages found to export.",!1,"info"),setTimeout(p,3e3),c=!1;return}let P=I.csv_chunk||"",T=b+P,x=I.exported_count||0,A=I.is_last_batch||!1,C=E>0?E:x,q=(h.logExportProgress||"Exporting conversation %d / %d...").replace("%d",x).replace("%d",C);d(q,!0),A?(f(T),d(h.logExportComplete||"Done!",!1,"success"),setTimeout(p,4e3),c=!1):setTimeout(()=>{u(k+1,w,T,E)},100)}).catch(I=>{console.error("AIPKit Log Export: Error fetching export batch:",I),d(`${h.logExportError||"Export failed:"} ${I.message}`,!1,"error"),setTimeout(p,6e3),c=!1})}function f(k){if(!k)return;let w="\uFEFF",b=new Blob([w+k],{type:"text/csv;charset=utf-8;"}),y=document.createElement("a"),h=URL.createObjectURL(b),S=new Date().toISOString().slice(0,10);y.setAttribute("href",h),y.setAttribute("download",`aipkit-chat-logs-${S}.csv`),y.style.visibility="hidden",document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(h)}function m(){if(c||r)return;r=!0;let k=window.aipkit_dashboard?.text||{};d(k.logDeleteStarting||"Starting...",!0,"info");let w=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};g(0,w,0,-1)}function g(k,w,b,y){let h=window.aipkit_dashboard?.text||{},v={page:k,deleted_count:b,total_count:y,filter_user_name:w.user_name||"",filter_chatbot_id:w.chatbot_id??"",filter_message_like:w.message_like||""},S=y>0?(h.logDeleteProgress||"Deleting conversation %d / %d...").replace("%d",b).replace("%d",y):h.logDeleteStarting||"Starting...";d(S,!0,"info"),aipkit_apiRequest("aipkit_delete_chat_logs",v).then(I=>{let E=I.total_count??-1;if(E===0&&k===0){d(h.logDeleteNoLogs||"No messages found to delete.",!1,"info"),setTimeout(p,3e3),r=!1;return}let P=I.deleted_total||b,T=I.is_last_batch||!1,x=E>0?E:P,A=(h.logDeleteProgress||"Deleting conversation %d / %d...").replace("%d",P).replace("%d",x);d(A,!0,"info"),T?(d(h.logDeleteComplete||"Done!",!1,"success"),setTimeout(()=>{p(),typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1)},3e3),r=!1):setTimeout(()=>{g(k+1,w,P,E)},200)}).catch(I=>{console.error("AIPKit Log Delete: Error processing delete batch:",I),d(`${h.logDeleteError||"Deletion failed:"} ${I.message}`,!1,"error"),setTimeout(p,6e3),r=!1})}window.aipkit_initLogBulkActions=i})();(function(){"use strict";function c(){if(console.log("AIPKit Logs Main: Initializing log components (aipkit_initLogs)..."),typeof window.aipkit_attachLogFilterDelegatedListeners=="function"?window.aipkit_attachLogFilterDelegatedListeners():console.error("AIPKit Logs Main: aipkit_attachLogFilterDelegatedListeners function not found."),typeof window.aipkit_fetchAndDisplayLogs=="function")window.aipkit_fetchAndDisplayLogs(1);else{console.error("AIPKit Logs Main: aipkit_fetchAndDisplayLogs function not found. Cannot fetch logs.");let r=document.getElementById("aipkit_log_table_view");r&&(r.innerHTML='<p style="color:red;">Error: Log fetching script failed to load.</p>')}typeof window.aipkit_initLogRowClickListener=="function"?window.aipkit_initLogRowClickListener():console.error("AIPKit Logs Main: aipkit_initLogRowClickListener function not found."),typeof window.aipkit_initLogBulkActions=="function"?window.aipkit_initLogBulkActions():console.error("AIPKit Logs Main: aipkit_initLogBulkActions function not found."),console.log("AIPKit Logs Main: Log components initialization sequence complete.")}window.aipkit_initLogs=c})();(function(){"use strict";function c(){let r=document.getElementById("chatbot-create-new-content");if(!r){console.warn("AIPKit Chat Creator: 'Create New' content pane not found.");return}let i=r.querySelector("#aipkit_create_new_bot_btn"),n=r.querySelector("#aipkit_new_bot_name"),t=r.querySelector("#aipkit_create_bot_message");if(!i||!n||!t){console.warn("AIPKit Chat Creator: Missing required elements (button, name input, or message div) within create pane.");return}let e=i.querySelector(".aipkit_spinner");i.addEventListener("click",function(){let o=n.value.trim();if(!o){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(t,"error","Please enter a name for the chatbot."):(t.textContent="Please enter a name for the chatbot.",t.style.color="red",setTimeout(()=>{t.textContent="",t.style.color=""},4e3)),n.focus();return}i.disabled=!0,e&&(e.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Creating..."):i.textContent="Creating...",t.textContent="",t.className="aipkit_form-help",aipkit_apiRequest("aipkit_create_chatbot",{bot_name:o}).then(a=>{let s=a.message||"Chatbot created!";typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(t,"success",s):(t.textContent=s,t.style.color="green",setTimeout(()=>{t.textContent="",t.style.color=""},4e3)),n.value="";let l=a.bot_id;if(!l){console.error("AIPKit Chat Creator: 'bot_id' missing in success response!",a),typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(t,"error","Creation succeeded but failed to get bot ID. Please reload."):(t.textContent="Creation succeeded but failed to get bot ID. Please reload.",t.style.color="red");return}aipkit_loadModule("chatbot",{force_active_bot_id:l},function(d){if(d){console.error("AIPKit Chat Creator: Error during module reload after creation:",d),typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(t,"error","Bot created, but UI failed to refresh. Please reload."):(t.textContent="Bot created, but UI failed to refresh. Please reload.",t.style.color="red");return}setTimeout(()=>{typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(l)},50)})}).catch(a=>{let s="Error: "+(a.message||"Unknown error during creation.");typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(t,"error",s):(t.textContent=s,t.style.color="red",setTimeout(()=>{t.textContent="",t.style.color=""},4e3))}).finally(()=>{i.disabled=!1,e&&(e.style.display="none"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Start Creating"):(i.textContent="Start Creating",e&&i.appendChild(e))})}),console.log("AIPKit Chat Creator: Create button initialized.")}window.aipkit_initCreateNewBot=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}r.addEventListener("submit",function(i){let n=i.target.closest(".aipkit_chatbot_settings_form");if(!n)return;i.preventDefault();let t=n.getAttribute("data-bot-id"),e=n.querySelector(".aipkit_save_bot_settings_btn"),o=document.getElementById("aipkit_chatbot_global_save_status_container"),a=n.querySelector(`#aipkit_action_feedback_${t}`);if(!t||!e||!o){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",n),o||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}a&&(a.innerHTML=""),o.textContent="",o.className="aipkit_save_status_container",e.disabled=!0,e.classList.add("aipkit_loading");let s=e.querySelector(".aipkit_spinner");if(s||(s=document.createElement("span"),s.className="aipkit_spinner",e.appendChild(s)),s.style.display="inline-block",typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(e,"Saving...");else{let _=Array.from(e.childNodes).find(u=>u.nodeType===Node.TEXT_NODE);_?_.textContent="Saving... ":e.insertBefore(document.createTextNode("Saving... "),e.firstChild)}let l=new FormData(n),d={};for(let[_,u]of l.entries())if(_.endsWith("[]")){let f=_.slice(0,-2);d[f]=l.getAll(_)}else d.hasOwnProperty(_)||(d[_]=u);d.bot_id=t,console.log("AIPKit Chat Saver: Data being sent to backend:",JSON.stringify(d,null,2));let p=d.provider;if(p==="OpenAI"?d.model=d.openai_model:p==="OpenRouter"?d.model=d.openrouter_model:p==="Google"?d.model=d.google_model:p==="Azure"?d.model=d.azure_deployment:p==="DeepSeek"?d.model=d.deepseek_model:d.model="",delete d.openai_model,delete d.openrouter_model,delete d.google_model,delete d.azure_deployment,delete d.deepseek_model,d.vector_store_provider==="openai"){let _=n.querySelector('select[name="openai_vector_store_ids[]"]');_?d.openai_vector_store_ids=Array.from(_.selectedOptions).map(u=>u.value):d.openai_vector_store_ids=[]}else d.hasOwnProperty("openai_vector_store_ids")&&delete d.openai_vector_store_ids;if(d.vector_store_provider==="pinecone"||d.vector_store_provider==="qdrant"){if(d.vector_store_provider==="qdrant"){let f=n.querySelector('select[name="qdrant_collection_name"]');f&&(d.qdrant_collection_name=f.value,console.log("Saving Qdrant collection:",d.qdrant_collection_name))}else if(d.vector_store_provider==="pinecone"){let f=n.querySelector('select[name="pinecone_index_name"]');f&&(d.pinecone_index_name=f.value,console.log("Saving Pinecone index:",d.pinecone_index_name))}let _=n.querySelector('select[name="vector_embedding_provider"]');_&&(d.vector_embedding_provider=_.value,console.log("Saving embedding provider:",d.vector_embedding_provider));let u=n.querySelector('select[name="vector_embedding_model"]');u&&(d.vector_embedding_model=u.value,console.log("Saving embedding model:",d.vector_embedding_model))}else delete d.pinecone_index_name,delete d.qdrant_collection_name,delete d.vector_embedding_provider,delete d.vector_embedding_model;aipkit_apiRequest("aipkit_save_chatbot_settings",d).then(_=>{o.textContent=_.message||"Settings Saved!",o.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(t)}).catch(_=>{o.textContent="Error: "+_.message,o.classList.add("error")}).finally(()=>{e.disabled=!1,e.classList.remove("aipkit_loading");let _=e.querySelector(".aipkit_spinner");if(_&&(_.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(e,"Save");else{let u=Array.from(e.childNodes).find(f=>f.nodeType===Node.TEXT_NODE);u?u.textContent="Save":e.insertBefore(document.createTextNode("Save"),e.firstChild),_&&e.appendChild(_)}setTimeout(()=>{o&&(o.textContent="",o.className="aipkit_save_status_container")},3e3)})}),console.log("AIPKit Chat Saver: Save listeners initialized on #aipkit_chatbot_main_tab_content_container.")}window.aipkit_initSaveBotSettings=c})();(function(){"use strict";function c(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit Chat Deleter: Main content container not found.");return}n.querySelectorAll(".aipkit_delete_bot_btn").forEach(t=>{t.getAttribute("data-is-default")==="1"&&(t.disabled=!0)}),n.addEventListener("click",function(t){let e=t.target.closest(".aipkit_delete_bot_btn");if(!e||e.disabled)return;let o=e.getAttribute("data-bot-id"),a=e.getAttribute("data-bot-name"),s=e.closest(".aipkit_chatbot_settings_form"),l=s?s.querySelector(`#aipkit_action_feedback_${o}`):null,d=document.getElementById("aipkit_chatbot_global_save_status_container");if(!o||!l){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",e);return}let p=`aipkit_delete_confirmation_${o}`,_=l.querySelector(`#${p}`);_||(_=document.createElement("div"),_.id=p,_.className="aipkit_confirmation_message aipkit_delete_confirmation",_.style.display="none",l.insertBefore(_,l.firstChild));let u=`aipkit_action_status_${o}`,f=l.querySelector(`#${u}`);if(f||(f=document.createElement("div"),f.id=u,f.className="aipkit_action_status_message",l.appendChild(f)),_.style.display!=="none"&&_.innerHTML!=="")return;d&&(d.textContent="",d.className="aipkit_save_status_container");let m=l.querySelector(".aipkit_reset_confirmation");m&&(m.style.display="none"),f.textContent="",f.className="aipkit_action_status_message",_.innerHTML=`
                <p>Delete <strong>${i(a)}</strong>? This cannot be undone.</p>
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm Delete</button>
                </div>
            `,_.style.display="block";let g=_.querySelector(".aipkit_delete_confirm_btn"),k=_.querySelector(".aipkit_delete_cancel_btn"),w=()=>{_.innerHTML="",_.style.display="none",r(e,o,f,d)},b=()=>{_.innerHTML="",_.style.display="none"};g.addEventListener("click",w,{once:!0}),k.addEventListener("click",b,{once:!0})}),console.log("AIPKit Chat Deleter: Delete listeners initialized.")}function r(n,t,e,o){let a=n.querySelector(".aipkit_spinner"),s=document.getElementById("aipkit_chatbot_main_selector_container");o&&(o.textContent="",o.className="aipkit_save_status_container"),e.textContent="",e.className="aipkit_action_status_message",n.disabled=!0,n.classList.add("aipkit_loading"),a&&(a.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(n,"Deleting..."):n.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:t}).then(l=>{e.textContent=l.message||"Chatbot deleted successfully.",e.classList.add("success");let d=!1;if(s){let _=s.querySelector(`.aipkit_tab_button[data-bot-id="${t}"]`),u=s.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${t}"]`);if(_)d=_.classList.contains("aipkit_active"),_.remove();else if(u){d=u.classList.contains("aipkit_active"),u.remove();let f=s.querySelector(".aipkit_tab_dropdown_menu");if(f&&f.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let g=f.closest(".aipkit_tab_dropdown_container");g&&(g.remove(),console.log("AIPKit Chat Deleter: Removed empty 'More Bots' dropdown."))}}}let p=document.getElementById(`chatbot-${t}-content`);if(p&&p.remove(),setTimeout(()=>{let _=document.getElementById(`aipkit_action_status_${t}`);_&&(_.textContent="",_.className="aipkit_action_status_message")},4e3),d){let _=s?.querySelector(".aipkit_tab_button_default");if(_)_.click();else{let u=s?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(u)u.click();else{let f=s?.querySelector(".aipkit_tab_dropdown_item");if(f)f.click();else{let m=s?.querySelector(".aipkit_create-new-button");if(m)m.click();else{let g=document.getElementById("aipkit_admin_chat_preview_container");g&&(g.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(l=>{e.textContent="Error: "+(l.message||"Failed to delete chatbot."),e.classList.add("error"),n.disabled=!1,n.classList.remove("aipkit_loading"),a&&(a.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(n,"Delete"),setTimeout(()=>{e&&(e.textContent="",e.className="aipkit_action_status_message")},5e3)})}function i(n){if(!n)return"";let t=document.createElement("div");return t.textContent=n,t.innerHTML}window.aipkit_initDeleteBot=c})();(function(){"use strict";function c(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit Chat Resetter: Main content container not found.");return}n.addEventListener("click",function(t){let e=t.target.closest(".aipkit_reset_bot_btn");if(!e||e.disabled)return;let o=e.getAttribute("data-bot-id"),a=e.getAttribute("data-bot-name"),s=e.closest(".aipkit_chatbot_settings_form"),l=s?s.querySelector(`#aipkit_action_feedback_${o}`):null,d=document.getElementById("aipkit_chatbot_global_save_status_container");if(!o||!l){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",e);return}let p=`aipkit_reset_confirmation_${o}`,_=l.querySelector(`#${p}`);_||(_=document.createElement("div"),_.id=p,_.className="aipkit_confirmation_message aipkit_reset_confirmation",_.style.display="none",l.insertBefore(_,l.firstChild));let u=`aipkit_action_status_${o}`,f=l.querySelector(`#${u}`);if(f||(f=document.createElement("div"),f.id=u,f.className="aipkit_action_status_message",l.appendChild(f)),_.style.display!=="none"&&_.innerHTML!=="")return;d&&(d.textContent="",d.className="aipkit_save_status_container");let m=l.querySelector(".aipkit_delete_confirmation");m&&(m.style.display="none"),f.textContent="",f.className="aipkit_action_status_message",_.innerHTML=`
                <p>Reset <strong>${i(a)}</strong> to defaults?</p>
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm Reset</button>
                </div>
            `,_.style.display="block";let g=_.querySelector(".aipkit_reset_confirm_btn"),k=_.querySelector(".aipkit_reset_cancel_btn"),w=()=>{_.innerHTML="",_.style.display="none",r(e,o,f,d)},b=()=>{_.innerHTML="",_.style.display="none"};g.addEventListener("click",w,{once:!0}),k.addEventListener("click",b,{once:!0})}),console.log("AIPKit Chat Resetter: Reset listeners initialized.")}function r(n,t,e,o){let a=n.querySelector(".aipkit_spinner");o&&(o.textContent="",o.className="aipkit_save_status_container"),e.textContent="",e.className="aipkit_action_status_message",n.disabled=!0,n.classList.add("aipkit_loading"),a&&(a.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(n,"Resetting..."):n.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:t}).then(s=>{e.textContent=s.message||"Chatbot reset successfully!",e.classList.add("success"),aipkit_loadModule("chatbot",{force_active_bot_id:t},function(l){l&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",l),e.textContent="Reset OK, but UI refresh failed. Reload page.",e.classList.add("error"))}),setTimeout(()=>{let l=document.getElementById(`aipkit_action_status_${t}`);l&&(l.textContent="",l.className="aipkit_action_status_message")},4e3)}).catch(s=>{e.textContent="Error: "+(s.message||"Failed to reset chatbot."),e.classList.add("error"),n.disabled=!1,n.classList.remove("aipkit_loading"),a&&(a.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(n,"Reset"),setTimeout(()=>{e&&(e.textContent="",e.className="aipkit_action_status_message")},5e3)})}function i(n){if(!n)return"";let t=document.createElement("div");return t.textContent=n,t.innerHTML}window.aipkit_initResetBot=c})();(function(){"use strict";function c(n,t=5,e=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(n)}catch(o){console.error("AIPKit Chat Preview: Error during chat initialization.",o),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else t>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${e}ms... (${t} retries left)`),setTimeout(()=>{c(n,t-1,e)},e)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function r(){let n=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),t=document.getElementById("aipkit_admin_chat_preview_container"),e=document.querySelector(".aipkit_chatbot-preview-column"),o=window.aipkit_dashboard?.text||{};if(!t||!e){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(t.innerHTML="",e.classList.remove("aipkit_loading"),n){let a=n.getAttribute("data-tab-type"),s=n.getAttribute("data-bot-id");a==="bot"&&s?i(s):a==="create"?t.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:a==="settings"?t.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:t.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?t.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:t.innerHTML=`<p class="aipkit_preview_placeholder">${o.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function i(n){let t=document.getElementById("aipkit_admin_chat_preview_container"),e=document.querySelector(".aipkit_chatbot-preview-column");if(!t||!e){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}e.classList.add("aipkit_loading"),t.innerHTML="";let o=new URL(window.aipkit_dashboard.ajaxurl);o.searchParams.append("action","aipkit_get_chatbot_shortcode"),o.searchParams.append("bot_id",n),o.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(o).then(a=>a.json()).then(a=>{if(a.success&&a.data&&a.data.html){t.innerHTML=a.data.html;let s=t.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");s?c(s):(console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${n} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,a.data.html),t.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>')}else{let s=a.data&&a.data.message?a.data.message:"Invalid response received for shortcode preview.";throw new Error(s)}}).catch(a=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${n}:`,a),t.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${a.message}</p>`}).finally(()=>{e.classList.remove("aipkit_loading")})}window.aipkit_loadInitialChatPreview=r,window.aipkit_refreshChatPreview=i})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Chat Accordions: Main content container not found.");return}r.addEventListener("click",function(i){let n=i.target.closest(".aipkit_accordion-header");if(!n)return;let t=n.closest(".aipkit_accordion");if(!t)return;let e=n.nextElementSibling;if(!e||!e.classList.contains("aipkit_accordion-content"))return;if(t.classList.contains("aipkit_popup_settings_accordion")){t.style.display!=="none"&&(n.classList.toggle("aipkit_active"),e.classList.toggle("aipkit_active"));return}let o=t.closest(".aipkit_accordion-group");o&&o.querySelectorAll(".aipkit_accordion").forEach(a=>{if(a!==t){let s=a.querySelector(".aipkit_accordion-header"),l=a.querySelector(".aipkit_accordion-content");s&&s.classList.contains("aipkit_active")&&s.classList.remove("aipkit_active"),l&&l.classList.contains("aipkit_active")&&l.classList.remove("aipkit_active")}}),n.classList.toggle("aipkit_active"),e.classList.toggle("aipkit_active")}),console.log("AIPKit Chat Accordions: Delegated event listener initialized.")}window.aipkit_initChatAccordions=c})();(function(){"use strict";function c(){let e=document.getElementById("aipkit_chatbot_main_tab_content_container");e&&(e.addEventListener("change",function(o){let a=o.target.closest(".aipkit_popup_toggle_switch");if(a){let d=a.closest(".aipkit_chatbot-settings-area");d&&(r(d,a.checked),n(d,a));return}let s=o.target.closest('input[name="popup_icon_type"]');if(s){let d=s.closest(".aipkit_chatbot-settings-area");d&&i(d,s.value);return}let l=o.target.closest(".aipkit_voice_input_toggle_switch");if(l){let d=l.closest(".aipkit_chatbot-settings-area");d&&t(d,l.checked);return}}),e.querySelectorAll(".aipkit_chatbot-settings-area").forEach(o=>{let a=o.querySelector(".aipkit_popup_toggle_switch");a&&(r(o,a.checked),n(o,a));let s=o.querySelector('input[name="popup_icon_type"]:checked');s?i(o,s.value):o.querySelector('input[name="popup_icon_type"][value="default"]')&&i(o,"default");let l=o.querySelector(".aipkit_voice_input_toggle_switch");l&&t(o,l.checked)}),console.log("AIPKit Appearance Toggles: Initialized."))}function r(e,o){let a=e.querySelector(".aipkit_popup_settings_accordion");if(a&&(a.style.display=o?"block":"none",!o)){let l=a.querySelector(".aipkit_accordion-header"),d=a.querySelector(".aipkit_accordion-content");l&&l.classList.remove("aipkit_active"),d&&d.classList.remove("aipkit_active")}let s=e.querySelector(".aipkit_popup_icon_options_container");s&&(s.style.display=o?"block":"none")}function i(e,o){let a=e.querySelector(".aipkit_popup_icon_default_selector_container"),s=e.querySelector(".aipkit_popup_icon_custom_input_container");a&&(a.style.display=o==="default"?"block":"none"),s&&(s.style.display=o==="custom"?"block":"none")}function n(e,o){let a=o.checked,s=o.getAttribute("data-sidebar-target"),l=e.querySelector("#"+s);if(!l)return;let d=l.querySelector(".aipkit_sidebar_toggle_switch"),p=l.querySelector("label");if(!d||!p)return;let _=l.getAttribute("data-tooltip-disabled")||"";a?(d.getAttribute("data-original-state")===null&&d.setAttribute("data-original-state",d.checked?"checked":"unchecked"),d.checked=!1,d.disabled=!0,l.setAttribute("title",_),l.classList.add("aipkit-disabled-tooltip"),p.style.opacity="0.6"):(d.disabled=!1,l.removeAttribute("title"),l.classList.remove("aipkit-disabled-tooltip"),p.style.opacity="1",d.getAttribute("data-original-state")==="checked"&&(d.checked=!0),d.removeAttribute("data-original-state"))}function t(e,o){let a=e.querySelector(".aipkit_stt_provider_conditional_row");a&&(a.style.display="none")}window.aipkit_initAppearanceToggles=c,window.aipkit_togglePopupDependentSettingsVisibility=r,window.aipkit_toggleSidebarCheckboxState=n,window.aipkit_togglePopupIconValueInputs=i,window.aipkit_toggleSttSettingsVisibility=t})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");r&&(r.addEventListener("change",function(i){let n=i.target.closest(".aipkit_starters_toggle_switch");if(!n)return;let t=n.closest(".aipkit_chatbot-settings-area");if(!t)return;let e=t.querySelector(".aipkit_starters_conditional_row");e&&(e.style.display=n.checked?"block":"none")}),r.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{let n=i.querySelector(".aipkit_starters_toggle_switch"),t=i.querySelector(".aipkit_starters_conditional_row");n&&t&&(t.style.display=n.checked?"block":"none")}),console.log("AIPKit Conversation Starters: Toggle initialized."))}window.aipkit_initConversationStartersToggle=c})();(function(){"use strict";function c(i){let n=i.closest(".aipkit_tab_dropdown_container");if(!n)return;let t=n.querySelector(".aipkit_tab_dropdown_menu");if(!t)return;let e=t.style.display==="none"||!t.style.display;t.style.display=e?"block":"none"}function r(){let i=document.getElementById("aipkit_chatbot_main_selector_container");if(!i)return;let n="data-dropdown-outside-click-listener";document.body.getAttribute(n)||(document.addEventListener("click",function(t){let e=i.querySelector('.aipkit_tab_dropdown_menu[style*="display: block"]');if(!e)return;let o=i.querySelector(".aipkit_tab_dropdown_trigger");!e.contains(t.target)&&(!o||!o.contains(t.target))&&(e.style.display="none")},!0),document.body.setAttribute(n,"true"))}window.aipkit_chatTabs_toggleMoreBotsDropdown=c,window.aipkit_chatTabs_initDropdownOutsideClickListener=r})();(function(){"use strict";function c(t){let e=t.target.closest(".aipkit_tab_button, .aipkit_tab_dropdown_item");e&&(t.key==="Enter"?(t.preventDefault(),window.aipkit_chatTabs_saveNewName(e)):t.key==="Escape"&&(t.preventDefault(),window.aipkit_chatTabs_exitEditMode(e)))}function r(t){let e=t.querySelector(".aipkit_tab_name_display"),o=t.querySelector(".aipkit_tab_edit_container"),a=t.querySelector(".aipkit_tab_edit_btn"),s=t.querySelector(".aipkit_tab_icon");if(!e||!o){console.error("AIPKit Edit Mode Error: nameDisplay or editContainer not found!");return}let l=e.textContent.trim(),d=window.aipkit_escapeHtml||(u=>u),p=window.aipkit_escapeAttribute||(u=>u);o.innerHTML=`
            <input type="text" class="aipkit_tab_name_input" value="${d(l)}" aria-label="${p("New chatbot name")}">
            <button type="button" class="aipkit_btn-save-name" title="${p("Save name")}"><span class="dashicons dashicons-yes-alt"></span></button>
            <button type="button" class="aipkit_btn-cancel-name" title="${p("Cancel rename")}"><span class="dashicons dashicons-no"></span></button>
        `,t.classList.add("aipkit_tab-editing"),e.style.display="none",a&&(a.style.display="none"),s&&(s.style.display="none");let _=o.querySelector(".aipkit_tab_name_input");_?(o.style.display="inline-flex",setTimeout(()=>{_.focus(),_.select()},0),_.removeEventListener("keydown",c),_.addEventListener("keydown",c)):console.error("AIPKit Edit Mode Error: Input field could not be found after creation.")}function i(t,e=null){let o=t.querySelector(".aipkit_tab_name_display"),a=t.querySelector(".aipkit_tab_edit_container"),s=a?a.querySelector(".aipkit_tab_name_input"):null,l=t.querySelector(".aipkit_tab_edit_btn"),d=t.querySelector(".aipkit_tab_icon");if(s&&s.removeEventListener("keydown",c),a&&(a.innerHTML="",a.style.display="none"),t.classList.remove("aipkit_tab-editing"),o&&(o.style.display=""),l&&(l.style.display=""),d&&(d.style.display=""),e!==null&&o&&(o.textContent=e,t.classList.contains("aipkit_active"))){let u=document.getElementById("aipkit_chatbot_main_selector_container")?.querySelector(".aipkit_active_bot_name_display");u&&(u.textContent=e)}let p=t.querySelector(".aipkit_tab_rename_status");p&&p.textContent!==""&&setTimeout(()=>{p&&(p.textContent=""),p.className="aipkit_tab_rename_status"},3e3)}function n(t){let e=t.querySelector(".aipkit_tab_name_input"),o=t.querySelector(".aipkit_tab_rename_status");if(!e||!o)return;let a=t.getAttribute("data-bot-id"),s=e.value.trim(),l=t.querySelector(".aipkit_tab_name_display"),d=l?l.textContent.trim():"";if(!a||!s||s===d){i(t);return}e.disabled=!0,o.textContent="Saving...",o.className="aipkit_tab_rename_status",window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:a,new_name:s}).then(p=>{o.textContent=p.message||"Renamed!",o.classList.add("success"),i(t,p.new_name||s)}).catch(p=>{console.error("AIPKit Debug: Rename error:",p),o.textContent="Error: "+(p.message||"Could not rename"),o.classList.add("error"),e.disabled=!1,e.focus(),setTimeout(()=>{o&&(o.textContent=""),o.className="aipkit_tab_rename_status"},4e3)})}window.aipkit_chatTabs_enterEditMode=r,window.aipkit_chatTabs_exitEditMode=i,window.aipkit_chatTabs_saveNewName=n})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_chatbot_main_selector_container");if(!r){console.warn("AIPKit Chat Main Tabs: Container not found.");return}typeof window.aipkit_chatTabs_initDropdownOutsideClickListener=="function"&&window.aipkit_chatTabs_initDropdownOutsideClickListener(),r.addEventListener("click",function(i){let n=i.target,t=n.closest(".aipkit_tab_button, .aipkit_tab_dropdown_item");if(n.closest(".aipkit_tab_dropdown_trigger")){i.stopPropagation(),typeof window.aipkit_chatTabs_toggleMoreBotsDropdown=="function"&&window.aipkit_chatTabs_toggleMoreBotsDropdown(n.closest(".aipkit_tab_dropdown_trigger"));return}let e=n.closest(".aipkit_tab_dropdown_item");if(e){if(n.matches(".aipkit_tab_edit_btn")||n.closest(".aipkit_tab_edit_btn")){if(i.stopPropagation(),!e.classList.contains("aipkit_tab-editing")&&typeof window.aipkit_chatTabs_enterEditMode=="function"){let l=r.querySelector(".aipkit_tab_dropdown_item.aipkit_tab-editing");l&&l!==e&&window.aipkit_chatTabs_exitEditMode(l),window.aipkit_chatTabs_enterEditMode(e)}return}if(n.matches(".aipkit_btn-save-name")||n.closest(".aipkit_btn-save-name")){i.stopPropagation(),typeof window.aipkit_chatTabs_saveNewName=="function"&&window.aipkit_chatTabs_saveNewName(e);return}if(n.matches(".aipkit_btn-cancel-name")||n.closest(".aipkit_btn-cancel-name")){i.stopPropagation(),typeof window.aipkit_chatTabs_exitEditMode=="function"&&window.aipkit_chatTabs_exitEditMode(e);return}if(n.closest(".aipkit_tab_edit_container"))return}if(!t)return;if(t.classList.contains("aipkit_active")){if(t.classList.contains("aipkit_tab_dropdown_item")){let l=t.closest(".aipkit_tab_dropdown_menu");l&&(l.style.display="none")}return}let o=t.getAttribute("data-tab-type"),a=t.getAttribute("data-bot-id")||"";if(typeof window.aipkit_loadModule!="function"){console.error("AIPKit Tabs: aipkit_loadModule function is not available."),alert("Error: Cannot switch chatbot view.");return}if(t.classList.contains("aipkit_tab_dropdown_item")){let l=t.closest(".aipkit_tab_dropdown_menu");l&&(l.style.display="none")}let s={};o==="bot"&&a?s={force_active_bot_id:a}:o==="create"&&(s={force_active_tab:"create"}),window.aipkit_loadModule("chatbot",s)}),console.log("AIPKit Chat Main Tabs: Delegated event listener attached.")}window.aipkit_initChatbotMainTabs=c})();(function(){"use strict";function c(i){if(!i)return;let n=i.querySelector(".aipkit_token_limit_mode_select"),t=i.querySelector(".aipkit_token_general_user_limit_field"),e=i.querySelector(".aipkit_token_role_limits_container");if(!n||!t||!e){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let o=n.value;t.style.display=o==="general"?"block":"none",e.style.display=o==="role_based"?"block":"none"}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit Token Management JS: Main content container not found.");return}i.addEventListener("change",function(t){let e=t.target.closest(".aipkit_token_limit_mode_select");if(!e)return;let o=e.closest(".aipkit_accordion-content");o?c(o):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",e)}),i.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(t=>{let e=t.querySelector(".aipkit_accordion-content");e&&c(e)}),console.log("AIPKit Token Management JS: UI Initialized (delegated listeners ready).")}window.aipkit_initTokenManagementUI=r})();(function(){"use strict";let c=!1;function r(){let t=document.getElementById("aipkit_export_all_bots_btn"),e=document.getElementById("aipkit_export_bots_status");if(!t||!e){console.warn("AIPKit Chatbot Exporter: Missing export button or status area.");return}t.addEventListener("click",i),console.log("AIPKit Chatbot Exporter: Initialized.")}function i(){let t=document.getElementById("aipkit_export_all_bots_btn"),e=document.getElementById("aipkit_export_bots_status"),o=t?.querySelector(".aipkit_spinner");c||(c=!0,t.disabled=!0,o&&(o.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(t,"Exporting..."):t.textContent="Exporting...",e.textContent="",e.className="aipkit_form-help",aipkit_apiRequest("aipkit_export_all_chatbots").then(a=>{if(a&&a.jsonData){n(a.jsonData);let s=a.message||"Export successful!";typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"success",s):(e.textContent=s,e.style.color="green",setTimeout(()=>{e.textContent="",e.style.color=""},4e3))}else throw new Error("Invalid export data received.")}).catch(a=>{console.error("AIPKit Chatbot Export Error:",a);let s="Export Failed: "+(a.message||"Unknown error");typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error",s):(e.textContent=s,e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},5e3))}).finally(()=>{c=!1,t.disabled=!1,o&&(o.style.display="none"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(t,"Export All Chatbots"):(t.textContent="Export All Chatbots",o&&t.appendChild(o))}))}function n(t){let e=new Blob([t],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),a=URL.createObjectURL(e),l=new Date().toISOString().slice(0,10);o.setAttribute("href",a),o.setAttribute("download",`aipkit-chatbots-export-${l}.json`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}window.aipkit_initChatbotExporter=r})();(function(){"use strict";let c=!1,r=null;function i(){let e=document.getElementById("aipkit_import_file"),o=document.getElementById("aipkit_import_bots_btn"),a=document.getElementById("aipkit_import_bots_status");if(!e||!o||!a){console.warn("AIPKit Chatbot Importer: Missing import button, file input, or status area.");return}e.addEventListener("change",n),o.addEventListener("click",t),console.log("AIPKit Chatbot Importer: Initialized.")}function n(e){let o=e.target,a=document.getElementById("aipkit_import_bots_btn"),s=document.getElementById("aipkit_import_bots_status");r=o.files.length>0?o.files[0]:null,r?r.type!=="application/json"?(typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(s,"error","Invalid file type. Please select a .json file."):(s.textContent="Invalid file type. Please select a .json file.",s.style.color="red",setTimeout(()=>{s.textContent="",s.style.color=""},4e3)),o.value="",r=null,a.disabled=!0):(a.disabled=!1,s.textContent="",s.className="aipkit_form-help"):a.disabled=!0}function t(){let e=document.getElementById("aipkit_import_bots_btn"),o=document.getElementById("aipkit_import_file"),a=document.getElementById("aipkit_import_bots_status"),s=e?.querySelector(".aipkit_spinner");if(!r){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(a,"error","Please select a JSON file to import."):(a.textContent="Please select a JSON file to import.",a.style.color="red",setTimeout(()=>{a.textContent="",a.style.color=""},4e3));return}if(c)return;c=!0,e.disabled=!0,o.disabled=!0,s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(e,"Importing..."):e.textContent="Importing...",a.textContent="",a.className="aipkit_form-help";let l=new FormData;l.append("aipkit_import_file",r),window.aipkit_dashboard?.nonce&&l.append("_ajax_nonce",window.aipkit_dashboard.nonce),l.append("action","aipkit_import_chatbots"),fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:l,credentials:"same-origin"}).then(d=>d.json()).then(d=>{if(!d.success){let _=d.data&&d.data.message?d.data.message:"Unknown import error";throw new Error(_)}let p=d.data.message||"Import complete!";typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(a,"success",p):(a.textContent=p,a.style.color="green",setTimeout(()=>{a.textContent="",a.style.color=""},4e3)),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",_=>{_&&console.error("Importer: Error reloading module after import:",_)}):console.error("Importer: Cannot reload module, aipkit_loadModule missing.")}).catch(d=>{console.error("AIPKit Chatbot Import Error:",d);let p="Import Failed: "+(d.message||"Unknown error");typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(a,"error",p):(a.textContent=p,a.style.color="red",setTimeout(()=>{a.textContent="",a.style.color=""},5e3))}).finally(()=>{c=!1,o.value="",r=null,e.disabled=!0,o.disabled=!1,s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(e,"Import Chatbots"):(e.textContent="Import Chatbots",s&&e.appendChild(s))})}window.aipkit_initChatbotImporter=i})();(function(){"use strict";function c(){if(console.log("AIPKit Chat Admin Main: Initializing UI (aipkit_initChatbot)..."),typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let i=document.querySelector(".aipkit_chatbot_module_container");i&&(i.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js."),typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCreateNewBot=="function"?window.aipkit_initCreateNewBot():console.error("AIPKit Chat Admin Main: aipkit_initCreateNewBot function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initChatAccordions=="function"?window.aipkit_initChatAccordions():console.error("AIPKit Chat Admin Main: aipkit_initChatAccordions function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')?window.aipkit_initTokenManagementUI():console.log("AIPKit Chat Admin Main: Token Management accordion not found, skipping UI init."):console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_initChatbotMainTabs=="function"?window.aipkit_initChatbotMainTabs():console.error("AIPKit Chat Admin Main: aipkit_initChatbotMainTabs function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initChatbotExporter=="function"?window.aipkit_initChatbotExporter():console.error("AIPKit Chat Admin Main: aipkit_initChatbotExporter function not found."),typeof window.aipkit_initChatbotImporter=="function"?window.aipkit_initChatbotImporter():console.error("AIPKit Chat Admin Main: aipkit_initChatbotImporter function not found."),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')?window.aipkit_initTtsSettingsUI():console.log("AIPKit Chat Admin Main: TTS settings accordion not found, skipping TTS UI init."):console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found.");let r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(r){let i=r.dataset.botId,n=document.getElementById(`aipkit_trigger_builder_${i}`);i&&n&&typeof window.aipkit_initTriggerBuilderUI=="function"?(console.log(`AIPKit Chat Admin Main: Initializing Trigger Builder for bot ${i}.`),window.aipkit_initTriggerBuilderUI(i)):i&&n&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${i}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"?window.aipkit_initRealtimeVoiceAgentUI():document.querySelector('.aipkit_accordion[data-section="voice-agent"]')&&console.error("AIPKit Chat Admin Main: aipkit_initRealtimeVoiceAgentUI function not found."),console.log("AIPKit Chat Admin Main: UI Initialization complete (aipkit_initChatbot).")}window.aipkit_initChatbot=c})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"title",sortDirection:"asc",filterProvider:"all",isLoading:!1}})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_ai_forms_list_tbody"),n=window.aipkit_escapeHtml||(e=>e),t=wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e;i&&(i.innerHTML="",!(!r||r.length===0)&&r.forEach(e=>{let o=window.aipkit_dashboard?.isProPlan??!1,s=(window.aipkit_dashboard?.addons??{}).pdf_download??!1,l="";if(o&&s)l=`
              <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${e.id}" data-attr-name="pdf_download" value="true">
                  <span>${t("Save as PDF","gpt3-ai-content-generator")}</span>
              </label>`;else{let u=t(o?"Activate the 'PDF Download' addon to use this feature.":"This is a Pro feature. Please upgrade.","gpt3-ai-content-generator"),f=o?`<span class="aipkit_status-tag">${t("Addon inactive","gpt3-ai-content-generator")}</span>`:`<a href="${window.aipkit_dashboard.upgradeUrl}" target="_blank" class="aipkit_status-tag" style="background-color: #fef3c7; color: #92400e; border: 1px solid #fde68a;">${t("Pro","gpt3-ai-content-generator")}</a>`;l=`
              <div class="aipkit_config_item_locked" title="${n(u)}">
                  <label class="aipkit_config_item" style="opacity: 0.5; cursor: not-allowed;">
                      <input type="checkbox" disabled>
                      <span>${t("Save as PDF","gpt3-ai-content-generator")}</span>
                  </label>
                  ${f}
              </div>`}let d=i.insertRow();d.insertCell().textContent=e.id,d.insertCell().textContent=n(e.title),d.insertCell().innerHTML=`<span class="aipkit_status-tag">${n(e.provider||"Default")}</span>`,d.insertCell().textContent=n(e.model||"Default");let p=d.insertCell();p.classList.add("aipkit_shortcode_cell"),p.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${e.id}" readonly value="${n(e.shortcode)}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${e.id}" title="${t("Configure Shortcode","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-settings"></span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator" id="aif-configurator-${e.id}" style="display: none;">
            <div class="aipkit_config_section">
                <h6>${t("Display Options","gpt3-ai-content-generator")}</h6>
                <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${e.id}" data-attr-name="show_provider" value="true">
                  <span>${t("Show Provider Select","gpt3-ai-content-generator")}</span>
                </label>
                <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${e.id}" data-attr-name="show_model" value="true">
                  <span>${t("Show Model Select","gpt3-ai-content-generator")}</span>
                </label>
            </div>
            <div class="aipkit_config_section">
                <h6>${t("Functionality","gpt3-ai-content-generator")}</h6>
                 <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${e.id}" data-attr-name="copy_button" value="true">
                  <span>${t("Copy Button","gpt3-ai-content-generator")}</span>
                </label>
                 <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${e.id}" data-attr-name="save_button" value="true">
                  <span>${t("Save as Post","gpt3-ai-content-generator")}</span>
                </label>
                ${l}
            </div>
            <div class="aipkit_config_section">
                <h6>${t("Theme","gpt3-ai-content-generator")}</h6>
                <select class="aipkit-aiform-config-input aipkit_form-input" data-form-id="${e.id}" data-attr-name="theme">
                    <option value="light">${t("Light (default)","gpt3-ai-content-generator")}</option>
                    <option value="dark">${t("Dark","gpt3-ai-content-generator")}</option>
                    <option value="custom">${t("Custom","gpt3-ai-content-generator")}</option>
                </select>
            </div>
        </div>
      `;let _=d.insertCell();_.classList.add("aipkit_form_actions_cell"),_.innerHTML=`
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_edit_ai_form_btn" data-form-id="${e.id}" title="${t("Edit","gpt3-ai-content-generator")}"><span class="dashicons dashicons-edit"></span></button>
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_duplicate_ai_form_btn" data-form-id="${e.id}" title="${t("Duplicate","gpt3-ai-content-generator")}"><span class="dashicons dashicons-admin-page"></span></button>
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_export_ai_form_btn" data-form-id="${e.id}" title="${t("Export","gpt3-ai-content-generator")}"><span class="dashicons dashicons-download"></span></button>
        <button class="aipkit_btn aipkit_btn-danger aipkit_icon_btn aipkit_delete_ai_form_btn" data-form-id="${e.id}" data-form-title="${n(e.title)}" title="${t("Delete","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
      `}))}window.aipkitForms_renderTable=c})();(function(){"use strict";function c(r){let i=window.aipkitAIFormsListState,n=document.getElementById("aipkit_ai_forms_pagination");if(!n||!r||!i)return;n.innerHTML="";let{total_forms:t,total_pages:e}=r,o=i.currentPage;if(t<=0)return;let a=document.createElement("span");if(a.className="aipkit_pagination-count",a.textContent=`${t.toLocaleString()} form(s) found`,n.appendChild(a),e>1){let s=document.createElement("span");s.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",l.innerHTML="\xAB Previous",l.disabled=o<=1,s.appendChild(l);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`Page ${o} of ${e}`,s.appendChild(d);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",p.innerHTML="Next \xBB",p.disabled=o>=e,s.appendChild(p),n.appendChild(s)}}window.aipkitForms_renderPagination=c})();(function(){"use strict";function c(){let r=window.aipkitAIFormsListState;if(!r||r.isLoading)return;r.isLoading=!0;let i=document.getElementById("aipkit_ai_forms_list_tbody"),n=document.getElementById("aipkit_no_ai_forms_message"),t=document.getElementById("aipkit_ai_forms_pagination");i&&(i.innerHTML='<tr><td colspan="6" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),n&&(n.style.display="none"),t&&(t.innerHTML="");let o={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:r.currentPage,search:r.searchQuery,sort_by:r.sortColumn,sort_order:r.sortDirection,filter_provider:r.filterProvider};window.aipkit_apiRequest("aipkit_list_ai_forms",o).then(a=>{typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(a.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(a.pagination||{}),n&&(!a.forms||a.forms.length===0)&&(n.style.display="block",n.textContent=r.searchQuery?"No forms found matching your search.":"No AI Forms have been created yet.")}).catch(a=>{i&&(i.innerHTML=`<tr><td colspan="6" style="color:red;text-align:center;">Error loading forms: ${a.message}</td></tr>`)}).finally(()=>{r.isLoading=!1})}window.aipkitForms_fetchForms=c})();(function(){"use strict";let c;function r(){let i=document.getElementById("aipkit_ai_forms_list_container");if(!i||i.dataset.listListenersAttached)return;i.dataset.listListenersAttached="true";let n=window.aipkitAIFormsListState;if(!n){console.error("AI Forms Events: List state object is not available.");return}i.addEventListener("click",function(o){let a=o.target,s=wp.i18n&&wp.i18n.__?wp.i18n.__:d=>d,l=a.closest(".aipkit-sortable-col");if(l){let d=l.dataset.sortKey;n.sortColumn===d?n.sortDirection=n.sortDirection==="asc"?"desc":"asc":(n.sortColumn=d,n.sortDirection="asc"),n.currentPage=1,i.querySelectorAll(".aipkit-sortable-col").forEach(p=>p.removeAttribute("data-sort-direction")),l.setAttribute("data-sort-direction",n.sortDirection),window.aipkitForms_fetchForms();return}if(a.matches(".aipkit_pagination_prev")){n.currentPage>1&&(n.currentPage--,window.aipkitForms_fetchForms());return}if(a.matches(".aipkit_pagination_next")){n.currentPage++,window.aipkitForms_fetchForms();return}});let t=i.querySelector("#aipkit_ai_forms_search_input");t&&t.addEventListener("input",function(){clearTimeout(c),c=setTimeout(()=>{n.searchQuery=this.value,n.currentPage=1,window.aipkitForms_fetchForms()},400)});let e=i.querySelector("#aipkit_ai_forms_provider_filter");e&&e.addEventListener("change",function(){n.filterProvider=this.value,n.currentPage=1,window.aipkitForms_fetchForms()})}window.aipkitForms_attachListEventListeners=r})();(function(){"use strict";function c(){if(console.log("[AI Forms Init] Initializing dynamic list view..."),typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"){console.error("AI Forms Init ListView: Missing required event or fetch functions.");return}window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms()}window.aipkitForms_initListView=c})();(function(){"use strict";function c(r){let i=window.aipkitAIFormsState;if(!r){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let n=r.querySelector("#aipkit_ai_form_elements_palette"),t=r.querySelector("#aipkit_ai_form_designer_area"),e=r.querySelector("#aipkit_form_designer_placeholder");if(!n||!t){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(n.dataset.dragListenersAttached==="true"&&t.dataset.dragListenersAttached==="true")return;n.querySelectorAll(".aipkit_form_element_item").forEach(a=>{a.dataset.dragStartListenerAttached!=="true"&&(a.addEventListener("dragstart",s=>{i.draggedElementType=s.target.dataset.elementType,s.dataTransfer.setData("text/plain",i.draggedElementType),s.dataTransfer.effectAllowed="copy",s.target.classList.add("aipkit-dragging"),i.draggedElement=null}),a.addEventListener("dragend",s=>{s.target.classList.remove("aipkit-dragging"),i.draggedElementType=null}),a.dataset.dragStartListenerAttached="true")}),n.dataset.dragListenersAttached="true",t.dataset.dragListenersAttached!=="true"&&(t.addEventListener("dragstart",a=>{a.target.classList.contains("aipkit_dropped_element")&&(i.draggedElement=a.target,a.dataTransfer.setData("text/element-id",a.target.id),a.dataTransfer.effectAllowed="move",setTimeout(()=>{i.draggedElement&&(i.draggedElement.style.opacity="0.5")},0),i.draggedElementType=null)}),t.addEventListener("dragend",a=>{i.draggedElement&&(i.draggedElement.style.opacity="1",i.draggedElement=null)}),t.addEventListener("dragover",a=>{a.preventDefault();let s=a.target.closest(".aipkit_dropped_element");t.classList.add("aipkit-drag-over"),i.draggedElement&&s&&i.draggedElement!==s?a.dataTransfer.dropEffect="move":a.dataTransfer.dropEffect="copy"}),t.addEventListener("dragleave",a=>{t.contains(a.relatedTarget)||t.classList.remove("aipkit-drag-over")}),t.addEventListener("drop",a=>{a.preventDefault(),t.classList.remove("aipkit-drag-over");let s=a.dataTransfer.getData("text/element-id");if(i.draggedElement&&s===i.draggedElement.id){let l=a.target.closest(".aipkit_dropped_element"),d=null;if(l&&l!==i.draggedElement){let p=l.getBoundingClientRect();d=a.clientY>p.top+p.height/2?l.nextSibling:l}t.insertBefore(i.draggedElement,d),i.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(i.draggedElementType){if(e&&e.style.display!=="none"&&(e.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let l=window.aipkitForms_createNewFormElementData(i.draggedElementType);i.formStructure.push(l),window.aipkitForms_renderDroppedElement(t,l,null)}i.draggedElementType=null,i.draggedElement=null}),t.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=c})();(function(){"use strict";function c(){let r=window.aipkitAIFormsState,i=document.getElementById("aipkit_ai_form_designer_area");if(!i)return;let n=[];i.querySelectorAll(".aipkit_layout_row").forEach(e=>{let o=e.id,a=r.formStructure.find(d=>d.internalId===o);if(!a)return;let s={internalId:o,type:"layout-row",columns:[]};e.querySelectorAll(".aipkit_layout_column").forEach(d=>{let p=d.id,_=a.columns.find(m=>m.internalId===p);if(!_)return;let u={internalId:p,width:_.width,elements:[]};d.querySelectorAll(".aipkit_dropped_element").forEach(m=>{let g=m.id,k=null;r.formStructure.forEach(w=>{w.columns.forEach(b=>{let y=b.elements.find(h=>h.internalId===g);y&&(k=y)})}),k&&u.elements.push(k)}),s.columns.push(u)}),n.push(s)}),r.formStructure=n,console.log("Form structure updated after reorder:",r.formStructure)}window.aipkitForms_updateFormStructureOrder=c})();(function(){"use strict";function c(i){let n=window.aipkitAIFormsState;n.droppedElementCounter++;let t=`field_${i.replace(/-/g,"_")}_${n.droppedElementCounter}`;switch(i){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:i,label:`New ${i.replace(/-/g," ").replace(/\b\w/g,a=>a.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:t,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let e,o;return i==="select"?(e="New Dropdown",o="select"):i==="radio-button"?(e="New Radio Buttons",o="radio"):(e="New Checkbox Group",o="checkbox"),{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:i,label:e,fieldId:`${o}_${n.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${n.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function r(i){let n=Date.now(),t=[];switch(i){case"1-col":t=[{internalId:`col-${n}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":t=[{internalId:`col-${n}-1`,width:"50%",elements:[]},{internalId:`col-${n}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":t=[{internalId:`col-${n}-1`,width:"33.33%",elements:[]},{internalId:`col-${n}-2`,width:"33.33%",elements:[]},{internalId:`col-${n}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":t=[{internalId:`col-${n}-1`,width:"30%",elements:[]},{internalId:`col-${n}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":t=[{internalId:`col-${n}-1`,width:"70%",elements:[]},{internalId:`col-${n}-2`,width:"30%",elements:[]}];break;default:t=[{internalId:`col-${n}-1`,width:"100%",elements:[]}]}return{internalId:`row-${n}`,type:"layout-row",columns:t}}window.aipkitForms_createNewFormElementData=c,window.aipkitForms_createNewLayoutData=r})();(function(){"use strict";function c(r,i,n=null){let t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u,e=window.aipkit_escapeHtml||function(u){return u},o=document.createElement("div");o.className="aipkit_dropped_element",o.id=i.internalId,o.dataset.elementType=i.type;let a=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${t("Drag to reorder","gpt3-ai-content-generator")}"></span>`,s="",l=`${i.internalId}-field`,d="";switch(i.helpText&&(d=`<p class="aipkit_dropped_element_help_text">${e(i.helpText)}</p>`),i.type){case"text-input":s=`<label class="aipkit_dropped_element_label" for="${l}">${e(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${l}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${e(i.placeholder)}" readonly>
                    ${d}`;break;case"textarea":s=`<label class="aipkit_dropped_element_label" for="${l}">${e(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${l}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${e(i.placeholder)}" readonly></textarea>
                    ${d}`;break;case"select":let u="";i.options&&i.options.length>0?i.options.forEach(g=>{u+=`<option value="${e(g.value)}">${e(g.text)}</option>`}):u=`<option>${t("No options configured","gpt3-ai-content-generator")}</option>`,s=`<label class="aipkit_dropped_element_label" for="${l}">${e(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${l}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${u}</select>
                    ${d}`;break;case"radio-button":let f="";i.options&&i.options.length>0?i.options.forEach((g,k)=>{let w=`${l}-${k}`;f+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${w}" class="aipkit_dropped_element_field" name="preview-${i.internalId}" disabled>
                                    <label for="${w}">${e(g.text)}</label>
                                </div>`}):f=`<p class="aipkit-no-options-note">${t("No options configured","gpt3-ai-content-generator")}</p>`,s=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${e(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${f}
                    </fieldset>
                    ${d}`;break;case"checkbox":let m="";i.options&&i.options.length>0?i.options.forEach((g,k)=>{let w=`${l}-${k}`;m+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${w}" class="aipkit_dropped_element_field" name="preview-${i.internalId}-${k}" disabled>
                                    <label for="${w}">${e(g.text)}</label>
                                </div>`}):m=`<p class="aipkit-no-options-note">${t("No options configured","gpt3-ai-content-generator")}</p>`,s=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${e(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${m}
                    </fieldset>
                    ${d}`;break;case"file-upload":s=`<label class="aipkit_dropped_element_label" for="${l}">${e(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${l}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${d}`;break;default:s=`<p>${e(i.label)}</p>${d}`}let p=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${t("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,_=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${t("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;o.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${s}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${a}
            ${p}
            ${_}
        </div>
    `,n?r.insertBefore(o,n):r.appendChild(o)}window.aipkitForms_renderFieldInColumn=c,window.aipkitForms_renderDroppedElement=c})();(function(){"use strict";function c(r,i){let n=window.aipkitAIFormsState,t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;if(!i){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let e=i.querySelector("#aipkit_ai_form_designer_area");if(!e){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let o=e.querySelector(`#${CSS.escape(r)}`);if(o&&(o.remove(),n.formStructure.forEach(a=>{a.columns.forEach(s=>{s.elements=s.elements.filter(l=>l.internalId!==r)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(i),n.selectedDesignerElementId===r&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(i):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),e.querySelectorAll(".aipkit_dropped_element").length===0&&e.querySelectorAll(".aipkit_layout_row").length===0)){let a=e.querySelector("#aipkit_form_designer_placeholder");a||(a=document.createElement("div"),a.className="aipkit_form_designer_placeholder",a.id="aipkit_form_designer_placeholder",a.innerHTML=`<span class="dashicons dashicons-layout"></span>${t("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,e.appendChild(a)),a.style.display="flex"}}window.aipkitForms_deleteDroppedElement=c})();(function(){"use strict";function c(){let r=window.aipkitAIFormsState,i=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,n=document.getElementById("aipkit_form_editor_container");if(!n)return;let t=n.querySelector("#aipkit_ai_form_prompt_template"),e=n.querySelector("#aipkit_prompt_validation_results");if(!t||!e)return;let o=t.value,a=[],s=[],l=new Set;r.formStructure.forEach(m=>{m.columns.forEach(g=>{g.elements.forEach(k=>{k.fieldId&&l.add(k.fieldId)})})});let d=/{[a-zA-Z0-9_]+}/g,p=(o.match(d)||[]).map(m=>m.slice(1,-1)),_=new Set(p);p.forEach(m=>{l.has(m)||a.push(`Variable <code>{${m}}</code> is used in the prompt but not defined as a form field.`)}),l.forEach(m=>{_.has(m)||s.push(`Field <code>{${m}}</code> is defined but not used in the prompt.`)});let u=o;if(p.forEach(m=>{let g=new RegExp(`\\{${m}\\}`,"g");u=u.replace(g,"")}),/[{}]/.test(u)&&a.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),e.className="aipkit_form-help",e.innerHTML="",a.length>0){e.classList.add("aipkit-validation-error");let m=`<strong>${i("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;a.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>",e.innerHTML=m}else{e.classList.add("aipkit-validation-success");let m=`<strong>${i("Validation Passed!","gpt3-ai-content-generator")}</strong> (${p.length} of ${l.size} fields used).`;s.length>0&&(m+=`<br><strong>${i("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,s.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>"),e.innerHTML=m}e.style.display="block",e.dismissTimer&&clearTimeout(e.dismissTimer);let f=a.length>0?8e3:5e3;e.dismissTimer=setTimeout(()=>{e.style.display="none",e.innerHTML=""},f)}window.aipkitForms_validatePrompt=c})();(function(){"use strict";function c(r,i){let n=window.aipkitAIFormsState,t=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u,o=window.aipkit_escapeHtml||function(u){return u};if(!i){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}i.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(u=>u.classList.remove("aipkit-element-selected"));let a=i.querySelector(`#${CSS.escape(r)}`);a&&a.classList.add("aipkit-element-selected"),n.selectedDesignerElementId=r;let s=null;for(let u of n.formStructure){for(let f of u.columns){let m=f.elements.find(g=>g.internalId===r);if(m){s=m;break}}if(s)break}if(!s){console.error(`showSettingsPanel: Could not find element data for ID ${r} in state.`,n.formStructure);return}let l=i.querySelector("#aipkit_ai_form_elements_palette"),d=i.querySelector("#aipkit_ai_form_element_settings_panel"),p=d?d.querySelector("#aipkit_settings_panel_fields"):null,_=d?d.querySelector("#aipkit_settings_panel_element_type"):null;if(!l||!d||!p||!_){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(_.textContent=`(${s.type.replace(/-/g," ").replace(/\b\w/g,u=>u.toUpperCase())})`,p.innerHTML="",p.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${s.internalId}">${e(t.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${s.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="label" value="${o(s.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${s.internalId}">${e(t.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${s.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="fieldId" value="${o(s.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${e("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${e(t.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(s.type==="text-input"||s.type==="textarea")&&(p.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${s.internalId}">${e(t.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${s.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="placeholder" value="${o(s.placeholder||"")}">
                </div>`),p.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${s.internalId}">
                    <input type="checkbox" id="setting-required-${s.internalId}" class="aipkit-setting-field" data-setting="required" ${s.required?"checked":""}>
                    ${e(t.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${s.internalId}">${e("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${s.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${o(e("This text will appear under the field.","gpt3-ai-content-generator"))}">${o(s.helpText||"")}</textarea>
            </div>
        `,s.type==="select"||s.type==="radio-button"||s.type==="checkbox"){let u=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${e(t.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(s.options||[]).forEach((f,m)=>{u+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${m}" value="${o(f.value)}" placeholder="${e(t.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${m}" value="${o(f.text)}" placeholder="${e(t.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${e(t.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),u+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${e(t.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,p.innerHTML+=u}l.style.display="none",d.style.display="block"}window.aipkitForms_showSettingsPanel=c})();(function(){"use strict";function c(r){let i=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!r){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let t=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!t){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let e=t.querySelector("#aipkit_select_options_container");if(!e){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let o=e.querySelectorAll(".aipkit_select_option_row").length,a=document.createElement("div");a.className="aipkit_select_option_row",a.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${o}" placeholder="${n(i.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${o}" placeholder="${n(i.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${n(i.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,e.appendChild(a)}window.aipkitForms_addSelectOptionRow=c})();(function(){"use strict";function c(r){let i=window.aipkitAIFormsState;if(!r){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}r.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(e=>e.classList.remove("aipkit-element-selected")),i.selectedDesignerElementId=null;let n=r.querySelector("#aipkit_ai_form_elements_palette"),t=r.querySelector("#aipkit_ai_form_element_settings_panel");n&&(n.style.display="block"),t&&(t.style.display="none")}window.aipkitForms_hideSettingsPanel=c})();(function(){"use strict";function c(r,i){let n=window.aipkitAIFormsState,t=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f;if(!i){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let o=null;for(let f of n.formStructure){for(let m of f.columns){let g=m.elements.find(k=>k.internalId===r);if(g){o=g;break}}if(o)break}if(!o){console.error(`updateElementFromSettingsPanel: Element data for ID ${r} not found.`);return}let a=i.querySelector("#aipkit_ai_form_element_settings_panel");if(!a){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let s=a.querySelector('input[data-setting="label"]');s&&(o.label=s.value);let l=a.querySelector('input[data-setting="fieldId"]');if(l){let f=l.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!f){let g=o.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");g||(g=o.type.replace(/-/g,"_")),f=`${g}_${r.split("-").pop()}`}let m=!0;e:for(let g of n.formStructure)for(let k of g.columns)if(k.elements.some(w=>w.internalId!==r&&w.fieldId===f)){m=!1;break e}m&&f.length>0?(o.fieldId=f,l.value=f,l.classList.remove("aipkit_input_error")):f.length>0&&l.classList.add("aipkit_input_error")}let d=a.querySelector('input[data-setting="required"]');d&&(o.required=d.checked);let p=a.querySelector('textarea[data-setting="helpText"]');if(p&&(o.helpText=p.value),o.type==="text-input"||o.type==="textarea"){let f=a.querySelector('input[data-setting="placeholder"]');f&&(o.placeholder=f.value)}(o.type==="select"||o.type==="radio-button"||o.type==="checkbox")&&(o.options=[],a.querySelectorAll(".aipkit_select_option_row").forEach(m=>{let g=m.querySelector('input[data-setting="option-value"]'),k=m.querySelector('input[data-setting="option-text"]');g&&k&&g.value.trim()!==""?o.options.push({value:g.value,text:k.value}):g&&k&&g.value.trim()===""&&k.value.trim()!==""&&o.options.push({value:k.value,text:k.value})}));let _=i.querySelector("#aipkit_ai_form_designer_area"),u=_?_.querySelector(`#${CSS.escape(r)}`):null;if(u&&_){let f=u.parentElement,m=_.scrollTop,g=u.classList.contains("aipkit-element-selected"),k=u.nextElementSibling;if(u.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(f,o,k):console.error("AI Forms updateElement: renderFieldInColumn function missing."),g){let w=_.querySelector(`#${CSS.escape(r)}`);w&&w.classList.add("aipkit-element-selected")}_.scrollTop=m}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(i)}window.aipkitForms_updateElementFromSettingsPanel=c})();(function(){"use strict";function c(n){let t=window.aipkitAIFormsState;if(!n)return;let e=n.querySelector("#aipkit_prompt_snippets_container");if(!e)return;e.innerHTML="";let o=new Set;if(t.formStructure.forEach(a=>{a.columns.forEach(s=>{s.elements.forEach(l=>{l.fieldId&&o.add(l.fieldId)})})}),o.size>0){let a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;o.forEach(s=>{let l=document.createElement("button");l.type="button",l.className="aipkit_prompt_snippet",l.dataset.fieldId=s,l.title=a("Click to copy","gpt3-ai-content-generator"),l.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${s}}`,e.appendChild(l)})}}function r(n){if(!n)return;let t=n.querySelector("#aipkit_form_editor_container");if(!t){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let e=t.querySelector("#aipkit_prompt_snippets_container");if(!e){console.warn("AI Forms: Prompt snippets container not found for init.");return}e.dataset.listenerAttached!=="true"&&(e.addEventListener("click",function(o){let a=o.target.closest(".aipkit_prompt_snippet");if(!a)return;let s=a.dataset.fieldId;s&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${s}}`,a)}),e.dataset.listenerAttached="true")}function i(n=null,t){let e=window.aipkitAIFormsState,o=window.aipkit_ai_forms_config||{text:{}},a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,s=window.aipkit_escapeHtml||function(p){return p};if(!t){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}e.currentFormId=n,e.droppedElementCounter=0,e.formStructure=[],e.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(t):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let l=t.querySelector("#aipkit_form_editor_container"),d=t.querySelector("#aipkit_ai_forms_list_container");d.style.display="none",l.style.display="block",requestAnimationFrame(()=>{let p=l.querySelector("#aipkit_ai_form_title"),_=l.querySelector("#aipkit_ai_form_prompt_template"),u=l.querySelector("#aipkit_ai_form_id"),f=l.querySelector("#aipkit_ai_form_designer_area"),m=l.querySelector("#aipkit_ai_form_ai_provider"),g=l.querySelector("#aipkit_ai_form_ai_model"),k=l.querySelector("#aipkit_ai_form_temperature"),w=l.querySelector("#aipkit_ai_form_temperature_value"),b=l.querySelector("#aipkit_ai_form_max_tokens"),y=l.querySelector("#aipkit_ai_form_max_tokens_value"),h=l.querySelector("#aipkit_ai_form_top_p"),v=l.querySelector("#aipkit_ai_form_top_p_value"),S=l.querySelector("#aipkit_ai_form_frequency_penalty"),I=l.querySelector("#aipkit_ai_form_frequency_penalty_value"),E=l.querySelector("#aipkit_ai_form_presence_penalty"),P=l.querySelector("#aipkit_ai_form_presence_penalty_value"),T=l.querySelector("#aipkit_preview_ai_form_btn"),x=()=>{let C=document.createElement("div");return C.className="aipkit_form_designer_placeholder",C.id="aipkit_form_designer_placeholder",C.innerHTML=`<span class="dashicons dashicons-layout"></span>${a("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,C};if(!l||!d||!p||!_||!u||!f||!m||!g||!k||!b||!T||!w||!y||!h||!v||!S||!I||!E||!P){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:t.innerHTML.substring(0,500)});return}p.value="",_.value="",u.value="",f.innerHTML="",f.appendChild(x()),c(t);let A={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Provider",model_label:"Model"};if(l.querySelectorAll('input[name^="labels["]').forEach(C=>{let q=C.name.match(/labels\[(.+)\]/),N=q?q[1]:null;N&&A[N]!==void 0?C.value=A[N]:C.value=""}),!n){if(m.value="OpenAI",k&&w){let C=window.aipkit_dashboard?.ai_params?.temperature||1;k.value=C,w.textContent=C}if(b&&y){let C=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;b.value=C,y.textContent=C}if(h&&v){let C=window.aipkit_dashboard?.ai_params?.top_p||1;h.value=C,v.textContent=C}if(S&&I){let C=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;S.value=C,I.textContent=C}if(E&&P){let C=window.aipkit_dashboard?.ai_params?.presence_penalty||0;E.value=C,P.textContent=C}typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini")}n?(T.disabled=!1,u.value=n,f.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${a("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:n,_ajax_nonce:o.nonce_manage_forms}).then(C=>{if(C.form){p.value=C.form.title||"",_.value=C.form.prompt_template||"",m.value=C.form.ai_provider||"OpenAI",k&&w&&(k.value=C.form.temperature,w.textContent=C.form.temperature),b&&y&&(b.value=C.form.max_tokens,y.textContent=C.form.max_tokens),h&&v&&(h.value=C.form.top_p,v.textContent=C.form.top_p),S&&I&&(S.value=C.form.frequency_penalty,I.textContent=C.form.frequency_penalty),E&&P&&(E.value=C.form.presence_penalty,P.textContent=C.form.presence_penalty);let q=C.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach($=>{let D=l.querySelector(`input[name="labels[${$}]"]`);D&&(D.value=q[$]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(m.value,C.form.ai_model);let O=l.querySelector('input[name="enable_vector_store"]'),L=O?O.closest(".aipkit_accordion-content"):null;if(L){let $=L.querySelector('select[name="vector_store_provider"]'),D=L.querySelector('select[name="openai_vector_store_ids[]"]'),B=L.querySelector('select[name="pinecone_index_name"]'),M=L.querySelector('select[name="qdrant_collection_name"]'),F=L.querySelector('select[name="vector_embedding_provider"]'),H=L.querySelector('select[name="vector_embedding_model"]'),G=L.querySelector('input[name="vector_store_top_k"]'),U=L.querySelector("#aipkit_ai_form_vector_store_top_k_value");if(O.checked=C.form.enable_vector_store==="1",$&&($.value=C.form.vector_store_provider||"openai"),B&&(B.value=C.form.pinecone_index_name||""),M&&(M.value=C.form.qdrant_collection_name||""),F&&(F.value=C.form.vector_embedding_provider||"openai"),G&&U){let R=C.form.vector_store_top_k||3;G.value=R,U.textContent=R}D&&C.form.openai_vector_store_ids&&Array.isArray(C.form.openai_vector_store_ids)&&Array.from(D.options).forEach(R=>{R.selected=C.form.openai_vector_store_ids.includes(R.value)}),typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(L),H&&(H.value=C.form.vector_embedding_model||""),O.dispatchEvent(new Event("change",{bubbles:!0}))}if(C.form.structure&&Array.isArray(C.form.structure))if(e.formStructure=C.form.structure,f.innerHTML="",e.formStructure.length===0)f.appendChild(x());else{e.formStructure.forEach(D=>{window.aipkitForms_renderLayoutRow(f,D,null,t)});let $=0;e.formStructure.forEach(D=>{D.columns.forEach(B=>{B.elements.forEach(M=>{let F=M.internalId.split("-"),H=parseInt(F[F.length-1],10)||0;H>$&&($=H)})})}),e.droppedElementCounter=$}else f.innerHTML="",f.appendChild(x());c(t)}else throw new Error(C.message||a("Could not load form data.","gpt3-ai-content-generator"))}).catch(C=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(t,"error",C.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(t):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):T.disabled=!0})}window.aipkitForms_showFormEditor=i,window.aipkitForms_updatePromptSnippets=c,window.aipkitForms_initPromptSnippets=r})();(function(){"use strict";function c(r){let i=window.aipkitAIFormsState,n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;if(!r){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}i.currentFormId=null,i.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(r):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let t=r.querySelector("#aipkit_form_editor_container"),e=r.querySelector("#aipkit_ai_forms_list_container");if(t&&(t.style.display="none"),e&&(e.style.display="block"),t){let a=t.querySelector("#aipkit_ai_form_preview_container");a&&(a.style.display="none",a.innerHTML="");let s=t.querySelector("#aipkit_preview_ai_form_btn");if(s&&s.classList.contains("aipkit-preview-active")){s.classList.remove("aipkit-preview-active");let l=s.querySelector(".aipkit_btn-text");l&&(l.textContent=n("Preview","gpt3-ai-content-generator"))}}let o=r.querySelector("#aipkit_ai_forms_messages");o&&(o.innerHTML="")}window.aipkitForms_hideFormEditor=c})();(function(){"use strict";function c(r,i){let n=window.aipkitAIFormsState,t=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:B=>B;if(!i){console.error("AI Forms saveForm: formsContainerElement not provided.");return}let o=i.querySelector("#aipkit_form_editor_container");if(!o){console.error("AI Forms saveForm: editorContainer not found in provided formsContainerElement.");return}let a=o.querySelector("#aipkit_ai_form_title"),s=o.querySelector("#aipkit_ai_form_prompt_template"),l=o.querySelector("#aipkit_ai_form_id"),d=o.querySelector("#aipkit_ai_form_ai_provider"),p=o.querySelector("#aipkit_ai_form_ai_model"),_=o.querySelector("#aipkit_ai_form_temperature"),u=o.querySelector("#aipkit_ai_form_max_tokens"),f=o.querySelector("#aipkit_ai_form_top_p"),m=o.querySelector("#aipkit_ai_form_frequency_penalty"),g=o.querySelector("#aipkit_ai_form_presence_penalty"),k=o.querySelector('input[name="enable_vector_store"]'),w=o.querySelector('select[name="vector_store_provider"]'),b=o.querySelector('select[name="openai_vector_store_ids[]"]'),y=o.querySelector('select[name="pinecone_index_name"]'),h=o.querySelector('select[name="qdrant_collection_name"]'),v=o.querySelector('select[name="vector_embedding_provider"]'),S=o.querySelector('select[name="vector_embedding_model"]'),I=o.querySelector('input[name="vector_store_top_k"]');if(!a||!s||!l||!d||!p||!_||!u||!f||!m||!g){console.error("AI Forms saveForm: One or more critical form editor inputs not found in editorContainer.");return}let E=a.value.trim(),P=s.value.trim(),T=l.value;if(!E){alert(e(t.text.formTitleRequired||"Form title is required.","gpt3-ai-content-generator"));return}if(!P){alert(e(t.text.promptTemplateRequired||"Prompt template is required.","gpt3-ai-content-generator"));return}let x=new Set,A=!0;e:for(let B of n.formStructure)for(let M of B.columns)for(let F of M.elements){if(!F.fieldId||!/^[a-zA-Z0-9_]+$/.test(F.fieldId)){alert(e(`Invalid Field Variable Name: "${F.fieldId||""}" for element "${F.label}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(F.internalId,i);let H=o.querySelector(`#setting-field-id-${F.internalId}`);H&&H.focus(),A=!1;break e}if(x.has(F.fieldId)){alert(e(`Duplicate Field Variable Name: "${F.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(F.internalId,i);let H=o.querySelector(`#setting-field-id-${F.internalId}`);H&&H.focus(),A=!1;break e}x.add(F.fieldId)}if(!A)return;let C=b?Array.from(b.selectedOptions).map(B=>B.value):[],q=o.querySelectorAll('input[name^="labels["]'),N={};q.forEach(B=>{let M=B.name.match(/\[(.*?)\]/);if(M&&M[1]){let F=M[1];N[F]=B.value}});let O=JSON.stringify(N),L={_ajax_nonce:t.nonce_manage_forms,form_id:T||null,title:E,prompt_template:P,form_structure:JSON.stringify(n.formStructure),ai_provider:d.value,ai_model:p.value,temperature:_.value,max_tokens:u.value,top_p:f.value,frequency_penalty:m.value,presence_penalty:g.value,enable_vector_store:k?.checked?"1":"0",vector_store_provider:w?.value,openai_vector_store_ids:C,pinecone_index_name:y?.value||"",qdrant_collection_name:h?.value||"",vector_embedding_provider:v?.value,vector_embedding_model:S?.value||"",vector_store_top_k:I?.value||3,labels:O};console.log("AIPKit AI Forms - Data to be saved:",L);let $=r.querySelector(".aipkit_btn-text")?r.querySelector(".aipkit_btn-text").textContent:r.textContent,D=r.querySelector(".aipkit_spinner");r.disabled=!0,D&&(D.style.display="inline-block"),r.querySelector(".aipkit_btn-text")?r.querySelector(".aipkit_btn-text").textContent=e(t.text.savingForm||"Saving...","gpt3-ai-content-generator"):r.firstChild.textContent=e(t.text.savingForm||"Saving...","gpt3-ai-content-generator")+" ",window.aipkit_apiRequest("aipkit_save_ai_form",L).then(B=>{if(!T&&B.form_id){l&&(l.value=B.form_id),n.currentFormId=B.form_id;let M=o.querySelector("#aipkit_preview_ai_form_btn");M&&(M.disabled=!1)}typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",B.message||e(t.text.formSaved||"Form saved!","gpt3-ai-content-generator")),typeof window.aipkitForms_hideFormEditor=="function"&&window.aipkitForms_hideFormEditor(i),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(B=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",B.message||e(t.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator"))}).finally(()=>{r.disabled=!1,D&&(D.style.display="none"),r.querySelector(".aipkit_btn-text")?r.querySelector(".aipkit_btn-text").textContent=$:r.firstChild.textContent=$})}window.aipkitForms_saveForm=c})();(function(){"use strict";function c(r,i,n){let t=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!n){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let o={_ajax_nonce:t.nonce_manage_forms,form_id:r},a=i.textContent;i.disabled=!0,i.textContent=e(t.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",o).then(s=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",s.message||e(t.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(s=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",s.message||e(t.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let l=n.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${r}"]`);l&&(l.disabled=!1,l.textContent=a)})}window.aipkitForms_deleteForm=c})();(function(){"use strict";function c(r,i){let n=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!i){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let e={_ajax_nonce:n.nonce_manage_forms},o=r.querySelector(".aipkit_btn-text")?.textContent||t("Delete All Forms","gpt3-ai-content-generator"),a=r.querySelector(".aipkit_spinner");r.disabled=!0,r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${t(n.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",e).then(s=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",s.message||t(n.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(s=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",s.message||t(n.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").textContent=o),a&&(a.style.display="none"),r.disabled=!1})}window.aipkitForms_deleteAllForms=c})();(function(){"use strict";function c(r,i,n){let t=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!n){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let o={_ajax_nonce:t.nonce_manage_forms,form_id:r},a=i.textContent;i.disabled=!0,i.textContent=e(t.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",o).then(s=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",s.message||e("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(s=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",s.message||e(t.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let s=n.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${r}"]`);s&&(s.disabled=!1,s.textContent=a)})}window.aipkitForms_duplicateForm=c})();(function(){"use strict";async function c(r){let i=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e,t=r.textContent;r.disabled=!0,r.textContent=n("Exporting...","gpt3-ai-content-generator");try{let e=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:i.nonce_manage_forms});if(e.forms&&Array.isArray(e.forms)&&e.forms.length>0){let o=e.forms.map(u=>(delete u.id,delete u.status,u)),s=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,l=JSON.stringify(o,null,2),d=new Blob([l],{type:"application/json"}),p=URL.createObjectURL(d),_=document.createElement("a");_.href=p,_.download=s,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(p)}else throw new Error(n("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(e){alert(n("Error exporting forms: ","gpt3-ai-content-generator")+e.message)}finally{r.disabled=!1,r.textContent=t}}window.aipkitForms_exportAllForms=c})();(function(){"use strict";async function c(r,i){let n=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o,e=i.textContent;i.disabled=!0,i.textContent=t("Exporting...","gpt3-ai-content-generator");try{let o=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:r,_ajax_nonce:n.nonce_manage_forms});if(o.form){let a=o.form,s=a.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),l=`aipkit-form-${r}-${s}.json`;delete a.id,delete a.status;let d=JSON.stringify(a,null,2),p=new Blob([d],{type:"application/json"}),_=URL.createObjectURL(p),u=document.createElement("a");u.href=_,u.download=l,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(_)}else throw new Error(t("Form data not found in response.","gpt3-ai-content-generator"))}catch(o){alert(t("Error exporting form: ","gpt3-ai-content-generator")+o.message)}finally{i.disabled=!1,i.textContent=e}}window.aipkitForms_exportForm=c})();(function(){"use strict";let c=document.getElementById("aipkit_ai_forms_import_messages"),r;function i(e,o){if(!c)return;let a=window.aipkit_escapeHtml||(s=>s);c.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${e}">${a(o)}</div>`,r&&clearTimeout(r),r=setTimeout(()=>{c.innerHTML=""},8e3)}function n(){c&&(c.innerHTML=""),r&&clearTimeout(r)}async function t(e){let o=window.aipkit_ai_forms_config||{text:{}},a=window.wp?.i18n?.__||(p=>p),s=e.files;if(!s.length)return;let l=s[0];n(),i("info",a("Reading file...","gpt3-ai-content-generator"));let d=new FileReader;d.onload=async function(p){try{let _=p.target.result,u=JSON.parse(_);if(typeof u=="object"&&u!==null&&!Array.isArray(u)&&(u=[u]),!Array.isArray(u))throw new Error(a("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(u.length===0){i("warning",a("File contains no forms to import.","gpt3-ai-content-generator"));return}i("info",a("Importing...","gpt3-ai-content-generator"));let f=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:o.nonce_manage_forms,forms_json:JSON.stringify(u)});i(f.failed_count>0?"warning":"success",f.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(_){i("error",a("Error processing import file: ","gpt3-ai-content-generator")+_.message)}},d.onerror=function(){i("error",a("Error reading the selected file.","gpt3-ai-content-generator"))},d.readAsText(l)}window.aipkitForms_importForms=t})();(function(){"use strict";function c(r){let i=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:d=>d,t=document.getElementById("aipkit_ai_forms_settings_form");if(!t){console.error("AI Forms Save Settings: Settings form not found.");return}let e="aipkit_aiforms_settings_save_status";window.aipkit_showSavingIndicator(e,!1);let o=r.querySelector(".aipkit_btn-text")?.textContent||n("Save AI Forms Settings","gpt3-ai-content-generator"),a=r.querySelector(".aipkit_spinner");r.disabled=!0,a&&(a.style.display="inline-block"),r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").textContent=n("Saving...","gpt3-ai-content-generator"));let s=new FormData(t),l=Object.fromEntries(s.entries());window.aipkit_apiRequest("aipkit_save_ai_forms_settings",l).then(d=>{window.aipkit_showMessage(e,"success",d.message||n("Settings saved!","gpt3-ai-content-generator"))}).catch(d=>{window.aipkit_showMessage(e,"error",d.message||n("Failed to save settings.","gpt3-ai-content-generator")),console.error("AI Forms Save Settings Error:",d)}).finally(()=>{r.disabled=!1,a&&(a.style.display="none"),r.querySelector(".aipkit_btn-text")&&(r.querySelector(".aipkit_btn-text").textContent=o)})}window.aipkitForms_saveAiFormsSettings=c})();(function(){"use strict";function c(r,i,n){let t=window.aipkit_escapeHtml||function(o){return o};if(!r){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let e=r.querySelector("#aipkit_ai_forms_messages");e?(e.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${i}">${t(n)}</div>`,setTimeout(()=>{e.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=c})();(function(){"use strict";function c(i){if(!i){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let n=i.querySelector(".aipkit_token_limit_mode_select"),t=i.querySelector(".aipkit_token_general_user_limit_field"),e=i.querySelector(".aipkit_token_role_limits_container");if(!n||!t||!e){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let o=n.value;t.style.display=o==="general"?"block":"none",e.style.display=o==="role_based"?"block":"none"}function r(i){if(!i){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let n="data-token-listener-attached";i.getAttribute(n)!=="true"&&(i.addEventListener("change",function(t){t.target.closest(".aipkit_token_limit_mode_select")&&c(i)}),c(i),i.setAttribute(n,"true"),console.log("AIPKit AI Forms Token Management UI Initialized."))}window.aipkit_initAIFormsTokenManagementUI=r})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_ai_forms_container");return r||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=c})();(function(){"use strict";function c(r){let i=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e,t=window.aipkit_escapeHtml||function(e){return e};r.dataset.clickListenerAttached!=="true"&&(r.addEventListener("click",function(e){let o=e.target,a=l=>o.closest(l),s=r.querySelector("#aipkit_form_editor_container");if(o.matches("#aipkit_create_new_ai_form_btn")||a("#aipkit_create_new_ai_form_btn")){e.preventDefault();let l=r.querySelector('.aipkit_tab[data-tab="forms-main"]');l&&!l.classList.contains("aipkit_active")&&l.click(),typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,r)}else if(a(".aipkit_actions_menu_toggle")){e.preventDefault(),e.stopPropagation();let l=o.closest(".aipkit_actions_menu");if(!l)return;let d=l.querySelector(".aipkit_actions_dropdown_menu");if(!d)return;let p=d.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(_=>{_!==d&&(_.style.display="none")}),d.style.display=p?"none":"block",!p){let _=u=>{l.contains(u.target)||(d.style.display="none")};document.addEventListener("click",_,{once:!0,capture:!0})}}else if(a("#aipkit_import_ai_forms_btn")){e.preventDefault();let l=r.querySelector("#aipkit_ai_forms_import_file_input");l&&l.click()}else if(o.matches(".aipkit_edit_ai_form_btn")||a(".aipkit_edit_ai_form_btn")){e.preventDefault();let d=a(".aipkit_edit_ai_form_btn").dataset.formId;typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(d,r)}else if(o.matches(".aipkit_duplicate_ai_form_btn")||a(".aipkit_duplicate_ai_form_btn")){e.preventDefault();let l=a(".aipkit_duplicate_ai_form_btn"),d=l.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(d,l,r)}else if(o.matches("#aipkit_export_all_ai_forms_btn")||a("#aipkit_export_all_ai_forms_btn")){e.preventDefault();let l=a("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(l)}else if(o.matches(".aipkit_export_ai_form_btn")||a(".aipkit_export_ai_form_btn")){e.preventDefault();let l=a(".aipkit_export_ai_form_btn"),d=l.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(d,l)}else if(o.matches(".aipkit_delete_ai_form_btn")||a(".aipkit_delete_ai_form_btn")){e.preventDefault();let l=a(".aipkit_delete_ai_form_btn"),d=l.dataset.formId,p=l.dataset.formTitle||`Form ID ${d}`;confirm(`${n(i.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${p}`)&&typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(d,l,r)}else if(o.matches("#aipkit_delete_all_ai_forms_btn")||a("#aipkit_delete_all_ai_forms_btn")){e.preventDefault();let l=a("#aipkit_delete_all_ai_forms_btn");confirm(n(i.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"))&&typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(l,r)}else if(o.matches(".aipkit_form_shortcode_input"))e.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(o.value,o);else if(a(".aipkit_aiform_settings_toggle")){e.preventDefault();let l=a(".aipkit_aiform_settings_toggle"),d=l.dataset.formId,p=r.querySelector(`#aif-configurator-${d}`);if(!p)return;r.querySelectorAll(".aipkit_shortcode_configurator").forEach(f=>{f!==p&&(f.style.display="none")});let u=p.style.display==="block";if(p.style.display=u?"none":"block",!u){let f=m=>{!p.contains(m.target)&&!l.contains(m.target)&&(p.style.display="none",document.removeEventListener("click",f,!0))};setTimeout(()=>{document.addEventListener("click",f,{capture:!0,once:!0})},0)}}else if(o.matches("#aipkit_validate_prompt_btn")||a("#aipkit_validate_prompt_btn"))e.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(a("#aipkit_ai_form_toggle_params_btn")){e.preventDefault();let l=a("#aipkit_ai_form_toggle_params_btn"),d=s.querySelector("#aipkit_ai_form_advanced_params_container");if(d){let p=d.style.display!=="none";d.style.display=p?"none":"block",l.classList.toggle("aipkit-active",!p)}}else if(o.matches("#aipkit_save_ai_form_btn")||a("#aipkit_save_ai_form_btn")){e.preventDefault();let l=a("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(l,r)}else if(o.matches("#aipkit_cancel_edit_ai_form_btn")||a("#aipkit_cancel_edit_ai_form_btn"))e.preventDefault(),typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(r);else if(o.matches("#aipkit_preview_ai_form_btn")||a("#aipkit_preview_ai_form_btn")){let u=function(m){if(!document.querySelector(`link[href="${m}"]`)){let g=document.createElement("link");g.rel="stylesheet",g.href=m,document.head.appendChild(g)}},f=function(m){return new Promise((g,k)=>{if(document.querySelector(`script[src="${m}"]`)){g();return}let b=document.createElement("script");b.src=m,b.async=!0,b.onload=()=>g(),b.onerror=()=>k(new Error(`Failed to load script: ${m}`)),document.body.appendChild(b)})};e.preventDefault();let l=a("#aipkit_preview_ai_form_btn"),d=s.querySelector("#aipkit_ai_form_preview_container"),p=l.querySelector(".aipkit_btn-text");if(!l||!d||!p){console.error("AI Forms Preview: Missing required UI elements (button, container, or text span).");return}if(l.classList.contains("aipkit-preview-active")){d.style.display="none",d.innerHTML="",l.classList.remove("aipkit-preview-active"),p.textContent=n("Preview","gpt3-ai-content-generator");return}let _=s.querySelector("#aipkit_ai_form_id").value;if(!_){alert(n("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}l.classList.add("aipkit-preview-active"),p.textContent=n("Close Preview","gpt3-ai-content-generator"),d.innerHTML='<p style="text-align:center;"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading Preview...</p>',d.style.display="block",window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:_,_ajax_nonce:i.nonce_manage_forms}).then(m=>{if(m.config&&(window.aipkit_ai_forms_public_config=m.config),m.models&&(window.aipkit_ai_forms_models=m.models),m.assets&&m.assets.css&&Object.values(m.assets.css).forEach(g=>u(g)),d.innerHTML=m.html,m.assets&&m.assets.js){let g=Object.values(m.assets.js).map(k=>f(k));return Promise.all(g)}}).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(m=>{console.error("Error fetching form preview:",m),d.innerHTML=`<p style="color:red;">Error: ${t(m.message)}</p>`,l.classList.remove("aipkit-preview-active"),p.textContent=n("Preview","gpt3-ai-content-generator")})}else if(a(".aipkit_dropped_element_settings_btn")){e.preventDefault();let l=a(".aipkit_dropped_element");l&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(l.id,r)}else if(a(".aipkit_dropped_element_delete_btn")){e.preventDefault();let l=a(".aipkit_dropped_element");l&&confirm(n(i.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(l.id,r)}else if(a(".aipkit_layout_row_delete_btn")){if(e.preventDefault(),confirm(n("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let l=a(".aipkit_layout_row");l&&(Array.from(l.querySelectorAll(".aipkit_dropped_element")).map(p=>p.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(r),l.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(r))}}else if(a("#aipkit_settings_panel_close_btn"))e.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(r);else if(a(".aipkit_remove_option_btn")){e.preventDefault();let l=a(".aipkit_select_option_row");l&&(l.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,r))}else if(a("#aipkit_add_select_option_btn"))e.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(r);else if(a("#aipkit_save_ai_forms_settings_btn")){e.preventDefault();let l=a("#aipkit_save_ai_forms_settings_btn");typeof window.aipkitForms_saveAiFormsSettings=="function"&&window.aipkitForms_saveAiFormsSettings(l)}}),r.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=c})();(function(){"use strict";function c(i,n){if(!i)return;let t=n.querySelector(`#aif-configurator-${i}`),e=n.querySelector(`#aif-shortcode-input-${i}`);if(!t||!e)return;let o=t.querySelectorAll(".aipkit-aiform-config-input"),a=[];o.forEach(l=>{let d=l.dataset.attrName;d&&(l.type==="checkbox"?l.checked&&a.push(`${d}="true"`):l.type==="select-one"&&l.value&&l.value!=="light"&&a.push(`${d}="${l.value}"`))});let s=`[aipkit_ai_form id=${i}`;a.length>0&&(s+=" "+a.join(" ")),s+="]",e.value=s}function r(i){i.dataset.changeListenerAttached!=="true"&&(i.addEventListener("change",function(n){let t=n.target;if(t.matches(".aipkit-aiform-config-input")){let e=t.dataset.formId;c(e,i)}else t.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(t),t.value="")}),i.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=r})();(function(){"use strict";function c(r){let i=window.aipkitAIFormsState,n=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!n){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(n.dataset.inputListenerAttached==="true")return;let t=()=>{i.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(i.selectedDesignerElementId,r)};n.addEventListener("input",e=>{e.target.matches(".aipkit-setting-field")&&t()}),n.addEventListener("change",e=>{e.target.matches('.aipkit-setting-field[type="checkbox"]')&&t()}),n.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=c})();(function(){"use strict";function c(r){let i=window.aipkitAIFormsState;if(!r){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let n=r.querySelector("#aipkit_ai_form_elements_palette"),t=r.querySelector("#aipkit_ai_form_designer_area");if(!n||!t){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(n.dataset.dragListenersAttached==="true"&&t.dataset.dragListenersAttached==="true")return;n.querySelectorAll(".aipkit_form_element_item").forEach(o=>{o.dataset.dragStartListenerAttached!=="true"&&(o.addEventListener("dragstart",a=>{a.target.classList.add("aipkit-dragging"),i.draggedElement=null,a.target.dataset.layoutType?(i.draggedLayoutType=a.target.dataset.layoutType,i.draggedElementType=null,a.dataTransfer.setData("text/plain",i.draggedLayoutType),a.dataTransfer.effectAllowed="copy"):(i.draggedElementType=a.target.dataset.elementType,i.draggedLayoutType=null,a.dataTransfer.setData("text/plain",i.draggedElementType),a.dataTransfer.effectAllowed="copy")}),o.addEventListener("dragend",a=>{a.target.classList.remove("aipkit-dragging"),i.draggedElementType=null,i.draggedLayoutType=null}),o.dataset.dragStartListenerAttached="true")}),n.dataset.dragListenersAttached="true",t.dataset.dragListenersAttached!=="true"&&(t.addEventListener("dragstart",o=>{let a=o.target.closest(".aipkit_layout_row"),s=o.target.closest(".aipkit_dropped_element");if(a&&o.target.classList.contains("aipkit_layout_row_drag_handle"))i.draggedElement=a,o.dataTransfer.setData("text/row-id",a.id),o.dataTransfer.effectAllowed="move";else if(s&&o.target.classList.contains("aipkit_dropped_element_drag_handle"))i.draggedElement=s,o.dataTransfer.setData("text/element-id",s.id),o.dataTransfer.effectAllowed="move";else return;i.draggedElementType=null,i.draggedLayoutType=null,setTimeout(()=>{i.draggedElement&&i.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),t.addEventListener("dragend",o=>{i.draggedElement&&(i.draggedElement.classList.remove("aipkit-row-dragging-source"),i.draggedElement=null)}),t.addEventListener("dragover",o=>{o.preventDefault(),t.classList.add("aipkit-drag-over"),i.draggedElement?o.dataTransfer.dropEffect="move":o.dataTransfer.dropEffect="copy"}),t.addEventListener("dragleave",o=>{t.contains(o.relatedTarget)||t.classList.remove("aipkit-drag-over")}),t.addEventListener("drop",o=>{o.preventDefault(),o.stopPropagation(),t.classList.remove("aipkit-drag-over");let a=t.querySelector("#aipkit_form_designer_placeholder");if(i.draggedLayoutType){a&&(a.style.display="none");let s=window.aipkitForms_createNewLayoutData(i.draggedLayoutType);i.formStructure.push(s),window.aipkitForms_renderLayoutRow(t,s,null,r),i.draggedLayoutType=null}else if(i.draggedElement&&i.draggedElement.classList.contains("aipkit_layout_row")){let s=o.target.closest(".aipkit_layout_row");if(s&&s!==i.draggedElement){let l=s.getBoundingClientRect(),p=o.clientY>l.top+l.height/2?s.nextSibling:s;t.insertBefore(i.draggedElement,p)}window.aipkitForms_updateFormStructureOrder()}else if(i.draggedElementType){a&&(a.style.display="none");let s=window.aipkitForms_createNewLayoutData("1-col"),l=window.aipkitForms_createNewFormElementData(i.draggedElementType);s.columns[0].elements.push(l),i.formStructure.push(s),window.aipkitForms_renderLayoutRow(t,s,null,r),i.draggedElementType=null}i.draggedElement&&(i.draggedElement.classList.remove("aipkit-row-dragging-source"),i.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r)}),t.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=c})();(function(){"use strict";function c(r){let i=r.querySelector("#forms-settings-content");i&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(i):console.error("AI Forms Init: Could not initialize token management UI for settings tab.")}window.aipkitForms_initializeTokenUI=c})();(function(){"use strict";function c(r){if(!r)return;let i="data-accordion-listener-attached";r.getAttribute(i)!=="true"&&(r.addEventListener("click",function(n){let t=n.target.closest(".aipkit_accordion-header");if(!t||!t.closest(".aipkit_ai_forms_container"))return;n.preventDefault();let e=t.closest(".aipkit_accordion-group");if(e&&!t.classList.contains("aipkit_active")){let a=e.querySelector(".aipkit_accordion-header.aipkit_active");if(a){a.classList.remove("aipkit_active");let s=a.nextElementSibling;s&&s.classList.remove("aipkit_active")}}let o=t.nextElementSibling;o&&(t.classList.toggle("aipkit_active"),o.classList.toggle("aipkit_active"))}),r.setAttribute(i,"true"),console.log("[AI Forms Init] Accordion listeners initialized."))}window.aipkitForms_initializeAccordions=c})();(function(){"use strict";function c(i,n=""){let t=document.getElementById("aipkit_ai_form_ai_model"),e=window.aipkit_dashboard?.models||{};if(!t||!e){console.warn("AI Forms Config: Model select or global models data not found.");return}let o=i.toLowerCase(),a=e[o]||[];if(t.innerHTML="",!a||Array.isArray(a)&&a.length===0||!Array.isArray(a)&&Object.keys(a).length===0){let l=new Option("No models found. Sync in main settings.","");t.appendChild(l);return}let s=!1;if(Array.isArray(a)?a.forEach(l=>{let d=new Option(l.name,l.id);l.id===n&&(d.selected=!0,s=!0),t.appendChild(d)}):Object.keys(a).forEach(l=>{let d=document.createElement("optgroup");d.label=l,a[l].forEach(p=>{let _=new Option(p.name,p.id);p.id===n&&(_.selected=!0,s=!0),d.appendChild(_)}),t.appendChild(d)}),!s&&n){let l=new Option(`${n} (Manual/Not Synced)`,n,!1,!0);t.insertBefore(l,t.firstChild),l.selected=!0}t.selectedIndex===-1&&t.options.length>0&&(t.options[0].selected=!0)}function r(i){let n=i.querySelector("#aipkit_ai_form_ai_provider");if(!n){console.warn("AI Forms Config Init: AI Provider select not found in editor.");return}n.dataset.modelListenerAttached!=="true"&&(n.addEventListener("change",function(){c(this.value)}),n.dataset.modelListenerAttached="true"),c(n.value)}window.aipkitForms_initAiConfig=r,window.aipkitForms_populateAiModels=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(t){return t};function r(t){if(!t)return;let e=t.querySelector(".aipkit_ai_form_vector_store_toggle"),o=t.querySelector(".aipkit_ai_form_vector_store_conditional_settings"),a=t.querySelector(".aipkit_ai_form_vector_store_provider_select"),s=t.querySelector(".aipkit_ai_form_embedding_config_row");if(!e||!o||!a)return;let l=e.checked;if(o.style.display=l?"block":"none",l){let d=a.value;o.querySelectorAll(".aipkit_ai_form_vector_openai_field, .aipkit_ai_form_vector_pinecone_field, .aipkit_ai_form_vector_qdrant_field").forEach(u=>u.style.display="none");let _=o.querySelector(`.aipkit_ai_form_vector_${d}_field`);_&&(_.style.display="block"),s&&(s.style.display=d==="pinecone"||d==="qdrant"?"block":"none")}}function i(t){let e=t.querySelector(".aipkit_ai_form_vector_embedding_provider_select"),o=t.querySelector(".aipkit_ai_form_vector_embedding_model_select"),s=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!e||!o||!s)return;let d=e.value.toLowerCase(),p=s[d]||[];o.innerHTML="",o.appendChild(new Option(`-- Select ${e.options[e.selectedIndex].text} Model --`,"")),p&&Array.isArray(p)&&p.length>0?(p.forEach(_=>{o.appendChild(new Option(c(_.name),_.id))}),o.disabled=!1):(o.appendChild(new Option("(No models found - Sync in Settings)","")),o.disabled=!0)}function n(t){let e=t.querySelector("#aipkit_form_editor_container");if(!e)return;let o=e.querySelector('.aipkit_accordion-content:has(input[name="enable_vector_store"])');if(!o)return;let a="data-vector-config-listener-attached";o.getAttribute(a)!=="true"&&(o.addEventListener("change",s=>{let l=s.target;l.matches(".aipkit_ai_form_vector_store_toggle")||l.matches(".aipkit_ai_form_vector_store_provider_select")?r(o):l.matches(".aipkit_ai_form_vector_embedding_provider_select")&&i(o)}),r(o),i(o),o.setAttribute(a,"true"),console.log("AIPKit AI Forms: Vector Config UI initialized."))}window.aipkitForms_initVectorConfig=n,window.aipkitForms_toggleVectorConfigVisibility=r,window.aipkitForms_populateVectorEmbeddingModels=i})();(function(){"use strict";function c(i,n,t,e){let o=window.aipkitAIFormsState,a=document.createElement("div");a.className="aipkit_layout_row",a.id=n.internalId;let s=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,l=document.createElement("div");l.className="aipkit_layout_row_columns_container",n.columns.forEach(d=>{let p=document.createElement("div");p.className="aipkit_layout_column",p.id=d.internalId,p.style.flexBasis=d.width,r(p,e),d.elements.forEach(_=>{window.aipkitForms_renderFieldInColumn(p,_)}),l.appendChild(p)}),a.innerHTML=s,a.appendChild(l),t?i.insertBefore(a,t):i.appendChild(a)}function r(i,n){let t=window.aipkitAIFormsState;i.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),i.classList.add("aipkit-drag-over"),(t.draggedElement||t.draggedElementType)&&(e.dataTransfer.dropEffect=t.draggedElement?"move":"copy")}),i.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),i.classList.remove("aipkit-drag-over")}),i.addEventListener("drop",e=>{if(e.preventDefault(),i.classList.remove("aipkit-drag-over"),t.draggedElementType||t.draggedElement&&t.draggedElement.classList.contains("aipkit_dropped_element")){e.stopPropagation();let o=i.id;if(t.draggedElementType){let a=window.aipkitForms_createNewFormElementData(t.draggedElementType);t.formStructure.forEach(s=>{let l=s.columns.find(d=>d.internalId===o);l&&l.elements.push(a)}),window.aipkitForms_renderFieldInColumn(i,a,null,n)}else t.draggedElement&&(i.appendChild(t.draggedElement),window.aipkitForms_updateFormStructureOrder());t.draggedElementType=null,t.draggedElement&&(t.draggedElement.classList.remove("aipkit-row-dragging-source"),t.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=c})();(function(){"use strict";function c(){console.log("[AI Forms Init] Main initializer running...");let r=window.aipkitForms_validateContainer();if(r){if(r.dataset.aipkitInitialized==="true"){console.log("[AI Forms Init] Module already initialized. Re-running initial data load."),window.aipkitForms_initializeDragAndDrop(r),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(r);return}window.aipkitForms_attachClickEventListeners(r),window.aipkitForms_attachChangeEventListeners(r),window.aipkitForms_attachSettingsPanelListeners(r),window.aipkitForms_initializeAccordions(r),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(r):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(r),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(r),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(r):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(r):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),r.dataset.aipkitInitialized="true",console.log("[AI Forms Init] Initialization complete.")}}window.aipkit_initAiForms=c})();(function(){"use strict";let c=localStorage.getItem("aipkit_last_global_vector_provider")||"openai";function r(){return c}function i(n){c=n}window.aipkit_getCurrentGlobalVectorProvider=r,window.aipkit_setCurrentGlobalVectorProvider=i})();(function(){"use strict";function c(r,i,n="block",t=null){if(!r||!Array.isArray(i)){console.warn("aipkit_ui_showSection: Invalid arguments provided.");return}i.forEach(e=>{let o=null;t&&t[e]&&t[e]instanceof HTMLElement?o=t[e]:typeof e=="string"&&(o=document.getElementById(e)),o&&(o.id===r||e===r&&t&&t[e]===o?(o.style.display=n,o.classList.add("aipkit-active")):(o.style.display="none",o.classList.remove("aipkit-active")))})}window.aipkit_ui_showSection=c})();(function(){"use strict";async function c(r){let i=r.target.closest(".aipkit-delete-vector-log-btn");if(!i)return;let n=i.dataset.provider,t=i.dataset.storeId,e=i.dataset.vectorId,o=i.dataset.logId;if(!n||!t||!e||!o){console.error("Delete Vector Log: Missing data attributes on the delete button.",i.dataset),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Could not delete record, missing data.","error","aipkit_vs_global_provider_status");return}let a=window.aipkit_escapeHtml||function(l){return l};if(!confirm(`Are you sure you want to delete this record?

ID: ${a(e)}

This will remove the entry from both ${a(n)} and your local logs. This action cannot be undone.`))return;if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Vector Log: Missing required UI or API helper functions.");return}let s="aipkit_vs_global_provider_status";window.aipkit_setLoadingStateOpenAI(i,!0,"","..."),window.aipkit_showOpenAIVectorStatus(`Deleting record ${a(e)}...`,"info",s);try{let l={_ajax_nonce:window.aipkit_dashboard.nonce,provider:n,store_id:t,vector_id:e,log_id:o},d=await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",l);window.aipkit_showOpenAIVectorStatus(d.message||"Record deleted successfully!","success",s);let p=i.closest("tr");p&&(p.style.opacity="0",setTimeout(()=>p.remove(),300))}catch(l){console.error("Delete Vector Log Error:",l),window.aipkit_showOpenAIVectorStatus(`Error: ${l.message||"Failed to delete the record."}`,"error",s),window.aipkit_setLoadingStateOpenAI(i,!1,"","")}}window.aipkit_handleDeleteVectorLogEntryClick=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_vs_global_provider_status"),n=window.aipkit_escapeHtml||function(p){return p};if(!i){console.warn("Update Provider Status: Status div (#aipkit_vs_global_provider_status) not found.");return}i.innerHTML="",i.style.display="none";let t=!0,e=!0,o=window.aipkit_openai_vs_config||{},a=window.aipkit_pinecone_vs_config||{},s=window.aipkit_qdrant_vs_config||{};r==="openai"?t=o.apiKeyIsSet!==!1:r==="pinecone"?t=a.apiKeyIsSet!==!1:r==="qdrant"&&(t=s.apiKeyIsSet!==!1,e=s.urlIsSet!==!1);let l="",d=r.charAt(0).toUpperCase()+r.slice(1);if(t||(l+=`${d} API Key not set. `),!e&&r==="qdrant"&&(l+=`${d} URL not set. `),l.trim()!==""){let p=r==="openai"||r==="google"?"providers":"integrations",_=`${window.aipkit_dashboard.adminUrl}?page=wpaicg#${p}`;i.innerHTML=`<span class="aipkit_text-danger">${n(l.trim())} <a href="${n(_)}">Configure Now</a></span>`,i.style.display="block"}}window.aipkit_updateGlobalProviderStatusMessage=c})();(function(){"use strict";let c="aipkit_last_global_vector_provider",r={openai:"Store",pinecone:"Index",qdrant:"Collection"};async function i(n){let t=n.target.value;if(!t)return;let e=["aipkit_setCurrentGlobalVectorProvider","aipkit_updateTargetLabel","aipkit_ui_showSection","aipkit_updateGlobalProviderStatusMessage","aipkit_populateGlobalOpenAITargetSelect","aipkit_listPineconeIndexes","aipkit_listQdrantCollections","aipkit_handleGlobalTargetSelectChange","aipkit_populateGlobalEmbeddingModelSelect"];for(let f of e)if(typeof window[f]!="function"){console.error(`AIPKit Handle Provider Switch: Missing dependency function: ${f}.`);return}window.aipkit_setCurrentGlobalVectorProvider(t),localStorage.setItem(c,t),window.aipkit_updateTargetLabel(r[t]||"Target Store/Index/Collection");let o=["aipkit_vector_openai_management_ui","aipkit_vector_pinecone_management_ui","aipkit_vector_qdrant_management_ui"],a=`aipkit_vector_${t}_management_ui`;window.aipkit_ui_showSection(a,o,"block");let s=document.getElementById(a),d={openai:window.aipkit_initOpenAIVectorStore,pinecone:window.aipkit_initPineconeUI,qdrant:window.aipkit_initQdrantVectorStoreUI}[t];if(s&&typeof d=="function"&&!s.dataset.providerUiInitialized)try{d(),s.dataset.providerUiInitialized="true"}catch(f){console.error(`Error initializing UI for ${t}:`,f)}let p=document.getElementById("aipkit_vs_global_target_select");if(p){p.innerHTML='<option value="">Loading...</option>',p.disabled=!0;let f;t==="openai"?f=window.aipkit_populateGlobalOpenAITargetSelect(!1):t==="pinecone"?f=window.aipkit_listPineconeIndexes(null,!0):t==="qdrant"?f=window.aipkit_listQdrantCollections(null,!0):(p.innerHTML='<option value="" disabled>-- Select Provider First --</option>',f=Promise.resolve()),await f,window.aipkit_handleGlobalTargetSelectChange({target:p})}window.aipkit_updateGlobalProviderStatusMessage(t);let _=document.getElementById("aipkit_vs_global_embedding_model_inline_group");t==="pinecone"||t==="qdrant"?(_&&(_.style.display="block"),window.aipkit_populateGlobalEmbeddingModelSelect()):_&&(_.style.display="none");let u={openai:document.getElementById("aipkit_vs_global_add_openai_store_btn"),pinecone:document.getElementById("aipkit_vs_global_add_pinecone_index_btn"),qdrant:document.getElementById("aipkit_vs_global_add_qdrant_collection_btn")};for(let f in u)if(u[f]){let m=f===t,g=p?p.value.startsWith("_create_new_"):!1;u[f].style.display=m&&!g?"inline-flex":"none"}}window.aipkit_handleGlobalProviderSwitch=i,window.aipkit_updateTargetLabel=function(n){let t=document.getElementById("aipkit_vs_global_target_label");t&&(t.textContent=n)}})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_vs_global_provider_select");if(r){if(typeof window.aipkit_setCurrentGlobalVectorProvider!="function"||typeof window.aipkit_handleGlobalProviderSwitch!="function"){console.error("AIPKit Provider Switcher Init: Missing required utility functions (setCurrentGlobalVectorProvider or handleGlobalProviderSwitch).");return}let i=localStorage.getItem("aipkit_last_global_vector_provider")||"openai";r.value=i,window.aipkit_setCurrentGlobalVectorProvider(i),window.aipkit_handleGlobalProviderSwitch({target:r}),r.addEventListener("change",window.aipkit_handleGlobalProviderSwitch),console.log("AIPKit AI Training: Global Provider Switcher initialized.")}else console.warn("AIPKit Provider Switcher Init: Global provider select element (#aipkit_vs_global_provider_select) not found.")}window.aipkit_initGlobalProviderSwitcher=c})();(function(){"use strict";function c(r,i=2){if(!+r)return"0 B";let n=1024,t=i<0?0:i,e=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(r)/Math.log(n));return`${parseFloat((r/Math.pow(n,o)).toFixed(t))} ${e[o]}`}window.aipkit_formatFileSize=c})();(function(){"use strict";function c(r,i="info",n="aipkit_vector_stores_list_status_openai_collapsible"){let t=document.getElementById(n);if(!t){console.warn(`showOpenAIVectorStatus: Status container #${n} not found.`);return}t.messageTimeoutId&&clearTimeout(t.messageTimeoutId),t.messageTimeoutId=null;let e=r?r.trim():"";e!==""?(t.className="aipkit_form-help",i==="success"?t.classList.add("aipkit_settings_message-success"):i==="error"?t.classList.add("aipkit_settings_message-error"):t.classList.add("aipkit_settings_message-info"),t.textContent=e,t.style.display="block",t.style.opacity="1",t.classList.add("aipkit-active"),t.messageTimeoutId=setTimeout(()=>{t.style.opacity="0",setTimeout(()=>{t.textContent===e&&(t.textContent="",t.className="aipkit_form-help",t.style.display="none",t.classList.remove("aipkit-active"))},300)},5e3)):(t.textContent="",t.className="aipkit_form-help",t.style.display="none",t.style.opacity="0",t.classList.remove("aipkit-active"))}window.aipkit_showOpenAIVectorStatus=c})();(function(){"use strict";function c(r,i,n){console.error(`AIPKit OpenAI Vector Store (${i}):`,r);let t=r?.message||`Failed to ${i.replace(/_/g," ")}.`;typeof window.aipkit_showOpenAIVectorStatus=="function"?window.aipkit_showOpenAIVectorStatus(t,"error",n):alert("Error: "+t)}window.aipkit_handleOpenAIAjaxError=c})();(function(){"use strict";function c(r,i,n="Submit",t="Processing..."){if(!r)return;let e=r.querySelector(".aipkit_btn-text"),o=r.querySelector(".aipkit_spinner"),a=r.querySelector(".dashicons");if(i){if(r.disabled=!0,!r.dataset.originalText)if(e)r.dataset.originalText=e.textContent;else{let l="";r.childNodes.forEach(d=>{d.nodeType===Node.TEXT_NODE&&(l+=d.textContent.trim())}),r.dataset.originalText=l.trim()||n}a&&(a.dataset.originalDisplay||(a.dataset.originalDisplay=a.style.display||"inline-block"),a.style.display="none");let s=r.dataset.loadingText||t;e?e.textContent=s:(!a||a.style.display==="none")&&(Array.from(r.childNodes).forEach(l=>{l.nodeType===Node.TEXT_NODE&&l.remove()}),s&&r.insertBefore(document.createTextNode(s),r.firstChild)),o&&(o.style.display="inline-block")}else{r.disabled=!1;let s=r.dataset.originalText||n;a&&a.dataset.originalDisplay&&(a.style.display=a.dataset.originalDisplay,delete a.dataset.originalDisplay),e?e.textContent=s:(!a||a.style.display!=="none")&&(Array.from(r.childNodes).forEach(l=>{l.nodeType===Node.TEXT_NODE&&l.remove()}),s&&(!a||a.style.display==="none")&&r.insertBefore(document.createTextNode(s),r.firstChild)),o&&(o.style.display="none"),delete r.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=c})();(function(){"use strict";function c(r){let i=window.aipkit_openai_vs_refs;if(!i.rightColumnContainer){console.error("showRightColumnSection: refs.rightColumnContainer (OpenAI main content area) is not defined or found.");return}let n=[i.rightColumnPlaceholder,i.manageFilesPanel,i.searchStoreFormWrapper],t=!1;n.forEach(e=>{e&&e.id&&(e.id===r?(e.style.display="flex",e.classList.add("aipkit-active"),t=!0):(e.style.display="none",e.classList.remove("aipkit-active")))}),!t&&i.rightColumnPlaceholder&&(i.rightColumnPlaceholder.style.display="flex",i.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showRightColumnSection=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};async function r(i,n){let t=document.getElementById(i);if(t&&!(t.dataset.limitsLoaded==="true"&&t.innerHTML!=="")){if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Display Upload Limits: Missing showOpenAIVectorStatus or aipkit_apiRequest."),t.innerHTML='<span class="aipkit_text-danger">Error: UI components missing.</span>',t.style.display="block";return}try{window.aipkit_showOpenAIVectorStatus("Fetching upload limits...","info",n);let e=document.getElementById("aipkit_vector_store_nonce_openai");if(!e||!e.value)throw new Error("Nonce field not found for upload limits.");let o=await window.aipkit_apiRequest("aipkit_get_upload_limits",{_ajax_nonce:e.value});if(o&&o.effective_upload_limit_formatted)t.innerHTML=`<strong>Max file size:</strong> ${c(o.effective_upload_limit_formatted)}. Server limits: PHP upload_max_filesize: ${c(o.upload_max_filesize_hr)}, PHP post_max_size: ${c(o.post_max_size_hr)}.`,t.style.display="block",t.dataset.limitsLoaded="true",window.aipkit_showOpenAIVectorStatus("","info",n);else throw new Error("Invalid limit data received.")}catch(e){console.error("Error fetching upload limits:",e),t.innerHTML='<span class="aipkit_text-danger">Could not retrieve upload limits.</span>',t.style.display="block",window.aipkit_showOpenAIVectorStatus("Could not retrieve upload limits.","error",n)}}}window.aipkit_displayUploadLimits=r})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(t){return t},i="aipkit_last_openai_vs_id";window.aipkit_openai_fetched_stores_data=window.aipkit_openai_fetched_stores_data||{};async function n(t=!1){let e=document.getElementById("aipkit_vs_global_target_select"),o="aipkit_vs_global_provider_status";if(!e)return console.error("Populate Global Target Select: Select element #aipkit_vs_global_target_select not found."),Promise.reject(new Error("Global target select not found."));let a=e.value,s=localStorage.getItem(i),l=e.offsetWidth;l>0&&(e.style.minWidth=`${l}px`,e.style.width=`${l}px`),e.innerHTML=`<option value="">${r(c.loading_stores||"Loading stores...")}</option>`,e.disabled=!0,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("","info",o);let d=null;if(!t&&window.aipkit_initial_openai_stores&&Array.isArray(window.aipkit_initial_openai_stores))d=window.aipkit_initial_openai_stores,console.log("AIPKit OpenAI Store List: Using initial localized stores for global select."),d.length===0&&typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No OpenAI stores found in local registry. Sync or create one.","info",o);else{console.log(`AIPKit OpenAI Store List: Fetching stores via API for global select (forceApiFetch: ${t}).`);try{let u=document.getElementById("aipkit_vector_store_nonce_openai");if(!u||!u.value)throw new Error("OpenAI Vector Store nonce not found for populating global select.");let f={_ajax_nonce:u.value,limit:100,order:"desc"};d=(await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",f)).stores,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Stores synced with OpenAI.","success",o)}catch(u){return console.error("Populate Global Target Select: Error fetching stores via API:",u),e.innerHTML=`<option value="">${r(c.error_fetching_stores||"Error loading stores.")}</option>`,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(u.message||"Failed to load stores for global select.","error",o),e.disabled=!1,e.style.minWidth="",e.style.width="",Promise.reject(u)}}e.innerHTML="",e.appendChild(new Option(`${r(c.selectTargetStore||"-- Select Store --")}`,"")),d&&Array.isArray(d)?(window.aipkit_openai_fetched_stores_data={},d.forEach(u=>{if(u&&u.id){window.aipkit_openai_fetched_stores_data[u.id]=u;let f="(Files: N/A)";u.file_counts&&typeof u.file_counts.total=="number"?f=`(${u.file_counts.total} ${u.file_counts.total===1?"File":"Files"})`:u.file_counts&&(f="(Files: ?)");let m=`${r(u.name||u.id)} ${f}`,g=new Option(m,u.id);e.appendChild(g)}}),d.length===0&&!t&&window.aipkit_initial_openai_stores||d.length===0&&t&&typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No OpenAI stores found. You can create one via the API.","info",o)):(console.error("Populate Global Target Select: Invalid stores data received.",d),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error processing store list.","error",o));let p=new Option("+ "+(c.createNewStoreButton||"Create New Store..."),"_create_new_openai_");e.appendChild(p);let _=a;return!_&&s&&(_=s),_&&_!=="_create_new_openai_"&&e.querySelector(`option[value="${CSS.escape(_)}"]`)?e.value=_:e.options.length>1&&e.options[0].value===""?e.selectedIndex=0:e.options.length>0&&(e.selectedIndex=e.options[0].value===""?0:e.options.length>1?1:0),e.disabled=!1,e.style.minWidth="",e.style.width="",Promise.resolve()}window.aipkit_populateGlobalOpenAITargetSelect=n})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{};function r(t){let e=document.getElementById("aipkit_vs_global_new_store_inline_form_openai"),o=document.getElementById("aipkit_vs_global_new_store_name_openai");e&&(e.style.display=t?"flex":"none",t&&o&&(o.value="",o.focus()))}function i(){let t=document.getElementById("aipkit_vs_global_new_store_name_openai"),e=document.getElementById("aipkit_vs_global_create_store_btn_openai"),o="aipkit_vs_global_provider_status";if(!t||!e){console.error("Create New OpenAI Store Inline: Missing required elements.");return}let a=t.value.trim();if(!a){typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("New store name cannot be empty.","error",o),t.focus();return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_handleOpenAIAjaxError!="function"||typeof window.aipkit_populateGlobalOpenAITargetSelect!="function"){console.error("Create New OpenAI Store Inline: Missing required UI or API helper functions."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Core UI components missing for store creation.","error",o);return}window.aipkit_setLoadingStateOpenAI(e,!0,c.createStoreButton||"Create Store",c.creatingStore||"Creating..."),window.aipkit_showOpenAIVectorStatus("Creating new OpenAI store...","info",o);let s=document.getElementById("aipkit_vector_store_nonce_openai");if(!s||!s.value){typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(new Error("OpenAI Vector Store nonce not found."),"create_vector_store_inline",o),typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,c.createStoreButton||"Create Store");return}let l={_ajax_nonce:s.value,name:a,source_type:"inline_global_form_create"};window.aipkit_apiRequest("aipkit_create_vector_store_openai",l).then(d=>{window.aipkit_showOpenAIVectorStatus(d.message||"Store created successfully!","success",o),r(!1);let p=d.store;p&&p.id?(window.aipkit_openai_fetched_stores_data&&(window.aipkit_openai_fetched_stores_data[p.id]=p),window.aipkit_initial_openai_stores&&Array.isArray(window.aipkit_initial_openai_stores)&&(window.aipkit_initial_openai_stores.some(_=>_.id===p.id)||window.aipkit_initial_openai_stores.unshift(p)),window.aipkit_populateGlobalOpenAITargetSelect(!1).then(()=>{let _=document.getElementById("aipkit_vs_global_target_select");_&&(_.value=p.id,_.dispatchEvent(new Event("change")))})):window.aipkit_populateGlobalOpenAITargetSelect(!0)}).catch(d=>{typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(d,"create_vector_store_inline",o)}).finally(()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,c.createStoreButton||"Create Store")})}function n(){let t=document.getElementById("aipkit_vs_global_add_openai_store_btn"),e=document.getElementById("aipkit_vs_global_create_store_btn_openai"),o=document.getElementById("aipkit_vs_global_cancel_create_store_btn_openai");t&&t.addEventListener("click",()=>r(!0)),e&&e.addEventListener("click",i),o&&o.addEventListener("click",()=>r(!1)),console.log("AIPKit AI Training: OpenAI Inline Store Creator Initialized.")}window.aipkit_initOpenAIInlineStoreCreator=n})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};function i(n,t=null){if(!n){console.warn("Delete Store (Management): No store ID provided."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No store selected to delete.","error","aipkit_vs_global_provider_status");return}if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_showRightColumnSection!="function"){console.error("Delete Store (Management): Missing one or more UI/API helper functions.");return}let e="aipkit_vs_global_provider_status",o=t;!o&&window.aipkit_openai_vs_refs&&(o=window.aipkit_openai_vs_refs.deleteSelectedStoreButtonPanel),window.aipkit_showOpenAIVectorStatus("Deleting vector store...","info",e),o&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!0,c.deleteStoreButton||"Delete Store",c.deletingStore||"Deleting..."),window.aipkit_apiRequest("aipkit_delete_vector_store_openai",{store_id:n,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value}).then(a=>{if(window.aipkit_showOpenAIVectorStatus(a.message||"Vector store deleted.","success",e),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"?window.aipkit_populateGlobalOpenAITargetSelect(!0):console.error("Delete Store (Management): populateGlobalOpenAITargetSelect function not found. Cannot refresh global dropdown."),window.aipkit_openai_vs_refs?.manageFilesPanel?.dataset.activeStoreId===n){window.aipkit_showRightColumnSection(window.aipkit_openai_vs_refs.rightColumnPlaceholder?.id);let s=window.aipkit_openai_vs_refs.deleteSelectedStoreButtonPanel;s&&(s.style.display="none")}}).catch(a=>{o&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,c.deleteStoreButton||"Delete Store"),typeof window.aipkit_handleOpenAIAjaxError=="function"?window.aipkit_handleOpenAIAjaxError(a,"delete_vector_store",e):console.error("Delete Store (Management): aipkit_handleOpenAIAjaxError function not found.")}).finally(()=>{o&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,c.deleteStoreButton||"Delete Store")})}window.aipkit_deleteOpenAIVectorStore=i})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(t){return t};function i(t){if(!t||isNaN(Number(t))||Number(t)<=0)return"N/A";try{return new Date(Number(t)*1e3).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}}function n(t,e){let o=window.aipkit_openai_vs_refs.panelFilesTableBody,a=window.aipkit_openai_vs_refs.panelStatusDiv;if(o){if(o.innerHTML='<tr><td colspan="7" class="aipkit_text-center">Loading files...</td></tr>',typeof window.aipkit_apiRequest!="function"){o.innerHTML='<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">Error: Core API function missing.</td></tr>';return}window.aipkit_apiRequest("aipkit_list_files_in_vector_store_openai",{store_id:t,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value}).then(s=>{o.innerHTML="",s.files&&Array.isArray(s.files)&&s.files.length>0?s.files.forEach(l=>{let d=l.created_at?i(l.created_at):"N/A",p=l.user_display_name||"N/A",_=l.post_title||(l.post_id?`Post ID: ${l.post_id}`:"N/A"),u=l.indexed_content_snippet||"N/A",f=`<span class="dashicons dashicons-visibility aipkit_view_snippet_icon" title="${r("View Indexed Snippet")}" data-file-id="${r(l.id)}" data-snippet="${r(u)}" style="cursor:pointer; margin-left: 5px; vertical-align: middle;"></span>`,m=l.usage_bytes||l.bytes||0,g=typeof window.aipkit_formatFileSize=="function"?window.aipkit_formatFileSize(m):m.toLocaleString()||"N/A",k=l.id||"N/A",w=k.length>20?k.substring(0,10)+"..."+k.substring(k.length-7):k,b=`
                            <tr data-file-id="${r(l.id)}">
                                <td title="${r(k)}">${r(w)}</td>
                                <td>${r(p)}</td>
                                <td>${r(_)} ${u!=="N/A"&&u?f:""}</td>
                                <td>${r(l.status||"N/A")}</td>
                                <td class="aipkit_text-right">${r(g)}</td>
                                <td>${r(d)}</td>
                                <td class="aipkit_text-right">
                                    <button class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_delete_store_file_btn_openai" data-store-id="${r(t)}" data-file-id="${r(l.id)}">Delete</button>
                                </td>
                            </tr>`;o.insertAdjacentHTML("beforeend",b)}):o.innerHTML='<tr><td colspan="7" class="aipkit_text-center">No files found in this vector store.</td></tr>'}).catch(s=>{o.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${r(s.message||"Failed to load files.")}</td></tr>`})}}window.aipkit_listFilesInStoreForPanel=n})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};function i(n,t,e){let o=window.aipkit_openai_vs_refs.panelStatusDiv;o&&(o.innerHTML="Deleting file from store...",o.className="aipkit_form-help aipkit_settings_message-info",o.style.display="block"),e&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!0,"Delete","Deleting..."),window.aipkit_apiRequest("aipkit_delete_file_from_vector_store_openai",{store_id:n,file_id:t,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value}).then(a=>{o&&(o.textContent=a.message||"File deleted successfully.",o.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{o.textContent===(a.message||"File deleted successfully.")&&(o.textContent="",o.style.display="none")},4e3));let s=window.aipkit_openai_vs_refs.manageFilesPanel?.querySelector("#aipkit_manage_files_panel_title_openai"),d=(s?s.textContent:"").match(/Files in:\s*(.*)/),p=d&&d[1]?d[1].trim():n;typeof window.aipkit_listFilesInStoreForPanel=="function"&&window.aipkit_listFilesInStoreForPanel(n,p),typeof window.aipkit_fetchAndCacheSingleStore=="function"&&window.aipkit_fetchAndCacheSingleStore(n).then(_=>{_&&window.aipkit_openai_vs_refs.manageFilesPanel.dataset.activeStoreId===n&&typeof window.aipkit_showStoreFilesPanel=="function"&&window.aipkit_showStoreFilesPanel(n,p,_)}),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"&&window.aipkit_populateGlobalOpenAITargetSelect()}).catch(a=>{o&&(o.textContent=a.message||"Failed to delete file.",o.className="aipkit_form-help aipkit_settings_message-error",setTimeout(()=>{o.textContent===(a.message||"Failed to delete file.")&&(o.textContent="",o.style.display="none")},6e3))}).finally(()=>{e&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,"Delete")})}window.aipkit_deleteFileFromStoreOpenAI=i})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(t){return t};function i(t){if(!t||isNaN(Number(t))||Number(t)<=0)return"N/A";try{return new Date(Number(t)*1e3).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}}function n(t,e,o){let a=window.aipkit_openai_vs_refs;if(!a.manageFilesPanel||!a.rightColumnContainer){console.error("Show Files Panel: Manage files panel or main content area not found in global refs.");return}a.manageFilesPanel.dataset.activeStoreId=t;let s=a.manageFilesPanel.querySelector("#aipkit_manage_files_panel_title_openai"),l=a.panelFilesTableBody,d=a.panelStatusDiv,p=a.searchThisStoreButtonPanel,_=a.metadataDisplayPanel,u=a.deleteSelectedStoreButtonPanel,f=a.toggleMetadataButtonPanel;if(!s||!l||!d||!p||!_||!u||!f){console.error("Show Files Panel: One or more required child elements of the files panel are missing."),typeof window.aipkit_showRightColumnSection=="function"&&a.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(a.rightColumnPlaceholder.id);return}if(s.textContent=`Files in: ${r(e)}`,l.innerHTML='<tr><td colspan="7" class="aipkit_text-center">Loading files...</td></tr>',d.innerHTML="",_.innerHTML="",_.style.display="none",f.classList.remove("aipkit_active"),f.title="View Store Metadata",o){let m="<ul>";if(m+=`<li><strong>ID:</strong> ${r(o.id)}</li>`,o.created_at&&(m+=`<li><strong>Created:</strong> ${r(i(o.created_at))}</li>`),o.last_active_at&&(m+=`<li><strong>Last Active:</strong> ${r(i(o.last_active_at))}</li>`),o.expires_after){let g=o.expires_after.anchor==="last_active_at"?"Last Active At":r(o.expires_after.anchor);m+=`<li><strong>Expires After:</strong> ${r(o.expires_after.days)} days from ${g}</li>`}o.expires_at?m+=`<li><strong>Expires At:</strong> ${r(i(o.expires_at))}</li>`:o.expires_after===null&&(m+="<li><strong>Expires At:</strong> Never</li>"),o.status&&(m+=`<li><strong>Status:</strong> ${r(o.status)}</li>`),m+="</ul>",_.innerHTML=m}else _.style.display="none";p&&(p.setAttribute("data-store-id",t),p.setAttribute("data-store-name",e),p.style.display="inline-flex"),u&&(u.setAttribute("data-store-id",t),u.setAttribute("data-store-name",e),u.style.display="inline-flex"),f&&(f.style.display="inline-flex"),typeof window.aipkit_listFilesInStoreForPanel=="function"?window.aipkit_listFilesInStoreForPanel(t,e):console.error("Show Files Panel: aipkit_listFilesInStoreForPanel function not found."),typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_showRightColumnSection(a.manageFilesPanel.id)}window.aipkit_showStoreFilesPanel=n})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};function i(){let n=window.aipkit_openai_vs_refs,t=n.searchStoreFormWrapper?.querySelector("#aipkit_search_vector_store_btn_openai"),e=n.searchStoreFormWrapper?.querySelector("#aipkit_search_vector_store_id_openai"),o=n.searchStoreFormWrapper?.querySelector("#aipkit_search_query_text_openai"),a=n.searchStoreFormWrapper?.querySelector("#aipkit_search_top_k_openai"),s=n.searchStoreFormWrapper?.querySelector("#aipkit_search_results_area_openai"),l="aipkit_vs_global_provider_status";if(!t||!e||!o||!a||!s){console.error("Search Store: Missing required form or results elements within the search wrapper."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Search UI elements missing.","error",l);return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_handleOpenAIAjaxError!="function"){console.error("Search Store: Missing one or more UI/API helper functions."),window.aipkit_showOpenAIVectorStatus("Error: Core functions missing for search.","error",l);return}let d=e.value,p=o.value.trim(),_=parseInt(a.value,10)||3;if(!d){window.aipkit_showOpenAIVectorStatus("Vector Store ID is missing.","error",l);return}if(!p){window.aipkit_showOpenAIVectorStatus("Search query cannot be empty.","error",l);return}window.aipkit_setLoadingStateOpenAI(t,!0,c.searchButton||"Search",c.searching||"Searching..."),window.aipkit_showOpenAIVectorStatus(c.vectorSearching||"Searching vector store...","info",l),s.innerHTML=`<p class="aipkit_text-center">${c.loading||"Loading..."}</p>`;let u={_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value,store_id:d,query_text:p,top_k:_};window.aipkit_apiRequest("aipkit_search_vector_store_openai",u).then(f=>{if(window.aipkit_setLoadingStateOpenAI(t,!1,c.searchButton||"Search"),s.innerHTML="",f.results&&Array.isArray(f.results))if(f.results.length===0)s.innerHTML=`<p class="aipkit_text-center">No results found for "${r(p)}".</p>`,window.aipkit_showOpenAIVectorStatus("No results found.","info",l);else{let m=document.createElement("ul");m.style.listStyleType="decimal",m.style.paddingLeft="20px",f.results.forEach(g=>{let k=document.createElement("li");k.style.marginBottom="10px",k.style.borderBottom="1px dashed #eee",k.style.paddingBottom="5px";let w=`<strong>File ID:</strong> ${r(g.id||"N/A")}<br>`;g.score!==null&&typeof g.score<"u"&&(w+=`<strong>Score:</strong> ${Number(g.score).toFixed(4)}<br>`);let b="[No text content found]";if(g.content&&Array.isArray(g.content)){let y=g.content.filter(h=>h.type==="text"&&h.text).map(h=>h.text);y.length>0&&(b=y.join(`

`))}else g.content&&typeof g.content=="string"&&(b=g.content);if(b){let y=b.length>300?b.substring(0,300)+"...":b;w+=`<strong>Content Snippet:</strong><pre>${r(y)}</pre>`}g.metadata&&Object.keys(g.metadata).length>0&&(w+=`<strong>Metadata:</strong><pre>${r(JSON.stringify(g.metadata,null,2))}</pre>`),k.innerHTML=w,m.appendChild(k)}),s.appendChild(m),window.aipkit_showOpenAIVectorStatus(`Found ${f.results.length} results.`,"success",l)}else throw new Error(f.message||"Invalid response format for search results.")}).catch(f=>{window.aipkit_setLoadingStateOpenAI(t,!1,c.searchButton||"Search"),typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(f,"search_vector_store",l),s.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">${r(f.message||"Failed to perform search.")}</p>`})}window.aipkit_searchOpenAIVectorStore=i})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};function i(n,t){let o=window.aipkit_openai_vs_refs.searchStoreFormWrapper;if(!o){console.error("Show Search Form: Search form wrapper not found in global refs.");return}let a=o.querySelector("#aipkit_search_vector_store_id_openai"),s=o.querySelector("#aipkit_search_store_form_title_openai"),l=o.querySelector("#aipkit_search_results_area_openai"),d=o.querySelector("#aipkit_search_query_text_openai");a&&(a.value=n),s&&(s.textContent=`Search in: ${r(t)}`),l&&(l.innerHTML=""),d&&(d.value=""),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("","info","aipkit_vs_global_provider_status"),typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_showRightColumnSection(o.id)}window.aipkit_showSearchFormForStore=i})();(function(){"use strict";window.aipkit_openai_vs_refs=window.aipkit_openai_vs_refs||{},window.aipkit_initial_openai_stores=null;function c(){console.log("AIPKit AI Training: Initializing OpenAI Vector Store MANAGEMENT UI (Single Pane)..."),window.aipkit_openai_vs_config&&window.aipkit_openai_vs_config.initialStores?(window.aipkit_initial_openai_stores=window.aipkit_openai_vs_config.initialStores,console.log("AIPKit OpenAI Init: Received initial stores from PHP:",window.aipkit_initial_openai_stores)):console.warn("AIPKit OpenAI Init: Initial OpenAI stores not found in localized config.");let r=document.querySelector(".aipkit_ai_training_right_column");if(!r){console.warn("AIPKit AI Training (OpenAI Init): Main right column for OpenAI management UI not found.");return}let i=r.querySelector("#aipkit_vector_openai_management_ui");if(!i){console.warn("AIPKit AI Training (OpenAI Init): OpenAI management block (#aipkit_vector_openai_management_ui) not found within the right column.");return}let n=window.aipkit_openai_vs_refs;if(n.rightColumnContainer=i.querySelector("#aipkit_openai_vs_main_content_area"),n.rightColumnPlaceholder=i.querySelector("#aipkit_openai_vs_right_col_placeholder"),n.manageFilesPanel=i.querySelector("#aipkit_manage_files_panel_openai"),n.manageFilesPanel&&(n.deleteSelectedStoreButtonPanel=n.manageFilesPanel.querySelector("#aipkit_delete_selected_store_btn_openai"),n.searchThisStoreButtonPanel=n.manageFilesPanel.querySelector("#aipkit_panel_search_this_store_btn_openai"),n.toggleMetadataButtonPanel=n.manageFilesPanel.querySelector("#aipkit_toggle_store_metadata_btn_openai"),n.metadataDisplayPanel=n.manageFilesPanel.querySelector("#aipkit_vector_store_metadata_display_openai"),n.panelFilesTableBody=n.manageFilesPanel.querySelector("#aipkit_vector_store_files_table_body_openai"),n.panelStatusDiv=n.manageFilesPanel.querySelector("#aipkit_manage_files_panel_status_openai")),n.searchStoreFormWrapper=i.querySelector("#aipkit_search_store_form_openai_wrapper_modal_placeholder"),n.apiKeyIsSet=!!document.getElementById("aipkit_vector_store_nonce_openai"),!n.apiKeyIsSet&&window.aipkit_openai_vs_config?.apiKeyIsSet===!1){n.rightColumnPlaceholder&&n.rightColumnContainer&&(n.rightColumnContainer.innerHTML=`<div class="aipkit_ai_training_section_wrapper aipkit_openai_vs_content_section" id="aipkit_openai_vs_right_col_placeholder" style="display: flex;">
                                                            <div class="aipkit_ai_training_section_header"><h5>Store Details</h5></div>
                                                            <p class="aipkit_text-center" style="padding: 20px;">OpenAI API Key not set. Store details cannot be displayed. Configure in Main Settings.</p>
                                                        </div>`),console.warn("AIPKit AI Training (OpenAI Init): API key not set. Management features disabled.");return}if(typeof window.aipkit_showRightColumnSection=="function"&&n.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(n.rightColumnPlaceholder.id),i.dataset.openaiManagementListenersAttached==="true"){console.log("AIPKit AI Training (OpenAI Init): Listeners already attached.");return}n.manageFilesPanel&&(n.deleteSelectedStoreButtonPanel?.addEventListener("click",t=>{let e=n.manageFilesPanel.dataset.activeStoreId;e&&typeof window.aipkit_deleteOpenAIVectorStore=="function"&&window.aipkit_deleteOpenAIVectorStore(e,t.currentTarget)}),n.searchThisStoreButtonPanel?.addEventListener("click",t=>{let e=n.manageFilesPanel.dataset.activeStoreId,o=n.manageFilesPanel.querySelector("#aipkit_manage_files_panel_title_openai"),a=o&&o.textContent.replace("Files in: ","").trim()||e;e&&typeof window.aipkit_showSearchFormForStore=="function"&&window.aipkit_showSearchFormForStore(e,a)}),n.panelFilesTableBody?.addEventListener("click",t=>{let e=t.target.closest(".aipkit_delete_store_file_btn_openai"),o=t.target.closest(".aipkit_view_snippet_icon");if(e&&!e.disabled){let a=e.dataset.storeId,s=e.dataset.fileId;a&&s&&typeof window.aipkit_deleteFileFromStoreOpenAI=="function"&&window.aipkit_deleteFileFromStoreOpenAI(a,s,e)}else if(o){t.preventDefault();let a=o.dataset.snippet,s=n.panelStatusDiv;if(s){let l=window.aipkit_escapeHtml||function(u){return u},d=`snippet_for_${o.dataset.fileId||Math.random().toString(36).substring(2)}`,p=`<strong style='display:block; margin-bottom:3px;'>Indexed Snippet:</strong><pre id="${d}" style='white-space: pre-wrap; word-wrap: break-word; max-height: 150px; overflow-y: auto; background: #f0f0f0; border:1px solid #ddd; padding: 5px;'>${l(a)}</pre>`,_=s.querySelector(`pre#${CSS.escape(d)}`);s.style.display==="block"&&_&&s.innerHTML.includes(p)?(s.innerHTML="",s.style.display="none"):(s.innerHTML=p,s.style.display="block",s.className="aipkit_form-help",s.scrollIntoView({behavior:"smooth",block:"nearest"}))}else console.error("AIPKit OpenAI Init: panelStatusDiv not found for snippet.")}}),n.toggleMetadataButtonPanel?.addEventListener("click",()=>{if(n.metadataDisplayPanel){let t=n.metadataDisplayPanel.style.display==="none";n.metadataDisplayPanel.style.display=t?"block":"none",n.toggleMetadataButtonPanel.classList.toggle("aipkit_active",t),n.toggleMetadataButtonPanel.title=t?"Hide Store Metadata":"View Store Metadata"}})),n.searchStoreFormWrapper&&n.searchStoreFormWrapper.addEventListener("click",t=>{let e=t.target.closest("#aipkit_search_vector_store_btn_openai"),o=t.target.closest("#aipkit_close_search_panel_btn_openai");if(e)typeof window.aipkit_searchOpenAIVectorStore=="function"&&window.aipkit_searchOpenAIVectorStore();else if(o){let a=n.manageFilesPanel?.dataset.activeStoreId;if(a&&typeof window.aipkit_showStoreFilesPanel=="function"){let s=window.aipkit_openai_fetched_stores_data?window.aipkit_openai_fetched_stores_data[a]:null,l=s?.name||a;window.aipkit_showStoreFilesPanel(a,l,s)}else typeof window.aipkit_showRightColumnSection=="function"&&n.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(n.rightColumnPlaceholder.id)}}),i.dataset.openaiManagementListenersAttached="true",console.log("AIPKit AI Training (OpenAI Init): OpenAI Management UI Listeners attached.")}window.aipkit_initOpenAIVectorStore=c})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(t){return t},i="aipkit_last_pinecone_index_id";function n(t=null){let e=document.getElementById("aipkit_vs_global_target_select"),o=localStorage.getItem(i);if(!e){console.error("Populate Global Pinecone Target: Select element #aipkit_vs_global_target_select not found.");return}let a=e.value;e.innerHTML=`<option value="">${r(c.selectTargetIndex||"-- Select Index --")}</option>`;let s=t!==null?t:window.aipkit_pinecone_vs_refs.syncedIndexes||[];s&&Array.isArray(s)&&s.length>0?s.forEach(p=>{let _=p.name||p.id;if(_){let u=p.name||_,f=p.total_vector_count!==void 0&&p.total_vector_count!==null&&p.total_vector_count!=="Error"&&p.total_vector_count!=="No Host"?` (Vectors: ${Number(p.total_vector_count).toLocaleString()})`:(p.total_vector_count||"")==="Error"||(p.total_vector_count||"")==="No Host"?" (Stats Err)":" (Vectors: ?)",m=`${r(u)}${f}`,g=new Option(m,_);e.appendChild(g)}}):e.appendChild(new Option(r(c.noPineconeIndexesFound||"No Pinecone indexes found. Sync or create one."),""));let l=new Option("+ "+(c.createNewIndexButton||"Create New Index..."),"_create_new_pinecone_");e.appendChild(l);let d=null;a&&a!=="_create_new_pinecone_"&&e.querySelector(`option[value="${CSS.escape(a)}"]`)?d=a:o&&e.querySelector(`option[value="${CSS.escape(o)}"]`)&&(d=o),d?e.value=d:e.options.length>1&&e.options[0].value===""?e.selectedIndex=0:e.options.length>0&&(e.selectedIndex=e.options[0].value===""?0:e.options.length>1?1:0),e.disabled=!(s&&s.length>0&&e.options.length>1)}window.aipkit_populateGlobalPineconeTargetSelect=n})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(t){return t},i="aipkit_last_pinecone_index_id";window.aipkit_pinecone_vs_refs=window.aipkit_pinecone_vs_refs||{},window.aipkit_pinecone_vs_refs.syncedIndexes=window.aipkit_pinecone_vs_config?.initialIndexes||[];async function n(t=null,e=!1){let o=window.aipkit_pinecone_vs_refs,a="aipkit_vs_global_provider_status";if(typeof window.aipkit_populateGlobalPineconeTargetSelect!="function")return console.error("AIPKit Pinecone List: aipkit_populateGlobalPineconeTargetSelect function not found."),Promise.reject(new Error("Dependency missing for populating select."));if(e&&o.syncedIndexes&&o.syncedIndexes.length>0){console.log("AIPKit Pinecone: Using cached/PHP-localized indexes for initial load of global select."),window.aipkit_populateGlobalPineconeTargetSelect(o.syncedIndexes);let s=document.getElementById("aipkit_vs_global_target_select"),l=localStorage.getItem(i),d=s?s.value:null;if(!d&&l&&s&&s.querySelector(`option[value="${CSS.escape(l)}"]`)&&(s.value=l,d=l),d&&typeof window.aipkit_showPineconeIndexDetails=="function"){let p=o.syncedIndexes.find(_=>_.name===d);p&&window.aipkit_showPineconeIndexDetails(d,p)}return Promise.resolve()}t&&typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(t,!0,c.syncIndexesButton||"Sync Indexes",c.syncing||"Syncing..."):t&&(t.disabled=!0,t.textContent=c.syncing||"Syncing..."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Syncing Pinecone indexes...","info",a);try{let s=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!s||!s.value)throw new Error("Pinecone management nonce not found for listing indexes.");let l=await window.aipkit_apiRequest("aipkit_list_indexes_pinecone",{_ajax_nonce:s.value});o.syncedIndexes=l.indexes||[],window.aipkit_pinecone_vs_refs.syncedIndexes=o.syncedIndexes,window.aipkit_populateGlobalPineconeTargetSelect(o.syncedIndexes),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(l.message||"Pinecone indexes synced successfully.","success",a)}catch(s){console.error("Pinecone List Indexes Error:",s),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(`Error: ${s.message||"Failed to sync Pinecone indexes."}`,"error",a)}finally{t&&typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(t,!1,c.syncIndexesButton||"Sync Indexes"):t&&(t.disabled=!1,t.textContent=c.syncIndexesButton||"Sync Indexes")}}window.aipkit_listPineconeIndexes=n})();(function(){"use strict";function c(r,i="info"){let n=window.aipkit_pinecone_vs_refs?.searchStatusDiv;n&&(n.textContent=r,n.className=`aipkit_form-help aipkit_settings_message-${i}`,n.style.display=r?"block":"none",r&&i!=="info"&&setTimeout(()=>{n.textContent===r&&(n.textContent="",n.style.display="none")},5e3))}window.aipkit_showPineconeSearchStatus=c})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};function i(n,t){let e=window.aipkit_pinecone_vs_refs;if(!e.searchFormWrapper||!e.searchIndexIdInput||!e.searchFormTitle||!e.searchResultsArea||!e.searchQueryVectorInput||!e.searchNamespaceInput){console.error("Pinecone Search (Show Form): Missing required search form elements in refs.");return}e.searchIndexIdInput.value=n,e.searchFormTitle.textContent=`Search in Index: ${r(t)}`,e.searchQueryVectorInput.value="",e.searchNamespaceInput.value="",e.searchResultsArea.innerHTML="",e.searchStatusDiv&&(e.searchStatusDiv.innerHTML=""),e.manageIndexPanel&&(e.manageIndexPanel.style.display="none"),e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="none"),e.createFormWrapperGlobal&&(e.createFormWrapperGlobal.style.display="none"),e.searchFormWrapper.style.display="flex"}window.aipkit_showSearchFormForPineconeIndex=i})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};async function i(){let n=window.aipkit_pinecone_vs_refs;if(!n.searchSubmitButton||!n.searchIndexIdInput||!n.searchQueryVectorInput||!n.searchTopKInput||!n.searchResultsArea||!n.searchStatusDiv||!n.searchNamespaceInput){console.error("Pinecone Search (Perform): Missing search form submit or input elements in refs for search action.");return}if(typeof window.aipkit_showPineconeSearchStatus!="function"||typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Pinecone Search (Perform): Missing required UI or API helper functions.");return}let t=n.searchIndexIdInput.value,e=n.searchQueryVectorInput.value.trim(),o=n.searchNamespaceInput.value.trim(),a=parseInt(n.searchTopKInput.value,10)||3,s=document.getElementById("aipkit_vs_global_embedding_model_select"),l=s?s.value:"",d=s&&s.options[s.selectedIndex]?.dataset.provider||"openai";if(!t){window.aipkit_showPineconeSearchStatus("Index ID missing.","error");return}if(!e){window.aipkit_showPineconeSearchStatus("Search query empty.","error");return}if(!l){window.aipkit_showPineconeSearchStatus('Select embedding model from "Add Content" form.',"error");return}window.aipkit_setLoadingStateOpenAI(n.searchSubmitButton,!0,c.searchButton||"Search",c.searching||"Searching..."),window.aipkit_showPineconeSearchStatus(c.vectorSearching||"Searching index...","info"),n.searchResultsArea.innerHTML=`<p class="aipkit_text-center">${c.loading||"Loading..."}</p>`;let p={_ajax_nonce:document.getElementById("aipkit_vector_store_pinecone_nonce_management").value,index_id:t,query_text:e,embedding_provider:d,embedding_model:l,top_k:a,...o&&{namespace:o}};try{let _=await window.aipkit_apiRequest("aipkit_search_pinecone_index",p);if(window.aipkit_showPineconeSearchStatus(_.message||"Search complete.","success"),_.results&&Array.isArray(_.results))if(_.results.length===0)n.searchResultsArea.innerHTML=`<p class="aipkit_text-center">No results for "${r(e)}".</p>`;else{let u=document.createElement("ul");u.style.listStyleType="decimal",u.style.paddingLeft="20px",_.results.forEach(f=>{let m=document.createElement("li");m.style.marginBottom="10px",m.style.borderBottom="1px dashed #eee",m.style.paddingBottom="5px";let g=`<strong>ID:</strong> ${r(f.id||"N/A")}<br>`;f.score!==null&&typeof f.score<"u"&&(g+=`<strong>Score:</strong> ${Number(f.score).toFixed(4)}<br>`),f.metadata&&Object.keys(f.metadata).length>0&&(g+=`<strong>Metadata:</strong><pre style="white-space: pre-wrap; word-wrap: break-word; max-height: 100px; overflow-y: auto; background: #f0f0f0; border:1px solid #ddd; padding: 5px;">${r(JSON.stringify(f.metadata,null,2))}</pre>`,f.metadata.url&&f.metadata.title&&(g+=`<a href="${r(f.metadata.url)}" target="_blank" rel="noopener noreferrer">${r(f.metadata.title)}</a><br>`)),m.innerHTML=g,u.appendChild(m)}),n.searchResultsArea.innerHTML="",n.searchResultsArea.appendChild(u)}else n.searchResultsArea.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Invalid search response.</p>'}catch(_){window.aipkit_showPineconeSearchStatus(`Search Error: ${_.message||"Unknown error"}`,"error"),n.searchResultsArea.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">${r(_.message||"Failed search.")}</p>`}finally{window.aipkit_setLoadingStateOpenAI(n.searchSubmitButton,!1,c.searchButton||"Search")}}window.aipkit_searchPineconeIndex=i})();(function(){"use strict";function c(r,i="info",n=!0){let t=window.aipkit_pinecone_vs_refs,e=n?t?.createIndexStatusDivGlobal:null;e&&(e.textContent=r,e.className=`aipkit_form-help aipkit_settings_message-${i}`,e.style.display=r?"block":"none",r&&i!=="info"&&setTimeout(()=>{e.textContent===r&&(e.textContent="",e.style.display="none")},5e3))}window.aipkit_showPineconeCreateStatus=c})();(function(){"use strict";function c(){let r=window.aipkit_pinecone_vs_refs;r.createFormWrapperGlobal&&(r.createFormWrapperGlobal.style.display="none"),r.rightColumnPlaceholder&&(r.rightColumnPlaceholder.style.display="flex")}window.aipkit_hideCreatePineconeIndexFormGlobal=c})();(function(){"use strict";function c(){let r=window.aipkit_pinecone_vs_refs;if(!r.createFormWrapperGlobal||!r.newIndexNameInputGlobal||!r.newIndexDimensionInputGlobal){console.error("Show Global Pinecone Create Form: Missing essential global form elements.");return}r.newIndexNameInputGlobal.value="",r.newIndexDimensionInputGlobal.value="1536",r.createIndexStatusDivGlobal&&(r.createIndexStatusDivGlobal.innerHTML=""),r.manageIndexPanel&&(r.manageIndexPanel.style.display="none"),r.searchFormWrapper&&(r.searchFormWrapper.style.display="none"),r.rightColumnPlaceholder&&(r.rightColumnPlaceholder.style.display="none"),r.createFormWrapperGlobal.style.display="flex",r.newIndexNameInputGlobal.focus()}window.aipkit_showCreatePineconeIndexFormGlobal=c})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};async function i(n=!1){let t=window.aipkit_pinecone_vs_refs,e=n?t.newIndexNameInputGlobal:null,o=n?t.newIndexDimensionInputGlobal:null,a=n?t.createIndexSubmitButtonGlobal:null,s=n?t.createIndexStatusDivGlobal:null,l=n?t.createFormWrapperGlobal:null;if(!a||!e||!o||!s||!l){console.error("Create Pinecone Index: Missing required form elements for ",n?"global form.":"panel form (not supported).");return}let d=e.value.trim(),p=parseInt(o.value,10);if(!d){typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus("Index name is required.","error",n):console.error("aipkit_showPineconeCreateStatus not defined");return}if(!p||p<=0){typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus("Valid vector dimension is required.","error",n):console.error("aipkit_showPineconeCreateStatus not defined");return}window.aipkit_setLoadingStateOpenAI(a,!0,c.createIndexButton||"Create Index",c.creatingIndex||"Creating..."),typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus(c.creatingIndex||"Creating index...","info",n):console.error("aipkit_showPineconeCreateStatus not defined");try{let _=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!_||!_.value)throw new Error("Pinecone management nonce not found for create operation.");let u={_ajax_nonce:_.value,name:d,dimension:p,metric:"cosine",spec_cloud:"aws",spec_region:"us-east-1"},f=await window.aipkit_apiRequest("aipkit_create_index_pinecone",u);typeof window.aipkit_showPineconeCreateStatus=="function"&&window.aipkit_showPineconeCreateStatus(f.message||"Index created successfully!","success",n),l&&(l.style.display="none"),typeof window.aipkit_listPineconeIndexes=="function"&&await window.aipkit_listPineconeIndexes(null,!1);let m=document.getElementById("aipkit_vs_global_target_select");if(m){let g=!1;for(let k=0;k<m.options.length;k++)if(m.options[k].value===d){g=!0;break}g?(m.value=d,m.dispatchEvent(new Event("change"))):t.rightColumnPlaceholder&&(t.rightColumnPlaceholder.style.display="flex")}else t.rightColumnPlaceholder&&(t.rightColumnPlaceholder.style.display="flex")}catch(_){typeof window.aipkit_showPineconeCreateStatus=="function"&&window.aipkit_showPineconeCreateStatus(`Error: ${_.message||"Failed to create index."}`,"error",n)}finally{window.aipkit_setLoadingStateOpenAI(a,!1,c.createIndexButton||"Create Index")}}window.aipkit_handleCreatePineconeIndex=i})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};async function i(n,t=null){let e=window.aipkit_pinecone_vs_refs,o="aipkit_vs_global_provider_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Pinecone Index: Missing required UI or API helper functions."),t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,c.deleteIndexButton||"Delete Index");return}window.aipkit_showOpenAIVectorStatus(`Deleting Pinecone index "${r(n)}"...`,"info",o),t&&window.aipkit_setLoadingStateOpenAI(t,!0,c.deleteIndexButton||"Delete Index",c.deletingIndex||"Deleting...");try{let a=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!a||!a.value)throw new Error("Pinecone management nonce not found for delete operation.");let s=await window.aipkit_apiRequest("aipkit_delete_index_pinecone",{_ajax_nonce:a.value,index_name:n});window.aipkit_showOpenAIVectorStatus(s.message||`Pinecone index "${r(n)}" deleted.`,"success",o),typeof window.aipkit_listPineconeIndexes=="function"&&await window.aipkit_listPineconeIndexes(null,!1),e.manageIndexPanel&&e.manageIndexPanel.dataset.activeIndexName===n&&(e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="flex"),e.manageIndexPanel.style.display="none",e.manageIndexPanel.dataset.activeIndexName=""),e.searchFormWrapper&&e.searchIndexIdInput&&e.searchIndexIdInput.value===n&&(e.searchFormWrapper.style.display="none")}catch(a){console.error(`Delete Pinecone Index Error for "${r(n)}":`,a),window.aipkit_showOpenAIVectorStatus(`Error deleting index: ${r(a.message)||"Unknown error."}`,"error",o)}finally{t&&window.aipkit_setLoadingStateOpenAI(t,!1,c.deleteIndexButton||"Delete Index")}}window.aipkit_deletePineconeIndex=i})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};async function i(n){let t=window.aipkit_pinecone_vs_refs;if(!t.indexLogsContainer){console.error("Fetch Pinecone Logs: Log container not found in refs.");return}t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${r(c.loading_logs||"Loading logs...")}</p>`;try{let e=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!e||!e.value)throw new Error("Pinecone management nonce for logs not found.");let a=(await window.aipkit_apiRequest("aipkit_get_pinecone_indexing_logs",{_ajax_nonce:e.value,index_name:n})).logs||[];if(a.length===0){t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center">${r(c.noLogsForStore||"No indexing logs found for this index.")}</p>`;return}let s='<div class="aipkit_data-table aipkit_index_logs_table"><table>';s+="<thead><tr><th>Time</th><th>Status</th><th>Message</th><th>Emb. Provider</th><th>Emb. Model</th><th>Source</th><th>Vector ID</th><th>Actions</th></tr></thead><tbody>",a.forEach(l=>{let d=l.status==="success"?"aipkit_status-success":l.status==="failed"||l.status==="content_error"?"aipkit_status-warning":"aipkit_status-info",p="";l.file_id&&(p=`<button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit-delete-vector-log-btn" 
                                                   data-provider="Pinecone" 
                                                   data-store-id="${r(n)}" 
                                                   data-vector-id="${r(l.file_id)}" 
                                                   data-log-id="${r(l.id||"")}"
                                                   title="${r("Delete this record from Pinecone and local logs")}">
                                                   <span class="dashicons dashicons-trash"></span>
                                            </button>`),s+=`<tr data-log-id="${r(l.id||"")}">
                    <td>${r(l.timestamp?new Date(l.timestamp).toLocaleString():"N/A")}</td>
                    <td><span class="aipkit_status-tag ${d}">${r(l.status)}</span></td>
                    <td>${r(l.message)}</td>
                    <td>${r(l.embedding_provider||"N/A")}</td>
                    <td>${r(l.embedding_model||"N/A")}</td>
                    <td>${l.post_id?`Post ID: ${l.post_id}`:l.indexed_content?r(l.indexed_content.substring(0,30))+"...":"N/A"}</td>
                    <td class="aipkit-code-snippet">${r(l.file_id||"N/A")}</td>
                    <td class="aipkit_text-right">${p}</td>
                </tr>`}),s+="</tbody></table></div>",t.indexLogsContainer.innerHTML=s}catch(e){console.error("Fetch Pinecone Logs Error:",e),t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">Error loading logs: ${r(e.message||"Unknown error")}</p>`}}window.aipkit_fetchAndRenderPineconeIndexingLogs=i})();(function(){"use strict";function c(r){let i=window.aipkit_pinecone_vs_refs;if(!i||!i.managementBlock){console.error("showPineconeSection: Pinecone refs or management block not initialized.");return}let n=[i.rightColumnPlaceholder,i.manageIndexPanel,i.searchFormWrapper,i.createFormWrapperGlobal],t=!1;n.forEach(e=>{e&&((e===i.rightColumnPlaceholder?"placeholder":e===i.manageIndexPanel?"manage_panel":e===i.searchFormWrapper?"search_form":e===i.createFormWrapperGlobal?"create_form_global":null)===r?(e.style.display="flex",e.classList.add("aipkit-active"),t=!0):(e.style.display="none",e.classList.remove("aipkit-active")))}),!t&&i.rightColumnPlaceholder&&(i.rightColumnPlaceholder.style.display="flex",i.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showPineconeSection=c})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(t){return t};function i(t,e){let o=window.aipkit_pinecone_vs_refs;if(!o.metadataDisplayDiv)return;let a="<ul>";a+=`<li><strong>Name:</strong> ${r(e.name)}</li>`,a+=`<li><strong>Dimension:</strong> ${r(e.dimension||"N/A")}</li>`,a+=`<li><strong>Metric:</strong> ${r(e.metric||"N/A")}</li>`,a+=`<li><strong>Host:</strong> ${r(e.host||"N/A")}</li>`;let s=e.total_vector_count!==void 0&&e.total_vector_count!==null&&e.total_vector_count!=="Error"&&e.total_vector_count!=="No Host"?Number(e.total_vector_count).toLocaleString():`<span class="aipkit_text-danger">${r(e.total_vector_count||"N/A")}</span>`;a+=`<li><strong>Total Vectors:</strong> ${s}</li>`,e.status&&(a+=`<li><strong>Status:</strong> Ready: ${e.status.ready?"Yes":"No"}, State: ${r(e.status.state||"Unknown")}</li>`),e.spec?.serverless&&(a+=`<li><strong>Spec (Serverless):</strong> Cloud: ${r(e.spec.serverless.cloud)}, Region: ${r(e.spec.serverless.region)}</li>`),a+="</ul>",o.metadataDisplayDiv.innerHTML=a}async function n(t,e){let o=window.aipkit_pinecone_vs_refs;if(!o.manageIndexPanel||!o.panelTitle||!o.metadataDisplayDiv||!o.panelSearchButton||!o.panelDeleteButton||!o.toggleMetadataButton||!o.indexLogsContainer){console.error("Pinecone Details: Missing one or more UI elements in refs for showing index details.");return}o.manageIndexPanel.dataset.activeIndexName=t,o.panelTitle.textContent=`Manage Index: ${r(t)}`,o.metadataDisplayDiv.style.display="block",o.toggleMetadataButton.classList.add("aipkit_active"),o.toggleMetadataButton.title=c.hideCollectionInfo||"Hide Collection Info",o.panelSearchButton.disabled=!1,o.panelDeleteButton.disabled=!1,o.panelDeleteButton.dataset.indexName=t,window.aipkit_showPineconeSection("manage_panel"),e?i(t,e):o.metadataDisplayDiv.innerHTML=`<p>${r(c.loading_details||"Loading details...")}</p>`,aipkit_fetchAndRenderPineconeIndexingLogs(t);try{let a=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!a||!a.value)throw new Error("Pinecone management nonce for details not found.");let s=await window.aipkit_apiRequest("aipkit_get_pinecone_index_details",{_ajax_nonce:a.value,index_name:t}),l=s.details;if(l)i(t,l);else throw new Error(s.message||"Invalid data received for index details.")}catch(a){if(console.error("Pinecone Fetch Details Error:",a),o.metadataDisplayDiv){let s=o.metadataDisplayDiv.querySelector(".aipkit_pinecone_vector_count_placeholder");s&&(s.innerHTML='<span class="aipkit_text-danger">Error</span>')}}}window.aipkit_showPineconeIndexDetails=n})();(function(){"use strict";window.aipkit_pinecone_vs_refs=window.aipkit_pinecone_vs_refs||{},window.aipkit_pinecone_vs_refs.syncedIndexes=window.aipkit_pinecone_vs_config?.initialIndexes||[];let c=window.aipkit_escapeHtml||function(n){return n},r=window.aipkit_dashboard?.text||{};function i(){console.log("AIPKit AI Training: Initializing Pinecone Vector Store MANAGEMENT UI...");let n=document.getElementById("aipkit_vector_pinecone_management_ui");if(!n){console.warn("Pinecone Init: Pinecone management block (#aipkit_vector_pinecone_management_ui) not found.");return}let t=window.aipkit_pinecone_vs_refs;if(t.managementBlock=n,t.rightColumnPlaceholder=n.querySelector("#aipkit_pinecone_vs_right_col_placeholder"),t.manageIndexPanel=n.querySelector("#aipkit_manage_selected_pinecone_index_panel"),t.manageIndexPanel&&(t.panelTitle=t.manageIndexPanel.querySelector("#aipkit_manage_pinecone_index_panel_title"),t.toggleMetadataButton=t.manageIndexPanel.querySelector("#aipkit_toggle_pinecone_index_metadata_btn"),t.metadataDisplayDiv=t.manageIndexPanel.querySelector("#aipkit_pinecone_index_metadata_display"),t.panelSearchButton=t.manageIndexPanel.querySelector("#aipkit_panel_search_this_pinecone_index_btn"),t.panelDeleteButton=t.manageIndexPanel.querySelector("#aipkit_delete_selected_pinecone_index_btn"),t.panelStatusDiv=t.manageIndexPanel.querySelector("#aipkit_manage_pinecone_index_panel_status"),t.indexLogsContainer=t.manageIndexPanel.querySelector("#aipkit_pinecone_index_logs_container")),t.searchFormWrapper=n.querySelector("#aipkit_search_pinecone_index_form_wrapper"),t.searchFormWrapper&&(t.searchFormTitle=t.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_form_title"),t.searchIndexIdInput=t.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_id"),t.searchQueryVectorInput=t.searchFormWrapper.querySelector("#aipkit_search_query_vector_pinecone"),t.searchNamespaceInput=t.searchFormWrapper.querySelector("#aipkit_search_pinecone_namespace"),t.searchTopKInput=t.searchFormWrapper.querySelector("#aipkit_search_top_k_pinecone"),t.searchSubmitButton=t.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_btn"),t.searchCloseButton=t.searchFormWrapper.querySelector("#aipkit_close_search_pinecone_panel_btn"),t.searchResultsArea=t.searchFormWrapper.querySelector("#aipkit_search_pinecone_results_area"),t.searchStatusDiv=t.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_form_status")),t.createFormWrapperGlobal=document.getElementById("aipkit_pinecone_create_index_form_wrapper_global"),t.createFormWrapperGlobal&&(t.newIndexNameInputGlobal=t.createFormWrapperGlobal.querySelector("#aipkit_new_pinecone_index_name_global"),t.newIndexDimensionInputGlobal=t.createFormWrapperGlobal.querySelector("#aipkit_new_pinecone_dimension_global"),t.createIndexSubmitButtonGlobal=t.createFormWrapperGlobal.querySelector("#aipkit_submit_create_pinecone_index_btn_global"),t.createIndexCloseButtonGlobal=t.createFormWrapperGlobal.querySelector("#aipkit_close_create_pinecone_index_panel_btn_global"),t.createIndexStatusDivGlobal=t.createFormWrapperGlobal.querySelector("#aipkit_create_pinecone_index_status_global")),t.apiKeyIsSet=!!window.aipkit_pinecone_vs_config?.apiKeyIsSet,!t.apiKeyIsSet){let a=document.getElementById("aipkit_vs_global_provider_status"),s="Pinecone API Key not set. ",l=`<a href="${window.aipkit_dashboard.adminUrl}?page=wpaicg#integrations">Configure Now</a>`;a?a.innerHTML=`<span class="aipkit_text-danger">${(window.aipkit_escapeHtml||function(d){return d})(s)}${l}</span>`:t.rightColumnPlaceholder&&(t.rightColumnPlaceholder.innerHTML=`<p class="aipkit_text-center" style="padding: 20px;">${(window.aipkit_escapeHtml||function(d){return d})(s)}${l}</p>`),t.manageIndexPanel&&(t.manageIndexPanel.style.display="none"),t.searchFormWrapper&&(t.searchFormWrapper.style.display="none"),t.createFormWrapperGlobal&&(t.createFormWrapperGlobal.style.display="none");return}t.rightColumnPlaceholder&&(t.rightColumnPlaceholder.style.display="flex"),t.manageIndexPanel&&(t.manageIndexPanel.style.display="none"),t.searchFormWrapper&&(t.searchFormWrapper.style.display="none"),t.createFormWrapperGlobal&&(t.createFormWrapperGlobal.style.display="none");let e="data-pinecone-listener-attached";if(n.getAttribute(e)){console.log("AIPKit Pinecone Management UI: Listeners already attached.");return}t.manageIndexPanel&&(t.toggleMetadataButton&&t.toggleMetadataButton.addEventListener("click",()=>{if(t.metadataDisplayDiv){let a=t.metadataDisplayDiv.style.display==="none";t.metadataDisplayDiv.style.display=a?"block":"none",t.toggleMetadataButton.classList.toggle("aipkit_active",a),t.toggleMetadataButton.title=a?"Hide Index Metadata":"View Index Metadata"}}),t.panelSearchButton&&t.panelSearchButton.addEventListener("click",()=>{let a=t.manageIndexPanel?.dataset.activeIndexName;a&&typeof window.aipkit_showSearchFormForPineconeIndex=="function"&&window.aipkit_showSearchFormForPineconeIndex(a,a)}),t.panelDeleteButton&&t.panelDeleteButton.addEventListener("click",a=>{let s=a.currentTarget.dataset.indexName,l=typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml(s):s;s&&typeof window.aipkit_deletePineconeIndex=="function"&&confirm(`Are you sure you want to delete the Pinecone index "${l}"? This action cannot be undone.`)&&window.aipkit_deletePineconeIndex(s,a.currentTarget)}),typeof window.aipkit_handleDeleteVectorLogEntryClick=="function"&&t.manageIndexPanel.addEventListener("click",window.aipkit_handleDeleteVectorLogEntryClick)),t.searchFormWrapper&&(t.searchSubmitButton&&typeof window.aipkit_searchPineconeIndex=="function"&&t.searchSubmitButton.addEventListener("click",window.aipkit_searchPineconeIndex),t.searchCloseButton&&t.searchCloseButton.addEventListener("click",()=>{let a=t.searchIndexIdInput?.value;a&&t.syncedIndexes?.find(s=>s.name===a)&&typeof window.aipkit_showPineconeIndexDetails=="function"?window.aipkit_showPineconeIndexDetails(a,t.syncedIndexes.find(s=>s.name===a)):t.rightColumnPlaceholder&&(t.rightColumnPlaceholder.style.display="flex",t.manageIndexPanel&&(t.manageIndexPanel.style.display="none"),t.searchFormWrapper&&(t.searchFormWrapper.style.display="none"),t.createFormWrapperGlobal&&(t.createFormWrapperGlobal.style.display="none"))}));let o=document.getElementById("aipkit_vs_global_add_pinecone_index_btn");o&&typeof window.aipkit_showCreatePineconeIndexFormGlobal=="function"&&(o.dataset.listenerAttached||(o.addEventListener("click",window.aipkit_showCreatePineconeIndexFormGlobal),o.dataset.listenerAttached="true")),t.createIndexSubmitButtonGlobal&&typeof window.aipkit_handleCreatePineconeIndex=="function"&&(t.createIndexSubmitButtonGlobal.dataset.listenerAttached||(t.createIndexSubmitButtonGlobal.addEventListener("click",()=>window.aipkit_handleCreatePineconeIndex(!0)),t.createIndexSubmitButtonGlobal.dataset.listenerAttached="true")),t.createIndexCloseButtonGlobal&&typeof window.aipkit_hideCreatePineconeIndexFormGlobal=="function"&&(t.createIndexCloseButtonGlobal.dataset.listenerAttached||(t.createIndexCloseButtonGlobal.addEventListener("click",window.aipkit_hideCreatePineconeIndexFormGlobal),t.createIndexCloseButtonGlobal.dataset.listenerAttached="true")),n.setAttribute(e,"true"),console.log("AIPKit Pinecone Management UI Initialized.")}window.aipkit_initPineconeUI=i})();(function(){"use strict";function c(r){let i=window.aipkit_qdrant_vs_refs;if(!i||!i.managementBlock){console.error("showQdrantSection: Qdrant refs or management block not initialized.");return}let n=[i.rightColumnPlaceholder,i.manageCollectionPanel,i.searchFormWrapper,i.createFormWrapperGlobal],t=!1;n.forEach(e=>{e&&((e===i.rightColumnPlaceholder?"placeholder":e===i.manageCollectionPanel?"manage_panel":e===i.searchFormWrapper?"search_form":e===i.createFormWrapperGlobal?"create_form_global":null)===r?(e.style.display="flex",e.classList.add("aipkit-active"),t=!0):(e.style.display="none",e.classList.remove("aipkit-active")))}),!t&&i.rightColumnPlaceholder&&(i.rightColumnPlaceholder.style.display="flex",i.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showQdrantSection=c})();(function(){"use strict";function c(r,i="info",n=!0,t=!1){let e=window.aipkit_qdrant_vs_refs,o=null;if(t?o=e?.searchStatusDiv:n?o=e?.createCollectionStatusDivGlobal:o=e?.panelStatusDiv,!o&&(o=document.getElementById("aipkit_vs_global_provider_status"),!o)){console.warn("showQdrantStatus: No status div found.");return}o.messageTimeoutId&&clearTimeout(o.messageTimeoutId),o.messageTimeoutId=null;let a=r?r.trim():"";a!==""?(o.className="aipkit_form-help",i==="success"?o.classList.add("aipkit_settings_message-success"):i==="error"?o.classList.add("aipkit_settings_message-error"):o.classList.add("aipkit_settings_message-info"),o.textContent=a,o.style.display="block",o.style.opacity="1",o.classList.add("aipkit-active"),o.messageTimeoutId=setTimeout(()=>{o.style.opacity="0",setTimeout(()=>{o.textContent===a&&(o.textContent="",o.className="aipkit_form-help",o.style.display="none",o.classList.remove("aipkit-active"))},300)},5e3)):(o.textContent="",o.className="aipkit_form-help",o.style.display="none",o.style.opacity="0",o.classList.remove("aipkit-active"))}window.aipkit_showQdrantStatus=c})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(e){return e},i="aipkit_last_qdrant_collection_id";function n(e=null){let o=document.getElementById("aipkit_vs_global_target_select"),a=localStorage.getItem(i);if(!o){console.error("Populate Global Qdrant Target: Select element #aipkit_vs_global_target_select not found.");return}let s=o.value,l=o.offsetWidth;l>0&&(o.style.minWidth=`${l}px`,o.style.width=`${l}px`),o.innerHTML=`<option value="">${r(c.selectTargetCollection||"-- Select Collection --")}</option>`;let d=e!==null?e:window.aipkit_qdrant_vs_refs?.syncedCollections||window.aipkit_qdrant_vs_config?.initialCollections||[];d&&d.length>0?d.forEach(u=>{let f=u.name||u.id;if(f){let m=new Option(r(f),f);o.appendChild(m)}}):o.appendChild(new Option(r(c.noQdrantCollectionsFound||"No Qdrant collections. Sync or create one."),""));let p=new Option("+ "+(c.createNewCollectionButton||"Create New Collection..."),"_create_new_qdrant_");o.appendChild(p);let _=null;s&&s!=="_create_new_qdrant_"&&o.querySelector(`option[value="${CSS.escape(s)}"]`)?_=s:a&&o.querySelector(`option[value="${CSS.escape(a)}"]`)&&(_=a),_?o.value=_:o.options.length>1&&o.options[0].value===""?o.selectedIndex=0:o.options.length>0&&(o.selectedIndex=o.options[0].value===""?0:o.options.length>1?1:0),o.disabled=!(d&&d.length>0&&o.options.length>1),o.style.minWidth="",o.style.width=""}async function t(e=null,o=!1){let a=window.aipkit_qdrant_vs_refs||{},s="aipkit_vs_global_provider_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function")return console.error("List Qdrant Collections: Missing required UI or API helper functions."),Promise.reject(new Error("Dependencies missing."));if(o&&window.aipkit_qdrant_vs_config?.initialCollections&&window.aipkit_qdrant_vs_config.initialCollections.length>0){console.log("AIPKit Qdrant: Using initial localized collections for global select."),a.syncedCollections=window.aipkit_qdrant_vs_config.initialCollections,n(a.syncedCollections);let l=document.getElementById("aipkit_vs_global_target_select"),d=localStorage.getItem(i),p=l?l.value:null;return!p&&d&&l&&l.querySelector(`option[value="${CSS.escape(d)}"]`)&&(l.value=d,p=d),p&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"&&window.aipkit_fetchAndShowQdrantCollectionDetails(p),Promise.resolve()}e&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!0,"Sync Collections","Syncing..."),window.aipkit_showOpenAIVectorStatus("Syncing Qdrant collections...","info",s);try{let l=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!l||!l.value)throw new Error("Qdrant management nonce not found for listing collections.");let d=await window.aipkit_apiRequest("aipkit_list_collections_qdrant",{_ajax_nonce:l.value});a.syncedCollections=d.collections||[],window.aipkit_qdrant_vs_refs.syncedCollections=a.syncedCollections,n(a.syncedCollections),window.aipkit_showOpenAIVectorStatus(d.message||"Qdrant collections synced.","success",s)}catch(l){console.error("List Qdrant Collections Error:",l),window.aipkit_showOpenAIVectorStatus(`Error: ${l.message||"Failed to sync Qdrant collections."}`,"error",s)}finally{e&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,"Sync Collections")}}window.aipkit_populateGlobalQdrantTargetSelect=n,window.aipkit_listQdrantCollections=t})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{};function r(){let t=window.aipkit_qdrant_vs_refs;if(!t.createFormWrapperGlobal||!t.newCollectionNameInputGlobal||!t.newCollectionVectorSizeInputGlobal){console.error("Show Global Qdrant Create Form: Missing essential global form elements.");return}t.newCollectionNameInputGlobal.value="",t.newCollectionVectorSizeInputGlobal.value="1536",t.createCollectionStatusDivGlobal&&(t.createCollectionStatusDivGlobal.innerHTML=""),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("create_form_global"),t.newCollectionNameInputGlobal.focus()}function i(){typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}async function n(t=!0){let e=window.aipkit_qdrant_vs_refs,o=t?e.newCollectionNameInputGlobal:null,a=t?e.newCollectionVectorSizeInputGlobal:null,s=t?e.createCollectionSubmitButtonGlobal:null;if(!s||!o||!a){console.error("Create Qdrant Collection: Missing required form elements for ",t?"global form.":"panel form (deprecated).");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showQdrantStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Create Qdrant Collection: Missing core UI/API helper functions.");return}let l=o.value.trim(),d=parseInt(a.value,10);if(!l){window.aipkit_showQdrantStatus("Collection name is required.","error",t);return}if(!d||d<=0){window.aipkit_showQdrantStatus("Valid vector size (dimension) is required.","error",t);return}window.aipkit_setLoadingStateOpenAI(s,!0,c.createCollectionButton||"Create Collection",c.creatingCollection||"Creating..."),window.aipkit_showQdrantStatus(c.creatingCollection||"Creating collection...","info",t);try{let p=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!p||!p.value)throw new Error("Qdrant management nonce not found for create.");let _={_ajax_nonce:p.value,name:l,dimension:d,metric:"Cosine"},u=await window.aipkit_apiRequest("aipkit_create_collection_qdrant",_);window.aipkit_showQdrantStatus(u.message||"Collection created successfully!","success",t),t&&i(),typeof window.aipkit_listQdrantCollections=="function"&&await window.aipkit_listQdrantCollections(null,!1);let f=document.getElementById("aipkit_vs_global_target_select");f&&Array.from(f.options).some(g=>g.value===l)?(f.value=l,f.dispatchEvent(new Event("change"))):typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}catch(p){window.aipkit_showQdrantStatus(`Error: ${p.message||"Failed to create collection."}`,"error",t)}finally{window.aipkit_setLoadingStateOpenAI(s,!1,c.createCollectionButton||"Create Collection")}}window.aipkit_showCreateQdrantCollectionFormGlobal=r,window.aipkit_hideCreateQdrantCollectionFormGlobal=i,window.aipkit_handleCreateQdrantCollection=n})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};async function i(n,t){let e=window.aipkit_qdrant_vs_refs,o="aipkit_vs_global_provider_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Qdrant Collection: Missing required UI or API helper functions."),t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,"Delete Collection");return}window.aipkit_showOpenAIVectorStatus(`Deleting Qdrant collection "${r(n)}"...`,"info",o),t&&window.aipkit_setLoadingStateOpenAI(t,!0,"Delete Collection","Deleting...");try{let a=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!a||!a.value)throw new Error("Qdrant management nonce not found for delete.");let s=await window.aipkit_apiRequest("aipkit_delete_collection_qdrant",{_ajax_nonce:a.value,collection_name:n});window.aipkit_showOpenAIVectorStatus(s.message||`Collection "${r(n)}" deleted.`,"success",o),typeof window.aipkit_listQdrantCollections=="function"&&await window.aipkit_listQdrantCollections(null,!1),e.manageCollectionPanel&&e.manageCollectionPanel.dataset.activeCollectionName===n&&typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder"),e.searchFormWrapper&&e.searchCollectionIdInput&&e.searchCollectionIdInput.value===n&&typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}catch(a){console.error(`Delete Qdrant Collection Error for "${r(n)}":`,a),window.aipkit_showOpenAIVectorStatus(`Error deleting collection: ${r(a.message)||"Unknown error."}`,"error",o)}finally{t&&window.aipkit_setLoadingStateOpenAI(t,!1,"Delete Collection")}}window.aipkit_deleteQdrantCollection=i})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(o){return o};async function i(o){let a=window.aipkit_qdrant_vs_refs;if(!a.manageCollectionPanel||!a.panelTitle||!a.metadataDisplayDiv||!a.panelSearchButton||!a.panelDeleteButton||!a.toggleMetadataButton||!a.collectionLogsContainer){console.error("Qdrant Details: Missing one or more UI elements in refs for showing collection details."),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder");return}if(typeof window.aipkit_showQdrantSection!="function"||typeof window.aipkit_showQdrantStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Qdrant Details: Missing essential UI/API helper functions.");return}a.manageCollectionPanel.dataset.activeCollectionName=o,a.panelTitle.textContent=`Manage Collection: ${r(o)}`,a.metadataDisplayDiv.innerHTML=`<p>${r(c.loading_details||"Loading details...")}</p>`,a.metadataDisplayDiv.style.display="block",a.toggleMetadataButton.classList.add("aipkit_active"),a.toggleMetadataButton.title=c.hideCollectionInfo||"Hide Collection Info",a.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center" style="padding: 10px;"><span class="aipkit_spinner" style="display:inline-block;"></span> ${r(c.loading_logs||"Loading logs...")}</p>`;try{let s=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!s||!s.value)throw new Error("Qdrant management nonce for details not found.");let l=await window.aipkit_apiRequest("aipkit_get_qdrant_collection_stats",{_ajax_nonce:s.value,collection_name:o}),d=l.stats;if(d)n(o,d);else throw new Error(l.message||"Invalid data received for collection details.")}catch(s){console.error("Qdrant Fetch Details Error:",s),a.metadataDisplayDiv&&(a.metadataDisplayDiv.innerHTML=`<p class="aipkit_text-danger">Error loading details: ${r(s.message)}</p>`),a.collectionLogsContainer&&(a.collectionLogsContainer.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Error loading logs.</p>')}a.panelSearchButton.disabled=!1,a.panelDeleteButton.disabled=!1,a.panelDeleteButton.dataset.collectionName=o,window.aipkit_showQdrantSection("manage_panel"),t(o)}function n(o,a){let s=window.aipkit_qdrant_vs_refs;if(s.metadataDisplayDiv)if(s.metadataDisplayDiv.innerHTML="",a){let l="<ul>";l+=`<li><strong>Name:</strong> ${r(o)}</li>`;let d=a.result||a;if(d.status&&(l+=`<li><strong>Status:</strong> ${r(d.status)}</li>`),d.optimizer_status&&(l+=`<li><strong>Optimizer Status:</strong> ${r(d.optimizer_status)}</li>`),d.vectors_count!==void 0&&(l+=`<li><strong>Vectors Count:</strong> ${Number(d.vectors_count).toLocaleString()}</li>`),d.indexed_vectors_count!==void 0&&(l+=`<li><strong>Indexed Vectors:</strong> ${Number(d.indexed_vectors_count).toLocaleString()}</li>`),d.points_count!==void 0&&(l+=`<li><strong>Points Count:</strong> ${Number(d.points_count).toLocaleString()}</li>`),d.segments_count!==void 0&&(l+=`<li><strong>Segments Count:</strong> ${r(d.segments_count)}</li>`),d.config?.params?.vectors){let p=d.config.params.vectors;if(e(p)&&p.size!==void 0)l+=`<li><strong>Vector Size:</strong> ${r(p.size)}</li>`,l+=`<li><strong>Distance Metric:</strong> ${r(p.distance)}</li>`;else if(e(p)){l+="<li><strong>Vector Configs:</strong><ul>";for(let _ in p){let u=p[_];l+=`<li><strong>${r(_)}:</strong> Size: ${r(u.size)}, Metric: ${r(u.distance)}</li>`}l+="</ul></li>"}}d.payload_schema&&Object.keys(d.payload_schema).length>0&&(l+=`<li><strong>Payload Schema:</strong><pre style="max-height: 100px; overflow-y: auto; background: #f0f0f0; border:1px solid #ddd; padding: 5px;">${r(JSON.stringify(d.payload_schema,null,2))}</pre></li>`),l+="</ul>",s.metadataDisplayDiv.innerHTML=l}else s.metadataDisplayDiv.innerHTML="<p>Could not retrieve full collection details.</p>"}async function t(o){let a=window.aipkit_qdrant_vs_refs;if(a.collectionLogsContainer){a.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${r(c.loading_logs||"Loading logs...")}</p>`;try{let s=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!s||!s.value)throw new Error("Nonce for Qdrant logs not found.");let d=(await window.aipkit_apiRequest("aipkit_get_vector_data_source_logs_for_store",{_ajax_nonce:s.value,provider:"Qdrant",store_id:o})).logs||[];if(d.length===0){a.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center">${r(c.noLogsForStore||"No indexing logs found for this collection.")}</p>`;return}let p='<div class="aipkit_data-table aipkit_index_logs_table"><table>';p+="<thead><tr><th>Time</th><th>Status</th><th>Message</th><th>Emb. Provider</th><th>Emb. Model</th><th>Source</th><th>Point ID</th><th>Actions</th></tr></thead><tbody>",d.forEach(_=>{let u=_.status==="success"?"aipkit_status-success":_.status==="failed"||_.status==="content_error"?"aipkit_status-warning":"aipkit_status-info",f="";_.file_id&&(f=`<button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit-delete-vector-log-btn" 
                                                   data-provider="Qdrant" 
                                                   data-store-id="${r(o)}" 
                                                   data-vector-id="${r(_.file_id)}"
                                                   data-log-id="${r(_.id||"")}"
                                                   title="${r("Delete this record from Qdrant and local logs")}">
                                                   <span class="dashicons dashicons-trash"></span>
                                            </button>`),p+=`<tr data-log-id="${r(_.id||"")}">
                    <td>${r(_.timestamp?new Date(_.timestamp).toLocaleString():"N/A")}</td>
                    <td><span class="aipkit_status-tag ${u}">${r(_.status)}</span></td>
                    <td>${r(_.message)}</td>
                    <td>${r(_.embedding_provider||"N/A")}</td>
                    <td>${r(_.embedding_model||"N/A")}</td>
                    <td>${_.post_id?`Post ID: ${_.post_id}`:_.indexed_content?r(_.indexed_content.substring(0,30))+"...":"N/A"}</td>
                    <td class="aipkit-code-snippet">${r(_.file_id||"N/A")}</td>
                    <td class="aipkit_text-right">${f}</td>
                </tr>`}),p+="</tbody></table></div>",a.collectionLogsContainer.innerHTML=p}catch(s){console.error("Fetch Qdrant Logs Error:",s),a.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">Error loading logs: ${r(s.message||"Unknown error")}</p>`}}}function e(o){return o&&typeof o=="object"&&!Array.isArray(o)}window.aipkit_fetchAndShowQdrantCollectionDetails=i})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};function r(i,n){let t=window.aipkit_qdrant_vs_refs;if(!t.searchFormWrapper||!t.searchCollectionIdInput||!t.searchFormTitle||!t.searchResultsArea||!t.searchQueryTextInput||!t.searchFilterInput){console.error("Qdrant Search (Show Form): Missing required search form elements in refs."),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder");return}t.searchCollectionIdInput.value=i,t.searchFormTitle.textContent=`Search in Collection: ${c(n)}`,t.searchQueryTextInput.value="",t.searchFilterInput.value="",t.searchResultsArea.innerHTML="",t.searchStatusDiv&&(t.searchStatusDiv.innerHTML=""),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("search_form")}window.aipkit_showSearchFormForQdrantCollection=r})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(n){return n};async function i(){let n=window.aipkit_qdrant_vs_refs;if(!n.searchSubmitButton||!n.searchCollectionIdInput||!n.searchQueryTextInput||!n.searchTopKInput||!n.searchResultsArea||!n.searchFilterInput){console.error("Qdrant Search (Perform): Missing search form submit or input elements in refs for search action.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showQdrantStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Qdrant Search (Perform): Missing essential UI/API helper functions.");return}let t=n.searchCollectionIdInput.value,e=n.searchQueryTextInput.value.trim(),o=parseInt(n.searchTopKInput.value,10)||3,a=n.searchFilterInput.value.trim(),s=document.getElementById("aipkit_vs_global_embedding_model_select"),l=s?s.value:"",d=s&&s.options[s.selectedIndex]?.dataset.provider||"openai";if(!t){window.aipkit_showQdrantStatus("Collection ID missing.","error",!1,!0);return}if(!e){window.aipkit_showQdrantStatus("Search query empty.","error",!1,!0);return}if(!l){window.aipkit_showQdrantStatus('Select embedding model from "Add Content" form.',"error",!1,!0);return}let p=null;if(a)try{p=JSON.parse(a)}catch{window.aipkit_showQdrantStatus("Invalid JSON in filter.","error",!1,!0);return}window.aipkit_setLoadingStateOpenAI(n.searchSubmitButton,!0,"Search","Searching..."),window.aipkit_showQdrantStatus("Searching...","info",!1,!0),n.searchResultsArea.innerHTML=`<p class="aipkit_text-center">${c.loading||"Loading..."}</p>`;let _={_ajax_nonce:document.getElementById("aipkit_vector_store_qdrant_nonce_management").value,collection_id:t,query_text:e,embedding_provider:d,embedding_model:l,top_k:o,...p&&{filter:JSON.stringify(p)}};try{let u=await window.aipkit_apiRequest("aipkit_search_qdrant_collection",_);if(window.aipkit_showQdrantStatus(u.message||"Search complete.","success",!1,!0),u.results&&Array.isArray(u.results))if(u.results.length===0)n.searchResultsArea.innerHTML=`<p class="aipkit_text-center">No results for "${r(e)}".</p>`;else{let f="<ul>";u.results.forEach(m=>{let g=`<li><strong>ID:</strong> ${r(m.id||"N/A")}<br>`;m.score!==null&&typeof m.score<"u"&&(g+=`<strong>Score:</strong> ${Number(m.score).toFixed(4)}<br>`),m.metadata&&Object.keys(m.metadata).length>0&&(g+=`<strong>Payload:</strong><pre style="max-height: 100px; overflow-y: auto;">${r(JSON.stringify(m.metadata,null,2))}</pre>`,m.metadata.url&&m.metadata.title&&(g+=`<a href="${r(m.metadata.url)}" target="_blank" rel="noopener noreferrer">${r(m.metadata.title)}</a><br>`)),f+=`${g}</li>`}),f+="</ul>",n.searchResultsArea.innerHTML=f}else n.searchResultsArea.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Invalid search response.</p>'}catch(u){window.aipkit_showQdrantStatus(`Search Error: ${u.message||"Unknown error"}`,"error",!1,!0),n.searchResultsArea.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">${r(u.message||"Failed search.")}</p>`}finally{window.aipkit_setLoadingStateOpenAI(n.searchSubmitButton,!1,"Search")}}window.aipkit_searchQdrantCollection=i})();(function(){"use strict";window.aipkit_qdrant_vs_refs=window.aipkit_qdrant_vs_refs||{},window.aipkit_qdrant_vs_refs.syncedCollections=window.aipkit_qdrant_vs_config?.initialCollections||[];function c(){console.log("AIPKit AI Training: Initializing Qdrant Vector Store MANAGEMENT UI...");let r=document.getElementById("aipkit_vector_qdrant_management_ui");if(!r){console.warn("Qdrant Init: Qdrant management block (#aipkit_vector_qdrant_management_ui) not found.");return}let i=window.aipkit_qdrant_vs_refs;i.syncedCollections=window.aipkit_qdrant_vs_config?.initialCollections||[],i.urlIsSet=window.aipkit_qdrant_vs_config?.urlIsSet||!1,i.apiKeyIsSet=window.aipkit_qdrant_vs_config?.apiKeyIsSet||!1,i.managementBlock=r,i.rightColumnPlaceholder=r.querySelector("#aipkit_qdrant_vs_right_col_placeholder"),i.manageCollectionPanel=r.querySelector("#aipkit_manage_selected_qdrant_collection_panel"),i.manageCollectionPanel&&(i.panelTitle=i.manageCollectionPanel.querySelector("#aipkit_manage_qdrant_collection_panel_title"),i.toggleMetadataButton=i.manageCollectionPanel.querySelector("#aipkit_toggle_qdrant_collection_metadata_btn"),i.metadataDisplayDiv=i.manageCollectionPanel.querySelector("#aipkit_qdrant_collection_metadata_display"),i.panelSearchButton=i.manageCollectionPanel.querySelector("#aipkit_panel_search_this_qdrant_collection_btn"),i.panelDeleteButton=i.manageCollectionPanel.querySelector("#aipkit_delete_selected_qdrant_collection_btn"),i.panelStatusDiv=i.manageCollectionPanel.querySelector("#aipkit_manage_qdrant_collection_panel_status"),i.collectionLogsContainer=i.manageCollectionPanel.querySelector("#aipkit_qdrant_collection_logs_container")),i.searchFormWrapper=r.querySelector("#aipkit_search_qdrant_collection_form_wrapper"),i.searchFormWrapper&&(i.searchFormTitle=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_form_title"),i.searchCollectionIdInput=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_id"),i.searchQueryTextInput=i.searchFormWrapper.querySelector("#aipkit_search_query_text_qdrant"),i.searchTopKInput=i.searchFormWrapper.querySelector("#aipkit_search_top_k_qdrant"),i.searchFilterInput=i.searchFormWrapper.querySelector("#aipkit_search_filter_qdrant"),i.searchSubmitButton=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_btn"),i.searchCloseButton=i.searchFormWrapper.querySelector("#aipkit_close_search_qdrant_panel_btn"),i.searchResultsArea=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_results_area"),i.searchStatusDiv=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_form_status")),i.createFormWrapperGlobal=document.getElementById("aipkit_qdrant_create_collection_form_wrapper_global"),i.createFormWrapperGlobal&&(i.newCollectionNameInputGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_new_qdrant_collection_name_global"),i.newCollectionVectorSizeInputGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_new_qdrant_vector_size_global"),i.createCollectionSubmitButtonGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_submit_create_qdrant_collection_btn_global"),i.createCollectionCloseButtonGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_close_create_qdrant_collection_panel_btn_global"),i.createCollectionStatusDivGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_create_qdrant_collection_status_global")),typeof window.aipkit_showQdrantSection=="function"?window.aipkit_showQdrantSection("placeholder"):console.error("Qdrant Init: showQdrantSection function not found.");let n="data-qdrant-ui-listener-attached";r.getAttribute(n)||(r.addEventListener("click",function(e){let o=e.target.closest("button");if(o)if(o.id==="aipkit_toggle_qdrant_collection_metadata_btn"&&i.toggleMetadataButton){if(i.metadataDisplayDiv){let a=i.metadataDisplayDiv.style.display==="none";i.metadataDisplayDiv.style.display=a?"block":"none",i.toggleMetadataButton.classList.toggle("aipkit_active",a),i.toggleMetadataButton.title=a?"Hide Collection Info":"View Collection Info"}}else if(o.id==="aipkit_panel_search_this_qdrant_collection_btn"&&i.panelSearchButton){let a=i.manageCollectionPanel?.dataset.activeCollectionName;a&&typeof window.aipkit_showSearchFormForQdrantCollection=="function"&&window.aipkit_showSearchFormForQdrantCollection(a,a)}else if(o.id==="aipkit_delete_selected_qdrant_collection_btn"&&i.panelDeleteButton){let a=i.panelDeleteButton.dataset.collectionName,s=window.aipkit_escapeHtml||function(l){return l};a&&typeof window.aipkit_deleteQdrantCollection=="function"&&confirm(`Are you sure you want to delete the Qdrant collection "${s(a)}"? This action cannot be undone.`)&&window.aipkit_deleteQdrantCollection(a,i.panelDeleteButton)}else if(o.id==="aipkit_search_qdrant_collection_btn"&&i.searchSubmitButton&&typeof window.aipkit_searchQdrantCollection=="function")window.aipkit_searchQdrantCollection();else if(o.id==="aipkit_close_search_qdrant_panel_btn"&&i.searchCloseButton){let a=i.searchCollectionIdInput?.value;a&&i.syncedCollections?.find(s=>s.name===a)&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"?window.aipkit_fetchAndShowQdrantCollectionDetails(a):typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}else o.classList.contains("aipkit-delete-vector-log-btn")&&typeof window.aipkit_handleDeleteVectorLogEntryClick=="function"&&window.aipkit_handleDeleteVectorLogEntryClick(e)}),r.setAttribute(n,"true"));let t=document.getElementById("aipkit_vs_global_add_qdrant_collection_btn");t&&!t.dataset.listenerAttached&&(t.addEventListener("click",()=>{typeof window.aipkit_showCreateQdrantCollectionFormGlobal=="function"&&window.aipkit_showCreateQdrantCollectionFormGlobal()}),t.dataset.listenerAttached="true"),i.createCollectionSubmitButtonGlobal&&!i.createCollectionSubmitButtonGlobal.dataset.listenerAttached&&(i.createCollectionSubmitButtonGlobal.addEventListener("click",()=>{typeof window.aipkit_handleCreateQdrantCollection=="function"&&window.aipkit_handleCreateQdrantCollection(!0)}),i.createCollectionSubmitButtonGlobal.dataset.listenerAttached="true"),i.createCollectionCloseButtonGlobal&&!i.createCollectionCloseButtonGlobal.dataset.listenerAttached&&(i.createCollectionCloseButtonGlobal.addEventListener("click",()=>{typeof window.aipkit_hideCreateQdrantCollectionFormGlobal=="function"&&window.aipkit_hideCreateQdrantCollectionFormGlobal()}),i.createCollectionCloseButtonGlobal.dataset.listenerAttached="true"),console.log("AIPKit Qdrant Management UI Initialized.")}window.aipkit_initQdrantVectorStoreUI=c})();(function(){"use strict";let c="aipkit_last_openai_vs_id",r="aipkit_last_pinecone_index_id",i="aipkit_last_qdrant_collection_id";function n(t){let e=t.target.value,o=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai",a=document.getElementById("aipkit_vs_global_provider_status");a&&!a.querySelector(".aipkit_text-danger")&&(typeof window.aipkit_showOpenAIVectorStatus=="function"?window.aipkit_showOpenAIVectorStatus("","info","aipkit_vs_global_provider_status"):a&&(a.textContent=""));let s={openai:document.getElementById("aipkit_vs_global_new_store_inline_form_openai"),pinecone:document.getElementById("aipkit_pinecone_create_index_form_wrapper_global"),qdrant:document.getElementById("aipkit_qdrant_create_collection_form_wrapper_global")},l={openai:document.getElementById("aipkit_vs_global_add_openai_store_btn"),pinecone:document.getElementById("aipkit_vs_global_add_pinecone_index_btn"),qdrant:document.getElementById("aipkit_vs_global_add_qdrant_collection_btn")};for(let _ in s)s[_]&&(s[_].style.display="none"),l[_]&&(l[_].style.display=_===o?"inline-flex":"none");let d=`_create_new_${o}_`;if(e===d&&(l[o]&&(l[o].style.display="none"),s[o])){s[o].style.display="flex";let _=s[o].querySelector('input[type="text"]');_&&(_.value="",_.focus())}if(o==="openai")if(e&&e!=="_create_new_openai_"?localStorage.setItem(c,e):e!=="_create_new_openai_"&&localStorage.removeItem(c),e&&e!=="_create_new_openai_"&&typeof window.aipkit_showStoreFilesPanel=="function"){let _=window.aipkit_openai_fetched_stores_data?window.aipkit_openai_fetched_stores_data[e]:null,u=_?.name||e;window.aipkit_showStoreFilesPanel(e,u,_)}else e!=="_create_new_openai_"&&typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_openai_vs_refs?.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(window.aipkit_openai_vs_refs.rightColumnPlaceholder.id);else if(o==="pinecone")if(e&&e!=="_create_new_pinecone_"?localStorage.setItem(r,e):e!=="_create_new_pinecone_"&&localStorage.removeItem(r),e&&e!=="_create_new_pinecone_"&&typeof window.aipkit_showPineconeIndexDetails=="function"){let _=window.aipkit_pinecone_vs_refs?.syncedIndexes?.find(u=>u.name===e);window.aipkit_showPineconeIndexDetails(e,_)}else e!=="_create_new_pinecone_"&&typeof window.aipkit_ui_showSection=="function"&&window.aipkit_pinecone_vs_refs?.rightColumnPlaceholder&&window.aipkit_ui_showSection("placeholder",["placeholder","manageIndexPanel","searchFormWrapper","createFormWrapperGlobal"],window.aipkit_pinecone_vs_refs);else o==="qdrant"?(e&&e!=="_create_new_qdrant_"?localStorage.setItem(i,e):e!=="_create_new_qdrant_"&&localStorage.removeItem(i),e&&e!=="_create_new_qdrant_"&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"?window.aipkit_fetchAndShowQdrantCollectionDetails(e):e!=="_create_new_qdrant_"&&typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")):typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_openai_vs_refs?.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(window.aipkit_openai_vs_refs.rightColumnPlaceholder.id);let p=document.getElementById("aipkit_vs_global_data_source");if(p&&p.value==="wordpress_content"&&e&&!e.startsWith("_create_new_")&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&typeof window.aipkit_getWPCurrentPageForTraining=="function"){let _=window.aipkit_getWPCurrentPageForTraining();window.aipkit_fetchWordPressContentForTraining(_)}}window.aipkit_handleGlobalTargetSelectChange=n})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_vs_global_target_select");r?(typeof window.aipkit_handleGlobalTargetSelectChange=="function"?r.addEventListener("change",window.aipkit_handleGlobalTargetSelectChange):console.error("AIPKit Global Target Handler Init: aipkit_handleGlobalTargetSelectChange function not found."),console.log("AIPKit AI Training: Global Target Select Handler initialized.")):console.warn("AIPKit Global Target Handler Init: Global target select element (#aipkit_vs_global_target_select) not found.")}window.aipkit_initGlobalTargetHandler=c})();(function(){"use strict";function c(r){let i=r.target.value;if(typeof window.aipkit_ui_showSection!="function"){console.error("AIPKit Handle Source Change: aipkit_ui_showSection utility function not found.");return}let n=["aipkit_vs_global_text_entry","aipkit_vs_global_file_upload","aipkit_vs_global_wp_content_selector"],t="";i==="text_entry"?t="aipkit_vs_global_text_entry":i==="file_upload"?t="aipkit_vs_global_file_upload":i==="wordpress_content"&&(t="aipkit_vs_global_wp_content_selector"),window.aipkit_ui_showSection(t,n,"block");let e=document.getElementById("aipkit_vs_global_submit_upload_limits_info"),o=document.getElementById("aipkit_vs_wp_content_messages_area"),a=document.getElementById("aipkit_vs_global_file_upload_actual_input_wrapper"),s=document.getElementById("aipkit_vs_global_file_upload_pro_notice"),l=document.getElementById("aipkit_vs_global_submit_data_btn");if(i==="file_upload")if(window.aipkit_dashboard?.isProPlan===!0||window.aipkit_dashboard?.isProPlan==="1"||window.aipkit_dashboard?.isProPlan===1)a&&(a.style.display="block"),s&&(s.style.display="none"),typeof window.aipkit_displayUploadLimits=="function"&&window.aipkit_displayUploadLimits("aipkit_vs_global_submit_upload_limits_info","aipkit_vs_global_provider_status"),l&&(l.disabled=!1);else{if(a&&(a.style.display="none"),s){let p=window.aipkit_dashboard?.upgradeUrl||"#";s.innerHTML=`File Upload is a Pro feature. <a href="${p}" target="_blank">Upgrade to Pro</a> to enable.`,s.style.display="block"}e&&(e.style.display="none"),l&&(l.disabled=!0)}else e&&(e.style.display="none"),l&&(l.disabled=!1),a&&(a.style.display="block"),s&&(s.style.display="none");if(i==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"){let d=document.getElementById("aipkit_vs_global_wp_content_selector");d&&d.style.display==="block"&&window.aipkit_fetchWordPressContentForTraining(1)}else if(i!=="wordpress_content"){let d=document.getElementById("aipkit_vs_wp_content_list_area"),p=document.getElementById("aipkit_vs_wp_content_pagination"),_=window.aipkit_dashboard?.text||{},u=window.aipkit_escapeHtml||function(f){return f};d&&(d.innerHTML=`<p class="aipkit_text-center aipkit_text-secondary">${u(_.selectWPCriteria||'Select criteria and click "Load Content".')}</p>`),p&&(p.innerHTML=""),o&&(o.innerHTML="")}}window.aipkit_handleGlobalDataSourceChange=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_vs_global_data_source");r?typeof window.aipkit_handleGlobalDataSourceChange=="function"?(window.aipkit_handleGlobalDataSourceChange({target:r}),r.addEventListener("change",window.aipkit_handleGlobalDataSourceChange),console.log("AIPKit AI Training: Global Data Source Switcher initialized.")):console.error("AIPKit Global Data Source Init: aipkit_handleGlobalDataSourceChange function not found."):console.warn("AIPKit Global Data Source Init: Global data source select element (#aipkit_vs_global_data_source) not found.")}window.aipkit_initGlobalDataSourceSwitcher=c})();(function(){"use strict";let c="aipkit_last_embedding_model",r=window.aipkit_escapeHtml||function(n){return n};function i(){let n=document.getElementById("aipkit_vs_global_embedding_model_select");if(!n)return;let t=n.value;n.innerHTML=`<option value="">${r("-- Select Embedding Model --")}</option>`;let e=window.aipkit_openai_vs_config||{},o=[{providerKey:"openai",label:"OpenAI",models:e.openaiEmbeddingModels||[]},{providerKey:"google",label:"Google",models:e.googleEmbeddingModels||[]}],a=0;o.forEach(d=>{if(d.models&&Array.isArray(d.models)&&d.models.length>0){a+=d.models.length;let p=document.createElement("optgroup");p.label=d.label,d.models.forEach(_=>{if(_&&_.id){let u=new Option(r(_.name||_.id),_.id);u.dataset.provider=d.providerKey,p.appendChild(u)}}),n.appendChild(p)}});let s=null,l=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai";if(l==="pinecone"||l==="qdrant"){let d=localStorage.getItem(c);d&&n.querySelector(`option[value="${CSS.escape(d)}"]`)&&(s=d)}if(!s&&t&&n.querySelector(`option[value="${CSS.escape(t)}"]`)&&(s=t),s)n.value=s;else if(n.options.length>1&&n.options[0].value==="")n.selectedIndex=0;else if(n.options.length>0){let d=n.querySelector("optgroup");if(d){let p=d.querySelector("option");p&&p.value&&(n.value=p.value)}else n.options.length>0&&n.options[0].value&&(n.selectedIndex=0)}n.disabled=!(a>0),a===0&&n.appendChild(new Option(r("(No embedding models found - Sync in AI Settings)"),""))}window.aipkit_populateGlobalEmbeddingModelSelect=i})();(function(){"use strict";let c="aipkit_last_embedding_model";function r(){let i=document.getElementById("aipkit_vs_global_embedding_model_select");i?typeof window.aipkit_populateGlobalEmbeddingModelSelect=="function"?(window.aipkit_populateGlobalEmbeddingModelSelect(),i.addEventListener("change",n=>{let t=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():null;(t==="pinecone"||t==="qdrant")&&localStorage.setItem(c,n.target.value)}),console.log("AIPKit AI Training: Global Embedding Config Initializer executed.")):console.error("AIPKit Global Embedding Config Init: aipkit_populateGlobalEmbeddingModelSelect function not found."):console.warn("AIPKit Global Embedding Config Init: Embedding model select element (#aipkit_vs_global_embedding_model_select) not found.")}window.aipkit_initGlobalEmbeddingConfig=r})();(function(){"use strict";let c=1;function r(n){c=parseInt(n,10)||1}function i(){return c}window.aipkit_setWPCurrentPageForTraining=r,window.aipkit_getWPCurrentPageForTraining=i})();(function(){"use strict";function c(r,i){console.log("AIPKit Render WP List: Received paginationData:",i);let n=document.getElementById("aipkit_vs_wp_content_list_area"),t=document.getElementById("aipkit_vs_wp_content_pagination"),e=window.aipkit_escapeHtml||function(s){return s};if(!n||!t){console.error("Render WP List: Missing list or pagination area elements.");return}if(typeof window.aipkit_fetchWordPressContentForTraining!="function"&&console.error("Render WP List: aipkit_fetchWordPressContentForTraining function not found for pagination."),!r||r.length===0){n.innerHTML=`<p class="aipkit_text-center aipkit_text-secondary">${window.aipkit_dashboard?.text?.noWPCPostsFound||"No posts found matching your criteria."}</p>`,t.innerHTML="";return}let o=`<div class="aipkit_wp_content_select_all_wrapper">
                            <label class="aipkit_checkbox-label">
                                <input type="checkbox" id="aipkit_vs_wp_content_select_all">
                                ${e("Select All on Page")}
                            </label>
                        </div><ul>`;if(r.forEach(s=>{let l=s.is_already_indexed?"aipkit_wp_content_indexed_status":"",d=s.is_already_indexed?"\u2713 Indexed":"",p="",_=s.edit_link?`<a href="${e(s.edit_link)}" target="_blank" class="aipkit_wp_content_title">${e(s.title)}</a>`:`<span class="aipkit_wp_content_title">${e(s.title)}</span>`;o+=`<li class="aipkit_wp_content_list_item">
                            <input type="checkbox" name="wp_content_to_index[]" value="${e(s.id)}" ${p}>
                            ${_}
                            <span class="aipkit_wp_content_type">${e(s.type_label)}</span>
                            ${d?`<span class="${l}">${e(d)}</span>`:""}
                         </li>`}),o+="</ul>",n.innerHTML=o,t.innerHTML="",i&&i.total_pages>1){let s=i.total_posts||0,l=parseInt(i.current_page,10),d=parseInt(i.total_pages,10),p=wp.i18n?.__||(w=>w),_=wp.i18n?._n||((w,b,y)=>y>1?b:w),u=document.createElement("span");u.className="aipkit_pagination-count",u.textContent=`${s.toLocaleString()} ${_("item","items",s)}`,t.appendChild(u);let f=document.createElement("span");f.className="aipkit_pagination-links";let m=document.createElement("button");m.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",m.innerHTML="\xAB "+p("Previous","gpt3-ai-content-generator"),m.disabled=l<=1,m.disabled||m.addEventListener("click",w=>{w.preventDefault(),window.aipkit_fetchWordPressContentForTraining(l-1)}),f.appendChild(m);let g=document.createElement("span");g.className="aipkit_pagination-current",g.textContent=`${p("Page","gpt3-ai-content-generator")} ${l} ${p("of","gpt3-ai-content-generator")} ${d}`,f.appendChild(g);let k=document.createElement("button");k.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",k.innerHTML=p("Next","gpt3-ai-content-generator")+" \xBB",k.disabled=l>=d,k.disabled||k.addEventListener("click",w=>{w.preventDefault(),window.aipkit_fetchWordPressContentForTraining(l+1)}),f.appendChild(k),t.appendChild(f)}let a=document.getElementById("aipkit_vs_wp_content_select_all");a&&a.addEventListener("change",function(){n.querySelectorAll('input[name="wp_content_to_index[]"]:not(:disabled)').forEach(s=>{s.checked=this.checked})})}window.aipkit_renderWordPressContentListForTraining=c})();(function(){"use strict";async function c(r=1){let i=document.getElementById("aipkit_vs_wp_content_list_area"),n=document.getElementById("aipkit_vs_wp_content_pagination"),t=document.getElementById("aipkit_vs_wp_content_messages_area"),e=document.getElementById("aipkit_vs_load_wp_content_btn"),o=document.getElementById("aipkit_vs_global_target_select"),a=o?o.value:"";if(typeof window.aipkit_setWPCurrentPageForTraining=="function"?window.aipkit_setWPCurrentPageForTraining(r):console.warn("aipkit_setWPCurrentPageForTraining not defined in wp-content-state.js"),!i||!n||!t||!e){console.error("Fetch WP Content: Missing required UI elements (list, pagination, status, or loadButton).");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderWordPressContentListForTraining!="function"){console.error("Fetch WP Content: Missing UI/API helper or render functions."),t&&(t.innerHTML='<p class="aipkit_text-danger">Error: Core UI functions missing.</p>');return}let s=document.getElementById("aipkit_vs_wp_content_post_types"),l=document.getElementById("aipkit_vs_wp_content_status"),d=s?Array.from(s.selectedOptions).map(f=>f.value):[],p=l?l.value:"publish";if(d.length===0){t&&(t.innerHTML='<p class="aipkit_text-danger">Please select at least one post type.</p>');return}window.aipkit_setLoadingStateOpenAI(e,!0,"Load Content","Loading..."),i.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading content...</p>',n.innerHTML="",t&&(t.innerHTML="");let _=document.getElementById("aipkit_wp_content_fetch_nonce");if(!_||!_.value){t&&(t.innerHTML='<p class="aipkit_text-danger">Error: Security token missing.</p>'),window.aipkit_setLoadingStateOpenAI(e,!1,"Load Content");return}let u={_ajax_nonce:_.value,post_types:d,post_status:p,target_store_id:a,paged:r};try{let f=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",u);console.log("AIPKit Fetch WP Content: Raw response from server:",f),window.aipkit_renderWordPressContentListForTraining(f.posts,f.pagination)}catch(f){console.error("Fetch WP Content Error:",f),t&&(t.innerHTML=`<p class="aipkit_text-danger">Error loading content: ${f.message||"Unknown error"}</p>`),i&&(i.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Failed to load content.</p>')}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Load Content")}}window.aipkit_fetchWordPressContentForTraining=c})();(function(){"use strict";function c(r,i,n){return r==="text_entry"?{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:i,vector_id:n}:r==="wp_post"?{source:"wordpress_post",post_id:String(i),vector_id:n}:{}}window.aipkit_utils_extractEmbeddingMeta=c})();(function(){"use strict";function c(){let r=document.querySelectorAll('#aipkit_vs_wp_content_list_area input[name="wp_content_to_index[]"]:checked');return Array.from(r).map(i=>i.value)}window.aipkit_utils_getSelectedPostIds=c})();(function(){"use strict";function c(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,r=>(r^crypto.getRandomValues(new Uint8Array(1))[0]&15>>r/4).toString(16))}window.aipkit_generateUUIDv4=c})();(function(){"use strict";function c(){let r=window.aipkit_dashboard?.text||{},i=document.getElementById("aipkit_vs_global_data_source")?.value,n=document.getElementById("aipkit_vs_global_provider_select")?.value,t=document.getElementById("aipkit_vs_global_target_select"),e=t?t.value:"",o=document.getElementById("aipkit_vs_global_new_store_name_openai"),a=o?o.value.trim():"",s=null,l=null,d=[],p="",_=null;if(!n)return{isValid:!1,message:"Please select a Vector Provider.",values:null};if(!e)return{isValid:!1,message:"Please select a target Store/Index/Collection.",values:null};if(n==="openai"&&e.startsWith("_create_new_")&&!a)return{isValid:!1,message:"Please provide a name for the new OpenAI store.",values:null};if((n==="pinecone"||n==="qdrant")&&e.startsWith("_create_new_"))return{isValid:!1,message:"Please create the Pinecone Index or Qdrant Collection in its management panel first.",values:null};if(n==="pinecone"||n==="qdrant"){let u=document.getElementById("aipkit_vs_global_embedding_model_select");if(u&&u.value){let f=u.options[u.selectedIndex];l=f.value,s=f.dataset.provider||null}if(!s||!l)return{isValid:!1,message:"Please select an Embedding Model for this provider.",values:null}}if(i==="text_entry"){if(p=document.getElementById("aipkit_vs_global_text_content")?.value.trim()||"",!p)return{isValid:!1,message:"Text content cannot be empty.",values:null}}else if(i==="file_upload"){if(_=document.getElementById("aipkit_vs_global_file_to_submit"),!_?.files||_.files.length===0)return{isValid:!1,message:"Please select a file to upload.",values:null}}else if(i==="wordpress_content"){let u=document.querySelectorAll('#aipkit_vs_wp_content_list_area input[name="wp_content_to_index[]"]:checked');if(d=Array.from(u).map(f=>f.value),d.length===0)return{isValid:!1,message:"Please select WordPress content to index.",values:null}}else return{isValid:!1,message:"Invalid data source selected.",values:null};return{isValid:!0,message:null,values:{dataSource:i,vectorStoreProvider:n,targetStoreId:e,newStoreNameOpenAI:a,embeddingProvider:s,embeddingModel:l,textContent:p,fileInput:_,postIds:d}}}window.aipkit_validateGlobalFormState=c})();(function(){"use strict";function c(r,i){return(i==="pinecone"||i==="qdrant")&&(r==="text_entry"||r==="wordpress_content")?{isIterative:!0,type:i}:i==="openai"&&r==="wordpress_content"?{isIterative:!0,type:"openai"}:{isIterative:!1,type:null}}window.aipkit_determineIterationMode=c})();(function(){"use strict";function c(r,i){let n="";return r==="text_entry"?i==="openai"?n="aipkit_add_text_to_vector_store_openai":i==="pinecone"?n="aipkit_upsert_to_pinecone_index":i==="qdrant"&&(n="aipkit_upsert_to_qdrant_collection"):r==="file_upload"&&(i==="openai"?n="aipkit_upload_and_add_file_to_store_direct_openai":i==="pinecone"?n="aipkit_upload_file_and_upsert_to_pinecone":i==="qdrant"&&(n="aipkit_upload_file_and_upsert_to_qdrant")),n}window.aipkit_determineAjaxAction=c})();(function(){"use strict";function c(r){let{dataSource:i,vectorStoreProvider:n,targetStoreId:t,newStoreNameOpenAI:e,embeddingProvider:o,embeddingModel:a,textContent:s,fileInput:l,postIds:d}=r,p=new FormData,_={provider:n,source_type:i,...o&&{embedding_provider:o},...a&&{embedding_model:a}};n==="openai"?(_.target_store_id=t.startsWith("_create_new_")?"":t,_.new_store_name_openai=e):n==="pinecone"?_.index_name=t.startsWith("_create_new_")?"":t:n==="qdrant"&&(_.collection_name=t.startsWith("_create_new_")?"":t);for(let g in _)p.append(g,_[g]);if(i==="text_entry")_.text_content=s,_.original_text_content=s,p.append("text_content",s);else if(i==="file_upload"){if(l&&l.files[0]){let g=n==="openai"?"aipkit_vs_global_file_to_submit":"file_to_upload";p.append(g,l.files[0])}(n==="pinecone"||n==="qdrant")&&t&&p.append("target_store_id",t)}else i==="wordpress_content"&&(_.post_ids=d,p.delete("post_ids"),d.forEach(g=>p.append("post_ids[]",g)));let u="",f="";n==="openai"?f="aipkit_vector_store_nonce_openai":n==="pinecone"?f="aipkit_vector_store_pinecone_nonce_management":n==="qdrant"&&(f="aipkit_vector_store_qdrant_nonce_management"),i==="wordpress_content"&&n==="openai"&&(f="aipkit_wp_content_index_nonce");let m=document.getElementById(f);return m?.value?(u=m.value,p.append("_ajax_nonce",u),_._ajax_nonce=u):console.error(`BuildSubmissionData: Nonce field #${f} not found.`),{formDataForFetch:p,requestDataForAJAX:_}}window.aipkit_buildSubmissionData=c})();(function(){"use strict";function c(r,i,n="Submit",t="Processing..."){if(!r)return;let e=r.querySelector(".aipkit_btn-text"),o=r.querySelector(".aipkit_spinner"),a=r.querySelector(".dashicons");if(i){if(r.disabled=!0,!r.dataset.originalText)if(e)r.dataset.originalText=e.textContent;else{let l="";r.childNodes.forEach(d=>{d.nodeType===Node.TEXT_NODE&&(l+=d.textContent.trim())}),r.dataset.originalText=l.trim()||n}a&&(a.dataset.originalDisplay||(a.dataset.originalDisplay=a.style.display||"inline-block"),a.style.display="none");let s=r.dataset.loadingText||t;e?e.textContent=s:(!a||a.style.display==="none")&&(Array.from(r.childNodes).forEach(l=>{l.nodeType===Node.TEXT_NODE&&l.remove()}),s&&r.insertBefore(document.createTextNode(s),r.firstChild)),o&&(o.style.display="inline-block")}else{r.disabled=!1;let s=r.dataset.originalText||n;a&&a.dataset.originalDisplay&&(a.style.display=a.dataset.originalDisplay,delete a.dataset.originalDisplay),e?e.textContent=s:(!a||a.style.display!=="none")&&(Array.from(r.childNodes).forEach(l=>{l.nodeType===Node.TEXT_NODE&&l.remove()}),s&&(!a||a.style.display==="none")&&r.insertBefore(document.createTextNode(s),r.firstChild)),o&&(o.style.display="none"),delete r.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=c})();(function(){"use strict";function c(r,i="info",n){let t=document.getElementById(n);if(!t){console.warn(`showOpenAIVectorStatus: Status container #${n} not found.`);return}t.messageTimeoutId&&clearTimeout(t.messageTimeoutId),t.messageTimeoutId=null;let e=r?r.trim():"";e!==""?(t.className="aipkit_form-help",i==="success"?t.classList.add("aipkit_settings_message-success"):i==="error"?t.classList.add("aipkit_settings_message-error"):t.classList.add("aipkit_settings_message-info"),t.textContent=e,t.style.display="block",t.style.opacity="1",t.classList.add("aipkit-active"),t.messageTimeoutId=setTimeout(()=>{t.style.opacity="0",setTimeout(()=>{t.textContent===e&&(t.textContent="",t.className="aipkit_form-help",t.style.display="none",t.classList.remove("aipkit-active"))},300)},5e3)):(t.textContent="",t.className="aipkit_form-help",t.style.display="none",t.style.opacity="0",t.classList.remove("aipkit-active"))}window.aipkit_showOpenAIVectorStatus=c})();(function(){"use strict";function c(r){if(r==="text_entry"){let i=document.getElementById("aipkit_vs_global_text_content");i&&(i.value="")}else if(r==="file_upload"){let i=document.getElementById("aipkit_vs_global_file_to_submit");i&&(i.value="")}}window.aipkit_clearSubmissionFields=c})();(function(){"use strict";function c(r,i,n){let t=r?.message||"An unknown error occurred.";if(console.error(`AIPKit Submission Error (${i}):`,r),typeof window.aipkit_showOpenAIVectorStatus=="function")window.aipkit_showOpenAIVectorStatus(`Error: ${t}`,"error",n);else{let e=document.getElementById(n);e?(e.textContent=`Error: ${t}`,e.className="aipkit_form-help aipkit_settings_message-error"):alert(`Error: ${t}`)}}window.aipkit_reportSubmissionError=c})();(function(){"use strict";async function c(r,i,n,t){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let e={_ajax_nonce:t,content_to_embed:r,embedding_provider:i,embedding_model:n};return window.aipkit_apiRequest("aipkit_generate_embedding",e)}window.aipkit_api_generateEmbedding=c})();(function(){"use strict";async function c(r,i){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let n={_ajax_nonce:i,get_content_for_ids:r};return window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",n)}window.aipkit_api_fetchWpPostContent=c})();(function(){"use strict";async function c(i){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",i)}async function r(i,n){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));i.set("action",n);let t=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:i,credentials:"same-origin"}),e=await t.json();if(!t.ok||!e.success)throw new Error(e.data?.message||`HTTP error! status: ${t.status}`);return e.data}window.aipkit_api_upsertOpenAIText=c,window.aipkit_api_upsertFile=r})();(function(){"use strict";async function c(r,i){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let n={...r,_ajax_nonce:i};return window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",n)}window.aipkit_api_upsertToPinecone=c})();(function(){"use strict";async function c(r,i){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let n={...r,_ajax_nonce:i};return window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",n)}window.aipkit_api_upsertToQdrant=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};async function r(i,n,t){let e=0,o=0,a="aipkit_index_selected_wp_content";try{for(let[l,d]of i.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",t);break}let p=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${d}"]`),_=p?p.closest("li").querySelector(".aipkit_wp_content_title"):null,u=_?_.textContent.trim():`Post #${d}`;window.aipkit_showOpenAIVectorStatus(`Processing ${l+1}/${i.length}: "${c(u)}"`,"info",t);let f={...n,post_ids:[d]};try{await window.aipkit_apiRequest(a,f),e++}catch(m){o++,console.error(`AI Training Indexing Error (Post ID ${d}):`,m)}}let s=`Indexing complete. ${e} successful, ${o} failed.`;window.aipkit_isIndexingStopped&&e+o<i.length?s=`Indexing stopped. ${e} successful, ${o} failed.`:o>0&&(s+=" See browser console for details on failed posts."),window.aipkit_showOpenAIVectorStatus(s,o>0||window.aipkit_isIndexingStopped?"warning":"success",t),typeof window.aipkit_fetchWordPressContentForTraining=="function"&&typeof window.aipkit_getWPCurrentPageForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"&&window.aipkit_populateGlobalOpenAITargetSelect(!0)}catch(s){console.error("AIPKit OpenAI Indexer: Loop-level error:",s),window.aipkit_showOpenAIVectorStatus(`Error during batch processing: ${s.message}`,"error",t)}}window.aipkit_indexOpenAIBatch=r})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};async function r(i,n,t){let e=0,o=0,{embedding_provider:a,embedding_model:s,index_name:l,_ajax_nonce:d}=n;window.aipkit_showOpenAIVectorStatus(`Preparing to index ${i.length} item(s) for Pinecone...`,"info",t);try{for(let[_,u]of i.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",t);break}try{let f=u.content,m={...u.metadata},g=u.metadata.title||`Item ${_+1}`;if(u.type==="wp_post"){let y=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${u.postId}"]`),h=y?y.closest("li").querySelector(".aipkit_wp_content_title"):null;g=h?h.textContent.trim():`Post #${u.postId}`}if(window.aipkit_showOpenAIVectorStatus(`Processing ${_+1}/${i.length}: "${c(g)}"`,"info",t),u.type==="wp_post"){let y=document.getElementById("aipkit_wp_content_fetch_nonce");if(!y?.value)throw new Error("WP Content fetch nonce missing.");let h=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:y.value,get_content_for_ids:[u.postId]});if(!h.posts_content||!h.posts_content[u.postId])throw new Error(`Could not fetch content for Post ID ${u.postId}.`);let v=h.posts_content[u.postId];f=v.content,m.title=v.title||"N/A",m.type=v.type_label||"N/A",m.url=v.edit_link||"#"}if(!f)throw new Error(`Content to embed is empty for item ${u.id}`);let k=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:f,embedding_provider:a,embedding_model:s,_ajax_nonce:window.aipkit_dashboard.nonce});if(!k.embeddings||k.embeddings.length===0)throw new Error(`Embedding failed: ${k.message||"No vector returned"}`);let w=k.embeddings[0],b={_ajax_nonce:d,vectors:JSON.stringify([{id:u.id,values:w,metadata:m}]),embedding_provider:a,embedding_model:s,original_text_content:f,index_name:l};await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",b),e++}catch(f){o++,console.error(`Error processing Pinecone item ${c(u.id)}:`,f)}}let p=`Indexing complete. ${e} successful, ${o} failed.`;o>0&&(p+=" See console for details."),window.aipkit_showOpenAIVectorStatus(p,e>0&&o===0?"success":"warning",t),n.source_type==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_listPineconeIndexes=="function"&&window.aipkit_listPineconeIndexes(null,!1).then(()=>{if(l){let _=document.getElementById("aipkit_vs_global_target_select");_&&(_.value=l,_.dispatchEvent(new Event("change")))}})}catch(p){console.error("AIPKit Pinecone Indexer: Loop-level error:",p),window.aipkit_showOpenAIVectorStatus(`Error during batch processing: ${p.message}`,"error",t)}}window.aipkit_indexPineconeBatch=r})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};async function r(i,n,t){let e=0,o=0,{embedding_provider:a,embedding_model:s,collection_name:l,_ajax_nonce:d}=n;window.aipkit_showOpenAIVectorStatus(`Preparing to index ${i.length} item(s) for Qdrant...`,"info",t);try{for(let[_,u]of i.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",t);break}try{let f=u.content,m={...u.metadata},g=u.metadata.title||`Item ${_+1}`;if(u.type==="wp_post"){let y=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${u.postId}"]`),h=y?y.closest("li").querySelector(".aipkit_wp_content_title"):null;g=h?h.textContent.trim():`Post #${u.postId}`}if(window.aipkit_showOpenAIVectorStatus(`Processing ${_+1}/${i.length}: "${c(g)}"`,"info",t),u.type==="wp_post"){let y=document.getElementById("aipkit_wp_content_fetch_nonce");if(!y?.value)throw new Error("WP Content fetch nonce missing.");let h=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:y.value,get_content_for_ids:[u.postId]});if(!h.posts_content||!h.posts_content[u.postId])throw new Error(`Could not fetch content for Post ID ${u.postId}.`);let v=h.posts_content[u.postId];f=v.content,m.title=v.title||"N/A",m.type=v.type_label||"N/A",m.url=v.edit_link||"#"}if(!f)throw new Error(`Content to embed is empty for item ${u.id}`);let k=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:f,embedding_provider:a,embedding_model:s,_ajax_nonce:window.aipkit_dashboard.nonce});if(!k.embeddings||k.embeddings.length===0)throw new Error(`Embedding failed: ${k.message||"No vector returned"}`);let w=k.embeddings[0],b={_ajax_nonce:d,vectors:JSON.stringify([{id:u.id,vector:w,payload:m}]),embedding_provider:a,embedding_model:s,original_text_content:f,collection_name:l};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",b),e++}catch(f){o++,console.error(`Error processing Qdrant item ${c(u.id)}:`,f)}}let p=`Indexing complete. ${e} successful, ${o} failed.`;o>0&&(p+=" See console for details."),window.aipkit_showOpenAIVectorStatus(p,e>0&&o===0?"success":"warning",t),n.source_type==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_listQdrantCollections=="function"&&window.aipkit_listQdrantCollections(null,!1).then(()=>{if(l){let _=document.getElementById("aipkit_vs_global_target_select");_&&(_.value=l,_.dispatchEvent(new Event("change")))}})}catch(p){console.error("AIPKit Qdrant Indexer: Loop-level error:",p),window.aipkit_showOpenAIVectorStatus(`Error during batch processing: ${p.message}`,"error",t)}}window.aipkit_indexQdrantBatch=r})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{};async function r(i){i.preventDefault();let n=document.getElementById("aipkit_vs_global_submit_data_btn"),t=document.getElementById("aipkit_vs_global_stop_indexing_btn"),e,o=window.aipkit_validateGlobalFormState(),a=o.values?.dataSource==="wordpress_content"?"aipkit_vs_wp_content_messages_area":"aipkit_vs_global_provider_status";if(!o.isValid){window.aipkit_showOpenAIVectorStatus(o.message,"error",a);return}let{dataSource:s,vectorStoreProvider:l,...d}=o.values;window.aipkit_isIndexingStopped=!1,window.aipkit_setLoadingStateOpenAI(n,!0,c.addContentButton||"Add Content",c.processingButton||"Processing..."),window.aipkit_showOpenAIVectorStatus(c.processingRequest||"Processing request...","info",a),n.style.display="none";try{let p=window.aipkit_determineIterationMode(s,l),{requestDataForAJAX:_,formDataForFetch:u}=window.aipkit_buildSubmissionData(o.values);if(p.isIterative&&(t.style.display="inline-flex",t.disabled=!1,t.textContent=c.stopButton||"Stop",e=()=>{window.aipkit_isIndexingStopped=!0,t.disabled=!0,t.textContent=c.stoppingButton||"Stopping..."},t.addEventListener("click",e,{once:!0})),p.isIterative){let f=[];if(s==="text_entry"){let m=l==="qdrant"?window.aipkit_generateUUIDv4():`text_${Date.now()}`;f.push({id:m,content:d.textContent,type:"text_entry",metadata:window.aipkit_utils_extractEmbeddingMeta("text_entry",d.textContent,m)})}else s==="wordpress_content"&&(f=d.postIds.map(m=>({id:`wp_post_${m}`,postId:m,type:"wp_post",metadata:window.aipkit_utils_extractEmbeddingMeta("wp_post",m,`wp_post_${m}`)})));p.type==="openai"?await window.aipkit_indexOpenAIBatch(d.postIds,_,a):p.type==="pinecone"?await window.aipkit_indexPineconeBatch(f,_,a):p.type==="qdrant"&&await window.aipkit_indexQdrantBatch(f,_,a)}else{let f=window.aipkit_determineAjaxAction(s,l);if(!f)throw new Error("No AJAX action defined for this submission type.");let k=await(s==="file_upload"?window.aipkit_api_upsertFile(u,f):window.aipkit_api_upsertOpenAIText(_));window.aipkit_showOpenAIVectorStatus(k.message||"Content added successfully!","success",a),window.aipkit_clearSubmissionFields(s);let w=k.new_store_id||k.store_id||d.targetStoreId;l==="openai"?window.aipkit_populateGlobalOpenAITargetSelect(!0).then(()=>{if(w){let b=document.getElementById("aipkit_vs_global_target_select");b&&(b.value=w,b.dispatchEvent(new Event("change")))}}):l==="pinecone"?window.aipkit_listPineconeIndexes(null,!1).then(()=>{if(w){let b=document.getElementById("aipkit_vs_global_target_select");b&&(b.value=w,b.dispatchEvent(new Event("change")))}}):l==="qdrant"&&window.aipkit_listQdrantCollections(null,!1).then(()=>{if(w){let b=document.getElementById("aipkit_vs_global_target_select");b&&(b.value=w,b.dispatchEvent(new Event("change")))}})}}catch(p){window.aipkit_reportSubmissionError(p,`${l} ${s} submission`,a)}finally{e?t.removeEventListener("click",e):(window.aipkit_setLoadingStateOpenAI(n,!1,c.addContentButton||"Add Content"),n.style.display="inline-flex",t.style.display="none")}}window.aipkit_handleGlobalSubmitDataToStore=r})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_vs_global_submit_data_btn");r?typeof window.aipkit_handleGlobalSubmitDataToStore=="function"?(r.addEventListener("click",window.aipkit_handleGlobalSubmitDataToStore),console.log("AIPKit Submit Init: Global submit button listener attached.")):console.error("AIPKit Submit Init: aipkit_handleGlobalSubmitDataToStore function not found."):console.warn("AIPKit Submit Init: Global submit button (#aipkit_vs_global_submit_data_btn) not found.")}window.aipkit_initGlobalSubmitButton=c})();(function(){"use strict";let c=window.aipkit_dashboard?.text||{};function r(n){let t=n.currentTarget,e=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai",o="aipkit_vs_global_provider_status";if(!e||!t){console.warn("Global Refresh Data: Missing provider slug or refresh button.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"){console.error("Global Refresh Data: Missing required UI helper functions (setLoadingState or showStatus).");return}window.aipkit_setLoadingStateOpenAI(t,!0,"Sync","");let a=Promise.resolve();if(e==="openai"&&typeof window.aipkit_populateGlobalOpenAITargetSelect=="function")a=window.aipkit_populateGlobalOpenAITargetSelect(!0);else if(e==="pinecone"&&typeof window.aipkit_listPineconeIndexes=="function")a=window.aipkit_listPineconeIndexes(null,!1);else if(e==="qdrant"&&typeof window.aipkit_listQdrantCollections=="function")a=window.aipkit_listQdrantCollections(null,!1);else{console.warn(`Global Refresh Data: No specific refresh action defined for provider '${e}'.`),window.aipkit_setLoadingStateOpenAI(t,!1,"Sync");return}a.then(()=>{}).catch(s=>{console.error(`Global Refresh Data: Error refreshing data for ${e}:`,s),window.aipkit_showOpenAIVectorStatus(`Failed to sync ${e} data. ${s.message||""}`,"error",o)}).finally(()=>{window.aipkit_setLoadingStateOpenAI(t,!1,"Sync")})}function i(){let n=document.getElementById("aipkit_vs_global_refresh_data_btn");n?n.dataset.listenerAttached||(n.addEventListener("click",r),n.dataset.listenerAttached="true",console.log("AIPKit AI Training: Global Refresh Button initialized.")):console.warn("AIPKit Global Refresh Button Init: Refresh button (#aipkit_vs_global_refresh_data_btn) not found.")}window.aipkit_initGlobalRefreshButton=i})();(function(){"use strict";function c(){if(!document.getElementById("aipkit_vector_store_management_area")){console.warn("AIPKit Global Form UI Manager: Parent management area not found. Global Form UI not fully initialized.");return}typeof window.aipkit_initGlobalProviderSwitcher=="function"?window.aipkit_initGlobalProviderSwitcher():console.error("AIPKit Global Form UI Init: aipkit_initGlobalProviderSwitcher not found."),typeof window.aipkit_initGlobalTargetHandler=="function"?window.aipkit_initGlobalTargetHandler():console.error("AIPKit Global Form UI Init: aipkit_initGlobalTargetHandler not found."),typeof window.aipkit_initGlobalDataSourceSwitcher=="function"?window.aipkit_initGlobalDataSourceSwitcher():console.error("AIPKit Global Form UI Init: aipkit_initGlobalDataSourceSwitcher not found."),typeof window.aipkit_initGlobalEmbeddingConfig=="function"?window.aipkit_initGlobalEmbeddingConfig():console.error("AIPKit Global Form UI Init: aipkit_initGlobalEmbeddingConfig not found."),typeof window.aipkit_initOpenAIInlineStoreCreator=="function"?window.aipkit_initOpenAIInlineStoreCreator():console.error("AIPKit Global Form UI Init: aipkit_initOpenAIInlineStoreCreator not found.");let i=document.getElementById("aipkit_vs_load_wp_content_btn");i&&typeof window.aipkit_fetchWordPressContentForTraining=="function"?i.dataset.listenerAttached||(i.addEventListener("click",()=>window.aipkit_fetchWordPressContentForTraining(1)),i.dataset.listenerAttached="true"):i&&console.error("AIPKit Global Form UI Init: aipkit_fetchWordPressContentForTraining not found for WP Content button."),typeof window.aipkit_initGlobalSubmitButton=="function"?window.aipkit_initGlobalSubmitButton():console.error("AIPKit Global Form UI Init: aipkit_initGlobalSubmitButton function not found."),typeof window.aipkit_initGlobalRefreshButton=="function"?window.aipkit_initGlobalRefreshButton():console.error("AIPKit Global Form UI Init: aipkit_initGlobalRefreshButton function not found."),console.log("AIPKit Global Form UI Manager: Orchestrator Initialized (Modular Structure).")}window.aipkit_initGlobalFormUIManager=c})();(function(){"use strict";async function c(){console.log("AIPKit AI Training: Main Initializer (ai-training-main.js) starting..."),typeof window.aipkit_initGlobalFormUIManager=="function"?window.aipkit_initGlobalFormUIManager():console.error("AIPKit AI Training Main: aipkit_initGlobalFormUIManager function not found. Global 'Add Content' form UI will not function correctly."),console.log("AIPKit AI Training: Main Initializer (ai-training-main.js) finished.")}window.aipkit_initAiTraining=c})();(function(){"use strict";let c=1,r={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"knowledge_base",label:"Context"},{id:"seo",label:"SEO"},{id:"images",label:"Images"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",prompts:"task_config_ai",knowledge_base:"task_config_knowledge_base",seo:"task_config_seo",images:"task_form_image_settings",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"knowledge_base",label:"Context"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",knowledge_base:"task_config_enhancement_knowledge_base",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function i(){let o=document.querySelectorAll(".aipkit_wizard_step"),a=document.querySelector(".aipkit_wizard_content_container"),s=document.getElementById("aipkit_wizard_prev_btn"),l=document.getElementById("aipkit_wizard_next_btn"),d=document.getElementById("aipkit_save_task_btn");if(!o.length||!a)return;let p="";o.forEach(_=>{let u=parseInt(_.dataset.step,10);_.classList.remove("aipkit_active","aipkit_completed"),u<c?_.classList.add("aipkit_completed"):u===c&&(_.classList.add("aipkit_active"),p=_.dataset.contentId)}),console.log(`[Wizard] Updating UI for step ${c}. Activating content pane with ID: '${p}'.`),a.querySelectorAll(".aipkit_wizard_content_step").forEach(_=>{(_.dataset.contentId||"")===p?(_.style.display="block",_.classList.add("aipkit_active")):(_.style.display="none",_.classList.remove("aipkit_active"))}),s&&(s.style.display=c>1?"inline-flex":"none"),l&&(l.style.display=c<o.length?"inline-flex":"none"),d&&(d.style.display=c===o.length?"inline-flex":"none")}function n(o){let a=document.querySelectorAll(".aipkit_wizard_step").length;c=Math.max(1,Math.min(o,a||1)),i()}function t(){let o=document.querySelector(".aipkit_wizard_nav");if(!o)return;let a="data-nav-listener-attached";if(o.getAttribute(a))return;let s=document.getElementById("aipkit_wizard_prev_btn"),l=document.getElementById("aipkit_wizard_next_btn");if(!s||!l){console.warn("Wizard Nav: Previous or Next button not found.");return}s.addEventListener("click",()=>{typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),n(c-1)}),l.addEventListener("click",()=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),l.dataset.action==="upgrade"){let d=window.aipkit_dashboard?.upgradeUrl;d?window.open(d,"_blank"):console.error("Upgrade URL not found.");return}if(typeof window.aipkit_form_validateWizardStep=="function"){let d=window.aipkit_form_validateWizardStep(c);if(d!==!0){typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(d,"error");return}}n(c+1)}),o.setAttribute(a,"true"),console.log("AIPKit AutoGPT: Wizard Navigation Re-initialized.")}function e(o){let a=document.querySelector(".aipkit_wizard_steps");if(!a)return;a.innerHTML="";let s="content_writing";o==="content_indexing"?s="content_indexing":o==="community_reply_comments"?s="community_reply_comments":o==="enhance_existing_content"&&(s="enhance_existing_content");let l=window.aipkit_wizardConfig[s];if(!l){console.warn(`No wizard configuration found for task type: ${o}`);return}l.steps.forEach((d,p)=>{let _=p+1,u=document.createElement("div");u.className="aipkit_wizard_step",u.dataset.step=_,u.dataset.contentId=l.contentMap[d.id],u.innerHTML=`
                <div class="aipkit_step_indicator_circle">${_}</div>
                <span>${d.label}</span>
            `,a.appendChild(u)}),typeof window.aipkit_initWizardNavigation=="function"&&window.aipkit_initWizardNavigation(),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_renderWizard=e,window.aipkit_initWizardNavigation=t,window.aipkit_resetWizard=()=>n(1),window.aipkit_wizardConfig=r})();(function(){"use strict";function c(r){let i=window.aipkit_automated_tasks_config||{},n=i.text||{},t=window.aipkit_escapeHtml||function(s){return s},e=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!e)return Promise.resolve();e.innerHTML=`<option value="">${t(n.loading_stores||"Loading...")}</option>`,e.disabled=!0;let o=[],a=n.select_target_store||"-- Select Target Store --";return r==="openai"&&i.openai_vector_stores?o=i.openai_vector_stores:r==="pinecone"&&i.pinecone_indexes?(o=i.pinecone_indexes,a=n.select_target_index||"-- Select Target Index --"):r==="qdrant"&&i.qdrant_collections&&(o=i.qdrant_collections,a=n.select_target_collection||"-- Select Target Collection --"),e.innerHTML=`<option value="">${t(a)}</option>`,o&&Array.isArray(o)&&o.length>0?(o.forEach(s=>{let l=s.id||s.name,d=s.name||s.id,p=t(d);r==="openai"&&s.file_counts?.total!==void 0?p+=` (Files: ${s.file_counts.total})`:r==="pinecone"&&s.dimension!==void 0&&(p+=` (Dim: ${s.dimension})`),e.appendChild(new Option(p,l))}),e.disabled=!1):(e.appendChild(new Option(t(n.no_targets_found_configure||`No ${r} targets found. Configure in AI Training.`),"")),e.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=c})();(function(){"use strict";function c(){let r=window.aipkit_automated_tasks_config||{},i=r.text||{},n=window.aipkit_escapeHtml||function(d){return d},t=document.getElementById("aipkit_task_content_indexing_embedding_model"),e=window.aipkit_automated_tasks_form_state||{},o=e.pendingEmbeddingModelSelection;if(!t)return Promise.resolve();t.innerHTML=`<option value="">${n(i.select_embedding_model||"-- Select Model --")}</option>`;let a=r.openai_embedding_models||[],s=r.google_embedding_models||[],l=(d,p,_)=>{let u=document.createElement("optgroup");return u.label=n(d),p&&p.length>0&&p.forEach(f=>{let m=`${_}:${f.id}`;u.appendChild(new Option(n(f.name||f.id),m))}),u};if(t.appendChild(l("OpenAI",a,"openai")),t.appendChild(l("Google",s,"google")),t.disabled=a.length===0&&s.length===0,t.disabled&&(t.innerHTML=`<option value="">${n(i.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),o&&t.querySelector(`option[value="${CSS.escape(o)}"]`))t.value=o,e.pendingEmbeddingModelSelection=null;else if(t.options.length>1){let d=t.querySelector("optgroup");d&&d.options.length>0&&(t.value=d.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=c})();(function(){"use strict";function c(r){let i=r.target.value,n=document.getElementById("aipkit_task_content_indexing_embedding_model_group");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(i):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),n){let t=i==="pinecone"||i==="qdrant";n.style.display=t?"block":"none",t&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_task_config_content_indexing");if(!r)return;let i=r.querySelector("#aipkit_task_content_indexing_target_store_provider");i&&(typeof window.aipkit_handleTargetStoreProviderChange=="function"?(i.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:i})):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found.")),console.log("AIPKit Automated Tasks: Content Indexing UI Handler Initialized.")}window.aipkit_initContentIndexingTaskFormUI=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};function r(i,n){let t=i.value,e=t?t.toLowerCase():"",o=window.aipkit_dashboard?.models,a=window.aipkit_automated_tasks_form_state||{};if(!n)return;if(!o){n.innerHTML=`<option value="">${c("Error: Model data object not found")}</option>`,n.disabled=!0;return}let s=o[e],l=a.pendingModelSelection||n.value;if(n.innerHTML="",e==="openai"&&typeof s=="object"&&!Array.isArray(s)?Object.keys(s).forEach(d=>{let p=document.createElement("optgroup");p.label=c(d),Array.isArray(s[d])&&s[d].forEach(_=>{_&&_.id&&p.appendChild(new Option(c(_.name||_.id),_.id))}),n.appendChild(p)}):Array.isArray(s)&&s.forEach(d=>{d&&d.id&&n.appendChild(new Option(c(d.name||d.id),d.id))}),n.options.length===0)n.appendChild(new Option(c(`No models for ${t}`),"")),n.disabled=!0;else{n.disabled=!1;let d=!1;if(l&&n.querySelector(`option[value="${CSS.escape(l)}"]`)&&(n.value=l,d=!0),!d&&n.options.length>0){let p=n.querySelector('option:not([value=""])');p&&(n.value=p.value)}}a&&(a.pendingModelSelection=null)}window.aipkit_task_cw_populateModels=r})();(function(){"use strict";function c(r){if(!r)return;let i=r.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");i&&(i.textContent=r.value,r.dataset.listenerAttached||(r.addEventListener("input",()=>i.textContent=r.value),r.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=c})();(function(){"use strict";function c(r){if(!r)return;let i=r.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");i&&(i.textContent=r.value,r.dataset.listenerAttached||(r.addEventListener("input",()=>i.textContent=r.value),r.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=c})();(function(){"use strict";function c(r){let i=r.target,n=i.closest(".aipkit_wizard_content_step");if(!n)return;let t=n.querySelector("#aipkit_task_cw_schedule_options_wrapper"),e=n.querySelector("#aipkit_task_cw_smart_schedule_fields"),o=n.querySelector(".aipkit_task_schedule_from_input_option"),a=n.querySelector(".aipkit_task_schedule_from_input_help");if(!t)return;let s=i.value==="publish";t.style.display=s?"block":"none";let l=document.getElementById("aipkit_automated_task_type");if(o){let _=l&&l.value==="content_writing_rss";if(o.style.display=_?"none":"inline-flex",_){let u=o.querySelector('input[name="schedule_mode"][value="from_input"]');if(u&&u.checked){let f=n.querySelector('input[name="schedule_mode"][value="immediate"]');f&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))}}}n.querySelectorAll('input[name="schedule_mode"]').forEach(_=>{_.dataset.listenerAttached||(_.addEventListener("change",function(){if(e&&(e.style.display=this.value==="smart"?"block":"none"),a){let u=l&&l.value==="content_writing_rss";a.style.display=this.value==="from_input"&&!u?"block":"none"}}),_.dataset.listenerAttached="true")});let p=n.querySelector('input[name="schedule_mode"]:checked');if(p&&e&&(e.style.display=p.value==="smart"?"block":"none"),p&&a){let _=l&&l.value==="content_writing_rss";a.style.display=p.value==="from_input"&&!_?"block":"none"}}window.aipkit_toggleTaskCwScheduleFields=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||(t=>t);function r(t,e){let o=e.querySelector(".aipkit_task_cw_vector_openai_field"),a=e.querySelector(".aipkit_task_cw_vector_pinecone_field"),s=e.querySelector(".aipkit_task_cw_vector_qdrant_field"),l=e.querySelector(".aipkit_task_cw_vector_embedding_config_row");o&&(o.style.display="none"),a&&(a.style.display="none"),s&&(s.style.display="none"),l&&(l.style.display="none"),t==="openai"&&o?o.style.display="block":t==="pinecone"&&a&&l?(a.style.display="block",l.style.display="block"):t==="qdrant"&&s&&l&&(s.style.display="block",l.style.display="block")}function i(t){let e=t.querySelector("#aipkit_task_cw_vector_embedding_model");if(!e)return;let o=window.aipkit_automated_tasks_config||{},a=o.openai_embedding_models||[],s=o.google_embedding_models||[];e.innerHTML=`<option value="">${c("-- Select Model --")}</option>`;let l=document.createElement("optgroup");l.label="OpenAI",a.forEach(p=>l.appendChild(new Option(c(p.name),p.id))),e.appendChild(l);let d=document.createElement("optgroup");d.label="Google",s.forEach(p=>d.appendChild(new Option(c(p.name),p.id))),e.appendChild(d)}function n(){let t=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_knowledge_base"]');if(!t||t.dataset.kbListenerAttached)return;let e=t.querySelector(".aipkit_task_cw_vector_store_toggle"),o=t.querySelector(".aipkit_task_cw_vector_store_settings_container"),a=t.querySelector(".aipkit_task_cw_vector_store_provider_select"),s=t.querySelector(".aipkit_task_cw_vector_embedding_provider_select");e&&o&&e.addEventListener("change",()=>{o.style.display=e.checked?"block":"none"}),a&&o&&(a.addEventListener("change",()=>r(a.value,o)),r(a.value,o)),s&&s.addEventListener("change",()=>{i(o)}),o&&i(o),t.dataset.kbListenerAttached="true",console.log("AIPKit AutoGPT: Knowledge Base UI Handler Initialized.")}window.aipkit_initCwKnowledgeBaseUI=n})();(function(){"use strict";function c(){console.log("AIPKit AutoGPT: Initializing Content Writing Task Form UI...");let n=document.getElementById("aipkit_automated_task_form");if(!n){console.warn("Content Writing UI Init: Could not find main form element.");return}let t=n.querySelector("#aipkit_task_cw_ai_provider"),e=n.querySelector("#aipkit_task_cw_ai_model");t&&e&&typeof window.aipkit_task_cw_populateModels=="function"&&(t.dataset.cwProviderListenerAttached||(t.addEventListener("change",()=>window.aipkit_task_cw_populateModels(t,e)),t.dataset.cwProviderListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(t,e));let o=n.querySelector("#aipkit_task_cw_ai_temperature");o&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(o);let a=n.querySelector("#aipkit_task_cw_content_max_tokens");a&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(a);let s=n.querySelector("#aipkit_task_cw_post_status");s&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(s.dataset.cwStatusListenerAttached||(s.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),s.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:s}));let l=n.querySelector("#aipkit_task_cw_generate_meta_desc"),d=n.querySelector(".aipkit_task_cw_custom_meta_prompt"),p=n.querySelector("#aipkit_task_cw_generate_focus_keyword"),_=n.querySelector(".aipkit_task_cw_custom_keyword_prompt"),u=n.querySelector("#aipkit_task_cw_generate_excerpt"),f=n.querySelector(".aipkit_task_cw_custom_excerpt_prompt"),m=n.querySelector("#aipkit_task_cw_generate_tags"),g=n.querySelector(".aipkit_task_cw_custom_tags_prompt"),k=()=>{d&&(d.style.display=l?.checked?"block":"none"),_&&(_.style.display=p?.checked?"block":"none"),f&&(f.style.display=u?.checked?"block":"none"),g&&(g.style.display=m?.checked?"block":"none")};l&&(l.dataset.cwSeoListenerAttached||(l.addEventListener("change",k),l.dataset.cwSeoListenerAttached="true")),p&&(p.dataset.cwSeoListenerAttached||(p.addEventListener("change",k),p.dataset.cwSeoListenerAttached="true")),u&&(u.dataset.cwSeoListenerAttached||(u.addEventListener("change",k),u.dataset.cwSeoListenerAttached="true")),m&&(m.dataset.cwSeoListenerAttached||(m.addEventListener("change",k),m.dataset.cwSeoListenerAttached="true")),k(),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let b=n.querySelector(".aipkit_task_cw_image_enable_toggle");b&&(b.dataset.cwImgListenerAttached||(b.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),b.dataset.cwImgListenerAttached="true"));let y=n.querySelector("#aipkit_task_cw_image_provider");y&&(y.dataset.cwImgListenerAttached||(y.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),y.dataset.cwImgListenerAttached="true"));let h=n.querySelector("#aipkit_task_cw_generate_featured_image");h&&(h.dataset.cwImgListenerAttached||(h.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),h.dataset.cwImgListenerAttached="true"));let v=n.querySelector(".aipkit_task_cw_image_placement_select");v&&(v.dataset.cwImgListenerAttached||(v.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),v.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100)),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let S=n.querySelector("#aipkit_task_cw_ai_settings_toggle"),I=n.querySelector("#aipkit_task_cw_ai_parameters_row");S&&I&&(S.dataset.cwAiSettingsListenerAttached||(S.addEventListener("click",()=>{let T=I.style.display==="none"||I.style.display==="";I.style.display=T?"block":"none",S.classList.toggle("aipkit_active",T),S.setAttribute("aria-expanded",T)}),S.dataset.cwAiSettingsListenerAttached="true"));let E=n.querySelector("#aipkit_task_config_ai");E&&(E.dataset.cwPromptListenerAttached||(E.addEventListener("click",T=>{let x=T.target.closest(".aipkit_textarea_toggle");if(!x)return;let A=x.dataset.target,C=document.getElementById(A),q=x.querySelector(".dashicons");if(!C||!q)return;C.classList.toggle("aipkit_collapsed")?(q.classList.remove("dashicons-minus"),q.classList.add("dashicons-plus-alt2"),x.title="Expand"):(q.classList.remove("dashicons-plus-alt2"),q.classList.add("dashicons-minus"),x.title="Collapse")}),E.dataset.cwPromptListenerAttached="true"));let P=n.querySelector("#aipkit_task_config_seo");P&&(P.dataset.cwSeoPromptListenerAttached||(P.addEventListener("click",T=>{let x=T.target.closest(".aipkit_textarea_toggle");if(!x)return;let A=x.dataset.target,C=document.getElementById(A),q=x.querySelector(".dashicons");if(!C||!q)return;C.classList.toggle("aipkit_collapsed")?(q.classList.remove("dashicons-minus"),q.classList.add("dashicons-plus-alt2"),x.title="Expand"):(q.classList.remove("dashicons-plus-alt2"),q.classList.add("dashicons-minus"),x.title="Collapse")}),P.dataset.cwSeoPromptListenerAttached="true"))}function r(){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let t=window.aipkit_debug||!1,e=n.querySelector(".aipkit_task_cw_image_enable_toggle"),o=n.querySelector("#aipkit_task_cw_generate_featured_image"),a=n.querySelector(".aipkit_task_cw_image_settings_container"),s=n.querySelector("#aipkit_task_cw_image_provider");if(!e||!o||!a||!s)return;let l=e.checked,d=o.checked,p=l||d,_=s.value,u=_==="pexels"||_==="pixabay";if(t&&console.log("AIPKit Image Settings Update:",{inContentEnabled:l,featuredEnabled:d,shouldShowContainer:p,selectedProvider:_,isStockProvider:u}),a.style.display=p?"block":"none",p){let f=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],m=n.querySelector("#aipkit_task_cw_image_prompt")?.closest(".aipkit_form-group"),g=n.querySelector(".aipkit_task_cw_featured_image_prompt_field"),k=n.querySelector(".aipkit_task_cw_image_placement_select"),w=n.querySelector(".aipkit_task_cw_image_placement_x_field"),b=n.querySelector("#aipkit_task_cw_pexels_options"),y=n.querySelector("#aipkit_task_cw_pixabay_options"),h=n.querySelector("#aipkit_task_cw_image_model_group");if(f.forEach(v=>{let S=n.querySelector(v);if(S){let I=S.closest(".aipkit_form-group");I&&(I.style.display=l?"block":"none")}}),k&&w){let v=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(k.value);w.style.display=l&&v?"block":"none"}m&&(m.style.display=l&&!u?"block":"none"),g&&(g.style.display=d&&!u?"block":"none"),b&&(b.style.display=p&&u&&_==="pexels"?"flex":"none"),y&&(y.style.display=p&&u&&_==="pixabay"?"flex":"none"),h&&(h.style.display=p&&!u?"block":"none"),p&&!u&&typeof i=="function"&&i(_)}}function i(n){let t=document.getElementById("aipkit_task_cw_image_model");if(!t)return;let o=window.aipkit_dashboard?.imageGeneratorModels?.[n.toLowerCase()]||[],a=window.aipkit_escapeHtml||function(l){return l},s=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||t.value;t.innerHTML="",o.length>0?(o.forEach(l=>{t.appendChild(new Option(a(l.name),l.id))}),t.querySelector(`option[value="${CSS.escape(s)}"]`)&&(t.value=s)):t.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null)}window.aipkit_updateTaskImageSettingsUI=r,window.aipkit_initContentWritingTaskFormUI=c})();(function(){"use strict";function c(){console.log("AIPKit AutoGPT: Initializing Comment Reply Task Form UI...");let r=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!r)return;let i=r.querySelector("#aipkit_task_cc_ai_provider"),n=r.querySelector("#aipkit_task_cc_ai_model");i&&n&&typeof window.aipkit_task_cw_populateModels=="function"&&(i.dataset.ccProviderListenerAttached||(i.addEventListener("change",()=>window.aipkit_task_cw_populateModels(i,n)),i.dataset.ccProviderListenerAttached="true"),window.aipkit_task_cw_populateModels(i,n));let t=r.querySelector("#aipkit_task_cc_ai_temperature");t&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(t);let e=r.querySelector("#aipkit_task_cc_content_max_tokens");e&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(e);let o=r.querySelector("#aipkit_task_cc_ai_settings_toggle"),a=r.querySelector("#aipkit_task_cc_ai_parameters_row");o&&a&&(o.dataset.ccAiSettingsListenerAttached||(o.addEventListener("click",()=>{let s=a.style.display==="none"||a.style.display==="";a.style.display=s?"block":"none",o.classList.toggle("aipkit_active",s),o.setAttribute("aria-expanded",s)}),o.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=c})();(function(){"use strict";function c(r,i){let n=document.getElementById("aipkit_automated_task_form_title"),t=r.querySelector("#aipkit_save_task_btn"),e=t?t.querySelector(".aipkit_btn-text"):null,o=r.elements.task_id,a=r.elements.task_name,s=r.elements.task_type,l=r.elements.task_status,d=document.getElementById("aipkit_cancel_edit_task_btn"),_=(window.aipkit_automated_tasks_config||{}).text||{};i?(n&&(n.textContent=_.edit_task_title||"Edit Automated Task"),e&&(e.textContent=_.save_task_button||"Save Task"),o&&(o.value=i.id||""),a&&(a.value=i.task_name||""),s&&(s.value=i.task_type||"content_indexing"),l&&(l.value=i.status||"active"),d&&(d.style.display="inline-flex")):(n&&(n.textContent=_.create_task_title||"Create New Automated Task"),e&&(e.textContent=_.create_task_button||"Create Task"),o&&(o.value=""),a&&(a.value=""),s&&(s.value="content_indexing"),l&&(l.value="active"),d&&(d.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};function r(i){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let t=n.elements["post_types[]"];t&&(Array.from(t.options).forEach(o=>o.selected=!1),(i.post_types||[]).forEach(o=>{let a=t.querySelector(`option[value="${c(o)}"]`);a&&(a.selected=!0)}));let e=n.elements.target_store_provider;e&&(e.value=i.target_store_provider||"openai"),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(i.target_store_provider||"openai").then(()=>{let o=n.elements.target_store_id;o&&(o.value=i.target_store_id||"")}),n.elements.index_existing_now_flag&&(n.elements.index_existing_now_flag.checked=i.index_existing_now_flag==="1"),n.elements.only_new_updated_flag&&(n.elements.only_new_updated_flag.checked=i.only_new_updated_flag==="1"),(i.target_store_provider==="pinecone"||i.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&i.embedding_provider&&i.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${i.embedding_provider}:${i.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),n.elements.task_frequency&&(n.elements.task_frequency.value=i.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=r})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};function r(i){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let t=i.cw_generation_mode||"bulk";if(t==="bulk"||t==="single"||t==="task"){let y=n.elements.content_title_bulk;y&&(y.value=i.content_title||"")}else if(t==="csv"){let y=n.elements.content_title;y&&(y.value=i.content_title||"")}else if(t==="rss")n.elements.rss_feeds&&(n.elements.rss_feeds.value=i.rss_feeds||""),n.elements.rss_include_keywords&&(n.elements.rss_include_keywords.value=i.rss_include_keywords||""),n.elements.rss_exclude_keywords&&(n.elements.rss_exclude_keywords.value=i.rss_exclude_keywords||"");else if(t==="url")n.elements.url_list&&(n.elements.url_list.value=i.url_list||"");else if(t==="gsheets"){let y=n.elements.gsheets_credentials;if(y){let h=i.gsheets_credentials,v=y.closest(".aipkit_gsheets_section_container");typeof h=="object"&&h!==null?y.value=JSON.stringify(h,null,2):y.value=h||"",y.value?(y.dataset.filename="credentials.json",v&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(v),100)):(delete y.dataset.filename,v&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(v,"clear"))}n.elements.gsheets_sheet_id&&(n.elements.gsheets_sheet_id.value=i.gsheets_sheet_id||"")}n.elements.custom_title_prompt&&(n.elements.custom_title_prompt.value=i.custom_title_prompt||""),n.elements.custom_content_prompt&&(n.elements.custom_content_prompt.value=i.custom_content_prompt||"");let e=document.getElementById("aipkit_task_cw_ai_provider"),o=document.getElementById("aipkit_task_cw_ai_model");e&&(e.value=i.ai_provider?i.ai_provider.toLowerCase():"openai",i.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=i.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&o&&window.aipkit_task_cw_populateModels(e,o));let a=document.getElementById("aipkit_task_cw_ai_temperature");if(a){a.value=i.ai_temperature||"1.0";let y=document.getElementById("aipkit_task_cw_ai_temperature_value");y&&(y.textContent=a.value)}let s=document.getElementById("aipkit_task_cw_content_max_tokens");if(s){s.value=i.content_max_tokens||"1500";let y=document.getElementById("aipkit_task_cw_content_max_tokens_value");y&&(y.textContent=s.value)}n.elements.generate_meta_description&&(n.elements.generate_meta_description.checked=i.generate_meta_description==="1"),n.elements.custom_meta_prompt&&(n.elements.custom_meta_prompt.value=i.custom_meta_prompt||""),n.elements.generate_focus_keyword&&(n.elements.generate_focus_keyword.checked=i.generate_focus_keyword==="1"),n.elements.custom_keyword_prompt&&(n.elements.custom_keyword_prompt.value=i.custom_keyword_prompt||""),n.elements.generate_excerpt&&(n.elements.generate_excerpt.checked=i.generate_excerpt==="1"),n.elements.custom_excerpt_prompt&&(n.elements.custom_excerpt_prompt.value=i.custom_excerpt_prompt||""),n.elements.generate_tags&&(n.elements.generate_tags.checked=i.generate_tags==="1"),n.elements.custom_tags_prompt&&(n.elements.custom_tags_prompt.value=i.custom_tags_prompt||""),n.elements.generate_toc&&(n.elements.generate_toc.checked=i.generate_toc==="1"),n.elements.generate_seo_slug&&(n.elements.generate_seo_slug.checked=i.generate_seo_slug==="1"),n.elements.post_type&&(n.elements.post_type.value=i.post_type||"post");let l=n.elements.post_author;l&&(l.value=i.post_author||window.aipkit_dashboard?.currentUserId||"1");let d=document.getElementById("aipkit_task_cw_post_status");d&&(d.value=i.post_status||"draft");let p=i.schedule_mode||"immediate",_=n.querySelector(`input[name="schedule_mode"][value="${p}"]`);_&&(_.checked=!0),n.elements.smart_schedule_start_datetime&&(n.elements.smart_schedule_start_datetime.value=i.smart_schedule_start_datetime||""),n.elements.smart_schedule_interval_value&&(n.elements.smart_schedule_interval_value.value=i.smart_schedule_interval_value||"1"),n.elements.smart_schedule_interval_unit&&(n.elements.smart_schedule_interval_unit.value=i.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:d});let u=document.getElementById("aipkit_task_cw_post_categories");u&&u.options&&(Array.from(u.options).forEach(h=>h.selected=!1),(Array.isArray(i.post_categories)?i.post_categories.map(String):[]).forEach(h=>{let v=u.querySelector(`option[value="${c(h)}"]`);v&&(v.selected=!0)})),n.elements.generate_images_enabled&&(n.elements.generate_images_enabled.checked=i.generate_images_enabled==="1"),n.elements.image_provider&&(n.elements.image_provider.value=(i.image_provider||"openai").toLowerCase()),n.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=i.image_model),n.elements.image_prompt&&(n.elements.image_prompt.value=i.image_prompt||""),n.elements.image_count&&(n.elements.image_count.value=i.image_count||"1"),n.elements.image_placement&&(n.elements.image_placement.value=i.image_placement||"after_first_h2"),n.elements.image_alignment&&(n.elements.image_alignment.value=i.image_alignment||"none"),n.elements.generate_featured_image&&(n.elements.generate_featured_image.checked=i.generate_featured_image==="1"),n.elements.featured_image_prompt&&(n.elements.featured_image_prompt.value=i.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let f=n.querySelector('input[name="enable_vector_store"]');f&&(f.checked=i.enable_vector_store==="1");let m=n.querySelector("#aipkit_task_cw_vector_store_provider");m&&(m.value=i.vector_store_provider||"openai");let g=n.querySelector("#aipkit_task_cw_vector_store_top_k");g&&(g.value=i.vector_store_top_k||"3");let k=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(k&&k.options){let y=Array.isArray(i.openai_vector_store_ids)?i.openai_vector_store_ids.map(String):[];Array.from(k.options).forEach(h=>{h.selected=y.includes(h.value)})}let w=document.getElementById("aipkit_task_cw_pinecone_index_name");w&&(w.value=i.pinecone_index_name||"");let b=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(b&&(b.value=i.qdrant_collection_name||""),i.vector_store_provider==="pinecone"||i.vector_store_provider==="qdrant"){let y=document.getElementById("aipkit_task_cw_vector_embedding_provider");y&&(y.value=i.vector_embedding_provider||"openai"),window.aipkit_automated_tasks_form_state&&i.vector_embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=i.vector_embedding_model)}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),n.elements.task_frequency&&(n.elements.task_frequency.value=i.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=r})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let n=document.getElementById("aipkit_task_cc_ai_provider"),t=document.getElementById("aipkit_task_cc_ai_model");n&&t&&(n.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&r.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(n,t));let e=document.getElementById("aipkit_task_cc_ai_temperature");if(e){e.value=r.ai_temperature||1;let u=document.getElementById(e.id+"_value");u&&(u.textContent=e.value)}let o=document.getElementById("aipkit_task_cc_content_max_tokens");if(o){o.value=r.content_max_tokens||250;let u=document.getElementById(o.id+"_value");u&&(u.textContent=o.value)}let a=document.getElementById("aipkit_task_cc_custom_content_prompt");a&&(a.value=r.custom_content_prompt||"");let s=document.getElementById("aipkit_task_comment_reply_include_keywords");s&&(s.value=r.include_keywords||"");let l=document.getElementById("aipkit_task_comment_reply_exclude_keywords");l&&(l.value=r.exclude_keywords||"");let d=i.elements["post_types_for_comments[]"];d&&(Array.from(d.options).forEach(u=>u.selected=!1),(r.post_types_for_comments||[]).forEach(u=>{let f=d.querySelector(`option[value="${u}"]`);f&&(f.selected=!0)}));let p=i.elements.reply_action;p&&(p.value=r.reply_action||"approve");let _=i.elements.no_reply_to_replies;_&&(_.checked=r.no_reply_to_replies==="1"),i.elements.task_frequency&&(i.elements.task_frequency.value=r.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=c})();(function(){"use strict";function c(){console.log("AutoGPT: Setting Content Writing defaults for new task.");let r=document.getElementById("aipkit_automated_task_form"),i=window.aipkit_automated_tasks_config||{},n=window.aipkit_dashboard||{},t=i.default_cw_prompts||{};if(!r)return;r.elements.custom_title_prompt&&(r.elements.custom_title_prompt.value=t.title||""),r.elements.custom_content_prompt&&(r.elements.custom_content_prompt.value=t.content||""),r.elements.custom_meta_prompt&&(r.elements.custom_meta_prompt.value=t.meta||""),r.elements.custom_keyword_prompt&&(r.elements.custom_keyword_prompt.value=t.keyword||""),r.elements.image_prompt&&(r.elements.image_prompt.value=t.image||""),r.elements.featured_image_prompt&&(r.elements.featured_image_prompt.value=t.featured_image||"");let e=document.getElementById("aipkit_task_cw_ai_provider"),o=document.getElementById("aipkit_task_cw_ai_model");if(e&&o){let a=(n.main_provider||"openai").toLowerCase();if(e.value=a,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(e,o);let s="",l=n?.models?.[a];switch(a){case"openai":s="gpt-4.1-mini";break;case"google":s="gemini-1.5-flash-latest";break;case"openrouter":s="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":Array.isArray(l)&&l.length>0&&(s=l[0].id||"");break}o.querySelector(`option[value="${CSS.escape(s)}"]`)?o.value=s:console.warn(`Default model ${s} not found for provider ${a}.`)}}r.elements.generate_images_enabled&&(r.elements.generate_images_enabled.checked=!1),r.elements.image_provider&&(r.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{r.elements.image_model&&(r.elements.image_model.value="gpt-image-1")},0)),r.elements.image_count&&(r.elements.image_count.value="1"),r.elements.image_placement&&(r.elements.image_placement.value="after_first_h2"),r.elements.generate_featured_image&&(r.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=c})();(function(){"use strict";function c(){console.log("AutoGPT: Setting Comment Reply defaults for new task.");let r=document.getElementById("aipkit_automated_task_form"),i=window.aipkit_dashboard||{};if(!r)return;let n=document.getElementById("aipkit_task_cc_custom_content_prompt");n&&(n.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let t=document.getElementById("aipkit_task_cc_ai_provider"),e=document.getElementById("aipkit_task_cc_ai_model");if(t&&e){let o=(i.main_provider||"openai").toLowerCase();if(t.value=o,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(t,e);let a="",s=(i.models||{})[o]||{};switch(o){case"openai":a="gpt-4o-mini";break;case"google":a="gemini-1.5-flash-latest";break;case"openrouter":a="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":Array.isArray(s)&&s.length>0&&(a=s[0].id||"");break}e.querySelector(`option[value="${CSS.escape(a)}"]`)&&(e.value=a)}}}window.aipkit_form_setCommentReplyDefaults=c})();(function(){"use strict";function c(r,i,n,t=null){let e=document.getElementById("aipkit_automated_task_form"),o=document.getElementById("aipkit_automated_task_queue_wrapper");if(!e){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),e.reset(),e.elements.task_id&&(e.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),t){let l=((window.aipkit_automated_tasks_config||{}).task_types||{})[t.task_type];if(l){let d=e.elements.task_category;if(d){d.value=l.category;let p=new Event("change",{bubbles:!0});d.dispatchEvent(p)}}}else{let s=e.elements.task_category,l=e.elements.task_type;s&&l&&(s.value="content_creation",s.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{l.value="content_writing_bulk",l.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(e,t):(console.error("Show Task Form: aipkit_form_populateCommonFields function is missing."),document.getElementById("aipkit_automated_task_form_title").textContent=t?"Edit Task":"Create Task");let a=e.elements.task_type;if(a&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:a}),t){let s=JSON.parse(t.task_config||"{}");t.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(s):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):t.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(s):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):t.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(s):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):t.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(s):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}r&&(r.style.display="block"),i&&(i.style.display="none"),o&&(o.style.display="none"),n&&(n.style.display="none")}window.aipkit_form_showAutomatedTaskForm=c})();(function(){"use strict";function c(r,i,n){let t=document.getElementById("aipkit_automated_task_queue_wrapper");r&&(r.style.display="none"),i&&(i.style.display="block"),t&&(t.style.display="block"),n&&(n.style.display="inline-flex");let e=document.getElementById("aipkit_automated_task_form"),o=document.getElementById("aipkit_automated_task_id"),a=document.getElementById("aipkit_automated_task_category");e&&e.reset(),o&&(o.value=""),a&&(a.value="",a.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=c})();(function(){"use strict";function c(n,t){let e=document.getElementById(n),o=window.aipkit_escapeHtml||function(p){return p};if(!e)return;let a=t.startsWith("content_writing_")?t.replace("content_writing_",""):"bulk",s=["{topic}","{keywords}"];a==="rss"?(s.push("{description}"),s.push("{source_url}")):a==="url"&&s.push("{url_content}");let d=("Use placeholders: "+s.join(", ")+".").replace(/(\{[a-zA-Z0-9_]+\})/g,p=>`<code class="aipkit-placeholder" title="Click to copy">${o(p)}</code>`);e.innerHTML=d}function r(n){let t=n.target.value,e=document.getElementById("aipkit_automated_task_type"),o=(window.aipkit_automated_tasks_config||{}).task_types||{},a=window.aipkit_escapeHtml||function(d){return d};e.innerHTML="",e.disabled=!0;let s=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(s&&s.querySelectorAll(".aipkit_task_config_section").forEach(d=>{d.id==="aipkit_task_cw_input_modes_wrapper"&&d.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(p=>{p.style.display="none"}),d.style.display="none"}),!t){e.appendChild(new Option(a("-- Select a category first --"),"")),e.dispatchEvent(new Event("change",{bubbles:!0}));return}let l=Object.entries(o).filter(([d,p])=>p.category===t);l.length===0?e.appendChild(new Option(a("-- No tasks in this category --"),"")):(e.appendChild(new Option(a("-- Select a Task Type --"),"")),l.forEach(([d,p])=>{let _=new Option(a(p.label),d);p.disabled&&(_.disabled=!0),e.appendChild(_)}),e.disabled=!1),t==="knowledge_base"?e.value="content_indexing":t==="community_engagement"?e.value="community_reply_comments":t==="content_enhancement"&&(e.value="enhance_existing_content"),e.dispatchEvent(new Event("change",{bubbles:!0}))}function i(n){let t=n.target.value,e=document.getElementById("aipkit_automated_task_id"),o=!e||!e.value,a=document.getElementById("aipkit_wizard_next_btn"),s=a?a.querySelector(".aipkit_btn-text"):null,l=document.getElementById("aipkit_save_task_btn"),d=l?l.querySelector(".aipkit_btn-text"):null,p=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,u=((window.aipkit_automated_tasks_config||{}).task_types||{})[t],f=u&&u.pro===!0,m=(window.aipkit_automated_tasks_config||{}).text||{};if(f&&!p)s&&a&&(a.dataset.action="upgrade",s.textContent="Upgrade to Pro"),d&&l&&(l.dataset.action="upgrade",d.textContent="Upgrade to Pro");else if(s&&a&&(a.dataset.action="next",s.textContent=m.wizard_next_button||"Next"),d&&l){l.dataset.action="save";let h=e&&e.value;d.textContent=h?m.save_task_button||"Save Task":m.create_task_button||"Create Task"}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(t):console.error("Task Type Change: aipkit_renderWizard function is missing.");let g=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!g){console.error("Task Type Change: Could not find setup pane.");return}let k=g.querySelector("#aipkit_task_ci_source_wrapper"),w=g.querySelector("#aipkit_task_cw_input_modes_wrapper"),b=g.querySelector("#aipkit_task_cc_source_wrapper"),y=g.querySelector("#aipkit_task_ce_content_selection_wrapper");if(k&&(k.style.display="none"),w&&(w.style.display="none"),b&&(b.style.display="none"),y&&(y.style.display="none"),!!t){if(t==="content_indexing")k&&(k.style.display="block");else if(t.startsWith("content_writing")){if(c("aipkit_task_cw_content_prompt_placeholders",t),c("aipkit_task_cw_image_prompt_placeholders",t),w){w.style.display="block";let h=t.replace("content_writing_",""),v=h==="content_writing"?"bulk":h;w.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(S=>{S.id===`aipkit_task_cw_input_mode_${v}`?S.style.display="block":S.style.display="none"})}}else if(t==="community_reply_comments")b&&(b.style.display="block");else if(t==="enhance_existing_content"){y&&(y.style.display="block");let h=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),v=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(h&&v){let S=h.querySelector("#aipkit_task_ce_post_types");if(S&&!S.dataset.placeholderListenerAttached){let I=()=>{let P=Array.from(S.selectedOptions).map(x=>x.value).includes("product");v.querySelectorAll(".aipkit-product-placeholders").forEach(x=>{x.style.display=P?"inline":"none"})};S.addEventListener("change",I),S.dataset.placeholderListenerAttached="true",I()}}}o&&(t.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():t==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():t==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),t==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():t.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():t==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():t==="enhance_existing_content"&&(console.log("[handleTaskTypeChange] Calling initializer for 'enhance_existing_content'."),typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=r,window.aipkit_form_handleTaskTypeChange=i})();(function(){"use strict";function c(r,i="info"){let n=document.getElementById("aipkit_automated_task_form_status");if(n){if(!r){n.textContent="",n.className="aipkit_form-help";return}n.textContent=r,n.className=`aipkit_form-help aipkit_settings_message-${i}`,setTimeout(()=>{n.textContent===r&&(n.textContent="",n.className="aipkit_form-help")},5e3)}}window.aipkit_form_showAutomatedTaskFormStatus=c})();(function(){"use strict";function c(r){let i=new FormData(r),n=Object.fromEntries(i.entries());return n.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:i,data:n}}window.aipkit_save_task_extractBaseData=c})();(function(){"use strict";function c(r,i){if(r.task_type==="content_indexing"){if(r.post_types=i.getAll("post_types[]"),r.target_store_provider=i.get("target_store_provider")||"openai",r.target_store_id=i.get("target_store_id")||"",r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant"){let t=i.get("embedding_model")||"";if(t&&t.includes(":")){let[e,o]=t.split(":",2);r.embedding_provider=e,r.embedding_model=o}else r.embedding_provider="",r.embedding_model=t}else delete r.embedding_provider,delete r.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(t=>delete r[t])}else delete r.post_types,delete r["post_types[]"],delete r.target_store_provider,delete r.target_store_id,delete r.index_existing_now_flag,delete r.only_new_updated_flag,delete r.embedding_model,delete r.embedding_provider;return r}window.aipkit_save_task_handleContentIndexing=c})();(function(){"use strict";function c(r,i){return r.task_type.startsWith("content_writing")?(r.post_categories=i.getAll("post_categories[]"),r.openai_vector_store_ids=i.getAll("openai_vector_store_ids[]"),delete r["post_categories[]"],delete r["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(t=>delete r[t])):(delete r.content_title,delete r.content_title_bulk,delete r.content_keywords,delete r.ai_temperature,delete r.content_max_tokens,delete r.post_type,delete r.post_author,delete r.post_status,delete r["post_categories[]"],delete r.post_categories,delete r.prompt_mode,delete r.custom_title_prompt,delete r.custom_content_prompt,delete r.generate_meta_description,delete r.custom_meta_prompt,delete r.generate_focus_keyword,delete r.custom_keyword_prompt,delete r.cw_generation_mode,delete r.rss_feeds,delete r.gsheets_sheet_id,delete r.gsheets_credentials,delete r.url_list,delete r.generate_toc,delete r.generate_images_enabled,delete r.image_provider,delete r.image_model,delete r.image_prompt,delete r.image_count,delete r.image_placement,delete r.image_placement_param_x,delete r.image_alignment,delete r.image_size,delete r.generate_featured_image,delete r.featured_image_prompt,delete r.pexels_orientation,delete r.pexels_size,delete r.pexels_color,delete r.pixabay_orientation,delete r.pixabay_image_type,delete r.pixabay_category,delete r.enable_vector_store,delete r.vector_store_provider,delete r["openai_vector_store_ids[]"],delete r.openai_vector_store_ids,delete r.pinecone_index_name,delete r.qdrant_collection_name,delete r.vector_embedding_provider,delete r.vector_embedding_model,delete r.vector_store_top_k,delete r.rss_include_keywords,delete r.rss_exclude_keywords),r}window.aipkit_save_task_handleContentWriting=c})();(function(){"use strict";function c(r){let n=(window.aipkit_automated_tasks_config||{}).text||{};if(!r.task_name)return n.task_name_required||"Task name is required.";if(!r.task_type)return n.task_type_required||"Task type is required.";if(r.task_type==="content_indexing"){if(!r.target_store_id)return n.target_store_required||"A target vector store/index must be selected.";if(!r.post_types||r.post_types.length===0)return n.content_type_required||"Please select content types for indexing.";if(r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant"){if(!r.embedding_provider)return n.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!r.embedding_model)return n.embedding_model_required||"Embedding model is required for this vector provider."}}if(r.task_type.startsWith("content_writing")){let t=r.cw_generation_mode;if(t==="bulk"||t==="csv"||t==="single"){if(!r.content_title)return n.content_title_required_cw_task||"Content Title/Topic is required for this Content Writing task mode."}else{if(t==="rss"&&!r.rss_feeds)return"RSS Feed URLs are required for this task mode.";if(t==="url"&&!r.url_list)return"Website URLs are required for this task mode.";if(t==="gsheets"&&(!r.gsheets_sheet_id||!r.gsheets_credentials))return"Google Sheet ID and Credentials are required for this task mode."}if(!r.ai_provider||!r.ai_model)return n.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}return!0}window.aipkit_save_task_validateData=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_automated_task_form");if(!i)return console.error("Wizard Validation: Form element not found."),"An internal error occurred: Form not found.";let n=document.querySelector(`.aipkit_wizard_step[data-step="${r}"]`);if(!n)return console.warn(`Validation: Step indicator for step ${r} not found.`),!0;let t=n.dataset.contentId;if(!t)return console.warn(`Validation: Could not find content ID for step ${r}`),!0;let e=(window.aipkit_automated_tasks_config||{}).text||{};switch(t){case"task_form_setup":{if(!i.elements.task_name.value.trim())return e.task_name_required||"Task name is required.";if(!i.elements.task_category.value)return"Task category is required.";let o=i.elements.task_type.value;if(!o)return e.task_type_required||"Task type is required.";if(o==="content_indexing"){let a=i.elements["post_types[]"];if(!a||!Array.from(a.selectedOptions).some(s=>s.value))return e.content_type_required||"Please select at least one post type to index."}else if(o.startsWith("content_writing")){let a=o.replace("content_writing_","");if(a==="bulk"&&!i.elements.content_title_bulk.value.trim())return"At least one topic is required for Bulk mode.";if(a==="csv"){let s=document.getElementById("aipkit_task_cw_csv_data_holder");if(!s||!s.value.trim())return"A parsed CSV file is required for CSV mode."}if(a==="rss"&&!i.elements.rss_feeds.value.trim())return"RSS Feed URL(s) are required for RSS mode.";if(a==="url"&&!i.elements.url_list.value.trim())return"Website URL(s) are required for URL mode.";if(a==="gsheets"&&!i.elements.gsheets_sheet_id.value.trim())return"Google Sheet ID is required for Google Sheets mode."}else if(o==="enhance_existing_content"){let a=document.getElementById("aipkit_task_ce_post_types");if(!a||!Array.from(a.selectedOptions).some(_=>_.value))return"Please select at least one post type to enhance.";let s=document.getElementById("aipkit_task_ce_update_title"),l=document.getElementById("aipkit_task_ce_update_excerpt"),d=document.getElementById("aipkit_task_ce_update_content"),p=document.getElementById("aipkit_task_ce_update_meta");if(!s?.checked&&!l?.checked&&!p?.checked&&!d?.checked)return"Please select at least one field to enhance (Title, Excerpt, Content, or Meta Description)."}break}case"task_config_ai":{let o=i.elements.custom_content_prompt;if(!o||!o.value.trim())return"The Content Prompt cannot be empty.";break}case"task_config_content_indexing":{if(!i.elements.target_store_id.value)return e.target_store_required||"A target vector store/index must be selected.";if(i.elements.target_store_provider.value==="pinecone"||i.elements.target_store_provider.value==="qdrant"){if(!i.elements.embedding_provider.value)return"Embedding provider is required for this vector provider.";if(!i.elements.embedding_model.value)return"Embedding model is required for this vector provider."}break}case"task_config_seo":case"task_form_image_settings":case"task_config_content_writing":break;default:break}return!0}window.aipkit_form_validateWizardStep=c})();(function(){"use strict";async function c(r){let i=window.aipkit_automated_tasks_config||{},n={...r,_ajax_nonce:i.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",n)}window.aipkit_save_task_submitRequest=c})();(function(){"use strict";function c(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=c})();(function(){"use strict";async function c(r){if(r.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let i=r.target,n=i.querySelector("#aipkit_save_task_btn");if(n&&n.dataset.action==="upgrade"){let a=window.aipkit_dashboard?.upgradeUrl;a?window.open(a,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let t=(window.aipkit_automated_tasks_config||{}).text||{},o=!!(i.elements.task_id&&i.elements.task_id.value)?t.save_task_button||"Save Task":t.create_task_button||"Create Task";try{let{formData:a,data:s}=window.aipkit_save_task_extractBaseData(i),l;s.task_type==="content_indexing"?l=window.aipkit_save_task_handleContentIndexing(s,a):s.task_type.startsWith("content_writing")?l=window.aipkit_save_task_handleContentWriting(s,a):s.task_type==="enhance_existing_content"?l=window.aipkit_save_task_handleContentEnhancement(s,a):l=s;let d=window.aipkit_save_task_validateData(l);if(d!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(d,"error"),new Error("Validation failed: "+d);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!0,o,t.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(t.saving_task||"Saving task...","info");let p=await window.aipkit_save_task_submitRequest(l);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(p.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(a){console.error("Save Task Error:",a),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&a.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${a.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,o)}}window.aipkit_form_handleSaveTask=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_automated_task_form"),i=document.getElementById("aipkit_automated_task_category"),n=document.getElementById("aipkit_automated_task_type"),t=document.getElementById("aipkit_cancel_edit_task_btn"),e=document.getElementById("aipkit_automated_task_form_wrapper"),o=document.getElementById("aipkit_automated_task_list_wrapper"),a=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),r&&typeof window.aipkit_form_handleSaveTask=="function"?r.addEventListener("submit",window.aipkit_form_handleSaveTask):r&&console.error("Automated Task Form Init: handleSaveTask function not found."),i&&typeof window.aipkit_form_handleCategoryChange=="function"?i.addEventListener("change",window.aipkit_form_handleCategoryChange):i&&console.error("Automated Task Form Init: handleCategoryChange function not found."),n&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(n.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:n})):n&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),t&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?t.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(e,o,a)}):t&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI(),console.log("AIPKit Automated Tasks: Task Form specific listeners initialized.")}window.aipkit_form_initAutomatedTaskForm=c})();(function(){"use strict";let c=!1,r=null,i=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return c},set isSubmitting(t){c=t},get pendingModelSelection(){return r},set pendingModelSelection(t){r=t},get pendingEmbeddingModelSelection(){return i},set pendingEmbeddingModelSelection(t){i=t}};function n(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found."),console.log("AIPKit Automated Tasks: Main Form Handler Orchestrator Initialized.")}window.aipkit_initAutomatedTaskForm=n})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_automated_tasks_tbody"),n=window.aipkit_automated_tasks_config||{},t=n.text||{},e=window.aipkit_escapeHtml||function(d){return d},o=window.aipkit_ucfirst||function(d){return d?d.charAt(0).toUpperCase()+d.slice(1):""},a=n.frequencies||{},s=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(d=>{d.removeAttribute("data-sort-direction"),s&&d.dataset.sortBy===s.sortBy&&d.setAttribute("data-sort-direction",s.sortOrder.toLowerCase())}),!i){console.warn("Render Tasks Table: Table body not found.");return}if(i.innerHTML="",!r||r.length===0){i.innerHTML=`<tr><td colspan="7" class="aipkit_text-center">${t.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}r.forEach(d=>{let p=JSON.parse(d.task_config||"{}"),_=i.insertRow();_.insertCell().textContent=e(d.task_name);let f=(n.task_types?.[d.task_type]||{}).label||o(d.task_type.replace(/_/g," "));_.insertCell().textContent=e(f);let m=p.indexing_frequency||p.task_frequency||"N/A",g=a[m]||o(m.replace(/_/g," "));_.insertCell().textContent=e(g);let k=_.insertCell();k.innerHTML=`<span class="aipkit_job_status_${e(d.status)}">${e(o(d.status))}</span>`,_.insertCell().textContent=d.last_run_time?new Date(d.last_run_time.replace(" ","T")+"Z").toLocaleString():t.never_run||"Never",_.insertCell().textContent=d.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(d.next_run_time):d.next_run_time?new Date(d.next_run_time.replace(" ","T")+"Z").toLocaleString():t.not_scheduled||"Not Scheduled";let w=_.insertCell();w.className="aipkit_automated_tasks_table_actions",w.innerHTML=`
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="edit" data-task-id="${d.id}">${t.edit_button||"Edit"}</button>
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="${d.status==="active"?"pause":"resume"}" data-task-id="${d.id}">${d.status==="active"?t.pause_button||"Pause":t.resume_button||"Resume"}</button>
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="run_now" data-task-id="${d.id}" ${d.status!=="active"?"disabled":""} title="${d.status!=="active"?t.task_not_active_run_title||"Task must be active to run":""}">${t.run_now_button||"Run Now"}</button>
                <button class="aipkit_btn aipkit_btn-danger aipkit_btn-small" data-action="delete" data-task-id="${d.id}">${t.delete_button||"Delete"}</button>
            `})}window.aipkit_list_renderTasksTable=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_automated_task_list_pagination"),t=(window.aipkit_automated_tasks_config||{}).text||{};if(!i){console.warn("Render List Pagination: Pagination container not found.");return}i.innerHTML="";let{total_items:e,total_pages:o,current_page:a}=r||{};if(!o||o<=1){e>0&&(i.innerHTML=`<span class="aipkit_pagination-count">${Number(e).toLocaleString()} ${Number(e)===1?t.task_singular||"task":t.task_plural||"tasks"}</span>`);return}let s=document.createElement("span");s.className="aipkit_pagination-count",s.textContent=`${Number(e).toLocaleString()} ${Number(e)===1?t.task_singular||"task":t.task_plural||"tasks"}`,i.appendChild(s);let l=document.createElement("span");l.className="aipkit_pagination-links";let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",d.innerHTML=`\xAB ${t.previous_button||"Previous"}`,d.disabled=Number(a)<=1,d.disabled||(d.dataset.page=Number(a)-1),l.appendChild(d);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${t.page_label||"Page"} ${Number(a)} ${t.of_label||"of"} ${Number(o)}`,l.appendChild(p);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=`${t.next_button||"Next"} \xBB`,_.disabled=Number(a)>=Number(o),_.disabled||(_.dataset.page=Number(a)+1),l.appendChild(_),i.appendChild(l)}window.aipkit_list_renderListPagination=c})();(function(){"use strict";async function c(r=1){let i=document.getElementById("aipkit_automated_tasks_tbody"),n=window.aipkit_automated_tasks_list_state,t=window.aipkit_automated_tasks_config||{},e=t.text||{};if(!i){console.warn("Fetch Tasks: Table body not found.");return}i.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${e.loading_tasks||"Loading tasks..."}</td></tr>`,n&&(n.page=r);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let o={page:r,search:n?n.search:"",orderby:n?n.sortBy:"created_at",order:n?n.sortOrder:"DESC",_ajax_nonce:t.nonce_manage_tasks},a=await window.aipkit_apiRequest("aipkit_get_automated_tasks",o);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=a.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(a.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(a.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(o){console.error("Fetch Tasks Error:",o),i.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${e.error_loading_tasks||"Error loading tasks:"} ${o.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=c})();(function(){"use strict";function c(r){if(!r){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),r):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=c})();(function(){"use strict";async function c(r,i){let n=window.aipkit_automated_tasks_config||{},t=n.text||{};if(confirm(t.confirm_delete_task||"Are you sure you want to delete this task?")){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,t.delete_button||"Delete",t.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:i,_ajax_nonce:n.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(t.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(e){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${t.error_deleting_task||"Error deleting task:"} ${e.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,t.delete_button||"Delete")}}}window.aipkit_handleDeleteTaskAction=c})();(function(){"use strict";async function c(r,i,n){let t=window.aipkit_automated_tasks_config||{},e=t.text||{},o=n==="paused",a=o?e.pausing_task||"Pausing...":e.resuming_task||"Resuming...",s=o?e.pause_button||"Pause":e.resume_button||"Resume";typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,s,a);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:i,status:n,_ajax_nonce:t.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.task_status_updated||"Task status updated to"} ${n}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(l){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_updating_status||"Error updating task status:"} ${l.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,s)}}window.aipkit_handleToggleTaskStatusAction=c})();(function(){"use strict";async function c(r,i){let n=window.aipkit_automated_tasks_config||{},t=n.text||{};typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,t.run_now_button||"Run Now",t.running_task||"Initiating Run...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:i,_ajax_nonce:n.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(t.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(e){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${t.error_initiating_run||"Error initiating task run:"} ${e.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,t.run_now_button||"Run Now")}}window.aipkit_handleRunNowTaskAction=c})();(function(){"use strict";async function c(r){let i=r.target.closest("button[data-action]");if(!i)return;let n=i.dataset.action,t=i.dataset.taskId;if(!t)return;let o=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(a=>a.id.toString()===t.toString());switch(n){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(o);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(i,t);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let a=n==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(i,t,a)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(i,t);break;default:console.warn(`Unknown task action: ${n}`);break}}window.aipkit_list_handleTaskActionClick=c})();(function(){"use strict";function c(r){let i=r.target.closest("button[data-page]");if(i&&!i.disabled){let n=parseInt(i.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(n):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=c})();(function(){"use strict";function c(r,i="info"){let n=document.getElementById("aipkit_automated_task_status");n&&(n.textContent=r,n.className=`aipkit_form-help aipkit_settings_message-${i}`,setTimeout(()=>{n.textContent===r&&(n.textContent="",n.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_automated_task_list_wrapper"),i=document.getElementById("aipkit_automated_tasks_tbody"),n=document.getElementById("aipkit_add_new_task_btn"),t=document.getElementById("aipkit_automated_task_form_wrapper"),e=document.getElementById("aipkit_automated_task_list_pagination"),o=document.getElementById("aipkit_task_list_search_input"),a=r?r.querySelector(".aipkit_data-table"):null;if(n&&t&&r&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&n.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(t,r,n)}),i&&typeof window.aipkit_list_handleTaskActionClick=="function"&&i.addEventListener("click",window.aipkit_list_handleTaskActionClick),e&&typeof window.aipkit_list_handleListPaginationClick=="function"&&e.addEventListener("click",window.aipkit_list_handleListPaginationClick),o){let s;o.addEventListener("input",()=>{clearTimeout(s),s=setTimeout(()=>{let l=window.aipkit_automated_tasks_list_state;l&&(l.search=o.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}a&&a.addEventListener("click",s=>{let l=s.target.closest("th.aipkit-sortable-col");if(!l)return;let d=l.dataset.sortBy,p=window.aipkit_automated_tasks_list_state;if(!p)return;let _="DESC";p.sortBy===d&&(_=p.sortOrder==="DESC"?"ASC":"DESC"),p.sortBy=d,p.sortOrder=_,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found."),console.log("AIPKit Automated Tasks: Task List specific listeners initialized.")}window.aipkit_list_initAutomatedTaskList=c})();(function(){"use strict";let c=[],r=1,i="",n="created_at",t="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...c]},set tasks(o){c=Array.isArray(o)?o:[]},get page(){return r},set page(o){r=o},get search(){return i},set search(o){i=o},get sortBy(){return n},set sortBy(o){n=o},get sortOrder(){return t},set sortOrder(o){t=o}};function e(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found."),console.log("AIPKit Automated Tasks: Main List Handler Orchestrator Initialized.")}window.aipkit_initAutomatedTaskList=e})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_automated_task_queue_tbody"),n=window.aipkit_automated_tasks_config||{},t=n.text||{},e=window.aipkit_escapeHtml||function(l){return l},o=window.aipkit_ucfirst||function(l){return l?l.charAt(0).toUpperCase()+l.slice(1):""},a=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(l=>{l.removeAttribute("data-sort-direction"),a&&l.dataset.sortBy===a.sortBy&&l.setAttribute("data-sort-direction",a.sortOrder.toLowerCase())}),!i){console.warn("Render Queue Table: Table body not found.");return}if(i.innerHTML="",!r||r.length===0){i.innerHTML=`<tr><td colspan="7" class="aipkit_text-center">${t.queue_empty||"Task queue is currently empty."}</td></tr>`;return}r.forEach(l=>{let d=i.insertRow(),p=d.insertCell(),_=document.createElement("textarea");_.innerHTML=l.target_title||`${t.target_id_prefix||"Target ID:"} ${l.target_identifier}`;let u=_.value,f=l.task_type.startsWith("content_writing"),m=l.task_type==="enhance_existing_content",g=null;f&&l.status==="completed"&&l.generated_post_id?g=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${l.generated_post_id}&action=edit`:m&&!isNaN(parseInt(l.target_identifier,10))&&(g=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${l.target_identifier}&action=edit`),g?p.innerHTML=`<a href="${g}" target="_blank" title="${e(t.edit_generated_post_title||"Edit generated post")}">${e(u)}</a>`:p.textContent=u,d.insertCell().textContent=e(l.task_name||`${t.task_id_prefix||"Task ID:"} ${l.task_id}`);let k=n.task_types&&n.task_types[l.task_type]?n.task_types[l.task_type].label:o(l.task_type.replace(/_/g," "));d.insertCell().textContent=e(k);let w=d.insertCell(),b=`<span class="aipkit_job_status_${e(l.status)}">${e(o(l.status))}</span>`;l.status==="failed"&&l.error_message&&(b+=`<span class="aipkit_queue_error_message" title="${e(l.error_message)}">${e(l.error_message)}</span>`),w.innerHTML=b,d.insertCell().textContent=l.attempts,d.insertCell().textContent=l.added_at?new Date(l.added_at.replace(" ","T")+"Z").toLocaleString():t.not_applicable||"N/A";let y=d.insertCell();y.className="aipkit_automated_tasks_table_actions";let h=`<button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="delete_queue_item" data-item-id="${l.id}">${t.delete_button||"Delete"}</button>`;l.status==="failed"&&(h+=` <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="retry_queue_item" data-item-id="${l.id}">${t.retry_button||"Retry"}</button>`),y.innerHTML=h})}window.aipkit_queue_renderQueueTable=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_automated_task_queue_pagination"),t=(window.aipkit_automated_tasks_config||{}).text||{};if(!i){console.warn("Render Queue Pagination: Pagination container not found.");return}i.innerHTML="";let{total_items:e,total_pages:o,current_page:a}=r||{};if(!e||e<=0)return;let s=document.createElement("span");if(s.className="aipkit_pagination-count",s.textContent=`${Number(e).toLocaleString()} ${Number(e)===1?t.item_singular||"item":t.item_plural||"items"}`,i.appendChild(s),o>1){let l=document.createElement("span");l.className="aipkit_pagination-links";let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",d.innerHTML=`\xAB ${t.previous_button||"Previous"}`,d.disabled=Number(a)<=1,d.disabled||(d.dataset.page=Number(a)-1),l.appendChild(d);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${t.page_label||"Page"} ${Number(a)} ${t.of_label||"of"} ${Number(o)}`,l.appendChild(p);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=`${t.next_button||"Next"} \xBB`,_.disabled=Number(a)>=Number(o),_.disabled||(_.dataset.page=Number(a)+1),l.appendChild(_),i.appendChild(l)}}window.aipkit_queue_renderQueuePagination=c})();(function(){"use strict";async function c(r=1){let i=window.aipkit_automated_tasks_queue_state;i?i.page=r:console.warn("Fetch/Render Queue: Queue state object not available.");let n=document.getElementById("aipkit_automated_task_queue_tbody"),t=document.getElementById("aipkit_automated_task_queue_status"),e=window.aipkit_automated_tasks_config||{},o=e.text||{};if(!n){console.warn("Fetch/Render Queue: Table body not found.");return}n.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${o.loading_queue||"Loading queue items..."}</td></tr>`,t&&(t.textContent="");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let a={page:r,search:i?i.search:"",status_filter:i?i.status:"all",orderby:i?i.sortBy:"q.added_at",order:i?i.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},s=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",a);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(s.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(s.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(a){console.error("Fetch/Render Queue Error:",a),n.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${o.error_loading_queue||"Error loading queue:"} ${a.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=c})();(function(){"use strict";async function c(r){let i=r.target.closest("button[data-action]");if(!i)return;let n=i.dataset.action,t=i.dataset.itemId;if(!t)return;let e=document.getElementById("aipkit_automated_task_queue_status"),o=window.aipkit_automated_tasks_config||{},a=o.text||{},s=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1;if(n==="delete_queue_item"){if(confirm(a.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?")){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,a.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:t,_ajax_nonce:o.nonce_manage_tasks}),e&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(e,"success",a.queue_item_deleted||"Queue item deleted."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(s)}catch(l){e&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(e,"error",`${a.error_deleting_queue_item||"Error deleting item:"} ${l.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,a.delete_button||"Delete")}}}else if(n==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,a.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:t,_ajax_nonce:o.nonce_manage_tasks}),e&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(e,"success",a.item_marked_retry||"Item marked for retry. Queue processing will pick it up."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(s)}catch(l){e&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(e,"error",`${a.error_retrying_item||"Error retrying item:"} ${l.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,a.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=c})();(function(){"use strict";async function c(){let r=document.getElementById("aipkit_delete_queue_by_status_btn"),i=document.getElementById("aipkit_task_queue_status_filter");if(!r||!i){console.error("Delete by status button or filter dropdown not found.");return}let n=i.value,t=i.options[i.selectedIndex].text.toLowerCase(),e=window.aipkit_automated_tasks_config||{},o=e.text||{},a=n==="all"?o.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(o.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",t);if(confirm(a)){typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(r,!0,o.delete_button||"Delete",o.deleting_task||"Deleting..."):r.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let s=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:n,_ajax_nonce:e.nonce_manage_tasks}),l=document.getElementById("aipkit_automated_task_queue_status");l&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"success",s.message||"Queue items deleted."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(s){let l=document.getElementById("aipkit_automated_task_queue_status");l&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"error",`${o.errorDeletingAllItems||"Error deleting items:"} ${s.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(r,!1,o.delete_button||"Delete"):r.disabled=!1}}}window.aipkit_handleDeleteQueueByStatus=c})();(function(){"use strict";function c(r){let i=r.target.closest("button[data-page]");if(i&&!i.disabled){let n=parseInt(i.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(n):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_automated_task_queue_tbody"),i=document.getElementById("aipkit_refresh_task_queue_btn"),n=document.getElementById("aipkit_delete_queue_by_status_btn"),t=document.getElementById("aipkit_automated_task_queue_pagination"),e=document.getElementById("aipkit_task_queue_search_input"),o=document.getElementById("aipkit_task_queue_status_filter"),a=document.querySelector("#aipkit_automated_task_queue_viewer_area .aipkit_data-table");if(i&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&i.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),n&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&n.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),e){let s;e.addEventListener("input",()=>{clearTimeout(s),s=setTimeout(()=>{let l=window.aipkit_automated_tasks_queue_state;l&&(l.search=e.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}o&&o.addEventListener("change",()=>{let s=window.aipkit_automated_tasks_queue_state;s&&(s.status=o.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),a&&a.addEventListener("click",s=>{let l=s.target.closest("th.aipkit-sortable-col");if(!l)return;let d=l.dataset.sortBy,p=window.aipkit_automated_tasks_queue_state;if(!p)return;let _="DESC";p.sortBy===d&&(_=p.sortOrder==="DESC"?"ASC":"DESC"),p.sortBy=d,p.sortOrder=_,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),r&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&r.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),t&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&t.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch."),console.log("AIPKit Automated Tasks: Task Queue specific listeners initialized.")}window.aipkit_queue_initAutomatedTaskQueue=c})();(function(){"use strict";let c=1,r="",i="all",n="q.added_at",t="DESC";window.aipkit_automated_tasks_queue_state={get page(){return c},set page(o){c=o},get search(){return r},set search(o){r=o},get status(){return i},set status(o){i=o},get sortBy(){return n},set sortBy(o){n=o},get sortOrder(){return t},set sortOrder(o){t=o}};function e(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found."),console.log("AIPKit Automated Tasks: Main Queue Handler Orchestrator Initialized.")}window.aipkit_initAutomatedTaskQueue=e})();(function(){"use strict";function c(){console.log("AIPKit AutoGPT Module: Initializing (aipkit_initAutogpt)...");let r=document.getElementById("aipkit_autogpt_container");if(r&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():r&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(i){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",i)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.");console.log("AIPKit AutoGPT Module: Main initialization complete.")}window.aipkit_initAutogpt=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.warn("Content Writer Accordions: Main container not found.");return}r.dataset.accordionListenerAttached!=="true"&&(r.addEventListener("click",function(i){let n=i.target.closest(".aipkit_accordion-header");if(!n)return;let t=n.closest(".aipkit_accordion");if(!t)return;let e=n.nextElementSibling;if(!e||!e.classList.contains("aipkit_accordion-content"))return;let o=t.closest(".aipkit_accordion-group");if(o&&!n.classList.contains("aipkit_active")){let a=o.querySelector(".aipkit_accordion-header.aipkit_active");if(a){a.classList.remove("aipkit_active");let s=a.nextElementSibling;s&&s.classList.remove("aipkit_active")}}n.classList.toggle("aipkit_active"),e.classList.toggle("aipkit_active")}),r.dataset.accordionListenerAttached="true",console.log("AIPKit Content Writer: Accordion listeners initialized."))}window.aipkit_initContentWriterAccordions=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(t){return t},r=new Set;function i(t,e,o=""){let a=document.getElementById(`aipkit_cw_status_${t}_generation`),s=a?a.querySelector(".aipkit_cw_status_icon"):null,l=a?a.querySelector(".status-text"):null;if(!a||!s||!l){console.warn(`Could not find all elements for status indicator step: ${t}`);return}if(r.has(t)&&e==="generating"){console.log(`Preventing reset of completed step: ${t}`);return}switch((e==="success"||e==="skipped")&&r.add(t),e==="pending"&&r.delete(t),a.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),a.classList.add(`status-${e}`),e){case"pending":l.textContent="Pending";let d="dashicons-text-page";t==="content"&&(d="dashicons-admin-post"),t==="image"&&(d="dashicons-format-image"),t==="excerpt"&&(d="dashicons-editor-quote"),t==="tags"&&(d="dashicons-tag"),t==="meta"&&(d="dashicons-search"),t==="keyword"&&(d="dashicons-flag"),s.className=`dashicons ${d} aipkit_cw_status_icon`;break;case"generating":l.textContent="Generating...",s.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":l.textContent="Complete",s.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":l.textContent=`Error ${o?": "+c(o):""}`,s.className="dashicons dashicons-warning aipkit_cw_status_icon",r.delete(t);break;case"skipped":l.textContent="Skipped",s.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function n(){r.clear(),["title","content","image","meta","keyword","excerpt","tags"].forEach(t=>{i(t,"pending")})}window.aipkit_updateCwGenerationStatus=i,window.aipkit_resetAllGenerationStatuses=n})();(function(){"use strict";function c(){let r=document.querySelector(".aipkit_cw_generation_status_indicators");r&&(r.style.display="flex",typeof window.aipkit_updateCwGenerationStatus=="function"?(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending")):console.error("Reset Status Indicators: aipkit_updateCwGenerationStatus function not found."))}window.aipkit_resetGenerationStatusIndicators=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};async function r(i,n,t){let e=new FormData(i),o=Object.fromEntries(e.entries()),a=window.aipkit_dashboard?.text||{},s=document.querySelector(".aipkit_cw_tab.aipkit_active"),l=s?s.dataset.mode:"task";if(o.cw_generation_mode=l,l==="csv"){let u=document.getElementById("aipkit_cw_csv_data_holder");o.content_title=u?u.value:""}else l==="url"?(o.url_list=i.elements.url_list?.value||"",o.content_title=o.url_list):l==="task"?o.content_title=i.elements.content_title_bulk?i.elements.content_title_bulk.value:"":l==="single"&&(o.content_title=i.elements.content_title?i.elements.content_title.value:"");delete o.content_title_bulk,delete o.content_title_csv;let d=document.getElementById("aipkit_cw_template_select"),p="";if(d&&d.selectedIndex>0){let u=d.options[d.selectedIndex];u&&(p=u.text)}if(p&&p.trim()!=="")o.task_name=p.trim();else{let u=(o.content_title||o.rss_feeds||o.gsheets_sheet_id||o.url_list||"").split(`
`)[0].trim();o.task_name=u||"Automated Content Writing Task"}if((l==="task"||l==="csv"||l==="single")&&!o.content_title){t&&(t.textContent=l==="csv"?"Please upload and parse a valid CSV file first.":"Content Title/Topic is required for automated tasks.",t.className="aipkit_form-help aipkit_settings_message-error");return}if(l==="rss"&&!o.rss_feeds){t&&(t.textContent="RSS Feed URL(s) are required for this task mode.",t.className="aipkit_form-help aipkit_settings_message-error");return}if(l==="gsheets"&&(!o.gsheets_sheet_id||!o.gsheets_credentials)){t&&(t.textContent="Google Sheet ID and Credentials are required for this task mode.",t.className="aipkit_form-help aipkit_settings_message-error");return}if(l==="url"&&!o.url_list){t&&(t.textContent="Website URL(s) are required for this task mode.",t.className="aipkit_form-help aipkit_settings_message-error");return}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(n,!0,"Create Task","Creating Task..."):(n.disabled=!0,n.textContent="Creating Task..."),t&&(t.textContent="Creating automated task...",t.className="aipkit_form-help aipkit_settings_message-info");try{let u=document.getElementById("aipkit_content_writer_nonce");if(o._ajax_nonce=u?u.value:"",!o._ajax_nonce)throw new Error("Security token missing for task creation.");let f=await window.aipkit_apiRequest("aipkit_content_writer_create_task",o);t&&(t.textContent=f.message||(a.task_queued_content_writing??"Your content writing task is queued. You can track it under the Automated Tasks tab."),t.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_form-help")},5e3))}catch(u){console.error("Content Writer Create Task Error:",u),t&&(t.textContent=`Error creating task: ${c(u.message||"Unknown error")}`,t.className="aipkit_form-help aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(n,!1,"Create Task"):(n.disabled=!1,n.textContent="Create Task")}}window.aipkit_createContentWriterTask=r})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};function r(i,n){let t=i.value,e=t?t.toLowerCase():"",o=window.aipkit_dashboard?.models;if(console.log("Content Writer Model Populator: Populating for provider:",t,"Key:",e),!n){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!o){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),n.innerHTML='<option value="">'+c("Error: Model data object not found")+"</option>",n.disabled=!0;return}let a=o[e];if((typeof a>"u"||a===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${e}'. Defaulting to empty.`),a=e==="openai"?{}:[]),n.innerHTML="",e==="openai"&&typeof a=="object"&&!Array.isArray(a)?Object.keys(a).forEach(d=>{let p=document.createElement("optgroup");p.label=c(d);let _=a[d];Array.isArray(_)?_.forEach(u=>{if(u&&typeof u=="object"&&u.id){let f=new Option(c(u.name||u.id),u.id);p.appendChild(f)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${d}':`,u)}):console.warn(`Content Writer Model Populator: Items for group '${d}' under '${e}' is not an array.`),n.appendChild(p)}):Array.isArray(a)?a.forEach(d=>{if(d&&typeof d=="object"&&d.id){let p=new Option(c(d.name||d.id),d.id);n.appendChild(p)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${e}':`,d)}):(console.warn(`Content Writer Model Populator: Data for provider '${e}' is not in expected format. Actual type: ${typeof a}`),n.appendChild(new Option(c(`No models for ${t} (Format Error)`),""))),!n.options||typeof n.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),n.appendChild(new Option(c("Error loading models"),"")),n.disabled=!0;else if(n.options.length===0)n.appendChild(new Option(c(`No models for ${t} (Sync in settings)`),"")),n.disabled=!0;else{n.disabled=!1;let d=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let p=window.aipkit_cw_template_state.pendingModelSelection;n.querySelector(`option[value="${CSS.escape(p)}"]`)?(d=p,console.log(`Content Writer Model Populator: Applying pending model selection: ${p}`)):console.warn(`Content Writer Model Populator: Pending model '${p}' not found in new list for provider '${t}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(d===null){let p=n.querySelector("optgroup");p&&p.options&&p.options.length>0&&p.options[0].value?d=p.options[0].value:n.options&&n.options.length>0&&n.options[0].value?d=n.options[0].value:d=""}n.value=d}let s=n&&n.value!==void 0?n.value:"N/A (select.value undefined)",l=n&&n.options&&typeof n.options.length<"u"?n.options.length:"N/A (select.options undefined)";console.log(`Content Writer Model Populator: Model select for '${e}' populated. Selected: '${s}'. Options count: ${l}`),typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}window.aipkit_populateModelsForContentWriter=r})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(n){return n};function r(n){if(!document.getElementById("aipkit_content_writer_form"))return;let e=document.getElementById("aipkit_content_writer_generate_btn"),o=e?e.querySelector(".aipkit_btn-text"):null,a=document.getElementById("aipkit_cw_task_options"),s=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,l=new Set(["task","csv","rss","gsheets","url"]),d=new Set(["rss","gsheets","url"]),p=document.getElementById("aipkit_cw_single_output_wrapper");p&&n!=="single"&&(p.style.display="none");let _=document.getElementById("aipkit_cw_content_prompt_placeholders");if(_){let u="Use placeholders: {topic}, {keywords}";n==="rss"?u+=", {description}, {source_url}":n==="url"&&(u+=", {url_content}"),u+=".";let f=u.replace(/(\{[a-zA-Z0-9_]+\})/g,m=>`<code class="aipkit-placeholder" title="Click to copy">${c(m)}</code>`);_.innerHTML=f}o&&e&&(l.has(n)?d.has(n)&&!s?(o.textContent="Upgrade to Pro",e.dataset.action="upgrade"):(o.textContent="Create Task",e.dataset.action="create_task"):(o.textContent="Generate",e.dataset.action="generate_single")),a&&(a.style.display=l.has(n)?"flex":"none"),typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields()}function i(n){if(!n){console.error("Content Writer Tabs: Scope element not provided for initialization.");return}let t=n.querySelector(".aipkit_cw_tabs"),e=n.querySelector(".aipkit_cw_tab_content_container");if(!t||!e){console.warn("Content Writer Tabs: Tab or content container not found within the provided scope.");return}t.addEventListener("click",function(a){let s=a.target.closest(".aipkit_cw_tab");if(!s||s.classList.contains("aipkit_active"))return;t.querySelectorAll(".aipkit_cw_tab").forEach(p=>p.classList.remove("aipkit_active")),e.querySelectorAll(".aipkit_cw_tab_content").forEach(p=>p.classList.remove("aipkit_active"));let l=s.dataset.mode;s.classList.add("aipkit_active");let d=e.querySelector(`.aipkit_cw_tab_content[data-pane="${l}"]`);d&&d.classList.add("aipkit_active"),r(l)});let o=t.querySelector(".aipkit_cw_tab.aipkit_active");o&&r(o.dataset.mode),console.log("AIPKit Content Writer: Tabs Initialized.")}window.aipkit_initContentWriterTabs=i})();(function(){"use strict";function c(r,i){if(!r||!i||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(r.addEventListener("change",()=>{console.log("Content Writer UI: Provider changed, re-populating models."),window.aipkit_populateModelsForContentWriter(r,i)}),window.aipkit_dashboard&&window.aipkit_dashboard.models)console.log("Content Writer UI: aipkit_dashboard.models IS available for initial population."),window.aipkit_populateModelsForContentWriter(r,i);else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let n=window.aipkit_escapeHtml||function(t){return t};i.innerHTML='<option value="">'+n("Models unavailable (Data Object Missing)")+"</option>",i.disabled=!0}}window.aipkit_handleProviderModelDropdowns=c})();(function(){"use strict";function c(r){if(!r){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let i=document.getElementById("aipkit_content_writer_temperature_value");i?r.dataset.listenerAttached||(r.addEventListener("input",()=>i.textContent=r.value),r.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=c})();(function(){"use strict";function c(r){if(!r){console.error("Max Tokens Slider Handler: Slider element was not passed or not found.");return}console.log("Content Writer UI: Max Tokens Slider element IS present and its ID is: "+r.id);let i=document.getElementById("aipkit_content_writer_max_tokens_value");i?(console.log("Content Writer UI: Max Tokens Value Span #aipkit_content_writer_max_tokens_value IS found:",i),i.textContent=r.value,r.dataset.listenerAttached?console.log("Content Writer UI: Listener for Max Tokens Slider was already attached."):(console.log("Content Writer UI: Attaching 'input' listener to Max Tokens Slider."),r.addEventListener("input",function(){console.log("Content Writer UI: Max Tokens Slider 'input' event. New value:",this.value),i.textContent=this.value}),r.dataset.listenerAttached="true",console.log("Content Writer UI: Listener for Max Tokens Slider attached. Attribute set:",r.dataset.listenerAttached))):console.error("Max Tokens Slider Handler: Value Span #aipkit_content_writer_max_tokens_value NOT FOUND.")}window.aipkit_handleMaxTokensSlider=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.warn("AI Settings Toggle: Content writer container not found.");return}let i=r.querySelector(".aipkit_ai_settings_toggle"),n=r.querySelector(".aipkit_cw_ai_parameters_row");if(!i||!n){console.warn("AI Settings Toggle: Toggle button or settings row not found.");return}let t="data-settings-toggle-listener-attached";i.getAttribute(t)||(i.addEventListener("click",function(){let e=n.style.display==="none";n.style.display=e?"block":"none",i.classList.toggle("aipkit_active",e),i.setAttribute("aria-expanded",e)}),i.setAttribute(t,"true"),console.log("AIPKit Content Writer: AI Settings Toggle Initialized."))}window.aipkit_initAiSettingsToggle=c})();(function(){"use strict";function c(r){if(!r){console.warn("Copy Button Handler: Button element not provided.");return}r.dataset.listenerAttached||(r.addEventListener("click",()=>{let i=document.getElementById("aipkit_content_writer_output_display");i&&navigator.clipboard.writeText(i.innerText).then(()=>{let n=r.innerHTML;r.innerHTML='<span class="dashicons dashicons-yes"></span> Copied!',setTimeout(()=>{r.innerHTML=n},2e3)}).catch(n=>console.error("Failed to copy: ",n))}),r.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=c})();(function(){"use strict";function c(){let i=document.getElementById("aipkit_cw_single_output_wrapper"),n=document.getElementById("aipkit_content_writer_output_display"),t=document.getElementById("aipkit_cw_generated_content_area"),e=document.querySelector(".aipkit_content_writer_output_actions"),o=document.getElementById("aipkit_cw_status_display_container"),a=document.getElementById("aipkit_cw_generated_title_display"),s=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),l=document.getElementById("aipkit_cw_generated_meta_desc"),d=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),p=document.getElementById("aipkit_cw_generated_focus_keyword"),_=document.getElementById("aipkit_cw_excerpt_output_wrapper"),u=document.getElementById("aipkit_cw_generated_excerpt"),f=document.getElementById("aipkit_cw_tags_output_wrapper"),m=document.getElementById("aipkit_cw_generated_tags"),g=document.getElementById("aipkit_content_writer_copy_btn"),k=document.getElementById("aipkit_content_writer_clear_btn");if(i&&(i.style.display="none"),n&&t){t.innerHTML=`
            <div class="aipkit_cw_output_placeholder">
                <span class="dashicons dashicons-edit-large"></span>
                <span>Your article will appear here...</span>
            </div>`,n.scrollTop=0,e&&(e.style.display="none"),g&&(g.disabled=!0),k&&(k.disabled=!0),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton();let w=document.getElementById("aipkit_content_writer_form_status");w&&(w.textContent="",w.className="aipkit_form-help"),o&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():o&&(o.style.display="none"),a&&(a.style.display="none",a.textContent=""),s&&(s.style.display="none"),l&&(l.value=""),d&&(d.style.display="none"),p&&(p.value=""),_&&(_.style.display="none"),u&&(u.value=""),f&&(f.style.display="none"),m&&(m.value="")}}function r(i,n){if(!i){console.warn("Clear Button Handler: Button element not provided.");return}i.dataset.listenerAttached||(i.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),i.dataset.listenerAttached="true")}window.aipkit_handleClearButton=r,window.aipkit_clearContentWriterOutput=c})();(function(){"use strict";function c(){let i=document.getElementById("aipkit_content_writer_form");if(!i)return;let n=i.elements.generate_meta_description,t=i.querySelector("#aipkit_cw_custom_meta_prompt_field"),e=i.elements.generate_focus_keyword,o=i.querySelector("#aipkit_cw_custom_keyword_prompt_field"),a=i.elements.generate_excerpt,s=i.querySelector(".aipkit_cw_custom_excerpt_prompt"),l=i.elements.generate_tags,d=i.querySelector(".aipkit_cw_custom_tags_prompt");t&&(t.style.display=n&&n.checked?"block":"none"),o&&(o.style.display=e&&e.checked?"block":"none"),s&&(s.style.display=a&&a.checked?"block":"none"),d&&(d.style.display=l&&l.checked?"block":"none")}function r(){let i=document.getElementById("aipkit_content_writer_form");if(!i||i.dataset.optionToggleListenerAttached)return;let n=i.elements.generate_meta_description,t=i.elements.generate_focus_keyword,e=i.elements.generate_excerpt,o=i.elements.generate_tags;n&&n.addEventListener("change",c),t&&t.addEventListener("change",c),e&&e.addEventListener("change",c),o&&o.addEventListener("change",c),i.dataset.optionToggleListenerAttached="true",c()}window.aipkit_cw_toggleCustomOptionPrompts=c,window.aipkit_cw_initOptionPromptToggles=r})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.warn("Prompt Toggle Handler: Content writer container not found.");return}r.querySelectorAll(".aipkit_textarea_toggle").forEach(t=>{let e=t.dataset.target;if(!e)return;let o=`aipkit-cw-prompt-${e}-state`,a=localStorage.getItem(o),s=document.getElementById(e),l=t.querySelector(".dashicons");s&&l&&(a==="expanded"?(s.classList.remove("aipkit_collapsed"),l.classList.remove("dashicons-plus-alt2"),l.classList.add("dashicons-minus"),t.title="Collapse"):(s.classList.add("aipkit_collapsed"),l.classList.remove("dashicons-minus"),l.classList.add("dashicons-plus-alt2"),t.title="Expand"))});let n="data-prompt-toggle-listener-attached";r.getAttribute(n)||(r.addEventListener("click",function(t){let e=t.target.closest(".aipkit_textarea_toggle");if(!e)return;let o=e.dataset.target,a=document.getElementById(o),s=e.querySelector(".dashicons");if(!a||!s){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",e);return}let l=a.classList.toggle("aipkit_collapsed");l?(s.classList.remove("dashicons-minus"),s.classList.add("dashicons-plus-alt2"),e.title="Expand"):(s.classList.remove("dashicons-plus-alt2"),s.classList.add("dashicons-minus"),e.title="Collapse");let d=`aipkit-cw-prompt-${o}-state`;localStorage.setItem(d,l?"collapsed":"expanded")}),r.setAttribute(n,"true"),console.log("AIPKit Content Writer: Prompt Toggle Handler Initialized."))}window.aipkit_initPromptToggles=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(e){return e};function r(e){let o=document.getElementById("aipkit_cw_image_model");if(!o)return;let a=window.aipkit_dashboard?.imageGeneratorModels;if(!a){console.error("Image models data not found in aipkit_dashboard object."),o.innerHTML='<option value="">Error: Models not loaded</option>';return}let s=a[e.toLowerCase()]||[],l=window.aipkit_cw_template_state?.pendingImageModelSelection,d=o.value,p=l||d;console.log(`[populateImageModels] Populating for provider: ${e}. Pending model: ${l}. Current value: ${d}. Will try to set: ${p}`),o.innerHTML="",s.length>0?(s.forEach(_=>{o.appendChild(new Option(_.name,_.id))}),o.querySelector(`option[value="${CSS.escape(p)}"]`)?(o.value=p,console.log(`[populateImageModels] Successfully set model to: ${p}`)):o.options.length>0&&(o.selectedIndex=0,console.log(`[populateImageModels] Could not find ${p}. Set to first option: ${o.value}`))):o.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(l&&console.log("[populateImageModels] Clearing pendingImageModelSelection."),window.aipkit_cw_template_state.pendingImageModelSelection=null)}function i(e){let o=e.closest(".aipkit_form-row").querySelector(".aipkit_cw_image_placement_x_field");o&&(o.style.display=e.value==="after_every_x_h2"||e.value==="after_every_x_h3"||e.value==="after_every_x_p"?"block":"none")}function n(){let e=document.getElementById("aipkit_content_writer_container");if(!e)return;let o=e.querySelector(".aipkit_cw_image_enable_toggle"),a=e.querySelector("#aipkit_cw_generate_featured_image"),s=e.querySelector("#aipkit_cw_image_placement"),l=e.querySelector("#aipkit_cw_image_provider"),d=o?.closest(".aipkit_accordion-content")?.querySelector(".aipkit_cw_image_settings_container"),p=a?.closest(".aipkit_accordion-content")?.querySelector(".aipkit_cw_featured_image_prompt_field"),_=e.querySelector("#aipkit_cw_image_prompt")?.closest(".aipkit_form-group");if(!o||!a||!d||!p||!_)return;let u=o.checked,f=a.checked,m=u||f,g=l.value,k=g==="pexels"||g==="pixabay";if(d.style.display=m?"block":"none",m){let w=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],b=e.querySelector("#aipkit_cw_pexels_options"),y=e.querySelector("#aipkit_cw_pixabay_options"),h=e.querySelector("#aipkit_cw_image_model_group");w.forEach(v=>{let S=e.querySelector(v);if(S){let I=S.closest(".aipkit_form-group");I&&(I.style.display=u?"block":"none")}}),s&&i(s),_.style.display=u&&!k?"block":"none",p.style.display=f&&!k?"block":"none",b&&(b.style.display=k&&g==="pexels"?"flex":"none"),y&&(y.style.display=k&&g==="pixabay"?"flex":"none"),h&&(h.style.display=k?"none":"block"),k||r(g)}}function t(){let e=document.getElementById("aipkit_content_writer_container");e&&(e.dataset.imageHandlerAttached||(e.addEventListener("change",function(o){o.target.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider")&&n()}),n(),e.dataset.imageHandlerAttached="true",console.log("AIPKit Content Writer: Image Settings Handler Initialized.")))}window.aipkit_initImageSettingsHandler=t,window.aipkit_updateImageSettingsUI=n})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(e){return e};function r(e){let o=e.querySelector(".aipkit_cw_vector_store_toggle"),a=e.querySelector(".aipkit_cw_vector_store_settings_container");if(o&&a){let s=o.checked;a.style.display=s?"block":"none",s&&i(e)}}function i(e){let o=e.querySelector(".aipkit_cw_vector_store_provider_select");if(!o)return;let a=o.value,s=e.querySelector(".aipkit_cw_vector_openai_field"),l=e.querySelector(".aipkit_cw_vector_pinecone_field"),d=e.querySelector(".aipkit_cw_vector_qdrant_field"),p=e.querySelector(".aipkit_cw_vector_embedding_config_row");if(s&&(s.style.display=a==="openai"?"block":"none"),l&&(l.style.display=a==="pinecone"?"block":"none"),d&&(d.style.display=a==="qdrant"?"block":"none"),p){let _=a==="pinecone"||a==="qdrant";if(p.style.display=_?"block":"none",_){let u=p.querySelector(".aipkit_cw_vector_embedding_provider_select");u&&n(u.value)}}}function n(e){let o=document.getElementById("aipkit_cw_vector_embedding_model");if(!o)return;let s=(window.aipkit_dashboard?.embeddingModels||{})[e.toLowerCase()]||[],l=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";o.innerHTML=`<option value="">${c("-- Select Model --")}</option>`,s.length>0?(s.forEach(d=>{if(d&&d.id){let p=new Option(c(d.name||d.id),d.id);d.id===l&&(p.selected=!0),o.appendChild(p)}}),o.disabled=!1):(o.disabled=!0,o.innerHTML=`<option value="">${c("-- No models found --")}</option>`)}function t(){let e=document.getElementById("aipkit_content_writer_container");e&&(e.dataset.vectorSettingsHandlerAttached||(e.addEventListener("change",function(o){let a=o.target;a.matches(".aipkit_cw_vector_store_toggle")?r(a.closest(".aipkit_accordion-content")):a.matches(".aipkit_cw_vector_store_provider_select")?i(a.closest(".aipkit_cw_vector_store_settings_container")):a.matches(".aipkit_cw_vector_embedding_provider_select")&&n(a.value)}),e.querySelectorAll(".aipkit_accordion-content").forEach(o=>{o.querySelector(".aipkit_cw_vector_store_toggle")&&r(o)}),e.dataset.vectorSettingsHandlerAttached="true",console.log("AIPKit Content Writer: Vector Settings Handler Initialized.")))}window.aipkit_initContentWriterVectorSettings=t,window.aipkit_cw_toggleVectorSettingsContainer=r,window.aipkit_cw_toggleProviderSpecificFields=i,window.aipkit_cw_populateEmbeddingModelSelect=n})();(function(){"use strict";function c(r,i,n,t,e,o,a){console.log("Content Writer UI: Initializing UI components..."),typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(r,i):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(n):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleMaxTokensSlider=="function"?window.aipkit_handleMaxTokensSlider(t):console.error("Content Writer UI: handleMaxTokensSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(o):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(a,o):console.error("Content Writer UI: handleClearButton function not found."),console.log("Content Writer UI: UI components initialization complete.")}window.aipkit_initContentWriterUI=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_content_writer_generate_btn"),i=document.getElementById("aipkit_content_writer_stop_btn");r&&(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(r,!1,"Generate"):(r.disabled=!1,r.textContent="Generate"),r.style.display="inline-flex"),i&&(i.style.display="none")}window.aipkit_resetContentWriterButtons=c})();(function(){"use strict";function c(r){r.current&&(r.current.close(),r.current=null,console.log("Content Writer Finalize Stream: EventSource closed.")),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let i=document.getElementById("aipkit_content_writer_output_display"),n=document.querySelector(".aipkit_content_writer_output_actions"),t=document.getElementById("aipkit_content_writer_copy_btn"),e=document.getElementById("aipkit_content_writer_clear_btn");i&&i.textContent.trim()!==""&&!i.classList.contains("aipkit_content_writer_output_error")?(n&&(n.style.display="block"),t&&(t.disabled=!1),e&&(e.disabled=!1),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(n&&(n.style.display="none"),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=c})();(function(){"use strict";async function c(n){let t=n.target,e=t.closest(".aipkit_form-group");if(!e)return;let o=e.querySelector(".aipkit_csv_analysis_results"),a=e.querySelector(".aipkit_csv_data_holder"),s=document.getElementById("aipkit_content_writer_nonce"),l=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,d=s?s.value:l;if(!o||!a||!d){console.error("CSV Handler: Missing status div, data holder, or nonce field."),o&&(o.textContent="Error: A required UI component or security token is missing.",o.className="aipkit_form-help aipkit_settings_message-error");return}let p=t.files[0];if(!p){o.textContent="Please select a CSV file first.",o.className="aipkit_form-help aipkit_settings_message-error";return}if(!p.name.toLowerCase().endsWith(".csv")){o.textContent="Invalid file type. Please upload a .csv file.",o.className="aipkit_form-help aipkit_settings_message-error";return}o.textContent="Parsing CSV...",o.className="aipkit_form-help aipkit_settings_message-info";let _=new FormData;_.append("file",p),_.append("_ajax_nonce",d),_.append("action","aipkit_content_writer_parse_csv");try{let u=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:_,credentials:"same-origin"});if(!u.ok)throw new Error(`Server returned status ${u.status}`);let f=await u.json();if(!f.success)throw new Error(f.data?.message||"Unknown server error.");let m=f.data;m.tasks_found>0?(a.value=m.formatted_data,o.textContent=`Success! Found ${m.tasks_found} tasks in the CSV file. Ready.`,o.className="aipkit_form-help aipkit_settings_message-success"):(a.value="",o.textContent="No valid tasks found in the CSV file.",o.className="aipkit_form-help aipkit_settings_message-error")}catch(u){a.value="",o.textContent=`Error: ${u.message||"Failed to parse CSV file."}`,o.className="aipkit_form-help aipkit_settings_message-error",console.error("CSV Parse Error:",u)}}function r(){let n=document.getElementById("aipkit_cw_csv_file_input");n&&n.dataset.listenerAttached!=="true"&&(n.addEventListener("change",c),n.dataset.listenerAttached="true")}function i(){let n=document.getElementById("aipkit_task_cw_csv_file_input");n&&n.dataset.listenerAttached!=="true"&&(n.addEventListener("change",c),n.dataset.listenerAttached="true")}window.aipkit_initCsvUploadHandler=r,window.aipkit_initTaskCsvUploadHandler=i})();(function(){"use strict";function c(r,i){let n=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!n||!n.value)throw new Error("Security token missing for stream. Please reload.");let t=new URL(window.aipkit_dashboard.ajaxurl);t.searchParams.append("action","aipkit_frontend_chat_stream"),t.searchParams.append("cache_key",r),t.searchParams.append("_ajax_nonce",n.value),i.current&&(console.log("EventSource Connection Setup: Closing previous EventSource connection."),i.current.close());try{let e=new EventSource(t.toString());return e.userStopped=!1,console.log("EventSource Connection Setup: EventSource created for URL:",t.toString()),e}catch(e){throw console.error("EventSource Connection Setup: EventSource creation error:",e),new Error("Could not connect to stream. "+e.message)}}window.aipkit_stream_setupEventSourceConnection=c})();(function(){"use strict";function c(r,i,n,t){if(r.data)try{let e=JSON.parse(r.data);if(e.delta){if(i.fullContent+=e.delta,t)n.innerHTML=t.render(i.fullContent);else{let a=n.textContent||"";n.textContent=a+e.delta}let o=n.parentElement;if(o){let a=n.lastElementChild;a?a.scrollIntoView({behavior:"auto",block:"end"}):o.scrollTop=o.scrollHeight}}}catch(e){console.error("Stream Message Handler: Error parsing event data.",e)}}window.aipkit_stream_handleMessage=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};async function r(i,n,t,e,o,a){if(n.isDone){console.log("Stream Done Handler: Already processed, ignoring duplicate 'done' event");return}n.isDone=!0,console.log("Stream Done Handler: DONE event received",i),e&&(t.innerHTML=e.render(n.fullContent)),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let s=document.getElementById("aipkit_content_writer_form"),l=s?s.elements.generate_meta_description:null,d=s?s.elements.generate_focus_keyword:null,p=s?s.elements.generate_excerpt:null,_=s?s.elements.generate_tags:null,u=document.getElementById("aipkit_content_writer_nonce")?.value,f=s.elements.ai_provider?.value,m=s.elements.ai_model?.value,g=s.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",k=document.getElementById("aipkit_cw_generated_title_display"),w=k?k.textContent:s.elements.content_title?.value.split("|")[0].trim()||"Untitled",b=s.elements.content_keywords?.value.trim()||"",y="",h=document.getElementById("aipkit_content_writer_title");if(h){let T=h.value.split("|")||[];T.length>1&&(y=T[1].trim())}let v=y||b,S=v;if(d?.checked&&!v&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let T={generated_content:n.fullContent,final_title:w,provider:f,model:m,prompt_mode:g,custom_keyword_prompt:s.elements.custom_keyword_prompt.value,_ajax_nonce:u},x=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",T);if(x&&x.focus_keyword){S=x.focus_keyword;let A=document.getElementById("aipkit_cw_generated_focus_keyword"),C=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");A&&C&&(A.value=S,C.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",T.message||"Failed")}}else if(v){let T=document.getElementById("aipkit_cw_generated_focus_keyword"),x=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");T&&x&&(T.value=v.split(",")[0].trim(),x.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let I=s?s.elements.generate_images_enabled:null,E=s?s.elements.generate_featured_image:null;if((I?.checked||E?.checked)&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating");try{let T={original_topic:h?h.value.split("|")[0].trim():w,final_title:w,keywords:S,generate_images_enabled:s.elements.generate_images_enabled?.checked?"1":"0",image_provider:s.elements.image_provider?.value,image_model:s.elements.image_model?.value,image_prompt:s.elements.image_prompt?.value,image_count:s.elements.image_count?.value,image_placement:s.elements.image_placement?.value,image_placement_param_x:s.elements.image_placement_param_x?.value,generate_featured_image:s.elements.generate_featured_image?.checked?"1":"0",featured_image_prompt:s.elements.featured_image_prompt?.value,pexels_orientation:s.elements.pexels_orientation?.value,pexels_size:s.elements.pexels_size?.value,pexels_color:s.elements.pexels_color?.value,pixabay_orientation:s.elements.pixabay_orientation?.value,pixabay_image_type:s.elements.pixabay_image_type?.value,pixabay_category:s.elements.pixabay_category?.value,_ajax_nonce:u},x=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",T);if(x&&x.image_data){let A=document.getElementById("aipkit_cw_image_data_holder");A&&(A.value=JSON.stringify(x.image_data)),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success")}else throw new Error("AI did not return any image data.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",T.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(p?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let T={generated_content:n.fullContent,final_title:w,keywords:S,provider:f,model:m,prompt_mode:g,custom_excerpt_prompt:s.elements.custom_excerpt_prompt.value,_ajax_nonce:u},x=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",T);if(x&&x.excerpt){let A=document.getElementById("aipkit_cw_generated_excerpt"),C=document.getElementById("aipkit_cw_excerpt_output_wrapper");A&&C&&(A.value=x.excerpt,C.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",T.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(_?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let T={generated_content:n.fullContent,final_title:w,keywords:S,provider:f,model:m,prompt_mode:g,custom_tags_prompt:s.elements.custom_tags_prompt.value,_ajax_nonce:u},x=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",T);if(x&&x.tags){let A=document.getElementById("aipkit_cw_generated_tags"),C=document.getElementById("aipkit_cw_tags_output_wrapper");A&&C&&(A.value=x.tags,C.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",T.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(l?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let T={generated_content:n.fullContent,final_title:w,keywords:S,provider:f,model:m,prompt_mode:g,custom_meta_prompt:s.elements.custom_meta_prompt.value,_ajax_nonce:u},x=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",T);if(x&&x.meta_description){let A=document.getElementById("aipkit_cw_generated_meta_desc"),C=document.getElementById("aipkit_cw_meta_desc_output_wrapper");A&&C&&(A.value=x.meta_description,C.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",T.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(a)}window.aipkit_stream_handleDone=r})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};function r(i,n,t,e,o){if(n.isDone){console.log("Stream Error Handler: Ignoring error event because stream is already done.");return}if(o.current&&o.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(o);return}let a="Error during streaming.";if(i.data)try{a=JSON.parse(i.data).error||a}catch{}console.error("Stream Error Handler: Error event received:",i),t&&(t.textContent=`Error: ${c(a)}`,t.className="aipkit_form-help aipkit_settings_message-error"),e&&e.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",a),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(o)}window.aipkit_stream_handleError=r})();(function(){"use strict";let c={current:null};function r(i,n){let t=document.getElementById("aipkit_content_writer_output_display"),e=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_content_writer_form_status");if(!t||!e||!o){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let a=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let l of a)if(typeof window[l]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${l}`),o&&(o.textContent=`Error: A required script component (${l}) is missing.`,o.className="aipkit_form-help aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let s={fullContent:"",isDone:!1};e.innerHTML="",t.classList.remove("aipkit_content_writer_output_error"),o&&(o.textContent="",o.className="aipkit_form-help"),window.aipkit_updateCwGenerationStatus("content","generating");try{n.current=window.aipkit_stream_setupEventSourceConnection(i,n);let l=window.aipkit_getMarkdownRenderer();n.current.onopen=function(){console.log("EventSource Orchestrator: Connection opened."),window.aipkit_updateCwGenerationStatus("content","generating")},n.current.onmessage=function(d){window.aipkit_stream_handleMessage(d,s,e,l)},n.current.addEventListener("done",function(d){window.aipkit_stream_handleDone(d,s,e,l,o,n)}),n.current.addEventListener("error",function(d){window.aipkit_stream_handleError(d,s,o,t,n)})}catch(l){console.error("EventSource Orchestrator: Error during setup:",l),o&&(o.textContent="Error: "+l.message,o.className="aipkit_form-help aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=r,window.aipkit_contentWriterEventSourceInstanceRef=c})();(function(){"use strict";function c(r){r&&r.current?(console.log("Content Writer Stop EventSource: Manually stopping stream by calling .close()."),r.current.close()):console.log("Content Writer Stop EventSource: No active stream to stop.")}window.aipkit_stopContentWriterEventSource=c})();(function(){"use strict";async function c(r){let i=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),t=document.getElementById("aipkit_content_writer_stop_btn"),e=document.getElementById("aipkit_content_writer_form_status"),o=document.getElementById("aipkit_cw_generated_content_area"),a=document.getElementById("aipkit_content_writer_copy_btn"),s=document.getElementById("aipkit_content_writer_clear_btn"),l=document.querySelector(".aipkit_content_writer_progress_bar_container"),d=document.querySelector(".aipkit_content_writer_output_actions");if(!i||!n||!t||!e||!o||!a||!s||!d){console.error("Handle SSE: Missing UI elements.");return}let p=new FormData(i),_=Object.fromEntries(p.entries());if(!_.content_title){e.textContent="Please enter a content title or topic.",e.className="aipkit_form-help aipkit_settings_message-error";return}let u=document.getElementById("aipkit_content_writer_nonce");if(u&&u.value)_._ajax_nonce=u.value;else{e.textContent="Error: Security token missing for stream initialization. Please reload.",e.className="aipkit_form-help aipkit_settings_message-error";return}if(window.aipkit_setLoadingStateOpenAI(n,!0,"Generate","Initializing..."),n.style.display="none",t.style.display="inline-flex",l&&(l.style.display="none"),d.style.display="none",o){let f=o.querySelector(".aipkit_cw_output_placeholder");f&&(f.style.display="none"),o.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'}a.disabled=!0,s.disabled=!0,typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),e.textContent="",e.className="aipkit_form-help";try{_.content_title=document.getElementById("aipkit_content_writer_title").value;let f=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",_);if(!f.cache_key)throw new Error(f.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=f.cache_key,typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(f.cache_key,r);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(f){console.error("Content Writer Init Stream Error:",f),e.textContent=`Error: ${f.message||"Failed to start generation."}`,e.className="aipkit_form-help aipkit_settings_message-error",window.aipkit_setLoadingStateOpenAI(n,!1,"Generate"),n.style.display="inline-flex",t.style.display="none",o&&(o.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};async function r(){let i=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),t=document.getElementById("aipkit_content_writer_stop_btn"),e=document.getElementById("aipkit_content_writer_form_status"),o=document.getElementById("aipkit_cw_generated_content_area"),a=document.getElementById("aipkit_content_writer_copy_btn"),s=document.getElementById("aipkit_content_writer_clear_btn"),l=document.querySelector(".aipkit_content_writer_progress_bar_container"),d=l?l.querySelector(".aipkit_content_writer_progress_bar"):null,p=document.querySelector(".aipkit_content_writer_output_actions"),_=document.getElementById("aipkit_cw_status_display_container");if(!i||!n||!t||!e||!o||!a||!s){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),e.textContent="Error: Essential script components missing.",e.className="aipkit_form-help aipkit_settings_message-error";return}let u=new FormData(i),f=Object.fromEntries(u.entries());if(!f.content_title){e.textContent="Please enter a content title or topic.",e.className="aipkit_form-help aipkit_settings_message-error",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let m=document.getElementById("aipkit_content_writer_nonce");if(m&&m.value)f._ajax_nonce=m.value;else{e.textContent="Error: Security token missing. Please reload.",e.className="aipkit_form-help aipkit_settings_message-error",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}_&&(_.style.display="block");let g=document.getElementById("aipkit_cw_generate_meta_desc"),k=document.getElementById("aipkit_cw_generate_focus_keyword"),w=document.getElementById("aipkit_cw_generate_excerpt"),b=document.getElementById("aipkit_cw_generate_tags");if(typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",w?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",b?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",g?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",k?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(n,!0,"Generate","Generating..."),t.style.display="none",p&&(p.style.display="none"),o){let y=o.querySelector(".aipkit_cw_output_placeholder");y&&(y.style.display="none"),o.innerHTML=""}a.disabled=!0,s.disabled=!0,typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),e.textContent="Generating content, please wait...",e.className="aipkit_form-help aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),l&&d&&(l.style.display="block",d.style.width="0%",d.classList.add("aipkit_indeterminate"));try{let y=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",f);if(y.content){let h=window.aipkit_getMarkdownRenderer();if(o&&(h?o.innerHTML=h.render(y.content):o.textContent=y.content),p&&(p.style.display="block"),e.textContent="Content generated successfully.",e.className="aipkit_form-help aipkit_settings_message-success",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),a.disabled=!1,s.disabled=!1,typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),y.content&&w?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let v={generated_content:y.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||f.content_title,provider:f.ai_provider,model:f.ai_model,prompt_mode:f.prompt_mode,custom_excerpt_prompt:f.custom_excerpt_prompt,_ajax_nonce:f._ajax_nonce},S=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",v);if(S&&S.excerpt){let I=document.getElementById("aipkit_cw_generated_excerpt"),E=document.getElementById("aipkit_cw_excerpt_output_wrapper");I&&E&&(I.value=S.excerpt,E.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(v){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",v.message||"Not returned")}}if(y.content&&b?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let v={generated_content:y.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||f.content_title,provider:f.ai_provider,model:f.ai_model,prompt_mode:f.prompt_mode,custom_tags_prompt:f.custom_tags_prompt,_ajax_nonce:f._ajax_nonce},S=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",v);if(S&&S.tags){let I=document.getElementById("aipkit_cw_generated_tags"),E=document.getElementById("aipkit_cw_tags_output_wrapper");I&&E&&(I.value=S.tags,E.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(v){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",v.message||"Not returned")}}if(y.meta_description){let v=document.getElementById("aipkit_cw_generated_meta_desc"),S=document.getElementById("aipkit_cw_meta_desc_output_wrapper");v&&S&&(v.value=y.meta_description,S.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else g?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(y.focus_keyword){let v=document.getElementById("aipkit_cw_generated_focus_keyword"),S=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");v&&S&&(v.value=y.focus_keyword,S.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else k?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(y.message||"No content received.")}catch(y){console.error("Content Writer AJAX Error:",y),e.textContent=`Error: ${c(y.message||"Failed to generate content.")}`,e.className="aipkit_form-help aipkit_settings_message-error",o&&(o.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",y.message),w?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),b?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),g?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),k?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),p&&(p.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(n,!1,"Generate"),l&&(l.style.display="none"),d&&d.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=r})();(function(){"use strict";function c(r){if(!r||!r.current){console.log("Handle Stop Generation: No active stream to stop."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let i=document.getElementById("aipkit_content_writer_form_status");r.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(r):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=c})();(function(){"use strict";function c(r,i,n,t){r&&(r.dataset.listenerAttached||(r.addEventListener("click",async()=>{if(r.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):alert("Upgrade URL not found. Please visit our website.");return}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let e=document.getElementById("aipkit_content_writer_form_status"),o=document.getElementById("aipkit_cw_status_display_container"),a=document.getElementById("aipkit_cw_generated_title_display"),s=document.getElementById("aipkit_content_writer_title");if((r.dataset.action||"generate_single")==="create_task"){o&&(o.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(i,r,e):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),e&&(e.textContent="Error: Task creation script missing.",e.className="aipkit_form-help aipkit_settings_message-error"));return}let d=document.getElementById("aipkit_cw_single_output_wrapper");d&&(d.style.display="block"),o&&(o.style.display="flex");let p=document.getElementById("aipkit_content_writer_stream_mode"),u=i.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),n.style.display="flex";let f={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[k,w]of Object.entries(f)){let b=document.getElementById(w);b&&!b.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(k,"skipped")}let m=document.getElementById("aipkit_cw_generate_images_enabled"),g=document.getElementById("aipkit_cw_generate_featured_image");if(m&&g&&!m.checked&&!g.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),u){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),a&&(a.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,"Generate","Generating Title...");let k=new FormData(i),w=Object.fromEntries(k.entries()),b=document.getElementById("aipkit_content_writer_nonce");w._ajax_nonce=b?b.value:"";let y=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",w);if(y&&y.new_title)a&&(a.textContent=y.new_title,a.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success"),e&&(e.textContent="Title generated. Proceeding to content...");else throw new Error(y.message||"Failed to generate new title.")}catch(k){console.error("Title Generation Error:",k),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",k.message),e&&(e.textContent=`Title Gen Error: ${k.message||"Unknown error"}`,e.className="aipkit_form-help aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),a&&s&&(a.textContent=s.value.split("|")[0].trim(),a.style.display="block");!p||p.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(t):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),r.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=c})();(function(){"use strict";function c(r,i){r&&(r.dataset.listenerAttached||(r.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(i):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),r.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=c})();(function(){"use strict";function c(r,i){if(r===i)return!0;if(r==null||typeof r!="object"||i==null||typeof i!="object")return!1;let n=Object.keys(r),t=Object.keys(i);if(n.length!==t.length)return!1;for(let e of n)if(!t.includes(e)||!c(r[e],i[e]))return!1;return!0}window.aipkit_deepEqual=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_content_writer_provider"),i=document.getElementById("aipkit_content_writer_temperature"),n=document.getElementById("aipkit_content_writer_post_author"),t=n?n.value:window.aipkit_dashboard?.currentUserId||"1",o=(r&&r.options.length>0?r.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),a=r?r.value.toLowerCase():o,s="",l=window.aipkit_dashboard?.models?.[a];switch(a){case"openai":s="gpt-4.1-mini";break;case"google":s="gemini-2.5-flash";break;case"openrouter":s="anthropic/claude-3.7-sonnet";break;case"azure":case"deepseek":Array.isArray(l)&&l.length>0?s=l[0].id||"":s="";break;default:s=""}let d=i&&i.defaultValue||"1.0",_=(window.aipkit_dashboard?.aiParams||{}).max_completion_tokens||"1500",u=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:a,ai_model:s,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:d,content_max_tokens:_,post_type:"post",post_author:t,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:u.title,custom_content_prompt:u.content,generate_meta_description:"1",custom_meta_prompt:u.meta,generate_focus_keyword:"1",custom_keyword_prompt:u.keyword,generate_excerpt:"1",custom_excerpt_prompt:u.excerpt,generate_tags:"1",custom_tags_prompt:u.tags,cw_generation_mode:"single",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"gpt-image-1",image_prompt:u.image||"A high-quality, relevant image for an article about: {topic}",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_featured_image:"0",featured_image_prompt:u.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=c})();(function(){"use strict";function c(r){let i={};if(!r)return i;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","rss_include_keywords","rss_exclude_keywords"].forEach(k=>{r.elements[k]&&(i[k]=r.elements[k].value)});let t=r.elements.generate_meta_description;t?i.generate_meta_description=t.checked?"1":"0":i.generate_meta_description="0";let e=r.elements.generate_focus_keyword;e?i.generate_focus_keyword=e.checked?"1":"0":i.generate_focus_keyword="0";let o=r.elements.generate_excerpt;o?i.generate_excerpt=o.checked?"1":"0":i.generate_excerpt="0";let a=r.elements.generate_tags;a?i.generate_tags=a.checked?"1":"0":i.generate_tags="0";let s=r.elements.generate_toc;s?i.generate_toc=s.checked?"1":"0":i.generate_toc="0";let l=r.elements.generate_seo_slug;l?i.generate_seo_slug=l.checked?"1":"0":i.generate_seo_slug="0";let d=r.elements.generate_images_enabled;d?i.generate_images_enabled=d.checked?"1":"0":i.generate_images_enabled="0";let p=r.elements.generate_featured_image;p?i.generate_featured_image=p.checked?"1":"0":i.generate_featured_image="0";let _=r.elements.enable_vector_store;_?i.enable_vector_store=_.checked?"1":"0":i.enable_vector_store="0";let u=r.elements["openai_vector_store_ids[]"];u?i.openai_vector_store_ids=Array.from(u.selectedOptions).map(k=>k.value):i.openai_vector_store_ids=[];let f=r.querySelector("#aipkit_cw_prompt_mode_hidden_input");f?i.prompt_mode=f.value:i.prompt_mode="custom";let m=r.querySelector("#aipkit_cw_generation_mode");i.cw_generation_mode=m?m.value:"single";let g=r.elements["post_categories[]"];return g?i.post_categories=Array.from(g.selectedOptions).map(k=>k.value):i.post_categories=[],i}window.aipkit_getContentWriterFormConfig=c})();(function(){"use strict";function c(r){return r&&r.parentElement&&r.parentElement.tagName.toLowerCase()==="optgroup"&&r.parentElement.label==="Defaults"}window.aipkit_isDefaultTemplateSelected=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_content_writer_post_status"),i=document.getElementById("aipkit_cw_schedule_options_wrapper"),n=document.getElementById("aipkit_cw_smart_schedule_fields"),t=document.querySelector(".aipkit_schedule_from_input_help"),e=document.querySelector(".aipkit_schedule_from_input_option");if(!r||!i)return;let o=r.value==="publish";i.style.display=o?"block":"none";let a=document.querySelector(".aipkit_cw_tab.aipkit_active"),s=a?a.dataset.mode:"single";if(e){let p=s==="rss";e.style.display=p?"none":"inline-flex";let _=e.querySelector('input[name="schedule_mode"]');if(p&&_&&_.checked){let u=document.querySelector('input[name="schedule_mode"][value="immediate"]');u&&(u.checked=!0,u.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(p=>{p.dataset.listenerAttached||(p.addEventListener("change",function(){n&&(n.style.display=this.value==="smart"?"block":"none"),t&&(t.style.display=this.value==="from_input"?"block":"none")}),p.dataset.listenerAttached="true")});let d=document.querySelector('input[name="schedule_mode"]:checked');d&&n&&(n.style.display=d.value==="smart"?"block":"none"),d&&t&&(t.style.display=d.value==="from_input"?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(n){return n};function r(){let n=document.getElementById("aipkit_cw_single_output_wrapper"),t=document.getElementById("aipkit_cw_generated_title_display"),e=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),a=document.querySelector(".aipkit_content_writer_output_actions");n&&(n.style.display="none"),t&&(t.style.display="none",t.textContent=""),e&&(e.innerHTML=`
            <div class="aipkit_cw_output_placeholder">
                <span class="dashicons dashicons-edit-large"></span>
                <span>Your article will appear here...</span>
            </div>`),o&&(o.style.display="none"),a&&(a.style.display="none")}function i(n,t=!1){let e=document.getElementById("aipkit_cw_template_status");window.aipkit_cw_template_state.currentTemplateId=n;let o=window.aipkit_cw_template_state.currentTemplates.find(y=>String(y.id)===String(n)),a;if(o)a=JSON.parse(JSON.stringify(o.config)),a.gsheets_credentials&&console.log("AIPKit DEBUG (apply-template): Applying gsheets_credentials from loaded template data:",a.gsheets_credentials);else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),e&&!t&&(e.textContent="Error: Cannot load default template.",e.className="aipkit_form-help aipkit_settings_message-error");return}a=window.aipkit_getDefaultContentWriterTemplateConfig()}window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(a)),window.aipkit_cw_template_state.currentTemplateModified=!1,r();let s=document.getElementById("aipkit_content_writer_form");if(!s){console.error("Apply Template: Content writer form not found.");return}a.ai_model&&s.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=a.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,console.log(`[apply-template] Applying template ID: ${n}. Pending image model set to:`,a.image_model),a.image_model&&s.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=a.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,["ai_provider","content_title","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","rss_include_keywords","rss_exclude_keywords"].forEach(y=>{let h=s.elements[y];if(h){let v=a[y]===null||typeof a[y]>"u"?"":a[y];if(y==="gsheets_credentials"&&typeof v=="object"&&v!==null)h.value=JSON.stringify(v,null,2);else if((y==="ai_temperature"||y==="content_max_tokens"||y==="vector_store_top_k")&&h.type==="range"){h.value=v||(y==="ai_temperature"?"1.0":y==="vector_store_top_k"?"3":"1500");let S=document.getElementById(h.id+"_value");S&&(S.textContent=h.value)}else h.type==="checkbox"?h.checked=v==="1":h.value=v;y==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields()}});let d=s.elements.gsheets_credentials;if(d){let y=a.gsheets_credentials,h=d.closest(".aipkit_gsheets_section_container");d.value=typeof y=="object"&&y!==null?JSON.stringify(y,null,2):y||"",d.value?(d.dataset.filename="credentials.json",h&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(h),100)):(delete d.dataset.filename,h&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(h,"clear"))}let p={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",enable_vector_store:"0"};for(let[y,h]of Object.entries(p)){let v=s.elements[y];v&&(v.checked=(a[y]||h)==="1")}let _=document.getElementById("aipkit_cw_prompt_mode_hidden_input");_&&(_.value=a.prompt_mode||"custom");let u=s.querySelector("#aipkit_cw_generation_mode"),f=a.cw_generation_mode||"single";u&&(u.value=f,typeof window.aipkit_initContentWriterTaskModeHandler=="function"&&u.dispatchEvent(new Event("change",{bubbles:!0})));let m=s.elements["post_categories[]"];if(m){let y=Array.isArray(a.post_categories)?a.post_categories.map(h=>String(h)):[];Array.from(m.options).forEach(h=>{h.selected=y.includes(h.value)})}let g=s.elements["openai_vector_store_ids[]"];if(g){let y=Array.isArray(a.openai_vector_store_ids)?a.openai_vector_store_ids.map(String):[];Array.from(g.options).forEach(h=>{h.selected=y.includes(h.value)})}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts();let k=s.elements.enable_vector_store;k&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(k.closest(".aipkit_accordion-content"));let w=s.elements.vector_store_provider;w&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(w.value=a.vector_store_provider||"openai",w.dispatchEvent(new Event("change",{bubbles:!0})));let b=s.elements.ai_provider;if(b){let y=b.value,h=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),v=(a.ai_provider||h).toLowerCase();if(y!==v)b.value=v,b.dispatchEvent(new Event("change",{bubbles:!0}));else{let S=s.elements.ai_model;S&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(b,S):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}}!t&&e&&(o&&n?(e.textContent=`Template "${c(o.template_name)}" applied.`,e.className="aipkit_form-help aipkit_settings_message-success"):n||(e.textContent="Form reset to defaults.",e.className="aipkit_form-help aipkit_settings_message-info"),setTimeout(()=>{e&&(e.textContent="",e.className="aipkit_form-help")},3e3)),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(n)}window.aipkit_applyContentWriterTemplate=i})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};async function r(i){if(!i){console.error("Fetch & Populate Templates: Select element is missing.");return}let n=document.getElementById("aipkit_cw_template_status"),t=document.getElementById("aipkit_content_writer_template_nonce_field");i.innerHTML=`<option value="">${c("Loading templates...")}</option>`,i.disabled=!0,n&&(n.textContent="",n.className="aipkit_form-help");try{let e=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:t?t.value:""});window.aipkit_cw_template_state.currentTemplates=e.templates||[],i.innerHTML="";let o=new Option(c("-- Select Template --"),"");i.appendChild(o);let a=null,s=document.createElement("optgroup");s.label=c("Defaults");let l=!1;window.aipkit_cw_template_state.currentTemplates.forEach(_=>{if(String(_.is_default)==="1"){a=_.id;let u=new Option(c(_.template_name),_.id);s.appendChild(u),l=!0}}),l&&i.appendChild(s);let d=window.aipkit_cw_template_state.currentTemplates.filter(_=>String(_.is_default)!=="1");if(d.length>0){let _=document.createElement("optgroup");_.label=c("My Templates"),d.forEach(u=>{let f=new Option(c(u.template_name),u.id);_.appendChild(f)}),i.appendChild(_)}i.disabled=!1;let p=sessionStorage.getItem("aipkit_cw_last_template_id");p&&i.querySelector(`option[value="${CSS.escape(p)}"]`)?(i.value=p,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(p,!0)):a?(i.value=a,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(a,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0)}catch(e){console.error("Error fetching templates:",e),i.innerHTML=`<option value="">${c("Error loading templates")}</option>`,n&&(n.textContent=`Error: ${e.message||"Failed to load templates."}`,n.className="aipkit_form-help aipkit_settings_message-error")}}window.aipkit_fetchAndPopulateTemplates=r})();(function(){"use strict";async function c(r,i,n){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let t=document.getElementById("aipkit_cw_template_status"),e=document.getElementById("aipkit_content_writer_template_nonce_field");t&&(t.textContent="Saving template...",t.className="aipkit_form-help aipkit_settings_message-info");try{let o=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:r,template_name:i,config:JSON.stringify(n),_ajax_nonce:e?e.value:""});t&&(t.textContent=o.message||"Template saved successfully.",t.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_form-help")},3e3)),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(o.template_config||n)),window.aipkit_cw_template_state.currentTemplateModified=!1;let a=document.getElementById("aipkit_cw_template_select");typeof window.aipkit_fetchAndPopulateTemplates=="function"&&a&&(await window.aipkit_fetchAndPopulateTemplates(a),o.template_id&&(a.value=o.template_id,window.aipkit_cw_template_state.currentTemplateId=o.template_id,sessionStorage.setItem("aipkit_cw_last_template_id",window.aipkit_cw_template_state.currentTemplateId))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}catch(o){console.error("Error saving template:",o),t&&(t.textContent=`Error: ${o.message||"Failed to save template."}`,t.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=c})();(function(){"use strict";function c(r){let i=document.getElementById("aipkit_cw_rename_template_btn"),n=document.getElementById("aipkit_cw_delete_template_btn"),t=document.getElementById("aipkit_cw_update_template_btn"),e=document.getElementById("aipkit_cw_template_select"),o=!1;if(e&&r){let s=e.querySelector(`option[value="${CSS.escape(r)}"]`);typeof window.aipkit_isDefaultTemplateSelected=="function"&&(o=window.aipkit_isDefaultTemplateSelected(s))}let a=r&&String(r)!==""&&!o;if(i&&(i.disabled=!a),n&&(n.disabled=!a),t){let s=a&&window.aipkit_cw_template_state.currentTemplateModified;t.disabled=!s}}window.aipkit_updateTemplateActionButtonsState=c})();(function(){"use strict";function c(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let i=window.aipkit_getContentWriterFormConfig(r),n=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(i,n),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=c})();(function(){"use strict";function c(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),alert("An error occurred. Please refresh the page.");return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};function r(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),n=i.value,t=i.options[i.selectedIndex],e=t?t.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),alert("An error occurred. Please refresh the page.");return}if(!n||n===""||window.aipkit_isDefaultTemplateSelected(t)){alert("Cannot rename the default template or no template is selected.");return}window.aipkit_showTemplateNameForm("rename",e)}window.aipkit_handleRenameContentWriterTemplate=r})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(i){return i};function r(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),n=i.value,t=i.options[i.selectedIndex],e=t?t.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),alert("Cannot delete: core function missing.");return}if(!n||n===""||window.aipkit_isDefaultTemplateSelected(t)){alert("Cannot delete the default template or no template is selected.");return}window.aipkit_showTemplateDeleteConfirm(e)}window.aipkit_handleDeleteContentWriterTemplate=r})();(function(){"use strict";function c(i,n=""){let t=document.querySelector(".aipkit_cw_template_select_group"),e=document.getElementById("aipkit_cw_template_inline_form"),o=document.getElementById("aipkit_cw_template_name_input");!t||!e||!o||(t.style.display="none",e.style.display="flex",e.dataset.mode=i,o.value=n,o.focus())}function r(){let i=document.querySelector(".aipkit_cw_template_select_group"),n=document.getElementById("aipkit_cw_template_inline_form"),t=document.getElementById("aipkit_cw_template_name_input");!i||!n||!t||(i.style.display="block",n.style.display="none",t.value="",delete n.dataset.mode)}window.aipkit_showTemplateNameForm=c,window.aipkit_hideTemplateNameForm=r})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(n){return n};function r(n){let t=document.querySelector(".aipkit_cw_template_select_group"),e=document.getElementById("aipkit_cw_template_inline_form"),o=document.getElementById("aipkit_cw_template_inline_delete_confirm"),a=document.getElementById("aipkit_cw_template_delete_confirm_text");!t||!e||!o||!a||(t.style.display="none",e.style.display="none",o.style.display="flex",a.innerHTML=`Delete "<strong>${c(n)}</strong>"?`)}function i(){let n=document.querySelector(".aipkit_cw_template_select_group"),t=document.getElementById("aipkit_cw_template_inline_delete_confirm");!n||!t||(n.style.display="block",t.style.display="none")}window.aipkit_showTemplateDeleteConfirm=r,window.aipkit_hideTemplateDeleteConfirm=i})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_cw_template_save_inline_btn"),i=document.getElementById("aipkit_cw_template_cancel_inline_btn"),n=document.getElementById("aipkit_cw_template_inline_form"),t=document.getElementById("aipkit_cw_template_name_input");if(!r||!i||!n||!t){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}i.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),r.addEventListener("click",async()=>{let e=n.dataset.mode,o=t.value.trim();if(!o){alert("Please enter a template name.");return}let a=document.getElementById("aipkit_content_writer_form"),s=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let l=window.aipkit_getContentWriterFormConfig(a);if(e==="new")await window.aipkit_saveContentWriterTemplate(0,o,l);else if(e==="rename"){let d=s.value;d&&await window.aipkit_saveContentWriterTemplate(parseInt(d),o,l)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_cw_template_confirm_delete_btn"),i=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!r||!i){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}i.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),r.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let n=document.getElementById("aipkit_cw_template_select"),t=n.value,e=document.getElementById("aipkit_cw_template_status"),o=document.getElementById("aipkit_content_writer_template_nonce_field");window.aipkit_cw_template_state.isSavingOrDeleting=!0,e&&(e.textContent="Deleting...",e.className="aipkit_form-help aipkit_settings_message-info");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:t,_ajax_nonce:o?o.value:""}),e&&(e.textContent="Template deleted.",e.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{e&&(e.textContent="",e.className="aipkit_form-help")},3e3)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(n)}catch(a){console.error("Error deleting template:",a),e&&(e.textContent=`Error: ${a.message||"Failed to delete template."}`,e.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_cw_template_select");if(!r){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(r):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?r.addEventListener("change",i=>window.aipkit_applyContentWriterTemplate(i.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_cw_save_as_template_btn");if(!r){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_cw_update_template_btn"),i=document.getElementById("aipkit_cw_template_select"),n=document.getElementById("aipkit_content_writer_form");if(!r||!i||!n){console.warn("bindUpdateTemplateBtn: Required elements (button, select, form) not found.");return}typeof window.aipkit_saveContentWriterTemplate=="function"&&typeof window.aipkit_getContentWriterFormConfig=="function"?r.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting||!window.aipkit_cw_template_state.currentTemplateId)return;let t=i.options[i.selectedIndex],e=t?t.text:"Untitled Template",o=window.aipkit_getContentWriterFormConfig(n);await window.aipkit_saveContentWriterTemplate(parseInt(window.aipkit_cw_template_state.currentTemplateId),e,o)}):console.error("bindUpdateTemplateBtn: Missing saveContentWriterTemplate or getContentWriterFormConfig function.")}window.aipkit_bindUpdateTemplateBtn=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_cw_rename_template_btn");if(!r){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_cw_delete_template_btn");if(!r){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?r.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=c})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_content_writer_post_status");if(!r){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(r.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=c})();(function(){"use strict";function c(){let r=document.querySelector(".aipkit_content_writer_inputs");if(!r){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(r.addEventListener("input",window.aipkit_checkFormForModifications),r.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=c})();(function(){"use strict";function c(){let r=["aipkit_initTemplateSelect","aipkit_bindSaveAsTemplateBtn","aipkit_bindUpdateTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let n of r)if(typeof window[n]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${n}`);return}window.aipkit_initTemplateSelect(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindUpdateTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let i=document.getElementById("aipkit_cw_template_select");i&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(i.value):i&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set."),console.log("AIPKit Content Writer: Full Template Handler System Initialized.")}window.aipkit_initContentWriterTemplateHandler=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(n){return n};function r(){let n=document.getElementById("aipkit_cw_save_as_post_btn");if(!n){console.warn("Save as Post Handler: Button not found.");return}n.addEventListener("click",i),console.log("AIPKit Content Writer: Save as Post Handler Initialized.")}async function i(){let n=document.getElementById("aipkit_content_writer_form"),t=document.getElementById("aipkit_cw_save_as_post_btn"),e=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_content_writer_output_display"),a=document.getElementById("aipkit_cw_save_post_status");if(!n||!t||!e||!o||!a){console.error("Save as Post: Missing required UI elements.");return}let s=e.innerHTML;if(e.textContent.trim()===""||e.textContent.trim()==="Your article will appear here..."){a&&(a.textContent="Nothing to save. Please generate content first.",a.className="aipkit_form-help aipkit_settings_message-error");return}let l=document.getElementById("aipkit_cw_generated_title_display"),d={post_title:l?l.textContent:"Untitled AI Post",post_content:s,generated_excerpt:n.elements.generated_excerpt?.value||"",generated_tags:n.elements.generated_tags?.value||"",meta_description:n.elements.meta_description?n.elements.meta_description.value:"",focus_keyword:n.elements.focus_keyword?n.elements.focus_keyword.value:"",post_type:n.elements.post_type?n.elements.post_type.value:"post",post_author:n.elements.post_author?n.elements.post_author.value:1,post_status:n.elements.post_status?n.elements.post_status.value:"draft",post_schedule_date:n.elements.post_schedule_date?n.elements.post_schedule_date.value:"",post_schedule_time:n.elements.post_schedule_time?n.elements.post_schedule_time.value:"",post_categories:n.elements["post_categories[]"]?Array.from(n.elements["post_categories[]"].selectedOptions).map(p=>p.value):[],generate_toc:n.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:n.elements.image_alignment?n.elements.image_alignment.value:"none",image_size:n.elements.image_size?n.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};a&&(a.textContent="Saving post...",a.className="aipkit_form-help aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(t,!0,"Save","Saving...");try{console.log("AIPKit Save as Post Debug: Sending data to backend:",d);let p=await window.aipkit_apiRequest("aipkit_content_writer_save_post",d);a&&(a.textContent=p.message||"Post saved successfully!",a.className="aipkit_form-help aipkit_settings_message-success",p.edit_link&&(a.innerHTML+=` <a href="${c(p.edit_link)}" target="_blank">Edit Post</a>`))}catch(p){console.error("Error saving post:",p),a&&(a.textContent=`Error: ${p.message||"Failed to save post."}`,a.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(t,!1,"Save as Post"),setTimeout(()=>{a&&(a.textContent="",a.className="aipkit_form-help")},5e3)}}window.aipkit_initSaveAsPostButton=r})();(function(){"use strict";function c(){let r=document.getElementById("aipkit_content_writer_container");if(!r){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let i=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),t=document.getElementById("aipkit_content_writer_stop_btn"),e=document.getElementById("aipkit_content_writer_copy_btn"),o=document.getElementById("aipkit_content_writer_clear_btn"),a=document.getElementById("aipkit_content_writer_provider"),s=document.getElementById("aipkit_content_writer_model"),l=document.getElementById("aipkit_content_writer_temperature"),d=document.getElementById("aipkit_content_writer_max_tokens"),p=document.getElementById("aipkit_cw_save_as_post_btn"),_=document.querySelector(".aipkit_cw_generation_status_indicators");if(!i||!n||!t||!e||!o||!a||!s||!l||!d||!p||!_){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(r):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_initAiSettingsToggle=="function"?window.aipkit_initAiSettingsToggle():console.error("Content Writer Main: aipkit_initAiSettingsToggle function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(a,s,l,d,n,e,o):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let u=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;u&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():u&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),u&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():u&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(n,i,_,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(t,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){p&&(p.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){p&&(p.disabled=!0)},window.aipkit_disableSaveAsPostButton(),console.log("AIPKit Content Writer: Main Module Initialized.")}window.aipkit_initContentWriter=c})();(function(){"use strict";let c=!1,r="aipkit_image_gen_preview_theme",i=["dark","light"];function n(){let p=document.getElementById("aipkit_image_generator_container");if(!p){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(p.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(u){console.error("AIPKit Image Generator: Error calling public UI initializer:",u);let f=document.getElementById("aipkit_public_image_results");f&&(f.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let u=document.getElementById("aipkit_public_image_results");u&&(u.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}l(p),a(p),t()}function t(){let p=document.getElementById("image-settings-content");if(!p)return;typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),p.querySelectorAll(".aipkit_accordion-group").forEach(m=>{let g="data-accordion-listener-added";m.hasAttribute(g)||(m.addEventListener("click",function(k){let w=k.target.closest(".aipkit_accordion-header");if(!w)return;let b=w.nextElementSibling;!b||!b.classList.contains("aipkit_accordion-content")||(m.querySelectorAll(".aipkit_accordion-content").forEach(y=>{y!==b&&y.classList.contains("aipkit_active")&&(y.classList.remove("aipkit_active"),y.previousElementSibling?.classList.remove("aipkit_active"))}),w.classList.toggle("aipkit_active"),b.classList.toggle("aipkit_active"))}),m.setAttribute(g,"true"))});let u="data-token-listener-attached";p.hasAttribute(u)||(p.addEventListener("change",function(m){m.target.closest(".aipkit_token_limit_mode_select")&&e(p)}),p.setAttribute(u,"true"),e(p));let f=p.querySelector("#aipkit_save_image_settings_btn");f&&!f.hasAttribute("data-listener-added")&&(f.addEventListener("click",o),f.setAttribute("data-listener-added","true"))}function e(p){if(!p)return;let _=p.querySelector(".aipkit_token_limit_mode_select"),u=p.querySelector(".aipkit_token_general_user_limit_field"),f=p.querySelector(".aipkit_token_role_limits_container");if(!_||!u||!f){document.querySelector('.aipkit_accordion[data-section="token-management"]');return}let m=_.value;u.style.display=m==="general"?"block":"none",f.style.display=m==="role_based"?"block":"none"}function o(p){p.preventDefault();let _=p.currentTarget,u=document.querySelector("#image-settings-content form"),f=document.getElementById("aipkit_image_settings_save_status"),m=_.querySelector(".aipkit_spinner");if(!u||!f||c)return;c=!0,_.disabled=!0,m&&(m.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Saving..."),f.textContent="",f.className="aipkit_form-help";let g=new FormData(u),k=u.querySelector('input[name="_ajax_nonce"]');if(!k||!k.value){typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(f,"error","Security check failed (Nonce missing). Please reload."),c=!1,_.disabled=!1,m&&(m.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Save Image Settings");return}window.aipkit_apiRequest("aipkit_save_image_settings",Object.fromEntries(g.entries())).then(w=>{typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(f,"success",w.message||"Settings saved!")}).catch(w=>{typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(f,"error","Save failed: "+w.message)}).finally(()=>{c=!1,_.disabled=!1,m&&(m.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Save Image Settings")})}function a(p){let _=p.querySelector("#aipkit_theme_switcher_toggle_btn"),u=p.querySelector("#generator-content .aipkit_image_generator_admin_preview_wrapper");if(!_||!u){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",p);return}let f=i.indexOf(localStorage.getItem(r)||"dark");f===-1&&(f=i.indexOf("dark")),s(i[f],u,_),_.hasAttribute("data-listener-attached")||(_.addEventListener("click",function(){f=(f+1)%i.length;let m=i[f];s(m,u,_),localStorage.setItem(r,m)}),_.setAttribute("data-listener-attached","true"))}function s(p,_,u){let f=_.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");f&&(i.forEach(k=>f.classList.remove(`aipkit-theme-${k}`)),f.classList.add(`aipkit-theme-${p}`));let m=p.charAt(0).toUpperCase()+p.slice(1),g="Toggle Preview Theme";u.title=`${g} (Current: ${m})`}function l(p){let _=p.querySelector("#aipkit_image_generator_shortcode_snippet"),u=p.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),f=p.querySelector("#aipkit_image_generator_shortcode_configurator"),m=p.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!_||!u||!f||m.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",p);return}u.hasAttribute("data-listener-attached")||(u.addEventListener("click",()=>{let g=f.style.display==="none"||!f.style.display;f.style.display=g?"block":"none",u.classList.toggle("aipkit_active",g),u.setAttribute("aria-expanded",g.toString())}),m.forEach(g=>g.addEventListener("change",()=>d(p))),_.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(_.textContent,_):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),d(p),u.setAttribute("data-listener-attached","true"))}function d(p){let _=p.querySelector("#aipkit_image_generator_shortcode_snippet"),u=p.querySelector("#aipkit_image_generator_shortcode_configurator");if(!_||!u)return;let f=u.querySelector('input[name="cfg_show_provider"]').checked,m=u.querySelector('input[name="cfg_show_model"]').checked,g=u.querySelector('input[name="cfg_show_history"]').checked,k=u.querySelector('input[name="cfg_theme"]:checked'),w=k?k.value:"dark",b="[aipkit_image_generator";f||(b+=' show_provider="false"'),m||(b+=' show_model="false"'),g&&(b+=' history="true"'),w!=="dark"&&(b+=` theme="${w}"`),b+="]",_.textContent=b}window.aipkit_initImageGenerator=n})();(function(){"use strict";function c(r,i,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof i=="function"&&i(new Error("API function missing."),null,n);return}let t=window.aipkit_post_enhancer,e=t?.nonce_generate_title,o=t?.text||{};if(!e){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof i=="function"&&i(new Error("Configuration missing (nonce)."),null,n);return}let a={_ajax_nonce:e,post_id:r};window.aipkit_apiRequest("aipkit_generate_title_suggestions",a).then(s=>{if(!s?.suggestions||s.suggestions.length===0)throw new Error(o.no_suggestions_title||"No title suggestions generated.");typeof i=="function"&&i(null,s.suggestions,n)}).catch(s=>{console.error("AIPKit Post Enhancer Fetcher (Title):",s),typeof i=="function"&&i(s,null,n)})}window.aipkit_fetchTitleSuggestions=c})();(function(){"use strict";let c=null;function r(){c&&(c.classList.remove("aipkit-active"),c.addEventListener("transitionend",()=>{c?.parentNode&&c.parentNode.removeChild(c),c=null},{once:!0}),setTimeout(()=>{c?.parentNode&&c.parentNode.removeChild(c),c=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function i(e,o,a){c&&r();let s=window.aipkit_escapeHtml||function(k){return k},l=window.aipkit_escapeAttribute||s,d=a?.default_ai_provider||"N/A",p=a?.default_ai_model||"N/A",_=a?.default_ai_params||{},u=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(o.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${s(d)}</strong>`).replace("%2$s",`<strong>${s(p)}</strong>`).replace("%3$s",s(u));c=document.createElement("div"),c.className="aipkit-modal-overlay",c.addEventListener("click",k=>{k.target===c&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=e,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${s(o.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${l(o.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${s(o.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,c.appendChild(g),document.body.appendChild(c),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{c.classList.add("aipkit-active")}),c}function n(e,o){if(!c)return;let a=c.querySelector(".aipkit-modal-body");if(!a)return;let s=window.aipkit_escapeHtml||function(p){return p},l=window.aipkit_escapeAttribute||s;a.innerHTML=`
            <p>${s(o.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${e.map(p=>`<li data-new-title="${l(p)}">${s(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let d=a.querySelector(".aipkit-suggestions-list");d&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(d):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function t(e,o){if(!c)return;let a=c.querySelector(".aipkit-modal-body");if(!a)return;let s=window.aipkit_escapeHtml||function(l){return l};a.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${s(o.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${s(e)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=i,window.aipkit_updateModalWithSuggestions=n,window.aipkit_updateModalWithError=t,window.aipkit_closePostTitleModal=r})();(function(){"use strict";let c=!1;function r(){c=!1}function i(e){if(c)return;c=!0;let o=e.currentTarget,a=o.closest(".aipkit-modal-content"),s=a?.dataset.postId,l=o.dataset.newTitle,d=a?.querySelector(".aipkit-modal-status"),p=a?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!s||!l||!d||!p){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),d&&(d.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),c=!1;return}p.forEach(u=>u.classList.add("aipkit-disabled")),d.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_title||"Updating Title..."}`,d.style.color="",n(s,l,d,p,_)}function n(e,o,a,s,l){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),a.innerHTML='<span class="error">Error: Configuration missing.</span>',s.forEach(_=>_.classList.remove("aipkit-disabled")),c=!1;return}let d=window.aipkit_post_enhancer?.nonce_update_title;if(!d){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),a.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',s.forEach(_=>_.classList.remove("aipkit-disabled")),c=!1;return}let p={_ajax_nonce:d,post_id:e,new_value:o};window.aipkit_apiRequest("aipkit_update_post_title",p).then(_=>{let u=document.querySelector(`#post-${e} .row-title`);u?u.textContent=o:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${e}.`);let f=document.getElementById(`post-${e}`);if(f){let m=f.querySelector(`#inline_${e}`);if(m){let g=m.querySelector(".post_title");g?g.textContent=o:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${e}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${e}.`)}window.aipkit_closePostTitleModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Title):",_),a.innerHTML=`<span class="error">${_.message||l.error_updating_title||"Error updating title."}</span>`,s.forEach(u=>u.classList.remove("aipkit-disabled"))}).finally(()=>{c=!1})}function t(e){e&&e.addEventListener("click",function(o){let a=o.target.closest("li[data-new-title]");a&&i({currentTarget:a})})}window.aipkit_attachSuggestionClickListener=t,window.aipkit_resetTitleUpdateFlag=r})();(function(){"use strict";function c(r,i,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof i=="function"&&i(new Error("API function missing."),null,n);return}let t=window.aipkit_post_enhancer,e=t?.nonce_generate_excerpt,o=t?.text||{};if(!e){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof i=="function"&&i(new Error("Configuration missing (nonce)."),null,n);return}let a={_ajax_nonce:e,post_id:r};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",a).then(s=>{if(!s?.suggestions||s.suggestions.length===0)throw new Error(o.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof i=="function"&&i(null,s.suggestions,n)}).catch(s=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",s),typeof i=="function"&&i(s,null,n)})}window.aipkit_fetchExcerptSuggestions=c})();(function(){"use strict";let c=null;function r(){c&&(c.classList.remove("aipkit-active"),c.addEventListener("transitionend",()=>{c?.parentNode&&c.parentNode.removeChild(c),c=null},{once:!0}),setTimeout(()=>{c?.parentNode&&c.parentNode.removeChild(c),c=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function i(e,o,a){c&&r();let s=window.aipkit_escapeHtml||function(k){return k},l=window.aipkit_escapeAttribute||s,d=a?.default_ai_provider||"N/A",p=a?.default_ai_model||"N/A",_=a?.default_ai_params||{},u=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(o.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${s(d)}</strong>`).replace("%2$s",`<strong>${s(p)}</strong>`).replace("%3$s",s(u));c=document.createElement("div"),c.className="aipkit-modal-overlay",c.addEventListener("click",k=>{k.target===c&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=e,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${s(o.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${l(o.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${s(o.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,c.appendChild(g),document.body.appendChild(c),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{c.classList.add("aipkit-active")}),c}function n(e,o){if(!c)return;let a=c.querySelector(".aipkit-modal-body");if(!a)return;let s=window.aipkit_escapeHtml||function(p){return p},l=window.aipkit_escapeAttribute||s;a.innerHTML=`
            <p>${s(o.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${e.map(p=>`<li data-new-excerpt="${l(p)}">${s(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let d=a.querySelector(".aipkit-suggestions-list");d&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(d):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function t(e,o){if(!c)return;let a=c.querySelector(".aipkit-modal-body");if(!a)return;let s=window.aipkit_escapeHtml||function(l){return l};a.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${s(o.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${s(e)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=i,window.aipkit_updateModalWithExcerptSuggestions=n,window.aipkit_updateModalWithErrorExcerpt=t,window.aipkit_closePostExcerptModal=r})();(function(){"use strict";let c=!1;function r(){c=!1}function i(e){if(c)return;c=!0;let o=e.currentTarget,a=o.closest(".aipkit-modal-content"),s=a?.dataset.postId,l=o.dataset.newExcerpt,d=a?.querySelector(".aipkit-modal-status"),p=a?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!s||l===void 0||!d||!p){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:s,newExcerpt:l,statusDiv:d,listItems:p}),d&&(d.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),c=!1;return}p.forEach(u=>u.classList.add("aipkit-disabled")),d.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_excerpt||"Updating Excerpt..."}`,d.style.color="",n(s,l,d,p,_)}function n(e,o,a,s,l){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),a.innerHTML='<span class="error">Error: Configuration missing.</span>',s.forEach(_=>_.classList.remove("aipkit-disabled")),c=!1;return}let d=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!d){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),a.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',s.forEach(_=>_.classList.remove("aipkit-disabled")),c=!1;return}let p={_ajax_nonce:d,post_id:e,new_value:o};window.aipkit_apiRequest("aipkit_update_post_excerpt",p).then(_=>{window.aipkit_closePostExcerptModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",_),a.innerHTML=`<span class="error">${_.message||l.error_updating_excerpt||"Error updating excerpt."}</span>`,s.forEach(u=>u.classList.remove("aipkit-disabled"))}).finally(()=>{c=!1})}function t(e){e&&e.addEventListener("click",function(o){let a=o.target.closest("li[data-new-excerpt]");a&&i({currentTarget:a})})}window.aipkit_attachExcerptSuggestionClickListener=t,window.aipkit_resetExcerptUpdateFlag=r})();(function(){"use strict";function c(r,i,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof i=="function"&&i(new Error("API function missing."),null,n);return}let t=window.aipkit_post_enhancer,e=t?.nonce_generate_meta,o=t?.text||{};if(!e){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof i=="function"&&i(new Error("Configuration missing (nonce)."),null,n);return}let a={_ajax_nonce:e,post_id:r};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",a).then(s=>{if(!s?.suggestions||s.suggestions.length===0)throw new Error(o.no_suggestions_meta||"No meta description suggestions generated.");typeof i=="function"&&i(null,s.suggestions,n)}).catch(s=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",s),typeof i=="function"&&i(s,null,n)})}window.aipkit_fetchMetaSuggestions=c})();(function(){"use strict";let c=null;function r(){c&&(c.classList.remove("aipkit-active"),c.addEventListener("transitionend",()=>{c?.parentNode&&c.parentNode.removeChild(c),c=null},{once:!0}),setTimeout(()=>{c?.parentNode&&c.parentNode.removeChild(c),c=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function i(e,o,a){c&&r();let s=window.aipkit_escapeHtml||function(k){return k},l=window.aipkit_escapeAttribute||s,d=a?.default_ai_provider||"N/A",p=a?.default_ai_model||"N/A",_=a?.default_ai_params||{},u=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(o.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${s(d)}</strong>`).replace("%2$s",`<strong>${s(p)}</strong>`).replace("%3$s",s(u));c=document.createElement("div"),c.className="aipkit-modal-overlay",c.addEventListener("click",k=>{k.target===c&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=e,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${s(o.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${l(o.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${s(o.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,c.appendChild(g),document.body.appendChild(c),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>{c.classList.add("aipkit-active")}),c}function n(e,o){if(!c)return;let a=c.querySelector(".aipkit-modal-body");if(!a)return;let s=window.aipkit_escapeHtml||function(p){return p},l=window.aipkit_escapeAttribute||s;a.innerHTML=`
            <p>${s(o.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${e.map(p=>`<li data-new-meta="${l(p)}">${s(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let d=a.querySelector(".aipkit-suggestions-list");d&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(d):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function t(e,o){if(!c)return;let a=c.querySelector(".aipkit-modal-body");if(!a)return;let s=window.aipkit_escapeHtml||function(l){return l};a.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${s(o.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${s(e)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=i,window.aipkit_updateModalWithMetaSuggestions=n,window.aipkit_updateModalWithErrorMeta=t,window.aipkit_closePostMetaModal=r})();(function(){"use strict";let c=!1;function r(){c=!1}function i(e){if(c)return;c=!0;let o=e.currentTarget,a=o.closest(".aipkit-modal-content"),s=a?.dataset.postId,l=o.dataset.newMeta,d=a?.querySelector(".aipkit-modal-status"),p=a?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!s||l===void 0||!d||!p){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:s,newMetaDesc:l,statusDiv:d,listItems:p}),d&&(d.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),c=!1;return}p.forEach(u=>u.classList.add("aipkit-disabled")),d.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_meta||"Updating Meta Desc..."}`,d.style.color="",n(s,l,d,p,_)}function n(e,o,a,s,l){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),a.innerHTML='<span class="error">Error: Configuration missing.</span>',s.forEach(_=>_.classList.remove("aipkit-disabled")),c=!1;return}let d=window.aipkit_post_enhancer?.nonce_update_meta;if(!d){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),a.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',s.forEach(_=>_.classList.remove("aipkit-disabled")),c=!1;return}let p={_ajax_nonce:d,post_id:e,new_value:o};window.aipkit_apiRequest("aipkit_update_post_meta_desc",p).then(_=>{try{let m=`${`#post-${e}`} .column-wpseo-metadesc`,g=document.querySelector(m);g?(g.textContent=window.aipkit_escapeHtml(o),g.style.transition="background-color 0.1s ease-out",g.style.backgroundColor="#f0f7ff",setTimeout(()=>{g.style.backgroundColor=""},300)):console.log(`AIPKit Post Enhancer UI Update: Yoast meta column cell (${m}) not found in the DOM. It might be hidden or Yoast is inactive.`)}catch(u){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",u)}window.aipkit_closePostMetaModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Meta):",_),a.innerHTML=`<span class="error">${_.message||l.error_updating_meta||"Error updating meta description."}</span>`,s.forEach(u=>u.classList.remove("aipkit-disabled"))}).finally(()=>{c=!1})}function t(e){e&&e.addEventListener("click",function(o){let a=o.target.closest("li[data-new-meta]");a&&i({currentTarget:a})})}window.aipkit_attachMetaSuggestionClickListener=t,window.aipkit_resetMetaUpdateFlag=r})();(function(){"use strict";function c(r,i,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof i=="function"&&i(new Error("API function missing."),null,n);return}let t=window.aipkit_post_enhancer,e=t?.nonce_generate_tags,o=t?.text||{};if(!e){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof i=="function"&&i(new Error("Configuration missing (nonce)."),null,n);return}let a={_ajax_nonce:e,post_id:r};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",a).then(s=>{if(!s?.suggestions||s.suggestions.length===0)throw new Error(o.no_suggestions_tags||"No tag suggestions generated.");typeof i=="function"&&i(null,s.suggestions,n)}).catch(s=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",s),typeof i=="function"&&i(s,null,n)})}window.aipkit_fetchTagsSuggestions=c})();(function(){"use strict";let c=null;function r(){c&&(c.classList.remove("aipkit-active"),c.addEventListener("transitionend",()=>{c?.parentNode&&c.parentNode.removeChild(c),c=null},{once:!0}),setTimeout(()=>{c?.parentNode&&c.parentNode.removeChild(c),c=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function i(e,o,a){c&&r();let s=window.aipkit_escapeHtml||(k=>k),l=window.aipkit_escapeAttribute||s,d=a?.default_ai_provider||"N/A",p=a?.default_ai_model||"N/A",_=a?.default_ai_params||{},u=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(o.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${s(d)}</strong>`).replace("%2$s",`<strong>${s(p)}</strong>`).replace("%3$s",s(u));c=document.createElement("div"),c.className="aipkit-modal-overlay",c.addEventListener("click",k=>{k.target===c&&r()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=e,g.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${s(o.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${l(o.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${s(o.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${m}</p>
            </div>
        </div>
    `,c.appendChild(g),document.body.appendChild(c),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),requestAnimationFrame(()=>c.classList.add("aipkit-active")),c}function n(e,o){if(!c)return;let a=c.querySelector(".aipkit-modal-body");if(!a)return;let s=window.aipkit_escapeHtml||(p=>p),l=window.aipkit_escapeAttribute||s;a.innerHTML=`
        <p>${s(o.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${e.map(p=>`<li data-new-tags="${l(p)}">${s(p)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let d=a.querySelector(".aipkit-suggestions-list");d&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(d):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function t(e,o){if(!c)return;let a=c.querySelector(".aipkit-modal-body");if(!a)return;let s=window.aipkit_escapeHtml||(l=>l);a.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${s(o.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${s(e)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=i,window.aipkit_updateModalWithTagsSuggestions=n,window.aipkit_updateModalWithErrorTags=t,window.aipkit_closePostTagsModal=r})();(function(){"use strict";let c=!1;function r(){c=!1}function i(e){if(c)return;c=!0;let o=e.currentTarget,a=o.closest(".aipkit-modal-content"),s=a?.dataset.postId,l=o.dataset.newTags,d=a?.querySelector(".aipkit-modal-status"),p=a?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!s||l===void 0||!d||!p){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:s,newTags:l,statusDiv:d,listItems:p}),d&&(d.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),c=!1;return}p.forEach(u=>u.classList.add("aipkit-disabled")),d.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_tags||"Updating Tags..."}`,d.style.color="",n(s,l,d,p,_)}function n(e,o,a,s,l){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),a.innerHTML='<span class="error">Error: Configuration missing.</span>',s.forEach(_=>_.classList.remove("aipkit-disabled")),c=!1;return}let d=window.aipkit_post_enhancer?.nonce_update_tags;if(!d){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),a.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',s.forEach(_=>_.classList.remove("aipkit-disabled")),c=!1;return}let p={_ajax_nonce:d,post_id:e,new_value:o};window.aipkit_apiRequest("aipkit_update_post_tags",p).then(_=>{let u=document.getElementById(`post-${e}`);if(u){let f=u.querySelector(".column-tags");f&&(f.textContent=o.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Tags):",_),a.innerHTML=`<span class="error">${_.message||l.error_updating_tags||"Error updating tags."}</span>`,s.forEach(u=>u.classList.remove("aipkit-disabled"))}).finally(()=>{c=!1})}function t(e){e&&e.addEventListener("click",function(o){let a=o.target.closest("li[data-new-tags]");a&&i({currentTarget:a})})}window.aipkit_attachTagsSuggestionClickListener=t,window.aipkit_resetTagsUpdateFlag=r})();(function(){"use strict";function c(r,i,n){let e=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorTags(r.message||e.error_loading_tags,e):i?window.aipkit_updateModalWithTagsSuggestions(i,e):window.aipkit_updateModalWithErrorTags(e.error_loading_tags||"Unknown error occurred.",e)}window.aipkit_handleTagsSuggestionsResult=c})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function c(i,n="info"){let t=document.getElementById("aipkit-enhancer-bulk-status-log");if(t){let e=document.createElement("div");e.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${n}`,e.textContent=i,t.appendChild(e),t.scrollTop=t.scrollHeight}}function r(){let i=document.getElementById("aipkit-enhancer-bulk-progress-bar");if(i&&window.aipkit_enhancer_bulkState.total>0){let n=(window.aipkit_enhancer_bulkState.completed+window.aipkit_enhancer_bulkState.failed)/window.aipkit_enhancer_bulkState.total*100;i.style.width=`${n}%`}}window.aipkit_enhancer_logToModal=c,window.aipkit_enhancer_updateProgressBar=r})();(function(){"use strict";function c(r="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let i=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!i)return;r==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let n=i.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");n&&(n.textContent="Start"),i.querySelector("#aipkit_bulk_enhancer_start_btn").disabled=!1,i.querySelector("#aipkit_bulk_enhancer_stop_btn").style.display="none",i.querySelector("#aipkit_bulk_enhancer_cancel_btn").style.display="inline-flex"}window.aipkit_enhancer_stopBulkProcess=c})();(function(){"use strict";function c(r,i){let n=r.value.toLowerCase(),e=(window.aipkit_dashboard?.models||{})[n]||[],o=window.aipkit_escapeHtml||(a=>a);if(i.innerHTML="",n==="openai"&&typeof e=="object"&&!Array.isArray(e)?Object.keys(e).forEach(a=>{let s=document.createElement("optgroup");s.label=o(a),Array.isArray(e[a])&&e[a].forEach(l=>{l&&l.id&&s.appendChild(new Option(o(l.name||l.id),l.id))}),i.appendChild(s)}):Array.isArray(e)&&e.forEach(a=>{a&&a.id&&i.appendChild(new Option(o(a.name||a.id),a.id))}),i.options.length===0)i.appendChild(new Option(o(`No models for ${r.value}`),"")),i.disabled=!0;else{i.disabled=!1;let a;switch(n){case"openai":a="gpt-4o-mini";break;case"google":a="gemini-1.5-flash-latest";break;case"openrouter":a="anthropic/claude-3.5-sonnet";break;default:a=null;break}a&&i.querySelector(`option[value="${CSS.escape(a)}"]`)?i.value=a:i.selectedIndex=0}}window.aipkit_enhancer_populateBulkModels=c})();(function(){"use strict";async function c(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Enhancement complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let i=window.aipkit_enhancer_bulkState.queue.shift();typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Processing Post ID #${i}...`);try{let n=window.aipkit_post_enhancer?.nonce_generate_title;if(!n)throw new Error("Security nonce not found.");let t={_ajax_nonce:n,post_id:i,enhancements:JSON.stringify(window.aipkit_enhancer_bulkState.enhancementsConfig)};await window.aipkit_apiRequest("aipkit_bulk_process_single_post",t),window.aipkit_enhancer_bulkState.completed++,typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Successfully enhanced Post ID #${i}.`,"success")}catch(n){window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Failed to enhance Post ID #${i}: ${n.message||"Unknown error"}`,"error")}typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(c,200)}function r(i){let n=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!n)return;let t={},e=n.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(e.length===0){alert("Please select at least one field to enhance.");return}e.forEach(_=>{let u=_.value,f=n.querySelector(`#aipkit_bulk_prompt_${u}`);f&&(t[u]={prompt:f.value})});let o=n.querySelector("#aipkit_bulk_ai_provider").value,a=n.querySelector("#aipkit_bulk_ai_model").value,s=n.querySelector("#aipkit_bulk_ai_temperature").value,l=n.querySelector("#aipkit_bulk_content_max_tokens").value;if(!o||!a){alert("Please select an AI Provider and Model.");return}t.ai_provider=o,t.ai_model=a,t.temperature=s,t.max_tokens=l;let d=n.querySelector("#aipkit_bulk_generate_seo_slug");d&&(t.generate_seo_slug=d.checked?"1":"0");let p=n.querySelector('input[name="enable_vector_store"]');if(p&&p.checked){if(t.enable_vector_store="1",t.vector_store_provider=n.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",t.vector_store_top_k=n.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,t.vector_store_provider==="openai"){let _=n.querySelector("#aipkit_bulk_openai_vector_store_ids");_&&(t.openai_vector_store_ids=Array.from(_.selectedOptions).map(u=>u.value))}else t.vector_store_provider==="pinecone"?t.pinecone_index_name=n.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":t.vector_store_provider==="qdrant"&&(t.qdrant_collection_name=n.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(t.vector_store_provider==="pinecone"||t.vector_store_provider==="qdrant")&&(t.vector_embedding_provider=n.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",t.vector_embedding_model=n.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else t.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...i],isRunning:!0,completed:0,failed:0,total:i.length,enhancementsConfig:t},n.querySelector("#aipkit-enhancer-bulk-config").style.display="none",n.querySelector("#aipkit-enhancer-bulk-progress").style.display="block",n.querySelector("#aipkit_bulk_enhancer_start_btn").disabled=!0,n.querySelector("#aipkit_bulk_enhancer_stop_btn").style.display="inline-flex",n.querySelector("#aipkit_bulk_enhancer_cancel_btn").style.display="none",typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Starting enhancement for ${i.length} posts...`),c()}window.aipkit_enhancer_startBulkProcess=r})();(function(){"use strict";let c={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,modalElement:null},r=window.aipkit_escapeHtml||function(p){return p};function i(){let p=c.modalElement;if(!p)return{};let _={};["title","excerpt","content","meta","keyword","tags"].forEach(m=>{let g=p.querySelector(`#aipkit_bulk_enhance_${m}`),k=p.querySelector(`#aipkit_bulk_prompt_${m}`);g&&k&&(_[m]={enabled:g.checked?"1":"0",prompt:k.value})}),_.ai_provider=p.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",_.ai_model=p.querySelector("#aipkit_bulk_ai_model")?.value||"",_.temperature=p.querySelector("#aipkit_bulk_ai_temperature")?.value,_.max_tokens=p.querySelector("#aipkit_bulk_content_max_tokens")?.value,_.generate_seo_slug=p.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let f=p.querySelector('input[name="enable_vector_store"]');if(f&&f.checked){if(_.enable_vector_store="1",_.vector_store_provider=p.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",_.vector_store_top_k=p.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",_.vector_store_provider==="openai"){let m=p.querySelector("#aipkit_bulk_openai_vector_store_ids");m&&(_.openai_vector_store_ids=Array.from(m.selectedOptions).map(g=>g.value))}else _.vector_store_provider==="pinecone"?_.pinecone_index_name=p.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":_.vector_store_provider==="qdrant"&&(_.qdrant_collection_name=p.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(_.vector_store_provider==="pinecone"||_.vector_store_provider==="qdrant")&&(_.vector_embedding_provider=p.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",_.vector_embedding_model=p.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else _.enable_vector_store="0";return _}function n(p){c.currentTemplateId=p;let _=c.templates.find(S=>String(S.id)===String(p)),u=_?JSON.parse(JSON.stringify(_.config)):{};c.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(u));let f=c.modalElement;if(!f)return;let m=f.querySelector("#aipkit_bulk_ai_provider"),g=f.querySelector("#aipkit_bulk_ai_model"),k=f.querySelector("#aipkit_bulk_ai_temperature"),w=f.querySelector("#aipkit_bulk_ai_temperature_value"),b=f.querySelector("#aipkit_bulk_content_max_tokens"),y=f.querySelector("#aipkit_bulk_content_max_tokens_value");m&&(m.value=u.ai_provider||"openai"),g&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(window.aipkit_enhancer_populateBulkModels(m,g),u.ai_model&&setTimeout(()=>{g.querySelector(`option[value="${CSS.escape(u.ai_model)}"]`)&&(g.value=u.ai_model)},150)),k&&(k.value=u.temperature||"1.0"),w&&(w.textContent=u.temperature||"1.0"),b&&(b.value=u.max_tokens||"4000"),y&&(y.textContent=u.max_tokens||"4000"),["title","excerpt","content","meta","keyword","tags"].forEach(S=>{let I=f.querySelector(`#aipkit_bulk_enhance_${S}`),E=f.querySelector(`#aipkit_bulk_prompt_${S}`);if(I&&E){let P=u[S]?.enabled==="1";I.checked!==P&&(I.checked=P,I.dispatchEvent(new Event("change"))),E.value=u[S]?.prompt||E.defaultValue}});let h=f.querySelector("#aipkit_bulk_generate_seo_slug");h&&(h.checked=u.generate_seo_slug==="1");let v=f.querySelector('input[name="enable_vector_store"]');if(v&&(v.checked=u.enable_vector_store==="1",v.dispatchEvent(new Event("change"))),u.enable_vector_store==="1"){let S=f.querySelector("#aipkit_bulk_vector_store_provider");S&&(S.value=u.vector_store_provider||"openai",S.dispatchEvent(new Event("change",{bubbles:!0})));let I=f.querySelector("#aipkit_bulk_vector_store_top_k");I&&(I.value=u.vector_store_top_k||"3"),setTimeout(()=>{if(u.vector_store_provider==="openai"){let E=f.querySelector("#aipkit_bulk_openai_vector_store_ids");E&&Array.isArray(u.openai_vector_store_ids)&&Array.from(E.options).forEach(P=>{P.selected=u.openai_vector_store_ids.includes(P.value)})}else if(u.vector_store_provider==="pinecone"){let E=f.querySelector("#aipkit_bulk_pinecone_index_name");E&&(E.value=u.pinecone_index_name||"")}else if(u.vector_store_provider==="qdrant"){let E=f.querySelector("#aipkit_bulk_qdrant_collection_name");E&&(E.value=u.qdrant_collection_name||"")}if(u.vector_store_provider==="pinecone"||u.vector_store_provider==="qdrant"){let E=f.querySelector("#aipkit_bulk_vector_embedding_provider"),P=f.querySelector("#aipkit_bulk_vector_embedding_model");E&&(E.value=u.vector_embedding_provider||"openai",E.dispatchEvent(new Event("change"))),P&&u.vector_embedding_model&&setTimeout(()=>{P.value=u.vector_embedding_model},150)}},100)}c.currentTemplateModified=!1,e()}function t(){let p=i();c.currentTemplateModified=!window.aipkit_deepEqual(p,c.initialConfigForSelectedTemplate),e()}function e(){let p=c.modalElement;if(!p)return;let _=p.querySelector("#aipkit_enhancer_template_select").value,u=_&&String(_)!=="";p.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!u,p.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!u,p.querySelector("#aipkit_enhancer_update_template_btn").disabled=!u||!c.currentTemplateModified}function o(p,_="info"){let u=c.modalElement?.querySelector("#aipkit_enhancer_template_status");u&&(u.textContent=p,u.className=`aipkit_form-help aipkit_settings_message-${_}`,setTimeout(()=>{u.textContent="",u.className="aipkit_form-help"},4e3))}async function a(){let p=c.modalElement.querySelector("#aipkit_enhancer_template_select");p.innerHTML='<option value="">Loading...</option>',p.disabled=!0;try{let _=window.aipkit_post_enhancer?.nonce_manage_templates;if(!_)throw new Error("Security nonce for templates not found.");let u=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:_});c.templates=u.templates||[],p.innerHTML='<option value="">-- Select Template --</option>',c.templates.forEach(f=>{p.appendChild(new Option(r(f.template_name),f.id))}),p.disabled=!1}catch(_){o("Error loading templates: "+_.message,"error")}}async function s(p,_){if(!c.isSavingOrDeleting){c.isSavingOrDeleting=!0,o("Saving template...","info");try{let u=i(),f=window.aipkit_post_enhancer?.nonce_manage_templates;if(!f)throw new Error("Security nonce for templates not found.");let m=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:p,template_name:_,config:JSON.stringify(u),template_type:"enhancer",_ajax_nonce:f});o(m.message,"success"),await a(),c.modalElement.querySelector("#aipkit_enhancer_template_select").value=m.template_id,c.currentTemplateId=m.template_id,c.currentTemplateModified=!1,e()}catch(u){o("Error saving: "+u.message,"error")}finally{c.isSavingOrDeleting=!1}}}async function l(){let p=c.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!p||c.isSavingOrDeleting)&&confirm("Are you sure you want to delete this enhancer template?")){c.isSavingOrDeleting=!0,o("Deleting...","info");try{let _=window.aipkit_post_enhancer?.nonce_manage_templates;if(!_)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:p,_ajax_nonce:_}),o("Template deleted.","success"),await a(),c.currentTemplateId=null,e()}catch(_){o("Error deleting: "+_.message,"error")}finally{c.isSavingOrDeleting=!1}}}function d(p){c.modalElement=p;let _=p.querySelector("#aipkit_enhancer_template_select");_.addEventListener("change",u=>n(u.target.value)),p.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{let u=prompt("Enter a name for the new template:");u&&s(0,u)}),p.querySelector("#aipkit_enhancer_update_template_btn").addEventListener("click",()=>{let u=_.options[_.selectedIndex];c.currentTemplateId&&u&&s(c.currentTemplateId,u.text)}),p.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let u=_.options[_.selectedIndex];if(c.currentTemplateId&&u){let f=prompt("Enter new name:",u.text);f&&s(c.currentTemplateId,f)}}),p.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",l),a(),p.addEventListener("input",t),p.addEventListener("change",t)}window.aipkit_enhancer_initTemplateControls=d})();(function(){"use strict";function c(r){let{postCount:i,providerOptions:n,defaultPrompts:t,postType:e}=r,o="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}.";e==="product"&&(o+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),o=o.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let a="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}.";return e==="product"&&(a+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),a=a.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div class="aipkit-modal-content aipkit-enhancer-bulk-modal-content" style="min-height: auto;min-width:700px;">
          <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">Content Assistant</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="Close">\xD7</button>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <p>You have selected <strong>${i}</strong> items to enhance.</p>
              
              <div class="aipkit_accordion-group">
                <!-- Accordion 1: Template -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header aipkit_active">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Template
                    </div>
                    <div class="aipkit_accordion-content aipkit_active">
                        <div class="aipkit_cw_template_controls">
                          <div class="aipkit_form-group aipkit_cw_template_select_group">
                              <label class="aipkit_form-label" for="aipkit_enhancer_template_select">Template</label>
                              <div class="aipkit_cw_template_inline_controls">
                                  <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_form-input" style="max-width: inherit;">
                                      <option value="">-- Select Template --</option>
                                  </select>
                                  <div class="aipkit_cw_template_action_buttons">
                                      <button type="button" id="aipkit_enhancer_update_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_icon_btn" title="Update Current Template" disabled>
                                          <span class="dashicons dashicons-saved"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Create New Template">
                                          <span class="dashicons dashicons-plus"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Rename Selected Template" disabled>
                                          <span class="dashicons dashicons-edit"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_icon_btn" title="Delete Selected Template" disabled>
                                          <span class="dashicons dashicons-trash"></span>
                                      </button>
                                  </div>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                              <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                              <div class="aipkit_cw_template_inline_form_actions">
                                  <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                                  <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                              <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                              <div class="aipkit_cw_template_inline_form_actions">
                                  <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                                  <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_status" class="aipkit_form-help"></div>
                      </div>
                    </div>
                </div>

                <!-- Accordion 2: AI Settings -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> AI
                    </div>
                    <div class="aipkit_accordion-content">
                       <div class="aipkit_form-row">
                            <div class="aipkit_form-group aipkit_form-col">
                                <label class="aipkit_form-label" for="aipkit_bulk_ai_provider">Provider</label>
                                <select id="aipkit_bulk_ai_provider" class="aipkit_form-input">${n}</select>
                            </div>
                            <div class="aipkit_form-group aipkit_form-col">
                                 <label class="aipkit_form-label" for="aipkit_bulk_ai_model">Model</label>
                                 <div class="aipkit_input-with-button">
                                     <select id="aipkit_bulk_ai_model" class="aipkit_form-input"><option value="">-- Select Provider --</option></select>
                                     <button type="button" id="aipkit_bulk_enhancer_ai_settings_toggle" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Toggle Advanced AI Parameters">
                                        <span class="dashicons dashicons-admin-generic"></span>
                                     </button>
                                 </div>
                            </div>
                       </div>
                       <div id="aipkit_bulk_enhancer_ai_parameters_row" style="display: none;">
                            <div class="aipkit_form-row">
                                <div class="aipkit_form-group aipkit_form-col">
                                    <label class="aipkit_form-label" for="aipkit_bulk_ai_temperature">Temperature</label>
                                    <div class="aipkit_slider_wrapper">
                                        <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_form-input aipkit_range_slider" min="0" max="2" step="0.1" value="1.0">
                                        <span id="aipkit_bulk_ai_temperature_value" class="aipkit_slider_value">1.0</span>
                                    </div>
                                </div>
                                <div class="aipkit_form-group aipkit_form-col">
                                    <label class="aipkit_form-label" for="aipkit_bulk_content_max_tokens">Max Tokens</label>
                                    <div class="aipkit_slider_wrapper">
                                        <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_form-input aipkit_range_slider" min="100" max="4096" step="100" value="4000">
                                        <span id="aipkit_bulk_content_max_tokens_value" class="aipkit_slider_value">4000</span>
                                    </div>
                                </div>
                            </div>
                       </div>
                    </div>
                </div>

                <!-- Accordion 3: Context -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Context
                    </div>
                    <div class="aipkit_accordion-content">
                      <div class="aipkit_form-group">
                          <label class="aipkit_form-label aipkit_checkbox-label">
                              <input type="checkbox" name="enable_vector_store" value="1">
                              Use Context
                          </label>
                          <p class="aipkit_form-help" style="margin-left: 23px; margin-top: -5px;">Allow the AI to use your knowledge base for more accurate enhancements.</p>
                      </div>
                      <div class="aipkit_cw_vector_store_settings_container" style="display:none; margin-top: 15px; padding-left: 23px;">
                          
                          <div class="aipkit_form-row">
                              <div class="aipkit_form-group aipkit_form-col">
                                  <label class="aipkit_form-label" for="aipkit_bulk_vector_store_provider">Vector Provider</label>
                                  <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_form-input">
                                      <option value="openai" selected>OpenAI</option>
                                      <option value="pinecone">Pinecone</option>
                                      <option value="qdrant">Qdrant</option>
                                  </select>
                              </div>
                              <div class="aipkit_form-col">
                                  <div class="aipkit_form-group aipkit_cw_vector_openai_field">
                                      <label class="aipkit_form-label" for="aipkit_bulk_openai_vector_store_ids">Stores</label>
                                      <select id="aipkit_bulk_openai_vector_store_ids" name="openai_vector_store_ids[]" class="aipkit_form-input" multiple size="3" style="height: auto;"></select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_cw_vector_pinecone_field" style="display:none;">
                                      <label class="aipkit_form-label" for="aipkit_bulk_pinecone_index_name">Index</label>
                                      <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_form-input"></select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_cw_vector_qdrant_field" style="display:none;">
                                      <label class="aipkit_form-label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                                      <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_form-input"></select>
                                  </div>
                              </div>
                              <div class="aipkit_form-group aipkit_form-col">
                                  <label class="aipkit_form-label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                                  <input type="number" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_form-input" value="3" min="1" max="20" step="1">
                              </div>
                          </div>

                          <div class="aipkit_cw_vector_embedding_config_row" style="display: none;">
                              <div class="aipkit_form-row">
                                  <div class="aipkit_form-group aipkit_form-col">
                                      <label class="aipkit_form-label" for="aipkit_bulk_vector_embedding_provider">Embedding Provider</label>
                                      <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_form-input">
                                          <option value="openai" selected>OpenAI</option>
                                          <option value="google">Google</option>
                                      </select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_form-col">
                                      <label class="aipkit_form-label" for="aipkit_bulk_vector_embedding_model">Embedding Model</label>
                                      <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_form-input"></select>
                                  </div>
                              </div>
                          </div>
                      </div>
                    </div>
                </div>
                
                <!-- NEW: SEO Accordion -->
                 <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> SEO
                    </div>
                    <div class="aipkit_accordion-content">
                        <div class="aipkit_form-group">
                            <label class="aipkit_form-label aipkit_checkbox-label">
                                <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1">
                                Optimize URL
                            </label>
                            <p class="aipkit_form-help" style="margin-left: 23px; margin-top: -5px;">Generate a new, SEO-friendly post slug based on the focus keyword or title.</p>
                        </div>
                    </div>
                </div>

                <!-- Accordion 4: Fields & Prompts -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Prompts
                    </div>
                    <div class="aipkit_accordion-content">
                      <div class="aipkit_form-group">
                          <label class="aipkit_form-label">Fields to Enhance</label>
                          <div class="aipkit_checkbox-group">
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_title">
                                  <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title"> Title
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_excerpt">
                                  <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt"> Excerpt
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_content">
                                  <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content"> Content
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_tags">
                                  <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags"> Tags
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_meta">
                                  <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta"> Meta Description
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_keyword">
                                  <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword"> Focus Keyword
                              </label>
                          </div>
                      </div>
                      <div class="aipkit_tabs aipkit_enhancer_prompt_tabs">
                        <div class="aipkit_tab" data-tab="prompt-title" style="display: none;">Title</div>
                        <div class="aipkit_tab" data-tab="prompt-excerpt" style="display: none;">Excerpt</div>
                        <div class="aipkit_tab" data-tab="prompt-content" style="display: none;">Content</div>
                        <div class="aipkit_tab" data-tab="prompt-tags" style="display: none;">Tags</div>
                        <div class="aipkit_tab" data-tab="prompt-meta" style="display: none;">Meta</div>
                        <div class="aipkit_tab" data-tab="prompt-keyword" style="display: none;">Keyword</div>
                      </div>
                      <div class="aipkit_tab_content_container">
                        <div class="aipkit_tab-content" data-pane="prompt-title">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_title" class="aipkit_form-input" rows="6">${t.title}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-excerpt">
                             <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_form-input" rows="6">${t.excerpt}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-content">
                             <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_content" class="aipkit_form-input" rows="6">${t.content}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-tags">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_tags" class="aipkit_form-input" rows="6">${t.tags}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-meta">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_meta" class="aipkit_form-input" rows="6">${t.meta}</textarea>
                                <p class="aipkit_form-help">${a}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-keyword">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_form-input" rows="6">${t.keyword}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>

            <!-- Progress Display -->
            <div id="aipkit-enhancer-bulk-progress" style="display: none;">
                <div class="aipkit_progress_bar_container">
                    <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled" style="width: 0%;"></div>
                </div>
                <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <button type="button" id="aipkit_bulk_enhancer_cancel_btn" class="aipkit_btn aipkit_btn-secondary">Cancel</button>
            <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" style="display:none;">Stop</button>
            <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-primary">
                <span class="aipkit_btn-text">Start</span>
                <span class="aipkit_spinner" style="display:none;"></span>
            </button>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=c})();(function(){"use strict";function c(r,i){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let n=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},t=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],e={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",deepseek:"DeepSeek"},o=t.map(l=>`<option value="${l.toLowerCase()}">${e[l.toLowerCase()]||l.toUpperCase()}</option>`).join(""),a=window.aipkit_enhancer_getBulkModalHtml({postCount:r.length,providerOptions:o,defaultPrompts:n,postType:i});document.body.insertAdjacentHTML("beforeend",a);let s=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(s,r):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available."),requestAnimationFrame(()=>{s.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=c})();(function(){"use strict";let c=window.aipkit_escapeHtml||(o=>o);function r(o,a){let s=window.aipkit_post_enhancer||{},l,d,p,_,u;o==="openai"?(l=a.querySelector("#aipkit_bulk_openai_vector_store_ids"),d=s.openai_vector_stores||[],p="id",_="name",u="No OpenAI stores found."):o==="pinecone"?(l=a.querySelector("#aipkit_bulk_pinecone_index_name"),d=s.pinecone_indexes||[],p="name",_="name",u="No Pinecone indexes found."):o==="qdrant"&&(l=a.querySelector("#aipkit_bulk_qdrant_collection_name"),d=s.qdrant_collections||[],p="name",_="name",u="No Qdrant collections found."),l&&(l.innerHTML="",d.length>0?l.multiple?d.forEach(f=>{l.add(new Option(c(f[_]),f[p]))}):(l.add(new Option("-- Select --","")),d.forEach(f=>{l.add(new Option(c(f[_]),f[p]))})):(l.add(new Option(u,"")),l.disabled=!0))}function i(o,a){let s=a.querySelector("#aipkit_bulk_vector_embedding_model");if(!s)return;let l=window.aipkit_post_enhancer||{},d=o==="google"?l.googleEmbeddingModels||[]:l.openaiEmbeddingModels||[];s.innerHTML="",d.length>0?(s.add(new Option("-- Select Model --","")),d.forEach(p=>{s.add(new Option(c(p.name||p.id),p.id))}),s.disabled=!1):(s.add(new Option("No models found","")),s.disabled=!0)}function n(o){let a=o.querySelector("#aipkit_bulk_vector_store_provider").value,s=o.querySelector(".aipkit_cw_vector_openai_field"),l=o.querySelector(".aipkit_cw_vector_pinecone_field"),d=o.querySelector(".aipkit_cw_vector_qdrant_field"),p=o.querySelector(".aipkit_cw_vector_embedding_config_row");s&&(s.style.display="none"),l&&(l.style.display="none"),d&&(d.style.display="none"),p&&(p.style.display="none"),a==="openai"?(s&&(s.style.display="block"),r("openai",o)):a==="pinecone"?(l&&(l.style.display="block"),p&&(p.style.display="block"),r("pinecone",o),i("openai",o)):a==="qdrant"&&(d&&(d.style.display="block"),p&&(p.style.display="block"),r("qdrant",o),i("openai",o))}function t(o){let a=o.querySelector('input[name="enable_vector_store"]'),s=o.querySelector(".aipkit_cw_vector_store_settings_container"),l=o.querySelector("#aipkit_bulk_vector_store_provider"),d=o.querySelector("#aipkit_bulk_vector_embedding_provider");!a||!s||!l||(a.addEventListener("change",()=>{s.style.display=a.checked?"block":"none"}),l.addEventListener("change",()=>n(o)),d&&d.addEventListener("change",p=>i(p.target.value,o)),s.style.display=a.checked?"block":"none",n(o))}function e(o,a){if(!o)return;function s(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),o&&(o.classList.remove("aipkit-active"),o.addEventListener("transitionend",()=>o.remove(),{once:!0}),setTimeout(()=>o?.remove(),500))}o.querySelector(".aipkit-modal-close-btn").addEventListener("click",s),o.querySelector("#aipkit_bulk_enhancer_cancel_btn").addEventListener("click",s);let l=o.querySelector(".aipkit-modal-body");l&&l.addEventListener("click",h=>{let v=h.target.closest(".aipkit_accordion-header");if(!v)return;h.preventDefault();let S=v.closest(".aipkit_accordion");if(!S)return;let I=v.nextElementSibling;if(!I||!I.classList.contains("aipkit_accordion-content"))return;let E=S.closest(".aipkit_accordion-group");if(E&&!v.classList.contains("aipkit_active")){let P=E.querySelector(".aipkit_accordion-header.aipkit_active");if(P){P.classList.remove("aipkit_active");let T=P.nextElementSibling;T&&T.classList.remove("aipkit_active")}}v.classList.toggle("aipkit_active"),I.classList.toggle("aipkit_active")});let d=o.querySelector("#aipkit_bulk_ai_provider"),p=o.querySelector("#aipkit_bulk_ai_model"),_=o.querySelector("#aipkit_bulk_ai_temperature"),u=o.querySelector("#aipkit_bulk_ai_temperature_value"),f=o.querySelector("#aipkit_bulk_content_max_tokens"),m=o.querySelector("#aipkit_bulk_content_max_tokens_value"),g=o.querySelector("#aipkit_bulk_enhancer_ai_settings_toggle"),k=o.querySelector("#aipkit_bulk_enhancer_ai_parameters_row");g&&k&&g.addEventListener("click",()=>{let h=k.style.display==="none";k.style.display=h?"block":"none",g.classList.toggle("aipkit_active",h)}),d&&p&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(d.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(d,p)),window.aipkit_enhancer_populateBulkModels(d,p)),_&&u&&_.addEventListener("input",()=>u.textContent=_.value),f&&m&&f.addEventListener("input",()=>m.textContent=f.value),typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(o);let w=o.querySelector(".aipkit_enhancer_prompt_tabs"),b=o.querySelector(".aipkit_tab_content_container"),y=o.querySelectorAll('input[name="bulk_enhance_fields"]');w&&b&&w.addEventListener("click",h=>{let v=h.target.closest(".aipkit_tab");if(!v||v.classList.contains("aipkit_active"))return;let S=v.dataset.tab;w.querySelectorAll(".aipkit_tab").forEach(E=>E.classList.remove("aipkit_active")),b.querySelectorAll(".aipkit_tab-content").forEach(E=>E.classList.remove("aipkit_active")),v.classList.add("aipkit_active");let I=b.querySelector(`[data-pane="${S}"]`);I&&I.classList.add("aipkit_active")}),y.forEach(h=>{let v=h.value,S=w?.querySelector(`[data-tab="prompt-${v}"]`);S&&(S.style.display=h.checked?"flex":"none"),h.addEventListener("change",()=>{S&&(S.style.display=h.checked?"flex":"none");let I=w.querySelector(".aipkit_tab.aipkit_active");if(I&&I.style.display==="none"){let E=w.querySelector('.aipkit_tab:not([style*="display: none"])');if(E)E.click();else{let P=b.querySelector(".aipkit_tab-content.aipkit_active");P&&P.classList.remove("aipkit_active")}}else if(!w.querySelector('.aipkit_tab.aipkit_active:not([style*="display: none"])')){let E=w.querySelector('.aipkit_tab:not([style*="display: none"])');E&&E.click()}})}),o.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(a)}),o.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),t(o)}window.aipkit_enhancer_attachBulkModalListeners=e})();(function(){"use strict"})();(function(){"use strict";function c(r,i,n){let e=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithError(r.message||e.error_loading_title,e):i?window.aipkit_updateModalWithSuggestions(i,e):window.aipkit_updateModalWithError(e.error_loading_title||"Unknown error occurred.",e)}window.aipkit_handleTitleSuggestionsResult=c})();(function(){"use strict";function c(r,i,n){let e=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorExcerpt(r.message||e.error_loading_excerpt,e):i?window.aipkit_updateModalWithExcerptSuggestions(i,e):window.aipkit_updateModalWithErrorExcerpt(e.error_loading_excerpt||"Unknown error occurred.",e)}window.aipkit_handleExcerptSuggestionsResult=c})();(function(){"use strict";function c(r,i,n){let e=(window.aipkit_post_enhancer||{}).text||{};r?window.aipkit_updateModalWithErrorMeta(r.message||e.error_loading_meta,e):i?window.aipkit_updateModalWithMetaSuggestions(i,e):window.aipkit_updateModalWithErrorMeta(e.error_loading_meta||"Unknown error occurred.",e)}window.aipkit_handleMetaSuggestionsResult=c})();(function(){"use strict";function c(){}function r(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=r})();(function(){"use strict";function c(i){let n=i.target.closest(".aipkit_enhancer_item"),t=i.target.closest("#aipkit_bulk_enhance_btn");if(n){if(n.classList.contains("aipkit_enhancer_placeholder")){i.target.tagName==="A"&&i.preventDefault();return}i.preventDefault();let e=n.getAttribute("data-post-id"),o=n.getAttribute("data-action-type");if(!e||!o)return;let a=window.aipkit_post_enhancer||{},s=a.text||{};switch(o){case"title":window.aipkit_showLoadingModal(e,s,a),window.aipkit_fetchTitleSuggestions(e,window.aipkit_handleTitleSuggestionsResult,n);break;case"excerpt":window.aipkit_showLoadingExcerptModal(e,s,a),window.aipkit_fetchExcerptSuggestions(e,window.aipkit_handleExcerptSuggestionsResult,n);break;case"meta":window.aipkit_showLoadingMetaModal(e,s,a),window.aipkit_fetchMetaSuggestions(e,window.aipkit_handleMetaSuggestionsResult,n);break;case"tags":window.aipkit_showLoadingTagsModal(e,s,a),window.aipkit_fetchTagsSuggestions(e,window.aipkit_handleTagsSuggestionsResult,n);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${o}'.`);break}}else if(t){i.preventDefault();let e=document.querySelectorAll('input[name="post[]"]:checked');if(e.length===0){alert("Please select at least one post.");return}let o=Array.from(e).map(s=>s.value),a=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(o,a):alert("Error: Bulk processing feature is not available.")}}function r(){let i=document;if(!i)return;let n="data-post-enhancer-listener";document.body.getAttribute(n)||(i.addEventListener("click",c),document.body.setAttribute(n,"true"))}window.aipkit_initEnhancerEventListeners=r})();(function(){"use strict";function c(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(i=>typeof window[i]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),console.log("AIPKit Post Enhancer: Initialized.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.aipkit_initPostEnhancer=c})();(function(){"use strict";function c(){console.log("AIPKit Admin STT: Initializing (placeholder)...")}})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(n){return n};function r(){let n=document.getElementById("aipkit_vpp_embedding_provider_select");if(!n){console.error("VPP Embedding Util: Embedding provider select not found.");return}i(n.value)}function i(n){let t=document.getElementById("aipkit_vpp_embedding_model_select");if(!t){console.error("VPP Embedding Util: Embedding model select not found.");return}let e=window.aipkit_vpp_config||{},o=e.text||{};t.innerHTML=`<option value="">${c(o.select_model||"-- Select Model --")}</option>`;let a=[];n==="openai"&&e.openaiEmbeddingModels?a=e.openaiEmbeddingModels:n==="google"&&e.googleEmbeddingModels&&(a=e.googleEmbeddingModels),a.length>0?(a.forEach(s=>{s&&s.id&&t.appendChild(new Option(c(s.name||s.id),s.id))}),t.disabled=!1,t.options.length>1&&(t.selectedIndex=1)):(t.appendChild(new Option(c(`(No ${n} models - Sync in AI Settings)`),"")),t.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=r,window.aipkit_vpp_populateEmbeddingModelSelect=i})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(n){return n};async function r(){let n=document.getElementById("aipkit_vpp_openai_vector_store_id"),t=document.getElementById("aipkit_vpp_openai_store_status"),e=window.aipkit_vpp_config||{},o=e.text||{};if(!n||!t){console.error("VPP OpenAI Provider: Store select or status div not found.");return}n.innerHTML=`<option value="">${c(o.loading_stores||"Loading stores...")}</option>`,n.disabled=!0,t.textContent="";try{let a=e.nonce_fetch_openai_stores;if(!a)throw new Error("Nonce for fetching OpenAI stores is missing in config.");let s=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:a,limit:100});n.innerHTML="",s.stores&&s.stores.length>0?(n.appendChild(new Option(`-- ${c(o.select_store||"Select Existing Store")} --`,"")),s.stores.forEach(l=>{let d="(Files: N/A)";l.file_counts&&typeof l.file_counts.total=="number"?d=`(${l.file_counts.total} ${l.file_counts.total===1?"File":"Files"})`:l.file_counts&&(d="(Files: ?)");let p=`${c(l.name||l.id)} ${d}`,_=new Option(p,l.id);n.appendChild(_)})):n.appendChild(new Option(c(o.no_stores_found||"No stores found."),""))}catch(a){console.error("VPP OpenAI Provider: Error fetching vector stores:",a),n.innerHTML=`<option value="">${c(o.error_fetching_stores||"Error fetching stores.")}</option>`,t.textContent=c(a.message||o.error_fetching_stores||"Error fetching stores."),t.className="aipkit_form-help aipkit_message-error"}finally{n.disabled=!1}}async function i(n,t,e,o){let a=window.aipkit_vpp_config||{},s=a.text||{},l=n.length,d=0,p=0,_=0,u=[];try{let f=a.nonce_index_posts;if(!f)throw new Error("Nonce for indexing posts is missing in config.");for(let g of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}d++;let k=document.querySelector(`#post-${g}`),w=k?k.querySelector(".title .row-title"):null,b=w?w.textContent.trim():`Post #${g}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let h=d/l*100,v=(s.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",d).replace("%2$d",l)+` "${c(b)}"`;window.aipkit_vpp_updateProgress(h,v)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let y={_ajax_nonce:f,post_ids:[g],post_type:o,target_store_id:t,new_store_name_openai:e||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",y),p++}catch(h){_++,u.push({id:g,title:b,error:h.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${g}:`,h)}}let m=`Indexing complete. ${p} successful, ${_} failed.`;window.aipkit_isIndexingStopped&&d<l?m=`Indexing stopped. ${p} successful, ${_} failed.`:_>0&&(m+=" See browser console for details on failed posts.",console.error("Failed Posts:",u)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,_>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${p}/${l}`)}catch(f){console.error("VPP OpenAI Provider: Indexing setup error:",f),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,s.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(f.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),_>0?5e3:2e3)}}window.aipkit_vpp_fetchOpenAIVectorStores=r,window.aipkit_vpp_startIndexingOpenAI=i})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(n){return n};async function r(){let n=document.getElementById("aipkit_vpp_pinecone_target_index_select"),t=document.getElementById("aipkit_vpp_pinecone_index_status"),e=window.aipkit_vpp_config||{},o=e.text||{};if(!n||!t){console.error("VPP Pinecone Provider: Index select or status div not found.");return}n.innerHTML=`<option value="">${c(o.loading_indexes||"Loading indexes...")}</option>`,n.disabled=!0,t.textContent="";try{let a=e.nonce_fetch_pinecone_indexes;if(!a)throw new Error("Nonce for fetching Pinecone indexes is missing in config.");let s=await window.aipkit_apiRequest("aipkit_list_indexes_pinecone",{_ajax_nonce:a});n.innerHTML="",s.indexes&&s.indexes.length>0?(n.appendChild(new Option(`-- ${c(o.select_pinecone_index||"Select Pinecone Index")} --`,"")),s.indexes.forEach(l=>{let d=l.name||l.id;if(d){let p=`${c(d)} (${l.dimension||"?"})`;n.appendChild(new Option(p,d))}})):n.appendChild(new Option(c(o.no_pinecone_indexes_found||"No Pinecone indexes found."),""))}catch(a){console.error("VPP Pinecone Provider: Error fetching indexes:",a),n.innerHTML=`<option value="">${c(o.error_fetching_indexes||"Error fetching indexes.")}</option>`,t.textContent=c(a.message||o.error_fetching_indexes||"Error fetching indexes."),t.className="aipkit_form-help aipkit_message-error"}finally{n.disabled=!1}}async function i(n,t,e,o,a){let s=window.aipkit_vpp_config||{},l=s.text||{},d=n.length,p=0,_=0,u=0,f=[];try{let m=s.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let k of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}p++;let w=document.querySelector(`#post-${k}`),b=w?w.querySelector(".title .row-title"):null,y=b?b.textContent.trim():`Post #${k}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let v=p/d*100,S=(l.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",p).replace("%2$d",d)+` "${c(y)}"`;window.aipkit_vpp_updateProgress(v,S)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let h={_ajax_nonce:m,post_ids:[k],post_type:a,target_index_id:t,provider:"pinecone",embedding_provider:e,embedding_model:o};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",h),_++}catch(v){u++,f.push({id:k,title:y,error:v.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${k}:`,v)}}let g=`Indexing complete. ${_} successful, ${u} failed.`;window.aipkit_isIndexingStopped&&p<d?g=`Indexing stopped. ${_} successful, ${u} failed.`:u>0&&(g+=" See browser console for details on failed posts.",console.error("Failed Posts:",f)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,u>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${_}/${d}`)}catch(m){console.error("VPP Pinecone Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,l.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),u>0?5e3:2e3)}}window.aipkit_vpp_fetchPineconeIndexesAndPopulateSelect=r,window.aipkit_vpp_startIndexingPinecone=i})();(function(){"use strict";let c=window.aipkit_escapeHtml||function(n){return n};async function r(){let n=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),t=document.getElementById("aipkit_vpp_qdrant_collection_status"),e=window.aipkit_vpp_config||{},o=e.text||{};if(!n||!t){console.error("VPP Qdrant Provider: Collection select or status div not found.");return}n.innerHTML=`<option value="">${c(o.loading_indexes||"Loading collections...")}</option>`,n.disabled=!0,t.textContent="";try{let a=e.nonce_fetch_qdrant_collections;if(!a)throw new Error("Nonce for fetching Qdrant collections is missing in config.");let s=await window.aipkit_apiRequest("aipkit_list_collections_qdrant",{_ajax_nonce:a});n.innerHTML="",s.collections&&s.collections.length>0?(n.appendChild(new Option(`-- ${c(o.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),s.collections.forEach(l=>{let d=l.name||l.id;d&&n.appendChild(new Option(c(d),d))})):n.appendChild(new Option(c(o.no_qdrant_collections_found||"No Qdrant collections found."),""))}catch(a){console.error("VPP Qdrant Provider: Error fetching collections:",a),n.innerHTML=`<option value="">${c(o.error_fetching_indexes||"Error fetching collections.")}</option>`,t.textContent=c(a.message||o.error_fetching_indexes||"Error fetching collections."),t.className="aipkit_form-help aipkit_message-error"}finally{n.disabled=!1}}async function i(n,t,e,o,a){let s=window.aipkit_vpp_config||{},l=s.text||{},d=n.length,p=0,_=0,u=0,f=[];try{let m=s.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let k of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}p++;let w=document.querySelector(`#post-${k}`),b=w?w.querySelector(".title .row-title"):null,y=b?b.textContent.trim():`Post #${k}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let v=p/d*100,S=l.indexing_progress.replace("%1",p).replace("%2",d)+` "${c(y)}"`;window.aipkit_vpp_updateProgress(v,S)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let h={_ajax_nonce:m,post_ids:[k],post_type:a,target_collection_name:t,provider:"qdrant",embedding_provider:e,embedding_model:o};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",h),_++}catch(v){u++,f.push({id:k,title:y,error:v.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${k}:`,v)}}let g=`Indexing complete. ${_} successful, ${u} failed.`;window.aipkit_isIndexingStopped&&p<d?g=`Indexing stopped. ${_} successful, ${u} failed.`:u>0&&(g+=" See browser console for details on failed posts.",console.error("Failed Posts:",f)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,u>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${_}/${d}`)}catch(m){console.error("VPP Qdrant Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,l.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),u>0?5e3:2e3)}}window.aipkit_vpp_fetchQdrantCollectionsAndPopulateSelect=r,window.aipkit_vpp_startIndexingQdrant=i})();(function(){"use strict";let c="aipkit_vpp_modal",r=[],i="",n=!1;function t(_,u){if(document.getElementById(c)){console.warn("VPP Modal UI: Modal already exists.");return}r=_,i=u,n=!1;let f=window.aipkit_vpp_config||{},m=f.text||{},g=window.aipkit_escapeHtml||function(I){return I},k=window.aipkit_escapeAttribute||g,w="",b=_.length;b===1?w=(m.items_selected_singular||"You have selected %d item to index.").replace("%d",b):w=(m.items_selected_plural||"You have selected %d items to index.").replace("%d",b);let y=document.createElement("div");y.id=c,y.className="aipkit-modal-overlay aipkit-active";let h=document.createElement("div");h.className="aipkit-modal-content aipkit_vpp_modal_content",h.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${g(m.modal_title||"Index")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${k(m.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <p>${g(w)}</p>

                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="aipkit_vpp_vector_store_provider">${g(m.provider_label||"Provider")}</label>
                    <select id="aipkit_vpp_vector_store_provider" class="aipkit_form-input">
                        <option value="openai" selected>OpenAI</option>
                        <option value="pinecone">Pinecone</option>
                        <option value="qdrant">Qdrant</option>
                    </select>
                </div>

                <div id="aipkit_vpp_openai_options" style="display: block;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_openai_vector_store_id">${g(m.select_store||"Select OpenAI Store")}</label>
                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_form-input">
                            <option value="">${g(m.loading_stores||"Loading stores...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_openai_store_status"></div>
                    </div>
                </div>

                <div id="aipkit_vpp_pinecone_options" style="display: none;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_pinecone_target_index_select">${g(m.select_pinecone_index||"Select Pinecone Index")}</label>
                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_form-input">
                            <option value="">${g(m.loading_indexes||"Loading indexes...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_pinecone_index_status"></div>
                    </div>
                </div>
                
                <div id="aipkit_vpp_qdrant_options" style="display: none;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_qdrant_target_collection_select">${g(m.select_qdrant_collection||"Select Qdrant Collection")}</label>
                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_form-input">
                            <option value="">${g(m.loading_indexes||"Loading collections...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_qdrant_collection_status"></div>
                    </div>
                </div>

                <div id="aipkit_vpp_embedding_config_options" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #eee;">
                     <div class="aipkit_form-row" style="gap: 10px;">
                        <div class="aipkit_form-group aipkit_form-col">
                            <label class="aipkit_form-label" for="aipkit_vpp_embedding_provider_select">${g(m.embedding_provider_label||"Embedding Provider")}</label>
                            <select id="aipkit_vpp_embedding_provider_select" class="aipkit_form-input">
                                <option value="openai" selected>OpenAI</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="aipkit_form-group aipkit_form-col">
                            <label class="aipkit_form-label" for="aipkit_vpp_embedding_model_select">${g(m.embedding_model_label||"Embedding Model")}</label>
                            <select id="aipkit_vpp_embedding_model_select" class="aipkit_form-input">
                                <option value="">${g(m.select_model||"-- Select Model --")}</option>
                            </select>
                        </div>
                    </div>
                     <div class="aipkit_form-help">${g(f.text.ensure_api_key_for_embedding||"Ensure API key is set for the selected embedding provider in AI Settings.")}</div>
                </div>

                <div id="aipkit_vpp_progress_area" style="margin-top: 15px; display: none;">
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <p id="aipkit_vpp_progress_text" class="aipkit_form-help" style="text-align: center; margin-top: 5px;"></p>
                </div>
                <div id="aipkit_vpp_status_message" class="aipkit_form-help" style="margin-top: 10px; min-height: 1.5em;"></div>
            </div>
            <div class="aipkit-modal-footer" style="display: flex; justify-content: flex-end; align-items: center; gap: 8px; padding: 10px 15px; border-top: 1px solid var(--aipkit_container-border);">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_vpp_modal_close_btn">${g(m.close||"Close")}</button>
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${g(m.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" style="display:none;"></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" style="display:none;">
                     <span class="aipkit_btn-text">${g(m.stop||"Stop")}</span>
                </button>
            </div>
        `,y.appendChild(h),document.body.appendChild(y),h.addEventListener("click",I=>{let E=I.target;E.closest(".aipkit-modal-close-btn")||E.closest(".aipkit_vpp_modal_close_btn")?o():E.closest("#aipkit_vpp_start_indexing_btn")?p():E.closest("#aipkit_vpp_stop_indexing_btn")&&e()}),y.addEventListener("click",I=>{I.target===y&&o()});let v=document.getElementById("aipkit_vpp_vector_store_provider");v&&(v.addEventListener("change",d),d({target:v}));let S=document.getElementById("aipkit_vpp_embedding_provider_select");S&&typeof window.aipkit_vpp_populateEmbeddingModelSelect=="function"&&S.addEventListener("change",()=>window.aipkit_vpp_populateEmbeddingModelSelect(S.value))}function e(){window.aipkit_isIndexingStopped=!0;let _=document.getElementById("aipkit_vpp_stop_indexing_btn"),u=window.aipkit_vpp_config?.text||{};if(_){_.disabled=!0;let f=_.querySelector(".aipkit_btn-text");f&&(f.textContent=u.stopping||"Stopping...")}}function o(){window.aipkit_isIndexingStopped=!0;let _=document.getElementById(c);_&&(_.classList.remove("aipkit-active"),setTimeout(()=>{_.parentNode&&_.parentNode.removeChild(_)},300))}function a(_,u){let f=document.querySelector(`#${c} .aipkit_vpp_progress_bar`),m=document.getElementById("aipkit_vpp_progress_text");f&&(f.style.width=`${Math.max(0,Math.min(100,_))}%`),m&&(m.textContent=u)}function s(_,u="info"){let f=document.getElementById("aipkit_vpp_status_message");f&&(f.textContent=_,f.className=`aipkit_form-help aipkit_message-${u}`)}function l(){n=!1;let _=document.getElementById("aipkit_vpp_start_indexing_btn"),u=document.getElementById("aipkit_vpp_stop_indexing_btn"),f=document.querySelectorAll(`#${c} .aipkit-modal-close-btn, #${c} .aipkit_vpp_modal_close_btn`),m=window.aipkit_vpp_config?.text||{};if(_){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,m.start_indexing||"Start Indexing"),_.disabled=!1,_.style.display="inline-flex";let g=_.querySelector(".aipkit_spinner");g&&(g.style.display="none")}if(u){u.style.display="none",u.disabled=!1;let g=u.querySelector(".aipkit_btn-text");g&&(g.textContent=m.stop||"Stop")}f.forEach(g=>g.disabled=!1)}function d(_){let u=_.target.value,f=document.getElementById("aipkit_vpp_openai_options"),m=document.getElementById("aipkit_vpp_pinecone_options"),g=document.getElementById("aipkit_vpp_qdrant_options"),k=document.getElementById("aipkit_vpp_embedding_config_options");f&&(f.style.display="none"),m&&(m.style.display="none"),g&&(g.style.display="none"),k&&(k.style.display="none"),u==="openai"?(f&&(f.style.display="block"),typeof window.aipkit_vpp_fetchOpenAIVectorStores=="function"&&window.aipkit_vpp_fetchOpenAIVectorStores()):u==="pinecone"?(m&&(m.style.display="block"),k&&(k.style.display="block"),typeof window.aipkit_vpp_fetchPineconeIndexesAndPopulateSelect=="function"&&window.aipkit_vpp_fetchPineconeIndexesAndPopulateSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):u==="qdrant"&&(g&&(g.style.display="block"),k&&(k.style.display="block"),typeof window.aipkit_vpp_fetchQdrantCollectionsAndPopulateSelect=="function"&&window.aipkit_vpp_fetchQdrantCollectionsAndPopulateSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function p(){if(n)return;window.aipkit_isIndexingStopped=!1;let _=document.getElementById("aipkit_vpp_vector_store_provider").value,u=window.aipkit_vpp_config?.text||{},f="",m={post_ids:r,post_type:i,provider:_};if(_==="openai"){if(f=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!f){s(u.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}m.target_store_id=f}else if(_==="pinecone"){if(f=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!f){s(u.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}if(m.target_index_id=f,m.embedding_provider=document.getElementById("aipkit_vpp_embedding_provider_select").value,m.embedding_model=document.getElementById("aipkit_vpp_embedding_model_select").value,!m.embedding_provider||!m.embedding_model){s(u.error_no_embedding_config||"Please select embedding provider and model for Pinecone.","error");return}}else if(_==="qdrant"){if(f=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!f){s(u.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}if(m.target_collection_name=f,m.embedding_provider=document.getElementById("aipkit_vpp_embedding_provider_select").value,m.embedding_model=document.getElementById("aipkit_vpp_embedding_model_select").value,!m.embedding_provider||!m.embedding_model){s(u.error_no_embedding_config||"Please select embedding provider and model for Qdrant.","error");return}}else{s(`Provider ${_} not yet supported for indexing.`,"error");return}n=!0;let g=document.getElementById("aipkit_vpp_start_indexing_btn"),k=document.getElementById("aipkit_vpp_stop_indexing_btn"),w=document.querySelectorAll(`#${c} .aipkit-modal-close-btn, #${c} .aipkit_vpp_modal_close_btn`);if(g&&(g.style.display="none"),k){k.style.display="inline-flex",k.disabled=!1;let b=k.querySelector(".aipkit_btn-text");b&&(b.textContent=u.stop||"Stop")}document.getElementById("aipkit_vpp_progress_area").style.display="block",a(0,u.status_preparing||"Preparing..."),_==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(r,f,null,i):_==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(r,f,m.embedding_provider,m.embedding_model,i):_==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(r,f,m.embedding_provider,m.embedding_model,i)}window.aipkit_vpp_showModal=t,window.aipkit_vpp_closeModal=o,window.aipkit_vpp_updateProgress=a,window.aipkit_vpp_updateStatus=s,window.aipkit_vpp_resetModalAfterProcessing=l})();(function(){"use strict";let c="aipkit_add_to_vector_store_btn";function r(){let e=document.getElementById("posts-filter");if(!e)return;let o=null,a=e.querySelector("div.tablenav.top");if(a){let s=a.querySelector(".alignleft.actions.bulkactions"),l=a.querySelector(".alignleft.actions:not(.bulkactions)");s?o=s:l?o=l.parentNode:o=a}else o=e;if(o&&!document.getElementById(c)){let s=document.createElement("button");if(s.type="button",s.id=c,s.className="button button-secondary aipkit_vpp_button",s.textContent="Index",s.disabled=!0,o.classList.contains("bulkactions")){let l=o.querySelector('input[type="submit"].action, button.action');l?l.parentNode.insertBefore(s,l.nextSibling):o.appendChild(s)}else if(o.classList.contains("tablenav")&&o.classList.contains("top")){let l=o.querySelector('.alignleft.actions input[type="submit"], .alignleft.actions button');l?l.parentNode.insertBefore(s,l.nextSibling):o.appendChild(s)}else o.appendChild(s);s.addEventListener("click",n)}}function i(){let e=document.getElementById(c);if(!e)return;let o=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');e.disabled=o.length===0}function n(){let e=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(e.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let o=Array.from(e).map(a=>a.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(o,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function t(){r(),document.addEventListener("change",function(e){e.target.matches&&(e.target.matches('#the-list input[type="checkbox"][name="post[]"]')||e.target.matches("#cb-select-all-1")||e.target.matches("#cb-select-all-2"))&&i()}),i()}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",t):t()})();(function(){"use strict";function c(){console.log("AIPKit WooCommerce Product Writer: Initializing UI...")}function r(i){i.preventDefault(),alert("WooCommerce Product Description generation coming soon!")}window.aipkit_initWooCommerceWriter=c})();(function(){"use strict";function c(n,t,e="Processing..."){let o=document.querySelector(`#aipkit_migration_row_${n}`);if(!o)return;let a=o.querySelector(".aipkit_spinner"),s=o.querySelector(".aipkit_status-tag"),l=o.querySelectorAll("button");t?(s&&(s.textContent=e,s.className="aipkit_status-tag"),a&&(a.style.display="inline-block"),l.forEach(d=>d.disabled=!0)):a&&(a.style.display="none")}function r(n,t,e){let o=document.querySelector(`#aipkit_migration_row_${n}`);if(!o)return;let a=o.querySelector(".aipkit_spinner"),s=o.querySelector(".aipkit_status-tag"),l=o.querySelectorAll("button");a&&(a.style.display="none"),s&&(s.textContent=t,s.className=`aipkit_status-tag ${e}`),l.forEach(d=>d.disabled=!0)}function i(n,t="info"){let e=document.getElementById("aipkit_migration_messages_area");if(!e)return;let o=t==="success"?"notice-success":t==="error"?"notice-error":"notice-info";e.innerHTML=`<div class="notice ${o} is-dismissible" style="margin: 0 0 15px 0;"><p>${n}</p></div>`}window.aipkitMigrationUI={setCategoryLoadingState:c,updateCategoryStatus:r,showGlobalMessage:i}})();(function(){"use strict";async function c(n){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest("aipkit_analyze_old_data",{_ajax_nonce:n})}async function r(n,t,e){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest(t,{_ajax_nonce:e,category:n})}async function i(n,t,e){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest(t,{_ajax_nonce:e,category:n})}window.aipkitMigrationAjax={executeAnalysisStep:c,executeMigrationStep:r,executeDeleteStep:i}})();(function(){"use strict";function c(){let r=window.aipkitMigrationToolData;if(!r||!r.steps){console.error("AIPKit Migration Tool: Localized data or steps not found.");return}let i=window.aipkitMigrationUI,n=window.aipkitMigrationAjax;if(!i||!n){console.error("AIPKit Migration Tool: UI or AJAX helper modules not found.");return}let t=document.getElementById("aipkit_analyze_data_btn");t&&t.addEventListener("click",async()=>{let s=t.querySelector(".aipkit_btn-text"),l=t.querySelector(".aipkit_spinner");t.disabled=!0,s&&(s.textContent=r.text.analyzing),l&&(l.style.display="inline-block");try{await n.executeAnalysisStep(r.nonce),i.showGlobalMessage("Analysis complete. Reloading page...","success"),setTimeout(()=>window.location.reload(),1500)}catch(d){i.showGlobalMessage(`Analysis failed: ${d.message}`,"error"),t.disabled=!1,s&&(s.textContent="Analyze Legacy Data"),l&&(l.style.display="none")}});let e=document.getElementById("aipkit_analyze_again_btn");e&&e.addEventListener("click",async()=>{let s=e.querySelector(".aipkit_btn-text"),l=e.querySelector(".aipkit_spinner");e.disabled=!0,s&&(s.textContent=r.text.analyzing),l&&(l.style.display="inline-block");try{await n.executeAnalysisStep(r.nonce),i.showGlobalMessage("Re-analysis complete. Reloading page...","success"),setTimeout(()=>window.location.reload(),1500)}catch(d){i.showGlobalMessage(`Analysis failed: ${d.message}`,"error"),e.disabled=!1,s&&(s.textContent=r.text.analyzeAgain||"Analyze Again"),l&&(l.style.display="none")}});let o=document.getElementById("aipkit_migrate_start_fresh_btn");o&&o.addEventListener("click",()=>{if(confirm(r.text.confirmStartFresh)){if(typeof window.aipkit_apiRequest!="function")return;window.aipkit_apiRequest("aipkit_handle_migration_choice",{_ajax_nonce:r.nonce,choice:"start_fresh"}).then(()=>{i.showGlobalMessage("Choice saved. Reloading...","success"),setTimeout(()=>window.location.reload(),1500)}).catch(s=>i.showGlobalMessage(`Error: ${s.message}`,"error"))}});let a=document.getElementById("aipkit_migration_dashboard_tbody");a&&a.addEventListener("click",async s=>{let l=s.target.closest(".aipkit_migrate_category_btn"),d=s.target.closest(".aipkit_delete_category_btn");if(!l&&!d)return;let p=l?l.dataset.category:d.dataset.category,_=r.steps[p];if(!_){console.error("Could not find step info for category:",p);return}if(d){if(!confirm(r.text.confirmDeleteData))return;i.setCategoryLoadingState(p,!0,r.text.deleting);try{let u=await n.executeDeleteStep(p,_.delete_action,r.nonce);i.updateCategoryStatus(p,r.text.statusDeleted,"aipkit_status-success"),i.showGlobalMessage(u.message,"success")}catch(u){i.showGlobalMessage(`Error deleting ${_.label}: ${u.message}`,"error"),i.updateCategoryStatus(p,r.text.statusFailed,"aipkit_status-warning")}}else if(l){i.setCategoryLoadingState(p,!0,r.text.migrating);try{let u=await n.executeMigrationStep(p,_.action,r.nonce);i.updateCategoryStatus(p,r.text.statusMigrated,"aipkit_status-success"),i.showGlobalMessage(u.message,"success")}catch(u){i.showGlobalMessage(`Error migrating ${_.label}: ${u.message}`,"error"),i.updateCategoryStatus(p,r.text.statusFailed,"aipkit_status-warning")}}}),console.log("AIPKit Migration Tool Initialized.")}window.aipkit_initMigrationTool=c})();})();
