(()=>{(function(){"use strict";function g(r,n){if(!r)return;let e=r.querySelector(".aipkit_btn-text");if(e){e.textContent=n;return}let i=r.querySelector(".aipkit_spinner"),c=Array.from(r.childNodes).find(s=>s.nodeType===Node.TEXT_NODE);c?c.textContent=n+(i?" ":""):r.insertBefore(document.createTextNode(n+(i?" ":"")),r.firstChild),i&&r.appendChild(i)}function o(r,n,e,i=4e3){if(!r)return;let c=r.dataset.baseClass||"aipkit_form-help";r.dataset.baseClass||(r.dataset.baseClass=c),r.messageTimeoutId&&(clearTimeout(r.messageTimeoutId),r.messageTimeoutId=null),r.textContent=e,r.className=c,r.classList.add(`aipkit_form-help-${n}`),r.style.opacity="1",r.style.display="block",r.messageTimeoutId=setTimeout(()=>{r.style.opacity="0",setTimeout(()=>{r.textContent===e&&(r.textContent="",r.className=c,r.style.display="",r.messageTimeoutId=null)},300)},i)}window.aipkit_setButtonText=g,window.aipkit_showTemporaryMessage=o})();(function(){"use strict";function g(r){return r===null||typeof r>"u"?"":String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function o(r){return g(r)}window.aipkit_escapeHtml=g,window.aipkit_escapeAttribute=o})();(function(){"use strict";function g(r){let n=document.createElement("div");if(n.textContent="Copied!",Object.assign(n.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:1000005,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)",pointerEvents:"none"}),document.body.appendChild(n),r){let{top:e,left:i,width:c}=r.getBoundingClientRect(),s=e+window.scrollY+2,t=i+window.scrollX+c+5;n.style.top=`${s}px`,n.style.left=`${t}px`;let d=n.getBoundingClientRect(),a=8,l=window.innerWidth-a;if(d.right>l){let p=i+window.scrollX-d.width-5,_=Math.max(window.scrollX+a,p);n.style.left=`${_}px`}}else n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateY(0)"}),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateY(-5px)",n.addEventListener("transitionend",()=>n.remove(),{once:!0}),setTimeout(()=>{n.parentNode&&n.remove()},500)},1e3)}async function o(r,n){if(r)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(r),g(n);return}throw new Error("Clipboard API not available")}catch(e){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",e);try{let i=document.createElement("textarea");i.value=r,i.style.position="fixed",i.style.top="-9999px",i.style.left="-9999px",i.style.opacity="0",i.setAttribute("readonly",""),document.body.appendChild(i),i.select(),i.setSelectionRange(0,99999);let c=document.execCommand("copy");if(document.body.removeChild(i),c)g(n);else throw new Error('document.execCommand("copy") failed.')}catch(i){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",i),window.prompt("Please copy the shortcode manually:",r)}}}window.aipkit_copyShortcode=o})();(function(){"use strict";function g(e){let i=Number(e);if(!i||isNaN(i))return"";try{let c=new Date(i*1e3);if(isNaN(c.getTime()))return"";let s=String(c.getHours()).padStart(2,"0"),t=String(c.getMinutes()).padStart(2,"0"),d=String(c.getSeconds()).padStart(2,"0");return`${s}:${t}:${d}`}catch(c){return console.error("Error formatting timestamp:",e,c),""}}function o(e){if(!e)return"";try{let i=new Date(e.replace(" ","T")+"Z");if(isNaN(i.getTime()))return"";let c=new Date,s=(i.getTime()-c.getTime())/1e3;if(s<0)return"In the past";if(s<60)return"in less than a minute";if(s<3600){let l=Math.round(s/60);return`in ${l} minute${l!==1?"s":""}`}let t=new Date(c.getFullYear(),c.getMonth(),c.getDate()),d=new Date(c.getFullYear(),c.getMonth(),c.getDate()+1),a=new Date(i.getFullYear(),i.getMonth(),i.getDate());return a.getTime()===t.getTime()?`Today at ${i.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:a.getTime()===d.getTime()?`Tomorrow at ${i.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${i.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(i){return console.error("Error formatting relative time:",e,i),e}}function r(e){if(!e)return"N/A";try{let i=new Date(e.replace(" ","T")+"Z");return isNaN(i.getTime())?"Invalid Date":i.toLocaleString()}catch(i){return console.error("Error formatting UTC date string:",e,i),e}}function n(e){if(!e)return"N/A";try{let i=new Date(e.replace(" ","T")+"Z");if(isNaN(i.getTime()))return"Invalid Date";let c=Math.floor((Date.now()-i.getTime())/1e3);if(Number.isNaN(c)||c<0)return i.toLocaleString();if(c<60)return"Just now";let s=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],t=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let d of s)if(c>=d.seconds){let a=Math.floor(c/d.seconds);return t?t.format(-a,d.unit):`${a} ${d.unit}${a!==1?"s":""} ago`}return i.toLocaleString()}catch(i){return console.error("Error formatting relative date string:",e,i),e}}window.aipkit_formatTimestamp=g,window.aipkit_formatFriendlyFutureDate=o,window.aipkit_formatUtcDateTime=r,window.aipkit_formatRelativeDateTime=n})();(function(){"use strict";function g(o){return!o||typeof o!="string"?"":o.charAt(0).toUpperCase()+o.slice(1)}window.aipkit_ucfirst=g,window.ucfirst=g})();(function(){"use strict";function g(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let o=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&o.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=o,o}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=g})();(function(){"use strict";function g(o,r="",n="",e={}){if(!o)return"N/A";let i=o.toLowerCase();if(i.includes("text content submitted for indexing"))return"Text";if(i.includes("file content submitted for indexing")||i.includes("file content embedded and upserted")||i.includes("original filename:"))return"File Upload";if(i.includes("wordpress post content submitted for indexing"))return"Site Content";if(n==="openai")return"N/A";if(n==="pinecone"&&i.includes("vectors upserted")){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("pinecone_file_")||r.includes("file_"))return"File Upload"}if(n==="qdrant"){if(i.includes("points upserted to qdrant"))return e.post_id||i.includes("post id:")?"Site Content":"Text";if(i.includes("wordpress post content submitted for indexing"))return"Site Content"}if(r&&n==="pinecone"){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("file_")||r.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=g})();(function(){"use strict";async function g(n){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",n)}async function o(n,e){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));n.set("action",e);try{let s=n.get("provider")||"openai",t=n.has("file_to_upload")?"file_to_upload":n.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null,d=t?n.get(t):null;if(d&&typeof d.size=="number"){let a=["text/plain","text/csv","application/json","text/json","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/csv","text/comma-separated-values"],l=Array.isArray(window.aipkit_uploadLimits?.allowed_mime_types)&&window.aipkit_uploadLimits.allowed_mime_types.length?window.aipkit_uploadLimits.allowed_mime_types:a,p=Number(window.aipkit_effectiveUploadLimitBytes||0);(!Number.isFinite(p)||p<=0)&&(p=10*1024*1024),s==="openai"&&(p=Math.min(p,10*1024*1024));let _=[];if(d.size>p&&_.push(`File is too large (${r(d.size)}). Max allowed is ${r(p)}.`),d.type&&!l.map(u=>u.toLowerCase()).includes(String(d.type).toLowerCase())&&_.push(`Unsupported file type (${d.type}). Allowed: ${l.join(", ")}.`),_.length){let u=new Error(_.join(" "));throw u.code="client_validation_failed",u}}}catch(s){throw console.warn("[AIPKit] Client-side file validation failed",s),s}let i;try{let s=n.has("file_to_upload")?"file_to_upload":n.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null;if(s)try{let t=n.get(s);t&&console.debug("[AIPKit] File upload request",{action:e,fileField:s,name:t.name,size_bytes:t.size,type:t.type})}catch{}i=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:n,credentials:"same-origin"})}catch(s){throw console.error("[AIPKit] Network error during file upload",{action:e,error:s}),s}let c;try{c=await i.json()}catch(s){console.error("[AIPKit] Failed to parse JSON response for file upload",{action:e,status:i?.status,parseErr:s});let t=new Error(`Unexpected server response (status ${i?.status||"n/a"})`);throw t.status=i?.status,t}if(!i.ok||!c.success){let s=c?.data||{},t=new Error(s.message||`HTTP error! status: ${i.status}`);throw t.code=s.code,t.status=i.status,t.details=s.details||void 0,t.serverResponse=c,console.error("[AIPKit] File upload failed",{action:e,status:i.status,server:c}),t}return c.data}function r(n){if(!Number.isFinite(n))return`${n}`;let e=["B","KB","MB","GB"],i=0,c=n;for(;c>=1024&&i<e.length-1;)c/=1024,i++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:t=>t.toFixed(1)}).format(c)} ${e[i]}`}window.aipkit_api_upsertOpenAIText=g,window.aipkit_api_upsertFile=o})();(function(){"use strict";function g(o){let r=document.querySelector(o);if(!r)return;r.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(e=>{let i=e.id+"_value",c=null,s=e.closest(".aipkit_slider_wrapper");if(s&&(c=s.querySelector(".aipkit_slider_value")),!c)try{c=r.querySelector(`#${CSS.escape(i)}`)}catch{c=r.querySelector("#"+i)}if(c){let t=e.getAttribute("data-suffix")||(e.id.includes("confidence_threshold")?"%":"");c.textContent=e.value+t,e.hasAttribute("data-range-listener-attached")||(e.addEventListener("input",function(){c.textContent=this.value+t}),e.setAttribute("data-range-listener-attached","true"))}})}window.aipkit_attachRangeValueHandlers=g})();(function(){"use strict";function g(o){let r=document.querySelector(o);if(!r)return;let n="data-apikey-toggle-listener-attached";r.getAttribute(n)||(r.addEventListener("click",function(e){let i=e.target.closest(".aipkit_api-key-toggle");if(!i)return;let c=i.closest(".aipkit_api-key-wrapper");if(!c)return;let s=c.querySelector(".aipkit_form-input"),t=i.querySelector(".dashicons");!s||!t||(s.type==="password"?(s.type="text",t.classList.remove("dashicons-visibility"),t.classList.add("dashicons-hidden")):(s.type="password",t.classList.remove("dashicons-hidden"),t.classList.add("dashicons-visibility")))}),r.setAttribute(n,"true"))}window.aipkit_initApiKeyToggles=g})();(function(){"use strict";function g(o,r,n="Submit",e="Processing..."){if(!o)return;let i=o.querySelector(".aipkit_btn-text")||o.querySelector(".aipkit_btn_text"),c=o.querySelector(".aipkit_spinner"),s=o.querySelector(".dashicons");if(r){if(o.disabled=!0,!o.dataset.originalText)if(i)o.dataset.originalText=i.textContent;else{let d="";o.childNodes.forEach(a=>{a.nodeType===Node.TEXT_NODE&&(d+=a.textContent.trim())}),o.dataset.originalText=d.trim()}s&&(s.dataset.originalDisplay||(s.dataset.originalDisplay=s.style.display||"inline-block"),s.style.display="none");let t=n===""?"":o.dataset.loadingText||e;i?(o.dataset.originalText||(o.dataset.originalText=i.textContent),i.textContent=t):(!s||s.style.display==="none")&&t&&(Array.from(o.childNodes).forEach(d=>{d.nodeType===Node.TEXT_NODE&&d.remove()}),t&&o.insertBefore(document.createTextNode(t),o.firstChild)),c&&(c.style.display="inline-block")}else{o.disabled=!1;let t=n===""?"":o.dataset.originalText||n;s&&s.dataset.originalDisplay&&(s.style.display=s.dataset.originalDisplay,delete s.dataset.originalDisplay),i?i.textContent=t:n!==""&&(Array.from(o.childNodes).forEach(d=>{d.nodeType===Node.TEXT_NODE&&d.remove()}),t&&(s?s.insertAdjacentText("afterend"," "+t):o.insertBefore(document.createTextNode(t),o.firstChild))),c&&(c.style.display="none"),delete o.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=g})();(function(){"use strict";function g(o,r="info",n="aipkit_knowledge_base_global_status"){let e=document.getElementById(n);if(!e)return;e.messageTimeoutId&&clearTimeout(e.messageTimeoutId),e.messageTimeoutId=null;let i=o?String(o).trim():"";if(i===""){e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.style.opacity="0",e.classList.remove("aipkit-active");return}let c=e.classList.contains("aipkit_settings_message-error"),s=r;c&&r!=="error"&&(s="error"),e.className="aipkit_form-help",s==="success"?e.classList.add("aipkit_settings_message-success"):s==="error"?e.classList.add("aipkit_settings_message-error"):e.classList.add("aipkit_settings_message-info"),s==="error"&&e.textContent||c&&r!=="error"&&e.textContent?e.textContent=e.textContent+`
`+i:e.textContent=i,e.style.display="block",e.style.opacity="1",e.classList.add("aipkit-active"),s!=="error"&&(e.messageTimeoutId=setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.textContent.includes(i)&&(e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.classList.remove("aipkit-active"))},300)},5e3))}window.aipkit_showOpenAIVectorStatus=g})();(function(){"use strict";async function g(e,i,c,s){let t=document.getElementById("aipkit_nonce"),d=t&&t.value||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||void 0;return await window.aipkit_apiRequest("aipkit_get_chunk_logs_by_batch",{_ajax_nonce:d,provider:e,store_id:i,batch_id:c,page:s,per_page:10})}function o({snippetText:e="",fileId:i="",provider:c="",batchId:s="",storeId:t=""}={}){let d=window.aipkit_escapeHtml||function(f){return f},a=document.createElement("div");a.className="aipkit-snippet-modal-overlay";let l=document.createElement("div");l.className="aipkit-snippet-modal-content";let p=c?`${c} Indexed Snippet`:"Indexed Snippet",_=i?` (${d(i)})`:"",u=!!s&&!!t&&!!c;l.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${p}${_}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        ${u?`
          <div class="aipkit-chunks-list"></div>
          <div class="aipkit-chunks-pagination" style="margin-top:10px; display:flex; justify-content: space-between; align-items:center;">
            <button class="button button-secondary aipkit-chunks-prev">Prev</button>
            <span class="aipkit-chunks-page-info"></span>
            <button class="button button-secondary aipkit-chunks-next">Next</button>
          </div>
        `:`
          <pre class="aipkit-snippet-modal-content-text">${d(e)}</pre>
        `}
      </div>
    `,a.appendChild(l),document.body.appendChild(a);function m(){a.classList.remove("active"),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)}l.querySelector(".aipkit-snippet-modal-close").addEventListener("click",m),a.addEventListener("click",f=>{f.target===a&&m()});function k(f){f.key==="Escape"&&(m(),document.removeEventListener("keydown",k))}if(document.addEventListener("keydown",k),requestAnimationFrame(()=>{a.classList.add("active")}),u){let f=l.querySelector(".aipkit-chunks-list"),w=l.querySelector(".aipkit-chunks-page-info"),E=l.querySelector(".aipkit-chunks-prev"),y=l.querySelector(".aipkit-chunks-next"),I=1,S=1,h=b=>{if(!b||!b.length){f.innerHTML="<p>No chunks found.</p>";return}f.innerHTML=b.map(A=>{let x=A.indexed_content||"",v=A.file_id||"";return`<div class="aipkit-chunk-item" style="margin-bottom:12px;">
            <div class="aipkit-chunk-title" style="font-weight:600; margin-bottom:6px;">${d(v)}</div>
            <pre class="aipkit-chunk-text">${d(x)}</pre>
          </div>`}).join("")};async function M(b){f.innerHTML='<p><span class="aipkit_spinner" style="display:inline-block;"></span> Loading...</p>';try{let A=await g(c,t,s,b);h(A.chunks||[]),I=A.pagination?.current_page||b,S=A.pagination?.total_pages||1,w.textContent=`Page ${I} / ${S}`,E.disabled=I<=1,y.disabled=I>=S}catch(A){f.innerHTML=`<p class="aipkit_text-danger">${A&&A.message||"Failed to load chunks."}</p>`}}E.addEventListener("click",()=>{I>1&&M(I-1)}),y.addEventListener("click",()=>{I<S&&M(I+1)}),M(1)}}function r(e,i,c=""){return o({snippetText:e,fileId:i,provider:c})}function n(e,i=""){e&&e.querySelectorAll(".aipkit_view_snippet_icon").forEach(c=>{let s=c.cloneNode(!0);c.parentNode.replaceChild(s,c),s.addEventListener("click",t=>{t.preventDefault();let d=s.dataset.snippet,a=s.dataset.fileId,l=s.dataset.batchId||"",p=s.dataset.storeId||"";o({snippetText:d,fileId:a,provider:i,batchId:l,storeId:p})})})}window.aipkit_showSnippetModal=r,window.aipkit_showSnippetModalEnhanced=o,window.aipkit_attachSnippetModalListeners=n})();(function(){"use strict";function g(o,r,n){if(!o||!r||typeof n!="function"){r&&(r.innerHTML="");return}r.innerHTML="";let{total_logs:e,total_pages:i,current_page:c}=o,s=parseInt(c,10);if(!e||e<=0||!i||i<=1)return;let t=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,d=wp.i18n&&wp.i18n._n?wp.i18n._n:(m,k,f)=>f>1?k:m,a=document.createElement("span");a.className="aipkit_pagination-count",a.textContent=`${e.toLocaleString()} ${d("item","items",e)}`,r.appendChild(a);let l=document.createElement("span");l.className="aipkit_pagination-links";let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",p.innerHTML="&laquo; "+t("Previous","gpt3-ai-content-generator"),p.disabled=s<=1,p.disabled||p.addEventListener("click",m=>{m.preventDefault(),n(s-1)}),l.appendChild(p);let _=document.createElement("span");_.className="aipkit_pagination-current",_.textContent=`${t("Page","gpt3-ai-content-generator")} ${s} ${t("of","gpt3-ai-content-generator")} ${i}`,l.appendChild(_);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML=t("Next","gpt3-ai-content-generator")+" &raquo;",u.disabled=s>=i,u.disabled||u.addEventListener("click",m=>{m.preventDefault(),n(s+1)}),l.appendChild(u),r.appendChild(l)}window.aipkit_renderLogsPagination=g})();(function(){"use strict";function g(o){let r=document.querySelector(o);if(!r)return;let n="data-restore-icon-listener-attached";r.getAttribute(n)||(r.addEventListener("click",function(e){let i=e.target.closest(".aipkit_restore-default-icon");if(!i)return;let c=i.getAttribute("data-target-input"),s=i.getAttribute("data-default-value");if(!c||s===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",i);return}let t=document.getElementById(c);if(t){if(t.value!==s){t.value=s;let a=new Event("change",{bubbles:!0,cancelable:!0}),l=new Event("blur",{bubbles:!0,cancelable:!0});if(t.dispatchEvent(a),t.dispatchEvent(l),t.type==="range"){let p=document.getElementById(`${c}_value`);p&&(p.textContent=s)}}}else console.warn(`AIPKit Restore Default: Target input element #${c} not found.`)}),r.setAttribute(n,"true"))}window.aipkit_initRestoreDefaultIcons=g})();(function(){"use strict";function g(e){!e||!e.parentNode||e.classList.contains("aipkit_message_fadeout")||(e.classList.add("aipkit_message_fadeout"),e.addEventListener("animationend",()=>{e.parentNode&&e.parentNode.removeChild(e)},{once:!0}),setTimeout(()=>{e&&e.parentNode&&e.parentNode.removeChild(e)},500))}function o(e,i,c){let s=document.getElementById(e);if(!s){console.error(`AIPKit Message Handler: Container #${e} not found.`);return}s.querySelectorAll(".aipkit_settings_message").forEach(m=>{m.dataset.timerId&&clearTimeout(parseInt(m.dataset.timerId,10)),m.remove()});let d=s.querySelector(".aipkit_saving-indicator");d&&d.remove();let a=document.createElement("div");a.className=`aipkit_settings_message aipkit_settings_message-${i}`;let l=i==="success"?"dashicons-yes-alt":i==="error"?"dashicons-warning":"dashicons-info-alt",p=document.createElement("span");p.className=`dashicons ${l}`,p.style.marginRight="5px",a.appendChild(p),a.appendChild(document.createTextNode(` ${c}`));let _=document.createElement("span");_.className="dashicons dashicons-dismiss aipkit_settings_message-close",_.setAttribute("aria-label","Dismiss message"),_.title="Dismiss message",a.appendChild(_),s.appendChild(a);let u=setTimeout(()=>{g(a)},5e3);a.dataset.timerId=u}function r(e){let i=document.getElementById(e);if(!i){console.error(`AIPKit Message Handler: Container #${e} not found for close button init.`);return}let c=`data-close-listener-${e}`;i.getAttribute(c)!=="true"&&(i.addEventListener("click",function(s){let t=s.target.closest(".aipkit_settings_message-close");if(t){let d=t.closest(".aipkit_settings_message");d&&(d.dataset.timerId&&clearTimeout(parseInt(d.dataset.timerId,10)),g(d))}}),i.setAttribute(c,"true"))}function n(e){let i=document.getElementById(e);if(i){let c=i.querySelector(".aipkit_saving-indicator");c&&c.remove(),i.querySelectorAll(".aipkit_settings_message").forEach(t=>{t.dataset.timerId&&clearTimeout(parseInt(t.dataset.timerId,10)),t.remove()})}else console.warn(`AIPKit Message Handler: Container #${e} not found for clearing messages.`)}window.aipkit_showMessage=o,window.aipkit_initMessageCloseButtons=r,window.aipkit_clearStatusMessages=n})();(function(){"use strict";function g(n,e){let i=document.getElementById(n);if(!i){console.error(`AIPKit Saving Indicator: Container #${n} not found.`);return}let c=i.querySelector(".aipkit_saving-indicator");if(e)if(!c)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(n):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),c=document.createElement("span"),c.className="aipkit_saving-indicator",c.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',i.appendChild(c),requestAnimationFrame(()=>{let s=i.querySelector(".aipkit_saving-indicator");s&&s.classList.add("aipkit_active")});else{c.style.display="inline-flex",c.classList.add("aipkit_active");let s=c.querySelector(".aipkit_spinner");s&&(s.style.display="inline-block")}else c&&(c.classList.remove("aipkit_active"),setTimeout(()=>{c&&c.parentNode&&c.remove()},200))}function o(n){r(n);let e=document.createElement("span");e.className="aipkit-title-spinner aipkit_spinner",e.style.display="inline-block",n.parentNode.insertBefore(e,n.nextSibling)}function r(n){let e=n.parentNode.querySelector(".aipkit-title-spinner");e&&e.remove()}window.aipkit_showSavingIndicator=g,window.aipkit_showLinkSpinner=o,window.aipkit_hideLinkSpinner=r})();(function(){"use strict";function g(n){let e=n.textContent;n.textContent="Copied!",n.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{n&&n.classList.contains("aipkit-placeholder--copied")&&(n.textContent=e,n.classList.remove("aipkit-placeholder--copied"))},1500)}function o(n){let e=n.target;if(!e.matches(".aipkit-placeholder"))return;n.preventDefault(),n.stopPropagation();let i=e.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(i).then(()=>{g(e)}).catch(c=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",c)})}function r(){let n=document.body;if(n){let e="data-placeholder-copy-listener-attached";n.getAttribute(e)||(n.addEventListener("click",o),n.setAttribute(e,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",r)})();(function(){"use strict";let g="select[data-aipkit-provider-notice-target]",o="a[data-aipkit-load-module]";function r(){let k=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return k&&typeof k=="object"?k:{}}function n(k){window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=k}function e(k){return k?String(k).trim().toLowerCase():""}function i(k,f){return!k||!f||!Object.prototype.hasOwnProperty.call(f,k)?null:!!f[k]}function c(k,f){if(!k)return"";let w=f?k.getAttribute(`data-message-${f}`):"";return w||k.getAttribute("data-message-default")||""}function s(k){k&&k.classList.add("aipkit_provider_notice--hidden")}function t(k){k&&k.classList.remove("aipkit_provider_notice--hidden")}function d(k,f){if(!k)return;let w=k.getAttribute("data-aipkit-provider-notice-target");if(!w)return;let E=document.getElementById(w);if(!E)return;if(k.getAttribute("data-aipkit-provider-notice-defer")==="1"&&k.dataset.aipkitProviderNoticeArmed!=="true"){s(E);return}let I=e(k.value);if(!I){s(E);return}let S=i(I,f);if(S===null){s(E);return}if(S){s(E);return}let h=E.querySelector(".aipkit_provider_notice_message");h&&(h.textContent=c(E,I)),t(E)}function a(k){return k?k.offsetParent!==null?!0:k.getClientRects().length>0:!1}function l(k){let f=r(),w=k||document,E=Array.from(w.querySelectorAll(g)),y=new Map;E.forEach(I=>{let S=I.getAttribute("data-aipkit-provider-notice-target");S&&(y.has(S)||y.set(S,[]),y.get(S).push(I))}),y.forEach(I=>{let S=I.find(a)||I[0];S&&d(S,f)})}function p(){let k={...r()},f=!1,w=$=>{let U=document.getElementById($);if(U)return f=!0,String(U.value||"").trim()},E=w("aipkit_openai_api_key");E!==void 0&&(k.openai=E!=="");let y=w("aipkit_openrouter_api_key");y!==void 0&&(k.openrouter=y!=="");let I=w("aipkit_google_api_key");I!==void 0&&(k.google=I!=="");let S=w("aipkit_azure_api_key"),h=w("aipkit_azure_endpoint");(S!==void 0||h!==void 0)&&(k.azure=(S||"")!==""&&(h||"")!=="");let M=w("aipkit_deepseek_api_key");M!==void 0&&(k.deepseek=M!=="");let b=w("aipkit_ollama_base_url");b!==void 0&&(k.ollama=b!=="");let A=w("aipkit_replicate_api_key"),x=w("aipkit_task_cw_replicate_api_key");(A!==void 0||x!==void 0)&&(k.replicate=(A||"")!==""||(x||"")!=="");let v=w("aipkit_pinecone_api_key");v!==void 0&&(k.pinecone=v!=="");let C=w("aipkit_qdrant_api_key"),P=w("aipkit_qdrant_url");return(C!==void 0||P!==void 0)&&(k.qdrant=(C||"")!==""&&(P||"")!==""),f?(n(k),!0):!1}function _(){["aipkit_openai_api_key","aipkit_openrouter_api_key","aipkit_google_api_key","aipkit_azure_api_key","aipkit_azure_endpoint","aipkit_deepseek_api_key","aipkit_ollama_base_url","aipkit_replicate_api_key","aipkit_task_cw_replicate_api_key","aipkit_pinecone_api_key","aipkit_qdrant_api_key","aipkit_qdrant_url"].forEach(f=>{let w=document.getElementById(f);if(!w||w.dataset.aipkitProviderStatusBound==="true")return;let E=()=>{p()&&l(document)};w.addEventListener("input",E),w.addEventListener("change",E),w.dataset.aipkitProviderStatusBound="true"})}function u(k){(k||document).querySelectorAll(o).forEach(E=>{E.dataset.aipkitProviderNoticeLinkBound!=="true"&&(E.addEventListener("click",y=>{let I=E.getAttribute("data-aipkit-load-module");!I||typeof window.aipkit_loadModule!="function"||(y.preventDefault(),window.aipkit_loadModule(I))}),E.dataset.aipkitProviderNoticeLinkBound="true")})}function m(k){let f=k||document;f.querySelectorAll(g).forEach(E=>{E.dataset.aipkitProviderNoticeBound!=="true"&&(E.addEventListener("change",()=>{E.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(E.dataset.aipkitProviderNoticeArmed="true"),d(E,r())}),E.dataset.aipkitProviderNoticeBound="true")}),p(),l(f),_(),u(f)}window.aipkit_initProviderKeyNotices=m,document.addEventListener("DOMContentLoaded",function(){m(document)})})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelectorAll("[data-aipkit-popover-target]");if(!r.length)return;let n=null,e=null,i=!1,c=l=>l?o.querySelector(`#${l}`):null,s=(l,p)=>{if(!l||!p)return;let _=l.getBoundingClientRect(),u=p.getBoundingClientRect(),m=u.width||400,k=u.height||0,f=window.innerWidth,w=window.innerHeight,E=12;if(l.dataset.aipkitPopoverPlacement==="bottom"){let S=_.left;S+m>f-E&&(S=_.right-m),S=Math.max(E,Math.min(S,f-m-E));let h=_.bottom+8;h+k>w-E&&(h=_.top-k-8),h=Math.max(E,Math.min(h,w-k-E)),p.style.left=`${Math.round(S)}px`,p.style.top=`${Math.round(h)}px`;return}if(l.dataset.aipkitPopoverPlacement==="left"){let S=_.left-m-10;S<E&&(S=_.right+10),S=Math.max(E,Math.min(S,f-m-E));let h=_.top;h+k>w-E&&(h=w-k-E),h=Math.max(E,h),p.style.left=`${Math.round(S)}px`,p.style.top=`${Math.round(h)}px`;return}let y=_.right+10;y+m>f-E&&(y=_.right-m-10),y=Math.max(E,Math.min(y,f-m-E));let I=_.top;I+k>w-E&&(I=w-k-E),I=Math.max(E,I),p.style.left=`${Math.round(y)}px`,p.style.top=`${Math.round(I)}px`},t=()=>{!e||!n||i||(i=!0,window.requestAnimationFrame(()=>{let l=n.querySelector(".aipkit_model_settings_popover_panel");s(e,l),i=!1}))},d=()=>{if(!n)return;let l=n.id;n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),l==="aipkit_cw_template_picker_popover"&&typeof window.aipkit_resetTemplateActionsPanel=="function"&&window.aipkit_resetTemplateActionsPanel(),n=null,e=null},a=l=>{if(!l)return;let p=l.getAttribute("data-aipkit-popover-target"),_=c(p);if(!_)return;n&&n!==_&&d(),n=_,e=l,_.classList.add("aipkit-active"),_.setAttribute("aria-hidden","false"),l.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${p}`);let u=_.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{s(l,u)})};r.forEach(l=>{l.dataset.popoverListenerAttached!=="true"&&(l.addEventListener("click",p=>{if(p.preventDefault(),!(l.dataset.aipkitPopoverKeepOpen==="true")&&n&&e===l&&n.classList.contains("aipkit-active")){d();return}a(l)}),l.dataset.popoverListenerAttached="true")}),o.querySelectorAll(".aipkit_model_settings_popover").forEach(l=>{l.dataset.overlayListenerAttached!=="true"&&(l.addEventListener("click",_=>{_.target===l&&d()}),l.dataset.overlayListenerAttached="true");let p=l.querySelector(".aipkit_model_settings_popover_close");p&&p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",_=>{_.preventDefault(),d()}),p.dataset.popoverListenerAttached="true"),l.querySelectorAll("[data-aipkit-popover-close]").forEach(_=>{_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",u=>{u.preventDefault(),d()}),_.dataset.popoverListenerAttached="true")})}),o.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",l=>{l.key==="Escape"&&n&&d()}),o.dataset.escapeListenerAttached="true"),o.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),o.dataset.repositionListenersAttached="true")}window.aipkit_initContentWriterPopovers=g})();(function(){"use strict";let g=e=>{if(!e)return null;let i=e.querySelector("#aipkit_enhancer_editor_integration"),c=e.querySelector("#aipkit_enhancer_list_button"),s=e.querySelector('input[name="enhancer_insert_position_default"]:checked');return!i||!c||!s?null:{enhancer_editor_integration:i.checked?"1":"0",enhancer_list_button:c.checked?"1":"0",enhancer_insert_position_default:s.value||"replace"}},o=e=>e?JSON.stringify(e):"",r=async e=>{if(!e||typeof window.aipkit_apiRequest!="function")return;let i=g(e);if(!i)return;let c=e.dataset.assistantAutosaveBaseline||"",s=o(i);if(!s||s===c||e.dataset.assistantAutosaveBusy==="true")return;let t=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,d=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,a=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;e.dataset.assistantAutosaveBusy="true",t&&t("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",i),e.dataset.assistantAutosaveBaseline=s,d&&d("Updated")}catch(l){a&&a(`Error: ${l.message||"Failed to save."}`),console.error("Content Writer Assistant Settings Save Error:",l)}finally{e.dataset.assistantAutosaveBusy="false"}};function n(e){let i=e||document.getElementById("aipkit_content_writer_container"),c=document.getElementById("aipkit_cw_builder_sheet");if(!i||!c)return;let s=c.querySelector(".aipkit_builder_sheet_title"),t=c.querySelector(".aipkit_builder_sheet_description"),d=c.querySelectorAll(".aipkit_builder_sheet_section"),a=c.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'),l=c.querySelector(".aipkit_builder_sheet_close"),p=u=>{if(!u)return;let m=u.getAttribute("data-sheet-title")||"Sheet",k=u.getAttribute("data-sheet-description")||"",f=u.getAttribute("data-sheet-content")||"placeholder";s&&(s.textContent=m),t&&(t.textContent=k);let w=!1;if(d.forEach(E=>{E.dataset.sheet===f?(E.hidden=!1,w=!0):E.hidden=!0}),!w&&a&&(a.hidden=!1),c.classList.add("aipkit-active"),c.setAttribute("aria-hidden","false"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_cw_builder_sheet"),f==="assistant"&&(typeof window.aipkit_initMessageCloseButtons=="function"&&window.aipkit_initMessageCloseButtons("aipkit_content_writer_messages"),typeof window.aipkit_initEnhancerActionsUI=="function"&&window.aipkit_initEnhancerActionsUI(),!c.dataset.assistantAutosaveBound)){let E=g(c);c.dataset.assistantAutosaveBaseline=o(E),c.addEventListener("change",y=>{let I=y.target;!I||!I.matches("#aipkit_enhancer_editor_integration")&&!I.matches("#aipkit_enhancer_list_button")&&!I.matches('input[name="enhancer_insert_position_default"]')||r(c)}),c.dataset.assistantAutosaveBound="true"}l&&l.focus()},_=()=>{c.classList.remove("aipkit-active"),c.setAttribute("aria-hidden","true")};i.dataset.assistantSheetBound||(i.addEventListener("click",u=>{let m=u.target.closest(".aipkit_builder_sheet_trigger");m&&(u.preventDefault(),p(m))}),i.dataset.assistantSheetBound="true"),l&&l.dataset.assistantSheetBound!=="true"&&(l.addEventListener("click",_),l.dataset.assistantSheetBound="true"),c.dataset.assistantSheetBound||(c.addEventListener("click",u=>{u.target===c&&_()}),document.addEventListener("keydown",u=>{u.key==="Escape"&&c.classList.contains("aipkit-active")&&_()}),c.dataset.assistantSheetBound="true")}window.aipkit_initContentWriterAssistantSheet=n})();(function(){"use strict";let g=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],o=d=>{let a=g.findIndex(l=>l.key===d);return a===-1?1:a},r=(d,a)=>{let l=Number(d);if(!l||Number.isNaN(l))return"medium";let p="medium",_=1/0;return Object.keys(a).forEach(u=>{let m=Math.abs(l-a[u]);m<_&&(_=m,p=u)}),p},n=(d,a)=>{if(!d)return;let l=d.querySelector(".aipkit_ai_behavior_value"),p=d.querySelector(".aipkit_ai_behavior_hint"),_=d.querySelector(".aipkit_ai_length_slider"),u=g[o(a)];l&&(l.textContent=u.label),p&&(p.textContent=`Approx. ${u.words} words`),_&&(_.value=String(o(a)+1))},e=d=>{let a=d.querySelector(".aipkit_ai_temperature_control");if(!a)return;let l=a.querySelector(".aipkit_ai_temperature_slider"),p=a.querySelector(".aipkit_ai_behavior_value");if(!l||!p||l.dataset.enhancedListenerAttached==="true")return;let _=()=>{p.textContent=l.value};l.addEventListener("input",_),_(),l.dataset.enhancedListenerAttached="true"},i=d=>{let a=d.querySelectorAll(".aipkit_ai_reasoning_input"),l=d.querySelector("[data-aipkit-reasoning-select]");if(!a.length||!l||l.dataset.reasoningSyncAttached==="true")return;let p=u=>u==="minimal"?"low":u,_=u=>{let m=p(u);d.querySelectorAll(".aipkit_ai_reasoning_option").forEach(f=>f.classList.remove("aipkit_ai_reasoning_option--selected"));let k=d.querySelector(`.aipkit_ai_reasoning_input[value="${m}"]`);if(k){k.checked=!0;let f=k.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}};a.forEach(u=>{u.dataset.reasoningListenerAttached!=="true"&&(u.addEventListener("change",()=>{u.checked&&(l.value=p(u.value),l.dispatchEvent(new Event("change",{bubbles:!0})),_(u.value))}),u.dataset.reasoningListenerAttached="true")}),l.addEventListener("change",()=>{_(l.value||"medium")}),_(l.value||"medium"),l.dataset.reasoningSyncAttached="true"},c=d=>{let a=d.querySelector(".aipkit_ai_length_control");if(!a)return;let l=a.querySelector(".aipkit_ai_length_slider"),p=a.querySelector("[data-aipkit-length-input]");if(!l||!p||l.dataset.lengthListenerAttached==="true")return;let _=a.dataset.aipkitLengthMode||"content_length",u={short:Number(a.dataset.aipkitLengthShort||2e3),medium:Number(a.dataset.aipkitLengthMedium||4e3),long:Number(a.dataset.aipkitLengthLong||6e3)},m=(f,w)=>{let E=g.some(y=>y.key===f)?f:"medium";if(n(a,E),_==="content_length")p.value!==E&&(p.value=E);else{let y=u[E]||u.medium;Number(p.value)!==y&&(p.value=String(y))}w&&p.dispatchEvent(new Event("change",{bubbles:!0}))},k=()=>{if(_==="content_length"){m(p.value||"medium",!1);return}let f=r(p.value,u);m(f,!1)};l.addEventListener("input",()=>{let f=Math.max(1,Math.min(3,Number(l.value||2)))-1,w=g[f]?.key||"medium";m(w,!0)}),p.addEventListener("change",k),k(),l.dataset.lengthListenerAttached="true"},s=d=>{!d||d.dataset.aiSettingsInit==="true"||(e(d),c(d),i(d),d.dataset.aiSettingsInit="true")};function t(d){let a=d||document.getElementById("aipkit_autogpt_container");a&&a.querySelectorAll(".aipkit_ai_settings_redesigned").forEach(s)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>t()):t(),window.aipkit_initAutogptAiSettingsRedesigned=t})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function g(o,r={},n={}){return new Promise((e,i)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return i(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let c=new FormData;c.append("action",o),!Object.prototype.hasOwnProperty.call(r,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&c.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let d in r)Object.prototype.hasOwnProperty.call(r,d)&&(Array.isArray(r[d])?r[d].forEach(a=>{c.append(d+"[]",a)}):c.append(d,r[d]));let s=new AbortController,t=setTimeout(()=>{s.abort()},n.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:c,credentials:"same-origin",signal:s.signal}).then(d=>(clearTimeout(t),d.json())).then(d=>{if(d.success)e(d.data);else{let a=d.data||{},l=a.message||"Unknown error",p=new Error(l);a.debug_error&&(p.debug=a.debug_error),p.data=a,a.code&&(p.code=a.code),a.details&&(p.details=a.details),i(p)}}).catch(d=>{clearTimeout(t),d.name==="AbortError"?i(new Error("Request timeout")):i(d)})})}window.aipkit_apiRequest=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_modulesMenu");if(o){let n=o.querySelector(".aipkit_dropdown-panel"),e=o.querySelector(".aipkit_menu-trigger");e&&e.addEventListener("click",function(i){i.stopPropagation(),o.classList.toggle("aipkit_show-menu")}),n&&n.addEventListener("click",function(i){i.stopPropagation()})}document.addEventListener("click",function(n){o&&o.classList.contains("aipkit_show-menu")&&(o.contains(n.target)||o.classList.remove("aipkit_show-menu"))});let r=document.getElementById("aipkit_modulesMenuMobile");if(r){r.addEventListener("click",function(e){e.stopPropagation(),r.classList.toggle("aipkit_show-menu")});let n=r.querySelector(".aipkit_dropdown-menu");n&&n.addEventListener("click",function(e){e.stopPropagation()})}}window.aipkit_initSettingsMenus=g})();(function(){"use strict";function g(){let n=document.getElementById("aipkit_upgradeBtn"),e=document.getElementById("aipkit_upgradeModal");!n||!e||(n.addEventListener("click",function(i){i.preventDefault(),o(e)}),e.querySelectorAll("[data-close-modal]").forEach(function(i){i.addEventListener("click",function(c){c.preventDefault(),r(e)})}),document.addEventListener("keydown",function(i){i.key==="Escape"&&e.classList.contains("aipkit_active")&&r(e)}),e.querySelector(".aipkit_modal").addEventListener("click",function(i){i.stopPropagation()}))}function o(n){n.classList.add("aipkit_active"),document.body.classList.add("aipkit_upgrade_modal_open");let e=n.querySelector('button, a, [tabindex]:not([tabindex="-1"])');e&&setTimeout(()=>e.focus(),100)}function r(n){n.classList.remove("aipkit_active"),document.body.classList.remove("aipkit_upgrade_modal_open")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g(),window.aipkit_initUpgradeModal=g})();(function(){"use strict";let g={settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",stats:"aipkit_initStats","image-generator":"aipkit_initImageGenerator",sources:"aipkit_initSources","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"};async function o(r,n,e){let i={};if(typeof n=="function"?e=n:typeof n=="object"&&n!==null&&(i=n),r==="chatbot"&&!i.force_active_bot_id&&!i.force_active_tab)try{let l=localStorage.getItem("aipkit_last_selected_chatbot");l&&(i.force_active_bot_id=l)}catch(l){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",l)}if(r==="chatbot"&&!i.layout)try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(i.layout="next")}catch(l){console.warn("AIPKit Loader: Failed to read chatbot layout flag from URL:",l)}document.querySelectorAll(".aipkit_module-link").forEach(l=>l.classList.remove("aipkit_active"));let s=document.querySelector(`.aipkit_module-link[data-module="${r}"]`);s&&s.classList.add("aipkit_active");let t=document.getElementById("aipkit_module-container");if(!t)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof e=="function"&&e(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));let d=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",r):`Loading ${r}...`;if(t.innerHTML=`
            <div class="aipkit_container aipkit_loading-placeholder">
                <div class="aipkit_container-body">
                    <p style="text-align: center; padding: 30px;">
                        <span class="aipkit_spinner"
                            style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                        </span>
                        ${d}
                    </p>
                </div>
            </div>
        `,typeof window.aipkit_apiRequest!="function"){let l="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${r}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(t,r,l),typeof e=="function"&&e(new Error(l)),Promise.reject(new Error(l))}let a={module:r,...i};try{let l=await window.aipkit_apiRequest("aipkit_dashboard_load_module",a);if(!l||typeof l.html!="string")throw new Error('Missing or invalid "html" in response data');t.innerHTML=l.html,r==="chatbot"&&l.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=l.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let p=g[r];if(p&&typeof window[p]=="function")try{window[p]()}catch(_){let u=`Error initializing ${r} module scripts.`;return console.error(`AIPKit Loader: Error executing initializer '${p}':`,_),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(t,r,u+` (Details: ${_.message})`),typeof e=="function"&&e(new Error(u+` (Details: ${_.message})`)),Promise.reject(new Error(u+` (Details: ${_.message})`))}return typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(t),typeof e=="function"&&e(),Promise.resolve()}catch(l){return l&&l.debug?console.error(`AIPKit Loader: Module loading error for '${r}':`,l.message,`
Server debug:`,l.debug):console.error(`AIPKit Loader: Module loading error for '${r}':`,l),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(t,r,l.message),typeof e=="function"&&e(l),Promise.reject(l)}}window.aipkit_loadModule=o})();(function(){"use strict";function g(o,r,n){if(!o)return;let e=window.aipkit_dashboard?.text||{},i=e.errorLoadingModuleTitle||"Error Loading Module",c=e.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",s=e.errorDetails||"Details:",t=c.replace("%s",r);o.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${i}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${t}</p>
                    <p><strong>${s}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${n||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_modulesMenu");if(!o)return;let r=o.querySelector(".aipkit_dropdown-panel");r&&(r.addEventListener("change",function(n){let e=n.target;if(e.matches&&e.matches(".aipkit_module-toggle")){let i=r.querySelectorAll(".aipkit_module-toggle");i.forEach(_=>_.disabled=!0),i.forEach(_=>_.disabled=!0);let c=e.getAttribute("data-module"),s=e.getAttribute("data-option-key"),t=e.getAttribute("data-icon"),d=e.getAttribute("data-label"),a=e.checked,l=document.querySelector(`.aipkit_module-link[data-module="${c}"]`);a?l?l.style.display="":console.log(`Module Toggle: Enabling '${c}'. Nav link will appear on refresh if needed.`):l&&(l.style.display="none");let p={moduleKey:s,enabled:a?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),e.checked=!a,l&&(l.style.display=a?"none":""),i.forEach(_=>_.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",p).then(()=>{console.log(`Module Toggle: '${c}' status updated successfully.`)}).catch(_=>{console.error("Error updating module setting:",_.message),alert(`Error updating module setting: ${_.message}`),e.checked=!a,l&&(l.style.display=a?"none":"")}).finally(()=>{i.forEach(_=>_.disabled=!1)})}}),r.addEventListener("click",function(n){let e=n.target.closest(".aipkit_module-item");if(e){let i=e.querySelector(".aipkit_toggle-switch");if(i&&!i.contains(n.target)){let c=e.querySelector(".aipkit_module-toggle");if(c&&!c.disabled){c.checked=!c.checked;let s=new Event("change",{bubbles:!0});c.dispatchEvent(s)}}}}))}window.aipkit_initModuleToggles=g})();(function(){"use strict";function g(){document.querySelectorAll(".aipkit_tabs").forEach(n=>{if(n.dataset.tabGroupListenerAttached==="true")return;let e=n.querySelectorAll(".aipkit_tab"),i=n.nextElementSibling;if(!i||!i.classList.contains("aipkit_tab_content_container")){let c=n.closest(".aipkit_container-body, .aipkit_container"),s=c?c.querySelector(".aipkit_tab_content_container"):null;if(!s)return;let t=s.querySelectorAll(".aipkit_tab-content");o(n,e,t)}else{let c=i.querySelectorAll(".aipkit_tab-content");o(n,e,c)}})}function o(r,n,e){n.forEach(i=>{i.addEventListener("click",function(){n.forEach(t=>t.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),e.forEach(t=>t.classList.remove("aipkit_active"));let c=this.getAttribute("data-tab"),s=Array.from(e).find(t=>t.id===c+"-content");s&&(s.classList.add("aipkit_active"),s.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),r.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=g})();document.addEventListener("DOMContentLoaded",function(){typeof window.aipkit_initSettingsMenus=="function"?window.aipkit_initSettingsMenus():console.error("AIPKit Main: aipkit_initSettingsMenus function not found."),typeof window.aipkit_initModuleToggles=="function"?window.aipkit_initModuleToggles():console.error("AIPKit Main: aipkit_initModuleToggles function not found.");let r=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(r)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let n=["settings","chatbot","content-writer","ai-forms","image-generator","sources"],e=Array.from(document.querySelectorAll(".aipkit_module-link")),i=null;for(let c=0;c<n.length;c++){let s=n[c];if(e.find(d=>d.getAttribute("data-module")===s&&d.offsetParent!==null)){i=s;break}}if(!i){let c=e.find(s=>s.offsetParent!==null);c&&(i=c.getAttribute("data-module"))}if(i)window.aipkit_loadModule(i);else if(e.find(s=>s.getAttribute("data-module")==="settings"))window.aipkit_loadModule("settings");else{let s=document.getElementById("aipkit_module-container");s&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(s,"initial","No modules enabled or accessible. Please activate modules via the top-right menu or check permissions."):s&&(s.innerHTML='<p style="text-align:center; padding: 30px;">No modules enabled. Activate modules via the top-right menu.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!r){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let n=document.getElementById("aipkit_module-container");n&&(n.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector("#aipkit_sources_settings_popover");if(!r)return;let n=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!n.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),i=r.querySelector(".aipkit_model_settings_popover_back"),c=o.querySelector("#aipkit_sources_settings_trigger"),s={root:r.dataset.titleRoot||"Settings",general:r.dataset.titleGeneral||"General","provider-credentials":r.dataset.titleProviderCredentials||"Provider credentials","document-chunking":r.dataset.titleDocumentChunking||"Document chunking"},t=null,d=a=>{let l=a||"root",p=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let _=p.dataset.aipkitSettingsPanel||"root";_!==t&&(n.forEach(u=>{u.hidden=u!==p}),e&&(e.textContent=s[_]||s.root),i&&(i.hidden=_==="root"),t=_,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",a=>{let l=a.target.closest("[data-aipkit-panel-target]");if(!l)return;a.preventDefault();let p=l.dataset.aipkitPanelTarget;d(p)}),i&&i.addEventListener("click",a=>{a.preventDefault(),d("root")}),c&&c.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitSources_initSettingsPopoverPanels=g})();(function(){"use strict";let g=window.wp&&window.wp.i18n?window.wp.i18n:null,o=g&&typeof g.__=="function"?g.__:N=>N,r=g&&typeof g.sprintf=="function"?g.sprintf:(N,...R)=>N.replace(/%s/g,()=>R.shift()),n=g&&typeof g._n=="function"?g._n:(N,R,j)=>j===1?N:R,e=typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml:N=>String(N??""),i=60,c={openai:{singular:o("Vector store","gpt3-ai-content-generator"),plural:o("Vector stores","gpt3-ai-content-generator"),loading:o("Loading vector stores...","gpt3-ai-content-generator"),empty:o("No vector stores found.","gpt3-ai-content-generator")},pinecone:{singular:o("Index","gpt3-ai-content-generator"),plural:o("Indexes","gpt3-ai-content-generator"),loading:o("Loading indexes...","gpt3-ai-content-generator"),empty:o("No indexes found.","gpt3-ai-content-generator")},qdrant:{singular:o("Collection","gpt3-ai-content-generator"),plural:o("Collections","gpt3-ai-content-generator"),loading:o("Loading collections...","gpt3-ai-content-generator"),empty:o("No collections found.","gpt3-ai-content-generator")},default:{singular:o("Index","gpt3-ai-content-generator"),plural:o("Indexes","gpt3-ai-content-generator"),loading:o("Loading indexes...","gpt3-ai-content-generator"),empty:o("No indexes found.","gpt3-ai-content-generator")}},s={openai:{key:"openai",typeLabel:o("Vector stores","gpt3-ai-content-generator"),emptyLabel:o("No vector stores found.","gpt3-ai-content-generator"),loadingLabel:o("Loading vector stores...","gpt3-ai-content-generator"),listAction:"aipkit_list_vector_stores_openai",listKey:"stores",createAction:"aipkit_create_vector_store_openai",createKey:"store",nameLabel:o("Store name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. Product FAQ","gpt3-ai-content-generator"),countSingular:o("store","gpt3-ai-content-generator"),countPlural:o("stores","gpt3-ai-content-generator"),needsDimension:!1},pinecone:{key:"pinecone",typeLabel:o("Indexes","gpt3-ai-content-generator"),emptyLabel:o("No indexes found.","gpt3-ai-content-generator"),loadingLabel:o("Loading indexes...","gpt3-ai-content-generator"),listAction:"aipkit_list_indexes_pinecone",listKey:"indexes",createAction:"aipkit_create_index_pinecone",createKey:"index",nameLabel:o("Index name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. site-content","gpt3-ai-content-generator"),countSingular:o("index","gpt3-ai-content-generator"),countPlural:o("indexes","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536},qdrant:{key:"qdrant",typeLabel:o("Collections","gpt3-ai-content-generator"),emptyLabel:o("No collections found.","gpt3-ai-content-generator"),loadingLabel:o("Loading collections...","gpt3-ai-content-generator"),listAction:"aipkit_list_collections_qdrant",listKey:"collections",createAction:"aipkit_create_collection_qdrant",createKey:"collection",nameLabel:o("Collection name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. docs","gpt3-ai-content-generator"),countSingular:o("collection","gpt3-ai-content-generator"),countPlural:o("collections","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536}},t={openai:"aipkit_vector_store_nonce_openai",pinecone:"aipkit_vector_store_pinecone_nonce_management",qdrant:"aipkit_vector_store_qdrant_nonce_management"},d={openai:{action:"aipkit_delete_vector_store_openai",param:"store_id",label:o("vector store","gpt3-ai-content-generator")},pinecone:{action:"aipkit_delete_index_pinecone",param:"index_name",label:o("index","gpt3-ai-content-generator")},qdrant:{action:"aipkit_delete_collection_qdrant",param:"collection_name",label:o("collection","gpt3-ai-content-generator")}},a="aipkit_sources_filters_v1";function l(){try{let N=window.localStorage.getItem(a);if(!N)return{};let R=JSON.parse(N);return R&&typeof R=="object"?R:{}}catch{return{}}}function p(N){try{window.localStorage.setItem(a,JSON.stringify(N))}catch{}}function _(N){if(!N)return[];try{let R=JSON.parse(N);return Array.isArray(R)?R:[]}catch{return[]}}function u(N,R){return N?N.length>R?`${N.slice(0,R)}...`:N:""}function m(N){return String(N||"").trim().toLowerCase()}function k(N){return s[m(N)]||null}function f(N){return d[m(N)]||null}function w(N){let R=m(N);return c[R]||c.default}function E(){let N=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return N&&typeof N=="object"?N:{}}function y(N){let R=m(N),j=E();return Object.prototype.hasOwnProperty.call(j,R)?!!j[R]:null}function I(N){let R=y(N);return R===!0?{label:o("Connected","gpt3-ai-content-generator"),className:"aipkit_status-success"}:R===!1?{label:o("Needs setup","gpt3-ai-content-generator"),className:"aipkit_status-warning"}:{label:o("Unknown","gpt3-ai-content-generator"),className:"aipkit_status-info"}}function S(N,R){return!R||typeof R!="object"?"":N==="openai"?R.id||R.vector_store_id||"":N==="pinecone"?R.name||R.id||"":N==="qdrant"?R.name||R.id||R.collection_name||"":R.id||R.name||""}function h(N,R){let j=S(N,R);return!R||typeof R!="object"?j||"\u2014":R.name||R.vector_store_name||j||"\u2014"}function M(N){let R=String(N?.message||"").toLowerCase(),j=m(N?.provider||""),L=String(N?.file_id||""),K=!!N?.post_id;if(R.includes("file content submitted for indexing")||R.includes("file content embedded and upserted")||R.includes("original filename:")||R.includes("file uploaded"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if((j==="pinecone"||j==="qdrant")&&L&&(L.includes("pinecone_file_")||L.includes("file_"))&&!L.startsWith("wp_post_")&&!L.startsWith("text_"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if(R.includes("text content submitted for indexing"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(j==="qdrant"&&R.includes("points upserted to qdrant"))return K||R.includes("post id:")?{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"}:{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(j==="pinecone"&&R.includes("vectors upserted")){if(L.startsWith("wp_post_"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(L.startsWith("text_"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(L.includes("pinecone_file_")||L.includes("file_"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"}}if(R.includes("wordpress post content submitted for indexing"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(K)return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(j==="pinecone"&&L){if(L.startsWith("wp_post_"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(L.startsWith("text_"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"}}return{key:"na",label:o("N/A","gpt3-ai-content-generator"),className:""}}function b(N){let R=N||"";return R==="indexed"||R==="skipped_already_indexed"||R==="success"?{label:o("Trained","gpt3-ai-content-generator"),className:"aipkit_status-success"}:R==="failed"?{label:R.replace(/_/g," "),className:"aipkit_status-warning"}:R?{label:R.replace(/_/g," "),className:"aipkit_status-info"}:{label:"\u2014",className:"aipkit_status-info"}}function A(N){return N.post_title?String(N.post_title):N.post_id?`${o("Post","gpt3-ai-content-generator")} #${N.post_id}`:N.indexed_content?String(N.indexed_content):N.message?String(N.message):N.file_id?String(N.file_id):N.vector_store_name?String(N.vector_store_name):"\u2014"}function x(N){let R=m(N);return R?{openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"}[R]||String(N):"\u2014"}function v(N){let R=m(N);return R&&["openai","pinecone","qdrant"].includes(R)?`aipkit_settings_select_picker_icon--${R}`:""}function C(N){return N.vector_store_name?String(N.vector_store_name):N.vector_store_id?String(N.vector_store_id):"\u2014"}function P(N,R,j){if(!N)return;let L=N.classList.contains("aipkit_training_status");if(N.textContent=R||"",L){N.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),R&&N.classList.add("is-visible"),j&&N.classList.add(`is-${j}`);return}N.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),j==="success"?N.classList.add("aipkit_form-help-success"):j==="error"&&N.classList.add("aipkit_form-help-error")}function $(N,R,j){N&&(N.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${e(j)}</td></tr>`,R&&(R.innerHTML=""))}function U(N,R){if(!N)return;if(!Array.isArray(R)||!R.length){$(N,null,o("No sources found.","gpt3-ai-content-generator"));return}let j=R.map(L=>{let K=M(L),V=b(L.status),ee=L.status==="processing"||L.status==="queued",J=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(L.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(L.timestamp):L.timestamp||"\u2014",le=x(L.provider),ue=v(L.provider),be=ue?`<span class="aipkit_settings_select_picker_icon ${e(ue)}" aria-hidden="true"></span>`:"",ze=C(L),Me=u(ze,40),rt=le?`${le} \xB7 ${ze}`:ze,Ue=String(A(L)||"\u2014"),vt=u(Ue,i),we=L.indexed_content||"",pt=[];return K.key==="site"&&L.post_id&&L.vector_store_id&&L.file_id&&pt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              data-post-id="${e(L.post_id||"")}"
              data-embedding-provider="${e(L.embedding_provider||"")}"
              data-embedding-model="${e(L.embedding_model||"")}"
              ${ee?'disabled aria-disabled="true"':""}
            >${e(o(ee?"Training...":"Retrain","gpt3-ai-content-generator"))}</button>`),K.key==="text"&&we&&L.vector_store_id&&L.file_id&&pt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              data-embedding-provider="${e(L.embedding_provider||"")}"
              data-embedding-model="${e(L.embedding_model||"")}"
              data-content="${e(encodeURIComponent(we))}"
              ${ee?'disabled aria-disabled="true"':""}
            >${e(o(ee?"Training...":"Edit","gpt3-ai-content-generator"))}</button>`),we&&pt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_view"
              data-snippet="${e(we)}"
              ${ee?'disabled aria-disabled="true"':""}
            >${e(o("View","gpt3-ai-content-generator"))}</button>`),L.file_id&&pt.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              ${ee?'disabled aria-disabled="true"':""}
            >${e(o("Delete","gpt3-ai-content-generator"))}</button>`),`<tr data-log-id="${e(L.id||"")}">
          <td>${e(J)}</td>
          <td title="${e(rt)}">
            <span class="aipkit_popover_option_label_group">
              ${be}
              <span>${e(Me)}</span>
            </span>
          </td>
          <td><span class="aipkit_content-type-tag ${e(K.className)}">${e(K.label)}</span></td>
          <td title="${e(Ue)}">${e(vt)}</td>
          <td><span class="aipkit_status-tag ${e(V.className)}">${e(V.label)}</span></td>
          <td class="aipkit_actions_cell">
            <div class="aipkit-table-actions-group">${pt.join("")}</div>
          </td>
        </tr>`}).join("");N.innerHTML=j}function B(N,R,j){if(!R)return;R.innerHTML="";let L=Number(N?.total_logs||0),K=Number(N?.total_pages||0),V=Number(N?.current_page||1);if(!L)return;let ee=document.createElement("span");if(ee.className="aipkit_pagination-count",ee.textContent=`${L.toLocaleString()} ${n("source","sources",L,"gpt3-ai-content-generator")}`,R.appendChild(ee),K<=1)return;let J=document.createElement("span");J.className="aipkit_pagination-links";let le=document.createElement("button");le.type="button",le.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",le.textContent=o("Prev","gpt3-ai-content-generator"),le.disabled=V<=1,le.addEventListener("click",()=>j(V-1));let ue=document.createElement("span");ue.className="aipkit_pagination-current",ue.textContent=`${V}/${K}`;let be=document.createElement("button");be.type="button",be.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",be.textContent=o("Next","gpt3-ai-content-generator"),be.disabled=V>=K,be.addEventListener("click",()=>j(V+1)),J.appendChild(le),J.appendChild(ue),J.appendChild(be),R.appendChild(J)}function D(){let N=document.getElementById("aipkit_sources_module_container");if(!N)return;let R=document.getElementById("aipkit_sources_table_body"),j=document.getElementById("aipkit_sources_pagination"),L=document.getElementById("aipkit_sources_status"),K=document.getElementById("aipkit_sources_provider_filter"),V=document.getElementById("aipkit_sources_index_filter"),ee=document.getElementById("aipkit_sources_status_filter"),J=document.getElementById("aipkit_sources_type_filter"),le=document.getElementById("aipkit_sources_search_input"),ue=document.getElementById("aipkit_sources_provider_popover_body"),be=document.getElementById("aipkit_sources_settings_trigger"),ze=document.getElementById("aipkit_sources_settings_popover"),Me=document.getElementById("aipkit_sources_indexing_manage"),rt=N.querySelector('[data-aipkit-settings-action="indexing-controls"]'),Ue=Me||rt,vt=document.getElementById("aipkit_sources_settings_save"),we=document.getElementById("aipkit_sources_settings_sheet"),pt=we?we.querySelector(".aipkit_builder_sheet_close"):null,st=document.getElementById("aipkit_save_indexing_settings_btn"),bt=document.getElementById("aipkit_indexing_settings_messages"),wt=document.getElementById("aipkit_sources_settings_sheet_messages"),Ht=document.getElementById("aipkit_sources_semantic_manage"),se=N.querySelector('[data-aipkit-settings-action="semantic-search"]'),me=Ht||se,de=document.getElementById("aipkit_sources_semantic_sheet"),ve=de?de.querySelector(".aipkit_builder_sheet_close"):null,qe=document.getElementById("aipkit_sources_semantic_vector_provider"),Se=document.getElementById("aipkit_sources_semantic_target_id"),Je=document.getElementById("aipkit_sources_semantic_target_label"),nt=document.getElementById("aipkit_sources_semantic_embedding_model"),Vt=document.getElementById("aipkit_sources_semantic_embedding_provider"),ai=document.getElementById("aipkit_sources_semantic_num_results"),ti=document.getElementById("aipkit_sources_semantic_no_results_text"),Ft=document.getElementById("aipkit_sources_semantic_shortcode_copy"),ht=document.getElementById("aipkit_sources_semantic_demo_form"),Le=document.getElementById("aipkit_sources_semantic_demo_input"),Te=document.getElementById("aipkit_sources_semantic_demo_results"),xt=document.getElementById("aipkit_sources_semantic_demo_submit"),Kt=document.getElementById("aipkit_sources_index_empty_action"),yt=document.getElementById("aipkit_sources_index_create_trigger"),ot=document.getElementById("aipkit_sources_editor_modal"),Li=ot?ot.querySelector(".aipkit_sources_editor_textarea"):null,yi=ot?ot.querySelector(".aipkit_sources_editor_close"):null,Zt=ot?ot.querySelector(".aipkit_sources_editor_cancel"):null,Nt=ot?ot.querySelector(".aipkit_sources_editor_save"):null,Jt=document.getElementById("aipkit_sources_view_modal"),Pi=Jt?Jt.querySelector(".aipkit_sources_view_textarea"):null,Hi=Jt?Jt.querySelector(".aipkit_sources_view_close"):null,ji=Jt?Jt.querySelector(".aipkit_sources_view_close_btn"):null,ii=document.getElementById("aipkit_sources_delete_modal"),pe=ii?ii.querySelector(".aipkit_sources_delete_close"):null,xe=ii?ii.querySelector(".aipkit_sources_delete_cancel"):null,ke=ii?ii.querySelector(".aipkit_sources_delete_confirm"):null;if(!R||typeof window.aipkit_apiRequest!="function")return;let tt=l(),Ye=tt.indexByProvider&&typeof tt.indexByProvider=="object"?{...tt.indexByProvider}:{},Ot=tt.embeddingByProvider&&typeof tt.embeddingByProvider=="object"?{...tt.embeddingByProvider}:{};K&&typeof tt.provider=="string"&&Array.from(K.options).some(q=>q.value===tt.provider)&&(K.value=tt.provider),ee&&typeof tt.status=="string"&&Array.from(ee.options).some(q=>q.value===tt.status)&&(ee.value=tt.status),J&&typeof tt.type=="string"&&Array.from(J.options).some(q=>q.value===tt.type)&&(J.value=tt.type),typeof window.aipkit_initChatSelectPickers=="function"&&window.aipkit_initChatSelectPickers();let qt=null,kt=null,zt=null,Dt=null,it=null,Wt=null,Ae={page:1,perPage:10,provider:K?K.value:"",status:ee?ee.value:"",type:J?J.value:"",search:le?le.value.trim():"",indexByProvider:Ye,embeddingByProvider:Ot,openIndexCreateOnOpen:!1},Lt={activeProvider:"",stores:{},syncTokens:{}},ut={nonce:N.dataset.settingsNonce||"",isPro:N.dataset.settingsIsPro==="1"||N.dataset.settingsIsPro==="true"},ft={initialized:!1,accordionsBound:!1,saveBound:!1,autosaveBound:!1,originalSettings:{}},Ri=null,_n=!1,Di=!1,at={nonce:N.dataset.semanticSearchNonce||"",pineconeIndexes:_(N.dataset.semanticPineconeIndexes),qdrantCollections:_(N.dataset.semanticQdrantCollections)},Ui={initialized:!1,autosaveBound:!1,dirty:!1},pi=null,Mt=!1,$n=!1,vi={pinecone_api_key:N.dataset.pineconeApiKey||"",qdrant_api_key:N.dataset.qdrantApiKey||"",qdrant_url:N.dataset.qdrantUrl||""},oi=null,Ni=()=>{qt&&window.clearTimeout(qt),qt=window.setTimeout(()=>{P(L,"","")},3e3)},Vi=()=>{Dt&&window.clearTimeout(Dt),Dt=window.setTimeout(()=>{P(bt,"","")},3e3)},ni=()=>!V||V.disabled?"":V.value||"",un=()=>!V||!V.id?null:document.getElementById(`${V.id}_picker_btn`),Yn=Q=>{if(!V)return;let q=!Q;V.hidden=q;let F=un();F&&(F.hidden=q)},ki=(Q,q={})=>{if(!V)return;V.disabled=Q;let F=un();F&&(q.disableTrigger!==!1?(F.disabled=Q,Q?F.setAttribute("aria-disabled","true"):F.removeAttribute("aria-disabled")):(F.disabled=!1,F.removeAttribute("aria-disabled")))},ci=(Q,q)=>{if(!Kt||!yt)return;Kt.hidden=!Q;let F=un();if(F&&(Q?F.hidden=!0:(!V||!V.hidden)&&(F.hidden=!1)),!Q)return;let T=m(q),W=w(T);yt.textContent=r(o("Create new %s","gpt3-ai-content-generator"),W.singular.toLowerCase());let Y=y(T),te=!!T&&Y!==!1;yt.disabled=!te,te?(yt.removeAttribute("aria-disabled"),yt.removeAttribute("title")):(yt.setAttribute("aria-disabled","true"),yt.setAttribute("title",o("Add credentials to create.","gpt3-ai-content-generator")))},uo=Q=>{let q=un();if(!q||!Q)return;let F=Q.getBoundingClientRect(),T={hidden:q.hidden,style:q.getAttribute("style")||""};q.hidden=!1,q.style.position="fixed",q.style.left=`${Math.round(F.left)}px`,q.style.top=`${Math.round(F.top)}px`,q.style.width=`${Math.round(F.width)}px`,q.style.height=`${Math.round(F.height)}px`,q.style.opacity="0",q.style.pointerEvents="none",q.click();let W=()=>{q.setAttribute("style",T.style),T.hidden&&(q.hidden=!0)};window.requestAnimationFrame(()=>{window.requestAnimationFrame(W)})},$i=()=>!V||!V.id?null:document.getElementById(`${V.id}_picker_popover`),fi=()=>{let Q=$i();if(!Q)return null;Q.classList.add("aipkit_sources_index_picker_popover");let q=Q.querySelector(".aipkit_model_settings_popover_body");if(!q)return null;let F=q.querySelector(".aipkit_sources_index_picker_actions");return F||(F=document.createElement("div"),F.className="aipkit_sources_index_picker_actions",F.innerHTML=`
          <div class="aipkit_sources_index_action_list">
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_sources_index_new_btn">
              <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
              ${Bt(o("New","gpt3-ai-content-generator"))}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_delete_btn" disabled aria-disabled="true">
              <span class="dashicons dashicons-trash" aria-hidden="true"></span>
              ${Bt(o("Delete","gpt3-ai-content-generator"))}
            </button>
          </div>
          <div class="aipkit_sources_index_inline_form" style="display: none;">
            <div class="aipkit_popover_options_list">
              <div class="aipkit_popover_option_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label aipkit_sources_index_create_label" for="aipkit_sources_index_name_input">
                    ${Bt(o("Create","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="text"
                      id="aipkit_sources_index_name_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--vector-wide aipkit_popover_option_input--framed"
                      placeholder=""
                      data-aipkit-provider-name-input
                    >
                  </div>
                </div>
              </div>
              <div class="aipkit_popover_option_row aipkit_sources_index_dimension_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label" for="aipkit_sources_index_dimension_input">
                    ${Bt(o("Dimension","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="number"
                      id="aipkit_sources_index_dimension_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--compact aipkit_popover_option_input--framed"
                      min="1"
                      placeholder="${Bt(o("e.g. 1536","gpt3-ai-content-generator"))}"
                      data-aipkit-provider-dimension-input
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="aipkit_sources_index_inline_actions">
              <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_create">
                ${Bt(o("Cancel","gpt3-ai-content-generator"))}
              </button>
              <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_sources_index_create_btn">
                ${Bt(o("Create","gpt3-ai-content-generator"))}
              </button>
            </div>
          </div>
          <div class="aipkit_inline_confirm aipkit_sources_index_inline_confirm" style="display: none;">
            <div class="aipkit_inline_confirm_content">
              <p class="aipkit_builder_help_text aipkit_sources_index_delete_confirm_text"></p>
              <div class="aipkit_inline_confirm_actions">
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_confirm_delete">
                  ${Bt(o("Confirm","gpt3-ai-content-generator"))}
                </button>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_delete">
                  ${Bt(o("Cancel","gpt3-ai-content-generator"))}
                </button>
              </div>
            </div>
          </div>
          <p class="aipkit_form-help aipkit_sources_index_status" aria-live="polite" style="display: none;"></p>
        `,q.appendChild(F)),F},on=()=>{let Q=fi();return Q?{footer:Q,actionList:Q.querySelector(".aipkit_sources_index_action_list"),newButton:Q.querySelector(".aipkit_sources_index_new_btn"),deleteButton:Q.querySelector(".aipkit_sources_index_delete_btn"),inlineForm:Q.querySelector(".aipkit_sources_index_inline_form"),createButton:Q.querySelector(".aipkit_sources_index_create_btn"),cancelCreate:Q.querySelector(".aipkit_sources_index_cancel_create"),nameInput:Q.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:Q.querySelector("[data-aipkit-provider-dimension-input]"),dimensionRow:Q.querySelector(".aipkit_sources_index_dimension_row"),createLabel:Q.querySelector(".aipkit_sources_index_create_label"),deleteConfirm:Q.querySelector(".aipkit_sources_index_inline_confirm"),deleteConfirmText:Q.querySelector(".aipkit_sources_index_delete_confirm_text"),confirmDelete:Q.querySelector(".aipkit_sources_index_confirm_delete"),cancelDelete:Q.querySelector(".aipkit_sources_index_cancel_delete"),statusEl:Q.querySelector(".aipkit_sources_index_status")}:null},xi=(Q,q)=>{let F=on(),T=L||(F?F.statusEl:null);T&&(P(T,Q,q),F&&T===F.statusEl&&(T.style.display=Q?"block":"none"))},bi=()=>{zt&&window.clearTimeout(zt),zt=window.setTimeout(()=>{xi("","")},3e3)},St=()=>{let Q=on();Q&&(Q.inlineForm&&(Q.inlineForm.style.display="none"),Q.deleteConfirm&&(Q.deleteConfirm.style.display="none"),Q.actionList&&(Q.actionList.style.display=""),Q.nameInput&&(Q.nameInput.value=""),Q.dimensionInput&&(Q.dimensionInput.value=""),xi("",""))},Fn=Q=>{let q=on();if(!q)return;let F=m(Q),T=F?y(F):null,W=!!F&&T!==!1,Y=W&&!!(V&&V.value);q.nameInput&&(q.nameInput.disabled=!W),q.dimensionInput&&(q.dimensionInput.disabled=!W),q.newButton&&(q.newButton.disabled=!W,W?q.newButton.removeAttribute("aria-disabled"):q.newButton.setAttribute("aria-disabled","true")),q.createButton&&(q.createButton.disabled=!W,W?q.createButton.removeAttribute("aria-disabled"):q.createButton.setAttribute("aria-disabled","true")),q.deleteButton&&(q.deleteButton.disabled=!Y,Y?q.deleteButton.removeAttribute("aria-disabled"):q.deleteButton.setAttribute("aria-disabled","true"))},Tt=Q=>{let q=on();if(!q||!q.dimensionInput)return;let F=m(Q),T=k(F);if(!T||!T.needsDimension)return;let W=T.defaultDimension||1536;q.dimensionInput.value||(q.dimensionInput.value=String(W))},fn=Q=>{let q=on();if(!q)return;let F=m(Q),T=k(F),W=w(F),Y=T?T.namePlaceholder:"",te=T?T.nameLabel:W.singular;q.createLabel&&(q.createLabel.textContent=W.singular),q.nameInput&&(q.nameInput.placeholder=Y,q.nameInput.setAttribute("aria-label",te)),q.dimensionRow&&(q.dimensionRow.style.display=T&&T.needsDimension?"":"none"),Fn(F)},Nn=()=>{let Q=on();if(!Q||Q.footer.dataset.indexActionsBound==="true")return;Q.newButton&&Q.newButton.addEventListener("click",()=>{St(),Q.actionList&&(Q.actionList.style.display="none"),Q.inlineForm&&(Q.inlineForm.style.display=""),Tt(K?K.value:""),Q.nameInput&&(Q.nameInput.focus(),Q.nameInput.select())}),Q.cancelCreate&&Q.cancelCreate.addEventListener("click",()=>{St()}),Q.deleteButton&&Q.deleteButton.addEventListener("click",()=>{let F=m(K?K.value:""),T=V?V.value:"";if(!F||!T){let G=w(F);xi(r(o("Select a %s to delete.","gpt3-ai-content-generator"),G.singular.toLowerCase()),"error"),bi();return}let W=V&&V.selectedOptions?V.selectedOptions[0]:null,Y=W?W.textContent:T,te=f(F),ne=te?te.label:w(F).singular.toLowerCase();Q.deleteConfirmText&&(Q.deleteConfirmText.textContent=r(o('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),ne,Y)),Q.actionList&&(Q.actionList.style.display="none"),Q.inlineForm&&(Q.inlineForm.style.display="none"),Q.deleteConfirm&&(Q.deleteConfirm.style.display="")}),Q.cancelDelete&&Q.cancelDelete.addEventListener("click",()=>{St()}),Q.createButton&&Q.createButton.addEventListener("click",async()=>{let F=m(K?K.value:"");if(!F)return;let T=await Rn(F,Q.createButton,{root:Q.inlineForm,statusUpdater:xi,clearStatusSoon:bi});Fn(F),T&&T.success&&St()}),Q.confirmDelete&&Q.confirmDelete.addEventListener("click",async()=>{let F=m(K?K.value:""),T=V?V.value:"";if(!F||!T)return;let W=V&&V.selectedOptions?V.selectedOptions[0]:null,Y=W?W.textContent:T,te=await On(F,T,Y,Q.confirmDelete,{skipConfirm:!0,statusUpdater:xi,clearStatusSoon:bi,defaultLabel:o("Confirm","gpt3-ai-content-generator")});Qi(),te&&(St(),Ei(1))}),Q.footer.dataset.indexActionsBound="true";let q=un();q&&q.dataset.indexActionsBound!=="true"&&(q.addEventListener("click",()=>{St(),fn(Ae.provider||""),Ae.openIndexCreateOnOpen&&(Ae.openIndexCreateOnOpen=!1,Q.actionList&&(Q.actionList.style.display="none"),Q.inlineForm&&(Q.inlineForm.style.display=""),Tt(Ae.provider||""),Q.nameInput&&(Q.nameInput.focus(),Q.nameInput.select()))}),q.dataset.indexActionsBound="true")},Si=(Q,q,F={})=>{if(!V)return;let T=m(Q),W=T&&Ae.indexByProvider[T]||"",Y=w(T),te=!!T;Yn(te),V.dataset.aipkitPickerTitle=Y.singular;let ne=document.getElementById(`${V.id}_picker_title`);ne&&(ne.textContent=Y.singular);let G=document.getElementById(`${V.id}_picker_search`);if(G){let he=Y.singular?`Search ${Y.singular.toLowerCase()}...`:o("Search...","gpt3-ai-content-generator");G.setAttribute("placeholder",he)}if(V.innerHTML="",!te){let he=document.createElement("option");he.value="",he.textContent=Y.plural,V.appendChild(he),V.value="",ki(!0),ci(!1,T),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),Nn(),fn(T);return}if(F.loading){let he=document.createElement("option");he.value="",he.textContent=Y.loading,he.disabled=!0,V.appendChild(he),V.value="",ki(!0,{disableTrigger:!1}),ci(!1,T),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),Nn(),fn(T);return}let O=Array.isArray(q)?q:[];if(!O.length){let he=document.createElement("option");he.value="",he.textContent=F.emptyLabel||Y.empty,he.disabled=!0,V.appendChild(he),V.value="",ki(!0,{disableTrigger:!1}),ci(!0,T),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),Nn(),fn(T);return}let z=document.createElement("option");z.value="",z.textContent=r(o("All %s","gpt3-ai-content-generator"),Y.plural.toLowerCase()),V.appendChild(z),O.forEach(he=>{let Ke=S(T,he),lt=h(T,he);if(!Ke)return;let mt=document.createElement("option");mt.value=Ke,mt.textContent=lt||Ke,V.appendChild(mt)});let ae=Ae.indexByProvider[T]||"",ge=ae?O.some(he=>S(T,he)===ae):!1;ae&&!ge&&(Ae.indexByProvider[T]=""),V.value=ge?ae:"",ki(!1),ci(!1,T),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),T&&W!==Ae.indexByProvider[T]&&p({provider:Ae.provider,status:Ae.status,type:Ae.type,indexByProvider:Ae.indexByProvider,embeddingByProvider:Ae.embeddingByProvider}),Nn(),fn(T)},ei=()=>bt||L||(ue?ue.querySelector("#aipkit_sources_provider_panel_status"):null),Oi=(Q,q)=>{let F=ei();P(F,Q,q)},zi=()=>{kt&&window.clearTimeout(kt),kt=window.setTimeout(()=>{Oi("","")},3e3)},Ci=()=>{Jt&&(Jt.classList.remove("aipkit-active"),Jt.setAttribute("aria-hidden","true"),Pi&&(Pi.value=""))},Oe=Q=>{!Jt||!Pi||(Pi.value=Q||"",Pi.scrollTop=0,Jt.classList.add("aipkit-active"),Jt.setAttribute("aria-hidden","false"),Pi.focus())},vn=()=>{ot&&(ot.classList.remove("aipkit-active"),ot.setAttribute("aria-hidden","true"),ot.dataset.provider="",ot.dataset.storeId="",ot.dataset.vectorId="",ot.dataset.logId="",ot.dataset.embeddingProvider="",ot.dataset.embeddingModel="",Li&&(Li.value=""))},Ii=Q=>{!ot||!Li||(ot.dataset.provider=Q.dataset.provider||"",ot.dataset.storeId=Q.dataset.storeId||"",ot.dataset.vectorId=Q.dataset.vectorId||"",ot.dataset.logId=Q.dataset.logId||"",ot.dataset.embeddingProvider=Q.dataset.embeddingProvider||"",ot.dataset.embeddingModel=Q.dataset.embeddingModel||"",Li.value=Q.dataset.content?decodeURIComponent(Q.dataset.content):"",ot.classList.add("aipkit-active"),ot.setAttribute("aria-hidden","false"),setTimeout(()=>Li.focus(),0))},gi=()=>{ii&&(ii.classList.remove("aipkit-active"),ii.setAttribute("aria-hidden","true"),ii.dataset.provider="",ii.dataset.storeId="",ii.dataset.vectorId="",ii.dataset.logId="")},li=Q=>{ii&&(ii.dataset.provider=Q.provider||"",ii.dataset.storeId=Q.storeId||"",ii.dataset.vectorId=Q.vectorId||"",ii.dataset.logId=Q.logId||"",ii.classList.add("aipkit-active"),ii.setAttribute("aria-hidden","false"),ke&&(ke.disabled=!1))},Be=Q=>{let q=document.getElementById(Q);return q?q.value:""},si=Q=>{let q=t[m(Q)];return q?Be(q):""},fo=()=>{let Q={...E()};return Q.pinecone=!!vi.pinecone_api_key,Q.qdrant=!!(vi.qdrant_api_key&&vi.qdrant_url),window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=Q,Q};fo();let mo=Q=>Q.startsWith("pinecone_")?"pinecone":Q.startsWith("qdrant_")?"qdrant":"",go=async()=>{if(!ue)return;let Q=ue.querySelectorAll("[data-aipkit-provider-config]");if(!Q.length)return;let q={},F=!1,T=new Set;if(Q.forEach(W=>{let Y=W.dataset.aipkitProviderConfig;if(!Y)return;let te=W.value.trim();if(q[Y]=te,vi[Y]!==te){F=!0;let ne=mo(Y);ne&&T.add(ne)}}),!!F){Oi(o("Saving...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",q),Object.keys(q).forEach(W=>{vi[W]=q[W]}),fo(),Qi(),T.forEach(W=>{y(W)!==!1&&(Lt.activeProvider===W?Sn(W,{silent:!0}):Lt.stores[W]=null)}),Oi(o("Saved","gpt3-ai-content-generator"),"success"),zi()}catch(W){let Y=W&&W.message?W.message:o("Save failed.","gpt3-ai-content-generator");Oi(`${o("Error:","gpt3-ai-content-generator")} ${Y}`,"error"),zi()}}},an=()=>{oi&&window.clearTimeout(oi),oi=window.setTimeout(()=>{go()},600)},bn=(Q=ue)=>Q?{nameInput:Q.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:Q.querySelector("[data-aipkit-provider-dimension-input]"),deleteButton:Q.querySelector("[data-aipkit-provider-delete-selected]")}:{},Qi=()=>{let Q=m(K?K.value:ue?.dataset.provider||""),q=V?V.value:"",F=!!Q&&!!q&&y(Q)===!0,{deleteButton:T}=bn();T&&(T.disabled=!F,F?T.removeAttribute("aria-disabled"):T.setAttribute("aria-disabled","true")),Fn(Q)},Ji=(Q,q,F={})=>{let T=m(Q),W=m(K?K.value:"");if(!T){Si("",[]),Qi();return}T===W&&(Si(T,q,{loading:F.loading===!0,emptyLabel:F.emptyLabel}),Qi())},Yi=(Q,q,F,T)=>{Q&&(q?(Q.disabled=!0,Q.setAttribute("aria-disabled","true"),Q.textContent=T):(Q.disabled=!1,Q.removeAttribute("aria-disabled"),Q.textContent=F))},Sn=async(Q,q={})=>{let F=k(Q);if(!F)return;let T=m(Q),W=q.silent===!0;if(y(T)===!1){Oi(o("Add provider credentials to load stores.","gpt3-ai-content-generator"),"error"),zi();return}let te=si(T);if(!te){Oi(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),zi();return}let ne=`${T}-${Date.now()}`;Lt.syncTokens[T]=ne,Ji(T,Lt.stores[T],{loading:!0}),W||Oi(o("Syncing stores...","gpt3-ai-content-generator"),"");let G={_ajax_nonce:te};T==="openai"&&(G.limit=100,G.order="desc");let O=q.triggerButton||(ue&&ue.dataset.provider===T?ue.querySelector(".aipkit_sources_provider_sync"):null);Yi(O,!0,o("Sync","gpt3-ai-content-generator"),o("Syncing...","gpt3-ai-content-generator"));try{let z=await window.aipkit_apiRequest(F.listAction,G);if(Lt.syncTokens[T]!==ne)return;let ae=Array.isArray(z[F.listKey])?z[F.listKey]:[];Lt.stores[T]=ae,T==="pinecone"?at.pineconeIndexes=ae:T==="qdrant"&&(at.qdrantCollections=ae),qe&&m(qe.value)===T&&tn(T,{preserveValue:!0}),Lt.activeProvider===T&&Ji(T,ae),W||(Oi(z.message||o("Stores synced.","gpt3-ai-content-generator"),"success"),zi())}catch(z){if(Lt.syncTokens[T]!==ne)return;let ae=z&&z.message?z.message:o("Sync failed.","gpt3-ai-content-generator");Oi(`${o("Error:","gpt3-ai-content-generator")} ${ae}`,"error"),zi(),Ji(T,Lt.stores[T])}finally{Yi(O,!1,o("Sync","gpt3-ai-content-generator"),o("Syncing...","gpt3-ai-content-generator"))}},On=async(Q,q,F,T,W={})=>{let Y=f(Q);if(!Y)return!1;let te=m(Q),ne=typeof W.statusUpdater=="function"?W.statusUpdater:Oi,G=typeof W.clearStatusSoon=="function"?W.clearStatusSoon:zi,O=W.defaultLabel||(T?T.textContent.trim():"")||o("Delete","gpt3-ai-content-generator"),z=W.loadingLabel||o("Deleting...","gpt3-ai-content-generator"),ae=!1;if(!q)return ne(o("Missing store identifier.","gpt3-ai-content-generator"),"error"),G(),!1;let ge=F||q,he=r(o('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Y.label,ge);if(W.skipConfirm!==!0&&!window.confirm(he))return!1;let Ke=si(te);if(!Ke)return ne(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),G(),!1;Yi(T,!0,O,z),ne(o("Deleting...","gpt3-ai-content-generator"),"");let lt={_ajax_nonce:Ke};lt[Y.param]=q;try{let mt=await window.aipkit_apiRequest(Y.action,lt),et=(Array.isArray(Lt.stores[te])?Lt.stores[te]:[]).filter(Pt=>S(te,Pt)!==q);Lt.stores[te]=et,te==="pinecone"?at.pineconeIndexes=et:te==="qdrant"&&(at.qdrantCollections=et),qe&&m(qe.value)===te&&tn(te,{preserveValue:!0}),Lt.activeProvider===te&&Ji(te,et),ne(mt.message||o("Deleted.","gpt3-ai-content-generator"),"success"),G(),ae=!0}catch(mt){let Xe=mt&&mt.message?mt.message:o("Delete failed.","gpt3-ai-content-generator");ne(`${o("Error:","gpt3-ai-content-generator")} ${Xe}`,"error"),G()}finally{Yi(T,!1,O,z)}return ae},Rn=async(Q,q,F={})=>{let T=k(Q);if(!T)return{success:!1,createdId:""};let W=m(Q),Y=typeof F.statusUpdater=="function"?F.statusUpdater:Oi,te=typeof F.clearStatusSoon=="function"?F.clearStatusSoon:zi,ne=!1,G="";if(y(W)===!1)return Y(o("Add provider credentials to create stores.","gpt3-ai-content-generator"),"error"),te(),{success:!1,createdId:""};let z=si(W);if(!z)return Y(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),te(),{success:!1,createdId:""};let{nameInput:ae,dimensionInput:ge}=bn(F.root||ue),he=ae?ae.value.trim():"";if(!he)return Y(o("Name is required.","gpt3-ai-content-generator"),"error"),te(),{success:!1,createdId:""};let Ke=0;if(T.needsDimension&&(Ke=ge?parseInt(ge.value,10):0,!Ke||Number.isNaN(Ke)))return Y(o("Dimension is required.","gpt3-ai-content-generator"),"error"),te(),{success:!1,createdId:""};Yi(q,!0,o("Create","gpt3-ai-content-generator"),o("Creating...","gpt3-ai-content-generator")),Y(o("Creating...","gpt3-ai-content-generator"),"");let lt={_ajax_nonce:z,name:he};T.needsDimension&&(lt.dimension=Ke),W==="openai"&&(lt.source_type="sources_module_create");try{let mt=await window.aipkit_apiRequest(T.createAction,lt),Xe=mt[T.createKey];if(Xe){let et=Array.isArray(Lt.stores[W])?Lt.stores[W].slice():[];G=S(W,Xe),G&&et.some(Pt=>S(W,Pt)===G)||et.unshift(Xe),Lt.stores[W]=et,W==="pinecone"?at.pineconeIndexes=Lt.stores[W]:W==="qdrant"&&(at.qdrantCollections=Lt.stores[W]),qe&&m(qe.value)===W&&tn(W,{preserveValue:!0}),Lt.activeProvider===W&&Ji(W,Lt.stores[W])}else await Sn(W);ae&&(ae.value=""),ge&&(ge.value=""),Y(mt.message||o("Store created.","gpt3-ai-content-generator"),"success"),te(),ne=!0}catch(mt){let Xe=mt&&mt.message?mt.message:o("Create failed.","gpt3-ai-content-generator");Y(`${o("Error:","gpt3-ai-content-generator")} ${Xe}`,"error"),te()}finally{Yi(q,!1,o("Create","gpt3-ai-content-generator"),o("Creating...","gpt3-ai-content-generator"))}return{success:ne,createdId:G}},Dn=Q=>{let q=m(Q);if(Lt.activeProvider=q,St(),!q)Si("",[]);else{let F=Lt.stores[q];if(Array.isArray(F))Ji(q,F);else if(y(q))Ji(q,[],{loading:!0}),Sn(q,{silent:!0});else{let T=w(q);Ji(q,[],{emptyLabel:r(o("Add credentials to load %s.","gpt3-ai-content-generator"),T.plural.toLowerCase())})}}Qi()},Xn=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():`text_${Date.now()}`,rn=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now(),en=Q=>typeof CSS<"u"&&CSS.escape?CSS.escape(String(Q)):String(Q).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),Wn=async(Q,q,F,T,W)=>{let Y=Q.toLowerCase();if(Y==="openai"){let G=Be("aipkit_vector_store_nonce_openai");if(!G)throw new Error(o("OpenAI nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:G,target_store_id:q,text_content:F,source_type:"text_entry_global_form"});return}if(!T||!W)throw new Error(o("Select an embedding model.","gpt3-ai-content-generator"));let te=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:F,embedding_provider:T,embedding_model:W}),ne=te.embeddings&&te.embeddings.length?te.embeddings[0]:null;if(!ne)throw new Error(o("Failed to generate embedding.","gpt3-ai-content-generator"));if(Y==="pinecone"){let G=Be("aipkit_vector_store_pinecone_nonce_management");if(!G)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));let O=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:G,vectors:JSON.stringify([{id:O,values:ne,metadata:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:F,vector_id:O}}]),embedding_provider:T,embedding_model:W,original_text_content:F,index_name:q});return}if(Y==="qdrant"){let G=Be("aipkit_vector_store_qdrant_nonce_management");if(!G)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));let O=rn(),z={_ajax_nonce:G,vectors:JSON.stringify([{id:O,vector:ne,payload:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:F,vector_id:O}}]),embedding_provider:T,embedding_model:W,original_text_content:F,collection_name:q,source_context:"sources_module_edit"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",z);return}throw new Error(o("Unsupported provider for edit.","gpt3-ai-content-generator"))},Bt=window.aipkit_escapeHtml||(Q=>Q==null?"":String(Q)),sn=(Q,q)=>{let F=document.createElement("div");F.className="aipkit_indexing_settings_section";let T=document.createElement("h5");T.textContent=o("Basic Labels","gpt3-ai-content-generator"),F.appendChild(T);let W=document.createElement("table");W.className="wp-list-table widefat striped",W.innerHTML=`
        <thead>
          <tr>
            <th>${Bt(o("Label Type","gpt3-ai-content-generator"))}</th>
            <th>${Bt(o("Custom Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Y=W.querySelector("tbody"),te=["source_url","title","excerpt","content"],ne=[o("Source URL","gpt3-ai-content-generator"),o("Title","gpt3-ai-content-generator"),o("Excerpt","gpt3-ai-content-generator"),o("Content","gpt3-ai-content-generator")];return te.forEach((G,O)=>{let z=q&&q[G]?q[G]:ne[O],ae=ft.originalSettings?.[Q]?.basic_labels?.[G]||z,ge=document.createElement("tr");ge.innerHTML=`
          <td><code>${Bt(ne[O])}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Bt(Q)}][basic_labels][${Bt(G)}]"
              value="${Bt(ae)}"
              placeholder="${Bt(z)}"
              ${ut.isPro?"":"disabled"}
            >
          </td>
        `,Y.appendChild(ge)}),F.appendChild(W),F},Zn=(Q,q,F,T)=>{let W=document.createElement("div");if(W.className="aipkit_indexing_settings_section",!T||Object.keys(T).length===0)return W.innerHTML=`<p><em>${Bt(r(o("No %s found for this content type.","gpt3-ai-content-generator"),Q.toLowerCase()))}</em></p>`,W;let Y=document.createElement("h5");Y.textContent=Q,W.appendChild(Y);let te=document.createElement("table");te.className="wp-list-table widefat striped",te.innerHTML=`
        <thead>
          <tr>
            <th class="check-column">
              <input type="checkbox" class="aipkit-indexing-select-all" ${ut.isPro?"":"disabled"} />
            </th>
            <th>${Bt(o("Field / Taxonomy","gpt3-ai-content-generator"))}</th>
            <th>${Bt(o("Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let ne=te.querySelector("tbody");Object.keys(T).forEach(O=>{let z=T[O],ae=ft.originalSettings?.[q]?.[F]?.[O]||{},ge=typeof ae.enabled=="boolean"?ae.enabled:!0,he=ae.label||"",Ke=document.createElement("tr");Ke.innerHTML=`
          <th scope="row" class="check-column">
            <input
              type="checkbox"
              name="settings[${Bt(q)}][${Bt(F)}][${Bt(O)}][enabled]"
              value="1"
              ${ge?"checked":""}
              ${ut.isPro?"":"disabled"}
            >
          </th>
          <td><code>${Bt(O)}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Bt(q)}][${Bt(F)}][${Bt(O)}][label]"
              value="${Bt(he)}"
              placeholder="${Bt(z)}"
              ${ut.isPro?"":"disabled"}
            >
          </td>
        `,ne.appendChild(Ke)});let G=te.querySelector(".aipkit-indexing-select-all");return G&&G.addEventListener("change",O=>{ne.querySelectorAll('input[type="checkbox"]').forEach(z=>{z.checked=O.target.checked})}),W.appendChild(te),W},mn=(Q,q,F)=>{let T=document.createElement("div");T.className="aipkit_accordion";let W=document.createElement("div");W.className="aipkit_accordion-header",W.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${Bt(q)}`;let Y=document.createElement("div");return Y.className="aipkit_accordion-content",Y.appendChild(sn(Q,F.basic_labels||{})),Y.appendChild(Zn(o("Custom Fields","gpt3-ai-content-generator"),Q,"fields",F.fields||{})),Y.appendChild(Zn(o("Taxonomies","gpt3-ai-content-generator"),Q,"taxonomies",F.taxonomies||{})),Q==="product"&&F.woo_attributes&&Y.appendChild(Zn(o("Product Data","gpt3-ai-content-generator"),Q,"woo_attributes",F.woo_attributes)),T.appendChild(W),T.appendChild(Y),T},Io=async()=>{let Q=document.getElementById("aipkit_indexing_settings_form_container");if(Q){if(Q.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${Bt(o("Loading content types...","gpt3-ai-content-generator"))}</p>`,!ut.nonce){Q.innerHTML=`<p class="aipkit_text-danger">${Bt(o("Error: Security token is missing. Cannot load settings.","gpt3-ai-content-generator"))}</p>`;return}try{let q=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:ut.nonce}),F={},T={};if(q&&typeof q.success<"u"){if(!q.success)throw new Error(q.data||"Failed to load content types.");F=q.data?.cpt_data||{},T=q.data?.saved_settings||{}}else q&&(F=q.cpt_data||{},T=q.saved_settings||{});if(ft.originalSettings=T||{},Q.innerHTML="",!Object.keys(F).length){Q.innerHTML=`<p class="aipkit_text-center">${Bt(o("No content types found. Please add content and try again.","gpt3-ai-content-generator"))}</p>`;return}let W=document.createElement("div");W.className="aipkit_accordion-group",Object.keys(F).forEach(te=>{let ne=F[te];W.appendChild(mn(te,ne.label||te,ne))}),Q.appendChild(W);let Y=document.getElementById("aipkit_indexing_settings_form");Y&&!ft.accordionsBound&&(Y.addEventListener("click",te=>{let ne=te.target.closest(".aipkit_accordion-header");ne&&(ne.classList.toggle("aipkit_active"),ne.nextElementSibling&&ne.nextElementSibling.classList.toggle("aipkit_active"))}),ft.accordionsBound=!0)}catch(q){Q.innerHTML=`<p class="aipkit_text-danger">${Bt(q&&q.message?q.message:o("Failed to load content types.","gpt3-ai-content-generator"))}</p>`}}},En=()=>{let Q=document.getElementById("aipkit_indexing_settings_form_container");if(!Q)return{};let q={},F=document.getElementById("aipkit_hide_user_uploads_checkbox");q.hide_user_uploads=F?F.checked:!0;let T=document.getElementById("aipkit_show_index_button_checkbox");q.show_index_button=T?T.checked:!0;let W=document.getElementById("aipkit_chunk_avg_chars_per_token"),Y=document.getElementById("aipkit_chunk_max_tokens_per_chunk"),te=document.getElementById("aipkit_chunk_overlap_tokens");if(W&&Y&&te){let ne=parseInt(W.value,10),G=parseInt(Y.value,10),O=parseInt(te.value,10);Number.isNaN(ne)||(q.chunk_avg_chars_per_token=ne),Number.isNaN(G)||(q.chunk_max_tokens_per_chunk=G),Number.isNaN(O)||(q.chunk_overlap_tokens=O)}return Q.querySelectorAll('input[type="checkbox"]').forEach(ne=>{let G=ne.name.match(/[^[\]']+/g);if(G&&G.length===5&&G[4]==="enabled"){let[,O,z,ae]=G;q[O]||(q[O]={}),q[O][z]||(q[O][z]={}),q[O][z][ae]||(q[O][z][ae]={}),q[O][z][ae].enabled=ne.checked}}),Q.querySelectorAll('input[type="text"]').forEach(ne=>{let G=ne.name.match(/[^[\]']+/g);if(G&&G.length===5&&G[4]==="label"){let[,O,z,ae]=G;q[O]||(q[O]={}),q[O][z]||(q[O][z]={}),q[O][z][ae]||(q[O][z][ae]={}),q[O][z][ae].label=ne.value.trim()}else if(G&&G.length===4&&G[2]==="basic_labels"){let[,O,,z]=G;q[O]||(q[O]={}),q[O].basic_labels||(q[O].basic_labels={}),q[O].basic_labels[z]=ne.value.trim()}}),q},ko=(Q,q)=>{if(!Q)return;Q.dataset.label||(Q.dataset.label=Q.textContent.trim());let F=Q.dataset.label||o("Save","gpt3-ai-content-generator"),T=Q.querySelector(".aipkit_spinner"),W=Q.querySelector(".aipkit_btn-text"),Y=q?o("Saving...","gpt3-ai-content-generator"):F;W?W.textContent=Y:Q.textContent=Y,T&&(T.style.display=q?"inline-block":"none"),Q.disabled=q},Hn=(Q,q)=>{if(!bt)return;P(bt,q,{success:"success",error:"error",info:"loading"}[Q]||""),(Q==="success"||Q==="error")&&Vi()},Mi=async(Q={})=>{let{button:q=null,mode:F="manual"}=Q;if(!ut.nonce)return;q&&ko(q,!0),F==="auto"&&Hn("info",o("Auto-saving...","gpt3-ai-content-generator"));let T=En();try{let W=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:ut.nonce,settings:JSON.stringify(T)});ft.originalSettings=T;let Y=W.message||o("Settings saved!","gpt3-ai-content-generator");Hn("success",F==="auto"?o("Saved","gpt3-ai-content-generator"):Y)}catch(W){let Y=W&&W.message?W.message:o("Failed to save settings.","gpt3-ai-content-generator");Hn("error",Y)}finally{q&&ko(q,!1)}},wo=Q=>{let q=document.getElementById("aipkit_upgradeBtn");if(q){q.click();return}let F=Q&&Q.dataset?Q.dataset.upgradeUrl:"";F&&window.open(F,"_blank","noopener")},Gi=Q=>{Q.preventDefault();let q=Q.currentTarget;if(q&&q.dataset&&q.dataset.upgradeOnly==="1"){wo(q);return}Mi({button:Q.currentTarget,mode:"manual"})},eo=async()=>{if(_n){Di=!0;return}_n=!0,await Mi({mode:"auto"}),_n=!1,Di&&(Di=!1,eo())},xn=()=>{ut.nonce&&(Ri&&window.clearTimeout(Ri),Ri=window.setTimeout(()=>{eo()},600))},ho=()=>{if(ft.autosaveBound)return;[{element:document.getElementById("aipkit_hide_user_uploads_checkbox"),events:["change"]},{element:document.getElementById("aipkit_show_index_button_checkbox"),events:["change"]},{element:document.getElementById("aipkit_chunk_avg_chars_per_token"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_max_tokens_per_chunk"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_overlap_tokens"),events:["input","change"]}].forEach(({element:q,events:F})=>{q&&(F.forEach(T=>{q.addEventListener(T,xn)}),q.addEventListener("blur",xn))}),ft.autosaveBound=!0},Cn=()=>{if(ft.initialized)return!0;let Q=document.getElementById("indexing-settings-tab-content");return Q?Q.dataset.initialized==="true"?(ft.initialized=!0,!0):(Io(),ft.saveBound||(st&&st.addEventListener("click",Gi),ft.saveBound=!0),ho(),Q.dataset.initialized="true",ft.initialized=!0,!0):!1},to=()=>{ze&&(ze.classList.remove("aipkit-active"),ze.setAttribute("aria-hidden","true"),be&&be.setAttribute("aria-expanded","false"))},gn=()=>{we&&(we.classList.add("aipkit-active"),we.setAttribute("aria-hidden","false"),pt&&pt.focus())},io=()=>{we&&(we.classList.remove("aipkit-active"),we.setAttribute("aria-hidden","true"))},qo=()=>bt||L,cn=(Q,q)=>{let F=qo();P(F,Q,q)},Vn=()=>{it&&window.clearTimeout(it),it=window.setTimeout(()=>{cn("","")},3e3)},Un=Q=>{if(!Je)return;let q=w(Q);Je.textContent=q.singular},tn=(Q,q={})=>{if(!Se)return;let F=m(Q),W=q.preserveValue===!0?Se.value:"";Se.innerHTML=`<option value="">${Bt(o("-- Select --","gpt3-ai-content-generator"))}</option>`;let Y=[];if(F==="pinecone"?Y=at.pineconeIndexes:F==="qdrant"&&(Y=at.qdrantCollections),Array.isArray(Y)&&Y.forEach(te=>{let ne=te?.name||te?.id||(typeof te=="string"?te:"");if(!ne)return;let G=document.createElement("option");G.value=ne,G.textContent=ne,Se.appendChild(G)}),W&&Se.querySelector(`option[value="${en(W)}"]`))Se.value=W;else if(W){let te=document.createElement("option");te.value=W,te.textContent=`${W} (${o("Manual","gpt3-ai-content-generator")})`,Se.appendChild(te),Se.value=W}},An=()=>{if(!Vt||!nt)return;let Q=nt.options[nt.selectedIndex];Q&&Q.dataset.provider&&(Vt.value=Q.dataset.provider)},In=()=>({semantic_search_vector_provider:qe?qe.value:"",semantic_search_target_id:Se?Se.value:"",semantic_search_embedding_provider:Vt?Vt.value:"",semantic_search_embedding_model:nt?nt.value:"",semantic_search_num_results:ai?ai.value:"",semantic_search_no_results_text:ti?ti.value:""}),no=async(Q={})=>{let q=Q.mode||"auto";An();let F=In();if(F.semantic_search_vector_provider){q==="auto"&&cn(o("Saving...","gpt3-ai-content-generator"),"loading");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",F),Ui.dirty=!1,cn(o(q==="auto"?"Saved":"Settings saved!","gpt3-ai-content-generator"),"success"),Vn()}catch(T){let W=T&&T.message?T.message:o("Failed to save settings.","gpt3-ai-content-generator");cn(`${o("Error:","gpt3-ai-content-generator")} ${W}`,"error"),Vn()}}},oo=async()=>{if(Mt){$n=!0;return}Mt=!0,await no({mode:"auto"}),Mt=!1,$n&&($n=!1,oo())},Xi=()=>{pi&&window.clearTimeout(pi),Ui.dirty=!0,pi=window.setTimeout(()=>{oo()},600)},yo=()=>{if(Ui.autosaveBound)return;let Q=(q,F=["change"])=>{q&&F.forEach(T=>q.addEventListener(T,Xi))};Q(qe),Q(Se),Q(nt),Q(ai,["input","change"]),Q(ti,["input","change"]),Ui.autosaveBound=!0},vo=()=>Ui.initialized||!qe||!Se||!nt?!1:(Un(qe.value),tn(qe.value,{preserveValue:!0}),An(),yo(),Ui.initialized=!0,!0),Gn=()=>{de&&(vo(),de.classList.add("aipkit-active"),de.setAttribute("aria-hidden","false"),ve&&ve.focus())},Kn=()=>{de&&(de.classList.remove("aipkit-active"),de.setAttribute("aria-hidden","true"))},jn=Q=>{if(!xt)return;let q=xt.querySelector(".aipkit_spinner");q&&(q.style.display=Q?"inline-block":"none"),xt.disabled=Q,xt.setAttribute("aria-disabled",Q?"true":"false")},ln=(Q,q="")=>{Te&&(Te.className="aipkit_sources_semantic_results aipkit_form-help",q&&Te.classList.add(`aipkit_form-help-${q}`),Te.textContent=Q)},Ki=async Q=>{if(!Te)return;let q=In();if(!q.semantic_search_vector_provider||!q.semantic_search_target_id||!q.semantic_search_embedding_model){ln(o("Complete semantic search settings before running a demo.","gpt3-ai-content-generator"));return}if(!at.nonce){ln(o("Security token missing. Please reload.","gpt3-ai-content-generator"),"error");return}(Ui.dirty||Mt)&&await no({mode:"auto"}),jn(!0),Te.innerHTML='<div class="aipkit-search-loading"><span class="aipkit_spinner"></span></div>';try{let F=await window.aipkit_apiRequest("aipkit_perform_semantic_search",{nonce:at.nonce,query:Q});Te.className="aipkit_sources_semantic_results",Te.innerHTML=F.html||`<p>${Bt(q.semantic_search_no_results_text||o("No results found.","gpt3-ai-content-generator"))}</p>`}catch(F){let T=F&&F.message?F.message:o("An error occurred while searching.","gpt3-ai-content-generator");ln(`${o("Error:","gpt3-ai-content-generator")} ${T}`,"error")}finally{jn(!1)}},Ei=async(Q=1)=>{Ae.page=Q,P(L,"",""),R.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${Bt(o("Loading sources...","gpt3-ai-content-generator"))}</td></tr>`,j&&(j.innerHTML="");try{let q=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:Ae.page,per_page:Ae.perPage,provider:Ae.provider,status:Ae.status,type:Ae.type,search:Ae.search,store_id:ni()});U(R,q.logs||[]),B(q.pagination||{},j,Ei)}catch(q){let F=q&&q.message?q.message:o("Error loading sources.","gpt3-ai-content-generator");$(R,j,F),P(L,F,"error")}},qn=(()=>{let Q=document.getElementById("aipkit_sources_training_toggle"),q=document.getElementById("aipkit_sources_training_card");if(!Q||!q)return null;let F=q.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),T=q.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),W=q.querySelector(".aipkit_training_text_input"),Y=q.querySelector("#aipkit_training_qa_question"),te=q.querySelector("#aipkit_training_qa_answer"),ne=q.querySelector("#aipkit_training_files_input"),G=q.querySelector(".aipkit_training_files_button"),O=q.querySelector(".aipkit_builder_dropzone"),z=q.querySelector("#aipkit_training_file_list"),ae=q.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),ge=q.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),he=q.querySelector(".aipkit_training_stop_btn"),Ke=q.querySelector(".aipkit_training_action_row"),lt=q.querySelector("#aipkit_training_status")||L,mt=document.getElementById("aipkit_sources_embedding_row"),Xe=document.getElementById("aipkit_sources_embedding_model"),et=q.querySelector("#aipkit_vs_wp_content_mode"),Pt=q.querySelector("#aipkit_vs_wp_content_status"),ri=q.querySelector("#aipkit_vs_wp_content_status_specific"),Ut=q.querySelector("#aipkit_vs_wp_content_list_area"),gt=q.querySelector("#aipkit_vs_wp_content_pagination"),jt=q.querySelector("#aipkit_vs_wp_content_messages_area"),Ct=q.querySelector("#aipkit_vs_global_target_select"),_i=q.querySelectorAll('input[name="aipkit_wp_content_mode"]'),di=q.querySelector("#aipkit_wp_content_bulk_panel"),qi=q.querySelector("#aipkit_wp_content_specific_panel"),Ce=q.querySelector("#aipkit_wp_content_bulk_hint"),Pe=q.querySelector("#aipkit_wp_content_specific_types_panel"),je=q.querySelector("#aipkit_wp_content_status_wrap_bulk"),He=q.querySelector("#aipkit_wp_content_status_wrap_specific"),Qe=new Map,We={page:1,selectedIds:new Set},De=null,_t=null,wi=!1,Rt=(H,X)=>{lt&&(lt.textContent=H||"",lt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),H&&lt.classList.add("is-visible"),X&&lt.classList.add(`is-${X}`))},hi=(H=2500)=>{De&&window.clearTimeout(De),De=window.setTimeout(()=>{Rt("","")},H)},Ai=(H,X="")=>{if(!jt)return;P(jt,H||"",X==="error"?"error":X==="success"?"success":"")},dn=(H=2500)=>{_t&&window.clearTimeout(_t),_t=window.setTimeout(()=>{Ai("","")},H)},nn=()=>{let H=m(K?K.value:""),X=V&&!V.disabled&&V.value||"";return!H||!X?null:{providerKey:H,storeId:X}},pn=()=>{let H=m(K?K.value:"");if(!H||H==="all")return Rt(o("Select a provider first.","gpt3-ai-content-generator"),"error"),hi(),!1;let X=nn();if(!X||!X.storeId){let oe=w(H);return Rt(r(o("Select a %s first.","gpt3-ai-content-generator"),oe.singular),"error"),hi(),!1}return!0},Lo=H=>{if(!Number.isFinite(H))return"";let X=["B","KB","MB","GB"],oe=H,re=0;for(;oe>=1024&&re<X.length-1;)oe/=1024,re+=1;let ce=re===0?0:1;return`${oe.toFixed(ce)} ${X[re]}`},kn=()=>{O&&(O.style.display=Qe.size>0&&wi?"none":"")},To=(H=1500)=>{z&&window.setTimeout(()=>{Qe.clear(),z.innerHTML="",kn()},H)},ao=H=>{if(!z||!H)return null;let X=`${H.name}_${H.size}_${H.lastModified}`;if(Qe.has(X))return Qe.get(X);let oe=document.createElement("div");oe.className="aipkit_training_file_row",oe.dataset.fileKey=X;let re=document.createElement("div");re.className="aipkit_training_file_meta";let ce=document.createElement("span");ce.className="aipkit_training_file_name",ce.textContent=H.name;let fe=document.createElement("span");fe.className="aipkit_training_file_size",fe.textContent=Lo(H.size);let _e=document.createElement("span");return _e.className="aipkit_training_file_status",_e.textContent=o("Queued","gpt3-ai-content-generator"),re.appendChild(ce),re.appendChild(fe),oe.appendChild(re),oe.appendChild(_e),z.appendChild(oe),Qe.set(X,oe),oe},Gt=(H,X,oe)=>{let re=ao(H);if(!re)return;let ce=re.querySelector(".aipkit_training_file_status");ce&&(ce.textContent=X||"",ce.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),oe&&ce.classList.add(`is-${oe}`))},Ln=async(H,X,oe)=>{if(!H||!H.name||typeof window.aipkit_apiRequest!="function")return!1;let re=m(X);if(!re)return!1;let ce=String(H.name||"").trim();if(!ce)return!1;let fe=Ve=>String(Ve||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),_e=fe(ce),$e=ce.replace(/\.[^/.]+$/,""),Ee=[ce,_e,$e&&$e!==ce?$e:""].filter(Boolean),Fe=async(Ve,Qt)=>{let Et=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:1,per_page:Qt,provider:re,store_id:oe||"",type:"file",search:Ve||""});return Array.isArray(Et.logs)?Et.logs:[]},Re=(Ve,Qt)=>{if(!Ve.length)return null;let Et=Qt.map(fe).filter(Boolean);return Ve.find(Ze=>{let Ie=fe(Ze.message),Ne=fe(Ze.post_title),ct=fe(Ze.file_id);return Et.some(ye=>Ie&&Ie.includes(ye)||Ne&&Ne.includes(ye)||ct&&ct.includes(ye))})||null};try{for(let Et of Ee){let Ze=await Fe(Et,10),Ie=Re(Ze,[Et,_e]);if(Ie){let Ne=String(Ie.status||"").toLowerCase();if(Ne==="indexed"||Ne==="skipped_already_indexed"||Ne==="success")return Gt(H,o("Trained","gpt3-ai-content-generator"),"success"),!0;if(Ne==="failed")return Gt(H,o("Failed","gpt3-ai-content-generator"),"error"),!0;if(Ne==="processing"||Ne==="queued")return Gt(H,o("Processing","gpt3-ai-content-generator"),"loading"),!0}}let Ve=await Fe("",20),Qt=Re(Ve,Ee);if(Qt){let Et=String(Qt.status||"").toLowerCase();if(Et==="indexed"||Et==="skipped_already_indexed"||Et==="success")return Gt(H,o("Trained","gpt3-ai-content-generator"),"success"),!0;if(Et==="failed")return Gt(H,o("Failed","gpt3-ai-content-generator"),"error"),!0;if(Et==="processing"||Et==="queued")return Gt(H,o("Processing","gpt3-ai-content-generator"),"loading"),!0}}catch{}return!1},Tn=(H,X,oe,re=0)=>{if(!H||!X||!oe)return;if(re>=30){Ln(oe,"openai",H).then(_e=>{_e||Gt(oe,o("Queued","gpt3-ai-content-generator"),"warning")});return}let fe=Be("aipkit_vector_store_nonce_openai");if(!fe||typeof window.aipkit_apiRequest!="function"){Ln(oe,"openai",H);return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:H,batch_id:X,_ajax_nonce:fe}).then(_e=>{let $e=(_e.status||"").toLowerCase();if($e==="completed"){Gt(oe,o("Trained","gpt3-ai-content-generator"),"success"),Ei(1);return}if($e==="failed"||$e==="cancelled"){Gt(oe,o("Failed","gpt3-ai-content-generator"),"error");return}Gt(oe,o("Processing","gpt3-ai-content-generator"),"loading"),setTimeout(()=>{Tn(H,X,oe,re+1)},2500)}).catch(()=>{setTimeout(()=>{Tn(H,X,oe,re+1)},3e3)})},wn=H=>H?Array.isArray(H)?H.flatMap(X=>{if(Array.isArray(X))return X;if(X&&typeof X=="object"){if(Array.isArray(X.models))return X.models;if(Array.isArray(X.items))return X.items;if(X.id)return[X]}return[]}):typeof H=="object"?Object.values(H).flatMap(X=>Array.isArray(X)?X:[]):[]:[],Fi=H=>{let X=window.aipkit_dashboard?.embeddingModels||{};return wn(X[H]||[])},Po=(H,X)=>{if(!X)return null;let re=Fi(H).find(_e=>_e&&_e.id===X),ce=re?.dimensions||re?.dimension||re?.output_dimensionality||re?.outputDimensionality||re?.output_dimension,fe=ce?Number(ce):NaN;if(Number.isFinite(fe)&&fe>0)return fe;if(re&&typeof re.name=="string"){let _e=re.name.match(/\((\d{3,5})\)/);if(_e)return Number(_e[1])}return H==="google"?768:1536},mi=H=>{if(!Xe)return;let X=m(H),oe=X&&Ae.embeddingByProvider?Ae.embeddingByProvider[X]:"";if(!oe)return;let re=en(oe);Xe.querySelector(`option[value="${re}"]`)&&(Xe.value=oe)},So=()=>{if(!Xe)return;let H=Xe.value||"",X=["openai","google","azure"],oe={openai:o("OpenAI","gpt3-ai-content-generator"),google:o("Google","gpt3-ai-content-generator"),azure:o("Azure","gpt3-ai-content-generator")};Xe.innerHTML="";let re=document.createElement("option");re.value="",re.textContent=o("Select embedding model","gpt3-ai-content-generator"),Xe.appendChild(re);let ce=!1;if(X.forEach(_e=>{let $e=Fi(_e);if(!$e.length)return;let Ee=document.createElement("optgroup");Ee.label=oe[_e]||_e,$e.forEach(Fe=>{let Re=Fe.id||"";if(!Re)return;let Ve=document.createElement("option");Ve.value=`${_e}::${Re}`,Ve.textContent=Fe.name||Re,Ve.dataset.provider=_e,Ve.dataset.model=Re,Ee.appendChild(Ve)}),Ee.children.length&&(Xe.appendChild(Ee),ce=!0)}),!ce){Xe.innerHTML="";let _e=document.createElement("option");_e.value="",_e.textContent=o("No embedding models found.","gpt3-ai-content-generator"),Xe.appendChild(_e),Xe.disabled=!0;return}if(Xe.disabled=!1,H){let _e=en(H);if(Xe.querySelector(`option[value="${_e}"]`)){Xe.value=H;return}}let fe=Xe.querySelector("optgroup option");fe&&(Xe.value=fe.value)},ro=()=>{if(!Xe)return null;let H=Xe.options[Xe.selectedIndex],X=H&&H.dataset.provider||"",oe=H&&H.dataset.model||"";if(!X||!oe){let re=Xe.value||"";if(re&&re.includes("::")){let[ce,fe]=re.split("::");X=ce||"",oe=fe||""}}return!X||!oe?null:{provider:X,model:oe,dimension:Po(X,oe)}},so=H=>{!he||!ge||(H?(he.hidden=!1,he.disabled=!1,ge.disabled=!0):(he.hidden=!0,he.disabled=!1,ge.disabled=!1))},Pn=()=>{let H=nn(),X=m(K?K.value:H?.providerKey||"");if(ae.forEach(oe=>{oe.disabled=!1,oe.removeAttribute("aria-disabled")}),mt){let oe=X==="pinecone"||X==="qdrant";mt.hidden=!oe,oe&&mi(X)}if(Ct){let oe=H?H.storeId:"";Ct.innerHTML=oe?`<option value="${Bt(oe)}">${Bt(oe)}</option>`:'<option value=""></option>',Ct.value=oe}},Eo=H=>{if(!F||!H)return;F.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(oe=>{let re=oe.dataset.aipkitTab===H;oe.classList.toggle("is-active",re),oe.setAttribute("aria-selected",re?"true":"false")}),T.forEach(oe=>{let re=oe.dataset.aipkitPanel===H;oe.classList.toggle("is-active",re),oe.hidden=!re}),ge&&(ge.style.display=H==="files"?"none":""),Ke&&Ke.classList.toggle("aipkit_builder_action_row--end",H==="files")},Mo=()=>{let H=F?F.querySelector(".aipkit_builder_tab.is-active"):null;return H?H.dataset.aipkitTab:""},hn=()=>et&&et.value||"bulk",Qn=H=>{let X=H==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",oe=document.getElementById(X);return oe?Array.from(oe.selectedOptions).map(re=>re.value).filter(Boolean):[]},co=H=>{let X=H==="specific"?ri:Pt;return X&&X.value||"publish"},Bo=()=>Ut?Array.from(Ut.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(H=>H.value):[],Oo=(H,X,oe)=>{if(!X)return;X.innerHTML="";let re=Number(H?.total_posts||0),ce=Number(H?.total_pages||0),fe=Number(H?.current_page||1);if(!re)return;let _e=document.createElement("span");if(_e.className="aipkit_pagination-count",_e.textContent=`${re.toLocaleString()} ${n("item","items",re,"gpt3-ai-content-generator")}`,X.appendChild(_e),ce<=1)return;let $e=document.createElement("span");$e.className="aipkit_pagination-links";let Ee=document.createElement("button");Ee.type="button",Ee.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Ee.textContent=o("Prev","gpt3-ai-content-generator"),Ee.disabled=fe<=1,Ee.addEventListener("click",()=>oe(fe-1));let Fe=document.createElement("span");Fe.className="aipkit_pagination-current",Fe.textContent=`${fe}/${ce}`;let Re=document.createElement("button");Re.type="button",Re.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Re.textContent=o("Next","gpt3-ai-content-generator"),Re.disabled=fe>=ce,Re.addEventListener("click",()=>oe(fe+1)),$e.appendChild(Ee),$e.appendChild(Fe),$e.appendChild(Re),X.appendChild($e)},lo=(H,X)=>{if(!Ut)return;if(Ut.innerHTML="",!Array.isArray(H)||!H.length){Ut.innerHTML=`<p class="aipkit_builder_help_text">${Bt(o("No posts found for selection.","gpt3-ai-content-generator"))}</p>`,gt&&(gt.innerHTML="");return}let oe=document.createElement("ul"),re=document.createElement("div");re.className="aipkit_wp_content_select_all_wrapper";let ce=document.createElement("label");ce.className="aipkit_training_site_option";let fe=document.createElement("input");fe.type="checkbox",fe.checked=H.every(_e=>We.selectedIds.has(String(_e.id))),ce.appendChild(fe),ce.appendChild(document.createTextNode(o("Select all","gpt3-ai-content-generator"))),re.appendChild(ce),Ut.appendChild(re),Ut.appendChild(oe),H.forEach(_e=>{let $e=document.createElement("li");$e.className="aipkit_wp_content_list_item";let Ee=document.createElement("input");Ee.type="checkbox",Ee.name="wp_content_to_index[]",Ee.value=String(_e.id),Ee.checked=We.selectedIds.has(String(_e.id)),Ee.addEventListener("change",()=>{Ee.checked?We.selectedIds.add(String(_e.id)):We.selectedIds.delete(String(_e.id)),fe.checked=H.every(Qt=>We.selectedIds.has(String(Qt.id)))});let Fe=document.createElement("a");Fe.className="aipkit_wp_content_title",Fe.href=_e.edit_link||"#",Fe.target="_blank",Fe.rel="noopener noreferrer",Fe.textContent=_e.title||o("Untitled","gpt3-ai-content-generator");let Re=document.createElement("span");Re.className="aipkit_wp_content_type",Re.textContent=_e.type_label||"";let Ve=document.createElement("span");Ve.className="aipkit_wp_content_indexed_status",Ve.textContent=_e.is_already_indexed?o("Indexed","gpt3-ai-content-generator"):"",$e.appendChild(Ee),$e.appendChild(Fe),$e.appendChild(Re),$e.appendChild(Ve),oe.appendChild($e)}),fe.addEventListener("change",()=>{fe.checked?H.forEach(_e=>We.selectedIds.add(String(_e.id))):H.forEach(_e=>We.selectedIds.delete(String(_e.id))),Ut.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(_e=>{_e.checked=fe.checked})}),Oo(X,gt,Mn)},Mn=async H=>{if(!Ut)return;let X=nn(),oe=hn(),re=Qn(oe);if(!re.length){Ut.innerHTML="",gt&&(gt.innerHTML=""),Ai(o("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let ce=Be("aipkit_wp_content_fetch_nonce");if(!ce){Ai(o("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let fe=co(oe);try{Ai(o("Loading content...","gpt3-ai-content-generator"),"");let _e=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ce,post_types:re,post_status:fe,target_store_id:X?X.storeId:"",paged:H});We.page=H,lo(_e.posts||[],_e.pagination||{}),Ai("","")}catch(_e){Ai(_e&&_e.message?_e.message:o("Failed to load content.","gpt3-ai-content-generator"),"error")}},po=H=>{et&&(et.value=H),di&&(di.hidden=H!=="bulk"),Pe&&(Pe.hidden=H!=="specific"),qi&&(qi.hidden=H!=="specific"),je&&(je.hidden=H!=="bulk"),He&&(He.hidden=H!=="specific"),Ce&&(Ce.hidden=H!=="bulk"),H==="specific"&&Mn(1)},_o=()=>{q.querySelectorAll(".aipkit_training_site_dropdown").forEach(X=>{let oe=X.querySelector(".aipkit_training_site_dropdown_btn"),re=X.querySelector(".aipkit_training_site_dropdown_label"),ce=X.querySelector(".aipkit_training_site_dropdown_panel"),_e=X.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",$e=document.getElementById(_e);if(!oe||!ce||!$e)return;let Ee=()=>{let Re=ce.querySelectorAll('input[type="checkbox"]:checked'),Ve=X.dataset.placeholder||o("Select types","gpt3-ai-content-generator"),Qt=X.dataset.selectedLabel||o("selected","gpt3-ai-content-generator");re&&(Re.length?re.textContent=`${Re.length} ${Qt}`:re.textContent=Ve)},Fe=()=>{let Re=Array.from(ce.querySelectorAll('input[type="checkbox"]:checked')).map(Ve=>Ve.value);Array.from($e.options).forEach(Ve=>{Ve.selected=Re.includes(Ve.value)})};oe.addEventListener("click",()=>{let Re=oe.getAttribute("aria-expanded")==="true";oe.setAttribute("aria-expanded",Re?"false":"true"),ce.hidden=Re}),ce.addEventListener("change",()=>{Fe(),Ee(),hn()==="specific"&&Mn(1)}),document.addEventListener("click",Re=>{X.contains(Re.target)||(oe.setAttribute("aria-expanded","false"),ce.hidden=!0)}),Fe(),Ee()})},$o=async(H,X,oe)=>{let re=Be("aipkit_wp_content_fetch_nonce");if(!re)throw new Error("WP content fetch nonce missing.");let ce=[],fe=1,_e=1;do{let $e=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:re,post_types:H,post_status:X,target_store_id:oe||"",paged:fe});(Array.isArray($e?.posts)?$e.posts:[]).forEach(Re=>{ce.push({id:String(Re.id),title:Re.title||r(o("Post %s","gpt3-ai-content-generator"),Re.id)})});let Fe=parseInt($e?.pagination?.total_pages||1,10);_e=Number.isNaN(Fe)?1:Fe,fe+=1}while(fe<=_e);return ce},Fo=()=>Ut?Array.from(Ut.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(H=>{let X=H.closest(".aipkit_wp_content_list_item"),oe=X?X.querySelector(".aipkit_wp_content_title"):null;return{id:String(H.value||""),title:oe&&oe.textContent.trim()||r(o("Post %s","gpt3-ai-content-generator"),H.value)}}):[],Jn=(H,X,oe,re)=>{let ce=r(o("Post %s","gpt3-ai-content-generator"),H),fe=re&&re.get(String(H))||ce;return r(o("Training: %s (%d/%d)","gpt3-ai-content-generator"),fe,X+1,oe)},yn=async(H,X)=>{if(!window.aipkit_dashboard?.ajaxurl)throw new Error(o("AJAX configuration is missing.","gpt3-ai-content-generator"));H.set("action",X);let oe=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:H,credentials:"same-origin"}),re=await oe.json();if(!oe.ok||!re.success){let ce=re?.data?.message||o("Upload failed.","gpt3-ai-content-generator");throw new Error(ce)}return re.data},xo=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`text_${Date.now()}`,No=()=>{let H=ro();return H||(Rt(o("Select an embedding model.","gpt3-ai-content-generator"),"warning"),hi(),null)},Co=async(H,X)=>{if(!window.aipkit_dashboard?.nonce)throw new Error(o("Embedding nonce missing.","gpt3-ai-content-generator"));let oe=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:H,embedding_provider:X.provider,embedding_model:X.model,_ajax_nonce:window.aipkit_dashboard.nonce}),re=oe.embeddings&&oe.embeddings.length?oe.embeddings[0]:null;if(!re)throw new Error(o("Failed to generate embedding.","gpt3-ai-content-generator"));return re},Ao=async({content:H,indexName:X,embedding:oe,metadata:re})=>{let ce=Be("aipkit_vector_store_pinecone_nonce_management");if(!ce)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));let fe=await Co(H,oe);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:ce,vectors:JSON.stringify([{id:re.vector_id,values:fe,metadata:re}]),embedding_provider:oe.provider,embedding_model:oe.model,original_text_content:H,index_name:X})},Z=async({content:H,collectionName:X,embedding:oe,metadata:re,sourceContext:ce})=>{let fe=Be("aipkit_vector_store_qdrant_nonce_management");if(!fe)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));let _e=await Co(H,oe),$e={_ajax_nonce:fe,vectors:JSON.stringify([{id:re.vector_id,vector:_e,payload:re}]),embedding_provider:oe.provider,embedding_model:oe.model,original_text_content:H,collection_name:X,source_context:ce||"sources_module"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",$e)},ie=async()=>{if(wi)return;let H=nn();if(!H){Rt(o("Select a provider and index first.","gpt3-ai-content-generator"),"warning"),hi();return}let X=Mo(),oe="",re=[],ce=null,fe="text_entry_global_form",_e="file_upload_global_form";if(X==="text"){if(oe=W?W.value.trim():"",!oe){Rt(o("Add text to train.","gpt3-ai-content-generator"),"warning"),hi();return}}else if(X==="qa"){let Ee=Y?Y.value.trim():"",Fe=te?te.value.trim():"";if(!Ee||!Fe){Rt(o("Add a question and answer to train.","gpt3-ai-content-generator"),"warning"),hi();return}oe=`Q: ${Ee}
A: ${Fe}`}else if(X==="files"){if(re=ne?Array.from(ne.files||[]):[],!re.length){ne&&ne.click(),Rt(o("Choose files to upload.","gpt3-ai-content-generator"),"warning"),hi();return}}else if(X==="website"){let Ee=hn(),Fe=co(Ee),Re=Qn(Ee),Ve=Bo();if(Ee==="specific"&&!Ve.length){Rt(o("Select content to train.","gpt3-ai-content-generator"),"warning"),hi();return}if(Ee==="bulk"&&!Re.length){Rt(o("Select at least one post type.","gpt3-ai-content-generator"),"warning"),hi();return}ce={mode:Ee,statusValue:Fe,postTypes:Re,selectedPostIds:Ve}}else{Rt(o("Select a training tab to continue.","gpt3-ai-content-generator"),"warning"),hi();return}let $e=null;if(!((H.providerKey==="pinecone"||H.providerKey==="qdrant")&&($e=No(),!$e))){wi=!0,so(!0),ae.forEach(Ee=>{Ee.disabled=!0}),Rt(o("Preparing training...","gpt3-ai-content-generator"),"loading");try{if(X==="files"){kn();for(let Ee=0;Ee<re.length;Ee+=1){let Fe=re[Ee];Rt(r(o("Uploading %1$d of %2$d...","gpt3-ai-content-generator"),Ee+1,re.length),"loading"),Gt(Fe,o("Uploading","gpt3-ai-content-generator"),"loading");try{let Re=new FormData;if(H.providerKey==="openai"){let Ve=Be("aipkit_vector_store_nonce_openai");if(!Ve)throw new Error(o("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));Re.append("aipkit_vs_global_file_to_submit",Fe),Re.append("target_store_id",H.storeId),Re.append("source_type",_e),Re.append("_ajax_nonce",Ve);let Qt=await yn(Re,"aipkit_upload_and_add_file_to_store_direct_openai");Gt(Fe,o("Processing","gpt3-ai-content-generator"),"loading");let Et=Qt?.batch?.id;Ln(Fe,H.providerKey,H.storeId).then(Ze=>{if(!Ze){if(Et){Tn(H.storeId,Et,Fe);return}Gt(Fe,o("Queued","gpt3-ai-content-generator"),"warning")}})}else if(H.providerKey==="pinecone"){let Ve=Be("aipkit_vector_store_pinecone_nonce_management");if(!Ve)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));Re.append("file_to_upload",Fe),Re.append("index_name",H.storeId),Re.append("embedding_provider",$e.provider),Re.append("embedding_model",$e.model),Re.append("_ajax_nonce",Ve),await yn(Re,"aipkit_upload_file_and_upsert_to_pinecone"),Gt(Fe,o("Trained","gpt3-ai-content-generator"),"success")}else if(H.providerKey==="qdrant"){let Ve=Be("aipkit_vector_store_qdrant_nonce_management");if(!Ve)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));Re.append("file_to_upload",Fe),Re.append("target_store_id",H.storeId),Re.append("embedding_provider",$e.provider),Re.append("embedding_model",$e.model),Re.append("source_context","sources_module_file_upload"),Re.append("_ajax_nonce",Ve),await yn(Re,"aipkit_upload_file_and_upsert_to_qdrant"),Gt(Fe,o("Trained","gpt3-ai-content-generator"),"success")}}catch(Re){throw Gt(Fe,o("Failed","gpt3-ai-content-generator"),"error"),Re}}ne&&(ne.value=""),kn(),Rt(o("Saved","gpt3-ai-content-generator"),"success"),Ai(o("Saved","gpt3-ai-content-generator"),"success"),dn(),hi(),To(),Ei(1);return}if(X==="website"&&ce){let{mode:Ee,statusValue:Fe,postTypes:Re}=ce,Ve=[],Qt=new Map;if(Ee==="bulk"){Rt(o("Preparing website content...","gpt3-ai-content-generator"),"loading");let Et=await $o(Re,Fe,H.storeId);if(Ve=Et.map(Ze=>Ze.id),Qt=new Map(Et.map(Ze=>[String(Ze.id),Ze.title])),!Ve.length){Ai(o("No posts found for selection.","gpt3-ai-content-generator"),"error"),Rt(o("Nothing to train.","gpt3-ai-content-generator"),"warning"),hi();return}}if(Ee!=="bulk"){let Et=Fo();Ve=Et.map(Ze=>Ze.id),Qt=new Map(Et.map(Ze=>[String(Ze.id),Ze.title]))}if(Rt(o("Training...","gpt3-ai-content-generator"),"loading"),Ai(r(o("Training %d item(s)...","gpt3-ai-content-generator"),Ve.length),""),H.providerKey==="openai"){let Et=Be("aipkit_wp_content_index_nonce");if(!Et)throw new Error(o("WP content index nonce missing.","gpt3-ai-content-generator"));for(let Ze=0;Ze<Ve.length;Ze+=1){let Ie=Ve[Ze];Ai(Jn(Ie,Ze,Ve.length,Qt),""),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{_ajax_nonce:Et,post_ids:[Ie],target_store_id:H.storeId,provider:"openai"})}}else if(H.providerKey==="pinecone")for(let Et=0;Et<Ve.length;Et+=1){let Ze=Ve[Et];Ai(Jn(Ze,Et,Ve.length,Qt),"");let Ie=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Be("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[Ze]}),Ne=Ie.posts_content&&Ie.posts_content[Ze]?Ie.posts_content[Ze]:null;if(!Ne||!Ne.content)continue;let ct=rn(),ye={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Ze,title:Ne.title||"",url:Ne.edit_link||"",vector_id:ct};ye.vector_id=ct,await Ao({content:Ne.content,indexName:H.storeId,embedding:$e,metadata:ye})}else if(H.providerKey==="qdrant")for(let Et=0;Et<Ve.length;Et+=1){let Ze=Ve[Et];Ai(Jn(Ze,Et,Ve.length,Qt),"");let Ie=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Be("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[Ze]}),Ne=Ie.posts_content&&Ie.posts_content[Ze]?Ie.posts_content[Ze]:null;if(!Ne||!Ne.content)continue;let ct=xo(),ye={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Ze,title:Ne.title||"",url:Ne.edit_link||"",vector_id:ct};await Z({content:Ne.content,collectionName:H.storeId,embedding:$e,metadata:ye,sourceContext:"sources_module_website"})}Rt(o("Saved","gpt3-ai-content-generator"),"success"),hi(),Ei(1);return}if(H.providerKey==="openai"){let Ee=Be("aipkit_vector_store_nonce_openai");if(!Ee)throw new Error(o("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:Ee,target_store_id:H.storeId,text_content:oe,source_type:fe})}else if(H.providerKey==="pinecone"){let Ee=rn(),Fe={source:fe,created_at:new Date().toISOString(),original_content:oe,vector_id:Ee};await Ao({content:oe,indexName:H.storeId,embedding:$e,metadata:Fe})}else if(H.providerKey==="qdrant"){let Ee=rn(),Fe={source:fe,created_at:new Date().toISOString(),original_content:oe,vector_id:Ee};await Z({content:oe,collectionName:H.storeId,embedding:$e,metadata:Fe,sourceContext:"sources_module_training"})}X==="text"&&W&&(W.value=""),X==="qa"&&(Y&&(Y.value=""),te&&(te.value="")),Rt(o("Saved","gpt3-ai-content-generator"),"success"),hi(),Ei(1)}catch(Ee){Rt(r(o("Error: %s","gpt3-ai-content-generator"),Ee?.message||o("Training failed.","gpt3-ai-content-generator")),"error")}finally{wi=!1,so(!1),Pn(),kn()}}};if(Q.addEventListener("click",()=>{let H=q.hidden;q.hidden=!H,Q.setAttribute("aria-expanded",H?"true":"false"),H&&(Pn(),So(),mi(K?K.value:""))}),F){let H=F.querySelector(".aipkit_builder_tab.is-active");H&&Eo(H.dataset.aipkitTab),F.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(X=>{X.addEventListener("click",()=>{Eo(X.dataset.aipkitTab)})})}return G&&ne&&G.addEventListener("click",()=>{pn()&&ne.click()}),ne&&ne.addEventListener("change",()=>{if(!pn()){ne.value="";return}let H=Array.from(ne.files||[]);H.length&&(H.forEach(X=>{ao(X),Gt(X,o("Queued","gpt3-ai-content-generator"))}),kn(),ie())}),ae.forEach(H=>{H.addEventListener("click",ie)}),he&&he.addEventListener("click",()=>{wi&&(he.disabled=!0,Rt(o("Stopping...","gpt3-ai-content-generator"),"warning"))}),Xe&&Xe.addEventListener("change",()=>{let H=m(K?K.value:"");H&&(Ae.embeddingByProvider[H]=Xe.value||"",p({provider:Ae.provider,status:Ae.status,type:Ae.type,indexByProvider:Ae.indexByProvider,embeddingByProvider:Ae.embeddingByProvider}))}),_i.length&&_i.forEach(H=>{H.addEventListener("change",()=>{H.checked&&po(H.value)})}),Pt&&Pt.addEventListener("change",()=>{hn()==="specific"&&Mn(1)}),ri&&ri.addEventListener("change",()=>{hn()==="specific"&&Mn(1)}),_o(),Pn(),So(),mi(K?K.value:""),po(hn()),{updateTargetState:Pn}})();K&&K.addEventListener("change",()=>{Ae.provider=K.value,Dn(Ae.provider),qn?.updateTargetState?.(),p({provider:Ae.provider,status:Ae.status,type:Ae.type,indexByProvider:Ae.indexByProvider,embeddingByProvider:Ae.embeddingByProvider}),Ei(1)}),yt&&yt.addEventListener("click",()=>{m(K?K.value:"")&&(Ae.openIndexCreateOnOpen=!0,uo(yt))}),ee&&ee.addEventListener("change",()=>{Ae.status=ee.value,p({provider:Ae.provider,status:Ae.status,type:Ae.type,indexByProvider:Ae.indexByProvider,embeddingByProvider:Ae.embeddingByProvider}),Ei(1)}),J&&J.addEventListener("change",()=>{Ae.type=J.value,p({provider:Ae.provider,status:Ae.status,type:Ae.type,indexByProvider:Ae.indexByProvider,embeddingByProvider:Ae.embeddingByProvider}),Ei(1)});let zn=()=>{if(!le)return;let Q=le.value.trim();Q!==Ae.search&&(Ae.search=Q,Ei(1))},bo=()=>{le&&(Wt&&window.clearTimeout(Wt),Wt=window.setTimeout(()=>{zn()},300))};if(le&&(le.addEventListener("input",bo),le.addEventListener("search",zn),le.addEventListener("keydown",Q=>{Q.key==="Enter"&&(Q.preventDefault(),Wt&&window.clearTimeout(Wt),zn())})),V&&V.addEventListener("change",()=>{let Q=m(K?K.value:"");Q&&(Ae.indexByProvider[Q]=V.value||"",p({provider:Ae.provider,status:Ae.status,type:Ae.type,indexByProvider:Ae.indexByProvider,embeddingByProvider:Ae.embeddingByProvider}),Qi(),qn?.updateTargetState?.(),Ei(1))}),ue&&ue.dataset.configListenersAttached!=="true"){let Q=q=>{q.target.closest("[data-aipkit-provider-config]")&&an()};ue.addEventListener("input",Q),ue.addEventListener("change",Q),ue.dataset.configListenersAttached="true"}yi&&yi.addEventListener("click",vn),Zt&&Zt.addEventListener("click",vn),ot&&!ot.dataset.bound&&(document.addEventListener("keydown",Q=>{Q.key==="Escape"&&ot.classList.contains("aipkit-active")&&vn()}),ot.dataset.bound="1"),Hi&&Hi.addEventListener("click",Ci),ji&&ji.addEventListener("click",Ci),pe&&pe.addEventListener("click",gi),xe&&xe.addEventListener("click",gi),ke&&ke.addEventListener("click",async()=>{if(!ii)return;let Q=ii.dataset.provider||"",q=ii.dataset.storeId||"",F=ii.dataset.vectorId||"",T=ii.dataset.logId||"";if(!Q||!q||!F||!T){P(L,o("Missing source details.","gpt3-ai-content-generator"),"error"),Ni(),gi();return}gi();let W=null,Y=[];if(R){let te=en(T);if(W=R.querySelector(`tr[data-log-id="${te}"]`),W){Y=Array.from(W.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")),Y.forEach(G=>{G.disabled=!0,G.setAttribute("aria-disabled","true")});let ne=W.querySelector(".aipkit_sources_action_delete");ne&&(ne.textContent=o("Deleting...","gpt3-ai-content-generator"))}}ke&&(ke.disabled=!0),P(L,o("Deleting...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:Q,store_id:q,vector_id:F,log_id:T}),P(L,o("Deleted","gpt3-ai-content-generator"),"success"),Ni(),Ei(Ae.page||1)}catch(te){let ne=te&&te.message?te.message:o("Failed to delete source.","gpt3-ai-content-generator");P(L,`${o("Error:","gpt3-ai-content-generator")} ${ne}`,"error"),Ni(),Y.forEach(O=>{O.disabled=!1,O.removeAttribute("aria-disabled")});let G=W?W.querySelector(".aipkit_sources_action_delete"):null;G&&(G.textContent=o("Delete","gpt3-ai-content-generator"))}finally{ke&&(ke.disabled=!1)}}),Nt&&Nt.addEventListener("click",async()=>{if(!ot||!Li)return;let Q=Li.value.trim();if(!Q){P(L,o("Text cannot be empty.","gpt3-ai-content-generator"),"error"),Ni();return}let q=ot.dataset.provider||"",F=ot.dataset.storeId||"",T=ot.dataset.vectorId||"",W=ot.dataset.logId||"",Y=ot.dataset.embeddingProvider||"",te=ot.dataset.embeddingModel||"";if(!q||!F||!T||!W){P(L,o("Missing source details.","gpt3-ai-content-generator"),"error"),Ni();return}vn();let ne=[];if(R&&W){let G=en(W),O=R.querySelector(`tr[data-log-id="${G}"]`);ne=O?Array.from(O.querySelectorAll(".aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[],ne.forEach(z=>{z.disabled=!0,z.setAttribute("aria-disabled","true"),z.classList.contains("aipkit_sources_action_edit")&&(z.textContent=o("Training...","gpt3-ai-content-generator"))})}P(L,o("Training...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:q,store_id:F,vector_id:T,log_id:W}),await Wn(q,F,Q,Y,te),P(L,o("Trained","gpt3-ai-content-generator"),"success"),Ni(),Ei(Ae.page||1)}catch(G){let O=G&&G.message?G.message:o("Failed to save source.","gpt3-ai-content-generator");P(L,`${o("Error:","gpt3-ai-content-generator")} ${O}`,"error"),Ni(),ne.forEach(z=>{z.disabled=!1,z.removeAttribute("aria-disabled"),z.classList.contains("aipkit_sources_action_edit")&&(z.textContent=o("Edit","gpt3-ai-content-generator"))})}}),N.addEventListener("click",async Q=>{let q=Q.target.closest(".aipkit_sources_provider_create");if(q){let ne=q.dataset.provider||"";ne&&Rn(ne,q);return}let F=Q.target.closest(".aipkit_sources_provider_delete_selected");if(F){let ne=m(K?K.value:F.dataset.provider||""),G=V?V.value:"";if(!ne||!G){let ae=w(ne);Oi(r(o("Select a %s to delete.","gpt3-ai-content-generator"),ae.singular.toLowerCase()),"error"),zi();return}let O=V&&V.selectedOptions?V.selectedOptions[0]:null,z=O?O.textContent:G;On(ne,G,z,F);return}let T=Q.target.closest(".aipkit_sources_action_edit");if(T){Ii(T);return}let W=Q.target.closest(".aipkit_sources_action_view");if(W){let ne=W.dataset.snippet||"";if(!ne){P(L,o("No preview available for this source.","gpt3-ai-content-generator"),"error"),Ni();return}Oe(ne);return}let Y=Q.target.closest(".aipkit_sources_action_delete");if(Y){let ne=Y.dataset.provider||"",G=Y.dataset.storeId||"",O=Y.dataset.vectorId||"",z=Y.dataset.logId||"";if(!ne||!G||!O||!z){P(L,o("Missing source details.","gpt3-ai-content-generator"),"error"),Ni();return}li({provider:ne,storeId:G,vectorId:O,logId:z});return}let te=Q.target.closest(".aipkit_sources_action_retrain");if(te){let ne=te.dataset.provider||"",G=te.dataset.storeId||"",O=te.dataset.vectorId||"",z=te.dataset.logId||"",ae=te.dataset.postId||"",ge=te.dataset.embeddingProvider||"",he=te.dataset.embeddingModel||"";if(!ne||!G||!O||!z||!ae){P(L,o("Missing source details.","gpt3-ai-content-generator"),"error"),Ni();return}let Ke=te.closest("tr"),lt=Ke?Array.from(Ke.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[];lt.forEach(mt=>{mt.disabled=!0,mt.setAttribute("aria-disabled","true")}),te.textContent=o("Training...","gpt3-ai-content-generator"),P(L,o("Retraining...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:ne,store_id:G,vector_id:O,log_id:z,post_id:ae,embedding_provider:ge,embedding_model:he}),P(L,o("Retrained","gpt3-ai-content-generator"),"success"),Ni(),Ei(Ae.page||1)}catch(mt){let Xe=mt&&mt.message?mt.message:o("Failed to retrain source.","gpt3-ai-content-generator");P(L,`${o("Error:","gpt3-ai-content-generator")} ${Xe}`,"error"),Ni(),lt.forEach(et=>{et.disabled=!1,et.removeAttribute("aria-disabled")}),te.textContent=o("Retrain","gpt3-ai-content-generator")}}}),be&&be.addEventListener("click",()=>{Cn()}),Ue&&Ue.addEventListener("click",Q=>{Q.preventDefault(),Cn(),to(),gn()}),me&&me.addEventListener("click",Q=>{Q.preventDefault(),to(),Gn()}),pt&&pt.addEventListener("click",Q=>{Q.preventDefault(),io()}),we&&we.addEventListener("click",Q=>{Q.target===we&&io()}),ve&&ve.addEventListener("click",Q=>{Q.preventDefault(),Kn()}),de&&de.addEventListener("click",Q=>{Q.target===de&&Kn()}),document.addEventListener("keydown",Q=>{Q.key==="Escape"&&we&&we.classList.contains("aipkit-active")&&io(),Q.key==="Escape"&&de&&de.classList.contains("aipkit-active")&&Kn()}),qe&&qe.addEventListener("change",()=>{let Q=qe.value;Un(Q),tn(Q),Se&&(Se.value=""),Xi()}),Se&&Se.addEventListener("change",Xi),nt&&nt.addEventListener("change",()=>{An(),Xi()}),ai&&(ai.addEventListener("input",Xi),ai.addEventListener("change",Xi)),ti&&(ti.addEventListener("input",Xi),ti.addEventListener("change",Xi)),Ft&&Ft.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode("[aipkit_semantic_search]",Ft)}),ht&&ht.addEventListener("submit",Q=>{if(Q.preventDefault(),!Le)return;let q=Le.value.trim();q&&Ki(q)}),bt&&wt&&(wt.innerHTML=""),Dn(K?K.value:""),typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(N),typeof window.aipkitSources_initSettingsPopoverPanels=="function"&&window.aipkitSources_initSettingsPopoverPanels(N),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_sources_module_container"),Ei(1)}window.aipkit_initSources=D})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector("#aipkit_stats_settings_popover");if(!r)return;let n=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!n.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),i=r.querySelector(".aipkit_model_settings_popover_back"),c=o.querySelector("#aipkit_stats_settings_trigger"),s={root:r.dataset.titleRoot||"Log Settings","log-retention":r.dataset.titleLogRetention||"Log retention"},t=null,d=a=>{let l=a||"root",p=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let _=p.dataset.aipkitSettingsPanel||"root";_!==t&&(n.forEach(u=>{u.hidden=u!==p}),e&&(e.textContent=s[_]||s.root),i&&(i.hidden=_==="root"),t=_,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",a=>{let l=a.target.closest("[data-aipkit-panel-target]");if(!l)return;a.preventDefault();let p=l.dataset.aipkitPanelTarget;d(p)}),i&&i.addEventListener("click",a=>{a.preventDefault(),d("root")}),c&&c.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitStats_initSettingsPopoverPanels=g})();(function(){"use strict";let r="aipkit_stats_overview_open",n=d=>typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml(d):(d==null?"":String(d)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),e=d=>{let a=Number(d||0);return Number.isNaN(a)?"0":a.toLocaleString()},i=d=>{let a=Number(d);if(!a)return"";let l=new Date(a*1e3);return Number.isNaN(l.getTime())?"":l.toLocaleString()},c=d=>{let a=Number(d);if(!a)return"";let l=Date.now()/1e3,p=Math.floor(l-a);if(Number.isNaN(p)||p<0)return i(a);if(p<60)return"Just now";let _=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],u=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let m of _)if(p>=m.seconds){let k=Math.floor(p/m.seconds);return u?u.format(-k,m.unit):`${k} ${m.unit}${k!==1?"s":""} ago`}return i(a)},s=d=>{if(typeof d=="string")return d;if(d==null)return"";try{return JSON.stringify(d,null,2)}catch{return String(d)}};function t(){let d=document.getElementById("aipkit_stats_container");if(!d)return;typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(d),typeof window.aipkitStats_initSettingsPopoverPanels=="function"&&window.aipkitStats_initSettingsPopoverPanels(d);let a={days:parseInt(d.dataset.defaultDays||30,10)||30,perPage:20,page:1,search:"",botId:"",module:"",selectedLogId:null},l=wp.i18n&&wp.i18n.__?wp.i18n.__:se=>se,p={page:1,search:"",botTitles:{}},_=null,u=null,m=null,k=!1,f={status:d.querySelector("#aipkit_stats_status"),overviewPanel:d.querySelector("#aipkit_stats_overview_panel"),overviewToggle:d.querySelector("#aipkit_stats_overview_toggle"),overviewPeriod:d.querySelector("#aipkit_stats_period_label"),totalConversations:d.querySelector("#aipkit_stats_total_conversations"),totalMessages:d.querySelector("#aipkit_stats_total_messages"),uniqueUsers:d.querySelector("#aipkit_stats_unique_users"),avgTokens:d.querySelector("#aipkit_stats_avg_tokens"),daysFilter:d.querySelector("#aipkit_stats_days_filter"),botFilter:d.querySelector("#aipkit_stats_bot_filter"),moduleFilter:d.querySelector("#aipkit_stats_module_filter"),searchInput:d.querySelector("#aipkit_stats_search_input"),exportBtn:d.querySelector("#aipkit_stats_export_btn"),deleteAllBtn:d.querySelector("#aipkit_stats_delete_all_btn"),tableMenu:d.querySelector("#aipkit_stats_table_menu"),tableMenuTrigger:d.querySelector("#aipkit_stats_table_menu_trigger"),tableBody:d.querySelector("#aipkit_stats_table_body"),pagination:d.querySelector("#aipkit_stats_pagination"),detailPanel:d.querySelector("#aipkit_stats_detail_panel"),conversationChart:d.querySelector("#aipkit_stats_conversation_chart"),moduleChart:d.querySelector("#aipkit_stats_module_chart"),settingsToggle:document.getElementById("aipkit_stats_auto_delete_toggle"),retentionSelect:document.getElementById("aipkit_stats_retention_days"),retentionRow:d.querySelector("[data-aipkit-stats-retention-row]"),cronRow:d.querySelector("[data-aipkit-stats-cron-row]"),cronStatus:document.getElementById("aipkit_stats_cron_status"),cronText:document.getElementById("aipkit_stats_cron_text"),cronLastRun:document.getElementById("aipkit_stats_cron_last_run"),settingsPopover:document.getElementById("aipkit_stats_settings_popover"),settingsTrigger:document.getElementById("aipkit_stats_settings_trigger"),settingsUsersNav:d.querySelector('[data-aipkit-settings-action="users"]'),userSheet:document.getElementById("aipkit_stats_user_sheet"),userSheetClose:document.getElementById("aipkit_stats_user_sheet_close"),userSearchInput:document.getElementById("aipkit_stats_user_search"),userTableBody:document.getElementById("aipkit_stats_user_table_body"),userTableFoot:document.querySelector("#aipkit_stats_user_sheet tfoot"),userPagination:document.getElementById("aipkit_stats_user_pagination"),userNoResults:document.getElementById("aipkit_stats_user_no_results"),shortcodeSnippet:document.getElementById("aipkit_stats_shortcode_snippet"),shortcodeToggle:document.getElementById("aipkit_stats_shortcode_toggle"),shortcodeConfig:document.getElementById("aipkit_stats_shortcode_config"),shortcodeOptions:d.querySelectorAll(".aipkit_stats_shortcode_option")},w=(()=>{try{let se=d.dataset.moduleLabels||"{}";return JSON.parse(se)}catch{return{}}})(),E=d.dataset.isPro==="1",y=d.dataset.userCreditsNonce||"",I=(se,me="")=>{if(!f.status)return;let de=f.status,ve=de.classList.contains("aipkit_training_status");if(de.textContent=se||"",de.classList.remove("aipkit_status_error","aipkit_status_success","aipkit_status_warning","aipkit_status_loading"),ve){de.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),se&&de.classList.add("is-visible"),me&&de.classList.add(`is-${me}`);return}de.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),me==="success"?de.classList.add("aipkit_form-help-success"):me==="error"&&de.classList.add("aipkit_form-help-error")},S=()=>{try{return localStorage.getItem(r)==="1"}catch{return!1}},h=se=>{f.retentionRow&&(f.retentionRow.hidden=!se),f.cronRow&&(f.cronRow.hidden=!se),f.retentionSelect&&(f.retentionSelect.disabled=!se||!E)},M=se=>{!se||!f.cronStatus||(se.state&&f.cronStatus.setAttribute("data-state",se.state),f.cronText&&se.status_text&&(f.cronText.textContent=se.status_text),f.cronLastRun&&se.last_run_label&&(f.cronLastRun.textContent=se.last_run_label))},b=se=>{f.tableBody&&(f.tableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${n(se)}</td>
                </tr>
            `)},A=se=>{f.userTableBody&&(f.userTableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${n(se)}</td>
                </tr>
            `,f.userNoResults&&(f.userNoResults.hidden=!0))},x=se=>{if(!se)return l("N/A","gpt3-ai-content-generator");let me=new Date(se*1e3);return Number.isNaN(me.getTime())?l("N/A","gpt3-ai-content-generator"):me.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},v=(se,me)=>{let de=Array.isArray(se)?se:[],ve='<ul class="aipkit_stats_usage_list">';return de.length?(de.forEach((qe,Se)=>{let Je=Se>=2;ve+=`<li class="${Je?"aipkit_stats_usage_extra":""}"${Je?" hidden":""}>${qe}</li>`}),ve+="</ul>",{html:ve,hasToggle:de.length>2}):(ve+=`<li>${n(me)}</li>`,ve+="</ul>",{html:ve,hasToggle:!1})},C=(se,me)=>{if(!f.userTableBody)return;if(f.userTableBody.innerHTML="",!Array.isArray(se)||se.length===0){f.userNoResults&&(f.userNoResults.hidden=!1);return}f.userNoResults&&(f.userNoResults.hidden=!0);let de=me||{};se.forEach(ve=>{let qe=document.createElement("tr");qe.dataset.userId=ve.id;let Se=document.createElement("td");Se.textContent=`${ve.display_name} (${ve.email})`,qe.appendChild(Se);let Je=document.createElement("td"),nt=document.createElement("input");nt.type="number",nt.className="aipkit_form-input aipkit_stats_credits_balance_input",nt.value=ve.token_balance||0,nt.dataset.userId=ve.id,nt.dataset.originalValue=ve.token_balance||0,nt.setAttribute("min","0"),nt.setAttribute("step","1"),nt.title=l("Press Enter or blur to save changes","gpt3-ai-content-generator"),Je.appendChild(nt);let Vt=document.createElement("span");Vt.className="aipkit_stats_credits_balance_status",Je.appendChild(Vt),qe.appendChild(Je);let ai=document.createElement("td");ai.textContent=e(ve.total_used_all_bots||0),qe.appendChild(ai);let ti=document.createElement("td"),Ft=[],ht=ve.tokens_used||{},Le=ve.image_usage||{used:0};Le.used>0&&Ft.push(`<strong>${n(l("Image Generator","gpt3-ai-content-generator"))}:</strong> ${e(Le.used)}`),Object.keys(ht||{}).sort((Nt,Jt)=>Number(Nt)-Number(Jt)).forEach(Nt=>{let Jt=ht[Nt]||0;if(Jt<=0)return;let Pi=de[Nt]||`Bot #${Nt}`;Ft.push(`<strong>${n(Pi)}:</strong> ${e(Jt)}`)});let Te=v(Ft,"-");ti.innerHTML=Te.html+(Te.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${n(l("Show more","gpt3-ai-content-generator"))}...</button>`:""),qe.appendChild(ti);let xt=document.createElement("td"),Kt=[],yt=ve.last_reset||{};Le.used>0&&Kt.push(`<strong>${n(l("Image Generator","gpt3-ai-content-generator"))}:</strong> ${n(x(Le.last_reset))}`);let ot=new Set([...Object.keys(ht||{}),...Object.keys(yt||{})]);Array.from(ot).sort((Nt,Jt)=>Number(Nt)-Number(Jt)).forEach(Nt=>{if((ht||{})[Nt]<=0)return;let Jt=de[Nt]||`Bot #${Nt}`;Kt.push(`<strong>${n(Jt)}:</strong> ${n(x(yt[Nt]||0))}`)});let Li=Ft.length>0?l("N/A","gpt3-ai-content-generator"):"-",yi=v(Kt,Li);xt.innerHTML=yi.html+(yi.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${n(l("Show more","gpt3-ai-content-generator"))}...</button>`:""),qe.appendChild(xt);let Zt=document.createElement("td");if(Zt.className="aipkit_stats_user_actions_cell",ve.purchase_history&&ve.purchase_history.length){let Nt=document.createElement("button");Nt.type="button",Nt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_stats_purchase_history_btn",Nt.title=l("View purchase history","gpt3-ai-content-generator"),Nt.innerHTML='<span class="dashicons dashicons-cart" aria-hidden="true"></span>',Nt.dataset.userName=ve.display_name,Nt.dataset.history=JSON.stringify(ve.purchase_history),Zt.appendChild(Nt)}else Zt.textContent="-";qe.appendChild(Zt),f.userTableBody.appendChild(qe)})},P=se=>{if(!f.userPagination||!f.userTableFoot)return;f.userPagination.innerHTML="";let me=Number(se?.total_users||0),de=Number(se?.total_pages||0),ve=Number(se?.current_page||1);if(!me){f.userTableFoot.hidden=!0;return}let qe=document.createElement("span");if(qe.className="aipkit_pagination-count",qe.textContent=`${me.toLocaleString()} ${l("users","gpt3-ai-content-generator")}`,f.userPagination.appendChild(qe),de<=1){f.userTableFoot.hidden=!0;return}let Se=document.createElement("span");Se.className="aipkit_pagination-links";let Je=document.createElement("button");Je.type="button",Je.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Je.textContent=`\xAB ${l("Previous","gpt3-ai-content-generator")}`,Je.disabled=ve<=1,Je.addEventListener("click",()=>$(ve-1,p.search));let nt=document.createElement("span");nt.className="aipkit_pagination-current",nt.textContent=`${l("Page","gpt3-ai-content-generator")} ${ve} ${l("of","gpt3-ai-content-generator")} ${de}`;let Vt=document.createElement("button");Vt.type="button",Vt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Vt.textContent=`${l("Next","gpt3-ai-content-generator")} \xBB`,Vt.disabled=ve>=de,Vt.addEventListener("click",()=>$(ve+1,p.search)),Se.appendChild(Je),Se.appendChild(nt),Se.appendChild(Vt),f.userPagination.appendChild(Se),f.userTableFoot.hidden=!1},$=async(se=1,me="")=>{if(!(!f.userTableBody||typeof window.aipkit_apiRequest!="function")){A(l("Loading user credits...","gpt3-ai-content-generator")),p.page=se,p.search=me;try{let de=await window.aipkit_apiRequest("aipkit_get_user_credits_data",{page:se,search:me});p.botTitles=de.bot_titles||{},C(de.users_data||[],p.botTitles),P(de.pagination||{})}catch(de){f.userTableBody&&(f.userTableBody.innerHTML=`
                        <tr>
                            <td colspan="6" class="aipkit_stats_table_placeholder aipkit_text-danger">${n(de.message||l("Error loading user credits.","gpt3-ai-content-generator"))}</td>
                        </tr>
                    `),f.userNoResults&&(f.userNoResults.hidden=!0),f.userTableFoot&&(f.userTableFoot.hidden=!0)}}},U=()=>{f.settingsPopover&&(f.settingsPopover.classList.remove("aipkit-active"),f.settingsPopover.setAttribute("aria-hidden","true"),f.settingsTrigger&&f.settingsTrigger.setAttribute("aria-expanded","false"))},B=()=>{f.userSheet&&(f.userSheet.classList.add("aipkit-active"),f.userSheet.setAttribute("aria-hidden","false"),$(p.page,p.search),f.userSearchInput&&f.userSearchInput.focus())},D=()=>{f.userSheet&&(f.userSheet.classList.remove("aipkit-active"),f.userSheet.setAttribute("aria-hidden","true"))},N=()=>{if(!f.shortcodeSnippet||!f.shortcodeOptions)return;let se=!0,me=!0,de=!0;f.shortcodeOptions.forEach(Se=>{Se.name==="cfg_show_chatbot"&&(se=Se.checked),Se.name==="cfg_show_aiforms"&&(me=Se.checked),Se.name==="cfg_show_imagegenerator"&&(de=Se.checked)});let ve=[];se||ve.push('chatbot="false"'),me||ve.push('aiforms="false"'),de||ve.push('imagegenerator="false"');let qe="[aipkit_token_usage";ve.length&&(qe+=` ${ve.join(" ")}`),qe+="]",f.shortcodeSnippet.textContent=qe},R=(se,me)=>{let de=Array.isArray(se)?se:[],ve=document.createElement("div");ve.className="aipkit-modal-overlay aipkit-active";let qe=()=>de.length?de.map(Je=>{let nt=Je?.date?.date?new Date(Je.date.date):null,Vt=nt&&!Number.isNaN(nt.getTime())?nt.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"",ai=(Je.products||[]).map(ti=>`
                                <div class="aipkit_stats_purchase_product">
                                    <span class="aipkit_stats_purchase_product_name">${n(ti.name)}</span>
                                    <span class="aipkit_stats_purchase_product_meta">
                                        ${ti.quantity>1?`${Number(ti.quantity)}x `:""}
                                        ${e(ti.tokens_per_item)} ${n(l("tokens","gpt3-ai-content-generator"))}
                                    </span>
                                </div>
                            `).join("");return`
                            <div class="aipkit_stats_purchase_item">
                                <div class="aipkit_stats_purchase_header">
                                    <div class="aipkit_stats_purchase_date">${n(Vt)}</div>
                                    <div class="aipkit_stats_purchase_summary">
                                        <span class="aipkit_stats_purchase_tokens">+${e(Je.tokens_granted)}</span>
                                        <span class="aipkit_stats_purchase_amount">${n(Je.total_amount)} ${n(Je.currency)}</span>
                                    </div>
                                </div>
                                <div class="aipkit_stats_purchase_order">${n(l("Order #","gpt3-ai-content-generator"))}${n(Je.order_id)}</div>
                                ${ai?`<div class="aipkit_stats_purchase_products">${ai}</div>`:""}
                            </div>
                        `}).join(""):`<p>${n(l("No purchase history found for this user.","gpt3-ai-content-generator"))}</p>`;ve.innerHTML=`
                <div class="aipkit-modal-content aipkit_stats_purchase_modal">
                    <div class="aipkit-modal-header">
                        <h3 class="aipkit-modal-title">${n(l("Purchase History for","gpt3-ai-content-generator"))} ${n(me||"")}</h3>
                        <button class="aipkit-modal-close-btn" type="button" aria-label="${n(l("Close","gpt3-ai-content-generator"))}">&times;</button>
                    </div>
                    <div class="aipkit-modal-body">
                        <div class="aipkit_stats_purchase_history_list">${qe()}</div>
                    </div>
                </div>
            `;let Se=()=>{ve.classList.remove("aipkit-active"),window.setTimeout(()=>{ve.parentNode&&ve.parentNode.removeChild(ve)},200)};ve.addEventListener("click",Je=>{Je.target===ve&&Se()}),ve.querySelector(".aipkit-modal-close-btn")?.addEventListener("click",Se),document.body.appendChild(ve)},j=se=>{if(!se)return;let me=se.dataset.userId,de=se.parentElement?se.parentElement.querySelector(".aipkit_stats_credits_balance_status"):null,ve=se.dataset.originalValue||se.defaultValue,qe=se.value;if(String(qe)!==String(ve)){if(!y){de&&(de.textContent="ERR");return}de&&(de.innerHTML='<span class="aipkit_spinner"></span>'),clearTimeout(m),m=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",{_ajax_nonce:y,user_id:me,balance:qe}).then(Se=>{de&&(de.textContent="OK"),se.dataset.originalValue=Se.new_balance,window.setTimeout(()=>{de&&(de.textContent="")},1500)}).catch(()=>{de&&(de.textContent="ERR"),se.value=ve,window.setTimeout(()=>{de&&(de.textContent="")},2500)})},400)}},L=se=>{if(!f.conversationChart)return;f.conversationChart.innerHTML="";let me=Object.entries(se||{});if(!me.length){f.conversationChart.innerHTML=`<div class="aipkit_stats_table_placeholder">${n("No data available.")}</div>`;return}let de=Math.max(...me.map(([,Ft])=>Number(Ft)||0),1),ve=document.createElement("div");ve.className="aipkit_stats_chart_wrapper";let qe=document.createElement("div");qe.className="aipkit_stats_y_axis";let Se=4;for(let Ft=Se;Ft>=0;Ft--){let ht=document.createElement("span");ht.className="aipkit_stats_y_label";let Le=Math.round(de/Se*Ft);ht.textContent=Le>=1e3?`${(Le/1e3).toFixed(1)}k`:Le,qe.appendChild(ht)}ve.appendChild(qe);let Je=document.createElement("div");Je.className="aipkit_stats_bars_container";for(let Ft=0;Ft<Se;Ft++){let ht=document.createElement("div");ht.className="aipkit_stats_grid_line",ht.style.bottom=`${(Ft+1)/Se*100}%`,Je.appendChild(ht)}let nt=document.createElement("div");nt.className="aipkit_stats_bars_wrapper",me.forEach(([Ft,ht])=>{let Le=document.createElement("div");Le.className="aipkit_stats_bar_group";let Te=document.createElement("div"),xt=Math.max(2,Math.round(Number(ht)/de*100));Te.className="aipkit_stats_bar",Te.style.height=`${xt}%`,Te.title=`${Ft}: ${ht}`,Le.appendChild(Te),nt.appendChild(Le)}),Je.appendChild(nt),ve.appendChild(Je);let Vt=document.createElement("div");Vt.className="aipkit_stats_x_axis";let ai=Math.min(me.length,7),ti=Math.max(1,Math.floor(me.length/ai));me.forEach(([Ft],ht)=>{let Le=document.createElement("span");if(Le.className="aipkit_stats_x_label",ht%ti===0||ht===me.length-1){let Te=Ft.split("-");Le.textContent=Te.length>=3?`${Te[1]}/${Te[2]}`:Ft}Vt.appendChild(Le)}),ve.appendChild(Vt),f.conversationChart.appendChild(ve)},K=se=>{if(f.moduleChart){if(typeof window.aipkit_renderTokenUsageChart!="function"){f.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${n("Chart renderer unavailable.")}</p>`;return}if(!se||Object.keys(se).length===0){f.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${n("No data available.")}</p>`;return}window.aipkit_renderTokenUsageChart(f.moduleChart,se)}},V=se=>se?w[se]?w[se]:se.replace(/[_-]/g," ").replace(/\b\w/g,me=>me.toUpperCase()):w.chatbot||"Chatbot",ee=se=>{if(!f.tableBody)return;if(!Array.isArray(se)||!se.length){b("No logs found.");return}let me=se.map(de=>{let ve=de.last_message_content?String(de.last_message_content):"",qe=c(de.last_message_ts),Se=i(de.last_message_ts),Je=e(de.total_conversation_tokens||0),nt=Number(de.id);return`
                    <tr class="aipkit_stats_row${a.selectedLogId===nt?" aipkit_stats_row_active":""}" data-log-id="${n(de.id)}">
                        <td title="${n(Se)}">${n(qe)}</td>
                        <td>${n(de.user_display_name||"\u2014")}</td>
                        <td>${n(de.bot_name||V(de.module))}</td>
                        <td>${n(e(de.message_count||0))}</td>
                        <td>${n(Je)}</td>
                        <td><span class="aipkit_stats_preview">${n(ve)}</span></td>
                    </tr>
                `});f.tableBody.innerHTML=me.join("")},J=()=>({days:a.days,bot_id:a.botId,module:a.module,search:a.search}),le=(se,me)=>{let de=new Blob([se],{type:"text/csv;charset=utf-8;"}),ve=URL.createObjectURL(de),qe=document.createElement("a");qe.href=ve,qe.download=me||"aipkit-logs.csv",document.body.appendChild(qe),qe.click(),qe.remove(),URL.revokeObjectURL(ve)},ue=async se=>{if(!(!se||!window.confirm("Delete this conversation?"))){I("Deleting conversation...");try{let de=await window.aipkit_apiRequest("aipkit_stats_delete_log",{log_id:se});I(de.message||"Conversation deleted."),a.selectedLogId===Number(se)&&(a.selectedLogId=null,Ue(null)),pt(),window.setTimeout(()=>I(""),2e3)}catch(de){I(de.message||"Failed to delete conversation.","error")}}},be=async()=>{if(window.confirm("Delete all logs that match the current filters?")){I("Deleting logs...");try{let me=await window.aipkit_apiRequest("aipkit_stats_delete_logs",J());I(me.message||"Logs deleted."),a.selectedLogId=null,Ue(null),pt(),window.setTimeout(()=>I(""),2500)}catch(me){I(me.message||"Failed to delete logs.","error")}}},ze=async()=>{I("Preparing export...");try{let se=await window.aipkit_apiRequest("aipkit_stats_export_logs",J());if(!se||!se.csv)throw new Error("Export failed.");le(se.csv,se.filename),I(se.message||"Export ready."),window.setTimeout(()=>I(""),2e3)}catch(se){I(se.message||"Failed to export logs.","error")}},Me=se=>{if(!f.tableMenu||!f.tableMenuTrigger)return;let me=se??f.tableMenu.hidden;f.tableMenu.hidden=!me,f.tableMenuTrigger.setAttribute("aria-expanded",me?"true":"false")},rt=se=>{if(f.pagination){if(typeof window.aipkit_renderLogsPagination=="function"){window.aipkit_renderLogsPagination(se,f.pagination,me=>{a.page=me,pt()});return}f.pagination.innerHTML=""}},Ue=se=>{if(!f.detailPanel)return;if(!se){f.detailPanel.innerHTML=`
                    <div class="aipkit_stats_detail_empty">
                        <div>
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.4; margin-bottom: 12px;">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <div>${n("Select a conversation to view details.")}</div>
                        </div>
                    </div>
                `;return}let me=Le=>{let Te=(Le||"").toLowerCase();return Te==="assistant"||Te==="model"||Te==="bot"?"bot":Te==="user"?"user":Te||"unknown"},de=(Le,Te)=>{for(let xt=Te+1;xt<Le.length;xt+=1)if(me(Le[xt]?.role)==="bot")return Le[xt];return null},ve=Le=>Le>=85?"is-excellent":Le>=70?"is-good":Le>=50?"is-fair":"is-poor",qe=`
                <div class="aipkit_stats_detail_header">
                    <div class="aipkit_stats_detail_title">${n(se.user_display_name||"User")}</div>
                    <div class="aipkit_stats_detail_meta">
                        ${n(se.bot_name||V(se.module))}
                        &middot; ${n(i(se.last_message_ts))}
                        &middot; ${n(e(se.message_count||0))} ${n("messages")}
                        ${se.ip_address?`&middot; ${n(`IP ${se.ip_address}`)}`:""}
                    </div>
                </div>
            `,Se=Array.isArray(se.messages)?se.messages:[],Je=String(se.module||"").toLowerCase().replace(/[\s-]+/g,"_"),nt=(()=>{if(typeof window.markdownit!="function")return null;let Le=window.markdownit({html:!1,linkify:!0,typographer:!0});return window.hljs&&typeof window.markdownitHighlight=="function"&&Le.use(window.markdownitHighlight,{hljs:window.hljs}),Le})(),Vt=Le=>{let Te=String(Le||"").trim().toLowerCase();return Te?Te.startsWith("generate ")||Te.startsWith("content writer request"):!1},ai=Le=>{if(!Le||typeof Le!="object")return null;let Te=Le.payload_sent;if(!Te||typeof Te!="object")return null;let xt=Array.isArray(Te.messages)?Te.messages:Array.isArray(Te.input)?Te.input:null;if(!Array.isArray(xt))return null;let Kt=xt.find(yt=>yt&&yt.role==="user"&&typeof yt.content=="string"&&yt.content.trim());return Kt?Kt.content.trim():null},ti=(Le,Te)=>{if(!Le||typeof Le!="object")return null;let xt={"generate excerpt":"custom_excerpt_prompt","generate tags":"custom_tags_prompt","generate meta description":"custom_meta_prompt","generate focus keyword":"custom_keyword_prompt","generate image prompt":"image_prompt","generate featured image":"featured_image_prompt","generate title":"custom_title_prompt"},Kt=String(Te||"").trim().toLowerCase(),yt=xt[Kt];if(!yt||typeof Le[yt]!="string")return null;let ot=Le[yt].trim();return ot||null},Ft=Le=>{if(!Le||typeof Le!="object")return null;for(let Te in Le){if(!Object.prototype.hasOwnProperty.call(Le,Te)||!/_prompt$/i.test(Te))continue;let xt=Le[Te];if(typeof xt=="string"&&xt.trim())return xt.trim()}return null};if(Je==="content_writer"&&Array.isArray(Se)&&Se.length)for(let Le=0;Le<Se.length;Le+=1){let Te=Se[Le];if(!Te||Te.role!=="user"||typeof Te.content!="string")continue;let xt=Te.content.trim();if(!xt||!Vt(xt))continue;let Kt=null,yt=Se[Le+1]?.request_payload;yt&&(Kt=ai(yt)),!Kt&&Te.request_payload&&(Kt=ai(Te.request_payload)),!Kt&&Te.request_payload&&(Kt=ti(Te.request_payload,xt)),!Kt&&Te.request_payload&&(Kt=Ft(Te.request_payload)),Kt&&(Te.original_content=Te.content,Te.content=Kt)}let ht=Se.map((Le,Te)=>{let xt=me(Le.role),Kt=i(Le.timestamp),yt=s(Le.content),ot=xt==="user"?"User":xt==="bot"?"Assistant":xt,yi=String(Le.message_id||`msg_${Te}`).replace(/[^a-zA-Z0-9_-]/g,"")||`msg_${Te}`,Zt=[],Nt="",Jt="",Pi="";if(xt==="user"){let tt=de(Se,Te),Ye=tt?.provider||"",Ot=tt?.model||"",qt=tt?.usage?.total_tokens??tt?.usage?.totalTokenCount??null;Ye&&Zt.push(Ye),Ot&&Zt.push(Ot),typeof qt=="number"&&qt>0&&Zt.push(`${e(qt)} tokens`);let kt=tt?.request_payload||null;if(Zt.length||kt)if(kt){let zt=`aipkit_stats_payload_${yi}`,Dt=Zt.length?Zt.join(" / "):"Request payload";Nt=`
                                <button type="button" class="aipkit_stats_meta_toggle" data-aipkit-stats-toggle="${zt}" aria-expanded="false">
                                    <span>${n(Dt)}</span>
                                    <span class="aipkit_stats_meta_chevron" aria-hidden="true"></span>
                                </button>
                            `,Pi+=`
                                <div class="aipkit_stats_expandable" id="${zt}" hidden>
                                    <div class="aipkit_stats_expandable_header">${n("Request Payload")}</div>
                                    <div class="aipkit_stats_expandable_body">
                                        <pre class="aipkit_stats_payload">${n(JSON.stringify(kt,null,2))}</pre>
                                    </div>
                                </div>
                            `}else Zt.length&&(Nt=`<div class="aipkit_stats_meta_info">${n(Zt.join(" / "))}</div>`)}if(xt==="bot"){let tt=Array.isArray(Le.vector_search_scores)?Le.vector_search_scores:[];if(tt.length>0){let Ye=tt.reduce((Dt,it)=>{let Wt=Number(Dt?.score??0);return Number(it?.score??0)>Wt?it:Dt},tt[0]),Ot=Ye?.score!==void 0?Math.round(Number(Ye.score)*100):0,qt=ve(Ot),kt=`aipkit_stats_scores_${yi}`;Jt=`
                            <button type="button" class="aipkit_stats_score_badge ${qt}" data-aipkit-stats-toggle="${kt}" aria-expanded="false">
                                ${n(`Score ${Ot}%`)}
                            </button>
                        `;let zt=tt.map(Dt=>{let it=Dt?.provider||"Unknown",Wt="";if(it==="OpenAI")Wt=Dt.store_name||Dt.store_id?` \xB7 ${Dt.store_name||Dt.store_id}`:"";else if(it==="Pinecone"){let ft=Dt.namespace?` \xB7 ${Dt.namespace}`:"";Wt=Dt.index_name?` \xB7 ${Dt.index_name}${ft}`:ft}else it==="Qdrant"&&(Wt=Dt.collection_name?` \xB7 ${Dt.collection_name}`:"");let Ae=Dt?.score!==void 0?Math.round(Number(Dt.score)*100):null,Lt=Ae!==null?ve(Ae):"is-poor",ut=Dt?.content_preview||"";return`
                                <div class="aipkit_stats_score_item">
                                    <div class="aipkit_stats_score_title">${n(it)}${n(Wt)}</div>
                                    <div class="aipkit_stats_score_value ${Lt}">
                                        ${n(Ae!==null?`${Ae}%`:"\u2014")}
                                    </div>
                                    <div class="aipkit_stats_score_preview">${n(ut)}</div>
                                </div>
                            `}).join("");Pi+=`
                            <div class="aipkit_stats_expandable" id="${kt}" hidden>
                                <div class="aipkit_stats_expandable_header">${n("Vector Search Results")}</div>
                                <div class="aipkit_stats_expandable_body aipkit_stats_scores_list">
                                    ${zt}
                                </div>
                            </div>
                        `}}let Hi=!!Nt,ji=!!Jt,pe=Hi||ji?`
                    <div class="aipkit_stats_meta_bar${Hi&&!ji||!Hi&&ji?" aipkit_stats_meta_bar--compact":""}">
                        ${Hi?Nt:""}
                        <div class="aipkit_stats_meta_actions">
                            ${Jt||""}
                        </div>
                    </div>
                `:"",xe=!!(nt&&typeof yt=="string"),ke=xe?nt.render(yt):n(yt);return`
                    <div class="aipkit_stats_message aipkit_stats_message--${n(xt)}" style="animation-delay: ${Te*.05}s">
                        <div class="aipkit_stats_message_meta">${n(ot)}${Kt?` \xB7 ${n(Kt)}`:""}</div>
                        <div class="aipkit_stats_message_body${xe?" aipkit_stats_message_body--markdown":""}">${ke}</div>
                        ${pe}
                        ${Pi}
                    </div>
                `}).join("");f.detailPanel.innerHTML=`
                ${qe}
                <div class="aipkit_stats_detail_messages">
                    ${ht||`<div class="aipkit_stats_table_placeholder">${n("No messages found.")}</div>`}
                    <div class="aipkit_stats_detail_footer">
                        <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_stats_detail_delete" data-log-id="${n(se.id)}">
                            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                            ${n("Delete")}
                        </button>
                    </div>
                </div>
            `},vt=async()=>{I("Loading stats...");try{let se=await window.aipkit_apiRequest("aipkit_stats_get_overview",{days:a.days});f.totalConversations.textContent=e(se.summary?.total_conversations||0),f.totalMessages.textContent=e(se.summary?.total_messages||0),f.uniqueUsers.textContent=e(se.summary?.unique_users||0),f.avgTokens.textContent=e(se.summary?.avg_tokens||0),f.overviewPeriod&&(f.overviewPeriod.textContent=se.summary?.period_label||""),L(se.charts?.daily_conversations||{}),K(se.charts?.daily_tokens||{}),I("")}catch(se){I(se.message||"Failed to load stats.","error")}},we=(se,me=!0)=>{if(f.overviewPanel){if(f.overviewPanel.hidden=!se,f.overviewToggle&&(f.overviewToggle.setAttribute("aria-expanded",se?"true":"false"),f.overviewToggle.classList.toggle("is-active",se)),me)try{localStorage.setItem(r,se?"1":"0")}catch{}se&&vt()}},pt=async()=>{b("Loading logs...");try{let se=await window.aipkit_apiRequest("aipkit_stats_get_logs",{days:a.days,page:a.page,per_page:a.perPage,bot_id:a.botId,module:a.module,search:a.search}),me=Array.isArray(se.logs)?se.logs:[];!a.selectedLogId&&!k&&me.length&&(a.selectedLogId=Number(me[0].id),k=!0),ee(me),rt(se.pagination||{}),a.selectedLogId&&k&&st(a.selectedLogId)}catch(se){b(se.message||"Failed to load logs.")}},st=async se=>{if(!se){Ue(null);return}f.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${n("Loading conversation...")}</div>`;try{let me=await window.aipkit_apiRequest("aipkit_stats_get_log_detail",{log_id:se});Ue(me)}catch(me){f.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${n(me.message||"Failed to load conversation.")}</div>`}},bt=se=>{a.search=se.trim(),a.page=1,_&&clearTimeout(_),_=window.setTimeout(()=>{pt()},300)},wt=async()=>{if(f.cronStatus)try{let se=await window.aipkit_apiRequest("aipkit_stats_get_log_cron_status",{});M(se)}catch{}},Ht=async()=>{if(!f.settingsToggle||!f.retentionSelect)return;let se=f.settingsToggle.checked?"1":"0",me=parseInt(f.retentionSelect.value,10)||90;I("Saving settings...","loading");try{let de=await window.aipkit_apiRequest("aipkit_stats_save_settings",{enable_pruning:se,retention_period_days:me});h(f.settingsToggle.checked),I(de.message||"Settings saved.","success"),wt(),window.setTimeout(()=>I(""),2e3)}catch(de){I(de.message||"Failed to save settings.","error")}};if(f.daysFilter&&(f.daysFilter.value=String(a.days),f.daysFilter.addEventListener("change",()=>{a.days=parseInt(f.daysFilter.value,10)||30,a.page=1,f.overviewPanel&&!f.overviewPanel.hidden&&vt(),pt()})),f.botFilter&&f.botFilter.addEventListener("change",()=>{a.botId=f.botFilter.value,a.page=1,pt()}),f.moduleFilter&&f.moduleFilter.addEventListener("change",()=>{a.module=f.moduleFilter.value,a.page=1,pt()}),f.searchInput&&f.searchInput.addEventListener("input",se=>{bt(se.target.value||"")}),f.overviewToggle&&f.overviewPanel&&f.overviewToggle.addEventListener("click",()=>{let se=!f.overviewPanel.hidden;we(!se)}),f.tableBody&&f.tableBody.addEventListener("click",se=>{let me=se.target.closest("tr[data-log-id]");if(!me)return;let de=me.getAttribute("data-log-id");de&&(a.selectedLogId=Number(de),f.tableBody.querySelectorAll("tr").forEach(ve=>{ve.classList.toggle("aipkit_stats_row_active",ve===me)}),st(de))}),f.detailPanel&&f.detailPanel.addEventListener("click",se=>{let me=se.target.closest(".aipkit_stats_detail_delete");if(!me){let de=se.target.closest("[data-aipkit-stats-toggle]");if(!de)return;let ve=de.getAttribute("data-aipkit-stats-toggle");if(!ve)return;let qe=document.getElementById(ve);if(!qe)return;let Se=de.getAttribute("aria-expanded")==="true";qe.hidden=Se,de.setAttribute("aria-expanded",Se?"false":"true"),de.classList.toggle("is-expanded",!Se);return}ue(me.getAttribute("data-log-id"))}),f.tableMenuTrigger&&f.tableMenu&&f.tableMenuTrigger.addEventListener("click",se=>{se.preventDefault(),se.stopPropagation(),Me(f.tableMenu.hidden)}),document.addEventListener("click",se=>{!f.tableMenu||f.tableMenu.hidden||se.target.closest("#aipkit_stats_table_menu")||se.target.closest("#aipkit_stats_table_menu_trigger")||Me(!1)}),document.addEventListener("keydown",se=>{se.key!=="Escape"||!f.tableMenu||f.tableMenu.hidden||Me(!1)}),f.deleteAllBtn&&f.deleteAllBtn.addEventListener("click",()=>{Me(!1),be()}),f.exportBtn&&f.exportBtn.addEventListener("click",()=>{Me(!1),ze()}),f.settingsToggle&&f.settingsToggle.addEventListener("change",()=>{if(!E){f.settingsToggle.checked=!1,I("Upgrade to Pro to enable auto-delete.","error");return}h(f.settingsToggle.checked),Ht()}),f.retentionSelect&&f.retentionSelect.addEventListener("change",()=>{E&&Ht()}),f.shortcodeToggle&&f.shortcodeConfig&&f.shortcodeToggle.addEventListener("click",se=>{se.preventDefault();let me=!f.shortcodeConfig.hidden;f.shortcodeConfig.hidden=me,f.shortcodeToggle.setAttribute("aria-expanded",me?"false":"true"),f.shortcodeToggle.classList.toggle("is-active",!me)}),f.shortcodeOptions&&f.shortcodeOptions.length&&(f.shortcodeOptions.forEach(se=>{se.addEventListener("change",N)}),N()),f.shortcodeSnippet&&f.shortcodeSnippet.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(f.shortcodeSnippet.textContent,f.shortcodeSnippet)}),f.settingsUsersNav&&f.settingsUsersNav.addEventListener("click",se=>{se.preventDefault(),U(),B()}),f.userSheetClose&&f.userSheetClose.addEventListener("click",se=>{se.preventDefault(),D()}),f.userSheet&&f.userSheet.addEventListener("click",se=>{se.target===f.userSheet&&D()}),f.userSearchInput&&(f.userSearchInput.addEventListener("input",()=>{clearTimeout(u);let se=f.userSearchInput.value.trim();u=window.setTimeout(()=>{$(1,se)},350)}),f.userSearchInput.addEventListener("keydown",se=>{if(se.key==="Enter"){se.preventDefault(),clearTimeout(u);let me=f.userSearchInput.value.trim();$(1,me),f.userSearchClear&&(f.userSearchClear.hidden=me.length===0)}})),f.userSearchClear&&f.userSearchClear.addEventListener("click",()=>{f.userSearchInput&&(f.userSearchInput.value=""),f.userSearchClear.hidden=!0,$(1,"")}),f.userTableBody){let se="data-user-credits-listeners";f.userTableBody.getAttribute(se)||(f.userTableBody.addEventListener("change",me=>{me.target.matches(".aipkit_stats_credits_balance_input")&&j(me.target)}),f.userTableBody.addEventListener("keypress",me=>{me.key==="Enter"&&me.target.matches(".aipkit_stats_credits_balance_input")&&(me.preventDefault(),me.target.blur())}),f.userTableBody.addEventListener("click",me=>{let de=me.target.closest(".aipkit_stats_usage_toggle");if(de){me.preventDefault();let qe=de.closest("td");if(qe){let Se=qe.querySelectorAll(".aipkit_stats_usage_extra");if(Se.length){let Je=Se[0].hidden;Se.forEach(nt=>{nt.hidden=!Je}),de.textContent=Je?l("Show less","gpt3-ai-content-generator"):`${l("Show more","gpt3-ai-content-generator")}...`}}return}let ve=me.target.closest(".aipkit_stats_purchase_history_btn");if(ve){me.preventDefault();let qe=ve.dataset.history?JSON.parse(ve.dataset.history):[];R(qe,ve.dataset.userName||"")}}),f.userTableBody.setAttribute(se,"true"))}document.addEventListener("keydown",se=>{se.key==="Escape"&&f.userSheet&&f.userSheet.classList.contains("aipkit-active")&&D()}),we(S(),!1),pt(),h(!!f.settingsToggle?.checked)}window.aipkit_initStats=t})();(function(){"use strict";function g(){let o={},r=document.getElementById("aipkit_settings_container");return r&&r.querySelectorAll("input[name], select[name], textarea[name]").forEach(e=>{e.type==="checkbox"?o[e.name]=e.checked?"1":"0":e.type==="radio"?e.checked&&(o[e.name]=e.value):o[e.name]=e.value}),o}window.aipkit_getCurrentFormData=g})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function g(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let o=window.aipkit_getCurrentFormData(),r=window.aipkit_lastSavedData||{};if(JSON.stringify(o)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let n="aipkit_settings_messages";window.aipkit_showSavingIndicator(n,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",o),window.aipkit_showSavingIndicator(n,!1),window.aipkit_showMessage(n,"success","Settings saved!"),window.aipkit_lastSavedData=o,typeof window.aipkit_queueProviderAutoSync=="function"&&window.aipkit_queueProviderAutoSync(r,o)}catch(e){window.aipkit_showSavingIndicator(n,!1),window.aipkit_showMessage(n,"error","Save failed: "+e.message),console.error("AIPKit Auto-Save Error:",e)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=g})();(function(){"use strict";function g(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let n="data-autosave-listener-attached";r.getAttribute(n)||(r.addEventListener("change",function(e){let i=e.target;i.matches(".aipkit_autosave_trigger")&&i.id!=="aipkit_provider"&&(i.tagName.toLowerCase()==="select"||i.type==="checkbox"||i.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),r.addEventListener("blur",function(e){let i=e.target;if(i.matches(".aipkit_autosave_trigger")&&i.id!=="aipkit_provider"){let c=i.tagName.toLowerCase();(c==="input"||c==="textarea")&&i.type!=="range"&&i.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),r.setAttribute(n,"true"))}function o(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=g,window.aipkit_updateLastSavedData=o})();(function(){"use strict";function g(r){try{return new Date(r+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return r}}function o(r){return typeof r!="number"?r:r.toLocaleString()}window.aipkit_formatChartDate=g,window.aipkit_formatChartNumber=o})();(function(){"use strict";let g=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],o="#B0BEC5",r={};function n(i){r={};let c=0;i.forEach(s=>{if(s==="Other")r[s]=o;else{let t;do t=g[c%g.length],c++;while(t===o&&g.length>1);r[s]=t}})}function e(i){return r[i]||"#cccccc"}window.aipkit_assignModuleColors=n,window.aipkit_getModuleColor=e})();(function(){"use strict";function g(e,i){if(!i||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let c=e.target,s=c.getAttribute("data-date"),t=c.getAttribute("data-module"),d=parseInt(c.getAttribute("data-value"),10),a=parseInt(c.getAttribute("data-daily-total"),10),l=window.aipkit_getModuleColor(t),p=t?o(t.replace(/[-_]/g," ")):"Unknown";i.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(s)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${l}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${p}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(d)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(a)} tokens)</span>
        `,i.classList.add("aipkit_active"),r(e,i)}function o(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function r(e,i){if(!i)return;let c=i.parentElement;if(!c)return;let s=c.getBoundingClientRect(),t=e.clientX-s.left,d=e.clientY-s.top,a=i.offsetWidth,l=i.offsetHeight,p=t+15,_=d-l-10;p+a>s.width-5&&(p=t-a-15),p<5&&(p=5),_<5&&(_=d+15),_+l>s.height-5&&(_=s.height-l-5),i.style.left=`${p}px`,i.style.top=`${_}px`,i.style.transform="translate(0, 0)"}function n(e){e&&e.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=g,window.aipkit_moveChartTooltip=r,window.aipkit_hideChartTooltip=n})();(function(){"use strict";let g="http://www.w3.org/2000/svg";function o(n,e){if(n.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),n.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let i=Object.keys(e);if(i.length===0){n.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let c=new Set;i.forEach(x=>{Object.keys(e[x]).forEach(v=>c.add(v))});let s=Array.from(c);s.sort((x,v)=>{if(x==="Other")return 1;if(v==="Other")return-1;let C=P=>P?r(P.replace(/[-_]/g," ")):"Unknown";return C(x).localeCompare(C(v))}),window.aipkit_assignModuleColors(s);let t=1;i.forEach(x=>{let v=Object.values(e[x]).reduce((C,P)=>C+P,0);v>t&&(t=v)}),t=t*1.05;let d=i.length,a=250,l=s.length>0?Math.max(40,Math.ceil(s.length/3)*20):0,p={top:20,right:20,bottom:30+l,left:50},_=n.clientWidth-p.left-p.right,u=a-p.top-p.bottom,m=Math.max(1,_/d*.8),k=Math.max(0,_/d*.2),f=document.createElementNS(g,"svg");f.setAttribute("viewBox",`0 0 ${n.clientWidth} ${a}`),f.setAttribute("preserveAspectRatio","xMidYMid meet"),f.setAttribute("class","aipkit_token_usage_chart_svg"),f.setAttribute("aria-label","Token usage per module per day chart");let w=document.createElementNS(g,"g");w.setAttribute("transform",`translate(${p.left}, ${p.top})`),f.appendChild(w);let E=document.createElement("div");E.className="aipkit_chart_tooltip",n.style.position="relative",n.appendChild(E);let y=document.createElementNS(g,"g");y.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),w.appendChild(y);let I=document.createElementNS(g,"line");I.setAttribute("x1",0),I.setAttribute("y1",0),I.setAttribute("x2",0),I.setAttribute("y2",u),y.appendChild(I);let S=5;for(let x=0;x<S;x++){let v=Math.round(t*(x/(S-1))),C=u-u*(x/(S-1)),P=document.createElementNS(g,"text");P.setAttribute("x",-5),P.setAttribute("y",C+3),P.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),P.textContent=window.aipkit_formatChartNumber(v),y.appendChild(P);let $=document.createElementNS(g,"line");$.setAttribute("x1",0),$.setAttribute("y1",C),$.setAttribute("x2",_),$.setAttribute("y2",C),$.setAttribute("class","aipkit_chart_grid_line"),w.insertBefore($,w.firstChild)}let h=document.createElementNS(g,"g");h.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),h.setAttribute("transform",`translate(0, ${u})`),w.appendChild(h);let M=document.createElementNS(g,"line");M.setAttribute("x1",0),M.setAttribute("y1",0),M.setAttribute("x2",_),M.setAttribute("y2",0),h.appendChild(M);let b=Math.max(1,Math.ceil(d/(_/60)));i.forEach((x,v)=>{if(v%b===0||v===d-1){let C=v*(m+k)+m/2+k/2,P=document.createElementNS(g,"text");P.setAttribute("x",C),P.setAttribute("y",p.bottom-l-10),P.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),P.textContent=window.aipkit_formatChartDate(x),h.appendChild(P)}});let A=document.createElementNS(g,"g");if(w.appendChild(A),i.forEach((x,v)=>{let C=e[x],P=u,$=0;s.filter(D=>C[D]>0).forEach(D=>{let N=C[D]||0;$+=N;let R=N/t*u;P-=R;let j=v*(m+k)+k/2,L=document.createElementNS(g,"rect");L.setAttribute("x",j),L.setAttribute("y",P),L.setAttribute("width",m),L.setAttribute("height",Math.max(.1,R)),L.setAttribute("class","aipkit_chart_bar"),L.setAttribute("fill",window.aipkit_getModuleColor(D)),L.setAttribute("data-date",x),L.setAttribute("data-module",D),L.setAttribute("data-value",N),L.setAttribute("data-daily-total",0),L.addEventListener("mouseenter",K=>window.aipkit_showStackedTooltip(K,E)),L.addEventListener("mousemove",K=>window.aipkit_moveChartTooltip(K,E)),L.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(E)),A.appendChild(L)}),A.querySelectorAll(`rect[data-date="${x}"]`).forEach(D=>D.setAttribute("data-daily-total",$))}),s.length>0){let x=document.createElementNS(g,"g");x.setAttribute("class","aipkit_chart_legend"),x.setAttribute("transform",`translate(0, ${u+p.bottom-l+5})`),w.appendChild(x);let v=0,C=0,P=20,$=_,U=35;s.forEach(B=>{let D=r(B.replace(/[-_]/g," ")),R=D.length*7+25+U;v>0&&v+R>$&&(v=0,C+=P);let j=document.createElementNS(g,"g");j.setAttribute("transform",`translate(${v}, ${C})`);let L=document.createElementNS(g,"rect");L.setAttribute("width",10),L.setAttribute("height",10),L.setAttribute("y",-5),L.setAttribute("fill",window.aipkit_getModuleColor(B)),j.appendChild(L);let K=document.createElementNS(g,"text");K.setAttribute("x",15),K.setAttribute("y",0),K.setAttribute("class","aipkit_chart_legend_label"),K.textContent=D,j.appendChild(K),x.appendChild(j),v+=R})}n.appendChild(f)}function r(n){return n?n.charAt(0).toUpperCase()+n.slice(1):""}window.aipkit_renderTokenUsageChart=o})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_token_usage_chart_container");if(!r){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let n=r.querySelector(".aipkit_chart_loading_placeholder"),e=r.querySelector(".aipkit_chart_error_placeholder"),i=r.querySelector(".aipkit_chart_nodata_placeholder");e&&(e.style.display="none"),i&&(i.style.display="none"),n&&(n.style.display="flex");let c=[3,7,14,30,90],s=parseInt(o,10);if(!s||isNaN(s)){try{let d=localStorage.getItem("aipkit_stats_period_days"),a=parseInt(d,10);d&&!isNaN(a)&&c.includes(a)&&(s=a)}catch{}let t=document.getElementById("aipkit_stats_period_select");if(t){let d=parseInt(t.value,10);(!s||isNaN(s))&&(s=!isNaN(d)&&c.includes(d)?d:3),c.includes(s)&&String(t.value)!==String(s)&&(t.value=String(s))}else r.dataset.defaultDays?s=parseInt(r.dataset.defaultDays,10)||3:s=3}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:s}).then(t=>{if(n&&(n.style.display="none"),t&&t.daily_token_data){let d=t.daily_token_data;if(d&&typeof d=="object"&&Object.values(d).some(l=>l&&typeof l=="object"&&Object.values(l).some(p=>Number(p)>0)))window.aipkit_renderTokenUsageChart(r,d);else{let l=t.notice||window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.",p=t.manage_logs_url,_=e||i;if(_){_.textContent="";let u=document.createTextNode(l+" ");if(_.appendChild(u),p){let m=document.createElement("a");m.href=p,m.target="_blank",m.rel="noopener noreferrer",m.textContent=window.aipkit_dashboard?.text?.manageLogs||"View stats",_.appendChild(m)}_.style.display="flex"}else{let u=document.createElement("div");u.className="aipkit_chart_error_placeholder",u.textContent=l,r.innerHTML="",r.appendChild(u)}}}else throw new Error("Invalid data received for chart.")}).catch(t=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",t),n&&(n.style.display="none"),e)e.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,e.style.display="flex";else{let d=document.createElement("div");d.className="aipkit_chart_error_placeholder",d.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,r.innerHTML="",r.appendChild(d)}})}window.aipkit_loadTokenUsageChart=g,document.addEventListener("change",function(o){let r=o.target;if(r&&r.id==="aipkit_stats_period_select"){let n=parseInt(r.value,10)||7;typeof window.aipkit_loadTokenUsageChart=="function"&&window.aipkit_loadTokenUsageChart(n);try{[3,7,14,30,90].includes(n)&&localStorage.setItem("aipkit_stats_period_days",String(n))}catch{}}})})();(function(){"use strict";function g(o){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openai=o);let r=document.getElementById("aipkit_openai_model"),n=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openai_model"]');if(!r&&n.length===0){console.warn("OpenAI Sync: No OpenAI model selects found (#aipkit_openai_model or chat selects).");return}if(!o||Object.keys(o).length===0){r.appendChild(new Option("No models found.",""));return}let e=!1,i=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],c=Object.keys(o),s=i.filter(l=>c.includes(l)).concat(c.filter(l=>!i.includes(l)).sort()),t=(l,p)=>{let _=!1;return s.forEach(u=>{let m=o[u]||[];if(m.length===0)return;let k=document.createElement("optgroup");k.label=u,m.sort((f,w)=>(f.name||f.id||"").localeCompare(w.name||w.id||"")),m.forEach(f=>{let w=new Option(f.name||f.id,f.id);f.id===p&&(w.selected=!0,_=!0),k.appendChild(w)}),l.appendChild(k)}),_};if(r){let l=t(r,r.value);if(!l&&r.value&&!r.querySelector(`option[value="${CSS.escape(r.value)}"]`)){let p=new Option(r.value+" (manual)",r.value,!1,!0),_=r.querySelector('optgroup[label="Other"]');_?_.appendChild(p):r.insertBefore(p,r.firstChild),l=!0}if(!l&&r.options.length>0&&r.selectedIndex===-1){let p=-1;for(let _=0;_<r.options.length;_++)if(!r.options[_].disabled&&r.options[_].value){p=_;break}r.selectedIndex=p!==-1?p:0}}n.forEach(l=>{if(!t(l,l.value)&&l.value&&!l.querySelector(`option[value="${CSS.escape(l.value)}"]`)){let _=new Option(l.value+" (manual)",l.value,!1,!0);l.insertBefore(_,l.firstChild)}l.options.length>0&&l.selectedIndex===-1&&(l.selectedIndex=0)});let d=document.getElementById("aipkit_content_writer_provider"),a=document.getElementById("aipkit_content_writer_model");d&&a&&d.value==="openai"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(d,a)}window.aipkit_updateOpenAIModels=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openrouter=Array.isArray(r)?r:[]);let n=document.getElementById("aipkit_openrouter_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openrouter_model"]');if(!n&&e.length===0){console.warn("OpenRouter Sync: No OpenRouter model selects found (#aipkit_openrouter_model or chat selects).");return}let i=window.aipkit_dashboard?.recommendedModels?.openrouter||[],c=Array.isArray(i)?i:[],s=a=>{if(!a)return[];let l=g("Recommended","gpt3-ai-content-generator"),p=Array.from(a.querySelectorAll("optgroup")).find(_=>_.label===l||_.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(_=>({id:_.value,name:_.textContent.trim()||_.value})).filter(_=>_.id):[]};if(c.length===0){let a=n||e[0];c=s(a)}let t=new Set(c.map(a=>a?.id).filter(Boolean)),d=a=>{let l=a.value;a.innerHTML="";let p=!1,_=!1;if(c.length>0){let k=document.createElement("optgroup");k.label=g("Recommended","gpt3-ai-content-generator"),c.forEach(f=>{if(f&&typeof f=="object"&&f.id){let w=new Option(f.name||f.id,f.id);f.id===l&&(w.selected=!0,p=!0),k.appendChild(w)}}),k.children.length>0&&(a.appendChild(k),_=!0)}if(!r||!r.length){_||a.appendChild(new Option("No models found.",""));return}let u={};if(r.forEach(k=>{if(!k||!k.id||t.has(k.id))return;let f=k.id.split("/"),w=(f.length>1?f[0]:"other").toLowerCase();u[w]||(u[w]=[]),u[w].push(k)}),Object.keys(u).sort().forEach(k=>{let f=document.createElement("optgroup");f.label=k.charAt(0).toUpperCase()+k.slice(1),u[k].sort((w,E)=>(w.name||"").localeCompare(E.name||"")),u[k].forEach(w=>{let E=new Option(w.name||w.id,w.id);w.id===l&&(E.selected=!0,p=!0),f.appendChild(E)}),f.children.length>0&&(a.appendChild(f),_=!0)}),!p&&l&&!a.querySelector(`option[value="${CSS.escape(l)}"]`)){let k=new Option(l+" (manual)",l,!1,!0);a.insertBefore(k,a.firstChild)}if(!p&&a.options.length>0&&a.selectedIndex===-1){let k=-1;for(let f=0;f<a.options.length;f++)if(!a.options[f].disabled&&a.options[f].value){k=f;break}a.selectedIndex=k!==-1?k:0}};n&&d(n),e.forEach(d)}window.aipkit_updateOpenRouterModels=o})();(function(){"use strict";let g=window.wp?.i18n?.__||function(r){return r};function o(r){let n=document.getElementById("aipkit_google_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_google_model"]');if(!n&&e.length===0){console.warn("Google Sync: No Google model selects found (#aipkit_google_model or chat selects).");return}let i=window.aipkit_dashboard?.recommendedModels?.google||[],c=Array.isArray(i)?i:[],s=l=>{if(!l)return[];let p=g("Recommended","gpt3-ai-content-generator"),_=Array.from(l.querySelectorAll("optgroup")).find(u=>u.label===p||u.label==="Recommended");return _?Array.from(_.querySelectorAll("option")).map(u=>({id:u.value,name:u.textContent.trim()||u.value})).filter(u=>u.id):[]};if(c.length===0){let l=n||e[0];c=s(l)}let t=new Set(c.map(l=>l?.id).filter(Boolean)),d=Array.isArray(r)?r.slice():[];d.sort((l,p)=>(l.name||l.id||"").localeCompare(p.name||p.id||""));let a=l=>{let p=l.value;l.innerHTML="";let _=!1,u=!1,m=c.length>0?document.createElement("optgroup"):null;if(m&&(m.label=g("All models","gpt3-ai-content-generator")),c.length>0){let k=document.createElement("optgroup");k.label=g("Recommended","gpt3-ai-content-generator"),c.forEach(f=>{if(f&&typeof f=="object"&&f.id){let w=new Option(f.name||f.id,f.id);(f.id===p||`models/${f.id}`===p)&&(w.selected=!0,_=!0),k.appendChild(w)}}),k.children.length>0&&(l.appendChild(k),u=!0)}if(!d.length){u||l.appendChild(new Option("No models found.",""));return}if(d.forEach(k=>{let f=k.id||"",w=k.name||f;if(!f||t.has(f))return;let E=new Option(w,f);(f===p||`models/${f}`===p)&&(E.selected=!0,_=!0),m?m.appendChild(E):(l.appendChild(E),u=!0)}),m&&m.children.length>0&&(l.appendChild(m),u=!0),!_&&p){let k=p.startsWith("models/")?p.substring(7):p;if(!l.querySelector(`option[value="${CSS.escape(k)}"]`)){let f=k,w=new Option(f+" (manual)",p,!1,!0);l.insertBefore(w,l.firstChild),l.value=p}}if(l.options.length>0&&l.selectedIndex===-1){let k=-1;for(let f=0;f<l.options.length;f++)if(!l.options[f].disabled&&l.options[f].value){k=f;break}l.selectedIndex=k!==-1?k:0}};n&&a(n),e.forEach(a)}window.aipkit_updateGoogleModels=o})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_azure_deployment"),n=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_azure_deployment"]');if(!r&&n.length===0){console.warn("Azure Sync: No Azure deployment selects found (#aipkit_azure_deployment or chat selects).");return}let e=i=>{let c=i.value;i.innerHTML="";let s=o&&typeof o=="object"&&!Array.isArray(o)&&(o["Chat Models"]||o["Embedding Models"]||o["Image Models"]);if(!o||Array.isArray(o)&&!o.length||s&&Object.keys(o).length===0){if(r.appendChild(new Option("No deployments found.","")),c){let d=new Option(c+" (manual)",c,!1,!0);r.appendChild(d),r.value=c}return}let t=!1;if(s)Object.keys(o).forEach(d=>{let a=o[d];if(a&&Array.isArray(a)&&a.length>0){let l=document.createElement("optgroup");l.label=d,a.sort((p,_)=>(p.id||"").localeCompare(_.id||"")),a.forEach(p=>{let _=p.id||"",u=p.name||_;if(!_)return;let m=_+(u&&u!==_?` (model: ${u})`:""),k=new Option(m,_);_===c&&(k.selected=!0,t=!0),l.appendChild(k)}),i.appendChild(l)}});else{let d=Array.isArray(o)?o:[];d.sort((a,l)=>(a.id||"").localeCompare(l.id||"")),d.forEach(a=>{let l=a.id||"",p=a.name||l;if(!l)return;let _=l+(p&&p!==l?` (model: ${p})`:""),u=new Option(_,l);l===c&&(u.selected=!0,t=!0),i.appendChild(u)})}if(!t&&i.value&&!i.querySelector(`option[value="${CSS.escape(i.value)}"]`)){let d=new Option(i.value+" (not in synced list)",i.value,!1,!0);i.appendChild(d),t=!0}if(!t&&i.options.length>0&&i.selectedIndex===-1){let d=-1;for(let a=0;a<i.options.length;a++)if(!i.options[a].disabled&&i.options[a].value){d=a;break}i.selectedIndex=d!==-1?d:0}};r&&e(r),n.forEach(e)}window.aipkit_updateAzureDeployments=g})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_deepseek_model"),n=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_deepseek_model"]');if(!r&&n.length===0){console.warn("DeepSeek Sync: No DeepSeek model selects found (#aipkit_deepseek_model or chat selects).");return}let e=i=>{let c=i.value;if(i.innerHTML="",!o||!o.length){r.appendChild(new Option("No models found.",""));return}let s=!1;if(o.sort((t,d)=>(t.name||t.id||"").localeCompare(d.name||d.id||"")),o.forEach(t=>{let d=t.id||"",a=t.name||d;if(!d)return;let l=new Option(a,d);d===c&&(l.selected=!0,s=!0),i.appendChild(l)}),!s&&i.value&&!i.querySelector(`option[value="${CSS.escape(i.value)}"]`)){let t=new Option(i.value+" (manual)",i.value,!1,!0);i.insertBefore(t,i.firstChild)}!s&&i.options.length>0&&i.selectedIndex===-1&&(i.selectedIndex=0)};r&&e(r),n.forEach(e)}window.aipkit_updateDeepSeekModels=g})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_ollama_model"),n=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_ollama_model"]');if(!r&&n.length===0){console.warn("Ollama Sync: No Ollama model selects found (#aipkit_ollama_model or chat selects).");return}let e=i=>{let c=i.value;if(i.innerHTML="",!o||!o.length){r.appendChild(new Option("No models found.",""));return}o.sort((t,d)=>(t.name||t.id||"").localeCompare(d.name||d.id||""));let s=!1;if(o.forEach(t=>{let d=t.id||"",a=t.name||d;if(!d)return;let l=new Option(a,d);d===c&&(l.selected=!0,s=!0),i.appendChild(l)}),!s&&i.value&&!i.querySelector(`option[value="${CSS.escape(i.value)}"]`)){let t=new Option(i.value+" (manual)",i.value,!1,!0);i.insertBefore(t,i.firstChild)}i.options.length>0&&i.selectedIndex===-1&&(i.selectedIndex=0)};r&&e(r),n.forEach(e)}window.aipkit_updateOllamaModels=g})();(function(){"use strict";function g(n,e){let i=Array.isArray(e)?e:[],c=JSON.stringify(i),t=`[id^="${n==="models"?"aipkit_elevenlabs_models_json_":"aipkit_elevenlabs_voices_json_"}"]`;document.querySelectorAll(t).forEach(d=>{n==="models"?d.dataset.models=c:d.dataset.voices=c})}function o(n,e="aipkit_elevenlabs_voice_id"){let i=Array.isArray(n)?n:[];g("voices",i);let c=document.getElementById(e);if(!c){console.warn(`ElevenLabs Sync (Voices): Select element #${e} not found.`);return}if(typeof e=="string"&&e.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){window.aipkit_chatTts_updateElevenLabsVoiceSelect(e,i,c.value||"");return}let s=c.value;if(c.innerHTML="",c.appendChild(new Option("-- Select a Voice (Optional) --","")),!i.length){s&&s!==""&&(c.appendChild(new Option(s+" (manual/not synced)",s,!1,!0)),c.value=s);return}let t=!1;if(i.sort((d,a)=>(d.name||d.id||"").localeCompare(a.name||a.id||"")),i.forEach(d=>{let a=d.id||"",l=d.name||a;if(!a)return;let p=new Option(l,a);a===s&&(p.selected=!0,t=!0),c.appendChild(p)}),!t&&s&&s!==""&&!c.querySelector(`option[value="${CSS.escape(s)}"]`)){let d=new Option(s+" (manual/not synced)",s,!1,!0);c.appendChild(d),c.value=s}}function r(n,e="aipkit_elevenlabs_tts_model_id"){let i=Array.isArray(n)?n:[];g("models",i);let c=document.getElementById(e);if(!c){console.warn(`ElevenLabs Sync (Models): Select element #${e} not found.`);return}if(typeof e=="string"&&e.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){window.aipkit_chatTts_updateElevenLabsModelsSelect(e,i,c.value||"");return}let s=c.value;if(c.innerHTML="",c.appendChild(new Option("-- Select a Model (Optional) --","")),!i.length){s&&s!==""&&(c.appendChild(new Option(s+" (manual/not synced)",s,!1,!0)),c.value=s);return}let t=!1;if(i.sort((d,a)=>(d.name||d.id||"").localeCompare(a.name||a.id||"")),i.forEach(d=>{let a=d.id||"",l=d.name||a;if(!a)return;let p=new Option(l,a);a===s&&(p.selected=!0,t=!0),c.appendChild(p)}),!t&&s&&s!==""&&!c.querySelector(`option[value="${CSS.escape(s)}"]`)){let d=new Option(s+" (manual/not synced)",s,!1,!0);c.appendChild(d),c.value=s}}window.aipkit_updateElevenLabsVoices=o,window.aipkit_updateElevenLabsModelsSelect=r})();(function(){"use strict";function g(o,r="aipkit_pinecone_default_index"){let n=document.getElementById(r);if(!n){console.warn(`Pinecone Sync: Select element #${r} not found.`);return}let e=n.value;if(n.innerHTML="",n.appendChild(new Option("-- Select Default Index --","")),!o||!o.length){n.appendChild(new Option("(No indexes found - Sync again)","")),e&&e!==""&&(n.appendChild(new Option(e+" (manual)",e,!1,!0)),n.value=e);return}let i=!1;if(o.sort((c,s)=>(c.name||c.id||"").localeCompare(s.name||s.id||"")),o.forEach(c=>{let s=c.name||c.id||(typeof c=="string"?c:"");if(!s)return;let t=new Option(s,s);s===e&&(t.selected=!0,i=!0),n.appendChild(t)}),!i&&e&&e!==""&&!n.querySelector(`option[value="${CSS.escape(e)}"]`)){let c=new Option(e+" (manual)",e,!1,!0);n.appendChild(c),n.value=e}}window.aipkit_updatePineconeIndexes=g})();(function(){"use strict";function g(o,r="aipkit_qdrant_default_collection"){let n=document.getElementById(r);if(!n){console.warn(`Qdrant Sync: Select element #${r} not found.`);return}let e=n.multiple,i=e?Array.from(n.selectedOptions).map(s=>s.value).filter(Boolean):[n.value];if(n.innerHTML="",e||n.appendChild(new Option("-- Select Collection (Optional) --","")),!o||!o.length){n.appendChild(new Option("(No collections found - Sync again)","")),i.length&&(i.forEach(s=>{s&&n.appendChild(new Option(s+" (manual)",s,!1,!0))}),!e&&i[0]&&(n.value=i[0]));return}let c=new Set;if(o.sort((s,t)=>(s.name||s.id||"").localeCompare(t.name||t.id||"")),o.forEach(s=>{let t=s.name||s.id||"";if(!t)return;let d=i.includes(t),a=new Option(t,t,!1,d);d&&c.add(t),n.appendChild(a)}),i.forEach(s=>{if(s&&!c.has(s)&&!n.querySelector(`option[value="${CSS.escape(s)}"]`)){let t=new Option(s+" (manual)",s,!1,!0);n.appendChild(t)}}),!e&&i[0]&&!n.value&&(n.value=i[0]),typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let s=n.closest(".aipkit_popover_options_list")||n.closest(".aipkit_popover_option_main")||document;window.aipkit_populateQdrantCollectionsMultiSelect(s)}}window.aipkit_updateQdrantCollections=g})();(function(){"use strict";function g(o,r=""){let n=r||"aipkit_replicate_model",e=document.getElementById(n);if(window.aipkit_dashboard&&window.aipkit_dashboard.imageGeneratorModels&&(window.aipkit_dashboard.imageGeneratorModels.replicate=o),window.aipkit_image_generator_config_public&&(window.aipkit_image_generator_config_public.replicate_models=o),!e){r&&console.warn(`Replicate Sync: Select element #${n} not found.`);return}let i=e.value;if(e.innerHTML="",!o||!o.length){e.appendChild(new Option("(No models found - Sync again)","")),i&&i!==""&&(e.appendChild(new Option(i+" (manual/not synced)",i,!1,!0)),e.value=i);return}let c=!1;if(o.sort((s,t)=>(s.name||s.id||"").localeCompare(t.name||t.id||"")),o.forEach(s=>{let t=s.id||"",d=s.name||t;if(!t)return;let a=new Option(d,t);t===i&&(a.selected=!0,c=!0),e.appendChild(a)}),!c&&i&&i!==""&&!e.querySelector(`option[value="${CSS.escape(i)}"]`)){let s=new Option(i+" (manual)",i,!1,!0);e.insertBefore(s,e.firstChild),e.value=i}if(!e.value&&e.options.length>0){let s=-1;for(let t=0;t<e.options.length;t++)if(!e.options[t].disabled&&e.options[t].value){s=t;break}e.selectedIndex=s!==-1?s:0}}window.aipkit_updateReplicateModels=g})();(function(){"use strict";function g(u,m,k={}){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function")return console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing."),null;let f=k&&typeof k=="object"?k:{},w=!!f.silent,E=f.showErrors!==!1,y=!!u,I=(B,D="")=>{let N=Array.isArray(B)?B:[],R=document.getElementById("aipkit_google_tts_voices_json_main");R&&(R.dataset.voices=JSON.stringify(N));let j=D||document.querySelector('select[name="tts_google_voice_id"]')?.id||"";if(j&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let L=document.getElementById(j);window.aipkit_updateGoogleVoiceSelect(j,N,L&&L.value||"")}},S={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,GoogleTtsVoices:I,Azure:window.aipkit_updateAzureDeployments,DeepSeek:window.aipkit_updateDeepSeekModels,Ollama:window.aipkit_updateOllamaModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof S[m]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${m}.`),alert(`AIPKit Error: Cannot update UI for ${m}.`);return}let h="aipkit_settings_messages",M=y?!!u.closest(".aipkit_popover_options_list"):!1;!w&&!M&&document.getElementById(h)&&(window.aipkit_clearStatusMessages(h),window.aipkit_showSavingIndicator(h,!1));let b=y?u.querySelector(".aipkit_btn-text"):null,A=y?u.getAttribute("data-target-select"):f.targetSelectId||"",x=null;if(M){let D=u.closest(".aipkit_popover_flyout_body")?.closest(".aipkit-modal-content")?.querySelector(".aipkit_popover_flyout_header")||u.closest(".aipkit_popover_context_flyout")?.querySelector(".aipkit_popover_flyout_header")||u.closest(".aipkit_popover_flyout_header");if(D&&(x=D.querySelector(".aipkit_popover_status_inline")),!x){let N=u.closest(".aipkit_model_settings_popover");N&&(x=N.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline.aipkit_model_sync_status"))}if(!x){let N=u.closest(".aipkit_popover_option_row");N&&(x=N.querySelector(".aipkit_popover_status_inline"))}if(!x){let N=u.closest(".aipkit_model_settings_panel");N&&(x=N.querySelector(".aipkit_popover_status_inline.aipkit_model_sync_status"))}}else{let B=y?u.closest(".aipkit_chatbot_model_field"):null,D=y?u.closest(".aipkit_chatbot_builder"):null;D&&D.getAttribute("data-aipkit-chatbot-layout")==="next"&&(x=D.querySelector(".aipkit_builder_card_status .aipkit_model_sync_status")),x||(x=B?B.querySelector(".aipkit_model_sync_status"):null)}if(!x&&m){let B=document.querySelector(`.aipkit_chatbot_model_field[data-provider="${m}"]`);B&&(x=B.querySelector(".aipkit_model_sync_status"))}let v=(B,D,N)=>{if(!x)return;let R=x.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_save_status_container");R&&B&&(R.textContent="",R.className="aipkit_save_status_container"),x.textContent=B||"",x.classList.remove("success","error","loading"),D&&x.classList.add(D),N?x.setAttribute("title",N):x.removeAttribute("title"),x.classList.contains("aipkit_popover_status_inline")&&(x.style.display=B?"inline-block":"none")};v("Syncing\u2026","loading");let C=b?b.textContent:m.includes("ElevenLabs")||m.includes("Pinecone")||m.includes("Qdrant")||m.includes("Replicate")?"Sync Items":"Sync Models";b&&(b.textContent="");let P=null;return y&&(P=u.querySelector(".aipkit_spinner"),P||(P=document.createElement("span"),P.className="aipkit_spinner",u.appendChild(P)),P.style.display="inline-block",u.classList.add("aipkit_loading"),u.disabled=!0),(m==="GoogleTtsVoices"?window.aipkit_apiRequest("aipkit_sync_google_tts_voices"):window.aipkit_apiRequest("aipkit_sync_models",{provider:m})).then(B=>{let D=m==="GoogleTtsVoices"?B.voices:B.models;f.skipUpdate||(A?S[m](D,A):S[m](D)),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers(),(m==="PineconeIndexes"||m==="QdrantCollections")&&typeof window.aipkit_refreshTrainingSourcesCount=="function"&&window.aipkit_refreshTrainingSourcesCount(),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():w||console.warn("Model Sync Init: Cannot update autosave baseline.");let N="models";m==="ElevenLabs"||m==="GoogleTtsVoices"?N="voices":m==="ElevenLabsModels"?N="synthesis models":m==="PineconeIndexes"?N="indexes":m==="QdrantCollections"&&(N="collections"),!w&&!M&&document.getElementById(h)&&window.aipkit_showMessage(h,"success",`${m.replace(/Indexes|Collections|Models/,"")} ${N} synced!`),v("Saved","success"),x&&setTimeout(()=>v("",null),2500)}).catch(B=>{let D=B?.message||"Sync failed.";if(E&&!M&&document.getElementById(h)&&window.aipkit_showMessage(h,"error",`Sync failed: ${D}`),console.error(`AIPKit Sync Error (${m}):`,B),v(D,"error",D),x&&setTimeout(()=>v("",null),5e3),f.propagateError)throw B}).finally(()=>{if(y){u.disabled=!1,u.classList.remove("aipkit_loading");let B=u.querySelector(".aipkit_spinner");B&&(B.style.display="none"),b&&(b.textContent=C)}})}function o(u){if(!u)return;let m="data-sync-listener-attached";u.getAttribute(m)||(u.addEventListener("click",function(k){let f=k.target.closest(".aipkit_sync_btn");if(!f||f.disabled)return;k.preventDefault();let w=f.getAttribute("data-provider")||"";if(!w){let E=f.closest(".aipkit_chatbot_model_field");E&&E.getAttribute("data-provider")&&(w=E.getAttribute("data-provider"))}w?g(f,w):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",f)}),u.setAttribute(m,"true"))}function r(){o(document.getElementById("aipkit_module-container")),o(document.getElementById("aipkit_chatbot_main_tab_content_container"))}let n=[],e=!1;function i(u,m){if(!u||typeof u!="object")return"";let k=u[m];return k==null?"":String(k).trim()}function c(u,m,k){return k.some(f=>i(u,f)!==i(m,f))}function s(u){return i(u,"azure_api_key")!==""&&i(u,"azure_endpoint")!==""}function t(u,m){return[{provider:"OpenAI",keys:["openai_api_key"],ready:f=>i(f,"openai_api_key")!==""},{provider:"OpenRouter",keys:["openrouter_api_key"],ready:f=>i(f,"openrouter_api_key")!==""},{provider:"Google",keys:["google_api_key"],ready:f=>i(f,"google_api_key")!==""},{provider:"GoogleTtsVoices",keys:["google_api_key"],ready:f=>i(f,"google_api_key")!==""},{provider:"Azure",keys:["azure_api_key","azure_endpoint"],ready:f=>s(f)},{provider:"DeepSeek",keys:["deepseek_api_key"],ready:f=>i(f,"deepseek_api_key")!==""},{provider:"ElevenLabs",keys:["elevenlabs_api_key"],ready:f=>i(f,"elevenlabs_api_key")!==""},{provider:"ElevenLabsModels",keys:["elevenlabs_api_key"],ready:f=>i(f,"elevenlabs_api_key")!==""},{provider:"Replicate",keys:["replicate_api_key"],ready:f=>i(f,"replicate_api_key")!==""},{provider:"PineconeIndexes",keys:["pinecone_api_key"],ready:f=>i(f,"pinecone_api_key")!==""},{provider:"QdrantCollections",keys:["qdrant_url","qdrant_api_key"],ready:f=>i(f,"qdrant_url")!==""&&i(f,"qdrant_api_key")!==""}].filter(f=>c(u,m,f.keys)&&f.ready(m)).map(f=>f.provider)}function d(u){return u?document.querySelector(`.aipkit_sync_btn[data-provider="${u}"]`):null}let a=null;function l(){if(e)return;let u=n.shift();if(!u)return;e=!0;let{provider:m,options:k,resolve:f,reject:w}=u,E=d(m),y=g(E,m,k);a={provider:m,promise:y},y&&typeof y.finally=="function"?y.then(I=>{typeof f=="function"&&f(I)}).catch(I=>{typeof w=="function"&&w(I)}).finally(()=>{a=null,e=!1,l()}):(a=null,typeof f=="function"&&f(null),e=!1,l())}function p(u,m={}){if(!u)return null;if(a&&a.provider===u&&a.promise)return a.promise;if(n.some(y=>y.provider===u)){let y=n.find(I=>I.provider===u);return y&&y.promise?y.promise:null}let f,w,E=new Promise((y,I)=>{f=y,w=I});return n.push({provider:u,options:m,resolve:f,reject:w,promise:E}),l(),E}function _(u,m){if(!u||!m)return;t(u,m).forEach(f=>p(f,{silent:!0}))}window.aipkit_initSyncButtons=r,window.aipkit_syncModels=g,window.aipkit_queueProviderSync=p,window.aipkit_queueProviderAutoSync=_})();(function(){"use strict";let g=window.wp?.i18n?.__||function(S){return S},o="#aipkit_settings_container .aipkit_settings-form-row--provider-model select.aipkit_form-input",r=null,n=null,e=!1,i=S=>{if(!S)return"";let h=S.getAttribute("data-aipkit-picker-title");if(h)return h;let M=S.id&&document.querySelector(`label[for="${S.id}"]`)||S.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return M?M.textContent.trim():""},c=S=>{if(!S)return"";let h=S.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:S.querySelector("option[selected]");if(h)return h.textContent.trim();let M=S.querySelector("option");return M?M.textContent.trim():""},s=S=>S&&S.id==="aipkit_provider",t=S=>String(S||"").trim().toLowerCase(),d=(S,h)=>{if(!S)return;let M="aipkit_settings_select_picker_icon--";S.classList.forEach(A=>{A.startsWith(M)&&S.classList.remove(A)});let b=t(h);b&&S.classList.add(`${M}${b}`)},a=S=>({buttonId:`${S}_picker_btn`,labelId:`${S}_picker_label`,popoverId:`${S}_picker_popover`,titleId:`${S}_picker_title`,searchId:`${S}_picker_search`,listId:`${S}_picker_list`}),l=S=>{if(!S||!S.id)return null;let h=a(S.id),M=document.getElementById("aipkit_settings_container");if(!M)return null;let b=document.getElementById(h.buttonId),A=s(S)||!!S.closest(".aipkit_settings-form-col--model-select");if(!b){b=document.createElement("button"),b.type="button",b.id=h.buttonId,b.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",b.setAttribute("data-aipkit-popover-target",h.popoverId),b.setAttribute("aria-controls",h.popoverId),b.setAttribute("aria-expanded","false");let v=document.createElement("span");if(v.className="aipkit_settings_select_picker_label",v.id=h.labelId,v.textContent=c(S)||g("Select","gpt3-ai-content-generator"),s(S)){let P=document.createElement("span");P.className="aipkit_settings_select_picker_icon",P.setAttribute("aria-hidden","true"),d(P,S.value),b.classList.add("aipkit_settings_select_picker_btn--provider"),b.appendChild(P)}let C=document.createElement("span");C.className="dashicons dashicons-arrow-down-alt2",C.setAttribute("aria-hidden","true"),b.appendChild(v),b.appendChild(C),S.insertAdjacentElement("beforebegin",b)}if(s(S)){let v=b.querySelector(".aipkit_settings_select_picker_icon")||(()=>{let C=document.createElement("span");return C.className="aipkit_settings_select_picker_icon",C.setAttribute("aria-hidden","true"),b.classList.add("aipkit_settings_select_picker_btn--provider"),b.insertBefore(C,b.firstChild),C})();d(v,S.value)}A&&(b.dataset.aipkitPopoverPlacement="bottom"),S.classList.contains("screen-reader-text")||S.classList.add("screen-reader-text");let x=document.getElementById(h.popoverId);if(!x){x=document.createElement("div"),x.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",x.id=h.popoverId,x.setAttribute("aria-hidden","true");let v=document.createElement("div");v.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",v.setAttribute("role","dialog"),v.setAttribute("aria-labelledby",h.titleId);let C=document.createElement("div");C.className="aipkit_model_settings_popover_header";let P=document.createElement("span");P.className="aipkit_model_settings_popover_title",P.id=h.titleId,P.textContent=i(S)||g("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',C.appendChild(P),C.appendChild($);let U=document.createElement("div");U.className="aipkit_model_settings_popover_body";let B=document.createElement("div");B.className="aipkit_settings_select_picker_search";let D=document.createElement("input");D.type="search",D.id=h.searchId,D.className="aipkit_form-input";let N=i(S),R=N?`Search ${N.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");D.setAttribute("placeholder",R),B.appendChild(D);let j=document.createElement("div");j.className="aipkit_settings_select_picker_list",j.id=h.listId,j.setAttribute("role","listbox"),U.appendChild(B),U.appendChild(j),v.appendChild(C),v.appendChild(U),x.appendChild(v),M.appendChild(x),S.id==="aipkit_provider"&&(B.style.display="none")}return{ids:h,button:b,popover:x,label:document.getElementById(h.labelId),search:document.getElementById(h.searchId),list:document.getElementById(h.listId)}},p=S=>{let h=[];return S&&Array.from(S.children).forEach(b=>{if(b.tagName==="OPTGROUP"){let A=Array.from(b.children).filter(x=>x.tagName==="OPTION").map(x=>({value:x.value,label:x.textContent.trim(),disabled:x.disabled,selected:x.selected}));h.push({groupLabel:b.label||"",options:A})}else b.tagName==="OPTION"&&h.push({groupLabel:"",options:[{value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}]})}),h},_=(S,h,M="")=>{if(!S||!h)return;let b=M.trim().toLowerCase();h.innerHTML="";let A=p(S),x=!1;if(A.forEach(v=>{let C=v.options.filter(P=>b?P.label.toLowerCase().includes(b):!0);if(C.length){if(v.groupLabel){let P=document.createElement("div");P.className="aipkit_settings_select_picker_group_label",P.textContent=v.groupLabel,h.appendChild(P)}C.forEach(P=>{let $=document.createElement("button");$.type="button",$.className="aipkit_settings_select_picker_item",$.setAttribute("role","option"),$.dataset.value=P.value,$.dataset.label=P.label,P.disabled&&($.classList.add("is-disabled"),$.setAttribute("aria-disabled","true")),S.value===P.value?($.classList.add("is-active"),$.setAttribute("aria-selected","true")):$.setAttribute("aria-selected","false");let U=document.createElement("span");U.className="aipkit_settings_select_picker_text",U.textContent=P.label;let B=document.createElement("span");if(B.className="dashicons dashicons-yes aipkit_settings_select_picker_check",s(S)){$.classList.add("aipkit_settings_select_picker_item--provider");let D=document.createElement("span");D.className="aipkit_settings_select_picker_icon",D.setAttribute("aria-hidden","true"),d(D,P.value),$.appendChild(D)}$.appendChild(U),$.appendChild(B),h.appendChild($),x=!0})}}),!x){let v=document.createElement("div");v.className="aipkit_settings_select_picker_empty",v.textContent=g(b?"No matches found.":"No options available.","gpt3-ai-content-generator"),h.appendChild(v)}},u=(S,h)=>{if(!S||!h)return;let M=c(S);if(h.textContent=M||g("Select","gpt3-ai-content-generator"),s(S)){let b=h.closest("button"),A=b?b.querySelector(".aipkit_settings_select_picker_icon"):null;d(A,S.value)}},m=(S,h)=>{if(!S||!h)return;let M=S.getBoundingClientRect(),b=h.getBoundingClientRect(),A=b.width||320,x=b.height||0,v=window.innerWidth,C=window.innerHeight,P=12;if(S.dataset.aipkitPopoverPlacement==="bottom"){let B=M.left;B+A>v-P&&(B=M.right-A),B=Math.max(P,Math.min(B,v-A-P));let D=M.bottom+8;D+x>C-P&&(D=M.top-x-8),D=Math.max(P,Math.min(D,C-x-P)),h.style.left=`${Math.round(B)}px`,h.style.top=`${Math.round(D)}px`;return}let $=M.right+10;$+A>v-P&&($=M.left-A-10),$=Math.max(P,Math.min($,v-A-P));let U=M.top;U+x>C-P&&(U=C-x-P),U=Math.max(P,U),h.style.left=`${Math.round($)}px`,h.style.top=`${Math.round(U)}px`},k=()=>{!r||!n||e||(e=!0,window.requestAnimationFrame(()=>{let S=r.querySelector(".aipkit_model_settings_popover_panel");m(n,S),e=!1}))},f=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),r=null,n=null)},w=(S,h,M)=>{if(!S||!h)return;r&&r!==h&&f(),r=h,n=S,h.classList.add("aipkit-active"),h.setAttribute("aria-hidden","false"),S.setAttribute("aria-expanded","true");let b=h.querySelector(".aipkit_settings_select_picker_search input"),A=h.querySelector(".aipkit_settings_select_picker_list");A&&_(M,A,b?b.value:""),b&&b.offsetParent!==null&&(b.focus(),b.select());let x=h.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{m(S,x)})},E=(S,h)=>{if(!S||!h)return;let{button:M,popover:b,list:A,search:x}=h;if(M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("click",v=>{if(v.preventDefault(),r===b){f();return}w(M,b,S)}),M.dataset.pickerListenerAttached="true"),b&&b.dataset.overlayListenerAttached!=="true"){b.addEventListener("click",C=>{C.target===b&&f()});let v=b.querySelector(".aipkit_model_settings_popover_close");v&&v.addEventListener("click",C=>{C.preventDefault(),f()}),b.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",v=>{let C=v.target.closest(".aipkit_settings_select_picker_item");if(!C||C.classList.contains("is-disabled"))return;let P=C.dataset.value??"";S.value=P,S.dispatchEvent(new Event("change",{bubbles:!0})),u(S,h.label),_(S,A,x?x.value:""),f()}),A.dataset.pickerListenerAttached="true"),x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("input",()=>{_(S,A,x.value)}),x.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("change",()=>{u(S,h.label),_(S,A,x?x.value:"")}),S.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerObserverAttached!=="true"){let v=!1;new MutationObserver(()=>{v||(v=!0,window.requestAnimationFrame(()=>{u(S,h.label),_(S,A,x?x.value:""),v=!1}))}).observe(S,{childList:!0,subtree:!0}),S.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitSettingsPickerEscapeBound||(document.addEventListener("keydown",v=>{v.key==="Escape"&&r&&f()}),document.body.dataset.aipkitSettingsPickerEscapeBound="true"),document.body.dataset.aipkitSettingsPickerRepositionBound||(window.addEventListener("resize",k),window.addEventListener("scroll",k,!0),document.body.dataset.aipkitSettingsPickerRepositionBound="true")};function y(){let S=document.getElementById("aipkit_settings_container");if(!S)return;let h=S.querySelectorAll(o);h.length&&h.forEach(M=>{if(!M.id||M.dataset.aipkitPickerInit==="true")return;let b=l(M);b&&(u(M,b.label),_(M,b.list,b.search?b.search.value:""),E(M,b),M.dataset.aipkitPickerInit="true")})}function I(){let S=document.getElementById("aipkit_settings_container");if(!S)return;S.querySelectorAll(o).forEach(M=>{if(!M.id)return;let b=l(M);b&&(u(M,b.label),_(M,b.list,b.search?b.search.value:""),E(M,b),M.dataset.aipkitPickerInit="true")})}window.aipkit_initSettingsSelectPickers=y,window.aipkit_refreshSettingsSelectPickers=I})();(function(){"use strict";let g=!1,o=window.aipkit_escapeHtml||(k=>k||""),r={},n={},e=120,i="aipkit_content_writer_messages";function c(k,f){if(!k||typeof k!="string")return"";if(k.length<=f)return k;let w=k.substring(0,f-1);return w.substring(0,w.lastIndexOf(" ")).trim()+"\u2026"}function s(k){let f={"":n.use_default_position||"Default",default:n.use_default_position||"Default",replace:n.replace_selection||"Replace",after:n.insert_after||"After",before:n.insert_before||"Before"};return f[k]||f[""]}function t(k){let f=document.createElement("div");f.className="aipkit_assistant_action_card",f.dataset.actionId=k.id,f.dataset.label=k.label,f.dataset.prompt=k.prompt,f.dataset.insertPosition=k.insert_position||"";let w=o(k.prompt),E=c(w,e),y=w.length>e;return f.innerHTML=`
      <div class="aipkit_assistant_action_drag" draggable="true" title="Drag to reorder">
        <span class="dashicons dashicons-move" aria-hidden="true"></span>
      </div>
      <div class="aipkit_assistant_action_content">
        <div class="aipkit_assistant_action_label">${o(k.label)}</div>
        <div class="aipkit_assistant_action_prompt ${y?"":"aipkit_assistant_action_prompt--full"}">${y?E:w}</div>
        ${y?'<button type="button" class="aipkit-enhancer-prompt-toggle" style="background:none;border:none;padding:0;color:#2271b1;font-size:11px;cursor:pointer;text-decoration:underline;">Show more</button>':""}
      </div>
      <div class="aipkit_assistant_action_controls">
        <button type="button" class="aipkit_assistant_action_btn_small aipkit-enhancer-edit-action-btn" aria-label="${o(n.edit_action||"Edit")}">
          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
        </button>
        <button type="button" class="aipkit_assistant_action_btn_small aipkit_assistant_action_btn_small--danger aipkit-enhancer-delete-action-btn" aria-label="${o(n.delete_action||"Delete")}">
          <span class="dashicons dashicons-trash" aria-hidden="true"></span>
        </button>
      </div>
    `,f}function d(k,f=!1){let w=(k.insert_position||"").trim();return`
      <div class="aipkit_assistant_action_edit_form">
        <div class="aipkit_assistant_action_edit_row">
          <div>
            <label class="aipkit_assistant_action_edit_label">${o(n.action_label||"Label")}</label>
            <input type="text" class="aipkit-edit-label" value="${o(k.label)}" placeholder="${o(n.action_label||"Action name")}" maxlength="50">
          </div>
          <div>
            <label class="aipkit_assistant_action_edit_label">${o(n.insert_position||"Position")}</label>
            <select class="aipkit-edit-position">
              <option value="" ${w===""?"selected":""}>${o(n.use_default_position||"Use default")}</option>
              <option value="replace" ${w==="replace"?"selected":""}>${o(n.replace_selection||"Replace selection")}</option>
              <option value="after" ${w==="after"?"selected":""}>${o(n.insert_after||"Insert after")}</option>
              <option value="before" ${w==="before"?"selected":""}>${o(n.insert_before||"Insert before")}</option>
            </select>
          </div>
        </div>
        <div>
          <label class="aipkit_assistant_action_edit_label">${o(n.action_prompt||"Prompt")}</label>
          <textarea class="aipkit-edit-prompt" rows="3" placeholder="${o("Enter prompt. Use %s for selected text.")}">${o(k.prompt)}</textarea>
        </div>
        <div class="aipkit_assistant_action_edit_actions">
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--secondary aipkit-enhancer-cancel-action-btn">
            ${o(n.cancel||"Cancel")}
          </button>
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--primary aipkit-enhancer-save-action-btn">
            ${o(n.save||"Save")}
          </button>
        </div>
      </div>
    `}function a(k){let f={id:k.dataset.actionId,label:k.dataset.label,prompt:k.dataset.prompt,insert_position:k.dataset.insertPosition||""};k.classList.add("aipkit_assistant_action_card--editing"),k.innerHTML=d(f);let w=k.querySelector(".aipkit-edit-prompt");w&&(w.value=f.prompt);let E=k.querySelector(".aipkit-edit-label");E&&(E.focus(),E.select())}function l(k,f){k.dataset.actionId=f.id,k.dataset.label=f.label,k.dataset.prompt=f.prompt,k.dataset.insertPosition=f.insert_position||"",k.classList.remove("aipkit_assistant_action_card--editing");let w=t(f);k.innerHTML=w.innerHTML}function p(k){if(k.querySelectorAll(".aipkit_assistant_action_card").length>=10){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",n.max_actions_reached||"Maximum of 10 actions reached.");return}if(k.querySelector('[data-action-id^="new-"]'))return;let w=document.createElement("div");w.className="aipkit_assistant_action_card aipkit_assistant_action_card--editing",w.dataset.actionId=`new-${Date.now()}`,w.dataset.label="",w.dataset.prompt="",w.dataset.insertPosition="",w.innerHTML=d({id:w.dataset.actionId,label:"",prompt:"",insert_position:""},!0),k.prepend(w);let E=w.querySelector(".aipkit-edit-label");E&&E.focus()}async function _(k){if(g)return;let f=k.querySelector(".aipkit-edit-label"),w=k.querySelector(".aipkit-edit-prompt"),E=k.querySelector(".aipkit-edit-position");if(!f||!w)return;k.querySelectorAll(".aipkit_form-help-error").forEach(A=>A.remove()),f.style.borderColor="",w.style.borderColor="";let y=f.value.trim(),I=w.value.trim(),S=E?E.value:"",h=k.dataset.actionId,M=!1;if(!y){f.style.borderColor="#dc2626";let A=document.createElement("div");A.className="aipkit_form-help aipkit_form-help-error",A.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",A.textContent=n.label_required||"Label is required",f.parentNode.appendChild(A),M=!0}if(!I){w.style.borderColor="#dc2626";let A=document.createElement("div");A.className="aipkit_form-help aipkit_form-help-error",A.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",A.textContent=n.prompt_required||"Prompt is required",w.parentNode.appendChild(A),M=!0}if(M)return;g=!0;let b=k.querySelector(".aipkit-enhancer-save-action-btn");b&&(b.textContent=n.saving_action||"Saving...",b.disabled=!0);try{let A=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:h,label:y,prompt:I,insert_position:S,_ajax_nonce:r.nonce_manage_actions});l(k,A.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"success",n.action_saved||"Action saved successfully")}catch(A){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",`${n.error||"Error"}: ${A.message}`),b&&(b.textContent=n.save||"Save",b.disabled=!1)}finally{g=!1}}async function u(k){let f=k.querySelector("#aipkit_enhancer_actions_list");f.innerHTML=`
      <div class="aipkit_assistant_loading" style="text-align:center;padding:24px;color:#64748b;">
        <span class="dashicons dashicons-update" style="animation:spin 1s linear infinite;"></span>
        <span style="margin-left:8px;">${o(n.loading_actions||"Loading actions...")}</span>
      </div>
    `;try{let w=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions});f.innerHTML="";let E=w.actions||[];E.length===0?f.innerHTML=`
          <div class="aipkit_assistant_empty_state">
            <div class="aipkit_assistant_empty_state_icon">
              <span class="dashicons dashicons-edit-large" aria-hidden="true"></span>
            </div>
            <div class="aipkit_assistant_empty_state_text">
              ${o(n.no_actions||'No actions yet. Click "Add Action" to create one.')}
            </div>
          </div>
        `:E.forEach(y=>{f.appendChild(t(y))})}catch(w){f.innerHTML="",typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",w.message||n.loading_failed||"Failed to load actions.")}}function m(){let k=document.getElementById("aipkit_enhancer_actions_container");if(!k)return;let f=k.closest(".aipkit_assistant_settings_redesigned")||k;if(f.dataset.listenerAttached==="true")return;f.dataset.listenerAttached="true",k.dataset.listenerAttached="true";let w=k.closest(".aipkit_assistant_settings_redesigned")||f;r=window.aipkit_post_enhancer||{},n=r.text||{};let E=k.querySelector("#aipkit_enhancer_actions_list");if(!E)return;let y=w.querySelectorAll(".aipkit_assistant_position_option"),I=()=>{y.forEach(b=>{let A=b.querySelector("input[type=radio]");b.classList.toggle("aipkit_assistant_position_option--active",!!(A&&A.checked))})};I(),y.forEach(b=>{let A=b.querySelector("input[type=radio]");A&&A.addEventListener("change",I)});let S=null,h=null,M=async()=>{if(g)return;let b=Array.from(E.querySelectorAll(".aipkit_assistant_action_card")).map(C=>C.dataset.actionId).filter(C=>C&&!C.startsWith("new-"));if(!b.length)return;let A=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,x=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,v=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;g=!0,A&&A(n.saving_order||"Saving order...");try{await window.aipkit_apiRequest("aipkit_reorder_enhancer_actions",{order:b,_ajax_nonce:r.nonce_manage_actions}),x&&x(n.order_saved||"Order saved.")}catch(C){v?v(`${n.error||"Error"}: ${C.message}`):typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",`${n.error||"Error"}: ${C.message}`)}finally{g=!1}};E.addEventListener("dragstart",b=>{let A=b.target.closest(".aipkit_assistant_action_drag");if(!A)return;let x=A.closest(".aipkit_assistant_action_card");if(!x||x.classList.contains("aipkit_assistant_action_card--editing")){b.preventDefault();return}S=x,x.classList.add("aipkit_dragging");try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",x.dataset.actionId||"")}catch{}}),E.addEventListener("dragend",async()=>{S&&S.classList.remove("aipkit_dragging"),S=null,h=null,await M()}),E.addEventListener("dragover",b=>{if(!S)return;let A=b.target.closest(".aipkit_assistant_action_card");if(!A||A===S)return;b.preventDefault();let x=A.getBoundingClientRect(),C=b.clientY<x.top+x.height/2?A:A.nextSibling;(h!==A||S.nextSibling!==C)&&(E.insertBefore(S,C),h=A)}),E.addEventListener("drop",async b=>{S&&(b.preventDefault(),await M())}),f.addEventListener("click",async b=>{let A=b.target.closest(".aipkit-enhancer-add-new-btn"),x=b.target.closest(".aipkit-enhancer-reset-actions-btn"),v=b.target.closest(".aipkit-enhancer-edit-action-btn"),C=b.target.closest(".aipkit-enhancer-delete-action-btn"),P=b.target.closest(".aipkit-enhancer-save-action-btn"),$=b.target.closest(".aipkit-enhancer-cancel-action-btn"),U=b.target.closest(".aipkit-enhancer-prompt-toggle");if(A)p(E);else if(x){if(!confirm(n.confirm_reset_actions||"Reset all actions to defaults? This cannot be undone."))return;try{await window.aipkit_apiRequest("aipkit_reset_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions}),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"success",n.actions_reset||"Actions reset to defaults."),u(k)}catch(B){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",`${n.error||"Error"}: ${B.message}`)}}else if(U){let B=U.closest(".aipkit_assistant_action_card"),D=B.querySelector(".aipkit_assistant_action_prompt"),N=B.dataset.prompt;U.textContent.toLowerCase().includes("more")?(D.textContent=o(N),D.classList.add("aipkit_assistant_action_prompt--full"),U.textContent="Show less"):(D.textContent=c(o(N),e),D.classList.remove("aipkit_assistant_action_prompt--full"),U.textContent="Show more")}else if(v)a(v.closest(".aipkit_assistant_action_card"));else if(P)await _(P.closest(".aipkit_assistant_action_card"));else if($){let B=$.closest(".aipkit_assistant_action_card");B.dataset.actionId.startsWith("new-")?B.remove():l(B,{id:B.dataset.actionId,label:B.dataset.label,prompt:B.dataset.prompt,insert_position:B.dataset.insertPosition})}else if(C){if(g)return;let B=C.closest(".aipkit_assistant_action_card"),D=B.dataset.actionId;if(!confirm(n.confirm_delete_action||"Delete this action? This cannot be undone."))return;g=!0,C.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:D,_ajax_nonce:r.nonce_manage_actions}),B.style.transition="opacity 0.2s, transform 0.2s",B.style.opacity="0",B.style.transform="translateX(-10px)",setTimeout(()=>B.remove(),200),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"success",n.action_deleted||"Action deleted.")}catch(N){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(i,"error",`${n.error||"Error"}: ${N.message}`),C.disabled=!1}finally{g=!1}}}),f.addEventListener("keydown",b=>{if(b.key==="Enter"&&b.target.matches("input[type=text]")){b.preventDefault();let A=b.target.closest(".aipkit_assistant_action_card--editing");A&&_(A)}}),window.aipkit_enhancer_reload_actions=()=>u(k),u(k)}window.aipkit_initEnhancerActionsUI=m})();(function(){"use strict";let g=[],o=[];function r(i){let c=document.getElementById("aipkit_semantic_search_target_id");if(!c)return;let s=c.value;c.innerHTML='<option value="">-- Select --</option>';let t=[];i==="pinecone"?t=g:i==="qdrant"&&(t=o),Array.isArray(t)&&t.forEach(d=>{let a=d.name||d.id||(typeof d=="string"?d:null);if(a){let l=document.createElement("option");l.value=a,l.textContent=a,c.appendChild(l)}}),c.querySelector(`option[value="${CSS.escape(s)}"]`)&&(c.value=s)}function n(i){let c=document.getElementById("aipkit_semantic_search_embedding_provider");if(!c||!i)return;let s=i.options[i.selectedIndex];s&&s.dataset.provider&&(c.value=s.dataset.provider)}function e(){let i=document.getElementById("aipkit_settings_container");if(!i)return;let c="data-semantic-search-listener-attached";if(i.getAttribute(c))return;let s=document.getElementById("aipkit_semantic_search_vector_provider"),t=document.getElementById("aipkit_pinecone_indexes_json_main"),d=document.getElementById("aipkit_qdrant_collections_json_main"),a=document.getElementById("aipkit_semantic_search_embedding_model");if(s){if(t&&t.dataset.indexes)try{g=JSON.parse(t.dataset.indexes)||[]}catch(l){console.error("Error parsing Pinecone indexes JSON:",l)}if(d&&d.dataset.collections)try{o=JSON.parse(d.dataset.collections)||[]}catch(l){console.error("Error parsing Qdrant collections JSON:",l)}s&&(s.addEventListener("change",l=>{if(r(l.target.value),typeof window.aipkit_handleAutoSave=="function"){let p=document.getElementById("aipkit_semantic_search_target_id");p&&(p.value=""),window.aipkit_handleAutoSave()}}),r(s.value)),a&&(a.addEventListener("change",l=>{n(l.target)}),n(a)),i.setAttribute(c,"true")}}window.aipkit_initSemanticSearchUI=e})();(function(){"use strict";function g(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let n=r.querySelector("#aipkit_provider");if(!n)return;let e=n.value,i=e.toLowerCase(),c=r.querySelectorAll(".aipkit_api_key_field"),s=r.querySelectorAll(".aipkit_model_field"),t=r.querySelectorAll(".aipkit_advanced_settings_provider"),d=r.querySelector("#aipkit_safety_settings_accordion"),a=r.querySelector(".aipkit_openai_store_field"),l=r.querySelectorAll(".aipkit_param_not_openai");c.forEach(m=>m.style.display="none"),s.forEach(m=>m.style.display="none"),t.forEach(m=>m.style.display="none"),d&&(d.style.display="none"),a&&(a.style.display="none"),r.querySelectorAll(`.aipkit_api_key_field[data-provider="${e}"]`).forEach(m=>m.style.display="block"),r.querySelectorAll(`.aipkit_model_field[data-provider="${e}"]`).forEach(m=>m.style.display="block");let u=r.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${e}"]`);u&&(u.style.display="block"),e==="Google"?d&&(d.style.display="block"):e==="OpenAI"&&a&&(a.style.display="block"),e==="OpenAI"||e==="Google"?l.forEach(m=>m.style.display="none"):l.forEach(m=>m.style.display="block"),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function o(){let r=document.getElementById("aipkit_provider");if(r){let n="data-provider-listener-attached";if(r.getAttribute(n)==="true")return;r.addEventListener("change",function(){g(),typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found.")}),r.setAttribute(n,"true"),g()}}window.aipkit_toggleProviderFields=g,window.aipkit_initProviderSelectListener=o})();(function(){"use strict";function g(t){let d=t?t.dataset:{};return{notSet:d.textNotSet||"Not set",notSelected:d.textNotSelected||"Not selected",statusSet:d.textSet||"Set",statusMissing:d.textMissing||"Missing",statusIncomplete:d.textIncomplete||"Incomplete",labelApiKey:d.labelApiKey||"API Key",labelApiKeyEndpoint:d.labelApiKeyEndpoint||"API Key & Endpoint",labelBaseUrl:d.labelBaseUrl||"Base URL"}}function o(t,d){let a=t.querySelector(d);return a?String(a.value||"").trim():""}function r(t,d){return d?t.querySelector(`.aipkit_model_field[data-provider="${d}"] select`):null}function n(t,d){if(!t)return d.notSelected;let a=String(t.value||"").trim();if(!a)return d.notSelected;let l=t.selectedOptions&&t.selectedOptions[0]?t.selectedOptions[0]:null;return(l?String(l.textContent||"").trim():a)||d.notSelected}function e(){let t=document.getElementById("aipkit_settings_container");if(!t)return;let d=t.querySelector("#aipkit_settings_summary_card");if(!d)return;let a=g(d),l=t.querySelector("#aipkit_provider"),p=l?l.value:"",_=l&&l.selectedOptions&&l.selectedOptions[0]?String(l.selectedOptions[0].textContent||"").trim():"",u=d.querySelector('[data-aipkit-summary="provider"]');u&&(u.textContent=_||a.notSet);let m=d.querySelector('[data-aipkit-summary="model"]');if(m){let I=r(t,p);m.textContent=n(I,a)}let k=d.querySelector('[data-aipkit-summary-label="connection"]'),f=d.querySelector('[data-aipkit-summary="connection-status"]'),w=a.labelApiKey,E=a.statusMissing,y="aipkit_status-warning";if(p==="Azure"){w=a.labelApiKeyEndpoint;let I=o(t,"#aipkit_azure_api_key"),S=o(t,"#aipkit_azure_endpoint");I&&S?(E=a.statusSet,y="aipkit_status-success"):E=a.statusIncomplete}else if(p==="Ollama")w=a.labelBaseUrl,o(t,"#aipkit_ollama_base_url")&&(E=a.statusSet,y="aipkit_status-success");else if(p){let S={OpenAI:"#aipkit_openai_api_key",OpenRouter:"#aipkit_openrouter_api_key",Google:"#aipkit_google_api_key",DeepSeek:"#aipkit_deepseek_api_key"}[p];S&&o(t,S)&&(E=a.statusSet,y="aipkit_status-success")}k&&(k.textContent=w),f&&(f.textContent=E,f.classList.remove("aipkit_status-success","aipkit_status-warning","aipkit_status-info"),f.classList.add(y))}function i(){let t=document.getElementById("aipkit_settings_container");if(!t||!t.querySelector("#aipkit_settings_summary_card"))return;let a="data-summary-listener-attached";if(t.getAttribute(a)!=="true"){let l="#aipkit_provider, .aipkit_model_field select, .aipkit_api_key_field input",p=_=>{_.target.matches(l)&&e()};t.addEventListener("change",p),t.addEventListener("input",p),t.setAttribute(a,"true")}e()}function c(){let t=document.getElementById("aipkit_settings_container");if(!t)return;let d=t.querySelector("#aipkit_settings_advanced_popover");if(!d)return;let a=t.querySelectorAll(".aipkit_settings_advanced_btn");if(!a.length)return;let l=d.querySelector(".aipkit_model_settings_popover_panel"),p=d.querySelector(".aipkit_model_settings_popover_close"),_=null,u=!1,m=y=>{if(!l||!y)return;let I=y.getBoundingClientRect(),S=l.getBoundingClientRect(),h=S.width||400,M=S.height||0,b=window.innerWidth,A=window.innerHeight,x=12,v=I.right+10;v+h>b-x&&(v=I.left-h-10),v=Math.max(x,Math.min(v,b-h-x));let C=I.top;C+M>A-x&&(C=A-M-x),C=Math.max(x,C),l.style.left=`${Math.round(v)}px`,l.style.top=`${Math.round(C)}px`},k=()=>{!_||!d.classList.contains("aipkit-active")||u||(u=!0,window.requestAnimationFrame(()=>{m(_),u=!1}))},f=y=>{y&&(_=y,d.classList.add("aipkit-active"),d.setAttribute("aria-hidden","false"),a.forEach(I=>{I.setAttribute("aria-expanded",I===y?"true":"false")}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_advanced_popover"),window.requestAnimationFrame(()=>{m(y)}))},w=()=>{d.classList.remove("aipkit-active"),d.setAttribute("aria-hidden","true"),a.forEach(y=>{y.setAttribute("aria-expanded","false")}),_=null},E=y=>{y&&y.preventDefault();let I=y?y.currentTarget:null;if(d.classList.contains("aipkit-active")&&_===I){w();return}f(I)};a.forEach(y=>{y.dataset.popoverListenerAttached!=="true"&&(y.addEventListener("click",E),y.dataset.popoverListenerAttached="true")}),p&&p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",w),p.dataset.popoverListenerAttached="true"),d.dataset.overlayListenerAttached!=="true"&&(d.addEventListener("click",y=>{y.target===d&&w()}),d.dataset.overlayListenerAttached="true"),d.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",y=>{y.key==="Escape"&&d.classList.contains("aipkit-active")&&w()}),d.dataset.escapeListenerAttached="true"),d.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",k),window.addEventListener("scroll",k,!0),d.dataset.repositionListenersAttached="true")}function s(){typeof window.aipkit_initMessageCloseButtons=="function"?window.aipkit_initMessageCloseButtons("aipkit_settings_messages"):console.error("Settings Init: aipkit_initMessageCloseButtons not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),typeof window.aipkit_initSettingsSelectPickers=="function"?window.aipkit_initSettingsSelectPickers():console.error("Settings Init: aipkit_initSettingsSelectPickers not found."),c(),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(d=>{d.dataset.accordionListenerAttached!=="true"&&(d.addEventListener("click",function(){let a=this.nextElementSibling;if(a){this.classList.toggle("aipkit_active"),a.classList.toggle("aipkit_active");let l=this.closest(".aipkit_accordion");l?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(l.style.display="block")}}),d.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found."),typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found."),i()}window.aipkit_initSettings=s,window.aipkit_updateSettingsSummary=e,window.aipkit_initSettingsSummary=i})();(function(){"use strict";let g=!1;function o(){let r=document.getElementById("aipkit_role_manager_container");if(!r){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let n=r.querySelector("#aipkit_save_roles_btn"),e=r.querySelector("#aipkit_role_manager_form"),i=r.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),i&&(i.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let c=window.aipkit_role_manager_config,s=c.text||{};if(!n||!e||!i){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let t="data-role-save-listener";n.getAttribute(t)||(n.addEventListener("click",function(d){if(d.preventDefault(),g)return;g=!0;let a=n.querySelector(".aipkit_btn-text"),l=n.querySelector(".aipkit_spinner");n.disabled=!0,l&&(l.style.display="inline-block"),a&&(a.textContent=s.saving||"Saving..."),i.innerHTML="",i.className="aipkit_settings_messages";let p=new FormData(e);p.append("action","aipkit_save_role_permissions"),fetch(c.ajaxurl,{method:"POST",body:p,credentials:"same-origin"}).then(_=>_.ok?_.json():_.json().then(u=>{throw new Error(u.data.message||`HTTP error! status: ${_.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${_.status}`)})).then(_=>{if(!_.success){let u=_.data&&_.data.message?_.data.message:"An unknown error occurred.";throw new Error(u)}return _.data}).then(_=>{let u=document.createElement("div");u.className="aipkit_settings_message aipkit_settings_message-success",u.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${_.message||s.success||"Permissions saved!"}`,i.appendChild(u),setTimeout(()=>{u.remove()},4e3)}).catch(_=>{console.error("AIPKit Role Manager Save Error:",_);let u=document.createElement("div");u.className="aipkit_settings_message aipkit_settings_message-error",u.innerHTML=`<span class="dashicons dashicons-warning"></span> ${_.message||s.fail||"Failed to save permissions."}`,i.appendChild(u),setTimeout(()=>{u.remove()},6e3)}).finally(()=>{g=!1,n.disabled=!1,l&&(l.style.display="none"),a&&(a.textContent=s.saveButton||"Save Permissions")})}),n.setAttribute(t,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&o()}),window.aipkit_initRoleManager=o})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}o.addEventListener("change",function(n){let e=n.target,i=e.closest(".aipkit_chatbot-settings-area");if(!i)return;if(e.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(i),window.aipkit_toggleOpenAISpecificSettingsVisibility(i),window.aipkit_toggleGoogleSpecificSettingsVisibility(i);return}if(e.matches('select[name$="_model"]')||e.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(i);return}let c=e.closest(".aipkit_stt_provider_select");if(c){let u=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u?window.aipkit_toggleSttModelFields(u):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",c);return}let s=e.closest(".aipkit_vector_store_toggle_switch");if(s){let u=s.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");if(u){window.aipkit_toggleVectorStoreSettingsVisibility(u),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(u);let m=u.querySelector('.aipkit_feature_config_btn[data-feature="vector_store"]');m&&(m.disabled=!s.checked,m.title=s.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let t=e.closest(".aipkit_vector_store_provider_select");if(t){let u=t.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_toggleVectorStoreProviderFields(u);return}let d=e.closest(".aipkit_vector_embedding_provider_select");if(d){let u=d.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_populateVectorEmbeddingModelSelect(u);return}let a=e.closest(".aipkit_openai_web_search_enable_toggle");if(a){let u=a.closest(".aipkit_chatbot-settings-area");if(u){window.aipkit_toggleOpenAIWebSearchSubSettings(u);let m=u.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');m&&(m.disabled=!a.checked)}return}let l=e.closest(".aipkit_openai_web_search_loc_type_select");if(l){let u=l.closest(".aipkit_chatbot-settings-area");u&&window.aipkit_toggleOpenAIWebSearchLocationDetails(u);return}let p=e.closest(".aipkit_google_search_grounding_enable_toggle");if(p){let u=p.closest(".aipkit_chatbot-settings-area");if(u){window.aipkit_toggleGoogleSearchGroundingSubSettings(u);let m=u.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');m&&(m.disabled=!p.checked)}return}let _=e.closest(".aipkit_google_grounding_mode_select");if(_){let u=_.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_toggleGoogleGroundingDynamicThreshold(u);return}}),o.querySelectorAll(".aipkit_chatbot-settings-area").forEach(n=>{n.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(n),window.aipkit_toggleOpenAISpecificSettingsVisibility(n),window.aipkit_toggleGoogleSpecificSettingsVisibility(n)),n.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(n),n.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(n),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(n));let e=n.querySelector(".aipkit_openai_web_search_enable_toggle"),i=n.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');i&&e&&(i.disabled=!e.checked,i.title=e.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure");let c=n.querySelector(".aipkit_google_search_grounding_enable_toggle"),s=n.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');s&&c&&(s.disabled=!c.checked,s.title=c.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")})}window.aipkit_initProviderSelectToggles=g})();(function(){"use strict";function g(o){if(!o){console.warn("AIPKit Chat Fields: No settings area provided to toggle model fields.");return}let r=o.querySelector(".aipkit_chatbot_provider_select");if(!r){console.warn("AIPKit Chat Fields: Provider select not found in the given settings area.");return}let n=r.value,e=["OpenAI","OpenRouter","Google","Azure","DeepSeek","Ollama"];o.querySelectorAll(".aipkit_chatbot_model_field").forEach(s=>{s.style.display="none";let t=s.querySelector(".aipkit_cb_web_search_toggle");t&&(t.style.display="none");let d=s.querySelector(".aipkit_cb_stateful_conv_toggle");d&&(d.style.display="none");let a=s.querySelector(".aipkit_cb_image_upload_toggle");a&&(a.style.display="none");let l=s.querySelector(".aipkit_cb_voice_input_toggle");l&&(l.style.display="none")});let c=o.querySelector(`.aipkit_chatbot_model_field[data-provider="${n}"]`);if(c){c.style.display="block";let s=o.querySelector("#aipkit_chatbot_global_save_status_container");if(s){let _=c.querySelector(".aipkit_model_status_slot");_&&!_.contains(s)&&_.appendChild(s)}o.querySelectorAll(".aipkit_feature_toggle_item").forEach(_=>{let u=(_.dataset.providers||"").trim();if(!u||u==="*"){_.style.display="";return}let m=u.split(/\s+/);_.style.display=m.includes(n)?"":"none"}),typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(o),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(o);let d=c.querySelector(".aipkit_cb_web_search_toggle");d&&(d.dataset.provider||"").split(" ").includes(n)&&(d.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(o));let a=c.querySelector(".aipkit_cb_stateful_conv_toggle");a&&n==="OpenAI"&&(a.style.display="inline-flex");let l=c.querySelector(".aipkit_cb_image_upload_toggle");l&&(n==="OpenAI"?(l.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(o)):l.style.display="none");let p=c.querySelector(".aipkit_cb_voice_input_toggle");p&&(p.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(o)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(o)}}window.aipkit_toggleChatbotModelFields=g})();(function(){"use strict";function g(o){o&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(o)}window.aipkit_toggleOpenAISpecificSettingsVisibility=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let n=r?.value==="OpenAI",e=o.querySelector(".aipkit_openai_web_search_enable_toggle");e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let i=o.querySelector(".aipkit_openai_web_search_conditional_settings");if(!e||!i)return;let c=e.tagName==="SELECT"?e.value==="1":e.checked;if(i.style.display=n&&c?"block":"none",n&&c)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(o);else{let s=o.querySelector(".aipkit_openai_web_search_location_details");s&&(s.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector(".aipkit_openai_web_search_enable_toggle");r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let n=o.querySelector(".aipkit_openai_web_search_loc_type_select"),e=o.querySelector(".aipkit_openai_web_search_location_details");if(!n||!e){e&&(e.style.display="none");return}let i=r?r.tagName==="SELECT"?r.value==="1":r.checked:!1,c=(n.value||"")==="approximate";e.style.display=i&&c?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=g})();(function(){"use strict";function g(o){o&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(o)}window.aipkit_toggleGoogleSpecificSettingsVisibility=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let n=r?.value==="Google",e=o.querySelector(".aipkit_google_search_grounding_enable_toggle");e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let i=o.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!e||!i)return;let c=e.tagName==="SELECT"?e.value==="1":e.checked,s=n&&c;i.style.display=s?"block":"none",s?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(o):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(o,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=g})();(function(){"use strict";function g(o,r=null){if(!o)return;let n=o.querySelector(".aipkit_google_grounding_mode_select"),e=o.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),i=o.querySelector(".aipkit_google_search_grounding_enable_toggle");i||(i=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),i||(i=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let c=o.querySelector(".aipkit_google_search_grounding_conditional_settings"),s=c&&c.style.display==="none";if(!n||!e||!i){e&&(e.style.display="none");return}if(s){e.style.display="none";return}let t=r!==null?r:(i.tagName==="SELECT"?i.value==="1":i.checked)&&n.value==="MODE_DYNAMIC";e.style.display=t?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector(".aipkit_stt_provider_select");if(!r)return;let n=r.value;o.querySelectorAll(".aipkit_stt_model_field").forEach(i=>{i.style.display=i.getAttribute("data-stt-provider")===n?"block":"none"})}window.aipkit_toggleSttModelFields=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_toggle_switch");r||(r=o.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let n=o.querySelector(".aipkit_vector_store_settings_conditional_row"),e=o.querySelector(".aipkit_vector_store_top_k_field"),i=o.querySelector(".aipkit_vector_store_confidence_field");if(!r||!n)return;let c=r.tagName==="SELECT"?r.value==="1":r.checked;n.style.display=c?"block":"none",e&&(e.style.display=c?"block":"none"),i&&(i.style.display=c?"block":"none"),c?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(o):o.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_pinecone_key_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_qdrant_url_field, .aipkit_vector_store_qdrant_key_field, .aipkit_vector_store_embedding_config_row").forEach(s=>s.style.display="none")}window.aipkit_toggleVectorStoreSettingsVisibility=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_provider_select"),n=o.querySelector(".aipkit_vector_store_toggle_switch");if(n||(n=o.querySelector(".aipkit_vector_store_enable_select")),n||(n=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select")),!r||!n)return;let e=r.value,i=n.tagName==="SELECT"?n.value==="1":n.checked,c=o.querySelector(".aipkit_vector_store_openai_field"),s=o.querySelector(".aipkit_vector_store_pinecone_field"),t=o.querySelector(".aipkit_vector_store_pinecone_key_field"),d=o.querySelector(".aipkit_vector_store_qdrant_field"),a=o.querySelector(".aipkit_vector_store_qdrant_url_field"),l=o.querySelector(".aipkit_vector_store_qdrant_key_field"),p=o.querySelector(".aipkit_vector_store_embedding_config_row"),_=o.querySelector(".aipkit_vector_store_top_k_field");c&&(c.style.display=i&&e==="openai"?"block":"none"),s&&(s.style.display=i&&e==="pinecone"?"block":"none"),t&&(t.style.display=i&&e==="pinecone"?"block":"none"),d&&(d.style.display=i&&e==="qdrant"?"block":"none"),a&&(a.style.display=i&&e==="qdrant"?"block":"none"),l&&(l.style.display=i&&e==="qdrant"?"block":"none"),p&&(p.style.display=i&&(e==="pinecone"||e==="qdrant")?"block":"none"),_&&(_.style.display=i?"block":"none"),i&&e==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(o):i&&(e==="pinecone"||e==="qdrant")&&(e==="pinecone"&&typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(o),e==="qdrant"&&typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"&&window.aipkit_populateQdrantCollectionsMultiSelect(o),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(o),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(o))}window.aipkit_toggleVectorStoreProviderFields=g})();(function(){"use strict";function g(o){let r=o.querySelector('select[name="openai_vector_store_ids[]"]'),n=window.aipkit_escapeHtml||function(w){return w};if(!r)return;let e=o.querySelector("[data-aipkit-vector-stores-dropdown]"),i=e?e.querySelector(".aipkit_popover_multiselect_btn"):null,c=e?e.querySelector(".aipkit_popover_multiselect_label"):null,s=e?e.querySelector(".aipkit_popover_multiselect_panel"):null,t=e?e.querySelector(".aipkit_popover_multiselect_options"):null,d=e?.dataset.placeholder||"Select stores",a=e?.dataset.selectedLabel||"selected",l=window.aipkit_chat_config?.openaiVectorStores||[],p=Array.from(r.options).filter(w=>w.selected).map(w=>w.value);if(r.innerHTML="",l.length>0){let w=1;l.forEach(E=>{if(E&&E.id){let y="(Files: N/A)";E.file_counts&&typeof E.file_counts.total=="number"?y=`(${E.file_counts.total} ${E.file_counts.total===1?"File":"Files"})`:E.file_counts&&(y="(Files: ?)");let I=E.name||`Untitled store ${w}`,S=`${n(I)} ${y}`,h=document.createElement("option");h.value=E.id,h.textContent=S,p.includes(E.id)&&(h.selected=!0),r.appendChild(h),w+=1}})}let _=1;p.forEach(w=>{if(!l.some(y=>y.id===w)&&!r.querySelector(`option[value="${CSS.escape(w)}"]`)){let y=document.createElement("option");y.value=w,y.textContent=`Manual store ${_} (not synced)`,y.selected=!0,r.appendChild(y),_+=1}}),r.options.length===0&&(r.innerHTML='<option value="" disabled>-- No Stores Found (Sync in AI Training) --</option>');let u=()=>{if(!c)return;let w=Array.from(r.options).filter(y=>y.selected&&y.value);if(!w.length){c.textContent=d;return}let E=w.map(y=>y.textContent.trim()).filter(Boolean);if(E.length<=2){c.textContent=E.join(", ");return}c.textContent=`${E.length} ${a}`},m=()=>{if(!t)return;let w=Array.from(t.querySelectorAll('input[type="checkbox"]:checked'));if(w.length>2){let y=w[w.length-1];y&&(y.checked=!1)}let E=Array.from(t.querySelectorAll('input[type="checkbox"]:checked')).map(y=>y.value);Array.from(r.options).forEach(y=>{y.selected=E.includes(y.value)}),r.dispatchEvent(new Event("change",{bubbles:!0})),u()},k=()=>{if(!t)return;t.innerHTML="";let w=Array.from(r.options),E=w.filter(y=>y.value);if(!E.length){let y=document.createElement("div");y.className="aipkit_popover_multiselect_empty",y.textContent=w[0]?.textContent||"-- No Stores Found --",t.appendChild(y),u();return}E.forEach(y=>{let I=document.createElement("label");I.className="aipkit_popover_multiselect_item";let S=document.createElement("input");S.type="checkbox",S.value=y.value,S.checked=y.selected,S.disabled=y.disabled;let h=document.createElement("span");h.className="aipkit_popover_multiselect_text",h.textContent=y.textContent,I.appendChild(S),I.appendChild(h),t.appendChild(I)}),u()},f=w=>{!e||!i||(e.classList.toggle("is-open",w),i.setAttribute("aria-expanded",w?"true":"false"),s&&(s.hidden=!w))};e&&i&&!e.dataset.listenerAttached&&(i.addEventListener("click",w=>{w.preventDefault(),f(!e.classList.contains("is-open"))}),document.addEventListener("click",w=>{e.classList.contains("is-open")&&(e.contains(w.target)||f(!1))}),i.addEventListener("keydown",w=>{w.key==="Escape"&&f(!1)}),e.dataset.listenerAttached="true"),t&&!t.dataset.listenerAttached&&(t.addEventListener("change",m),t.dataset.listenerAttached="true"),k()}window.aipkit_populateOpenAIVectorStoresMultiSelect=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector('select[name="qdrant_collection_names[]"]');if(!r)return;let n=o.querySelector("[data-aipkit-qdrant-collections-dropdown]"),e=n?n.querySelector(".aipkit_popover_multiselect_btn"):null,i=n?n.querySelector(".aipkit_popover_multiselect_label"):null,c=n?n.querySelector(".aipkit_popover_multiselect_panel"):null,s=n?n.querySelector(".aipkit_popover_multiselect_options"):null;if(!n||!s)return;let t=n.dataset.placeholder||"Select collections",d=n.dataset.selectedLabel||"selected",a=()=>{if(!i)return;let u=Array.from(r.options).filter(k=>k.selected&&k.value);if(!u.length){i.textContent=t;return}let m=u.map(k=>k.textContent.trim()).filter(Boolean);if(m.length<=2){i.textContent=m.join(", ");return}i.textContent=`${m.length} ${d}`},l=()=>{let u=Array.from(s.querySelectorAll('input[type="checkbox"]:checked')).map(m=>m.value);Array.from(r.options).forEach(m=>{m.selected=u.includes(m.value)}),r.dispatchEvent(new Event("change",{bubbles:!0})),a()},p=()=>{s.innerHTML="";let u=Array.from(r.options),m=u.filter(k=>k.value);if(!m.length){let k=document.createElement("div");k.className="aipkit_popover_multiselect_empty",k.textContent=u[0]?.textContent||"-- No Collections Found --",s.appendChild(k),a();return}m.forEach(k=>{let f=document.createElement("label");f.className="aipkit_popover_multiselect_item";let w=document.createElement("input");w.type="checkbox",w.value=k.value,w.checked=k.selected,w.disabled=k.disabled;let E=document.createElement("span");E.className="aipkit_popover_multiselect_text",E.textContent=k.textContent,f.appendChild(w),f.appendChild(E),s.appendChild(f)}),a()},_=u=>{!n||!e||(n.classList.toggle("is-open",u),e.setAttribute("aria-expanded",u?"true":"false"),c&&(c.hidden=!u))};n&&e&&!n.dataset.listenerAttached&&(e.addEventListener("click",u=>{u.preventDefault(),_(!n.classList.contains("is-open"))}),document.addEventListener("click",u=>{n.classList.contains("is-open")&&(n.contains(u.target)||_(!1))}),e.addEventListener("keydown",u=>{u.key==="Escape"&&_(!1)}),n.dataset.listenerAttached="true"),s&&!s.dataset.listenerAttached&&(s.addEventListener("change",l),s.dataset.listenerAttached="true"),p()}window.aipkit_populateQdrantCollectionsMultiSelect=g})();(function(){"use strict";function g(o){let r=o.querySelector('select[name="pinecone_index_name"]'),n=window.aipkit_escapeHtml||function(c){return c};if(!r)return;let e=window.aipkit_chat_config?.pineconeIndexes||[],i=r.value;if(r.innerHTML="",r.appendChild(new Option(n("-- Select Index --"),"")),e.length>0&&e.forEach(c=>{let s=c.name||c.id||"",t=c.name||s,d=c.total_vector_count!==void 0&&c.total_vector_count!==null&&c.total_vector_count!=="Error"&&c.total_vector_count!=="No Host"?` (Vectors: ${Number(c.total_vector_count).toLocaleString()})`:(c.total_vector_count||"")==="Error"||(c.total_vector_count||"")==="No Host"?" (Stats Err)":" (Vectors: ?)",a=n(t+d),l=new Option(a,s);s===i&&(l.selected=!0),r.appendChild(l)}),i&&!r.querySelector(`option[value="${CSS.escape(i)}"]`)){let c=new Option(n(i)+" (Manual/Not Synced)",i,!1,!0);r.appendChild(c),r.value=i}r.options.length<=1&&(r.innerHTML='<option value="" disabled>-- No Indexes Found (Sync in AI Settings) --</option>')}window.aipkit_populatePineconeIndexSelect=g})();(function(){"use strict";function g(o){let r=o.querySelector('select[name="vector_embedding_provider"]');r&&(r.value===""&&(r.value="openai"),r.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=g})();(function(){"use strict";function g(o){let r=o.querySelector('select[name="vector_embedding_provider"]'),n=o.querySelector('select[name="vector_embedding_model"]'),e=window.aipkit_escapeHtml||function(t){return t};if(!r||!n)return;let i=r.value,c=n.value;n.innerHTML="",n.appendChild(new Option(e("-- Select Model --"),""));let s=[];if(i==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?s=window.aipkit_chat_config.openaiEmbeddingModels:i==="google"&&window.aipkit_chat_config?.googleEmbeddingModels?s=window.aipkit_chat_config.googleEmbeddingModels:i==="azure"&&window.aipkit_chat_config?.azureEmbeddingModels&&(s=window.aipkit_chat_config.azureEmbeddingModels),s.length>0&&s.forEach(t=>{if(t&&t.id){let d=new Option(e(t.name||t.id),t.id);t.id===c&&(d.selected=!0),n.appendChild(d)}}),c&&!n.querySelector(`option[value="${CSS.escape(c)}"]`)){let t=new Option(e(c)+" (Manual/Not Synced)",c,!1,!0);n.appendChild(t),n.value=c}n.options.length<=1&&(n.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_toggle_switch"),n=o.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),e=o.querySelector(".aipkit_file_upload_field_group");if(!r||!n||!e)return;let i=r.checked,c=n.dataset.isProPlan==="true",t=c&&i,d="";c?i||(d='File upload requires "Enable Vector Store" to be active for this bot.'):d="File upload is a paid feature. Please upgrade.",t?(n.disabled=!1,e.classList.remove("aipkit_dimmed_row"),e.style&&(e.style.opacity=""),e.removeAttribute("title")):(n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change",{bubbles:!0}))),n.disabled=!0,e.classList.add("aipkit_dimmed_row"),e.style&&e.style.opacity&&(e.style.opacity=""),e.setAttribute("title",d))}window.aipkit_toggleFileUploadAvailability=g})();(function(){"use strict";function g(r){if(!r)return;let n=r.querySelector('select[name="theme"]'),e=r.querySelector('input[name="theme"]:checked'),i=()=>n?n.value:e?e.value:"",c=r.querySelector(".aipkit_custom_theme_config_btn, .aipkit_open_custom_theme_modal_btn"),s=i()==="custom";c&&(c.style.display=s?"inline-flex":"none")}function o(){let r=document.querySelector(".aipkit_chatbot_module_container")||document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Theme Toggle: Module container not found.");return}r.dataset.themeSettingsListenerAttached||(r.addEventListener("click",function(n){n.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(n):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),r.addEventListener("change",function(n){let e=n.target;if(e.matches&&e.matches('select[name="theme"]')||e.matches&&e.matches('input[name="theme"]')){let i=e.closest('.aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]')||e.closest(".aipkit_chatbot-settings-area")||r;if(i){g(i);let c=i.querySelector(".aipkit_open_custom_theme_modal_btn");if(c&&e.value==="custom"&&typeof window.aipkit_openChatbotSettingsModalById=="function"){let s=c.getAttribute("data-modal-target");s&&window.aipkit_openChatbotSettingsModalById(s)}}}}),r.dataset.themeSettingsListenerAttached="true"),document.documentElement.dataset.aipkitResetListenerAttached||(document.addEventListener("click",function(n){n.target.closest(".aipkit_chatbot_settings_modal .aipkit_reset_custom_theme_btn")&&typeof window.aipkit_handleResetCustomTheme=="function"&&window.aipkit_handleResetCustomTheme(n)}),document.documentElement.dataset.aipkitResetListenerAttached="true"),r.querySelectorAll('.aipkit_chatbot-settings-area, .aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]').forEach(n=>{g(n)})}window.aipkit_initChatThemeSettingsToggle=o})();(function(){"use strict";function g(o){let r=o.target.closest(".aipkit_reset_custom_theme_btn");if(!r)return;let n=r.dataset.botId,e=document.getElementById("aipkit_chatbot_main_tab_content_container"),i=document.getElementById(`aipkit_bot_${n}_custom_theme_settings_container`)||(e?e.querySelector(`#aipkit_bot_${n}_custom_theme_settings_container`):null),c=document.getElementById(`aipkit_reset_theme_status_${n}`)||(e?e.querySelector(`#aipkit_reset_theme_status_${n}`):null);if(!i||!c){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",n);return}let s=i.dataset.defaults;if(!s){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"error","Error: Defaults not found.",2e3);return}try{let t=JSON.parse(s);i.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(a=>{let p=a.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(p&&p[1]){let _=p[1];if(Object.prototype.hasOwnProperty.call(t,_)){a.type==="checkbox"?a.checked=String(t[_])==="1":a.value=t[_]!==null?String(t[_]):"";let u=new Event("change",{bubbles:!0,cancelable:!0});a.dispatchEvent(u)}else if(Object.prototype.hasOwnProperty.call(t,_+"_placeholder")){a.type==="checkbox"?a.checked=String(t[_+"_placeholder"])==="1":a.value=t[_+"_placeholder"]!==null?String(t[_+"_placeholder"]):"";let u=new Event("change",{bubbles:!0,cancelable:!0});a.dispatchEvent(u)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"success","\u2714 Reverted.",2e3)}catch(t){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",t),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=g})();(function(){"use strict";function g(s){let t=new Event("input",{bubbles:!0,cancelable:!0}),d=new Event("change",{bubbles:!0,cancelable:!0});s.dispatchEvent(t),s.dispatchEvent(d)}function o(s,t,d){let a=s.querySelector(`input[name="custom_theme_settings[${t}]"], select[name="custom_theme_settings[${t}]"]`);if(a){if(a.type==="checkbox"){let l=d==="1";a.checked!==l&&(a.checked=l,g(a));return}a.value!==d&&(a.value=d,g(a))}}function r(s){let t=s.closest(".aipkit_chatbot_settings_form");if(!t)return;let d=t.querySelector('input[name="theme"][value="custom"]');d&&!d.checked&&(d.checked=!0,g(d))}function n(s){let t=s.closest(".aipkit_custom_theme_settings_container");if(t)return t;let d=s.dataset.botId||s.closest("[data-bot-id]")?.dataset.botId;return d?document.getElementById(`aipkit_bot_${d}_custom_theme_settings_container`):null}function e(s){let t=s.closest(".aipkit_custom_theme_presets");t&&t.querySelectorAll(".aipkit_custom_theme_preset").forEach(d=>{let a=d===s;d.classList.toggle("is-selected",a),d.setAttribute("aria-pressed",a?"true":"false")})}function i(s){let t=s.dataset.primary,d=s.dataset.secondary;if(!t||!d)return;let a=n(s);a&&(r(s),o(a,"primary_color",t),o(a,"secondary_color",d),o(a,"auto_text_contrast","1"),e(s))}function c(){document.documentElement.dataset.aipkitCustomThemePresetsBound||(document.addEventListener("click",s=>{let t=s.target.closest(".aipkit_custom_theme_preset");t&&(s.preventDefault(),i(t))}),document.documentElement.dataset.aipkitCustomThemePresetsBound="1")}window.aipkit_initCustomThemePresets=c})();(function(){"use strict";let g=".aipkit_builder_theme_row_content",o=".aipkit_builder_theme_row",r=".aipkit_theme_scroll_btn",n=".aipkit_theme_scroll_btn--prev",e=".aipkit_theme_scroll_btn--next";function i(p){let _=p.closest(o);return _?{row:_,prev:_.querySelector(n),next:_.querySelector(e)}:null}function c(p){return Math.max(180,Math.round(p.clientWidth*.75))}function s(p){let _=i(p);if(!_||!_.prev||!_.next)return;let u=Math.max(0,p.scrollWidth-p.clientWidth),m=p.scrollLeft<=1,k=p.scrollLeft>=u-1;_.prev.disabled=u===0||m,_.next.disabled=u===0||k}function t(p){let _=p.target.closest(r);if(!_||_.disabled)return;let u=_.closest(o),m=u?u.querySelector(g):null;if(!m)return;let k=_.classList.contains("aipkit_theme_scroll_btn--next")?1:-1;m.scrollBy({left:k*c(m),behavior:"smooth"})}function d(p){let _=p.target;!(_ instanceof HTMLElement)||!_.matches(g)||s(_)}function a(){document.querySelectorAll(g).forEach(p=>{s(p)})}function l(p){let _=document.documentElement;_.dataset.aipkitThemeRowScrollBound||(document.addEventListener("click",t),document.addEventListener("scroll",d,!0),window.addEventListener("resize",a),_.dataset.aipkitThemeRowScrollBound="1"),p&&a()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>l(!0)):l(!0),window.aipkit_initThemeRowScroll=function(){l(!0)}})();(function(){"use strict";function g(i){if(!i)return;let c=i.querySelector(".aipkit_chatbot_provider_select");c||(c=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let s=i.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');s||(s=document.querySelector('#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_model_field[data-provider="OpenAI"] select'));let t=i.querySelector(".aipkit_reasoning_effort_field"),d=t?t.querySelector(".aipkit_reasoning_effort_slider"):null,a=t?t.querySelector('input[name="reasoning_effort"]'):null,l=t?t.querySelector(".aipkit_reasoning_effort_label"):null,p=null;if(t?p=t.closest('section[data-section="reasoning"], .aipkit_reasoning_section'):p=i.querySelector(".aipkit_reasoning_section"),!t)return;let _=t.querySelector('select[name="reasoning_effort"]'),u=()=>{t.classList.add("aipkit_hidden"),p&&p.classList.add("aipkit_hidden"),_&&(_.disabled=!0),t.style.opacity="",t.removeAttribute("title")},m=()=>{t.classList.remove("aipkit_hidden"),p&&p.classList.remove("aipkit_hidden"),_&&(_.disabled=!1),t.style.opacity="",t.removeAttribute("title")};if(!c||!s){u();return}let k=(c.value||"").toLowerCase(),w=(s.value||"").toLowerCase(),E=w.startsWith("o1")||w.startsWith("o3")||w.startsWith("o4"),y=w.includes("gpt-5");k==="openai"&&(E||y)?(m(),o(d,a,l,w)):u()}function o(i,c,s,t){if(!i||!c)return;let d=r(t),a=d.allowed,l=a.map(u=>u==="medium"?"med":u);i.dataset.reasoningValues=JSON.stringify(a),i.dataset.reasoningLabels=JSON.stringify(l),i.max=String(Math.max(0,a.length-1));let p=c.value||"";p==="minimal"&&(p="low"),a.includes(p)||(p=d.defaultValue),a.includes(p)||(p=a[0]||""),p&&(c.value=p);let _=Math.max(0,a.indexOf(p));i.value=String(_),s&&(s.textContent=l[_]||l[0]||""),i.dispatchEvent(new Event("input",{bubbles:!0}))}function r(i){return e(i)?{allowed:["high"],defaultValue:"high"}:i.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(i)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(i){let c=i.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let s=i.match(/gpt-(\d+)/);return s?Number.parseInt(s[1],10)>=6:!1}function e(i){return/gpt-5(\.\d+)?-pro/.test(i)}window.aipkit_toggleReasoningEffort=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(h){return h},o="#aipkit_chatbot_builder_bot_select, #aipkit_sources_provider_filter, #aipkit_sources_index_filter, .aipkit_builder_ai_model .aipkit_chatbot_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_model_field select",r=null,n=null,e=!1,i=h=>!!(h&&(h.classList.contains("aipkit_chatbot_provider_select")||h.id==="aipkit_sources_provider_filter")),c=h=>!!(h&&h.id==="aipkit_chatbot_builder_bot_select"),s=h=>String(h||"").trim().toLowerCase(),t=(h,M)=>{if(!h)return;let b="aipkit_settings_select_picker_icon--";h.classList.forEach(x=>{x.startsWith(b)&&h.classList.remove(x)}),h.classList.remove("is-hidden");let A=s(M);if(!A){h.classList.add("is-hidden");return}h.classList.add(`${b}${A}`)},d=h=>{if(!h)return"";let M=h.getAttribute("data-aipkit-picker-title");if(M)return M;let b=h.id&&document.querySelector(`label[for="${h.id}"]`)||h.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return b?b.textContent.trim():""},a=h=>{if(!h)return"";let M=h.selectedOptions&&h.selectedOptions.length?h.selectedOptions[0]:h.querySelector("option[selected]");if(M)return M.textContent.trim();let b=h.querySelector("option");return b?b.textContent.trim():""},l=h=>({buttonId:`${h}_picker_btn`,labelId:`${h}_picker_label`,popoverId:`${h}_picker_popover`,titleId:`${h}_picker_title`,searchId:`${h}_picker_search`,listId:`${h}_picker_list`}),p=h=>{if(!h||!h.id)return null;let M=l(h.id),b=h.closest(".aipkit_chatbot_builder");if(!b)return null;let A=document.getElementById(M.buttonId);if(!A){if(A=document.createElement("button"),A.type="button",A.id=M.buttonId,A.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",A.setAttribute("data-aipkit-popover-target",M.popoverId),A.setAttribute("aria-controls",M.popoverId),A.setAttribute("aria-expanded","false"),A.dataset.aipkitPopoverPlacement="bottom",i(h)){A.classList.add("aipkit_settings_select_picker_btn--provider");let P=document.createElement("span");P.className="aipkit_settings_select_picker_icon",P.setAttribute("aria-hidden","true"),t(P,h.value),A.appendChild(P)}let v=document.createElement("span");v.className="aipkit_settings_select_picker_label",v.id=M.labelId,v.textContent=a(h)||g("Select","gpt3-ai-content-generator");let C=document.createElement("span");C.className="dashicons dashicons-arrow-down-alt2",C.setAttribute("aria-hidden","true"),A.appendChild(v),A.appendChild(C),h.insertAdjacentElement("beforebegin",A)}h.classList.contains("screen-reader-text")||h.classList.add("screen-reader-text");let x=document.getElementById(M.popoverId);if(!x){x=document.createElement("div"),x.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",i(h)&&x.classList.add("aipkit_settings_select_picker_popover--provider"),x.id=M.popoverId,x.setAttribute("aria-hidden","true");let v=document.createElement("div");v.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",v.setAttribute("role","dialog"),v.setAttribute("aria-labelledby",M.titleId);let C=document.createElement("div");C.className="aipkit_model_settings_popover_header";let P=document.createElement("span");P.className="aipkit_model_settings_popover_title",P.id=M.titleId,P.textContent=d(h)||g("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',C.appendChild(P),C.appendChild($);let U=document.createElement("div");U.className="aipkit_model_settings_popover_body";let B=document.createElement("div");B.className="aipkit_settings_select_picker_search";let D=document.createElement("input");D.type="search",D.id=M.searchId,D.className="aipkit_form-input";let N=d(h),R=N?`Search ${N.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");D.setAttribute("placeholder",R),B.appendChild(D);let j=document.createElement("div");j.className="aipkit_settings_select_picker_list",j.id=M.listId,j.setAttribute("role","listbox"),U.appendChild(B),U.appendChild(j),v.appendChild(C),v.appendChild(U),x.appendChild(v),b.appendChild(x),(i(h)||c(h))&&(B.style.display="none")}return{ids:M,button:A,popover:x,label:document.getElementById(M.labelId),search:document.getElementById(M.searchId),list:document.getElementById(M.listId)}},_=h=>{let M=[];return h&&Array.from(h.children).forEach(A=>{if(A.tagName==="OPTGROUP"){let x=Array.from(A.children).filter(v=>v.tagName==="OPTION").map(v=>({value:v.value,label:v.textContent.trim(),disabled:v.disabled,selected:v.selected}));M.push({groupLabel:A.label||"",options:x})}else A.tagName==="OPTION"&&M.push({groupLabel:"",options:[{value:A.value,label:A.textContent.trim(),disabled:A.disabled,selected:A.selected}]})}),M},u=(h,M,b="")=>{if(!h||!M)return;let A=b.trim().toLowerCase();if(M.innerHTML="",c(h)){let C=Array.from(h.options).map(N=>({value:N.value,label:N.textContent.trim(),disabled:N.disabled,selected:N.selected})),P=N=>N.disabled&&N.value===""&&/^-+$/.test(N.label.replace(/\s+/g,"")),$=C.filter(N=>N.value==="__new__"),U=C.filter(N=>N.value!=="__new__"&&!P(N)),B=A?U.filter(N=>N.label.toLowerCase().includes(A)):U,D=N=>{let R=document.createElement("button");R.type="button",R.className="aipkit_settings_select_picker_item",R.setAttribute("role","option"),R.dataset.value=N.value,R.dataset.label=N.label,N.disabled&&(R.classList.add("is-disabled"),R.setAttribute("aria-disabled","true")),h.value===N.value?(R.classList.add("is-active"),R.setAttribute("aria-selected","true")):R.setAttribute("aria-selected","false");let j=document.createElement("span");j.className="aipkit_settings_select_picker_text",j.textContent=N.label;let L=document.createElement("span");L.className="dashicons dashicons-yes aipkit_settings_select_picker_check",R.appendChild(j),R.appendChild(L),M.appendChild(R)};if($.forEach(D),B.forEach(D),!$.length&&!B.length){let N=document.createElement("div");N.className="aipkit_settings_select_picker_empty",N.textContent=g(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),M.appendChild(N)}return}let x=_(h),v=!1;if(x.forEach(C=>{let P=C.options.filter($=>A?$.label.toLowerCase().includes(A):!0);if(P.length){if(C.groupLabel){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=C.groupLabel,M.appendChild($)}P.forEach($=>{let U=document.createElement("button");if(U.type="button",U.className="aipkit_settings_select_picker_item",U.setAttribute("role","option"),U.dataset.value=$.value,U.dataset.label=$.label,$.disabled&&(U.classList.add("is-disabled"),U.setAttribute("aria-disabled","true")),h.value===$.value?(U.classList.add("is-active"),U.setAttribute("aria-selected","true")):U.setAttribute("aria-selected","false"),i(h)){U.classList.add("aipkit_settings_select_picker_item--provider");let N=document.createElement("span");N.className="aipkit_settings_select_picker_icon",N.setAttribute("aria-hidden","true"),t(N,$.value),U.appendChild(N)}let B=document.createElement("span");B.className="aipkit_settings_select_picker_text",B.textContent=$.label;let D=document.createElement("span");D.className="dashicons dashicons-yes aipkit_settings_select_picker_check",U.appendChild(B),U.appendChild(D),M.appendChild(U),v=!0})}}),!v){let C=document.createElement("div");C.className="aipkit_settings_select_picker_empty",C.textContent=g(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),M.appendChild(C)}},m=(h,M)=>{if(!h||!M)return;let b=a(h);if(M.textContent=b||g("Select","gpt3-ai-content-generator"),i(h)){let A=M.closest("button"),x=A?A.querySelector(".aipkit_settings_select_picker_icon"):null;t(x,h.value)}},k=(h,M)=>{if(!h||!M)return;let b=h.getBoundingClientRect(),A=M.getBoundingClientRect(),x=A.width||320,v=A.height||0,C=window.innerWidth,P=window.innerHeight,$=12,U=b.left;U+x>C-$&&(U=b.right-x),U=Math.max($,Math.min(U,C-x-$));let B=b.bottom+8;B+v>P-$&&(B=b.top-v-8),B=Math.max($,Math.min(B,P-v-$)),M.style.left=`${Math.round(U)}px`,M.style.top=`${Math.round(B)}px`},f=()=>{!r||!n||e||(e=!0,window.requestAnimationFrame(()=>{let h=r.querySelector(".aipkit_model_settings_popover_panel");k(n,h),e=!1}))},w=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),r=null,n=null)},E=(h,M,b)=>{if(!h||!M)return;r&&r!==M&&w(),r=M,n=h,M.classList.add("aipkit-active"),M.setAttribute("aria-hidden","false"),h.setAttribute("aria-expanded","true");let A=M.querySelector(".aipkit_settings_select_picker_search input"),x=M.querySelector(".aipkit_settings_select_picker_list");x&&u(b,x,A?A.value:""),A&&A.offsetParent!==null&&(A.focus(),A.select());let v=M.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{k(h,v)})},y=(h,M)=>{if(!h||!M)return;let{button:b,popover:A,list:x,search:v}=M;if(b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("click",C=>{if(C.preventDefault(),r===A){w();return}E(b,A,h)}),b.dataset.pickerListenerAttached="true"),A&&A.dataset.overlayListenerAttached!=="true"){A.addEventListener("click",P=>{P.target===A&&w()});let C=A.querySelector(".aipkit_model_settings_popover_close");C&&C.addEventListener("click",P=>{P.preventDefault(),w()}),A.dataset.overlayListenerAttached="true"}if(x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("click",C=>{let P=C.target.closest(".aipkit_settings_select_picker_item");if(!P||P.classList.contains("is-disabled"))return;let $=P.dataset.value??"";h.value=$,h.dispatchEvent(new Event("change",{bubbles:!0})),m(h,M.label),u(h,x,v?v.value:""),w()}),x.dataset.pickerListenerAttached="true"),v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("input",()=>{u(h,x,v.value)}),v.dataset.pickerListenerAttached="true"),h&&h.dataset.pickerListenerAttached!=="true"&&(h.addEventListener("change",()=>{m(h,M.label),u(h,x,v?v.value:""),r===A&&w()}),h.dataset.pickerListenerAttached="true"),h&&h.dataset.pickerObserverAttached!=="true"){let C=!1;new MutationObserver(()=>{C||(C=!0,window.requestAnimationFrame(()=>{m(h,M.label),u(h,x,v?v.value:""),C=!1}))}).observe(h,{childList:!0,subtree:!0}),h.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitChatPickerEscapeBound||(document.addEventListener("keydown",C=>{C.key==="Escape"&&r&&w()}),document.body.dataset.aipkitChatPickerEscapeBound="true"),document.body.dataset.aipkitChatPickerRepositionBound||(window.addEventListener("resize",f),window.addEventListener("scroll",f,!0),document.body.dataset.aipkitChatPickerRepositionBound="true")};function I(){let h=document.querySelector(".aipkit_chatbot_builder");if(!h)return;let M=h.querySelectorAll(o);M.length&&M.forEach(b=>{if(!b.id||b.dataset.aipkitPickerInit==="true")return;let A=p(b);A&&(m(b,A.label),u(b,A.list,A.search?A.search.value:""),y(b,A),b.dataset.aipkitPickerInit="true")})}function S(){let h=document.querySelector(".aipkit_chatbot_builder");if(!h)return;h.querySelectorAll(o).forEach(b=>{if(!b.id)return;let A=p(b);A&&(m(b,A.label),u(b,A.list,A.search?A.search.value:""),y(b,A),b.dataset.aipkitPickerInit="true")})}window.aipkit_initChatSelectPickers=I,window.aipkit_refreshChatSelectPickers=S})();(function(){"use strict";let g={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",DeepSeek:"deepseek",Ollama:"ollama"};function o(n){let e=g[n];if(!e)return!0;let i=window.aipkit_dashboard?.providerStatus?.[e];return typeof i>"u"?!0:!!i}function r(n,e={}){return n?typeof window.aipkit_queueProviderSync!="function"?(console.warn("AIPKit Chatbot Sync: aipkit_queueProviderSync is not available."),!1):o(n)?(window.aipkit_queueProviderSync(n,e),!0):!1:!1}window.aipkit_requestChatbotModelSync=r})();(function(){"use strict";function g(r,n,e){let i=document.getElementById(r);if(!i)return;if(i.innerHTML="",!n||n.length===0){i.appendChild(new Option("(No voices found - Sync again)",""));return}i.appendChild(new Option("-- Select Voice --",""));let c={};n.forEach(t=>{let d=t.languageCodes[0]||"und";c[d]||(c[d]=[]),c[d].push(t)}),Object.keys(c).sort().forEach(t=>{let d=document.createElement("optgroup");try{let a=new Intl.DisplayNames(["en"],{type:"language"}).of(t.split("-")[0]);d.label=`${a} (${t})`}catch{d.label=t}c[t].sort((a,l)=>a.name.localeCompare(l.name)),c[t].forEach(a=>{let l=new Option(a.name,a.id);a.id===e&&(l.selected=!0),d.appendChild(l)}),i.appendChild(d)}),e&&!i.value&&(Array.from(i.options).some(d=>d.value===e)?i.value=e:console.warn(`AIPKit TTS: Saved Google voice ID "${e}" not found in synced list for ${r}.`))}function o(r){let n=r.getAttribute("data-target-select"),e=r.querySelector(".aipkit_spinner"),i=r.closest(".aipkit_popover_audio_flyout"),c=i?i.querySelector(".aipkit_tts_sync_status"):null;if(!c){let a=r.closest(".aipkit_popover_option_row");c=a?a.querySelector(".aipkit_tts_sync_status"):null}if(!c){let a=r.closest(".aipkit_form-group");c=a?a.querySelector(".aipkit_form-help"):null}if(!n){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(c||console.error("AIPKit TTS Sync (Google): Could not find message container for button:",r),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}let s=c&&c.classList.contains("aipkit_popover_status_inline"),t=(a,l)=>{!c||!s||(c.textContent=a||"",c.classList.remove("success","error","loading"),l&&c.classList.add(l),c.style.display=a?"inline-block":"none")};if(r.disabled=!0,r.classList.add("aipkit_loading"),e&&(e.style.display="inline-block"),c){let a=c.dataset.baseClass||c.className||"aipkit_form-help";c.dataset.baseClass||(c.dataset.baseClass=a),c.textContent="",c.className=a,c.style.display=a.includes("aipkit_popover_status_inline")?"none":""}s&&t("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(a=>{if(a&&a.voices){let l=document.getElementById(n),p=l?l.value:"";g(n,a.voices,p);let _=document.getElementById("aipkit_google_tts_voices_json_main");_&&(_.dataset.voices=JSON.stringify(a.voices)),c&&(s?t(a.message||"Sync successful!","success"):window.aipkit_showTemporaryMessage(c,"success",a.message||"Sync successful!"))}else throw new Error("Invalid response received from voice sync.")}).catch(a=>{console.error("AIPKit TTS Sync Error (Google):",a),c&&(s?t(`Sync failed: ${a.message||"Unknown error"}`,"error"):window.aipkit_showTemporaryMessage(c,"error",`Sync failed: ${a.message||"Unknown error"}`))}).finally(()=>{r.disabled=!1,r.classList.remove("aipkit_loading"),e&&(e.style.display="none")})}window.aipkit_updateGoogleVoiceSelect=g,window.aipkit_handleSyncGoogleVoices=o})();(function(){"use strict";function g(r,n,e){let i=document.getElementById(r);if(!i){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${r} not found.`);return}if(i.innerHTML="",!n||n.length===0){if(i.appendChild(new Option("(No voices found - Sync voices to load)","")),e){let s=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(s),i.value=e}return}i.appendChild(new Option("-- Select Voice --","")),n.sort((s,t)=>(s.name||s.id||"").localeCompare(t.name||t.id||""));let c=!1;if(n.forEach(s=>{let t=new Option(s.name,s.id);s.id===e&&(t.selected=!0,c=!0),i.appendChild(t)}),e&&!c){let s=!1;for(let t=0;t<i.options.length;t++)if(i.options[t].value===e){s=!0,i.value=e;break}if(!s){let t=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(t),i.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${e}" not found in synced list for #${r}, added as manual.`)}}else!e&&i.options.length>0&&(i.value="")}function o(r,n,e){let i=document.getElementById(r);if(!i){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${r} not found.`);return}if(i.innerHTML="",!n||n.length===0){if(i.appendChild(new Option("(No models found - Sync models to load)","")),e){let s=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(s),i.value=e}return}i.appendChild(new Option("-- Select Model --","")),n.sort((s,t)=>(s.name||s.id||"").localeCompare(t.name||t.id||""));let c=!1;if(n.forEach(s=>{let t=s.id||"",d=s.name||t;if(!t)return;let a=new Option(d,t);t===e&&(a.selected=!0,c=!0),i.appendChild(a)}),e&&!c){let s=!1;for(let t=0;t<i.options.length;t++)if(i.options[t].value===e){s=!0,i.value=e;break}if(!s){let t=new Option(e+" (manual/not synced)",e,!1,!0);i.appendChild(t),i.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${e}" not found in synced list for #${r}, added as manual.`)}}else!e&&i.options.length>0&&(i.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=g,window.aipkit_chatTts_updateElevenLabsModelsSelect=o})();(function(){"use strict";function g(n,e){let i=n.querySelector(".aipkit_tts_conditional_settings"),c=n.querySelector(".aipkit_tts_auto_play_container");i&&(i.style.display=e?"block":"none"),c&&(c.style.display=e?"block":"none")}function o(n){let e=n.querySelector(".aipkit_tts_provider_select");if(!e)return;let i=e.value;n.querySelectorAll(".aipkit_tts_provider_settings").forEach(s=>{if(s.getAttribute("data-provider")===i){if(s.style.display="block",i==="OpenAI"){let t=s.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');t&&(t.style.display="block")}}else s.style.display="none"})}function r(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit TTS Settings: Main content container not found.");return}let e=typeof window.aipkit_updateGoogleVoiceSelect=="function",i=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",c=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",s=typeof window.aipkit_handleSyncGoogleVoices=="function";e||console.error("AIPKit TTS Settings: Google voice update function missing."),i||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),c||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),s||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),n.addEventListener("change",function(d){let a=d.target.closest(".aipkit_tts_toggle_switch"),l=d.target.closest(".aipkit_tts_provider_select");if(a){let p=a.closest(".aipkit_accordion-content");p&&(g(p,a.checked),a.checked&&o(p))}else if(l){let p=l.closest(".aipkit_accordion-content");p&&o(p)}}),n.addEventListener("click",function(d){let a=d.target.closest(".aipkit_sync_tts_voices_btn");a&&a.getAttribute("data-provider")==="Google"&&s&&window.aipkit_handleSyncGoogleVoices(a)}),n.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(d=>{let a=d.querySelector(".aipkit_tts_toggle_switch");a&&(g(d,a.checked),a.checked&&o(d));let l=d.querySelector('select[name="tts_google_voice_id"]');l&&!e&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),l&&l.options.length<=1&&(l.innerHTML='<option value="">(Sync voices to load)</option>');let p=d.querySelector('select[name="tts_elevenlabs_voice_id"]');if(p&&i){let m="";if(p&&p.id){let w=p.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);w&&w[1]&&(m=w[1])}let k=m?document.getElementById(`aipkit_elevenlabs_voices_json_${m}`):null,f=k?k.dataset.voices:null;try{let w=f?JSON.parse(f):[],E=p.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(p.id,w,E)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",w),p.options.length<=1&&(p.innerHTML='<option value="">(Sync voices to load)</option>')}}else p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync voices to load)</option>');let _=d.querySelector('select[name="tts_elevenlabs_model_id"]');if(_&&c){let m="";if(_&&_.id){let w=_.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);w&&w[1]&&(m=w[1])}let k=m?document.getElementById(`aipkit_elevenlabs_models_json_${m}`):null,f=k?k.dataset.models:null;try{let w=f?JSON.parse(f):[],E=_.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(_.id,w,E)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",w),_.options.length<=1&&(_.innerHTML='<option value="">(Sync models to load)</option>')}}else _&&_.options.length<=1&&(_.innerHTML='<option value="">(Sync models to load)</option>');let u=d.querySelector('select[name="tts_openai_model_id"]');u&&u.options.length<=1&&(u.innerHTML='<option value="">(Sync models to load)</option>')})}window.aipkit_initTtsSettingsUI=r})();(function(){"use strict";function g(){let o=document.getElementById("chatbot-create-new-content");if(!o)return;let r=o.querySelector("#aipkit_create_new_bot_btn"),n=o.querySelector("#aipkit_new_bot_name"),e=o.querySelector("#aipkit_create_bot_message");if(!r||!n||!e)return;let i=r.querySelector(".aipkit_spinner");r.addEventListener("click",function(){let c=n.value.trim();if(!c){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Please enter a name for the chatbot."):(e.textContent="Please enter a name for the chatbot.",e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),n.focus();return}r.disabled=!0,i&&(i.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(r,"Creating..."):r.textContent="Creating...",e.textContent="",e.className="aipkit_form-help",aipkit_apiRequest("aipkit_create_chatbot",{bot_name:c}).then(s=>{let t=s.message||"Chatbot created!";typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"success",t):(e.textContent=t,e.style.color="green",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),n.value="";let d=s.bot_id;if(!d){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Creation succeeded but failed to get bot ID. Please reload."):(e.textContent="Creation succeeded but failed to get bot ID. Please reload.",e.style.color="red");return}aipkit_loadModule("chatbot",{force_active_bot_id:d},function(a){if(a){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Bot created, but UI failed to refresh. Please reload."):(e.textContent="Bot created, but UI failed to refresh. Please reload.",e.style.color="red");return}if(typeof window.aipkit_requestChatbotModelSync=="function"){let l=document.querySelector(".aipkit_chatbot_provider_select"),p=l&&l.value||"";p&&window.aipkit_requestChatbotModelSync(p,{silent:!0})}setTimeout(()=>{typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(d)},50)})}).catch(s=>{let t="Error: "+(s.message||"Unknown error during creation.");typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error",t):(e.textContent=t,e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3))}).finally(()=>{r.disabled=!1,i&&(i.style.display="none"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(r,"Start Creating"):(r.textContent="Start Creating",i&&r.appendChild(i))})})}window.aipkit_initCreateNewBot=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}o.addEventListener("submit",function(r){let n=r.target.closest(".aipkit_chatbot_settings_form");if(!n)return;r.preventDefault();let e=n.getAttribute("data-bot-id"),i=n.querySelector(".aipkit_save_bot_settings_btn");i||(i=document.getElementById("aipkit_chatbot_header_save_btn"));let c=document.getElementById("aipkit_chatbot_global_save_status_container"),s=n.querySelector(`#aipkit_action_feedback_${e}`);if(!e||!i||!c){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",n),c||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}s&&(s.innerHTML=""),c.textContent="",c.className="aipkit_save_status_container",i.disabled=!0,i.classList.add("aipkit_loading");let t=i.querySelector(".aipkit_spinner");t||(t=document.createElement("span"),t.className="aipkit_spinner",i.appendChild(t)),t.style.display="inline-block";let d=new FormData(n),a={};for(let[p,_]of d.entries())if(p.endsWith("[]")){let u=p.slice(0,-2);a[u]=d.getAll(p)}else a.hasOwnProperty(p)||(a[p]=_);a.bot_id=e,function(){let _=document.getElementById(`aipkit_bot_${e}_custom_theme_settings_container`);if(!_)return;_.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["], textarea[name^="custom_theme_settings["]').forEach(m=>{let k=m.getAttribute("name");if(!k)return;let f=!0;(m.type==="checkbox"||m.type==="radio")&&(f=m.checked),f?a[k]=m.value:m.type==="checkbox"&&(a[k]="0")})}(),function(){let _=document.getElementById(`aipkit_bot_${e}_ai_params_modal`);if(!_)return;let u=_.querySelector(".aipkit_modal_body")||_;["temperature","max_completion_tokens","reasoning_effort"].forEach(k=>{let f=u.querySelector(`[name="${k}"]`);f&&(a[k]=f.value)})}(),function(){let _=document.getElementById(`aipkit_bot_${e}_web_settings_modal`);if(!_)return;let u=_.querySelector(".aipkit_modal_body")||_,m=k=>u.querySelector(`[name="${k}"]`);["openai_web_search_context_size","openai_web_search_loc_type","openai_web_search_loc_country","openai_web_search_loc_city","openai_web_search_loc_region","openai_web_search_loc_timezone"].forEach(k=>{let f=m(k);f&&(a[k]=f.value)}),["google_grounding_mode","google_grounding_dynamic_threshold"].forEach(k=>{let f=m(k);f&&(a[k]=f.value)})}(),function(){let _=document.getElementById(`aipkit_bot_${e}_vector_store_modal`);if(!_)return;let u=I=>_.querySelector(I),m=_.querySelector(".aipkit_modal_body")||_,k=m.querySelector('input[name="enable_vector_store"]');k&&(a.enable_vector_store=k.checked?"1":"0");let f=u('select[name="vector_store_provider"]');if(f&&(a.vector_store_provider=f.value),a.vector_store_provider==="openai"){let I=u('select[name="openai_vector_store_ids[]"]');I?a.openai_vector_store_ids=Array.from(I.selectedOptions).map(S=>S.value):a.openai_vector_store_ids=[]}else delete a.openai_vector_store_ids;if(a.vector_store_provider==="pinecone"){let I=u('select[name="pinecone_index_name"]');I&&(a.pinecone_index_name=I.value)}else delete a.pinecone_index_name;if(a.vector_store_provider==="qdrant"){let I=u('select[name="qdrant_collection_names[]"]');if(I){let S=Array.from(I.selectedOptions).map(h=>h.value);a.qdrant_collection_names=S,a.qdrant_collection_name=S[0]||""}else a.qdrant_collection_names=[],a.qdrant_collection_name=""}else delete a.qdrant_collection_names,delete a.qdrant_collection_name;if(a.vector_store_provider==="pinecone"||a.vector_store_provider==="qdrant"){let I=u('select[name="vector_embedding_provider"]'),S=u('select[name="vector_embedding_model"]');I&&(a.vector_embedding_provider=I.value),S&&(a.vector_embedding_model=S.value)}else delete a.vector_embedding_provider,delete a.vector_embedding_model;let w=u('input[name="vector_store_top_k"]');w&&(a.vector_store_top_k=w.value);let E=u('input[name="vector_store_confidence_threshold"]');E&&(a.vector_store_confidence_threshold=E.value);let y=m.querySelector('input[name="content_aware_enabled"]');y&&(a.content_aware_enabled=y.checked?"1":"0")}(),function(){let _=document.getElementById(`aipkit_bot_${e}_conversations_modal`);if(!_)return;let u=_.querySelector(".aipkit_modal_body")||_,m=u.querySelector('input[name="stream_enabled"]');m&&(a.stream_enabled=m.checked?"1":"0");let k=u.querySelector('input[name="openai_conversation_state_enabled"]');k&&(a.openai_conversation_state_enabled=k.checked?"1":"0");let f=u.querySelector('input[name="max_messages"]');f&&(a.max_messages=f.value);let w=u.querySelector('select[name="reasoning_effort"]');w&&(a.reasoning_effort=w.value)}(),function(){let _=document.getElementById(`aipkit_bot_${e}_images_modal`);if(!_)return;let u=_.querySelector(".aipkit_modal_body")||_,m=u.querySelector('select[name="chat_image_model_id"]'),k=u.querySelector('input[name="image_triggers"]');m&&(a.chat_image_model_id=m.value),k&&(a.image_triggers=k.value);let f=u.querySelector('input[name="enable_image_upload"]');f&&(a.enable_image_upload=f.checked?"1":"0")}(),function(){let _=document.getElementById(`aipkit_bot_${e}_audio_settings_modal`);if(!_)return;let u=_.querySelector(".aipkit_modal_body")||_,m=w=>u.querySelector(`[name="${w}"]`);function k(w){let E=m(w);E&&(a[w]=E.checked?"1":"0")}function f(w){let E=m(w);E&&(a[w]=E.value)}k("enable_voice_input"),f("stt_provider"),f("stt_openai_model_id"),k("tts_enabled"),f("tts_provider"),f("tts_google_voice_id"),f("tts_openai_voice_id"),f("tts_openai_model_id"),f("tts_elevenlabs_voice_id"),f("tts_elevenlabs_model_id"),k("tts_auto_play"),k("enable_realtime_voice"),k("direct_voice_mode"),k("input_audio_noise_reduction"),f("realtime_model"),f("realtime_voice"),f("turn_detection"),f("input_audio_format"),f("output_audio_format"),f("speed")}(),function(){let _=document.getElementById(`aipkit_bot_${e}_token_mgmt_modal`);if(!_)return;let u=_.querySelector(".aipkit_modal_body")||_,m=u.querySelector('input[name="token_guest_limit"]'),k=u.querySelector('input[name="token_user_limit"]'),f=u.querySelector('select[name="token_limit_mode"]'),w=u.querySelector('select[name="token_reset_period"]'),E=u.querySelector('input[name="token_limit_message"]');m&&(a.token_guest_limit=m.value),k&&(a.token_user_limit=k.value),f&&(a.token_limit_mode=f.value),w&&(a.token_reset_period=w.value),E&&(a.token_limit_message=E.value),u.querySelectorAll('input[name^="token_role_limits["]').forEach(I=>{let S=I.getAttribute("name");S&&(a[S]=I.value)})}(),function(){let _=document.getElementById("aipkit_starters_flyout");if(!_)return;let u=_.querySelector('textarea[name="conversation_starters"]');u&&(a.conversation_starters=u.value)}(),function(){let _=document.getElementById(`aipkit_bot_${e}_popup_settings_modal`);if(!_)return;let u=_.querySelector(".aipkit_modal_body")||_;function m(ee){return u.querySelector(`[name="${ee}"]`)}function k(ee){return u.querySelector(`[name="${ee}"]:checked`)}function f(ee,J){typeof J<"u"&&J!==null&&(a[ee]=J)}let w=m("popup_position");w&&f("popup_position",w.value);let E=m("popup_delay");E&&f("popup_delay",E.value);let y=m("site_wide_enabled");y&&f("site_wide_enabled",y.checked?"1":"0");let I=m("popup_icon_style");if(I)f("popup_icon_style",I.value);else{let ee=k("popup_icon_style");ee&&f("popup_icon_style",ee.value)}let S=m("popup_icon_size");S&&f("popup_icon_size",S.value);let h=m("popup_icon_type");if(h)f("popup_icon_type",h.value);else{let ee=k("popup_icon_type");ee&&f("popup_icon_type",ee.value)}let M=k("popup_icon_default");M&&f("popup_icon_default",M.value);let b=m("popup_icon_custom_url");b&&f("popup_icon_custom_url",b.value);let A=m("header_avatar_type");if(A)f("header_avatar_type",A.value);else{let ee=k("header_avatar_type");ee&&f("header_avatar_type",ee.value)}let x=k("header_avatar_default");x&&f("header_avatar_default",x.value);let v=m("header_avatar_url");v&&f("header_avatar_url",v.value);let C=m("header_online_text");C&&f("header_online_text",C.value);let P=m("popup_label_enabled");P&&f("popup_label_enabled",P.checked?"1":"0");let $=m("popup_label_text");$&&f("popup_label_text",$.value);let U=m("popup_label_mode");U&&f("popup_label_mode",U.value);let B=m("popup_label_size");B&&f("popup_label_size",B.value);let D=m("popup_label_delay_seconds");D&&f("popup_label_delay_seconds",D.value);let N=m("popup_label_auto_hide_seconds");N&&f("popup_label_auto_hide_seconds",N.value);let R=m("popup_label_dismissible");R&&f("popup_label_dismissible",R.checked?"1":"0");let j=m("popup_label_show_on_desktop");j&&f("popup_label_show_on_desktop",j.checked?"1":"0");let L=m("popup_label_show_on_mobile");L&&f("popup_label_show_on_mobile",L.checked?"1":"0");let K=m("popup_label_frequency");K&&f("popup_label_frequency",K.value);let V=m("popup_label_version");V&&f("popup_label_version",V.value)}();let l=a.provider;if(l==="OpenAI")a.model=a.openai_model;else if(l==="OpenRouter")a.model=a.openrouter_model;else if(l==="Google")a.model=a.google_model;else if(l==="Azure")a.model=a.azure_deployment;else if(l==="DeepSeek")a.model=a.deepseek_model;else if(l==="Ollama"){let p=n.querySelector('select[name="ollama_model"]'),_=typeof a.ollama_model<"u"?a.ollama_model:p?p.value:"";a.model=_||""}else a.model="";delete a.openai_model,delete a.openrouter_model,delete a.google_model,delete a.azure_deployment,delete a.deepseek_model,delete a.ollama_model,function(){let _=document.getElementById(`aipkit_bot_${e}_vector_store_modal`),u=k=>_?_.querySelector(k):null,m=k=>n.querySelector(k);if(a.vector_store_provider==="openai"){let k=u('select[name="openai_vector_store_ids[]"]')||m('select[name="openai_vector_store_ids[]"]');k?a.openai_vector_store_ids=Array.from(k.selectedOptions).map(f=>f.value):a.openai_vector_store_ids=[]}else a.hasOwnProperty("openai_vector_store_ids")&&delete a.openai_vector_store_ids;if(a.vector_store_provider==="pinecone"||a.vector_store_provider==="qdrant"){if(a.vector_store_provider==="qdrant"){let w=u('select[name="qdrant_collection_names[]"]')||m('select[name="qdrant_collection_names[]"]');if(w){let E=Array.from(w.selectedOptions).map(y=>y.value);a.qdrant_collection_names=E,a.qdrant_collection_name=E[0]||""}else a.qdrant_collection_names=[],a.qdrant_collection_name=""}else if(a.vector_store_provider==="pinecone"){let w=u('select[name="pinecone_index_name"]')||m('select[name="pinecone_index_name"]');w&&(a.pinecone_index_name=w.value)}let k=u('select[name="vector_embedding_provider"]')||m('select[name="vector_embedding_provider"]');k&&(a.vector_embedding_provider=k.value);let f=u('select[name="vector_embedding_model"]')||m('select[name="vector_embedding_model"]');f&&(a.vector_embedding_model=f.value)}else delete a.pinecone_index_name,delete a.qdrant_collection_name,delete a.qdrant_collection_names,delete a.vector_embedding_provider,delete a.vector_embedding_model}(),aipkit_apiRequest("aipkit_save_chatbot_settings",a).then(p=>{c.textContent=p.message||"Settings Saved!",c.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(e)}).catch(p=>{c.textContent="Error: "+p.message,c.classList.add("error")}).finally(()=>{i.disabled=!1,i.classList.remove("aipkit_loading");let p=i.querySelector(".aipkit_spinner");if(p&&(p.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(i,"Save");else{let _=Array.from(i.childNodes).find(u=>u.nodeType===Node.TEXT_NODE);_?_.textContent="Save":i.insertBefore(document.createTextNode("Save"),i.firstChild),p&&i.appendChild(p)}setTimeout(()=>{c&&(c.textContent="",c.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=g})();(function(){"use strict";function g(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");n||console.warn("AIPKit Chat Deleter: Main content container not found."),n&&n.querySelectorAll(".aipkit_delete_bot_btn").forEach(i=>{i.getAttribute("data-is-default")==="1"&&(i.disabled=!0)}),n&&n.addEventListener("click",function(i){let c=i.target.closest(".aipkit_delete_bot_btn");if(!c||c.disabled)return;let s=c.getAttribute("data-bot-id"),t=c.getAttribute("data-bot-name"),d=c.closest(".aipkit_chatbot_settings_form"),l=document.getElementById("aipkit_header_action_feedback")||(d?d.querySelector(`#aipkit_action_feedback_${s}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!s||!l){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",c);return}let _=`aipkit_delete_confirmation_${s}`,u=l.querySelector(`#${_}`);u||(u=document.createElement("div"),u.id=_,u.className="aipkit_confirmation_message aipkit_delete_confirmation",u.style.display="none",l.insertBefore(u,l.firstChild));let m=`aipkit_action_status_${s}`,k=l.querySelector(`#${m}`);if(k||(k=document.createElement("div"),k.id=m,k.className="aipkit_action_status_message",l.appendChild(k)),u.style.display!=="none"&&u.innerHTML!=="")return;p&&(p.textContent="",p.className="aipkit_save_status_container");let f=l.querySelector(".aipkit_reset_confirmation");f&&(f.style.display="none"),k.textContent="",k.className="aipkit_action_status_message",u.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
                </div>
            `,u.style.display="block";let w=u.querySelector(".aipkit_delete_confirm_btn"),E=u.querySelector(".aipkit_delete_cancel_btn"),y=()=>{u.innerHTML="",u.style.display="none",o(c,s,k,p)},I=()=>{u.innerHTML="",u.style.display="none"};w.addEventListener("click",y,{once:!0}),E.addEventListener("click",I,{once:!0})});let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(i){let c=i.target.closest(".aipkit_header_delete_btn");if(!c)return;let s=c.closest(".aipkit_tab_dropdown_menu");s&&(s.style.display="none");let t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),d=t?.dataset?.botId,a=t?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",p=document.getElementById("aipkit_header_action_feedback")||(t?t.querySelector(`#aipkit_action_feedback_${d}`):null),_=document.getElementById("aipkit_chatbot_global_save_status_container");if(!d||!p)return;if(a){p.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{p.innerHTML=""},3e3);return}let u=`aipkit_delete_confirmation_${d}`,m=p.querySelector(`#${u}`);m||(m=document.createElement("div"),m.id=u,m.className="aipkit_confirmation_message aipkit_delete_confirmation",m.style.display="none",p.insertBefore(m,p.firstChild));let k=`aipkit_action_status_${d}`,f=p.querySelector(`#${k}`);f||(f=document.createElement("div"),f.id=k,f.className="aipkit_action_status_message",p.appendChild(f)),_&&(_.textContent="",_.className="aipkit_save_status_container");let w=p.querySelector(".aipkit_reset_confirmation");w&&(w.style.display="none"),f.textContent="",f.className="aipkit_action_status_message",m.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
          </div>`,m.style.display="block";let E=m.querySelector(".aipkit_delete_confirm_btn"),y=m.querySelector(".aipkit_delete_cancel_btn");E?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none",o(c,d,f,_)},{once:!0}),y?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none"},{once:!0})})}function o(n,e,i,c){let s=n.querySelector(".aipkit_spinner"),t=document.getElementById("aipkit_chatbot_main_selector_container");c&&(c.textContent="",c.className="aipkit_save_status_container"),i.textContent="",i.className="aipkit_action_status_message",n.disabled=!0,n.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(n,"Deleting..."):n.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:e}).then(d=>{i.textContent=d.message||"Chatbot deleted successfully.",i.classList.add("success");let a=!1;if(t){let p=t.querySelector(`.aipkit_tab_button[data-bot-id="${e}"]`),_=t.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${e}"]`);if(p)a=p.classList.contains("aipkit_active"),p.remove();else if(_){a=_.classList.contains("aipkit_active"),_.remove();let u=t.querySelector(".aipkit_tab_dropdown_menu");if(u&&u.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let k=u.closest(".aipkit_tab_dropdown_container");k&&k.remove()}}}let l=document.getElementById(`chatbot-${e}-content`);if(l&&l.remove(),setTimeout(()=>{let p=document.getElementById(`aipkit_action_status_${e}`);p&&(p.textContent="",p.className="aipkit_action_status_message")},4e3),a){let p=t?.querySelector(".aipkit_tab_button_default");if(p)p.click();else{let _=t?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(_)_.click();else{let u=t?.querySelector(".aipkit_tab_dropdown_item");if(u)u.click();else{let m=t?.querySelector(".aipkit_create-new-button");if(m)m.click();else{let k=document.getElementById("aipkit_admin_chat_preview_container");k&&(k.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(d=>{i.textContent="Error: "+(d.message||"Failed to delete chatbot."),i.classList.add("error"),n.disabled=!1,n.classList.remove("aipkit_loading"),s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(n,"Delete"),setTimeout(()=>{i&&(i.textContent="",i.className="aipkit_action_status_message")},5e3)})}function r(n){if(!n)return"";let e=document.createElement("div");return e.textContent=n,e.innerHTML}window.aipkit_initDeleteBot=g})();(function(){"use strict";function g(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");n||console.warn("AIPKit Chat Resetter: Main content container not found."),n&&n.addEventListener("click",function(i){let c=i.target.closest(".aipkit_reset_bot_btn");if(!c||c.disabled)return;let s=c.getAttribute("data-bot-id"),t=c.getAttribute("data-bot-name"),d=c.closest(".aipkit_chatbot_settings_form"),l=document.getElementById("aipkit_header_action_feedback")||(d?d.querySelector(`#aipkit_action_feedback_${s}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!s||!l){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",c);return}let _=`aipkit_reset_confirmation_${s}`,u=l.querySelector(`#${_}`);u||(u=document.createElement("div"),u.id=_,u.className="aipkit_confirmation_message aipkit_reset_confirmation",u.style.display="none",l.insertBefore(u,l.firstChild));let m=`aipkit_action_status_${s}`,k=l.querySelector(`#${m}`);if(k||(k=document.createElement("div"),k.id=m,k.className="aipkit_action_status_message",l.appendChild(k)),u.style.display!=="none"&&u.innerHTML!=="")return;p&&(p.textContent="",p.className="aipkit_save_status_container");let f=l.querySelector(".aipkit_delete_confirmation");f&&(f.style.display="none"),k.textContent="",k.className="aipkit_action_status_message",u.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm</button>
                </div>
            `,u.style.display="block";let w=u.querySelector(".aipkit_reset_confirm_btn"),E=u.querySelector(".aipkit_reset_cancel_btn"),y=()=>{u.innerHTML="",u.style.display="none",o(c,s,k,p)},I=()=>{u.innerHTML="",u.style.display="none"};w.addEventListener("click",y,{once:!0}),E.addEventListener("click",I,{once:!0})});let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(i){let c=i.target.closest(".aipkit_header_reset_btn");if(!c)return;let s=c.closest(".aipkit_tab_dropdown_menu");s&&(s.style.display="none");let t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),d=t?.dataset?.botId,l=document.getElementById("aipkit_header_action_feedback")||(t?t.querySelector(`#aipkit_action_feedback_${d}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!d||!l)return;let _=`aipkit_reset_confirmation_${d}`,u=l.querySelector(`#${_}`);u||(u=document.createElement("div"),u.id=_,u.className="aipkit_confirmation_message aipkit_reset_confirmation",u.style.display="none",l.insertBefore(u,l.firstChild));let m=`aipkit_action_status_${d}`,k=l.querySelector(`#${m}`);k||(k=document.createElement("div"),k.id=m,k.className="aipkit_action_status_message",l.appendChild(k)),p&&(p.textContent="",p.className="aipkit_save_status_container");let f=l.querySelector(".aipkit_delete_confirmation");f&&(f.style.display="none"),k.textContent="",k.className="aipkit_action_status_message",u.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Reset</button>
          </div>`,u.style.display="block";let w=u.querySelector(".aipkit_reset_confirm_btn"),E=u.querySelector(".aipkit_reset_cancel_btn");w?.addEventListener("click",()=>{u.innerHTML="",u.style.display="none",o(c,d,k,p)},{once:!0}),E?.addEventListener("click",()=>{u.innerHTML="",u.style.display="none"},{once:!0})})}function o(n,e,i,c){let s=n.querySelector(".aipkit_spinner");c&&(c.textContent="",c.className="aipkit_save_status_container"),i.textContent="",i.className="aipkit_action_status_message",n.disabled=!0,n.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(n,"Resetting..."):n.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:e}).then(t=>{i.textContent=t.message||"Chatbot reset successfully!",i.classList.add("success"),aipkit_loadModule("chatbot",{force_active_bot_id:e},function(d){d&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",d),i.textContent="Reset OK, but UI refresh failed. Reload page.",i.classList.add("error"))}),setTimeout(()=>{let d=document.getElementById(`aipkit_action_status_${e}`);d&&(d.textContent="",d.className="aipkit_action_status_message")},4e3)}).catch(t=>{i.textContent="Error: "+(t.message||"Failed to reset chatbot."),i.classList.add("error"),n.disabled=!1,n.classList.remove("aipkit_loading"),s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(n,"Reset"),setTimeout(()=>{i&&(i.textContent="",i.className="aipkit_action_status_message")},5e3)})}function r(n){if(!n)return"";let e=document.createElement("div");return e.textContent=n,e.innerHTML}window.aipkit_initResetBot=g})();(function(){"use strict";function g(n,e=5,i=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(n)}catch(c){console.error("AIPKit Chat Preview: Error during chat initialization.",c),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else e>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${i}ms... (${e} retries left)`),setTimeout(()=>{g(n,e-1,i)},i)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function o(){let n=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),e=document.getElementById("aipkit_admin_chat_preview_container"),i=document.querySelector(".aipkit_chatbot-preview-column"),c=window.aipkit_dashboard?.text||{};if(!e||!i){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(e.innerHTML="",i.classList.remove("aipkit_loading"),n){let s=n.getAttribute("data-tab-type"),t=n.getAttribute("data-bot-id");s==="bot"&&t?r(t):s==="create"?e.innerHTML=`<p class="aipkit_preview_placeholder">${c.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:s==="settings"?e.innerHTML=`<p class="aipkit_preview_placeholder">${c.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${c.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?e.innerHTML=`<p class="aipkit_preview_placeholder">${c.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${c.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function r(n){let e=document.getElementById("aipkit_admin_chat_preview_container"),i=document.querySelector(".aipkit_chatbot-preview-column");if(!e||!i){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}i.classList.add("aipkit_loading"),e.innerHTML="";let c=new URL(window.aipkit_dashboard.ajaxurl);c.searchParams.append("action","aipkit_get_chatbot_shortcode"),c.searchParams.append("bot_id",n),c.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(c).then(s=>s.json()).then(s=>{if(s.success&&s.data&&s.data.html){e.innerHTML=s.data.html;let t=e.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");if(t){e.classList.toggle("aipkit-preview-inline",t.classList.contains("aipkit_chat_container")),e.classList.toggle("aipkit-preview-popup",t.classList.contains("aipkit_popup_wrapper"));let a=window.getComputedStyle(t).getPropertyValue("--aipkit-chat-container-border-radius").trim();a&&a!=="initial"&&a!=="inherit"&&a!=="unset"?e.style.setProperty("--aipkit-chat-container-border-radius",a):e.style.removeProperty("--aipkit-chat-container-border-radius"),g(t)}else console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${n} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,s.data.html),e.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>'}else{let t=s.data&&s.data.message?s.data.message:"Invalid response received for shortcode preview.";throw new Error(t)}}).catch(s=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${n}:`,s),e.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${s.message}</p>`}).finally(()=>{i.classList.remove("aipkit_loading")})}window.aipkit_loadInitialChatPreview=o,window.aipkit_refreshChatPreview=r})();(function(){"use strict";function g(){let c=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!c)return;let s=function(t){let d=t.target.closest(".aipkit_popup_toggle_switch");if(d){let m=d.closest(".aipkit_chatbot-settings-area");if(m){o(m,d.checked),n(m,d);let k=m.querySelector(".aipkit_popup_config_btn_placeholder");k&&(k.disabled=!d.checked,k.title=d.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let a=t.target.closest('select[name="popup_icon_type"]');if(a){let m=a.closest(".aipkit_chatbot-settings-area");m&&r(m,a.value);return}let l=t.target.closest('input[name="popup_icon_type"]');if(l){let m=l.closest(".aipkit_chatbot-settings-area");m&&r(m,l.value);return}let p=t.target.closest(".aipkit_popup_hint_toggle_switch");if(p){let m=p.closest(".aipkit_chatbot-settings-area");m&&i(m,p.checked);return}let _=t.target.closest(".aipkit_starters_toggle_switch");if(_){let m=_.closest(".aipkit_chatbot-settings-area");if(m){let k=m.querySelector(".aipkit_starters_config_btn");k&&(k.disabled=!_.checked,k.title=_.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let u=t.target.closest(".aipkit_voice_input_toggle_switch");if(u){let m=u.closest(".aipkit_chatbot-settings-area");m&&e(m,u.checked);return}};c.addEventListener("change",s),c.querySelectorAll(".aipkit_chatbot-settings-area").forEach(t=>{let d=t.querySelector(".aipkit_popup_toggle_switch");if(d){o(t,d.checked),n(t,d);let m=t.querySelector(".aipkit_popup_config_btn_placeholder");m&&(m.disabled=!d.checked,m.title=d.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}let a=t.querySelector('select[name="popup_icon_type"]');if(a)r(t,a.value);else{let m=t.querySelector('input[name="popup_icon_type"]:checked');m?r(t,m.value):t.querySelector('input[name="popup_icon_type"][value="default"]')&&r(t,"default")}let l=t.querySelector(".aipkit_voice_input_toggle_switch");l&&e(t,l.checked);let p=t.querySelector(".aipkit_popup_hint_toggle_switch");p&&i(t,p.checked);let _=t.querySelector(".aipkit_starters_toggle_switch"),u=t.querySelector(".aipkit_starters_config_btn");if(u){let m=_?_.checked:!1;u.disabled=!m,u.title=m?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}})}function o(c,s){let t=c.querySelector(".aipkit_popup_settings_accordion");if(t&&(t.style.display=s?"block":"none",!s)){let a=t.querySelector(".aipkit_accordion-header"),l=t.querySelector(".aipkit_accordion-content");a&&a.classList.remove("aipkit_active"),l&&l.classList.remove("aipkit_active")}let d=c.querySelector(".aipkit_popup_icon_options_container");d&&(d.style.display=s?"block":"none")}function r(c,s){let t=c.querySelector(".aipkit_popup_icon_default_selector_container"),d=c.querySelector(".aipkit_popup_icon_custom_input_container");t&&(t.style.display=s==="default"?"block":"none"),d&&(d.style.display=s==="custom"?"block":"none")}function n(c,s){let t=s.checked,d=s.getAttribute("data-sidebar-target"),a=c.querySelector("#"+d);if(!a)return;let l=a.querySelector(".aipkit_sidebar_toggle_switch"),p=a.querySelector("label");if(!l||!p)return;let _=a.getAttribute("data-tooltip-disabled")||"";t?(l.getAttribute("data-original-state")===null&&l.setAttribute("data-original-state",l.checked?"checked":"unchecked"),l.checked=!1,l.disabled=!0,a.setAttribute("title",_),a.classList.add("aipkit-disabled-tooltip"),p.style.opacity="0.6"):(l.disabled=!1,a.removeAttribute("title"),a.classList.remove("aipkit-disabled-tooltip"),p.style.opacity="1",l.getAttribute("data-original-state")==="checked"&&(l.checked=!0),l.removeAttribute("data-original-state"))}function e(c,s){let t=c.querySelector(".aipkit_stt_provider_conditional_row");t&&(t.style.display=s?"block":"none")}function i(c,s){let t=c.querySelector(".aipkit_popup_hint_conditional_row");t&&(t.style.display=s?"block":"none");let d=c.querySelectorAll(".aipkit_popup_hint_extra");d&&d.length&&d.forEach(a=>{a.style.display=s?"":"none"})}window.aipkit_initAppearanceToggles=g,window.aipkit_togglePopupDependentSettingsVisibility=o,window.aipkit_toggleSidebarCheckboxState=n,window.aipkit_togglePopupIconValueInputs=r,window.aipkit_toggleSttSettingsVisibility=e,window.aipkit_togglePopupHintSettingsVisibility=i})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");o&&(o.addEventListener("change",function(r){let n=r.target.closest(".aipkit_starters_toggle_switch");if(!n)return;let e=n.closest(".aipkit_chatbot-settings-area");if(!e)return;let i=e.querySelector(".aipkit_starters_conditional_row");i&&(i.style.display=n.checked?"block":"none")}),o.querySelectorAll(".aipkit_chatbot-settings-area").forEach(r=>{let n=r.querySelector(".aipkit_starters_toggle_switch"),e=r.querySelector(".aipkit_starters_conditional_row");n&&e&&(e.style.display=n.checked?"block":"none")}))}window.aipkit_initConversationStartersToggle=g})();(function(){"use strict";let g="aipkit_last_selected_chatbot",o=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now();function r(e){let i=document.getElementById("aipkit_admin_chat_preview_container");if(!i)return;i.classList.remove("aipkit-preview-inline","aipkit-preview-popup");let c=document.createElement("p");c.className="aipkit_preview_placeholder",c.textContent=e,i.innerHTML="",i.appendChild(c)}function n(){let e=document.querySelector(".aipkit_chatbot_builder");if(!e||e.dataset.aipkitContext==="sources")return;let i=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:q=>q,c=window.wp&&window.wp.i18n&&window.wp.i18n._n?window.wp.i18n._n:(q,F,T)=>T===1?q:F,s=e.getAttribute("data-aipkit-chatbot-layout")||"next",t=e.dataset.openaiApiKeySet==="true",d=e.dataset.pineconeApiKeySet==="true",a=e.dataset.qdrantApiKeySet==="true",l=e.dataset.qdrantUrlSet==="true",p=e.dataset.googleApiKeySet==="true",_=e.dataset.azureApiKeySet==="true",u=e.querySelector("#aipkit_chatbot_builder_bot_select"),m=e.getAttribute("data-active-bot-id")||u&&u.value||"";if(m)try{localStorage.setItem(g,m)}catch{}let k=document.getElementById("aipkit_builder_new_bot_modal"),f=e.querySelector(".aipkit_builder_new_bot_btn"),w=null,E=k?k.querySelector(".aipkit_builder_new_bot_close"):null,y=document.getElementById("aipkit_builder_sheet"),I=y?y.querySelector(".aipkit_builder_sheet_panel"):null,S=document.getElementById("aipkit_model_settings_popover"),h=S?S.querySelector(".aipkit_model_settings_popover_panel"):null,M=S?S.querySelector(".aipkit_model_settings_popover_close"):null,b=S?S.querySelector(".aipkit_model_settings_popover_title"):null,A=S?S.querySelector(".aipkit_model_settings_popover_back"):null,x=S?S.querySelector(".aipkit_model_settings_popover_footer"):null,v=null,C=document.getElementById("aipkit_deploy_settings_popover"),P=C?C.querySelector(".aipkit_deploy_settings_popover_panel"):null,$=C?C.querySelector(".aipkit_deploy_settings_popover_close"):null,U=null,B="root",D=y?y.querySelector(".aipkit_builder_sheet_title"):null,N=y?y.querySelector(".aipkit_builder_sheet_description"):null,R=y?y.querySelector(".aipkit_builder_sheet_body"):null,j=y?y.querySelectorAll(".aipkit_builder_sheet_section"):[],L=y?y.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'):null,K=y?y.querySelector(".aipkit_builder_sheet_close"):null,V=e.querySelector(".aipkit_builder_rename_btn"),ee=document.getElementById("aipkit_builder_rename_bot_modal"),J=ee?ee.querySelector(".aipkit_builder_rename_bot_close"):null,le=ee?ee.querySelector("#aipkit_rename_bot_name"):null,ue=ee?ee.querySelector("#aipkit_rename_bot_btn"):null,be=ee?ee.querySelector("#aipkit_rename_bot_message"):null,ze=e.querySelector(".aipkit_bot_name_input"),Me=e.querySelector('textarea[name="instructions"]'),rt=e.querySelector(".aipkit_builder_instructions_expand"),Ue=document.getElementById("aipkit_builder_instructions_modal"),vt=Ue?Ue.querySelector(".aipkit_builder_instructions_close"):null,we=Ue?Ue.querySelector(".aipkit_builder_instructions_modal_textarea"):null,pt=Ue?Ue.querySelector(".aipkit_builder_instructions_count"):null,st=e.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),bt=e.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),wt=e.querySelector(".aipkit_training_text_input"),Ht=e.querySelector("#aipkit_training_qa_question"),se=e.querySelector("#aipkit_training_qa_answer"),me=e.querySelector("#aipkit_training_files_input"),de=e.querySelector(".aipkit_training_files_button"),ve=e.querySelector(".aipkit_builder_dropzone"),qe=e.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),Se=e.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),Je=e.querySelector(".aipkit_training_stop_btn"),nt=e.querySelector(".aipkit_builder_card--training .aipkit_builder_action_row"),Vt=e.querySelector("#aipkit_training_status"),ai=e.querySelector("#aipkit_training_file_list"),ti=new Map,Ft=null,ht={page:1,selectedIds:new Set},Le=e.querySelector(".aipkit_training_sources_btn"),Te=e.querySelector("#aipkit_vs_wp_content_messages_area"),xt=e.querySelector("#aipkit_vs_wp_content_mode"),Kt=e.querySelector("#aipkit_vs_load_wp_content_btn"),yt=e.querySelector("#aipkit_vs_global_target_select"),ot=e.querySelector("#aipkit_vs_wp_content_status"),Li=e.querySelector("#aipkit_vs_wp_content_status_specific"),yi=e.querySelector("#aipkit_vs_wp_content_list_area"),Zt=e.querySelector("#aipkit_vs_wp_content_pagination"),Nt=e.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Jt=e.querySelector("#aipkit_wp_content_bulk_panel"),Pi=e.querySelector("#aipkit_wp_content_specific_panel"),Hi=e.querySelector("#aipkit_wp_content_bulk_hint"),ji=e.querySelector("#aipkit_wp_content_specific_types_panel"),ii=e.querySelector("#aipkit_wp_content_status_wrap_bulk"),pe=e.querySelector("#aipkit_wp_content_status_wrap_specific"),xe=y?y.querySelector('.aipkit_builder_sheet_section[data-sheet="sources"]'):null,ke=xe?xe.querySelector("#aipkit_sources_table_body"):null,tt=xe?xe.querySelector(".aipkit_sources_search_input"):null,Ye=xe?xe.querySelector(".aipkit_sources_filter_select"):null,Ot=xe?xe.querySelector(".aipkit_sources_refresh_btn"):null,qt=xe?xe.querySelector("#aipkit_sources_pagination"):null,kt=xe?xe.querySelector("#aipkit_sources_status"):null,zt=xe?xe.querySelector("#aipkit_sources_provider_label"):null,Dt=xe?xe.querySelector("#aipkit_sources_store_label"):null,it=document.getElementById("aipkit_sources_editor_modal"),Wt=it?it.querySelector(".aipkit_sources_editor_textarea"):null,Ae=it?it.querySelector(".aipkit_sources_editor_close"):null,Lt=it?it.querySelector(".aipkit_sources_editor_cancel"):null,ut=it?it.querySelector(".aipkit_sources_editor_save"):null,ft=document.getElementById("aipkit_sources_delete_modal"),Ri=ft?ft.querySelector(".aipkit_sources_delete_close"):null,_n=ft?ft.querySelector(".aipkit_sources_delete_cancel"):null,Di=ft?ft.querySelector(".aipkit_sources_delete_confirm"):null,at=document.getElementById("aipkit_image_settings_flyout"),Ui=at?at.querySelector(".aipkit_popover_flyout_close"):null,pi=null,Mt=document.getElementById("aipkit_parameters_flyout"),$n=Mt?Mt.querySelector(".aipkit_popover_flyout_close"):null,vi=null,oi=document.getElementById("aipkit_popup_hint_flyout"),Ni=oi?oi.querySelector(".aipkit_popover_flyout_close"):null,Vi=null,ni=document.getElementById("aipkit_security_privacy_flyout"),un=ni?ni.querySelector(".aipkit_popover_flyout_close"):null,Yn=h?h.querySelector('[data-aipkit-settings-panel="safety"]'):null,ki=null,ci=document.getElementById("aipkit_starters_flyout"),uo=ci?ci.querySelector(".aipkit_popover_flyout_close"):null,$i=null,fi=document.getElementById("aipkit_custom_theme_flyout"),on=fi?fi.querySelector(".aipkit_popover_flyout_close"):null,xi=null,bi=null,St=document.getElementById("aipkit_builder_web_settings_modal"),Fn=St?St.querySelector(".aipkit_builder_web_settings_close"):null,Tt=document.getElementById("aipkit_builder_context_settings_modal"),fn=Tt?Tt.querySelector(".aipkit_builder_context_settings_close"):null,Nn=h?h.querySelector('[data-aipkit-settings-panel="context"]'):null,Si=null,ei=document.getElementById("aipkit_builder_token_limits_modal"),Oi=ei?ei.querySelector(".aipkit_builder_token_limits_close"):null,zi=h?h.querySelector('[data-aipkit-settings-panel="limits"]'):null,Ci=null,Oe=document.getElementById("aipkit_builder_audio_settings_modal"),vn=Oe?Oe.querySelector(".aipkit_builder_audio_settings_close"):null,Ii=null,gi=e.querySelector("#aipkit_builder_popup_settings_panel"),li=document.getElementById("aipkit_chatbot_global_save_status_container"),Be=(q,F)=>{if(!li)return;let T=li.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_model_sync_status");T&&q&&(T.textContent="",T.classList.remove("success","error","loading")),li.textContent=q,li.className="aipkit_save_status_container",F&&li.classList.add(F)},si=()=>{li&&setTimeout(()=>{li.textContent="",li.className="aipkit_save_status_container"},2500)},fo=()=>{let q=at&&at.querySelector('input[name="replicate_api_key"]')||h&&h.querySelector('input[name="replicate_api_key"]')||y?.querySelector('input[name="replicate_api_key"]');return q?String(q.value||"").trim():""},mo=q=>{if(!(q!==void 0?String(q||"").trim():fo())||typeof window.aipkit_queueProviderSync!="function")return null;Be("Syncing models...","loading");let T=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return T&&typeof T.then=="function"&&T.then(()=>{Be("Models synced!","success"),si()}).catch(W=>{Be(`Error: ${W?.message||"Sync failed."}`,"error"),si()}),T},go=e.dataset.modelSettingsTitle||"Settings",an=q=>{if(!h||!q)return;let F=q.getBoundingClientRect(),T=h.getBoundingClientRect(),W=T.width||420,Y=T.height||0,te=window.innerWidth,ne=window.innerHeight,G=12,O=F.right+10;O+W>te-G&&(O=F.left-W-10),O=Math.max(G,Math.min(O,te-W-G));let z=F.top;z+Y>ne-G&&(z=ne-Y-G),z=Math.max(G,z),h.style.left=`${Math.round(O)}px`,h.style.top=`${Math.round(z)}px`,Mt&&Mt.classList.contains("is-open")&&vi&&Ji(vi),at&&at.classList.contains("is-open")&&pi&&Yi(pi),St&&St.classList.contains("is-open")&&bi&&Xn(bi),Tt&&Tt.classList.contains("is-open")&&Si&&rn(Si),ei&&ei.classList.contains("is-open")&&Ci&&en(Ci),Oe&&Oe.classList.contains("is-open")&&Ii&&Wn(Ii)},bn=q=>{if(!P||!q)return;let F=q.getBoundingClientRect(),T=P.getBoundingClientRect(),W=T.width||420,Y=T.height||0,te=window.innerWidth,ne=window.innerHeight,G=12,O=F.right+10;O+W>te-G&&(O=F.left-W-10),O=Math.max(G,Math.min(O,te-W-G));let z=F.top;z+Y>ne-G&&(z=ne-Y-G),z=Math.max(G,z),P.style.left=`${Math.round(O)}px`,P.style.top=`${Math.round(z)}px`},Qi=q=>{if(!S)return;let F=Array.from(S.querySelectorAll("[data-aipkit-settings-panel]"));if(!F.length)return;let T=q||"root",W=S.querySelector(`[data-aipkit-settings-panel="${T}"]`)||S.querySelector('[data-aipkit-settings-panel="root"]');if(!W)return;let Y=W.dataset.aipkitSettingsPanel||"root";if(Y!==B&&((()=>{Mt&&(Mt.classList.remove("is-open"),Mt.setAttribute("aria-hidden","true")),vi&&(vi.setAttribute("aria-expanded","false"),vi=null),at&&(at.classList.remove("is-open"),at.setAttribute("aria-hidden","true")),pi&&(pi.setAttribute("aria-expanded","false"),pi=null),ni&&(ni.classList.remove("is-open"),ni.setAttribute("aria-hidden","true")),ki&&(ki.setAttribute("aria-expanded","false"),ki=null),St&&(St.classList.remove("is-open"),St.setAttribute("aria-hidden","true")),bi&&(bi.setAttribute("aria-expanded","false"),bi=null),Tt&&(Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true")),Si&&(Si.setAttribute("aria-expanded","false"),Si=null),ei&&(ei.classList.remove("is-open"),ei.setAttribute("aria-hidden","true")),Ci&&(Ci.setAttribute("aria-expanded","false"),Ci=null),Oe&&(Oe.classList.remove("is-open"),Oe.setAttribute("aria-hidden","true")),Ii&&(Ii.setAttribute("aria-expanded","false"),Ii=null),ci&&(ci.classList.remove("is-open"),ci.setAttribute("aria-hidden","true")),$i&&($i.setAttribute("aria-expanded","false"),$i=null),fi&&(fi.classList.remove("is-open"),fi.setAttribute("aria-hidden","true")),xi&&(xi.setAttribute("aria-expanded","false"),xi=null)})(),B=Y),F.forEach(ne=>{ne.hidden=ne!==W}),b){let ne={root:S.dataset.titleRoot||"Settings",appearance:S.dataset.titleAppearance||"Appearance",behavior:S.dataset.titleBehavior||"Behavior",context:S.dataset.titleContext||"Context",tools:S.dataset.titleTools||"Tools",safety:S.dataset.titleSafety||"Safety",limits:S.dataset.titleLimits||"Limits"};b.textContent=ne[Y]||ne.root}A&&(A.hidden=Y==="root"),x&&(x.hidden=Y!=="root"),Y==="behavior"&&jn(W),Y==="limits"&&Un(),S.classList.contains("aipkit-active")&&v&&window.requestAnimationFrame(()=>{an(v)})},Ji=q=>{if(!Mt||!q)return;let F=q.getBoundingClientRect(),T=h?h.getBoundingClientRect():null,W=T&&T.width>0&&T.height>0,Y=Mt.getBoundingClientRect(),te=Y.width||320,ne=Y.height||260,G=window.innerWidth,O=window.innerHeight,z=12,ae=(T?T.right:F.right)+8;ae+te>G-z&&(ae=(T?T.left:F.left)-te-8),ae=Math.max(z,Math.min(ae,G-te-z));let ge=T?T.top:F.top-8;ge+ne>O-z&&(ge=O-ne-z),ge<z&&(ge=z),Mt.style.left=`${Math.round(ae)}px`,Mt.style.top=`${Math.round(ge)}px`},Yi=q=>{if(!at||!q)return;let F=q.getBoundingClientRect(),T=h?h.getBoundingClientRect():null,W=at.getBoundingClientRect(),Y=W.width||340,te=W.height||220,ne=window.innerWidth,G=window.innerHeight,O=12,z=(T?T.right:F.right)+8;z+Y>ne-O&&(z=(T?T.left:F.left)-Y-8),z=Math.max(O,Math.min(z,ne-Y-O));let ae=T?T.top:F.top-8;ae+te>G-O&&(ae=G-te-O),ae<O&&(ae=O),at.style.left=`${Math.round(z)}px`,at.style.top=`${Math.round(ae)}px`},Sn=q=>{if(!oi||!q)return;let F=q.getBoundingClientRect(),T=P?P.getBoundingClientRect():null,W=oi.getBoundingClientRect(),Y=W.width||320,te=W.height||240,ne=window.innerWidth,G=window.innerHeight,O=12,z=(usePanelRect?T.right:F.right)+8;z+Y>ne-O&&(z=(usePanelRect?T.left:F.left)-Y-8),z=Math.max(O,Math.min(z,ne-Y-O));let ae=usePanelRect?T.top:F.top-8;ae+te>G-O&&(ae=G-te-O),ae<O&&(ae=O),oi.style.left=`${Math.round(z)}px`,oi.style.top=`${Math.round(ae)}px`},On=q=>{if(!ci||!q)return;let F=q.getBoundingClientRect(),T=h?h.getBoundingClientRect():null,W=ci.getBoundingClientRect(),Y=W.width||400,te=W.height||240,ne=window.innerWidth,G=window.innerHeight,O=12,z=(T?T.right:F.right)+8;z+Y>ne-O&&(z=(T?T.left:F.left)-Y-8),z=Math.max(O,Math.min(z,ne-Y-O));let ae=T?T.top:F.top-8;ae+te>G-O&&(ae=G-te-O),ae<O&&(ae=O),ci.style.left=`${Math.round(z)}px`,ci.style.top=`${Math.round(ae)}px`},Rn=q=>{if(!ni||!q)return;let F=q.getBoundingClientRect(),T=h?h.getBoundingClientRect():null,W=T&&T.width>0&&T.height>0,te=ni.getBoundingClientRect().width||400,ne=window.innerWidth,G=window.innerHeight,O=12,z=(W?T.right:F.right)+8;z+te>ne-O&&(z=(W?T.left:F.left)-te-8),z=Math.max(O,Math.min(z,ne-te-O));let ae=W?G-T.bottom:G-F.bottom,ge=Math.max(O,ae);ni.style.left=`${Math.round(z)}px`,ni.style.top="auto",ni.style.bottom=`${Math.round(ge)}px`},Dn=q=>{if(!fi||!q)return;let F=q.getBoundingClientRect();if(F.width===0&&F.height===0&&e){let he=e.querySelector('.aipkit_theme_choice_card input[name="theme"][value="custom"]')?.closest(".aipkit_theme_choice_card");if(he){let Ke=he.getBoundingClientRect();(Ke.width>0||Ke.height>0)&&(F=Ke)}}let T=h?h.getBoundingClientRect():null,W=T&&T.width>0&&T.height>0,Y=fi.getBoundingClientRect(),te=Y.width||400,ne=Y.height||260,G=window.innerWidth,O=window.innerHeight,z=12,ae=(W?T.right:F.right)+8;ae+te>G-z&&(ae=(W?T.left:F.left)-te-8),ae=Math.max(z,Math.min(ae,G-te-z));let ge=W?T.top:F.top-8;ge+ne>O-z&&(ge=O-ne-z),ge<z&&(ge=z),fi.style.left=`${Math.round(ae)}px`,fi.style.top=`${Math.round(ge)}px`},Xn=q=>{if(!St||!q)return;let F=h?h.getBoundingClientRect():null,T=q.getBoundingClientRect(),W=St.querySelector(".aipkit-modal-content"),Y=W?W.getBoundingClientRect():null,te=Y?Y.width:520,ne=window.innerWidth,G=window.innerHeight,O=12,z=(F?F.right:T.right)+8;z+te>ne-O&&(z=(F?F.left:T.left)-te-8),z=Math.max(O,Math.min(z,ne-te-O));let ae=F?G-F.bottom:O,ge=Math.max(O,ae);St.style.left=`${Math.round(z)}px`,St.style.top="auto",St.style.bottom=`${Math.round(ge)}px`},rn=q=>{if(!Tt||!q)return;let F=h?h.getBoundingClientRect():null,T=q.getBoundingClientRect(),W=Tt.querySelector(".aipkit-modal-content"),Y=W?W.getBoundingClientRect():null,te=Y?Y.width:560,ne=window.innerWidth,G=12,O=(F?F.right:T.right)+8;O+te>ne-G&&(O=(F?F.left:T.left)-te-8),O=Math.max(G,Math.min(O,ne-te-G));let z=F?F.top:G;Tt.style.left=`${Math.round(O)}px`,Tt.style.top=`${Math.round(z)}px`},en=q=>{if(!ei||!q)return;let F=h?h.getBoundingClientRect():null,T=q.getBoundingClientRect(),W=ei.querySelector(".aipkit-modal-content"),Y=W?W.getBoundingClientRect():null,te=Y?Y.width:620,ne=Y?Y.height:400,G=window.innerWidth,O=12,z=(F?F.right:T.right)+8;z+te>G-O&&(z=(F?F.left:T.left)-te-8),z=Math.max(O,Math.min(z,G-te-O));let ae=F?F.bottom-ne:T.top-12;ae<O&&(ae=O),ei.style.left=`${Math.round(z)}px`,ei.style.top=`${Math.round(ae)}px`},Wn=q=>{if(!Oe||!q)return;let F=h?h.getBoundingClientRect():null,T=q.getBoundingClientRect(),W=Oe.querySelector(".aipkit-modal-content"),Y=W?W.getBoundingClientRect():null,te=Y?Y.width:520,ne=window.innerWidth,G=window.innerHeight,O=12,z=(F?F.right:T.right)+8;z+te>ne-O&&(z=(F?F.left:T.left)-te-8),z=Math.max(O,Math.min(z,ne-te-O));let ae=F?G-F.bottom:O,ge=Math.max(O,ae);Oe.style.left=`${Math.round(z)}px`,Oe.style.top="auto",Oe.style.bottom=`${Math.round(ge)}px`},Bt=q=>{!S||!h||!q||(y&&y.classList.contains("aipkit-active")&&(y.classList.remove("aipkit-active"),y.setAttribute("aria-hidden","true")),C&&C.classList.contains("aipkit-active")&&mn(),Qi("root"),v=q,S.classList.add("aipkit-active"),S.setAttribute("aria-hidden","false"),q.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_model_settings_popover"),jn(h),En(),ln(),Vn(),window.requestAnimationFrame(()=>{an(q)}))},sn=()=>{S&&(Qi("root"),St&&(St.classList.remove("is-open"),St.setAttribute("aria-hidden","true")),bi&&(bi.setAttribute("aria-expanded","false"),bi=null),Tt&&(Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true")),Si&&(Si.setAttribute("aria-expanded","false"),Si=null),ei&&(ei.classList.remove("is-open"),ei.setAttribute("aria-hidden","true")),Ci&&(Ci.setAttribute("aria-expanded","false"),Ci=null),Oe&&(Oe.classList.remove("is-open"),Oe.setAttribute("aria-hidden","true")),Ii&&(Ii.setAttribute("aria-expanded","false"),Ii=null),Mt&&(Mt.classList.remove("is-open"),Mt.setAttribute("aria-hidden","true")),vi&&(vi.setAttribute("aria-expanded","false"),vi=null),at&&(at.classList.remove("is-open"),at.setAttribute("aria-hidden","true")),pi&&(pi.setAttribute("aria-expanded","false"),pi=null),ni&&(ni.classList.remove("is-open"),ni.setAttribute("aria-hidden","true")),ki&&(ki.setAttribute("aria-expanded","false"),ki=null),S.classList.remove("aipkit-active"),S.setAttribute("aria-hidden","true"),v&&v.setAttribute("aria-expanded","false"),v=null)},Zn=q=>{!C||!P||!q||(y&&y.classList.contains("aipkit-active")&&(y.classList.remove("aipkit-active"),y.setAttribute("aria-hidden","true")),S&&S.classList.contains("aipkit-active")&&sn(),U=q,C.classList.add("aipkit-active"),C.setAttribute("aria-hidden","false"),q.setAttribute("aria-expanded","true"),window.requestAnimationFrame(()=>{bn(q)}))},mn=()=>{C&&(In(),C.classList.remove("aipkit-active"),C.setAttribute("aria-hidden","true"),U&&(U.setAttribute("aria-expanded","false"),U=null))},Io=()=>{if(!h)return;let q=e.querySelector(".aipkit_chatbot_provider_select"),F=q?q.value:"",T=h.querySelector(".aipkit_web_search_toggle_openai"),W=h.querySelector(".aipkit_web_search_toggle_google");T&&(T.style.display=F==="OpenAI"?"":"none"),W&&(W.style.display=F==="Google"?"":"none");let Y=h.querySelector(".aipkit_openai_web_search_enable_toggle"),te=h.querySelector(".aipkit_google_search_grounding_enable_toggle"),ne=h.querySelector('.aipkit_web_search_config_btn[data-web-provider="openai"]'),G=h.querySelector('.aipkit_web_search_config_btn[data-web-provider="google"]'),O=z=>z?z.tagName==="SELECT"?z.value==="1":z.type==="checkbox"?z.checked:z.value==="1":!1;ne&&(ne.style.display=O(Y)?"":"none"),G&&(G.style.display=O(te)?"":"none")},En=()=>{let q=e.querySelector(".aipkit_chatbot_provider_select"),F=q?q.value:"",T=St||y;if(T){let W=T.querySelector(".aipkit_web_modal_section_openai"),Y=T.querySelector(".aipkit_web_modal_section_google");W&&(W.style.display=F==="OpenAI"?"":"none"),Y&&(Y.style.display=F==="Google"?"":"none"),typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(T),typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(T),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(T),typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(T)}Io()},ko=()=>{let q=h&&h.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return q?q.tagName==="SELECT"?q.value==="1"?"1":"0":q.checked?"1":"0":"0"},Hn=()=>{if(!h)return"0";let q=h.querySelector(".aipkit_file_upload_toggle_select");return!q||q.disabled?"0":q.tagName==="SELECT"?q.value==="1"?"1":"0":q.checked?"1":"0"},Mi=()=>Nn||Tt,wo=()=>zi||ei,Gi=()=>{let q=Mi();return q?{providerSelect:q.querySelector('[name="vector_store_provider"]'),openaiStoresSelect:q.querySelector('select[name="openai_vector_store_ids[]"]'),pineconeIndexSelect:q.querySelector('[name="pinecone_index_name"]'),qdrantCollectionsSelect:q.querySelector('select[name="qdrant_collection_names[]"]'),pineconeKeyInput:q.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:q.querySelector('[name="qdrant_url"]'),qdrantKeyInput:q.querySelector('[name="qdrant_api_key"]')}:{}},eo=q=>q?Array.from(q.options).filter(F=>!F.disabled&&F.value):[],xn=q=>q?(q.selectedOptions?Array.from(q.selectedOptions):[]).some(T=>!T.disabled&&T.value):!1,ho=q=>{if(!q)return!1;let F=q.options[q.selectedIndex];if(F&&!F.disabled&&F.value)return!0;let T=eo(q)[0];return T?(q.value=T.value,q.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},Cn=q=>{if(!q)return!1;if(xn(q))return!0;let F=eo(q)[0];return F?(F.selected=!0,q.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},to=q=>{if(!h)return;let F=h.querySelector(".aipkit_vector_store_popover_row .aipkit_popover_warning");if(F){if(!q){F.classList.remove("is-visible"),F.setAttribute("aria-hidden","true"),F.setAttribute("data-tooltip",""),F.removeAttribute("aria-label");return}F.classList.add("is-visible"),F.setAttribute("aria-hidden","false"),F.setAttribute("data-tooltip",q),F.setAttribute("aria-label",q)}},gn=()=>{if(Hn()!=="1"){to("");return}let{providerSelect:q,openaiStoresSelect:F,pineconeIndexSelect:T,qdrantCollectionsSelect:W,pineconeKeyInput:Y,qdrantUrlInput:te,qdrantKeyInput:ne}=Gi(),G=q?q.value:"",O=!!(Y&&Y.value.trim()),z=!!(te&&te.value.trim()),ae=!!(ne&&ne.value.trim()),ge=xn(F),he=xn(T),Ke=xn(W),lt="";G?G==="openai"?t?ge||(lt="No OpenAI vector stores found. Create a vector store."):lt="Add your OpenAI API key to enable OpenAI vector stores.":G==="pinecone"?O?he||(lt="No Pinecone indexes found. Create an index."):lt="Add your Pinecone API key to enable Pinecone.":G==="qdrant"?!z&&!ae?lt="Add your Qdrant URL and API key to enable Qdrant.":z?ae?Ke||(lt="No Qdrant collections found. Create a collection."):lt="Add your Qdrant API key to enable Qdrant.":lt="Add your Qdrant URL to enable Qdrant.":lt="Select and configure a vector provider to use file uploads.":lt="Select and configure a vector provider to use file uploads.",to(lt)},io=()=>{let q=Mi();if(!h||!q)return;let F=h.querySelector(".aipkit_vector_store_enable_select");F&&!F.checked&&(F.checked=!0,F.dispatchEvent(new Event("change",{bubbles:!0})));let{providerSelect:T,openaiStoresSelect:W,pineconeIndexSelect:Y,qdrantCollectionsSelect:te,pineconeKeyInput:ne,qdrantUrlInput:G,qdrantKeyInput:O}=Gi(),z=!!(ne&&ne.value.trim()),ae=!!(G&&G.value.trim()),ge=!!(O&&O.value.trim()),he="";t?he="openai":z?he="pinecone":(ge||ae)&&(he="qdrant"),T&&he&&T.value!==he&&(T.value=he,T.dispatchEvent(new Event("change",{bubbles:!0}))),he==="openai"?Cn(W):he==="pinecone"?ho(Y):he==="qdrant"&&Cn(te),gn()},qo=()=>{if(!h)return;let q=h.querySelector(".aipkit_file_upload_toggle_select");if(!q)return;let F=q.closest(".aipkit_popover_option_row"),T=F?F.querySelector(".aipkit_popover_option_label"):null,W=q.dataset.isProPlan==="true",Y=W,te=q.dataset.tooltipDefault||"";W||(te=q.dataset.tooltipUpgrade||te,Y=!1),F&&F.classList.toggle("aipkit_popover_option_row--disabled",!Y),q.disabled=!Y,T&&T.setAttribute("data-tooltip",te);let ne=q.tagName==="SELECT"?q.value==="1":q.checked;!Y&&ne&&(q.tagName==="SELECT"?q.value="0":q.checked=!1,q.dispatchEvent(new Event("change",{bubbles:!0})))},cn=()=>{let q=Mi();q&&(typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(q),typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(q))},Vn=()=>{if(!h)return;let q=ko()==="1",F=h.querySelector(".aipkit_file_upload_toggle_select");!q&&F&&!F.disabled&&(F.tagName==="SELECT"?F.value==="1":F.checked)&&(F.tagName==="SELECT"?F.value="0":F.checked=!1,F.dispatchEvent(new Event("change",{bubbles:!0}))),cn(),qo(),gn()},Un=()=>{let q=wo();if(!q)return;let F=q.querySelector(".aipkit_token_limit_mode_select"),T=q.querySelector(".aipkit_token_general_user_limit_field"),W=q.querySelector(".aipkit_token_role_limits_container");if(!F||!T||!W)return;let Y=F.value;T.style.display=Y==="general"?"block":"none",W.style.display=Y==="role_based"?"block":"none"},tn=()=>{if(!Oe)return;let q=Oe.querySelector(".aipkit_voice_input_toggle_switch"),F=et=>et?et.tagName==="SELECT"?et.value==="1":et.type==="checkbox"?et.checked:et.value==="1":!1,T=Oe.querySelector(".aipkit_stt_provider_conditional_row"),W=Oe.querySelector(".aipkit_stt_provider_row"),Y=W&&W.dataset.sttControlsHidden==="1";if(q){let et=F(q);if(W&&(W.style.display=et&&!Y?"block":"none"),T&&(T.style.display=et&&!Y?"flex":"none"),et&&Y&&W){let Pt=W.dataset.sttDefaultProvider,ri=W.dataset.sttDefaultModel,Ut=Oe.querySelector(".aipkit_stt_provider_select"),gt=Oe.querySelector('[name="stt_openai_model_id"]'),jt=(Ct,_i,di)=>{if(!Ct||!_i)return;if(!Array.from(Ct.options).some(Ce=>Ce.value===_i)){let Ce=new Option(di||_i,_i,!0,!0);Ct.add(Ce)}Ct.value=_i};jt(Ut,Pt),jt(gt,ri,"whisper-1")}}typeof window.aipkit_toggleSttModelFields=="function"&&window.aipkit_toggleSttModelFields(Oe);let te=Oe.querySelector(".aipkit_tts_toggle_switch"),ne=Oe.querySelector(".aipkit_tts_conditional_settings"),G=Oe.querySelector(".aipkit_tts_provider_row"),O=Oe.querySelector(".aipkit_tts_auto_play_container"),z=!1;te&&(z=F(te),G&&(G.style.display=z?"block":"none"),ne&&(ne.style.display=z?"flex":"none"),O&&(O.style.display=z?"block":"none"));let ae=Oe.querySelector(".aipkit_tts_provider_select");if(ae){let et=ae.value;Oe.querySelectorAll(".aipkit_tts_field").forEach(Ct=>{let _i=Ct.getAttribute("data-provider");Ct.style.display=z&&_i===et?"block":"none"});let Pt=Oe.querySelector(".aipkit_tts_google_voice_inline"),ri=Oe.querySelector(".aipkit_tts_openai_voice_inline"),Ut=Oe.querySelector(".aipkit_tts_openai_model_inline"),gt=Oe.querySelector(".aipkit_tts_elevenlabs_voice_inline"),jt=Oe.querySelector(".aipkit_tts_elevenlabs_model_inline");Pt&&(Pt.style.display=z&&et==="Google"?"block":"none"),ri&&(ri.style.display=z&&et==="OpenAI"?"block":"none"),Ut&&(Ut.style.display=z&&et==="OpenAI"?"block":"none"),gt&&(gt.style.display=z&&et==="ElevenLabs"?"block":"none"),jt&&(jt.style.display=z&&et==="ElevenLabs"?"block":"none")}else if(z===!1){Oe.querySelectorAll(".aipkit_tts_field").forEach(jt=>{jt.style.display="none"});let et=Oe.querySelector(".aipkit_tts_google_voice_inline");et&&(et.style.display="none");let Pt=Oe.querySelector(".aipkit_tts_openai_voice_inline");Pt&&(Pt.style.display="none");let ri=Oe.querySelector(".aipkit_tts_openai_model_inline");ri&&(ri.style.display="none");let Ut=Oe.querySelector(".aipkit_tts_elevenlabs_voice_inline");Ut&&(Ut.style.display="none");let gt=Oe.querySelector(".aipkit_tts_elevenlabs_model_inline");gt&&(gt.style.display="none")}let ge=Oe.querySelector(".aipkit_enable_realtime_voice_toggle"),he=Oe.querySelector(".aipkit_realtime_voice_settings_container"),Ke=Oe.querySelector(".aipkit_realtime_voice_inline_controls"),lt=Oe.querySelector(".aipkit_realtime_voice_inline_row"),Xe=he&&he.getAttribute("data-force-visible")==="1"||ge&&F(ge);he&&(he.style.display=Xe?"block":"none"),lt&&(lt.style.display=Xe?"block":"none"),Ke&&(Ke.style.display=Xe?"flex":"none"),Oe.querySelectorAll(".aipkit_rt_dependent").forEach(et=>{et.style.display=Xe?"":"none"})},An=()=>{if(!gi)return;let q=gi.querySelector('select[name="popup_icon_type"]');if(q){let G=gi.querySelector(".aipkit_popup_icon_default_selector_container"),O=gi.querySelector(".aipkit_popup_icon_custom_input_container");G&&(q.value==="default"?G.removeAttribute("hidden"):G.setAttribute("hidden","")),O&&(q.value==="custom"?O.removeAttribute("hidden"):O.setAttribute("hidden",""));let z=gi.querySelectorAll('input[name="popup_icon_type"]');z.length&&z.forEach(ae=>{ae.checked=ae.value===q.value})}let F=gi.querySelector('select[name="header_avatar_type"]');if(F){let G=gi.querySelector(".aipkit_header_avatar_default_selector_container"),O=gi.querySelector(".aipkit_header_avatar_custom_input_container");G&&(F.value==="default"?G.removeAttribute("hidden"):G.setAttribute("hidden","")),O&&(F.value==="custom"?O.removeAttribute("hidden"):O.setAttribute("hidden",""));let z=gi.querySelectorAll('input[name="header_avatar_type"]');z.length&&z.forEach(ae=>{ae.checked=ae.value===F.value})}let T=gi.querySelector('select[name="popup_icon_style"]');if(T){let G=gi.querySelectorAll('input[name="popup_icon_style"]');G.length&&G.forEach(O=>{O.checked=O.value===T.value})}let W=gi.querySelector(".aipkit_popup_hint_toggle_switch"),Y=W?W.checked:!1,te=gi.querySelector(".aipkit_popup_hint_config_btn");te&&(te.style.display=Y?"":"none",Y||te.setAttribute("aria-expanded","false")),!Y&&oi&&oi.classList.contains("is-open")&&In();let ne=oi||gi;if(ne){ne.querySelectorAll(".aipkit_popup_hint_extra").forEach(O=>{Y?O.removeAttribute("hidden"):O.setAttribute("hidden","")});let G=ne.querySelector(".aipkit_popup_hint_conditional_row");G&&(Y?G.removeAttribute("hidden"):G.setAttribute("hidden",""))}},In=()=>{oi&&(oi.classList.remove("is-open"),oi.setAttribute("aria-hidden","true"),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null))},no=()=>{ni&&(ni.classList.remove("is-open"),ni.setAttribute("aria-hidden","true"),ki&&(ki.setAttribute("aria-expanded","false"),ki=null))},oo=()=>{let q=Yn||ni;if(!q)return;let F=q.querySelector('input[name="enable_consent_compliance"]'),T=F?F.checked:!1;q.querySelectorAll(".aipkit_consent_field_row").forEach(W=>{T?W.removeAttribute("hidden"):W.setAttribute("hidden","")}),S&&S.classList.contains("aipkit-active")&&v&&requestAnimationFrame(()=>{an(v)})},Xi=()=>{let q=Yn||ni;if(!q)return;let F=q.querySelector('input[name="openai_moderation_enabled"]'),T=F?F.checked:!1;q.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(W=>{T?W.removeAttribute("hidden"):W.setAttribute("hidden","")}),S&&S.classList.contains("aipkit-active")&&v&&requestAnimationFrame(()=>{an(v)})},yo=()=>{let q=Yn||ni;if(!q)return;let F=e.querySelector(".aipkit_chatbot_provider_select"),W=(F?F.value:"")==="OpenAI";if(q.querySelectorAll(".aipkit_openai_moderation_row").forEach(te=>{te.style.display=W?"":"none"}),W){Xi();return}q.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(te=>{te.setAttribute("hidden","")})},vo=()=>{ci&&(ci.classList.remove("is-open"),ci.setAttribute("aria-hidden","true"),$i&&($i.setAttribute("aria-expanded","false"),$i=null))},Gn=()=>{fi&&(fi.classList.remove("is-open"),fi.setAttribute("aria-hidden","true"),xi&&(xi.setAttribute("aria-expanded","false"),xi=null))},Kn=q=>{if(!fi||!q)return;fi.classList.contains("is-open")||(fi.classList.add("is-open"),fi.setAttribute("aria-hidden","false")),xi&&xi!==q&&xi.setAttribute("aria-expanded","false"),q.setAttribute&&q.setAttribute("aria-expanded","true"),xi=q,window.requestAnimationFrame(()=>{Dn(q)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_custom_theme_flyout")},jn=q=>{if(!q)return;let F=q.querySelector(".aipkit_reasoning_effort_slider"),T=q.querySelector(".aipkit_reasoning_effort_label"),W=q.querySelector('input[name="reasoning_effort"]');if(!F||!T||!W)return;let Y=()=>{let te=[],ne=[];try{F.dataset.reasoningValues&&(te=JSON.parse(F.dataset.reasoningValues)),F.dataset.reasoningLabels&&(ne=JSON.parse(F.dataset.reasoningLabels))}catch{te=[],ne=[]}(!Array.isArray(te)||te.length===0)&&(te=["none","low","medium","high","xhigh"]),(!Array.isArray(ne)||ne.length===0)&&(ne=te.slice());let G=parseInt(F.value,10),O=Number.isNaN(G)?0:Math.min(te.length-1,Math.max(0,G)),z=te[O]||te[0],ae=ne[O]||z;W.value=z,T.textContent=ae};Y(),F.dataset.reasoningBound||(F.addEventListener("input",Y),F.addEventListener("change",Y),F.dataset.reasoningBound="1")},ln=()=>{if(!h)return;let q=e.querySelector(".aipkit_chatbot_provider_select"),T=(q?q.value:"")==="OpenAI",W=h.querySelector(".aipkit_stateful_convo_checkbox"),Y=h.querySelector(".aipkit_stateful_convo_group");W&&(W.disabled=!T),Y&&(Y.style.display=T?"":"none",Y.removeAttribute("title"));let te=h&&h.querySelector(".aipkit_reasoning_effort_field")||Mt&&Mt.querySelector(".aipkit_reasoning_effort_field");te&&(te.style.display=T?"":"none");let ne=h&&h.querySelector(".aipkit_image_analysis_popover_row")||at&&at.querySelector(".aipkit_image_analysis_popover_row");ne&&(ne.style.display=T?"":"none"),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(Mt||h);let G=h.querySelector(".aipkit_model_settings_panel:not([hidden])"),O=G?G.querySelector(".aipkit_popover_options_list"):h.querySelector(".aipkit_popover_options_list");if(O){let z=O.querySelectorAll(".aipkit_popover_option_row");z.forEach(ge=>ge.classList.remove("aipkit_last_visible_row"));let ae=null;z.forEach(ge=>{ge.style.display!=="none"&&(ae=ge)}),ae&&ae.classList.add("aipkit_last_visible_row")}S&&S.classList.contains("aipkit-active")&&v&&an(v)};if(e.dataset.shortcodeCopyBound||(e.addEventListener("click",q=>{let F=q.target.closest(".aipkit_shortcode_pill");if(!F)return;let T=F.dataset.shortcode||F.querySelector(".aipkit_shortcode_text")?.textContent||"";T&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(T,F)}),e.dataset.shortcodeCopyBound="1"),e.dataset.embedCopyBound||(e.addEventListener("click",q=>{let F=q.target.closest(".aipkit_copy_embed_code_btn");if(!F)return;let T=F.dataset.target;if(!T)return;let W=document.getElementById(T);if(!W)return;let Y=W.value||W.textContent||"";Y&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(Y,F)}),e.dataset.embedCopyBound="1"),S&&e.querySelectorAll(".aipkit_cb_ai_settings_toggle").forEach(F=>{F.classList.add("aipkit_model_settings_popover_trigger"),F.setAttribute("aria-haspopup","dialog"),F.setAttribute("aria-expanded","false"),F.setAttribute("aria-controls","aipkit_model_settings_popover"),F.setAttribute("aria-label",go),F.setAttribute("title",go)}),u){let q=u.value||"";u.addEventListener("change",()=>{let F=u.value;if(F){if(F==="__new__"){typeof w=="function"&&w();let T=q||e.getAttribute("data-active-bot-id")||"";if(T)u.value=T;else{let W=Array.from(u.options).find(Y=>Y.value&&Y.value!=="__new__"&&!Y.disabled);W&&(u.value=W.value,q=W.value)}return}q=F;try{localStorage.setItem(g,F)}catch(T){console.warn("AIPKit Chat Builder: Failed to store selected chatbot:",T)}typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:F,layout:s})}})}if(k&&!k.dataset.bound){let q=k.querySelector("#aipkit_new_bot_name");w=()=>{k.classList.add("aipkit-active"),k.setAttribute("aria-hidden","false"),q&&q.focus()};let F=()=>{k.classList.remove("aipkit-active"),k.setAttribute("aria-hidden","true")};f&&f.addEventListener("click",w),E&&E.addEventListener("click",F),k.addEventListener("click",T=>{T.target===k&&F()}),document.addEventListener("keydown",T=>{T.key==="Escape"&&k.classList.contains("aipkit-active")&&F()}),k.dataset.bound="1"}if(V&&ee&&!ee.dataset.bound){let q=()=>{if(V.disabled)return;let T=u&&u.options[u.selectedIndex]?.text||"";le&&(le.value=T,le.focus(),le.select()),be&&(be.textContent="",be.className="aipkit_form-help"),ee.classList.add("aipkit-active"),ee.setAttribute("aria-hidden","false")},F=()=>{ee.classList.remove("aipkit-active"),ee.setAttribute("aria-hidden","true")};V.addEventListener("click",q),J&&J.addEventListener("click",F),ee.addEventListener("click",T=>{T.target===ee&&F()}),document.addEventListener("keydown",T=>{T.key==="Escape"&&ee.classList.contains("aipkit-active")&&F()}),ue&&ue.addEventListener("click",()=>{let T=u&&u.value||e.getAttribute("data-active-bot-id"),W=le?le.value.trim():"";if(!T||!W){be&&(be.textContent=W===""?"Please enter a bot name.":"Select a bot to rename.",be.className="aipkit_form-help aipkit_form-help-error");return}if(typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(ue,"Saving..."),ue.disabled=!0,typeof window.aipkit_apiRequest!="function"){be&&(be.textContent="API unavailable.",be.className="aipkit_form-help aipkit_form-help-error"),ue.disabled=!1;return}window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:T,new_name:W}).then(Y=>{let te=Y.new_name||W;if(u){let ne=u.options[u.selectedIndex];ne&&(ne.text=te)}be&&(be.textContent=Y.message||"Renamed successfully.",be.className="aipkit_form-help aipkit_form-help-success"),F()}).catch(Y=>{be&&(be.textContent=Y.message||"Could not rename the bot.",be.className="aipkit_form-help aipkit_form-help-error")}).finally(()=>{ue.disabled=!1,typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(ue,"Save Name"):ue.textContent="Save Name"})}),ee.dataset.bound="1"}if(y&&!e.dataset.sheetBound){let q=T=>{if(!y)return;S&&S.classList.contains("aipkit-active")&&sn(),C&&C.classList.contains("aipkit-active")&&mn();let W=T.dataset.sheetTitle||"Sheet",Y=T.dataset.sheetDescription||"Settings will appear here.",te=T.dataset.sheetContent||"placeholder";if(D&&(D.textContent=W),N&&(N.textContent=Y),j.length){let ne=!1;j.forEach(G=>{let O=G.dataset.sheet===te;G.hidden=!O,O&&(ne=!0)}),!ne&&L&&(L.hidden=!1)}if(Wi&&(Wi.textContent="",Wi.classList.remove("success","error","loading"),Wi.style.display="none"),te==="triggers"&&typeof window.aipkit_initTriggerBuilderUI=="function"){let ne=u&&u.value||e.getAttribute("data-active-bot-id");ne&&window.aipkit_initTriggerBuilderUI(ne)}y.classList.add("aipkit-active"),y.setAttribute("aria-hidden","false"),K&&K.focus(),te==="sources"&&typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_sheet"),En(),tn(),ln(),An()},F=()=>{y.classList.remove("aipkit-active"),y.setAttribute("aria-hidden","true")};e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_builder_sheet_trigger");W&&(T.preventDefault(),q(W))}),K&&K.addEventListener("click",F),y.addEventListener("click",T=>{T.target===y&&F()}),document.addEventListener("keydown",T=>{T.key==="Escape"&&y.classList.contains("aipkit-active")&&F()}),e.dataset.sheetBound="1"}if(S&&!e.dataset.modelPopoverBound){e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_model_settings_popover_trigger");if(W){if(T.preventDefault(),T.stopPropagation(),S.classList.contains("aipkit-active")&&v===W){sn();return}Bt(W)}}),e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_deploy_settings_trigger");if(W){if(T.preventDefault(),T.stopPropagation(),C&&C.classList.contains("aipkit-active")&&U===W){mn();return}Zn(W)}}),e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_style_settings_trigger");if(!W)return;T.preventDefault(),T.stopPropagation();let Y=W.dataset.aipkitPanelTarget||"appearance";Qi(Y)}),e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_popover_params_config_btn");if(!W||(T.preventDefault(),!Mt))return;let Y=!Mt.classList.contains("is-open");Mt.classList.toggle("is-open",Y),Mt.setAttribute("aria-hidden",Y?"false":"true"),vi&&vi!==W&&vi.setAttribute("aria-expanded","false"),W.setAttribute("aria-expanded",Y?"true":"false"),vi=Y?W:null,Y&&(window.requestAnimationFrame(()=>{Ji(W)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_parameters_flyout"),jn(Mt),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(Mt))}),e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_image_settings_config_btn");if(!W||(T.preventDefault(),!at))return;let Y=!at.classList.contains("is-open");at.classList.toggle("is-open",Y),at.setAttribute("aria-hidden",Y?"false":"true"),pi&&pi!==W&&pi.setAttribute("aria-expanded","false"),W.setAttribute("aria-expanded",Y?"true":"false"),pi=Y?W:null,Y&&(window.requestAnimationFrame(()=>{Yi(W)}),mo())}),e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_popup_hint_config_btn");if(!W||(T.preventDefault(),!oi))return;let Y=!oi.classList.contains("is-open");oi.classList.toggle("is-open",Y),oi.setAttribute("aria-hidden",Y?"false":"true"),Vi&&Vi!==W&&Vi.setAttribute("aria-expanded","false"),W.setAttribute("aria-expanded",Y?"true":"false"),Vi=Y?W:null,Y&&window.requestAnimationFrame(()=>{Sn(W)})}),e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_starters_config_btn");if(!W||(T.preventDefault(),!ci))return;let Y=!ci.classList.contains("is-open");ci.classList.toggle("is-open",Y),ci.setAttribute("aria-hidden",Y?"false":"true"),$i&&$i!==W&&$i.setAttribute("aria-expanded","false"),W.setAttribute("aria-expanded",Y?"true":"false"),$i=Y?W:null,Y&&window.requestAnimationFrame(()=>{On(W)})}),e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_security_privacy_config_btn");if(!W||(T.preventDefault(),!ni))return;let Y=!ni.classList.contains("is-open");ni.classList.toggle("is-open",Y),ni.setAttribute("aria-hidden",Y?"false":"true"),ki&&ki!==W&&ki.setAttribute("aria-expanded","false"),W.setAttribute("aria-expanded",Y?"true":"false"),ki=Y?W:null,Y&&(window.requestAnimationFrame(()=>{Rn(W)}),oo(),yo())}),e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_theme_choice_card");if(!W)return;let Y=W.querySelector('input[name="theme"]');!Y||Y.disabled||Y.value!=="custom"||Kn(W)});let q=()=>{at&&(at.classList.remove("is-open"),at.setAttribute("aria-hidden","true"),pi&&(pi.setAttribute("aria-expanded","false"),pi=null))};Ui&&Ui.addEventListener("click",T=>{T.preventDefault(),q()}),Ni&&Ni.addEventListener("click",T=>{T.preventDefault(),In()}),un&&un.addEventListener("click",T=>{T.preventDefault(),no()}),uo&&uo.addEventListener("click",T=>{T.preventDefault(),vo()}),on&&on.addEventListener("click",T=>{T.preventDefault(),Gn()}),document.addEventListener("click",T=>{!at||!at.classList.contains("is-open")||T.target.closest(".aipkit_image_settings_config_btn")||T.target.closest("#aipkit_image_settings_flyout")||q()}),document.addEventListener("click",T=>{!oi||!oi.classList.contains("is-open")||T.target.closest(".aipkit_popup_hint_config_btn")||T.target.closest("#aipkit_popup_hint_flyout")||In()}),document.addEventListener("click",T=>{!ni||!ni.classList.contains("is-open")||T.target.closest(".aipkit_security_privacy_config_btn")||T.target.closest("#aipkit_security_privacy_flyout")||no()}),document.addEventListener("click",T=>{!ci||!ci.classList.contains("is-open")||T.target.closest(".aipkit_starters_config_btn")||T.target.closest("#aipkit_starters_flyout")||vo()}),document.addEventListener("click",T=>{!fi||!fi.classList.contains("is-open")||T.target.closest(".aipkit_theme_choice_group")||T.target.closest("#aipkit_custom_theme_flyout")||Gn()});let F=()=>{Mt&&(Mt.classList.remove("is-open"),Mt.setAttribute("aria-hidden","true"),vi&&(vi.setAttribute("aria-expanded","false"),vi=null))};if($n&&$n.addEventListener("click",T=>{T.preventDefault(),F()}),document.addEventListener("click",T=>{!Mt||!Mt.classList.contains("is-open")||T.target.closest(".aipkit_popover_params_config_btn")||T.target.closest("#aipkit_parameters_flyout")||F()}),M&&M.addEventListener("click",sn),A&&A.addEventListener("click",()=>{Qi("root")}),S.addEventListener("click",T=>{T.target===S&&sn()}),$&&$.addEventListener("click",mn),C&&C.addEventListener("click",T=>{T.target===C&&mn()}),document.addEventListener("keydown",T=>{T.key==="Escape"&&S.classList.contains("aipkit-active")&&sn(),T.key==="Escape"&&C&&C.classList.contains("aipkit-active")&&mn()}),h&&!h.dataset.footerActionsBound){let T=e.getAttribute("data-default-bot-id")||"",W=()=>u&&u.value||e.getAttribute("data-active-bot-id")||"";h.addEventListener("click",Y=>{let te=Y.target.closest(".aipkit_popover_footer_btn");if(!te)return;Y.preventDefault();let ne=te.getAttribute("data-action"),G=W();if(!(!ne||!G||typeof window.aipkit_apiRequest!="function")){if(ne==="delete"){if(te.disabled||G===T)return;Be("Deleting...",""),window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:G}).then(O=>{Be(O.message||"Deleted","success");try{T&&localStorage.setItem(g,T)}catch{}typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:T||G,layout:s}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(T||G),si()}).catch(O=>{Be(`Error: ${O.message||"Failed to delete."}`,"error"),si()});return}ne==="reset"&&(Be("Resetting...",""),window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:G}).then(O=>{Be(O.message||"Saved","success"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:G,layout:s}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(G),si()}).catch(O=>{Be(`Error: ${O.message||"Failed to reset."}`,"error"),si()}))}}),h.dataset.footerActionsBound="1"}window.addEventListener("resize",()=>{S.classList.contains("aipkit-active")&&v&&an(v),C&&C.classList.contains("aipkit-active")&&U&&bn(U),St&&St.classList.contains("is-open")&&bi&&Xn(bi),Tt&&Tt.classList.contains("is-open")&&Si&&rn(Si),ei&&ei.classList.contains("is-open")&&Ci&&en(Ci),Oe&&Oe.classList.contains("is-open")&&Ii&&Wn(Ii),at&&at.classList.contains("is-open")&&pi&&Yi(pi),oi&&oi.classList.contains("is-open")&&Vi&&Sn(Vi),ni&&ni.classList.contains("is-open")&&ki&&Rn(ki),ci&&ci.classList.contains("is-open")&&$i&&On($i),fi&&fi.classList.contains("is-open")&&xi&&Dn(xi)}),window.addEventListener("scroll",()=>{S.classList.contains("aipkit-active")&&v&&an(v),C&&C.classList.contains("aipkit-active")&&U&&bn(U),St&&St.classList.contains("is-open")&&bi&&Xn(bi),Tt&&Tt.classList.contains("is-open")&&Si&&rn(Si),ei&&ei.classList.contains("is-open")&&Ci&&en(Ci),Oe&&Oe.classList.contains("is-open")&&Ii&&Wn(Ii),at&&at.classList.contains("is-open")&&pi&&Yi(pi),oi&&oi.classList.contains("is-open")&&Vi&&Sn(Vi),ni&&ni.classList.contains("is-open")&&ki&&Rn(ki),ci&&ci.classList.contains("is-open")&&$i&&On($i),fi&&fi.classList.contains("is-open")&&xi&&Dn(xi)},!0),e.dataset.modelPopoverBound="1"}if(Me&&li&&!Me.dataset.autosaveBound){let q=Me.value,F=!1,T=null,W=O=>{pt&&(pt.textContent=`${O.length.toLocaleString()} characters`)},Y=O=>{we&&(we.value=O,W(O))},te=O=>{let z=u&&u.value||e.getAttribute("data-active-bot-id");z&&(F=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_instructions",{bot_id:z,instructions:O}).then(ae=>{q=O,Me.dataset.dirty="0",Be(ae.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(z),si()}).catch(ae=>{Be(`Error: ${ae.message||"Failed to save."}`,"error"),Me.dataset.dirty="1"}).finally(()=>{if(F=!1,T!==null&&T!==q){let ae=T;T=null,te(ae)}else T=null}))},ne=()=>{!Ue||!we||(Y(Me.value),Ue.classList.add("aipkit-active"),Ue.setAttribute("aria-hidden","false"),setTimeout(()=>we.focus(),0))},G=O=>{if(!Ue||(Ue.classList.remove("aipkit-active"),Ue.setAttribute("aria-hidden","true"),!O||!we))return;let z=we.value;if(z!==Me.value&&(Me.value=z,Me.dataset.dirty="1"),Me.dataset.dirty==="1"){if(F){T=Me.value;return}te(Me.value)}};we&&!we.dataset.bound&&(we.addEventListener("input",()=>{W(we.value),Me.dataset.dirty="1"}),we.dataset.bound="1"),Ue&&!Ue.dataset.bound&&(rt&&rt.addEventListener("click",ne),vt&&vt.addEventListener("click",()=>{G(!0)}),document.addEventListener("keydown",O=>{O.key==="Escape"&&Ue.classList.contains("aipkit-active")&&G(!0)}),Ue.dataset.bound="1"),Me.addEventListener("input",()=>{Me.dataset.dirty="1"}),Me.addEventListener("blur",()=>{let O=Me.value;if(Me.dataset.dirty==="1"){if(O===q){Me.dataset.dirty="0";return}if(F){T=O;return}te(O)}}),Me.dataset.autosaveBound="1"}if(st){let q=st.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]"),F=W=>{W&&(q.forEach(Y=>{let te=Y.dataset.aipkitTab===W;Y.classList.toggle("is-active",te),Y.setAttribute("aria-selected",te?"true":"false")}),bt.forEach(Y=>{let te=Y.dataset.aipkitPanel===W;Y.classList.toggle("is-active",te),Y.hidden=!te}),Se&&(Se.style.display=W==="files"?"none":""),nt&&nt.classList.toggle("aipkit_builder_action_row--end",W==="files"))},T=st.querySelector(".aipkit_builder_tab.is-active");T&&F(T.dataset.aipkitTab),q.forEach(W=>{W.addEventListener("click",()=>{F(W.dataset.aipkitTab)})})}let Ki=y?y.querySelector('textarea[name="triggers_json"]'):null,Ei=y?y.querySelector(".aipkit_trigger_builder_container"):null,Wi=y?y.querySelector(".aipkit_triggers_status"):null;if((Ki||Ei)&&li&&!e.dataset.triggersAutosaveBound){let q=Ki?Ki.value:"[]",F=!1,T=null,W=null,Y=()=>{let ge=u&&u.value||e.getAttribute("data-active-bot-id");if(!ge)return null;let he="";if(typeof window.aipkit_getTriggerBuilderState=="function"){let Ke=window.aipkit_getTriggerBuilderState(ge);Ke&&Array.isArray(Ke.triggers)&&(typeof window.aipkit_updateTriggersJsonForSave=="function"&&window.aipkit_updateTriggersJsonForSave(ge,Ke.triggers),he=Ki?Ki.value:JSON.stringify(Ke.triggers,null,2))}return!he&&Ki&&(he=Ki.value),he||(he="[]"),{botId:ge,triggersJson:he}},te=(ge,he)=>{Wi&&(Wi.textContent=ge||"",Wi.classList.remove("success","error","loading"),he&&Wi.classList.add(he),Wi.style.display=ge?"inline-block":"none")},ne=()=>{Wi&&setTimeout(()=>{Wi.textContent="",Wi.classList.remove("success","error","loading"),Wi.style.display="none"},2500)},G=(ge,he)=>{he&&(F=!0,Be("Auto-saving...",""),te("Saving...","loading"),window.aipkit_apiRequest("aipkit_update_chatbot_triggers",{bot_id:he,triggers_json:ge}).then(Ke=>{q=ge,Be(Ke.message||"Saved","success"),te("Saved","success"),si(),ne()}).catch(Ke=>{Be(`Error: ${Ke.message||"Failed to save."}`,"error"),te("Error","error"),ne()}).finally(()=>{if(F=!1,T!==null&&T!==q){let Ke=T;T=null;let lt=Y();lt&&G(Ke,lt.botId)}else T=null}))},O=ge=>{if(ge===q)return;if(F){T=ge;return}let he=Y();he&&G(ge,he.botId)},z=()=>{W&&clearTimeout(W),W=setTimeout(()=>{let ge=Y();ge&&O(ge.triggersJson)},900)};typeof window.aipkit_requestTriggerAutosave!="function"&&(window.aipkit_requestTriggerAutosave=z);let ae=ge=>{ge.target&&ge.target.closest(".aipkit_trigger_builder_container")&&z()};Ei&&(Ei.addEventListener("input",ae),Ei.addEventListener("change",ae),Ei.addEventListener("click",ae)),Ki&&(Ki.addEventListener("input",z),Ki.addEventListener("blur",z)),e.dataset.triggersAutosaveBound="1"}if(St&&!St.dataset.bound){let q=T=>{!St||!T||(St.classList.add("is-open"),St.setAttribute("aria-hidden","false"),T.setAttribute("aria-expanded","true"),bi=T,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_web_settings_modal"),En(),window.requestAnimationFrame(()=>{Xn(T)}))},F=()=>{St.classList.remove("is-open"),St.setAttribute("aria-hidden","true"),bi&&(bi.setAttribute("aria-expanded","false"),bi=null)};e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_web_search_config_btn");if(W){if(T.preventDefault(),St.classList.contains("is-open")&&bi===W){F();return}q(W)}}),Fn&&Fn.addEventListener("click",F),document.addEventListener("click",T=>{St.classList.contains("is-open")&&(T.target.closest(".aipkit_web_search_config_btn")||T.target.closest("#aipkit_builder_web_settings_modal")||F())}),document.addEventListener("keydown",T=>{T.key==="Escape"&&St.classList.contains("is-open")&&F()}),St.dataset.bound="1"}if(Tt&&!Tt.dataset.bound){let q=T=>{!Tt||!T||(Tt.classList.add("is-open"),Tt.setAttribute("aria-hidden","false"),T.setAttribute("aria-expanded","true"),Si=T,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_context_settings_modal"),cn(),window.requestAnimationFrame(()=>{rn(T)}))},F=()=>{Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true"),Si&&(Si.setAttribute("aria-expanded","false"),Si=null)};e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_vector_store_config_btn");if(W){if(T.preventDefault(),Tt.classList.contains("is-open")&&Si===W){F();return}q(W)}}),fn&&fn.addEventListener("click",F),document.addEventListener("click",T=>{Tt.classList.contains("is-open")&&(T.target.closest(".aipkit_vector_store_config_btn")||T.target.closest("#aipkit_builder_context_settings_modal")||F())}),document.addEventListener("keydown",T=>{T.key==="Escape"&&Tt.classList.contains("is-open")&&F()}),Tt.dataset.bound="1"}if(ei&&!ei.dataset.bound){let q=T=>{!ei||!T||(ei.classList.add("is-open"),ei.setAttribute("aria-hidden","false"),T.setAttribute("aria-expanded","true"),Ci=T,Un(),window.requestAnimationFrame(()=>{en(T)}))},F=()=>{ei.classList.remove("is-open"),ei.setAttribute("aria-hidden","true"),Ci&&(Ci.setAttribute("aria-expanded","false"),Ci=null)};e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_limit_usage_config_btn");if(W){if(T.preventDefault(),ei.classList.contains("is-open")&&Ci===W){F();return}q(W)}}),Oi&&Oi.addEventListener("click",F),document.addEventListener("click",T=>{ei.classList.contains("is-open")&&(T.target.closest(".aipkit_limit_usage_config_btn")||T.target.closest("#aipkit_builder_token_limits_modal")||F())}),document.addEventListener("keydown",T=>{T.key==="Escape"&&ei.classList.contains("is-open")&&F()}),ei.dataset.bound="1"}if(Oe&&!Oe.dataset.bound){let q=T=>{!Oe||!T||(Oe.classList.add("is-open"),Oe.setAttribute("aria-hidden","false"),T.setAttribute("aria-expanded","true"),Ii=T,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_audio_settings_modal"),tn(),typeof window.aipkit_syncAudioTtsOnOpen=="function"&&window.aipkit_syncAudioTtsOnOpen().catch(()=>{}),window.requestAnimationFrame(()=>{Wn(T)}))},F=()=>{Oe.classList.remove("is-open"),Oe.setAttribute("aria-hidden","true"),Ii&&(Ii.setAttribute("aria-expanded","false"),Ii=null)};e.addEventListener("click",T=>{let W=T.target.closest(".aipkit_audio_settings_config_btn");if(W){if(T.preventDefault(),Oe.classList.contains("is-open")&&Ii===W){F();return}q(W)}}),vn&&vn.addEventListener("click",F),document.addEventListener("click",T=>{Oe.classList.contains("is-open")&&(T.target.closest(".aipkit_audio_settings_config_btn")||T.target.closest("#aipkit_builder_audio_settings_modal")||F())}),document.addEventListener("keydown",T=>{T.key==="Escape"&&Oe.classList.contains("is-open")&&F()}),Oe.dataset.bound="1"}if(ze&&li&&!ze.dataset.autosaveBound){let q=ze.value.trim(),F=!1,T=null,W=te=>{if(!u)return;let ne=u.options[u.selectedIndex];ne&&(ne.text=te)},Y=te=>{let ne=u&&u.value||e.getAttribute("data-active-bot-id");ne&&(F=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:ne,new_name:te}).then(G=>{let O=(G.new_name||te).trim();q=O,ze.value=O,W(O),Be("Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ne),si()}).catch(G=>{Be(`Error: ${G.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,T!==null&&T!==q){let G=T;T=null,Y(G)}else T=null}))};ze.addEventListener("keydown",te=>{te.key==="Enter"&&(te.preventDefault(),ze.blur())}),ze.addEventListener("blur",()=>{let te=ze.value.trim();if(!te){ze.value=q,Be("Name cannot be empty.","error");return}if(te!==q){if(F){T=te;return}Y(te)}}),ze.dataset.autosaveBound="1"}if(li&&!e.dataset.modelAutosaveBound){let q=e.querySelector(".aipkit_chatbot_provider_select");if(q){let F=!1,T=null,W=O=>{if(!O)return"";let z=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${O}"]`);if(!z)return"";let ae=z.querySelector("select");return ae?ae.value:""},Y=q.value||"",te=W(Y),ne=(O,z)=>{let ae=u&&u.value||e.getAttribute("data-active-bot-id");ae&&(F=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_model_settings",{bot_id:ae,provider:O,model:z}).then(ge=>{if(Y=O,te=z,Be(ge.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ae),si(),typeof window.aipkit_requestChatbotModelSync=="function"){let he=q?q.value||"":O,Ke=W(he);he===O&&Ke===z&&window.aipkit_requestChatbotModelSync(O,{silent:!0})}}).catch(ge=>{Be(`Error: ${ge.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,T){let{provider:ge,model:he}=T;T=null,(ge!==Y||he!==te)&&ne(ge,he)}}))},G=(O,z)=>{if(!(O===Y&&z===te)){if(F){T={provider:O,model:z};return}ne(O,z)}};e.addEventListener("change",O=>{let z=O.target;if(!z)return;if(z.matches(".aipkit_chatbot_provider_select")){let ge=z.value||"",he=W(ge);G(ge,he),S&&S.classList.contains("aipkit-active")&&sn(),En(),ln(),yo();return}let ae=z.closest(".aipkit_chatbot_model_field select");if(ae){let ge=q.value||"",he=ae.value||"";G(ge,he),ln()}})}e.dataset.modelAutosaveBound="1"}if(li&&!e.dataset.deployWizardBound){let q=e.querySelector(".aipkit_deploy_wizard");if(q){let F=Array.from(q.querySelectorAll('input[name="aipkit_deploy_scope"]')),T=Array.from(q.querySelectorAll('input[name="aipkit_deploy_mode"]')),W=Array.from(q.querySelectorAll('input[name="aipkit_deploy_popup_scope"]')),Y=q.querySelector('select[name="aipkit_deploy_scope"]'),te=q.querySelector('select[name="aipkit_deploy_mode"]'),ne=q.querySelector('select[name="aipkit_deploy_popup_scope"]'),G=q.querySelector(".aipkit_deploy_row_mode"),O=q.querySelector(".aipkit_deploy_row_popup_scope"),z=Array.from(q.querySelectorAll("[data-deploy-panel]")),ae=q.querySelector("[data-deploy-popup-shortcode]"),ge=q.querySelector('textarea[name="embed_allowed_domains"]'),he=(He,Qe)=>{let We=He.find(De=>De.checked);return We?We.value:Qe},Ke=()=>Y?Y.value||"site":he(F,"site"),lt=()=>te?te.value||"inline":he(T,"inline"),mt=()=>ne?ne.value||"page":he(W,"page"),Xe=He=>{let Qe=S||y;if(!Qe)return;let We=Qe.querySelector(".aipkit_sidebar_toggle_group");if(!We)return;let De=We.querySelector(".aipkit_sidebar_toggle_switch"),_t=We.querySelector("label");if(!De||!_t)return;let wi=We.getAttribute("data-tooltip-disabled")||"";He?(De.getAttribute("data-original-state")===null&&De.setAttribute("data-original-state",De.checked?"checked":"unchecked"),De.checked=!1,De.disabled=!0,We.setAttribute("title",wi),We.classList.add("aipkit-disabled-tooltip"),_t.style.opacity="0.6"):(De.disabled=!1,We.removeAttribute("title"),We.classList.remove("aipkit-disabled-tooltip"),_t.style.opacity="1",De.getAttribute("data-original-state")==="checked"&&(De.checked=!0),De.removeAttribute("data-original-state"))},et=He=>{let Qe=S||y;if(!Qe)return;let We=Qe.querySelectorAll('[data-popup-only="header-identity"]');We.length&&We.forEach(De=>{De.hidden=!He})},Pt=()=>{let He=Ke(),Qe=lt(),We=mt();G&&(G.hidden=He!=="site"),O&&(O.hidden=!(He==="site"&&Qe==="popup")),z.forEach(_t=>{let wi=_t.dataset.deployPanel,Rt=!1;wi==="external"?Rt=He==="external":wi==="inline"?Rt=He==="site"&&Qe==="inline":wi==="popup"&&(Rt=He==="site"&&Qe==="popup"),_t.hidden=!Rt}),W.forEach(_t=>{_t.disabled=He!=="site"||Qe!=="popup"}),ne&&(ne.disabled=He!=="site"||Qe!=="popup"),te&&(te.disabled=He!=="site"),ae&&(ae.hidden=!(He==="site"&&Qe==="popup"&&We==="page"));let De=He==="site"&&Qe==="popup";Xe(De),et(De),U&&window.requestAnimationFrame(()=>{bn(U)})},ri=Ke()==="site"?{popup_enabled:lt()==="popup"?"1":"0",site_wide_enabled:lt()==="popup"&&mt()==="sitewide"?"1":"0"}:null,Ut=!1,gt=null,jt=()=>{if(Ke()!=="site")return null;let He=lt()==="popup"?"1":"0",Qe=He==="1"&&mt()==="sitewide"?"1":"0";return{popup_enabled:He,site_wide_enabled:Qe}},Ct=He=>{let Qe=u&&u.value||e.getAttribute("data-active-bot-id");!Qe||!He||(Ut=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",{bot_id:Qe,popup_enabled:He.popup_enabled,site_wide_enabled:He.site_wide_enabled}).then(We=>{ri=He,Be(We.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Qe),si()}).catch(We=>{Be(`Error: ${We.message||"Failed to save."}`,"error")}).finally(()=>{if(Ut=!1,gt){let We=gt;gt=null,(!ri||JSON.stringify(We)!==JSON.stringify(ri))&&Ct(We)}}))},_i=He=>{if(He&&!(ri&&JSON.stringify(He)===JSON.stringify(ri))){if(Ut){gt=He;return}Ct(He)}},di=ge?ge.value:"",qi=!1,Ce=null,Pe=He=>{let Qe=u&&u.value||e.getAttribute("data-active-bot-id");Qe&&(qi=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",{bot_id:Qe,embed_allowed_domains:He}).then(We=>{di=He,Be(We.message||"Saved","success"),si()}).catch(We=>{Be(`Error: ${We.message||"Failed to save."}`,"error")}).finally(()=>{if(qi=!1,Ce!==null){let We=Ce;Ce=null,We!==di&&Pe(We)}}))},je=He=>{if(He!==di){if(qi){Ce=He;return}Pe(He)}};q.addEventListener("change",He=>{let Qe=He.target;Qe&&(Qe.matches('input[name="aipkit_deploy_scope"]')||Qe.matches('input[name="aipkit_deploy_mode"]')||Qe.matches('input[name="aipkit_deploy_popup_scope"]')||Qe.matches('select[name="aipkit_deploy_scope"]')||Qe.matches('select[name="aipkit_deploy_mode"]')||Qe.matches('select[name="aipkit_deploy_popup_scope"]'))&&(Pt(),_i(jt()))}),ge&&(ge.addEventListener("blur",()=>{je(ge.value)}),ge.addEventListener("change",()=>{je(ge.value)})),Pt(),e.dataset.deployWizardBound="1"}}if(h&&li&&!e.dataset.aiParamsAutosaveBound){let q=!1,F=null,T=()=>{let z=Ke=>Mt&&Mt.querySelector(Ke)||h.querySelector(Ke),ae=z('[name="temperature"]'),ge=z('[name="max_completion_tokens"]'),he=z('[name="max_messages"]');return{temperature:ae?ae.value:"",maxTokens:ge?ge.value:"",maxMessages:he?he.value:""}},{temperature:W,maxTokens:Y,maxMessages:te}=T(),ne=(z,ae,ge)=>{let he=u&&u.value||e.getAttribute("data-active-bot-id");!he||z===""||ae===""||ge===""||(q=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_ai_parameters",{bot_id:he,temperature:z,max_completion_tokens:ae,max_messages:ge}).then(Ke=>{W=z,Y=ae,te=ge,Be(Ke.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(he),si()}).catch(Ke=>{Be(`Error: ${Ke.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F){let{temperature:Ke,maxTokens:lt,maxMessages:mt}=F;F=null,(Ke!==W||lt!==Y||mt!==te)&&ne(Ke,lt,mt)}}))},G=(z,ae,ge)=>{if(!(z===W&&ae===Y&&ge===te)){if(q){F={temperature:z,maxTokens:ae,maxMessages:ge};return}ne(z,ae,ge)}},O=z=>{let ae=z.target;if(ae&&(ae.matches('[name="temperature"]')||ae.matches('[name="max_completion_tokens"]')||ae.matches('[name="max_messages"]'))){let{temperature:ge,maxTokens:he,maxMessages:Ke}=T();G(ge,he,Ke)}};h.addEventListener("change",O),Mt&&Mt.addEventListener("change",O),e.dataset.aiParamsAutosaveBound="1"}if((St||h)&&li&&!e.dataset.webSettingsAutosaveBound){let q=!1,F=null,T=()=>{let G=z=>{let ae=St?St.querySelector(z):null;return ae?ae.value:""},O=z=>{let ae=h&&h.querySelector(z)||e&&e.querySelector(z)||St&&St.querySelector(z);return ae?ae.tagName==="SELECT"?ae.value==="1"?"1":"0":ae.checked?"1":"0":"0"};return{openai_web_search_enabled:O(".aipkit_openai_web_search_enable_toggle"),openai_web_search_context_size:G('[name="openai_web_search_context_size"]'),openai_web_search_loc_type:G('[name="openai_web_search_loc_type"]'),openai_web_search_loc_country:G('[name="openai_web_search_loc_country"]'),openai_web_search_loc_city:G('[name="openai_web_search_loc_city"]'),openai_web_search_loc_region:G('[name="openai_web_search_loc_region"]'),openai_web_search_loc_timezone:G('[name="openai_web_search_loc_timezone"]'),google_search_grounding_enabled:O(".aipkit_google_search_grounding_enable_toggle"),google_grounding_mode:G('[name="google_grounding_mode"]'),google_grounding_dynamic_threshold:G('[name="google_grounding_dynamic_threshold"]')}},W=T(),Y=G=>{let O=u&&u.value||e.getAttribute("data-active-bot-id");O&&(q=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_web_settings",{bot_id:O,...G}).then(z=>{W=G,Be(z.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),si()}).catch(z=>{Be(`Error: ${z.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F){let z=F;F=null,JSON.stringify(z)!==JSON.stringify(W)&&Y(z)}}))},te=G=>{if(JSON.stringify(G)!==JSON.stringify(W)){if(q){F=G;return}Y(G)}},ne=G=>{let O=G.target;O&&(O.matches(".aipkit_openai_web_search_enable_toggle")||O.matches(".aipkit_openai_web_search_loc_type_select")||O.matches('[name="openai_web_search_context_size"]')||O.matches('[name="openai_web_search_loc_country"]')||O.matches('[name="openai_web_search_loc_city"]')||O.matches('[name="openai_web_search_loc_region"]')||O.matches('[name="openai_web_search_loc_timezone"]')||O.matches(".aipkit_google_search_grounding_enable_toggle")||O.matches(".aipkit_google_grounding_mode_select")||O.matches('[name="google_grounding_dynamic_threshold"]'))&&(En(),te(T()))};h&&h.addEventListener("change",ne),St&&St.addEventListener("change",ne),e.dataset.webSettingsAutosaveBound="1"}if((Tt||h)&&li&&!e.dataset.contextSettingsAutosaveBound){let q=!1,F=null,T=()=>{let Z=X=>{let oe=Mi(),re=oe?oe.querySelector(X):null;return re?re.value:""},ie=X=>{let oe=h&&h.querySelector(X)||e&&e.querySelector(X)||Tt&&Tt.querySelector(X);return oe?oe.tagName==="SELECT"?oe.value==="1"?"1":"0":oe.checked?"1":"0":"0"},H=X=>{let oe=Mi(),re=oe?oe.querySelector(X):null;return re?Array.from(re.selectedOptions).map(ce=>ce.value).filter(Boolean):[]};return{enable_vector_store:ie(".aipkit_vector_store_enable_select"),vector_store_provider:Z('[name="vector_store_provider"]'),openai_vector_store_ids:H('select[name="openai_vector_store_ids[]"]'),pinecone_index_name:Z('[name="pinecone_index_name"]'),qdrant_collection_names:H('select[name="qdrant_collection_names[]"]'),vector_embedding_provider:Z('[name="vector_embedding_provider"]'),vector_embedding_model:Z('[name="vector_embedding_model"]'),vector_store_top_k:Z('[name="vector_store_top_k"]'),vector_store_confidence_threshold:Z('[name="vector_store_confidence_threshold"]'),content_aware_enabled:ie(".aipkit_content_aware_enable_select")}},W=T(),Y=h&&h.closest(".aipkit_model_settings_popover")?.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline")||Tt&&Tt.querySelector(".aipkit_popover_flyout_header .aipkit_popover_status_inline")||Tt&&Tt.querySelector(".aipkit_popover_status_inline")||h&&h.querySelector(".aipkit_popover_status_inline")||null,te=(Z,ie)=>{Y&&(Y.textContent=Z||"",Y.classList.remove("success","error","loading"),ie&&Y.classList.add(ie),Y.style.display=Z?"inline-block":"none")},ne=()=>{Y&&setTimeout(()=>{Y.textContent="",Y.classList.remove("success","error","loading"),Y.style.display="none"},2500)},G=!1,O=null,z={},ae=Mi();ae&&ae.querySelectorAll('[name="pinecone_api_key"], [name="qdrant_url"], [name="qdrant_api_key"]').forEach(Z=>{z[Z.name]=Z.value});let ge=()=>{let{pineconeKeyInput:Z,qdrantUrlInput:ie,qdrantKeyInput:H}=Gi(),X=!!(Z&&Z.value.trim()||d),oe=!!(ie&&ie.value.trim()||l),re=!!(H&&H.value.trim()||a);return{pinecone:X,qdrant:oe&&re}},he=0,Ke=(Z,ie)=>Z?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(Z,{silent:!0,showErrors:!1,targetSelectId:ie,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,Z,{silent:!0,showErrors:!1,targetSelectId:ie,propagateError:!0}):null:null,lt=(Z,ie)=>{let H=++he;te("Syncing...","loading");let X=Ke(Z,ie);if(X&&typeof X.then=="function"){X.then(()=>{he===H&&(te("Synced","success"),ne())}).catch(oe=>{he===H&&te(`Error: ${oe.message||"Sync failed."}`,"error")});return}ne()},mt=Z=>{let ie=ge();if(Z==="pinecone"&&ie.pinecone){let{pineconeIndexSelect:H}=Gi();lt("PineconeIndexes",H?H.id:"")}else if(Z==="qdrant"&&ie.qdrant){let{qdrantCollectionsSelect:H}=Gi();lt("QdrantCollections",H?H.id:"")}},Xe=Z=>{!Z||!Object.keys(Z).length||(G=!0,te("Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",Z).then(ie=>{Object.keys(Z).forEach(H=>{z[H]=Z[H]}),Object.prototype.hasOwnProperty.call(Z,"pinecone_api_key")&&mt("pinecone"),(Object.prototype.hasOwnProperty.call(Z,"qdrant_url")||Object.prototype.hasOwnProperty.call(Z,"qdrant_api_key"))&&mt("qdrant"),te(ie.message||"Saved","success"),ne()}).catch(ie=>{te(`Error: ${ie.message||"Failed to save."}`,"error")}).finally(()=>{if(G=!1,O){let ie=O;O=null,Xe(ie)}}))},et=Z=>{if(!Z)return;let ie=Object.keys(Z).reduce((H,X)=>(Z[X]!==z[X]&&(H[X]=Z[X]),H),{});if(Object.keys(ie).length){if(G){O={...O||{},...ie};return}Xe(ie)}},Pt=Z=>{let ie=u&&u.value||e.getAttribute("data-active-bot-id");ie&&(q=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_context_settings",{bot_id:ie,...Z}).then(H=>{W=Z,Be(H.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ie),si()}).catch(H=>{Be(`Error: ${H.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F){let H=F;F=null,JSON.stringify(H)!==JSON.stringify(W)&&Pt(H)}}))},ri=Z=>{if(JSON.stringify(Z)!==JSON.stringify(W)){if(q){F=Z;return}Pt(Z)}},Ut=Z=>{let ie=Z.target;if(ie){if(ie.matches('[name="pinecone_api_key"]')||ie.matches('[name="qdrant_url"]')||ie.matches('[name="qdrant_api_key"]')){let H=ie.value||"";et({[ie.name]:H}),gn(),Fi(T());return}if(ie.matches(".aipkit_vector_store_enable_select")||ie.matches(".aipkit_vector_store_provider_select")||ie.matches('select[name="openai_vector_store_ids[]"]')||ie.matches('select[name="qdrant_collection_names[]"]')||ie.matches('[name="pinecone_index_name"]')||ie.matches(".aipkit_vector_embedding_select")||ie.matches('[name="vector_embedding_provider"]')||ie.matches('[name="vector_embedding_model"]')||ie.matches('[name="vector_store_top_k"]')||ie.matches('[name="vector_store_confidence_threshold"]')||ie.matches('[name="content_aware_enabled"]')){if(ie.matches(".aipkit_vector_embedding_select")&&Mn(ie),ie.matches(".aipkit_vector_store_enable_select")&&(Vn(),mt(T().vector_store_provider)),ie.matches(".aipkit_vector_store_provider_select")&&(cn(),mt(ie.value||"")),ie.matches('[name="vector_embedding_provider"]')){let X=Mi();X&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(X),lo(X)}if(ie.matches('[name="vector_embedding_model"]')){let X=Mi();lo(X)}let H=T();ri(H),gn(),Fi(H),_i(H),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(1)}}};h&&h.addEventListener("change",Ut),Tt&&Tt.addEventListener("change",Ut);let gt=(Z,ie)=>{Vt&&(Vt.textContent=Z||"",Vt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),Z&&Vt.classList.add("is-visible"),ie&&Vt.classList.add(`is-${ie}`))},jt=(Z=2500)=>{Vt&&setTimeout(()=>{Vt.textContent="",Vt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading")},Z)},Ct=(Z,ie="info")=>{if(Te){if(typeof window.aipkit_showOpenAIVectorStatus=="function"){window.aipkit_showOpenAIVectorStatus(Z||"",ie,Te.id);return}Te.textContent=Z||""}},_i=(Z=null)=>{if(!yt)return;let ie=Z||T();if(!ie||ie.enable_vector_store!=="1"){yt.innerHTML='<option value=""></option>',yt.value="";return}let H="";ie.vector_store_provider==="openai"?H=(Array.isArray(ie.openai_vector_store_ids)?ie.openai_vector_store_ids.filter(Boolean):[])[0]||"":ie.vector_store_provider==="pinecone"?H=ie.pinecone_index_name||"":ie.vector_store_provider==="qdrant"&&(H=(Array.isArray(ie.qdrant_collection_names)?ie.qdrant_collection_names.filter(Boolean):[])[0]||""),yt.innerHTML=H?`<option value="${H}">${H}</option>`:'<option value=""></option>',yt.value=H,yt.dispatchEvent(new Event("change"))},di=()=>xt&&xt.value||"bulk",qi=Z=>{let ie=Z==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",H=document.getElementById(ie);return H?Array.from(H.selectedOptions).map(X=>X.value).filter(Boolean):[]},Ce=Z=>{let ie=Z==="specific"?Li:ot;return ie&&ie.value||"publish"},Pe=()=>{let Z=document.getElementById("aipkit_vs_wp_content_list_area");return Z?Array.from(Z.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(ie=>ie.value):[]},je=(Z,ie,H)=>{if(!ie)return;ie.innerHTML="";let X=Number(Z?.total_posts||0),oe=Number(Z?.total_pages||0),re=Number(Z?.current_page||1);if(!X)return;let ce=document.createElement("span");if(ce.className="aipkit_pagination-count",ce.textContent=`${X.toLocaleString()} ${c("item","items",X,"gpt3-ai-content-generator")}`,ie.appendChild(ce),oe<=1)return;let fe=document.createElement("span");fe.className="aipkit_pagination-links";let _e=document.createElement("button");_e.type="button",_e.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_e.textContent=i("Prev","gpt3-ai-content-generator"),_e.disabled=re<=1,_e.addEventListener("click",()=>H(re-1));let $e=document.createElement("span");$e.className="aipkit_pagination-current",$e.textContent=`${re}/${oe}`;let Ee=document.createElement("button");Ee.type="button",Ee.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Ee.textContent=i("Next","gpt3-ai-content-generator"),Ee.disabled=re>=oe,Ee.addEventListener("click",()=>H(re+1)),fe.appendChild(_e),fe.appendChild($e),fe.appendChild(Ee),ie.appendChild(fe)},He=(Z,ie)=>{if(!yi)return;if(yi.innerHTML="",!Array.isArray(Z)||!Z.length){let ce=document.createElement("p");ce.className="aipkit_builder_help_text",ce.textContent=i("No posts found for selection.","gpt3-ai-content-generator"),yi.appendChild(ce),Zt&&(Zt.innerHTML="");return}let H=document.createElement("ul"),X=document.createElement("div");X.className="aipkit_wp_content_select_all_wrapper";let oe=document.createElement("label");oe.className="aipkit_training_site_option";let re=document.createElement("input");re.type="checkbox",re.checked=Z.every(ce=>ht.selectedIds.has(String(ce.id))),oe.appendChild(re),oe.appendChild(document.createTextNode(i("Select all","gpt3-ai-content-generator"))),X.appendChild(oe),yi.appendChild(X),yi.appendChild(H),Z.forEach(ce=>{let fe=document.createElement("li");fe.className="aipkit_wp_content_list_item";let _e=document.createElement("input");_e.type="checkbox",_e.name="wp_content_to_index[]",_e.value=String(ce.id),_e.checked=ht.selectedIds.has(String(ce.id)),_e.addEventListener("change",()=>{_e.checked?ht.selectedIds.add(String(ce.id)):ht.selectedIds.delete(String(ce.id)),re.checked=Z.every(Re=>ht.selectedIds.has(String(Re.id)))});let $e=document.createElement("a");$e.className="aipkit_wp_content_title",$e.href=ce.edit_link||"#",$e.target="_blank",$e.rel="noopener noreferrer",$e.textContent=ce.title||i("Untitled","gpt3-ai-content-generator");let Ee=document.createElement("span");Ee.className="aipkit_wp_content_type",Ee.textContent=ce.type_label||"";let Fe=document.createElement("span");Fe.className="aipkit_wp_content_indexed_status",Fe.textContent=ce.is_already_indexed?i("Indexed","gpt3-ai-content-generator"):"",fe.appendChild(_e),fe.appendChild($e),fe.appendChild(Ee),fe.appendChild(Fe),H.appendChild(fe)}),re.addEventListener("change",()=>{re.checked?Z.forEach(ce=>ht.selectedIds.add(String(ce.id))):Z.forEach(ce=>ht.selectedIds.delete(String(ce.id))),yi.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(ce=>{ce.checked=re.checked})}),je(ie,Zt,Qe)},Qe=async Z=>{if(!yi)return;let ie=di(),H=qi(ie);if(!H.length){yi.innerHTML="",Zt&&(Zt.innerHTML=""),Ct(i("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let X=mi("aipkit_wp_content_fetch_nonce");if(!X){Ct(i("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let oe=Ce(ie),re=yt&&yt.value||"";try{Ct(i("Loading content...","gpt3-ai-content-generator"),"");let ce=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:X,post_types:H,post_status:oe,target_store_id:re,paged:Z});ht.page=Z,He(ce.posts||[],ce.pagination||{}),Ct("","")}catch(ce){Ct(ce&&ce.message?ce.message:i("Failed to load content.","gpt3-ai-content-generator"),"error")}},We=Z=>{xt&&(xt.value=Z),Jt&&(Jt.hidden=Z!=="bulk"),ji&&(ji.hidden=Z!=="specific"),Pi&&(Pi.hidden=Z!=="specific"),ii&&(ii.hidden=Z!=="bulk"),pe&&(pe.hidden=Z!=="specific"),Hi&&(Hi.hidden=Z!=="bulk"),Z==="specific"&&Qe(1)},De=()=>{e.querySelectorAll(".aipkit_training_site_dropdown").forEach(ie=>{let H=ie.querySelector(".aipkit_training_site_dropdown_btn"),X=ie.querySelector(".aipkit_training_site_dropdown_label"),oe=ie.querySelector(".aipkit_training_site_dropdown_panel"),ce=ie.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",fe=document.getElementById(ce);if(!H||!oe||!fe)return;let _e=()=>{let Ee=oe.querySelectorAll('input[type="checkbox"]:checked'),Fe=ie.dataset.placeholder||i("Select types","gpt3-ai-content-generator"),Re=ie.dataset.selectedLabel||i("selected","gpt3-ai-content-generator");X&&(Ee.length?X.textContent=`${Ee.length} ${Re}`:X.textContent=Fe)},$e=()=>{let Ee=Array.from(oe.querySelectorAll('input[type="checkbox"]:checked')).map(Fe=>Fe.value);Array.from(fe.options).forEach(Fe=>{Fe.selected=Ee.includes(Fe.value)})};H.addEventListener("click",()=>{let Ee=H.getAttribute("aria-expanded")==="true";H.setAttribute("aria-expanded",Ee?"false":"true"),oe.hidden=Ee}),oe.addEventListener("change",()=>{$e(),_e(),di()==="specific"&&Qe(1)}),document.addEventListener("click",Ee=>{ie.contains(Ee.target)||(H.setAttribute("aria-expanded","false"),oe.hidden=!0)}),$e(),_e()})},_t=async(Z,ie,H)=>{let X=mi("aipkit_wp_content_fetch_nonce");if(!X||!Z.length)return{total:0};let oe=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:X,post_types:Z,post_status:ie,target_store_id:H||"",paged:1}),re=parseInt(oe?.pagination?.total_posts||0,10);return{total:Number.isNaN(re)?0:re,totalPages:parseInt(oe?.pagination?.total_pages||1,10)}},wi=async(Z,ie,H)=>{let X=mi("aipkit_wp_content_fetch_nonce");if(!X)throw new Error("WP content fetch nonce missing.");let oe=[],re=1,ce=1;do{let fe=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:X,post_types:Z,post_status:ie,target_store_id:H||"",paged:re}),_e=Array.isArray(fe?.posts)?fe.posts:[];_e.length&&(window.aipkit_wpContentTitleMap=window.aipkit_wpContentTitleMap||{},_e.forEach(Ee=>{Ee&&Ee.id&&(window.aipkit_wpContentTitleMap[String(Ee.id)]=Ee.title||window.aipkit_wpContentTitleMap[String(Ee.id)]||"")})),oe.push(..._e.map(Ee=>String(Ee.id)));let $e=parseInt(fe?.pagination?.total_pages||1,10);ce=Number.isNaN($e)?1:$e,Ct(`Preparing... collected ${oe.length} item(s).`,"info"),re+=1}while(re<=ce);return oe},Rt=(Z,ie)=>Z<=200||ie!=="publish"?Promise.resolve(!1):new Promise(H=>{let X=document.getElementById("aipkit_background_indexing_confirm"),oe=document.getElementById("aipkit_background_indexing_message"),re=document.getElementById("aipkit_background_indexing_yes"),ce=document.getElementById("aipkit_background_indexing_no"),fe=document.getElementById("aipkit_wp_content_bulk_hint");if(!X||!oe||!re||!ce){H(window.confirm(`You're about to index ${Z} items. Run in the background?`));return}oe.textContent=`You're about to index ${Z} items. Run in the background?`,fe&&(fe.hidden=!0),X.hidden=!1;let _e=()=>{X.hidden=!0,fe&&(fe.hidden=!1),re.removeEventListener("click",$e),ce.removeEventListener("click",Ee)},$e=()=>{_e(),H(!0)},Ee=()=>{_e(),H(!1)};re.addEventListener("click",$e),ce.addEventListener("click",Ee)}),hi=async({botId:Z,postTypes:ie,provider:H,targetStoreId:X,embeddingProvider:oe,embeddingModel:re})=>{let ce=window.aipkit_chat_config?.automationsNonce||"";if(!ce)throw new Error("Automations nonce missing.");let fe=`Chatbot ${Z} website indexing`,_e={_ajax_nonce:ce,task_id:0,task_name:fe,task_type:"content_indexing",task_status:"active",task_frequency:"one-time",index_existing_now_flag:"1",only_new_updated_flag:"0",post_types:ie,target_store_provider:H,target_store_id:X};return(H==="pinecone"||H==="qdrant")&&(_e.embedding_provider=oe||"",_e.embedding_model=re||""),window.aipkit_apiRequest("aipkit_save_automated_task",_e)};if(xt&&!e.dataset.trainingWebsiteBound){if(typeof window.aipkit_initWpContentModeToggle=="function"&&window.aipkit_initWpContentModeToggle(),Kt&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&!Kt.dataset.listenerAttached&&(Kt.addEventListener("click",()=>{window.aipkit_fetchWordPressContentForTraining(1)}),Kt.dataset.listenerAttached="true"),typeof window.aipkit_updatePostTypeCounts=="function"&&(window.aipkit_updatePostTypeCounts(),ot&&!ot.dataset.listenerAttached&&(ot.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),ot.dataset.listenerAttached="true"),yt&&!yt.dataset.listenerAttached&&(yt.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),yt.dataset.listenerAttached="true")),_i(T()),De(),Nt.length){Nt.forEach(ie=>{ie.dataset.listenerAttached||(ie.addEventListener("change",()=>{We(ie.value)}),ie.dataset.listenerAttached="true")});let Z=Array.from(Nt).find(ie=>ie.checked);We(Z?Z.value:di())}else We(di());Li&&!Li.dataset.listenerAttached&&(Li.addEventListener("change",()=>{di()==="specific"&&Qe(1)}),Li.dataset.listenerAttached="true"),yt&&!yt.dataset.websiteListenerAttached&&(yt.addEventListener("change",()=>{di()==="specific"&&Qe(1)}),yt.dataset.websiteListenerAttached="true"),e.dataset.trainingWebsiteBound="1"}let Ai=Z=>`${Z.name}::${Z.size}::${Z.lastModified}`,dn=Z=>{if(!Number.isFinite(Z)||Z<=0)return"0 KB";let ie=["B","KB","MB","GB"],H=Z,X=0;for(;H>=1024&&X<ie.length-1;)H/=1024,X+=1;let oe=X===0?0:1;return`${H.toFixed(oe)} ${ie[X]}`},nn=()=>ai&&ai.dataset.upgradeUrl||"",pn=()=>{if(!ve)return;let Z=ti.size>0;ve.style.display=Z?"none":""},Lo=(Z=1500)=>{ai&&(Ft&&window.clearTimeout(Ft),Ft=window.setTimeout(()=>{ti.clear(),ai.innerHTML="",me&&(me.value=""),pn(),Ft=null},Z))},kn=()=>ti.size?Array.from(ti.values()).every(Z=>{let ie=Z.querySelector(".aipkit_training_file_status");return ie?ie.classList.contains("is-success")||ie.classList.contains("is-error"):!1}):!1,To=()=>{Ft&&!kn()&&(window.clearTimeout(Ft),Ft=null),kn()&&Lo(),pn()},ao=Z=>{if(!ai)return null;let ie=Ai(Z);if(ti.has(ie))return ti.get(ie);let H=document.createElement("div");H.className="aipkit_training_file_row",H.dataset.fileKey=ie;let X=document.createElement("div");X.className="aipkit_training_file_meta";let oe=document.createElement("span");oe.className="aipkit_training_file_name",oe.textContent=Z.name;let re=document.createElement("span");re.className="aipkit_training_file_size",re.textContent=dn(Z.size);let ce=document.createElement("span");return ce.className="aipkit_training_file_status",ce.textContent="Queued",X.appendChild(oe),X.appendChild(re),H.appendChild(X),H.appendChild(ce),ai.appendChild(H),ti.set(ie,H),H},Gt=(Z,ie,H)=>{let X=ao(Z);if(!X)return;let oe=X.querySelector(".aipkit_training_file_status");if(oe){if(oe.textContent="",oe.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),H&&oe.classList.add(`is-${H}`),ie==="Upgrade"&&nn()){oe.classList.add("is-upgrade");let re=document.createElement("a");re.className="aipkit_training_file_upgrade",re.href=nn(),re.textContent=ie,oe.appendChild(re)}else oe.textContent=ie;To()}},Ln=async(Z,ie=null)=>{if(!Z||!Z.name||typeof window.aipkit_apiRequest!="function")return!1;let H=u&&u.value||e.getAttribute("data-active-bot-id");if(!H)return!1;let X=ie||T();if(!X||X.enable_vector_store!=="1")return!1;let oe=String(Z.name||"").trim();if(!oe)return!1;let re=Fe=>String(Fe||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),ce=re(oe),fe=oe.replace(/\.[^/.]+$/,""),_e=[oe,ce,fe&&fe!==oe?fe:""].filter(Boolean),$e=async(Fe,Re)=>{let Ve=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",{bot_id:H,page:1,per_page:Re,search:Fe||"",enable_vector_store:X.enable_vector_store,vector_store_provider:X.vector_store_provider,openai_vector_store_ids:X.openai_vector_store_ids||[],pinecone_index_name:X.pinecone_index_name,qdrant_collection_names:X.qdrant_collection_names||[]});return Array.isArray(Ve.logs)?Ve.logs:[]},Ee=(Fe,Re)=>{if(!Fe.length)return null;let Ve=Re.map(re).filter(Boolean);return Fe.find(Qt=>{let Et=re(Qt.message),Ze=re(Qt.post_title),Ie=re(Qt.file_id);return Ve.some(Ne=>Et&&Et.includes(Ne)||Ze&&Ze.includes(Ne)||Ie&&Ie.includes(Ne))})||null};try{for(let Ve of _e){let Qt=await $e(Ve,10),Et=Ee(Qt,[Ve,ce]);if(Et){let Ze=String(Et.status||"").toLowerCase();if(Ze==="indexed"||Ze==="skipped_already_indexed")return Gt(Z,"Trained","success"),!0;if(Ze==="failed")return Gt(Z,"Failed","error"),!0;if(Ze==="processing"||Ze==="queued")return Gt(Z,"Processing","loading"),!0}}let Fe=await $e("",20),Re=Ee(Fe,_e);if(Re){let Ve=String(Re.status||"").toLowerCase();if(Ve==="indexed"||Ve==="skipped_already_indexed")return Gt(Z,"Trained","success"),!0;if(Ve==="failed")return Gt(Z,"Failed","error"),!0;if(Ve==="processing"||Ve==="queued")return Gt(Z,"Processing","loading"),!0}}catch{}return!1},Tn=(Z,ie,H,X=0)=>{if(!Z||!ie||!H)return;if(X>=30){Ln(H,T()).then(ce=>{ce||Gt(H,"Queued","warning")});return}let re=mi("aipkit_vector_store_nonce_openai");if(!re||typeof window.aipkit_apiRequest!="function"){Ln(H,T());return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:Z,batch_id:ie,_ajax_nonce:re}).then(ce=>{let fe=(ce.status||"").toLowerCase();if(fe==="completed"){Gt(H,"Trained","success"),Fi(T()),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}if(fe==="failed"||fe==="cancelled"){Gt(H,"Failed","error");return}Gt(H,"Processing","loading"),setTimeout(()=>{Tn(Z,ie,H,X+1)},2500)}).catch(()=>{setTimeout(()=>{Tn(Z,ie,H,X+1)},3e3)})},wn=Z=>{if(!Le)return;let ie=Le.dataset.baseLabel||Le.querySelector(".aipkit_training_sources_label")?.textContent.trim()||Le.textContent.replace(/\(\d+\)/,"").trim(),H=Number.isFinite(Z)?Z:0,X=Le.querySelector(".aipkit_training_sources_count");X?(X.textContent=String(H),Le.setAttribute("aria-label",`${ie} (${H})`)):Le.textContent=`${ie} (${H})`},Fi=async(Z=null)=>{if(!Le||typeof window.aipkit_apiRequest!="function")return;if(Z&&Z.enable_vector_store!=="1"){wn(0);return}let ie=Z?Z.vector_store_provider:"";if(ie==="openai"&&!(Array.isArray(Z.openai_vector_store_ids)?Z.openai_vector_store_ids:[]).length){wn(0);return}if(ie==="pinecone"&&!Z.pinecone_index_name){wn(0);return}if(ie==="qdrant"&&!(Array.isArray(Z.qdrant_collection_names)?Z.qdrant_collection_names:[]).length){wn(0);return}let H=u&&u.value||e.getAttribute("data-active-bot-id");if(!H){wn(0);return}try{let X={bot_id:H};Z&&(X.enable_vector_store=Z.enable_vector_store,X.vector_store_provider=Z.vector_store_provider,X.openai_vector_store_ids=Z.openai_vector_store_ids||[],X.pinecone_index_name=Z.pinecone_index_name,X.qdrant_collection_names=Z.qdrant_collection_names||[]);let oe=await window.aipkit_apiRequest("aipkit_get_chatbot_training_source_count",X),re=Number(oe.count||0);wn(Number.isNaN(re)?0:re)}catch{}};window.aipkit_refreshTrainingSourcesCount=()=>{Fi(T())};let Po=()=>{if(!Le||e.dataset.trainingAutoSync)return;let Z=()=>{document.visibilityState==="visible"&&Fi(T())},ie=window.setInterval(Z,6e4);e.dataset.trainingAutoSync="1",e.dataset.trainingAutoSyncInterval=String(ie),document.addEventListener("visibilitychange",Z)},mi=Z=>{let ie=document.getElementById(Z);return ie?ie.value:""},So=Z=>{let ie=String(Z),H=window.aipkit_wpContentTitleMap||{};if(H&&H[ie])return H[ie];if(yi){let X=yi.querySelector(`input[name="wp_content_to_index[]"][value="${ie}"]`);if(X){let oe=X.closest(".aipkit_wp_content_list_item"),re=oe?oe.querySelector(".aipkit_wp_content_title"):null,ce=re?re.textContent.trim():"";if(ce)return ce}}return`${i("Post","gpt3-ai-content-generator")} ${ie}`},ro=(Z,ie,H)=>{let X=So(Z);return`${i("Training","gpt3-ai-content-generator")}: ${X} (${ie+1}/${H})`},so=async Z=>{let ie=mi("aipkit_wp_content_fetch_nonce");if(!ie)throw new Error("WP content fetch nonce missing.");let H=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ie,get_content_for_ids:[String(Z)]});return(H&&H.posts_content?H.posts_content:{})[String(Z)]||null},Pn=async(Z,ie,H)=>{if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let X=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Z,embedding_provider:ie,embedding_model:H,_ajax_nonce:window.aipkit_dashboard.nonce}),oe=X.embeddings&&X.embeddings.length?X.embeddings[0]:null;if(!oe)throw new Error("Failed to generate embedding.");return oe},Eo=async(Z,ie)=>{let H=Array.isArray(Z)?Z:[];if(H.length)for(let X=0;X<H.length;X+=1){if(window.aipkit_isIndexingStopped){Ct(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let oe=H[X];Ct(ro(oe,X,H.length),"info"),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{...ie,post_ids:[oe]})}},Mo=async(Z,ie)=>{let H=Array.isArray(Z)?Z:[];if(H.length)for(let X=0;X<H.length;X+=1){if(window.aipkit_isIndexingStopped){Ct(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let oe=H[X]||{},re=oe.postId||oe.id;if(!re)continue;Ct(ro(re,X,H.length),"info");let ce=await so(re);if(!ce||!ce.content)continue;let fe=oe.metadata&&oe.metadata.vector_id||`wp_post_${re}`,_e={source:"wordpress_post",created_at:new Date().toISOString(),post_id:re,title:ce.title||"",url:ce.edit_link||"",vector_id:fe},$e=await Pn(ce.content,ie.embedding_provider,ie.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:ie._ajax_nonce,vectors:JSON.stringify([{id:fe,values:$e,metadata:_e}]),embedding_provider:ie.embedding_provider,embedding_model:ie.embedding_model,original_text_content:ce.content,index_name:ie.index_name})}},hn=async(Z,ie)=>{let H=Array.isArray(Z)?Z:[];if(H.length)for(let X=0;X<H.length;X+=1){if(window.aipkit_isIndexingStopped){Ct(i("Stopped.","gpt3-ai-content-generator"),"warning");return}let oe=H[X]||{},re=oe.postId||oe.id;if(!re)continue;Ct(ro(re,X,H.length),"info");let ce=await so(re);if(!ce||!ce.content)continue;let fe=o(),_e={source:"wordpress_post",created_at:new Date().toISOString(),post_id:re,title:ce.title||"",url:ce.edit_link||"",vector_id:fe},$e=await Pn(ce.content,ie.embedding_provider,ie.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",{_ajax_nonce:ie._ajax_nonce,vectors:JSON.stringify([{id:fe,vector:$e,payload:_e}]),embedding_provider:ie.embedding_provider,embedding_model:ie.embedding_model,original_text_content:ce.content,collection_name:ie.collection_name,source_context:"chatbot_settings_website"})}};typeof window.aipkit_indexOpenAIBatch!="function"&&(window.aipkit_indexOpenAIBatch=Eo),typeof window.aipkit_indexPineconeBatch!="function"&&(window.aipkit_indexPineconeBatch=Mo),typeof window.aipkit_indexQdrantBatch!="function"&&(window.aipkit_indexQdrantBatch=hn);let Qn=Z=>Z?Array.isArray(Z)?Z.flatMap(ie=>{if(Array.isArray(ie))return ie;if(ie&&typeof ie=="object"){if(Array.isArray(ie.models))return ie.models;if(Array.isArray(ie.items))return ie.items;if(ie.id)return[ie]}return[]}):typeof Z=="object"?Object.values(Z).flatMap(ie=>Array.isArray(ie)?ie:[]):[]:[],co=Z=>{let ie=window.aipkit_chat_config||{};return Z==="openai"?Qn(ie.openaiEmbeddingModels):Z==="google"?Qn(ie.googleEmbeddingModels):Z==="azure"?Qn(ie.azureEmbeddingModels):[]},Bo=(Z,ie)=>!Z||!ie?"":`${Z}::${ie}`,Oo=Z=>{let ie=(Z||"").split("::"),H=ie.shift()||"",X=ie.join("::")||"";return{provider:H,model:X}},lo=Z=>{if(!Z)return;let ie=Z.querySelector(".aipkit_vector_embedding_select");if(!ie)return;let H=Z.querySelector('[name="vector_embedding_provider"]'),X=Z.querySelector('[name="vector_embedding_model"]'),oe=H?H.value:"",re=X?X.value:"",ce=Bo(oe,re);if(!ce||ie.value===ce)return;let fe=typeof CSS<"u"&&CSS.escape?CSS.escape(ce):ce.replace(/"/g,'\\"');ie.querySelector(`option[value="${fe}"]`)&&(ie.value=ce)},Mn=Z=>{let ie=Mi();if(!ie||!Z)return;let H=ie.querySelector('[name="vector_embedding_provider"]'),X=ie.querySelector('[name="vector_embedding_model"]'),oe=Z.selectedOptions[0],re=oe&&oe.dataset.provider||"",ce=Z.value||"";H&&(H.value=re),X&&(X.value=ce),H&&X&&re&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&(X.value=ce,window.aipkit_populateVectorEmbeddingModelSelect(ie),ce&&(X.value=ce))},po=(Z,ie)=>{if(!ie)return null;let X=co(Z).find(ce=>ce&&ce.id===ie),oe=X?.dimensions||X?.dimension||X?.output_dimensionality||X?.outputDimensionality||X?.output_dimension,re=oe?Number(oe):NaN;if(Number.isFinite(re)&&re>0)return re;if(X&&typeof X.name=="string"){let ce=X.name.match(/\((\d{3,5})\)/);if(ce)return Number(ce[1])}return Z==="google"?768:1536},_o=()=>{let{pineconeKeyInput:Z,qdrantUrlInput:ie,qdrantKeyInput:H}=Gi(),X=!!(Z&&Z.value.trim()||d),oe=!!(ie&&ie.value.trim()||l),re=!!(H&&H.value.trim()||a);return{openai:t,pinecone:X,qdrant:oe&&re}},$o=()=>{let Z=_o();return Z.openai?"openai":Z.pinecone?"pinecone":Z.qdrant?"qdrant":""},Fo=()=>t?"openai":p?"google":_?"azure":"",Jn=()=>{let Z=Mi();if(!Z)return{provider:"",model:""};let ie=Z.querySelector('[name="vector_embedding_provider"]'),H=Z.querySelector('[name="vector_embedding_model"]'),X=ie?ie.value:"";X||(X=Fo(),ie&&X&&(ie.value=X,typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(Z)));let oe=H?H.value:"";if(!oe&&X){let re=co(X);oe=re.length?re[0].id:"",H&&oe&&(H.value=oe)}return lo(Z),{provider:X,model:oe}},yn=Z=>{if(!Z)return"";let H=(Z.selectedOptions?Array.from(Z.selectedOptions):[]).find(X=>X&&X.value);return H?H.value:""},xo=(Z,ie)=>{!Z||!ie||Array.from(Z.options).forEach(H=>{H.selected=H.value===ie})},No=async Z=>{let{openaiStoresSelect:ie}=Gi(),H=yn(ie);if(!H&&ie&&(Cn(ie),H=yn(ie)),!H){let X=mi("aipkit_vector_store_nonce_openai");if(!X)throw new Error("OpenAI vector store nonce missing.");let oe=`Chatbot ${Z} ${Date.now()}`,re=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:X,name:oe,source_type:"chatbot_training_text"}),ce=re.store||re;if(!ce||!ce.id)throw new Error("OpenAI vector store creation failed.");if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]),window.aipkit_chat_config.openaiVectorStores.some(_e=>_e&&_e.id===ce.id)||window.aipkit_chat_config.openaiVectorStores.push(ce),typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"){let _e=Mi();_e&&window.aipkit_populateOpenAIVectorStoresMultiSelect(_e)}ie&&xo(ie,ce.id),H=ce.id}return H},Co=async(Z,ie)=>{let{pineconeIndexSelect:H}=Gi(),X=H?H.value:"";if(!X&&H&&(ho(H),X=H.value),!X){let oe=mi("aipkit_vector_store_pinecone_nonce_management");if(!oe)throw new Error("Pinecone nonce missing.");let re=`chatbot-${Z}-${Date.now()}`,ce=await window.aipkit_apiRequest("aipkit_create_index_pinecone",{_ajax_nonce:oe,name:re,dimension:ie,metric:"cosine"}),fe=ce.index||ce,_e=fe?.name||re;if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.pineconeIndexes)||(window.aipkit_chat_config.pineconeIndexes=[]),window.aipkit_chat_config.pineconeIndexes.some(Ee=>Ee&&Ee.name===_e||Ee===_e)||window.aipkit_chat_config.pineconeIndexes.push(fe||_e),typeof window.aipkit_populatePineconeIndexSelect=="function"){let Ee=Mi();Ee&&window.aipkit_populatePineconeIndexSelect(Ee)}H&&(H.value=_e),X=_e}return X},Ao=async(Z,ie)=>{let{qdrantCollectionsSelect:H}=Gi(),X=yn(H);if(!X&&H&&(Cn(H),X=yn(H)),!X){let oe=mi("aipkit_vector_store_qdrant_nonce_management");if(!oe)throw new Error("Qdrant nonce missing.");let re=`chatbot-${Z}-${Date.now()}`;if(await window.aipkit_apiRequest("aipkit_create_collection_qdrant",{_ajax_nonce:oe,name:re,dimension:ie,metric:"Cosine"}),window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.qdrantCollections)||(window.aipkit_chat_config.qdrantCollections=[]),window.aipkit_chat_config.qdrantCollections.some(fe=>fe&&fe.name===re||fe===re||fe?.id===re)||window.aipkit_chat_config.qdrantCollections.push({name:re}),H){if(!Array.from(H.options).some(_e=>_e.value===re)){let _e=document.createElement("option");_e.value=re,_e.textContent=re,H.appendChild(_e)}xo(H,re)}if(typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let fe=Mi();fe&&window.aipkit_populateQdrantCollectionsMultiSelect(fe)}X=re}return X};if(qe.length&&!e.dataset.trainingTextBound){let Z=!1,ie=ce=>{!Je||!Se||(ce?(Je.hidden=!1,Je.disabled=!1,Se.disabled=!0):(Je.hidden=!0,Je.disabled=!1,Se.disabled=!1))},H=()=>{let ce=st?st.querySelector(".aipkit_builder_tab.is-active"):null;return ce?ce.dataset.aipkitTab:""},X=()=>{let ce=h?h.querySelector(".aipkit_file_upload_toggle_select"):null;return ce?ce.dataset.isProPlan==="true":window.aipkit_chat_config?.isProPlan===!0||window.aipkit_dashboard?.isProPlan===!0};de&&me&&de.addEventListener("click",()=>{me.click()});let oe=async()=>{if(Z)return;let ce=H(),fe="",_e="chatbot_training_text",$e=[],Ee=null;if(ce==="text"){if(fe=wt?wt.value.trim():"",!fe){gt("Add text to train.","warning"),jt();return}}else if(ce==="qa"){let Ie=Ht?Ht.value.trim():"",Ne=se?se.value.trim():"";if(!Ie||!Ne){gt("Add a question and answer to train.","warning"),jt();return}fe=`Q: ${Ie}
A: ${Ne}`,_e="chatbot_training_qa"}else if(ce==="files"){if(!X()){gt("Upgrade to use file uploads.","warning");return}if($e=me?Array.from(me.files||[]):[],!$e.length){me&&me.click(),gt("Choose files to upload.","warning"),jt();return}_e="chatbot_training_file"}else if(ce==="website"){let Ie=di(),Ne=Ce(Ie),ct=qi(Ie),ye=Pe();if(Ie==="specific"){if(!ye.length){gt("Select content to train.","warning"),jt();return}}else if(!ct.length){gt("Select at least one post type.","warning"),jt();return}Ee={mode:Ie,statusValue:Ne,postTypes:ct,selectedPostIds:ye}}else{gt("Select a training tab to continue.","warning"),jt();return}let Fe=u&&u.value||e.getAttribute("data-active-bot-id");if(!Fe){gt("Select a chatbot before training.","error"),jt();return}let Re=Gi(),Ve=Re?Re.providerSelect:null,Qt=Ve?Ve.value:"",Et=["openai","pinecone","qdrant"],Ze="";if(Qt&&Et.includes(Qt)?Ze=Qt:Ze=$o(),!Ze){gt("Add an OpenAI, Pinecone, or Qdrant key to train.","error");return}Z=!0,ie(!0),qe.forEach(Ie=>{Ie.disabled=!0}),gt("Preparing training...","loading");try{let Ie=h&&h.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");Ie&&(Ie.tagName==="SELECT"?Ie.value="1":Ie.checked=!0),Ve&&(Ve.value=Ze),Vn(),cn();let Ne="",ct="",ye="",At="",Yt="";if(Ze==="openai"){if(!t)throw new Error("OpenAI API key missing.");ye=await No(Fe)}else if(Ze==="pinecone"){if(!_o().pinecone)throw new Error("Pinecone API key missing.");let dt=Jn();if(Ne=dt.provider,ct=dt.model,!Ne||!ct)throw new Error("Select an embedding provider and model.");let Ge=po(Ne,ct);At=await Co(Fe,Ge)}else if(Ze==="qdrant"){if(!_o().qdrant)throw new Error("Qdrant URL and API key are required.");let dt=Jn();if(Ne=dt.provider,ct=dt.model,!Ne||!ct)throw new Error("Select an embedding provider and model.");let Ge=po(Ne,ct);Yt=await Ao(Fe,Ge)}if(ri(T()),gn(),_i(T()),ce==="files"){pn();for(let $t=0;$t<$e.length;$t+=1){let dt=$e[$t];gt(`Uploading ${$t+1} of ${$e.length}...`,"loading"),Gt(dt,"Uploading","loading");try{let Ge=new FormData;if(Ze==="openai"){let It=mi("aipkit_vector_store_nonce_openai");if(!It)throw new Error("OpenAI vector store nonce missing.");Ge.append("aipkit_vs_global_file_to_submit",dt),Ge.append("target_store_id",ye),Ge.append("source_type",_e),Ge.append("_ajax_nonce",It);let Xt=await window.aipkit_api_upsertFile(Ge,"aipkit_upload_and_add_file_to_store_direct_openai");Gt(dt,"Processing","loading");let ui=Xt?.batch?.id;Ln(dt,T()).then(Bi=>{if(!Bi){if(ui){Tn(ye,ui,dt);return}Gt(dt,"Queued","warning")}})}else if(Ze==="pinecone"){let It=mi("aipkit_vector_store_pinecone_nonce_management");if(!It)throw new Error("Pinecone nonce missing.");Ge.append("file_to_upload",dt),Ge.append("index_name",At),Ge.append("embedding_provider",Ne),Ge.append("embedding_model",ct),Ge.append("_ajax_nonce",It),await window.aipkit_api_upsertFile(Ge,"aipkit_upload_file_and_upsert_to_pinecone"),Gt(dt,"Trained","success")}else if(Ze==="qdrant"){let It=mi("aipkit_vector_store_qdrant_nonce_management");if(!It)throw new Error("Qdrant nonce missing.");Ge.append("file_to_upload",dt),Ge.append("target_store_id",Yt),Ge.append("embedding_provider",Ne),Ge.append("embedding_model",ct),Ge.append("source_context","chatbot_settings_file_upload"),Ge.append("_ajax_nonce",It),await window.aipkit_api_upsertFile(Ge,"aipkit_upload_file_and_upsert_to_qdrant"),Gt(dt,"Trained","success")}}catch(Ge){throw Gt(dt,"Failed","error"),Ge}}me&&(me.value=""),pn(),gt("Saved","success"),jt(),Fi(),Z=!1,ie(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}else if(ce==="website"&&Ee){let{mode:$t,statusValue:dt,postTypes:Ge,selectedPostIds:It}=Ee,Xt=It,ui=Xt.length;if($t==="bulk"){if(gt("Preparing website content...","loading"),ui=(await _t(Ge,dt,ye)).total,!ui){Ct("No posts found for selection.","error"),gt("Nothing to train.","warning"),jt();return}if(await Rt(ui,dt)){await hi({botId:Fe,postTypes:Ge,provider:Ze,targetStoreId:Ze==="openai"?ye:Ze==="pinecone"?At:Yt,embeddingProvider:Ne,embeddingModel:ct}),Ct("Queued in the background. You can monitor it in the Automate module. You can close this page.","success"),gt("Queued","success"),jt(),Fi(T()),Z=!1,ie(!1);return}if(ui>200&&dt!=="publish"&&Ct("Background indexing supports published content only.","info"),Xt=await wi(Ge,dt,ye),!Xt.length){Ct("No posts found for selection.","error"),gt("Nothing to train.","warning"),jt();return}}gt("Training...","loading"),Ct(`Training ${ui||Xt.length} item(s)...`,"info"),window.aipkit_isIndexingStopped=!1;let Bi=Te?Te.id:"aipkit_training_wp_status";if(Ze==="openai"){let Ti=mi("aipkit_wp_content_index_nonce");if(!Ti)throw new Error("WP content index nonce missing.");await window.aipkit_indexOpenAIBatch(Xt,{_ajax_nonce:Ti,target_store_id:ye,provider:"openai",source_type:"wordpress_content"},Bi)}else if(Ze==="pinecone"){let Ti=mi("aipkit_vector_store_pinecone_nonce_management");if(!Ti)throw new Error("Pinecone nonce missing.");let Zi=Xt.map(Bn=>({id:`wp_post_${Bn}`,postId:Bn,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${Bn}`}}));await window.aipkit_indexPineconeBatch(Zi,{_ajax_nonce:Ti,index_name:At,embedding_provider:Ne,embedding_model:ct,source_type:"wordpress_content"},Bi)}else if(Ze==="qdrant"){let Ti=mi("aipkit_vector_store_qdrant_nonce_management");if(!Ti)throw new Error("Qdrant nonce missing.");let Zi=Xt.map(Bn=>({id:typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`wp_post_${Bn}`,postId:Bn,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${Bn}`}}));await window.aipkit_indexQdrantBatch(Zi,{_ajax_nonce:Ti,collection_name:Yt,embedding_provider:Ne,embedding_model:ct,source_type:"wordpress_content"},Bi)}gt("Saved","success"),jt(),Fi(T()),Z=!1,ie(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}else{if(gt("Training...","loading"),Ze==="openai"){let $t=mi("aipkit_vector_store_nonce_openai");if(!$t)throw new Error("OpenAI vector store nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:$t,target_store_id:ye,text_content:fe,source_type:_e})}else if(Ze==="pinecone"){let $t=mi("aipkit_vector_store_pinecone_nonce_management");if(!$t)throw new Error("Pinecone nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let dt=`text_${Date.now()}`,Ge={source:_e,created_at:new Date().toISOString(),original_content:fe,vector_id:dt},It=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:fe,embedding_provider:Ne,embedding_model:ct,_ajax_nonce:window.aipkit_dashboard.nonce}),Xt=It.embeddings&&It.embeddings.length?It.embeddings[0]:null;if(!Xt)throw new Error("Failed to generate embedding.");await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:$t,vectors:JSON.stringify([{id:dt,values:Xt,metadata:Ge}]),embedding_provider:Ne,embedding_model:ct,original_text_content:fe,index_name:At})}else if(Ze==="qdrant"){let $t=mi("aipkit_vector_store_qdrant_nonce_management");if(!$t)throw new Error("Qdrant nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let dt=o(),Ge={source:_e,created_at:new Date().toISOString(),original_content:fe,vector_id:dt},It=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:fe,embedding_provider:Ne,embedding_model:ct,_ajax_nonce:window.aipkit_dashboard.nonce}),Xt=It.embeddings&&It.embeddings.length?It.embeddings[0]:null;if(!Xt)throw new Error("Failed to generate embedding.");let ui={_ajax_nonce:$t,vectors:JSON.stringify([{id:dt,vector:Xt,payload:Ge}]),embedding_provider:Ne,embedding_model:ct,original_text_content:fe,collection_name:Yt,source_context:"chatbot_settings_training"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",ui)}ce==="text"&&wt&&(wt.value=""),ce==="qa"&&(Ht&&(Ht.value=""),se&&(se.value="")),gt("Saved","success"),jt(),Fi(),Z=!1,ie(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}}catch(Ie){gt(`Error: ${Ie.message||"Training failed."}`,"error")}finally{Z=!1,ie(!1),qe.forEach(Ie=>{Ie.disabled=!1}),pn()}},re=()=>{if(!me)return;let ce=Array.from(me.files||[]);if(ce.length){if(ce.forEach(fe=>{ao(fe),Gt(fe,"Queued")}),pn(),!X()){gt("Upgrade to use file uploads.","warning"),ce.forEach(fe=>{Gt(fe,"Upgrade","warning")});return}oe()}};me&&me.addEventListener("change",re),qe.forEach(ce=>{ce.addEventListener("click",oe)}),Je&&!Je.dataset.listenerAttached&&(Je.addEventListener("click",()=>{Z&&(window.aipkit_isIndexingStopped=!0,Je.disabled=!0,gt("Stopping...","warning"))}),Je.dataset.listenerAttached="true"),Fi(),Po(),e.dataset.trainingTextBound="1"}if(xe&&!e.dataset.sourcesSheetBound){let Z=window.aipkit_escapeHtml||function(Ie){return Ie},ie={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"},H={page:1,search:"",status:""},X=null,oe=(Ie,Ne)=>{kt&&(kt.textContent=Ie||"",kt.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),Ne==="success"&&kt.classList.add("aipkit_form-help-success"),Ne==="error"&&kt.classList.add("aipkit_form-help-error"))},re=()=>{kt&&setTimeout(()=>{kt.textContent="",kt.classList.remove("aipkit_form-help-success","aipkit_form-help-error")},2500)},ce=(Ie,Ne)=>{zt&&(zt.textContent=Ie||"\u2014"),Dt&&(Dt.textContent=Ne||"\u2014")},fe=()=>{let Ie=T(),Ne=Ie.vector_store_provider||"",ct=ie[Ne]||"",ye=[],At="",Yt=Mi(),$t=Yt?Yt.querySelector('select[name="openai_vector_store_ids[]"]'):null;if(Ne==="openai"){if(ye=Array.isArray(Ie.openai_vector_store_ids)?Ie.openai_vector_store_ids.filter(Boolean):[],$t){let dt=Array.from($t.selectedOptions).map(Ge=>Ge.textContent.trim()).filter(Boolean);dt.length&&(At=dt.join(", "))}At||(At=ye.join(", "))}else Ne==="pinecone"?Ie.pinecone_index_name&&(ye=[Ie.pinecone_index_name],At=Ie.pinecone_index_name):Ne==="qdrant"&&(ye=Array.isArray(Ie.qdrant_collection_names)?Ie.qdrant_collection_names.filter(Boolean):[],At=ye.join(", "));return{contextSettings:Ie,providerKey:Ne,providerLabel:ct,storeIds:ye,storeLabel:At}},_e=Ie=>{ke&&(ke.innerHTML=`<tr><td colspan="5" class="aipkit_text-center">${Z(Ie)}</td></tr>`,qt&&(qt.innerHTML=""))},$e=(Ie,Ne)=>{if(!ke)return;if(!Ie.length){_e("No sources found.");return}let ct=Ie.map(ye=>{let At=(ye.provider||Ne||"").toLowerCase(),Yt=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(ye.message||"",ye.file_id||"",At,ye):"N/A",$t=Yt==="Text"?"aipkit_type-text":Yt==="File Upload"?"aipkit_type-file":Yt==="Site Content"?"aipkit_type-site":"aipkit_type-na",dt=ye.status==="indexed"||ye.status==="skipped_already_indexed"||ye.status==="success"?"aipkit_status-success":ye.status==="failed"?"aipkit_status-warning":"aipkit_status-info",Ge="\u2014";ye.status&&(Ge=ye.status==="indexed"||ye.status==="skipped_already_indexed"||ye.status==="success"?"Trained":ye.status.replace(/_/g," "));let It=ye.status==="processing"||ye.status==="queued",Xt=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(ye.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(ye.timestamp):ye.timestamp||"\u2014",ui=ye.indexed_content||"",Bi=ye.post_title||(ye.post_id?`Post #${ye.post_id}`:"")||ui||ye.message||ye.file_id||"\u2014",Ti=Bi.length>60?`${Bi.substring(0,60)}...`:Bi,Zi=[];return Yt==="Site Content"&&ye.post_id&&Zi.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
                    data-provider="${Z(ye.provider||Ne)}"
                    data-store-id="${Z(ye.vector_store_id||"")}"
                    data-vector-id="${Z(ye.file_id||"")}"
                    data-log-id="${Z(ye.id||"")}"
                    data-post-id="${Z(ye.post_id||"")}"
                    data-embedding-provider="${Z(ye.embedding_provider||"")}"
                    data-embedding-model="${Z(ye.embedding_model||"")}"
                    ${It?'disabled aria-disabled="true"':""}
                  >${It?"Training...":"Retrain"}</button>`),Yt==="Text"&&ui&&Zi.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
                    data-provider="${Z(ye.provider||Ne)}"
                    data-store-id="${Z(ye.vector_store_id||"")}"
                    data-vector-id="${Z(ye.file_id||"")}"
                    data-log-id="${Z(ye.id||"")}"
                    data-embedding-provider="${Z(ye.embedding_provider||"")}"
                    data-embedding-model="${Z(ye.embedding_model||"")}"
                    data-content="${encodeURIComponent(ui)}"
                    ${It?'disabled aria-disabled="true"':""}
                  >${It?"Training...":"Edit"}</button>`),ui&&Zi.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_view_snippet_icon"
                    data-file-id="${Z(ye.id||"")}"
                    data-snippet="${Z(ui)}"
                    ${ye.batch_id?`data-batch-id="${Z(ye.batch_id)}" data-store-id="${Z(ye.vector_store_id||"")}"`:""}
                    ${It?'disabled aria-disabled="true"':""}
                  >View</button>`),ye.file_id&&Zi.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
                    data-provider="${Z(ye.provider||Ne)}"
                    data-store-id="${Z(ye.vector_store_id||"")}"
                    data-vector-id="${Z(ye.file_id||"")}"
                    data-log-id="${Z(ye.id||"")}"
                    ${It?'disabled aria-disabled="true"':""}
                  >Delete</button>`),`<tr data-log-id="${Z(ye.id||"")}">
                <td style="white-space: nowrap;">${Z(Xt)}</td>
                <td><span class="aipkit_content-type-tag ${$t}">${Z(Yt)}</span></td>
                <td title="${Z(Bi)}">${Z(Ti)}</td>
                <td style="white-space: nowrap;"><span class="aipkit_status-tag ${dt}">${Z(Ge)}</span></td>
                <td class="aipkit_actions_cell">
                  <div class="aipkit-table-actions-group">${Zi.join("")}</div>
                </td>
              </tr>`}).join("");ke.innerHTML=ct,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(ke,Ne)},Ee=async(Ie=1)=>{if(!ke||typeof window.aipkit_apiRequest!="function")return;let Ne=u&&u.value||e.getAttribute("data-active-bot-id");if(!Ne){_e("Select a chatbot to view sources.");return}let{contextSettings:ct,providerKey:ye,providerLabel:At,storeIds:Yt,storeLabel:$t}=fe();if(ce(At,$t),ct.enable_vector_store!=="1"){_e("Enable a knowledge base to view sources.");return}if(!ye||!Yt.length){_e("Select a knowledge base store to view sources.");return}ke.innerHTML='<tr><td colspan="5" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading sources...</td></tr>',qt&&(qt.innerHTML="");try{let dt={bot_id:Ne,page:Ie,search:H.search,status:H.status,enable_vector_store:ct.enable_vector_store,vector_store_provider:ct.vector_store_provider,openai_vector_store_ids:ct.openai_vector_store_ids||[],pinecone_index_name:ct.pinecone_index_name,qdrant_collection_names:ct.qdrant_collection_names||[]},Ge=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",dt);H.page=Ie,$e(Ge.logs||[],At),typeof window.aipkit_renderLogsPagination=="function"&&Ge.pagination&&qt&&window.aipkit_renderLogsPagination(Ge.pagination,qt,It=>Ee(It))}catch(dt){_e(`Error loading sources: ${Z(dt.message||"Unknown error")}`)}},Fe=(Ie=1)=>{!y||!y.classList.contains("aipkit-active")||xe.hidden||Ee(Ie)};window.aipkit_refreshSourcesSheet=Fe;let Re=()=>{it&&(it.classList.remove("aipkit-active"),it.setAttribute("aria-hidden","true"),it.dataset.provider="",it.dataset.storeId="",it.dataset.vectorId="",it.dataset.logId="",it.dataset.embeddingProvider="",it.dataset.embeddingModel="",Wt&&(Wt.value=""))},Ve=Ie=>{!it||!Wt||(it.dataset.provider=Ie.dataset.provider||"",it.dataset.storeId=Ie.dataset.storeId||"",it.dataset.vectorId=Ie.dataset.vectorId||"",it.dataset.logId=Ie.dataset.logId||"",it.dataset.embeddingProvider=Ie.dataset.embeddingProvider||"",it.dataset.embeddingModel=Ie.dataset.embeddingModel||"",Wt.value=Ie.dataset.content?decodeURIComponent(Ie.dataset.content):"",it.classList.add("aipkit-active"),it.setAttribute("aria-hidden","false"),setTimeout(()=>Wt.focus(),0))},Qt=()=>{ft&&(ft.classList.remove("aipkit-active"),ft.setAttribute("aria-hidden","true"),ft.dataset.provider="",ft.dataset.storeId="",ft.dataset.vectorId="",ft.dataset.logId="")},Et=Ie=>{ft&&(ft.dataset.provider=Ie.providerLabel||"",ft.dataset.storeId=Ie.storeId||"",ft.dataset.vectorId=Ie.vectorId||"",ft.dataset.logId=Ie.logId||"",ft.classList.add("aipkit-active"),ft.setAttribute("aria-hidden","false"),Di&&(Di.disabled=!1))},Ze=async(Ie,Ne,ct,ye,At)=>{let Yt=Ie.toLowerCase();if(Yt==="openai"){let Ge=mi("aipkit_vector_store_nonce_openai");if(!Ge)throw new Error("OpenAI nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:Ge,target_store_id:Ne,text_content:ct,source_type:"chatbot_training_text"});return}if(!ye||!At){let Ge=T();ye=ye||Ge.vector_embedding_provider,At=At||Ge.vector_embedding_model}if(!ye||!At)throw new Error("Select an embedding provider and model.");let $t=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ct,embedding_provider:ye,embedding_model:At}),dt=$t.embeddings&&$t.embeddings.length?$t.embeddings[0]:null;if(!dt)throw new Error("Failed to generate embedding.");if(Yt==="pinecone"){let Ge=mi("aipkit_vector_store_pinecone_nonce_management");if(!Ge)throw new Error("Pinecone nonce missing.");let It=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:Ge,vectors:JSON.stringify([{id:It,values:dt,metadata:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:ct,vector_id:It}}]),embedding_provider:ye,embedding_model:At,original_text_content:ct,index_name:Ne});return}if(Yt==="qdrant"){let Ge=mi("aipkit_vector_store_qdrant_nonce_management");if(!Ge)throw new Error("Qdrant nonce missing.");let It=o(),Xt={_ajax_nonce:Ge,vectors:JSON.stringify([{id:It,vector:dt,payload:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:ct,vector_id:It}}]),embedding_provider:ye,embedding_model:At,original_text_content:ct,collection_name:Ne,source_context:"chatbot_settings_sources_sheet"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Xt)}};tt&&tt.addEventListener("input",()=>{X&&window.clearTimeout(X),X=window.setTimeout(()=>{H.search=tt.value.trim(),Fe(1)},300)}),Ye&&Ye.addEventListener("change",()=>{H.status=Ye.value,Fe(1)}),Ot&&Ot.addEventListener("click",()=>{Fe(H.page||1)}),Ae&&Ae.addEventListener("click",Re),Lt&&Lt.addEventListener("click",Re),it&&!it.dataset.bound&&(document.addEventListener("keydown",Ie=>{Ie.key==="Escape"&&it.classList.contains("aipkit-active")&&Re()}),it.dataset.bound="1"),ut&&ut.addEventListener("click",async()=>{if(!it||!Wt)return;let Ie=Wt.value.trim();if(!Ie){oe("Text cannot be empty.","error"),re();return}let Ne=it.dataset.provider||"",ct=it.dataset.storeId||"",ye=it.dataset.vectorId||"",At=it.dataset.logId||"",Yt=it.dataset.embeddingProvider||"",$t=it.dataset.embeddingModel||"";if(!Ne||!ct||!ye||!At){oe("Missing source details.","error"),re();return}if(Re(),ke&&At){let dt=typeof CSS<"u"&&CSS.escape?CSS.escape(String(At)):String(At).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),Ge=ke.querySelector(`tr[data-log-id="${dt}"]`),It=Ge?Ge.querySelector(".aipkit_sources_action_edit"):null,Xt=Ge?Ge.querySelector(".aipkit_view_snippet_icon"):null,ui=Ge?Ge.querySelector(".aipkit_sources_action_delete"):null;It&&(It.disabled=!0,It.setAttribute("aria-disabled","true"),It.textContent="Training..."),Xt&&(Xt.disabled=!0,Xt.setAttribute("aria-disabled","true")),ui&&(ui.disabled=!0,ui.setAttribute("aria-disabled","true"))}oe("Training...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:Ne,store_id:ct,vector_id:ye,log_id:At}),await Ze(Ne,ct,Ie,Yt,$t),oe("Trained","success"),re(),Re(),Fe(H.page||1),Fi(T())}catch(dt){oe(`Error: ${dt.message||"Failed to save."}`,"error")}}),Ri&&Ri.addEventListener("click",Qt),_n&&_n.addEventListener("click",Qt),Di&&Di.addEventListener("click",async()=>{if(!ft)return;let Ie=ft.dataset.provider||"",Ne=ft.dataset.storeId||"",ct=ft.dataset.vectorId||"",ye=ft.dataset.logId||"";if(!Ie||!Ne||!ct||!ye){oe("Missing source details.","error"),re(),Qt();return}Qt();let At=null,Yt=null,$t=null,dt=null,Ge=null;if(ke&&ye){let It=typeof CSS<"u"&&CSS.escape?CSS.escape(String(ye)):String(ye).replace(/[^a-zA-Z0-9_-]/g,"\\$&");At=ke.querySelector(`tr[data-log-id="${It}"]`),At&&(Yt=At.querySelector(".aipkit_sources_action_edit"),$t=At.querySelector(".aipkit_sources_action_retrain"),dt=At.querySelector(".aipkit_view_snippet_icon"),Ge=At.querySelector(".aipkit_sources_action_delete"),[Yt,$t,dt,Ge].forEach(Xt=>{Xt&&(Xt.disabled=!0,Xt.setAttribute("aria-disabled","true"))}),Ge&&(Ge.textContent="Deleting..."))}Di&&(Di.disabled=!0),oe("Deleting...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:Ie,store_id:Ne,vector_id:ct,log_id:ye}),oe("Deleted","success"),re(),Fe(H.page||1),Fi(T())}catch(It){oe(`Error: ${It.message||"Failed to delete."}`,"error"),[Yt,$t,dt,Ge].forEach(Xt=>{Xt&&(Xt.disabled=!1,Xt.removeAttribute("aria-disabled"))}),Ge&&(Ge.textContent="Delete")}finally{Di&&(Di.disabled=!1)}}),ft&&!ft.dataset.bound&&(document.addEventListener("keydown",Ie=>{Ie.key==="Escape"&&ft.classList.contains("aipkit-active")&&Qt()}),ft.dataset.bound="1"),xe.addEventListener("click",async Ie=>{let Ne=Ie.target.closest(".aipkit_sources_action_edit");if(Ne){Ve(Ne);return}let ct=Ie.target.closest(".aipkit_sources_action_delete");if(ct){let At=ct.dataset.provider||"",Yt=ct.dataset.storeId||"",$t=ct.dataset.vectorId||"",dt=ct.dataset.logId||"";if(!At||!Yt||!$t||!dt){oe("Missing source details.","error"),re();return}Et({providerLabel:At,storeId:Yt,vectorId:$t,logId:dt});return}let ye=Ie.target.closest(".aipkit_sources_action_retrain");if(ye){let At=ye.dataset.provider||"",Yt=ye.dataset.storeId||"",$t=ye.dataset.vectorId||"",dt=ye.dataset.logId||"",Ge=ye.dataset.postId||"",It=ye.dataset.embeddingProvider||"",Xt=ye.dataset.embeddingModel||"";if(!At||!Yt||!$t||!dt||!Ge){oe("Missing source details.","error"),re();return}ye.disabled=!0,ye.setAttribute("aria-disabled","true"),ye.textContent="Training...";let ui=ye.closest("tr"),Bi=ui?ui.querySelector(".aipkit_view_snippet_icon"):null,Ti=ui?ui.querySelector(".aipkit_sources_action_delete"):null;Bi&&(Bi.disabled=!0,Bi.setAttribute("aria-disabled","true")),Ti&&(Ti.disabled=!0,Ti.setAttribute("aria-disabled","true")),oe("Retraining...","");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:At,store_id:Yt,vector_id:$t,log_id:dt,post_id:Ge,embedding_provider:It,embedding_model:Xt}),oe("Retrained","success"),re(),Fe(H.page||1),Fi(T())}catch(Zi){oe(`Error: ${Zi.message||"Failed to retrain."}`,"error"),ye.disabled=!1,ye.removeAttribute("aria-disabled"),ye.textContent="Retrain",Bi&&(Bi.disabled=!1,Bi.removeAttribute("aria-disabled")),Ti&&(Ti.disabled=!1,Ti.removeAttribute("aria-disabled"))}}}),e.dataset.sourcesSheetBound="1"}e.dataset.contextSettingsAutosaveBound="1"}let qn=wo();if(qn&&li&&!e.dataset.tokenLimitsAutosaveBound){let q=!1,F=null,T=()=>{let G=qn.querySelectorAll('input[name^="token_role_limits["]'),O={};return G.forEach(z=>{let ae=z.getAttribute("name");ae&&(O[ae]=z.value)}),O},W=()=>{let G=O=>{let z=qn.querySelector(O);return z?z.value:""};return{token_guest_limit:G('[name="token_guest_limit"]'),token_user_limit:G('[name="token_user_limit"]'),token_limit_mode:G('[name="token_limit_mode"]'),token_reset_period:G('[name="token_reset_period"]'),token_limit_message:G('[name="token_limit_message"]'),role_limits:T()}},Y=W(),te=G=>{let O=u&&u.value||e.getAttribute("data-active-bot-id");if(!O)return;q=!0,Be("Auto-saving...","");let z={bot_id:O,token_guest_limit:G.token_guest_limit,token_user_limit:G.token_user_limit,token_limit_mode:G.token_limit_mode,token_reset_period:G.token_reset_period,token_limit_message:G.token_limit_message};Object.entries(G.role_limits).forEach(([ae,ge])=>{z[ae]=ge}),window.aipkit_apiRequest("aipkit_update_chatbot_token_limits",z).then(ae=>{Y=G,Be(ae.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),si()}).catch(ae=>{Be(`Error: ${ae.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F){let ae=F;F=null,JSON.stringify(ae)!==JSON.stringify(Y)&&te(ae)}})},ne=G=>{if(JSON.stringify(G)!==JSON.stringify(Y)){if(q){F=G;return}te(G)}};qn.addEventListener("change",G=>{let O=G.target;if(O){if(O.matches(".aipkit_token_limit_mode_select")){Un(),ne(W());return}(O.matches('[name="token_guest_limit"]')||O.matches('[name="token_user_limit"]')||O.matches('[name="token_reset_period"]')||O.matches('[name="token_limit_message"]')||O.matches('input[name^="token_role_limits["]'))&&ne(W())}}),e.dataset.tokenLimitsAutosaveBound="1"}let zn=S?S.querySelector('[data-aipkit-settings-panel="appearance"]'):null;if(zn&&li&&!e.dataset.styleSettingsAutosaveBound){let q=zn;if(q){let F=!1,T=null,W=()=>{let G={},O=et=>{let Pt=q.querySelector(et);return!Pt||Pt.disabled?null:Pt.value||""},z=q.querySelector('select[name="theme"]');if(z&&!z.disabled)G.theme=z.value||"light";else{let et=q.querySelector('input[name="theme"]:checked');if(et&&!et.disabled)G.theme=et.value||"light";else{let Pt=e.querySelector('input[name="theme"]:checked, select[name="theme"]');Pt&&!Pt.disabled&&(G.theme=Pt.value||"light")}}let ae=O('input[name="greeting"]');ae!==null&&(G.greeting=ae);let ge=O('input[name="subgreeting"]');ge!==null&&(G.subgreeting=ge);let he=O('input[name="input_placeholder"]');he!==null&&(G.input_placeholder=he);let Ke=O('input[name="footer_text"]');Ke!==null&&(G.footer_text=Ke);let lt=O('input[name="custom_typing_text"]');lt!==null&&(G.custom_typing_text=lt);let mt=et=>{let Pt=q.querySelector(`input[name="${et}"]`);!Pt||Pt.disabled||(G[et]=Pt.checked?"1":"0")};mt("enable_download"),mt("enable_copy_button"),mt("enable_fullscreen"),mt("enable_feedback"),mt("enable_conversation_sidebar"),mt("enable_conversation_starters");let Xe=u&&u.value||e.getAttribute("data-active-bot-id");if(Xe){let et=document.getElementById(`aipkit_bot_${Xe}_enable_consent_compliance`);et&&!et.disabled&&(G.enable_consent_compliance=et.checked?"1":"0");let Pt=document.getElementById(`aipkit_bot_${Xe}_enable_ip_anonymization`);Pt&&!Pt.disabled&&(G.enable_ip_anonymization=Pt.checked?"1":"0");let ri=document.getElementById(`aipkit_bot_${Xe}_consent_title`);ri&&!ri.disabled&&(G.consent_title=ri.value||"");let Ut=document.getElementById(`aipkit_bot_${Xe}_consent_message`);Ut&&!Ut.disabled&&(G.consent_message=Ut.value||"");let gt=document.getElementById(`aipkit_bot_${Xe}_consent_button`);gt&&!gt.disabled&&(G.consent_button=gt.value||"");let jt=document.getElementById(`aipkit_bot_${Xe}_openai_moderation_enabled`);jt&&!jt.disabled&&(G.openai_moderation_enabled=jt.checked?"1":"0");let Ct=document.getElementById(`aipkit_bot_${Xe}_openai_moderation_message`);Ct&&!Ct.disabled&&(G.openai_moderation_message=Ct.value||"");let _i=document.getElementById(`aipkit_bot_${Xe}_banned_words`);_i&&!_i.disabled&&(G.banned_words=_i.value||"");let di=document.getElementById(`aipkit_bot_${Xe}_banned_words_message`);di&&!di.disabled&&(G.banned_words_message=di.value||"");let qi=document.getElementById(`aipkit_bot_${Xe}_banned_ips`);qi&&!qi.disabled&&(G.banned_ips=qi.value||"");let Ce=document.getElementById(`aipkit_bot_${Xe}_banned_ips_message`);Ce&&!Ce.disabled&&(G.banned_ips_message=Ce.value||"");let Pe=document.getElementById(`aipkit_bot_${Xe}_custom_theme_settings_container`);Pe&&Pe.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(He=>{let Qe=He.getAttribute("name");Qe&&(He.type==="checkbox"?G[Qe]=He.checked?"1":"0":He.type==="radio"?He.checked&&(G[Qe]=He.value):G[Qe]=He.value)});let je=document.getElementById(`aipkit_bot_${Xe}_conversation_starters`);je&&!je.disabled&&(G.conversation_starters=je.value||"")}return G},Y=W(),te=G=>{let O=u&&u.value||e.getAttribute("data-active-bot-id");O&&(F=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_style_settings",{bot_id:O,...G}).then(z=>{Y=G,Be(z.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),si()}).catch(z=>{Be(`Error: ${z.message||"Failed to save."}`,"error")}).finally(()=>{if(F=!1,T){let z=T;T=null,JSON.stringify(z)!==JSON.stringify(Y)&&te(z)}}))},ne=G=>{if(JSON.stringify(G)!==JSON.stringify(Y)){if(F){T=G;return}te(G)}};q.addEventListener("change",G=>{let O=G.target;if(O&&(O.matches('input[name="greeting"]')||O.matches('input[name="subgreeting"]')||O.matches('input[name="input_placeholder"]')||O.matches('input[name="footer_text"]')||O.matches('input[name="custom_typing_text"]')||O.matches('input[name="enable_download"]')||O.matches('input[name="enable_copy_button"]')||O.matches('input[name="enable_fullscreen"]')||O.matches('input[name="enable_feedback"]')||O.matches('input[name="enable_conversation_sidebar"]')||O.matches('input[name="enable_conversation_starters"]')||O.matches('select[name="theme"]')||O.matches('input[name="theme"]'))){if((O.matches('select[name="theme"]')||O.matches('input[name="theme"]'))&&typeof Gn=="function")if(O.value!=="custom")Gn();else{let z=O.closest(".aipkit_theme_choice_card")||O;Kn(z)}ne(W())}}),e.addEventListener("change",G=>{let O=G.target;!O||!O.matches||!O.matches('select[name="theme"]')&&!O.matches('input[name="theme"]')||q.contains(O)||ne(W())}),e.dataset.customThemeAutosaveBound||(document.addEventListener("change",G=>{let O=G.target;O&&O.matches&&O.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')&&ne(W())}),e.dataset.customThemeAutosaveBound="1"),q.addEventListener("blur",G=>{let O=G.target;O&&(O.matches('input[name="greeting"]')||O.matches('input[name="subgreeting"]')||O.matches('input[name="input_placeholder"]')||O.matches('input[name="footer_text"]')||O.matches('input[name="custom_typing_text"]'))&&ne(W())},!0),document.addEventListener("change",G=>{let O=G.target;O&&O.matches('textarea[name="conversation_starters"], input[name="enable_consent_compliance"], input[name="enable_ip_anonymization"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_enabled"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&(O.matches('input[name="enable_consent_compliance"]')&&oo(),O.matches('input[name="openai_moderation_enabled"]')&&Xi(),ne(W()))}),document.addEventListener("blur",G=>{let O=G.target;O&&O.matches('textarea[name="conversation_starters"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&ne(W())},!0),e.dataset.styleSettingsAutosaveBound="1"}}if(y&&li&&!e.dataset.imageSettingsAutosaveBound){let q=!1,F=null,T=()=>{let G=at&&at.querySelector('select[name="chat_image_model_id"]')||h&&h.querySelector('select[name="chat_image_model_id"]')||y.querySelector('select[name="chat_image_model_id"]'),O=at&&at.querySelector('input[name="image_triggers"]')||at&&at.querySelector('textarea[name="image_triggers"]')||h&&h.querySelector('input[name="image_triggers"]')||h&&h.querySelector('textarea[name="image_triggers"]')||y.querySelector('input[name="image_triggers"]')||y.querySelector('textarea[name="image_triggers"]');if(!G||!O)return null;let z=at&&at.querySelector(".aipkit_image_analysis_select")||h&&h.querySelector(".aipkit_image_analysis_select")||y.querySelector(".aipkit_image_analysis_select"),ae=at&&at.querySelector(".aipkit_image_analysis_checkbox")||h&&h.querySelector(".aipkit_image_analysis_checkbox")||y.querySelector(".aipkit_image_analysis_checkbox"),ge=z&&z.value!==""?z.value:ae&&ae.checked?"1":"0";return{chat_image_model_id:G.value||"",image_triggers:O.value||"",enable_image_upload:ge}},W=T()||{},Y=G=>{let O=u&&u.value||e.getAttribute("data-active-bot-id");O&&(q=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_image_settings",{bot_id:O,...G}).then(z=>{W=G,Be(z.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),si()}).catch(z=>{Be(`Error: ${z.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F){let z=F;F=null,JSON.stringify(z)!==JSON.stringify(W)&&Y(z)}}))},te=G=>{if(G&&JSON.stringify(G)!==JSON.stringify(W)){if(q){F=G;return}Y(G)}},ne=G=>{let O=G.target;O&&(O.matches('select[name="chat_image_model_id"]')||O.matches('input[name="image_triggers"]')||O.matches('textarea[name="image_triggers"]')||O.matches(".aipkit_image_analysis_checkbox")||O.matches(".aipkit_image_analysis_select"))&&te(T())};y.addEventListener("change",ne),h&&h.addEventListener("change",ne),at&&at.addEventListener("change",ne),e.dataset.imageSettingsAutosaveBound="1"}if(y&&li&&!e.dataset.replicateKeyAutosaveBound){let F=at&&at.querySelector('input[name="replicate_api_key"]')||h&&h.querySelector('input[name="replicate_api_key"]')||y.querySelector('input[name="replicate_api_key"]');if(F){let T=!1,W=null,Y=F.value||"",te=O=>{T=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:O}).then(z=>{Y=O,Be(z.message||"Saved","success"),si(),mo(O)}).catch(z=>{Be(`Error: ${z.message||"Failed to save."}`,"error")}).finally(()=>{if(T=!1,W!==null){let z=W;W=null,z!==Y&&te(z)}})},ne=O=>{if(O!==Y){if(T){W=O;return}te(O)}},G=O=>{let z=O.target;!z||!z.matches('input[name="replicate_api_key"]')||ne(z.value||"")};y.addEventListener("change",G),y.addEventListener("blur",G,!0),h&&(h.addEventListener("change",G),h.addEventListener("blur",G,!0)),at&&(at.addEventListener("change",G),at.addEventListener("blur",G,!0)),e.dataset.replicateKeyAutosaveBound="1"}}if(Oe&&li&&!e.dataset.audioSettingsAutosaveBound){let q=!1,F=null,T=()=>{let Ce=De=>{let _t=Oe.querySelector(De);return _t?_t.value:null},Pe=De=>{let _t=Oe.querySelector(De);return _t?_t.tagName==="SELECT"?_t.value:_t.type==="checkbox"?_t.checked?"1":"0":_t.value?_t.value:"0":null},je={},He=Pe(".aipkit_voice_input_toggle_switch");if(He!==null){je.enable_voice_input=He;let De=Ce('[name="stt_provider"]');De!==null&&(je.stt_provider=De);let _t=Ce('[name="stt_openai_model_id"]');_t!==null&&(je.stt_openai_model_id=_t)}let Qe=Pe(".aipkit_tts_toggle_switch");if(Qe!==null){je.tts_enabled=Qe;let De=Pe('[name="tts_auto_play"]');De!==null&&(je.tts_auto_play=De);let _t=Ce('[name="tts_provider"]');_t!==null&&(je.tts_provider=_t);let wi=Ce('[name="tts_google_voice_id"]');wi!==null&&(je.tts_google_voice_id=wi);let Rt=Ce('[name="tts_openai_voice_id"]');Rt!==null&&(je.tts_openai_voice_id=Rt);let hi=Ce('[name="tts_openai_model_id"]');hi!==null&&(je.tts_openai_model_id=hi);let Ai=Ce('[name="tts_elevenlabs_voice_id"]');Ai!==null&&(je.tts_elevenlabs_voice_id=Ai);let dn=Ce('[name="tts_elevenlabs_model_id"]');dn!==null&&(je.tts_elevenlabs_model_id=dn)}let We=Pe(".aipkit_enable_realtime_voice_toggle");if(We!==null){je.enable_realtime_voice=We;let De=Pe('[name="direct_voice_mode"]');De!==null&&(je.direct_voice_mode=De);let _t=Pe('[name="input_audio_noise_reduction"]');_t!==null&&(je.input_audio_noise_reduction=_t);let wi=Ce('[name="realtime_model"]');wi!==null&&(je.realtime_model=wi);let Rt=Ce('[name="realtime_voice"]');Rt!==null&&(je.realtime_voice=Rt);let hi=Ce('[name="turn_detection"]');hi!==null&&(je.turn_detection=hi);let Ai=Ce('[name="input_audio_format"]');Ai!==null&&(je.input_audio_format=Ai);let dn=Ce('[name="output_audio_format"]');dn!==null&&(je.output_audio_format=dn);let nn=Ce('[name="speed"]');nn!==null&&(je.speed=nn)}return je},W=T(),te=(()=>{let Ce=Oe.querySelector('[name="elevenlabs_api_key"]');return Ce?Ce.value:""})(),ne=!1,G=null,O=!1,z=Oe.querySelector(".aipkit_tts_sync_status"),ae=(Ce,Pe,je)=>{z&&(z.textContent=Ce||"",z.classList.remove("success","error","loading"),Pe&&z.classList.add(Pe),je?z.setAttribute("title",je):z.removeAttribute("title"),z.style.display=Ce?"inline-block":"none")},ge=(Ce=2500)=>{z&&setTimeout(()=>{ae("")},Ce)},he=()=>{let Ce=Oe.querySelector('[name="tts_provider"]');return Ce?Ce.value:""},Ke=()=>{let Ce=Oe.querySelector(".aipkit_tts_toggle_switch");return Ce?Ce.checked:!1},lt=()=>{let Ce=Oe.querySelector('select[name="tts_google_voice_id"]');return!Ce||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_updateGoogleVoiceSelect!="function"||O?Promise.resolve():(O=!0,ae("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(Pe=>{if(!Pe||!Pe.voices)throw new Error("Invalid response received from voice sync.");let je=Ce.value||"";window.aipkit_updateGoogleVoiceSelect(Ce.id,Pe.voices,je);let He=document.getElementById("aipkit_google_tts_voices_json_main");He&&(He.dataset.voices=JSON.stringify(Pe.voices)),ae(Pe.message||"Synced","success"),ge()}).catch(Pe=>{let je=Pe?.message||"Sync failed.";throw ae(je,"error",je),ge(5e3),Pe}).finally(()=>{O=!1}))},mt=()=>{let Ce=Ct();if(!Ce||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect!="function"||typeof window.aipkit_chatTts_updateElevenLabsModelsSelect!="function")return Promise.resolve();let Pe=Oe.querySelector('select[name="tts_elevenlabs_voice_id"]'),je=Oe.querySelector('select[name="tts_elevenlabs_model_id"]');if(!Pe&&!je||O)return Promise.resolve();O=!0,ae("Syncing...","loading");let He=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabs"}).then(We=>{let De=We?.models||[];Pe&&window.aipkit_chatTts_updateElevenLabsVoiceSelect(Pe.id,De,Pe.value||"");let _t=document.getElementById(`aipkit_elevenlabs_voices_json_${Ce}`);_t&&(_t.dataset.voices=JSON.stringify(De))}),Qe=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabsModels"}).then(We=>{let De=We?.models||[];je&&window.aipkit_chatTts_updateElevenLabsModelsSelect(je.id,De,je.value||"");let _t=document.getElementById(`aipkit_elevenlabs_models_json_${Ce}`);_t&&(_t.dataset.models=JSON.stringify(De))});return Promise.allSettled([He,Qe]).then(We=>{let De=We.find(_t=>_t.status==="rejected");if(De){let _t=De.reason?.message||"Sync failed.";throw ae(_t,"error",_t),ge(5e3),De.reason}return ae("Synced","success"),ge(),We}).finally(()=>{O=!1})},Xe=Ce=>{try{let Pe=Ce?JSON.parse(Ce):[];return Array.isArray(Pe)&&Pe.length>0}catch{return!1}},et=Ce=>Ce?!!(Ce.options&&Ce.options.length>1):!1,Pt=()=>{let Ce=Oe.querySelector('select[name="tts_google_voice_id"]'),Pe=document.getElementById("aipkit_google_tts_voices_json_main");return!Xe(Pe?.dataset?.voices)||!et(Ce)},ri=()=>{let Ce=Ct();if(!Ce)return!1;let Pe=Oe.querySelector('select[name="tts_elevenlabs_voice_id"]'),je=Oe.querySelector('select[name="tts_elevenlabs_model_id"]'),He=document.getElementById(`aipkit_elevenlabs_voices_json_${Ce}`),Qe=document.getElementById(`aipkit_elevenlabs_models_json_${Ce}`),We=Xe(He?.dataset?.voices),De=Xe(Qe?.dataset?.models);return!We||!De||!et(Pe)||!et(je)},Ut=()=>{if(!Ke())return Promise.resolve();let Ce=he();return Ce==="Google"?Pt()?lt():Promise.resolve():Ce==="ElevenLabs"&&ri()?mt():Promise.resolve()};window.aipkit_syncAudioTtsOnOpen=Ut;let gt=Ce=>{Ce!=null&&(ne=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{elevenlabs_api_key:Ce}).then(Pe=>{te=Ce,Be(Pe.message||"Saved","success"),si(),he()==="ElevenLabs"&&Ke()&&mt().catch(()=>{})}).catch(Pe=>{Be(`Error: ${Pe.message||"Failed to save."}`,"error")}).finally(()=>{if(ne=!1,G!==null){let Pe=G;G=null,Pe!==te&&gt(Pe)}}))},jt=Ce=>{if(Ce!=null&&Ce!==te){if(ne){G=Ce;return}gt(Ce)}},Ct=()=>u&&u.value||e.getAttribute("data-active-bot-id"),_i=()=>{let Ce=Ct();Oe.querySelectorAll(".aipkit_audio_format_combo_select").forEach(We=>{let De=We.closest(".aipkit_popover_option_row"),_t=De?.querySelector('[name="input_audio_format"]'),wi=De?.querySelector('[name="output_audio_format"]'),Rt=We.querySelector('option[value="current"]');!_t||!wi||!Rt||(Rt.textContent=`In: ${_t.value} / Out: ${wi.value}`,We.value="current")});let je=Oe.querySelector('select[name="tts_google_voice_id"]');if(je&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let We=document.getElementById("aipkit_google_tts_voices_json_main");try{let De=We?.dataset?.voices?JSON.parse(We.dataset.voices):[];window.aipkit_updateGoogleVoiceSelect(je.id,De,je.value||"")}catch(De){console.warn("AIPKit Builder: Failed to parse Google TTS voices data.",De)}}let He=Oe.querySelector('select[name="tts_elevenlabs_voice_id"]');if(Ce&&He&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){let We=document.getElementById(`aipkit_elevenlabs_voices_json_${Ce}`);try{let De=We?.dataset?.voices?JSON.parse(We.dataset.voices):[];window.aipkit_chatTts_updateElevenLabsVoiceSelect(He.id,De,He.value||"")}catch(De){console.warn("AIPKit Builder: Failed to parse ElevenLabs voices data.",De)}}let Qe=Oe.querySelector('select[name="tts_elevenlabs_model_id"]');if(Ce&&Qe&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){let We=document.getElementById(`aipkit_elevenlabs_models_json_${Ce}`);try{let De=We?.dataset?.models?JSON.parse(We.dataset.models):[];window.aipkit_chatTts_updateElevenLabsModelsSelect(Qe.id,De,Qe.value||"")}catch(De){console.warn("AIPKit Builder: Failed to parse ElevenLabs models data.",De)}}},di=Ce=>{let Pe=Ct();Pe&&(q=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_audio_settings",{bot_id:Pe,...Ce}).then(je=>{W=Ce,Be(je.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Pe),si()}).catch(je=>{Be(`Error: ${je.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F){let je=F;F=null,JSON.stringify(je)!==JSON.stringify(W)&&di(je)}}))},qi=Ce=>{if(!(!Ce||Object.keys(Ce).length===0)&&JSON.stringify(Ce)!==JSON.stringify(W)){if(q){F=Ce;return}di(Ce)}};Oe.addEventListener("change",Ce=>{let Pe=Ce.target;if(Pe){if(Pe.matches(".aipkit_audio_format_combo_select")){let je=Pe.closest(".aipkit_popover_option_row"),He=je?.querySelector('[name="input_audio_format"]'),Qe=je?.querySelector('[name="output_audio_format"]'),We=Pe.querySelector('option[value="current"]'),De=Pe.value||"";if(!He||!Qe||!We||!De)return;De.startsWith("in:")?He.value=De.replace("in:",""):De.startsWith("out:")&&(Qe.value=De.replace("out:","")),We.textContent=`In: ${He.value} / Out: ${Qe.value}`,Pe.value="current",He.dispatchEvent(new Event("change",{bubbles:!0})),Qe.dispatchEvent(new Event("change",{bubbles:!0}));return}if(Pe.matches('[name="elevenlabs_api_key"]')){jt(Pe.value);return}if((Pe.matches(".aipkit_voice_input_toggle_switch")||Pe.matches(".aipkit_stt_provider_select")||Pe.matches('[name="stt_openai_model_id"]')||Pe.matches(".aipkit_tts_toggle_switch")||Pe.matches('[name="tts_auto_play"]')||Pe.matches(".aipkit_tts_provider_select")||Pe.matches('[name="tts_google_voice_id"]')||Pe.matches('[name="tts_openai_voice_id"]')||Pe.matches('[name="tts_openai_model_id"]')||Pe.matches('[name="tts_elevenlabs_voice_id"]')||Pe.matches('[name="tts_elevenlabs_model_id"]')||Pe.matches(".aipkit_enable_realtime_voice_toggle")||Pe.matches('[name="direct_voice_mode"]')||Pe.matches('[name="input_audio_noise_reduction"]')||Pe.matches('[name="realtime_model"]')||Pe.matches('[name="realtime_voice"]')||Pe.matches('[name="turn_detection"]')||Pe.matches('[name="input_audio_format"]')||Pe.matches('[name="output_audio_format"]')||Pe.matches('[name="speed"]'))&&(tn(),qi(T()),Pe.matches(".aipkit_tts_provider_select")&&Ke())){let je=he();je==="Google"?lt().catch(()=>{}):je==="ElevenLabs"&&mt().catch(()=>{})}}}),tn(),_i(),e.dataset.audioSettingsAutosaveBound="1"}if(gi&&li&&!e.dataset.popupSettingsAutosaveBound){let q=!1,F=null,T=()=>{let G=De=>gi&&gi.querySelector(De)||oi&&oi.querySelector(De),O=De=>{let _t=G(De);return _t?_t.value:null},z=De=>{let _t=G(De);return _t?_t.checked?"1":"0":null},ae={},ge=O('[name="popup_position"]');ge!==null&&(ae.popup_position=ge);let he=O('[name="popup_delay"]');he!==null&&(ae.popup_delay=he);let Ke=O('[name="popup_icon_style"]');Ke!==null&&(ae.popup_icon_style=Ke);let lt=O('[name="popup_icon_size"]');lt!==null&&(ae.popup_icon_size=lt);let mt=O('[name="popup_icon_type"]');mt!==null&&(ae.popup_icon_type=mt);let Xe=O('[name="popup_icon_default"]:checked');Xe!==null&&(ae.popup_icon_default=Xe);let et=O('[name="popup_icon_custom_url"]');et!==null&&(ae.popup_icon_custom_url=et);let Pt=O('[name="header_avatar_type"]');Pt!==null&&(ae.header_avatar_type=Pt);let ri=O('[name="header_avatar_default"]:checked');ri!==null&&(ae.header_avatar_default=ri);let Ut=O('[name="header_avatar_url"]');Ut!==null&&(ae.header_avatar_url=Ut);let gt=O('[name="header_online_text"]');gt!==null&&(ae.header_online_text=gt);let jt=z('[name="popup_label_enabled"]');jt!==null&&(ae.popup_label_enabled=jt);let Ct=O('[name="popup_label_text"]');Ct!==null&&(ae.popup_label_text=Ct);let _i=O('[name="popup_label_mode"]');_i!==null&&(ae.popup_label_mode=_i);let di=O('[name="popup_label_size"]');di!==null&&(ae.popup_label_size=di);let qi=O('[name="popup_label_delay_seconds"]');qi!==null&&(ae.popup_label_delay_seconds=qi);let Ce=O('[name="popup_label_auto_hide_seconds"]');Ce!==null&&(ae.popup_label_auto_hide_seconds=Ce);let Pe=z('[name="popup_label_dismissible"]');Pe!==null&&(ae.popup_label_dismissible=Pe);let je=z('[name="popup_label_show_on_desktop"]');je!==null&&(ae.popup_label_show_on_desktop=je);let He=z('[name="popup_label_show_on_mobile"]');He!==null&&(ae.popup_label_show_on_mobile=He);let Qe=O('[name="popup_label_frequency"]');Qe!==null&&(ae.popup_label_frequency=Qe);let We=O('[name="popup_label_version"]');return We!==null&&(ae.popup_label_version=We),ae},W=T(),Y=()=>u&&u.value||e.getAttribute("data-active-bot-id"),te=G=>{let O=Y();O&&(q=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_popup_settings",{bot_id:O,...G}).then(z=>{W=G,Be(z.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),si()}).catch(z=>{Be(`Error: ${z.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F){let z=F;F=null,JSON.stringify(z)!==JSON.stringify(W)&&te(z)}}))},ne=G=>{if(!(!G||Object.keys(G).length===0)&&JSON.stringify(G)!==JSON.stringify(W)){if(q){F=G;return}te(G)}};gi.addEventListener("change",G=>{let O=G.target;O&&((O.matches('select[name="popup_icon_type"]')||O.matches('select[name="popup_icon_style"]')||O.matches('select[name="header_avatar_type"]')||O.matches(".aipkit_popup_hint_toggle_switch"))&&An(),(O.matches('[name="popup_position"]')||O.matches('[name="popup_delay"]')||O.matches('[name="popup_icon_style"]')||O.matches('[name="popup_icon_size"]')||O.matches('[name="popup_icon_type"]')||O.matches('[name="popup_icon_default"]')||O.matches('[name="popup_icon_custom_url"]')||O.matches('[name="header_avatar_type"]')||O.matches('[name="header_avatar_default"]')||O.matches('[name="header_avatar_url"]')||O.matches('[name="header_online_text"]')||O.matches('[name="popup_label_enabled"]')||O.matches('[name="popup_label_text"]')||O.matches('[name="popup_label_mode"]')||O.matches('[name="popup_label_size"]')||O.matches('[name="popup_label_delay_seconds"]')||O.matches('[name="popup_label_auto_hide_seconds"]')||O.matches('[name="popup_label_dismissible"]')||O.matches('[name="popup_label_show_on_desktop"]')||O.matches('[name="popup_label_show_on_mobile"]')||O.matches('[name="popup_label_frequency"]')||O.matches('[name="popup_label_version"]'))&&ne(T()))}),oi&&oi.addEventListener("change",G=>{let O=G.target;O&&(O.matches('[name="popup_label_text"]')||O.matches('[name="popup_label_mode"]')||O.matches('[name="popup_label_size"]')||O.matches('[name="popup_label_delay_seconds"]')||O.matches('[name="popup_label_auto_hide_seconds"]')||O.matches('[name="popup_label_dismissible"]')||O.matches('[name="popup_label_show_on_desktop"]')||O.matches('[name="popup_label_show_on_mobile"]')||O.matches('[name="popup_label_frequency"]')||O.matches('[name="popup_label_version"]'))&&ne(T())}),An(),e.dataset.popupSettingsAutosaveBound="1"}if(h&&li&&!e.dataset.conversationSettingsAutosaveBound){let q=!1,F=null,T=()=>{let G=z=>{let ae=h&&h.querySelector(z)||Mt&&Mt.querySelector(z);return ae?ae.value:""},O=z=>{let ae=h.querySelector(z);return ae?ae.tagName==="SELECT"?ae.value==="1"?"1":"0":ae.checked?"1":"0":"0"};return{stream_enabled:O(".aipkit_stream_enable_toggle"),openai_conversation_state_enabled:O(".aipkit_stateful_convo_checkbox"),reasoning_effort:G('[name="reasoning_effort"]')}},W=T(),Y=G=>{let O=u&&u.value||e.getAttribute("data-active-bot-id");O&&(q=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_conversation_settings",{bot_id:O,...G}).then(z=>{W=G,Be(z.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(O),si()}).catch(z=>{Be(`Error: ${z.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F){let z=F;F=null,JSON.stringify(z)!==JSON.stringify(W)&&Y(z)}}))},te=G=>{if(JSON.stringify(G)!==JSON.stringify(W)){if(q){F=G;return}Y(G)}},ne=G=>{let O=G.target;O&&(O.matches(".aipkit_stream_enable_toggle")||O.matches(".aipkit_stateful_convo_checkbox")||O.matches(".aipkit_reasoning_effort_slider")||O.matches('[name="reasoning_effort"]'))&&(ln(),te(T()))};h.addEventListener("change",ne),Mt&&Mt.addEventListener("change",ne),e.dataset.conversationSettingsAutosaveBound="1"}if(h&&li&&!e.dataset.fileUploadAutosaveBound){let q=!1,F=null,T=()=>{let ne=h.querySelector('[name="enable_file_upload"]');return!ne||ne.disabled?"":ne.tagName==="SELECT"?ne.value==="1"?"1":"0":ne.checked?"1":"0"},W=T(),Y=ne=>{let G=u&&u.value||e.getAttribute("data-active-bot-id");!G||ne===""||(q=!0,Be("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_file_upload_settings",{bot_id:G,enable_file_upload:ne}).then(O=>{W=ne,Be(O.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(G),si()}).catch(O=>{Be(`Error: ${O.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,F!==null&&F!==W){let O=F;F=null,Y(O)}else F=null}))},te=ne=>{if(!(ne===""||ne===W)){if(q){F=ne;return}Y(ne)}};h.addEventListener("change",ne=>{let G=ne.target;G&&G.matches('[name="enable_file_upload"]')&&(te(T()),Hn()==="1"?io():gn())}),e.dataset.fileUploadAutosaveBound="1"}let bo=u&&u.value||e.getAttribute("data-active-bot-id");if(bo&&typeof window.aipkit_refreshChatPreview=="function"){window.aipkit_refreshChatPreview(bo);return}let Q=window.aipkit_dashboard?.text?.previewPlaceholderSelect||"Select a bot to see the preview.";r(Q)}window.aipkit_initChatbotBuilder=n})();(function(){"use strict";function g(r){if(!r)return;let n=r.querySelector(".aipkit_token_limit_mode_select"),e=r.querySelector(".aipkit_token_general_user_limit_field"),i=r.querySelector(".aipkit_token_role_limits_container");if(!n||!e||!i){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let c=n.value;e.style.display=c==="general"?"block":"none",i.style.display=c==="role_based"?"block":"none"}function o(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Token Management JS: Main content container not found.");return}r.addEventListener("change",function(e){let i=e.target.closest(".aipkit_token_limit_mode_select");if(!i)return;let c=i.closest(".aipkit_accordion-content");c?g(c):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",i)}),r.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(e=>{let i=e.querySelector(".aipkit_accordion-content");i&&g(i)})}window.aipkit_initTokenManagementUI=o})();(function(){"use strict";function g(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let n=document.querySelector(".aipkit_chatbot_module_container");n&&(n.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js.");let o=document.getElementById("aipkit_chatolia_notice");if(o){let n=o.querySelector(".aipkit_notification_bar__close");n&&n.addEventListener("click",()=>{o.style.display="none"});let e=document.getElementById("aipkit_dismiss_chatolia_notice_btn");e&&e.addEventListener("click",()=>{if(typeof window.aipkit_apiRequest!="function"){alert("Error: API function missing.");return}e.disabled=!0,e.textContent="Dismissing...",window.aipkit_apiRequest("aipkit_dismiss_chatolia_notice").then(()=>{o.style.display="none"}).catch(i=>{alert("Error dismissing notice: "+i.message),e.disabled=!1,e.textContent="Dont Show Again"})})}typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatSelectPickers=="function"?window.aipkit_initChatSelectPickers():console.error("AIPKit Chat Admin Main: aipkit_initChatSelectPickers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Chat Admin Main: aipkit_initSyncButtons function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles(".aipkit_chatbot_module_container"):console.error("AIPKit Chat Admin Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCustomThemePresets=="function"?window.aipkit_initCustomThemePresets():console.error("AIPKit Chat Admin Main: aipkit_initCustomThemePresets function not found."),typeof window.aipkit_initCreateNewBot=="function"?window.aipkit_initCreateNewBot():console.error("AIPKit Chat Admin Main: aipkit_initCreateNewBot function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initChatbotBuilder=="function"&&window.aipkit_initChatbotBuilder(),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found.");let r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(r){let n=r.dataset.botId,e=document.getElementById(`aipkit_trigger_builder_${n}`);n&&e&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(n):n&&e&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${n}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy(),function(){let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(i){if(i.target.closest(".aipkit_header_reset_btn, .aipkit_header_delete_btn, .aipkit_actions_dropdown_container .aipkit_tab_dropdown_trigger"))return;if(i.target.closest("#aipkit_chatbot_header_save_btn")){let d=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");d&&(typeof d.requestSubmit=="function"?d.requestSubmit():d.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})));return}if(i.target.closest(".aipkit_header_reset_btn")){let d=e.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");d&&(d.style.display="none");let l=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form")?.dataset.botId,p=e.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",_=e.querySelector("#aipkit_header_action_feedback");if(!l||!_)return;_.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_reset_confirmation" id="aipkit_reset_confirmation_${l}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_inline">Confirm</button>
              </div>
            </div>`,_.querySelector(".aipkit_reset_cancel_inline")?.addEventListener("click",()=>{_.innerHTML=""},{once:!0}),_.querySelector(".aipkit_reset_confirm_inline")?.addEventListener("click",()=>{_.innerHTML='<span class="aipkit_action_status_message">Resetting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:l}).then(u=>{_.innerHTML=`<span class="aipkit_action_status_message success">${u.message||"Chatbot reset successfully!"}</span>`,typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:l}),setTimeout(()=>{_.innerHTML=""},3e3)}).catch(u=>{_.innerHTML=`<span class="aipkit_action_status_message error">Error: ${u.message||"Failed to reset chatbot."}</span>`,setTimeout(()=>{_.innerHTML=""},4e3)})},{once:!0});return}if(i.target.closest(".aipkit_header_delete_btn")){let d=e.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");d&&(d.style.display="none");let a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),l=a?.dataset.botId,p=a?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",_=e.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",u=e.querySelector("#aipkit_header_action_feedback");if(!l||!u)return;if(p){u.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{u.innerHTML=""},3e3);return}u.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_delete_confirmation" id="aipkit_delete_confirmation_${l}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_inline">Confirm</button>
              </div>
            </div>`,u.querySelector(".aipkit_delete_cancel_inline")?.addEventListener("click",()=>{u.innerHTML=""},{once:!0}),u.querySelector(".aipkit_delete_confirm_inline")?.addEventListener("click",()=>{u.innerHTML='<span class="aipkit_action_status_message">Deleting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:l}).then(m=>{u.innerHTML=`<span class="aipkit_action_status_message success">${m.message||"Chatbot deleted successfully."}</span>`;let k=null,f=document.getElementById("aipkit_chatbot_main_selector_container");if(f){let w=f.querySelector(".aipkit_tab_dropdown_item .dashicons-star-filled"),E=w?w.closest(".aipkit_tab_dropdown_item"):null;if(E)k=E.getAttribute("data-bot-id");else{let y=f.querySelector(`.aipkit_tab_dropdown_item[data-bot-id]:not([data-bot-id="${l}"])`);y&&(k=y.getAttribute("data-bot-id"))}}if(typeof window.aipkit_loadModule=="function"){let w=k?{force_active_bot_id:k}:{};window.aipkit_loadModule("chatbot",w)}setTimeout(()=>{u.innerHTML=""},3e3)}).catch(m=>{u.innerHTML=`<span class="aipkit_action_status_message error">Error: ${m.message||"Failed to delete chatbot."}</span>`,setTimeout(()=>{u.innerHTML=""},4e3)})},{once:!0});return}})}()}window.aipkit_initChatbot=g})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"modified",sortDirection:"desc",isLoading:!1}})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_ai_forms_list_tbody"),n=document.getElementById("aipkit_ai_forms_container"),e=window.aipkit_escapeHtml||(t=>t),i=wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,c=wp.i18n&&wp.i18n._n?wp.i18n._n:null,s=wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:null;r&&(r.innerHTML="",!(!o||o.length===0)&&o.forEach(t=>{let d=window.aipkit_dashboard?.isProPlan??!1,a=window.aipkit_dashboard?.upgradeUrl||"#",l="",p="";if(d)l=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label">${i("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="pdf_download" value="true">
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`;else{let v=i("This is a Pro feature. Please upgrade.","gpt3-ai-content-generator");l=`
              <div class="aipkit_popover_option_row aipkit_popover_option_row--disabled">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label" data-tooltip="${e(v)}">${i("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch" disabled>
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`,p=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main aipkit_popover_option_main--stacked">
                      <p class="aipkit_form-help">${i("Save as PDF is available on the Pro plan.","gpt3-ai-content-generator")}</p>
                      <a class="aipkit_btn aipkit_btn-primary" href="${e(a)}" target="_blank" rel="noopener noreferrer">
                        ${i("Upgrade to Pro","gpt3-ai-content-generator")}
                      </a>
                  </div>
              </div>`}let _=r.insertRow(),u=_.insertCell();u.classList.add("aipkit_ai_form_title_cell");let m=e(t.title||i("Untitled","gpt3-ai-content-generator")),k=t.updated_at||t.updatedAt||t.updated||"",f="",w="";k&&(typeof window.aipkit_formatRelativeDateTime=="function"?f=window.aipkit_formatRelativeDateTime(k):typeof window.aipkit_formatUtcDateTime=="function"?f=window.aipkit_formatUtcDateTime(k):f=k,typeof window.aipkit_formatUtcDateTime=="function"&&(w=window.aipkit_formatUtcDateTime(k)));let E=t.submissions_count??t.submission_count??t.submissionsCount??0,y=Number.isFinite(Number(E))?Number(E):0,I=[];if(f){let v=s?s(i("Updated %s","gpt3-ai-content-generator"),f):`${i("Updated","gpt3-ai-content-generator")} ${f}`,C=w?` title="${e(w)}"`:"";I.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_updated"${C}>${e(v)}</span>`)}if(y>0){let v=`${y} ${i(y===1?"submission":"submissions","gpt3-ai-content-generator")}`;c&&s&&(v=s(c("%s submission","%s submissions",y,"gpt3-ai-content-generator"),y)),I.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_count">${e(v)}</span>`)}let S=I.length?`
          <span class="aipkit_ai_form_meta">
            ${I.join('<span class="aipkit_ai_form_meta_sep" aria-hidden="true">&middot;</span>')}
          </span>
        `:"";u.innerHTML=`
        <span class="aipkit_ai_form_title_text" title="${m}">${m}</span>
        ${S}
      `;let h=_.insertCell();h.classList.add("aipkit_ai_form_model_cell");let M=t.model||i("Default","gpt3-ai-content-generator");h.textContent=M,h.title=M;let b=_.insertCell();b.classList.add("aipkit_shortcode_cell","aipkit_ai_form_shortcode_cell");let A=`aipkit_ai_form_theme_${t.id}`;b.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${t.id}" readonly value="${e(t.shortcode)}" data-aipkit-shortcode-display="${t.id}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${t.id}" title="${i("Shortcode settings","gpt3-ai-content-generator")}" aria-label="${i("Shortcode settings","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-shortcode" aria-hidden="true"></span>
              <span class="screen-reader-text">${i("Shortcode settings","gpt3-ai-content-generator")}</span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator aipkit_model_settings_popover_panel" id="aif-configurator-${t.id}" style="display: none;" role="dialog" aria-modal="false" aria-labelledby="aif-shortcode-title-${t.id}">
            <div class="aipkit_model_settings_popover_header">
                <span class="aipkit_model_settings_popover_title" id="aif-shortcode-title-${t.id}">
                  ${i("Shortcode Settings","gpt3-ai-content-generator")}
                </span>
                <button
                    type="button"
                    class="aipkit_model_settings_popover_close aipkit_aiform_shortcode_close"
                    aria-label="${i("Close","gpt3-ai-content-generator")}"
                >
                    <span class="dashicons dashicons-no-alt"></span>
                </button>
            </div>
            <div class="aipkit_model_settings_popover_body">
                <div class="aipkit_popover_options_list">
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Show Provider Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="show_provider" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Show Model Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="show_model" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Copy Button","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="copy_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Save as Post","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="save_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    ${l}
                    ${p}
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <label class="aipkit_popover_option_label" for="${A}">
                              ${i("Theme","gpt3-ai-content-generator")}
                            </label>
                            <div class="aipkit_popover_option_actions">
                                <select id="${A}" class="aipkit_popover_option_select aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="theme">
                                    <option value="light">${i("Light (default)","gpt3-ai-content-generator")}</option>
                                    <option value="dark">${i("Dark","gpt3-ai-content-generator")}</option>
                                    <option value="custom">${i("Custom","gpt3-ai-content-generator")}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${i("Shortcode","gpt3-ai-content-generator")}</span>
                            <div class="aipkit_popover_option_actions">
                                <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" readonly value="${e(t.shortcode)}" data-aipkit-shortcode-display="${t.id}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="aipkit_popover_flyout_footer">
                <span class="aipkit_popover_flyout_footer_text">
                    ${i("Need help?","gpt3-ai-content-generator")}
                </span>
                <a
                    class="aipkit_popover_flyout_footer_link"
                    href="https://docs.aipower.org/docs/category/ai-forms"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    ${i("Documentation","gpt3-ai-content-generator")}
                </a>
            </div>
        </div>
      `,n&&typeof window.aipkitForms_applyStoredShortcodeConfig=="function"&&window.aipkitForms_applyStoredShortcodeConfig(t.id,n);let x=_.insertCell();x.classList.add("aipkit_form_actions_cell"),x.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_edit_ai_form_btn" data-form-id="${t.id}" title="${i("Edit","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            ${i("Edit","gpt3-ai-content-generator")}
          </button>
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_preview_ai_form_btn" data-form-id="${t.id}" data-form-title="${e(t.title||"")}" title="${i("Preview","gpt3-ai-content-generator")}" aria-label="${i("Preview","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-visibility" aria-hidden="true"></span>
            <span class="screen-reader-text">${i("Preview","gpt3-ai-content-generator")}</span>
          </button>
          <div class="aipkit_actions_menu">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_actions_menu_toggle" title="${i("More actions","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-ellipsis"></span>
            </button>
            <div class="aipkit_actions_dropdown_menu">
              <button type="button" class="aipkit_dropdown-item-btn aipkit_duplicate_ai_form_btn" data-form-id="${t.id}" title="${i("Duplicate","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-page"></span>
                <span>${i("Duplicate","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_export_ai_form_btn" data-form-id="${t.id}" title="${i("Export","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-download"></span>
                <span>${i("Export","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_dropdown-item--danger aipkit_delete_ai_form_btn" data-form-id="${t.id}" data-form-title="${e(t.title)}" title="${i("Delete","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-trash"></span>
                <span>${i("Delete","gpt3-ai-content-generator")}</span>
              </button>
            </div>
          </div>
        </div>
      `}))}window.aipkitForms_renderTable=g})();(function(){"use strict";function g(o){let r=window.aipkitAIFormsListState,n=document.getElementById("aipkit_ai_forms_pagination"),e=document.getElementById("aipkit_ai_forms_count_summary");if(!n||!o||!r)return;let i=wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a,c=wp.i18n&&wp.i18n._n?wp.i18n._n:(a,l,p)=>p===1?a:l;n.innerHTML="";let{total_forms:s,total_pages:t}=o,d=r.currentPage;if(e){let a=c("form","forms",s,"gpt3-ai-content-generator");e.textContent=`${s.toLocaleString()} ${a}`}if(!(s<=0)&&t>1){let a=document.createElement("span");a.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",l.innerHTML=`\xAB ${i("Previous","gpt3-ai-content-generator")}`,l.disabled=d<=1,a.appendChild(l);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${i("Page","gpt3-ai-content-generator")} ${d} ${i("of","gpt3-ai-content-generator")} ${t}`,a.appendChild(p);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",_.innerHTML=`${i("Next","gpt3-ai-content-generator")} \xBB`,_.disabled=d>=t,a.appendChild(_),n.appendChild(a)}}window.aipkitForms_renderPagination=g})();(function(){"use strict";function g(){let o=window.aipkitAIFormsListState;if(!o||o.isLoading)return;o.isLoading=!0;let r=document.getElementById("aipkit_ai_forms_list_tbody"),n=document.getElementById("aipkit_no_ai_forms_message"),e=document.getElementById("aipkit_ai_forms_pagination");r&&(r.innerHTML='<tr><td colspan="4" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),n&&(n.style.display="none"),e&&(e.innerHTML="");let c={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:o.currentPage,search:o.searchQuery,sort_by:o.sortColumn,sort_order:o.sortDirection};window.aipkit_apiRequest("aipkit_list_ai_forms",c).then(s=>{if(typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(s.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(s.pagination||{}),n&&(!s.forms||s.forms.length===0)){n.style.display="block";let t=!!o.searchQuery&&o.searchQuery.trim().length>0;n.textContent=t?"No forms found matching your search.":"No AI Forms have been created yet."}}).catch(s=>{r&&(r.innerHTML=`<tr><td colspan="4" style="color:red;text-align:center;">Error loading forms: ${s.message}</td></tr>`)}).finally(()=>{o.isLoading=!1})}window.aipkitForms_fetchForms=g})();(function(){"use strict";let g;function o(){let r=document.getElementById("aipkit_ai_forms_list_container");if(!r||r.dataset.listListenersAttached)return;r.dataset.listListenersAttached="true";let n=window.aipkitAIFormsListState;if(!n){console.error("AI Forms Events: List state object is not available.");return}r.addEventListener("click",function(i){let c=i.target,s=c.closest(".aipkit-sortable-col");if(s){let t=s.dataset.sortKey;n.sortColumn===t?n.sortDirection=n.sortDirection==="asc"?"desc":"asc":(n.sortColumn=t,n.sortDirection="asc"),n.currentPage=1,r.querySelectorAll(".aipkit-sortable-col").forEach(d=>d.removeAttribute("data-sort-direction")),s.setAttribute("data-sort-direction",n.sortDirection),window.aipkitForms_fetchForms();return}if(c.matches(".aipkit_pagination_prev")){n.currentPage>1&&(n.currentPage--,window.aipkitForms_fetchForms());return}if(c.matches(".aipkit_pagination_next")){n.currentPage++,window.aipkitForms_fetchForms();return}});let e=r.querySelector("#aipkit_ai_forms_search_input");e&&e.addEventListener("input",function(){clearTimeout(g),g=setTimeout(()=>{n.searchQuery=this.value,n.currentPage=1,window.aipkitForms_fetchForms()},400)})}window.aipkitForms_attachListEventListeners=o})();(function(){"use strict";function g(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=g})();(function(){"use strict";function g(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let n=o.querySelector("#aipkit_ai_form_elements_palette"),e=o.querySelector("#aipkit_ai_form_designer_area"),i=o.querySelector("#aipkit_form_designer_placeholder");if(!n||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(n.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;n.querySelectorAll(".aipkit_form_element_item").forEach(s=>{s.dataset.dragStartListenerAttached!=="true"&&(s.addEventListener("dragstart",t=>{r.draggedElementType=t.target.dataset.elementType,t.dataTransfer.setData("text/plain",r.draggedElementType),t.dataTransfer.effectAllowed="copy",t.target.classList.add("aipkit-dragging"),r.draggedElement=null}),s.addEventListener("dragend",t=>{t.target.classList.remove("aipkit-dragging"),r.draggedElementType=null}),s.dataset.dragStartListenerAttached="true")}),n.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",s=>{s.target.classList.contains("aipkit_dropped_element")&&(r.draggedElement=s.target,s.dataTransfer.setData("text/element-id",s.target.id),s.dataTransfer.effectAllowed="move",setTimeout(()=>{r.draggedElement&&(r.draggedElement.style.opacity="0.5")},0),r.draggedElementType=null)}),e.addEventListener("dragend",s=>{r.draggedElement&&(r.draggedElement.style.opacity="1",r.draggedElement=null)}),e.addEventListener("dragover",s=>{s.preventDefault();let t=s.target.closest(".aipkit_dropped_element");e.classList.add("aipkit-drag-over"),r.draggedElement&&t&&r.draggedElement!==t?s.dataTransfer.dropEffect="move":s.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",s=>{e.contains(s.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",s=>{s.preventDefault(),e.classList.remove("aipkit-drag-over");let t=s.dataTransfer.getData("text/element-id");if(r.draggedElement&&t===r.draggedElement.id){let d=s.target.closest(".aipkit_dropped_element"),a=null;if(d&&d!==r.draggedElement){let l=d.getBoundingClientRect();a=s.clientY>l.top+l.height/2?d.nextSibling:d}e.insertBefore(r.draggedElement,a),r.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){if(i&&i.style.display!=="none"&&(i.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let d=window.aipkitForms_createNewFormElementData(r.draggedElementType);r.formStructure.push(d),window.aipkitForms_renderDroppedElement(e,d,null)}r.draggedElementType=null,r.draggedElement=null}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=g})();(function(){"use strict";function g(){let o=window.aipkitAIFormsState,r=document.getElementById("aipkit_ai_form_designer_area");if(!r)return;let n=[];r.querySelectorAll(".aipkit_layout_row").forEach(i=>{let c=i.id,s=o.formStructure.find(a=>a.internalId===c);if(!s)return;let t={internalId:c,type:"layout-row",columns:[]};i.querySelectorAll(".aipkit_layout_column").forEach(a=>{let l=a.id,p=s.columns.find(m=>m.internalId===l);if(!p)return;let _={internalId:l,width:p.width,elements:[]};a.querySelectorAll(".aipkit_dropped_element").forEach(m=>{let k=m.id,f=null;o.formStructure.forEach(w=>{w.columns.forEach(E=>{let y=E.elements.find(I=>I.internalId===k);y&&(f=y)})}),f&&_.elements.push(f)}),t.columns.push(_)}),n.push(t)}),o.formStructure=n}window.aipkitForms_updateFormStructureOrder=g})();(function(){"use strict";function g(r){let n=window.aipkitAIFormsState;n.droppedElementCounter++;let e=`field_${r.replace(/-/g,"_")}_${n.droppedElementCounter}`;switch(r){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:r,label:`New ${r.replace(/-/g," ").replace(/\b\w/g,s=>s.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:e,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let i,c;return r==="select"?(i="New Dropdown",c="select"):r==="radio-button"?(i="New Radio Buttons",c="radio"):(i="New Checkbox Group",c="checkbox"),{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:r,label:i,fieldId:`${c}_${n.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${n.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function o(r){let n=Date.now(),e=[];switch(r){case"1-col":e=[{internalId:`col-${n}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":e=[{internalId:`col-${n}-1`,width:"50%",elements:[]},{internalId:`col-${n}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":e=[{internalId:`col-${n}-1`,width:"33.33%",elements:[]},{internalId:`col-${n}-2`,width:"33.33%",elements:[]},{internalId:`col-${n}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":e=[{internalId:`col-${n}-1`,width:"30%",elements:[]},{internalId:`col-${n}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":e=[{internalId:`col-${n}-1`,width:"70%",elements:[]},{internalId:`col-${n}-2`,width:"30%",elements:[]}];break;default:e=[{internalId:`col-${n}-1`,width:"100%",elements:[]}]}return{internalId:`row-${n}`,type:"layout-row",columns:e}}window.aipkitForms_createNewFormElementData=g,window.aipkitForms_createNewLayoutData=o})();(function(){"use strict";function g(o,r,n=null){let e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_,i=window.aipkit_escapeHtml||function(_){return _},c=document.createElement("div");c.className="aipkit_dropped_element",c.id=r.internalId,c.dataset.elementType=r.type;let s=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${e("Drag to reorder","gpt3-ai-content-generator")}"></span>`,t="",d=`${r.internalId}-field`,a="";switch(r.helpText&&(a=`<p class="aipkit_dropped_element_help_text">${i(r.helpText)}</p>`),r.type){case"text-input":t=`<label class="aipkit_dropped_element_label" for="${d}">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${d}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${i(r.placeholder)}" readonly>
                    ${a}`;break;case"textarea":t=`<label class="aipkit_dropped_element_label" for="${d}">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${d}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${i(r.placeholder)}" readonly></textarea>
                    ${a}`;break;case"select":let _="";r.options&&r.options.length>0?r.options.forEach(k=>{_+=`<option value="${i(k.value)}">${i(k.text)}</option>`}):_=`<option>${e("No options configured","gpt3-ai-content-generator")}</option>`,t=`<label class="aipkit_dropped_element_label" for="${d}">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${d}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${_}</select>
                    ${a}`;break;case"radio-button":let u="";r.options&&r.options.length>0?r.options.forEach((k,f)=>{let w=`${d}-${f}`;u+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${w}" class="aipkit_dropped_element_field" name="preview-${r.internalId}" disabled>
                                    <label for="${w}">${i(k.text)}</label>
                                </div>`}):u=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,t=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${u}
                    </fieldset>
                    ${a}`;break;case"checkbox":let m="";r.options&&r.options.length>0?r.options.forEach((k,f)=>{let w=`${d}-${f}`;m+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${w}" class="aipkit_dropped_element_field" name="preview-${r.internalId}-${f}" disabled>
                                    <label for="${w}">${i(k.text)}</label>
                                </div>`}):m=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,t=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${m}
                    </fieldset>
                    ${a}`;break;case"file-upload":t=`<label class="aipkit_dropped_element_label" for="${d}">${i(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${d}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${a}`;break;default:t=`<p>${i(r.label)}</p>${a}`}let l=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${e("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,p=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${e("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;c.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${t}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${s}
            ${l}
            ${p}
        </div>
    `,n?o.insertBefore(c,n):o.appendChild(c)}window.aipkitForms_renderFieldInColumn=g,window.aipkitForms_renderDroppedElement=g})();(function(){"use strict";function g(o,r){let n=window.aipkitAIFormsState,e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!r){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let i=r.querySelector("#aipkit_ai_form_designer_area");if(!i){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let c=i.querySelector(`#${CSS.escape(o)}`);if(c&&(c.remove(),n.formStructure.forEach(s=>{s.columns.forEach(t=>{t.elements=t.elements.filter(d=>d.internalId!==o)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r),n.selectedDesignerElementId===o&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(r):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),i.querySelectorAll(".aipkit_dropped_element").length===0&&i.querySelectorAll(".aipkit_layout_row").length===0)){let s=i.querySelector("#aipkit_form_designer_placeholder");s||(s=document.createElement("div"),s.className="aipkit_form_designer_placeholder",s.id="aipkit_form_designer_placeholder",s.innerHTML=`<span class="dashicons dashicons-layout"></span>${e("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,i.appendChild(s)),s.style.display="flex"}}window.aipkitForms_deleteDroppedElement=g})();(function(){"use strict";function g(){let o=window.aipkitAIFormsState,r=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,n=document.getElementById("aipkit_form_editor_container");if(!n)return;let e=n.querySelector("#aipkit_ai_form_prompt_template"),i=n.querySelector("#aipkit_prompt_validation_results");if(!e||!i)return;let c=e.value,s=[],t=[],d=new Set;o.formStructure.forEach(m=>{m.columns.forEach(k=>{k.elements.forEach(f=>{f.fieldId&&d.add(f.fieldId)})})});let a=/{[a-zA-Z0-9_]+}/g,l=(c.match(a)||[]).map(m=>m.slice(1,-1)),p=new Set(l);l.forEach(m=>{d.has(m)||s.push(`Variable <code>{${m}}</code> is used in the prompt but not defined as a form field.`)}),d.forEach(m=>{p.has(m)||t.push(`Field <code>{${m}}</code> is defined but not used in the prompt.`)});let _=c;if(l.forEach(m=>{let k=new RegExp(`\\{${m}\\}`,"g");_=_.replace(k,"")}),/[{}]/.test(_)&&s.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),i.className="aipkit_form-help",i.innerHTML="",s.length>0){i.classList.add("aipkit-validation-error");let m=`<strong>${r("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;s.forEach(k=>{m+=`<li>${k}</li>`}),m+="</ul>",i.innerHTML=m}else{i.classList.add("aipkit-validation-success");let m=`<strong>${r("Validation Passed!","gpt3-ai-content-generator")}</strong> (${l.length} of ${d.size} fields used).`;t.length>0&&(m+=`<br><strong>${r("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,t.forEach(k=>{m+=`<li>${k}</li>`}),m+="</ul>"),i.innerHTML=m}i.style.display="block",i.dismissTimer&&clearTimeout(i.dismissTimer);let u=s.length>0?8e3:5e3;i.dismissTimer=setTimeout(()=>{i.style.display="none",i.innerHTML=""},u)}window.aipkitForms_validatePrompt=g})();(function(){"use strict";function g(o,r){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_,c=window.aipkit_escapeHtml||function(_){return _};if(!r){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}r.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(_=>_.classList.remove("aipkit-element-selected"));let s=r.querySelector(`#${CSS.escape(o)}`);s&&s.classList.add("aipkit-element-selected"),n.selectedDesignerElementId=o;let t=null;for(let _ of n.formStructure){for(let u of _.columns){let m=u.elements.find(k=>k.internalId===o);if(m){t=m;break}}if(t)break}if(!t){console.error(`showSettingsPanel: Could not find element data for ID ${o} in state.`,n.formStructure);return}let d=r.querySelector("#aipkit_ai_form_elements_palette"),a=r.querySelector("#aipkit_ai_form_element_settings_panel"),l=a?a.querySelector("#aipkit_settings_panel_fields"):null,p=a?a.querySelector("#aipkit_settings_panel_element_type"):null;if(!d||!a||!l||!p){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(p.textContent=`(${t.type.replace(/-/g," ").replace(/\b\w/g,_=>_.toUpperCase())})`,l.innerHTML="",l.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${t.internalId}">${i(e.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${t.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="label" value="${c(t.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${t.internalId}">${i(e.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${t.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="fieldId" value="${c(t.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${i("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${i(e.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(t.type==="text-input"||t.type==="textarea")&&(l.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${t.internalId}">${i(e.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${t.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="placeholder" value="${c(t.placeholder||"")}">
                </div>`),l.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${t.internalId}">
                    <input type="checkbox" id="setting-required-${t.internalId}" class="aipkit-setting-field" data-setting="required" ${t.required?"checked":""}>
                    ${i(e.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${t.internalId}">${i("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${t.internalId}" class="aipkit_form-input aipkit_builder_textarea aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${c(i("This text will appear under the field.","gpt3-ai-content-generator"))}">${c(t.helpText||"")}</textarea>
            </div>
        `,t.type==="select"||t.type==="radio-button"||t.type==="checkbox"){let _=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${i(e.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(t.options||[]).forEach((u,m)=>{_+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-value" data-option-index="${m}" value="${c(u.value)}" placeholder="${i(e.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-text" data-option-index="${m}" value="${c(u.text)}" placeholder="${i(e.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${i(e.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),_+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${i(e.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,l.innerHTML+=_}d.style.display="none",a.style.display="block"}window.aipkitForms_showSettingsPanel=g})();(function(){"use strict";function g(o){let r=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;if(!o){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let e=o.querySelector("#aipkit_ai_form_element_settings_panel");if(!e){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let i=e.querySelector("#aipkit_select_options_container");if(!i){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let c=i.querySelectorAll(".aipkit_select_option_row").length,s=document.createElement("div");s.className="aipkit_select_option_row",s.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${c}" placeholder="${n(r.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${c}" placeholder="${n(r.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${n(r.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,i.appendChild(s)}window.aipkitForms_addSelectOptionRow=g})();(function(){"use strict";function g(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}o.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(i=>i.classList.remove("aipkit-element-selected")),r.selectedDesignerElementId=null;let n=o.querySelector("#aipkit_ai_form_elements_palette"),e=o.querySelector("#aipkit_ai_form_element_settings_panel");n&&(n.style.display="block"),e&&(e.style.display="none")}window.aipkitForms_hideSettingsPanel=g})();(function(){"use strict";function g(o,r){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u;if(!r){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let c=null;for(let u of n.formStructure){for(let m of u.columns){let k=m.elements.find(f=>f.internalId===o);if(k){c=k;break}}if(c)break}if(!c){console.error(`updateElementFromSettingsPanel: Element data for ID ${o} not found.`);return}let s=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!s){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let t=s.querySelector('input[data-setting="label"]');t&&(c.label=t.value);let d=s.querySelector('input[data-setting="fieldId"]');if(d){let u=d.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!u){let k=c.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");k||(k=c.type.replace(/-/g,"_")),u=`${k}_${o.split("-").pop()}`}let m=!0;e:for(let k of n.formStructure)for(let f of k.columns)if(f.elements.some(w=>w.internalId!==o&&w.fieldId===u)){m=!1;break e}m&&u.length>0?(c.fieldId=u,d.value=u,d.classList.remove("aipkit_input_error")):u.length>0&&d.classList.add("aipkit_input_error")}let a=s.querySelector('input[data-setting="required"]');a&&(c.required=a.checked);let l=s.querySelector('textarea[data-setting="helpText"]');if(l&&(c.helpText=l.value),c.type==="text-input"||c.type==="textarea"){let u=s.querySelector('input[data-setting="placeholder"]');u&&(c.placeholder=u.value)}(c.type==="select"||c.type==="radio-button"||c.type==="checkbox")&&(c.options=[],s.querySelectorAll(".aipkit_select_option_row").forEach(m=>{let k=m.querySelector('input[data-setting="option-value"]'),f=m.querySelector('input[data-setting="option-text"]');k&&f&&k.value.trim()!==""?c.options.push({value:k.value,text:f.value}):k&&f&&k.value.trim()===""&&f.value.trim()!==""&&c.options.push({value:f.value,text:f.value})}));let p=r.querySelector("#aipkit_ai_form_designer_area"),_=p?p.querySelector(`#${CSS.escape(o)}`):null;if(_&&p){let u=_.parentElement,m=p.scrollTop,k=_.classList.contains("aipkit-element-selected"),f=_.nextElementSibling;if(_.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(u,c,f):console.error("AI Forms updateElement: renderFieldInColumn function missing."),k){let w=p.querySelector(`#${CSS.escape(o)}`);w&&w.classList.add("aipkit-element-selected")}p.scrollTop=m}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r)}window.aipkitForms_updateElementFromSettingsPanel=g})();(function(){"use strict";function g(e){let i=window.aipkitAIFormsState;if(!e)return;let c=e.querySelector("#aipkit_prompt_snippets_container");if(!c)return;c.innerHTML="";let s=new Set;if(i.formStructure.forEach(t=>{t.columns.forEach(d=>{d.elements.forEach(a=>{a.fieldId&&s.add(a.fieldId)})})}),s.size>0){let t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:d=>d;s.forEach(d=>{let a=document.createElement("button");a.type="button",a.className="aipkit_prompt_snippet",a.dataset.fieldId=d,a.title=t("Click to copy","gpt3-ai-content-generator"),a.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${d}}`,c.appendChild(a)})}}function o(e){if(!e)return;let i=e.querySelector("#aipkit_form_editor_container");if(!i){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let c=i.querySelector("#aipkit_prompt_snippets_container");if(!c){console.warn("AI Forms: Prompt snippets container not found for init.");return}c.dataset.listenerAttached!=="true"&&(c.addEventListener("click",function(s){let t=s.target.closest(".aipkit_prompt_snippet");if(!t)return;let d=t.dataset.fieldId;d&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${d}}`,t)}),c.dataset.listenerAttached="true")}function r(e,i){if(!e)return;let c=e.querySelector("#aipkit_ai_form_ai_provider");c&&(c.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(i?c.dataset.aipkitProviderNoticeArmed="true":delete c.dataset.aipkitProviderNoticeArmed),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(e))}function n(e=null,i){let c=window.aipkitAIFormsState,s=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,d=window.aipkit_escapeHtml||function(m){return m};if(!i){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}c.currentFormId=e,c.droppedElementCounter=0,c.formStructure=[],c.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(i):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let a=i.querySelector("#aipkit_form_editor_container"),l=i.querySelector("#aipkit_ai_forms_list_container"),p=i.querySelector("#aipkit_ai_forms_editor_actions"),_=i.querySelector("#aipkit_create_new_ai_form_btn"),u=i.querySelector("#aipkit_ai_forms_settings_trigger");l.style.display="none",a.style.display="block",p&&(p.style.display="flex"),_&&(_.style.display="none"),u&&(u.style.display="none"),requestAnimationFrame(()=>{let m=i.querySelector("#aipkit_ai_form_title"),k=a.querySelector("#aipkit_ai_form_prompt_template"),f=a.querySelector("#aipkit_ai_form_id"),w=a.querySelector("#aipkit_ai_form_designer_area"),E=a.querySelector("#aipkit_ai_form_ai_provider"),y=a.querySelector("#aipkit_ai_form_ai_model"),I=a.querySelector("#aipkit_ai_form_temperature"),S=a.querySelector("#aipkit_ai_form_temperature_value"),h=a.querySelector("#aipkit_ai_form_max_tokens"),M=a.querySelector("#aipkit_ai_form_max_tokens_value"),b=a.querySelector("#aipkit_ai_form_top_p"),A=a.querySelector("#aipkit_ai_form_top_p_value"),x=a.querySelector("#aipkit_ai_form_frequency_penalty"),v=a.querySelector("#aipkit_ai_form_frequency_penalty_value"),C=a.querySelector("#aipkit_ai_form_presence_penalty"),P=a.querySelector("#aipkit_ai_form_presence_penalty_value"),$=i.querySelector("#aipkit_preview_ai_form_btn"),U=()=>{let J=document.createElement("div");return J.className="aipkit_form_designer_placeholder",J.id="aipkit_form_designer_placeholder",J.innerHTML=`<span class="dashicons dashicons-layout"></span>${t("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,J};if(!a||!l||!m||!k||!f||!w||!E||!y||!I||!h||!$||!S||!M||!b||!A||!x||!v||!C||!P){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:i.innerHTML.substring(0,500)});return}let B=i.querySelector("#aipkit_ai_forms_header_title_default"),D=i.querySelector("#aipkit_ai_forms_header_title_editor"),N=i.querySelector("#aipkit_ai_forms_title_display"),R=i.querySelector("#aipkit_ai_forms_title_text"),j=t("New Form","gpt3-ai-content-generator"),L=()=>{if(!R||!N||!m)return;let le=m.value.trim()||j;R.textContent=le,N.setAttribute("title",le)},K=()=>{!N||!m||(N.style.display="none",m.style.display="inline-block",m.focus(),m.select())},V=()=>{!N||!m||(m.style.display="none",N.style.display="inline-flex",L())};B&&(B.style.display="none"),D&&(D.style.display="flex"),D&&D.dataset.inlineTitleBound!=="true"&&N&&m&&(N.addEventListener("click",K),m.addEventListener("blur",V),m.addEventListener("keydown",J=>{J.key==="Enter"&&(J.preventDefault(),m.blur())}),m.addEventListener("input",L),D.dataset.inlineTitleBound="true"),m.value="",k.value="",f.value="",w.innerHTML="",w.appendChild(U()),V(),g(i);let ee={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Engine",model_label:"Model"};if(a.querySelectorAll('input[name^="labels["]').forEach(J=>{let le=J.name.match(/labels\[(.+)\]/),ue=le?le[1]:null;ue&&ee[ue]!==void 0?J.value=ee[ue]:J.value=""}),!e){if(E.value="OpenAI",I&&S){let J=window.aipkit_dashboard?.ai_params?.temperature||1;I.value=J,S.textContent=J}if(h&&M){let J=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;h.value=J,M.textContent=J}if(b&&A){let J=window.aipkit_dashboard?.ai_params?.top_p||1;b.value=J,A.textContent=J}if(x&&v){let J=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;x.value=J,v.textContent=J}if(C&&P){let J=window.aipkit_dashboard?.ai_params?.presence_penalty||0;C.value=J,P.textContent=J}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(a)),typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(E.value,a),r(a,!0)}e?($.disabled=!1,f.value=e,w.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${t("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:e,_ajax_nonce:s.nonce_manage_forms}).then(J=>{if(J.form){m.value=J.form.title||"",V(),k.value=J.form.prompt_template||"",E.value=J.form.ai_provider||"OpenAI",I&&S&&(I.value=J.form.temperature,S.textContent=J.form.temperature),h&&M&&(h.value=J.form.max_tokens,M.textContent=J.form.max_tokens),b&&A&&(b.value=J.form.top_p,A.textContent=J.form.top_p),x&&v&&(x.value=J.form.frequency_penalty,v.textContent=J.form.frequency_penalty),C&&P&&(C.value=J.form.presence_penalty,P.textContent=J.form.presence_penalty);let le=J.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(de=>{let ve=a.querySelector(`input[name="labels[${de}]"]`);ve&&(ve.value=le[de]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(E.value,J.form.ai_model);let be=a.querySelector("#aipkit_ai_form_reasoning_effort");be&&(be.value=J.form.reasoning_effort||""),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(a);let ze=a.querySelector('input[name="enable_vector_store"]'),Me=ze?ze.closest('[data-aipkit-settings-panel="context"]'):null;if(Me){let de=Me.querySelector('select[name="vector_store_provider"]'),ve=Me.querySelector('select[name="openai_vector_store_ids[]"]'),qe=Me.querySelector('select[name="pinecone_index_name"]'),Se=Me.querySelector('select[name="qdrant_collection_name"]'),Je=Me.querySelector(".aipkit_vector_embedding_select"),nt=Me.querySelector('select[name="vector_embedding_provider"]'),Vt=Me.querySelector('select[name="vector_embedding_model"]'),ai=Me.querySelector('input[name="vector_store_top_k"]'),ti=Me.querySelector("#aipkit_ai_form_vector_store_top_k_value"),Ft=Me.querySelector('input[name="vector_store_confidence_threshold"]'),ht=Me.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");if(ze.checked=J.form.enable_vector_store==="1",de&&(de.value=J.form.vector_store_provider||"openai"),qe&&(qe.value=J.form.pinecone_index_name||""),qe&&J.form.pinecone_index_name&&!Array.from(qe.options).some(Le=>Le.value===J.form.pinecone_index_name)){let Le=new Option(`${J.form.pinecone_index_name} (Manual)`,J.form.pinecone_index_name,!1,!0);qe.appendChild(Le),qe.value=J.form.pinecone_index_name}if(Se){let Le=Array.isArray(J.form.qdrant_collection_names)?J.form.qdrant_collection_names[0]:J.form.qdrant_collection_name||"";if(Le&&!Array.from(Se.options).some(Te=>Te.value===Le)){let Te=new Option(`${Le} (Manual)`,Le,!1,!0);Se.appendChild(Te)}Le&&(Se.value=Le)}if(nt&&(nt.value=J.form.vector_embedding_provider||"openai"),ai&&ti){let Le=J.form.vector_store_top_k||3;ai.value=Le,ti.textContent=Le}if(Ft&&ht){let Le=J.form.vector_store_confidence_threshold||20;Ft.value=Le,ht.textContent=Le+"%"}if(ve&&J.form.openai_vector_store_ids&&Array.isArray(J.form.openai_vector_store_ids)){let Le=new Set(Array.from(ve.options).map(Te=>Te.value));J.form.openai_vector_store_ids.forEach((Te,xt)=>{if(Te&&!Le.has(Te)){let Kt=new Option(`Manual store ${xt+1}`,Te,!1,!0);ve.appendChild(Kt),Le.add(Te)}}),Array.from(ve.options).forEach(Te=>{Te.selected=J.form.openai_vector_store_ids.includes(Te.value)})}typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(Me),Vt&&(Vt.value=J.form.vector_embedding_model||""),typeof window.aipkitForms_syncEmbeddingSelectFromInputs=="function"&&window.aipkitForms_syncEmbeddingSelectFromInputs(Me,Je),ze.dispatchEvent(new Event("change",{bubbles:!0}))}let rt=a.querySelector('input[name="openai_web_search_enabled"]'),Ue=a.querySelector('input[name="google_search_grounding_enabled"]');rt&&(rt.checked=J.form.openai_web_search_enabled==="1"),Ue&&(Ue.checked=J.form.google_search_grounding_enabled==="1");let vt=a.querySelector('select[name="openai_web_search_context_size"]'),we=a.querySelector('select[name="openai_web_search_loc_type"]'),pt=a.querySelector('input[name="openai_web_search_loc_country"]'),st=a.querySelector('input[name="openai_web_search_loc_city"]'),bt=a.querySelector('input[name="openai_web_search_loc_region"]'),wt=a.querySelector('input[name="openai_web_search_loc_timezone"]');vt&&(vt.value=J.form.openai_web_search_context_size||"medium"),we&&(we.value=J.form.openai_web_search_loc_type||"none"),pt&&(pt.value=J.form.openai_web_search_loc_country||""),st&&(st.value=J.form.openai_web_search_loc_city||""),bt&&(bt.value=J.form.openai_web_search_loc_region||""),wt&&(wt.value=J.form.openai_web_search_loc_timezone||"");let Ht=a.querySelector('select[name="google_grounding_mode"]'),se=a.querySelector('input[name="google_grounding_dynamic_threshold"]'),me=a.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(Ht&&(Ht.value=J.form.google_grounding_mode||"DEFAULT_MODE"),se){let de=J.form.google_grounding_dynamic_threshold||.3;se.value=de,me&&(me.textContent=de)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(E.value,a),rt&&rt.dispatchEvent(new Event("change",{bubbles:!0})),Ue&&Ue.dispatchEvent(new Event("change",{bubbles:!0})),J.form.structure&&Array.isArray(J.form.structure))if(c.formStructure=J.form.structure,w.innerHTML="",c.formStructure.length===0)w.appendChild(U());else{c.formStructure.forEach(ve=>{window.aipkitForms_renderLayoutRow(w,ve,null,i)});let de=0;c.formStructure.forEach(ve=>{ve.columns.forEach(qe=>{qe.elements.forEach(Se=>{let Je=Se.internalId.split("-"),nt=parseInt(Je[Je.length-1],10)||0;nt>de&&(de=nt)})})}),c.droppedElementCounter=de}else w.innerHTML="",w.appendChild(U());r(a,!0),g(i)}else throw new Error(J.message||t("Could not load form data.","gpt3-ai-content-generator"))}).catch(J=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(i,"error",J.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(i):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):($.disabled=!0,V())})}window.aipkitForms_showFormEditor=n,window.aipkitForms_updatePromptSnippets=g,window.aipkitForms_initPromptSnippets=o})();(function(){"use strict";function g(o){let r=window.aipkitAIFormsState,n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_;if(!o){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}r.currentFormId=null,r.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(o):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let e=o.querySelector("#aipkit_form_editor_container"),i=o.querySelector("#aipkit_ai_forms_list_container"),c=o.querySelector("#aipkit_ai_forms_editor_actions"),s=o.querySelector("#aipkit_create_new_ai_form_btn"),t=o.querySelector("#aipkit_ai_forms_settings_trigger"),d=o.querySelector("#aipkit_ai_forms_header_title_default"),a=o.querySelector("#aipkit_ai_forms_header_title_editor");if(e&&(e.style.display="none"),i&&(i.style.display="block"),c&&(c.style.display="none"),s&&(s.style.display=""),t&&(t.style.display=""),d&&(d.style.display=""),a&&(a.style.display="none"),typeof window.aipkitForms_closePreviewSheet=="function"&&window.aipkitForms_closePreviewSheet(o),e){let _=e.querySelector("#aipkit_ai_form_ai_provider");_&&delete _.dataset.aipkitProviderNoticeArmed}let l=document.getElementById("aipkit_provider_notice_ai_forms");if(l&&l.classList.add("aipkit_provider_notice--hidden"),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(o),e){let _=e.querySelector("#aipkit_ai_form_preview_container");_&&(_.style.display="none",_.innerHTML="");let u=o.querySelector("#aipkit_preview_ai_form_btn");if(u&&u.classList.contains("aipkit-preview-active")){u.classList.remove("aipkit-preview-active");let m=u.querySelector(".aipkit_btn-text");m&&(m.textContent=n("Preview","gpt3-ai-content-generator"))}}let p=o.querySelector("#aipkit_ai_forms_messages");p&&(p.innerHTML="")}window.aipkitForms_hideFormEditor=g})();(function(){"use strict";function g(o,r){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:st=>st,c={value:null},s=()=>r.querySelector("#aipkit_ai_forms_status"),t=(st,bt)=>{let wt=s();if(!wt)return;let Ht=wt.classList.contains("aipkit_training_status");if(wt.textContent=st||"",Ht){wt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),st&&wt.classList.add("is-visible"),bt&&wt.classList.add(`is-${bt}`);return}wt.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),bt==="success"?wt.classList.add("aipkit_form-help-success"):bt==="error"&&wt.classList.add("aipkit_form-help-error")},d=(st=2500)=>{c.value&&window.clearTimeout(c.value),c.value=window.setTimeout(()=>{t("","")},st)};if(!r){console.error("AI Forms saveForm: formsContainerElement not provided.");return}let a=r.querySelector("#aipkit_form_editor_container");if(!a){console.error("AI Forms saveForm: editorContainer not found in provided formsContainerElement.");return}let l=r.querySelector("#aipkit_ai_form_title"),p=a.querySelector("#aipkit_ai_form_prompt_template"),_=a.querySelector("#aipkit_ai_form_id"),u=a.querySelector("#aipkit_ai_form_ai_provider"),m=a.querySelector("#aipkit_ai_form_ai_model"),k=a.querySelector("#aipkit_ai_form_temperature"),f=a.querySelector("#aipkit_ai_form_max_tokens"),w=a.querySelector("#aipkit_ai_form_top_p"),E=a.querySelector("#aipkit_ai_form_frequency_penalty"),y=a.querySelector("#aipkit_ai_form_presence_penalty"),I=a.querySelector("#aipkit_ai_form_reasoning_effort"),S=a.querySelector('input[name="enable_vector_store"]'),h=a.querySelector('select[name="vector_store_provider"]'),M=a.querySelector('select[name="openai_vector_store_ids[]"]'),b=a.querySelector('select[name="pinecone_index_name"]'),A=a.querySelector('select[name="qdrant_collection_name"]'),x=a.querySelector('select[name="vector_embedding_provider"]'),v=a.querySelector('select[name="vector_embedding_model"]'),C=a.querySelector('input[name="vector_store_top_k"]'),P=a.querySelector('input[name="vector_store_confidence_threshold"]'),$=a.querySelector('input[name="openai_web_search_enabled"]'),U=a.querySelector('input[name="google_search_grounding_enabled"]'),B=a.querySelector('select[name="openai_web_search_context_size"]'),D=a.querySelector('select[name="openai_web_search_loc_type"]'),N=a.querySelector('input[name="openai_web_search_loc_country"]'),R=a.querySelector('input[name="openai_web_search_loc_city"]'),j=a.querySelector('input[name="openai_web_search_loc_region"]'),L=a.querySelector('input[name="openai_web_search_loc_timezone"]'),K=a.querySelector('select[name="google_grounding_mode"]'),V=a.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!l||!p||!_||!u||!m||!k||!f||!w||!E||!y){console.error("AI Forms saveForm: One or more critical form editor inputs not found in editorContainer.");return}let ee=l.value.trim(),J=p.value.trim(),le=_.value;if(ee||(ee=i("New Form","gpt3-ai-content-generator"),l.value=ee,l.dispatchEvent(new Event("input",{bubbles:!0}))),!J){alert(i(e.text.promptTemplateRequired||"Prompt template is required.","gpt3-ai-content-generator"));return}let ue=new Set,be=!0;e:for(let st of n.formStructure)for(let bt of st.columns)for(let wt of bt.elements){if(!wt.fieldId||!/^[a-zA-Z0-9_]+$/.test(wt.fieldId)){alert(i(`Invalid Field Variable Name: "${wt.fieldId||""}" for element "${wt.label}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(wt.internalId,r);let Ht=a.querySelector(`#setting-field-id-${wt.internalId}`);Ht&&Ht.focus(),be=!1;break e}if(ue.has(wt.fieldId)){alert(i(`Duplicate Field Variable Name: "${wt.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(wt.internalId,r);let Ht=a.querySelector(`#setting-field-id-${wt.internalId}`);Ht&&Ht.focus(),be=!1;break e}ue.add(wt.fieldId)}if(!be)return;let ze=M?Array.from(M.selectedOptions).map(st=>st.value):[],Me=a.querySelectorAll('input[name^="labels["]'),rt={};Me.forEach(st=>{let bt=st.name.match(/\[(.*?)\]/);if(bt&&bt[1]){let wt=bt[1];rt[wt]=st.value}});let Ue=JSON.stringify(rt),vt={_ajax_nonce:e.nonce_manage_forms,form_id:le||null,title:ee,prompt_template:J,form_structure:JSON.stringify(n.formStructure),ai_provider:u.value,ai_model:m.value,temperature:k.value,max_tokens:f.value,top_p:w.value,frequency_penalty:E.value,presence_penalty:y.value,reasoning_effort:I?.value,enable_vector_store:S?.checked?"1":"0",vector_store_provider:h?.value,openai_vector_store_ids:ze,pinecone_index_name:b?.value||"",qdrant_collection_name:A?.value||"",vector_embedding_provider:x?.value,vector_embedding_model:v?.value||"",vector_store_top_k:C?.value||3,vector_store_confidence_threshold:P?.value||20,openai_web_search_enabled:$?.checked?"1":"0",google_search_grounding_enabled:U?.checked?"1":"0",openai_web_search_context_size:B?.value||"medium",openai_web_search_loc_type:D?.value||"none",openai_web_search_loc_country:N?.value||"",openai_web_search_loc_city:R?.value||"",openai_web_search_loc_region:j?.value||"",openai_web_search_loc_timezone:L?.value||"",google_grounding_mode:K?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:V?.value||"0.30",labels:Ue},we=o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent:o.textContent,pt=o.querySelector(".aipkit_spinner");o.disabled=!0,pt&&(pt.style.display="inline-block"),o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent=i(e.text.savingForm||"Saving...","gpt3-ai-content-generator"):o.firstChild.textContent=i(e.text.savingForm||"Saving...","gpt3-ai-content-generator")+" ",t(i("Saving...","gpt3-ai-content-generator"),"loading"),window.aipkit_apiRequest("aipkit_save_ai_form",vt).then(st=>{if(!le&&st.form_id){_&&(_.value=st.form_id),n.currentFormId=st.form_id;let bt=r.querySelector("#aipkit_preview_ai_form_btn");bt&&(bt.disabled=!1)}t(st.message||i(e.text.formSaved||"Form saved!","gpt3-ai-content-generator"),"success"),d(),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(st=>{t(st.message||i(e.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator"),"error"),d(4e3)}).finally(()=>{o.disabled=!1,pt&&(pt.style.display="none"),o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent=we:o.firstChild.textContent=we})}window.aipkitForms_saveForm=g})();(function(){"use strict";function g(o,r,n){let e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;if(!n){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let c={_ajax_nonce:e.nonce_manage_forms,form_id:o},s=r.textContent;r.disabled=!0,r.textContent=i(e.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",c).then(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",t.message||i(e.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",t.message||i(e.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let d=n.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${o}"]`);d&&(d.disabled=!1,d.textContent=s)})}window.aipkitForms_deleteForm=g})();(function(){"use strict";function g(o,r){let n=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;if(!r){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let i={_ajax_nonce:n.nonce_manage_forms},c=o.querySelector(".aipkit_btn-text")?.textContent||e("Delete All Forms","gpt3-ai-content-generator"),s=o.querySelector(".aipkit_spinner");o.disabled=!0,o.querySelector(".aipkit_btn-text")&&(o.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${e(n.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",i).then(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"success",t.message||e(n.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"error",t.message||e(n.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{o.querySelector(".aipkit_btn-text")&&(o.querySelector(".aipkit_btn-text").textContent=c),s&&(s.style.display="none"),o.disabled=!1})}window.aipkitForms_deleteAllForms=g})();(function(){"use strict";function g(o,r,n){let e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;if(!n){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let c={_ajax_nonce:e.nonce_manage_forms,form_id:o},s=r.textContent;r.disabled=!0,r.textContent=i(e.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",c).then(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",t.message||i("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(t=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",t.message||i(e.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let t=n.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${o}"]`);t&&(t.disabled=!1,t.textContent=s)})}window.aipkitForms_duplicateForm=g})();(function(){"use strict";async function g(o){let r=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:i=>i,e=o.textContent;o.disabled=!0,o.textContent=n("Exporting...","gpt3-ai-content-generator");try{let i=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:r.nonce_manage_forms});if(i.forms&&Array.isArray(i.forms)&&i.forms.length>0){let c=i.forms.map(_=>(delete _.id,delete _.status,_)),t=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,d=JSON.stringify(c,null,2),a=new Blob([d],{type:"application/json"}),l=URL.createObjectURL(a),p=document.createElement("a");p.href=l,p.download=t,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(l)}else throw new Error(n("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(i){alert(n("Error exporting forms: ","gpt3-ai-content-generator")+i.message)}finally{o.disabled=!1,o.textContent=e}}window.aipkitForms_exportAllForms=g})();(function(){"use strict";async function g(o,r){let n=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c,i=r.textContent;r.disabled=!0,r.textContent=e("Exporting...","gpt3-ai-content-generator");try{let c=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:o,_ajax_nonce:n.nonce_manage_forms});if(c.form){let s=c.form,t=s.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),d=`aipkit-form-${o}-${t}.json`;delete s.id,delete s.status;let a=JSON.stringify(s,null,2),l=new Blob([a],{type:"application/json"}),p=URL.createObjectURL(l),_=document.createElement("a");_.href=p,_.download=d,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(p)}else throw new Error(e("Form data not found in response.","gpt3-ai-content-generator"))}catch(c){alert(e("Error exporting form: ","gpt3-ai-content-generator")+c.message)}finally{r.disabled=!1,r.textContent=i}}window.aipkitForms_exportForm=g})();(function(){"use strict";let g=document.getElementById("aipkit_ai_forms_import_messages"),o;function r(i,c){if(!g)return;let s=window.aipkit_escapeHtml||(t=>t);g.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${i}">${s(c)}</div>`,o&&clearTimeout(o),o=setTimeout(()=>{g.innerHTML=""},8e3)}function n(){g&&(g.innerHTML=""),o&&clearTimeout(o)}async function e(i){let c=window.aipkit_ai_forms_config||{text:{}},s=window.wp?.i18n?.__||(l=>l),t=i.files;if(!t.length)return;let d=t[0];n(),r("info",s("Reading file...","gpt3-ai-content-generator"));let a=new FileReader;a.onload=async function(l){try{let p=l.target.result,_=JSON.parse(p);if(typeof _=="object"&&_!==null&&!Array.isArray(_)&&(_=[_]),!Array.isArray(_))throw new Error(s("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(_.length===0){r("warning",s("File contains no forms to import.","gpt3-ai-content-generator"));return}r("info",s("Importing...","gpt3-ai-content-generator"));let u=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:c.nonce_manage_forms,forms_json:JSON.stringify(_)});r(u.failed_count>0?"warning":"success",u.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(p){r("error",s("Error processing import file: ","gpt3-ai-content-generator")+p.message)}},a.onerror=function(){r("error",s("Error reading the selected file.","gpt3-ai-content-generator"))},a.readAsText(d)}window.aipkitForms_importForms=e})();(function(){"use strict";let g="aipkit_ai_forms_status",o=!1,r=null,n=null,e=null;function i(){return document.getElementById(g)}function c(w,E){let y=i();if(!y)return;let I=y.classList.contains("aipkit_training_status");if(y.textContent=w||"",I){y.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),w&&y.classList.add("is-visible"),E&&y.classList.add(`is-${E}`);return}y.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),E==="success"?y.classList.add("aipkit_form-help-success"):E==="error"&&y.classList.add("aipkit_form-help-error")}function s(w=2500){e&&window.clearTimeout(e),e=window.setTimeout(()=>{c("","")},w)}function t(){return document.getElementById("aipkit_ai_forms_settings_form")}function d(){let w=t();if(!w)return console.error("AI Forms Save Settings: Settings form not found."),null;let E=new FormData(w),y={};return E.forEach((I,S)=>{y[S]=I}),y}function a(w){if(!w)return"";let E={};return Object.keys(w).sort().forEach(y=>{E[y]=w[y]}),JSON.stringify(E)}function l(w){n=a(w)}function p(w){return a(w)!==n}async function _(w,E){let y=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:h=>h;if(typeof window.aipkit_apiRequest!="function"){console.error("AI Forms Save Settings: aipkit_apiRequest not found.");return}c(y("Saving...","gpt3-ai-content-generator"),"loading");let I="",S=null;E&&(I=E.querySelector(".aipkit_btn-text")?.textContent||y("Save AI Forms Settings","gpt3-ai-content-generator"),S=E.querySelector(".aipkit_spinner"),E.disabled=!0,S&&(S.style.display="inline-block"),E.querySelector(".aipkit_btn-text")&&(E.querySelector(".aipkit_btn-text").textContent=y("Saving...","gpt3-ai-content-generator")));try{let h=await window.aipkit_apiRequest("aipkit_save_ai_forms_settings",w);return c(h.message||y("Settings saved!","gpt3-ai-content-generator"),"success"),s(),l(w),h}catch(h){throw c(h.message||y("Failed to save settings.","gpt3-ai-content-generator"),"error"),s(4e3),console.error("AI Forms Save Settings Error:",h),h}finally{E&&(E.disabled=!1,S&&(S.style.display="none"),E.querySelector(".aipkit_btn-text")&&(E.querySelector(".aipkit_btn-text").textContent=I))}}function u(w,E){if(w){if(o){r=w;return}o=!0,_(w,E).catch(()=>{}).finally(()=>{if(o=!1,r){let y=r;r=null,p(y)&&u(y,null)}})}}function m(w){let E=d();u(E,w)}function k(){let w=d();!w||!p(w)||u(w,null)}function f(){let w=d();w&&l(w)}window.aipkitForms_saveAiFormsSettings=m,window.aipkitForms_handleSettingsAutosave=k,window.aipkitForms_updateSettingsAutosaveBaseline=f})();(function(){"use strict";function g(o,r,n){let e=window.aipkit_escapeHtml||function(c){return c};if(!o){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let i=o.querySelector("#aipkit_ai_forms_messages");i?(i.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${r}">${e(n)}</div>`,setTimeout(()=>{i.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=g})();(function(){"use strict";function g(r){if(!r){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let n=r.querySelector(".aipkit_token_limit_mode_select"),e=r.querySelector(".aipkit_token_general_user_limit_field"),i=r.querySelector(".aipkit_token_role_limits_container");if(!n||!e||!i){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let c=n.value;e.hidden=c!=="general",i.hidden=c!=="role_based"}function o(r){if(!r){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let n="data-token-listener-attached";r.getAttribute(n)!=="true"&&(r.addEventListener("change",function(e){e.target.closest(".aipkit_token_limit_mode_select")&&g(r)}),g(r),r.setAttribute(n,"true"))}window.aipkit_initAIFormsTokenManagementUI=o})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_ai_forms_container");return o||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=g})();(function(){"use strict";function g(o){let r=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e;o.dataset.clickListenerAttached!=="true"&&(o.addEventListener("click",function(e){let i=e.target,c=t=>i.closest(t),s=o.querySelector("#aipkit_form_editor_container");if(i.matches("#aipkit_create_new_ai_form_btn")||c("#aipkit_create_new_ai_form_btn"))e.preventDefault(),typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,o);else if(c(".aipkit_actions_menu_toggle")){e.preventDefault(),e.stopPropagation();let t=i.closest(".aipkit_actions_menu");if(!t)return;let d=t.querySelector(".aipkit_actions_dropdown_menu");if(!d)return;let a=d.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(l=>{l!==d&&(l.style.display="none")}),d.style.display=a?"none":"block",!a){let l=p=>{t.contains(p.target)||(d.style.display="none")};document.addEventListener("click",l,{once:!0,capture:!0})}}else if(c("#aipkit_import_ai_forms_btn")){e.preventDefault();let t=o.querySelector("#aipkit_ai_forms_import_file_input");t&&t.click()}else if(i.matches(".aipkit_edit_ai_form_btn")||c(".aipkit_edit_ai_form_btn")){e.preventDefault();let d=c(".aipkit_edit_ai_form_btn").dataset.formId;typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(d,o)}else if(c(".aipkit_preview_ai_form_btn")){e.preventDefault();let t=c(".aipkit_preview_ai_form_btn"),d=t.dataset.formId,a=t.dataset.formTitle||"";typeof window.aipkitForms_openPreviewSheet=="function"&&window.aipkitForms_openPreviewSheet(d,a,o)}else if(i.matches(".aipkit_duplicate_ai_form_btn")||c(".aipkit_duplicate_ai_form_btn")){e.preventDefault();let t=c(".aipkit_duplicate_ai_form_btn"),d=t.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(d,t,o)}else if(i.matches("#aipkit_export_all_ai_forms_btn")||c("#aipkit_export_all_ai_forms_btn")){e.preventDefault();let t=c("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(t)}else if(i.matches(".aipkit_export_ai_form_btn")||c(".aipkit_export_ai_form_btn")){e.preventDefault();let t=c(".aipkit_export_ai_form_btn"),d=t.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(d,t)}else if(i.matches(".aipkit_delete_ai_form_btn")||c(".aipkit_delete_ai_form_btn")){e.preventDefault();let t=c(".aipkit_delete_ai_form_btn"),d=t.dataset.formId,a=t.dataset.formTitle||`Form ID ${d}`,p=`${n(r.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${a}`,_=()=>{typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(d,t,o)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(p,{title:n("Confirm","gpt3-ai-content-generator"),confirmText:n("Delete","gpt3-ai-content-generator"),cancelText:n("Cancel","gpt3-ai-content-generator"),onConfirm:_});return}confirm(p)&&_()}else if(i.matches("#aipkit_delete_all_ai_forms_btn")||c("#aipkit_delete_all_ai_forms_btn")){e.preventDefault();let t=c("#aipkit_delete_all_ai_forms_btn"),d=n(r.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"),a=()=>{typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(t,o)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(d,{title:n("Confirm","gpt3-ai-content-generator"),confirmText:n("Delete","gpt3-ai-content-generator"),cancelText:n("Cancel","gpt3-ai-content-generator"),onConfirm:a});return}confirm(d)&&a()}else if(i.matches(".aipkit_form_shortcode_input"))e.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(i.value,i);else if(c(".aipkit_aiform_settings_toggle")){e.preventDefault();let t=c(".aipkit_aiform_settings_toggle"),d=t.dataset.formId,a=o.querySelector(`#aif-configurator-${d}`);if(!a)return;let l=a.closest("tr"),p=()=>{let m=t.getBoundingClientRect(),k=a.getBoundingClientRect(),f=k.width||400,w=k.height||0,E=window.innerWidth,y=window.innerHeight,I=12,S=m.left;S+f>E-I&&(S=m.right-f),S=Math.max(I,Math.min(S,E-f-I));let h=m.bottom+8;h+w>y-I&&(h=m.top-w-8),h=Math.max(I,Math.min(h,y-w-I)),a.style.left=`${Math.round(S)}px`,a.style.top=`${Math.round(h)}px`};o.querySelectorAll(".aipkit_shortcode_configurator").forEach(m=>{m!==a&&(m.style.display="none");let k=m.closest("tr");k&&k.classList.remove("aipkit_shortcode_row_open")});let u=a.style.display==="flex";if(a.style.display=u?"none":"flex",l&&l.classList.toggle("aipkit_shortcode_row_open",!u),!u){p();let m=k=>{!a.contains(k.target)&&!t.contains(k.target)&&(a.style.display="none",l&&l.classList.remove("aipkit_shortcode_row_open"),document.removeEventListener("click",m,!0))};setTimeout(()=>{document.addEventListener("click",m,{capture:!0,once:!0})},0)}}else if(c(".aipkit_aiform_shortcode_close")){e.preventDefault();let d=c(".aipkit_aiform_shortcode_close").closest(".aipkit_shortcode_configurator");if(d){d.style.display="none";let a=d.closest("tr");a&&a.classList.remove("aipkit_shortcode_row_open")}}else if(i.matches("#aipkit_validate_prompt_btn")||c("#aipkit_validate_prompt_btn"))e.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(i.matches("#aipkit_save_ai_form_btn")||c("#aipkit_save_ai_form_btn")){e.preventDefault();let t=c("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(t,o)}else if(i.matches("#aipkit_cancel_edit_ai_form_btn")||c("#aipkit_cancel_edit_ai_form_btn"))e.preventDefault(),typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(o);else if(i.matches("#aipkit_preview_ai_form_btn")||c("#aipkit_preview_ai_form_btn")){e.preventDefault();let t=s.querySelector("#aipkit_ai_form_id").value;if(!t){alert(n("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}let d=o.querySelector("#aipkit_ai_form_title"),a=d?d.value:"";typeof window.aipkitForms_openPreviewSheet=="function"?window.aipkitForms_openPreviewSheet(t,a,o):console.error("AI Forms Preview: Preview sheet helper not available.")}else if(c(".aipkit_dropped_element_settings_btn")){e.preventDefault();let t=c(".aipkit_dropped_element");t&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(t.id,o)}else if(c(".aipkit_dropped_element_delete_btn")){e.preventDefault();let t=c(".aipkit_dropped_element");t&&confirm(n(r.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(t.id,o)}else if(c(".aipkit_layout_row_delete_btn")){if(e.preventDefault(),confirm(n("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let t=c(".aipkit_layout_row");t&&(Array.from(t.querySelectorAll(".aipkit_dropped_element")).map(a=>a.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(o),t.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(o))}}else if(c("#aipkit_settings_panel_close_btn"))e.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(o);else if(c(".aipkit_remove_option_btn")){e.preventDefault();let t=c(".aipkit_select_option_row");t&&(t.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,o))}else c("#aipkit_add_select_option_btn")&&(e.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(o))}),o.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=g})();(function(){"use strict";let g="aipkit_ai_forms_shortcode_config_v1_";function o(c){if(!c||!window.localStorage)return null;try{let s=window.localStorage.getItem(`${g}${c}`);if(!s)return null;let t=JSON.parse(s);return t&&typeof t=="object"?t:null}catch{return null}}function r(c,s){if(!(!c||!window.localStorage))try{window.localStorage.setItem(`${g}${c}`,JSON.stringify(s))}catch{}}function n(c,s){if(!c)return;let t=s.querySelector(`#aif-configurator-${c}`),d=s.querySelector(`#aif-shortcode-input-${c}`);if(!t||!d)return;let a=t.querySelectorAll(".aipkit-aiform-config-input"),l=[],p={};a.forEach(m=>{let k=m.dataset.attrName;k&&(m.type==="checkbox"?(p[k]=!!m.checked,m.checked&&l.push(`${k}="true"`)):m.type==="select-one"&&(p[k]=m.value,m.value&&m.value!=="light"&&l.push(`${k}="${m.value}"`)))});let _=`[aipkit_ai_form id=${c}`;l.length>0&&(_+=" "+l.join(" ")),_+="]",d.value=_,s.querySelectorAll(`[data-aipkit-shortcode-display="${c}"]`).forEach(m=>{m&&"value"in m&&(m.value=_)}),r(c,p)}function e(c,s){if(!c||!s)return;let t=o(c);if(!t)return;let d=s.querySelector(`#aif-configurator-${c}`);if(!d)return;d.querySelectorAll(".aipkit-aiform-config-input").forEach(l=>{let p=l.dataset.attrName;p&&(l.type==="checkbox"?Object.prototype.hasOwnProperty.call(t,p)&&(l.checked=!!t[p]):l.type==="select-one"&&typeof t[p]=="string"&&(l.value=t[p]))}),n(c,s)}function i(c){c.dataset.changeListenerAttached!=="true"&&(c.addEventListener("change",function(s){let t=s.target;if(t.matches(".aipkit-aiform-config-input")){let d=t.dataset.formId;n(d,c)}else t.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(t),t.value="")}),c.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=i,window.aipkitForms_applyStoredShortcodeConfig=e})();(function(){"use strict";function g(o){let r=window.aipkitAIFormsState,n=o.querySelector("#aipkit_ai_form_element_settings_panel");if(!n){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(n.dataset.inputListenerAttached==="true")return;let e=()=>{r.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(r.selectedDesignerElementId,o)};n.addEventListener("input",i=>{i.target.matches(".aipkit-setting-field")&&e()}),n.addEventListener("change",i=>{i.target.matches('.aipkit-setting-field[type="checkbox"]')&&e()}),n.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=g})();(function(){"use strict";function g(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let n=o.querySelector("#aipkit_ai_form_elements_palette"),e=o.querySelector("#aipkit_ai_form_designer_area");if(!n||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(n.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;n.querySelectorAll(".aipkit_form_element_item").forEach(c=>{c.dataset.dragStartListenerAttached!=="true"&&(c.addEventListener("dragstart",s=>{s.target.classList.add("aipkit-dragging"),r.draggedElement=null,s.target.dataset.layoutType?(r.draggedLayoutType=s.target.dataset.layoutType,r.draggedElementType=null,s.dataTransfer.setData("text/plain",r.draggedLayoutType),s.dataTransfer.effectAllowed="copy"):(r.draggedElementType=s.target.dataset.elementType,r.draggedLayoutType=null,s.dataTransfer.setData("text/plain",r.draggedElementType),s.dataTransfer.effectAllowed="copy")}),c.addEventListener("dragend",s=>{s.target.classList.remove("aipkit-dragging"),r.draggedElementType=null,r.draggedLayoutType=null}),c.dataset.dragStartListenerAttached="true")}),n.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",c=>{let s=c.target.closest(".aipkit_layout_row"),t=c.target.closest(".aipkit_dropped_element");if(s&&c.target.classList.contains("aipkit_layout_row_drag_handle"))r.draggedElement=s,c.dataTransfer.setData("text/row-id",s.id),c.dataTransfer.effectAllowed="move";else if(t&&c.target.classList.contains("aipkit_dropped_element_drag_handle"))r.draggedElement=t,c.dataTransfer.setData("text/element-id",t.id),c.dataTransfer.effectAllowed="move";else return;r.draggedElementType=null,r.draggedLayoutType=null,setTimeout(()=>{r.draggedElement&&r.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),e.addEventListener("dragend",c=>{r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null)}),e.addEventListener("dragover",c=>{c.preventDefault(),e.classList.add("aipkit-drag-over"),r.draggedElement?c.dataTransfer.dropEffect="move":c.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",c=>{e.contains(c.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",c=>{c.preventDefault(),c.stopPropagation(),e.classList.remove("aipkit-drag-over");let s=e.querySelector("#aipkit_form_designer_placeholder");if(r.draggedLayoutType){s&&(s.style.display="none");let t=window.aipkitForms_createNewLayoutData(r.draggedLayoutType);r.formStructure.push(t),window.aipkitForms_renderLayoutRow(e,t,null,o),r.draggedLayoutType=null}else if(r.draggedElement&&r.draggedElement.classList.contains("aipkit_layout_row")){let t=c.target.closest(".aipkit_layout_row");if(t&&t!==r.draggedElement){let d=t.getBoundingClientRect(),l=c.clientY>d.top+d.height/2?t.nextSibling:t;e.insertBefore(r.draggedElement,l)}window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){s&&(s.style.display="none");let t=window.aipkitForms_createNewLayoutData("1-col"),d=window.aipkitForms_createNewFormElementData(r.draggedElementType);t.columns[0].elements.push(d),r.formStructure.push(t),window.aipkitForms_renderLayoutRow(e,t,null,o),r.draggedElementType=null}r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(o)}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=g})();(function(){"use strict";function g(o){let r=o.querySelector("#aipkit_ai_forms_settings_form");r&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(r):console.error("AI Forms Init: Could not initialize token management UI for settings popover.")}window.aipkitForms_initializeTokenUI=g})();(function(){"use strict";function g(o){let r=(o||document).querySelector("#aipkit_ai_forms_settings_form");if(!r)return;let n="data-aipkit-aiforms-autosave-attached";if(r.getAttribute(n)==="true")return;let e=()=>{typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};r.addEventListener("change",i=>{let c=i.target;if(!c||!c.matches(".aipkit_autosave_trigger"))return;(c.tagName.toLowerCase()==="select"||c.type==="checkbox"||c.type==="range")&&e()}),r.addEventListener("blur",i=>{let c=i.target;if(!c||!c.matches(".aipkit_autosave_trigger"))return;let s=c.tagName.toLowerCase();(s==="input"||s==="textarea")&&c.type!=="range"&&c.type!=="checkbox"&&e()},!0),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),r.setAttribute(n,"true")}window.aipkitForms_initSettingsAutosave=g})();(function(){"use strict";function g(o){if(!o)return;let r="data-accordion-listener-attached";o.getAttribute(r)!=="true"&&(o.addEventListener("click",function(n){let e=n.target.closest(".aipkit_accordion-header");if(!e||!e.closest(".aipkit_ai_forms_container"))return;n.preventDefault();let i=e.closest(".aipkit_accordion-group"),c=e.dataset.aipkitContextAccordion==="1";if(i&&!e.classList.contains("aipkit_active")){let t=i.querySelector(".aipkit_accordion-header.aipkit_active");if(t){t.classList.remove("aipkit_active");let d=t.nextElementSibling;d&&d.classList.remove("aipkit_active")}}let s=e.nextElementSibling;s&&(e.classList.toggle("aipkit_active"),s.classList.toggle("aipkit_active"),c&&s.classList.contains("aipkit_active")&&typeof window.aipkitForms_refreshOpenaiStores=="function"&&window.aipkitForms_refreshOpenaiStores(s))}),o.setAttribute(r,"true"))}window.aipkitForms_initializeAccordions=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(t){return t};function o(t,d=""){let a=document.getElementById("aipkit_ai_form_ai_model"),l=window.aipkit_dashboard?.models||{};if(!a||!l)return;let p=t.toLowerCase(),_=l[p];(typeof _>"u"||_===null)&&(_=p==="openai"?{}:[]),a.innerHTML="",a.disabled=!1;let u=window.aipkit_dashboard?.recommendedModels?.[p]||[],m=Array.isArray(u)?u:[],k=new Set(m.map(w=>w?.id).filter(Boolean));if(!_||Array.isArray(_)&&_.length===0||!Array.isArray(_)&&Object.keys(_).length===0){let w=new Option("No models found. Sync in main settings.","");a.appendChild(w),a.disabled=!0;return}let f=!1;if(Array.isArray(_)){if(m.length>0){let E=document.createElement("optgroup");E.label=g("Recommended","gpt3-ai-content-generator"),m.forEach(y=>{if(y&&y.id){let I=new Option(y.name||y.id,y.id);y.id===d&&(I.selected=!0,f=!0),E.appendChild(I)}}),E.children.length>0&&a.appendChild(E)}let w=m.length>0?document.createElement("optgroup"):null;w&&(w.label=g("All models","gpt3-ai-content-generator")),_.forEach(E=>{if(E&&E.id&&k.has(E.id))return;let y=new Option(E.name,E.id);E.id===d&&(y.selected=!0,f=!0),w?w.appendChild(y):a.appendChild(y)}),w&&w.children.length>0&&a.appendChild(w)}else{if(m.length>0){let w=document.createElement("optgroup");w.label=g("Recommended","gpt3-ai-content-generator"),m.forEach(E=>{if(E&&E.id){let y=new Option(E.name||E.id,E.id);E.id===d&&(y.selected=!0,f=!0),w.appendChild(y)}}),w.children.length>0&&a.appendChild(w)}Object.keys(_).forEach(w=>{let E=document.createElement("optgroup");E.label=w,_[w].forEach(y=>{if(y&&y.id&&k.has(y.id))return;let I=new Option(y.name,y.id);y.id===d&&(I.selected=!0,f=!0),E.appendChild(I)}),E.children.length>0&&a.appendChild(E)})}if(!f&&d){let w=new Option(`${d} (Manual/Not Synced)`,d,!1,!0);a.insertBefore(w,a.firstChild),w.selected=!0}a.selectedIndex===-1&&a.options.length>0&&(a.options[0].selected=!0),a.options.length||(a.disabled=!0)}function r(t,d){let a=d||document,l=a.querySelector('input[name="openai_web_search_enabled"]'),p=a.querySelector('input[name="google_search_grounding_enabled"]'),_=a.querySelector(".aipkit_ai_form_web_search_row--openai"),u=a.querySelector(".aipkit_ai_form_web_search_row--google"),m=a.querySelector(".aipkit_ai_form_openai_web_search_settings"),k=a.querySelector(".aipkit_ai_form_google_search_grounding_settings"),f=a.querySelector(".aipkit_ai_form_openai_web_search_location_details"),w=a.querySelector(".aipkit_ai_form_web_search_empty_state"),E=t==="OpenAI";_&&(_.style.display=E?"block":"none"),!E&&l&&(l.checked=!1);let y=E&&l&&l.checked;m&&(m.style.display=y?"block":"none"),!y&&f?f.style.display="none":y&&typeof window.aipkitForms_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkitForms_toggleOpenAIWebSearchLocationDetails(a);let I=t==="Google";u&&(u.style.display=I?"block":"none"),!I&&p&&(p.checked=!1);let S=I&&p&&p.checked;k&&(k.style.display=S?"block":"none"),S&&typeof window.aipkitForms_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkitForms_toggleGoogleGroundingDynamicThreshold(a),w&&(w.style.display=!E&&!I?"block":"none")}function n(t){let d=t.querySelector("#aipkit_ai_form_ai_provider"),a=t.querySelector("#aipkit_ai_form_ai_model"),l=t.querySelector(".aipkit_ai_form_reasoning_effort_field"),p=t.querySelector("#aipkit_ai_form_reasoning_effort");if(!d||!a||!l||!p){l&&(l.style.display="none");return}let _=d.value,m=(a.value||"").toLowerCase(),k=m.startsWith("o1")||m.startsWith("o3")||m.startsWith("o4"),f=m.includes("gpt-5");if(!(_==="OpenAI"&&(k||f))){l.style.display="none";return}l.style.display="block";let w=e(m),E=new Set(w.allowed),y=p.value||"";y==="minimal"&&(y="low"),Array.from(p.options).forEach(I=>{let S=E.has(I.value);I.hidden=!S,I.disabled=!S}),E.has(y)||(y=w.defaultValue),E.has(y)||(y=w.allowed[0]||""),y&&(p.value=y)}function e(t){return c(t)?{allowed:["high"],defaultValue:"high"}:t.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(t)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(t){let d=t.match(/gpt-5\.(\d+)/);if(d)return Number.parseInt(d[1],10)>=2;let a=t.match(/gpt-(\d+)/);return a?Number.parseInt(a[1],10)>=6:!1}function c(t){return/gpt-5(\.\d+)?-pro/.test(t)}function s(t){let d=t.querySelector("#aipkit_ai_form_ai_provider"),a=t.querySelector("#aipkit_ai_form_ai_model");!d||!a||(d.dataset.modelListenerAttached!=="true"&&(d.addEventListener("change",function(){o(this.value),r(this.value,t),n(t)}),d.dataset.modelListenerAttached="true"),a.dataset.reasoningListenerAttached!=="true"&&(a.addEventListener("change",function(){n(t)}),a.dataset.reasoningListenerAttached="true"),o(d.value),r(d.value,t),n(t))}window.aipkitForms_initAiConfig=s,window.aipkitForms_populateAiModels=o,window.aipkitForms_updateWebSearchVisibility=r,window.aipkitForms_toggleReasoningEffort=n})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(B){return B},o={loaded:!1,loading:!1},r={saving:!1,queued:null,last:{pinecone_api_key:"",qdrant_url:"",qdrant_api_key:""}},n=()=>{let B=window.wp&&window.wp.i18n?window.wp.i18n:null;return{__:B&&typeof B.__=="function"?B.__:N=>N}},e=()=>{let B=window.aipkit_ai_forms_config||{},D=B.vectorStores?B.vectorStores.openai:[];return Array.isArray(D)?D:[]},i=B=>{window.aipkit_ai_forms_config||(window.aipkit_ai_forms_config={}),window.aipkit_ai_forms_config.vectorStores||(window.aipkit_ai_forms_config.vectorStores={}),window.aipkit_ai_forms_config.vectorStores.openai=B},c=B=>B?B.querySelector('select[name="openai_vector_store_ids[]"]'):null,s=B=>B?Array.from(B.options).some(D=>D.value&&!D.disabled):!1,t=(B,D)=>{let N=B.id||B.vector_store_id||"",j=B.name||B.vector_store_name||""||`Untitled store ${D}`,L=B.file_counts?B.file_counts.total:null,K=" (Files: N/A)";return typeof L=="number"&&(K=` (${L} ${L===1?"File":"Files"})`),{id:N,label:`${j}${K}`}},d=(B,D,N={})=>{if(!B)return;let{__:R}=n(),L=N.preserveSelection===!0?new Set(Array.from(B.selectedOptions||[]).map(ee=>ee.value)):new Set;B.innerHTML="";let K=Array.isArray(D)?D:[],V=1;if(K.forEach(ee=>{if(!ee||typeof ee!="object")return;let{id:J,label:le}=t(ee,V);if(!J)return;let ue=new Option(g(le),J);L.has(J)&&(ue.selected=!0),B.appendChild(ue),V+=1}),!B.options.length){let ee=new Option(R("No stores found.","gpt3-ai-content-generator"),"");ee.disabled=!0,B.appendChild(ee)}},a=B=>{B&&typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(B)},l=async(B,D={})=>{let N=c(B);if(!N)return;let{__:R}=n(),j=D.force===!0,L=e();if(L.length&&(!j||!o.loaded)){d(N,L,{preserveSelection:!0}),a(B),o.loaded=!0;return}if(!j&&o.loaded&&s(N)||o.loading)return;let K=document.getElementById("aipkit_vector_store_nonce_openai"),V=K?K.value:"";if(!V||typeof window.aipkit_apiRequest!="function")return;o.loading=!0,N.innerHTML="";let ee=new Option(R("Loading vector stores...","gpt3-ai-content-generator"),"");ee.disabled=!0,N.appendChild(ee);try{let J=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:V,limit:100,order:"desc"}),le=Array.isArray(J.stores)?J.stores:[];i(le),d(N,le,{preserveSelection:!0}),a(B),o.loaded=!0}catch(J){let le=J&&J.message?J.message:R("Unable to load stores.","gpt3-ai-content-generator");N.innerHTML="";let ue=new Option(le,"");ue.disabled=!0,N.appendChild(ue)}finally{o.loading=!1}},p=B=>{B&&l(B,{force:!0})},_=B=>{if(!B)return null;let D=B.closest(".aipkit_model_settings_popover");return D?D.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline"):null},u=(B,D,N)=>{let R=_(B);R&&(R.textContent=D||"",R.classList.remove("success","error","loading"),N&&R.classList.add(N),R.style.display=D?"inline-block":"none")},m=(B,D=2500)=>{window.setTimeout(()=>{u(B,"","")},D)},k=B=>B?{pineconeKeyInput:B.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:B.querySelector('[name="qdrant_url"]'),qdrantKeyInput:B.querySelector('[name="qdrant_api_key"]')}:{},f=B=>{let D=B?.closest("#aipkit_ai_forms_container"),N=D?D.dataset:{},{pineconeKeyInput:R,qdrantUrlInput:j,qdrantKeyInput:L}=k(B),K=R?.value.trim(),V=j?.value.trim(),ee=L?.value.trim(),J=!!(K||N?.pineconeApiKeySet==="true"),le=!!(V||N?.qdrantUrlSet==="true")&&!!(ee||N?.qdrantApiKeySet==="true");return{pinecone:J,qdrant:le}},w=(B,D)=>B?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(B,{silent:!0,showErrors:!1,targetSelectId:D,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,B,{silent:!0,showErrors:!1,targetSelectId:D,propagateError:!0}):null:null,E=(B,D,N)=>{if(!D)return;u(B,"Syncing...","loading");let R=w(D,N);if(R&&typeof R.then=="function"){R.then(()=>{u(B,"Synced","success"),m(B)}).catch(j=>{u(B,`Error: ${j?.message||"Sync failed."}`,"error")});return}m(B)},y=(B,D)=>{if(!B||!D)return;if(D==="openai"){l(B);return}let N=f(B);D==="pinecone"&&N.pinecone?E(B,"PineconeIndexes","aipkit_ai_form_pinecone_index_name"):D==="qdrant"&&N.qdrant&&E(B,"QdrantCollections","aipkit_ai_form_qdrant_collection_name")},I=(B,D)=>{!D||!Object.keys(D).length||typeof window.aipkit_apiRequest=="function"&&(r.saving=!0,u(B,"Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",D).then(N=>{Object.keys(D).forEach(j=>{r.last[j]=D[j]});let R=B.closest("#aipkit_ai_forms_container");R&&(Object.prototype.hasOwnProperty.call(D,"pinecone_api_key")&&(R.dataset.pineconeApiKeySet=D.pinecone_api_key?"true":"false"),Object.prototype.hasOwnProperty.call(D,"qdrant_url")&&(R.dataset.qdrantUrlSet=D.qdrant_url?"true":"false"),Object.prototype.hasOwnProperty.call(D,"qdrant_api_key")&&(R.dataset.qdrantApiKeySet=D.qdrant_api_key?"true":"false")),Object.prototype.hasOwnProperty.call(D,"pinecone_api_key")&&y(B,"pinecone"),(Object.prototype.hasOwnProperty.call(D,"qdrant_url")||Object.prototype.hasOwnProperty.call(D,"qdrant_api_key"))&&y(B,"qdrant"),u(B,N.message||"Saved","success"),m(B)}).catch(N=>{u(B,`Error: ${N?.message||"Failed to save."}`,"error")}).finally(()=>{if(r.saving=!1,r.queued){let N=r.queued;r.queued=null,I(B,N)}}))},S=(B,D)=>{if(!D)return;let N=Object.keys(D).reduce((R,j)=>(D[j]!==r.last[j]&&(R[j]=D[j]),R),{});if(Object.keys(N).length){if(r.saving){r.queued={...r.queued||{},...N};return}I(B,N)}},h=B=>{if(!B)return;let D=B.querySelector(".aipkit_vector_store_enable_select"),N=B.querySelector(".aipkit_vector_store_settings_conditional_row"),R=B.querySelector(".aipkit_vector_store_provider_select"),j=B.querySelector(".aipkit_vector_store_openai_field"),L=B.querySelector(".aipkit_vector_store_pinecone_field"),K=B.querySelector(".aipkit_vector_store_pinecone_key_field"),V=B.querySelector(".aipkit_vector_store_qdrant_field"),ee=B.querySelector(".aipkit_vector_store_qdrant_url_field"),J=B.querySelector(".aipkit_vector_store_qdrant_key_field"),le=B.querySelector(".aipkit_vector_store_embedding_config_row");if(!D||!N||!R)return;let ue=D.tagName==="SELECT"?D.value==="1":D.checked;if(N.style.display=ue?"block":"none",!ue){[j,L,K,V,ee,J,le].forEach(ze=>{ze&&(ze.style.display="none")});return}let be=R.value||"openai";j&&(j.style.display=be==="openai"?"block":"none"),L&&(L.style.display=be==="pinecone"?"block":"none"),K&&(K.style.display=be==="pinecone"?"block":"none"),V&&(V.style.display=be==="qdrant"?"block":"none"),ee&&(ee.style.display=be==="qdrant"?"block":"none"),J&&(J.style.display=be==="qdrant"?"block":"none"),le&&(le.style.display=be==="pinecone"||be==="qdrant"?"block":"none"),be==="openai"&&(l(B),a(B))},M=B=>{let D=(B||"").split("::"),N=D.shift()||"",R=D.join("::")||"";return{provider:N,model:R}},b=(B,D)=>!B||!D?"":`${B}::${D}`,A=(B,D,N)=>{if(!B||!D||!N)return;let R=b(D,N);if(!R)return;let j=typeof CSS<"u"&&CSS.escape?CSS.escape(R):R.replace(/"/g,'\\"');if(B.querySelector(`option[value="${j}"]`))return;let L=document.createElement("option");L.value=R,L.dataset.provider=D,L.textContent=`${N} (Manual)`,B.appendChild(L)},x=(B,D)=>{if(!B)return;let N=D||B.querySelector(".aipkit_vector_embedding_select");if(!N)return;let R=B.querySelector('select[name="vector_embedding_provider"]'),j=B.querySelector('select[name="vector_embedding_model"]'),L=R?R.value:"",K=j?j.value:"",V=b(L,K);if(V){A(N,L,K),N.value=V;return}N.value=""},v=(B,D)=>{if(!D||!B)return;let N=D.querySelector('select[name="vector_embedding_provider"]'),R=D.querySelector('select[name="vector_embedding_model"]'),{provider:j,model:L}=M(B.value);N&&(N.value=j),N&&R&&typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(D),R&&(R.value=L)};function C(B){let D=B.querySelector(".aipkit_vector_embedding_provider_select"),N=B.querySelector(".aipkit_vector_embedding_model_select"),j=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!D||!N||!j)return;let K=D.value.toLowerCase(),V=j[K]||[];N.innerHTML="",N.appendChild(new Option(`-- Select ${D.options[D.selectedIndex]?.text||""} Model --`,"")),V&&Array.isArray(V)&&V.length>0?(V.forEach(ee=>{N.appendChild(new Option(g(ee.name),ee.id))}),N.disabled=!1):(N.appendChild(new Option("(No models found - Sync in Settings)","")),N.disabled=!0)}function P(B){let D=B||document,N=D.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),R=D.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!N||!R)return;let j=N.value==="approximate";R.style.display=j?"block":"none"}function $(B){let D=B||document,N=D.querySelector(".aipkit_ai_form_google_grounding_mode_select"),R=D.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!N||!R)return;let j=N.value==="MODE_DYNAMIC";R.style.display=j?"block":"none"}function U(B){let D=B.querySelector("#aipkit_form_editor_container");if(!D)return;let N=D.querySelector("#aipkit_ai_form_settings_popover");if(!N)return;let R=N.querySelector('[data-aipkit-settings-panel="context"]'),j=N.querySelector('[data-aipkit-settings-panel="tools"]');if(!R)return;let L=D.querySelector("#aipkit_ai_form_ai_provider"),K=k(R);r.last={pinecone_api_key:K.pineconeKeyInput?.value||"",qdrant_url:K.qdrantUrlInput?.value||"",qdrant_api_key:K.qdrantKeyInput?.value||""};let V="data-vector-config-listener-attached";if(R.getAttribute(V)!=="true"&&(R.addEventListener("change",ee=>{let J=ee.target;if(J){if(J.matches('[name="pinecone_api_key"]')||J.matches('[name="qdrant_url"]')||J.matches('[name="qdrant_api_key"]')){S(R,{[J.name]:J.value||""});return}if(J.matches(".aipkit_vector_store_enable_select")||J.matches(".aipkit_vector_store_provider_select")){h(R);let le=R.querySelector(".aipkit_vector_store_provider_select"),ue=le?le.value:"";y(R,ue);return}if(J.matches(".aipkit_vector_embedding_select")){v(J,R);return}if(J.matches(".aipkit_vector_embedding_provider_select")||J.matches(".aipkit_vector_embedding_model_select")){typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(R),x(R);return}J.matches('select[name="openai_vector_store_ids[]"]')&&a(R)}}),R.addEventListener("input",ee=>{let J=ee.target;if(J){if(J.matches("#aipkit_ai_form_vector_store_top_k")){let le=R.querySelector("#aipkit_ai_form_vector_store_top_k_value");le&&(le.textContent=J.value)}else if(J.matches("#aipkit_ai_form_vector_store_confidence_threshold")){let le=R.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");le&&(le.textContent=J.value+"%")}}}),R.setAttribute(V,"true")),j){let ee="data-tools-config-listener-attached";j.getAttribute(ee)!=="true"&&(j.addEventListener("change",J=>{let le=J.target;if(le.matches(".aipkit_ai_form_openai_web_search_toggle")||le.matches(".aipkit_ai_form_google_search_grounding_toggle")){if(typeof window.aipkitForms_updateWebSearchVisibility=="function"){let ue=L?L.value:"";window.aipkitForms_updateWebSearchVisibility(ue,D)}}else le.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?P(j):le.matches(".aipkit_ai_form_google_grounding_mode_select")&&$(j)}),j.addEventListener("input",J=>{let le=J.target;if(le.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let ue=j.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");ue&&(ue.textContent=parseFloat(le.value).toFixed(2))}}),j.setAttribute(ee,"true"))}typeof window.aipkitForms_updateWebSearchVisibility=="function"&&L&&window.aipkitForms_updateWebSearchVisibility(L.value,D),h(R),C(R),x(R),a(R)}window.aipkitForms_initVectorConfig=U,window.aipkitForms_populateVectorEmbeddingModels=C,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=P,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=$,window.aipkitForms_refreshOpenaiStores=p,window.aipkitForms_syncEmbeddingSelectFromInputs=x})();(function(){"use strict";function g(r,n,e,i){let c=window.aipkitAIFormsState,s=document.createElement("div");s.className="aipkit_layout_row",s.id=n.internalId;let t=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,d=document.createElement("div");d.className="aipkit_layout_row_columns_container",n.columns.forEach(a=>{let l=document.createElement("div");l.className="aipkit_layout_column",l.id=a.internalId,l.style.flexBasis=a.width,o(l,i),a.elements.forEach(p=>{window.aipkitForms_renderFieldInColumn(l,p)}),d.appendChild(l)}),s.innerHTML=t,s.appendChild(d),e?r.insertBefore(s,e):r.appendChild(s)}function o(r,n){let e=window.aipkitAIFormsState;r.addEventListener("dragover",i=>{i.preventDefault(),i.stopPropagation(),r.classList.add("aipkit-drag-over"),(e.draggedElement||e.draggedElementType)&&(i.dataTransfer.dropEffect=e.draggedElement?"move":"copy")}),r.addEventListener("dragleave",i=>{i.preventDefault(),i.stopPropagation(),r.classList.remove("aipkit-drag-over")}),r.addEventListener("drop",i=>{if(i.preventDefault(),r.classList.remove("aipkit-drag-over"),e.draggedElementType||e.draggedElement&&e.draggedElement.classList.contains("aipkit_dropped_element")){i.stopPropagation();let c=r.id;if(e.draggedElementType){let s=window.aipkitForms_createNewFormElementData(e.draggedElementType);e.formStructure.forEach(t=>{let d=t.columns.find(a=>a.internalId===c);d&&d.elements.push(s)}),window.aipkitForms_renderFieldInColumn(r,s,null,n)}else e.draggedElement&&(r.appendChild(e.draggedElement),window.aipkitForms_updateFormStructureOrder());e.draggedElementType=null,e.draggedElement&&(e.draggedElement.classList.remove("aipkit-row-dragging-source"),e.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector("#aipkit_ai_form_settings_popover");if(!r)return;let n=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!n.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),i=r.querySelector(".aipkit_model_settings_popover_back"),c=o.querySelector("#aipkit_ai_form_settings_trigger"),s={root:r.dataset.titleRoot||"Settings",parameters:r.dataset.titleParameters||"Parameters",context:r.dataset.titleContext||"Context",tools:r.dataset.titleTools||"Tools"},t=null,d=a=>{let l=a||"root",p=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let _=p.dataset.aipkitSettingsPanel||"root";_!==t&&(n.forEach(u=>{u.hidden=u!==p}),e&&(e.textContent=s[_]||s.root),i&&(i.hidden=_==="root"),t=_,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",a=>{let l=a.target.closest("[data-aipkit-panel-target]");if(!l)return;a.preventDefault();let p=l.dataset.aipkitPanelTarget;d(p)}),i&&i.addEventListener("click",a=>{a.preventDefault(),d("root")}),c&&c.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitForms_initEditorSettingsPopover=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector("#aipkit_form_editor_container");if(!r)return;let n=r.querySelector("#aipkit_ai_form_prompt_template"),e=r.querySelector(".aipkit_ai_form_prompt_expand"),i=document.getElementById("aipkit_ai_form_prompt_modal");if(!n||!e||!i)return;let c=i.querySelector(".aipkit_ai_form_prompt_modal_textarea"),s=i.querySelector(".aipkit_ai_form_prompt_count"),t=i.querySelector(".aipkit_ai_form_prompt_modal_close");if(i.dataset.bound==="1")return;let d=_=>{s&&(s.textContent=`${_.length.toLocaleString()} characters`)},a=_=>{c&&(c.value=_,d(_))},l=()=>{c&&(a(n.value||""),i.classList.add("aipkit-active"),i.setAttribute("aria-hidden","false"),setTimeout(()=>c.focus(),0))},p=_=>{if(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),!_||!c)return;let u=c.value;u!==n.value&&(n.value=u,n.dispatchEvent(new Event("input",{bubbles:!0})))};e.addEventListener("click",_=>{_.preventDefault(),l()}),t&&t.addEventListener("click",()=>{p(!0)}),document.addEventListener("keydown",_=>{_.key==="Escape"&&i.classList.contains("aipkit-active")&&p(!0)}),c&&c.dataset.bound!=="1"&&(c.addEventListener("input",()=>{d(c.value)}),c.dataset.bound="1"),i.dataset.bound="1"}window.aipkitForms_initPromptModal=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.querySelector("#aipkit_ai_forms_settings_popover");if(!r)return;let n=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!n.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),i=r.querySelector(".aipkit_model_settings_popover_back"),c=r.querySelector(".aipkit_model_settings_popover_footer"),s=o.querySelector("#aipkit_ai_forms_settings_trigger"),t={root:r.dataset.titleRoot||"Settings",limits:r.dataset.titleLimits||"Limits","custom-css":r.dataset.titleCustomCss||"Custom CSS","provider-filtering":r.dataset.titleProviderFiltering||"Provider Filtering"},d=null,a=l=>{let p=l||"root",_=r.querySelector(`[data-aipkit-settings-panel="${p}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!_)return;let u=_.dataset.aipkitSettingsPanel||"root";u!==d&&(n.forEach(m=>{m.hidden=m!==_}),e&&(e.textContent=t[u]||t.root),i&&(i.hidden=u==="root"),c&&(c.hidden=u==="root"),u==="limits"&&typeof window.aipkitForms_initializeTokenUI=="function"&&window.aipkitForms_initializeTokenUI(o),d=u,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",l=>{let p=l.target.closest("[data-aipkit-panel-target]");if(!p)return;l.preventDefault();let _=p.dataset.aipkitPanelTarget;a(_)}),i&&i.addEventListener("click",l=>{l.preventDefault(),a("root")}),s&&s.addEventListener("click",()=>{a("root")}),a("root"),r.dataset.panelsBound="true"}window.aipkitForms_initSettingsPopoverPanels=g})();(function(){"use strict";let g=[{key:"openai",label:"OpenAI"},{key:"openrouter",label:"OpenRouter"},{key:"google",label:"Google"},{key:"azure",label:"Azure",keepWhenEmpty:!0,emptyMessage:"No Azure deployments found. Sync Azure models in main settings first."},{key:"deepseek",label:"DeepSeek"},{key:"ollama",label:"Ollama",requiresPro:!0}],o=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s,r=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(s,t)=>s.replace("%d",t),n=s=>{if(!s)return null;if(typeof s=="string")return{id:s,name:s};if(typeof s=="object"){let t=s.id||s.name||"";return t?{id:t,name:s.name||s.id||t}:null}return null},e=s=>{if(!s)return null;if(Array.isArray(s))return s.map(n).filter(Boolean);if(typeof s=="object"){let t={};return Object.keys(s).forEach(d=>{let l=(Array.isArray(s[d])?s[d]:[]).map(n).filter(Boolean);l.length&&(t[d]=l)}),t}return null},i=s=>s?Array.isArray(s)?s.length>0:Object.keys(s).length>0:!1;function c(s){let t=s||document,d=t.querySelector("#aipkit_ai_forms_models_selector");if(!d||d.dataset.enhanced==="true")return;let a=t.querySelector("#aipkit_aiforms_frontend_models"),l=t.querySelector("#aipkit_aiforms_frontend_providers");if(!a||!l)return;let p=o(),_=r(),m=(d.dataset.initialValue||a.value||"").split(",").map(b=>b.trim()).filter(Boolean),k=new Set(m),f=window.aipkit_dashboard||{},w=f.models||{},E=!!f.isProPlan,y=g.filter(b=>!b.requiresPro||E).map(b=>({...b,models:e(w[b.key])})).filter(b=>b.keepWhenEmpty||i(b.models));d.innerHTML="",d.classList.add("aipkit_models_selector--ready");let I=document.createElement("input");I.type="search",I.placeholder=p("Filter models...","gpt3-ai-content-generator"),I.className="aipkit_models_selector-search",d.appendChild(I);let S=document.createElement("div");S.className="aipkit_models_selector-summary",d.appendChild(S);let h=document.createElement("div");h.className="aipkit_models_selector-providers",d.appendChild(h);let M=b=>{let A=Array.from(d.querySelectorAll('.aipkit_models_selector-item input[type="checkbox"]:checked')),x=A.map(P=>P.value.trim()).filter(Boolean),v=new Set;A.forEach(P=>{P.dataset.providerName&&v.add(P.dataset.providerName)});let C=x.length?y.map(P=>P.label).filter(P=>v.has(P)).join(", "):"";a.value=x.join(", "),l.value=C,x.length===0?S.textContent=p("Showing all models (none selected)","gpt3-ai-content-generator"):x.length===1?S.textContent=p("1 model selected","gpt3-ai-content-generator"):S.textContent=_(p("%d models selected","gpt3-ai-content-generator"),x.length),b&&typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};y.forEach(b=>{let A=document.createElement("div");A.className="aipkit_models_selector-provider",A.dataset.provider=b.key;let x=document.createElement("div");x.className="aipkit_models_selector-provider-header",x.innerHTML=`<strong>${b.label}</strong>`;let v=document.createElement("div");v.className="aipkit_models_selector-provider-actions";let C=document.createElement("button");C.type="button",C.className="aipkit_btn aipkit_btn-xs",C.textContent=p("All","gpt3-ai-content-generator");let P=document.createElement("button");P.type="button",P.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",P.textContent=p("None","gpt3-ai-content-generator"),v.appendChild(C),v.appendChild(P),x.appendChild(v),A.appendChild(x);let $=document.createElement("div");$.className="aipkit_models_selector-models";let U=B=>{if(!B||!B.id)return;let D=document.createElement("label");D.className="aipkit_models_selector-item",D.title=B.id;let N=document.createElement("input");N.type="checkbox",N.value=B.id,N.checked=k.has(B.id),N.dataset.providerName=b.label,N.addEventListener("change",()=>M(!0));let R=document.createElement("span");R.textContent=B.name||B.id,D.appendChild(N),D.appendChild(R),$.appendChild(D)};if(Array.isArray(b.models)?b.models.forEach(B=>U(B)):b.models&&typeof b.models=="object"&&Object.keys(b.models).forEach(B=>{let D=b.models[B]||[];if(!D.length)return;let N=document.createElement("div");N.className="aipkit_models_selector-subgroup",N.textContent=B.charAt(0).toUpperCase()+B.slice(1),$.appendChild(N),D.forEach(R=>U(R))}),!i(b.models)){let B=document.createElement("div");B.className="aipkit_models_selector-empty",B.textContent=p(b.emptyMessage||"No models found.","gpt3-ai-content-generator"),$.appendChild(B)}C.addEventListener("click",()=>{$.querySelectorAll('input[type="checkbox"]').forEach(B=>{B.checked=!0}),M(!0)}),P.addEventListener("click",()=>{$.querySelectorAll('input[type="checkbox"]').forEach(B=>{B.checked=!1}),M(!0)}),A.appendChild($),h.appendChild(A)}),I.addEventListener("input",()=>{let b=I.value.toLowerCase();h.querySelectorAll(".aipkit_models_selector-provider").forEach(A=>{let x=!1;A.querySelectorAll(".aipkit_models_selector-item").forEach(v=>{let P=v.textContent.toLowerCase().includes(b);v.style.display=P?"":"none",P&&(x=!0)}),A.style.display=x||b===""?"":"none"})}),M(!1),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),d.dataset.enhanced="true"}window.aipkitForms_initAllowedModelsSelector=c})();(function(){"use strict";let g=window.wp?.i18n?.__||function(h){return h},o="#aipkit_ai_forms_container #aipkit_ai_form_ai_provider, #aipkit_ai_forms_container #aipkit_ai_form_ai_model, #aipkit_ai_forms_container #aipkit_ai_form_vector_store_provider",r=null,n=null,e=!1,i=h=>!!(h&&(h.id==="aipkit_ai_form_ai_provider"||h.id==="aipkit_ai_form_vector_store_provider")),c=h=>!!(h&&i(h)),s=(h,M)=>{if(!h)return!1;let b=t(M);return b?["openai","openrouter","google","azure","deepseek","ollama","pinecone","qdrant"].includes(b):!1},t=h=>String(h||"").trim().toLowerCase(),d=(h,M,b)=>{if(!h)return;let A="aipkit_settings_select_picker_icon--";h.classList.forEach(C=>{C.startsWith(A)&&h.classList.remove(C)});let x=t(b),v=s(M,x);h.hidden=!v,v&&h.classList.add(`${A}${x}`)},a=h=>{if(!h)return"";let M=h.getAttribute("data-aipkit-picker-title");if(M)return M;let b=h.id&&document.querySelector(`label[for="${h.id}"]`)||h.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return b?b.textContent.trim():""},l=h=>{if(!h)return"";let M=h.selectedOptions&&h.selectedOptions.length?h.selectedOptions[0]:h.querySelector("option[selected]");if(M)return M.textContent.trim();let b=h.querySelector("option");return b?b.textContent.trim():""},p=h=>({buttonId:`${h}_picker_btn`,labelId:`${h}_picker_label`,popoverId:`${h}_picker_popover`,titleId:`${h}_picker_title`,searchId:`${h}_picker_search`,listId:`${h}_picker_list`}),_=(h,M)=>{if(!h||!h.id||!M)return null;let b=p(h.id),A=document.getElementById(b.buttonId);if(!A){if(A=document.createElement("button"),A.type="button",A.id=b.buttonId,A.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",A.setAttribute("data-aipkit-popover-target",b.popoverId),A.setAttribute("aria-controls",b.popoverId),A.setAttribute("aria-expanded","false"),A.dataset.aipkitPopoverPlacement="bottom",i(h)){A.classList.add("aipkit_settings_select_picker_btn--provider");let P=document.createElement("span");P.className="aipkit_settings_select_picker_icon",P.setAttribute("aria-hidden","true"),d(P,h,h.value),A.appendChild(P)}let v=document.createElement("span");v.className="aipkit_settings_select_picker_label",v.id=b.labelId,v.textContent=l(h)||g("Select","gpt3-ai-content-generator");let C=document.createElement("span");C.className="dashicons dashicons-arrow-down-alt2",C.setAttribute("aria-hidden","true"),A.appendChild(v),A.appendChild(C),h.insertAdjacentElement("beforebegin",A)}h.classList.contains("screen-reader-text")||h.classList.add("screen-reader-text");let x=document.getElementById(b.popoverId);if(!x){x=document.createElement("div"),x.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",x.id=b.popoverId,x.setAttribute("aria-hidden","true"),i(h)&&x.classList.add("aipkit_settings_select_picker_popover--provider");let v=document.createElement("div");v.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",v.setAttribute("role","dialog"),v.setAttribute("aria-labelledby",b.titleId);let C=document.createElement("div");C.className="aipkit_model_settings_popover_header";let P=document.createElement("span");P.className="aipkit_model_settings_popover_title",P.id=b.titleId,P.textContent=a(h)||g("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',C.appendChild(P),C.appendChild($);let U=document.createElement("div");U.className="aipkit_model_settings_popover_body";let B=document.createElement("div");B.className="aipkit_settings_select_picker_search";let D=document.createElement("input");D.type="search",D.id=b.searchId,D.className="aipkit_form-input";let N=a(h),R=N?`Search ${N.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");D.setAttribute("placeholder",R),B.appendChild(D);let j=document.createElement("div");j.className="aipkit_settings_select_picker_list",j.id=b.listId,j.setAttribute("role","listbox"),U.appendChild(B),U.appendChild(j),v.appendChild(C),v.appendChild(U),x.appendChild(v),M.appendChild(x),c(h)&&(B.style.display="none")}return{ids:b,button:A,popover:x,label:document.getElementById(b.labelId),search:document.getElementById(b.searchId),list:document.getElementById(b.listId)}},u=h=>{let M=[];return h&&Array.from(h.children).forEach(A=>{if(A.tagName==="OPTGROUP"){let x=Array.from(A.children).filter(v=>v.tagName==="OPTION").map(v=>({value:v.value,label:v.textContent.trim(),disabled:v.disabled,selected:v.selected}));M.push({label:A.label,options:x})}else A.tagName==="OPTION"&&M.push({label:"",options:[{value:A.value,label:A.textContent.trim(),disabled:A.disabled,selected:A.selected}]})}),M},m=(h,M,b="")=>{if(!h||!M)return;M.innerHTML="";let A=u(h),x=b.trim().toLowerCase(),v=!1;if(A.forEach(C=>{let P=C.options.filter($=>x?$.label.toLowerCase().includes(x):!0);if(P.length){if(C.label){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=C.label,M.appendChild($)}P.forEach($=>{let U=document.createElement("button");if(U.type="button",U.className="aipkit_settings_select_picker_item",$.disabled&&U.classList.add("is-disabled"),$.selected&&U.classList.add("is-active"),U.dataset.value=$.value,i(h)&&s(h,$.value)){let N=document.createElement("span");N.className="aipkit_settings_select_picker_icon",N.setAttribute("aria-hidden","true"),d(N,h,$.value),U.appendChild(N)}let B=document.createElement("span");B.className="aipkit_settings_select_picker_text",B.textContent=$.label||$.value;let D=document.createElement("span");D.className="dashicons dashicons-yes aipkit_settings_select_picker_check",D.setAttribute("aria-hidden","true"),U.appendChild(B),U.appendChild(D),M.appendChild(U),v=!0})}}),!v){let C=document.createElement("div");C.className="aipkit_settings_select_picker_empty",C.textContent=g(x?"No matches found.":"No options available.","gpt3-ai-content-generator"),M.appendChild(C)}},k=(h,M)=>{if(!h||!M)return;let b=l(h);if(M.textContent=b||g("Select","gpt3-ai-content-generator"),i(h)){let A=M.closest("button"),x=A?A.querySelector(".aipkit_settings_select_picker_icon"):null;d(x,h,h.value)}},f=(h,M)=>{if(!h||!M)return;let b=h.getBoundingClientRect(),A=M.getBoundingClientRect(),x=A.width||320,v=A.height||0,C=window.innerWidth,P=window.innerHeight,$=12;if(h.dataset.aipkitPopoverPlacement==="bottom"){let D=b.left;D+x>C-$&&(D=b.right-x),D=Math.max($,Math.min(D,C-x-$));let N=b.bottom+8;N+v>P-$&&(N=b.top-v-8),N=Math.max($,Math.min(N,P-v-$)),M.style.left=`${Math.round(D)}px`,M.style.top=`${Math.round(N)}px`;return}let U=b.right+10;U+x>C-$&&(U=b.left-x-10),U=Math.max($,Math.min(U,C-x-$));let B=b.top;B+v>P-$&&(B=P-v-$),B=Math.max($,B),M.style.left=`${Math.round(U)}px`,M.style.top=`${Math.round(B)}px`},w=()=>{!r||!n||e||(e=!0,window.requestAnimationFrame(()=>{let h=r.querySelector(".aipkit_model_settings_popover_panel");f(n,h),e=!1}))},E=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),r=null,n=null)},y=(h,M,b)=>{if(!h||!M)return;r&&r!==M&&E(),r=M,n=h,M.classList.add("aipkit-active"),M.setAttribute("aria-hidden","false"),h.setAttribute("aria-expanded","true");let A=M.querySelector(".aipkit_settings_select_picker_search input"),x=M.querySelector(".aipkit_settings_select_picker_list");x&&m(b,x,A?A.value:""),A&&A.offsetParent!==null&&(A.focus(),A.select());let v=M.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{f(h,v)})},I=(h,M)=>{if(!h||!M)return;let{button:b,popover:A,list:x,search:v}=M;if(b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("click",C=>{if(C.preventDefault(),r===A){E();return}y(b,A,h)}),b.dataset.pickerListenerAttached="true"),A&&A.dataset.overlayListenerAttached!=="true"){A.addEventListener("click",P=>{P.target===A&&E()});let C=A.querySelector(".aipkit_model_settings_popover_close");C&&C.addEventListener("click",P=>{P.preventDefault(),E()}),A.dataset.overlayListenerAttached="true"}if(x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("click",C=>{let P=C.target.closest(".aipkit_settings_select_picker_item");if(!P||P.classList.contains("is-disabled"))return;let $=P.dataset.value??"";h.value=$,h.dispatchEvent(new Event("change",{bubbles:!0})),k(h,M.label),m(h,x,v?v.value:""),E()}),x.dataset.pickerListenerAttached="true"),v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("input",()=>{m(h,x,v.value)}),v.dataset.pickerListenerAttached="true"),h&&h.dataset.pickerListenerAttached!=="true"&&(h.addEventListener("change",()=>{k(h,M.label),m(h,x,v?v.value:"")}),h.dataset.pickerListenerAttached="true"),h&&h.dataset.pickerObserverAttached!=="true"){let C=!1;new MutationObserver(()=>{C||(C=!0,window.requestAnimationFrame(()=>{k(h,M.label),m(h,x,v?v.value:""),C=!1}))}).observe(h,{childList:!0,subtree:!0}),h.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitAiFormsPickerEscapeBound||(document.addEventListener("keydown",C=>{C.key==="Escape"&&r&&E()}),document.body.dataset.aipkitAiFormsPickerEscapeBound="true"),document.body.dataset.aipkitAiFormsPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitAiFormsPickerRepositionBound="true")};function S(h){let M=h||document.getElementById("aipkit_ai_forms_container");if(!M)return;let b=M.querySelectorAll(o);b.length&&b.forEach(A=>{if(!A.id||A.dataset.aipkitPickerInit==="true")return;let x=_(A,M);x&&(k(A,x.label),m(A,x.list,x.search?x.search.value:""),I(A,x),A.dataset.aipkitPickerInit="true")})}window.aipkitForms_initSelectPickers=S,window.aipkitForms_refreshSelectPickers=function(h){let M=h||document.getElementById("aipkit_ai_forms_container");if(!M)return;let b=M.querySelectorAll(o);b.length&&b.forEach(A=>{if(!A.id)return;let x=_(A,M);x&&(k(A,x.label),m(A,x.list,x.search?x.search.value:""),I(A,x),A.dataset.aipkitPickerInit="true")})}})();(function(){"use strict";let g={css:new Set,js:new Set},o=()=>{let l=typeof wp<"u"&&wp.i18n?wp.i18n:null;return{__:l&&typeof l.__=="function"?l.__:p=>p}},r=window.aipkit_escapeHtml||(l=>l),n=l=>{if(!l||g.css.has(l))return;if(document.querySelector(`link[href="${l}"]`)){g.css.add(l);return}let p=document.createElement("link");p.rel="stylesheet",p.href=l,document.head.appendChild(p),g.css.add(l)},e=l=>!l||g.js.has(l)?Promise.resolve():new Promise((p,_)=>{if(document.querySelector(`script[src="${l}"]`)){g.js.add(l),p();return}let u=document.createElement("script");u.src=l,u.async=!0,u.onload=()=>{g.js.add(l),p()},u.onerror=()=>_(new Error(`Failed to load script: ${l}`)),document.body.appendChild(u)}),i=(l,p,_="info")=>{if(!l)return;let u=_==="error"?"aipkit_ai_forms_preview_message aipkit_ai_forms_preview_message--error":"aipkit_ai_forms_preview_message",m=_==="error"?"":'<span class="aipkit_spinner" aria-hidden="true"></span>';l.innerHTML=`
      <div class="${u}">
        ${m}
        <span>${r(p)}</span>
      </div>
    `},c=(l,p,_={})=>{let{__:u}=o(),m=window.aipkit_ai_forms_config||{},k=_.loadingText||u("Loading preview...","gpt3-ai-content-generator");return p?l?typeof window.aipkit_apiRequest!="function"?(i(p,u("Preview loader is unavailable.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("API request helper missing."))):(i(p,k),window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:l,_ajax_nonce:m.nonce_manage_forms}).then(f=>(f.config&&(window.aipkit_ai_forms_public_config=f.config),f.models&&(window.aipkit_ai_forms_models=f.models),f.assets&&f.assets.css&&Object.values(f.assets.css).forEach(n),p.innerHTML=f.html||"",f.assets&&f.assets.js?Promise.all(Object.values(f.assets.js).map(e)):null)).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(f=>{let w=f&&f.message?f.message:"Unknown error.";throw i(p,`${u("Preview failed:","gpt3-ai-content-generator")} ${w}`,"error"),f})):(i(p,u("Missing form ID for preview.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("Form ID missing."))):Promise.reject(new Error("Preview container not found."))},s=l=>{let p=l||document.getElementById("aipkit_ai_forms_container");if(!p)return null;let _=p.querySelector("#aipkit_ai_forms_preview_sheet");return _?{container:p,overlay:_,panel:_.querySelector(".aipkit_builder_sheet_panel"),closeButton:_.querySelector("#aipkit_ai_forms_preview_sheet_close"),title:_.querySelector("#aipkit_ai_forms_preview_sheet_title"),description:_.querySelector("#aipkit_ai_forms_preview_sheet_description"),previewFrame:_.querySelector("#aipkit_ai_forms_preview_frame")}:null},t=(l,p,_)=>{let{__:u}=o(),m=s(_);if(!m)return;let k=p&&String(p).trim()||u("Untitled","gpt3-ai-content-generator");m.title&&(m.title.textContent=u("Preview","gpt3-ai-content-generator")),m.description&&(m.description.textContent="",m.description.removeAttribute("title"),m.description.setAttribute("hidden","true")),m.overlay.classList.add("aipkit-active"),m.overlay.setAttribute("aria-hidden","false"),m.previewFrame&&c(l,m.previewFrame).catch(()=>{}),m.closeButton&&m.closeButton.focus()},d=l=>{let p=s(l);p&&(p.overlay.classList.remove("aipkit-active"),p.overlay.setAttribute("aria-hidden","true"),p.previewFrame&&(p.previewFrame.innerHTML=""))},a=l=>{let p=s(l);!p||p.overlay.dataset.previewSheetInitialized==="true"||(p.closeButton&&p.closeButton.addEventListener("click",_=>{_.preventDefault(),d(p.container)}),p.overlay.addEventListener("click",_=>{_.target===p.overlay&&d(p.container)}),document.addEventListener("keydown",_=>{_.key==="Escape"&&p.overlay.classList.contains("aipkit-active")&&d(p.container)}),p.overlay.dataset.previewSheetInitialized="true")};window.aipkitForms_loadFormPreview=c,window.aipkitForms_openPreviewSheet=t,window.aipkitForms_closePreviewSheet=d,window.aipkitForms_initPreviewSheet=a})();(function(){"use strict";function g(){let o=window.aipkitForms_validateContainer();if(!o)return;let r=()=>{typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(o):console.error("AI Forms Init: aipkit_initContentWriterPopovers function not found.")};if(o.dataset.aipkitInitialized==="true"){r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"&&window.aipkitForms_initSettingsPopoverPanels(o),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(o),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(o),typeof window.aipkitForms_initSettingsAutosave=="function"&&window.aipkitForms_initSettingsAutosave(o),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(o),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(o),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(o),window.aipkitForms_initializeDragAndDrop(o),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(o),window.aipkitForms_initializeTokenUI(o);return}r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"?window.aipkitForms_initSettingsPopoverPanels(o):console.error("AI Forms Init: aipkitForms_initSettingsPopoverPanels function not found."),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(o),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(o),typeof window.aipkitForms_initSettingsAutosave=="function"?window.aipkitForms_initSettingsAutosave(o):console.error("AI Forms Init: aipkitForms_initSettingsAutosave function not found."),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(o),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(o),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(o),window.aipkitForms_attachClickEventListeners(o),window.aipkitForms_attachChangeEventListeners(o),window.aipkitForms_attachSettingsPanelListeners(o),window.aipkitForms_initializeAccordions(o),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(o):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(o),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(o),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(o):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(o):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),o.dataset.aipkitInitialized="true"}window.aipkit_initAiForms=g})();(function(){"use strict";let g="",o={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",status:"task_config_status",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",status:"task_config_status",prompts:"task_config_ai",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",status:"task_config_status",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",status:"task_config_status",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function r(){let c=document.getElementById("aipkit_automated_task_form"),s=document.getElementById("aipkit_provider_notice_autogpt");if(!c||!s)return;c.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"][data-aipkit-provider-notice-defer="1"]').forEach(p=>{delete p.dataset.aipkitProviderNoticeArmed});let d=Array.from(c.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"]')),a=p=>p&&(p.offsetParent!==null||p.getClientRects().length>0),l=d.filter(a);if(!l.length){s.classList.add("aipkit_provider_notice--hidden");return}l.forEach(p=>{p.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(p.dataset.aipkitProviderNoticeArmed="true")}),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(c)}function n(c){if(!c)return null;let s="content_writing";return c==="content_indexing"?s="content_indexing":c==="community_reply_comments"?s="community_reply_comments":c==="enhance_existing_content"&&(s="enhance_existing_content"),window.aipkit_wizardConfig[s]||null}function e(c){let s=document.querySelector(".aipkit_wizard_content_container"),t=document.getElementById("aipkit_save_task_btn");if(!s)return;let d=n(c);if(!d){s.querySelectorAll(".aipkit_wizard_content_step").forEach(l=>{l.style.display="none",l.classList.remove("aipkit_active")}),t&&(t.style.display="none"),r();return}let a=new Set(Object.values(d.contentMap));s.querySelectorAll(".aipkit_wizard_content_step").forEach(l=>{let p=l.dataset.contentId||"";a.has(p)?(l.style.display="block",l.classList.add("aipkit_active")):(l.style.display="none",l.classList.remove("aipkit_active"))}),t&&(t.style.display="inline-flex"),r()}function i(c){g=c,e(c)}window.aipkit_renderWizard=i,window.aipkit_initWizardNavigation=()=>{},window.aipkit_resetWizard=()=>{g="",e("")},window.aipkit_wizardConfig=o})();(function(){"use strict";function g(o){let r=window.aipkit_automated_tasks_config||{},n=r.text||{},e=window.aipkit_escapeHtml||function(t){return t},i=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!i)return Promise.resolve();i.innerHTML=`<option value="">${e(n.loading_stores||"Loading...")}</option>`,i.disabled=!0;let c=[],s=n.select_target_store||"-- Select Target Store --";return o==="openai"&&r.openai_vector_stores?c=r.openai_vector_stores:o==="pinecone"&&r.pinecone_indexes?(c=r.pinecone_indexes,s=n.select_target_index||"-- Select Target Index --"):o==="qdrant"&&r.qdrant_collections&&(c=r.qdrant_collections,s=n.select_target_collection||"-- Select Target Collection --"),i.innerHTML=`<option value="">${e(s)}</option>`,c&&Array.isArray(c)&&c.length>0?(c.forEach(t=>{let d=t.id||t.name,a=t.name||t.id,l=e(a);o==="openai"&&t.file_counts?.total!==void 0?l+=` (Files: ${t.file_counts.total})`:o==="pinecone"&&t.dimension!==void 0&&(l+=` (Dim: ${t.dimension})`),i.appendChild(new Option(l,d))}),i.disabled=!1):(i.appendChild(new Option(e(n.no_targets_found_configure||`No ${o} targets found. Configure in AI Training.`),"")),i.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=g})();(function(){"use strict";function g(){let o=window.aipkit_automated_tasks_config||{},r=o.text||{},n=window.aipkit_escapeHtml||function(l){return l},e=document.getElementById("aipkit_task_content_indexing_embedding_model"),i=window.aipkit_automated_tasks_form_state||{},c=i.pendingEmbeddingModelSelection;if(!e)return Promise.resolve();e.innerHTML=`<option value="">${n(r.select_embedding_model||"-- Select Model --")}</option>`;let s=o.openai_embedding_models||[],t=o.google_embedding_models||[],d=o.azure_embedding_models||[],a=(l,p,_)=>{let u=document.createElement("optgroup");return u.label=n(l),p&&p.length>0&&p.forEach(m=>{let k=`${_}:${m.id}`;u.appendChild(new Option(n(m.name||m.id),k))}),u};if(e.appendChild(a("OpenAI",s,"openai")),e.appendChild(a("Google",t,"google")),e.appendChild(a("Azure",d,"azure")),e.disabled=s.length===0&&t.length===0&&d.length===0,e.disabled&&(e.innerHTML=`<option value="">${n(r.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),c&&e.querySelector(`option[value="${CSS.escape(c)}"]`))e.value=c,i.pendingEmbeddingModelSelection=null;else if(e.options.length>1){let l=e.querySelector("optgroup");l&&l.options.length>0&&(e.value=l.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=g})();(function(){"use strict";function g(o){let r=o.target.value,n=document.getElementById("aipkit_task_content_indexing_embedding_model_group"),e=document.getElementById("aipkit_task_content_indexing_embedding_model_divider");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(r):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),n){let i=r==="pinecone"||r==="qdrant";n.style.display=i?"block":"none",e&&(e.style.display=i?"flex":"none"),i&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_autogpt_container");if(!o)return;let r=o.querySelector("#aipkit_task_content_indexing_target_store_provider");if(r){if(r.dataset.listenerAttached==="true")return;typeof window.aipkit_handleTargetStoreProviderChange=="function"?(r.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:r}),r.dataset.listenerAttached="true"):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found.")}}window.aipkit_initContentIndexingTaskFormUI=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n},o=window.wp?.i18n?.__||function(n){return n};function r(n,e){let i=n.value,c=i?i.toLowerCase():"",s=window.aipkit_dashboard?.models,t=window.aipkit_automated_tasks_form_state||{};if(!e)return;if(!s){e.innerHTML=`<option value="">${g("Error: Model data object not found")}</option>`,e.disabled=!0;return}let d=s[c];(typeof d>"u"||d===null)&&(console.warn(`AutoGPT Model Populator: No model data for provider '${c}'.`),d=c==="openai"?{}:[]);let a=t.pendingModelSelection||e.value;e.innerHTML="";let l=window.aipkit_dashboard?.recommendedModels?.[c]||[],p=Array.isArray(l)?l:[],_=new Set(p.map(u=>u?.id).filter(Boolean));if(c==="openai"&&typeof d=="object"&&!Array.isArray(d)){if(p.length>0){let u=document.createElement("optgroup");u.label=g(o("Recommended","gpt3-ai-content-generator")),p.forEach(m=>{m&&typeof m=="object"&&m.id&&u.appendChild(new Option(g(m.name||m.id),m.id))}),u.children.length>0&&e.appendChild(u)}Object.keys(d).forEach(u=>{let m=document.createElement("optgroup");m.label=g(u),Array.isArray(d[u])&&d[u].forEach(k=>{if(k&&k.id){if(_.has(k.id))return;m.appendChild(new Option(g(k.name||k.id),k.id))}}),e.appendChild(m)})}else if(Array.isArray(d)){if(p.length>0){let m=document.createElement("optgroup");m.label=g(o("Recommended","gpt3-ai-content-generator")),p.forEach(k=>{k&&typeof k=="object"&&k.id&&m.appendChild(new Option(g(k.name||k.id),k.id))}),m.children.length>0&&e.appendChild(m)}let u=p.length>0?document.createElement("optgroup"):null;u&&(u.label=g(o("All models","gpt3-ai-content-generator"))),d.forEach(m=>{if(m&&m.id){if(_.has(m.id))return;let k=new Option(g(m.name||m.id),m.id);u?u.appendChild(k):e.appendChild(k)}}),u&&u.children.length>0&&e.appendChild(u)}else console.warn(`AutoGPT Model Populator: Unexpected format for provider '${c}'.`),e.appendChild(new Option(g(`No models for ${i} (Format Error)`),""));if(e.options.length===0)e.appendChild(new Option(g(`No models for ${i}`),"")),e.disabled=!0;else{e.disabled=!1;let u=!1;if(a&&e.querySelector(`option[value="${CSS.escape(a)}"]`)&&(e.value=a,u=!0),!u&&e.options.length>0){let m=e.querySelector('option:not([value=""])');m&&(e.value=m.value)}}t&&(t.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort(),e&&e.dispatchEvent(new Event("change",{bubbles:!0}))}window.aipkit_task_cw_populateModels=r})();(function(){"use strict";function g(o){if(!o)return;let r=o.closest(".aipkit_slider_wrapper"),n=null;if(r&&(n=r.querySelector(".aipkit_slider_value")),!n){let e=o.closest(".aipkit_ai_temperature_control");e&&(n=e.querySelector(".aipkit_ai_behavior_value"))}n&&(n.textContent=o.value,o.dataset.listenerAttached||(o.addEventListener("input",()=>n.textContent=o.value),o.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=g})();(function(){"use strict";function g(o){if(!o)return;let r=o.closest(".aipkit_slider_wrapper"),n=r?r.querySelector(".aipkit_slider_value"):null;n&&(n.textContent=o.value,o.dataset.listenerAttached||(o.addEventListener("input",()=>n.textContent=o.value),o.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=g})();(function(){"use strict";function g(o){let r=o.target,n=r.closest(".aipkit_post_settings_redesigned")||r.closest(".aipkit_wizard_content_step")||document,e=n.querySelector("#aipkit_task_cw_schedule_options_wrapper"),i=n.querySelector("#aipkit_task_cw_smart_schedule_fields"),c=n.querySelector(".aipkit_task_schedule_from_input_option"),s=c?c.querySelector(".aipkit_post_schedule_radio_text"):null,t=c?c.querySelector(".aipkit_popover_warning[data-tooltip]"):null;if(!e)return;let d=r.value==="publish";e.style.display=d?"block":"none";let a=document.getElementById("aipkit_automated_task_type"),l=new Set(["content_writing_bulk","content_writing_csv","content_writing_gsheets"]),p=`Accepted formats: YYYY-MM-DD HH:MM[:SS], YYYY/MM/DD HH:MM, MM/DD/YYYY HH:MM, DD/MM/YYYY HH:MM, or ISO 8601.

Times use the site timezone unless an offset/Z is provided.`,_={content_writing_bulk:{label:"Use Dates from List",tooltip:`Use when your list includes a publish date on each line.

`+p},content_writing_csv:{label:"Use Dates from CSV",tooltip:`Use when your CSV includes a publish date column.

`+p},content_writing_gsheets:{label:"Use Dates from Sheets",tooltip:`Use when your Google Sheets includes a publish date column.

`+p}},u={label:"Use Dates from Input",tooltip:`Use when your input includes a publish date.

`+p},m=()=>{if(!a)return;let E=_[a.value]||u;s&&(s.textContent=E.label),t&&t.setAttribute("data-tooltip",E.tooltip)},k=a&&l.has(a.value);if(c&&(m(),c.style.display=k?"inline-flex":"none",!k)){let E=c.querySelector('input[name="schedule_mode"][value="from_input"]');if(E&&E.checked){let y=n.querySelector('input[name="schedule_mode"][value="immediate"]');y&&(y.checked=!0,y.dispatchEvent(new Event("change",{bubbles:!0})))}}a&&!a.dataset.fromInputCopyListener&&(a.addEventListener("change",()=>{m()}),a.dataset.fromInputCopyListener="true"),n.querySelectorAll('input[name="schedule_mode"]').forEach(E=>{E.dataset.listenerAttached||(E.addEventListener("change",function(){let y=a&&l.has(a.value);i&&(i.style.display=this.value==="smart"?"block":"none")}),E.dataset.listenerAttached="true")});let w=n.querySelector('input[name="schedule_mode"]:checked');w&&i&&(i.style.display=w.value==="smart"?"block":"none")}window.aipkit_toggleTaskCwScheduleFields=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||(d=>d);function o(d){if(!d)return;let a=d.querySelector(".aipkit_task_cw_vector_store_toggle"),l=d.querySelectorAll(".aipkit_task_cw_vector_store_settings_container");if(!a||!l.length)return;let p=a.checked;l.forEach(_=>{_.style.display=p?"block":"none"}),p&&r(d)}function r(d){if(!d)return;let a=d.querySelector(".aipkit_task_cw_vector_store_provider_select");if(!a)return;let l=a.value,p=d.querySelector(".aipkit_task_cw_vector_openai_field"),_=d.querySelector(".aipkit_task_cw_vector_pinecone_field"),u=d.querySelector(".aipkit_task_cw_vector_qdrant_field"),m=d.querySelector(".aipkit_task_cw_vector_embedding_config_row"),k=(f,w)=>{f&&(f.style.display=w?"block":"none")};if(k(p,l==="openai"),k(_,l==="pinecone"),k(u,l==="qdrant"),m){let f=l==="pinecone"||l==="qdrant";m.style.display=f?"block":"none",f&&n(d)}}function n(d){let a=d.querySelector("#aipkit_task_cw_vector_embedding_model");if(!a)return;let l=d.querySelector("#aipkit_task_cw_vector_embedding_provider"),p=l?l.value:"openai",_=window.aipkit_automated_tasks_config||{},u=window.aipkit_automated_tasks_form_state||{},m=[];if(p==="google"?m=_.google_embedding_models||[]:p==="azure"?m=_.azure_embedding_models||[]:m=_.openai_embedding_models||[],a.innerHTML="",m.length>0){a.add(new Option("-- Select Model --","")),m.forEach(f=>{a.add(new Option(g(f.name||f.id),f.id))}),a.disabled=!1;let k=u.pendingEmbeddingModelSelection;k&&Array.from(a.options).find(w=>w.value===k)&&(a.value=k,u.pendingEmbeddingModelSelection=null)}else a.add(new Option("No models found","")),a.disabled=!0}function e(d){if(!d)return;let a=d.getAttribute("aria-expanded")==="true",l=d.getAttribute("aria-controls"),p=document.getElementById(l);p&&(d.setAttribute("aria-expanded",(!a).toString()),p.setAttribute("aria-hidden",a?"true":"false"))}function i(d){if(!d)return;let a=document.getElementById(d.id+"_value");a&&(a.textContent=d.value)}function c(d){d&&(d.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(a=>{a.querySelector(".aipkit_task_cw_vector_store_toggle")&&(o(a),a.querySelectorAll(".aipkit_vector_slider").forEach(l=>{i(l)}))}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(d))}function s(){let d=document.getElementById("aipkit_autogpt_container");!d||d.dataset.kbListenerAttached==="true"||(d.addEventListener("change",a=>{let l=a.target;if(l.matches(".aipkit_task_cw_vector_store_toggle")){let p=l.closest(".aipkit_vector_settings_redesigned");o(p)}else if(l.matches(".aipkit_task_cw_vector_store_provider_select")){let p=l.closest(".aipkit_vector_settings_redesigned");r(p)}else if(l.matches(".aipkit_task_cw_vector_embedding_provider_select")){let p=l.closest(".aipkit_vector_settings_redesigned");n(p)}}),d.addEventListener("input",a=>{let l=a.target;l.matches(".aipkit_vector_slider")&&i(l)}),d.addEventListener("click",a=>{let l=a.target.closest(".aipkit_vector_settings_chunk_header--collapsible");if(!l)return;let p=l.closest(".aipkit_vector_settings_redesigned");!p||!p.querySelector(".aipkit_task_cw_vector_store_toggle")||(a.preventDefault(),e(l))}),c(d),d.dataset.kbListenerAttached="true")}function t(){let d=document.getElementById("aipkit_autogpt_container");d&&(s(),d.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(a=>{a.querySelector(".aipkit_task_cw_vector_store_toggle")&&(o(a),r(a),n(a))}))}window.aipkit_initCwKnowledgeBaseUI=s,window.aipkit_cw_task_populateEmbeddingModelSelect=n,window.aipkit_updateCwKnowledgeBaseUI=t})();(function(){"use strict";function g(){let n=document.getElementById("aipkit_automated_task_form");if(!n){console.warn("Content Writing UI Init: Could not find main form element.");return}let e=n.querySelector("#aipkit_task_cw_ai_provider"),i=n.querySelector("#aipkit_task_cw_ai_model");e&&i&&typeof window.aipkit_task_cw_populateModels=="function"&&(e.dataset.cwProviderListenerAttached||(e.addEventListener("change",()=>window.aipkit_task_cw_populateModels(e,i)),e.dataset.cwProviderListenerAttached="true"),i.dataset.cwModelListenerAttached||(i.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),i.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(e,i),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let c=n.querySelector("#aipkit_task_cw_ai_temperature");c&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(c);let s=n.querySelector("#aipkit_task_cw_post_status");s&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(s.dataset.cwStatusListenerAttached||(s.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),s.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:s})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect(n),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initTaskRssInputHandler=="function"?window.aipkit_initTaskRssInputHandler():typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let d=n.querySelector(".aipkit_task_cw_image_enable_toggle");d&&(d.dataset.cwImgListenerAttached||(d.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),d.dataset.cwImgListenerAttached="true"));let a=n.querySelector("#aipkit_task_cw_image_provider");a&&(a.dataset.cwImgListenerAttached||(a.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),a.dataset.cwImgListenerAttached="true"));let l=n.querySelector("#aipkit_task_cw_generate_featured_image");l&&(l.dataset.cwImgListenerAttached||(l.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),l.dataset.cwImgListenerAttached="true"));let p=n.querySelector(".aipkit_task_cw_image_placement_select");p&&(p.dataset.cwImgListenerAttached||(p.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),p.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100));let _=n.querySelector(".aipkit_image_settings_redesigned");_&&_.dataset.imageChunkListenerAttached!=="true"&&(_.addEventListener("click",y=>{let I=y.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!I)return;y.preventDefault();let S=I.getAttribute("aria-expanded")==="true",h=I.getAttribute("aria-controls");if(!h)return;let M=document.getElementById(h);I.setAttribute("aria-expanded",(!S).toString()),M&&M.setAttribute("aria-hidden",S?"true":"false")}),_.dataset.imageChunkListenerAttached="true");let u=async y=>{if(!y||!y.name)return;let I=y.value.trim(),S=y.dataset.apiKeyBaseline||"";if(I===S||y.dataset.apiKeySaving==="true"||typeof window.aipkit_apiRequest!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,M=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,b=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;y.dataset.apiKeySaving="true",y.dataset.apiKeyBaseline=I,h&&h("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[y.name]:I}),M&&M("Updated")}catch(A){y.dataset.apiKeyBaseline=S,b&&b(`Error: ${A.message||"Failed to save."}`)}finally{y.dataset.apiKeySaving="false"}};n.querySelectorAll(".aipkit_task_cw_stock_api_key, #aipkit_task_cw_replicate_api_key").forEach(y=>{if(y.dataset.apiKeyListenerAttached==="true")return;y.dataset.apiKeyBaseline=y.value.trim();let I=()=>{u(y)};y.addEventListener("change",I),y.addEventListener("blur",I),y.dataset.apiKeyListenerAttached="true"}),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let k=n.querySelector("#aipkit_task_cw_ai_settings_toggle"),f=n.querySelector("#aipkit_task_cw_ai_parameters_row");k&&f&&(k.dataset.cwAiSettingsListenerAttached||(k.addEventListener("click",()=>{let y=f.style.display==="none"||f.style.display==="";f.style.display=y?"block":"none",k.classList.toggle("aipkit_active",y),k.setAttribute("aria-expanded",y)}),k.dataset.cwAiSettingsListenerAttached="true"));let w=n.querySelector("#aipkit_task_config_ai");w&&(w.dataset.cwPromptListenerAttached||(w.addEventListener("click",y=>{let I=y.target.closest(".aipkit_textarea_toggle");if(!I)return;let S=I.dataset.target,h=document.getElementById(S),M=I.querySelector(".dashicons");if(!h||!M)return;h.classList.toggle("aipkit_collapsed")?(M.classList.remove("dashicons-minus"),M.classList.add("dashicons-plus-alt2"),I.title="Expand"):(M.classList.remove("dashicons-plus-alt2"),M.classList.add("dashicons-minus"),I.title="Collapse")}),w.dataset.cwPromptListenerAttached="true"));let E=n.querySelector("#aipkit_task_config_seo");E&&(E.dataset.cwSeoPromptListenerAttached||(E.addEventListener("click",y=>{let I=y.target.closest(".aipkit_textarea_toggle");if(!I)return;let S=I.dataset.target,h=document.getElementById(S),M=I.querySelector(".dashicons");if(!h||!M)return;h.classList.toggle("aipkit_collapsed")?(M.classList.remove("dashicons-minus"),M.classList.add("dashicons-plus-alt2"),I.title="Expand"):(M.classList.remove("dashicons-plus-alt2"),M.classList.add("dashicons-minus"),I.title="Collapse")}),E.dataset.cwSeoPromptListenerAttached="true"))}function o(){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=window.aipkit_debug||!1,i=n.querySelector(".aipkit_task_cw_image_enable_toggle"),c=n.querySelector("#aipkit_task_cw_generate_featured_image"),s=n.querySelector(".aipkit_task_cw_image_settings_container"),t=n.querySelector("#aipkit_task_cw_image_provider");if(!i||!c||!s||!t)return;let d=i.checked,a=c.checked,l=d||a,p=t.value,_=p==="pexels"||p==="pixabay";if(s.style.display=l?"block":"none",l){let u=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],m=n.querySelector(".aipkit_task_cw_image_placement_select"),k=n.querySelector(".aipkit_task_cw_image_placement_x_field"),f=n.querySelector("#aipkit_task_cw_pexels_options"),w=n.querySelector("#aipkit_task_cw_pixabay_options"),E=n.querySelector("#aipkit_task_cw_replicate_options"),y=n.querySelector(".aipkit_task_cw_image_display_chunk"),I=n.querySelector("#aipkit_task_cw_image_model_group"),S=n.querySelector("#aipkit_task_cw_image_model_divider");if(u.forEach(h=>{let M=n.querySelector(h);if(M){let b=M.closest(".aipkit_form-group");b&&(b.style.display=d?"block":"none")}}),y&&(y.style.display=d?"":"none"),m&&k){let h=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(m.value);k.style.display=d&&h?"block":"none"}f&&(f.style.display=l&&_&&p==="pexels"?"block":"none"),w&&(w.style.display=l&&_&&p==="pixabay"?"block":"none"),E&&(E.style.display=l&&p==="replicate"?"block":"none"),I&&(I.style.display=l&&!_?"":"none"),S&&(S.style.display=l&&!_?"":"none"),l&&!_&&typeof r=="function"&&r(p)}}function r(n){let e=document.getElementById("aipkit_task_cw_image_model");if(!e)return;let i=e.value,s=window.aipkit_dashboard?.imageGeneratorModels?.[n.toLowerCase()]||[],t=window.aipkit_escapeHtml||function(a){return a},d=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||e.value;if(e.innerHTML="",s.length>0?(s.forEach(a=>{e.appendChild(new Option(t(a.name),a.id))}),e.querySelector(`option[value="${CSS.escape(d)}"]`)&&(e.value=d)):e.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null),typeof window.aipkit_updateAutogptAiSummaries=="function"&&e.value!==i){let a=document.getElementById("aipkit_autogpt_container");window.aipkit_updateAutogptAiSummaries(a)}}window.aipkit_initContentWritingTaskFormUI=g,window.aipkit_updateTaskImageSettingsUI=o,window.aipkit_populateTaskImageModels=r})();(function(){"use strict";function g(){let o=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!o)return;let r=o.querySelector("#aipkit_task_cc_ai_provider"),n=o.querySelector("#aipkit_task_cc_ai_model");r&&n&&typeof window.aipkit_task_cw_populateModels=="function"&&(r.dataset.ccProviderListenerAttached||(r.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(r,n),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),r.dataset.ccProviderListenerAttached="true"),n.dataset.ccModelListenerAttached||(n.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),n.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(r,n),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let e=o.querySelector("#aipkit_task_cc_ai_temperature");e&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(e);let i=o.querySelector("#aipkit_task_cc_content_max_tokens");i&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(i);let c=o.querySelector("#aipkit_task_cc_ai_settings_toggle"),s=o.querySelector("#aipkit_task_cc_ai_parameters_row");c&&s&&(c.dataset.ccAiSettingsListenerAttached||(c.addEventListener("click",()=>{let t=s.style.display==="none"||s.style.display==="";s.style.display=t?"block":"none",c.classList.toggle("aipkit_active",t),c.setAttribute("aria-expanded",t)}),c.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=g})();(function(){"use strict";function g(r){if(!r)return;let n=r.querySelectorAll("[data-aipkit-popover-target]");if(!n.length)return;let e=null,i=null,c=!1,s=p=>p?r.querySelector(`#${p}`):null,t=(p,_)=>{if(!p||!_)return;let u=p.getBoundingClientRect(),m=_.getBoundingClientRect(),k=m.width||400,f=m.height||0,w=window.innerWidth,E=window.innerHeight,y=12;if(p.dataset.aipkitPopoverPlacement==="bottom"){let h=u.left;h+k>w-y&&(h=u.right-k),h=Math.max(y,Math.min(h,w-k-y));let M=u.bottom+8;M+f>E-y&&(M=u.top-f-8),M=Math.max(y,Math.min(M,E-f-y)),_.style.left=`${Math.round(h)}px`,_.style.top=`${Math.round(M)}px`;return}if(p.dataset.aipkitPopoverPlacement==="left"){let h=u.left-k-10;h<y&&(h=u.right+10),h=Math.max(y,Math.min(h,w-k-y));let M=u.top;M+f>E-y&&(M=E-f-y),M=Math.max(y,M),_.style.left=`${Math.round(h)}px`,_.style.top=`${Math.round(M)}px`;return}let I=u.right+10;I+k>w-y&&(I=u.right-k-10),I=Math.max(y,Math.min(I,w-k-y));let S=u.top;S+f>E-y&&(S=E-f-y),S=Math.max(y,S),_.style.left=`${Math.round(I)}px`,_.style.top=`${Math.round(S)}px`},d=()=>{!i||!e||c||(c=!0,window.requestAnimationFrame(()=>{let p=e.querySelector(".aipkit_model_settings_popover_panel");t(i,p),c=!1}))},a=()=>{e&&(e.classList.remove("aipkit-active"),e.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),e=null,i=null)},l=p=>{if(!p)return;let _=p.getAttribute("data-aipkit-popover-target"),u=s(_);if(!u)return;e&&e!==u&&a(),e=u,i=p,u.classList.add("aipkit-active"),u.setAttribute("aria-hidden","false"),p.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${_}`),typeof window.aipkit_initAutogptPromptFlyouts=="function"&&window.aipkit_initAutogptPromptFlyouts(r);let m=u.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{t(p,m)})};n.forEach(p=>{p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",_=>{if(_.preventDefault(),!(p.dataset.aipkitPopoverKeepOpen==="true")&&e&&i===p&&e.classList.contains("aipkit-active")){a();return}l(p)}),p.dataset.popoverListenerAttached="true")}),r.querySelectorAll(".aipkit_model_settings_popover").forEach(p=>{p.dataset.overlayListenerAttached!=="true"&&(p.addEventListener("click",u=>{u.target===p&&a()}),p.dataset.overlayListenerAttached="true");let _=p.querySelector(".aipkit_model_settings_popover_close");_&&_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",u=>{u.preventDefault(),a()}),_.dataset.popoverListenerAttached="true"),p.querySelectorAll("[data-aipkit-popover-close]").forEach(u=>{u.dataset.popoverListenerAttached!=="true"&&(u.addEventListener("click",m=>{m.preventDefault(),a()}),u.dataset.popoverListenerAttached="true")})}),r.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",p=>{p.key==="Escape"&&e&&a()}),r.dataset.escapeListenerAttached="true"),r.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",d),window.addEventListener("scroll",d,!0),r.dataset.repositionListenersAttached="true")}function o(){let r=document.getElementById("aipkit_autogpt_container");r&&g(r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o(),window.aipkit_initAutogptPopovers=g})();(function(){"use strict";let g=t=>{if(!t)return"";let d=t.options?t.options[t.selectedIndex]:null;return d?d.textContent.trim():""},o=t=>t?Array.from(t.selectedOptions||[]).map(d=>d.textContent.trim()).filter(Boolean):[],r=(t,d)=>{let a=t.filter(Boolean);return a.length?a.join(", "):d||""},n=(t,d)=>{if(!t)return;t.textContent=d,t.title=d;let a=t.dataset.aipkitPlaceholder||"",l="active";a&&d===a&&(l="placeholder"),t.dataset.aipkitSummaryState=l},e=(t,d)=>{if(!t)return;let a=d||document,l=t.dataset.aipkitAutogptSummary||"",p=t.dataset.aipkitAutogptProvider||"",_=t.dataset.aipkitAutogptModel||"",u=_?a.querySelector(_):null,m=g(u),k=t.dataset.aipkitPlaceholder||"Select";if(l==="images"){let f=t.dataset.aipkitDisabledLabel||k,w=t.dataset.aipkitAutogptToggle||"",E=t.dataset.aipkitAutogptFeaturedToggle||"",y=w?a.querySelector(w):null,I=E?a.querySelector(E):null;if(!(y&&y.checked||I&&I.checked)){n(t,f);return}let h=p?a.querySelector(p):null,M=h?h.value:"",b=g(h);if(["pexels","pixabay"].includes(M)){n(t,b||k);return}n(t,m||b||k);return}if(l==="vector"){let f=t.dataset.aipkitDisabledLabel||k,w=t.dataset.aipkitAutogptToggle||"",E=w?a.querySelector(w):null;if(!(E?E.checked:!0)){n(t,f);return}let I=p?a.querySelector(p):null,S=I?I.value:"",h=g(I),M=t.dataset.aipkitAutogptStore||"",b=t.dataset.aipkitAutogptOpenaiStore||"",A=t.dataset.aipkitAutogptPineconeStore||"",x=t.dataset.aipkitAutogptQdrantStore||"",v="";if(S==="openai"&&b){let C=a.querySelector(b);v=o(C).join(", ")}else S==="pinecone"&&A?v=g(a.querySelector(A)):S==="qdrant"&&x?v=g(a.querySelector(x)):M&&(v=g(a.querySelector(M)));n(t,r([v,h],k));return}n(t,m||k)},i=(t,d)=>{if(!t||t.dataset.aipkitAutogptSummaryBound==="true")return;let a=d||document,l=t.dataset.aipkitAutogptProvider||"",p=t.dataset.aipkitAutogptModel||"",_=t.dataset.aipkitAutogptToggle||"",u=t.dataset.aipkitAutogptFeaturedToggle||"",m=[t.dataset.aipkitAutogptStore||"",t.dataset.aipkitAutogptOpenaiStore||"",t.dataset.aipkitAutogptPineconeStore||"",t.dataset.aipkitAutogptQdrantStore||""].filter(Boolean),k=l?a.querySelector(l):null,f=p?a.querySelector(p):null,w=_?a.querySelector(_):null,E=u?a.querySelector(u):null,y=()=>e(t,a);k&&k.addEventListener("change",y),f&&f.addEventListener("change",y),w&&w.addEventListener("change",y),E&&E.addEventListener("change",y),m.forEach(I=>{let S=a.querySelector(I);S&&S.addEventListener("change",y)}),t.dataset.aipkitAutogptSummaryBound="true",e(t,a)};function c(t){let d=t||document.getElementById("aipkit_autogpt_container");if(!d)return;d.querySelectorAll("[data-aipkit-autogpt-summary]").forEach(l=>{i(l,d),e(l,d)})}function s(){let t=document.getElementById("aipkit_autogpt_container");t&&c(t)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s(),window.aipkit_updateAutogptAiSummaries=c})();(function(){"use strict";let g={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"]},o={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},r=a=>String(a??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),n=()=>{let a=document.getElementById("aipkit_automated_task_type"),l=a?a.value:"";return l==="content_writing"?"bulk":l&&l.startsWith("content_writing_")&&l.replace("content_writing_","")||"bulk"},e=(a,l)=>{let p=g[a]||[],_=o[l]||[],u=[...p,..._];return u.filter((m,k)=>u.indexOf(m)===k)},i=(a,l)=>{if(!a)return;let p=a.dataset.label||"Variables:",_=a.dataset.copyTitle||"Click to copy";a.innerHTML=`${r(p)} `,l.forEach((u,m)=>{let k=document.createElement("code");k.className="aipkit-placeholder",k.title=_,k.textContent=u,a.appendChild(k),m<l.length-1&&a.appendChild(document.createTextNode(" "))})},c=a=>{let l=a||document.getElementById("aipkit_autogpt_container");if(!l)return;let p=n(),_=l.querySelectorAll(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");_.length&&_.forEach(u=>{let m=u.dataset.promptType||"",k=e(m,p);k.length&&i(u,k)})};function s(a){let l=a.querySelectorAll(".aipkit_cw_prompt_library_select");l.length&&l.forEach(p=>{p.dataset.promptLibraryAttached!=="true"&&(p.addEventListener("change",()=>{let _=p.getAttribute("data-aipkit-prompt-target");if(!_||!p.value)return;let u=a.querySelector(`#${_}`);u&&(u.value=p.value,u.dispatchEvent(new Event("input",{bubbles:!0})))}),p.dataset.promptLibraryAttached="true")})}function t(a){if(!a)return;let l=a.querySelectorAll("[data-aipkit-flyout-target]");if(!l.length)return;let p=null,_=null,u=!1,m=y=>y?a.querySelector(`#${y}`):null,k=(y,I,S)=>{if(!y||!I||!p)return;let h=y.getBoundingClientRect(),M=S?S.getBoundingClientRect():h,b=I.getBoundingClientRect(),A=b.width||580,x=b.height||420,v=window.innerWidth,C=window.innerHeight,P=12,$=M.left-A-10;$<P&&($=M.right+10),$=Math.max(P,Math.min($,v-A-P));let U=M.top;U+x>C-P&&(U=C-x-P),U=Math.max(P,U),p.style.left=`${Math.round($)}px`,p.style.top=`${Math.round(U)}px`},f=()=>{!p||!_||u||(u=!0,window.requestAnimationFrame(()=>{let y=p.querySelector(".aipkit_cw_prompt_panel"),I=_.closest(".aipkit_model_settings_popover_panel");k(_,y,I),u=!1}))},w=()=>{p&&(p.classList.remove("is-open"),p.setAttribute("aria-hidden","true"),_&&_.setAttribute("aria-expanded","false"),p=null,_=null)},E=y=>{let I=y.getAttribute("data-aipkit-flyout-target"),S=m(I);S&&(p&&p!==S&&w(),p=S,_=y,S.classList.add("is-open"),S.setAttribute("aria-hidden","false"),y.setAttribute("aria-expanded","true"),c(S),window.requestAnimationFrame(()=>{let h=S.querySelector(".aipkit_cw_prompt_panel"),M=y.closest(".aipkit_model_settings_popover_panel");k(y,h,M)}))};l.forEach(y=>{y.dataset.promptFlyoutListenerAttached!=="true"&&(y.addEventListener("click",I=>{if(I.preventDefault(),p&&_===y&&p.classList.contains("is-open")){w();return}E(y)}),y.dataset.promptFlyoutListenerAttached="true")}),a.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(y=>{y.dataset.overlayListenerAttached!=="true"&&(y.addEventListener("click",I=>{I.target===y&&w()}),y.dataset.overlayListenerAttached="true")}),a.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",y=>{y.key==="Escape"&&p&&w()}),a.dataset.promptFlyoutEscapeAttached="true"),a.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",y=>{if(!p)return;let I=y.target;I.closest(".aipkit_cw_prompt_flyout")||I.closest("[data-aipkit-flyout-target]")||w()}),a.dataset.promptFlyoutClickAttached="true"),a.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",f),window.addEventListener("scroll",f,!0),a.dataset.promptFlyoutRepositionAttached="true")}function d(a){let l=a||document.getElementById("aipkit_autogpt_container");l&&(s(l),t(l),c(l))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>d()):d(),window.aipkit_initAutogptPromptFlyouts=d,window.aipkit_updateAutogptPromptPlaceholders=()=>{c()}})();(function(){"use strict";function g(){let i=document.querySelector("#aipkit_task_cw_ai_provider"),c=document.querySelector("#aipkit_task_cw_ai_model"),s=document.querySelector(".aipkit_task_cw_reasoning_effort_field"),t=s?s.closest(".aipkit_ai_settings_redesigned"):null;if(!i||!c||!s){s&&(s.style.display="none");return}let d=(i.value||"").toLowerCase(),l=(c.value||"").toLowerCase(),p=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),_=l.includes("gpt-5");d==="openai"&&(p||_)?(s.style.display="block",t&&o(t,l)):s.style.display="none"}function o(i,c){let s=i.querySelector("[data-aipkit-reasoning-select]"),t=i.querySelectorAll(".aipkit_ai_reasoning_option");if(!s||!t.length)return;let d=r(c),a=new Set(d.allowed);t.forEach(u=>{let m=u.querySelector(".aipkit_ai_reasoning_input");if(!m)return;let k=m.value==="minimal"?"low":m.value,f=a.has(k);u.style.display=f?"":"none",f||(m.checked=!1)});let l=s.value||"";l==="minimal"&&(l="low"),a.has(l)||(l=d.defaultValue),a.has(l)||(l=d.allowed[0]||"");let p=s.value;l&&(s.value=l);let _=i.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(_){_.checked=!0,i.querySelectorAll(".aipkit_ai_reasoning_option").forEach(m=>m.classList.remove("aipkit_ai_reasoning_option--selected"));let u=_.closest(".aipkit_ai_reasoning_option");u&&u.classList.add("aipkit_ai_reasoning_option--selected")}p!==s.value&&s.dispatchEvent(new Event("change",{bubbles:!0}))}function r(i){return e(i)?{allowed:["high"],defaultValue:"high"}:i.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(i)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(i){let c=i.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let s=i.match(/gpt-(\d+)/);return s?Number.parseInt(s[1],10)>=6:!1}function e(i){return/gpt-5(\.\d+)?-pro/.test(i)}window.aipkit_autogpt_cw_toggleReasoningEffort=g})();(function(){"use strict";function g(){let i=document.querySelector("#aipkit_task_cc_ai_provider"),c=document.querySelector("#aipkit_task_cc_ai_model"),s=document.querySelector(".aipkit_task_cc_reasoning_effort_field"),t=s?s.closest(".aipkit_ai_settings_redesigned"):null;if(!i||!c||!s){s&&(s.style.display="none");return}let d=(i.value||"").toLowerCase(),l=(c.value||"").toLowerCase(),p=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),_=l.includes("gpt-5");d==="openai"&&(p||_)?(s.style.display="block",t&&o(t,l)):s.style.display="none"}function o(i,c){let s=i.querySelector("[data-aipkit-reasoning-select]"),t=i.querySelectorAll(".aipkit_ai_reasoning_option");if(!s||!t.length)return;let d=r(c),a=new Set(d.allowed);t.forEach(u=>{let m=u.querySelector(".aipkit_ai_reasoning_input");if(!m)return;let k=m.value==="minimal"?"low":m.value,f=a.has(k);u.style.display=f?"":"none",f||(m.checked=!1)});let l=s.value||"";l==="minimal"&&(l="low"),a.has(l)||(l=d.defaultValue),a.has(l)||(l=d.allowed[0]||"");let p=s.value;l&&(s.value=l);let _=i.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(_){_.checked=!0,i.querySelectorAll(".aipkit_ai_reasoning_option").forEach(m=>m.classList.remove("aipkit_ai_reasoning_option--selected"));let u=_.closest(".aipkit_ai_reasoning_option");u&&u.classList.add("aipkit_ai_reasoning_option--selected")}p!==s.value&&s.dispatchEvent(new Event("change",{bubbles:!0}))}function r(i){return e(i)?{allowed:["high"],defaultValue:"high"}:i.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(i)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(i){let c=i.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let s=i.match(/gpt-(\d+)/);return s?Number.parseInt(s[1],10)>=6:!1}function e(i){return/gpt-5(\.\d+)?-pro/.test(i)}window.aipkit_autogpt_cc_toggleReasoningEffort=g})();(function(){"use strict";function g(o,r){let n=document.getElementById("aipkit_save_task_btn"),e=n?n.querySelector(".aipkit_btn-text"):null,i=o.elements.task_id,c=o.elements.task_name,s=o.elements.task_type,t=o.elements.task_status,d=document.getElementById("aipkit_cancel_edit_task_btn"),l=(window.aipkit_automated_tasks_config||{}).text||{},p=document.getElementById("aipkit_autogpt_header_title_default"),_=document.getElementById("aipkit_autogpt_header_title_editor"),u=document.getElementById("aipkit_autogpt_title_display"),m=document.getElementById("aipkit_autogpt_title_text"),k=document.getElementById("aipkit_autogpt_task_title_input"),f=m&&m.dataset.defaultLabel||k&&k.placeholder||"New Task",w=()=>{let S=(k?k.value.trim():"")||f;m&&(m.textContent=S),u&&u.setAttribute("title",S),c&&(c.value=S)},E=()=>{!u||!k||(u.style.display="none",k.style.display="inline-block",k.focus(),k.select())},y=()=>{!u||!k||(k.style.display="none",u.style.display="inline-flex",w())};p&&(p.style.display="none"),_&&(_.style.display="flex"),_&&_.dataset.inlineTitleBound!=="true"&&u&&k&&(u.addEventListener("click",E),k.addEventListener("blur",y),k.addEventListener("keydown",I=>{I.key==="Enter"&&(I.preventDefault(),k.blur())}),k.addEventListener("input",w),_.dataset.inlineTitleBound="true"),r?(e&&(e.textContent=l.save_task_button||"Save Task"),i&&(i.value=r.id||""),k&&(k.value=r.task_name||f),w(),s&&(s.value=r.task_type||"content_indexing"),t&&(t.value=r.status||"active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),d&&(d.style.display="inline-flex")):(e&&(e.textContent=l.save_task_button||"Save Task"),i&&(i.value=""),k&&(k.value=f),w(),s&&(s.value="content_indexing"),t&&(t.value="active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),d&&(d.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function o(r){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=n.elements["post_types[]"];e&&(Array.from(e.options).forEach(c=>c.selected=!1),(r.post_types||[]).forEach(c=>{let s=e.querySelector(`option[value="${g(c)}"]`);s&&(s.selected=!0)}));let i=n.elements.target_store_provider;i&&(i.value=r.target_store_provider||"openai",i.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(r.target_store_provider||"openai").then(()=>{let c=n.elements.target_store_id;c&&(c.value=r.target_store_id||"")}),n.elements.index_existing_now_flag&&(n.elements.index_existing_now_flag.checked=r.index_existing_now_flag==="1"),n.elements.only_new_updated_flag&&(n.elements.only_new_updated_flag.checked=r.only_new_updated_flag==="1"),(r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&r.embedding_provider&&r.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${r.embedding_provider}:${r.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),n.elements.task_frequency&&(n.elements.task_frequency.value=r.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=o})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function o(r){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=r.cw_generation_mode||"bulk";if(e==="bulk"||e==="single"||e==="task"){let I=n.elements.content_title_bulk;I&&(I.value=r.content_title||"")}else if(e==="csv"){let I=n.elements.content_title;I&&(I.value=r.content_title||"")}else if(e==="rss"){n.elements.rss_feeds&&(n.elements.rss_feeds.value=r.rss_feeds||""),n.elements.rss_include_keywords&&(n.elements.rss_include_keywords.value=r.rss_include_keywords||""),n.elements.rss_exclude_keywords&&(n.elements.rss_exclude_keywords.value=r.rss_exclude_keywords||"");let I=n.elements.rss_feeds;I&&(typeof window.aipkit_initTaskRssInputHandler=="function"&&window.aipkit_initTaskRssInputHandler(),I.dispatchEvent(new Event("input",{bubbles:!0})))}else if(e==="url")n.elements.url_list&&(n.elements.url_list.value=r.url_list||"");else if(e==="gsheets"){let I=n.elements.gsheets_credentials;if(I){let S=r.gsheets_credentials,h=I.closest(".aipkit_gsheets_section_container");typeof S=="object"&&S!==null?I.value=JSON.stringify(S,null,2):I.value=S||"",I.value?(I.dataset.filename="credentials.json",h&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(h),100)):(delete I.dataset.filename,h&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(h,"clear"))}n.elements.gsheets_sheet_id&&(n.elements.gsheets_sheet_id.value=r.gsheets_sheet_id||"")}n.elements.custom_title_prompt&&(n.elements.custom_title_prompt.value=r.custom_title_prompt||""),n.elements.custom_content_prompt&&(n.elements.custom_content_prompt.value=r.custom_content_prompt||"");let i=document.getElementById("aipkit_task_cw_ai_provider"),c=document.getElementById("aipkit_task_cw_ai_model");i&&(i.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",r.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&c&&window.aipkit_task_cw_populateModels(i,c));let s=document.getElementById("aipkit_task_cw_ai_temperature");if(s){s.value=r.ai_temperature||"1.0";let I=document.getElementById("aipkit_task_cw_ai_temperature_value");I&&(I.textContent=s.value)}let t=document.getElementById("aipkit_task_cw_content_length");t&&(t.value=r.content_length||"medium",t.dispatchEvent(new Event("change",{bubbles:!0})));let d=n.elements.reasoning_effort;if(d){let I=r.reasoning_effort||"";I&&(d.value=I==="minimal"?"low":I,d.dispatchEvent(new Event("change",{bubbles:!0})))}c&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>c.dispatchEvent(new Event("change",{bubbles:!0})),100),n.elements.generate_meta_description&&(n.elements.generate_meta_description.checked=r.generate_meta_description==="1"),n.elements.custom_meta_prompt&&(n.elements.custom_meta_prompt.value=r.custom_meta_prompt||""),n.elements.generate_focus_keyword&&(n.elements.generate_focus_keyword.checked=r.generate_focus_keyword==="1"),n.elements.custom_keyword_prompt&&(n.elements.custom_keyword_prompt.value=r.custom_keyword_prompt||""),n.elements.generate_excerpt&&(n.elements.generate_excerpt.checked=r.generate_excerpt==="1"),n.elements.custom_excerpt_prompt&&(n.elements.custom_excerpt_prompt.value=r.custom_excerpt_prompt||""),n.elements.generate_tags&&(n.elements.generate_tags.checked=r.generate_tags==="1"),n.elements.custom_tags_prompt&&(n.elements.custom_tags_prompt.value=r.custom_tags_prompt||""),n.elements.generate_toc&&(n.elements.generate_toc.checked=r.generate_toc==="1"),n.elements.generate_seo_slug&&(n.elements.generate_seo_slug.checked=r.generate_seo_slug==="1"),n.elements.post_type&&(n.elements.post_type.value=r.post_type||"post");let a=n.elements.post_author;a&&(a.value=r.post_author||window.aipkit_dashboard?.currentUserId||"1");let l=document.getElementById("aipkit_task_cw_post_status");l&&(l.value=r.post_status||"draft");let p=r.schedule_mode||"immediate",_=n.querySelector(`input[name="schedule_mode"][value="${p}"]`);_&&(_.checked=!0),n.elements.smart_schedule_start_datetime&&(n.elements.smart_schedule_start_datetime.value=r.smart_schedule_start_datetime||""),n.elements.smart_schedule_interval_value&&(n.elements.smart_schedule_interval_value.value=r.smart_schedule_interval_value||"1"),n.elements.smart_schedule_interval_unit&&(n.elements.smart_schedule_interval_unit.value=r.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:l});let u=document.getElementById("aipkit_task_cw_post_categories");u&&u.options&&(Array.from(u.options).forEach(S=>S.selected=!1),(Array.isArray(r.post_categories)?r.post_categories.map(String):[]).forEach(S=>{let h=u.querySelector(`option[value="${g(S)}"]`);h&&(h.selected=!0)}),u.dispatchEvent(new Event("change",{bubbles:!0}))),n.elements.generate_images_enabled&&(n.elements.generate_images_enabled.checked=r.generate_images_enabled==="1"),n.elements.image_provider&&(n.elements.image_provider.value=(r.image_provider||"openai").toLowerCase()),n.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=r.image_model),n.elements.image_prompt&&(n.elements.image_prompt.value=r.image_prompt||""),n.elements.image_count&&(n.elements.image_count.value=r.image_count||"1"),n.elements.image_placement&&(n.elements.image_placement.value=r.image_placement||"after_first_h2"),n.elements.image_placement_param_x&&(n.elements.image_placement_param_x.value=r.image_placement_param_x||"2"),n.elements.image_size&&(n.elements.image_size.value=r.image_size||"large"),n.elements.image_alignment&&(n.elements.image_alignment.value=r.image_alignment||"none"),n.elements.generate_featured_image&&(n.elements.generate_featured_image.checked=r.generate_featured_image==="1"),n.elements.featured_image_prompt&&(n.elements.featured_image_prompt.value=r.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let m=n.querySelector('input[name="enable_vector_store"]');m&&(m.checked=r.enable_vector_store==="1",m.dispatchEvent(new Event("change",{bubbles:!0})));let k=n.querySelector("#aipkit_task_cw_vector_store_provider");k&&(k.value=r.vector_store_provider||"openai",k.dispatchEvent(new Event("change",{bubbles:!0})));let f=n.querySelector("#aipkit_task_cw_vector_store_top_k");if(f){f.value=r.vector_store_top_k||"3";let I=n.querySelector("#aipkit_task_cw_vector_store_top_k_value");I&&(I.textContent=f.value)}let w=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(w&&w.options){let I=Array.isArray(r.openai_vector_store_ids)?r.openai_vector_store_ids.map(String):[];Array.from(w.options).forEach(S=>{S.selected=I.includes(S.value)}),w.dispatchEvent(new Event("change",{bubbles:!0}))}let E=document.getElementById("aipkit_task_cw_pinecone_index_name");E&&(E.value=r.pinecone_index_name||"");let y=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(y&&(y.value=r.qdrant_collection_name||""),r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant"){let I=document.getElementById("aipkit_task_cw_vector_embedding_provider");I&&(I.value=r.vector_embedding_provider||"openai",I.dispatchEvent(new Event("change",{bubbles:!0})))}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),r.vector_store_provider&&(r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant")&&r.vector_embedding_model&&setTimeout(()=>{window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=r.vector_embedding_model);let I=n.querySelector("#aipkit_autogpt_cw_vector_settings_popover")||n;I&&typeof window.aipkit_cw_task_populateEmbeddingModelSelect=="function"&&window.aipkit_cw_task_populateEmbeddingModelSelect(I)},150),n.elements.task_frequency&&(n.elements.task_frequency.value=r.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=o})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_automated_task_form");if(!r)return;let n=document.getElementById("aipkit_task_cc_ai_provider"),e=document.getElementById("aipkit_task_cc_ai_model");n&&e&&(n.value=o.ai_provider?o.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&o.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=o.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(n,e));let i=document.getElementById("aipkit_task_cc_ai_temperature");if(i){i.value=o.ai_temperature||1;let u=document.getElementById(i.id+"_value");u&&(u.textContent=i.value)}let c=document.getElementById("aipkit_task_cc_content_max_tokens");if(c){c.value=o.content_max_tokens||4e3;let u=document.getElementById(c.id+"_value");u&&(u.textContent=c.value),c.dispatchEvent(new Event("change",{bubbles:!0}))}let s=r.elements.cc_reasoning_effort;if(s){let u=o.reasoning_effort||"";u&&(s.value=u==="minimal"?"low":u,s.dispatchEvent(new Event("change",{bubbles:!0})))}e&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>e.dispatchEvent(new Event("change",{bubbles:!0})),100);let t=document.getElementById("aipkit_task_cc_custom_content_prompt");t&&(t.value=o.custom_content_prompt||"");let d=document.getElementById("aipkit_task_comment_reply_include_keywords");d&&(d.value=o.include_keywords||"");let a=document.getElementById("aipkit_task_comment_reply_exclude_keywords");a&&(a.value=o.exclude_keywords||"");let l=r.elements["post_types_for_comments[]"];l&&(Array.from(l.options).forEach(u=>u.selected=!1),(o.post_types_for_comments||[]).forEach(u=>{let m=l.querySelector(`option[value="${u}"]`);m&&(m.selected=!0)}));let p=r.elements.reply_action;p&&(p.value=o.reply_action||"approve");let _=r.elements.no_reply_to_replies;_&&(_.checked=o.no_reply_to_replies==="1"),r.elements.task_frequency&&(r.elements.task_frequency.value=o.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_automated_tasks_config||{},n=window.aipkit_dashboard||{},e=r.default_cw_prompts||{};if(!o)return;o.elements.custom_title_prompt&&(o.elements.custom_title_prompt.value=e.title||""),o.elements.custom_content_prompt&&(o.elements.custom_content_prompt.value=e.content||""),o.elements.custom_meta_prompt&&(o.elements.custom_meta_prompt.value=e.meta||""),o.elements.custom_keyword_prompt&&(o.elements.custom_keyword_prompt.value=e.keyword||""),o.elements.image_prompt&&(o.elements.image_prompt.value=e.image||""),o.elements.featured_image_prompt&&(o.elements.featured_image_prompt.value=e.featured_image||"");let i=document.getElementById("aipkit_task_cw_ai_provider"),c=document.getElementById("aipkit_task_cw_ai_model");if(i&&c){let t=(n.main_provider||"openai").toLowerCase();if(i.value=t,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(i,c);let d="",a=n?.models?.[t];switch(t){case"openai":d="gpt-4.1-mini";break;case"google":d="gemini-1.5-flash-latest";break;case"openrouter":d="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":case"ollama":Array.isArray(a)&&a.length>0&&(d=a[0].id||"");break}c.querySelector(`option[value="${CSS.escape(d)}"]`)?c.value=d:console.warn(`Default model ${d} not found for provider ${t}.`)}}let s=document.getElementById("aipkit_task_cw_content_length");s&&(s.value="medium",s.dispatchEvent(new Event("change",{bubbles:!0}))),o.elements.generate_images_enabled&&(o.elements.generate_images_enabled.checked=!1),o.elements.image_provider&&(o.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{o.elements.image_model&&(o.elements.image_model.value="gpt-image-1")},0)),o.elements.image_count&&(o.elements.image_count.value="1"),o.elements.image_placement&&(o.elements.image_placement.value="after_first_h2"),o.elements.generate_featured_image&&(o.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_dashboard||{};if(!o)return;let n=document.getElementById("aipkit_task_cc_custom_content_prompt");n&&(n.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let e=document.getElementById("aipkit_task_cc_ai_provider"),i=document.getElementById("aipkit_task_cc_ai_model");if(e&&i){let s=(r.main_provider||"openai").toLowerCase();if(e.value=s,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(e,i);let t="",d=(r.models||{})[s]||{};switch(s){case"openai":t="gpt-4o-mini";break;case"google":t="gemini-1.5-flash-latest";break;case"openrouter":t="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":case"ollama":Array.isArray(d)&&d.length>0&&(t=d[0].id||"");break}i.querySelector(`option[value="${CSS.escape(t)}"]`)&&(i.value=t)}}let c=document.getElementById("aipkit_task_cc_content_max_tokens");c&&(c.value="4000",c.dispatchEvent(new Event("change",{bubbles:!0})))}window.aipkit_form_setCommentReplyDefaults=g})();(function(){"use strict";function g(o,r,n,e=null){let i=document.getElementById("aipkit_automated_task_form"),c=document.getElementById("aipkit_automated_task_queue_wrapper");if(!i){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),i.reset(),i.elements.task_id&&(i.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),e){let l=((window.aipkit_automated_tasks_config||{}).task_types||{})[e.task_type];if(l){let p=i.elements.task_category;if(p){p.value=l.category;let _=new Event("change",{bubbles:!0});p.dispatchEvent(_)}}}else{let a=i.elements.task_category,l=i.elements.task_type;a&&l&&(a.value="content_creation",a.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{l.value="content_writing_bulk",l.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(i,e):console.error("Show Task Form: aipkit_form_populateCommonFields function is missing.");let s=i.elements.task_type;if(s&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:s}),e){let a=JSON.parse(e.task_config||"{}");e.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(a):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):e.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(a):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):e.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(a):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):e.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(a):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}o&&(o.style.display="block"),r&&(r.style.display="none"),c&&(c.style.display="none"),n&&(n.style.display="none");let t=document.getElementById("aipkit_autogpt_editor_actions");t&&(t.style.display="flex");let d=document.getElementById("aipkit_autogpt_cron_info");d&&(d.style.display="none"),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers()}window.aipkit_form_showAutomatedTaskForm=g})();(function(){"use strict";function g(o,r,n){let e=document.getElementById("aipkit_automated_task_queue_wrapper");o&&(o.style.display="none"),r&&(r.style.display="block"),e&&(e.style.display="block"),n&&(n.style.display="inline-flex");let i=document.getElementById("aipkit_autogpt_editor_actions");i&&(i.style.display="none");let c=document.getElementById("aipkit_autogpt_cron_info");c&&(c.style.display="inline-flex");let s=document.getElementById("aipkit_automated_task_form"),t=document.getElementById("aipkit_automated_task_id"),d=document.getElementById("aipkit_automated_task_category"),a=document.getElementById("aipkit_autogpt_header_title_default"),l=document.getElementById("aipkit_autogpt_header_title_editor"),p=document.getElementById("aipkit_autogpt_title_display"),_=document.getElementById("aipkit_autogpt_task_title_input");s&&s.reset(),t&&(t.value=""),a&&(a.style.display="block"),l&&(l.style.display="none"),p&&(p.style.display="inline-flex"),_&&(_.style.display="none"),d&&(d.value="",d.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=g})();(function(){"use strict";let g=()=>{typeof window.aipkit_updateAutogptPromptPlaceholders=="function"&&window.aipkit_updateAutogptPromptPlaceholders()};function o(i,c,s,t){if(!i||!c)return;i.innerHTML="";let d={content_writing_bulk:{icon:"dashicons-edit"},content_writing_csv:{icon:"dashicons-media-spreadsheet"},content_writing_rss:{icon:"dashicons-rss"},content_writing_url:{icon:"dashicons-admin-links"},content_writing_gsheets:{icon:"dashicons-analytics"}};s.forEach(([a,l])=>{let p=document.createElement("label");p.className="aipkit_cw_mode_card aipkit_autogpt_task_type_card",p.classList.toggle("is-active",a===t);let _=document.createElement("input");_.type="radio",_.name="aipkit_task_type_radio",_.value=a,_.checked=a===t,_.disabled=!!l.disabled,_.className="aipkit_task_type_input",_.addEventListener("change",()=>{_.checked&&(c.value=a,c.dispatchEvent(new Event("change",{bubbles:!0})),i.querySelectorAll(".aipkit_cw_mode_card").forEach(w=>w.classList.remove("is-active")),p.classList.add("is-active"))});let u=d[a]||{},m=document.createElement("span");m.className="aipkit_cw_mode_icon",m.innerHTML=`<span class="dashicons ${u.icon||"dashicons-admin-generic"}"></span>`;let k=document.createElement("span");k.className="aipkit_cw_mode_text";let f=document.createElement("span");f.className="aipkit_cw_mode_title",f.textContent=l.label,k.appendChild(f),l.disabled&&(p.classList.add("is-disabled"),p.setAttribute("aria-disabled","true")),p.appendChild(_),p.appendChild(m),p.appendChild(k),i.appendChild(p)})}function r(i,c){i&&i.querySelectorAll('input[name="aipkit_task_type_radio"]').forEach(s=>{let t=s.value===c;s.checked=t;let d=s.closest(".aipkit_cw_mode_card");d&&d.classList.toggle("is-active",t)})}function n(i){let c=i.target.value,s=document.querySelector(".aipkit_autogpt_form_right"),t=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;if(s){let E=!t&&c==="content_enhancement";s.style.display=E?"none":""}let d=document.getElementById("aipkit_automated_task_type"),a=document.getElementById("aipkit_automated_task_type_group"),l=document.getElementById("aipkit_automated_task_type_radios"),p=(window.aipkit_automated_tasks_config||{}).task_types||{},_=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),u=_.lastTaskTypeByCategory||{};_.lastTaskTypeByCategory=u;let m=window.aipkit_escapeHtml||function(E){return E};d.innerHTML="",d.disabled=!0,a&&(a.style.display="none"),l&&(l.innerHTML="");let k=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(k&&k.querySelectorAll(".aipkit_task_config_section").forEach(E=>{E.id==="aipkit_task_cw_input_modes_wrapper"&&E.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(y=>{y.style.display="none"}),E.style.display="none"}),!c){d.appendChild(new Option(m("-- Select a category first --"),"")),d.dispatchEvent(new Event("change",{bubbles:!0}));return}let f=Object.entries(p).filter(([E,y])=>y.category===c);if(f.length===0)d.appendChild(new Option(m("-- No tasks in this category --"),""));else if(f.length===1){let[E,y]=f[0],I=new Option(m(y.label),E);y.disabled&&(I.disabled=!0),d.appendChild(I),d.value=E,d.disabled=!0,a&&(a.style.display="none")}else d.appendChild(new Option(m("-- Select a Task Type --"),"")),f.forEach(([E,y])=>{let I=new Option(m(y.label),E);y.disabled&&(I.disabled=!0),d.appendChild(I)}),d.disabled=!1;if(f.length>1){let E=u[c];!E&&c==="content_creation"&&(E="content_writing_bulk"),!E&&f.length>0&&d.options.length&&(E=f[0][0]),E&&(d.value=E)}let w=!!l&&f.length>1&&c==="content_creation";a&&(a.style.display=w?"":"none"),l&&(w?o(l,d,f,d.value):l.innerHTML=""),d.dispatchEvent(new Event("change",{bubbles:!0}))}function e(i){let c=i.target.value,s=document.getElementById("aipkit_automated_task_type_radios");r(s,c);let t=document.getElementById("aipkit_automated_task_id"),d=!t||!t.value,a=document.getElementById("aipkit_wizard_next_btn"),l=a?a.querySelector(".aipkit_btn-text"):null,p=document.getElementById("aipkit_save_task_btn"),_=p?p.querySelector(".aipkit_btn-text"):null,u=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,k=((window.aipkit_automated_tasks_config||{}).task_types||{})[c],f=k&&k.pro===!0,w=(window.aipkit_automated_tasks_config||{}).text||{};if(k){let x=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),v=x.lastTaskTypeByCategory||{};v[k.category]=c,x.lastTaskTypeByCategory=v}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(c):console.error("Task Type Change: aipkit_renderWizard function is missing.");let E=document.querySelector(".aipkit_task_schedule_frequency"),y=document.getElementById("aipkit_automated_task_frequency");if(E&&y){let x=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={});c==="content_writing_bulk"||c==="content_writing_csv"?(!x.lastVisibleFrequency&&y.value&&(x.lastVisibleFrequency=y.value),y.value="one-time",E.style.display="none"):(E.style.display="",x.lastVisibleFrequency&&y.value==="one-time"&&(y.value=x.lastVisibleFrequency),x.lastVisibleFrequency=y.value)}let I=document.querySelectorAll("[data-aipkit-task-publishing]");if(I.length){let x=c&&c.startsWith("content_writing");I.forEach(v=>{v.style.display=x?"":"none"})}f&&!u?(l&&a&&(a.dataset.action="next",l.textContent=w.wizard_next_button||"Next",a.style.display="none"),_&&p&&(p.dataset.action="save",_.textContent=w.save_task_button||"Save Task",p.style.display="none")):(l&&a&&(a.dataset.action="next",l.textContent=w.wizard_next_button||"Next",a.style.display=""),_&&p&&(p.dataset.action="save",_.textContent=w.save_task_button||"Save Task",p.style.display=""));let S=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!S){console.error("Task Type Change: Could not find setup pane.");return}let h=S.querySelector("#aipkit_task_ci_source_wrapper"),M=S.querySelector("#aipkit_task_cw_input_modes_wrapper"),b=S.querySelector("#aipkit_task_cc_source_wrapper"),A=S.querySelector("#aipkit_task_ce_content_selection_wrapper");if(h&&(h.style.display="none"),M&&(M.style.display="none"),b&&(b.style.display="none"),A&&(A.style.display="none"),!!c){if(c==="content_indexing")h&&(h.style.display="block");else if(c.startsWith("content_writing")){if(g(),M){M.style.display="block";let x=c.replace("content_writing_",""),v=x==="content_writing"?"bulk":x,C=document.getElementById("aipkit_task_cw_generation_mode");C&&(C.value=v),M.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(P=>{P.id===`aipkit_task_cw_input_mode_${v}`?P.style.display="block":P.style.display="none"})}}else if(c==="community_reply_comments")b&&(b.style.display="block");else if(c==="enhance_existing_content"){A&&(A.style.display="block");let x=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),v=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(x&&v){let C=x.querySelector("#aipkit_task_ce_post_types");if(C&&!C.dataset.placeholderListenerAttached){let P=()=>{let U=Array.from(C.selectedOptions).map(D=>D.value).includes("product");v.querySelectorAll(".aipkit-product-placeholders").forEach(D=>{D.style.display=U?"inline":"none"})};C.addEventListener("change",P),C.dataset.placeholderListenerAttached="true",P()}}}d&&(c.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():c==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():c==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),c==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():c.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():c==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():c==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=n,window.aipkit_form_handleTaskTypeChange=e})();(function(){"use strict";function g(o,r="info"){let n=document.getElementById("aipkit_automated_task_form_status");if(!n)return;let e=n.classList.contains("aipkit_training_status");if(!o){n.textContent="",e?n.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):n.className="aipkit_form-help";return}if(n.textContent=o,e){let i=r==="info"?"loading":r;n.classList.remove("is-success","is-error","is-warning","is-loading"),n.classList.add("is-visible"),i&&n.classList.add(`is-${i}`)}else n.className=`aipkit_form-help aipkit_settings_message-${r}`;setTimeout(()=>{n.textContent===o&&(n.textContent="",e?n.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):n.className="aipkit_form-help")},5e3)}window.aipkit_form_showAutomatedTaskFormStatus=g})();(function(){"use strict";function g(o){let r=new FormData(o),n=Object.fromEntries(r.entries());return n.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:r,data:n}}window.aipkit_save_task_extractBaseData=g})();(function(){"use strict";function g(o,r){if(o.task_type==="content_indexing"){if(o.post_types=r.getAll("post_types[]"),o.target_store_provider=r.get("target_store_provider")||"openai",o.target_store_id=r.get("target_store_id")||"",o.target_store_provider==="pinecone"||o.target_store_provider==="qdrant"){let e=r.get("embedding_model")||"";if(e&&e.includes(":")){let[i,c]=e.split(":",2);o.embedding_provider=i,o.embedding_model=c}else o.embedding_provider="",o.embedding_model=e}else delete o.embedding_provider,delete o.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete o[e])}else delete o.post_types,delete o["post_types[]"],delete o.target_store_provider,delete o.target_store_id,delete o.index_existing_now_flag,delete o.only_new_updated_flag,delete o.embedding_model,delete o.embedding_provider;return o}window.aipkit_save_task_handleContentIndexing=g})();(function(){"use strict";function g(o,r){return o.task_type.startsWith("content_writing")?(o.post_categories=r.getAll("post_categories[]"),o.openai_vector_store_ids=r.getAll("openai_vector_store_ids[]"),delete o["post_categories[]"],delete o["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete o[e]),delete o.replicate_api_key,delete o.pexels_api_key,delete o.pixabay_api_key):(delete o.content_title,delete o.content_title_bulk,delete o.content_keywords,delete o.content_length,delete o.ai_temperature,delete o.post_type,delete o.post_author,delete o.post_status,delete o["post_categories[]"],delete o.post_categories,delete o.prompt_mode,delete o.custom_title_prompt,delete o.custom_content_prompt,delete o.generate_meta_description,delete o.custom_meta_prompt,delete o.generate_focus_keyword,delete o.custom_keyword_prompt,delete o.cw_generation_mode,delete o.rss_feeds,delete o.gsheets_sheet_id,delete o.gsheets_credentials,delete o.url_list,delete o.generate_toc,delete o.generate_images_enabled,delete o.image_provider,delete o.image_model,delete o.image_prompt,delete o.image_count,delete o.image_placement,delete o.image_placement_param_x,delete o.image_alignment,delete o.image_size,delete o.generate_featured_image,delete o.featured_image_prompt,delete o.pexels_orientation,delete o.pexels_size,delete o.pexels_color,delete o.pexels_api_key,delete o.pixabay_orientation,delete o.pixabay_image_type,delete o.pixabay_category,delete o.pixabay_api_key,delete o.replicate_api_key,delete o.enable_vector_store,delete o.vector_store_provider,delete o["openai_vector_store_ids[]"],delete o.openai_vector_store_ids,delete o.pinecone_index_name,delete o.qdrant_collection_name,delete o.vector_embedding_provider,delete o.vector_embedding_model,delete o.vector_store_top_k,delete o.rss_include_keywords,delete o.rss_exclude_keywords),o}window.aipkit_save_task_handleContentWriting=g})();(function(){"use strict";function g(o){let n=(window.aipkit_automated_tasks_config||{}).text||{};if(!o.task_name)return n.task_name_required||"Task name is required.";if(!o.task_category)return n.task_category_required||"Task category is required.";if(!o.task_type)return n.task_type_required||"Task type is required.";if(o.task_type==="content_indexing"){if(!o.target_store_id)return n.target_store_required||"A target vector store/index must be selected.";if(!o.post_types||o.post_types.length===0)return n.content_type_required||"Please select content types for indexing.";if(o.target_store_provider==="pinecone"||o.target_store_provider==="qdrant"){if(!o.embedding_provider)return n.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!o.embedding_model)return n.embedding_model_required||"Embedding model is required for this vector provider."}}if(o.task_type.startsWith("content_writing")){let e=o.cw_generation_mode||"bulk";if(e==="bulk"){if(!o.content_title_bulk?.trim())return n.content_title_required_cw_task||"At least one topic is required for Bulk mode."}else if(e==="csv"){if(!o.content_title?.trim())return n.csv_required_cw_task||"Please upload a CSV file."}else{if(e==="rss"&&!o.rss_feeds?.trim())return n.rss_required_cw_task||"Please add at least one RSS feed.";if(e==="url"&&!o.url_list?.trim())return n.url_required_cw_task||"Please add at least one URL.";if(e==="gsheets"){if(!o.gsheets_sheet_id?.trim())return n.gsheets_id_required_cw_task||"Please add a Google Sheet ID.";if(!o.gsheets_credentials?.trim())return n.gsheets_credentials_required_cw_task||"Please add Google Sheets credentials."}else if(e==="single"&&!o.content_title?.trim())return n.content_title_required_cw_task||"Please add a topic."}if(!o.custom_content_prompt?.trim())return"The Content Prompt cannot be empty.";if(!o.ai_provider||!o.ai_model)return n.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}if(o.task_type==="enhance_existing_content"){if(!o.post_types||o.post_types.length===0)return"Please select at least one post type to update.";if(o.update_title!=="1"&&o.update_excerpt!=="1"&&o.update_content!=="1"&&o.update_meta!=="1")return"Please select at least one field to update (Title, Excerpt, Content, or Meta Description)."}return!0}window.aipkit_save_task_validateData=g})();(function(){"use strict";async function g(o){let r=window.aipkit_automated_tasks_config||{},n={...o,_ajax_nonce:r.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",n)}window.aipkit_save_task_submitRequest=g})();(function(){"use strict";function g(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=g})();(function(){"use strict";async function g(o){if(o.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let r=o.target,n=document.getElementById("aipkit_save_task_btn");if(n&&n.dataset.action==="upgrade"){let c=window.aipkit_dashboard?.upgradeUrl;c?window.open(c,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let e=(window.aipkit_automated_tasks_config||{}).text||{},i=e.save_task_button||"Save Task";try{let{formData:c,data:s}=window.aipkit_save_task_extractBaseData(r),t;s.task_type==="content_indexing"?t=window.aipkit_save_task_handleContentIndexing(s,c):s.task_type.startsWith("content_writing")?t=window.aipkit_save_task_handleContentWriting(s,c):s.task_type==="enhance_existing_content"?t=window.aipkit_save_task_handleContentEnhancement(s,c):t=s;let d=window.aipkit_save_task_validateData(t);if(d!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(d,"error"),new Error("Validation failed: "+d);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!0,i,e.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(e.saving_task||"Saving task...","info");let a=await window.aipkit_save_task_submitRequest(t);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(a.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(c){console.error("Save Task Error:",c),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&c.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${c.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,i)}}window.aipkit_form_handleSaveTask=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_automated_task_form"),r=document.getElementById("aipkit_autogpt_task_status_toggle"),n=document.getElementById("aipkit_autogpt_task_status_input"),e=document.getElementById("aipkit_autogpt_task_status_label"),i=document.getElementById("aipkit_autogpt_task_status_card"),c=document.getElementById("aipkit_automated_task_category"),s=document.querySelector("[data-aipkit-autogpt-category-selector]"),t=s?Array.from(s.querySelectorAll(".aipkit_cw_mode_card")):[],d=document.getElementById("aipkit_automated_task_type"),a=document.getElementById("aipkit_cancel_edit_task_btn"),l=document.getElementById("aipkit_automated_task_form_wrapper"),p=document.getElementById("aipkit_automated_task_list_wrapper"),_=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),o&&typeof window.aipkit_form_handleSaveTask=="function"?o.addEventListener("submit",window.aipkit_form_handleSaveTask):o&&console.error("Automated Task Form Init: handleSaveTask function not found."),c&&typeof window.aipkit_form_handleCategoryChange=="function"?c.addEventListener("change",window.aipkit_form_handleCategoryChange):c&&console.error("Automated Task Form Init: handleCategoryChange function not found.");let u=k=>{t.length&&t.forEach(f=>{let w=f.dataset.category===k;f.classList.toggle("is-active",w),f.setAttribute("aria-pressed",w?"true":"false")})};c&&t.length&&(t.forEach(k=>{k.addEventListener("click",()=>{let f=k.dataset.category||"";!f||f===c.value||(c.value=f,c.dispatchEvent(new Event("change",{bubbles:!0})))})}),c.addEventListener("change",()=>{u(c.value)}),u(c.value||"")),d&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(d.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:d})):d&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),a&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?a.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(l,p,_)}):a&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI();let m=()=>{if(!r||!n||!e)return;let k=(n.value||"active")==="active";r.checked=k,e.textContent=k?"Active":"Paused",i&&(i.dataset.status=k?"active":"paused")};window.aipkit_syncTaskStatusToggle=m,r&&n&&e&&(r.dataset.statusListenerAttached||(r.addEventListener("change",()=>{n.value=r.checked?"active":"paused",m()}),r.dataset.statusListenerAttached="true"),m())}window.aipkit_form_initAutomatedTaskForm=g})();(function(){"use strict";let g=!1,o=null,r=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return g},set isSubmitting(e){g=e},get pendingModelSelection(){return o},set pendingModelSelection(e){o=e},get pendingEmbeddingModelSelection(){return r},set pendingEmbeddingModelSelection(e){r=e}};function n(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=n})();(function(){"use strict";function g(o,r){o&&(o.classList.toggle("aipkit_loading",!!r),o.disabled=!!r)}window.aipkit_setAutogptActionButtonLoading=g})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_automated_tasks_tbody"),n=window.aipkit_automated_tasks_config||{},e=n.text||{},i=window.aipkit_escapeHtml||function(a){return a},c=window.aipkit_ucfirst||function(a){return a?a.charAt(0).toUpperCase()+a.slice(1):""},s=n.frequencies||{},t=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(a=>{a.removeAttribute("data-sort-direction"),t&&a.dataset.sortBy===t.sortBy&&a.setAttribute("data-sort-direction",t.sortOrder.toLowerCase())}),!r){console.warn("Render Tasks Table: Table body not found.");return}if(r.innerHTML="",!o||o.length===0){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${e.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}o.forEach(a=>{let l=JSON.parse(a.task_config||"{}"),p=r.insertRow(),_=p.insertCell();_.textContent=i(a.task_name);let u=p.insertCell(),k=(n.task_types?.[a.task_type]||{}).label||c(a.task_type.replace(/_/g," "));u.innerHTML=`<span class="aipkit_task_type_badge" data-type="${i(a.task_type)}">${i(k)}</span>`;let f=l.indexing_frequency||l.task_frequency||"N/A",w=s[f]||c(f.replace(/_/g," "));p.insertCell().textContent=i(w);let E=p.insertCell();E.innerHTML=`<span class="aipkit_job_status_${i(a.status)}">${i(c(a.status))}</span>`;let y=p.insertCell(),I=a.last_run_time?new Date(a.last_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.never_run||"Never",S=a.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(a.next_run_time):a.next_run_time?new Date(a.next_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.not_scheduled||"Not Scheduled";y.innerHTML=`
        <div class="aipkit_task_timing">
          <div class="aipkit_task_timing_last">
            <span class="aipkit_task_timing_label">${e.last_label||"Last"}</span>
            <span class="aipkit_task_timing_value${a.last_run_time?"":" aipkit_never"}">${i(I)}</span>
          </div>
          <div class="aipkit_task_timing_next">
            <span class="aipkit_task_timing_label">${e.next_label||"Next"}</span>
            <span class="aipkit_task_timing_value">${i(S)}</span>
          </div>
        </div>
      `;let h=p.insertCell();h.className="aipkit_actions_cell",h.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="edit" data-task-id="${a.id}" title="${e.edit_button||"Edit"}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${e.edit_button||"Edit"}</span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="${a.status==="active"?"pause":"resume"}" data-task-id="${a.id}" title="${a.status==="active"?e.pause_button||"Pause":e.resume_button||"Resume"}">
            <span class="dashicons ${a.status==="active"?"dashicons-controls-pause":"dashicons-controls-play"}" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${a.status==="active"?e.pause_button||"Pause":e.resume_button||"Resume"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="run_now" data-task-id="${a.id}" ${a.status!=="active"?"disabled":""} title="${a.status!=="active"?e.task_not_active_run_title||"Task must be active to run":e.run_now_button||"Run Now"}">
            <span class="dashicons dashicons-controls-skipforward" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${e.run_now_button||"Run"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete" data-task-id="${a.id}" title="${e.delete_button||"Delete"}">
            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
          </button>
        </div>
      `})}window.aipkit_list_renderTasksTable=g})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_automated_task_list_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render List Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:i,total_pages:c,current_page:s}=o||{};if(!c||c<=1){i>0&&(r.innerHTML=`<span class="aipkit_pagination-count">${Number(i).toLocaleString()} ${Number(i)===1?e.task_singular||"task":e.task_plural||"tasks"}</span>`);return}let t=document.createElement("span");t.className="aipkit_pagination-count",t.textContent=`${Number(i).toLocaleString()} ${Number(i)===1?e.task_singular||"task":e.task_plural||"tasks"}`,r.appendChild(t);let d=document.createElement("span");d.className="aipkit_pagination-links";let a=document.createElement("button");a.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",a.innerHTML=`\xAB ${e.previous_button||"Previous"}`,a.disabled=Number(s)<=1,a.disabled||(a.dataset.page=Number(s)-1),d.appendChild(a);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`${e.page_label||"Page"} ${Number(s)} ${e.of_label||"of"} ${Number(c)}`,d.appendChild(l);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",p.innerHTML=`${e.next_button||"Next"} \xBB`,p.disabled=Number(s)>=Number(c),p.disabled||(p.dataset.page=Number(s)+1),d.appendChild(p),r.appendChild(d)}window.aipkit_list_renderListPagination=g})();(function(){"use strict";async function g(o=1){let r=document.getElementById("aipkit_automated_tasks_tbody"),n=window.aipkit_automated_tasks_list_state,e=window.aipkit_automated_tasks_config||{},i=e.text||{};if(!r){console.warn("Fetch Tasks: Table body not found.");return}r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${i.loading_tasks||"Loading tasks..."}</td></tr>`,n&&(n.page=o);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let c={page:o,search:n?n.search:"",orderby:n?n.sortBy:"created_at",order:n?n.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},s=await window.aipkit_apiRequest("aipkit_get_automated_tasks",c);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=s.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(s.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(s.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(c){console.error("Fetch Tasks Error:",c),r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${i.error_loading_tasks||"Error loading tasks:"} ${c.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=g})();(function(){"use strict";function g(o){if(!o){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),o):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=g})();(function(){"use strict";async function g(o,r){let n=window.aipkit_automated_tasks_config||{},e=n.text||{},i=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!0,e.delete_button||"Delete",e.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:r,_ajax_nonce:n.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(s){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_deleting_task||"Error deleting task:"} ${s.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,e.delete_button||"Delete")}},c=e.confirm_delete_task||"Are you sure you want to delete this task?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(c,{title:e.confirm_title||"Confirm",confirmText:e.delete_button||"Delete",cancelText:e.cancel_button||"Cancel",onConfirm:()=>{i()}});return}confirm(c)&&await i()}window.aipkit_handleDeleteTaskAction=g})();(function(){"use strict";async function g(o,r,n){let e=window.aipkit_automated_tasks_config||{},i=e.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!0):(o.classList.add("aipkit_loading"),o.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:r,status:n,_ajax_nonce:e.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${i.task_status_updated||"Task status updated to"} ${n}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${i.error_updating_status||"Error updating task status:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!1):(o.classList.remove("aipkit_loading"),o.disabled=!1)}}window.aipkit_handleToggleTaskStatusAction=g})();(function(){"use strict";async function g(o,r){let n=window.aipkit_automated_tasks_config||{},e=n.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!0):(o.classList.add("aipkit_loading"),o.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:r,_ajax_nonce:n.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(i){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_initiating_run||"Error initiating task run:"} ${i.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!1):(o.classList.remove("aipkit_loading"),o.disabled=!1)}}window.aipkit_handleRunNowTaskAction=g})();(function(){"use strict";async function g(o){let r=o.target.closest("button[data-action]");if(!r)return;let n=r.dataset.action,e=r.dataset.taskId;if(!e)return;let c=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(s=>s.id.toString()===e.toString());switch(n){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(c);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(r,e);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let s=n==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(r,e,s)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(r,e);break;default:console.warn(`Unknown task action: ${n}`);break}}window.aipkit_list_handleTaskActionClick=g})();(function(){"use strict";function g(o){let r=o.target.closest("button[data-page]");if(r&&!r.disabled){let n=parseInt(r.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(n):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=g})();(function(){"use strict";function g(o,r="info"){if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(o,r);return}let n=document.getElementById("aipkit_automated_task_form_status");n&&(n.textContent=o,n.className=`aipkit_form-help aipkit_settings_message-${r}`,setTimeout(()=>{n.textContent===o&&(n.textContent="",n.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_automated_task_list_wrapper"),r=document.getElementById("aipkit_automated_tasks_tbody"),n=document.getElementById("aipkit_add_new_task_btn"),e=document.getElementById("aipkit_automated_task_form_wrapper"),i=document.getElementById("aipkit_automated_task_list_pagination"),c=document.getElementById("aipkit_task_list_search_input"),s=o?o.querySelector(".aipkit_data-table"):null;if(n&&e&&o&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&n.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(e,o,n)}),r&&typeof window.aipkit_list_handleTaskActionClick=="function"&&r.addEventListener("click",window.aipkit_list_handleTaskActionClick),i&&typeof window.aipkit_list_handleListPaginationClick=="function"&&i.addEventListener("click",window.aipkit_list_handleListPaginationClick),c){let t;c.addEventListener("input",()=>{clearTimeout(t),t=setTimeout(()=>{let d=window.aipkit_automated_tasks_list_state;d&&(d.search=c.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}s&&s.addEventListener("click",t=>{let d=t.target.closest("th.aipkit-sortable-col");if(!d)return;let a=d.dataset.sortBy,l=window.aipkit_automated_tasks_list_state;if(!l)return;let p="DESC";l.sortBy===a&&(p=l.sortOrder==="DESC"?"ASC":"DESC"),l.sortBy=a,l.sortOrder=p,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=g})();(function(){"use strict";let g=[],o=1,r="",n="created_at",e="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...g]},set tasks(c){g=Array.isArray(c)?c:[]},get page(){return o},set page(c){o=c},get search(){return r},set search(c){r=c},get sortBy(){return n},set sortBy(c){n=c},get sortOrder(){return e},set sortOrder(c){e=c}};function i(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=i})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_automated_task_queue_tbody"),n=document.getElementById("aipkit_delete_queue_by_status_btn"),e=window.aipkit_automated_tasks_config||{},i=e.text||{},c=window.aipkit_escapeHtml||function(l){return l},s=window.aipkit_ucfirst||function(l){return l?l.charAt(0).toUpperCase()+l.slice(1):""},t=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(l=>{l.removeAttribute("data-sort-direction"),t&&l.dataset.sortBy===t.sortBy&&l.setAttribute("data-sort-direction",t.sortOrder.toLowerCase())}),!r){console.warn("Render Queue Table: Table body not found.");return}r.innerHTML="";let a=Array.isArray(o)&&o.length>0;if(n&&(n.disabled=!a,n.setAttribute("aria-disabled",a?"false":"true"),a?n.title=i.delete_filtered_title||"Delete filtered items":n.title=i.queue_empty_delete||"No queue items available to delete."),!a){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${i.queue_empty||"Task queue is currently empty."}</td></tr>`;return}o.forEach(l=>{let p=r.insertRow(),_=p.insertCell(),u=document.createElement("textarea");u.innerHTML=l.target_title||`${i.target_id_prefix||"ID:"} ${l.target_identifier}`;let m=u.value,k=l.task_type.startsWith("content_writing"),f=l.task_type==="enhance_existing_content",w=null;k&&l.status==="completed"&&l.generated_post_id?w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${l.generated_post_id}&action=edit`:f&&!isNaN(parseInt(l.target_identifier,10))&&(w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${l.target_identifier}&action=edit`),w?_.innerHTML=`<a href="${w}" target="_blank" title="${c(i.edit_generated_post_title||"View post")}">${c(m)}</a>`:_.textContent=m,p.insertCell().textContent=c(l.task_name||`${i.task_id_prefix||"Task"} ${l.task_id}`);let E=p.insertCell(),y=e.task_types&&e.task_types[l.task_type]?e.task_types[l.task_type].label:s(l.task_type.replace(/_/g," "));E.innerHTML=`<span class="aipkit_task_type_badge" data-type="${c(l.task_type)}">${c(y)}</span>`;let I=p.insertCell(),S=`<span class="aipkit_job_status_${c(l.status)}">${c(s(l.status))}`;l.status==="failed"&&l.attempts>1&&(S+=` <small>(${l.attempts}x)</small>`),S+="</span>",l.status==="failed"&&l.error_message&&(S+=`<span class="aipkit_queue_error_message" title="${c(l.error_message)}">${c(l.error_message)}</span>`),I.innerHTML=S;let h=p.insertCell();if(l.added_at){let A=new Date(l.added_at.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),x=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(l.added_at):A,v=`<div class="aipkit_queue_time_entry aipkit_queue_time_added" title="${c(A)}">${c(x)}</div>`;if(l.scheduled_gmt_time){let C=new Date(l.scheduled_gmt_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(l.scheduled_gmt_time):C;v+=`<div class="aipkit_queue_time_entry aipkit_queue_time_scheduled" title="${c(C)}">${c(i.scheduled_for_label||"\u2192")} ${c(P)}</div>`}h.innerHTML=v}else h.textContent=i.not_applicable||"\u2014";let M=p.insertCell();M.className="aipkit_actions_cell";let b='<div class="aipkit-table-actions-group">';l.status==="failed"&&(b+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="retry_queue_item" data-item-id="${l.id}" title="${i.retry_button||"Retry"}"><span class="dashicons dashicons-controls-repeat" aria-hidden="true"></span><span class="aipkit_btn_label">${i.retry_button||"Retry"}</span></button>`),b+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete_queue_item" data-item-id="${l.id}" title="${i.delete_button||"Delete"}"><span class="dashicons dashicons-trash" aria-hidden="true"></span></button>`,b+="</div>",M.innerHTML=b})}window.aipkit_queue_renderQueueTable=g})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_automated_task_queue_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render Queue Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:i,total_pages:c,current_page:s}=o||{};if(!i||i<=0)return;let t=document.createElement("span");if(t.className="aipkit_pagination-count",t.textContent=`${Number(i).toLocaleString()} ${Number(i)===1?e.item_singular||"item":e.item_plural||"items"}`,r.appendChild(t),c>1){let d=document.createElement("span");d.className="aipkit_pagination-links";let a=document.createElement("button");a.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",a.innerHTML=`\xAB ${e.previous_button||"Previous"}`,a.disabled=Number(s)<=1,a.disabled||(a.dataset.page=Number(s)-1),d.appendChild(a);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`${e.page_label||"Page"} ${Number(s)} ${e.of_label||"of"} ${Number(c)}`,d.appendChild(l);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",p.innerHTML=`${e.next_button||"Next"} \xBB`,p.disabled=Number(s)>=Number(c),p.disabled||(p.dataset.page=Number(s)+1),d.appendChild(p),r.appendChild(d)}}window.aipkit_queue_renderQueuePagination=g})();(function(){"use strict";async function g(o=1){let r=window.aipkit_automated_tasks_queue_state;r?r.page=o:console.warn("Fetch/Render Queue: Queue state object not available.");let n=document.getElementById("aipkit_automated_task_queue_tbody"),e=window.aipkit_automated_tasks_config||{},i=e.text||{};if(!n){console.warn("Fetch/Render Queue: Table body not found.");return}n.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${i.loading_queue||"Loading queue items..."}</td></tr>`;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let c={page:o,search:r?r.search:"",status_filter:r?r.status:"all",orderby:r?r.sortBy:"q.added_at",order:r?r.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},s=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",c);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(s.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(s.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(c){console.error("Fetch/Render Queue Error:",c),n.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${i.error_loading_queue||"Error loading queue:"} ${c.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=g})();(function(){"use strict";async function g(o){let r=o.target.closest("button[data-action]");if(!r)return;let n=r.dataset.action,e=r.dataset.itemId;if(!e)return;let i=window.aipkit_automated_tasks_config||{},c=i.text||{},s=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1,t=(d,a)=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(d,a);return}typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(d,a)};if(n==="delete_queue_item"){let d=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,c.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:e,_ajax_nonce:i.nonce_manage_tasks}),t(c.queue_item_deleted||"Queue item deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(s)}catch(l){t(`${c.error_deleting_queue_item||"Error deleting item:"} ${l.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,c.delete_button||"Delete")}},a=c.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(a,{title:c.confirm_title||"Confirm",confirmText:c.delete_button||"Delete",cancelText:c.cancel_button||"Cancel",onConfirm:()=>{d()}});return}if(!confirm(a))return;await d()}else if(n==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,c.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:e,_ajax_nonce:i.nonce_manage_tasks}),t(c.item_marked_retry||"Item marked for retry. Queue processing will pick it up.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(s)}catch(d){t(`${c.error_retrying_item||"Error retrying item:"} ${d.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,c.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=g})();(function(){"use strict";async function g(){let o=document.getElementById("aipkit_delete_queue_by_status_btn"),r=document.getElementById("aipkit_task_queue_status_filter");if(!o||!r){console.error("Delete by status button or filter dropdown not found.");return}let n=r.value,e=r.options[r.selectedIndex].text.toLowerCase(),i=window.aipkit_automated_tasks_config||{},c=i.text||{},s=n==="all"?c.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(c.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",e),t=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(o,!0,c.delete_button||"Delete",c.deleting_task||"Deleting..."):o.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let d=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:n,_ajax_nonce:i.nonce_manage_tasks});typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(d.message||"Queue items deleted.","success"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(d.message||"Queue items deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(d){let a=`${c.errorDeletingAllItems||"Error deleting items:"} ${d.message||"Unknown error"}`;typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(a,"error"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(a,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(o,!1,c.delete_button||"Delete"):o.disabled=!1}};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(s,{title:c.confirm_title||"Confirm",confirmText:c.delete_button||"Delete",cancelText:c.cancel_button||"Cancel",onConfirm:()=>{t()}});return}confirm(s)&&await t()}window.aipkit_handleDeleteQueueByStatus=g})();(function(){"use strict";function g(o){let r=o.target.closest("button[data-page]");if(r&&!r.disabled){let n=parseInt(r.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(n):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_automated_task_queue_tbody"),r=document.getElementById("aipkit_refresh_task_queue_btn"),n=document.getElementById("aipkit_delete_queue_by_status_btn"),e=document.getElementById("aipkit_automated_task_queue_pagination"),i=document.getElementById("aipkit_task_queue_search_input"),c=document.getElementById("aipkit_task_queue_status_filter"),s=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(r&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&r.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),n&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&n.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),i){let t;i.addEventListener("input",()=>{clearTimeout(t),t=setTimeout(()=>{let d=window.aipkit_automated_tasks_queue_state;d&&(d.search=i.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}c&&c.addEventListener("change",()=>{let t=window.aipkit_automated_tasks_queue_state;t&&(t.status=c.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),s&&s.addEventListener("click",t=>{let d=t.target.closest("th.aipkit-sortable-col");if(!d)return;let a=d.dataset.sortBy,l=window.aipkit_automated_tasks_queue_state;if(!l)return;let p="DESC";l.sortBy===a&&(p=l.sortOrder==="DESC"?"ASC":"DESC"),l.sortBy=a,l.sortOrder=p,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),o&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&o.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),e&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&e.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=g})();(function(){"use strict";let g=1,o="",r="all",n="q.added_at",e="DESC";window.aipkit_automated_tasks_queue_state={get page(){return g},set page(c){g=c},get search(){return o},set search(c){o=c},get status(){return r},set status(c){r=c},get sortBy(){return n},set sortBy(c){n=c},get sortOrder(){return e},set sortOrder(c){e=c}};function i(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=i})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_autogpt_container");if(o&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():o&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),(()=>{if(!o)return;let n=o.querySelector("#aipkit_autogpt_cron_status [data-aipkit-cron-timestamp]");if(!n)return;let e=n.dataset.aipkitCronTimestamp,i=e?parseInt(e,10):0;if(!i||Number.isNaN(i))return;let c=new Date(i*1e3),s=c.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});n.textContent=s,n.title=c.toLocaleString()})(),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(n){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",n)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(n){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",n)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(n){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",n)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(n){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",n)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.");if(typeof window.aipkit_initAutogptPopovers=="function")try{window.aipkit_initAutogptPopovers(o)}catch(n){console.error("AIPKit AutoGPT: Error initializing settings popovers:",n)}if(typeof window.aipkit_updateAutogptAiSummaries=="function")try{window.aipkit_updateAutogptAiSummaries(o)}catch(n){console.error("AIPKit AutoGPT: Error updating AI summaries:",n)}if(typeof window.aipkit_initAutogptAiSettingsRedesigned=="function")try{window.aipkit_initAutogptAiSettingsRedesigned(o)}catch(n){console.error("AIPKit AutoGPT: Error initializing AI settings UI:",n)}if(typeof window.aipkit_initAutogptPromptFlyouts=="function")try{window.aipkit_initAutogptPromptFlyouts(o)}catch(n){console.error("AIPKit AutoGPT: Error initializing prompt flyouts:",n)}typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_autogpt_container"):console.warn("AIPKit AutoGPT: aipkit_initApiKeyToggles not found.")}window.aipkit_initAutogpt=g})();(function(){"use strict";let g=null;function o(s,t="",d=0){let a=document.getElementById("aipkit_content_writer_form_status");if(!a)return;g&&(clearTimeout(g),g=null);let l="aipkit_cw_status_badge",p=(_="")=>{a.className=_?`${l} ${_}`:l};switch(p(),s){case"progress":a.textContent=t,p("aipkit_settings_message-info");break;case"info":a.textContent=t,p("aipkit_settings_message-info");break;case"success":a.textContent=t,p("aipkit_settings_message-success");break;case"error":a.textContent=t,p("aipkit_settings_message-error");break;case"clear":default:a.textContent="",p();return}d&&(g=setTimeout(()=>{a.textContent===t&&r()},d))}function r(){o("clear")}function n(s){o("progress",s)}function e(s,t=3e3){o("info",s,t)}function i(s){o("success",s,3e3)}function c(s){o("error",s)}window.aipkit_updateGeneralStatus=o,window.aipkit_clearGeneralStatus=r,window.aipkit_showProgress=n,window.aipkit_showInfo=e,window.aipkit_showSuccess=i,window.aipkit_showError=c})();(function(){"use strict";window.aipkit_cw_isAutosaving=!1,window.aipkit_cw_lastSavedData=null;function g(){let e=window.aipkit_cw_template_state,i=e?.currentTemplateId;if(!i)return null;let c="";if(Array.isArray(e?.currentTemplates)){let t=e.currentTemplates.find(d=>String(d.id)===String(i));t?.template_name&&(c=t.template_name)}if(!c){let t=document.getElementById("aipkit_cw_template_select");t?.selectedOptions?.length&&(c=t.selectedOptions[0].textContent.trim())}let s=parseInt(i,10);return!c||Number.isNaN(s)?null:{id:s,name:c}}function o(){if(typeof window.aipkit_getContentWriterFormConfig!="function")return null;let e=document.getElementById("aipkit_content_writer_form");return e?window.aipkit_getContentWriterFormConfig(e):null}async function r(){if(window.aipkit_cw_autosave_suspended||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getContentWriterFormConfig!="function"||window.aipkit_cw_isAutosaving)return;let e=window.aipkit_cw_template_state;if(e?.isSavingOrDeleting)return;let i=o();if(!i)return;let c=window.aipkit_cw_lastSavedData||{};if(JSON.stringify(i)===JSON.stringify(c))return;let s=g();if(!s)return;let t=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,d=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,a=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_isAutosaving=!0,t&&t("Saving...");try{let l=document.getElementById("aipkit_content_writer_template_nonce_field");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:s.id,template_name:s.name,template_type:"content_writer",config:JSON.stringify(i),_ajax_nonce:l?l.value:""}),window.aipkit_cw_lastSavedData=i,e&&(e.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(i)),e.currentTemplateModified=!1),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(String(s.id)),d&&d("Updated")}catch(l){a&&a(`Error: ${l.message||"Failed to save."}`),console.error("Content Writer Auto-Save Error:",l)}finally{window.aipkit_cw_isAutosaving=!1}}function n(){let e=o();e&&(window.aipkit_cw_lastSavedData=e)}window.aipkit_handleContentWriterAutoSave=r,window.aipkit_updateContentWriterAutosaveBaseline=n})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_content_writer_form");if(!o)return;let r="data-aipkit-cw-autosave-attached";o.getAttribute(r)||(o.addEventListener("change",n=>{let e=n.target;if(!e||!e.matches(".aipkit_autosave_trigger"))return;(e.tagName.toLowerCase()==="select"||e.type==="checkbox"||e.type==="range")&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()}),o.addEventListener("blur",n=>{let e=n.target;if(!e||!e.matches(".aipkit_autosave_trigger"))return;let i=e.tagName.toLowerCase();(i==="input"||i==="textarea")&&e.type!=="range"&&e.type!=="checkbox"&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()},!0),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline(),o.setAttribute(r,"true"))}window.aipkit_initContentWriterAutosave=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.warn("Content Writer Accordions: Main container not found.");return}o.dataset.accordionListenerAttached!=="true"&&(o.addEventListener("click",function(r){let n=r.target.closest(".aipkit_accordion-header");if(!n)return;let e=n.closest(".aipkit_accordion");if(!e)return;let i=n.nextElementSibling;if(!i||!i.classList.contains("aipkit_accordion-content"))return;let c=e.closest(".aipkit_accordion-group");if(c&&!n.classList.contains("aipkit_active")){let s=c.querySelector(".aipkit_accordion-header.aipkit_active");if(s){s.classList.remove("aipkit_active");let t=s.nextElementSibling;t&&t.classList.remove("aipkit_active")}}n.classList.toggle("aipkit_active"),i.classList.toggle("aipkit_active")}),o.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(s){return s},o=null,r={title:"Title",content:"Content",image:"Image",meta:"Meta",keyword:"Keyword",tags:"Tags",excerpt:"Excerpt"},n=null;function e(s,t=""){if(o||(o=document.getElementById("aipkit_content_writer_form_status")),!o)return;n&&(clearTimeout(n),n=null),o.textContent=s;let d="aipkit_cw_status_badge";o.className=t?`${d} ${t}`:d}function i(s,t,d=""){let a=r[s]||"Step",l=d?g(d):"";switch(t){case"pending":break;case"generating":e(l||`Generating ${a}...`,"aipkit_settings_message-info");break;case"success":e(`${a} complete`,"aipkit_settings_message-success"),n=setTimeout(()=>{e("")},1400);break;case"error":e(`Error ${a}${l?": "+l:""}`,"aipkit_settings_message-error");break;case"skipped":l&&(e(`${a} skipped: ${l}`,"aipkit_settings_message-info"),n=setTimeout(()=>{e("")},1400));break}let p=document.getElementById(`aipkit_cw_status_${s}_generation`),_=p?p.querySelector(".aipkit_cw_status_icon"):null,u=p?p.querySelector(".status-text"):null;if(!(!p||!_||!u))switch(p.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),p.classList.add(`status-${t}`),t){case"pending":{u.textContent="Pending";let m="dashicons-text-page";s==="content"&&(m="dashicons-admin-post"),s==="image"&&(m="dashicons-format-image"),s==="excerpt"&&(m="dashicons-editor-quote"),s==="tags"&&(m="dashicons-tag"),s==="meta"&&(m="dashicons-search"),s==="keyword"&&(m="dashicons-flag"),_.className=`dashicons ${m} aipkit_cw_status_icon`;break}case"generating":u.textContent=l||"Generating...",_.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":u.textContent="Complete",_.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":u.textContent=`Error ${l?": "+l:""}`,_.className="dashicons dashicons-warning aipkit_cw_status_icon";break;case"skipped":u.textContent="Skipped",_.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function c(){e(""),["title","content","image","meta","keyword","excerpt","tags"].forEach(s=>{i(s,"pending")})}window.aipkit_updateCwGenerationStatus=i,window.aipkit_resetAllGenerationStatuses=c})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_content_writer_form_status");o&&(o.textContent="",o.className="aipkit_cw_status_badge"),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending"))}window.aipkit_resetGenerationStatusIndicators=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(l){return l},o=window.aipkit_escapeHtml||function(l){return l},r=(l,p)=>(l?.elements?.[p]?.value||"").trim(),n=l=>String(l||"").split(/\r?\n/).map(p=>p.trim()).filter(Boolean),e=l=>l.map(p=>p.split("|")[0].trim()).filter(Boolean),i=l=>{try{let p=new URL(l);return p.protocol==="http:"||p.protocol==="https:"}catch{return!1}},c=l=>{let p=l?.querySelector(".aipkit_gsheets_indicator");return p?p.classList.contains("aipkit_gsheets_indicator--success"):!0};function s(l,p){l&&(l.textContent=p||g("Please review your input.","gpt3-ai-content-generator"),l.id==="aipkit_cw_action_validation"?l.className="aipkit_cw_action_validation":l.className="aipkit_cw_status_badge aipkit_settings_message-error")}function t(l){l&&(l.textContent="",l.id==="aipkit_cw_action_validation"?l.className="aipkit_cw_action_validation":l.className="aipkit_cw_status_badge")}function d(l,p){let _=p||document.getElementById("aipkit_cw_mode_select")?.value||"task";if(_==="single"&&(_="task"),_==="task")return e(n(r(l,"content_title_bulk"))).length?{isValid:!0}:{isValid:!1,message:g("Please enter at least one topic.","gpt3-ai-content-generator")};if(_==="csv"){let u=document.getElementById("aipkit_cw_csv_data_holder");return(u?u.value.trim():"")?{isValid:!0}:{isValid:!1,message:g("Please upload and parse a CSV file first.","gpt3-ai-content-generator")}}if(_==="rss")return n(r(l,"rss_feeds")).filter(i).length?{isValid:!0}:{isValid:!1,message:g("Please enter at least one valid RSS feed URL.","gpt3-ai-content-generator")};if(_==="url")return n(r(l,"url_list")).filter(i).length?{isValid:!0}:{isValid:!1,message:g("Please enter at least one valid website URL.","gpt3-ai-content-generator")};if(_==="gsheets"){let u=r(l,"gsheets_sheet_id"),m=r(l,"gsheets_credentials");return!u||!m?{isValid:!1,message:g("Please provide a Google Sheet ID and credentials.","gpt3-ai-content-generator")}:c(l)?{isValid:!0}:{isValid:!1,message:g("Verify access before generating.","gpt3-ai-content-generator")}}return{isValid:!0}}async function a(l,p,_){let u=new FormData(l),m=Object.fromEntries(u.entries()),k=l.elements["openai_vector_store_ids[]"];m.openai_vector_store_ids=k?Array.from(k.selectedOptions).map(M=>M.value):[],delete m["openai_vector_store_ids[]"];let f=window.aipkit_dashboard?.text||{},w=document.getElementById("aipkit_cw_mode_select"),E=w?w.value:"task";E==="single"&&(E="task"),m.cw_generation_mode=E;let y=document.getElementById("aipkit_cw_action_validation"),I=d(l,E);if(!I.isValid){let M=_||y;s(M,I.message),M!==y&&t(y);return}if(t(_),t(y),E==="csv"){let M=document.getElementById("aipkit_cw_csv_data_holder");m.content_title=M?M.value:""}else E==="url"?(m.url_list=l.elements.url_list?.value||"",m.content_title=m.url_list):E==="task"&&(m.content_title=l.elements.content_title_bulk?l.elements.content_title_bulk.value:"");delete m.content_title_bulk,delete m.content_title_csv;let S=document.getElementById("aipkit_cw_template_select"),h="";if(S&&S.selectedIndex>0){let M=S.options[S.selectedIndex];M&&(h=M.text)}if(h&&h.trim()!=="")m.task_name=h.trim();else{let M=(m.content_title||m.rss_feeds||m.gsheets_sheet_id||m.url_list||"").split(`
`)[0].trim();m.task_name=M||"Automated Content Writing Task"}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(p,!0,"Create Task","Creating Task..."):(p.disabled=!0,p.textContent="Creating Task..."),_&&(_.textContent="Creating automated task...",_.className="aipkit_cw_status_badge aipkit_settings_message-info");try{let M=document.getElementById("aipkit_content_writer_nonce");if(m._ajax_nonce=M?M.value:"",!m._ajax_nonce)throw new Error("Security token missing for task creation.");let b=await window.aipkit_apiRequest("aipkit_content_writer_create_task",m);_&&(_.textContent="",_.className="aipkit_cw_status_badge"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("autogpt")}catch(M){console.error("Content Writer Create Task Error:",M),_&&(_.textContent=`Error creating task: ${o(M.message||"Unknown error")}`,_.className="aipkit_cw_status_badge aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(p,!1,"Create Task"):(p.disabled=!1,p.textContent="Create Task")}}window.aipkit_createContentWriterTask=a,window.aipkit_validateContentWriterInputs=d,window.aipkit_showContentWriterValidationError=s,window.aipkit_clearContentWriterValidationMessage=t})();(function(){"use strict";let g=()=>{let _=document.getElementById("aipkit_cw_mode_select"),u=_?_.value:"task";return u==="single"?"task":u},o=()=>{let _=g();return _==="task"||_==="csv"},r=_=>{!_?.frequencySelect||!_.frequencySelect.querySelector('option[value="one-time"]')||_.frequencySelect.value!=="one-time"&&(_.frequencySelect.value="one-time",_.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})))},n=()=>{let _=document.getElementById("aipkit_content_writer_container");if(!_)return null;let u=_.querySelector(".aipkit_cw_generate_split");if(!u)return null;let m=u.querySelector("#aipkit_content_writer_generate_btn"),k=u.querySelector(".aipkit_cw_generate_toggle"),f=u.querySelector(".aipkit_cw_generate_menu"),w=f?f.querySelector('[data-menu-panel="actions"]'):null,E=f?f.querySelector('[data-menu-panel="intervals"]'):null,y=w?Array.from(w.querySelectorAll("[data-action]")):[],I=E?Array.from(E.querySelectorAll("[data-interval]")):[],S=E?E.querySelector("[data-menu-back]"):null,h=_.querySelector("#aipkit_cw_task_frequency");return{container:_,split:u,generateBtn:m,toggleBtn:k,menu:f,menuActions:w,menuIntervals:E,actionItems:y,intervalItems:I,backBtn:S,frequencySelect:h}},e=_=>{!_?.menu||!_?.toggleBtn||(_.menu.hidden=!0,_.toggleBtn.setAttribute("aria-expanded","false"))},i=_=>{if(!_?.menu||!_?.split)return;let u=_.menu,m=_.split.getBoundingClientRect(),k=window.innerWidth,f=12;u.style.position="fixed",u.style.right="auto",u.style.bottom="auto",u.style.zIndex="100000",u.style.visibility="hidden";let w=u.getBoundingClientRect(),E=m.right-w.width;E=Math.max(f,Math.min(E,k-w.width-f));let y=m.bottom+6;u.style.left=`${Math.round(E)}px`,u.style.top=`${Math.round(y)}px`,u.style.visibility="visible"},c=_=>{!_?.menu||!_?.toggleBtn||(_.menu.hidden=!1,i(_),_.toggleBtn.setAttribute("aria-expanded","true"))},s=(_,u)=>{if(!_?.menuActions||!_?.menuIntervals)return;let m=u==="intervals";_.menuActions.hidden=m,_.menuIntervals.hidden=!m},t=(_,u)=>{_&&(_.split.dataset.aipkitCwAction=u||"generate",_.actionItems.forEach(m=>{let k=m.dataset.action===u;m.classList.toggle("is-active",k),m.setAttribute("aria-checked",k?"true":"false")}))},d=_=>{if(!_?.frequencySelect)return;let u=_.frequencySelect.value||_.frequencySelect.options[0]?.value||"";_.intervalItems.forEach(m=>{let k=m.dataset.interval===u;m.classList.toggle("is-active",k),m.setAttribute("aria-checked",k?"true":"false")})},a=(_,u)=>{_?.frequencySelect&&(_.frequencySelect.value=u,_.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})),d(_),e(_),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState())},l=_=>{let u=n();if(!u)return;let m=_||"generate",k=m==="create_task"&&o();if(k&&r(u),t(u,m),typeof window.aipkit_updateContentWriterActionState=="function"&&(u.menu&&m==="create_task"&&!k&&(u.menu.dataset.keepOpen="true"),window.aipkit_updateContentWriterActionState()),m==="create_task"&&u.menuIntervals&&!k){s(u,"intervals"),d(u),c(u);return}s(u,"actions"),e(u),k&&m==="create_task"&&u.generateBtn&&setTimeout(()=>{u.generateBtn.click()},0)},p=()=>{let _=n();_&&_.split.dataset.listenerAttached!=="true"&&(_.split.dataset.aipkitCwAction||(_.split.dataset.aipkitCwAction="generate"),t(_,_.split.dataset.aipkitCwAction),d(_),_.toggleBtn&&_.toggleBtn.addEventListener("click",u=>{if(u.preventDefault(),_.toggleBtn.disabled)return;(_.split.dataset.aipkitCwAction||"generate")==="create_task"&&!o()?(s(_,"intervals"),d(_)):s(_,"actions"),_.menu&&_.menu.hidden?c(_):e(_)}),_.actionItems.forEach(u=>{u.addEventListener("click",m=>{m.preventDefault(),!u.disabled&&l(u.dataset.action||"generate")})}),_.intervalItems.forEach(u=>{u.addEventListener("click",m=>{m.preventDefault(),!u.disabled&&a(_,u.dataset.interval||"")})}),_.backBtn&&_.backBtn.addEventListener("click",u=>{u.preventDefault(),s(_,"actions"),c(_)}),document.addEventListener("click",u=>{let m=u.target;!_.menu||_.menu.hidden||_.split.contains(m)||e(_)}),document.addEventListener("keydown",u=>{u.key==="Escape"&&(!_.menu||_.menu.hidden||e(_))}),_.split.dataset.listenerAttached="true")};window.aipkit_initContentWriterGenerateMenu=p,window.aipkit_setCwGenerateAction=l,window.aipkit_getCwGenerateAction=()=>n()?.split?.dataset.aipkitCwAction||"generate"})();(function(){"use strict";let g=window.wp?.i18n?.__||function(L){return L},o=100,r=[{key:"write",label:g("Writing","gpt3-ai-content-generator"),steps:["title","content"],isEnabled:()=>!0},{key:"optimize",label:g("Optimizing","gpt3-ai-content-generator"),steps:["meta","focus","excerpt","tags"],isEnabled:L=>L.generateMeta||L.generateFocus||L.generateExcerpt||L.generateTags},{key:"publish",label:g("Publishing","gpt3-ai-content-generator"),steps:["image","featured","save"],isEnabled:()=>!0}],n={waiting:g("Waiting","gpt3-ai-content-generator"),running:g("Running","gpt3-ai-content-generator"),done:g("Done","gpt3-ai-content-generator"),skipped:g("Skipped","gpt3-ai-content-generator"),error:g("Error","gpt3-ai-content-generator")},e=[{key:"title",label:g("Title","gpt3-ai-content-generator"),isEnabled:L=>!!L.customTitlePrompt},{key:"content",label:g("Content","gpt3-ai-content-generator"),isEnabled:()=>!0},{key:"meta",label:g("Meta","gpt3-ai-content-generator"),isEnabled:L=>L.generateMeta},{key:"focus",label:g("Focus","gpt3-ai-content-generator"),isEnabled:L=>L.generateFocus},{key:"excerpt",label:g("Excerpt","gpt3-ai-content-generator"),isEnabled:L=>L.generateExcerpt},{key:"tags",label:g("Tags","gpt3-ai-content-generator"),isEnabled:L=>L.generateTags},{key:"image",label:g("Image","gpt3-ai-content-generator"),isEnabled:L=>L.generateImages},{key:"featured",label:g("Featured","gpt3-ai-content-generator"),isEnabled:L=>L.generateFeatured},{key:"save",label:g("Save","gpt3-ai-content-generator"),isEnabled:()=>!0}],i={active:!1,stopRequested:!1,items:[],rows:[],totals:{processed:0,completed:0,failed:0}},c=(L,K)=>({customTitlePrompt:String(L.custom_title_prompt||"").trim(),generateMeta:L.generate_meta_description==="1",generateFocus:L.generate_focus_keyword==="1",generateExcerpt:L.generate_excerpt==="1",generateTags:L.generate_tags==="1",generateImages:K.generate_images_enabled==="1",generateFeatured:K.generate_featured_image==="1"}),s=L=>{let K={};return e.forEach(V=>{K[V.key]=V.isEnabled(L)?"waiting":"skipped"}),K},t=(L,K)=>{let V=document.createElement("span");V.className=`aipkit_cw_batch_step aipkit_cw_batch_step--${K}`,V.dataset.step=L.key,V.dataset.status=K;let ee=document.createElement("span");ee.className="aipkit_cw_batch_step_label",ee.textContent=L.label;let J=document.createElement("span");return J.className="aipkit_cw_batch_step_status",J.textContent=n[K]||K,V.appendChild(ee),V.appendChild(J),{wrapper:V,status:J}},d=(L,K,V)=>{y(L,K,V)},a=L=>{L?.phases&&Object.keys(L.phases).forEach(K=>{let V=L.phases[K],ee=V.dataset.status;ee==="done"||ee==="skipped"||(V.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",V.dataset.status="error")})},l=()=>{let L=document.getElementById("aipkit_content_writer_container");if(!L)return null;let K=L.querySelector("#aipkit_cw_batch_queue"),V=K?K.querySelector(".aipkit_cw_batch_list"):null,ee=K?K.querySelector(".aipkit_cw_batch_count"):null,J=K?K.querySelector(".aipkit_cw_batch_progress"):null,le=K?K.querySelector(".aipkit_cw_batch_progress_bar"):null,ue=L.querySelector("#aipkit_content_writer_form_status"),be=L.querySelector("#aipkit_content_writer_generate_btn"),ze=L.querySelector(".aipkit_cw_generate_toggle"),Me=L.querySelector(".aipkit_cw_generate_menu"),rt=Me?Array.from(Me.querySelectorAll(".aipkit_cw_generate_menu_item")):[],Ue=L.querySelector("#aipkit_content_writer_stop_btn");return{container:L,queue:K,list:V,count:ee,progress:J,progressBar:le,status:ue,generateBtn:be,generateToggle:ze,generateMenu:Me,generateMenuItems:rt,stopBtn:Ue}},p=()=>{i.totals.processed=0,i.totals.completed=0,i.totals.failed=0},_=()=>{let L=l();if(!L||!L.count||!L.progressBar||!L.progress)return;let K=i.items.length,V=i.totals.completed;L.count.textContent=`${V}/${K}`;let ee=K>0?Math.round(V/K*100):0;L.progressBar.style.width=`${ee}%`,L.progress.setAttribute("aria-valuenow",String(ee))},u=(L,K)=>{let V=l();!V||!V.status||(V.status.textContent=L||"",V.status.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),K&&V.status.classList.add(`aipkit_settings_message-${K}`))},m=()=>{let L=l();!L||!L.list||(L.list.innerHTML="",i.rows=[],i.items=[],p(),_())},k=()=>{let L=l();L?.queue&&(L.queue.hidden=!1)},f=()=>{let L=l();L?.queue&&(L.queue.hidden=!0)},w=(L,K)=>{let V=document.createElement("div");V.className="aipkit_cw_batch_row";let ee=document.createElement("div");ee.className="aipkit_cw_batch_row_content";let J=document.createElement("span");J.className="aipkit_cw_batch_topic",J.textContent=L.topic||"";let le=document.createElement("div");le.className="aipkit_cw_batch_phases";let ue={},be=s(K),ze={};r.forEach(we=>{let pt=we.steps.some(bt=>{let wt=e.find(Ht=>Ht.key===bt);return wt&&wt.isEnabled(K)});if(!we.isEnabled(K)&&!pt)return;let st=document.createElement("span");st.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--waiting",st.dataset.phase=we.key,st.dataset.status="waiting",st.setAttribute("title",we.label),st.setAttribute("aria-label",we.label),le.appendChild(st),ue[we.key]=st,we.steps.forEach(bt=>{ze[bt]={wrapper:st,phaseKey:we.key,status:{textContent:""}}})});let Me=document.createElement("span");Me.className="aipkit_cw_batch_status aipkit_cw_batch_status--waiting",Me.textContent=g("Waiting","gpt3-ai-content-generator");let rt=document.createElement("span");rt.className="aipkit_cw_batch_error",rt.hidden=!0;let Ue=document.createElement("a");Ue.className="aipkit_cw_batch_view",Ue.textContent=g("View","gpt3-ai-content-generator"),Ue.target="_blank",Ue.rel="noopener noreferrer",Ue.hidden=!0;let vt=document.createElement("span");return vt.className="aipkit_cw_batch_summary_text",ee.appendChild(J),ee.appendChild(le),ee.appendChild(Me),ee.appendChild(rt),ee.appendChild(Ue),V.appendChild(ee),{row:V,topic:J,summary:vt,status:Me,error:rt,view:Ue,phases:ue,steps:ze}},E=L=>{let K=e.find(V=>V.key===L);return K?K.label:L},y=(L,K,V)=>{if(!L?.phases)return;let ee=r.find(le=>le.steps.includes(K));if(!ee)return;let J=L.phases[ee.key];J&&(V==="running"?(J.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--running",J.dataset.status="running",L.status&&(L.status.textContent=`${ee.label} \xB7 ${E(K)}`)):V==="done"?(J.dataset.status==="running"||K===ee.steps[ee.steps.length-1])&&(J.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",J.dataset.status="done"):V==="error"&&(J.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",J.dataset.status="error"))},I=(L,K)=>{let V=l();!V||!V.list||(V.list.innerHTML="",i.rows=L.map(ee=>{let J=w(ee,K);return V.list.appendChild(J.row),J}))},S=(L,K,V={})=>{if(!L)return;L.row.classList.toggle("is-active",K==="running"),L.status.className=`aipkit_cw_batch_status aipkit_cw_batch_status--${K}`;let ee={waiting:g("Waiting","gpt3-ai-content-generator"),running:g("Generating","gpt3-ai-content-generator"),success:g("Done","gpt3-ai-content-generator"),error:g("Failed","gpt3-ai-content-generator"),stopped:g("Stopped","gpt3-ai-content-generator")};if(L.status.textContent=ee[K]||K,L.error&&(L.error.hidden=!0,L.error.textContent="",L.error.removeAttribute("title")),K==="success"&&L.phases&&Object.keys(L.phases).forEach(J=>{let le=L.phases[J];le.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",le.dataset.status="done"}),V.summary!==void 0&&(L.summary.textContent=V.summary||""),V.viewLink?(L.view.href=V.viewLink,L.view.hidden=!1):K!=="success"&&(L.view.hidden=!0),K==="error"&&L.error){let J=M(V.summary);J&&(L.error.textContent=J,L.error.title=h(V.summary),L.error.hidden=!1)}},h=L=>String(L||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),M=L=>{let K=h(L);return K?K.length>140?`${K.slice(0,137)}\u2026`:K:""},b=(L,K)=>{let V=h(K||L);return V?V.length>140?`${V.slice(0,140)}\u2026`:V:""},A=L=>{let K=new FormData(L),V=Object.fromEntries(K.entries()),ee=L.elements["openai_vector_store_ids[]"];V.openai_vector_store_ids=ee?Array.from(ee.selectedOptions).map(le=>le.value):[],delete V["openai_vector_store_ids[]"];let J=document.getElementById("aipkit_content_writer_nonce");return J&&J.value&&(V._ajax_nonce=J.value),V},x=L=>{let K=L.elements["post_categories[]"],V=K?Array.from(K.selectedOptions).map(J=>J.value):[],ee=L.querySelector('input[name="schedule_mode"]:checked')?.value||"immediate";return{ai_provider:L.elements.ai_provider?.value||"",ai_model:L.elements.ai_model?.value||"",ai_temperature:L.elements.ai_temperature?.value||"",reasoning_effort:L.elements.reasoning_effort?.value||"",cw_generation_mode:L.elements.cw_generation_mode?.value||"",post_type:L.elements.post_type?.value||"post",post_author:L.elements.post_author?.value||"",post_status:L.elements.post_status?.value||"draft",post_schedule_date:L.elements.post_schedule_date?.value||"",post_schedule_time:L.elements.post_schedule_time?.value||"",schedule_mode:ee,smart_schedule_start_datetime:L.elements.smart_schedule_start_datetime?.value||"",smart_schedule_interval_value:L.elements.smart_schedule_interval_value?.value||"",smart_schedule_interval_unit:L.elements.smart_schedule_interval_unit?.value||"",post_categories:V,generate_toc:L.elements.generate_toc?.checked?"1":"0",generate_seo_slug:L.elements.generate_seo_slug?.checked?"1":"0",generate_images_enabled:L.elements.generate_images_enabled?.checked?"1":"0",generate_featured_image:L.elements.generate_featured_image?.checked?"1":"0",image_provider:L.elements.image_provider?.value||"",image_model:L.elements.image_model?.value||"",image_prompt:L.elements.image_prompt?.value||"",featured_image_prompt:L.elements.featured_image_prompt?.value||"",image_count:L.elements.image_count?.value||"1",image_placement:L.elements.image_placement?.value||"after_first_h2",image_placement_param_x:L.elements.image_placement_param_x?.value||"",image_alignment:L.elements.image_alignment?.value||"none",image_size:L.elements.image_size?.value||"large",pexels_orientation:L.elements.pexels_orientation?.value||"",pexels_size:L.elements.pexels_size?.value||"",pexels_color:L.elements.pexels_color?.value||"",pixabay_orientation:L.elements.pixabay_orientation?.value||"",pixabay_image_type:L.elements.pixabay_image_type?.value||"",pixabay_category:L.elements.pixabay_category?.value||"",generate_image_title:L.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:L.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:L.elements.generate_image_caption?.checked?"1":"0",generate_image_description:L.elements.generate_image_description?.checked?"1":"0",image_title_prompt:L.elements.image_title_prompt?.value||"",image_alt_text_prompt:L.elements.image_alt_text_prompt?.value||"",image_caption_prompt:L.elements.image_caption_prompt?.value||"",image_description_prompt:L.elements.image_description_prompt?.value||""}},v=(L,K)=>{let V=K.content_title||K.topic||"",ee=K.inline_keywords||K.keywords||"",J=ee?`${V} | ${ee}`:V,le={...L,content_title:J};return K.rss_description&&(le.rss_description=K.rss_description),K.source_url&&(le.source_url=K.source_url),K.url_content_context&&(le.url_content_context=K.url_content_context),{data:le,topic:V,keywords:ee}},C=(L,K,V,ee,J,le,ue)=>({original_topic:K,final_title:V,post_title:V,keywords:ee,excerpt:J||"",image_provider:L.image_provider,image_model:L.image_model,image_prompt:L.image_prompt,image_alignment:L.image_alignment,image_size:L.image_size,featured_image_prompt:L.featured_image_prompt,pexels_orientation:L.pexels_orientation,pexels_size:L.pexels_size,pexels_color:L.pexels_color,pixabay_orientation:L.pixabay_orientation,pixabay_image_type:L.pixabay_image_type,pixabay_category:L.pixabay_category,generate_image_title:L.generate_image_title,generate_image_alt_text:L.generate_image_alt_text,generate_image_caption:L.generate_image_caption,generate_image_description:L.generate_image_description,image_title_prompt:L.image_title_prompt,image_alt_text_prompt:L.image_alt_text_prompt,image_caption_prompt:L.image_caption_prompt,image_description_prompt:L.image_description_prompt,ai_provider:L.ai_provider,ai_model:L.ai_model,ai_temperature:L.ai_temperature,reasoning_effort:L.reasoning_effort,cw_generation_mode:L.cw_generation_mode,_ajax_nonce:le,generate_images_enabled:L.generate_images_enabled,image_count:L.image_count,generate_featured_image:L.generate_featured_image,image_placement:L.image_placement,image_placement_param_x:L.image_placement_param_x,conversation_uuid:ue}),P=(L,K,V,ee,J,le,ue)=>{let be=window.aipkit_getMarkdownRenderer?window.aipkit_getMarkdownRenderer():null,ze=be?be.render(ee):ee,Me=Array.isArray(K.post_categories)&&K.post_categories.length?K.post_categories:L.post_categories;return{post_title:V,post_content:ze,generated_excerpt:J.excerpt||"",generated_tags:J.tags||"",meta_description:J.meta_description||"",focus_keyword:J.focus_keyword||"",post_type:K.post_type||L.post_type,post_author:K.post_author||L.post_author,post_status:L.post_status,post_schedule_date:K.post_schedule_date||L.post_schedule_date,post_schedule_time:K.post_schedule_time||L.post_schedule_time,post_categories:Me,generate_toc:L.generate_toc,generate_seo_slug:L.generate_seo_slug,image_data:le?JSON.stringify(le):"",image_alignment:L.image_alignment,image_size:L.image_size,_ajax_nonce:ue}},$=async(L,K,V,ee,J)=>{let le=L.item_config||{},{data:ue,topic:be,keywords:ze}=v(K,le),Me=be,rt=ue.conversation_uuid||void 0;if(!!String(ue.custom_title_prompt||"").trim()){d(ee,"title","running");let Ht=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",{...ue,conversation_uuid:rt});if(!Ht?.new_title)throw new Error(g("Title generation failed","gpt3-ai-content-generator"));Me=Ht.new_title,rt=Ht.conversation_uuid||rt,d(ee,"title","done")}else d(ee,"title","skipped");d(ee,"content","running");let we=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",{...ue,conversation_uuid:rt});if(!we?.content)throw new Error(g("Content generation failed","gpt3-ai-content-generator"));d(ee,"content","done"),rt=we.conversation_uuid||rt||void 0,d(ee,"meta",J.generateMeta?"done":"skipped"),d(ee,"focus",J.generateFocus?"done":"skipped"),d(ee,"excerpt",J.generateExcerpt?"done":"skipped"),d(ee,"tags",J.generateTags?"done":"skipped");let pt=null;if(V.generate_images_enabled==="1"||V.generate_featured_image==="1"){J.generateImages&&d(ee,"image","running"),J.generateFeatured&&d(ee,"featured","running");let Ht=we.focus_keyword||ze||K.content_keywords||"",se=C(V,be,Me,Ht,we.excerpt||"",K._ajax_nonce,rt),me=V.generate_images_enabled==="1",de=V.generate_featured_image==="1",ve=me&&de,qe=async(Se={})=>{let Je=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...se,...Se});if(!Je?.image_data)throw new Error(g("Image generation failed","gpt3-ai-content-generator"));return Je.image_data};if(ve){let Se=null,Je=nt=>{Se||(Se={...nt,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(me){let nt=await qe({generate_featured_image:"0"});Je(nt),Array.isArray(nt.in_content_images)&&Se.in_content_images.push(...nt.in_content_images),J.generateImages&&d(ee,"image","done")}if(de){let nt=await qe({generate_images_enabled:"0",image_count:0});Je(nt),nt.featured_image_id&&(Se.featured_image_id=nt.featured_image_id),nt.featured_image_url&&(Se.featured_image_url=nt.featured_image_url),J.generateFeatured&&d(ee,"featured","done")}pt=Se}else pt=await qe(),J.generateImages&&d(ee,"image","done"),J.generateFeatured&&d(ee,"featured","done")}else d(ee,"image","skipped"),d(ee,"featured","skipped");d(ee,"save","running");let bt=P(V,le,Me,we.content,we,pt,K._ajax_nonce),wt=await window.aipkit_apiRequest("aipkit_content_writer_save_post",bt);return d(ee,"save","done"),{summary:b(we.content,we.excerpt),viewLink:wt.view_link||wt.edit_link}},U=()=>{let L=l();i.active=!1,i.stopRequested=!1,L?.generateBtn&&(typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():L.generateBtn.disabled=!1,L.generateBtn.removeAttribute("aria-disabled")),L?.generateToggle&&(L.generateToggle.disabled=!1,L.generateToggle.removeAttribute("aria-disabled")),L?.generateMenuItems?.length&&L.generateMenuItems.forEach(K=>{K.disabled=!1,K.removeAttribute("aria-disabled")}),L?.stopBtn&&(L.stopBtn.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()},B=()=>{i.active&&(i.stopRequested=!0,u(g("Stopping...","gpt3-ai-content-generator"),"info"))},D=L=>{i.items.slice(L).forEach((K,V)=>{let ee=i.rows[L+V];S(ee,"stopped")})},N=async()=>{for(let V=0;V<i.items.length;V+=1){if(i.stopRequested){D(V);break}let ee=i.rows[V];S(ee,"running");try{let J=await $(i.items[V],i.baseData,i.postConfig,ee,i.stepContext);S(ee,"success",J),i.totals.completed+=1}catch(J){a(ee),S(ee,"error",{summary:J?.message||g("Failed","gpt3-ai-content-generator")}),i.totals.failed+=1}i.totals.processed+=1,_()}let L=i.items.length,K=i.totals.completed;i.stopRequested?u(g("Generation stopped.","gpt3-ai-content-generator"),"error"):u(`${K}/${L} ${g("completed","gpt3-ai-content-generator")}`,"success"),U()},R=async(L,K)=>{if(!L||!K)return;if(!window.aipkit_apiRequest){console.error("Batch generation: aipkit_apiRequest not available.");return}let V=l();if(!V?.generateBtn)return;if(i.active){u(g("Generation already in progress.","gpt3-ai-content-generator"),"info");return}let ee=A(L),J=x(L),le=c(ee,J);try{i.active=!0,i.stopRequested=!1,p(),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(V.generateBtn,!0,g("Generate","gpt3-ai-content-generator"),g("Preparing\u2026","gpt3-ai-content-generator")):V.generateBtn.disabled=!0,V.queue&&(V.queue.dataset.cwMode=K),u(g("Preparing items\u2026","gpt3-ai-content-generator"),"info");let ue=await window.aipkit_apiRequest("aipkit_content_writer_prepare_batch",{...ee,cw_generation_mode:K}),be=Array.isArray(ue.items)?ue.items:[];if(!be.length){u(g("No items found to generate.","gpt3-ai-content-generator"),"error"),U();return}m(),i.items=be.slice(0,o),i.baseData=ee,i.postConfig=J,i.stepContext=le,I(i.items,le),k(),_(),u(g("Generating content\u2026","gpt3-ai-content-generator"),"info"),await N()}catch(ue){u(ue?.message||g("Batch generation failed.","gpt3-ai-content-generator"),"error"),U()}},j=()=>{i.active=!1,i.stopRequested=!1,m(),f()};window.aipkit_cw_handleBatchGeneration=R,window.aipkit_cw_resetBatchQueue=j,window.aipkit_cw_requestBatchStop=B,window.aipkit_cw_isBatchActive=()=>i.active===!0})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n},o=window.wp?.i18n?.__||function(n){return n};function r(n,e){let i=n.value,c=i?i.toLowerCase():"",s=window.aipkit_dashboard?.models;if(!e){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!s){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),e.innerHTML='<option value="">'+g("Error: Model data object not found")+"</option>",e.disabled=!0;return}let t=s[c];(typeof t>"u"||t===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${c}'. Defaulting to empty.`),t=c==="openai"?{}:[]),e.innerHTML="";let d=window.aipkit_dashboard?.recommendedModels?.[c]||[],a=Array.isArray(d)?d:[],l=new Set(a.map(p=>p?.id).filter(Boolean));if(c==="openai"&&typeof t=="object"&&!Array.isArray(t)){if(a.length>0){let p=document.createElement("optgroup");p.label=g(o("Recommended","gpt3-ai-content-generator")),a.forEach(_=>{if(_&&typeof _=="object"&&_.id){let u=new Option(g(_.name||_.id),_.id);p.appendChild(u)}}),p.children.length>0&&e.appendChild(p)}Object.keys(t).forEach(p=>{let _=document.createElement("optgroup");_.label=g(p);let u=t[p];Array.isArray(u)?u.forEach(m=>{if(!(m&&typeof m=="object"&&m.id&&l.has(m.id)))if(m&&typeof m=="object"&&m.id){let k=new Option(g(m.name||m.id),m.id);_.appendChild(k)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${p}':`,m)}):console.warn(`Content Writer Model Populator: Items for group '${p}' under '${c}' is not an array.`),_.children.length>0&&e.appendChild(_)})}else if(Array.isArray(t)){if(a.length>0){let _=document.createElement("optgroup");_.label=g(o("Recommended","gpt3-ai-content-generator")),a.forEach(u=>{if(u&&typeof u=="object"&&u.id){let m=new Option(g(u.name||u.id),u.id);_.appendChild(m)}}),_.children.length>0&&e.appendChild(_)}let p=a.length>0?document.createElement("optgroup"):null;p&&(p.label=g(o("All models","gpt3-ai-content-generator"))),t.forEach(_=>{if(!(_&&typeof _=="object"&&_.id&&l.has(_.id)))if(_&&typeof _=="object"&&_.id){let u=new Option(g(_.name||_.id),_.id);p?p.appendChild(u):e.appendChild(u)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${c}':`,_)}),p&&p.children.length>0&&e.appendChild(p)}else console.warn(`Content Writer Model Populator: Data for provider '${c}' is not in expected format. Actual type: ${typeof t}`),e.appendChild(new Option(g(`No models for ${i} (Format Error)`),""));if(!e.options||typeof e.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),e.appendChild(new Option(g("Error loading models"),"")),e.disabled=!0;else if(e.options.length===0)e.appendChild(new Option(g(`No models for ${i} (Sync in settings)`),"")),e.disabled=!0;else{e.disabled=!1;let p=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let _=window.aipkit_cw_template_state.pendingModelSelection;e.querySelector(`option[value="${CSS.escape(_)}"]`)?p=_:console.warn(`Content Writer Model Populator: Pending model '${_}' not found in new list for provider '${i}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(p===null){let _=e.querySelector("optgroup");_&&_.options&&_.options.length>0&&_.options[0].value?p=_.options[0].value:e.options&&e.options.length>0&&e.options[0].value?p=e.options[0].value:p=""}e.value=p}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let p=document.getElementById("aipkit_content_writer_container");p&&window.aipkit_cw_toggleReasoningEffort(p)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}window.aipkit_populateModelsForContentWriter=r})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(l){return l},o=l=>l&&l!=="single"?l:"task",r=l=>typeof l=="string"&&l.startsWith("existing"),n=l=>l==="existing"?"existing-content":l,e={"existing-images":{title:{label:"Image Title",desc:"Optimize attachment title"},content:{label:"Description",desc:"Update image description"},excerpt:{label:"Caption",desc:"Short image caption"},keyword:{label:"Alt Text",desc:"Describe the image for accessibility"}},"existing-products":{title:{label:"Product Title",desc:"Generate product headline"},content:{label:"Product Description",desc:"Generate main product description"},meta:{label:"Meta Description",desc:"SEO meta for product pages"},keyword:{label:"Focus Keyword",desc:"Primary keyword for product SEO"},excerpt:{label:"Short Description",desc:"Short summary of the product"},tags:{label:"Tags",desc:"Auto-generate product tags"}}},i=l=>{let p=document.getElementById("aipkit_content_writer_container");if(!p)return;let _=p.querySelectorAll(".aipkit_prompt_toggle_card[data-prompt-key]");if(!_.length)return;let u=e[l]||null;_.forEach(m=>{let k=m.dataset.promptKey,f=m.querySelector(".aipkit_prompt_toggle_label"),w=m.querySelector(".aipkit_prompt_toggle_desc");if(!f||!w)return;m.dataset.defaultLabel||(m.dataset.defaultLabel=f.textContent||""),m.dataset.defaultDesc||(m.dataset.defaultDesc=w.textContent||"");let E=u&&k?u[k]:null;E?(f.textContent=E.label,w.textContent=E.desc):(f.textContent=m.dataset.defaultLabel,w.textContent=m.dataset.defaultDesc)})},c=l=>{let p=document.querySelectorAll(".aipkit_cw_prompt_flyout");if(!p.length)return;let _=l==="existing-images",u=l==="existing-products";p.forEach(m=>{let k=m.querySelector(".aipkit_cw_prompt_panel"),f=m.querySelector(".aipkit_cw_prompt_editor_title");if(!k||!f)return;if(!m.dataset.defaultTitle){let E=f.textContent||k.getAttribute("aria-label")||"";m.dataset.defaultTitle=E}let w=m.dataset.defaultTitle||"";_&&m.dataset.existingImagesTitle?w=m.dataset.existingImagesTitle:u&&m.dataset.existingProductsTitle&&(w=m.dataset.existingProductsTitle),w&&(f.textContent=w,k.setAttribute("aria-label",w))})};function s(l){if(!document.getElementById("aipkit_content_writer_form"))return;let _=o(l),u=n(_),m=document.getElementById("aipkit_cw_single_output_wrapper");m&&u!=="task"&&(m.style.display="none");let k=document.getElementById("aipkit_cw_output_card");if(k){let E=m&&m.style.display!=="none";k.style.display=u==="task"&&E?"block":"none"}let f=document.getElementById("aipkit_cw_content_prompt_placeholders");if(f){let E="Use placeholders: {topic}, {keywords}",y=r(u);u==="rss"?E+=", {description}, {source_url}":u==="url"&&(E+=", {url_content}"),E+=".";let I=E.replace(/(\{[a-zA-Z0-9_]+\})/g,S=>`<code class="aipkit-placeholder" title="Click to copy">${g(S)}</code>`);f.innerHTML=I,f.hidden=y}typeof window.aipkit_setContentWriterPromptMode=="function"&&window.aipkit_setContentWriterPromptMode(u),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState(u);let w=document.getElementById("aipkit_cw_batch_queue");if(w){let E=w.querySelector(".aipkit_cw_batch_list"),y=E?E.children.length>0:!1,I=typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive();w.hidden=!(I||y)}typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),u.startsWith("existing")&&typeof window.aipkit_fetchContentWriterExistingPosts=="function"&&window.aipkit_fetchContentWriterExistingPosts(1)}function t(l){let p=document.getElementById("aipkit_content_writer_form");if(!p)return;let _=document.getElementById("aipkit_content_writer_generate_btn"),u=_?_.querySelector(".aipkit_btn-text"):null,m=_?_.querySelector(".aipkit_cw_task_suffix"):null,k=document.querySelector(".aipkit_cw_post_summary_trigger"),f=document.querySelector(".aipkit_cw_generate_split"),w=f?f.querySelector(".aipkit_cw_generate_toggle"):null,E=f?f.querySelector(".aipkit_cw_generate_menu"):null,y=p.querySelector("#aipkit_cw_task_frequency"),I=E?Array.from(E.querySelectorAll(".aipkit_cw_generate_menu_item[data-action]")):[],S=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,h=new Set(["task","csv","rss","gsheets","url"]),M=new Set(["rss","gsheets","url"]),b=o(l||document.getElementById("aipkit_cw_mode_select")?.value||"task");b=n(b);let A=r(b),x=b==="existing-images",v=b==="existing-products",C=b==="existing-content",P=h.has(b),$=M.has(b),U=P&&(!$||S),B=b==="task"||b==="csv";p.classList.toggle("aipkit_cw_mode_existing",A),p.classList.toggle("aipkit_cw_mode_existing_images",x),p.classList.toggle("aipkit_cw_mode_existing_products",v),p.classList.toggle("aipkit_cw_mode_existing_content",C),p.querySelectorAll(".aipkit_model_settings_popover.aipkit-active").forEach(V=>{V.classList.remove("aipkit-active"),V.setAttribute("aria-hidden","true")}),p.querySelectorAll(".aipkit_cw_popover_trigger[aria-expanded='true']").forEach(V=>V.setAttribute("aria-expanded","false")),p.querySelectorAll("[data-aipkit-cw-mode-only]").forEach(V=>{let J=V.dataset.aipkitCwModeOnly===b;V.hidden=!J,V.setAttribute("aria-hidden",J?"false":"true"),!J&&V.classList.contains("aipkit_model_settings_popover")&&(V.classList.remove("aipkit-active"),V.setAttribute("aria-hidden","true")),!J&&V.classList.contains("aipkit_cw_popover_trigger")&&V.setAttribute("aria-expanded","false")}),i(b),c(b),typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),(()=>{if(!r)return;let V=window.aipkit_cw_template_state;if(!V)return;let J=(Array.isArray(V.currentTemplates)?V.currentTemplates.find(le=>String(le.id)===String(V.currentTemplateId||"")):null)?.config||V.initialConfigForSelectedTemplate;!J||typeof J!="object"||["generate_title","generate_content"].forEach(le=>{if(!Object.prototype.hasOwnProperty.call(J,le))return;let ue=p.elements[le];if(!ue)return;let be=J[le];ue.checked=be==="1"||be===1||be===!0})})(),y&&B&&Array.from(y.options).some(ee=>ee.value==="one-time")&&y.value!=="one-time"&&(y.value="one-time");let N=!1;if(b==="rss"){let V=document.getElementById("aipkit_cw_rss_items_count");N=V&&parseInt(V.value,10)>0}let R=f?.dataset?.aipkitCwAction||"generate";if(A?R=!S&&v?"upgrade":"update":(P||(R="generate"),!U&&$&&(R="upgrade")),!A&&b==="rss"&&U?N?R==="fetch_feeds"&&(R="generate"):R="fetch_feeds":R==="fetch_feeds"&&(R="generate"),!A&&R==="create_task"&&!U&&(R="generate"),!A&&U&&R!=="generate"&&R!=="create_task"&&R!=="fetch_feeds"&&(R="generate"),f&&(f.dataset.aipkitCwAction=R),I.forEach(V=>{let ee=V.dataset.action||"generate",J=!P||$&&!S||A;ee==="create_task"&&(V.hidden=J);let le=ee===R;V.classList.toggle("is-active",le),V.setAttribute("aria-checked",le?"true":"false")}),w){let V=U&&!A&&!(b==="rss"&&!N);w.style.display=V?"":"none",w.disabled=!V}E&&(E.dataset.keepOpen==="true"||(E.hidden=!0),E.dataset.keepOpen="false"),f&&f.classList.toggle("is-single",!U||b==="rss"&&!N);let L={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",fetch_feeds:"Fetch Feeds",update:"Update"}[R]||"Generate";if(u?u.textContent=L:_&&(typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(_,L):_.textContent=L),_&&(_.dataset.action=R,A||(_.removeAttribute("aria-disabled"),_.dataset.aipkitExistingDisabled&&(_.disabled=!1,delete _.dataset.aipkitExistingDisabled))),m)if(R==="create_task"&&y&&!B){let V=y.options[y.selectedIndex],ee=V?V.text:"";ee?(m.textContent=` / ${ee}`,m.hidden=!1):(m.textContent="",m.hidden=!0)}else m.textContent="",m.hidden=!0;if(k&&(k.hidden=A,k.setAttribute("aria-hidden",A?"true":"false"),A&&k.setAttribute("aria-expanded","false")),typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0);return}_?.dataset?.aipkitStopMode==="true"&&typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),typeof window.aipkit_cw_resetBatchQueue=="function"&&(R!=="generate"||!P)&&window.aipkit_cw_resetBatchQueue()}let d={task:{label:"Manual Entry",icon:"dashicons-edit"},csv:{label:"Import CSV",icon:"dashicons-media-spreadsheet"},rss:{label:"RSS Feed",icon:"dashicons-rss"},url:{label:"Website URL",icon:"dashicons-admin-links"},gsheets:{label:"Google Sheets",icon:"dashicons-analytics"},existing:{label:"Update Content",icon:"dashicons-update"},"existing-content":{label:"Update Content",icon:"dashicons-update"},"existing-images":{label:"Optimize Images",icon:"dashicons-format-image"},"existing-products":{label:"Optimize Products",icon:"dashicons-cart"}};function a(l){if(!l){console.error("Content Writer Mode: Scope element not provided for initialization.");return}let p=l.querySelector("#aipkit_cw_mode_select"),_=Array.from(l.querySelectorAll(".aipkit_cw_mode_card")),u=Array.from(l.querySelectorAll(".aipkit_cw_bulk_source_tab")),m=Array.from(l.querySelectorAll("[data-aipkit-bulk-source-panel]")),k=l.querySelector(".aipkit_cw_tab_content_container"),f=l.querySelector("[data-aipkit-source-selector]"),w=f?.querySelector("[data-aipkit-source-trigger]"),E=f?.querySelector(".aipkit_cw_source_menu"),y=E?Array.from(E.querySelectorAll(".aipkit_cw_source_option")):[],I=w?.querySelector("[data-source-label]"),S=w?.querySelector("[data-source-icon]");if(!p||!k){console.warn("Content Writer Mode: Mode selector or content container not found within the provided scope.");return}let h=C=>{_.length&&_.forEach(P=>{let $=P.dataset.mode===C;P.classList.toggle("is-active",$),P.setAttribute("aria-pressed",$?"true":"false")})},M=C=>{!u.length||!m.length||(u.forEach(P=>{let $=P.dataset.source===C;P.classList.toggle("is-active",$),P.setAttribute("aria-pressed",$?"true":"false")}),m.forEach(P=>{let $=P.dataset.aipkitBulkSourcePanel===C;P.classList.toggle("is-hidden",!$),P.hidden=!$,P.setAttribute("aria-hidden",$?"false":"true")}))},b=C=>{if(!y.length)return;let P=n(C),$=r(P);y.forEach(B=>{let D=B.dataset.source===P;B.classList.toggle("is-active",D),B.setAttribute("aria-selected",D?"true":"false")});let U=d[P]||d.task;if(I&&(I.dataset.defaultLabel||(I.dataset.defaultLabel=I.textContent||""),I.textContent=$?U.label:I.dataset.defaultLabel),S){let B=S.querySelector(".dashicons");if(B&&!S.dataset.defaultIcon){let D=B.className.split(" ").find(N=>N!=="dashicons");S.dataset.defaultIcon=D||"dashicons-plus-alt2"}if(B){let D=$?U.icon:S.dataset.defaultIcon||"dashicons-plus-alt2";B.className="dashicons "+D}S.dataset.sourceIcon=$?P:"more"}w&&w.classList.toggle("is-active",$)},A=(C=!1)=>{if(!E||!w)return;let P=w.getAttribute("aria-expanded")==="true",$=C||P;w.setAttribute("aria-expanded",$?"false":"true"),E.hidden=$},x=C=>{let P=o(C),$=n(P),U=$.startsWith("existing")?"existing":$;p.value!==P&&(p.value=P),k.querySelectorAll(".aipkit_cw_tab_content").forEach(B=>{B.classList.toggle("aipkit_active",B.dataset.pane===U)}),h($),M(P==="csv"?"csv":"task"),b($),s($)};p.addEventListener("change",function(C){x(C.target.value)}),w&&w.addEventListener("click",C=>{C.stopPropagation(),A()}),y.length&&y.forEach(C=>{C.addEventListener("click",()=>{let P=C.dataset.source||"task";p.value!==P&&(p.value=P,p.dispatchEvent(new Event("change",{bubbles:!0}))),A(!0)})}),document.addEventListener("click",C=>{f&&!f.contains(C.target)&&A(!0)}),document.addEventListener("keydown",C=>{C.key==="Escape"&&E&&!E.hidden&&(A(!0),w?.focus())}),_.length&&_.forEach(C=>{C.dataset.listenerAttached||(C.addEventListener("click",()=>{let P=C.dataset.mode||"task";p.value!==P&&(p.value=P,p.dispatchEvent(new Event("change",{bubbles:!0})))}),C.dataset.listenerAttached="true")}),u.length&&u.forEach(C=>{C.dataset.listenerAttached||(C.addEventListener("click",()=>{let $=(C.dataset.source||"task")==="csv"?"csv":"task";p.value!==$&&(p.value=$,p.dispatchEvent(new Event("change",{bubbles:!0})))}),C.dataset.listenerAttached="true")});let v=p.value||"task";x(v==="single"?"task":v)}window.aipkit_initContentWriterTabs=a,window.aipkit_updateContentWriterActionState=t})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(k){return String(k||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},o=["keyword","title","excerpt","content","meta","tags"],r={keyword:"Focus keyword",title:"Title",excerpt:"Excerpt",content:"Content",meta:"Meta description",tags:"Tags",slug:"URL"},e={"existing-content":{fieldOrder:o,fieldLabels:r,postTypeOverride:"",allowMeta:!0,allowTags:!0,allowSlug:!0},"existing-images":{fieldOrder:["keyword","title","excerpt","content"],fieldLabels:{keyword:"Alt text",title:"Image title",excerpt:"Caption",content:"Description"},postTypeOverride:"attachment",allowMeta:!1,allowTags:!1,allowSlug:!1,useImageMetadataPrompts:!0},"existing-products":{fieldOrder:o,fieldLabels:r,postTypeOverride:"product",allowMeta:!0,allowTags:!0,allowSlug:!0}},i=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}"],c=["{price}","{regular_price}","{sale_price}","{sku}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{product_categories}"],s={title:["{original_title}"],content:["{original_content}","{short_description}"],meta:["{original_title}","{short_description}","{original_content}"],keyword:["{original_title}","{original_content}"],excerpt:["{short_description}","{original_content}","{original_excerpt}"],tags:["{original_content}","{attributes}","{product_categories}"]},t=["{file_name}","{original_title}","{original_alt}","{original_caption}","{original_description}"],d=["Generate product titles, descriptions, and SEO fields.","Use product data like price, SKU, and attributes.","Bulk optimize selected products."],a={short:2e3,medium:4e3,long:6e3},l=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,p=window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.aipkit_dashboard.upgradeUrl:"",_=2400;function u(k=1){if(typeof window.aipkit_cw_existing_handleFetch=="function"){window.aipkit_cw_existing_handleFetch(k);return}window.aipkit_cw_existing_pendingFetch=k}function m(k){if(!k)return;let f=k.querySelector("[data-aipkit-existing-panel]");if(!f||f.dataset.init==="true")return;let w=f.querySelector("#aipkit_cw_existing_post_type"),E=f.querySelector("#aipkit_cw_existing_post_status"),y=f.querySelector("#aipkit_cw_existing_media_filter"),I=f.querySelector("#aipkit_cw_existing_search"),S=f.querySelector("#aipkit_cw_existing_refresh"),h=f.querySelector("#aipkit_cw_existing_select_all"),M=f.querySelector("#aipkit_cw_existing_posts_body"),b=f.querySelector("#aipkit_cw_existing_page_status"),A=f.querySelector("#aipkit_cw_existing_page_prev"),x=f.querySelector("#aipkit_cw_existing_page_next"),v=f.querySelector("#aipkit_cw_existing_selected_count"),C=document.getElementById("aipkit_content_writer_generate_btn")||f.querySelector("#aipkit_cw_existing_open_assistant"),P=document.getElementById("aipkit_cw_mode_select");if(!M)return;let $=document.getElementById("aipkit_content_writer_nonce"),U=10,B=1,D=1,N=null,R=!1,j=!1,L=!1,K=[],V=new Set,ee=new Map,J=w?w.value:"",le=!1,ue=C?C.querySelector(".aipkit_btn-text"):null,be=C&&C.dataset.action||"generate",ze=pe=>pe?pe==="existing"?"existing-content":pe.indexOf("existing-")===0?pe:"":"",Me=()=>ze(P?P.value:""),rt=()=>e[Me()]||e["existing-content"],Ue=()=>!!Me(),vt=document.getElementById("aipkit_content_writer_form_status"),we="",pt=null,st=()=>{pt&&(clearTimeout(pt),pt=null)},bt=(pe,xe)=>{vt&&(st(),vt.textContent=pe||"",vt.className="aipkit_cw_status_badge",xe==="info"?vt.classList.add("aipkit_settings_message-info"):xe==="error"?vt.classList.add("aipkit_settings_message-error"):xe==="success"&&vt.classList.add("aipkit_settings_message-success"),pe?vt.dataset.cwUpdateStatus="1":delete vt.dataset.cwUpdateStatus)},wt=()=>{j&&(L=!0,bt("Stopping...","info"))},Ht=()=>{vt&&(st(),pt=setTimeout(()=>{vt.dataset.cwUpdateStatus==="1"&&bt("","")},4e3))},se=pe=>{if(!vt){we="";return}if(!pe){vt.dataset.cwProNotice==="1"&&(!we||vt.textContent.startsWith(we))&&(vt.textContent="",vt.className="aipkit_cw_status_badge"),delete vt.dataset.cwProNotice,we="";return}let xe=p?` <a class="aipkit_popover_upgrade_link" href="${g(p)}" target="_blank" rel="noopener noreferrer">Upgrade</a>`:"";we=pe,vt.dataset.cwProNotice="1",vt.className="aipkit_cw_status_badge aipkit_settings_message-info",vt.innerHTML=`${g(pe)}${xe}`};if(w&&!l){let pe=w.querySelector('option[value="product"]');pe&&!pe.dataset.proLabel&&(pe.dataset.proLabel=pe.textContent||"Products")}let me=pe=>{le=!!pe,C&&(C.dataset.action=le?"upgrade":be,ue&&Ue()&&(ue.textContent=le?"Upgrade":"Update"))},de=pe=>{let xe=[],ke=[];return pe.forEach(tt=>{let Ye=K.find(Ot=>Number(Ot.id)===tt);Ye&&Ye.type==="product"?xe.push(tt):ke.push(tt)}),{productIds:xe,otherIds:ke}},ve=()=>{if(!Ue()||Me()!=="existing-content"){me(!1),se("");return}if(l){me(!1),se("");return}let pe=Array.from(V),{productIds:xe,otherIds:ke}=de(pe);if(w&&w.value==="product"){me(!0);return}if(xe.length&&!ke.length){me(!0);return}if(xe.length&&ke.length){me(!1);return}me(!1),se("")},qe=pe=>{M&&(M.innerHTML=`
        <tr class="aipkit_cw_existing_empty">
          <td colspan="7">${g(pe)}</td>
        </tr>
      `,Se())},Se=()=>{let pe=V.size;if(ve(),v&&(v.textContent=`${pe} selected`),C&&Ue()){let xe=le?j:pe===0||j;C.disabled=xe,C.setAttribute("aria-disabled",xe?"true":"false"),xe?C.dataset.aipkitExistingDisabled="true":delete C.dataset.aipkitExistingDisabled}if(h){let xe=K.length>0&&K.every(ke=>V.has(ke.id));h.checked=xe}},Je=()=>{b&&(b.textContent=`Page ${B} of ${D}`),A&&(A.disabled=B<=1),x&&(x.disabled=B>=D)},nt=(pe,xe)=>{if(K=Array.isArray(pe)?pe:[],B=xe?.page||1,D=xe?.total_pages||1,!K.length){qe("No posts found."),Je(),Se();return}let ke=Me()==="existing-images",tt=K.map(Ye=>{let Ot=Number(Ye.id),qt=g(Ye.title||"(Untitled)"),kt=g(Ye.edit_link||"#"),zt=g(Ye.type_label||""),Dt=g(Ye.status_label||""),it=ke?g(Ye.alt_text||""):"",Wt=ke?g(Ye.caption||""):"",Ae=ke?g(Ye.description||""):"",Lt=ke?g(Ye.thumb_url||""):"",ut=V.has(Ot)?"checked":"",ft=g(Ye.type||"post"),Ri=qt?` title="${qt}"`:"",_n=it?` title="${it}"`:"",Di=Wt?` title="${Wt}"`:"",at=Ae?` title="${Ae}"`:"",Ui=Lt?`<span class="aipkit_cw_existing_thumb"><img src="${Lt}" alt="" loading="lazy"></span>`:'<span class="aipkit_cw_existing_thumb aipkit_cw_existing_thumb--empty" aria-hidden="true"></span>',pi=ke?`
                <div class="aipkit_cw_existing_title_stack">
                  ${Ui}
                  <div class="aipkit_cw_existing_title_meta">
                    <a class="row-title aipkit_cw_existing_truncate" href="${kt}" target="_blank" rel="noopener noreferrer"${Ri}>${qt}</a>
                    <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                  </div>
                </div>
              `:`
                <div class="aipkit_cw_existing_title_inline">
                  <a class="row-title aipkit_cw_existing_truncate" href="${kt}" target="_blank" rel="noopener noreferrer"${Ri}>${qt}</a>
                  <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                </div>
              `;return`
            <tr id="post-${Ot}" data-post-type="${ft}">
              <td class="aipkit_cw_existing_col_check">
                <input type="checkbox" class="aipkit_cw_existing_row_checkbox" value="${Ot}" ${ut}>
              </td>
              <td class="aipkit_cw_existing_title">
                ${pi}
              </td>
              <td class="aipkit_cw_existing_col_type">${zt}</td>
              <td class="aipkit_cw_existing_col_status">${Dt}</td>
              <td class="aipkit_cw_existing_col_alt"><span class="aipkit_cw_existing_truncate"${_n}>${it}</span></td>
              <td class="aipkit_cw_existing_col_caption"><span class="aipkit_cw_existing_truncate"${Di}>${Wt}</span></td>
              <td class="aipkit_cw_existing_col_description"><span class="aipkit_cw_existing_truncate"${at}>${Ae}</span></td>
            </tr>
          `}).join("");M.innerHTML=tt,Je(),Se()},Vt=pe=>{let xe=String(pe||"").trim();return xe||"(Untitled)"},ai=(pe,xe)=>{let ke=f.querySelector(`#post-${pe}`);if(!ke)return;let tt=ke.querySelector(".row-title");if(!tt)return;let Ye=Vt(xe);tt.textContent=Ye,tt.setAttribute("title",Ye);let Ot=K.find(qt=>Number(qt.id)===pe);Ot&&(Ot.title=Ye)},ti=(pe,xe,ke)=>{let tt=f.querySelector(`#post-${pe}`);if(!tt)return;let Ye="",Ot="";if(xe==="keyword")Ye=".aipkit_cw_existing_col_alt .aipkit_cw_existing_truncate",Ot="alt_text";else if(xe==="excerpt")Ye=".aipkit_cw_existing_col_caption .aipkit_cw_existing_truncate",Ot="caption";else if(xe==="content")Ye=".aipkit_cw_existing_col_description .aipkit_cw_existing_truncate",Ot="description";else return;let qt=tt.querySelector(Ye);if(!qt)return;let kt=String(ke||"").trim();qt.textContent=kt,kt?qt.setAttribute("title",kt):qt.removeAttribute("title");let zt=K.find(Dt=>Number(Dt.id)===pe);zt&&Ot&&(zt[Ot]=kt)},Ft=pe=>{let xe=ee.get(pe);xe&&(clearTimeout(xe),ee.delete(pe))},ht=(pe,xe,ke)=>{let tt=f.querySelector(`#post-${pe}`);if(!tt)return;let Ye=tt.querySelector(".aipkit_cw_existing_status");if(Ye){if(Ft(pe),Ye.classList.remove("is-visible","is-error","is-success","is-processing","is-queued"),!ke){Ye.textContent="";return}Ye.textContent=ke,Ye.classList.add("is-visible"),xe==="error"&&Ye.classList.add("is-error"),xe==="success"&&Ye.classList.add("is-success"),xe==="processing"&&Ye.classList.add("is-processing"),xe==="queued"&&Ye.classList.add("is-queued")}},Le=pe=>ht(pe,"",""),Te=pe=>{Ft(pe);let xe=setTimeout(()=>Le(pe),_);ee.set(pe,xe)},xt=pe=>{if(j=pe,C&&Ue()){let xe=C.dataset&&C.dataset.aipkitStopMode==="true",ke=le?pe:V.size===0||pe&&!xe;C.disabled=ke,C.setAttribute("aria-disabled",ke?"true":"false"),ke?C.dataset.aipkitExistingDisabled="true":delete C.dataset.aipkitExistingDisabled}if(S&&(S.disabled=pe),w){let xe=rt();w.disabled=pe||!!xe.postTypeOverride}E&&(E.disabled=pe),I&&(I.disabled=pe),A&&(A.disabled=pe||B<=1),x&&(x.disabled=pe||B>=D),h&&(h.disabled=pe),M.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(xe=>{xe.disabled=pe})},Kt=()=>{let pe=rt();w&&(pe.postTypeOverride?(w.value=pe.postTypeOverride,w.disabled=!0):(w.disabled=!1,w.value=J||"")),E&&pe.postTypeOverride==="attachment"&&(E.value="")},yt=pe=>{!C||!Ue()||C.dataset&&C.dataset.aipkitStopMode==="true"||(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(C,pe,"Update","Updating..."):C.disabled=pe)},ot=(pe,xe)=>{let ke=`${xe}_update`,tt=pe&&pe[ke]||pe&&pe[xe]||"";return String(tt||"").trim()},Li=pe=>{let xe=document.getElementById("aipkit_content_writer_form");if(!xe||typeof window.aipkit_getContentWriterFormConfig!="function")return{error:"Content Writer form is not ready yet."};let ke=window.aipkit_getContentWriterFormConfig(xe),tt=!!pe.useImageMetadataPrompts;if(!l&&pe.postTypeOverride==="product")return{error:"Optimize Products is a Pro feature. Upgrade to continue."};let Ye=ut=>tt?ut==="title"?ke.generate_image_title==="1":ut==="keyword"?ke.generate_image_alt_text==="1":ut==="excerpt"?ke.generate_image_caption==="1":ut==="content"?ke.generate_image_description==="1":!1:ut==="meta"&&!pe.allowMeta||ut==="tags"&&!pe.allowTags?!1:ut==="title"?ke.generate_title!=="0":ut==="content"?ke.generate_content!=="0":ut==="meta"?ke.generate_meta_description==="1":ut==="keyword"?ke.generate_focus_keyword==="1":ut==="excerpt"?ke.generate_excerpt==="1":ut==="tags"?ke.generate_tags==="1":!1,Ot=tt?{title:Ye("title")?ot(ke,"image_title_prompt"):"",content:Ye("content")?ot(ke,"image_description_prompt"):"",meta:"",keyword:Ye("keyword")?ot(ke,"image_alt_text_prompt"):"",excerpt:Ye("excerpt")?ot(ke,"image_caption_prompt"):"",tags:""}:{title:Ye("title")?ot(ke,"custom_title_prompt"):"",content:Ye("content")?ot(ke,"custom_content_prompt"):"",meta:Ye("meta")?ot(ke,"custom_meta_prompt"):"",keyword:Ye("keyword")?ot(ke,"custom_keyword_prompt"):"",excerpt:Ye("excerpt")?ot(ke,"custom_excerpt_prompt"):"",tags:Ye("tags")?ot(ke,"custom_tags_prompt"):""},qt=[],kt=ut=>pe.fieldLabels?.[ut]||r[ut]||ut;if(Ye("title")&&!Ot.title&&qt.push(`${kt("title")} prompt is required.`),Ye("content")&&!Ot.content&&qt.push(`${kt("content")} prompt is required.`),Ye("meta")&&!Ot.meta&&qt.push(`${kt("meta")} prompt is required.`),Ye("keyword")&&!Ot.keyword&&qt.push(`${kt("keyword")} prompt is required.`),Ye("excerpt")&&!Ot.excerpt&&qt.push(`${kt("excerpt")} prompt is required.`),Ye("tags")&&!Ot.tags&&qt.push(`${kt("tags")} prompt is required.`),qt.length)return{error:qt.join(" ")};let zt=[],Dt=(ut,ft)=>ft.some(Ri=>ut.includes(Ri)),it=ut=>tt?t:pe.postTypeOverride==="product"&&s[ut]||i;if(pe.fieldOrder.forEach(ut=>{let ft=Ot[ut];if(!ft)return;let Ri=it(ut);Dt(ft,Ri)||zt.push(`${kt(ut)} prompt: add one of ${Ri.join(", ")}.`)}),zt.length)return{error:`${tt?"Image optimization":pe.postTypeOverride==="product"?"Product update":"Update"} works best when prompts include source placeholders.

${zt.join(`
`)}`};let Wt=String(ke.content_length||"medium"),Ae=a[Wt]||a.medium,Lt={ai_provider:ke.ai_provider||"openai",ai_model:ke.ai_model||"",temperature:parseFloat(ke.ai_temperature||"1"),max_tokens:Ae,reasoning_effort:ke.reasoning_effort||"",generate_seo_slug:pe.allowSlug&&ke.generate_seo_slug||"0",enable_vector_store:ke.enable_vector_store||"0",vector_store_provider:ke.vector_store_provider||"openai",vector_store_top_k:ke.vector_store_top_k||"3",openai_vector_store_ids:ke.openai_vector_store_ids||[],pinecone_index_name:ke.pinecone_index_name||"",qdrant_collection_name:ke.qdrant_collection_name||"",vector_embedding_provider:ke.vector_embedding_provider||"",vector_embedding_model:ke.vector_embedding_model||""};return{prompts:Ot,baseConfig:Lt}},yi=(pe,xe,ke)=>({[pe]:{prompt:xe},ai_provider:ke.ai_provider,ai_model:ke.ai_model,temperature:ke.temperature,max_tokens:ke.max_tokens,reasoning_effort:ke.reasoning_effort,enable_vector_store:ke.enable_vector_store,vector_store_provider:ke.vector_store_provider,vector_store_top_k:ke.vector_store_top_k,openai_vector_store_ids:ke.openai_vector_store_ids,pinecone_index_name:ke.pinecone_index_name,qdrant_collection_name:ke.qdrant_collection_name,vector_embedding_provider:ke.vector_embedding_provider,vector_embedding_model:ke.vector_embedding_model}),Zt=async(pe=1)=>{if(!R){if(typeof window.aipkit_apiRequest!="function"){console.error("Content Writer Existing: aipkit_apiRequest not found.");return}R=!0,qe("Loading posts...");try{let ke=rt().postTypeOverride||(w?w.value:""),tt=await window.aipkit_apiRequest("aipkit_content_writer_fetch_existing_posts",{_ajax_nonce:$?$.value:"",post_type:ke,post_status:E?E.value:"",media_filter:y?y.value:"",search:I?I.value.trim():"",paged:pe,per_page:U});nt(tt.posts||[],tt.pagination||{})}catch(xe){console.error("Content Writer Existing: fetch failed",xe),qe("Unable to load posts. Please try again.")}finally{R=!1}}},Nt=()=>{V.clear(),Se()};M.addEventListener("change",pe=>{let xe=pe.target;if(!xe||!xe.classList.contains("aipkit_cw_existing_row_checkbox"))return;let ke=Number(xe.value||0);ke&&(xe.checked?V.add(ke):V.delete(ke),Se())}),h&&h.addEventListener("change",()=>{let pe=h.checked;K.forEach(ke=>{pe?V.add(Number(ke.id)):V.delete(Number(ke.id))}),M.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(ke=>{ke.checked=pe}),Se()}),A&&A.addEventListener("click",()=>{B>1&&Zt(B-1)}),x&&x.addEventListener("click",()=>{B<D&&Zt(B+1)}),S&&S.addEventListener("click",()=>{Nt(),Zt(1)}),w&&w.addEventListener("change",()=>{rt().postTypeOverride||(J=w.value),Nt(),Zt(1)}),E&&E.addEventListener("change",()=>{Nt(),Zt(1)}),y&&y.addEventListener("change",()=>{Nt(),Zt(1)}),I&&I.addEventListener("input",()=>{N&&clearTimeout(N),N=setTimeout(()=>{Nt(),Zt(1)},300)});let Jt=pe=>{typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(pe,{title:"Update existing"}):alert(pe)},Pi=()=>{let pe="Bulk image optimization is available on Pro. Select one image or upgrade.";if(typeof window.aipkit_showAlertModal=="function"){let xe=[];p&&xe.push({label:"Upgrade to Pro",href:p,className:"aipkit_btn aipkit_btn-primary"}),xe.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(pe,{title:"Optimize Images",actions:xe})}else alert(pe)},Hi=()=>{let pe="Optimize Products is a Pro feature.";if(typeof window.aipkit_showAlertModal=="function"){let xe=[];p&&xe.push({label:"Upgrade to Pro",href:p,className:"aipkit_btn aipkit_btn-primary"}),xe.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(pe,{title:"Optimize Products",bullets:d,actions:xe})}else alert(pe)},ji=async(pe,xe,ke,tt,Ye)=>{let Ot=`cw-existing-${pe}-${Date.now()}`,qt=!1;if(L)return ht(pe,"","Stopped"),Te(pe),{success:!1,stopped:!0};for(let kt of Ye.fieldOrder){let zt=xe[kt];if(!zt)continue;if(L)return ht(pe,"","Stopped"),Te(pe),{success:!1,stopped:!0};ht(pe,"processing",`Updating ${Ye.fieldLabels[kt]||kt}...`);let Dt=yi(kt,zt,ke),it={_ajax_nonce:tt,post_id:pe,field:kt,enhancements:JSON.stringify(Dt),conversation_uuid:Ot};try{let Wt=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",it,{timeout:18e4});Wt&&Object.prototype.hasOwnProperty.call(Wt,"updated_value")&&(kt==="title"?ai(pe,Wt.updated_value):ti(pe,kt,Wt.updated_value)),qt=!0}catch(Wt){let Ae=Wt&&Wt.message||"Update failed. Please try again.";return ht(pe,"error",Ae),{success:!1}}}if(L)return ht(pe,"","Stopped"),Te(pe),{success:!1,stopped:!0};if(ke.generate_seo_slug==="1"&&qt){ht(pe,"processing","Updating URL...");try{await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",{_ajax_nonce:tt,post_id:pe,action_type:"update_slug"},{timeout:3e4})}catch{return ht(pe,"error","URL update failed."),{success:!1}}}return qt?(ht(pe,"success","Updated"),Te(pe),{success:!0}):(ht(pe,"error","No prompts selected."),{success:!1})},ii=async()=>{if(j||!Ue())return;let pe=Array.from(V);if(!pe.length)return;if(!l&&Me()==="existing-content"){let{productIds:Ae,otherIds:Lt}=de(pe);if(Ae.length&&!Lt.length){Hi(),Se();return}Ae.length&&Lt.length&&(Ae.forEach(ut=>{ht(ut,"error","Skipped (Pro)"),Te(ut)}),pe=Lt)}if(!pe.length){Se();return}if(!l&&Me()==="existing-images"&&pe.length>1){Pi();return}if(typeof window.aipkit_apiRequest!="function"){Jt("Update service is not available yet.");return}let xe=window.aipkit_post_enhancer?.nonce_generate_title;if(!xe){Jt("Update permission is missing. Please reload the page.");return}let ke=rt(),{prompts:tt,baseConfig:Ye,error:Ot}=Li(ke);if(Ot){!l&&ke.postTypeOverride==="product"?Hi():Jt(Ot);return}if(!ke.fieldOrder.some(Ae=>!!tt[Ae])){Jt("No prompts selected for update.");return}L=!1,pe.forEach(Ae=>{ht(Ae,"queued","Queued")});let kt=0,zt=0,Dt=pe.length,it=null,Wt=()=>{let Ae=[];return Ae.push(`Updating ${Dt} item${Dt===1?"":"s"}...`),kt&&Ae.push(`${kt} done`),zt&&Ae.push(`${zt} error${zt===1?"":"s"}`),Ae.join(" ")};bt(Wt(),"info"),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):yt(!0),xt(!0);for(let Ae=0;Ae<pe.length;Ae+=1){let Lt=pe[Ae];if(L){it=Ae;break}let ut=await ji(Lt,tt,Ye,xe,ke);if(ut&&ut.stopped){L=!0,it=Ae+1;break}ut&&ut.success?kt+=1:zt+=1,bt(Wt(),"info")}if(xt(!1),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():yt(!1),L){(it!==null?pe.slice(it):[]).forEach(ut=>{ht(ut,"","Stopped"),Te(ut)});let Lt=[`Update stopped: ${kt} done`];zt&&Lt.push(`${zt} error${zt===1?"":"s"}`),bt(Lt.join(", ")+".","info")}else zt?bt(`Update complete: ${kt} done, ${zt} error${zt===1?"":"s"}.`,"error"):bt(`Update complete: ${kt} done.`,"success");Ht(),Se()};f.dataset.init="true",window.aipkit_cw_existing_handleFetch=Zt,window.aipkit_runContentWriterExistingUpdate=ii,window.aipkit_cw_isExistingUpdateActive=()=>j,window.aipkit_cw_requestExistingUpdateStop=wt,P&&!P.dataset.aipkitExistingListener&&(P.addEventListener("change",()=>{y&&(y.value=""),Kt(),Nt()},!0),P.dataset.aipkitExistingListener="true"),Kt(),window.aipkit_cw_existing_pendingFetch&&(Zt(window.aipkit_cw_existing_pendingFetch),window.aipkit_cw_existing_pendingFetch=null)}window.aipkit_initContentWriterExistingContent=m,window.aipkit_fetchContentWriterExistingPosts=u})();(function(){"use strict";let g=[{key:"custom_title_prompt",textareaId:"aipkit_cw_custom_title_prompt",updateInputId:"aipkit_cw_custom_title_prompt_update"},{key:"custom_content_prompt",textareaId:"aipkit_cw_custom_content_prompt",updateInputId:"aipkit_cw_custom_content_prompt_update"},{key:"custom_meta_prompt",textareaId:"aipkit_cw_custom_meta_prompt",updateInputId:"aipkit_cw_custom_meta_prompt_update"},{key:"custom_keyword_prompt",textareaId:"aipkit_cw_custom_keyword_prompt",updateInputId:"aipkit_cw_custom_keyword_prompt_update"},{key:"custom_excerpt_prompt",textareaId:"aipkit_cw_custom_excerpt_prompt",updateInputId:"aipkit_cw_custom_excerpt_prompt_update"},{key:"custom_tags_prompt",textareaId:"aipkit_cw_custom_tags_prompt",updateInputId:"aipkit_cw_custom_tags_prompt_update"},{key:"image_prompt",textareaId:"aipkit_cw_image_prompt",updateInputId:"aipkit_cw_image_prompt_update"},{key:"featured_image_prompt",textareaId:"aipkit_cw_featured_image_prompt",updateInputId:"aipkit_cw_featured_image_prompt_update"},{key:"image_title_prompt",textareaId:"aipkit_cw_image_title_prompt",updateInputId:"aipkit_cw_image_title_prompt_update"},{key:"image_alt_text_prompt",textareaId:"aipkit_cw_image_alt_text_prompt",updateInputId:"aipkit_cw_image_alt_text_prompt_update"},{key:"image_caption_prompt",textareaId:"aipkit_cw_image_caption_prompt",updateInputId:"aipkit_cw_image_caption_prompt_update"},{key:"image_description_prompt",textareaId:"aipkit_cw_image_description_prompt",updateInputId:"aipkit_cw_image_description_prompt_update"}],o={create:{},update:{}},r={},n=[],e="create",i=!1,c=k=>k&&k!=="single"?k:"task",s=()=>{let k=document.getElementById("aipkit_cw_mode_select");return c(k?.value||"task")},t=k=>k&&k.indexOf("existing")===0?"update":"create",d=(k,f,w)=>{if(w)return String(k||"");let E=String(k||"").trim()?k:f||"";return String(E||"")},a=()=>{if(i)return;let k=e==="update";n.forEach(({key:f,textarea:w,updateInput:E})=>{if(!w)return;let y=w.value||"";if(!k){o.create[f]=y;return}r[f]&&(o.update[f]=y,E&&(E.value=y))})},l=()=>{i=!0;let k=e==="update";n.forEach(({key:f,textarea:w,updateInput:E})=>{if(!w)return;let y=o.create[f]||"",I=o.update[f]||"",S=!!r[f],h=k?d(I,y,S):y;w.value=h||"",k&&E&&(E.value=S?I:"")}),i=!1},p=k=>{let f=t(c(k));f!==e&&(a(),e=f,l())},_=k=>{!k||k.dataset.aipkitPromptModeInit==="true"||(n=g.map(f=>{let w=k.querySelector(`#${f.textareaId}`)||document.getElementById(f.textareaId),E=k.querySelector(`#${f.updateInputId}`)||document.getElementById(f.updateInputId);return{...f,textarea:w,updateInput:E}}),n.some(f=>f.textarea)&&(n.forEach(f=>{let w=f.textarea&&f.textarea.value||"";o.create[f.key]=w;let E=f.updateInput&&f.updateInput.value||"";o.update[f.key]=E,r[f.key]=!!E,f.textarea&&!f.textarea.dataset.aipkitPromptModeListener&&(f.textarea.addEventListener("input",()=>{if(i)return;let y=f.textarea.value||"";e==="update"?(o.update[f.key]=y,r[f.key]=!0,f.updateInput&&(f.updateInput.value=y)):o.create[f.key]=y}),f.textarea.dataset.aipkitPromptModeListener="true")}),k.dataset.aipkitPromptModeInit="true",p(s())))},u=k=>{if(!k||typeof k!="object")return;let f=w=>Object.prototype.hasOwnProperty.call(k,w);n.forEach(w=>{let E=w.key,y=`${E}_update`;if(f(E)&&(o.create[E]=k[E]||""),f(y)){let I=k[y]||"";o.update[E]=I,r[E]=!!I,w.updateInput&&(w.updateInput.value=r[E]?I:"")}}),l()},m=()=>({create:{...o.create},update:{...o.update}});window.aipkit_initContentWriterPromptModeManager=_,window.aipkit_setContentWriterPromptMode=p,window.aipkit_applyContentWriterPromptSets=u,window.aipkit_getContentWriterPromptSets=m})();(function(){"use strict";let g={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"],image_title:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_alt_text:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_caption:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_description:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"]},o=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}","{price}","{regular_price}","{sale_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{total_sales}","{product_categories}"],r={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},n={existing:{title:["{original_title}","{original_content}","{original_focus_keyword}"],content:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],meta:["{original_title}","{original_content}","{original_focus_keyword}","{original_tags}","{categories}"],keyword:["{original_title}","{original_content}"],excerpt:["{original_title}","{original_content}","{original_excerpt}"],tags:["{original_title}","{original_content}","{original_tags}","{categories}"],image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],featured_image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"]},"existing-images":{title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],content:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],excerpt:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],keyword:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_alt_text:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_caption:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_description:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],featured_image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"]},"existing-products":{title:o,content:o,meta:o,keyword:o,excerpt:o,tags:o}},e={aipkit_cw_image_title_prompt:"image_title",aipkit_cw_image_alt_text_prompt:"image_alt_text",aipkit_cw_image_caption_prompt:"image_caption",aipkit_cw_image_description_prompt:"image_description"},i=p=>String(p??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),c=()=>{let _=document.getElementById("aipkit_cw_mode_select")?.value||"task";return _==="single"&&(_="task"),_},s=(p,_)=>{let u=window.aipkit_content_writer_config?.default_prompts||{};if(_==="existing-images"){let m=`${p}_update`;if(u[m])return u[m]}return u[p]||""},t=(p,_)=>{let u=n[_]||(_.indexOf("existing")===0?n.existing:null);if(u&&u[p])return u[p];let m=g[p]||[],k=r[_]||[],f=[...m,...k];return f.filter((w,E)=>f.indexOf(w)===E)},d=(p,_)=>{if(!p)return;let u=p.dataset.label||"Variables:",m=p.dataset.copyTitle||"Click to copy";p.innerHTML=`${i(u)} `,_.forEach((k,f)=>{let w=document.createElement("code");w.className="aipkit-placeholder",w.title=m,w.textContent=k,p.appendChild(w),f<_.length-1&&p.appendChild(document.createTextNode(" "))})},a=p=>{let _=p?.querySelector(".aipkit_cw_prompt_editor_placeholders");if(!_)return;let u=_.dataset.promptType||"",m=c(),k=t(u,m);d(_,k)};function l(p){if(!p)return;let _=p.querySelectorAll("[data-aipkit-flyout-target]");if(!_.length)return;let u=p.querySelectorAll(".aipkit_cw_prompt_library_select"),m=b=>{u.length&&u.forEach(A=>{let x=A.getAttribute("data-aipkit-prompt-target"),v=e[x];if(!v)return;let C=A.options?A.options[0]:null;if(!C)return;if(Array.from(A.options).forEach(($,U)=>{let B=$.dataset.aipkitMode||"both",D=!0;U!==0&&(b==="existing-images"?D=B!=="create":D=B!=="update"),$.hidden=!D}),A.dataset.aipkitDefaultCreate||(A.dataset.aipkitDefaultCreate=C.value||""),b==="existing-images"){let $=s(v,b);$&&(A.dataset.aipkitDefaultUpdate=$,C.value=$)}else C.value=A.dataset.aipkitDefaultCreate||C.value||"";A.selectedOptions.length&&A.selectedOptions[0].hidden&&(A.selectedIndex=0)})},k=null,f=null,w=!1,E=b=>b?p.querySelector(`#${b}`):null,y=(b,A,x)=>{if(!b||!A)return;let v=b.getBoundingClientRect(),C=x?x.getBoundingClientRect():v,P=A.getBoundingClientRect(),$=P.width||440,U=P.height||0,B=window.innerWidth,D=window.innerHeight,N=12,R=C.left-$-10;R<N&&(R=C.right+10),R=Math.max(N,Math.min(R,B-$-N));let j=C.top;j+U>D-N&&(j=D-U-N),j=Math.max(N,j),k.style.left=`${Math.round(R)}px`,k.style.top=`${Math.round(j)}px`},I=()=>{!f||!k||w||(w=!0,window.requestAnimationFrame(()=>{let b=k.querySelector(".aipkit_cw_prompt_panel"),A=f.closest(".aipkit_model_settings_popover_panel");y(f,b,A),w=!1}))},S=()=>{k&&(k.classList.remove("is-open"),k.setAttribute("aria-hidden","true"),f&&f.setAttribute("aria-expanded","false"),k=null,f=null)},h=b=>{let A=b.getAttribute("data-aipkit-flyout-target"),x=E(A);if(!x)return;k&&k!==x&&S(),k=x,f=b,x.classList.add("is-open"),x.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true"),a(x);let v=x.querySelector(".aipkit_cw_prompt_panel"),C=b.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{y(b,v,C)})};_.forEach(b=>{b.dataset.flyoutListenerAttached!=="true"&&(b.addEventListener("click",A=>{if(A.preventDefault(),k&&f===b&&k.classList.contains("is-open")){S();return}h(b)}),b.dataset.flyoutListenerAttached="true")});let M=c();if(m(M),u.forEach(b=>{let A=b.getAttribute("data-aipkit-prompt-target"),x=A?p.querySelector(`#${A}`):null;x&&typeof x.value=="string"&&x.value.trim()===""&&b.value&&(x.value=b.value),b.dataset.promptLibraryAttached!=="true"&&(b.addEventListener("change",()=>{let v=b.value;if(!v)return;let C=b.getAttribute("data-aipkit-prompt-target"),P=C?p.querySelector(`#${C}`):null;if(!P)return;P.value=v,P.dispatchEvent(new Event("input",{bubbles:!0})),typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave();let $=b.options?b.options[0]:null;$&&$.value===""&&(b.value="",b.selectedIndex=0)}),b.dataset.promptLibraryAttached="true")}),p.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(b=>{b.dataset.overlayListenerAttached!=="true"&&(b.addEventListener("click",x=>{x.target===b&&S()}),b.dataset.overlayListenerAttached="true");let A=b.querySelector(".aipkit_popover_flyout_close");A&&A.dataset.flyoutListenerAttached!=="true"&&(A.addEventListener("click",x=>{x.preventDefault(),S()}),A.dataset.flyoutListenerAttached="true")}),p.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",b=>{b.key==="Escape"&&k&&S()}),p.dataset.promptFlyoutEscapeAttached="true"),p.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",b=>{if(!k)return;let A=b.target;A.closest(".aipkit_cw_prompt_flyout")||A.closest("[data-aipkit-flyout-target]")||S()}),p.dataset.promptFlyoutClickAttached="true"),p.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",I),window.addEventListener("scroll",I,!0),p.dataset.promptFlyoutRepositionAttached="true"),p.dataset.promptFlyoutModeAttached!=="true"){let b=document.getElementById("aipkit_cw_mode_select");b&&b.addEventListener("change",()=>{m(c()),k&&a(k)}),p.dataset.promptFlyoutModeAttached="true"}window.aipkit_closeContentWriterPromptFlyout=S}window.aipkit_initContentWriterPromptFlyouts=l})();(function(){"use strict";let r=c=>String(c||"").replace(/\|/g," ").replace(/\r?\n/g," ").trim(),n=c=>{let s=String(c||"").trim();if(!s)return{value:"",raw:""};let t=s.match(/^(\d{4}-\d{2}-\d{2})(?:[T\s])(\d{2}:\d{2})(?::\d{2})?$/);return t?{value:`${t[1]}T${t[2]}`,raw:""}:{value:"",raw:s}},e=c=>c?c.replace("T"," ").trim():"";function i(c){let s=c||document.getElementById("aipkit_content_writer_container");if(!s)return;let t=s.querySelector("[data-aipkit-bulk-editor]");if(!t||t.dataset.bulkEditorAttached==="true")return;let d=t.querySelector("[data-aipkit-bulk-rows]"),a=t.querySelector("#aipkit_cw_bulk_row_template"),l=t.querySelector("#aipkit_cw_bulk_topics"),p=t.querySelector(".aipkit_cw_bulk_add_row"),_=t.querySelector(".aipkit_cw_bulk_toggle_raw"),u=t.querySelector("#aipkit_cw_bulk_raw"),m=t.querySelector(".aipkit_cw_bulk_grid"),k=t.querySelector(".aipkit_cw_bulk_toggle_details");if(!d||!a||!l)return;let f=!1,w,E=($,U)=>$?$.querySelector(`[data-bulk-field="${U}"]`):null,y=()=>{Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")).forEach((U,B)=>{let D=U.querySelector(".aipkit_cw_bulk_row_number");D&&(D.textContent=B+1)})},I=$=>{let U=r(E($,"topic")?.value||""),B=r(E($,"keywords")?.value||""),D=r(E($,"category")?.value||""),N=r(E($,"author")?.value||""),R=r(E($,"type")?.value||""),j=E($,"schedule")?.value||"";return j?(j=e(j),$.dataset.rawSchedule=""):$.dataset.rawSchedule&&(j=$.dataset.rawSchedule),{topic:U,keywords:B,category:D,author:N,type:R,schedule:j}},S=($,U)=>{if(!$||!U)return;let B=(N,R)=>{let j=E($,N);j&&(j.value=R||"")};B("topic",U.topic||""),B("keywords",U.keywords||""),B("category",U.category||""),B("author",U.author||""),B("type",U.type||"");let D=E($,"schedule");if(D){let N=n(U.schedule||"");D.value=N.value,$.dataset.rawSchedule=N.raw||""}},h=()=>{let $=Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")),U=[];return $.forEach(B=>{let{topic:D,keywords:N,category:R,author:j,type:L,schedule:K}=I(B);if(!D)return;let V=[D,N,R,j,L,K],ee=-1;V.forEach((J,le)=>{J&&(ee=le)}),ee!==-1&&U.push(V.slice(0,ee+1).join(" | "))}),U.join(`
`)},M=()=>{l&&(f=!0,l.value=h(),l.dispatchEvent(new Event("change",{bubbles:!0})),f=!1)},b=$=>{t.classList.toggle("is-details-open",$),k&&k.setAttribute("aria-expanded",$?"true":"false")},A=$=>{if(u){if(t.classList.toggle("is-raw-open",$),u.hidden=!$,_){_.setAttribute("aria-expanded",$?"true":"false");let U=$?_.dataset.labelGrid:_.dataset.labelRaw;if(U){let B=_.querySelector(".aipkit_cw_toggle_label");B?B.textContent=U:_.textContent=U}}m&&(m.hidden=$),p&&(p.hidden=$,p.disabled=$),k&&(k.hidden=$,$&&k.setAttribute("aria-expanded","false"))}},x=$=>{let B=document.importNode(a.content,!0).querySelector("[data-aipkit-bulk-row]");return B?(S(B,$||{}),B):null},v=()=>{let $=d.querySelectorAll("[data-aipkit-bulk-row]");if($.length>=1)return;let U=1-$.length;for(let B=0;B<U;B++){let D=x();D&&d.appendChild(D)}},C=()=>{let $=Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")),U=$[$.length-1];if(!U)return;let B=I(U);if(Object.values(B).some(N=>N)&&$.length<100){let N=x();N&&(d.appendChild(N),y())}},P=()=>{let U=(l.value||"").split(/\r?\n/).filter(D=>D.trim()!=="");d.innerHTML="";let B=[];if(U.slice(0,100).forEach(D=>{let N=D.split("|").map(L=>L.trim()),R={topic:N[0]||"",keywords:N[1]||"",category:N[2]||"",author:N[3]||"",type:N[4]||"",schedule:N[5]||""},j=x(R);j&&B.push(j)}),!B.length){v(),y(),M();return}B.forEach(D=>d.appendChild(D)),v(),y()};l.value.trim()?P():(v(),y(),M()),A(!u.hidden),k&&!k.dataset.listenerAttached&&(k.addEventListener("click",$=>{$.preventDefault();let U=t.classList.contains("is-details-open");b(!U)}),k.dataset.listenerAttached="true",b(!1)),d.addEventListener("input",$=>{let U=$.target;!U||!U.closest("[data-aipkit-bulk-row]")||(M(),C())}),d.addEventListener("change",$=>{let U=$.target;!U||!U.closest("[data-aipkit-bulk-row]")||(M(),C())}),d.addEventListener("click",$=>{let U=$.target.closest(".aipkit_cw_bulk_remove_row");if(!U)return;let B=U.closest("[data-aipkit-bulk-row]");if(!B)return;d.querySelectorAll("[data-aipkit-bulk-row]").length<=1?B.querySelectorAll("input, select").forEach(N=>{N.value=""}):B.remove(),M(),y(),C()}),p&&p.addEventListener("click",$=>{if($.preventDefault(),d.querySelectorAll("[data-aipkit-bulk-row]").length>=100)return;let B=x();B&&d.appendChild(B),y()}),_&&u&&_.addEventListener("click",$=>{$.preventDefault();let U=!u.hidden;A(!U)}),l.addEventListener("input",()=>{f||(clearTimeout(w),w=setTimeout(()=>{P()},250))}),t.dataset.bulkEditorAttached="true"}window.aipkit_initContentWriterBulkEditor=i})();(function(){"use strict";let g=null,o=0;function r(){if(!g)return;let i=g;g=null,i.classList.remove("aipkit-active"),i.__aipkitAlertKeydown&&(document.removeEventListener("keydown",i.__aipkitAlertKeydown),i.__aipkitAlertKeydown=null);let c=()=>{i.parentNode&&i.parentNode.removeChild(i)};i.addEventListener("transitionend",c,{once:!0}),window.setTimeout(c,250)}function n(i,c={}){let s=c.title||"Notice",t=c.okText||"OK",d=c.okClass||"aipkit_btn-primary",a=Array.isArray(c.actions)?c.actions:null,l=Array.isArray(c.bullets)?c.bullets:null;g&&r();let p=document.createElement("div");p.className="aipkit-modal-overlay",p.addEventListener("click",h=>{h.target===p&&r()});let _=`aipkit_cw_alert_${Date.now()}_${o++}`,u=document.createElement("div");u.className="aipkit-modal-content aipkit_cw_alert_modal_content",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true"),u.setAttribute("aria-labelledby",`${_}_title`);let m=document.createElement("div");m.className="aipkit-modal-header";let k=document.createElement("h3");k.className="aipkit-modal-title",k.id=`${_}_title`,k.textContent=s;let f=document.createElement("button");f.type="button",f.className="aipkit-modal-close-btn",f.setAttribute("aria-label","Close"),f.textContent="\xD7",m.appendChild(k),m.appendChild(f);let w=document.createElement("div");w.className="aipkit-modal-body";let E=document.createElement("p");if(E.className="aipkit_cw_alert_modal_message",E.textContent=i||"",l&&l.length){let h=document.createElement("ul");h.className="aipkit_cw_alert_modal_list",l.forEach(M=>{let b=document.createElement("li");b.textContent=M,h.appendChild(b)}),w.appendChild(E),w.appendChild(h)}else w.appendChild(E);let y=document.createElement("div");y.className="aipkit_cw_alert_modal_actions";let I=null;if(a&&a.length)a.forEach((h,M)=>{let b=!!(h&&h.href),A=h?.label||(M===0?t:"Close"),x=h?.className||(M===0?"aipkit_btn aipkit_btn-primary":"aipkit_btn aipkit_btn-secondary"),v=document.createElement(b?"a":"button");v.className=x,v.textContent=A,b?(v.href=h.href,v.target=h.target||"_blank",v.rel=h.rel||"noopener noreferrer"):v.type="button";let C=()=>{typeof h?.onClick=="function"&&h.onClick(),h?.closeOnClick!==!1&&r()};v.addEventListener("click",C),y.appendChild(v),I||(I=v)});else{let h=document.createElement("button");h.type="button",h.className=`aipkit_btn ${d}`,h.textContent=t,h.addEventListener("click",r),y.appendChild(h),I=h}w.appendChild(y),u.appendChild(m),u.appendChild(w),p.appendChild(u),document.body.appendChild(p);let S=h=>{h.key==="Escape"&&r()};p.__aipkitAlertKeydown=S,document.addEventListener("keydown",S),f.addEventListener("click",r),window.requestAnimationFrame(()=>{p.classList.add("aipkit-active"),I&&I.focus()}),g=p}function e(i,c={}){let s=c.title||"Confirm",t=c.confirmText||"Confirm",d=c.cancelText||"Cancel",a=typeof c.onConfirm=="function"?c.onConfirm:null,l=typeof c.onCancel=="function"?c.onCancel:null;g&&r();let p=document.createElement("div");p.className="aipkit-modal-overlay",p.addEventListener("click",M=>{M.target===p&&(r(),l&&l())});let _=`aipkit_cw_confirm_${Date.now()}_${o++}`,u=document.createElement("div");u.className="aipkit-modal-content aipkit_cw_alert_modal_content",u.setAttribute("role","dialog"),u.setAttribute("aria-modal","true"),u.setAttribute("aria-labelledby",`${_}_title`);let m=document.createElement("div");m.className="aipkit-modal-header";let k=document.createElement("h3");k.className="aipkit-modal-title",k.id=`${_}_title`,k.textContent=s;let f=document.createElement("button");f.type="button",f.className="aipkit-modal-close-btn",f.setAttribute("aria-label","Close"),f.textContent="\xD7",m.appendChild(k),m.appendChild(f);let w=document.createElement("div");w.className="aipkit-modal-body";let E=document.createElement("p");E.className="aipkit_cw_alert_modal_message",E.textContent=i||"";let y=document.createElement("div");y.className="aipkit_cw_alert_modal_actions";let I=document.createElement("button");I.type="button",I.className="aipkit_btn aipkit_btn-secondary",I.textContent=d;let S=document.createElement("button");S.type="button",S.className="aipkit_btn aipkit_btn-primary",S.textContent=t,y.appendChild(I),y.appendChild(S),w.appendChild(E),w.appendChild(y),u.appendChild(m),u.appendChild(w),p.appendChild(u),document.body.appendChild(p);let h=M=>{M.key==="Escape"&&(r(),l&&l())};p.__aipkitAlertKeydown=h,document.addEventListener("keydown",h),f.addEventListener("click",()=>{r(),l&&l()}),I.addEventListener("click",()=>{r(),l&&l()}),S.addEventListener("click",()=>{r(),a&&a()}),window.requestAnimationFrame(()=>{p.classList.add("aipkit-active"),S.focus()}),g=p}window.aipkit_showAlertModal=n,window.aipkit_showConfirmModal=e,window.aipkit_closeAlertModal=r})();(function(){"use strict";function g(o,r){if(!o||!r||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(o.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(o,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(o,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary();else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let n=window.aipkit_escapeHtml||function(e){return e};r.innerHTML='<option value="">'+n("Models unavailable (Data Object Missing)")+"</option>",r.disabled=!0}}window.aipkit_handleProviderModelDropdowns=g})();(function(){"use strict";function g(o){if(!o){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let r=document.getElementById("aipkit_content_writer_temperature_value");r?o.dataset.listenerAttached||(o.addEventListener("input",()=>r.textContent=o.value),o.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=g})();(function(){"use strict";function g(o){if(!o){console.warn("Copy Button Handler: Button element not provided.");return}o.dataset.listenerAttached||(o.addEventListener("click",()=>{let r=document.getElementById("aipkit_cw_generated_title_display"),n=document.getElementById("aipkit_cw_generated_content_area"),e="";r&&r.style.display!=="none"&&(e+=r.textContent+`

`),n&&(e+=n.innerText),e.trim()&&navigator.clipboard.writeText(e.trim()).then(()=>{let i=o.querySelector(".dashicons");if(i){let c=i.className;i.className="dashicons dashicons-yes",setTimeout(()=>{i.className=c},1500)}}).catch(i=>console.error("Failed to copy: ",i))}),o.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=g})();(function(){"use strict";function g(){let r=document.getElementById("aipkit_cw_single_output_wrapper"),n=document.getElementById("aipkit_cw_output_card"),e=document.getElementById("aipkit_content_writer_output_display"),i=document.getElementById("aipkit_cw_generated_content_area"),c=document.querySelector(".aipkit_content_writer_output_actions"),s=document.getElementById("aipkit_cw_status_display_container"),t=document.getElementById("aipkit_cw_generated_title_display"),d=document.getElementById("aipkit_cw_meta_chunk"),a=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),l=document.getElementById("aipkit_cw_generated_meta_desc"),p=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),_=document.getElementById("aipkit_cw_generated_focus_keyword"),u=document.getElementById("aipkit_cw_excerpt_output_wrapper"),m=document.getElementById("aipkit_cw_generated_excerpt"),k=document.getElementById("aipkit_cw_tags_output_wrapper"),f=document.getElementById("aipkit_cw_generated_tags"),w=document.getElementById("aipkit_cw_image_data_holder"),E=document.getElementById("aipkit_content_writer_copy_btn"),y=document.getElementById("aipkit_content_writer_clear_btn");if(r&&(r.style.display="none"),n&&(n.style.display="none"),e&&i){i.classList.remove("is-streaming");let I=i.closest(".aipkit_cw_output_chunk--primary");I&&I.classList.remove("has-overflow"),i.innerHTML="",e.scrollTop=0,c&&(c.style.display="none"),E&&(E.disabled=!0),y&&(y.disabled=!0),typeof window.aipkit_resetContentWriterRawHtml=="function"&&window.aipkit_resetContentWriterRawHtml(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction();let S=document.getElementById("aipkit_content_writer_form_status");S&&(S.textContent=""),s&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():s&&(s.style.display="none"),t&&(t.style.display="none",t.textContent=""),d&&(d.style.display="none"),a&&(a.style.display="none"),l&&(l.value=""),p&&(p.style.display="none"),_&&(_.value=""),u&&(u.style.display="none"),m&&(m.value=""),k&&(k.style.display="none"),f&&(f.value=""),w&&(w.value=""),typeof window.aipkit_updateMetaCountBadge=="function"&&window.aipkit_updateMetaCountBadge(),typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_resetContentWriterPreviewCounter=="function"&&window.aipkit_resetContentWriterPreviewCounter()}}function o(r,n){if(!r){console.warn("Clear Button Handler: Button element not provided.");return}r.dataset.listenerAttached||(r.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),r.dataset.listenerAttached="true")}window.aipkit_handleClearButton=o,window.aipkit_clearContentWriterOutput=g})();(function(){"use strict";function g(){return document.getElementById("aipkit_cw_expand_preview_btn")}function o(d){return d?d.closest(".aipkit_cw_output_chunk--primary"):document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_chunk--primary")}function r(d,a,l){return d?a==="restore"?d.dataset.labelRestore||l:d.dataset.labelExpand||l:l}function n(d,a){if(!d)return;let l=d.querySelector(".aipkit_cw_expand_label"),p=d.querySelector(".dashicons"),_=a?r(d,"restore","Restore preview"):r(d,"expand","Expand preview");l&&(l.textContent=_),d.setAttribute("title",_),d.setAttribute("aria-pressed",a?"true":"false"),p&&(p.classList.toggle("dashicons-fullscreen-alt",!a),p.classList.toggle("dashicons-fullscreen-exit-alt",a))}function e(d){let a=document.getElementById("aipkit_content_writer_output_display");!a||!d||(a.scrollHeight>a.clientHeight?d.classList.add("has-overflow"):d.classList.remove("has-overflow"))}function i(d){let a=g(),l=o(a);!a||!l||(d?l.classList.add("is-expanded"):l.classList.remove("is-expanded"),n(a,d),requestAnimationFrame(()=>e(l)))}function c(d){let a=g();a&&(a.disabled=!d,a.setAttribute("aria-disabled",d?"false":"true"),d||i(!1))}function s(){i(!1)}function t(){document.body?.dataset?.aipkitPreviewToggleAttached!=="true"&&(document.addEventListener("click",d=>{let a=d.target.closest("#aipkit_cw_expand_preview_btn");if(!a||a.disabled)return;let l=o(a);if(!l)return;let p=l.classList.contains("is-expanded");i(!p)}),document.body&&(document.body.dataset.aipkitPreviewToggleAttached="true"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t(),window.aipkit_resetContentWriterPreviewSize=s,window.aipkit_setContentWriterPreviewExpandEnabled=c})();(function(){"use strict";let g=f=>!f||typeof f!="object"?"":f.media_library_url||f.url||f.src||f.image_url||f.preview_url||"",o=f=>f==null?"":String(f).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=()=>{if(typeof window.aipkit_getContentWriterRawHtml=="function")return window.aipkit_getContentWriterRawHtml()||"";let f=document.getElementById("aipkit_cw_generated_content_area");return f?f.innerHTML:""},n=()=>{let f=document.getElementById("aipkit_cw_generated_content_area");if(!f)return;let w=r();w&&(f.innerHTML=w)},e=()=>({preview:document.getElementById("aipkit_cw_image_preview"),featuredWrap:document.getElementById("aipkit_cw_featured_image"),featuredImg:document.getElementById("aipkit_cw_featured_image_img"),inlineToggle:document.getElementById("aipkit_cw_inline_images_toggle"),inlineCount:document.getElementById("aipkit_cw_inline_images_count"),inlineGrid:document.getElementById("aipkit_cw_inline_images_grid")}),i=(f,w,E="")=>{f&&(f.hidden=!w,w?f.style.display=E||"":f.style.display="none")},c=f=>{f&&(f.innerHTML="",i(f,!1,"grid"))},s=()=>{let f=e();f.preview&&(f.featuredImg&&f.featuredImg.removeAttribute("src"),i(f.featuredWrap,!1,"flex"),f.inlineToggle&&(f.inlineToggle.setAttribute("aria-expanded","false"),f.inlineToggle.classList.remove("is-open")),f.inlineCount&&(f.inlineCount.textContent="0"),c(f.inlineGrid),i(f.inlineToggle,!1,"inline-flex"),i(f.preview,!1,"flex"),n())},t=f=>{!f.inlineToggle||!f.inlineGrid||f.inlineToggle.dataset.listenerAttached!=="true"&&(f.inlineToggle.addEventListener("click",()=>{let w=f.inlineToggle.getAttribute("aria-expanded")==="true";f.inlineToggle.setAttribute("aria-expanded",w?"false":"true"),f.inlineToggle.classList.toggle("is-open",!w),i(f.inlineGrid,!w,"grid")}),f.inlineToggle.dataset.listenerAttached="true")},d=(f,w)=>{if(!f.inlineToggle||!f.inlineGrid||!w.length)return!1;c(f.inlineGrid);let E=document.createDocumentFragment();return w.forEach((y,I)=>{let S=document.createElement("div");S.className="aipkit_cw_inline_image";let h=document.createElement("img");h.src=y,h.alt=`Generated image ${I+1}`,h.loading="lazy",h.decoding="async",S.appendChild(h),E.appendChild(S)}),f.inlineGrid.appendChild(E),i(f.inlineGrid,!1,"grid"),i(f.inlineToggle,!0,"inline-flex"),f.inlineToggle.setAttribute("aria-expanded","false"),f.inlineToggle.classList.remove("is-open"),f.inlineCount&&(f.inlineCount.textContent=String(w.length)),t(f),!0},a=(f,w,E)=>{let y=g(f);if(!y)return"";let I=f.alt||f.revised_prompt||f.caption||"Image",S=[];return["left","right","center","none"].includes(w)&&S.push(`align${w}`),S.push(`size-${E||"large"}`),`<img class="${o(S.join(" "))}" src="${o(y)}" alt="${o(I)}" loading="lazy" decoding="async" />`},l=(f,w)=>w.length?`${f}

${w.join(`

`)}`:f,p=(f,w,E)=>{if(!w.length)return f;let y=w.shift(),I=f.toLowerCase(),S=`</${E}>`,h=I.indexOf(S);return h!==-1?f=f.slice(0,h+S.length)+`

${y}

`+f.slice(h+S.length):f+=`

${y}`,l(f,w)},_=(f,w,E,y)=>{if(!w.length)return f;if(!y||y<=0)return l(f,w);let I=f.split(new RegExp(`(</${E}>)`,"ig")),S="",h=0,M=0;for(let b=0;b<I.length;b+=1)S+=I[b],b%2===1&&(h+=1,h%y===0&&M<w.length&&(S+=`

${w[M]}

`,M+=1));for(;M<w.length;)S+=`

${w[M]}`,M+=1;return S},u=f=>{let w=document.getElementById("aipkit_cw_generated_content_area");if(!w)return;let E=Array.isArray(f?.in_content_images)?f.in_content_images:[];if(!E.length){n();return}let y=r();if(y||(y=w.innerHTML),!y)return;let I=document.getElementById("aipkit_content_writer_form"),S=f?.placement_settings?.placement||I?.elements.image_placement?.value||"after_first_h2",h=f?.placement_settings?.param_x||I?.elements.image_placement_param_x?.value||2,M=parseInt(h,10)||2,b=I?.elements.image_alignment?.value||"none",A=I?.elements.image_size?.value||"large",x=E.map(C=>a(C,b,A)).filter(Boolean);if(!x.length){n();return}let v=y;switch(S){case"after_first_h2":v=p(v,x,"h2");break;case"after_first_h3":v=p(v,x,"h3");break;case"after_every_x_h2":v=_(v,x,"h2",M);break;case"after_every_x_h3":v=_(v,x,"h3",M);break;case"after_every_x_p":v=_(v,x,"p",M);break;case"at_end":default:v=l(v,x);break}w.innerHTML=v,typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()},m=(f,w)=>!f.featuredWrap||!f.featuredImg||!w?!1:(f.featuredImg.src=w,i(f.featuredWrap,!0,"flex"),!0),k=f=>{let w=e();if(!w.preview)return;s();let E=f;if(typeof f=="string")try{E=JSON.parse(f)}catch{return}if(!E||typeof E!="object")return;let I=(Array.isArray(E.in_content_images)?E.in_content_images:[]).map(g).filter(Boolean),S=E.featured_image_url||g(E.featured_image)||g(E.featured_image_data),h=m(w,S),M=d(w,I);u(E),(h||M)&&i(w.preview,!0,"flex")};window.aipkit_renderContentWriterImagePreview=k,window.aipkit_clearContentWriterImagePreview=s})();(function(){"use strict";function g(){let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let n=r.elements.generate_meta_description,e=r.elements.generate_focus_keyword,i=r.elements.generate_excerpt,c=r.elements.generate_tags,s=r.querySelector(".aipkit_cw_prompt_row--meta"),t=r.querySelector(".aipkit_cw_prompt_row--keyword"),d=r.querySelector(".aipkit_cw_prompt_row--excerpt"),a=r.querySelector(".aipkit_cw_prompt_row--tags"),l=!!(n&&n.checked),p=!!(e&&e.checked),_=!!(i&&i.checked),u=!!(c&&c.checked),m=(f,w)=>{if(!f)return;f.classList.toggle("aipkit_popover_option_row--disabled",!w);let E=f.querySelector(".aipkit_cw_prompt_trigger");E&&(E.disabled=!w,E.setAttribute("aria-disabled",w?"false":"true"))};m(s,l),m(t,p),m(d,_),m(a,u);let k=r.querySelector(".aipkit_cw_prompt_flyout.is-open");if(k){let f=[];l||f.push("aipkit_cw_meta_prompt_flyout"),p||f.push("aipkit_cw_keyword_prompt_flyout"),_||f.push("aipkit_cw_excerpt_prompt_flyout"),u||f.push("aipkit_cw_tags_prompt_flyout"),f.includes(k.id)&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout()}}function o(){let r=document.getElementById("aipkit_content_writer_form");if(!r||r.dataset.optionToggleListenerAttached)return;let n=r.elements.generate_meta_description,e=r.elements.generate_focus_keyword,i=r.elements.generate_excerpt,c=r.elements.generate_tags;n&&n.addEventListener("change",g),e&&e.addEventListener("change",g),i&&i.addEventListener("change",g),c&&c.addEventListener("change",g),r.dataset.optionToggleListenerAttached="true",g()}window.aipkit_cw_toggleCustomOptionPrompts=g,window.aipkit_cw_initOptionPromptToggles=o})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.warn("Prompt Toggle Handler: Content writer container not found.");return}o.querySelectorAll(".aipkit_textarea_toggle").forEach(e=>{let i=e.dataset.target;if(!i)return;let c=`aipkit-cw-prompt-${i}-state`,s=localStorage.getItem(c),t=document.getElementById(i),d=e.querySelector(".dashicons");t&&d&&(s==="expanded"?(t.classList.remove("aipkit_collapsed"),d.classList.remove("dashicons-plus-alt2"),d.classList.add("dashicons-minus"),e.title="Collapse"):(t.classList.add("aipkit_collapsed"),d.classList.remove("dashicons-minus"),d.classList.add("dashicons-plus-alt2"),e.title="Expand"))});let n="data-prompt-toggle-listener-attached";o.getAttribute(n)||(o.addEventListener("click",function(e){let i=e.target.closest(".aipkit_textarea_toggle");if(!i)return;let c=i.dataset.target,s=document.getElementById(c),t=i.querySelector(".dashicons");if(!s||!t){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",i);return}let d=s.classList.toggle("aipkit_collapsed");d?(t.classList.remove("dashicons-minus"),t.classList.add("dashicons-plus-alt2"),i.title="Expand"):(t.classList.remove("dashicons-plus-alt2"),t.classList.add("dashicons-minus"),i.title="Collapse");let a=`aipkit-cw-prompt-${c}-state`;localStorage.setItem(a,d?"collapsed":"expanded")}),o.setAttribute(n,"true"))}window.aipkit_initPromptToggles=g})();(function(){"use strict";let g="";function o(p){g=typeof p=="string"?p:""}function r(){return g||""}function n(){g=""}function e(){let p=document.getElementById("aipkit_cw_meta_chunk");if(!p)return;let _=!1;p.querySelectorAll(".aipkit_cw_meta_field").forEach(m=>{window.getComputedStyle(m).display!=="none"&&(_=!0)}),p.style.display=_?"block":"none"}function i(){let p=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");p&&(p.style.display="flex")}function c(){let p=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");p&&(p.style.display="none")}function s(){let p=document.getElementById("aipkit_cw_article_counter"),_=document.getElementById("aipkit_cw_generated_content_area");if(!p||!_)return;if(_.querySelector(".aipkit_spinner")){p.textContent="",p.hidden=!0;return}let m=(_.textContent||"").trim(),k=m?m.split(/\s+/).length:0;if(!k){p.textContent="",p.hidden=!0;return}let f=k===1?"word":"words";p.textContent=`${k} ${f}`,p.hidden=!1}function t(){let p=document.getElementById("aipkit_cw_generated_content_area");if(!p)return;let _=!1,u=()=>{_||(_=!0,window.requestAnimationFrame(()=>{_=!1,s()}))};new MutationObserver(()=>{u()}).observe(p,{childList:!0,subtree:!0,characterData:!0}),u()}function d(){let p=document.getElementById("aipkit_cw_generated_meta_desc"),_=document.querySelector("#aipkit_content_writer_container .aipkit_cw_meta_char_count");if(!p||!_)return;function u(){let m=p.value.length,k=m>=120&&m<=160;_.textContent=`${m}/160`,_.style.color=k?"#16a34a":m>160?"#dc2626":"#94a3b8"}p.addEventListener("input",u),u()}function a(){if(!document.getElementById("aipkit_cw_meta_chunk"))return;let _=new MutationObserver(function(m){m.forEach(function(k){k.type==="attributes"&&k.attributeName==="style"&&e()})});["aipkit_cw_excerpt_output_wrapper","aipkit_cw_tags_output_wrapper","aipkit_cw_focus_keyword_output_wrapper","aipkit_cw_meta_desc_output_wrapper"].forEach(m=>{let k=document.getElementById(m);k&&_.observe(k,{attributes:!0,attributeFilter:["style"]})})}function l(){d(),a(),t()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),window.aipkit_updateMetaChunkVisibility=e,window.aipkit_showPrimaryAction=i,window.aipkit_hidePrimaryAction=c,window.aipkit_updateContentWriterPreviewCounter=s,window.aipkit_setContentWriterRawHtml=o,window.aipkit_getContentWriterRawHtml=r,window.aipkit_resetContentWriterRawHtml=n,window.aipkit_resetContentWriterPreviewCounter=function(){let p=document.getElementById("aipkit_cw_article_counter");p&&(p.textContent="",p.hidden=!0)}})();(function(){"use strict";function g(i){if(!i)return;let c=i.querySelector("#aipkit_content_writer_provider"),s=i.querySelector("#aipkit_content_writer_model"),t=i.querySelector(".aipkit_cw_reasoning_effort_field"),d=i.querySelector("#aipkit_content_writer_reasoning_effort");if(!c||!s||!t||!d){t&&(t.style.display="none");return}let a=(c.value||"").toLowerCase(),p=(s.value||"").toLowerCase(),_=p.startsWith("o1")||p.startsWith("o3")||p.startsWith("o4"),u=p.includes("gpt-5");a==="openai"&&(_||u)?(t.classList.contains("aipkit_popover_option_row")||t.classList.contains("aipkit_ai_behavior_control")?t.style.display="flex":t.style.display="block",o(i,p)):t.style.display="none"}function o(i,c){let s=i.querySelector("#aipkit_content_writer_reasoning_effort"),t=i.querySelectorAll(".aipkit_ai_reasoning_option");if(!s||!t.length)return;let d=r(c),a=new Set(d.allowed);t.forEach(m=>{let k=m.querySelector(".aipkit_ai_reasoning_input");if(!k)return;let f=k.value==="minimal"?"low":k.value,w=a.has(f);m.style.display=w?"":"none",w||(k.checked=!1)});let l=s.value||"";l==="minimal"&&(l="low");let p=i.querySelector(".aipkit_ai_reasoning_input:checked");!a.has(l)&&p&&(l=p.value),a.has(l)||(l=d.defaultValue),a.has(l)||(l=d.allowed[0]||"");let _=s.value;l&&(s.value=l);let u=i.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(u){u.checked=!0,i.querySelectorAll(".aipkit_ai_reasoning_option").forEach(k=>k.classList.remove("aipkit_ai_reasoning_option--selected"));let m=u.closest(".aipkit_ai_reasoning_option");m&&m.classList.add("aipkit_ai_reasoning_option--selected")}_!==s.value&&s.dispatchEvent(new Event("change",{bubbles:!0}))}function r(i){return e(i)?{allowed:["high"],defaultValue:"high"}:i.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(i)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(i){let c=i.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let s=i.match(/gpt-(\d+)/);return s?Number.parseInt(s[1],10)>=6:!1}function e(i){return/gpt-5(\.\d+)?-pro/.test(i)}window.aipkit_cw_toggleReasoningEffort=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(k){return k},o=["pexels_api_key","pixabay_api_key"],r={},n={},e="",i=!1,c=!1,s="";function t(k){o.forEach(f=>{let w=k.querySelector(`.aipkit_cw_stock_api_key[name="${CSS.escape(f)}"]`);r[f]=w?w.value.trim():"",n[f]=!1})}function d(k){let f=k.querySelector("#aipkit_cw_replicate_api_key");e=f?f.value.trim():"",i=!1}async function a(k){if(!k||!k.name)return;let f=k.name;if(!o.includes(f))return;let w=k.value.trim(),E=r[f]||"";if(w===E||n[f]||typeof window.aipkit_apiRequest!="function")return;let y=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,I=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,S=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;n[f]=!0,r[f]=w,y&&y("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[f]:w}),I&&I("Updated")}catch(h){r[f]=E,S&&S(`Error: ${h.message||"Failed to save."}`),console.error("Content Writer Stock Image Key Save Error:",h)}finally{n[f]=!1}}async function l(k){if(!k)return;let f=k.value.trim(),w=e||"";if(f===w||i||typeof window.aipkit_apiRequest!="function")return;let E=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,y=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,I=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;i=!0,e=f,E&&E("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:f}),y&&y("Updated"),p(f,!0)}catch(S){e=w,I&&I(`Error: ${S.message||"Failed to save."}`),console.error("Content Writer Replicate Key Save Error:",S)}finally{i=!1}}function p(k,f=!1){let w=(k||"").trim();if(!w||c||!f&&w===s||typeof window.aipkit_queueProviderSync!="function")return;let E=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,y=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,I=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;c=!0,E&&E("Syncing models..."),window.aipkit_queueProviderSync("Replicate",{silent:!0,targetSelectId:"aipkit_cw_image_model",propagateError:!0}).then(()=>{s=w,y&&y("Models synced!")}).catch(S=>{I&&I(`Error: ${S.message||"Sync failed."}`),console.error("Content Writer Replicate Sync Error:",S)}).finally(()=>{c=!1})}function _(k){let f=document.getElementById("aipkit_cw_image_model");if(!f)return;let w=window.aipkit_dashboard?.imageGeneratorModels;if(!w){console.error("Image models data not found in aipkit_dashboard object."),f.innerHTML='<option value="">Error: Models not loaded</option>';return}let E=w[k.toLowerCase()]||[],y=window.aipkit_cw_template_state?.pendingImageModelSelection,I=f.value,S=y||I;f.innerHTML="",E.length>0?(E.forEach(h=>{f.appendChild(new Option(h.name,h.id))}),f.querySelector(`option[value="${CSS.escape(S)}"]`)?f.value=S:f.options.length>0&&(f.selectedIndex=0)):f.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function u(){let k=document.getElementById("aipkit_content_writer_container");if(!k)return;let f=k.querySelector(".aipkit_cw_image_enable_toggle"),w=k.querySelector("#aipkit_cw_generate_featured_image"),E=k.querySelector("#aipkit_cw_image_placement"),y=k.querySelector("#aipkit_cw_image_provider"),I=document.getElementById("aipkit_content_writer_form"),S=I?I.classList.contains("aipkit_cw_mode_existing_images"):!1,h=k.querySelectorAll(".aipkit_cw_image_settings_container"),M=k.querySelector(".aipkit_cw_prompt_row--image"),b=k.querySelector(".aipkit_cw_prompt_row--featured"),A=k.querySelector(".aipkit_cw_image_metadata_chunk"),x=Array.from(k.querySelectorAll(".aipkit_cw_image_metadata_subtoggle")).map(le=>{let ue=le.closest(".aipkit_image_toggle_card");return{toggle:le,button:ue?ue.querySelector(".aipkit_cw_image_metadata_prompt_btn"):null}});if(!f||!w)return;let v=le=>le?le.closest(".aipkit_popover_option_row")||le.closest(".aipkit_form-group"):null,C=(le,ue)=>{le&&(ue?le.style.display=le.classList.contains("aipkit_popover_option_row")?"flex":"block":le.style.display="none")},P=f.checked,$=w.checked,U=P||$||S,B=y?y.value:"",D=B==="pexels"||B==="pixabay";h.forEach(le=>{le.style.display=U?"block":"none"});let N=P&&!D,R=$&&!D,j=(le,ue)=>{if(!le)return;le.style.display="",le.classList.toggle("aipkit_popover_option_row--disabled",!ue);let be=le.querySelector(".aipkit_cw_prompt_trigger");be&&(be.disabled=!ue,be.setAttribute("aria-disabled",ue?"false":"true"))};j(M,N),j(b,R);let L=S||U;if(A&&(A.style.display=L?"block":"none"),A){let le=A.querySelector(".aipkit_image_settings_chunk_header--collapsible"),ue=A.querySelector(".aipkit_image_settings_chunk_body--collapsible");if(le&&ue){let be=S;le.setAttribute("aria-expanded",be?"true":"false"),ue.setAttribute("aria-hidden",be?"false":"true")}}x.length>0&&x.forEach(({toggle:le,button:ue})=>{let be=L&&le.checked;ue&&(ue.disabled=!be,ue.setAttribute("aria-disabled",be?"false":"true"))});let K=k.querySelector(".aipkit_cw_prompt_flyout.is-open"),V=K?k.querySelector(`.aipkit_cw_image_metadata_prompt_btn[data-aipkit-flyout-target="${CSS.escape(K.id)}"]`):null,ee=V?V.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_cw_image_metadata_subtoggle"):null,J=ee&&L?ee.checked:!1;if(K&&(K.id==="aipkit_cw_image_prompt_flyout"&&!N||K.id==="aipkit_cw_featured_image_prompt_flyout"&&!R||ee&&!J&&["aipkit_cw_image_title_prompt_flyout","aipkit_cw_image_alt_text_prompt_flyout","aipkit_cw_image_caption_prompt_flyout","aipkit_cw_image_description_prompt_flyout"].includes(K.id))&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),U){let le=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],ue=k.querySelector("#aipkit_cw_replicate_options"),be=k.querySelector("#aipkit_cw_pexels_options"),ze=k.querySelector("#aipkit_cw_pixabay_options"),Me=k.querySelector("#aipkit_cw_image_model_group");if(le.forEach(Ue=>{let vt=k.querySelector(Ue),we=v(vt);C(we,P)}),E){let Ue=k.querySelector(".aipkit_cw_image_placement_x_field");if(Ue){let vt=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(E.value);C(Ue,P&&vt)}}ue&&(ue.style.display=B==="replicate"?"block":"none"),be&&(be.style.display=D&&B==="pexels"?"block":"none"),ze&&(ze.style.display=D&&B==="pixabay"?"block":"none"),Me&&(Me.style.display=D?"none":"");let rt=k.querySelector("#aipkit_cw_image_model_wrapper");if(rt&&(rt.style.display=D?"none":""),!D&&B&&_(B),B==="replicate"){let Ue=k.querySelector("#aipkit_cw_replicate_api_key");p(Ue?Ue.value:"",!1)}}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}function m(){let k=document.getElementById("aipkit_content_writer_container");k&&(k.dataset.imageHandlerAttached||(t(k),d(k),k.addEventListener("change",function(f){let w=f.target;if(w&&w.matches(".aipkit_cw_stock_api_key")){a(w);return}if(w&&w.matches(".aipkit_cw_replicate_api_key")){l(w);return}w.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider, .aipkit_cw_image_metadata_subtoggle")&&u()}),k.addEventListener("click",function(f){let w=f.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!w)return;let E=w.getAttribute("aria-expanded")==="true",y=w.getAttribute("aria-controls"),I=y?document.getElementById(y):null;w.setAttribute("aria-expanded",E?"false":"true"),I&&I.setAttribute("aria-hidden",E?"true":"false")}),u(),k.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=m,window.aipkit_updateImageSettingsUI=u})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(s){return s};function o(s){if(!s)return;let t=s.querySelector(".aipkit_cw_vector_store_toggle"),d=s.querySelectorAll(".aipkit_cw_vector_store_settings_container");if(t&&d.length>0){let a=t.checked;d.forEach(l=>{l.style.display=a?"block":"none"}),a&&r(s)}}function r(s){if(!s)return;let t=s.querySelector(".aipkit_cw_vector_store_provider_select");if(!t)return;let d=t.value,a=s.querySelector(".aipkit_cw_vector_openai_field"),l=s.querySelector(".aipkit_cw_vector_pinecone_field"),p=s.querySelector(".aipkit_cw_vector_qdrant_field"),_=s.querySelector(".aipkit_cw_vector_embedding_config_row"),u=(m,k)=>{m&&(m.style.display=k?"block":"none")};if(u(a,d==="openai"),u(l,d==="pinecone"),u(p,d==="qdrant"),_){let m=d==="pinecone"||d==="qdrant";if(_.style.display=m?"block":"none",m){let k=_.querySelector(".aipkit_cw_vector_embedding_provider_select");k&&n(k.value)}}}function n(s){let t=document.getElementById("aipkit_cw_vector_embedding_model");if(!t)return;let a=(window.aipkit_dashboard?.embeddingModels||{})[s.toLowerCase()]||[],l=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";t.innerHTML=`<option value="">${g("-- Select Model --")}</option>`,a.length>0?(a.forEach(p=>{if(p&&p.id){let _=new Option(g(p.name||p.id),p.id);p.id===l&&(_.selected=!0),t.appendChild(_)}}),t.disabled=!1):(t.disabled=!0,t.innerHTML=`<option value="">${g("-- No models found --")}</option>`)}function e(s){if(!s)return;let t=s.getAttribute("aria-expanded")==="true",d=s.getAttribute("aria-controls"),a=document.getElementById(d);a&&(s.setAttribute("aria-expanded",!t),a.setAttribute("aria-hidden",t))}function i(s){if(!s)return;let t=document.getElementById(s.id+"_value");if(!t)return;let d=s.value;s.id==="aipkit_cw_vector_store_confidence_threshold"&&(d=d+"%"),t.textContent=d}function c(){let s=document.getElementById("aipkit_content_writer_container");if(!s||s.dataset.vectorSettingsHandlerAttached)return;s.addEventListener("change",function(d){let a=d.target;if(a.matches(".aipkit_cw_vector_store_toggle")){let l=a.closest(".aipkit_vector_settings_redesigned")||a.closest(".aipkit_popover_options_list")||s;o(l)}else if(a.matches(".aipkit_cw_vector_store_provider_select")){let l=a.closest(".aipkit_vector_settings_redesigned")||a.closest(".aipkit_cw_vector_store_settings_container")||s;r(l)}else a.matches(".aipkit_cw_vector_embedding_provider_select")&&n(a.value);typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),s.addEventListener("input",function(d){let a=d.target;a.matches(".aipkit_vector_slider")&&i(a)}),s.addEventListener("click",function(d){let l=d.target.closest(".aipkit_vector_settings_chunk_header--collapsible");l&&(d.preventDefault(),e(l))}),s.querySelectorAll(".aipkit_vector_settings_redesigned, .aipkit_popover_options_list").forEach(d=>{d.querySelector(".aipkit_cw_vector_store_toggle")&&o(d)}),s.querySelectorAll(".aipkit_vector_slider").forEach(d=>{i(d)}),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),s.dataset.vectorSettingsHandlerAttached="true"}window.aipkit_initContentWriterVectorSettings=c,window.aipkit_cw_toggleVectorSettingsContainer=o,window.aipkit_cw_toggleProviderSpecificFields=r,window.aipkit_cw_populateEmbeddingModelSelect=n})();(function(){"use strict";function g(s){if(!s)return;let t=s.querySelector("#aipkit_content_writer_post_status"),d=s.querySelector(".aipkit_post_smart_schedule_container");if(!t)return;let a=t.value==="publish";d&&(d.style.display=a?"block":"none"),a&&o(s)}function o(s){if(!s)return;let t=s.querySelector('input[name="schedule_mode"]:checked'),d=s.querySelector(".aipkit_post_smart_schedule_fields");if(!d)return;let a=t&&t.value==="smart";d.style.display=a?"flex":"none"}function r(s){if(!s)return;let t=s.getAttribute("aria-expanded")==="true",d=s.getAttribute("aria-controls"),a=document.getElementById(d);a&&(s.setAttribute("aria-expanded",!t),a.setAttribute("aria-hidden",t))}function n(s){if(!s)return;let t=s.querySelector("#aipkit_content_writer_post_status");t&&(t.addEventListener("change",()=>{g(s)}),g(s)),s.querySelectorAll('input[name="schedule_mode"]').forEach(a=>{a.addEventListener("change",()=>{o(s)})}),o(s)}function e(){document.addEventListener("click",s=>{let t=s.target.closest(".aipkit_post_settings_chunk_header--collapsible");if(t){s.preventDefault(),r(t);return}}),document.addEventListener("keydown",s=>{if(s.key!=="Enter"&&s.key!==" ")return;let t=s.target.closest(".aipkit_post_settings_chunk_header--collapsible");t&&(s.preventDefault(),r(t))})}function i(s){let t=s.target;if(!t||!t.id||t.id!=="aipkit_cw_post_settings_popover")return;let d=t.querySelector(".aipkit_post_settings_redesigned");d&&!d.dataset.postSettingsInitialized&&(n(d),d.dataset.postSettingsInitialized="true")}function c(){e(),document.addEventListener("aipkit:popover:opened",i),document.querySelectorAll(".aipkit_post_settings_redesigned").forEach(d=>{d.dataset.postSettingsInitialized||(n(d),d.dataset.postSettingsInitialized="true")}),new MutationObserver(d=>{d.forEach(a=>{if(a.type==="attributes"&&a.attributeName==="aria-hidden"){let l=a.target.closest("#aipkit_cw_post_settings_popover");if(l&&a.target.getAttribute("aria-hidden")==="false"){let p=l.querySelector(".aipkit_post_settings_redesigned");p&&!p.dataset.postSettingsInitialized&&(n(p),p.dataset.postSettingsInitialized="true")}}})}).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["aria-hidden"]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.aipkit_initPostSettingsHandler=n})();(function(){"use strict";function g(o){let r=o||document.getElementById("aipkit_content_writer_container");if(!r)return;let n=r.querySelectorAll("[data-aipkit-vector-stores-dropdown]");n.length&&n.forEach(e=>{let i=e.closest(".aipkit_popover_option_main"),c=e.closest(".aipkit_cw_vector_openai_field"),s=i||c,t=s?s.querySelector(".aipkit_popover_multiselect_select"):null;if(!t)return;let d=e.querySelector(".aipkit_popover_multiselect_btn"),a=e.querySelector(".aipkit_popover_multiselect_label"),l=e.querySelector(".aipkit_popover_multiselect_panel"),p=e.querySelector(".aipkit_popover_multiselect_options"),_=e.dataset.placeholder||"Select stores",u=e.dataset.selectedLabel||"selected",m=()=>{if(!a)return;let y=Array.from(t.options).filter(S=>S.selected&&S.value);if(!y.length){a.textContent=_;return}let I=y.map(S=>S.textContent.trim()).filter(Boolean);if(I.length<=2){a.textContent=I.join(", ");return}a.textContent=`${I.length} ${u}`},k=()=>{if(!p)return;p.innerHTML="";let y=Array.from(t.options),I=y.filter(S=>S.value);if(!I.length){let S=document.createElement("div");S.className="aipkit_popover_multiselect_empty",S.textContent=y[0]?.textContent||"-- No Stores Found --",p.appendChild(S),m();return}I.forEach(S=>{let h=document.createElement("label");h.className="aipkit_popover_multiselect_item";let M=document.createElement("input");M.type="checkbox",M.value=S.value,M.checked=S.selected,M.disabled=S.disabled;let b=document.createElement("span");b.className="aipkit_popover_multiselect_text",b.textContent=S.textContent,h.appendChild(M),h.appendChild(b),p.appendChild(h)}),m()},f=()=>{if(!p){m();return}let y=new Set(Array.from(t.options).filter(I=>I.selected).map(I=>I.value));p.querySelectorAll('input[type="checkbox"]').forEach(I=>{I.checked=y.has(I.value)}),m()},w=y=>{if(!p)return;let I=Array.from(p.querySelectorAll('input[type="checkbox"]:checked'));if(I.length>2){let h=y&&y.target;if(h&&h.checked)h.checked=!1;else{let M=I[I.length-1];M&&(M.checked=!1)}}let S=Array.from(p.querySelectorAll('input[type="checkbox"]:checked')).map(h=>h.value);Array.from(t.options).forEach(h=>{h.selected=S.includes(h.value)}),t.dispatchEvent(new Event("change",{bubbles:!0})),m()},E=y=>{!e||!d||(e.classList.toggle("is-open",y),d.setAttribute("aria-expanded",y?"true":"false"),l&&(l.hidden=!y))};k(),f(),e.dataset.vectorStoreMultiselectAttached||(d&&(d.addEventListener("click",y=>{y.preventDefault(),E(!e.classList.contains("is-open"))}),d.addEventListener("keydown",y=>{y.key==="Escape"&&E(!1)})),document.addEventListener("click",y=>{e.classList.contains("is-open")&&(e.contains(y.target)||E(!1))}),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",w),p.dataset.listenerAttached="true"),t.dataset.listenerAttached||(t.addEventListener("change",f),t.dataset.listenerAttached="true"),e.dataset.vectorStoreMultiselectAttached="true")})}window.aipkit_initContentWriterVectorStoreMultiSelect=g})();(function(){"use strict";function g(o){let r=o||document.getElementById("aipkit_content_writer_container");if(!r)return;let n=r.querySelectorAll("[data-aipkit-categories-dropdown]");n.length&&n.forEach(e=>{let i=e.closest(".aipkit_popover_option_main"),c=e.closest(".aipkit_post_taxonomy_row"),s=i||c,t=s?s.querySelector('select[name="post_categories[]"]'):null;if(!t)return;let d=e.querySelector(".aipkit_popover_multiselect_btn"),a=e.querySelector(".aipkit_popover_multiselect_label"),l=e.querySelector(".aipkit_popover_multiselect_panel"),p=e.querySelector(".aipkit_popover_multiselect_options"),_=e.dataset.placeholder||"Select categories",u=e.dataset.selectedLabel||"selected",m=()=>{if(!a)return;let y=Array.from(t.options).filter(S=>S.selected&&S.value);if(!y.length){a.textContent=_;return}let I=y.map(S=>S.textContent.trim()).filter(Boolean);if(I.length<=2){a.textContent=I.join(", ");return}a.textContent=`${I.length} ${u}`},k=()=>{if(!p)return;p.innerHTML="";let y=Array.from(t.options),I=y.filter(S=>S.value);if(!I.length){let S=document.createElement("div");S.className="aipkit_popover_multiselect_empty",S.textContent=y[0]?.textContent||"-- No Categories --",p.appendChild(S),m();return}I.forEach(S=>{let h=document.createElement("label");h.className="aipkit_popover_multiselect_item";let M=document.createElement("input");M.type="checkbox",M.value=S.value,M.checked=S.selected,M.disabled=S.disabled;let b=document.createElement("span");b.className="aipkit_popover_multiselect_text",b.textContent=S.textContent,h.appendChild(M),h.appendChild(b),p.appendChild(h)}),m()},f=()=>{if(!p){m();return}let y=new Set(Array.from(t.options).filter(I=>I.selected).map(I=>I.value));p.querySelectorAll('input[type="checkbox"]').forEach(I=>{I.checked=y.has(I.value)}),m()},w=()=>{if(!p)return;let y=Array.from(p.querySelectorAll('input[type="checkbox"]:checked')).map(I=>I.value);Array.from(t.options).forEach(I=>{I.selected=y.includes(I.value)}),t.dispatchEvent(new Event("change",{bubbles:!0})),m()},E=y=>{!e||!d||(e.classList.toggle("is-open",y),d.setAttribute("aria-expanded",y?"true":"false"),l&&(l.hidden=!y))};k(),f(),e.dataset.categoriesMultiselectAttached||(d&&(d.addEventListener("click",y=>{y.preventDefault(),E(!e.classList.contains("is-open"))}),d.addEventListener("keydown",y=>{y.key==="Escape"&&E(!1)})),document.addEventListener("click",y=>{e.classList.contains("is-open")&&(e.contains(y.target)||E(!1))}),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",w),p.dataset.listenerAttached="true"),t.dataset.listenerAttached||(t.addEventListener("change",f),t.dataset.listenerAttached="true"),e.dataset.categoriesMultiselectAttached="true")})}window.aipkit_initContentWriterCategoriesMultiSelect=g})();(function(){"use strict";let g=" \xB7 ",o=d=>{if(!d)return"";let a=d.options?d.options[d.selectedIndex]:null;return a?a.textContent.trim():""},r=d=>!d||!d.options?[]:Array.from(d.options).filter(a=>a.selected&&a.value).map(a=>a.textContent.trim()).filter(Boolean),n=(d,a)=>{let l=d.filter(Boolean);return l.length?l.join(g):a},e=(d,a)=>{if(!d)return;d.textContent=a,d.title=a;let l=d.closest(".aipkit_cw_settings_summary_text");l&&(l.title=a);let p=d.dataset.aipkitPlaceholder,_=d.dataset.aipkitDisabledLabel,u="active";_&&a===_?u="disabled":p&&a===p&&(u="placeholder"),d.dataset.aipkitSummaryState=u},i=d=>String(d||"").trim().toLowerCase(),c=(d,a,l=null)=>{if(!d)return;let p="aipkit_settings_select_picker_icon--";d.classList.forEach(k=>{k.startsWith(p)&&d.classList.remove(k)});let _=i(a),u=!l||l.includes(_),m=!!(_&&u);d.hidden=!m,m&&d.classList.add(`${p}${_}`)},s=d=>{if(!d)return;let a=document.getElementById("aipkit_content_writer_form"),l=a?a.classList.contains("aipkit_cw_mode_existing_images"):!1,p=d.querySelector('[data-aipkit-cw-summary="ai"]');if(p){let k=p.dataset.aipkitPlaceholder||"Not set",f=o(d.querySelector("#aipkit_content_writer_provider")),w=o(d.querySelector("#aipkit_content_writer_model"));e(p,n([w],k));let E=d.querySelector("#aipkit_content_writer_provider")?.value,y=p.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon");c(y,E)}let _=d.querySelector('[data-aipkit-cw-summary="images"]');if(_){let k=_.dataset.aipkitPlaceholder||"Not set",f=_.dataset.aipkitDisabledLabel||"Disabled",w=["#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description"],E=d.querySelector("#aipkit_cw_generate_images_enabled"),y=d.querySelector("#aipkit_cw_generate_featured_image"),I=E&&E.checked||y&&y.checked,S=d.querySelector("#aipkit_cw_image_provider"),h=S?S.value:"",M=o(S),b=o(d.querySelector("#aipkit_cw_image_model")),A=_.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_settings_select_picker_icon"),x=["openai","google","azure","replicate"];if(c(A,h,x),l){c(A,"",x);let v=w.map(C=>{let P=d.querySelector(C);if(!P||!P.checked)return"";let $=P.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_image_toggle_label");return $?$.textContent.trim():""}).filter(Boolean);e(_,n(v,f||k))}else I?x.includes(h)?e(_,n([b],k)):["pexels","pixabay"].includes(h)?e(_,n([M],k)):e(_,n([M,b],k)):(c(A,"",x),e(_,f))}let u=d.querySelector('[data-aipkit-cw-summary="vector"]');if(u){let k=u.dataset.aipkitPlaceholder||"Not set",f=u.dataset.aipkitDisabledLabel||"Disabled",w=d.querySelector("#aipkit_cw_enable_vector_store"),E=u.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon"),y=["openai","pinecone","qdrant"];if(w&&!w.checked)c(E,"",y),e(u,f);else{let I=d.querySelector("#aipkit_cw_vector_store_provider"),S=I?I.value:"",h="";if(S==="openai"){let M=d.querySelector("#aipkit_cw_openai_vector_store_ids");h=r(M).join(", ")}else S==="pinecone"?h=o(d.querySelector("#aipkit_cw_pinecone_index_name")):S==="qdrant"&&(h=o(d.querySelector("#aipkit_cw_qdrant_collection_name")));c(E,S,y),e(u,n([h],k))}}let m=d.querySelector('[data-aipkit-cw-summary="post"]');if(m){let k=m.dataset.aipkitPlaceholder||"Not set",f=o(d.querySelector("#aipkit_content_writer_post_status"));e(m,n([f],k))}};function t(d){let a=d||document.getElementById("aipkit_content_writer_container");if(!a||a.dataset.cwSummaryAttached==="true")return;let l=["#aipkit_content_writer_provider","#aipkit_content_writer_model","#aipkit_cw_generate_images_enabled","#aipkit_cw_generate_featured_image","#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description","#aipkit_cw_image_provider","#aipkit_cw_image_model","#aipkit_cw_enable_vector_store","#aipkit_cw_vector_store_provider","#aipkit_cw_openai_vector_store_ids","#aipkit_cw_pinecone_index_name","#aipkit_cw_qdrant_collection_name","#aipkit_content_writer_categories","#aipkit_content_writer_post_author","#aipkit_content_writer_post_status"],p=_=>l.some(u=>_.matches(u));a.addEventListener("change",_=>{let u=_.target;!u||!p(u)||s(a)}),s(a),a.dataset.cwSummaryAttached="true"}window.aipkit_initContentWriterSettingsSummary=t,window.aipkit_updateContentWriterSettingsSummary=function(){let d=document.getElementById("aipkit_content_writer_container");s(d)}})();(function(){"use strict";let g=window.wp?.i18n?.__||function(v){return v},o="#aipkit_content_writer_provider, #aipkit_content_writer_model, #aipkit_cw_image_provider, #aipkit_cw_image_model, #aipkit_task_cw_image_provider, #aipkit_task_cw_image_model, #aipkit_cw_vector_store_provider, #aipkit_cw_vector_embedding_provider, #aipkit_task_cw_vector_store_provider, #aipkit_task_ce_vector_store_provider, #aipkit_task_cw_vector_embedding_provider, #aipkit_task_ce_vector_embedding_provider, #aipkit_task_content_indexing_target_store_provider, #aipkit_enhancer_insert_position_default, #aipkit_cw_pinecone_index_name, #aipkit_cw_qdrant_collection_name, #aipkit_cw_vector_embedding_model, #aipkit_task_cw_ai_provider, #aipkit_task_cw_ai_model, #aipkit_task_cc_ai_provider, #aipkit_task_cc_ai_model, #aipkit_task_ce_ai_provider, #aipkit_task_ce_ai_model",r=null,n=null,e=!1,i=new Set(["aipkit_content_writer_provider","aipkit_cw_image_provider","aipkit_cw_vector_store_provider","aipkit_cw_vector_embedding_provider","aipkit_task_cw_image_provider","aipkit_task_cw_vector_store_provider","aipkit_task_ce_vector_store_provider","aipkit_task_cw_vector_embedding_provider","aipkit_task_ce_vector_embedding_provider","aipkit_task_content_indexing_target_store_provider","aipkit_task_cw_ai_provider","aipkit_task_cc_ai_provider","aipkit_task_ce_ai_provider"]),c=v=>!!(v&&v.id&&i.has(v.id)),s=v=>!!(v&&v.dataset?.aipkitPickerIcons==="assistant-position"),t=v=>!!(v&&(c(v)||s(v)||v.id==="aipkit_cw_pinecone_index_name"||v.id==="aipkit_cw_qdrant_collection_name"||v.id==="aipkit_cw_vector_embedding_model")),d=(v,C)=>{if(!v)return!1;let P=a(C);return P?v.id==="aipkit_cw_image_provider"?["openai","google","azure","replicate"].includes(P):v.id==="aipkit_task_cw_image_provider"?["openai","google","azure","replicate"].includes(P):v.id==="aipkit_cw_vector_store_provider"?["openai","pinecone","qdrant"].includes(P):v.id==="aipkit_task_cw_vector_store_provider"||v.id==="aipkit_task_ce_vector_store_provider"||v.id==="aipkit_task_content_indexing_target_store_provider"?["openai","pinecone","qdrant"].includes(P):v.id==="aipkit_cw_vector_embedding_provider"?["openai","google","azure"].includes(P):v.id==="aipkit_task_cw_vector_embedding_provider"||v.id==="aipkit_task_ce_vector_embedding_provider"?["openai","google","azure"].includes(P):["openai","openrouter","google","azure","deepseek","ollama"].includes(P):!1},a=v=>String(v||"").trim().toLowerCase(),l=(v,C,P)=>{if(!v)return;let $="aipkit_settings_select_picker_icon--";v.classList.forEach(D=>{D.startsWith($)&&v.classList.remove(D)});let U=a(P),B=d(C,U);v.hidden=!B,B&&v.classList.add(`${$}${U}`)},p=(v,C)=>{if(!v)return;let P="aipkit_settings_select_picker_icon--assistant-";v.classList.forEach(U=>{U.startsWith(P)&&v.classList.remove(U)});let $=String(C||"").trim().toLowerCase();v.hidden=!$,$&&v.classList.add(`${P}${$}`)},_=v=>v&&(v.selectedOptions&&v.selectedOptions.length?v.selectedOptions[0]:v.querySelector("option[selected]"))?.dataset?.icon||"",u=v=>{if(!v)return"";let C=v.getAttribute("data-aipkit-picker-title");if(C)return C;let P=v.id&&document.querySelector(`label[for="${v.id}"]`)||v.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return P?P.textContent.trim():""},m=v=>{if(!v)return"";let C=v.selectedOptions&&v.selectedOptions.length?v.selectedOptions[0]:v.querySelector("option[selected]");if(C)return C.textContent.trim();let P=v.querySelector("option");return P?P.textContent.trim():""},k=v=>({buttonId:`${v}_picker_btn`,labelId:`${v}_picker_label`,popoverId:`${v}_picker_popover`,titleId:`${v}_picker_title`,searchId:`${v}_picker_search`,listId:`${v}_picker_list`}),f=v=>v?v.closest("#aipkit_cw_builder_sheet")||v.closest("#aipkit_content_writer_container")||v.closest("#aipkit_autogpt_container")||v.closest("#aipkit_ai_forms_container"):null,w=v=>{if(!v||!v.id)return null;let C=k(v.id),P=f(v);if(!P)return null;let $=document.getElementById(C.buttonId);if(!$){if($=document.createElement("button"),$.type="button",$.id=C.buttonId,$.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",$.setAttribute("data-aipkit-popover-target",C.popoverId),$.setAttribute("aria-controls",C.popoverId),$.setAttribute("aria-expanded","false"),$.dataset.aipkitPopoverPlacement="bottom",c(v)){$.classList.add("aipkit_settings_select_picker_btn--provider");let N=document.createElement("span");N.className="aipkit_settings_select_picker_icon",N.setAttribute("aria-hidden","true"),l(N,v,v.value),$.appendChild(N)}else if(s(v)){let N=document.createElement("span");N.className="aipkit_settings_select_picker_icon",N.setAttribute("aria-hidden","true"),p(N,_(v)),$.appendChild(N)}let B=document.createElement("span");B.className="aipkit_settings_select_picker_label",B.id=C.labelId,B.textContent=m(v)||g("Select","gpt3-ai-content-generator");let D=document.createElement("span");D.className="dashicons dashicons-arrow-down-alt2",D.setAttribute("aria-hidden","true"),$.appendChild(B),$.appendChild(D),v.insertAdjacentElement("beforebegin",$)}v.classList.contains("screen-reader-text")||v.classList.add("screen-reader-text");let U=document.getElementById(C.popoverId);if(!U){U=document.createElement("div"),U.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",U.id=C.popoverId,U.setAttribute("aria-hidden","true"),c(v)&&U.classList.add("aipkit_settings_select_picker_popover--provider");let B=document.createElement("div");B.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",B.setAttribute("role","dialog"),B.setAttribute("aria-labelledby",C.titleId);let D=document.createElement("div");D.className="aipkit_model_settings_popover_header";let N=document.createElement("span");N.className="aipkit_model_settings_popover_title",N.id=C.titleId,N.textContent=u(v)||g("Select","gpt3-ai-content-generator");let R=document.createElement("button");R.type="button",R.className="aipkit_model_settings_popover_close",R.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),R.innerHTML='<span class="dashicons dashicons-no-alt"></span>',D.appendChild(N),D.appendChild(R);let j=document.createElement("div");j.className="aipkit_model_settings_popover_body";let L=document.createElement("div");L.className="aipkit_settings_select_picker_search";let K=document.createElement("input");K.type="search",K.id=C.searchId,K.className="aipkit_form-input";let V=u(v),ee=V?`Search ${V.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");K.setAttribute("placeholder",ee),L.appendChild(K);let J=document.createElement("div");J.className="aipkit_settings_select_picker_list",J.id=C.listId,J.setAttribute("role","listbox"),j.appendChild(L),j.appendChild(J),B.appendChild(D),B.appendChild(j),U.appendChild(B),P.appendChild(U),t(v)&&(L.style.display="none")}return{ids:C,button:$,popover:U,label:document.getElementById(C.labelId),search:document.getElementById(C.searchId),list:document.getElementById(C.listId)}},E=v=>{let C=[];return v&&Array.from(v.children).forEach($=>{if($.tagName==="OPTGROUP"){let U=Array.from($.children).filter(B=>B.tagName==="OPTION").map(B=>({value:B.value,label:B.textContent.trim(),disabled:B.disabled,selected:B.selected,icon:B.dataset?.icon||""}));C.push({label:$.label,options:U})}else $.tagName==="OPTION"&&C.push({label:"",options:[{value:$.value,label:$.textContent.trim(),disabled:$.disabled,selected:$.selected,icon:$.dataset?.icon||""}]})}),C},y=(v,C,P="")=>{if(!v||!C)return;C.innerHTML="";let $=E(v),U=P.trim().toLowerCase(),B=!1;if($.forEach(D=>{let N=D.options.filter(R=>U?R.label.toLowerCase().includes(U):!0);if(N.length){if(D.label){let R=document.createElement("div");R.className="aipkit_settings_select_picker_group_label",R.textContent=D.label,C.appendChild(R)}N.forEach(R=>{let j=document.createElement("button");if(j.type="button",j.className="aipkit_settings_select_picker_item",R.disabled&&j.classList.add("is-disabled"),R.selected&&j.classList.add("is-active"),j.dataset.value=R.value,c(v)&&d(v,R.value)){let V=document.createElement("span");V.className="aipkit_settings_select_picker_icon",V.setAttribute("aria-hidden","true"),l(V,v,R.value),j.appendChild(V)}else if(s(v)&&R.icon){let V=document.createElement("span");V.className="aipkit_settings_select_picker_icon",V.setAttribute("aria-hidden","true"),p(V,R.icon),j.appendChild(V)}let L=document.createElement("span");L.className="aipkit_settings_select_picker_text",L.textContent=R.label||R.value;let K=document.createElement("span");K.className="dashicons dashicons-yes aipkit_settings_select_picker_check",K.setAttribute("aria-hidden","true"),j.appendChild(L),j.appendChild(K),C.appendChild(j),B=!0})}}),!B){let D=document.createElement("div");D.className="aipkit_settings_select_picker_empty",D.textContent=g(U?"No matches found.":"No options available.","gpt3-ai-content-generator"),C.appendChild(D)}},I=(v,C)=>{if(!v||!C)return;let P=m(v);if(C.textContent=P||g("Select","gpt3-ai-content-generator"),c(v)){let $=C.closest("button"),U=$?$.querySelector(".aipkit_settings_select_picker_icon"):null;l(U,v,v.value)}else if(s(v)){let $=C.closest("button"),U=$?$.querySelector(".aipkit_settings_select_picker_icon"):null;p(U,_(v))}},S=(v,C)=>{if(!v||!C)return;let P=v.getBoundingClientRect(),$=C.getBoundingClientRect(),U=$.width||320,B=$.height||0,D=window.innerWidth,N=window.innerHeight,R=12;if(v.dataset.aipkitPopoverPlacement==="bottom"){let K=P.left;K+U>D-R&&(K=P.right-U),K=Math.max(R,Math.min(K,D-U-R));let V=P.bottom+8;V+B>N-R&&(V=P.top-B-8),V=Math.max(R,Math.min(V,N-B-R)),C.style.left=`${Math.round(K)}px`,C.style.top=`${Math.round(V)}px`;return}let j=P.right+10;j+U>D-R&&(j=P.left-U-10),j=Math.max(R,Math.min(j,D-U-R));let L=P.top;L+B>N-R&&(L=N-B-R),L=Math.max(R,L),C.style.left=`${Math.round(j)}px`,C.style.top=`${Math.round(L)}px`},h=()=>{!r||!n||e||(e=!0,window.requestAnimationFrame(()=>{let v=r.querySelector(".aipkit_model_settings_popover_panel");S(n,v),e=!1}))},M=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),r=null,n=null)},b=(v,C,P)=>{if(!v||!C)return;r&&r!==C&&M(),r=C,n=v,C.classList.add("aipkit-active"),C.setAttribute("aria-hidden","false"),v.setAttribute("aria-expanded","true");let $=C.querySelector(".aipkit_settings_select_picker_search input"),U=C.querySelector(".aipkit_settings_select_picker_list");U&&y(P,U,$?$.value:""),$&&$.offsetParent!==null&&($.focus(),$.select());let B=C.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{S(v,B)})},A=(v,C)=>{if(!v||!C)return;let{button:P,popover:$,list:U,search:B}=C;if(P&&P.dataset.pickerListenerAttached!=="true"&&(P.addEventListener("click",D=>{if(D.preventDefault(),r===$){M();return}b(P,$,v)}),P.dataset.pickerListenerAttached="true"),$&&$.dataset.overlayListenerAttached!=="true"){$.addEventListener("click",N=>{N.target===$&&M()});let D=$.querySelector(".aipkit_model_settings_popover_close");D&&D.addEventListener("click",N=>{N.preventDefault(),M()}),$.dataset.overlayListenerAttached="true"}if(U&&U.dataset.pickerListenerAttached!=="true"&&(U.addEventListener("click",D=>{let N=D.target.closest(".aipkit_settings_select_picker_item");if(!N||N.classList.contains("is-disabled"))return;let R=N.dataset.value??"";v.value=R,v.dispatchEvent(new Event("change",{bubbles:!0})),I(v,C.label),y(v,U,B?B.value:""),M()}),U.dataset.pickerListenerAttached="true"),B&&B.dataset.pickerListenerAttached!=="true"&&(B.addEventListener("input",()=>{y(v,U,B.value)}),B.dataset.pickerListenerAttached="true"),v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("change",()=>{I(v,C.label),y(v,U,B?B.value:"")}),v.dataset.pickerListenerAttached="true"),v&&v.dataset.pickerObserverAttached!=="true"){let D=!1;new MutationObserver(()=>{D||(D=!0,window.requestAnimationFrame(()=>{I(v,C.label),y(v,U,B?B.value:""),D=!1}))}).observe(v,{childList:!0,subtree:!0}),v.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitContentWriterPickerEscapeBound||(document.addEventListener("keydown",D=>{D.key==="Escape"&&r&&M()}),document.body.dataset.aipkitContentWriterPickerEscapeBound="true"),document.body.dataset.aipkitContentWriterPickerRepositionBound||(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),document.body.dataset.aipkitContentWriterPickerRepositionBound="true")};function x(){let v=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);v.length&&v.forEach(C=>{let P=C.querySelectorAll(o);P.length&&P.forEach($=>{if(!$.id||$.dataset.aipkitPickerInit==="true")return;let U=w($);U&&(I($,U.label),y($,U.list,U.search?U.search.value:""),A($,U),$.dataset.aipkitPickerInit="true")})})}window.aipkit_initContentWriterSelectPickers=x,window.aipkit_refreshContentWriterSelectPickers=function(){let v=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);v.length&&v.forEach(C=>{let P=C.querySelectorAll(o);P.length&&P.forEach($=>{if(!$.id)return;let U=w($);U&&(I($,U.label),y($,U.list,U.search?U.search.value:""),A($,U),$.dataset.aipkitPickerInit="true")})})}})();(function(){"use strict";function g(s){s||(s=document.getElementById("aipkit_content_writer_container")),s&&(o(s),n(s),e(s))}function o(s){let t=s.querySelectorAll(".aipkit_ai_reasoning_input"),d=s.querySelector("#aipkit_content_writer_reasoning_effort");!t.length||!d||(t.forEach(a=>{a.addEventListener("change",function(){if(this.checked){d.value=this.value,s.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>{_.classList.remove("aipkit_ai_reasoning_option--selected")});let l=this.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected");let p=new Event("change",{bubbles:!0});d.dispatchEvent(p)}})}),r(s))}function r(s){let t=s.querySelector("#aipkit_content_writer_reasoning_effort");if(!t)return;let d=t.value||"medium";d==="minimal"&&(d="low");let a=s.querySelector(`.aipkit_ai_reasoning_input[value="${d}"]`);if(a&&!a.checked){a.checked=!0,s.querySelectorAll(".aipkit_ai_reasoning_option").forEach(p=>{p.classList.remove("aipkit_ai_reasoning_option--selected")});let l=a.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected")}}function n(s){let t=s.querySelector("#aipkit_content_writer_temperature"),d=s.querySelector("#aipkit_content_writer_temperature_value");!t||!d||t.dataset.enhancedListenerAttached!=="true"&&(t.addEventListener("input",function(){d.textContent=this.value}),t.dataset.enhancedListenerAttached="true")}function e(s){let t=s.querySelector("#aipkit_content_writer_content_length_slider"),d=s.querySelector("#aipkit_content_writer_content_length_value"),a=s.querySelector("#aipkit_content_writer_content_length_hint"),l=s.querySelector("#aipkit_content_writer_content_length");if(!t||!d||!a||!l||t.dataset.enhancedListenerAttached==="true")return;let p=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],_="medium",u=f=>{let w=p.findIndex(E=>E.key===f);return w===-1?p.findIndex(E=>E.key===_):w},m=f=>{let w=u(f),E=p[w];d.textContent=E.label,a.textContent=`Approx. ${E.words} words`,t.value=String(w+1)},k=(f,w=!1)=>{let E=p.some(y=>y.key===f)?f:_;l.value!==E&&(l.value=E),m(E),w&&l.dispatchEvent(new Event("change",{bubbles:!0}))};t.addEventListener("input",function(){let f=Math.max(1,Math.min(3,parseInt(this.value,10)))-1,w=p[f]?.key||_;k(w,!0)}),l.addEventListener("change",function(){k(this.value,!1)}),k(l.value||_,!1),t.dataset.enhancedListenerAttached="true"}function i(s,t){if(!s||!t)return;let d=s.querySelector("#aipkit_content_writer_reasoning_effort");d&&(d.value=t==="minimal"?"low":t);let a=s.querySelector(`.aipkit_ai_reasoning_input[value="${t==="minimal"?"low":t}"]`);if(a){a.checked=!0,s.querySelectorAll(".aipkit_ai_reasoning_option").forEach(p=>{p.classList.remove("aipkit_ai_reasoning_option--selected")});let l=a.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected")}}function c(s){if(!s)return"medium";let t=s.querySelector(".aipkit_ai_reasoning_input:checked");if(t)return t.value;let d=s.querySelector("#aipkit_content_writer_reasoning_effort");return d?d.value:"medium"}window.aipkit_initAiSettingsRedesigned=g,window.aipkit_setReasoningEffort=i,window.aipkit_getReasoningEffort=c})();(function(){"use strict";function g(o,r,n,e,i,c){if(typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(o,r):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(n):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(i):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(c,i):console.error("Content Writer UI: handleClearButton function not found."),typeof window.aipkit_initContentWriterSettingsSummary=="function"?window.aipkit_initContentWriterSettingsSummary():console.error("Content Writer UI: initContentWriterSettingsSummary function not found."),typeof window.aipkit_initContentWriterSelectPickers=="function"?window.aipkit_initContentWriterSelectPickers():console.error("Content Writer UI: initContentWriterSelectPickers function not found."),typeof window.aipkit_initAiSettingsRedesigned=="function"){let s=document.getElementById("aipkit_content_writer_container");window.aipkit_initAiSettingsRedesigned(s)}}window.aipkit_initContentWriterUI=g})();(function(){"use strict";let g={intervalId:null,startTime:null};function o(s){let t=Math.floor(s/1e3),d=Math.floor(t/60),a=t%60;return`${d}:${String(a).padStart(2,"0")}`}function r(s){if(!s)return null;let t=s.querySelector(".aipkit_cw_btn_timer");if(t)return t;t=document.createElement("span"),t.className="aipkit_cw_btn_timer",t.setAttribute("aria-hidden","true"),t.hidden=!0;let d=s.querySelector(".aipkit_btn-text");return d?s.insertBefore(t,d):s.insertBefore(t,s.firstChild),t}function n(s){if(!s||g.intervalId)return;let t=r(s);if(!t)return;g.startTime=Date.now();let d=()=>{let a=Date.now()-g.startTime;t.textContent=o(a),t.hidden=!1};d(),g.intervalId=window.setInterval(d,1e3)}function e(s){g.intervalId&&(clearInterval(g.intervalId),g.intervalId=null),g.startTime=null;let t=r(s);t&&(t.hidden=!0,t.textContent="")}function i(s){let t=document.getElementById("aipkit_content_writer_generate_btn");if(!t)return;let d=t.closest(".aipkit_cw_generate_split"),a=d?d.querySelector(".aipkit_cw_generate_toggle"):null,l=d?d.querySelector(".aipkit_cw_generate_menu"):null,p=l?Array.from(l.querySelectorAll(".aipkit_cw_generate_menu_item")):[],_=document.getElementById("aipkit_content_writer_stop_btn");if(s){if(t.dataset.aipkitStopMode="true",d&&d.classList.add("is-single"),n(t),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(t,"Stop");else{let u=t.querySelector(".aipkit_btn-text");u?u.textContent="Stop":t.textContent="Stop"}t.disabled=!1,t.removeAttribute("aria-disabled"),t.style.display="inline-flex",a&&(a.style.display="none",a.disabled=!0),l&&(l.hidden=!0),p.length&&p.forEach(u=>{u.disabled=!0,u.setAttribute("aria-disabled","true")}),_&&(_.style.display="none");return}t.dataset.aipkitStopMode&&delete t.dataset.aipkitStopMode,e(t),d&&d.classList.remove("is-single"),a&&(a.style.display="",a.disabled=!1,a.removeAttribute("aria-disabled")),p.length&&p.forEach(u=>{u.disabled=!1,u.removeAttribute("aria-disabled")}),_&&(_.style.display="none")}function c(){let s=document.getElementById("aipkit_content_writer_generate_btn"),t=document.getElementById("aipkit_content_writer_stop_btn"),d=s?.dataset?.action||"generate",l={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",update:"Update"}[d]||"Generate";s&&(e(s),s.dataset.aipkitStopMode&&delete s.dataset.aipkitStopMode,typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(s,!1,l):(s.disabled=!1,s.textContent=l),s.style.display="inline-flex"),t&&(t.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()}window.aipkit_setContentWriterStopMode=i,window.aipkit_resetContentWriterButtons=c})();(function(){"use strict";function g(o){o.current&&(o.current.close(),o.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let r=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_content_writer_output_display"),e=document.querySelector(".aipkit_content_writer_output_actions"),i=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn");r&&(r.textContent.trim().length>0||!!r.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))&&(!n||!n.classList.contains("aipkit_content_writer_output_error"))?(e&&(e.style.display="flex"),i&&(i.disabled=!1),c&&(c.disabled=!1),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_showPrimaryAction=="function"&&window.aipkit_showPrimaryAction(),typeof window.aipkit_updateMetaChunkVisibility=="function"&&window.aipkit_updateMetaChunkVisibility(),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(e&&(e.style.display="none"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=g})();(function(){"use strict";function g(c,s,t,d){let a=c.querySelector("[data-csv-upload-zone]"),l=c.querySelector("[data-csv-status]"),p=c.querySelector("[data-csv-status-card]"),_=c.querySelector("[data-csv-status-icon]"),u=c.querySelector("[data-csv-file-name]"),m=c.querySelector("[data-csv-message]");if(!(!l||!p)){if(s==="idle"){a&&a.classList.remove("is-hidden"),l.hidden=!0;return}if(a&&a.classList.add("is-hidden"),l.hidden=!1,p.dataset.status=s,_){let k="dashicons-yes-alt";s==="loading"&&(k="dashicons-update"),s==="error"&&(k="dashicons-warning"),_.innerHTML=`<span class="dashicons ${k}" aria-hidden="true"></span>`;let f=_.querySelector(".dashicons");f&&s==="loading"&&(f.style.animation="aipkit_csv_spin 1s linear infinite")}u&&d?u.textContent=d:u&&(u.textContent=""),m&&(m.textContent=t||"")}}async function o(c){let s=c.target,t=s.closest(".aipkit_csv_import_container")||s.closest(".aipkit_form-group");if(!t)return;let d=t.querySelector("[data-csv-status]")!==null,a=t.querySelector(".aipkit_csv_analysis_results"),l=t.querySelector(".aipkit_csv_data_holder"),p=document.getElementById("aipkit_content_writer_nonce"),_=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,u=p?p.value:_;if(!l||!u){console.error("CSV Handler: Missing data holder or nonce field."),d?g(t,"error","Error: A required component is missing.",null):a&&(a.textContent="Error: A required UI component or security token is missing.",a.className="aipkit_form-help aipkit_settings_message-error");return}let m=s.files[0];if(!m){d?g(t,"idle",null,null):a&&(a.textContent="Please select a CSV file first.",a.className="aipkit_form-help aipkit_settings_message-error");return}if(!m.name.toLowerCase().endsWith(".csv")){d?g(t,"error","Invalid file type. Please upload a .csv file.",m.name):a&&(a.textContent="Invalid file type. Please upload a .csv file.",a.className="aipkit_form-help aipkit_settings_message-error");return}d?g(t,"loading","Parsing CSV...",m.name):a&&(a.textContent="Parsing CSV...",a.className="aipkit_form-help aipkit_settings_message-info");let k=new FormData;k.append("file",m),k.append("_ajax_nonce",u),k.append("action","aipkit_content_writer_parse_csv");try{let f=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:k,credentials:"same-origin"});if(!f.ok){let y=`Server returned status ${f.status}`;try{let I=await f.json();I&&I.data&&I.data.message&&(y=I.data.message)}catch{}throw new Error(y)}let w=await f.json();if(!w.success)throw new Error(w.data?.message||"Unknown server error.");let E=w.data;if(E.tasks_found>0){l.value=E.formatted_data;let I=s.id==="aipkit_task_cw_csv_file_input"||!!s.closest("#aipkit_autogpt_container")?`Found ${E.tasks_found} ${E.tasks_found===1?"topic":"topics"}. Ready to save the task.`:`Found ${E.tasks_found} ${E.tasks_found===1?"topic":"topics"}. Hit Generate to proceed.`;d?g(t,"success",I,m.name):a&&(a.textContent=`Success! Found ${E.tasks_found} topics in the CSV file. Ready.`,a.className="aipkit_form-help aipkit_settings_message-success")}else{l.value="";let y="No valid topics found in the CSV file.";d?g(t,"error",y,m.name):a&&(a.textContent=y,a.className="aipkit_form-help aipkit_settings_message-error")}}catch(f){l.value="";let w=f.message||"Failed to parse CSV file.";d?g(t,"error",w,m.name):a&&(a.textContent=`Error: ${w}`,a.className="aipkit_form-help aipkit_settings_message-error"),console.error("CSV Parse Error:",f)}}function r(c){let s=c.target.closest("[data-csv-clear]");if(!s)return;let t=s.closest(".aipkit_csv_import_container");if(!t)return;let d=t.querySelector("input[type='file']"),a=t.querySelector(".aipkit_csv_data_holder");d&&(d.value=""),a&&(a.value=""),g(t,"idle",null,null)}function n(c){if(!c||c.dataset.dragDropAttached==="true")return;let s=l=>{l.preventDefault(),l.stopPropagation()},t=()=>c.classList.add("is-dragover"),d=()=>c.classList.remove("is-dragover"),a=l=>{s(l),d();let _=l.dataTransfer.files;if(_.length>0){let u=c.querySelector("input[type='file']");if(u){let m=new DataTransfer;m.items.add(_[0]),u.files=m.files,u.dispatchEvent(new Event("change",{bubbles:!0}))}}};["dragenter","dragover","dragleave","drop"].forEach(l=>{c.addEventListener(l,s,!1)}),["dragenter","dragover"].forEach(l=>{c.addEventListener(l,t,!1)}),["dragleave","drop"].forEach(l=>{c.addEventListener(l,d,!1)}),c.addEventListener("drop",a,!1),c.dataset.dragDropAttached="true"}function e(){let c=document.getElementById("aipkit_cw_csv_file_input");if(!c||c.dataset.listenerAttached==="true")return;c.addEventListener("change",o),c.dataset.listenerAttached="true";let s=c.closest(".aipkit_csv_import_container");if(s){let t=s.querySelector(".aipkit_csv_dropzone");n(t);let d=s.querySelector("[data-csv-clear]");d&&d.dataset.listenerAttached!=="true"&&(d.addEventListener("click",r),d.dataset.listenerAttached="true")}}function i(){let c=document.getElementById("aipkit_task_cw_csv_file_input");if(!c||c.dataset.listenerAttached==="true")return;c.addEventListener("change",o),c.dataset.listenerAttached="true";let s=c.closest(".aipkit_csv_import_container");if(s){let t=s.querySelector(".aipkit_csv_dropzone");n(t);let d=s.querySelector("[data-csv-clear]");d&&d.dataset.listenerAttached!=="true"&&(d.addEventListener("click",r),d.dataset.listenerAttached="true")}}window.aipkit_initCsvUploadHandler=e,window.aipkit_initTaskCsvUploadHandler=i})();(function(){"use strict";function g(o,r){let n=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!n||!n.value)throw new Error("Security token missing for stream. Please reload.");let e=new URL(window.aipkit_dashboard.ajaxurl);e.searchParams.append("action","aipkit_frontend_chat_stream"),e.searchParams.append("cache_key",o),e.searchParams.append("_ajax_nonce",n.value),r.current&&r.current.close();try{let i=new EventSource(e.toString());return i.userStopped=!1,i}catch(i){throw console.error("EventSource Connection Setup: EventSource creation error:",i),new Error("Could not connect to stream. "+i.message)}}window.aipkit_stream_setupEventSourceConnection=g})();(function(){"use strict";function g(r){let n=r.parentElement,e=n?.closest(".aipkit_cw_output_chunk--primary");e&&(n.scrollHeight>n.clientHeight?e.classList.add("has-overflow"):e.classList.remove("has-overflow"))}function o(r,n,e,i){if(r.data)try{let c=JSON.parse(r.data);if(c.delta){if(n.fullContent+=c.delta,e.classList.contains("is-streaming")||e.classList.add("is-streaming"),!i&&typeof window.aipkit_getMarkdownRenderer=="function"&&(i=window.aipkit_getMarkdownRenderer()),i)e.innerHTML=i.render(n.fullContent);else{let t=e.textContent||"";e.textContent=t+c.delta}typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(e.innerHTML);let s=e.parentElement;s&&s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),g(e),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()}}catch(c){console.error("Stream Message Handler: Error parsing event data.",c)}}window.aipkit_stream_handleMessage=o})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};async function o(r,n,e,i,c,s){if(n.isDone)return;n.isDone=!0,s&&s.current&&(s.current.close(),s.current=null),e.classList.contains("is-streaming")&&e.classList.remove("is-streaming"),!i&&typeof window.aipkit_getMarkdownRenderer=="function"&&(i=window.aipkit_getMarkdownRenderer()),i&&(e.innerHTML=i.render(n.fullContent)),typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(e.innerHTML),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let t=document.getElementById("aipkit_content_writer_form"),d=t?t.elements.generate_meta_description:null,a=t?t.elements.generate_focus_keyword:null,l=t?t.elements.generate_excerpt:null,p=t?t.elements.generate_tags:null,_=document.getElementById("aipkit_content_writer_nonce")?.value,u=t.elements.ai_provider?.value,m=t.elements.ai_model?.value,k=t.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",f=document.getElementById("aipkit_cw_generated_title_display"),w=f?f.textContent:t.elements.content_title?.value.split("|")[0].trim()||"Untitled",E=t.elements.content_keywords?.value.trim()||"",y="",I=document.getElementById("aipkit_content_writer_title");if(I){let x=I.value.split("|")||[];x.length>1&&(y=x[1].trim())}let S=y||E,h=S;if(a?.checked&&!S&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let x=t.elements.enable_vector_store,v=x&&x.checked?"1":"0",C=t.elements.vector_store_provider?.value,P=t.elements["openai_vector_store_ids[]"],$=P?Array.from(P.selectedOptions).map(L=>L.value):[],U=t.elements.pinecone_index_name?.value,B=t.elements.qdrant_collection_name?.value,D=t.elements.vector_store_top_k?.value,N=t.elements.vector_store_confidence_threshold?.value,R={generated_content:n.fullContent,final_title:w,provider:u,model:m,prompt_mode:k,custom_keyword_prompt:t.elements.custom_keyword_prompt.value,enable_vector_store:v,vector_store_provider:C,openai_vector_store_ids:$,pinecone_index_name:U,qdrant_collection_name:B,vector_store_top_k:D,vector_store_confidence_threshold:N,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_},j=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",R);if(j&&j.focus_keyword){h=j.focus_keyword;let L=document.getElementById("aipkit_cw_generated_focus_keyword"),K=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");L&&K&&(L.value=h,K.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(x){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",x.message||"Failed")}}else if(S){let x=document.getElementById("aipkit_cw_generated_focus_keyword"),v=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");x&&v&&(x.value=S.split(",")[0].trim(),v.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let M=t?t.elements.generate_images_enabled:null,b=t?t.elements.generate_featured_image:null;if((M?.checked||b?.checked)&&n.fullContent.trim()!==""){let x=M?.checked,v=b?.checked,C=String(t.elements.image_provider?.value||"").toLowerCase(),P=String(t.elements.image_model?.value||"").toLowerCase(),$=C==="openai"&&P.startsWith("gpt-image-1"),U=x?parseInt(t.elements.image_count?.value,10)||1:0,B=document.getElementById("aipkit_cw_generated_excerpt"),D=U+(v?1:0),N=x&&v?U>1?`Generating ${U} content images and 1 featured image...`:"Generating 1 content image and 1 featured image...":v?"Generating featured image...":x?U>1?`Generating ${U} content images...`:"Generating content image...":D>1?`Generating ${D} images...`:D===1?"Generating 1 image...":"Generating images...",R={original_topic:I?I.value.split("|")[0].trim():w,final_title:w,post_title:w,keywords:h,excerpt:B?B.value:"",ai_provider:t.elements.ai_provider?.value,ai_model:t.elements.ai_model?.value,ai_temperature:t.elements.ai_temperature?.value,reasoning_effort:t.elements.reasoning_effort?.value,image_provider:t.elements.image_provider?.value,image_model:t.elements.image_model?.value,image_prompt:t.elements.image_prompt?.value,image_alignment:t.elements.image_alignment?.value,image_size:t.elements.image_size?.value,featured_image_prompt:t.elements.featured_image_prompt?.value,generate_image_title:t.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:t.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:t.elements.generate_image_caption?.checked?"1":"0",generate_image_description:t.elements.generate_image_description?.checked?"1":"0",image_title_prompt:t.elements.image_title_prompt?.value,image_alt_text_prompt:t.elements.image_alt_text_prompt?.value,image_caption_prompt:t.elements.image_caption_prompt?.value,image_description_prompt:t.elements.image_description_prompt?.value,pexels_orientation:t.elements.pexels_orientation?.value,pexels_size:t.elements.pexels_size?.value,pexels_color:t.elements.pexels_color?.value,pixabay_orientation:t.elements.pixabay_orientation?.value,pixabay_image_type:t.elements.pixabay_image_type?.value,pixabay_category:t.elements.pixabay_category?.value,_ajax_nonce:_,generate_images_enabled:x?"1":"0",image_count:U,generate_featured_image:v?"1":"0",image_placement:t.elements.image_placement?.value,image_placement_param_x:t.elements.image_placement_param_x?.value,cw_generation_mode:t.elements.cw_generation_mode?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0},j=K=>{let V=document.getElementById("aipkit_cw_image_data_holder");V&&(V.value=JSON.stringify(K)),typeof window.aipkit_renderContentWriterImagePreview=="function"&&window.aipkit_renderContentWriterImagePreview(K)},L=async(K={},V="")=>{typeof window.aipkit_updateCwGenerationStatus=="function"&&V&&window.aipkit_updateCwGenerationStatus("image","generating",V);let ee=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...R,...K});if(!ee?.image_data)throw new Error("Image generation failed or returned no data.");return ee.image_data};try{let K=x&&v,V=$&&x&&U>1,ee=null,J=le=>{ee||(ee={...le,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(K){if(x&&U>0)if(V&&U>1)for(let le=0;le<U;le++){let ue=await L({generate_featured_image:"0",image_count:1,image_start_index:le+1},`Generating content image ${le+1} of ${U}...`);J(ue),Array.isArray(ue.in_content_images)&&ee.in_content_images.push(...ue.in_content_images),j(ee)}else{let le=await L({generate_featured_image:"0"},U>1?`Generating ${U} content images...`:"Generating content image...");J(le),ee.in_content_images=le.in_content_images||[],j(ee)}if(v){let le=await L({generate_images_enabled:"0",image_count:0},"Generating featured image...");J(le),ee.featured_image_id=le.featured_image_id||null,ee.featured_image_url=le.featured_image_url||null}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",N),ee=await L();if(ee)j(ee),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success");else throw new Error("Image generation failed or returned no data.")}catch(K){typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",K.message||"Failed")}}else typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(l?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let x=t.elements.enable_vector_store,v=x&&x.checked?"1":"0",C=t.elements.vector_store_provider?.value,P=t.elements["openai_vector_store_ids[]"],$=P?Array.from(P.selectedOptions).map(L=>L.value):[],U=t.elements.pinecone_index_name?.value,B=t.elements.qdrant_collection_name?.value,D=t.elements.vector_store_top_k?.value,N=t.elements.vector_store_confidence_threshold?.value,R={generated_content:n.fullContent,final_title:w,keywords:h,provider:u,model:m,prompt_mode:k,custom_excerpt_prompt:t.elements.custom_excerpt_prompt.value,enable_vector_store:v,vector_store_provider:C,openai_vector_store_ids:$,pinecone_index_name:U,qdrant_collection_name:B,vector_store_top_k:D,vector_store_confidence_threshold:N,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_},j=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",R);if(j&&j.excerpt){let L=document.getElementById("aipkit_cw_generated_excerpt"),K=document.getElementById("aipkit_cw_excerpt_output_wrapper");L&&K&&(L.value=j.excerpt,K.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(x){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",x.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(p?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let x=t.elements.enable_vector_store,v=x&&x.checked?"1":"0",C=t.elements.vector_store_provider?.value,P=t.elements["openai_vector_store_ids[]"],$=P?Array.from(P.selectedOptions).map(L=>L.value):[],U=t.elements.pinecone_index_name?.value,B=t.elements.qdrant_collection_name?.value,D=t.elements.vector_store_top_k?.value,N=t.elements.vector_store_confidence_threshold?.value,R={generated_content:n.fullContent,final_title:w,keywords:h,provider:u,model:m,prompt_mode:k,custom_tags_prompt:t.elements.custom_tags_prompt.value,enable_vector_store:v,vector_store_provider:C,openai_vector_store_ids:$,pinecone_index_name:U,qdrant_collection_name:B,vector_store_top_k:D,vector_store_confidence_threshold:N,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_},j=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",R);if(j&&j.tags){let L=document.getElementById("aipkit_cw_generated_tags"),K=document.getElementById("aipkit_cw_tags_output_wrapper");L&&K&&(L.value=j.tags,K.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(x){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",x.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(d?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let x=t.elements.enable_vector_store,v=x&&x.checked?"1":"0",C=t.elements.vector_store_provider?.value,P=t.elements["openai_vector_store_ids[]"],$=P?Array.from(P.selectedOptions).map(L=>L.value):[],U=t.elements.pinecone_index_name?.value,B=t.elements.qdrant_collection_name?.value,D=t.elements.vector_store_top_k?.value,N=t.elements.vector_store_confidence_threshold?.value,R={generated_content:n.fullContent,final_title:w,keywords:h,provider:u,model:m,prompt_mode:k,custom_meta_prompt:t.elements.custom_meta_prompt.value,enable_vector_store:v,vector_store_provider:C,openai_vector_store_ids:$,pinecone_index_name:U,qdrant_collection_name:B,vector_store_top_k:D,vector_store_confidence_threshold:N,vector_embedding_provider:t.elements.vector_embedding_provider?.value,vector_embedding_model:t.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_},j=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",R);if(j&&j.meta_description){let L=document.getElementById("aipkit_cw_generated_meta_desc"),K=document.getElementById("aipkit_cw_meta_desc_output_wrapper");L&&K&&(L.value=j.meta_description,K.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(x){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",x.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(s)}window.aipkit_stream_handleDone=o})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function o(r,n,e,i,c){if(n.isDone)return;if(c.current&&c.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c);return}let s="Error during streaming.";if(r.data)try{s=JSON.parse(r.data).error||s}catch{}console.error("Stream Error Handler: Error event received:",r),e&&(e.textContent="",e.className="aipkit_cw_status_badge"),i&&i.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",s),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c)}window.aipkit_stream_handleError=o})();(function(){"use strict";let g={current:null};function o(r,n){let e=document.getElementById("aipkit_content_writer_output_display"),i=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_form_status");if(!e||!i||!c){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let s=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let d of s)if(typeof window[d]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${d}`),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let t={fullContent:"",isDone:!1};i.innerHTML="",e.classList.remove("aipkit_content_writer_output_error"),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),window.aipkit_updateCwGenerationStatus("content","generating");try{n.current=window.aipkit_stream_setupEventSourceConnection(r,n);let d=window.aipkit_getMarkdownRenderer();n.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},n.current.onmessage=function(a){window.aipkit_stream_handleMessage(a,t,i,d)},n.current.addEventListener("done",function(a){window.aipkit_stream_handleDone(a,t,i,d,c,n)}),n.current.addEventListener("error",function(a){window.aipkit_stream_handleError(a,t,c,e,n)})}catch(d){console.error("EventSource Orchestrator: Error during setup:",d),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=o,window.aipkit_contentWriterEventSourceInstanceRef=g})();(function(){"use strict";function g(o){o&&o.current&&o.current.close()}window.aipkit_stopContentWriterEventSource=g})();(function(){"use strict";async function g(o){let r=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_form_status"),i=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_copy_btn"),s=document.getElementById("aipkit_content_writer_clear_btn"),t=document.querySelector(".aipkit_content_writer_progress_bar_container"),d=document.querySelector(".aipkit_content_writer_output_actions"),a=function(m){if(!m)return"Error";let k=m.message||"Error",f=m.details||m.data?.details,w=f?.provider,E=f?.model;return w||E?`${k} (${[w,E].filter(Boolean).join(" \xB7 ")})`:k};if(!r||!n||!e||!i||!c||!s||!d){console.error("Handle SSE: Missing UI elements.");return}let l=new FormData(r),p=Object.fromEntries(l.entries()),_=r.elements["openai_vector_store_ids[]"];if(p.openai_vector_store_ids=_?Array.from(_.selectedOptions).map(m=>m.value):[],delete p["openai_vector_store_ids[]"],!p.conversation_uuid){let m=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();m&&(p.conversation_uuid=m)}if(!p.content_title){e.textContent="",e.className="aipkit_cw_status_badge";return}let u=document.getElementById("aipkit_content_writer_nonce");if(u&&u.value)p._ajax_nonce=u.value;else{e.textContent="",e.className="aipkit_cw_status_badge";return}typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0),t&&(t.style.display="none"),d.style.display="none",i&&(i.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'),c.disabled=!0,s.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),e.textContent="",e.className="aipkit_cw_status_badge";try{p.content_title=document.getElementById("aipkit_content_writer_title").value;let m=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",p);if(!m.cache_key)throw new Error(m.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=m.cache_key,m.conversation_uuid){window.aipkit_current_conversation_uuid=m.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",m.conversation_uuid)}catch{}}if(typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(m.cache_key,o);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(m){console.error("Content Writer Init Stream Error:",m),e&&(e.textContent=a(m),e.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),window.aipkit_setLoadingStateOpenAI(n,!1,"Generate"),typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),i&&(i.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n},o=function(n){if(!n)return"Error";let e=n.message||"Error",i=n.details||n.data?.details,c=i?.provider,s=i?.model;return c||s?`${e} (${[c,s].filter(Boolean).join(" \xB7 ")})`:e};async function r(){let n=document.getElementById("aipkit_content_writer_form"),e=document.getElementById("aipkit_content_writer_generate_btn"),i=document.getElementById("aipkit_content_writer_stop_btn"),c=document.getElementById("aipkit_content_writer_form_status"),s=document.getElementById("aipkit_cw_generated_content_area"),t=document.getElementById("aipkit_content_writer_copy_btn"),d=document.getElementById("aipkit_content_writer_clear_btn"),a=document.querySelector(".aipkit_content_writer_progress_bar_container"),l=a?a.querySelector(".aipkit_content_writer_progress_bar"):null,p=document.querySelector(".aipkit_content_writer_output_actions"),_=document.getElementById("aipkit_cw_status_display_container");if(!n||!e||!i||!c||!s||!t||!d){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),c.textContent="",c.className="aipkit_cw_status_badge";return}let u=new FormData(n),m=Object.fromEntries(u.entries()),k=n.elements["openai_vector_store_ids[]"];if(m.openai_vector_store_ids=k?Array.from(k.selectedOptions).map(S=>S.value):[],delete m["openai_vector_store_ids[]"],!m.conversation_uuid){let S=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();S&&(m.conversation_uuid=S)}if(!m.content_title){c.textContent="",c.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let f=document.getElementById("aipkit_content_writer_nonce");if(f&&f.value)m._ajax_nonce=f.value;else{c.textContent="",c.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}_&&(_.style.display="block");let w=document.getElementById("aipkit_cw_generate_meta_desc"),E=document.getElementById("aipkit_cw_generate_focus_keyword"),y=document.getElementById("aipkit_cw_generate_excerpt"),I=document.getElementById("aipkit_cw_generate_tags");typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",y?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",I?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",w?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",E?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(e,!0,"Generate","Generating..."),i.style.display="none",p&&(p.style.display="none"),s&&(s.innerHTML=""),t.disabled=!0,d.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),c.textContent="Generating content, please wait...",c.className="aipkit_cw_status_badge aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),a&&l&&(a.style.display="block",l.style.width="0%",l.classList.add("aipkit_indeterminate"));try{let S=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",m);if(S.content){if(S.conversation_uuid){window.aipkit_current_conversation_uuid=S.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",S.conversation_uuid)}catch{}}let h=window.aipkit_getMarkdownRenderer();if(s&&(h?s.innerHTML=h.render(S.content):s.textContent=S.content,typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(s.innerHTML)),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),p&&(p.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),t.disabled=!1,d.disabled=!1,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),S.content&&y?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let M=n.elements.enable_vector_store,b=M&&M.checked?"1":"0",A=n.elements.vector_store_provider?.value,x=n.elements["openai_vector_store_ids[]"],v=x?Array.from(x.selectedOptions).map(N=>N.value):[],C=n.elements.pinecone_index_name?.value,P=n.elements.qdrant_collection_name?.value,$=n.elements.vector_store_top_k?.value,U=n.elements.vector_store_confidence_threshold?.value,B={generated_content:S.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_excerpt_prompt:m.custom_excerpt_prompt,enable_vector_store:b,vector_store_provider:A,openai_vector_store_ids:v,pinecone_index_name:C,qdrant_collection_name:P,vector_store_top_k:$,vector_store_confidence_threshold:U,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},D=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",B);if(D&&D.excerpt){let N=document.getElementById("aipkit_cw_generated_excerpt"),R=document.getElementById("aipkit_cw_excerpt_output_wrapper");N&&R&&(N.value=D.excerpt,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(M){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",M.message||"Not returned")}}if(S.content&&I?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let M=n.elements.enable_vector_store,b=M&&M.checked?"1":"0",A=n.elements.vector_store_provider?.value,x=n.elements["openai_vector_store_ids[]"],v=x?Array.from(x.selectedOptions).map(N=>N.value):[],C=n.elements.pinecone_index_name?.value,P=n.elements.qdrant_collection_name?.value,$=n.elements.vector_store_top_k?.value,U=n.elements.vector_store_confidence_threshold?.value,B={generated_content:S.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_tags_prompt:m.custom_tags_prompt,enable_vector_store:b,vector_store_provider:A,openai_vector_store_ids:v,pinecone_index_name:C,qdrant_collection_name:P,vector_store_top_k:$,vector_store_confidence_threshold:U,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},D=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",B);if(D&&D.tags){let N=document.getElementById("aipkit_cw_generated_tags"),R=document.getElementById("aipkit_cw_tags_output_wrapper");N&&R&&(N.value=D.tags,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(M){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",M.message||"Not returned")}}if(S.meta_description){let M=document.getElementById("aipkit_cw_generated_meta_desc"),b=document.getElementById("aipkit_cw_meta_desc_output_wrapper");M&&b&&(M.value=S.meta_description,b.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else w?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(S.focus_keyword){let M=document.getElementById("aipkit_cw_generated_focus_keyword"),b=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");M&&b&&(M.value=S.focus_keyword,b.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else E?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(S.message||"No content received.")}catch(S){console.error("Content Writer AJAX Error:",S),c&&(c.textContent=o(S),c.className="aipkit_cw_status_badge aipkit_settings_message-error"),s&&(s.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",S.message),y?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),I?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),w?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),E?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),p&&(p.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Generate"),a&&(a.style.display="none"),l&&l.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=r})();(function(){"use strict";let g=window.wp?.i18n?.__||function(r){return r};function o(r){let n=document.getElementById("aipkit_content_writer_generate_btn"),e=()=>{if(n){if(typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(n,g("Stopping...","gpt3-ai-content-generator"));else{let c=n.querySelector(".aipkit_btn-text");c?c.textContent=g("Stopping...","gpt3-ai-content-generator"):n.textContent=g("Stopping...","gpt3-ai-content-generator")}n.disabled=!0,n.setAttribute("aria-disabled","true")}};if(typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){e(),typeof window.aipkit_cw_requestBatchStop=="function"&&window.aipkit_cw_requestBatchStop();return}if(typeof window.aipkit_cw_isExistingUpdateActive=="function"&&window.aipkit_cw_isExistingUpdateActive()){e(),typeof window.aipkit_cw_requestExistingUpdateStop=="function"&&window.aipkit_cw_requestExistingUpdateStop();return}if(!r||!r.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let i=document.getElementById("aipkit_content_writer_form_status");i&&(i.textContent=g("Stopping...","gpt3-ai-content-generator"),i.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),i.classList.add("aipkit_settings_message-info")),e(),r.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(r):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=o})();(function(){"use strict";let g={rss:["{description}"],url:["{url_content}"]},o=new Set(["task","csv","gsheets"]),r="{topic}",n=l=>{if(!l)return"Error";let p=l.message||"Error",_=l.details||l.data?.details,u=_?.provider,m=_?.model;return u||m?`${p} (${[u,m].filter(Boolean).join(" \xB7 ")})`:p},e=(l,p)=>{let _=l.querySelector(p);return _?String(_.value||""):""},i=(l,p)=>p.filter(_=>!l.includes(_)),c=(l,p,_)=>{let u=[],m=l==="rss"?"RSS":"URL";return p.length&&u.push(`Title prompt: missing ${p.join(", ")}.`),_.length&&u.push(`Content prompt: missing ${_.join(", ")}.`),u.length?`${m} mode works best when your prompts include the source placeholders.

${u.join(`
`)}

Please update your prompts and try again.`:""},s=(l,p)=>{let _=g[p];if(!_)return{shouldWarn:!1,message:""};let u=e(l,"#aipkit_cw_custom_title_prompt").trim(),m=e(l,"#aipkit_cw_custom_content_prompt").trim(),k=u?i(u,_):[],f=m?i(m,_):_.slice(),w=c(p,k,f);return{shouldWarn:!!w,message:w}},t=(l,p)=>p.length?`${l} mode requires ${r} in your prompts.

${p.join(`
`)}

Please update your prompts and try again.`:"",d=(l,p)=>{if(!o.has(p))return{shouldWarn:!1,message:""};let u={task:"Manual entry",csv:"CSV",gsheets:"Google Sheets"}[p]||"This",m=[{selector:"#aipkit_cw_custom_title_prompt",label:"Title prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_content_prompt",label:"Content prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_meta_prompt",label:"Meta description prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_meta_desc")?.checked},{selector:"#aipkit_cw_custom_keyword_prompt",label:"Focus keyword prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_focus_keyword")?.checked},{selector:"#aipkit_cw_custom_excerpt_prompt",label:"Excerpt prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_excerpt")?.checked},{selector:"#aipkit_cw_custom_tags_prompt",label:"Tags prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_tags")?.checked}],k=[];m.forEach(w=>{if(!w.enabled())return;let E=e(l,w.selector).trim();(E?i(E,[r]):[r]).length&&k.push(`${w.label}: missing ${r}.`)});let f=t(u,k);return{shouldWarn:!!f,message:f}};function a(l,p,_,u){l&&(l.dataset.listenerAttached||(l.addEventListener("click",async()=>{if(l.dataset.aipkitStopMode==="true"){typeof window.aipkit_handleStopGeneration=="function"&&window.aipkit_handleStopGeneration(u);return}try{delete window.aipkit_current_conversation_uuid,sessionStorage.removeItem("aipkit_current_conversation_uuid")}catch{}typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview();let m=document.getElementById("aipkit_cw_image_data_holder");if(m&&(m.value=""),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),l.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Upgrade URL not found. Please visit our website.",{title:"Upgrade"}):alert("Upgrade URL not found. Please visit our website.");return}if(l.dataset.action==="fetch_feeds"){typeof window.aipkit_handleRssFetchFromGenerateButton=="function"?window.aipkit_handleRssFetchFromGenerateButton(l):console.error("Fetch Feeds: Handler function not found.");return}let k=document.getElementById("aipkit_content_writer_form_status"),f=document.getElementById("aipkit_cw_action_validation"),w=l.dataset.action||"generate",E=w==="generate_single"?"generate":w,y=document.getElementById("aipkit_cw_mode_select"),I=y?y.value:"task";if(I==="single"&&(I="task"),I==="existing"||I.indexOf("existing-")===0){if(typeof window.aipkit_runContentWriterExistingUpdate=="function")window.aipkit_runContentWriterExistingUpdate();else{let V="Update panel is not ready yet. Please refresh the page and try again.";typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(V,{title:"Update existing"}):alert(V)}return}let S=V=>String(V||"").split(/\r?\n/).map(ee=>ee.trim()).filter(Boolean),h=V=>{let ee=String(V||"").split("|").map(J=>J.trim());return{topic:ee[0]||"",keywords:ee[1]||"",category:ee[2]||"",authorLogin:ee[3]||"",type:ee[4]||"",schedule:ee[5]||""}},M=()=>{let V=Array.from(p.querySelectorAll("[data-aipkit-bulk-row]"));for(let ee of V){let J=ee.querySelector('[data-bulk-field="topic"]'),le=J?J.value.trim():"";if(!le)continue;let ue=ee.querySelector('[data-bulk-field="keywords"]')?.value.trim()||"",be=ee.querySelector('[data-bulk-field="category"]')?.value.trim()||"",ze=ee.querySelector('[data-bulk-field="author"]'),Me=ze?ze.value.trim():"",rt=ze?.selectedOptions?.[0]?.dataset?.userId||"",Ue=ee.querySelector('[data-bulk-field="type"]')?.value.trim()||"",vt=ee.querySelector('[data-bulk-field="schedule"]')?.value.trim()||"";return{topic:le,keywords:ue,category:be,authorLogin:Me,authorId:rt,type:Ue,schedule:vt}}return null},b=V=>{if(!V||!V.topic)return;let ee=document.getElementById("aipkit_content_writer_title"),J=V.keywords?`${V.topic} | ${V.keywords}`:V.topic;ee&&(ee.value=J,ee.dispatchEvent(new Event("change",{bubbles:!0})));let le=p.elements.post_type;le&&V.type&&(le.value=V.type,le.dispatchEvent(new Event("change",{bubbles:!0})));let ue=p.elements["post_categories[]"];ue&&V.category&&(Array.from(ue.options).forEach(ze=>{ze.selected=ze.value===V.category}),ue.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect());let be=p.elements.post_author;if(be){let ze=V.authorId||"";if(!ze&&V.authorLogin){let Me=Array.from(be.options).find(rt=>rt.dataset.login===V.authorLogin||rt.value===V.authorLogin);Me&&(ze=Me.value)}ze&&(be.value=ze,be.dispatchEvent(new Event("change",{bubbles:!0})))}};if(E!=="upgrade"){let V=typeof window.aipkit_validateContentWriterInputs=="function"?window.aipkit_validateContentWriterInputs(p,I):{isValid:!0};if(!V.isValid){typeof window.aipkit_showContentWriterValidationError=="function"?window.aipkit_showContentWriterValidationError(k||f,V.message):k&&(k.textContent=V.message||"",k.className="aipkit_cw_status_badge aipkit_settings_message-error");return}}if(typeof window.aipkit_clearContentWriterValidationMessage=="function"?(window.aipkit_clearContentWriterValidationMessage(k),window.aipkit_clearContentWriterValidationMessage(f)):f&&(f.textContent=""),E==="generate"||E==="create_task"){let{shouldWarn:V,message:ee}=s(p,I);if(V){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(ee,{title:"Update prompts",okText:"Review prompts"}):alert(ee);return}let J=d(p,I);if(J.shouldWarn){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(J.message,{title:"Update prompts",okText:"Review prompts"}):alert(J.message);return}}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let A=document.getElementById("aipkit_cw_status_display_container"),x=document.getElementById("aipkit_cw_generated_title_display"),v=document.getElementById("aipkit_content_writer_title");if(E==="create_task"){A&&(A.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(p,l,k):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),k&&(k.textContent="",k.className="aipkit_cw_status_badge"));return}let C=p.elements.content_title_bulk,P=S(C?C.value:""),$=E==="generate"&&I==="task"&&P.length===1;if($){let V=M()||h(P[0]);b(V),typeof window.aipkit_cw_resetBatchQueue=="function"&&window.aipkit_cw_resetBatchQueue()}if(E==="generate"&&!$){typeof window.aipkit_cw_handleBatchGeneration=="function"?window.aipkit_cw_handleBatchGeneration(p,I):console.error("Generate Button Listener: aipkit_cw_handleBatchGeneration function not found.");return}let U=document.getElementById("aipkit_cw_single_output_wrapper"),B=document.getElementById("aipkit_cw_output_card");U&&(U.style.display="block"),B&&(B.style.display="block"),A&&(A.style.display="block");let D=document.getElementById("aipkit_content_writer_stream_mode"),R=p.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),_&&(_.style.display="flex");let j={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[V,ee]of Object.entries(j)){let J=document.getElementById(ee);J&&!J.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(V,"skipped")}let L=document.getElementById("aipkit_cw_generate_images_enabled"),K=document.getElementById("aipkit_cw_generate_featured_image");if(L&&K&&!L.checked&&!K.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),R){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),x&&(x.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(l,!0,"Generate","Generating...");let V=new FormData(p),ee=Object.fromEntries(V.entries()),J=p.elements["openai_vector_store_ids[]"];ee.openai_vector_store_ids=J?Array.from(J.selectedOptions).map(be=>be.value):[],delete ee["openai_vector_store_ids[]"];let le=document.getElementById("aipkit_content_writer_nonce");ee._ajax_nonce=le?le.value:"",window.aipkit_current_conversation_uuid&&(ee.conversation_uuid=window.aipkit_current_conversation_uuid);let ue=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",ee);if(ue&&ue.new_title){if(ue.conversation_uuid){window.aipkit_current_conversation_uuid=ue.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",ue.conversation_uuid)}catch{}}x&&(x.textContent=ue.new_title,x.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success")}else throw new Error(ue.message||"Failed to generate new title.")}catch(V){console.error("Title Generation Error:",V),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",V.message),k&&(k.textContent=n(V),k.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),x&&v&&(x.textContent=v.value.split("|")[0].trim(),x.style.display="block");!D||D.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(u):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),l.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=a})();(function(){"use strict";function g(o,r){o&&(o.dataset.listenerAttached||(o.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(r):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),o.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=g})();(function(){"use strict";function g(o,r){if(o===r)return!0;if(o==null||typeof o!="object"||r==null||typeof r!="object")return!1;let n=Object.keys(o),e=Object.keys(r);if(n.length!==e.length)return!1;for(let i of n)if(!e.includes(i)||!g(o[i],r[i]))return!1;return!0}window.aipkit_deepEqual=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_content_writer_provider"),r=document.getElementById("aipkit_content_writer_temperature"),n=document.getElementById("aipkit_content_writer_post_author"),e=n?n.value:window.aipkit_dashboard?.currentUserId||"1",c=(o&&o.options.length>0?o.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),s=o?o.value.toLowerCase():c,t="",d=window.aipkit_dashboard?.models?.[s];switch(s){case"openai":t="gpt-4.1-mini";break;case"google":t="gemini-2.5-flash";break;case"openrouter":t="anthropic/claude-3.7-sonnet";break;case"azure":case"deepseek":case"ollama":Array.isArray(d)&&d.length>0?t=d[0].id||"":t="";break;default:t=""}let a=r&&r.defaultValue||"1.0",l=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:s,ai_model:t,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:a,reasoning_effort:"medium",post_type:"post",post_author:e,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:l.title,custom_content_prompt:l.content,generate_title:"1",generate_content:"1",generate_meta_description:"1",custom_meta_prompt:l.meta,generate_focus_keyword:"1",custom_keyword_prompt:l.keyword,generate_excerpt:"1",custom_excerpt_prompt:l.excerpt,generate_tags:"1",custom_tags_prompt:l.tags,custom_title_prompt_update:"",custom_content_prompt_update:"",custom_meta_prompt_update:"",custom_keyword_prompt_update:"",custom_excerpt_prompt_update:"",custom_tags_prompt_update:"",cw_generation_mode:"task",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"dall-e-3",image_prompt:l.image||"A high-quality, relevant image for an article about: {topic}",image_prompt_update:"",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",image_title_prompt:l.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt:l.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt:l.image_caption||"Write a short image caption based on: {topic}",image_description_prompt:l.image_description||"Write a brief image description based on: {topic}",image_title_prompt_update:l.image_title_update||l.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt_update:l.image_alt_text_update||l.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt_update:l.image_caption_update||l.image_caption||"Write a short image caption based on: {topic}",image_description_prompt_update:l.image_description_update||l.image_description||"Write a brief image description based on: {topic}",generate_featured_image:"0",featured_image_prompt:l.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",featured_image_prompt_update:"",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",vector_store_confidence_threshold:"20",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=g})();(function(){"use strict";function g(o){let r={};if(!o)return r;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","custom_title_prompt_update","custom_content_prompt_update","custom_meta_prompt_update","custom_keyword_prompt_update","custom_excerpt_prompt_update","custom_tags_prompt_update","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_prompt_update","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","image_title_prompt_update","image_alt_text_prompt_update","image_caption_prompt_update","image_description_prompt_update","featured_image_prompt","featured_image_prompt_update","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(S=>{o.elements[S]&&(r[S]=o.elements[S].value)});let e=o.elements.generate_meta_description;e?r.generate_meta_description=e.checked?"1":"0":r.generate_meta_description="0";let i=o.elements.generate_focus_keyword;i?r.generate_focus_keyword=i.checked?"1":"0":r.generate_focus_keyword="0";let c=o.elements.generate_excerpt;c?r.generate_excerpt=c.checked?"1":"0":r.generate_excerpt="0";let s=o.elements.generate_tags;s?r.generate_tags=s.checked?"1":"0":r.generate_tags="0";let t=o.elements.generate_title;t?r.generate_title=t.checked?"1":"0":r.generate_title="1";let d=o.elements.generate_content;d?r.generate_content=d.checked?"1":"0":r.generate_content="1";let a=o.elements.generate_toc;a?r.generate_toc=a.checked?"1":"0":r.generate_toc="0";let l=o.elements.generate_seo_slug;l?r.generate_seo_slug=l.checked?"1":"0":r.generate_seo_slug="0";let p=o.elements.generate_images_enabled;p?r.generate_images_enabled=p.checked?"1":"0":r.generate_images_enabled="0";let _=o.elements.generate_featured_image;_?r.generate_featured_image=_.checked?"1":"0":r.generate_featured_image="0",["generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(S=>{let h=o.elements[S];h?r[S]=h.checked?"1":"0":r[S]="1"});let u=o.elements.enable_vector_store;u?r.enable_vector_store=u.checked?"1":"0":r.enable_vector_store="0";let m=o.elements["openai_vector_store_ids[]"];m?r.openai_vector_store_ids=Array.from(m.selectedOptions).map(S=>S.value):r.openai_vector_store_ids=[];let k=o.querySelector("#aipkit_cw_prompt_mode_hidden_input");k?r.prompt_mode=k.value:r.prompt_mode="custom";let f=o.querySelector("#aipkit_cw_mode_select"),w=f?f.value:"task";r.cw_generation_mode=w==="single"?"task":w;let E=o.elements["post_categories[]"];E?r.post_categories=Array.from(E.selectedOptions).map(S=>S.value):r.post_categories=[];let y=["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt"],I=typeof window.aipkit_getContentWriterPromptSets=="function"?window.aipkit_getContentWriterPromptSets():null;return I&&I.create&&y.forEach(S=>{Object.prototype.hasOwnProperty.call(I.create,S)&&(r[S]=I.create[S])}),I&&I.update&&y.forEach(S=>{let h=`${S}_update`;Object.prototype.hasOwnProperty.call(I.update,S)&&(r[h]=I.update[S])}),r}window.aipkit_getContentWriterFormConfig=g})();(function(){"use strict";function g(o){if(!o||!o.value)return!1;let r=o.value,n=window.aipkit_cw_template_state.currentTemplates.find(e=>String(e.id)===String(r));return n&&String(n.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_content_writer_post_status"),r=document.getElementById("aipkit_cw_schedule_options_wrapper"),n=document.getElementById("aipkit_cw_smart_schedule_fields"),e=document.querySelector(".aipkit_schedule_from_input_help"),i=document.querySelector(".aipkit_schedule_from_input_option");if(!o||!r)return;let c=o.value==="publish";r.style.display=c?"block":"none";let s=document.getElementById("aipkit_cw_mode_select"),t=s?s.value:"task",d=new Set(["task","csv","gsheets"]),a=d.has(t);if(i){i.style.display=a?"inline-flex":"none";let _=i.querySelector('input[name="schedule_mode"]');if(!a&&_&&_.checked){let u=document.querySelector('input[name="schedule_mode"][value="immediate"]');u&&(u.checked=!0,u.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(_=>{_.dataset.listenerAttached||(_.addEventListener("change",function(){let u=document.getElementById("aipkit_cw_mode_select"),m=u?u.value:"task",k=d.has(m);n&&(n.style.display=this.value==="smart"?"block":"none"),e&&(e.style.display=this.value==="from_input"&&k?"block":"none")}),_.dataset.listenerAttached="true")});let p=document.querySelector('input[name="schedule_mode"]:checked');p&&n&&(n.style.display=p.value==="smart"?"block":"none"),p&&e&&(e.style.display=p.value==="from_input"&&a?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(i){return i},o={image_title_prompt:"aipkit_cw_image_title_prompt",image_alt_text_prompt:"aipkit_cw_image_alt_text_prompt",image_caption_prompt:"aipkit_cw_image_caption_prompt",image_description_prompt:"aipkit_cw_image_description_prompt"};function r(i){if(!i)return"";let c=document.querySelector(`.aipkit_cw_prompt_library_select[data-aipkit-prompt-target="${CSS.escape(i)}"]`);if(!c)return"";let s=c.querySelector("option");return s?s.value:""}function n(){let i=document.getElementById("aipkit_cw_single_output_wrapper"),c=document.getElementById("aipkit_cw_generated_title_display"),s=document.getElementById("aipkit_cw_generated_content_area"),t=document.getElementById("aipkit_cw_meta_chunk"),d=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),a=document.querySelector(".aipkit_content_writer_output_actions");i&&(i.style.display="none"),c&&(c.style.display="none",c.textContent=""),s&&(s.innerHTML=""),t&&(t.style.display="none"),d&&(d.style.display="none"),a&&(a.style.display="none"),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction()}function e(i,c=!1){let s=window.aipkit_cw_autosave_suspended===!0;window.aipkit_cw_autosave_suspended=!0;try{let t=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,d=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.currentTemplateId=i,i?sessionStorage.setItem("aipkit_cw_last_template_id",i):sessionStorage.removeItem("aipkit_cw_last_template_id");let a=window.aipkit_cw_template_state.currentTemplates.find(u=>String(u.id)===String(i)),l;if(a)l=JSON.parse(JSON.stringify(a.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),d&&!c&&d("Error: Cannot load default template.");return}l=window.aipkit_getDefaultContentWriterTemplateConfig()}let p=l&&l.template_scope==="prompts_only";p||(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(l)),window.aipkit_cw_template_state.currentTemplateModified=!1),n();let _=document.getElementById("aipkit_content_writer_form");if(!_){console.error("Apply Template: Content writer form not found.");return}if(!p&&l.ai_model&&_.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=l.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,l.image_model&&_.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=l.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,p){let u=document.getElementById("aipkit_cw_prompt_mode_hidden_input");u&&(u.value=l.prompt_mode||"custom"),["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt"].forEach(S=>{let h=Object.prototype.hasOwnProperty.call(l,S),M=_.elements[S];if(!M)return;let b=l[S]===null||typeof l[S]>"u"?"":l[S],A=!!o[S],x=typeof b=="string"?b.trim()==="":b==="";if((!h||x)&&A){M.value=r(o[S]);return}h&&(M.value=b)}),["generate_images_enabled","generate_featured_image","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(S=>{if(!Object.prototype.hasOwnProperty.call(l,S))return;let h=_.elements[S];if(!h)return;let M=l[S];h.checked=M==="1"||M===1||M===!0}),["generate_title","generate_content","generate_meta_description","generate_focus_keyword","generate_excerpt","generate_tags"].forEach(S=>{if(!Object.prototype.hasOwnProperty.call(l,S))return;let h=_.elements[S];if(!h)return;let M=l[S];h.checked=M==="1"||M===1||M===!0});let w=_.elements.content_length;w&&Object.prototype.hasOwnProperty.call(l,"content_length")&&(w.value=l.content_length||"medium",w.dispatchEvent(new Event("change",{bubbles:!0})));let E=_.elements.image_provider;E&&Object.prototype.hasOwnProperty.call(l,"image_provider")&&(E.value=l.image_provider||"",E.dispatchEvent(new Event("change",{bubbles:!0}))),["image_count","image_size","image_alignment","image_placement"].forEach(S=>{if(!Object.prototype.hasOwnProperty.call(l,S))return;let h=_.elements[S];if(!h)return;let M=l[S]===null||typeof l[S]>"u"?"":l[S];h.type==="checkbox"?h.checked=M==="1"||M===1||M===!0:h.value=M});let I=_.elements.image_model;if(I&&Object.prototype.hasOwnProperty.call(l,"image_model")){let S=l.image_model||"";S&&I.querySelector(`option[value="${CSS.escape(S)}"]`)&&(I.value=S)}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI()}else{["ai_provider","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(A=>{let x=_.elements[A];if(x){let v=Object.prototype.hasOwnProperty.call(l,A),C=l[A]===null||typeof l[A]>"u"?"":l[A],P=!!o[A],$=typeof C=="string"?C.trim()==="":C==="";if((!v||$)&&P){x.value=r(o[A]);return}if(A==="gsheets_credentials"&&typeof C=="object"&&C!==null)x.value=JSON.stringify(C,null,2);else if((A==="ai_temperature"||A==="vector_store_top_k"||A==="vector_store_confidence_threshold")&&x.type==="range"){x.value=C||(A==="ai_temperature"?"1.0":A==="vector_store_top_k"?"3":A==="vector_store_confidence_threshold"?"20":"");let U=document.getElementById(x.id+"_value");U&&(U.textContent=A==="vector_store_confidence_threshold"?x.value+"%":x.value)}else x.type==="checkbox"?x.checked=C==="1":x.value=C;A==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),A==="content_length"&&x.dispatchEvent(new Event("change",{bubbles:!0}))}});let m=_.elements.gsheets_credentials;if(m){let A=l.gsheets_credentials,x=m.closest(".aipkit_gsheets_section_container");m.value=typeof A=="object"&&A!==null?JSON.stringify(A,null,2):A||"",m.value?(m.dataset.filename="credentials.json",x&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(x),100)):(delete m.dataset.filename,x&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(x,"clear"))}let k={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",enable_vector_store:"0"};for(let[A,x]of Object.entries(k)){let v=_.elements[A];if(v){let C=Object.prototype.hasOwnProperty.call(l,A)?l[A]:x;v.checked=C==="1"||C===1||C===!0}}let f=document.getElementById("aipkit_cw_prompt_mode_hidden_input");f&&(f.value=l.prompt_mode||"custom");let w=_.querySelector("#aipkit_cw_mode_select"),E=l.cw_generation_mode||"task",y=E==="single"?"task":E;w&&(w.value=y,w.dispatchEvent(new Event("change",{bubbles:!0})));let I=_.elements["post_categories[]"];if(I){let A=Array.isArray(l.post_categories)?l.post_categories.map(x=>String(x)):[];Array.from(I.options).forEach(x=>{x.selected=A.includes(x.value)}),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect()}let S=_.elements["openai_vector_store_ids[]"];if(S){let A=Array.isArray(l.openai_vector_store_ids)?l.openai_vector_store_ids.map(String):[];Array.from(S.options).forEach(x=>{x.selected=A.includes(x.value)}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect()}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI();let h=_.elements.enable_vector_store;h&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(h.closest(".aipkit_popover_options_list")||h.closest(".aipkit_cw_settings_popover_body")||document.getElementById("aipkit_content_writer_container"));let M=_.elements.vector_store_provider;M&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(M.value=l.vector_store_provider||"openai",M.dispatchEvent(new Event("change",{bubbles:!0})));let b=_.elements.ai_provider;if(b){let A=b.value,x=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),v=(l.ai_provider||x).toLowerCase();if(A!==v)b.value=v,b.dispatchEvent(new Event("change",{bubbles:!0}));else{let C=_.elements.ai_model;C&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(b,C):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}b.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(i?b.dataset.aipkitProviderNoticeArmed="true":delete b.dataset.aipkitProviderNoticeArmed,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(_))}}if(typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts(),typeof window.aipkit_applyContentWriterPromptSets=="function"&&window.aipkit_applyContentWriterPromptSets(l),p&&(typeof window.aipkit_getContentWriterFormConfig=="function"&&(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=window.aipkit_getContentWriterFormConfig(_)),window.aipkit_cw_template_state.currentTemplateModified=!1),!c&&t&&t("Updated"),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(i),typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(i),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let u=document.getElementById("aipkit_content_writer_container");u&&window.aipkit_cw_toggleReasoningEffort(u)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers(),typeof window.aipkit_refreshUrlCounter=="function"&&window.aipkit_refreshUrlCounter(),typeof window.aipkit_refreshRssCounter=="function"&&window.aipkit_refreshRssCounter()}finally{s||(window.aipkit_cw_autosave_suspended=!1),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline()}}window.aipkit_applyContentWriterTemplate=e})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};async function o(r){if(!r){console.error("Fetch & Populate Templates: Select element is missing.");return}let n=document.getElementById("aipkit_content_writer_template_nonce_field"),e=typeof window.aipkit_clearGeneralStatus=="function"?window.aipkit_clearGeneralStatus:null,i=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;r.innerHTML=`<option value="">${g("Loading templates...")}</option>`,r.disabled=!0,e&&e();try{let c=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:n?n.value:""});window.aipkit_cw_template_state.currentTemplates=c.templates||[],r.innerHTML="";let s=new Option(g("-- Select Template --"),"");r.appendChild(s);let t=window.aipkit_cw_template_state.currentTemplates||[],d=window.aipkit_dashboard?.currentUserId?.toString(),a=null,l=[],p=[],_={};t.forEach(f=>{if(String(f.is_default)==="1"&&f.user_id.toString()===d&&(a=f.id),f.user_id.toString()===d)String(f.is_starter)==="1"||f.is_starter===!0?l.push(f):p.push(f);else{let w=f.display_name||`User ID: ${f.user_id}`;_[w]||(_[w]=[]),_[w].push(f)}});let u=f=>{if(f&&f.starter_order!==void 0&&f.starter_order!==null&&f.starter_order!==""){let I=Number(f.starter_order);if(Number.isFinite(I))return I}let E=(f&&f.template_name?String(f.template_name):"").match(/(\d[\d,]*)/);if(!E)return null;let y=parseInt(E[1].replace(/,/g,""),10);return Number.isFinite(y)?y:null};if(p.sort((f,w)=>f.is_default==="1"?-1:w.is_default==="1"?1:f.template_name.localeCompare(w.template_name)),l.sort((f,w)=>{let E=u(f),y=u(w);return E!==null&&y!==null?E-y:E!==null?-1:y!==null?1:f.template_name.localeCompare(w.template_name)}),l.length>0){let f=document.createElement("optgroup");f.label=g("Starter Templates"),l.forEach(w=>{f.appendChild(new Option(g(w.template_name),w.id))}),r.appendChild(f)}if(p.length>0){let f=document.createElement("optgroup");f.label=g("My Templates"),p.forEach(w=>{f.appendChild(new Option(g(w.template_name),w.id))}),r.appendChild(f)}Object.keys(_).sort().forEach(f=>{let w=document.createElement("optgroup");w.label=g(f),_[f].forEach(E=>{w.appendChild(new Option(g(E.template_name),E.id))}),r.appendChild(w)}),r.disabled=!1;let k=sessionStorage.getItem("aipkit_cw_last_template_id");k&&r.querySelector(`option[value="${CSS.escape(k)}"]`)?(r.value=k,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(k,!0)):a?(r.value=a,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(a,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}catch(c){console.error("Error fetching templates:",c),r.innerHTML=`<option value="">${g("Error loading templates")}</option>`,i&&i(`Error: ${c.message||"Failed to load templates."}`),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}}window.aipkit_fetchAndPopulateTemplates=o})();(function(){"use strict";async function g(o,r,n){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let e=document.getElementById("aipkit_content_writer_template_nonce_field"),i=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,c=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,s=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;i&&i("Updating...");try{let t=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:o,template_name:r,config:JSON.stringify(n),_ajax_nonce:e?e.value:""});c&&c("Updated"),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(t.template_config||n)),window.aipkit_cw_template_state.currentTemplateModified=!1,typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline();let d=document.getElementById("aipkit_cw_template_select"),a=t.template_id?String(t.template_id):"";a&&(window.aipkit_cw_template_state.currentTemplateId=a,sessionStorage.setItem("aipkit_cw_last_template_id",a)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&d&&(await window.aipkit_fetchAndPopulateTemplates(d),a&&(d.value=a,typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(a))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(a||window.aipkit_cw_template_state.currentTemplateId)}catch(t){console.error("Error saving template:",t),s&&s(`Error: ${t.message||"Failed to save template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=g})();(function(){"use strict";function g(o){let r=document.getElementById("aipkit_cw_rename_template_btn"),n=document.getElementById("aipkit_cw_delete_template_btn"),e=window.aipkit_dashboard||{},i=e.isAdmin||!1,c=e.currentUserId?String(e.currentUserId):"0",s=window.aipkit_cw_template_state.currentTemplates.find(l=>String(l.id)===String(o));if(!s){r&&(r.disabled=!0),n&&(n.disabled=!0);return}let t=String(s.user_id)===c,d=t||i,a=t||i;r&&(r.disabled=!d),n&&(n.disabled=!a)}window.aipkit_updateTemplateActionButtonsState=g})();(function(){"use strict";function g(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let o=document.getElementById("aipkit_content_writer_form");if(!o)return;let r=window.aipkit_getContentWriterFormConfig(o),n=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(r,n),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=g})();(function(){"use strict";function g(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function o(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),n=r.value,e=r.options[r.selectedIndex],i=e?e.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!n||n===""||window.aipkit_isDefaultTemplateSelected(e)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot rename the default template or no template is selected.",{title:"Template"}):alert("Cannot rename the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("rename",i)}window.aipkit_handleRenameContentWriterTemplate=o})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(r){return r};function o(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),n=r.value,e=r.options[r.selectedIndex],i=e?e.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete: core function missing.",{title:"Template"}):alert("Cannot delete: core function missing."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!n||n===""||window.aipkit_isDefaultTemplateSelected(e)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete the default template or no template is selected.",{title:"Template"}):alert("Cannot delete the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateDeleteConfirm(i)}window.aipkit_handleDeleteContentWriterTemplate=o})();(function(){"use strict";let g=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,o=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,r=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;async function n(){if(!window.aipkit_cw_template_state||window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_content_writer_template_nonce_field"),c=document.getElementById("aipkit_cw_template_select");window.aipkit_cw_template_state.isSavingOrDeleting=!0,g&&g("Resetting starter templates...");try{await window.aipkit_apiRequest("aipkit_reset_cw_starter_templates",{_ajax_nonce:i?i.value:""}),sessionStorage.removeItem("aipkit_cw_last_template_id"),c&&typeof window.aipkit_fetchAndPopulateTemplates=="function"&&await window.aipkit_fetchAndPopulateTemplates(c),o&&o("Starter templates reset."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover()}catch(s){console.error("Error resetting starter templates:",s),r&&r(`Error: ${s.message||"Failed to reset starter templates."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}function e(){let i="Reset starter templates to their original defaults?",c="Starter Templates";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(i,{title:c,confirmText:"Reset",cancelText:"Cancel",onConfirm:n});return}window.confirm(i)&&n()}window.aipkit_handleResetStarterTemplates=e})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(_){return _},o={short:"Quick reads, ideal for news or updates",medium:"Standard blog posts with good depth",long:"In-depth guides and pillar content"};function r(_){let u=_.toLowerCase();return u.includes("short")?o.short:u.includes("medium")?o.medium:u.includes("long")?o.long:/\b600\b/.test(u)?o.short:/\b1200\b/.test(u)?o.medium:/\b2000\b/.test(u)?o.long:""}function n(_,u){if(u){let m=_.template_name.toLowerCase();return m.includes("short")?"dashicons-text-page":m.includes("medium")?"dashicons-text":m.includes("long")?"dashicons-media-document":"dashicons-star-filled"}return _.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function e(){return{select:document.getElementById("aipkit_cw_template_select"),button:document.getElementById("aipkit_cw_template_picker_btn"),label:document.getElementById("aipkit_cw_template_picker_label"),list:document.getElementById("aipkit_cw_template_picker_list"),search:document.getElementById("aipkit_cw_template_picker_search"),searchClear:document.getElementById("aipkit_cw_template_picker_search_clear")}}function i(_,u){let m=[],k=[],f={};_.forEach(y=>{if(y.user_id.toString()===u)String(y.is_starter)==="1"||y.is_starter===!0?m.push(y):k.push(y);else{let I=y.display_name||`User ID: ${y.user_id}`;f[I]||(f[I]=[]),f[I].push(y)}});let w=y=>{if(y&&y.starter_order!==void 0&&y.starter_order!==null&&y.starter_order!==""){let M=Number(y.starter_order);if(Number.isFinite(M))return M}let S=(y&&y.template_name?String(y.template_name):"").match(/(\d[\d,]*)/);if(!S)return null;let h=parseInt(S[1].replace(/,/g,""),10);return Number.isFinite(h)?h:null};m.sort((y,I)=>{let S=w(y),h=w(I);return S!==null&&h!==null?S-h:S!==null?-1:h!==null?1:y.template_name.localeCompare(I.template_name)}),k.sort((y,I)=>y.is_default==="1"?-1:I.is_default==="1"?1:y.template_name.localeCompare(I.template_name));let E={};return Object.keys(f).sort().forEach(y=>{E[y]=f[y].sort((I,S)=>I.template_name.localeCompare(S.template_name))}),{starterTemplates:m,myTemplates:k,otherUsersTemplates:E}}function c(_){let{label:u,button:m}=e();if(!u||!m||!_)return;let k=_.options[_.selectedIndex],f=k?k.text:g("Select template");u.textContent=f||g("Select template")}function s(_,u){if(!_)return;let m=String(u||"");_.querySelectorAll(".aipkit_cw_template_list_item").forEach(k=>{let w=(k.dataset.templateId||"")===m;k.classList.toggle("is-active",w),k.setAttribute("aria-selected",w?"true":"false")})}function t(_,u=""){let{list:m}=e();if(!m||!_)return;let k=window.aipkit_cw_template_state?.currentTemplates||[],f=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!k.length){let b=_.disabled&&_.options.length&&_.options[0].text.toLowerCase().includes("loading"),A=document.createElement("div");A.className="aipkit_cw_template_picker_empty",A.textContent=g(b?"Loading templates...":"No templates found."),m.appendChild(A),c(_);return}let w=i(k,f),E=document.createDocumentFragment(),y=u.toLowerCase().trim(),I=(b,A)=>{let x=document.createElement("div");if(x.className="aipkit_cw_template_group_label",A){let C=document.createElement("span");C.className=`dashicons ${A}`,C.setAttribute("aria-hidden","true"),x.appendChild(C)}let v=document.createElement("span");return v.textContent=g(b),x.appendChild(v),x},S=(b,A)=>{let x=document.createElement("button");x.type="button",x.className="aipkit_cw_template_list_item",A&&x.classList.add("is-starter"),b.is_default==="1"&&x.classList.add("is-default"),x.dataset.templateId=String(b.id),x.dataset.templateLabel=b.template_name.toLowerCase(),x.setAttribute("role","option"),x.setAttribute("aria-selected","false");let v=n(b,A),C=document.createElement("span");C.className=`aipkit_cw_template_list_icon dashicons ${v}`,C.setAttribute("aria-hidden","true");let P=document.createElement("span");P.className="aipkit_cw_template_list_content";let $=document.createElement("span");if($.className="aipkit_cw_template_list_name",$.textContent=g(b.template_name),P.appendChild($),A){let B=r(b.template_name);if(B){let D=document.createElement("span");D.className="aipkit_cw_template_list_desc",D.textContent=g(B),P.appendChild(D)}}let U=document.createElement("span");return U.className="aipkit_cw_template_list_check dashicons dashicons-yes",U.setAttribute("aria-hidden","true"),x.appendChild(C),x.appendChild(P),x.appendChild(U),x},h=(b,A,x,v=!1)=>{let C=y?A.filter($=>$.template_name.toLowerCase().includes(y)):A;if(!C.length)return 0;let P=document.createElement("div");return P.className="aipkit_cw_template_group",v&&P.classList.add("is-starter-group"),P.appendChild(I(b,x)),C.forEach($=>{P.appendChild(S($,v))}),E.appendChild(P),C.length},M=0;if(M+=h("Starter Templates",w.starterTemplates,"dashicons-star-filled",!0),M+=h("My Templates",w.myTemplates,"dashicons-admin-users",!1),Object.keys(w.otherUsersTemplates).forEach(b=>{M+=h(b,w.otherUsersTemplates[b],"dashicons-groups",!1)}),M===0){let b=document.createElement("div");b.className="aipkit_cw_template_picker_empty",b.textContent=g(y?"No templates match your search.":"No templates found."),m.appendChild(b)}else m.appendChild(E);c(_),s(m,_.value)}function d(_){let{select:u}=e();u&&t(u,_)}function a(){let{search:_,searchClear:u}=e();if(!_)return;let m=null;_.addEventListener("input",f=>{let w=f.target.value;u&&(u.style.display=w?"flex":"none"),clearTimeout(m),m=setTimeout(()=>{d(w)},150)}),u&&u.addEventListener("click",()=>{_.value="",u.style.display="none",d(""),_.focus()});let k=document.getElementById("aipkit_cw_template_picker_popover");k&&new MutationObserver(w=>{w.forEach(E=>{E.attributeName==="aria-hidden"&&k.getAttribute("aria-hidden")==="true"&&_.value&&(_.value="",u&&(u.style.display="none"),d(""))})}).observe(k,{attributes:!0})}function l(){let{select:_,list:u,button:m}=e();!_||!u||(a(),u.dataset.listenerAttached||(u.addEventListener("click",k=>{let f=k.target.closest(".aipkit_cw_template_list_item");if(!f||!_)return;let w=f.dataset.templateId||"";_.value=w,_.dispatchEvent(new Event("change",{bubbles:!0})),s(u,w),m&&m.click()}),u.dataset.listenerAttached="true"),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",()=>{c(_),s(u,_.value)}),_.dataset.listenerAttached="true"),t(_))}function p(_){let{select:u,list:m}=e();u&&(_!==void 0&&(u.value=_),c(u),s(m,u.value))}window.aipkit_initTemplatePicker=l,window.aipkit_renderTemplatePicker=t,window.aipkit_updateTemplatePickerSelection=p})();(function(){"use strict";function g(){let e=document.getElementById("aipkit_cw_template_action_list"),i=document.getElementById("aipkit_cw_template_inline_form"),c=document.getElementById("aipkit_cw_template_inline_delete_confirm"),s=document.getElementById("aipkit_cw_template_name_input");e&&(e.style.display=""),i&&(i.style.display="none",delete i.dataset.mode),c&&(c.style.display="none"),s&&(s.value="")}function o(){g()}function r(e,i=""){let c=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_name_input"),t=document.getElementById("aipkit_cw_template_action_list");!c||!s||(t&&(t.style.display="none"),c.style.display="flex",c.dataset.mode=e,s.value=i,s.focus())}function n(){let e=document.getElementById("aipkit_cw_template_inline_form"),i=document.getElementById("aipkit_cw_template_name_input");!e||!i||o()}window.aipkit_showTemplateNameForm=r,window.aipkit_hideTemplateNameForm=n,window.aipkit_closeTemplateActionsPopover=o,window.aipkit_resetTemplateActionsPanel=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function o(n){let e=document.getElementById("aipkit_cw_template_inline_form"),i=document.getElementById("aipkit_cw_template_inline_delete_confirm"),c=document.getElementById("aipkit_cw_template_delete_confirm_text"),s=document.getElementById("aipkit_cw_template_action_list");!e||!i||!c||(e.style.display="none",s&&(s.style.display="none"),i.style.display="flex",c.innerHTML=`Delete "<strong>${g(n)}</strong>"?`)}function r(){let n=document.getElementById("aipkit_cw_template_inline_delete_confirm"),e=document.getElementById("aipkit_cw_template_action_list");n&&(n.style.display="none",e&&(e.style.display=""),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover())}window.aipkit_showTemplateDeleteConfirm=o,window.aipkit_hideTemplateDeleteConfirm=r})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_cw_template_save_inline_btn"),r=document.getElementById("aipkit_cw_template_cancel_inline_btn"),n=document.getElementById("aipkit_cw_template_inline_form"),e=document.getElementById("aipkit_cw_template_name_input");if(!o||!r||!n||!e){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),o.addEventListener("click",async()=>{let i=n.dataset.mode,c=e.value.trim();if(!c){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}let s=document.getElementById("aipkit_content_writer_form"),t=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let d=window.aipkit_getContentWriterFormConfig(s);if(i==="new")await window.aipkit_saveContentWriterTemplate(0,c,d);else if(i==="rename"){let a=t.value;a&&await window.aipkit_saveContentWriterTemplate(parseInt(a),c,d)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_cw_template_confirm_delete_btn"),r=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!o||!r){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),o.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let n=document.getElementById("aipkit_cw_template_select"),e=n.value,i=document.getElementById("aipkit_content_writer_template_nonce_field"),c=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,s=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,t=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.isSavingOrDeleting=!0,c&&c("Updating...");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:e,_ajax_nonce:i?i.value:""}),s&&s("Updated"),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(n)}catch(d){console.error("Error deleting template:",d),t&&t(`Error: ${d.message||"Failed to delete template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_cw_template_select");if(!o){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(o):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?o.addEventListener("change",r=>window.aipkit_applyContentWriterTemplate(r.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_cw_save_as_template_btn");if(!o){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_cw_rename_template_btn");if(!o){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_cw_delete_template_btn");if(!o){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_cw_reset_starter_templates_btn");if(!o){console.warn("bindResetStarterTemplatesBtn: Button not found.");return}typeof window.aipkit_handleResetStarterTemplates=="function"?o.addEventListener("click",window.aipkit_handleResetStarterTemplates):console.error("bindResetStarterTemplatesBtn: handleResetStarterTemplates function missing.")}window.aipkit_bindResetStarterTemplatesBtn=g})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_content_writer_post_status");if(!o){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(o.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=g})();(function(){"use strict";function g(){let o=document.querySelector(".aipkit_content_writer_inputs");if(!o){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(o.addEventListener("input",window.aipkit_checkFormForModifications),o.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=g})();(function(){"use strict";function g(){let o=["aipkit_initTemplateSelect","aipkit_initTemplatePicker","aipkit_bindSaveAsTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindResetStarterTemplatesBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let n of o)if(typeof window[n]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${n}`);return}window.aipkit_initTemplateSelect(),window.aipkit_initTemplatePicker(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindResetStarterTemplatesBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let r=document.getElementById("aipkit_cw_template_select");r&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(r.value):r&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function o(){let n=document.getElementById("aipkit_cw_save_as_post_btn");if(!n){console.warn("Save as Post Handler: Button not found.");return}n.addEventListener("click",r)}async function r(){let n=document.getElementById("aipkit_content_writer_form"),e=document.getElementById("aipkit_cw_save_as_post_btn"),i=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_save_post_status");if(!n||!e||!i||!c||!s){console.error("Save as Post: Missing required UI elements.");return}let d=(typeof window.aipkit_getContentWriterRawHtml=="function"?window.aipkit_getContentWriterRawHtml():"")||i.innerHTML;if(!(i.textContent.trim().length>0||!!i.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))){s&&(s.textContent="Nothing to save. Please generate content first.",s.className="aipkit_cw_save_status aipkit_settings_message-error");return}let l=document.getElementById("aipkit_cw_generated_title_display"),p={post_title:l?l.textContent:"Untitled AI Post",post_content:d,generated_excerpt:n.elements.generated_excerpt?.value||"",generated_tags:n.elements.generated_tags?.value||"",meta_description:n.elements.meta_description?n.elements.meta_description.value:"",focus_keyword:n.elements.focus_keyword?n.elements.focus_keyword.value:"",post_type:n.elements.post_type?n.elements.post_type.value:"post",post_author:n.elements.post_author?n.elements.post_author.value:1,post_status:n.elements.post_status?n.elements.post_status.value:"draft",post_schedule_date:n.elements.post_schedule_date?n.elements.post_schedule_date.value:"",post_schedule_time:n.elements.post_schedule_time?n.elements.post_schedule_time.value:"",post_categories:n.elements["post_categories[]"]?Array.from(n.elements["post_categories[]"].selectedOptions).map(_=>_.value):[],generate_toc:n.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:n.elements.image_alignment?n.elements.image_alignment.value:"none",image_size:n.elements.image_size?n.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};s&&(s.textContent="Saving post...",s.className="aipkit_cw_save_status aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(e,!0,"Save","Saving...");try{let _=await window.aipkit_apiRequest("aipkit_content_writer_save_post",p);s&&(s.textContent=_.message||"Post saved successfully!",s.className="aipkit_cw_save_status aipkit_settings_message-success",_.edit_link&&(s.innerHTML+=` <a href="${g(_.edit_link)}" target="_blank">Edit Post</a>`))}catch(_){console.error("Error saving post:",_),s&&(s.textContent=`Error: ${_.message||"Failed to save post."}`,s.className="aipkit_cw_save_status aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Save as Post"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_cw_save_status")},5e3)}}window.aipkit_initSaveAsPostButton=o})();(function(){"use strict";function g(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let r=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),i=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn"),s=document.getElementById("aipkit_content_writer_provider"),t=document.getElementById("aipkit_content_writer_model"),d=document.getElementById("aipkit_content_writer_temperature"),a=document.getElementById("aipkit_cw_save_as_post_btn"),l=document.querySelector(".aipkit_cw_generation_status_indicators");if(!r||!n||!e||!i||!c||!s||!t||!d||!a){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(o):console.error("Content Writer Main: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initContentWriterAssistantSheet=="function"&&window.aipkit_initContentWriterAssistantSheet(o),typeof window.aipkit_initContentWriterPromptFlyouts=="function"?window.aipkit_initContentWriterPromptFlyouts(o):console.error("Content Writer Main: aipkit_initContentWriterPromptFlyouts function not found."),typeof window.aipkit_initContentWriterPromptModeManager=="function"?window.aipkit_initContentWriterPromptModeManager(o):console.error("Content Writer Main: aipkit_initContentWriterPromptModeManager function not found."),typeof window.aipkit_initContentWriterBulkEditor=="function"?window.aipkit_initContentWriterBulkEditor(o):console.error("Content Writer Main: aipkit_initContentWriterBulkEditor function not found."),typeof window.aipkit_initContentWriterGenerateMenu=="function"?window.aipkit_initContentWriterGenerateMenu():console.error("Content Writer Main: aipkit_initContentWriterGenerateMenu function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_content_writer_container"),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(o):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_initContentWriterExistingContent=="function"?window.aipkit_initContentWriterExistingContent(o):console.error("Content Writer Main: aipkit_initContentWriterExistingContent function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(s.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(o)}),t.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(o)}),window.aipkit_cw_toggleReasoningEffort(o)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_content_writer_container"):console.error("Content Writer Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"?window.aipkit_initContentWriterVectorStoreMultiSelect(o):console.error("Content Writer Main: aipkit_initContentWriterVectorStoreMultiSelect function not found."),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"?window.aipkit_initContentWriterCategoriesMultiSelect(o):console.error("Content Writer Main: aipkit_initContentWriterCategoriesMultiSelect function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(s,t,d,n,i,c):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initContentWriterAutosave=="function"?window.aipkit_initContentWriterAutosave():console.error("Content Writer Main: aipkit_initContentWriterAutosave function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let p=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;p&&typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),p&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():p&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),p&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():p&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(n,r,l,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(e,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){a&&(a.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){a&&(a.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=g})();(function(){"use strict";let g=!1,o=null,r=null,n=null,e=!1,i=null,c="aipkit_image_generator_status",s="aipkit_image_gen_preview_theme",t=["dark","light"];function d(){let R=document.getElementById("aipkit_image_generator_container");if(!R){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(R.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(L){console.error("AIPKit Image Generator: Error calling public UI initializer:",L);let K=document.getElementById("aipkit_public_image_results");K&&(K.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let L=document.getElementById("aipkit_public_image_results");L&&(L.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}D(R),U(R),x(R),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_image_generator_container"):console.error("AIPKit Image Generator: aipkit_initApiKeyToggles function not found.")}function a(){return document.getElementById(c)}function l(R,j){let L=a();if(!L)return;let K=L.classList.contains("aipkit_training_status");if(L.textContent=R||"",K){L.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),R&&L.classList.add("is-visible"),j&&L.classList.add(`is-${j}`);return}L.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),j==="success"?L.classList.add("aipkit_form-help-success"):j==="error"&&L.classList.add("aipkit_form-help-error")}function p(R=2500){n&&window.clearTimeout(n),n=window.setTimeout(()=>{l("","")},R)}function _(R){window.aipkit_dashboard||(window.aipkit_dashboard={});let j=window.aipkit_dashboard.providerStatus||{};j.replicate=!!String(R||"").trim(),window.aipkit_dashboard.providerStatus=j,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(document)}function u(){return document.getElementById("aipkit_image_generator_settings_form")}function m(){let R=u();if(!R)return console.error("AIPKit Image Settings: Settings form not found."),null;let j=new FormData(R);if(j.has("frontend_models")){let K=R.querySelector("#aipkit_image_gen_frontend_models");K&&K.value===""&&j.set("frontend_models","")}else{let K=R.querySelector("#aipkit_image_gen_frontend_models");K&&j.append("frontend_models",K.value||"")}let L={};return j.forEach((K,V)=>{L[V]=K}),Object.prototype.hasOwnProperty.call(L,"replicate_api_key")&&delete L.replicate_api_key,L}function k(R){if(!R)return"";let j={};return Object.keys(R).sort().forEach(L=>{j[L]=R[L]}),JSON.stringify(j)}function f(R){r=k(R)}function w(R){return k(R)!==r}function E(R){if(!(R||"").trim()||typeof window.aipkit_queueProviderSync!="function")return null;let L=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:V=>V;l(L("Syncing models...","gpt3-ai-content-generator"),"loading");let K=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return K&&typeof K.then=="function"&&K.then(()=>{l(L("Models synced!","gpt3-ai-content-generator"),"success"),p()}).catch(V=>{l(V?.message||L("Sync failed.","gpt3-ai-content-generator"),"error"),p(4e3)}),K}async function y(R){let j=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:L=>L;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Settings: aipkit_apiRequest not found.");return}l(j("Saving...","gpt3-ai-content-generator"),"loading");try{let L=await window.aipkit_apiRequest("aipkit_save_image_settings",R);return l(L.message||j("Settings saved!","gpt3-ai-content-generator"),"success"),p(),f(R),L}catch(L){throw l(L.message||j("Failed to save settings.","gpt3-ai-content-generator"),"error"),p(4e3),console.error("AIPKit Image Settings Save Error:",L),L}}async function I(R){let j=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:L=>L;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Generator: aipkit_apiRequest not found.");return}l(j("Saving...","gpt3-ai-content-generator"),"loading");try{let L=await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:R});return _(R),l(L.message||j("Replicate key saved!","gpt3-ai-content-generator"),"success"),p(),E(R),L}catch(L){throw l(L.message||j("Failed to save Replicate key.","gpt3-ai-content-generator"),"error"),p(4e3),console.error("AIPKit Replicate Key Save Error:",L),L}}function S(R){if(R){if(g){o=R;return}g=!0,y(R).catch(()=>{}).finally(()=>{if(g=!1,o){let j=o;o=null,w(j)&&S(j)}})}}function h(){let R=m();!R||!w(R)||S(R)}function M(){let R=m();R&&f(R)}function b(R){if(!R)return;let j="data-aipkit-image-autosave-attached";if(R.hasAttribute(j))return;let L=()=>{h()};R.addEventListener("change",K=>{let V=K.target;!V||!V.matches(".aipkit_autosave_trigger")||L()}),R.addEventListener("blur",K=>{let V=K.target;!V||!V.matches(".aipkit_autosave_trigger")||L()},!0),R.setAttribute(j,"true"),M()}function A(R){let j=R.querySelector("#aipkit_replicate_api_key");if(!j)return;let L="data-replicate-autosave-attached";if(j.hasAttribute(L))return;i=j.value||"",_(i);let K=()=>{let V=j.value||"";V===i||e||(e=!0,I(V).then(()=>{i=V}).catch(()=>{}).finally(()=>{e=!1;let ee=m();ee&&f(ee)}))};j.addEventListener("change",K),j.addEventListener("blur",K),j.setAttribute(L,"true")}function x(R){let j=R.querySelector("#aipkit_image_generator_settings_popover");if(!j)return;typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(R):console.error("AIPKit Image Generator: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),v(j);let L="data-token-listener-attached";j.hasAttribute(L)||(j.addEventListener("change",function(K){K.target.closest(".aipkit_token_limit_mode_select")&&C(j)}),j.setAttribute(L,"true")),C(j);try{P(j)}catch(K){console.error("AIPKit Image Settings: Failed to init model selector",K)}b(j),A(j)}function v(R){let j=R.querySelector("#aipkit_image_generator_settings_panel");if(!j)return;let L=Array.from(j.querySelectorAll("[data-aipkit-settings-panel]"));if(!L.length||j.dataset.panelsBound==="true")return;let K=R.querySelector(".aipkit_model_settings_popover_title"),V=R.querySelector(".aipkit_model_settings_popover_back"),ee=document.getElementById("aipkit_image_generator_settings_trigger"),J={root:j.dataset.titleRoot||"Settings","token-management":j.dataset.titleTokenManagement||"Token Management",replicate:j.dataset.titleReplicate||"Replicate","custom-css":j.dataset.titleCustomCss||"Custom CSS","provider-filtering":j.dataset.titleProviderFiltering||"Provider Filtering"},le=null,ue=be=>{let ze=be||"root",Me=j.querySelector(`[data-aipkit-settings-panel="${ze}"]`)||j.querySelector('[data-aipkit-settings-panel="root"]');if(!Me)return;let rt=Me.dataset.aipkitSettingsPanel||"root";if(rt!==le){if(L.forEach(Ue=>{Ue.hidden=Ue!==Me}),K&&(K.textContent=J[rt]||J.root),V&&(V.hidden=rt==="root"),rt==="token-management"&&C(R),rt==="replicate"){let Ue=R.querySelector("#aipkit_replicate_api_key");E(Ue?Ue.value:"")}le=rt,R.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))})}};j.addEventListener("click",be=>{let ze=be.target.closest("[data-aipkit-panel-target]");ze&&(be.preventDefault(),ue(ze.dataset.aipkitPanelTarget))}),V&&V.addEventListener("click",be=>{be.preventDefault(),ue("root")}),ee&&ee.addEventListener("click",()=>{ue("root")}),ue("root"),j.dataset.panelsBound="true"}function C(R){if(!R)return;let j=R.querySelector(".aipkit_token_limit_mode_select"),L=R.querySelector(".aipkit_token_general_user_limit_field"),K=R.querySelector(".aipkit_token_role_limits_container");if(!j||!L||!K)return;let V=j.value;L&&(L.hidden=V!=="general"),K&&(K.hidden=V!=="role_based")}function P(R){let j=R.querySelector("#aipkit_image_gen_models_selector");if(!j||j.getAttribute("data-enhanced")==="true")return;let L=R.querySelector("#aipkit_image_gen_frontend_models"),K=j.dataset.initialValue||"",ee=!0&&K===""?[]:K.split(",").map(we=>we.trim()).filter(Boolean),J=new Set(ee),le=window.aipkit_image_generator_config_public||{},ue=le.azure_models||[];if((!ue||ue.length===0)&&window.aipkit_dashboard_providers)try{Array.isArray(window.aipkit_dashboard_providers.AzureImage)&&(ue=window.aipkit_dashboard_providers.AzureImage.map(we=>typeof we=="string"?{id:we,name:we}:we))}catch{}let be=[{key:"openai",label:"OpenAI",type:"flat",models:(le.openai_models||[]).map(we=>({id:we.id,name:we.name}))},{key:"azure",label:"Azure",type:"flat",models:ue.map(we=>we.id?we:{id:we.id||we.name||we,name:we.name||we.id||we})},{key:"google",label:"Google",type:"grouped",models:le.google_models||{}},{key:"replicate",label:"Replicate",type:"flat",models:(le.replicate_models||[]).map(we=>we.id?we:{id:we.id||we.name||we,name:we.name||we.id||we})}].filter(we=>we.key==="azure"?!0:we.models&&(Array.isArray(we.models)?we.models.length:Object.keys(we.models).length));j.innerHTML="",j.classList.add("aipkit_models_selector--ready");let ze=document.createElement("input");ze.type="search",ze.placeholder="Filter models...",ze.className="aipkit_models_selector-search",j.appendChild(ze);let Me=document.createElement("div");Me.className="aipkit_models_selector-summary",j.appendChild(Me);let rt=document.createElement("div");rt.className="aipkit_models_selector-providers",j.appendChild(rt),be.forEach(we=>{let pt=document.createElement("div");pt.className="aipkit_models_selector-provider",pt.dataset.provider=we.key;let st=document.createElement("div");st.className="aipkit_models_selector-provider-header",st.innerHTML=`<strong>${we.label}</strong>`;let bt=document.createElement("div");bt.className="aipkit_models_selector-provider-actions";let wt=document.createElement("button");wt.type="button",wt.className="aipkit_btn aipkit_btn-xs",wt.textContent="All";let Ht=document.createElement("button");Ht.type="button",Ht.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",Ht.textContent="None",bt.appendChild(wt),bt.appendChild(Ht),st.appendChild(bt),pt.appendChild(st);let se=document.createElement("div");se.className="aipkit_models_selector-models";let me=de=>{if(!de||!de.id)return;let ve=de.id,qe=document.createElement("label");qe.className="aipkit_models_selector-item",qe.title=ve;let Se=document.createElement("input");Se.type="checkbox",Se.value=ve,Se.checked=J.has(ve),Se.dataset.modelId=ve,Se.addEventListener("change",()=>{vt(!0)});let Je=document.createElement("span");Je.textContent=de.name||ve,qe.appendChild(Se),qe.appendChild(Je),se.appendChild(qe)};if(we.type==="grouped"?Object.keys(we.models).forEach(de=>{let ve=we.models[de];if(!Array.isArray(ve))return;let qe=document.createElement("div");qe.className="aipkit_models_selector-subgroup",qe.textContent=de.charAt(0).toUpperCase()+de.slice(1),se.appendChild(qe),ve.forEach(Se=>me(Se))}):we.models.forEach(de=>me(de)),we.key==="azure"&&we.models.length===0){let de=document.createElement("div");de.className="aipkit_models_selector-empty",de.textContent="No Azure image models found. Sync Azure Image models in the main Models settings first.",se.appendChild(de)}wt.addEventListener("click",()=>{se.querySelectorAll('input[type="checkbox"]').forEach(de=>{de.checked=!0}),vt(!0)}),Ht.addEventListener("click",()=>{se.querySelectorAll('input[type="checkbox"]').forEach(de=>{de.checked=!1}),vt(!0)}),pt.appendChild(se),rt.appendChild(pt)}),ze.addEventListener("input",()=>{let we=ze.value.toLowerCase();rt.querySelectorAll(".aipkit_models_selector-item").forEach(pt=>{let st=pt.textContent.toLowerCase();pt.style.display=st.includes(we)?"":"none"})}),j.setAttribute("data-enhanced","true"),Ue();function Ue(){let we=Array.from(j.querySelectorAll(".aipkit_models_selector-item input:checked")).map(pt=>pt.value);we.length===0?Me.textContent="Showing all models (none selected)":Me.textContent=`${we.length} model${we.length>1?"s":""} selected`}function vt(we=!1){let pt=Array.from(j.querySelectorAll(".aipkit_models_selector-item input:checked")).map(st=>st.value.trim()).filter(Boolean);L&&(L.value=pt.join(", ")),Ue(),we&&h()}window.aipkit_syncAllowedModelsHiddenField=vt}function $(R=!1){typeof window.aipkit_syncAllowedModelsHiddenField=="function"&&window.aipkit_syncAllowedModelsHiddenField(R)}function U(R){let j=R.querySelector("#aipkit_theme_switcher_toggle_btn"),L=R.querySelector(".aipkit_image_generator_admin_preview_wrapper");if(!j||!L){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",R);return}let K=t.indexOf(localStorage.getItem(s)||"dark");K===-1&&(K=t.indexOf("dark")),B(t[K],L,j),j.hasAttribute("data-listener-attached")||(j.addEventListener("click",function(){K=(K+1)%t.length;let V=t[K];B(V,L,j),localStorage.setItem(s,V)}),j.setAttribute("data-listener-attached","true"))}function B(R,j,L){let K=j.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");K&&(t.forEach(J=>K.classList.remove(`aipkit-theme-${J}`)),K.classList.add(`aipkit-theme-${R}`));let V=R.charAt(0).toUpperCase()+R.slice(1),ee="Toggle Preview Theme";L.title=`${ee} (Current: ${V})`}function D(R){let j=R.querySelector("#aipkit_image_generator_shortcode_snippet"),L=R.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),K=R.querySelector("#aipkit_image_generator_shortcode_configurator"),V=R.querySelector("#aipkit_image_generator_shortcode_configurator .aipkit_model_settings_popover_close"),ee=R.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!j||!L||!K||ee.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",R);return}L.hasAttribute("data-listener-attached")||(L.addEventListener("click",()=>{let J=K.style.display==="none"||!K.style.display;K.style.display=J?"flex":"none",L.classList.toggle("aipkit_active",J),L.setAttribute("aria-expanded",J.toString())}),V&&V.addEventListener("click",()=>{K.style.display="none",L.classList.remove("aipkit_active"),L.setAttribute("aria-expanded","false")}),ee.forEach(J=>J.addEventListener("change",()=>N(R))),j.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(j.textContent,j):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),N(R),L.setAttribute("data-listener-attached","true"))}function N(R){let j=R.querySelector("#aipkit_image_generator_shortcode_snippet"),L=R.querySelector("#aipkit_image_generator_shortcode_configurator");if(!j||!L)return;let K=L.querySelector('input[name="cfg_show_provider"]').checked,V=L.querySelector('input[name="cfg_show_model"]').checked,ee=L.querySelector('input[name="cfg_show_history"]').checked,J=L.querySelector('select[name="cfg_theme"]'),le=L.querySelector('input[name="cfg_theme"]:checked'),ue=J?J.value:le?le.value:"dark",be="[aipkit_image_generator";K||(be+=' show_provider="false"'),V||(be+=' show_model="false"'),ee&&(be+=' history="true"'),ue!=="dark"&&(be+=` theme="${ue}"`),be+="]",j.textContent=be}window.aipkit_initImageGenerator=d})();(function(){"use strict";function g(o,r,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,i=e?.nonce_generate_title,c=e?.text||{};if(!i){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,n);return}let s={_ajax_nonce:i,post_id:o};window.aipkit_apiRequest("aipkit_generate_title_suggestions",s).then(t=>{if(!t?.suggestions||t.suggestions.length===0)throw new Error(c.no_suggestions_title||"No title suggestions generated.");typeof r=="function"&&r(null,t.suggestions,n)}).catch(t=>{console.error("AIPKit Post Enhancer Fetcher (Title):",t),typeof r=="function"&&r(t,null,n)})}window.aipkit_fetchTitleSuggestions=g})();(function(){"use strict";let g=null;function o(){g&&(g.classList.remove("aipkit-active"),g.addEventListener("transitionend",()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},{once:!0}),setTimeout(()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function r(i,c,s){g&&o();let t=window.aipkit_escapeHtml||function(f){return f},d=window.aipkit_escapeAttribute||t,a=s?.default_ai_provider||"N/A",l=s?.default_ai_model||"N/A",p=s?.default_ai_params||{},_=p.temperature!==void 0?parseFloat(p.temperature).toFixed(1):"N/A",m=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${t(a)}</strong>`).replace("%2$s",`<strong>${t(l)}</strong>`).replace("%3$s",t(_));g=document.createElement("div"),g.className="aipkit-modal-overlay",g.addEventListener("click",f=>{f.target===g&&o()});let k=document.createElement("div");return k.className="aipkit-modal-content",k.dataset.postId=i,k.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${t(c.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${t(c.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,g.appendChild(k),document.body.appendChild(g),k.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{g.classList.add("aipkit-active")}),g}function n(i,c){if(!g)return;let s=g.querySelector(".aipkit-modal-body");if(!s)return;let t=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||t;s.innerHTML=`
            <p>${t(c.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${i.map(l=>`<li data-new-title="${d(l)}">${t(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let a=s.querySelector(".aipkit-suggestions-list");a&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(a):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function e(i,c){if(!g)return;let s=g.querySelector(".aipkit-modal-body");if(!s)return;let t=window.aipkit_escapeHtml||function(d){return d};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${t(c.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${t(i)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=r,window.aipkit_updateModalWithSuggestions=n,window.aipkit_updateModalWithError=e,window.aipkit_closePostTitleModal=o})();(function(){"use strict";let g=!1;function o(){g=!1}function r(i){if(g)return;g=!0;let c=i.currentTarget,s=c.closest(".aipkit-modal-content"),t=s?.dataset.postId,d=c.dataset.newTitle,a=s?.querySelector(".aipkit-modal-status"),l=s?.querySelectorAll(".aipkit-suggestions-list li"),p=window.aipkit_post_enhancer?.text||{};if(!t||!d||!a||!l){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),a&&(a.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),g=!1;return}l.forEach(_=>_.classList.add("aipkit-disabled")),a.innerHTML=`<span class="aipkit_spinner"></span> ${p.updating_title||"Updating Title..."}`,a.style.color="",n(t,d,a,l,p)}function n(i,c,s,t,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',t.forEach(p=>p.classList.remove("aipkit-disabled")),g=!1;return}let a=window.aipkit_post_enhancer?.nonce_update_title;if(!a){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',t.forEach(p=>p.classList.remove("aipkit-disabled")),g=!1;return}let l={_ajax_nonce:a,post_id:i,new_value:c};window.aipkit_apiRequest("aipkit_update_post_title",l).then(p=>{let _=document.querySelector(`#post-${i} .row-title`);_?_.textContent=c:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${i}.`);let u=document.getElementById(`post-${i}`);if(u){let m=u.querySelector(`#inline_${i}`);if(m){let k=m.querySelector(".post_title");k?k.textContent=c:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${i}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${i}.`)}window.aipkit_closePostTitleModal()}).catch(p=>{console.error("AIPKit Post Enhancer Update Error (Title):",p),s.innerHTML=`<span class="error">${p.message||d.error_updating_title||"Error updating title."}</span>`,t.forEach(_=>_.classList.remove("aipkit-disabled"))}).finally(()=>{g=!1})}function e(i){i&&i.addEventListener("click",function(c){let s=c.target.closest("li[data-new-title]");s&&r({currentTarget:s})})}window.aipkit_attachSuggestionClickListener=e,window.aipkit_resetTitleUpdateFlag=o})();(function(){"use strict";function g(o,r,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,i=e?.nonce_generate_excerpt,c=e?.text||{};if(!i){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,n);return}let s={_ajax_nonce:i,post_id:o};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",s).then(t=>{if(!t?.suggestions||t.suggestions.length===0)throw new Error(c.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof r=="function"&&r(null,t.suggestions,n)}).catch(t=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",t),typeof r=="function"&&r(t,null,n)})}window.aipkit_fetchExcerptSuggestions=g})();(function(){"use strict";let g=null;function o(){g&&(g.classList.remove("aipkit-active"),g.addEventListener("transitionend",()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},{once:!0}),setTimeout(()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function r(i,c,s){g&&o();let t=window.aipkit_escapeHtml||function(f){return f},d=window.aipkit_escapeAttribute||t,a=s?.default_ai_provider||"N/A",l=s?.default_ai_model||"N/A",p=s?.default_ai_params||{},_=p.temperature!==void 0?parseFloat(p.temperature).toFixed(1):"N/A",m=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${t(a)}</strong>`).replace("%2$s",`<strong>${t(l)}</strong>`).replace("%3$s",t(_));g=document.createElement("div"),g.className="aipkit-modal-overlay",g.addEventListener("click",f=>{f.target===g&&o()});let k=document.createElement("div");return k.className="aipkit-modal-content",k.dataset.postId=i,k.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${t(c.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${t(c.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,g.appendChild(k),document.body.appendChild(g),k.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{g.classList.add("aipkit-active")}),g}function n(i,c){if(!g)return;let s=g.querySelector(".aipkit-modal-body");if(!s)return;let t=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||t;s.innerHTML=`
            <p>${t(c.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${i.map(l=>`<li data-new-excerpt="${d(l)}">${t(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let a=s.querySelector(".aipkit-suggestions-list");a&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(a):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function e(i,c){if(!g)return;let s=g.querySelector(".aipkit-modal-body");if(!s)return;let t=window.aipkit_escapeHtml||function(d){return d};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${t(c.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${t(i)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=r,window.aipkit_updateModalWithExcerptSuggestions=n,window.aipkit_updateModalWithErrorExcerpt=e,window.aipkit_closePostExcerptModal=o})();(function(){"use strict";let g=!1;function o(){g=!1}function r(i){if(g)return;g=!0;let c=i.currentTarget,s=c.closest(".aipkit-modal-content"),t=s?.dataset.postId,d=c.dataset.newExcerpt,a=s?.querySelector(".aipkit-modal-status"),l=s?.querySelectorAll(".aipkit-suggestions-list li"),p=window.aipkit_post_enhancer?.text||{};if(!t||d===void 0||!a||!l){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:t,newExcerpt:d,statusDiv:a,listItems:l}),a&&(a.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),g=!1;return}l.forEach(_=>_.classList.add("aipkit-disabled")),a.innerHTML=`<span class="aipkit_spinner"></span> ${p.updating_excerpt||"Updating Excerpt..."}`,a.style.color="",n(t,d,a,l,p)}function n(i,c,s,t,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',t.forEach(p=>p.classList.remove("aipkit-disabled")),g=!1;return}let a=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!a){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',t.forEach(p=>p.classList.remove("aipkit-disabled")),g=!1;return}let l={_ajax_nonce:a,post_id:i,new_value:c};window.aipkit_apiRequest("aipkit_update_post_excerpt",l).then(p=>{window.aipkit_closePostExcerptModal()}).catch(p=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",p),s.innerHTML=`<span class="error">${p.message||d.error_updating_excerpt||"Error updating excerpt."}</span>`,t.forEach(_=>_.classList.remove("aipkit-disabled"))}).finally(()=>{g=!1})}function e(i){i&&i.addEventListener("click",function(c){let s=c.target.closest("li[data-new-excerpt]");s&&r({currentTarget:s})})}window.aipkit_attachExcerptSuggestionClickListener=e,window.aipkit_resetExcerptUpdateFlag=o})();(function(){"use strict";function g(o,r,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,i=e?.nonce_generate_meta,c=e?.text||{};if(!i){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,n);return}let s={_ajax_nonce:i,post_id:o};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",s).then(t=>{if(!t?.suggestions||t.suggestions.length===0)throw new Error(c.no_suggestions_meta||"No meta description suggestions generated.");typeof r=="function"&&r(null,t.suggestions,n)}).catch(t=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",t),typeof r=="function"&&r(t,null,n)})}window.aipkit_fetchMetaSuggestions=g})();(function(){"use strict";let g=null;function o(){g&&(g.classList.remove("aipkit-active"),g.addEventListener("transitionend",()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},{once:!0}),setTimeout(()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function r(i,c,s){g&&o();let t=window.aipkit_escapeHtml||function(f){return f},d=window.aipkit_escapeAttribute||t,a=s?.default_ai_provider||"N/A",l=s?.default_ai_model||"N/A",p=s?.default_ai_params||{},_=p.temperature!==void 0?parseFloat(p.temperature).toFixed(1):"N/A",m=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${t(a)}</strong>`).replace("%2$s",`<strong>${t(l)}</strong>`).replace("%3$s",t(_));g=document.createElement("div"),g.className="aipkit-modal-overlay",g.addEventListener("click",f=>{f.target===g&&o()});let k=document.createElement("div");return k.className="aipkit-modal-content",k.dataset.postId=i,k.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${t(c.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${t(c.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,g.appendChild(k),document.body.appendChild(g),k.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{g.classList.add("aipkit-active")}),g}function n(i,c){if(!g)return;let s=g.querySelector(".aipkit-modal-body");if(!s)return;let t=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||t;s.innerHTML=`
            <p>${t(c.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${i.map(l=>`<li data-new-meta="${d(l)}">${t(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let a=s.querySelector(".aipkit-suggestions-list");a&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(a):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function e(i,c){if(!g)return;let s=g.querySelector(".aipkit-modal-body");if(!s)return;let t=window.aipkit_escapeHtml||function(d){return d};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${t(c.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${t(i)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=r,window.aipkit_updateModalWithMetaSuggestions=n,window.aipkit_updateModalWithErrorMeta=e,window.aipkit_closePostMetaModal=o})();(function(){"use strict";let g=!1;function o(){g=!1}function r(i){if(g)return;g=!0;let c=i.currentTarget,s=c.closest(".aipkit-modal-content"),t=s?.dataset.postId,d=c.dataset.newMeta,a=s?.querySelector(".aipkit-modal-status"),l=s?.querySelectorAll(".aipkit-suggestions-list li"),p=window.aipkit_post_enhancer?.text||{};if(!t||d===void 0||!a||!l){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:t,newMetaDesc:d,statusDiv:a,listItems:l}),a&&(a.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),g=!1;return}l.forEach(_=>_.classList.add("aipkit-disabled")),a.innerHTML=`<span class="aipkit_spinner"></span> ${p.updating_meta||"Updating Meta Desc..."}`,a.style.color="",n(t,d,a,l,p)}function n(i,c,s,t,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',t.forEach(p=>p.classList.remove("aipkit-disabled")),g=!1;return}let a=window.aipkit_post_enhancer?.nonce_update_meta;if(!a){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',t.forEach(p=>p.classList.remove("aipkit-disabled")),g=!1;return}let l={_ajax_nonce:a,post_id:i,new_value:c};window.aipkit_apiRequest("aipkit_update_post_meta_desc",l).then(p=>{try{let m=`${`#post-${i}`} .column-wpseo-metadesc`,k=document.querySelector(m);k&&(k.textContent=window.aipkit_escapeHtml(c),k.style.transition="background-color 0.1s ease-out",k.style.backgroundColor="#f0f7ff",setTimeout(()=>{k.style.backgroundColor=""},300))}catch(_){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",_)}window.aipkit_closePostMetaModal()}).catch(p=>{console.error("AIPKit Post Enhancer Update Error (Meta):",p),s.innerHTML=`<span class="error">${p.message||d.error_updating_meta||"Error updating meta description."}</span>`,t.forEach(_=>_.classList.remove("aipkit-disabled"))}).finally(()=>{g=!1})}function e(i){i&&i.addEventListener("click",function(c){let s=c.target.closest("li[data-new-meta]");s&&r({currentTarget:s})})}window.aipkit_attachMetaSuggestionClickListener=e,window.aipkit_resetMetaUpdateFlag=o})();(function(){"use strict";function g(o,r,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,i=e?.nonce_generate_tags,c=e?.text||{};if(!i){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,n);return}let s={_ajax_nonce:i,post_id:o};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",s).then(t=>{if(!t?.suggestions||t.suggestions.length===0)throw new Error(c.no_suggestions_tags||"No tag suggestions generated.");typeof r=="function"&&r(null,t.suggestions,n)}).catch(t=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",t),typeof r=="function"&&r(t,null,n)})}window.aipkit_fetchTagsSuggestions=g})();(function(){"use strict";let g=null;function o(){g&&(g.classList.remove("aipkit-active"),g.addEventListener("transitionend",()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},{once:!0}),setTimeout(()=>{g?.parentNode&&g.parentNode.removeChild(g),g=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function r(i,c,s){g&&o();let t=window.aipkit_escapeHtml||(f=>f),d=window.aipkit_escapeAttribute||t,a=s?.default_ai_provider||"N/A",l=s?.default_ai_model||"N/A",p=s?.default_ai_params||{},_=p.temperature!==void 0?parseFloat(p.temperature).toFixed(1):"N/A",m=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${t(a)}</strong>`).replace("%2$s",`<strong>${t(l)}</strong>`).replace("%3$s",t(_));g=document.createElement("div"),g.className="aipkit-modal-overlay",g.addEventListener("click",f=>{f.target===g&&o()});let k=document.createElement("div");return k.className="aipkit-modal-content",k.dataset.postId=i,k.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${t(c.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${d(c.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${t(c.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${m}</p>
            </div>
        </div>
    `,g.appendChild(k),document.body.appendChild(g),k.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>g.classList.add("aipkit-active")),g}function n(i,c){if(!g)return;let s=g.querySelector(".aipkit-modal-body");if(!s)return;let t=window.aipkit_escapeHtml||(l=>l),d=window.aipkit_escapeAttribute||t;s.innerHTML=`
        <p>${t(c.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${i.map(l=>`<li data-new-tags="${d(l)}">${t(l)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let a=s.querySelector(".aipkit-suggestions-list");a&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(a):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function e(i,c){if(!g)return;let s=g.querySelector(".aipkit-modal-body");if(!s)return;let t=window.aipkit_escapeHtml||(d=>d);s.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${t(c.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${t(i)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=r,window.aipkit_updateModalWithTagsSuggestions=n,window.aipkit_updateModalWithErrorTags=e,window.aipkit_closePostTagsModal=o})();(function(){"use strict";let g=!1;function o(){g=!1}function r(i){if(g)return;g=!0;let c=i.currentTarget,s=c.closest(".aipkit-modal-content"),t=s?.dataset.postId,d=c.dataset.newTags,a=s?.querySelector(".aipkit-modal-status"),l=s?.querySelectorAll(".aipkit-suggestions-list li"),p=window.aipkit_post_enhancer?.text||{};if(!t||d===void 0||!a||!l){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:t,newTags:d,statusDiv:a,listItems:l}),a&&(a.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),g=!1;return}l.forEach(_=>_.classList.add("aipkit-disabled")),a.innerHTML=`<span class="aipkit_spinner"></span> ${p.updating_tags||"Updating Tags..."}`,a.style.color="",n(t,d,a,l,p)}function n(i,c,s,t,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',t.forEach(p=>p.classList.remove("aipkit-disabled")),g=!1;return}let a=window.aipkit_post_enhancer?.nonce_update_tags;if(!a){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',t.forEach(p=>p.classList.remove("aipkit-disabled")),g=!1;return}let l={_ajax_nonce:a,post_id:i,new_value:c};window.aipkit_apiRequest("aipkit_update_post_tags",l).then(p=>{let _=document.getElementById(`post-${i}`);if(_){let u=_.querySelector(".column-tags");u&&(u.textContent=c.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(p=>{console.error("AIPKit Post Enhancer Update Error (Tags):",p),s.innerHTML=`<span class="error">${p.message||d.error_updating_tags||"Error updating tags."}</span>`,t.forEach(_=>_.classList.remove("aipkit-disabled"))}).finally(()=>{g=!1})}function e(i){i&&i.addEventListener("click",function(c){let s=c.target.closest("li[data-new-tags]");s&&r({currentTarget:s})})}window.aipkit_attachTagsSuggestionClickListener=e,window.aipkit_resetTagsUpdateFlag=o})();(function(){"use strict";function g(o,r,n){let i=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorTags(o.message||i.error_loading_tags,i):r?window.aipkit_updateModalWithTagsSuggestions(r,i):window.aipkit_updateModalWithErrorTags(i.error_loading_tags||"Unknown error occurred.",i)}window.aipkit_handleTagsSuggestionsResult=g})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function g(t,d=60){return t.length<=d?t:t.substring(0,d-3)+"..."}function o(t,d="info"){let a=document.getElementById("aipkit-enhancer-bulk-status-log");if(a){let l=document.createElement("div");l.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${d}`,l.textContent=t,a.appendChild(l),a.scrollTop=a.scrollHeight}}function r(){let t=document.getElementById("aipkit-enhancer-bulk-progress-bar"),d=document.getElementById("aipkit-enhancer-progress-text"),a=document.getElementById("aipkit-enhancer-progress-stats");if(t&&window.aipkit_enhancer_bulkState.total>0){let l=window.aipkit_enhancer_bulkState.completed,p=window.aipkit_enhancer_bulkState.failed,_=window.aipkit_enhancer_bulkState.total,u=l+p,m=Math.round(u/_*100);t.style.width=`${m}%`,d&&(u===_?d.textContent="Update complete!":d.textContent=`Processing ${u+1} of ${_}...`),a&&(p>0?a.innerHTML=`${m}% \u2022 <span style="color: #28a745;">${l} successful</span> \u2022 <span style="color: #dc3545;">${p} failed</span>`:a.textContent=`${m}%`)}}function n(t){let d=document.getElementById("aipkit-enhancer-bulk-status-log");if(!d)return;let l=(window.aipkit_enhancer_postTitles||{})[t]||`Post #${t}`;l=g(l,60);let p=document.createElement("div");p.className="aipkit_enhancer_post_steps",p.id=`aipkit_enhancer_post_${t}_steps`;let _=document.createElement("div");_.className="aipkit_enhancer_post_header",_.innerHTML=`<strong>${l}</strong>`;let u=document.createElement("div");u.className="aipkit_enhancer_steps_container",u.id=`aipkit_enhancer_steps_${t}`,p.appendChild(_),p.appendChild(u),d.appendChild(p),d.scrollTop=d.scrollHeight;let m=[],k=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(f=>{k[f]&&k[f].prompt&&m.push({field:f,display_name:f.charAt(0).toUpperCase()+f.slice(1).replace("_"," ")})}),k.generate_seo_slug==="1"&&m.push({field:"slug",display_name:"URL"}),m.forEach(f=>{let w=document.createElement("div");w.className="aipkit_enhancer_step aipkit_enhancer_step--pending",w.id=`aipkit_enhancer_step_${t}_${f.field}`,w.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${f.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,u.appendChild(w)})}function e(t,d,a,l=""){let p=document.getElementById(`aipkit_enhancer_step_${t}_${d}`);if(!p)return;p.className=`aipkit_enhancer_step aipkit_enhancer_step--${a}`;let _="\u23F3",u="Pending";switch(a){case"processing":_="\u{1F504}",u="Processing...";break;case"completed":_="\u2705",u="Completed";break;case"error":_="\u274C",u="Failed";break;case"pending":_="\u23F3",u="Pending";break}p.querySelector(".aipkit_enhancer_step_icon").textContent=_,p.querySelector(".aipkit_enhancer_step_status").textContent=u,l&&(p.title=l);let m=document.getElementById("aipkit-enhancer-bulk-status-log");m&&(m.scrollTop=m.scrollHeight)}function i(t,d,a){let l=document.getElementById(`aipkit_enhancer_steps_${t}`);if(!l||a.length===0)return;let p=d.length+a.length,_=document.createElement("div");_.className="aipkit_enhancer_completion_message",d.length===0?_.innerHTML=`<strong style="color: #dc3545;">\u274C All ${p} enhancement steps failed!</strong>`:_.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${d.length} of ${p} steps. ${a.length} failed.</strong>`,l.appendChild(_);let u=document.getElementById("aipkit-enhancer-bulk-status-log");u&&(u.scrollTop=u.scrollHeight)}function c(t,d){let a=document.getElementById(`aipkit_enhancer_steps_${t}`);if(!a)return;d.forEach(u=>{let m=document.getElementById(`aipkit_enhancer_step_${t}_${u.field}`);if(m){m.className=`aipkit_enhancer_step aipkit_enhancer_step--${u.status}`;let k="\u23F3";switch(u.status){case"completed":k="\u2705";break;case"error":k="\u274C";break;case"processing":k="\u{1F504}";break;case"pending":k="\u23F3";break}m.querySelector(".aipkit_enhancer_step_icon").textContent=k,m.querySelector(".aipkit_enhancer_step_status").textContent=u.status.charAt(0).toUpperCase()+u.status.slice(1),u.message&&(m.title=u.message)}});let l=d.filter(u=>u.status==="completed").length,p=d.length;if(l!==p){let u=document.createElement("div");u.className="aipkit_enhancer_completion_message";let m=d.filter(k=>k.status==="error").length;u.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${l} of ${p} steps. ${m} failed.</strong>`,a.appendChild(u)}let _=document.getElementById("aipkit-enhancer-bulk-status-log");_&&(_.scrollTop=_.scrollHeight)}function s(t,d){let a=document.getElementById(`aipkit_enhancer_steps_${t}`);if(!a)return;a.querySelectorAll(".aipkit_enhancer_step").forEach(u=>{u.classList.contains("aipkit_enhancer_step--completed")||(u.className="aipkit_enhancer_step aipkit_enhancer_step--error",u.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",u.querySelector(".aipkit_enhancer_step_status").textContent="Failed",u.title=d)});let p=document.createElement("div");p.className="aipkit_enhancer_completion_message",p.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${d}</strong>`,a.appendChild(p);let _=document.getElementById("aipkit-enhancer-bulk-status-log");_&&(_.scrollTop=_.scrollHeight)}window.aipkit_enhancer_logToModal=o,window.aipkit_enhancer_updateProgressBar=r,window.aipkit_enhancer_initStepProgress=n,window.aipkit_enhancer_updateFieldStatus=e,window.aipkit_enhancer_showPostCompletion=i,window.aipkit_enhancer_displayStepResults=c,window.aipkit_enhancer_showStepError=s,window.aipkit_enhancer_truncateTitle=g})();(function(){"use strict";function g(r="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let n=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!n)return;r==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let e=n.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");e&&(e.textContent="Start");let i=n.querySelector("#aipkit_bulk_enhancer_start_btn");i&&(i.disabled=!1,i.hidden=!0),n.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let c=n.querySelector("#aipkit_bulk_enhancer_cancel_btn");c&&(c.hidden=!1),n.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!1}function o(){let r=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!r)return;window.aipkit_enhancer_bulkState.isRunning&&g("user"),r.querySelector("#aipkit-enhancer-bulk-config").hidden=!1,r.querySelector("#aipkit-enhancer-bulk-progress").hidden=!0;let n=r.querySelector("#aipkit_bulk_enhancer_start_btn");n&&(n.disabled=!1,n.hidden=!1);let e=r.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");e&&(e.textContent="Start"),r.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let i=r.querySelector("#aipkit_bulk_enhancer_cancel_btn");i&&(i.hidden=!1),r.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0;let c=r.querySelector("#aipkit-enhancer-bulk-status-log");c&&(c.innerHTML="");let s=r.querySelector("#aipkit-enhancer-bulk-progress-bar");s&&(s.style.width="0%");let t=r.querySelector("#aipkit-enhancer-progress-text");t&&(t.textContent="Processing posts...");let d=r.querySelector("#aipkit-enhancer-progress-stats");d&&(d.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=g,window.aipkit_enhancer_returnToSettings=o})();(function(){"use strict";function g(c){let s=c.querySelector("#aipkit_bulk_ai_provider"),t=c.querySelector("#aipkit_bulk_ai_model"),d=c.querySelector(".aipkit_enhancer_reasoning_effort_field"),a=c.querySelector("#aipkit_bulk_reasoning_effort");if(!s||!t||!d||!a){d&&(d.style.display="none");return}let l=(s.value||"").toLowerCase(),_=(t.value||"").toLowerCase(),u=_.startsWith("o1")||_.startsWith("o3")||_.startsWith("o4"),m=_.includes("gpt-5");if(!(l==="openai"&&(u||m))){d.style.display="none";return}d.style.display="block",o(c,_)}function o(c,s){let t=c.querySelector("#aipkit_bulk_reasoning_effort");if(!t)return;let d=r(s),a=new Set(d.allowed),l=t.value||"";l==="minimal"&&(l="low"),Array.from(t.options).forEach(p=>{let _=a.has(p.value);p.hidden=!_,p.disabled=!_}),a.has(l)||(l=d.defaultValue),a.has(l)||(l=d.allowed[0]||""),l&&(t.value=l)}function r(c){return e(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:n(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function n(c){let s=c.match(/gpt-5\.(\d+)/);if(s)return Number.parseInt(s[1],10)>=2;let t=c.match(/gpt-(\d+)/);return t?Number.parseInt(t[1],10)>=6:!1}function e(c){return/gpt-5(\.\d+)?-pro/.test(c)}function i(c,s){let t=c.value.toLowerCase(),a=(window.aipkit_dashboard?.models||{})[t]||[],l=window.aipkit_escapeHtml||(f=>f),p=window.wp?.i18n?.__||(f=>f),_=window.aipkit_dashboard?.recommendedModels?.[t]||[],u=Array.isArray(_)?_:[],m=new Set(u.map(f=>f?.id).filter(Boolean));if(s.innerHTML="",u.length>0){let f=document.createElement("optgroup");f.label=l(p("Recommended","gpt3-ai-content-generator")),u.forEach(w=>{w&&w.id&&f.appendChild(new Option(l(w.name||w.id),w.id))}),f.children.length>0&&s.appendChild(f)}if(t==="openai"&&typeof a=="object"&&!Array.isArray(a))Object.keys(a).forEach(f=>{let w=document.createElement("optgroup");w.label=l(f),Array.isArray(a[f])&&a[f].forEach(E=>{E&&E.id&&m.has(E.id)||E&&E.id&&w.appendChild(new Option(l(E.name||E.id),E.id))}),w.children.length>0&&s.appendChild(w)});else if(Array.isArray(a)){let f=u.length?document.createElement("optgroup"):null;f&&(f.label=l(p("All models","gpt3-ai-content-generator"))),a.forEach(w=>{if(!(w&&w.id&&m.has(w.id))&&w&&w.id){let E=new Option(l(w.name||w.id),w.id);f?f.appendChild(E):s.appendChild(E)}}),f&&f.children.length>0&&s.appendChild(f)}if(s.options.length===0)s.appendChild(new Option(l(`No models for ${c.value}`),"")),s.disabled=!0;else{s.disabled=!1;let f;switch(t){case"openai":f="gpt-4o-mini";break;case"google":f="gemini-1.5-flash-latest";break;case"openrouter":f="anthropic/claude-3.5-sonnet";break;default:f=null;break}f&&s.querySelector(`option[value="${CSS.escape(f)}"]`)?s.value=f:s.selectedIndex=0}let k=c.closest(".aipkit-enhancer-bulk-modal-overlay");k&&g(k)}window.aipkit_enhancer_populateBulkModels=i,window.aipkit_enhancer_toggleReasoningEffort=g})();(function(){"use strict";let g=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],o=i=>{let c=parseInt(i,10);if(Number.isFinite(c)){if(c>=1&&c<=g.length)return g[c-1];let s=g.find(t=>t.tokens===c);if(s)return s}return g[1]};async function r(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let i=window.aipkit_enhancer_bulkState.queue.shift();await n(i),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(r,200)}async function n(i){try{let c=`enhancer-bulk-${i}-${Date.now()}`;typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(i);let s=window.aipkit_post_enhancer?.nonce_generate_title;if(!s)throw new Error("Security nonce not found.");let t=window.aipkit_enhancer_bulkState.enhancementsConfig,d=["keyword","title","excerpt","content","meta","tags"],a=[];d.forEach(_=>{t[_]&&t[_].prompt&&a.push(_)});let l=[],p=[];for(let _ of a){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,_,"processing");let u={_ajax_nonce:s,post_id:i,field:_,enhancer_source:"post_enhancer",enhancements:JSON.stringify({[_]:t[_],ai_provider:t.ai_provider,ai_model:t.ai_model,temperature:t.temperature,max_tokens:t.max_tokens,reasoning_effort:t.reasoning_effort,enable_vector_store:t.enable_vector_store,vector_store_provider:t.vector_store_provider,vector_store_top_k:t.vector_store_top_k,openai_vector_store_ids:t.openai_vector_store_ids,pinecone_index_name:t.pinecone_index_name,qdrant_collection_name:t.qdrant_collection_name,vector_embedding_provider:t.vector_embedding_provider,vector_embedding_model:t.vector_embedding_model}),conversation_uuid:c},m=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",u,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,_,"completed",m.message),l.push(_)}catch(u){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,_,"error",u.message||"Processing failed"),p.push(_),console.error(`Failed to process field ${_} for post ${i}:`,u)}}if(t.generate_seo_slug==="1"&&l.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","processing");let _={_ajax_nonce:s,post_id:i,action_type:"update_slug",enhancer_source:"post_enhancer"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",_,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(i,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(i,l,p),l.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let u=(window.aipkit_enhancer_postTitles||{})[i]||`Post #${i}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(u=window.aipkit_enhancer_truncateTitle(u,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${u}". No fields were processed successfully.`,"error")}}catch(c){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(i,c.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let t=(window.aipkit_enhancer_postTitles||{})[i]||`Post #${i}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(t=window.aipkit_enhancer_truncateTitle(t,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${t}": ${c.message||"Unknown error"}`,"error")}}}function e(i){let c=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!c)return;let s={},t=c.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(t.length===0){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select at least one field to update.","error");return}t.forEach(E=>{let y=E.value,I=c.querySelector(`#aipkit_bulk_prompt_${y}`);I&&(s[y]={prompt:I.value})});let d=c.querySelector("#aipkit_bulk_ai_provider").value,a=c.querySelector("#aipkit_bulk_ai_model").value,l=c.querySelector("#aipkit_bulk_ai_temperature").value,p=c.querySelector("#aipkit_bulk_content_max_tokens"),_=o(p?p.value:""),u=c.querySelector("#aipkit_bulk_reasoning_effort").value;if(!d||!a){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select an AI Provider and Model.","error");return}s.ai_provider=d,s.ai_model=a,s.temperature=l,s.max_tokens=_.tokens,s.reasoning_effort=u;let m=c.querySelector("#aipkit_bulk_generate_seo_slug");m&&(s.generate_seo_slug=m.checked?"1":"0");let k=c.querySelector('input[name="enable_vector_store"]');if(k&&k.checked){if(s.enable_vector_store="1",s.vector_store_provider=c.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",s.vector_store_top_k=c.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,s.vector_store_provider==="openai"){let E=c.querySelector("#aipkit_bulk_openai_vector_store_ids");E&&(s.openai_vector_store_ids=Array.from(E.selectedOptions).map(y=>y.value))}else s.vector_store_provider==="pinecone"?s.pinecone_index_name=c.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":s.vector_store_provider==="qdrant"&&(s.qdrant_collection_name=c.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(s.vector_store_provider==="pinecone"||s.vector_store_provider==="qdrant")&&(s.vector_embedding_provider=c.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",s.vector_embedding_model=c.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else s.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...i],isRunning:!0,completed:0,failed:0,total:i.length,enhancementsConfig:s},c.querySelector("#aipkit-enhancer-bulk-config").hidden=!0,c.querySelector("#aipkit-enhancer-bulk-progress").hidden=!1;let f=c.querySelector("#aipkit_bulk_enhancer_start_btn");f&&(f.disabled=!0,f.hidden=!0),c.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!1;let w=c.querySelector("#aipkit_bulk_enhancer_cancel_btn");w&&(w.hidden=!0),c.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0,typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),r()}window.aipkit_enhancer_startBulkProcess=e})();(function(){"use strict";let g={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,isAutosaving:!1,autosaveSuspended:!1,autosaveTimer:null,autosaveDelay:800,lastSavedConfig:null,headerStatusTimeout:null,modalElement:null},o="aipkit_bulk_enhancer_selected_template",r=window.aipkit_escapeHtml||function(x){return x},n=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],e=()=>String(window.aipkit_post_enhancer?.default_ai_provider||"").trim().toLowerCase(),i=x=>{let v=parseInt(x,10);if(Number.isFinite(v)){if(v>=1&&v<=n.length)return n[v-1];let C=n.find(P=>P.tokens===v);if(C)return C}return n[1]},c=x=>{let v=x?.content_max_tokens??x?.max_tokens??x?.max_completion_tokens??"",C=parseInt(v,10);if(Number.isFinite(C)){let B=C>=1&&C<=n.length,D=n.some(N=>N.tokens===C);return B||D?i(C):C<=n[0].tokens?n[0]:C<=n[1].tokens?n[1]:n[2]}let P=String(x?.content_length||"").trim().toLowerCase(),$=n.find(B=>B.key===P);if($)return $;let U=parseInt(window.aipkit_post_enhancer?.default_ai_params?.max_completion_tokens??window.aipkit_post_enhancer?.default_ai_params?.max_tokens??"",10);return Number.isFinite(U)?U<=n[0].tokens?n[0]:U<=n[1].tokens?n[1]:n[2]:n[1]};function s(x){try{x&&String(x)!==""?localStorage.setItem(o,String(x)):localStorage.removeItem(o)}catch(v){console.warn("Failed to save template to localStorage:",v)}}function t(){try{return localStorage.getItem(o)}catch(x){return console.warn("Failed to load template from localStorage:",x),null}}function d(){let x=g.modalElement;if(!x)return{};let v={};["title","excerpt","content","meta","keyword","tags"].forEach(B=>{let D=x.querySelector(`#aipkit_bulk_enhance_${B}`),N=x.querySelector(`#aipkit_bulk_prompt_${B}`);D&&N&&(v[B]={enabled:D.checked?"1":"0",prompt:N.value})}),v.ai_provider=x.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",v.ai_model=x.querySelector("#aipkit_bulk_ai_model")?.value||"",v.ai_temperature=x.querySelector("#aipkit_bulk_ai_temperature")?.value;let P=x.querySelector("#aipkit_bulk_content_max_tokens"),$=i(P?P.value:"");v.content_max_tokens=String($.tokens),v.reasoning_effort=x.querySelector("#aipkit_bulk_reasoning_effort")?.value||"",v.generate_seo_slug=x.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let U=x.querySelector('input[name="enable_vector_store"]');if(U&&U.checked){if(v.enable_vector_store="1",v.vector_store_provider=x.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",v.vector_store_top_k=x.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",v.vector_store_provider==="openai"){let B=x.querySelector("#aipkit_bulk_openai_vector_store_ids");B&&(v.openai_vector_store_ids=Array.from(B.selectedOptions).map(D=>D.value))}else v.vector_store_provider==="pinecone"?v.pinecone_index_name=x.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":v.vector_store_provider==="qdrant"&&(v.qdrant_collection_name=x.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(v.vector_store_provider==="pinecone"||v.vector_store_provider==="qdrant")&&(v.vector_embedding_provider=x.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",v.vector_embedding_model=x.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else v.enable_vector_store="0";return v}function a(x){g.autosaveSuspended=!0,g.currentTemplateId=x,s(x),window.aipkit_bulk_template_state&&(window.aipkit_bulk_template_state.currentTemplateId=x),typeof window.aipkit_updateBulkTemplatePickerSelection=="function"&&window.aipkit_updateBulkTemplatePickerSelection(x,g.modalElement);let v=g.templates.find(V=>String(V.id)===String(x)),C=v?JSON.parse(JSON.stringify(v.config)):{};if(!C.content_max_tokens&&C.content_length){let V=n.find(ee=>ee.key===String(C.content_length).toLowerCase());C.content_max_tokens=String(V?.tokens||n[1].tokens)}Object.prototype.hasOwnProperty.call(C,"content_length")&&delete C.content_length,g.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(C));let P=g.modalElement;if(!P)return;let $=P.querySelector("#aipkit_bulk_ai_provider"),U=P.querySelector("#aipkit_bulk_ai_model"),B=P.querySelector("#aipkit_bulk_ai_temperature"),D=P.querySelector("#aipkit_bulk_ai_temperature_value"),N=P.querySelector("#aipkit_bulk_content_max_tokens"),R=P.querySelector("#aipkit_bulk_content_max_tokens_value"),j=P.querySelector("#aipkit_bulk_reasoning_effort");if($){let V=e();$.value=C.ai_provider||V||"openai",$.dispatchEvent(new Event("change",{bubbles:!0}))}if(U&&C.ai_model&&setTimeout(()=>{U.querySelector(`option[value="${CSS.escape(C.ai_model)}"]`)&&(U.value=C.ai_model,U.dispatchEvent(new Event("change")))},150),B&&(B.value=C.ai_temperature||"1.0"),D&&(D.textContent=C.ai_temperature||"1.0"),N){let V=c(C),ee=Math.max(0,n.findIndex(J=>J.key===V.key));N.value=String(ee+1),R&&(R.textContent=`${V.words} words`)}j&&(j.value=C.reasoning_effort==="minimal"?"low":C.reasoning_effort||"",typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&window.aipkit_enhancer_toggleReasoningEffort(P)),["title","excerpt","content","meta","keyword","tags"].forEach(V=>{let ee=P.querySelector(`#aipkit_bulk_enhance_${V}`),J=P.querySelector(`#aipkit_bulk_prompt_${V}`);if(ee&&J){let le=C[V]?.enabled==="1";ee.checked!==le&&(ee.checked=le,ee.dispatchEvent(new Event("change"))),J.value=C[V]?.prompt||J.defaultValue}});let L=P.querySelector("#aipkit_bulk_generate_seo_slug");if(L){let V=C.generate_seo_slug==="1";L.checked!==V&&(L.checked=V,L.dispatchEvent(new Event("change")))}let K=P.querySelector('input[name="enable_vector_store"]');if(K&&(K.checked=C.enable_vector_store==="1",K.dispatchEvent(new Event("change"))),C.enable_vector_store==="1"){let V=P.querySelector("#aipkit_bulk_vector_store_provider");V&&(V.value=C.vector_store_provider||"openai",V.dispatchEvent(new Event("change",{bubbles:!0})));let ee=P.querySelector("#aipkit_bulk_vector_store_top_k");if(ee){ee.value=C.vector_store_top_k||"3";let J=P.querySelector("#aipkit_bulk_vector_store_top_k_value");J&&(J.textContent=ee.value)}setTimeout(()=>{if(C.vector_store_provider==="openai"){let J=P.querySelector("#aipkit_bulk_openai_vector_store_ids");J&&Array.isArray(C.openai_vector_store_ids)&&Array.from(J.options).forEach(le=>{le.selected=C.openai_vector_store_ids.includes(le.value)})}else if(C.vector_store_provider==="pinecone"){let J=P.querySelector("#aipkit_bulk_pinecone_index_name");J&&(J.value=C.pinecone_index_name||"",J.dispatchEvent(new Event("change",{bubbles:!0})))}else if(C.vector_store_provider==="qdrant"){let J=P.querySelector("#aipkit_bulk_qdrant_collection_name");J&&(J.value=C.qdrant_collection_name||"",J.dispatchEvent(new Event("change",{bubbles:!0})))}if(C.vector_store_provider==="pinecone"||C.vector_store_provider==="qdrant"){let J=P.querySelector("#aipkit_bulk_vector_embedding_provider"),le=P.querySelector("#aipkit_bulk_vector_embedding_model");J&&(J.value=C.vector_embedding_provider||"openai",J.dispatchEvent(new Event("change"))),le&&C.vector_embedding_model&&setTimeout(()=>{le.value=C.vector_embedding_model,le.dispatchEvent(new Event("change",{bubbles:!0}))},150)}},100)}g.currentTemplateModified=!1,p(),window.clearTimeout(g.autosaveTimer),g.autosaveTimer=null,window.setTimeout(()=>{g.lastSavedConfig=d(),g.autosaveSuspended=!1},200)}function l(){let x=d();g.currentTemplateModified=!window.aipkit_deepEqual(x,g.initialConfigForSelectedTemplate),p(),S()}function p(){let x=g.modalElement;if(!x)return;let v=x.querySelector("#aipkit_enhancer_template_select").value,C=v&&String(v)!=="";x.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!C,x.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!C}function _(){let x=g.modalElement;if(!x)return;let v=x.querySelector("#aipkit_enhancer_template_action_list"),C=x.querySelector("#aipkit_enhancer_template_inline_form"),P=x.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),$=x.querySelector("#aipkit_enhancer_template_name_input");v&&(v.style.display=""),C&&(C.style.display="none",delete C.dataset.mode),P&&(P.style.display="none"),$&&($.value="")}function u(x,v=""){let C=g.modalElement;if(!C)return;let P=C.querySelector("#aipkit_enhancer_template_inline_form"),$=C.querySelector("#aipkit_enhancer_template_name_input"),U=C.querySelector("#aipkit_enhancer_template_action_list"),B=C.querySelector("#aipkit_enhancer_template_inline_delete_confirm");!P||!$||(U&&(U.style.display="none"),B&&(B.style.display="none"),P.style.display="flex",P.dataset.mode=x,$.value=v,$.focus())}function m(){_()}function k(x){let v=g.modalElement;if(!v)return;let C=v.querySelector("#aipkit_enhancer_template_inline_form"),P=v.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),$=v.querySelector("#aipkit_enhancer_template_delete_confirm_text"),U=v.querySelector("#aipkit_enhancer_template_action_list");!P||!$||(C&&(C.style.display="none"),U&&(U.style.display="none"),P.style.display="flex",$.innerHTML=`Delete "<strong>${r(x)}</strong>"?`)}function f(){_()}function w(x,v="info"){E(x,v)}function E(x,v="info"){let C=g.modalElement?.querySelector("#aipkit_bulk_autosave_status");if(C){if(g.headerStatusTimeout&&(clearTimeout(g.headerStatusTimeout),g.headerStatusTimeout=null),!x){C.textContent="",C.className="aipkit_cw_save_status aipkit_enhancer_modal_status";return}C.textContent=r(x),C.className=`aipkit_cw_save_status aipkit_enhancer_modal_status aipkit_settings_message-${v}`,v==="success"&&(g.headerStatusTimeout=setTimeout(()=>{C.textContent="",C.className="aipkit_cw_save_status aipkit_enhancer_modal_status"},2500))}}function y(){let x=g.currentTemplateId;if(!x)return null;let v="",C=g.templates.find($=>String($.id)===String(x));if(C?.template_name&&(v=C.template_name),!v){let $=g.modalElement?.querySelector("#aipkit_enhancer_template_select");$?.selectedOptions?.length&&(v=$.selectedOptions[0].textContent.trim())}let P=parseInt(x,10);return!v||Number.isNaN(P)?null:{id:P,name:v}}async function I(){if(g.autosaveSuspended||g.isSavingOrDeleting||g.isAutosaving)return;let x=d();if(!x||g.lastSavedConfig&&window.aipkit_deepEqual(x,g.lastSavedConfig))return;let v=y();if(v){g.isAutosaving=!0,E("Saving...","info");try{let C=window.aipkit_post_enhancer?.nonce_manage_templates;if(!C)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:v.id,template_name:v.name,config:JSON.stringify(x),template_type:"enhancer",_ajax_nonce:C}),g.lastSavedConfig=JSON.parse(JSON.stringify(x)),g.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(x)),g.currentTemplateModified=!1,p(),E("Saved","success")}catch(C){E(`Error: ${C.message||"Failed to save."}`,"error"),console.error("Bulk Enhancer Auto-Save Error:",C)}finally{g.isAutosaving=!1}}}function S(){g.autosaveSuspended||g.isSavingOrDeleting||g.currentTemplateId&&(g.autosaveTimer&&clearTimeout(g.autosaveTimer),g.autosaveTimer=setTimeout(()=>{g.autosaveTimer=null,I()},g.autosaveDelay))}async function h(){let x=g.modalElement.querySelector("#aipkit_enhancer_template_select");x.innerHTML='<option value="">Loading...</option>',x.disabled=!0;try{let v=window.aipkit_post_enhancer?.nonce_manage_templates;if(!v)throw new Error("Security nonce for templates not found.");let C=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:v});g.templates=C.templates||[],x.innerHTML='<option value="">-- Select Template --</option>',g.templates.forEach($=>{x.appendChild(new Option(r($.template_name),$.id))}),x.disabled=!1;let P=t();P&&(g.templates.some(U=>String(U.id)===String(P))?(x.value=P,a(P)):s(null)),window.aipkit_bulk_template_state={templates:g.templates,currentTemplateId:g.currentTemplateId},typeof window.aipkit_renderBulkTemplatePicker=="function"&&window.aipkit_renderBulkTemplatePicker(g.modalElement)}catch(v){w("Error loading templates: "+v.message,"error")}}async function M(x,v){if(!g.isSavingOrDeleting){g.isSavingOrDeleting=!0,w("Saving template...","info");try{let C=d(),P=window.aipkit_post_enhancer?.nonce_manage_templates;if(!P)throw new Error("Security nonce for templates not found.");let $=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:x,template_name:v,config:JSON.stringify(C),template_type:"enhancer",_ajax_nonce:P});w($.message,"success"),await h(),g.modalElement.querySelector("#aipkit_enhancer_template_select").value=$.template_id,g.currentTemplateId=$.template_id,s($.template_id),g.currentTemplateModified=!1,g.lastSavedConfig=JSON.parse(JSON.stringify(C)),g.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(C)),E("Saved","success"),p()}catch(C){w("Error saving: "+C.message,"error")}finally{g.isSavingOrDeleting=!1}}}async function b(){let x=g.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!x||g.isSavingOrDeleting)){g.isSavingOrDeleting=!0,w("Deleting...","info");try{let v=window.aipkit_post_enhancer?.nonce_manage_templates;if(!v)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:x,_ajax_nonce:v}),w("Template deleted.","success"),await h(),g.currentTemplateId=null;let C=t();C&&String(C)===String(x)&&s(null),g.lastSavedConfig=null,E("Template deleted","success"),p()}catch(v){w("Error deleting: "+v.message,"error")}finally{g.isSavingOrDeleting=!1}}}function A(x){g.modalElement=x;let v=x.querySelector("#aipkit_enhancer_template_select");v.addEventListener("change",R=>{E(""),_(),a(R.target.value)}),x.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{u("new")}),x.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let R=v.options[v.selectedIndex];g.currentTemplateId&&R&&u("rename",R.text)}),x.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",()=>{let R=v.options[v.selectedIndex];R&&k(R.text)});let C=x.querySelector("#aipkit_enhancer_template_inline_form"),P=x.querySelector("#aipkit_enhancer_template_save_inline_btn"),$=x.querySelector("#aipkit_enhancer_template_cancel_inline_btn"),U=x.querySelector("#aipkit_enhancer_template_name_input");P&&$&&C&&U&&($.addEventListener("click",m),P.addEventListener("click",async()=>{let R=C.dataset.mode,j=U.value.trim();if(!j){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}if(R==="new")await M(0,j);else if(R==="rename"){let L=v.value;L&&await M(parseInt(L,10),j)}m()}));let B=x.querySelector("#aipkit_enhancer_template_confirm_delete_btn"),D=x.querySelector("#aipkit_enhancer_template_cancel_delete_btn");B&&D&&(D.addEventListener("click",f),B.addEventListener("click",async()=>{await b(),f()})),h(),typeof window.aipkit_initBulkTemplatePicker=="function"&&window.aipkit_initBulkTemplatePicker(x);let N=R=>{R.target?.id!=="aipkit_enhancer_template_select"&&l()};x.addEventListener("input",N),x.addEventListener("change",N)}window.aipkit_enhancer_initTemplateControls=A,window.aipkit_enhancer_setHeaderStatus=E})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(p){return p},o=p=>p||document.querySelector(".aipkit_enhancer_bulk_modal");function r(p){let _=o(p);return{root:_,select:_?.querySelector("#aipkit_enhancer_template_select")||null,button:_?.querySelector("#aipkit_enhancer_template_picker_btn")||null,label:_?.querySelector("#aipkit_enhancer_template_picker_label")||null,list:_?.querySelector("#aipkit_enhancer_template_picker_list")||null,search:_?.querySelector("#aipkit_enhancer_template_picker_search")||null,searchClear:_?.querySelector("#aipkit_enhancer_template_picker_search_clear")||null,popover:_?.querySelector("#aipkit_enhancer_template_picker_popover")||null}}function n(p,_){let u=[],m={};p.forEach(f=>{if(!(String(f.is_starter)==="1"||f.is_starter===!0))if(_&&f.user_id?.toString()===_)u.push(f);else{let E=f.display_name||`User ID: ${f.user_id}`;m[E]||(m[E]=[]),m[E].push(f)}}),u.sort((f,w)=>f.is_default==="1"?-1:w.is_default==="1"?1:f.template_name.localeCompare(w.template_name));let k={};return Object.keys(m).sort().forEach(f=>{k[f]=m[f].sort((w,E)=>w.template_name.localeCompare(E.template_name))}),{myTemplates:u,otherUsersTemplates:k}}function e(p){return p.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function i(p,_){let{label:u}=r(_);if(!u||!p)return;let m=p.options[p.selectedIndex],k=m?m.text:g("Select template");u.textContent=k||g("Select template")}function c(p,_){if(!p)return;let u=String(_||"");p.querySelectorAll(".aipkit_cw_template_list_item").forEach(m=>{let f=(m.dataset.templateId||"")===u;m.classList.toggle("is-active",f),m.setAttribute("aria-selected",f?"true":"false")})}function s(p,_=""){let{select:u,list:m}=r(p);if(!u||!m)return;let k=window.aipkit_bulk_template_state?.templates||[],f=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!k.length){let b=u.disabled&&u.options.length&&u.options[0].text.toLowerCase().includes("loading"),A=document.createElement("div");A.className="aipkit_cw_template_picker_empty",A.textContent=g(b?"Loading templates...":"No templates found."),m.appendChild(A),i(u,p);return}let w=n(k,f),E=document.createDocumentFragment(),y=_.toLowerCase().trim(),I=(b,A)=>{let x=document.createElement("div");if(x.className="aipkit_cw_template_group_label",A){let C=document.createElement("span");C.className=`dashicons ${A}`,C.setAttribute("aria-hidden","true"),x.appendChild(C)}let v=document.createElement("span");return v.textContent=g(b),x.appendChild(v),x},S=b=>{let A=document.createElement("button");A.type="button",A.className="aipkit_cw_template_list_item",b.is_default==="1"&&A.classList.add("is-default"),A.dataset.templateId=String(b.id),A.dataset.templateLabel=b.template_name.toLowerCase(),A.setAttribute("role","option"),A.setAttribute("aria-selected","false");let x=e(b),v=document.createElement("span");v.className=`aipkit_cw_template_list_icon dashicons ${x}`,v.setAttribute("aria-hidden","true");let C=document.createElement("span");C.className="aipkit_cw_template_list_content";let P=document.createElement("span");P.className="aipkit_cw_template_list_name",P.textContent=g(b.template_name),C.appendChild(P);let $=document.createElement("span");return $.className="aipkit_cw_template_list_check dashicons dashicons-yes",$.setAttribute("aria-hidden","true"),A.appendChild(v),A.appendChild(C),A.appendChild($),A},h=(b,A,x)=>{let v=y?A.filter(P=>P.template_name.toLowerCase().includes(y)):A;if(!v.length)return 0;let C=document.createElement("div");return C.className="aipkit_cw_template_group",C.appendChild(I(b,x)),v.forEach(P=>{C.appendChild(S(P))}),E.appendChild(C),v.length},M=0;if(M+=h("My Templates",w.myTemplates,"dashicons-admin-users"),Object.keys(w.otherUsersTemplates).forEach(b=>{M+=h(b,w.otherUsersTemplates[b],"dashicons-groups")}),M===0){let b=document.createElement("div");b.className="aipkit_cw_template_picker_empty",b.textContent=g(y?"No templates match your search.":"No templates found."),m.appendChild(b)}else m.appendChild(E);i(u,p),c(m,u.value)}function t(p,_){s(p,_)}function d(p){let{search:_,searchClear:u,popover:m}=r(p);if(!_)return;let k=null;_.addEventListener("input",f=>{let w=f.target.value;u&&(u.style.display=w?"flex":"none"),clearTimeout(k),k=setTimeout(()=>{t(p,w)},150)}),u&&u.addEventListener("click",()=>{_.value="",u.style.display="none",t(p,""),_.focus()}),m&&new MutationObserver(w=>{w.forEach(E=>{E.attributeName==="aria-hidden"&&m.getAttribute("aria-hidden")==="true"&&_.value&&(_.value="",u&&(u.style.display="none"),t(p,""))})}).observe(m,{attributes:!0})}function a(p){let{select:_,list:u,button:m}=r(p);!_||!u||(d(p),u.dataset.listenerAttached||(u.addEventListener("click",k=>{let f=k.target.closest(".aipkit_cw_template_list_item");if(!f||!_)return;let w=f.dataset.templateId||"";_.value=w,_.dispatchEvent(new Event("change",{bubbles:!0})),c(u,w),m&&m.click()}),u.dataset.listenerAttached="true"),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",()=>{i(_,p),c(u,_.value)}),_.dataset.listenerAttached="true"),s(p))}function l(p,_){let{select:u,list:m}=r(_);u&&(p!==void 0&&(u.value=p),i(u,_),c(m,u.value))}window.aipkit_initBulkTemplatePicker=a,window.aipkit_renderBulkTemplatePicker=s,window.aipkit_updateBulkTemplatePickerSelection=l})();(function(){"use strict";function g(o){let{postCount:r,providerOptions:n,defaultPrompts:e,promptLibrary:i,postType:c}=o,s=E=>String(E??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=E=>s(E).replace(/"/g,"&quot;").replace(/'/g,"&#39;"),d=(E=[])=>E.map(y=>!y?.label||!y?.prompt?"":`<option value="${t(y.prompt)}">${s(y.label)}</option>`).join(""),a=i||{},l=`<option value="${t(e.title||"")}">Default</option>${d(a.title)}`,p=`<option value="${t(e.content||"")}">Default</option>${d(a.content)}`,_=`<option value="${t(e.meta||"")}">Default</option>${d(a.meta)}`,u=`<option value="${t(e.keyword||"")}">Default</option>${d(a.keyword)}`,m=`<option value="${t(e.excerpt||"")}">Default</option>${d(a.excerpt)}`,k=`<option value="${t(e.tags||"")}">Default</option>${d(a.tags)}`,f="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}, {original_tags}, {categories}.";c==="product"&&(f+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),f=f.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let w="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}, {original_tags}, {categories}.";return c==="product"&&(w+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),w=w.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div id="aipkit_enhancer_bulk_modal" class="aipkit-modal-content aipkit-enhancer-bulk-modal-content aipkit_enhancer_bulk_modal" data-post-type="${t(c)}">
          <div class="aipkit-modal-header aipkit_enhancer_modal_header">
            <div class="aipkit_enhancer_header_left">
              <span class="aipkit_enhancer_header_icon" aria-hidden="true">
                <span class="dashicons dashicons-edit-large"></span>
              </span>
              <div class="aipkit_enhancer_header_text">
                <h3 class="aipkit-modal-title">Content Assistant</h3>
                <span class="aipkit_enhancer_modal_subtitle">Bulk content update</span>
              </div>
            </div>
            <div class="aipkit_enhancer_header_center">
              <div
                id="aipkit_bulk_autosave_status"
                class="aipkit_cw_save_status aipkit_enhancer_modal_status"
                aria-live="polite"
              ></div>
            </div>
            <div class="aipkit_enhancer_header_right">
              <button type="button" class="aipkit-modal-close-btn aipkit_enhancer_close_btn" aria-label="Close">\xD7</button>
            </div>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <div class="aipkit_enhancer_section aipkit_enhancer_engine_card">
                <div class="aipkit_enhancer_engine_fields">
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Template</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <button
                          type="button"
                          id="aipkit_enhancer_template_picker_btn"
                          class="aipkit_popover_option_btn aipkit_settings_select_picker_btn"
                          data-aipkit-popover-target="aipkit_enhancer_template_picker_popover"
                          data-aipkit-popover-placement="bottom"
                          data-aipkit-bulk-popover="templates"
                          aria-controls="aipkit_enhancer_template_picker_popover"
                          aria-expanded="false"
                        >
                          <span class="aipkit_settings_select_picker_label" id="aipkit_enhancer_template_picker_label">Select template</span>
                          <span class="dashicons dashicons-arrow-down-alt2" aria-hidden="true"></span>
                        </button>
                        <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_enhancer_engine_select screen-reader-text">
                        <option value="">-- Select Template --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Provider</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_provider" class="aipkit_enhancer_engine_select">${n}</select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Model</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_model" class="aipkit_enhancer_engine_select">
                          <option value="">-- Select Provider --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field aipkit_enhancer_engine_field--action">
                    <button
                      type="button"
                      class="aipkit_enhancer_settings_btn"
                      data-aipkit-popover-target="aipkit_bulk_settings_popover"
                      data-aipkit-popover-placement="bottom"
                      data-aipkit-bulk-popover="settings"
                      aria-controls="aipkit_bulk_settings_popover"
                      aria-expanded="false"
                      title="Advanced settings"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="aipkit_enhancer_section aipkit_enhancer_prompt_section"
                id="aipkit_bulk_prompt_section"
              >
                <div class="aipkit_enhancer_section_header">
                  <h4>What to update</h4>
                </div>
                <div class="aipkit_prompts_redesigned">
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="title">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Title</span>
                        <span class="aipkit_prompt_toggle_desc">Post title</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_title_prompt_flyout"
                          aria-controls="aipkit_bulk_title_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="content">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Content</span>
                        <span class="aipkit_prompt_toggle_desc">Rewrite the main body</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_content_prompt_flyout"
                          aria-controls="aipkit_bulk_content_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="meta">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Meta Description</span>
                        <span class="aipkit_prompt_toggle_desc">SEO snippet for search</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_meta_prompt_flyout"
                          aria-controls="aipkit_bulk_meta_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="keyword">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Focus Keyword</span>
                        <span class="aipkit_prompt_toggle_desc">Primary SEO keyword</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_keyword_prompt_flyout"
                          aria-controls="aipkit_bulk_keyword_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="excerpt">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Excerpt</span>
                        <span class="aipkit_prompt_toggle_desc">Short summary text</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_excerpt_prompt_flyout"
                          aria-controls="aipkit_bulk_excerpt_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="tags">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Tags</span>
                        <span class="aipkit_prompt_toggle_desc">Suggested tags list</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_tags_prompt_flyout"
                          aria-controls="aipkit_bulk_tags_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="seo_slug">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Optimize URL</span>
                        <span class="aipkit_prompt_toggle_desc">Generate a new slug</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1" class="aipkit_toggle_switch">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_bulk_settings_popover" data-aipkit-bulk-popover="settings" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_model_settings_popover_panel--wide aipkit_model_settings_popover_panel--allow-overflow aipkit_cw_settings_popover_panel" role="dialog" aria-label="Settings">
                <div class="aipkit_model_settings_popover_header">
                  <span class="aipkit_model_settings_popover_title">Settings</span>
                  <button type="button" class="aipkit_model_settings_popover_close" aria-label="Close">
                    <span class="dashicons dashicons-no-alt"></span>
                  </button>
                </div>
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_enhancer_settings_popover">
                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <!-- Sliders Row (2 columns) -->
                        <div class="aipkit_enhancer_sliders_row">
                          <!-- Temperature Slider (Creativity) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_temperature_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_ai_temperature">Creativity</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_ai_temperature_value">1.0</span>
                            </div>
                            <div class="aipkit_enhancer_temperature_slider_wrapper">
                              <div class="aipkit_enhancer_temperature_labels">
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--low">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                  Focused
                                </span>
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--high">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                  Creative
                                </span>
                              </div>
                              <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_enhancer_temperature_slider" min="0" max="2" step="0.1" value="1.0">
                            </div>
                          </div>

                          <!-- Max Tokens Slider (Content Length) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_tokens_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_content_max_tokens">Content Length</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_content_max_tokens_value">1200-1600 words</span>
                            </div>
                            <div class="aipkit_enhancer_tokens_slider_wrapper">
                              <div class="aipkit_enhancer_tokens_labels">
                                <span class="aipkit_enhancer_tokens_label">Short</span>
                                <span class="aipkit_enhancer_tokens_label">Medium</span>
                                <span class="aipkit_enhancer_tokens_label">Long</span>
                              </div>
                              <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_enhancer_tokens_slider" min="1" max="3" step="1" value="2">
                            </div>
                          </div>
                        </div>

                        <div class="aipkit_popover_option_row aipkit_enhancer_reasoning_effort_field">
                          <div class="aipkit_popover_option_main">
                            <div class="aipkit_popover_option_text">
                              <label class="aipkit_popover_option_label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                              <span class="aipkit_popover_option_helper">Controls thinking effort for supported models.</span>
                            </div>
                            <div class="aipkit_popover_option_actions">
                              <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_popover_option_select">
                                <option value="none">None</option>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="xhigh">XHigh</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <div class="aipkit_enhancer_vector_settings">
                      <!-- Enable Toggle -->
                      <div class="aipkit_enhancer_vector_toggle_card">
                        <div class="aipkit_enhancer_vector_toggle_row">
                          <div class="aipkit_enhancer_vector_toggle_info">
                            <span class="aipkit_enhancer_vector_toggle_label">Knowledge Base</span>
                            <span class="aipkit_enhancer_vector_toggle_desc">Use your vector stores for RAG-enhanced content</span>
                          </div>
                          <div class="aipkit_enhancer_vector_toggle_controls">
                            <label class="aipkit_switch">
                              <input type="checkbox" name="enable_vector_store" value="1" class="aipkit_toggle_switch">
                              <span class="aipkit_switch_slider"></span>
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Source Selector (shown when enabled) -->
                      <div class="aipkit_cw_vector_store_settings_container aipkit_enhancer_vector_source_container" hidden>
                        <div class="aipkit_enhancer_vector_source_selector">
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_store_provider">Provider</label>
                            <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="pinecone">Pinecone</option>
                              <option value="qdrant">Qdrant</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <!-- OpenAI Stores (Multiselect) -->
                            <div class="aipkit_cw_vector_openai_field">
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_openai_vector_store_ids">Vector Store</label>
                              <div
                                class="aipkit_popover_multiselect aipkit_vector_multiselect aipkit_enhancer_vector_multiselect"
                                data-aipkit-vector-stores-dropdown
                                data-placeholder="Select stores"
                                data-selected-label="selected"
                              >
                                <button
                                  type="button"
                                  class="aipkit_popover_multiselect_btn aipkit_vector_multiselect_btn aipkit_enhancer_vector_multiselect_btn"
                                  aria-expanded="false"
                                  aria-controls="aipkit_bulk_openai_vector_store_panel"
                                >
                                  <span class="aipkit_popover_multiselect_label">Select stores</span>
                                </button>
                                <div
                                  id="aipkit_bulk_openai_vector_store_panel"
                                  class="aipkit_popover_multiselect_panel aipkit_enhancer_vector_multiselect_panel"
                                  role="menu"
                                  hidden
                                >
                                  <div class="aipkit_popover_multiselect_options"></div>
                                </div>
                              </div>
                              <select
                                id="aipkit_bulk_openai_vector_store_ids"
                                name="openai_vector_store_ids[]"
                                class="aipkit_popover_multiselect_select"
                                multiple
                                size="3"
                                hidden
                                aria-hidden="true"
                                tabindex="-1"
                              ></select>
                            </div>
                            
                            <!-- Pinecone Index -->
                            <div class="aipkit_cw_vector_pinecone_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_pinecone_index_name">Index</label>
                              <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                            
                            <!-- Qdrant Collection -->
                            <div class="aipkit_cw_vector_qdrant_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                              <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                          </div>
                        </div>

                        <!-- Embedding Config (for Pinecone/Qdrant) -->
                        <div class="aipkit_cw_vector_embedding_config_row aipkit_enhancer_vector_embedding_selector" hidden>
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_provider">Embedding</label>
                            <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="google">Google</option>
                              <option value="azure">Azure</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_model">Model</label>
                            <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_enhancer_vector_settings_select"></select>
                          </div>
                        </div>

                        <!-- Results Limit Slider -->
                        <div class="aipkit_vector_slider_group">
                          <div class="aipkit_vector_slider_header">
                            <label class="aipkit_vector_settings_label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                            <span class="aipkit_vector_slider_value" id="aipkit_bulk_vector_store_top_k_value">3</span>
                          </div>
                          <div class="aipkit_vector_slider_wrapper">
                            <div class="aipkit_vector_slider_labels">
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--min">
                                <span class="dashicons dashicons-minus" aria-hidden="true"></span>
                                Fewer
                              </span>
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--max">
                                More
                                <span class="dashicons dashicons-plus" aria-hidden="true"></span>
                              </span>
                            </div>
                            <input type="range" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_vector_slider" value="3" min="1" max="20" step="1">
                          </div>
                          <p class="aipkit_vector_slider_hint">Number of matching chunks to retrieve</p>
                        </div>
                      </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_enhancer_template_picker_popover" data-aipkit-bulk-popover="templates" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_cw_settings_popover_panel aipkit_cw_template_picker_popover_panel" role="dialog" aria-label="Templates">
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_cw_template_picker_search_wrap">
                    <span class="dashicons dashicons-search aipkit_cw_template_picker_search_icon" aria-hidden="true"></span>
                    <input
                      type="text"
                      id="aipkit_enhancer_template_picker_search"
                      class="aipkit_cw_template_picker_search"
                      placeholder="Search templates..."
                      autocomplete="off"
                    >
                    <button
                      type="button"
                      id="aipkit_enhancer_template_picker_search_clear"
                      class="aipkit_cw_template_picker_search_clear"
                      aria-label="Clear search"
                      style="display: none;"
                    >
                      <span class="dashicons dashicons-no-alt" aria-hidden="true"></span>
                    </button>
                  </div>
                  <div class="aipkit_cw_template_picker_list" id="aipkit_enhancer_template_picker_list" role="listbox" aria-label="Template list">
                    <div class="aipkit_cw_template_picker_empty">
                      Loading templates...
                    </div>
                  </div>
                  <div class="aipkit_cw_template_picker_actions">
                    <div class="aipkit_cw_template_action_list" id="aipkit_enhancer_template_action_list">
                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">
                        <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
                        New
                      </button>
                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        Rename
                      </button>
                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                        Delete
                      </button>
                    </div>
                    <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                      <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                    <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                      <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_title_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Title Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Title Prompt</span>
                    <select id="aipkit_bulk_title_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_title" title="Load template">
                      ${l}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_title" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.title||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="title" data-label="Placeholders:" data-copy-title="Click to copy">${f}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_content_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Content Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Content Prompt</span>
                    <select id="aipkit_bulk_content_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_content" title="Load template">
                      ${p}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_content" class="aipkit_cw_prompt_editor_textarea" rows="10">${s(e.content||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="content" data-label="Placeholders:" data-copy-title="Click to copy">${f}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_meta_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Meta Description Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Meta Description Prompt</span>
                    <select id="aipkit_bulk_meta_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_meta" title="Load template">
                      ${_}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_meta" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.meta||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="meta" data-label="Placeholders:" data-copy-title="Click to copy">${w}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_keyword_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Focus Keyword Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Focus Keyword Prompt</span>
                    <select id="aipkit_bulk_keyword_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_keyword" title="Load template">
                      ${u}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.keyword||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="keyword" data-label="Placeholders:" data-copy-title="Click to copy">${f}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_excerpt_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Excerpt Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Excerpt Prompt</span>
                    <select id="aipkit_bulk_excerpt_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_excerpt" title="Load template">
                      ${m}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.excerpt||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="excerpt" data-label="Placeholders:" data-copy-title="Click to copy">${f}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_tags_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Tags Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Tags Prompt</span>
                    <select id="aipkit_bulk_tags_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_tags" title="Load template">
                      ${k}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_tags" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.tags||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="tags" data-label="Placeholders:" data-copy-title="Click to copy">${f}</span>
                  </div>
                </div>
              </div>
            </div>

            <div id="aipkit-enhancer-bulk-progress" hidden>
              <div class="aipkit_enhancer_progress_header">
                <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
              </div>
              <div class="aipkit_progress_bar_container">
                <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled"></div>
              </div>
              <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <div class="aipkit_enhancer_footer_info">
              <div class="aipkit_enhancer_selection_badge">
                <span class="aipkit_enhancer_selection_count">${r}</span>
                <span class="aipkit_enhancer_selection_label">item${r===1?"":"s"} selected</span>
              </div>
            </div>
            <div class="aipkit_enhancer_footer_actions">
              <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-ghost" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span>Back</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                <span>Stop</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-success">
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                <span class="aipkit_btn-text">Start Processing</span>
                <span class="aipkit_spinner" hidden></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=g})();(function(){"use strict";function g(o,r){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let n={};o.forEach(u=>{let m=document.querySelector(`tr#post-${u}`);if(m){let k=m.querySelector(".row-title")||m.querySelector("strong a")||m.querySelector(".title a")||m.querySelector("a.row-title")||m.querySelector(".column-title strong a")||m.querySelector(".column-title .row-title");k&&(n[u]=k.textContent.trim())}n[u]||(n[u]=`Post #${u}`)}),window.aipkit_enhancer_postTitles=n;let e=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},i=window.aipkit_post_enhancer?.prompt_library||{},c=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],s=window.aipkit_post_enhancer?.default_ai_provider||"",t=String(s||"").trim().toLowerCase(),d={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",deepseek:"DeepSeek",ollama:"Ollama"},a=c.map(u=>{let m=u.toLowerCase();return`<option value="${m}" ${t&&m===t?"selected":""}>${d[m]||u.toUpperCase()}</option>`}).join(""),l=window.aipkit_enhancer_getBulkModalHtml({postCount:o.length,providerOptions:a,defaultPrompts:e,promptLibrary:i,postType:r});document.body.insertAdjacentHTML("beforeend",l);let p=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(p,o):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available.");let _=p.querySelector("#aipkit_bulk_ai_provider");_&&t&&Array.from(_.options).some(m=>m.value===t)&&(_.value=t,_.dispatchEvent(new Event("change",{bubbles:!0}))),requestAnimationFrame(()=>{p.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=g})();(function(){"use strict";let g=window.wp?.i18n?.__||function(b){return b},o=".aipkit_enhancer_bulk_modal",r=["#aipkit_bulk_ai_provider","#aipkit_bulk_ai_model","#aipkit_bulk_vector_store_provider","#aipkit_bulk_vector_embedding_provider","#aipkit_bulk_pinecone_index_name","#aipkit_bulk_qdrant_collection_name","#aipkit_bulk_vector_embedding_model"].join(", "),n=null,e=null,i=!1,c=new Set(["aipkit_bulk_ai_provider","aipkit_bulk_vector_store_provider","aipkit_bulk_vector_embedding_provider"]),s=b=>!!(b&&b.id&&c.has(b.id)),t=b=>String(b||"").trim().toLowerCase(),d=(b,A)=>{if(!b)return;let x="aipkit_settings_select_picker_icon--";b.classList.forEach(C=>{C.startsWith(x)&&b.classList.remove(C)}),b.classList.remove("is-hidden");let v=t(A);if(!v){b.classList.add("is-hidden");return}b.classList.add(`${x}${v}`)},a=b=>{if(!b)return"";let A=b.getAttribute("data-aipkit-picker-title");if(A)return A;let x=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return x?x.textContent.trim():""},l=b=>{if(!b)return"";let A=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(A)return A.textContent.trim();let x=b.querySelector("option");return x?x.textContent.trim():""},p=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),_=(b,A)=>{if(!b||!b.id||!A)return null;let x=p(b.id),v=A.querySelector(`#${x.buttonId}`);if(!v){if(v=document.createElement("button"),v.type="button",v.id=x.buttonId,v.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",v.setAttribute("data-aipkit-popover-target",x.popoverId),v.setAttribute("aria-controls",x.popoverId),v.setAttribute("aria-expanded","false"),v.dataset.aipkitPopoverPlacement="bottom",s(b)){v.classList.add("aipkit_settings_select_picker_btn--provider");let U=document.createElement("span");U.className="aipkit_settings_select_picker_icon",U.setAttribute("aria-hidden","true"),d(U,b.value),v.appendChild(U)}let P=document.createElement("span");P.className="aipkit_settings_select_picker_label",P.id=x.labelId,P.textContent=l(b)||g("Select","gpt3-ai-content-generator");let $=document.createElement("span");$.className="dashicons dashicons-arrow-down-alt2",$.setAttribute("aria-hidden","true"),v.appendChild(P),v.appendChild($),b.insertAdjacentElement("beforebegin",v)}b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let C=A.querySelector(`#${x.popoverId}`);if(!C){C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",s(b)&&C.classList.add("aipkit_settings_select_picker_popover--provider"),C.id=x.popoverId,C.setAttribute("aria-hidden","true");let P=document.createElement("div");P.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",P.setAttribute("role","dialog"),P.setAttribute("aria-labelledby",x.titleId);let $=document.createElement("div");$.className="aipkit_model_settings_popover_header";let U=document.createElement("span");U.className="aipkit_model_settings_popover_title",U.id=x.titleId,U.textContent=a(b)||g("Select","gpt3-ai-content-generator");let B=document.createElement("button");B.type="button",B.className="aipkit_model_settings_popover_close",B.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),B.innerHTML='<span class="dashicons dashicons-no-alt"></span>',$.appendChild(U),$.appendChild(B);let D=document.createElement("div");D.className="aipkit_model_settings_popover_body";let N=document.createElement("div");N.className="aipkit_settings_select_picker_search";let R=document.createElement("input");R.type="search",R.id=x.searchId,R.className="aipkit_form-input";let j=a(b),L=j?`Search ${j.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");R.setAttribute("placeholder",L),N.appendChild(R);let K=document.createElement("div");K.className="aipkit_settings_select_picker_list",K.id=x.listId,K.setAttribute("role","listbox"),D.appendChild(N),D.appendChild(K),P.appendChild($),P.appendChild(D),C.appendChild(P),A.appendChild(C),s(b)&&(N.style.display="none")}return{ids:x,button:v,popover:C,label:A.querySelector(`#${x.labelId}`),search:A.querySelector(`#${x.searchId}`),list:A.querySelector(`#${x.listId}`)}},u=b=>{let A=[];return b&&Array.from(b.children).forEach(v=>{if(v.tagName==="OPTGROUP"){let C=Array.from(v.children).filter(P=>P.tagName==="OPTION").map(P=>({value:P.value,label:P.textContent.trim(),disabled:P.disabled,selected:P.selected}));A.push({groupLabel:v.label||"",options:C})}else v.tagName==="OPTION"&&A.push({groupLabel:"",options:[{value:v.value,label:v.textContent.trim(),disabled:v.disabled,selected:v.selected}]})}),A},m=(b,A,x="")=>{if(!b||!A)return;let v=x.trim().toLowerCase();A.innerHTML="";let C=u(b),P=!1;if(C.forEach($=>{let U=$.options.filter(B=>v?B.label.toLowerCase().includes(v):!0);if(U.length){if($.groupLabel){let B=document.createElement("div");B.className="aipkit_settings_select_picker_group_label",B.textContent=$.groupLabel,A.appendChild(B)}U.forEach(B=>{let D=document.createElement("button");if(D.type="button",D.className="aipkit_settings_select_picker_item",D.setAttribute("role","option"),D.dataset.value=B.value,D.dataset.label=B.label,B.disabled&&(D.classList.add("is-disabled"),D.setAttribute("aria-disabled","true")),b.value===B.value?(D.classList.add("is-active"),D.setAttribute("aria-selected","true")):D.setAttribute("aria-selected","false"),s(b)){D.classList.add("aipkit_settings_select_picker_item--provider");let j=document.createElement("span");j.className="aipkit_settings_select_picker_icon",j.setAttribute("aria-hidden","true"),d(j,B.value),D.appendChild(j)}let N=document.createElement("span");N.className="aipkit_settings_select_picker_text",N.textContent=B.label;let R=document.createElement("span");R.className="dashicons dashicons-yes aipkit_settings_select_picker_check",D.appendChild(N),D.appendChild(R),A.appendChild(D),P=!0})}}),!P){let $=document.createElement("div");$.className="aipkit_settings_select_picker_empty",$.textContent=g(v?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild($)}},k=(b,A)=>{if(!b||!A)return;let x=l(b);if(A.textContent=x||g("Select","gpt3-ai-content-generator"),s(b)){let v=A.closest("button"),C=v?v.querySelector(".aipkit_settings_select_picker_icon"):null;d(C,b.value)}},f=(b,A)=>{if(!b||!A)return;let x=b.getBoundingClientRect(),v=A.getBoundingClientRect(),C=v.width||320,P=v.height||0,$=window.innerWidth,U=window.innerHeight,B=12,D=x.left;D+C>$-B&&(D=x.right-C),D=Math.max(B,Math.min(D,$-C-B));let N=x.bottom+8;N+P>U-B&&(N=x.top-P-8),N=Math.max(B,Math.min(N,U-P-B)),A.style.left=`${Math.round(D)}px`,A.style.top=`${Math.round(N)}px`},w=()=>{!n||!e||i||(i=!0,window.requestAnimationFrame(()=>{let b=n.querySelector(".aipkit_model_settings_popover_panel");f(e,b),i=!1}))},E=()=>{n&&(n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),n=null,e=null)},y=(b,A,x)=>{if(!b||!A)return;n&&n!==A&&E(),n=A,e=b,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let v=A.querySelector(".aipkit_settings_select_picker_search input"),C=A.querySelector(".aipkit_settings_select_picker_list");C&&m(x,C,v?v.value:""),v&&v.offsetParent!==null&&(v.focus(),v.select());let P=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{f(b,P)})},I=(b,A)=>{if(!b||!A)return;let{button:x,popover:v,list:C,search:P}=A;if(x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("click",$=>{if($.preventDefault(),n===v){E();return}y(x,v,b)}),x.dataset.pickerListenerAttached="true"),v&&v.dataset.overlayListenerAttached!=="true"){v.addEventListener("click",U=>{U.target===v&&E()});let $=v.querySelector(".aipkit_model_settings_popover_close");$&&$.addEventListener("click",U=>{U.preventDefault(),E()}),v.dataset.overlayListenerAttached="true"}if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",$=>{let U=$.target.closest(".aipkit_settings_select_picker_item");if(!U||U.classList.contains("is-disabled"))return;let B=U.dataset.value??"";b.value=B,b.dispatchEvent(new Event("change",{bubbles:!0})),k(b,A.label),m(b,C,P?P.value:""),E()}),C.dataset.pickerListenerAttached="true"),P&&P.dataset.pickerListenerAttached!=="true"&&(P.addEventListener("input",()=>{m(b,C,P.value)}),P.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{k(b,A.label),m(b,C,P?P.value:""),n===v&&E()}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let $=!1;new MutationObserver(()=>{$||($=!0,window.requestAnimationFrame(()=>{k(b,A.label),m(b,C,P?P.value:""),$=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitBulkPickerEscapeBound||(document.addEventListener("keydown",$=>{$.key==="Escape"&&n&&E()}),document.body.dataset.aipkitBulkPickerEscapeBound="true"),document.body.dataset.aipkitBulkPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitBulkPickerRepositionBound="true")};function S(b){if(!b||b.dataset.aipkitBulkPickerInit==="true")return;let A=b.querySelectorAll(r);A.length&&(A.forEach(x=>{if(!x.id||x.dataset.aipkitPickerInit==="true")return;let v=_(x,b);v&&(k(x,v.label),m(x,v.list,v.search?v.search.value:""),I(x,v),x.dataset.aipkitPickerInit="true")}),b.dataset.aipkitBulkPickerInit="true")}function h(){document.querySelectorAll(o).forEach(S)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h(),new MutationObserver(h).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initBulkEnhancerSelectPickers=S})();(function(){"use strict";let g=window.aipkit_escapeHtml||(a=>String(a??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),o=["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],r=["{original_title}","{original_content}","{original_focus_keyword}","{original_meta_description}","{original_tags}","{categories}"],n=["{price}","{regular_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{purchase_note}","{product_categories}"],e=a=>a?.querySelector(".aipkit_enhancer_bulk_modal")?.dataset?.postType||"",i=(a,l)=>{let _=[...a==="meta"?r:o];return l==="product"&&_.push(...n),_.filter((u,m)=>_.indexOf(u)===m)},c=(a,l)=>{if(!a)return;let p=a.dataset.label||"Placeholders:",_=a.dataset.copyTitle||"Click to copy";a.innerHTML=`${g(p)} `,l.forEach((u,m)=>{let k=document.createElement("code");k.className="aipkit-placeholder",k.title=_,k.textContent=u,a.appendChild(k),m<l.length-1&&a.appendChild(document.createTextNode(" "))})},s=(a,l)=>{if(!a)return;let p=a.querySelector(".aipkit_bulk_prompt_placeholders");if(!p)return;let _=p.dataset.promptType||"",u=i(_,l);c(p,u)};function t(a){if(!a)return;let l=a.querySelectorAll("[data-aipkit-bulk-popover]");if(!l.length)return;let p=null,_=null,u=!1,m=y=>y?a.querySelector(`#${y}`):null,k=(y,I)=>{if(!y||!I)return;let S=y.getBoundingClientRect(),h=I.getBoundingClientRect(),M=h.width||400,b=h.height||0,A=window.innerWidth,x=window.innerHeight,v=12,C=S.left;C+M>A-v&&(C=S.right-M),C=Math.max(v,Math.min(C,A-M-v));let P=S.bottom+8;P+b>x-v&&(P=S.top-b-8),P=Math.max(v,Math.min(P,x-b-v)),I.style.left=`${Math.round(C)}px`,I.style.top=`${Math.round(P)}px`},f=()=>{!_||!p||u||(u=!0,window.requestAnimationFrame(()=>{let y=p.querySelector(".aipkit_model_settings_popover_panel");k(_,y),u=!1}))},w=()=>{p&&(p.classList.remove("aipkit-active"),p.setAttribute("aria-hidden","true"),_&&_.setAttribute("aria-expanded","false"),p?.dataset?.aipkitBulkPopover==="prompts"&&typeof window.aipkit_enhancer_closeBulkPromptFlyout=="function"&&window.aipkit_enhancer_closeBulkPromptFlyout(),p=null,_=null)},E=y=>{if(!y)return;let I=y.getAttribute("data-aipkit-popover-target"),S=m(I);if(!S)return;p&&p!==S&&w(),p=S,_=y,S.classList.add("aipkit-active"),S.setAttribute("aria-hidden","false"),y.setAttribute("aria-expanded","true");let h=S.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{k(y,h)})};l.forEach(y=>{y.dataset.popoverListenerAttached!=="true"&&(y.addEventListener("click",I=>{if(I.preventDefault(),p&&_===y){w();return}E(y)}),y.dataset.popoverListenerAttached="true")}),a.querySelectorAll(".aipkit_model_settings_popover[data-aipkit-bulk-popover]").forEach(y=>{y.dataset.overlayListenerAttached!=="true"&&(y.addEventListener("click",S=>{S.target===y&&w()}),y.dataset.overlayListenerAttached="true");let I=y.querySelector(".aipkit_model_settings_popover_close");I&&I.dataset.popoverListenerAttached!=="true"&&(I.addEventListener("click",S=>{S.preventDefault(),w()}),I.dataset.popoverListenerAttached="true")}),a.dataset.bulkPromptPopoverEscapeAttached!=="true"&&(document.addEventListener("keydown",y=>{y.key==="Escape"&&p&&w()}),a.dataset.bulkPromptPopoverEscapeAttached="true"),a.dataset.bulkPromptPopoverRepositionAttached!=="true"&&(window.addEventListener("resize",f),window.addEventListener("scroll",f,!0),a.dataset.bulkPromptPopoverRepositionAttached="true")}function d(a){if(!a)return;let l=a.querySelectorAll(".aipkit_prompt_edit_btn");if(!l.length)return;let p=e(a),_=null,u=null,m=!1,k=S=>S?a.querySelector(`#${S}`):null,f=(S,h,M)=>{if(!S||!h)return;let b=S.getBoundingClientRect(),A=h.getBoundingClientRect(),x=M?M.getBoundingClientRect():b,v=A.width||580,C=A.height||0,P=window.innerWidth,$=window.innerHeight,U=12,B=x.left-v-12;B<U&&(B=x.right+12),B=Math.max(U,Math.min(B,P-v-U));let D=x.top;D+C>$-U&&(D=$-C-U),D=Math.max(U,D),_.style.left=`${Math.round(B)}px`,_.style.top=`${Math.round(D)}px`},w=()=>{!u||!_||m||(m=!0,window.requestAnimationFrame(()=>{let S=_.querySelector(".aipkit_cw_prompt_panel"),h=u.closest(".aipkit_model_settings_popover_panel");f(u,S,h),m=!1}))},E=()=>{_&&(_.classList.remove("is-open"),_.setAttribute("aria-hidden","true"),u&&u.setAttribute("aria-expanded","false"),_=null,u=null)},y=S=>{let h=S.getAttribute("data-aipkit-flyout-target"),M=k(h);if(!M)return;_&&_!==M&&E(),_=M,u=S,M.classList.add("is-open"),M.setAttribute("aria-hidden","false"),S.setAttribute("aria-expanded","true"),s(M,p);let b=M.querySelector(".aipkit_cw_prompt_panel"),A=S.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{f(S,b,A)})};l.forEach(S=>{S.dataset.flyoutListenerAttached!=="true"&&(S.addEventListener("click",h=>{if(h.preventDefault(),_&&u===S){E();return}y(S)}),S.dataset.flyoutListenerAttached="true")}),a.querySelectorAll(".aipkit_cw_prompt_library_select").forEach(S=>{let h=S.getAttribute("data-aipkit-prompt-target"),M=h?a.querySelector(`#${h}`):null;M&&M.value.trim()===""&&S.value&&(M.value=S.value),S.dataset.promptLibraryAttached!=="true"&&(S.addEventListener("change",()=>{if(!S.value)return;let b=S.getAttribute("data-aipkit-prompt-target"),A=b?a.querySelector(`#${b}`):null;A&&(A.value=S.value,A.dispatchEvent(new Event("input",{bubbles:!0})))}),S.dataset.promptLibraryAttached="true")}),a.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(S=>{S.dataset.overlayListenerAttached!=="true"&&(S.addEventListener("click",h=>{h.target===S&&E()}),S.dataset.overlayListenerAttached="true")}),a.dataset.bulkPromptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",S=>{S.key==="Escape"&&_&&E()}),a.dataset.bulkPromptFlyoutEscapeAttached="true"),a.dataset.bulkPromptFlyoutClickAttached!=="true"&&(document.addEventListener("click",S=>{if(!_)return;let h=S.target;h.closest(".aipkit_cw_prompt_flyout")||h.closest("[data-aipkit-flyout-target]")||E()}),a.dataset.bulkPromptFlyoutClickAttached="true"),a.dataset.bulkPromptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),a.dataset.bulkPromptFlyoutRepositionAttached="true"),window.aipkit_enhancer_closeBulkPromptFlyout=E}window.aipkit_enhancer_initBulkPromptPopovers=t,window.aipkit_enhancer_initBulkPromptFlyouts=d})();(function(){"use strict";let g=window.aipkit_escapeHtml||(a=>a||""),o=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],r=a=>{let l=parseInt(a,10);if(Number.isFinite(l)){if(l>=1&&l<=o.length)return o[l-1];let p=o.find(_=>_.tokens===l);if(p)return p}return o[1]};function n(a,l){let p=window.aipkit_post_enhancer||{},_,u,m,k,f;a==="openai"?(_=l.querySelector("#aipkit_bulk_openai_vector_store_ids"),u=p.openai_vector_stores||[],m="id",k="name",f="No OpenAI stores found."):a==="pinecone"?(_=l.querySelector("#aipkit_bulk_pinecone_index_name"),u=p.pinecone_indexes||[],m="name",k="name",f="No Pinecone indexes found."):a==="qdrant"&&(_=l.querySelector("#aipkit_bulk_qdrant_collection_name"),u=p.qdrant_collections||[],m="name",k="name",f="No Qdrant collections found."),_&&(_.innerHTML="",u.length>0?_.multiple?u.forEach(w=>{_.add(new Option(g(w[k]),w[m]))}):(_.add(new Option("-- Select --","")),u.forEach(w=>{_.add(new Option(g(w[k]),w[m]))})):(_.add(new Option(f,"")),_.disabled=!0),a==="openai"&&e(l))}function e(a){let l=a.querySelector("[data-aipkit-vector-stores-dropdown]");if(!l)return;let p=l.closest(".aipkit_cw_vector_openai_field"),_=p?p.querySelector(".aipkit_popover_multiselect_select"):null;if(!_)return;let u=l.querySelector(".aipkit_popover_multiselect_btn"),m=l.querySelector(".aipkit_popover_multiselect_label"),k=l.querySelector(".aipkit_popover_multiselect_panel"),f=l.querySelector(".aipkit_popover_multiselect_options"),w=l.dataset.placeholder||"Select stores",E=l.dataset.selectedLabel||"selected",y=()=>{if(!m)return;let b=Array.from(_.options).filter(x=>x.selected&&x.value);if(!b.length){m.textContent=w;return}let A=b.map(x=>x.textContent.trim()).filter(Boolean);if(A.length<=2){m.textContent=A.join(", ");return}m.textContent=`${A.length} ${E}`},I=()=>{if(!f)return;f.innerHTML="";let b=Array.from(_.options),A=b.filter(x=>x.value);if(!A.length){let x=document.createElement("div");x.className="aipkit_popover_multiselect_empty",x.textContent=b[0]?.textContent||"-- No Stores Found --",f.appendChild(x),y();return}A.forEach(x=>{let v=document.createElement("label");v.className="aipkit_popover_multiselect_item";let C=document.createElement("input");C.type="checkbox",C.value=x.value,C.checked=x.selected,C.disabled=x.disabled;let P=document.createElement("span");P.className="aipkit_popover_multiselect_text",P.textContent=x.textContent,v.appendChild(C),v.appendChild(P),f.appendChild(v)}),y()},S=()=>{if(!f){y();return}let b=new Set(Array.from(_.options).filter(A=>A.selected).map(A=>A.value));f.querySelectorAll('input[type="checkbox"]').forEach(A=>{A.checked=b.has(A.value)}),y()},h=b=>{if(!f)return;let A=Array.from(f.querySelectorAll('input[type="checkbox"]:checked'));if(A.length>2){let v=b&&b.target;if(v&&v.checked)v.checked=!1;else{let C=A[A.length-1];C&&(C.checked=!1)}}let x=Array.from(f.querySelectorAll('input[type="checkbox"]:checked')).map(v=>v.value);Array.from(_.options).forEach(v=>{v.selected=x.includes(v.value)}),_.dispatchEvent(new Event("change",{bubbles:!0})),y()},M=b=>{!l||!u||(l.classList.toggle("is-open",b),u.setAttribute("aria-expanded",b?"true":"false"),k&&(k.hidden=!b))};I(),S(),l.dataset.vectorStoreMultiselectAttached||(u&&(u.addEventListener("click",b=>{b.preventDefault(),b.stopPropagation(),M(!l.classList.contains("is-open"))}),u.addEventListener("keydown",b=>{b.key==="Escape"&&M(!1)})),document.addEventListener("click",b=>{l.classList.contains("is-open")&&(l.contains(b.target)||M(!1))}),f&&!f.dataset.listenerAttached&&(f.addEventListener("change",h),f.dataset.listenerAttached="true"),_.dataset.listenerAttached||(_.addEventListener("change",S),_.dataset.listenerAttached="true"),l.dataset.vectorStoreMultiselectAttached="true")}function i(a,l){let p=l.querySelector("#aipkit_bulk_vector_embedding_model");if(!p)return;let _=window.aipkit_post_enhancer||{},u=[];a==="google"?u=_.googleEmbeddingModels||[]:a==="azure"?u=_.azureEmbeddingModels||[]:u=_.openaiEmbeddingModels||[],p.innerHTML="",u.length>0?(p.add(new Option("-- Select Model --","")),u.forEach(m=>{p.add(new Option(g(m.name||m.id),m.id))}),p.disabled=!1):(p.add(new Option("No models found","")),p.disabled=!0)}function c(a){let l=a.querySelector("#aipkit_bulk_vector_store_provider").value,p=a.querySelector(".aipkit_cw_vector_openai_field"),_=a.querySelector(".aipkit_cw_vector_pinecone_field"),u=a.querySelector(".aipkit_cw_vector_qdrant_field"),m=a.querySelector(".aipkit_cw_vector_embedding_config_row");p&&(p.hidden=!0),_&&(_.hidden=!0),u&&(u.hidden=!0),m&&(m.hidden=!0),l==="openai"?(p&&(p.hidden=!1),n("openai",a)):l==="pinecone"?(_&&(_.hidden=!1),m&&(m.hidden=!1),n("pinecone",a),i("openai",a)):l==="qdrant"&&(u&&(u.hidden=!1),m&&(m.hidden=!1),n("qdrant",a),i("openai",a))}function s(a){let l=a.querySelector('input[name="enable_vector_store"]'),p=a.querySelector(".aipkit_cw_vector_store_settings_container"),_=a.querySelector("#aipkit_bulk_vector_store_provider"),u=a.querySelector("#aipkit_bulk_vector_embedding_provider"),m=a.querySelector("#aipkit_bulk_vector_store_top_k"),k=a.querySelector("#aipkit_bulk_vector_store_top_k_value");if(!(!l||!p||!_)){if(l.addEventListener("change",()=>{p.hidden=!l.checked}),_.addEventListener("change",()=>c(a)),u&&u.addEventListener("change",f=>i(f.target.value,a)),m&&k){let f=()=>{k.textContent=m.value};m.addEventListener("input",f),f()}p.hidden=!l.checked,c(a)}}function t(a){let l=a.querySelectorAll(".aipkit_prompt_toggle_card, .aipkit_enhancer_prompt_card");l.length&&l.forEach(p=>{let _=p.querySelector('input[name="bulk_enhance_fields"], input[name="generate_seo_slug"]');if(!_)return;let u=()=>{p.classList.toggle("is-disabled",!_.checked)};u(),_.addEventListener("change",u),p.dataset.promptToggleAttached!=="true"&&(p.addEventListener("click",m=>{m.target.closest(".aipkit_prompt_edit_btn")||m.target.closest("a")||_.disabled||(m.target.closest(".aipkit_switch")&&m.preventDefault(),_.checked=!_.checked,_.dispatchEvent(new Event("change",{bubbles:!0})))}),p.dataset.promptToggleAttached="true")})}function d(a,l){if(!a)return;let p=a.querySelector("#aipkit-enhancer-bulk-config"),_=a.querySelector("#aipkit-enhancer-bulk-progress"),u=a.querySelector("#aipkit_bulk_enhancer_start_btn"),m=a.querySelector("#aipkit_bulk_enhancer_stop_btn"),k=a.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn");if(p&&(p.hidden=!1),_&&(_.hidden=!0),u){u.disabled=!1;let A=u.querySelector(".aipkit_btn-text");A&&(A.textContent="Start")}m&&(m.hidden=!0),k&&(k.hidden=!0);let f=a.querySelectorAll(".aipkit_enhancer_advanced_details");f.length&&f.forEach(A=>{if(A.dataset.toggleListenerAttached==="true")return;let x=A.querySelector("summary");x&&(x.addEventListener("click",v=>{v.preventDefault(),A.hasAttribute("open")?A.removeAttribute("open"):A.setAttribute("open","")}),A.dataset.toggleListenerAttached="true")});let w=a.querySelector(".aipkit_enhancer_settings_popover");w&&w.dataset.checkboxDelegateAttached!=="true"&&(w.addEventListener("click",A=>{let x=A.target?.closest?.(".aipkit_switch");if(x&&w.contains(x)){let P=x.querySelector('input[type="checkbox"]');if(!P||P.disabled)return;A.preventDefault(),P.checked=!P.checked,P.dispatchEvent(new Event("change",{bubbles:!0}));return}let v=A.target.closest(".aipkit_checkbox-label");if(!v||!w.contains(v))return;let C=v.querySelector('input[type="checkbox"]');!C||C.disabled||A.target!==C&&(A.preventDefault(),C.checked=!C.checked,C.dispatchEvent(new Event("change",{bubbles:!0})))}),w.dataset.checkboxDelegateAttached="true");function E(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),a&&(a.classList.remove("aipkit-active"),a.addEventListener("transitionend",()=>a.remove(),{once:!0}),setTimeout(()=>a?.remove(),500))}a.querySelector(".aipkit-modal-close-btn").addEventListener("click",E);let y=a.querySelector("#aipkit_bulk_ai_provider"),I=a.querySelector("#aipkit_bulk_ai_model"),S=a.querySelector("#aipkit_bulk_ai_temperature"),h=a.querySelector("#aipkit_bulk_ai_temperature_value"),M=a.querySelector("#aipkit_bulk_content_max_tokens"),b=a.querySelector("#aipkit_bulk_content_max_tokens_value");if(y&&I&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(y.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(y,I)),window.aipkit_enhancer_populateBulkModels(y,I)),I&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&I.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(a)),S&&h&&S.addEventListener("input",()=>h.textContent=S.value),M&&b){let A=()=>{let x=r(M.value);b.textContent=`${x.words} words`};M.addEventListener("input",A),A()}typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(a),t(a),typeof window.aipkit_enhancer_initBulkPromptPopovers=="function"&&window.aipkit_enhancer_initBulkPromptPopovers(a),typeof window.aipkit_enhancer_initBulkPromptFlyouts=="function"&&window.aipkit_enhancer_initBulkPromptFlyouts(a),a.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(l)}),a.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),a.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),s(a)}window.aipkit_enhancer_attachBulkModalListeners=d})();(function(){"use strict"})();(function(){"use strict";function g(o,r,n){let i=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithError(o.message||i.error_loading_title,i):r?window.aipkit_updateModalWithSuggestions(r,i):window.aipkit_updateModalWithError(i.error_loading_title||"Unknown error occurred.",i)}window.aipkit_handleTitleSuggestionsResult=g})();(function(){"use strict";function g(o,r,n){let i=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorExcerpt(o.message||i.error_loading_excerpt,i):r?window.aipkit_updateModalWithExcerptSuggestions(r,i):window.aipkit_updateModalWithErrorExcerpt(i.error_loading_excerpt||"Unknown error occurred.",i)}window.aipkit_handleExcerptSuggestionsResult=g})();(function(){"use strict";function g(o,r,n){let i=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorMeta(o.message||i.error_loading_meta,i):r?window.aipkit_updateModalWithMetaSuggestions(r,i):window.aipkit_updateModalWithErrorMeta(i.error_loading_meta||"Unknown error occurred.",i)}window.aipkit_handleMetaSuggestionsResult=g})();(function(){"use strict";function g(){}function o(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=o})();(function(){"use strict";function g(r){let n=r.target.closest(".aipkit_enhancer_item"),e=r.target.closest("#aipkit_bulk_enhance_btn");if(n){if(n.classList.contains("aipkit_enhancer_placeholder")){r.target.tagName==="A"&&r.preventDefault();return}r.preventDefault();let i=n.getAttribute("data-post-id"),c=n.getAttribute("data-action-type");if(!i||!c)return;let s=window.aipkit_post_enhancer||{},t=s.text||{};switch(c){case"title":window.aipkit_showLoadingModal(i,t,s),window.aipkit_fetchTitleSuggestions(i,window.aipkit_handleTitleSuggestionsResult,n);break;case"excerpt":window.aipkit_showLoadingExcerptModal(i,t,s),window.aipkit_fetchExcerptSuggestions(i,window.aipkit_handleExcerptSuggestionsResult,n);break;case"meta":window.aipkit_showLoadingMetaModal(i,t,s),window.aipkit_fetchMetaSuggestions(i,window.aipkit_handleMetaSuggestionsResult,n);break;case"tags":window.aipkit_showLoadingTagsModal(i,t,s),window.aipkit_fetchTagsSuggestions(i,window.aipkit_handleTagsSuggestionsResult,n);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${c}'.`);break}}else if(e){r.preventDefault();let i=document.querySelectorAll('input[name="post[]"]:checked');if(i.length===0){alert("Please select at least one post.");return}let c=Array.from(i).map(t=>t.value),s=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(c,s):alert("Error: Bulk processing feature is not available.")}}function o(){let r=document;if(!r)return;let n="data-post-enhancer-listener";document.body.getAttribute(n)||(r.addEventListener("click",g),document.body.setAttribute(n,"true"))}window.aipkit_initEnhancerEventListeners=o})();(function(){"use strict";function g(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(r=>typeof window[r]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),function(){let n=new WeakMap;function e(d){c(d),d.classList.add("aipkit-open")}function i(d){c(d);let a=setTimeout(()=>{d.classList.remove("aipkit-open")},180);n.set(d,a)}function c(d){let a=n.get(d);a&&(clearTimeout(a),n.delete(d))}function s(d){if(!d||d.dataset.aipkitHoverBound==="1")return;d.dataset.aipkitHoverBound="1",d.addEventListener("mouseenter",()=>e(d)),d.addEventListener("mouseleave",()=>i(d));let a=d.querySelector(".aipkit_enhancer_popover");a&&(a.addEventListener("mouseenter",()=>e(d)),a.addEventListener("mouseleave",()=>i(d)))}function t(){document.querySelectorAll(".aipkit_enhancer_action").forEach(s),new MutationObserver(l=>{for(let p of l)p.addedNodes&&p.addedNodes.length&&p.addedNodes.forEach(_=>{_.nodeType===1&&(_.matches&&_.matches(".aipkit_enhancer_action")&&s(_),_.querySelectorAll&&_.querySelectorAll(".aipkit_enhancer_action").forEach(s))})}).observe(document.body,{childList:!0,subtree:!0})}t()}()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g(),window.aipkit_initPostEnhancer=g})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function o(){r()}function r(){let n=document.getElementById("aipkit_vpp_embedding_model_select");if(!n){console.error("VPP Embedding Util: Embedding model select not found.");return}let e=window.aipkit_vpp_config||{},i=e.text||{};n.innerHTML=`<option value="">${g(i.select_model||"-- Select Model --")}</option>`;let c=[{key:"openai",label:"OpenAI",models:e.openaiEmbeddingModels||[]},{key:"google",label:"Google",models:e.googleEmbeddingModels||[]},{key:"azure",label:"Azure",models:e.azureEmbeddingModels||[]}],s=!1;c.forEach(t=>{if(!t.models||t.models.length===0)return;s=!0;let d=document.createElement("optgroup");d.label=t.label,t.models.forEach(a=>{if(a&&a.id){let l=document.createElement("option");l.value=a.id,l.textContent=g(a.name||a.id),l.dataset.provider=t.key,d.appendChild(l)}}),d.children.length&&n.appendChild(d)}),s?(n.disabled=!1,n.options.length>1&&(n.selectedIndex=1)):(n.appendChild(new Option(g(i.no_embedding_models||"(No embedding models - Sync in AI Settings)"),"")),n.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=o,window.aipkit_vpp_populateEmbeddingModelSelect=r})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function o(){let n=document.getElementById("aipkit_vpp_openai_vector_store_id"),e=document.getElementById("aipkit_vpp_openai_store_status"),i=window.aipkit_vpp_config||{},c=i.text||{},s=i.openai_vector_stores||[];if(!n){console.error("VPP OpenAI Provider: Store select not found.");return}n.innerHTML="",e&&(e.textContent=""),s.length>0?(n.appendChild(new Option(`-- ${g(c.select_store||"Select Existing Store")} --`,"")),s.forEach(t=>{let d="(Files: N/A)";t.file_counts&&typeof t.file_counts.total=="number"?d=`(${t.file_counts.total} ${t.file_counts.total===1?"File":"Files"})`:t.file_counts&&(d="(Files: ?)");let a=`${g(t.name||t.id)} ${d}`,l=new Option(a,t.id);n.appendChild(l)})):n.appendChild(new Option(g(c.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),n.disabled=s.length===0}async function r(n,e,i,c){let s=window.aipkit_vpp_config||{},t=s.text||{},d=n.length,a=0,l=0,p=0,_=[];try{let u=s.nonce_index_posts;if(!u)throw new Error("Nonce for indexing posts is missing in config.");for(let k of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}a++;let f=document.querySelector(`#post-${k}`),w=f?f.querySelector(".title .row-title"):null,E=w?w.textContent.trim():`Post #${k}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(k,"processing","",E),typeof window.aipkit_vpp_updateProgress=="function"){let I=a/d*100,S=(t.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",a).replace("%2$d",d)+` "${g(E)}"`;window.aipkit_vpp_updateProgress(I,S)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let y={_ajax_nonce:u,post_ids:[k],post_type:c,target_store_id:e,new_store_name_openai:i||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",y),l++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(k,"success","",E)}catch(I){if(p++,_.push({id:k,title:E,error:I.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${k}:`,I),typeof window.aipkit_vpp_updateProgressItem=="function"){let S=I?.message||t.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(k,"error",S,E)}}}let m=`Indexing complete. ${l} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&a<d?m=`Indexing stopped. ${l} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",_),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${l}/${d}`)}catch(u){console.error("VPP OpenAI Provider: Indexing setup error:",u),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,t.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(u.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=o,window.aipkit_vpp_startIndexingOpenAI=r})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function o(){let n=document.getElementById("aipkit_vpp_pinecone_target_index_select"),e=document.getElementById("aipkit_vpp_pinecone_index_status"),i=window.aipkit_vpp_config||{},c=i.text||{},s=i.pinecone_indexes||[];if(!n){console.error("VPP Pinecone Provider: Index select not found.");return}n.innerHTML="",e&&(e.textContent=""),s.length>0?(n.appendChild(new Option(`-- ${g(c.select_pinecone_index||"Select Pinecone Index")} --`,"")),s.forEach(t=>{let d=t.name||t.id;if(d){let a=`${g(d)} (${t.dimension||"?"})`;n.appendChild(new Option(a,d))}})):n.appendChild(new Option(g(c.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),n.disabled=s.length===0}async function r(n,e,i,c,s){let t=window.aipkit_vpp_config||{},d=t.text||{},a=n.length,l=0,p=0,_=0,u=[];try{let m=t.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let f of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}l++;let w=document.querySelector(`#post-${f}`),E=w?w.querySelector(".title .row-title"):null,y=E?E.textContent.trim():`Post #${f}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(f,"processing","",y),typeof window.aipkit_vpp_updateProgress=="function"){let S=l/a*100,h=(d.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",l).replace("%2$d",a)+` "${g(y)}"`;window.aipkit_vpp_updateProgress(S,h)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let I={_ajax_nonce:m,post_ids:[f],post_type:s,target_index_id:e,provider:"pinecone",embedding_provider:i,embedding_model:c};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",I),p++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(f,"success","",y)}catch(S){if(_++,u.push({id:f,title:y,error:S.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${f}:`,S),typeof window.aipkit_vpp_updateProgressItem=="function"){let h=S?.message||d.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(f,"error",h,y)}}}let k=`Indexing complete. ${p} successful, ${_} failed.`;window.aipkit_isIndexingStopped&&l<a?k=`Indexing stopped. ${p} successful, ${_} failed.`:_>0&&console.error("Failed Posts:",u),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(k,_>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${p}/${a}`)}catch(m){console.error("VPP Pinecone Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,d.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),_>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=o,window.aipkit_vpp_startIndexingPinecone=r})();(function(){"use strict";let g=window.aipkit_escapeHtml||function(n){return n};function o(){let n=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),e=document.getElementById("aipkit_vpp_qdrant_collection_status"),i=window.aipkit_vpp_config||{},c=i.text||{},s=i.qdrant_collections||[];if(!n){console.error("VPP Qdrant Provider: Collection select not found.");return}n.innerHTML="",e&&(e.textContent=""),s.length>0?(n.appendChild(new Option(`-- ${g(c.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),s.forEach(t=>{let d=t.name||t.id;d&&n.appendChild(new Option(g(d),d))})):n.appendChild(new Option(g(c.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),n.disabled=s.length===0}async function r(n,e,i,c,s){let t=window.aipkit_vpp_config||{},d=t.text||{},a=n.length,l=0,p=0,_=0,u=[];try{let m=t.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let f of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}l++;let w=document.querySelector(`#post-${f}`),E=w?w.querySelector(".title .row-title"):null,y=E?E.textContent.trim():`Post #${f}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(f,"processing","",y),typeof window.aipkit_vpp_updateProgress=="function"){let S=l/a*100,h=(d.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",l).replace("%2$d",a)+` "${g(y)}"`;window.aipkit_vpp_updateProgress(S,h)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let I={_ajax_nonce:m,post_ids:[f],post_type:s,target_collection_name:e,provider:"qdrant",embedding_provider:i,embedding_model:c};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",I),p++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(f,"success","",y)}catch(S){if(_++,u.push({id:f,title:y,error:S.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${f}:`,S),typeof window.aipkit_vpp_updateProgressItem=="function"){let h=S?.message||d.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(f,"error",h,y)}}}let k=`Indexing complete. ${p} successful, ${_} failed.`;window.aipkit_isIndexingStopped&&l<a?k=`Indexing stopped. ${p} successful, ${_} failed.`:_>0&&console.error("Failed Posts:",u),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(k,_>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${p}/${a}`)}catch(m){console.error("VPP Qdrant Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,d.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),_>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=o,window.aipkit_vpp_startIndexingQdrant=r})();(function(){"use strict";let g=window.wp?.i18n?.__||function(b){return b},o="#aipkit_vpp_modal",r=["#aipkit_vpp_vector_store_provider","#aipkit_vpp_openai_vector_store_id","#aipkit_vpp_pinecone_target_index_select","#aipkit_vpp_qdrant_target_collection_select","#aipkit_vpp_embedding_model_select"].join(", "),n=null,e=null,i=!1,c=new Set(["aipkit_vpp_vector_store_provider"]),s=b=>!!(b&&b.id&&c.has(b.id)),t=b=>String(b||"").trim().toLowerCase(),d=(b,A)=>{if(!b)return;let x="aipkit_settings_select_picker_icon--";b.classList.forEach(C=>{C.startsWith(x)&&b.classList.remove(C)}),b.classList.remove("is-hidden");let v=t(A);if(!v){b.classList.add("is-hidden");return}b.classList.add(`${x}${v}`)},a=b=>{if(!b)return"";let A=b.getAttribute("data-aipkit-picker-title");if(A)return A;let x=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return x?x.textContent.trim():""},l=b=>{if(!b)return"";let A=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(A)return A.textContent.trim();let x=b.querySelector("option");return x?x.textContent.trim():""},p=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),_=(b,A)=>{if(!b||!b.id||!A)return null;let x=p(b.id),v=A.querySelector(`#${x.buttonId}`);if(!v){if(v=document.createElement("button"),v.type="button",v.id=x.buttonId,v.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",v.setAttribute("data-aipkit-popover-target",x.popoverId),v.setAttribute("aria-controls",x.popoverId),v.setAttribute("aria-expanded","false"),v.dataset.aipkitPopoverPlacement="bottom",s(b)){v.classList.add("aipkit_settings_select_picker_btn--provider");let U=document.createElement("span");U.className="aipkit_settings_select_picker_icon",U.setAttribute("aria-hidden","true"),d(U,b.value),v.appendChild(U)}let P=document.createElement("span");P.className="aipkit_settings_select_picker_label",P.id=x.labelId,P.textContent=l(b)||g("Select","gpt3-ai-content-generator");let $=document.createElement("span");$.className="dashicons dashicons-arrow-down-alt2",$.setAttribute("aria-hidden","true"),v.appendChild(P),v.appendChild($),b.insertAdjacentElement("beforebegin",v)}v.disabled=b.disabled,b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let C=A.querySelector(`#${x.popoverId}`);if(!C){C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",s(b)&&C.classList.add("aipkit_settings_select_picker_popover--provider"),C.id=x.popoverId,C.setAttribute("aria-hidden","true");let P=document.createElement("div");P.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",P.setAttribute("role","dialog"),P.setAttribute("aria-labelledby",x.titleId);let $=document.createElement("div");$.className="aipkit_model_settings_popover_header";let U=document.createElement("span");U.className="aipkit_model_settings_popover_title",U.id=x.titleId,U.textContent=a(b)||g("Select","gpt3-ai-content-generator");let B=document.createElement("button");B.type="button",B.className="aipkit_model_settings_popover_close",B.setAttribute("aria-label",g("Close","gpt3-ai-content-generator")),B.innerHTML='<span class="dashicons dashicons-no-alt"></span>',$.appendChild(U),$.appendChild(B);let D=document.createElement("div");D.className="aipkit_model_settings_popover_body";let N=document.createElement("div");N.className="aipkit_settings_select_picker_search";let R=document.createElement("input");R.type="search",R.id=x.searchId,R.className="aipkit_form-input";let j=a(b),L=j?`Search ${j.toLowerCase()}...`:g("Search...","gpt3-ai-content-generator");R.setAttribute("placeholder",L),N.appendChild(R);let K=document.createElement("div");K.className="aipkit_settings_select_picker_list",K.id=x.listId,K.setAttribute("role","listbox"),D.appendChild(N),D.appendChild(K),P.appendChild($),P.appendChild(D),C.appendChild(P),A.appendChild(C),(s(b)||b.dataset.aipkitPickerSearch==="false")&&(N.style.display="none")}return{ids:x,button:v,popover:C,label:A.querySelector(`#${x.labelId}`),search:A.querySelector(`#${x.searchId}`),list:A.querySelector(`#${x.listId}`)}},u=b=>{let A=[];return b&&Array.from(b.children).forEach(v=>{if(v.tagName==="OPTGROUP"){let C=Array.from(v.children).filter(P=>P.tagName==="OPTION").map(P=>({value:P.value,label:P.textContent.trim(),disabled:P.disabled,selected:P.selected}));A.push({groupLabel:v.label||"",options:C})}else v.tagName==="OPTION"&&A.push({groupLabel:"",options:[{value:v.value,label:v.textContent.trim(),disabled:v.disabled,selected:v.selected}]})}),A},m=(b,A,x="")=>{if(!b||!A)return;let v=x.trim().toLowerCase();A.innerHTML="";let C=u(b),P=!1;if(C.forEach($=>{let U=$.options.filter(B=>v?B.label.toLowerCase().includes(v):!0);if(U.length){if($.groupLabel){let B=document.createElement("div");B.className="aipkit_settings_select_picker_group_label",B.textContent=$.groupLabel,A.appendChild(B)}U.forEach(B=>{let D=document.createElement("button");if(D.type="button",D.className="aipkit_settings_select_picker_item",D.setAttribute("role","option"),D.dataset.value=B.value,D.dataset.label=B.label,B.disabled&&(D.classList.add("is-disabled"),D.setAttribute("aria-disabled","true")),b.value===B.value?(D.classList.add("is-active"),D.setAttribute("aria-selected","true")):D.setAttribute("aria-selected","false"),s(b)){D.classList.add("aipkit_settings_select_picker_item--provider");let j=document.createElement("span");j.className="aipkit_settings_select_picker_icon",j.setAttribute("aria-hidden","true"),d(j,B.value),D.appendChild(j)}let N=document.createElement("span");N.className="aipkit_settings_select_picker_text",N.textContent=B.label;let R=document.createElement("span");R.className="dashicons dashicons-yes aipkit_settings_select_picker_check",D.appendChild(N),D.appendChild(R),A.appendChild(D),P=!0})}}),!P){let $=document.createElement("div");$.className="aipkit_settings_select_picker_empty",$.textContent=g(v?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild($)}},k=(b,A,x)=>{if(!b||!A)return;let v=l(b);if(A.textContent=v||g("Select","gpt3-ai-content-generator"),x&&(x.disabled=b.disabled),s(b)){let C=x?x.querySelector(".aipkit_settings_select_picker_icon"):null;d(C,b.value)}},f=(b,A)=>{if(!b||!A)return;let x=b.getBoundingClientRect(),v=A.getBoundingClientRect(),C=v.width||320,P=v.height||0,$=window.innerWidth,U=window.innerHeight,B=12,D=x.left;D+C>$-B&&(D=x.right-C),D=Math.max(B,Math.min(D,$-C-B));let N=x.bottom+8;N+P>U-B&&(N=x.top-P-8),N=Math.max(B,Math.min(N,U-P-B)),A.style.left=`${Math.round(D)}px`,A.style.top=`${Math.round(N)}px`},w=()=>{!n||!e||i||(i=!0,window.requestAnimationFrame(()=>{let b=n.querySelector(".aipkit_model_settings_popover_panel");f(e,b),i=!1}))},E=()=>{n&&(n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),n=null,e=null)},y=(b,A,x)=>{if(!b||!A)return;n&&n!==A&&E(),n=A,e=b,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let v=A.querySelector(".aipkit_settings_select_picker_search input"),C=A.querySelector(".aipkit_settings_select_picker_list");C&&m(x,C,v?v.value:""),v&&v.offsetParent!==null&&(v.focus(),v.select());let P=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{f(b,P)})},I=(b,A)=>{if(!b||!A)return;let{button:x,popover:v,list:C,search:P,label:$}=A;if(x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("click",U=>{if(U.preventDefault(),!x.disabled){if(n===v){E();return}y(x,v,b)}}),x.dataset.pickerListenerAttached="true"),v&&v.dataset.overlayListenerAttached!=="true"){v.addEventListener("click",B=>{B.target===v&&E()});let U=v.querySelector(".aipkit_model_settings_popover_close");U&&U.addEventListener("click",B=>{B.preventDefault(),E()}),v.dataset.overlayListenerAttached="true"}if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",U=>{let B=U.target.closest(".aipkit_settings_select_picker_item");if(!B||B.classList.contains("is-disabled"))return;let D=B.dataset.value??"";b.value=D,b.dispatchEvent(new Event("change",{bubbles:!0})),k(b,$,x),m(b,C,P?P.value:""),E()}),C.dataset.pickerListenerAttached="true"),P&&P.dataset.pickerListenerAttached!=="true"&&(P.addEventListener("input",()=>{m(b,C,P.value)}),P.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{k(b,$,x),m(b,C,P?P.value:""),n===v&&E()}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let U=!1;new MutationObserver(()=>{U||(U=!0,window.requestAnimationFrame(()=>{k(b,$,x),m(b,C,P?P.value:""),U=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitVppPickerEscapeBound||(document.addEventListener("keydown",U=>{U.key==="Escape"&&n&&E()}),document.body.dataset.aipkitVppPickerEscapeBound="true"),document.body.dataset.aipkitVppPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitVppPickerRepositionBound="true")};function S(b){if(!b||b.dataset.aipkitVppPickerInit==="true")return;let A=b.querySelectorAll(r);A.length&&(A.forEach(x=>{if(!x.id||x.dataset.aipkitPickerInit==="true")return;let v=_(x,b);v&&(k(x,v.label,v.button),m(x,v.list,v.search?v.search.value:""),I(x,v),x.dataset.aipkitPickerInit="true")}),b.dataset.aipkitVppPickerInit="true")}function h(){document.querySelectorAll(o).forEach(S)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h(),new MutationObserver(h).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initVppSelectPickers=S})();(function(){"use strict";let g="aipkit_vpp_modal",o=window.aipkit_escapeHtml||function(E){return E},r=window.aipkit_escapeAttribute||o,n=[],e="",i=!1,c=E=>{if(!E)return"Post";let y=window.aipkit_vpp_postTitles||{};if(y[E])return y[E];let I=document.querySelector(`#post-${E}`),S=I?I.querySelector(".title .row-title")||I.querySelector("strong a")||I.querySelector(".title a")||I.querySelector("a.row-title")||I.querySelector(".column-title strong a")||I.querySelector(".column-title .row-title"):null,h=S?S.textContent.trim():`Post #${E}`;return y[E]=h,window.aipkit_vpp_postTitles=y,h},s=E=>{let y=window.aipkit_vpp_config?.text||{};return{pending:y.status_pending||"Pending",processing:y.status_processing||"Processing",success:y.status_completed||"Completed",error:y.status_failed||"Failed",stopped:y.status_stopped||"Stopped"}[E]||E},t=(E,y)=>{let I=document.createElement("div");I.className="aipkit_vpp_progress_item aipkit_vpp_progress_item--pending",I.dataset.postId=E;let S=document.createElement("div");S.className="aipkit_vpp_progress_item_main";let h=document.createElement("div");h.className="aipkit_vpp_progress_item_title",h.textContent=y;let M=document.createElement("div");M.className="aipkit_vpp_progress_item_message",M.textContent="",M.style.display="none";let b=document.createElement("div");return b.className="aipkit_vpp_progress_item_status",b.textContent=s("pending"),S.appendChild(h),S.appendChild(M),I.appendChild(S),I.appendChild(b),I};function d(E,y){if(document.getElementById(g)){console.warn("VPP Modal UI: Modal already exists.");return}n=E,e=y,i=!1;let S=(window.aipkit_vpp_config||{}).text||{},h="",M=E.length;M===1?h=o(S.items_selected_singular||"You have selected %d item to index.").replace("%d",`<strong>${M}</strong>`):h=o(S.items_selected_plural||"You have selected %d items to index.").replace("%d",`<strong>${M}</strong>`);let b=document.createElement("div");b.id=g,b.className="aipkit-modal-overlay aipkit-active";let A=document.createElement("div");A.className="aipkit-modal-content aipkit_vpp_modal_content",A.innerHTML=`
            <div class="aipkit-modal-header aipkit_vpp_modal_header">
                <div class="aipkit_vpp_header_left">
                    <span class="aipkit_vpp_header_icon" aria-hidden="true">
                        <span class="dashicons dashicons-database"></span>
                    </span>
                    <div class="aipkit_vpp_header_text">
                        <h3 class="aipkit-modal-title">${o(S.modal_title||"Add Content to Vector Store")}</h3>
                        <span class="aipkit_vpp_header_subtitle">${o(S.modal_subtitle||"Index selected content for retrieval")}</span>
                    </div>
                </div>
                <button type="button" class="aipkit-modal-close-btn aipkit_vpp_close_btn" aria-label="${r(S.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body aipkit_vpp_modal_body">
                <div id="aipkit_vpp_status_message" class="aipkit_vpp_status_message" aria-live="polite"></div>

                <div class="aipkit_vpp_selection_card">
                    <span class="aipkit_vpp_selection_text">${h}</span>
                </div>

                <div class="aipkit_vpp_engine_card">
                    <div class="aipkit_enhancer_engine_card">
                        <div class="aipkit_enhancer_engine_fields">
                            <div class="aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_vector_store_provider">${o(S.provider_label||"Provider")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_vector_store_provider" class="aipkit_enhancer_engine_select">
                                            <option value="openai" selected>OpenAI</option>
                                            <option value="pinecone">Pinecone</option>
                                            <option value="qdrant">Qdrant</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_openai_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_openai_vector_store_id">${o(S.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(S.loading_stores||"Loading stores...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_pinecone_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_pinecone_target_index_select">${o(S.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(S.loading_indexes||"Loading indexes...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_qdrant_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_qdrant_target_collection_select">${o(S.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(S.loading_indexes||"Loading collections...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_embedding_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_embedding_model_select">${o(S.embedding_label||"Embedding")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_embedding_model_select" class="aipkit_enhancer_engine_select" data-aipkit-picker-search="false">
                                            <option value="">${o(S.select_model||"-- Select Model --")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="aipkit_vpp_progress_area" class="aipkit_vpp_section aipkit_vpp_section--progress" hidden>
                    <div class="aipkit_vpp_section_header">
                        <span class="aipkit_vpp_section_title">${o(S.section_progress_title||"Progress")}</span>
                    </div>
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <div id="aipkit_vpp_progress_text" class="aipkit_vpp_progress_text"></div>
                    <div id="aipkit_vpp_progress_log" class="aipkit_vpp_progress_log" role="list"></div>
                </div>
            </div>
            <div class="aipkit-modal-footer aipkit_vpp_modal_footer">
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${o(S.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" hidden></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                     <span class="aipkit_btn-text">${o(S.stop||"Stop")}</span>
                </button>
            </div>
        `,b.appendChild(A),document.body.appendChild(b),A.addEventListener("click",v=>{let C=v.target;C.closest(".aipkit-modal-close-btn")||C.closest(".aipkit_vpp_modal_close_btn")?l():C.closest("#aipkit_vpp_start_indexing_btn")?w():C.closest("#aipkit_vpp_stop_indexing_btn")&&a()}),b.addEventListener("click",v=>{v.target===b&&l()});let x=document.getElementById("aipkit_vpp_vector_store_provider");x&&(x.addEventListener("change",f),f({target:x}))}function a(){window.aipkit_isIndexingStopped=!0;let E=document.getElementById("aipkit_vpp_stop_indexing_btn"),y=window.aipkit_vpp_config?.text||{};if(E){E.disabled=!0;let I=E.querySelector(".aipkit_btn-text");I&&(I.textContent=y.stopping||"Stopping...")}}function l(){window.aipkit_isIndexingStopped=!0;let E=document.getElementById(g);E&&(E.classList.remove("aipkit-active"),setTimeout(()=>{E.parentNode&&E.parentNode.removeChild(E)},300))}function p(E,y){let I=document.querySelector(`#${g} .aipkit_vpp_progress_bar`),S=document.getElementById("aipkit_vpp_progress_text");I&&(I.style.width=`${Math.max(0,Math.min(100,E))}%`),S&&(S.textContent=y)}function _(E){let y=document.getElementById("aipkit_vpp_progress_log");if(!y)return;y.innerHTML="";let I=document.createDocumentFragment();(E||[]).forEach(S=>{let h=c(S);I.appendChild(t(S,h))}),y.appendChild(I),y.scrollTop=0}function u(E,y,I="",S=""){let h=document.getElementById("aipkit_vpp_progress_log");if(!h)return;let M=`.aipkit_vpp_progress_item[data-post-id="${E}"]`,b=h.querySelector(M);if(!b){let v=S||c(E);b=t(E,v),h.appendChild(b)}b.className=`aipkit_vpp_progress_item aipkit_vpp_progress_item--${y}`;let A=b.querySelector(".aipkit_vpp_progress_item_status"),x=b.querySelector(".aipkit_vpp_progress_item_message");A&&(A.textContent=s(y)),x&&(x.textContent=I||"",x.style.display=I?"":"none"),h.scrollTop=h.scrollHeight}function m(E,y="info"){let I=document.getElementById("aipkit_vpp_status_message");I&&(I.textContent=E,I.className=`aipkit_vpp_status_message aipkit_message-${y}`)}function k(){i=!1;let E=document.getElementById("aipkit_vpp_start_indexing_btn"),y=document.getElementById("aipkit_vpp_stop_indexing_btn"),I=document.querySelectorAll(`#${g} .aipkit-modal-close-btn, #${g} .aipkit_vpp_modal_close_btn`),S=window.aipkit_vpp_config?.text||{};if(E){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(E,S.start_indexing||"Start Indexing"),E.disabled=!1,E.hidden=!1;let M=E.querySelector(".aipkit_spinner");M&&(M.hidden=!0)}if(y){y.hidden=!0,y.disabled=!1;let M=y.querySelector(".aipkit_btn-text");M&&(M.textContent=S.stop||"Stop")}I.forEach(M=>M.disabled=!1);let h=document.getElementById("aipkit_vpp_progress_area");h&&(h.hidden=!1)}function f(E){let y=E.target.value,I=document.getElementById("aipkit_vpp_openai_options"),S=document.getElementById("aipkit_vpp_pinecone_options"),h=document.getElementById("aipkit_vpp_qdrant_options"),M=document.getElementById("aipkit_vpp_embedding_options");I&&(I.hidden=!0),S&&(S.hidden=!0),h&&(h.hidden=!0),M&&(M.hidden=!0),y==="openai"?(I&&(I.hidden=!1),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):y==="pinecone"?(S&&(S.hidden=!1),M&&(M.hidden=!1),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):y==="qdrant"&&(h&&(h.hidden=!1),M&&(M.hidden=!1),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function w(){if(i)return;window.aipkit_isIndexingStopped=!1;let E=document.getElementById("aipkit_vpp_vector_store_provider").value,y=window.aipkit_vpp_config?.text||{},I="",S={post_ids:n,post_type:e,provider:E};if(E==="openai"){if(I=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!I){m(y.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}S.target_store_id=I}else if(E==="pinecone"){if(I=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!I){m(y.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}S.target_index_id=I;let x=document.getElementById("aipkit_vpp_embedding_model_select"),v=x?.selectedOptions&&x.selectedOptions.length?x.selectedOptions[0]:null;if(S.embedding_model=x?x.value:"",S.embedding_provider=v&&v.dataset.provider||"",!S.embedding_provider||!S.embedding_model){m(y.error_no_embedding_config||"Please select an embedding model for Pinecone.","error");return}}else if(E==="qdrant"){if(I=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!I){m(y.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}S.target_collection_name=I;let x=document.getElementById("aipkit_vpp_embedding_model_select"),v=x?.selectedOptions&&x.selectedOptions.length?x.selectedOptions[0]:null;if(S.embedding_model=x?x.value:"",S.embedding_provider=v&&v.dataset.provider||"",!S.embedding_provider||!S.embedding_model){m(y.error_no_embedding_config||"Please select an embedding model for Qdrant.","error");return}}else{m(`Provider ${E} not yet supported for indexing.`,"error");return}i=!0;let h=document.getElementById("aipkit_vpp_start_indexing_btn"),M=document.getElementById("aipkit_vpp_stop_indexing_btn"),b=document.querySelectorAll(`#${g} .aipkit-modal-close-btn, #${g} .aipkit_vpp_modal_close_btn`);if(h&&(h.hidden=!0),M){M.hidden=!1,M.disabled=!1;let x=M.querySelector(".aipkit_btn-text");x&&(x.textContent=y.stop||"Stop")}let A=document.getElementById("aipkit_vpp_progress_area");A&&(A.hidden=!1),typeof window.aipkit_vpp_initProgressLog=="function"&&window.aipkit_vpp_initProgressLog(n),p(0,y.status_preparing||"Preparing..."),E==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(n,I,null,e):E==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(n,I,S.embedding_provider,S.embedding_model,e):E==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(n,I,S.embedding_provider,S.embedding_model,e)}window.aipkit_vpp_showModal=d,window.aipkit_vpp_closeModal=l,window.aipkit_vpp_updateProgress=p,window.aipkit_vpp_initProgressLog=_,window.aipkit_vpp_updateProgressItem=u,window.aipkit_vpp_updateStatus=m,window.aipkit_vpp_resetModalAfterProcessing=k})();(function(){"use strict";let g="aipkit_add_to_vector_store_btn";function r(){let i=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(i.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let c=Array.from(i).map(s=>s.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(c,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function n(){let i=document.getElementById(g);return i&&!i.dataset.vppBound?(i.addEventListener("click",r),i.dataset.vppBound="1",!0):!!(i&&i.dataset.vppBound)}function e(){if(n())return;let i=document.querySelector("#wpbody-content")||document.body,c=Date.now();if(!i)return;let s=new MutationObserver(()=>{(n()||Date.now()-c>15e3)&&s.disconnect()});s.observe(i,{childList:!0,subtree:!0});let t=setInterval(()=>{(n()||Date.now()-c>15e3)&&clearInterval(t)},300)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",e):e()})();})();
