(()=>{(function(){"use strict";function k(e,i){if(!e)return;let a=e.querySelector(".aipkit_btn-text");if(a){a.textContent=i;return}let s=e.querySelector(".aipkit_spinner"),l=Array.from(e.childNodes).find(c=>c.nodeType===Node.TEXT_NODE);l?l.textContent=i+(s?" ":""):e.insertBefore(document.createTextNode(i+(s?" ":"")),e.firstChild),s&&e.appendChild(s)}function n(e,i,a,s=4e3){if(!e)return;let l=e.dataset.baseClass||"aipkit_form-help";e.dataset.baseClass||(e.dataset.baseClass=l),e.messageTimeoutId&&(clearTimeout(e.messageTimeoutId),e.messageTimeoutId=null),e.textContent=a,e.className=l,e.classList.add(`aipkit_form-help-${i}`),e.style.opacity="1",e.style.display="block",e.messageTimeoutId=setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.textContent===a&&(e.textContent="",e.className=l,e.style.display="",e.messageTimeoutId=null)},300)},s)}window.aipkit_setButtonText=k,window.aipkit_showTemporaryMessage=n})();(function(){"use strict";function k(e){return e===null||typeof e>"u"?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function n(e){return k(e)}window.aipkit_escapeHtml=k,window.aipkit_escapeAttribute=n})();(function(){"use strict";function k(e){let i=document.createElement("div");if(i.textContent="Copied!",Object.assign(i.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:1000005,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)",pointerEvents:"none"}),document.body.appendChild(i),e){let{top:a,left:s,width:l}=e.getBoundingClientRect(),c=a+window.scrollY+2,o=s+window.scrollX+l+5;i.style.top=`${c}px`,i.style.left=`${o}px`;let t=i.getBoundingClientRect(),r=8,f=window.innerWidth-r;if(t.right>f){let u=s+window.scrollX-t.width-5,p=Math.max(window.scrollX+r,u);i.style.left=`${p}px`}}else i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateY(0)"}),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateY(-5px)",i.addEventListener("transitionend",()=>i.remove(),{once:!0}),setTimeout(()=>{i.parentNode&&i.remove()},500)},1e3)}async function n(e,i){if(e)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(e),k(i);return}throw new Error("Clipboard API not available")}catch(a){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",a);try{let s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.top="-9999px",s.style.left="-9999px",s.style.opacity="0",s.setAttribute("readonly",""),document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999);let l=document.execCommand("copy");if(document.body.removeChild(s),l)k(i);else throw new Error('document.execCommand("copy") failed.')}catch(s){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",s),window.prompt("Please copy the shortcode manually:",e)}}}window.aipkit_copyShortcode=n})();(function(){"use strict";function k(a){let s=Number(a);if(!s||isNaN(s))return"";try{let l=new Date(s*1e3);if(isNaN(l.getTime()))return"";let c=String(l.getHours()).padStart(2,"0"),o=String(l.getMinutes()).padStart(2,"0"),t=String(l.getSeconds()).padStart(2,"0");return`${c}:${o}:${t}`}catch(l){return console.error("Error formatting timestamp:",a,l),""}}function n(a){if(!a)return"";try{let s=new Date(a.replace(" ","T")+"Z");if(isNaN(s.getTime()))return"";let l=new Date,c=(s.getTime()-l.getTime())/1e3;if(c<0)return"In the past";if(c<60)return"in less than a minute";if(c<3600){let f=Math.round(c/60);return`in ${f} minute${f!==1?"s":""}`}let o=new Date(l.getFullYear(),l.getMonth(),l.getDate()),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()+1),r=new Date(s.getFullYear(),s.getMonth(),s.getDate());return r.getTime()===o.getTime()?`Today at ${s.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:r.getTime()===t.getTime()?`Tomorrow at ${s.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${s.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(s){return console.error("Error formatting relative time:",a,s),a}}function e(a){if(!a)return"N/A";try{let s=new Date(a.replace(" ","T")+"Z");return isNaN(s.getTime())?"Invalid Date":s.toLocaleString()}catch(s){return console.error("Error formatting UTC date string:",a,s),a}}function i(a){if(!a)return"N/A";try{let s=new Date(a.replace(" ","T")+"Z");if(isNaN(s.getTime()))return"Invalid Date";let l=Math.floor((Date.now()-s.getTime())/1e3);if(Number.isNaN(l)||l<0)return s.toLocaleString();if(l<60)return"Just now";let c=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],o=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let t of c)if(l>=t.seconds){let r=Math.floor(l/t.seconds);return o?o.format(-r,t.unit):`${r} ${t.unit}${r!==1?"s":""} ago`}return s.toLocaleString()}catch(s){return console.error("Error formatting relative date string:",a,s),a}}window.aipkit_formatTimestamp=k,window.aipkit_formatFriendlyFutureDate=n,window.aipkit_formatUtcDateTime=e,window.aipkit_formatRelativeDateTime=i})();(function(){"use strict";function k(n){return!n||typeof n!="string"?"":n.charAt(0).toUpperCase()+n.slice(1)}window.aipkit_ucfirst=k,window.ucfirst=k})();(function(){"use strict";function k(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let n=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&n.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=n,n}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=k})();(function(){"use strict";function k(n,e="",i="",a={}){if(!n)return"N/A";let s=n.toLowerCase();if(s.includes("text content submitted for indexing"))return"Text";if(s.includes("file content submitted for indexing")||s.includes("file content embedded and upserted")||s.includes("original filename:"))return"File Upload";if(s.includes("wordpress post content submitted for indexing"))return"Site Content";if(i==="openai")return"N/A";if(i==="pinecone"&&s.includes("vectors upserted")){if(e.startsWith("wp_post_"))return"Site Content";if(e.startsWith("text_"))return"Text";if(e.includes("pinecone_file_")||e.includes("file_"))return"File Upload"}if(i==="qdrant"){if(s.includes("points upserted to qdrant"))return a.post_id||s.includes("post id:")?"Site Content":"Text";if(s.includes("wordpress post content submitted for indexing"))return"Site Content"}if(e&&i==="pinecone"){if(e.startsWith("wp_post_"))return"Site Content";if(e.startsWith("text_"))return"Text";if(e.includes("file_")||e.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=k})();(function(){"use strict";async function k(i){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",i)}async function n(i,a){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));i.set("action",a);try{let c=i.get("provider")||"openai",o=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null,t=o?i.get(o):null;if(t&&typeof t.size=="number"){let r=["text/plain","text/csv","application/json","text/json","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/csv","text/comma-separated-values"],f=Array.isArray(window.aipkit_uploadLimits?.allowed_mime_types)&&window.aipkit_uploadLimits.allowed_mime_types.length?window.aipkit_uploadLimits.allowed_mime_types:r,u=Number(window.aipkit_effectiveUploadLimitBytes||0);(!Number.isFinite(u)||u<=0)&&(u=10*1024*1024),c==="openai"&&(u=Math.min(u,10*1024*1024));let p=[];if(t.size>u&&p.push(`File is too large (${e(t.size)}). Max allowed is ${e(u)}.`),t.type&&!f.map(_=>_.toLowerCase()).includes(String(t.type).toLowerCase())&&p.push(`Unsupported file type (${t.type}). Allowed: ${f.join(", ")}.`),p.length){let _=new Error(p.join(" "));throw _.code="client_validation_failed",_}}}catch(c){throw console.warn("[AIPKit] Client-side file validation failed",c),c}let s;try{let c=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null;if(c)try{let o=i.get(c);o&&console.debug("[AIPKit] File upload request",{action:a,fileField:c,name:o.name,size_bytes:o.size,type:o.type})}catch{}s=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:i,credentials:"same-origin"})}catch(c){throw console.error("[AIPKit] Network error during file upload",{action:a,error:c}),c}let l;try{l=await s.json()}catch(c){console.error("[AIPKit] Failed to parse JSON response for file upload",{action:a,status:s?.status,parseErr:c});let o=new Error(`Unexpected server response (status ${s?.status||"n/a"})`);throw o.status=s?.status,o}if(!s.ok||!l.success){let c=l?.data||{},o=new Error(c.message||`HTTP error! status: ${s.status}`);throw o.code=c.code,o.status=s.status,o.details=c.details||void 0,o.serverResponse=l,console.error("[AIPKit] File upload failed",{action:a,status:s.status,server:l}),o}return l.data}function e(i){if(!Number.isFinite(i))return`${i}`;let a=["B","KB","MB","GB"],s=0,l=i;for(;l>=1024&&s<a.length-1;)l/=1024,s++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:o=>o.toFixed(1)}).format(l)} ${a[s]}`}window.aipkit_api_upsertOpenAIText=k,window.aipkit_api_upsertFile=n})();(function(){"use strict";function k(n){let e=document.querySelector(n);if(!e)return;e.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(a=>{let s=a.id+"_value",l=null,c=a.closest(".aipkit_slider_wrapper");if(c&&(l=c.querySelector(".aipkit_slider_value")),!l)try{l=e.querySelector(`#${CSS.escape(s)}`)}catch{l=e.querySelector("#"+s)}if(l){let o=a.getAttribute("data-suffix")||(a.id.includes("confidence_threshold")?"%":"");l.textContent=a.value+o,a.hasAttribute("data-range-listener-attached")||(a.addEventListener("input",function(){l.textContent=this.value+o}),a.setAttribute("data-range-listener-attached","true"))}})}window.aipkit_attachRangeValueHandlers=k})();(function(){"use strict";function k(n){let e=document.querySelector(n);if(!e)return;let i="data-apikey-toggle-listener-attached";e.getAttribute(i)||(e.addEventListener("click",function(a){let s=a.target.closest(".aipkit_api-key-toggle");if(!s)return;let l=s.closest(".aipkit_api-key-wrapper");if(!l)return;let c=l.querySelector(".aipkit_form-input"),o=s.querySelector(".dashicons");!c||!o||(c.type==="password"?(c.type="text",o.classList.remove("dashicons-visibility"),o.classList.add("dashicons-hidden")):(c.type="password",o.classList.remove("dashicons-hidden"),o.classList.add("dashicons-visibility")))}),e.setAttribute(i,"true"))}window.aipkit_initApiKeyToggles=k})();(function(){"use strict";function k(n,e,i="Submit",a="Processing..."){if(!n)return;let s=n.querySelector(".aipkit_btn-text")||n.querySelector(".aipkit_btn_text"),l=n.querySelector(".aipkit_spinner"),c=n.querySelector(".dashicons");if(e){if(n.disabled=!0,!n.dataset.originalText)if(s)n.dataset.originalText=s.textContent;else{let t="";n.childNodes.forEach(r=>{r.nodeType===Node.TEXT_NODE&&(t+=r.textContent.trim())}),n.dataset.originalText=t.trim()}c&&(c.dataset.originalDisplay||(c.dataset.originalDisplay=c.style.display||"inline-block"),c.style.display="none");let o=i===""?"":n.dataset.loadingText||a;s?(n.dataset.originalText||(n.dataset.originalText=s.textContent),s.textContent=o):(!c||c.style.display==="none")&&o&&(Array.from(n.childNodes).forEach(t=>{t.nodeType===Node.TEXT_NODE&&t.remove()}),o&&n.insertBefore(document.createTextNode(o),n.firstChild)),l&&(l.style.display="inline-block")}else{n.disabled=!1;let o=i===""?"":n.dataset.originalText||i;c&&c.dataset.originalDisplay&&(c.style.display=c.dataset.originalDisplay,delete c.dataset.originalDisplay),s?s.textContent=o:i!==""&&(Array.from(n.childNodes).forEach(t=>{t.nodeType===Node.TEXT_NODE&&t.remove()}),o&&(c?c.insertAdjacentText("afterend"," "+o):n.insertBefore(document.createTextNode(o),n.firstChild))),l&&(l.style.display="none"),delete n.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=k})();(function(){"use strict";function k(n,e="info",i="aipkit_knowledge_base_global_status"){let a=document.getElementById(i);if(!a)return;a.messageTimeoutId&&clearTimeout(a.messageTimeoutId),a.messageTimeoutId=null;let s=n?String(n).trim():"";if(s===""){a.textContent="",a.className="aipkit_form-help",a.style.display="none",a.style.opacity="0",a.classList.remove("aipkit-active");return}let l=a.classList.contains("aipkit_settings_message-error"),c=e;l&&e!=="error"&&(c="error"),a.className="aipkit_form-help",c==="success"?a.classList.add("aipkit_settings_message-success"):c==="error"?a.classList.add("aipkit_settings_message-error"):a.classList.add("aipkit_settings_message-info"),c==="error"&&a.textContent||l&&e!=="error"&&a.textContent?a.textContent=a.textContent+`
`+s:a.textContent=s,a.style.display="block",a.style.opacity="1",a.classList.add("aipkit-active"),c!=="error"&&(a.messageTimeoutId=setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{a.textContent.includes(s)&&(a.textContent="",a.className="aipkit_form-help",a.style.display="none",a.classList.remove("aipkit-active"))},300)},5e3))}window.aipkit_showOpenAIVectorStatus=k})();(function(){"use strict";async function k(a,s,l,c){let o=document.getElementById("aipkit_nonce"),t=o&&o.value||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||void 0;return await window.aipkit_apiRequest("aipkit_get_chunk_logs_by_batch",{_ajax_nonce:t,provider:a,store_id:s,batch_id:l,page:c,per_page:10})}function n({snippetText:a="",fileId:s="",provider:l="",batchId:c="",storeId:o=""}={}){let t=window.aipkit_escapeHtml||function(d){return d},r=document.createElement("div");r.className="aipkit-snippet-modal-overlay";let f=document.createElement("div");f.className="aipkit-snippet-modal-content";let u=l?`${l} Indexed Snippet`:"Indexed Snippet",p=s?` (${t(s)})`:"",_=!!c&&!!o&&!!l;f.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${u}${p}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        ${_?`
          <div class="aipkit-chunks-list"></div>
          <div class="aipkit-chunks-pagination" style="margin-top:10px; display:flex; justify-content: space-between; align-items:center;">
            <button class="button button-secondary aipkit-chunks-prev">Prev</button>
            <span class="aipkit-chunks-page-info"></span>
            <button class="button button-secondary aipkit-chunks-next">Next</button>
          </div>
        `:`
          <pre class="aipkit-snippet-modal-content-text">${t(a)}</pre>
        `}
      </div>
    `,r.appendChild(f),document.body.appendChild(r);function m(){r.classList.remove("active"),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},300)}f.querySelector(".aipkit-snippet-modal-close").addEventListener("click",m),r.addEventListener("click",d=>{d.target===r&&m()});function g(d){d.key==="Escape"&&(m(),document.removeEventListener("keydown",g))}if(document.addEventListener("keydown",g),requestAnimationFrame(()=>{r.classList.add("active")}),_){let d=f.querySelector(".aipkit-chunks-list"),w=f.querySelector(".aipkit-chunks-page-info"),h=f.querySelector(".aipkit-chunks-prev"),b=f.querySelector(".aipkit-chunks-next"),A=1,S=1,I=x=>{if(!x||!x.length){d.innerHTML="<p>No chunks found.</p>";return}d.innerHTML=x.map(E=>{let v=E.indexed_content||"",y=E.file_id||"";return`<div class="aipkit-chunk-item" style="margin-bottom:12px;">
            <div class="aipkit-chunk-title" style="font-weight:600; margin-bottom:6px;">${t(y)}</div>
            <pre class="aipkit-chunk-text">${t(v)}</pre>
          </div>`}).join("")};async function T(x){d.innerHTML='<p><span class="aipkit_spinner" style="display:inline-block;"></span> Loading...</p>';try{let E=await k(l,o,c,x);I(E.chunks||[]),A=E.pagination?.current_page||x,S=E.pagination?.total_pages||1,w.textContent=`Page ${A} / ${S}`,h.disabled=A<=1,b.disabled=A>=S}catch(E){d.innerHTML=`<p class="aipkit_text-danger">${E&&E.message||"Failed to load chunks."}</p>`}}h.addEventListener("click",()=>{A>1&&T(A-1)}),b.addEventListener("click",()=>{A<S&&T(A+1)}),T(1)}}function e(a,s,l=""){return n({snippetText:a,fileId:s,provider:l})}function i(a,s=""){a&&a.querySelectorAll(".aipkit_view_snippet_icon").forEach(l=>{let c=l.cloneNode(!0);l.parentNode.replaceChild(c,l),c.addEventListener("click",o=>{o.preventDefault();let t=c.dataset.snippet,r=c.dataset.fileId,f=c.dataset.batchId||"",u=c.dataset.storeId||"";n({snippetText:t,fileId:r,provider:s,batchId:f,storeId:u})})})}window.aipkit_showSnippetModal=e,window.aipkit_showSnippetModalEnhanced=n,window.aipkit_attachSnippetModalListeners=i})();(function(){"use strict";function k(n,e,i){if(!n||!e||typeof i!="function"){e&&(e.innerHTML="");return}e.innerHTML="";let{total_logs:a,total_pages:s,current_page:l}=n,c=parseInt(l,10);if(!a||a<=0||!s||s<=1)return;let o=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,t=wp.i18n&&wp.i18n._n?wp.i18n._n:(m,g,d)=>d>1?g:m,r=document.createElement("span");r.className="aipkit_pagination-count",r.textContent=`${a.toLocaleString()} ${t("item","items",a)}`,e.appendChild(r);let f=document.createElement("span");f.className="aipkit_pagination-links";let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML="&laquo; "+o("Previous","gpt3-ai-content-generator"),u.disabled=c<=1,u.disabled||u.addEventListener("click",m=>{m.preventDefault(),i(c-1)}),f.appendChild(u);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${o("Page","gpt3-ai-content-generator")} ${c} ${o("of","gpt3-ai-content-generator")} ${s}`,f.appendChild(p);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=o("Next","gpt3-ai-content-generator")+" &raquo;",_.disabled=c>=s,_.disabled||_.addEventListener("click",m=>{m.preventDefault(),i(c+1)}),f.appendChild(_),e.appendChild(f)}window.aipkit_renderLogsPagination=k})();(function(){"use strict";function k(n){let e=document.querySelector(n);if(!e)return;let i="data-restore-icon-listener-attached";e.getAttribute(i)||(e.addEventListener("click",function(a){let s=a.target.closest(".aipkit_restore-default-icon");if(!s)return;let l=s.getAttribute("data-target-input"),c=s.getAttribute("data-default-value");if(!l||c===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",s);return}let o=document.getElementById(l);if(o){if(o.value!==c){o.value=c;let r=new Event("change",{bubbles:!0,cancelable:!0}),f=new Event("blur",{bubbles:!0,cancelable:!0});if(o.dispatchEvent(r),o.dispatchEvent(f),o.type==="range"){let u=document.getElementById(`${l}_value`);u&&(u.textContent=c)}}}else console.warn(`AIPKit Restore Default: Target input element #${l} not found.`)}),e.setAttribute(i,"true"))}window.aipkit_initRestoreDefaultIcons=k})();(function(){"use strict";let k="aipkit_settings_global_messages",n=new Set(["aipkit_settings_messages","aipkit_settings_others_messages"]),e=new Set([k,"aipkit_settings_messages","aipkit_settings_others_messages"]);function i(o){return o?n.has(o)&&document.getElementById(k)?k:o:""}function a(o){!o||!o.parentNode||o.classList.contains("aipkit_message_fadeout")||(o.classList.add("aipkit_message_fadeout"),o.addEventListener("animationend",()=>{o.parentNode&&o.parentNode.removeChild(o)},{once:!0}),setTimeout(()=>{o&&o.parentNode&&o.parentNode.removeChild(o)},500))}function s(o,t,r){let f=i(o),u=document.getElementById(f);if(!u){console.error(`AIPKit Message Handler: Container #${f} not found.`);return}let p=e.has(f);u.querySelectorAll(".aipkit_settings_message").forEach(w=>{w.dataset.timerId&&clearTimeout(parseInt(w.dataset.timerId,10)),w.remove()});let m=u.querySelector(".aipkit_saving-indicator");m&&m.remove();let g=document.createElement("div");if(g.className=`aipkit_settings_message aipkit_settings_message-${t}`,p)g.textContent=r;else{let w=t==="success"?"dashicons-yes-alt":t==="error"?"dashicons-warning":"dashicons-info-alt",h=document.createElement("span");h.className=`dashicons ${w}`,h.style.marginRight="5px",g.appendChild(h),g.appendChild(document.createTextNode(` ${r}`));let b=document.createElement("span");b.className="dashicons dashicons-dismiss aipkit_settings_message-close",b.setAttribute("aria-label","Dismiss message"),b.title="Dismiss message",g.appendChild(b)}if(u.appendChild(g),p){if(t!=="error"){let w=setTimeout(()=>{g&&g.parentNode&&g.parentNode.removeChild(g)},3e3);g.dataset.timerId=w}return}let d=setTimeout(()=>{a(g)},5e3);g.dataset.timerId=d}function l(o){let t=i(o);if(e.has(t))return;let r=document.getElementById(t);if(!r){console.error(`AIPKit Message Handler: Container #${t} not found for close button init.`);return}let f=`data-close-listener-${t}`;r.getAttribute(f)!=="true"&&(r.addEventListener("click",function(u){let p=u.target.closest(".aipkit_settings_message-close");if(p){let _=p.closest(".aipkit_settings_message");_&&(_.dataset.timerId&&clearTimeout(parseInt(_.dataset.timerId,10)),a(_))}}),r.setAttribute(f,"true"))}function c(o){let t=i(o),r=document.getElementById(t);if(r){let f=r.querySelector(".aipkit_saving-indicator");f&&f.remove(),r.querySelectorAll(".aipkit_settings_message").forEach(p=>{p.dataset.timerId&&clearTimeout(parseInt(p.dataset.timerId,10)),p.remove()})}else console.warn(`AIPKit Message Handler: Container #${t} not found for clearing messages.`)}window.aipkit_showMessage=s,window.aipkit_initMessageCloseButtons=l,window.aipkit_clearStatusMessages=c})();(function(){"use strict";function k(i,a){let s=document.getElementById(i);if(!s){console.error(`AIPKit Saving Indicator: Container #${i} not found.`);return}let l=s.querySelector(".aipkit_saving-indicator");if(a)if(!l)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(i):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),l=document.createElement("span"),l.className="aipkit_saving-indicator",l.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',s.appendChild(l),requestAnimationFrame(()=>{let c=s.querySelector(".aipkit_saving-indicator");c&&c.classList.add("aipkit_active")});else{l.style.display="inline-flex",l.classList.add("aipkit_active");let c=l.querySelector(".aipkit_spinner");c&&(c.style.display="inline-block")}else l&&(l.classList.remove("aipkit_active"),setTimeout(()=>{l&&l.parentNode&&l.remove()},200))}function n(i){e(i);let a=document.createElement("span");a.className="aipkit-title-spinner aipkit_spinner",a.style.display="inline-block",i.parentNode.insertBefore(a,i.nextSibling)}function e(i){let a=i.parentNode.querySelector(".aipkit-title-spinner");a&&a.remove()}window.aipkit_showSavingIndicator=k,window.aipkit_showLinkSpinner=n,window.aipkit_hideLinkSpinner=e})();(function(){"use strict";function k(i){let a=i.textContent;i.textContent="Copied!",i.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{i&&i.classList.contains("aipkit-placeholder--copied")&&(i.textContent=a,i.classList.remove("aipkit-placeholder--copied"))},1500)}function n(i){let a=i.target;if(!a.matches(".aipkit-placeholder"))return;i.preventDefault(),i.stopPropagation();let s=a.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(s).then(()=>{k(a)}).catch(l=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",l)})}function e(){let i=document.body;if(i){let a="data-placeholder-copy-listener-attached";i.getAttribute(a)||(i.addEventListener("click",n),i.setAttribute(a,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",e)})();(function(){"use strict";let k="select[data-aipkit-provider-notice-target]",n="a[data-aipkit-load-module]";function e(){let g=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return g&&typeof g=="object"?g:{}}function i(g){window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=g}function a(g){return g?String(g).trim().toLowerCase():""}function s(g,d){return!g||!d||!Object.prototype.hasOwnProperty.call(d,g)?null:!!d[g]}function l(g,d){if(!g)return"";let w=d?g.getAttribute(`data-message-${d}`):"";return w||g.getAttribute("data-message-default")||""}function c(g){g&&g.classList.add("aipkit_provider_notice--hidden")}function o(g){g&&g.classList.remove("aipkit_provider_notice--hidden")}function t(g,d){if(!g)return;let w=g.getAttribute("data-aipkit-provider-notice-target");if(!w)return;let h=document.getElementById(w);if(!h)return;if(g.getAttribute("data-aipkit-provider-notice-defer")==="1"&&g.dataset.aipkitProviderNoticeArmed!=="true"){c(h);return}let A=a(g.value);if(!A){c(h);return}let S=s(A,d);if(S===null){c(h);return}if(S){c(h);return}let I=h.querySelector(".aipkit_provider_notice_message");I&&(I.textContent=l(h,A)),o(h)}function r(g){return g?g.offsetParent!==null?!0:g.getClientRects().length>0:!1}function f(g){let d=e(),w=g||document,h=Array.from(w.querySelectorAll(k)),b=new Map;h.forEach(A=>{let S=A.getAttribute("data-aipkit-provider-notice-target");S&&(b.has(S)||b.set(S,[]),b.get(S).push(A))}),b.forEach(A=>{let S=A.find(r)||A[0];S&&t(S,d)})}function u(){let g={...e()},d=!1,w=D=>{let W=document.getElementById(D);if(W)return d=!0,String(W.value||"").trim()},h=w("aipkit_openai_api_key");h!==void 0&&(g.openai=h!=="");let b=w("aipkit_openrouter_api_key");b!==void 0&&(g.openrouter=b!=="");let A=w("aipkit_google_api_key");A!==void 0&&(g.google=A!=="");let S=w("aipkit_azure_api_key"),I=w("aipkit_azure_endpoint");(S!==void 0||I!==void 0)&&(g.azure=(S||"")!==""&&(I||"")!=="");let T=w("aipkit_claude_api_key");T!==void 0&&(g.claude=T!=="");let x=w("aipkit_deepseek_api_key");x!==void 0&&(g.deepseek=x!=="");let E=w("aipkit_ollama_base_url");E!==void 0&&(g.ollama=E!=="");let v=w("aipkit_replicate_api_key"),y=w("aipkit_task_cw_replicate_api_key");(v!==void 0||y!==void 0)&&(g.replicate=(v||"")!==""||(y||"")!=="");let C=w("aipkit_pinecone_api_key");C!==void 0&&(g.pinecone=C!=="");let M=w("aipkit_qdrant_api_key"),B=w("aipkit_qdrant_url");return(M!==void 0||B!==void 0)&&(g.qdrant=(M||"")!==""&&(B||"")!==""),d?(i(g),!0):!1}function p(){["aipkit_openai_api_key","aipkit_openrouter_api_key","aipkit_google_api_key","aipkit_azure_api_key","aipkit_azure_endpoint","aipkit_claude_api_key","aipkit_deepseek_api_key","aipkit_ollama_base_url","aipkit_replicate_api_key","aipkit_task_cw_replicate_api_key","aipkit_pinecone_api_key","aipkit_qdrant_api_key","aipkit_qdrant_url"].forEach(d=>{let w=document.getElementById(d);if(!w||w.dataset.aipkitProviderStatusBound==="true")return;let h=()=>{u()&&f(document)};w.addEventListener("input",h),w.addEventListener("change",h),w.dataset.aipkitProviderStatusBound="true"})}function _(g){(g||document).querySelectorAll(n).forEach(h=>{h.dataset.aipkitProviderNoticeLinkBound!=="true"&&(h.addEventListener("click",b=>{let A=h.getAttribute("data-aipkit-load-module");!A||typeof window.aipkit_loadModule!="function"||(b.preventDefault(),window.aipkit_loadModule(A))}),h.dataset.aipkitProviderNoticeLinkBound="true")})}function m(g){let d=g||document;d.querySelectorAll(k).forEach(h=>{h.dataset.aipkitProviderNoticeBound!=="true"&&(h.addEventListener("change",()=>{h.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(h.dataset.aipkitProviderNoticeArmed="true"),t(h,e())}),h.dataset.aipkitProviderNoticeBound="true")}),u(),f(d),p(),_(d)}window.aipkit_initProviderKeyNotices=m,document.addEventListener("DOMContentLoaded",function(){m(document)})})();(function(){"use strict";let k={list:"aipkit_list_prompt_library",create:"aipkit_create_prompt_library_item",update:"aipkit_update_prompt_library_item",remove:"aipkit_delete_prompt_library_item"},n=null,e=null,i=()=>window.aipkit_dashboard?.ajaxurl||window.aipkit_post_enhancer?.ajaxurl||window.ajaxurl||"",a=()=>window.aipkit_dashboard?.nonce||window.aipkit_post_enhancer?.nonce_prompt_library||"",s=async(u,p={})=>{let _=i(),m=a();if(!_||!m)throw new Error("Prompt library API is not configured.");let g=new URLSearchParams;g.set("action",u),g.set("_ajax_nonce",m),Object.entries(p).forEach(([h,b])=>{b!=null&&g.set(h,String(b))});let d=await fetch(_,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:g.toString(),credentials:"same-origin"}),w;try{w=await d.json()}catch{throw new Error("Prompt library API returned an invalid response.")}if(!d.ok||!w?.success){let h=w?.data?.message||"Prompt library request failed.";throw new Error(h)}return w.data||{}},l=u=>{if(!u||!u.library||!u.types||!n||!n.library||!n.types)return;let p=new Set(n.types);u.types.forEach(_=>{p.has(_)||n.types.push(_),n.library[_]=Array.isArray(u.library[_])?u.library[_]:[],u.counts&&u.counts[_]&&(n.counts=n.counts||{},n.counts[_]=u.counts[_])})},c=(u={})=>{window.dispatchEvent(new CustomEvent("aipkit_prompt_library_updated",{detail:u}))},o=async({force:u=!1}={})=>!u&&n?n:(!u&&e||(e=s(k.list).then(p=>(n=p,p)).finally(()=>{e=null})),e),t=async({promptType:u,label:p,prompt:_})=>{let m=await s(k.create,{prompt_type:u,label:p,prompt:_});return m.type_data?l(m.type_data):n=null,c({action:"create",promptType:u,promptId:m.item?.id||""}),m},r=async({promptId:u,promptType:p,label:_,prompt:m})=>{let g={prompt_id:u,prompt_type:p,label:_,prompt:m},d=await s(k.update,g);return d.type_data?l(d.type_data):n=null,c({action:"update",promptType:p,promptId:u}),d},f=async({promptId:u,promptType:p})=>{let _=await s(k.remove,{prompt_id:u,prompt_type:p});return _.type_data?l(_.type_data):n=null,c({action:"delete",promptType:p,promptId:u}),_};window.aipkit_prompt_library_api={list:o,create:t,update:r,remove:f,clearCache:()=>{n=null},getCache:()=>n}})();(function(){"use strict";let k={meta:"Meta Description",keyword:"Focus Keyword",featured_image:"Featured Image",image_alt_text:"Image Alt Text",image_caption:"Image Caption",image_description:"Image Description",image_title:"Image Title",image_title_update:"Image Title (Update)",image_alt_text_update:"Image Alt Text (Update)",image_caption_update:"Image Caption (Update)",image_description_update:"Image Description (Update)"},n={isOpen:!1,isBusy:!1,library:{},types:[],selectedType:"",selectedPromptId:"",search:"",pendingDraft:null,lastFocusedElement:null},e={modal:null,typeSelect:null,searchInput:null,list:null,emptyState:null,nameInput:null,promptTextarea:null,sourceMeta:null,status:null,newButton:null,createButton:null,updateButton:null,deleteButton:null,closeButton:null},i=y=>String(y||"").replace(/\s+\(Custom\)\s*$/i,"").trim(),a=y=>{let C=String(y||"").trim();return C?k[C]?k[C]:C.split("_").filter(Boolean).map(M=>M.charAt(0).toUpperCase()+M.slice(1)).join(" "):""},s=()=>window.aipkit_prompt_library_api||null,l=y=>!y||!n.library||!Array.isArray(n.library[y])?[]:n.library[y],c=()=>{let y=n.search.trim().toLowerCase(),C=l(n.selectedType);return y?C.filter(M=>{let B=String(M?.label||"").toLowerCase(),D=String(M?.prompt||"").toLowerCase();return B.includes(y)||D.includes(y)}):C},o=()=>!n.selectedType||!n.selectedPromptId?null:l(n.selectedType).find(y=>String(y?.id||"")===n.selectedPromptId)||null,t=(y,C=!1)=>{e.status&&(e.status.textContent=y?String(y):"",e.status.classList.toggle("is-error",!!C))},r=(y=!1)=>{e.nameInput&&(e.nameInput.value=""),e.promptTextarea&&(e.promptTextarea.value=""),y||t("")},f=y=>{y&&(e.nameInput&&(e.nameInput.value=i(y.label||"")),e.promptTextarea&&(e.promptTextarea.value=String(y.prompt||"")))},u=()=>{if(e.typeSelect){if(e.typeSelect.innerHTML="",!n.types.length){let y=document.createElement("option");y.value="",y.textContent="No prompt types",e.typeSelect.appendChild(y),e.typeSelect.disabled=!0;return}n.types.forEach(y=>{let C=document.createElement("option");C.value=y,C.textContent=a(y),e.typeSelect.appendChild(C)}),(!n.selectedType||!n.types.includes(n.selectedType))&&(n.selectedType=n.types[0]),e.typeSelect.disabled=!1,e.typeSelect.value=n.selectedType}},p=()=>{if(!e.list||!e.emptyState)return;let y=c();if(e.list.innerHTML="",!y.length){e.emptyState.textContent=n.search.trim()?"No prompts match your search.":"No prompts available for this type yet.",e.emptyState.hidden=!1;return}e.emptyState.hidden=!0,y.forEach(C=>{let M=String(C?.id||""),B=String(C?.source||(C?.is_builtin?"builtin":"custom")),D=document.createElement("button");D.type="button",D.className="aipkit_prompt_library_entry",M&&M===n.selectedPromptId&&D.classList.add("is-active"),D.dataset.promptId=M,D.dataset.promptType=String(C?.type||n.selectedType||"");let W=document.createElement("span");W.className="aipkit_prompt_library_entry_title",W.textContent=String(C?.label||"Untitled prompt");let U=document.createElement("span");U.className="aipkit_prompt_library_entry_meta",U.textContent=B==="custom"?"Custom":"Built-in",D.appendChild(W),D.appendChild(U),e.list.appendChild(D)})},_=()=>{let y=o(),C=!!n.selectedType,M=String(e.nameInput?.value||"").trim(),B=String(e.promptTextarea?.value||"").trim(),D=M!==""&&B!=="",W=!!y&&String(y?.source||"")==="custom";e.sourceMeta&&(y?e.sourceMeta.textContent=String(y?.source||"")==="custom"?"Editing custom prompt preset":"Built-in prompt preset (read-only source)":C?e.sourceMeta.textContent=`Creating new preset in ${a(n.selectedType)}`:e.sourceMeta.textContent="Prompt type is required."),e.newButton&&(e.newButton.disabled=n.isBusy||!C),e.createButton&&(e.createButton.disabled=n.isBusy||!C||!D),e.updateButton&&(e.updateButton.disabled=n.isBusy||!C||!D||!W),e.deleteButton&&(e.deleteButton.disabled=n.isBusy||!W),e.typeSelect&&(e.typeSelect.disabled=n.isBusy||!n.types.length),e.searchInput&&(e.searchInput.disabled=n.isBusy),e.nameInput&&(e.nameInput.disabled=n.isBusy||!C),e.promptTextarea&&(e.promptTextarea.disabled=n.isBusy||!C)},m=(y,C="")=>{let M=C||n.selectedType,B=String(y||"");if(!M||!B)return!1;let D=l(M).find(W=>String(W?.id||"")===B);return D?(n.selectedType=M,n.selectedPromptId=B,u(),p(),f(D),t(""),_(),!0):!1},g=()=>{let y=l(n.selectedType);if(y.length){let C=String(y[0]?.id||"");if(C){m(C,n.selectedType);return}}n.selectedPromptId="",p(),r(),_()},d=()=>{n.selectedPromptId="",p(),r(!0),t("Ready to create a new preset."),_(),e.nameInput?.focus()},w=y=>{n.isBusy=!!y,e.modal&&e.modal.classList.toggle("is-busy",n.isBusy),_()},h=()=>({promptType:String(n.selectedType||"").trim(),label:String(e.nameInput?.value||"").trim(),promptText:String(e.promptTextarea?.value||"").trim()}),b=async(y=!1)=>{let C=s();if(!C)throw new Error("Prompt library API is not available.");let M=await C.list({force:y});n.library=M?.library&&typeof M.library=="object"?M.library:{},n.types=Array.isArray(M?.types)?M.types.map(B=>String(B||"").trim()).filter(Boolean):Object.keys(n.library),(!n.selectedType||!n.types.includes(n.selectedType))&&(n.selectedType=n.types[0]||""),n.selectedPromptId&&(l(n.selectedType).some(D=>String(D?.id||"")===n.selectedPromptId)||(n.selectedPromptId="")),u(),p(),_()},A=()=>{let y=n.pendingDraft;if(n.pendingDraft=null,t(""),!y){g();return}let C=String(y.action||"manage").trim().toLowerCase(),M=String(y.promptType||"").trim();M&&n.types.includes(M)&&(n.selectedType=M),u(),p();let B=i(y.label||""),D=String(y.promptText||"").trim(),W=String(y.promptId||"").trim();if(W&&m(W,n.selectedType)){B&&e.nameInput&&(e.nameInput.value=B),D&&e.promptTextarea&&(e.promptTextarea.value=D),C==="update"?t("Review fields and click Update Selected."):C==="delete"&&t("Click Delete Selected to remove this preset."),_();return}if(B||D){n.selectedPromptId="",e.nameInput&&(e.nameInput.value=B),e.promptTextarea&&(e.promptTextarea.value=D),p(),t(C==="create"?"Review fields and click Save as New.":C==="update"?"Select a custom preset, then click Update Selected.":"Draft loaded. Save as new to add it to the library."),_();return}g()},S=()=>{!e.modal||!n.isOpen||(e.modal.classList.remove("is-open"),e.modal.setAttribute("aria-hidden","true"),n.isOpen=!1,w(!1),document.body.classList.remove("aipkit_prompt_library_open"),n.lastFocusedElement&&typeof n.lastFocusedElement.focus=="function"&&window.requestAnimationFrame(()=>{n.lastFocusedElement.focus()}))},I=async()=>{let y=s();if(!y){window.alert("Prompt library API is not available.");return}let{promptType:C,label:M,promptText:B}=h();if(!C||!M||!B){t("Prompt type, name, and prompt text are required.",!0);return}w(!0),t("Saving new preset...");try{let D=await y.create({promptType:C,label:M,prompt:B});await b(!0);let W=String(D?.item?.id||""),U=String(D?.item?.type||C);W?m(W,U):g(),t("Prompt preset created.")}catch(D){let W=D&&typeof D.message=="string"&&D.message.trim()?D.message.trim():"Could not create the prompt preset.";t(W,!0)}finally{w(!1)}},T=async()=>{let y=s();if(!y){window.alert("Prompt library API is not available.");return}let C=o();if(!C||String(C?.source||"")!=="custom"){t("Select a custom preset to update.",!0);return}let{promptType:M,label:B,promptText:D}=h();if(!M||!B||!D){t("Prompt type, name, and prompt text are required.",!0);return}w(!0),t("Updating preset...");try{await y.update({promptId:String(C.id||""),promptType:M,label:B,prompt:D}),await b(!0),m(String(C.id||""),M),t("Prompt preset updated.")}catch(W){let U=W&&typeof W.message=="string"&&W.message.trim()?W.message.trim():"Could not update the prompt preset.";t(U,!0)}finally{w(!1)}},x=async()=>{let y=s();if(!y){window.alert("Prompt library API is not available.");return}let C=o();if(!C||String(C?.source||"")!=="custom"){t("Select a custom preset to delete.",!0);return}if(!window.confirm("Delete the selected custom preset?"))return;let B=String(C.id||""),D=String(n.selectedType||"");w(!0),t("Deleting preset...");try{await y.remove({promptId:B,promptType:D}),n.selectedPromptId="",await b(!0),g(),t("Prompt preset deleted.")}catch(W){let U=W&&typeof W.message=="string"&&W.message.trim()?W.message.trim():"Could not delete the prompt preset.";t(U,!0)}finally{w(!1)}},E=()=>{if(e.modal)return;let y=document.getElementById("aipkit_prompt_library_modal");if(y)e.modal=y;else{let C=document.createElement("div");C.id="aipkit_prompt_library_modal",C.className="aipkit_prompt_library_modal",C.setAttribute("aria-hidden","true"),C.innerHTML=`
        <div class="aipkit_prompt_library_backdrop" data-aipkit-close-prompt-library="true"></div>
        <div class="aipkit_prompt_library_panel" role="dialog" aria-modal="true" aria-labelledby="aipkit_prompt_library_title">
          <div class="aipkit_prompt_library_header">
            <h2 id="aipkit_prompt_library_title">Prompt Library</h2>
            <button type="button" class="aipkit_prompt_library_close" aria-label="Close prompt library">&times;</button>
          </div>
          <div class="aipkit_prompt_library_toolbar">
            <label class="aipkit_prompt_library_field">
              <span>Type</span>
              <select class="aipkit_prompt_library_type_select"></select>
            </label>
            <label class="aipkit_prompt_library_field aipkit_prompt_library_field--grow">
              <span>Search</span>
              <input type="search" class="aipkit_prompt_library_search" placeholder="Find a prompt by name or text">
            </label>
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_prompt_library_new_btn">New</button>
          </div>
          <div class="aipkit_prompt_library_content">
            <div class="aipkit_prompt_library_list_wrap">
              <div class="aipkit_prompt_library_list" role="list"></div>
              <p class="aipkit_prompt_library_empty"></p>
            </div>
            <div class="aipkit_prompt_library_editor">
              <label class="aipkit_prompt_library_field">
                <span>Name</span>
                <input type="text" class="aipkit_prompt_library_name" maxlength="180" placeholder="Prompt name">
              </label>
              <label class="aipkit_prompt_library_field aipkit_prompt_library_field--grow">
                <span>Prompt</span>
                <textarea class="aipkit_prompt_library_prompt" rows="12" placeholder="Write your prompt"></textarea>
              </label>
              <div class="aipkit_prompt_library_source_meta"></div>
              <div class="aipkit_prompt_library_status" role="status" aria-live="polite"></div>
            </div>
          </div>
          <div class="aipkit_prompt_library_footer">
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_prompt_library_create_btn">Save as New</button>
            <button type="button" class="aipkit_btn aipkit_btn-ghost aipkit_btn-small aipkit_prompt_library_update_btn">Update Selected</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_prompt_library_delete_btn">Delete Selected</button>
          </div>
        </div>
      `,document.body.appendChild(C),e.modal=C}e.typeSelect=e.modal.querySelector(".aipkit_prompt_library_type_select"),e.searchInput=e.modal.querySelector(".aipkit_prompt_library_search"),e.list=e.modal.querySelector(".aipkit_prompt_library_list"),e.emptyState=e.modal.querySelector(".aipkit_prompt_library_empty"),e.nameInput=e.modal.querySelector(".aipkit_prompt_library_name"),e.promptTextarea=e.modal.querySelector(".aipkit_prompt_library_prompt"),e.sourceMeta=e.modal.querySelector(".aipkit_prompt_library_source_meta"),e.status=e.modal.querySelector(".aipkit_prompt_library_status"),e.newButton=e.modal.querySelector(".aipkit_prompt_library_new_btn"),e.createButton=e.modal.querySelector(".aipkit_prompt_library_create_btn"),e.updateButton=e.modal.querySelector(".aipkit_prompt_library_update_btn"),e.deleteButton=e.modal.querySelector(".aipkit_prompt_library_delete_btn"),e.closeButton=e.modal.querySelector(".aipkit_prompt_library_close"),e.typeSelect?.addEventListener("change",()=>{n.selectedType=String(e.typeSelect.value||""),n.selectedPromptId="",p(),r(),_()}),e.searchInput?.addEventListener("input",()=>{n.search=String(e.searchInput.value||""),p()}),e.list?.addEventListener("click",C=>{let M=C.target.closest(".aipkit_prompt_library_entry");if(!M)return;let B=String(M.dataset.promptId||""),D=String(M.dataset.promptType||n.selectedType||"");m(B,D)}),e.newButton?.addEventListener("click",()=>{d()}),e.nameInput?.addEventListener("input",()=>{t(""),_()}),e.promptTextarea?.addEventListener("input",()=>{t(""),_()}),e.createButton?.addEventListener("click",()=>{I()}),e.updateButton?.addEventListener("click",()=>{T()}),e.deleteButton?.addEventListener("click",()=>{x()}),e.closeButton?.addEventListener("click",C=>{C.preventDefault(),S()}),e.modal.querySelector('[data-aipkit-close-prompt-library="true"]')?.addEventListener("click",()=>{S()}),e.modal.addEventListener("click",C=>{C.target===e.modal&&S()}),document.body.dataset.aipkitPromptLibraryEscapeAttached!=="true"&&(document.addEventListener("keydown",C=>{C.key==="Escape"&&n.isOpen&&S()}),document.body.dataset.aipkitPromptLibraryEscapeAttached="true")},v=async(y={})=>{if(!s()){window.alert("Prompt library API is not available on this page.");return}E(),n.pendingDraft={action:String(y.action||"manage").trim().toLowerCase(),promptType:String(y.promptType||"").trim(),promptId:String(y.promptId||"").trim(),label:i(String(y.label||"")),promptText:String(y.promptText||"")},n.search="",n.selectedPromptId="",e.searchInput&&(e.searchInput.value=""),n.lastFocusedElement=document.activeElement,e.modal.classList.add("is-open"),e.modal.setAttribute("aria-hidden","false"),n.isOpen=!0,document.body.classList.add("aipkit_prompt_library_open"),w(!0),t("Loading prompt library...");try{await b(!0),A(),e.nameInput&&!e.nameInput.value&&e.searchInput?e.searchInput.focus():e.nameInput?.focus()}catch(M){let B=M&&typeof M.message=="string"&&M.message.trim()?M.message.trim():"Could not load the prompt library.";t(B,!0)}finally{w(!1)}};window.aipkit_openPromptLibraryManager=v,document.body&&document.body.dataset.aipkitPromptLibraryTriggerAttached!=="true"&&(document.addEventListener("click",y=>{let C=y.target.closest("[data-aipkit-open-prompt-library]");C&&(y.preventDefault(),v({action:C.getAttribute("data-aipkit-prompt-action")||"manage",promptType:C.getAttribute("data-aipkit-prompt-type")||"",label:C.getAttribute("data-aipkit-prompt-label")||"",promptText:C.getAttribute("data-aipkit-prompt-value")||""}))}),document.body.dataset.aipkitPromptLibraryTriggerAttached="true"),window.addEventListener("aipkit_prompt_library_updated",y=>{if(!n.isOpen)return;let C=y?.detail||{},M=String(C?.action||"")?`Prompt library updated (${C.action}).`:"Prompt library updated.";t(M),b(!0).then(()=>{n.selectedPromptId?m(n.selectedPromptId,n.selectedType):(p(),_())}).catch(()=>{t("Prompt library changed, but refresh failed.",!0)})})})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelectorAll("[data-aipkit-popover-target]");if(!e.length)return;let i=null,a=null,s=!1,l=f=>f?n.querySelector(`#${f}`):null,c=(f,u)=>{if(!f||!u)return;let p=f.getBoundingClientRect(),_=u.getBoundingClientRect(),m=_.width||400,g=_.height||0,d=window.innerWidth,w=window.innerHeight,h=12;if(f.dataset.aipkitPopoverPlacement==="bottom"){let S=p.left;S+m>d-h&&(S=p.right-m),S=Math.max(h,Math.min(S,d-m-h));let I=p.bottom+8;I+g>w-h&&(I=p.top-g-8),I=Math.max(h,Math.min(I,w-g-h)),u.style.left=`${Math.round(S)}px`,u.style.top=`${Math.round(I)}px`;return}if(f.dataset.aipkitPopoverPlacement==="left"){let S=p.left-m-10;S<h&&(S=p.right+10),S=Math.max(h,Math.min(S,d-m-h));let I=p.top;I+g>w-h&&(I=w-g-h),I=Math.max(h,I),u.style.left=`${Math.round(S)}px`,u.style.top=`${Math.round(I)}px`;return}let b=p.right+10;b+m>d-h&&(b=p.right-m-10),b=Math.max(h,Math.min(b,d-m-h));let A=p.top;A+g>w-h&&(A=w-g-h),A=Math.max(h,A),u.style.left=`${Math.round(b)}px`,u.style.top=`${Math.round(A)}px`},o=()=>{!a||!i||s||(s=!0,window.requestAnimationFrame(()=>{let f=i.querySelector(".aipkit_model_settings_popover_panel");c(a,f),s=!1}))},t=()=>{if(!i)return;let f=i.id;i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),f==="aipkit_cw_template_picker_popover"&&typeof window.aipkit_resetTemplateActionsPanel=="function"&&window.aipkit_resetTemplateActionsPanel(),i=null,a=null},r=f=>{if(!f)return;let u=f.getAttribute("data-aipkit-popover-target"),p=l(u);if(!p)return;i&&i!==p&&t(),i=p,a=f,p.classList.add("aipkit-active"),p.setAttribute("aria-hidden","false"),f.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${u}`);let _=p.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{c(f,_)})};e.forEach(f=>{f.dataset.popoverListenerAttached!=="true"&&(f.addEventListener("click",u=>{if(u.preventDefault(),!(f.dataset.aipkitPopoverKeepOpen==="true")&&i&&a===f&&i.classList.contains("aipkit-active")){t();return}r(f)}),f.dataset.popoverListenerAttached="true")}),n.querySelectorAll(".aipkit_model_settings_popover").forEach(f=>{f.dataset.overlayListenerAttached!=="true"&&(f.addEventListener("click",p=>{p.target===f&&t()}),f.dataset.overlayListenerAttached="true");let u=f.querySelector(".aipkit_model_settings_popover_close");u&&u.dataset.popoverListenerAttached!=="true"&&(u.addEventListener("click",p=>{p.preventDefault(),t()}),u.dataset.popoverListenerAttached="true"),f.querySelectorAll("[data-aipkit-popover-close]").forEach(p=>{p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",_=>{_.preventDefault(),t()}),p.dataset.popoverListenerAttached="true")})}),n.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",f=>{f.key==="Escape"&&i&&t()}),n.dataset.escapeListenerAttached="true"),n.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",o),window.addEventListener("scroll",o,!0),n.dataset.repositionListenersAttached="true")}window.aipkit_initContentWriterPopovers=k})();(function(){"use strict";let k=a=>{if(!a)return null;let s=a.querySelector("#aipkit_enhancer_editor_integration"),l=a.querySelector("#aipkit_enhancer_list_button"),c=a.querySelector('input[name="enhancer_insert_position_default"]:checked');return!s||!l||!c?null:{enhancer_editor_integration:s.checked?"1":"0",enhancer_list_button:l.checked?"1":"0",enhancer_insert_position_default:c.value||"replace"}},n=a=>a?JSON.stringify(a):"",e=async a=>{if(!a||typeof window.aipkit_apiRequest!="function")return;let s=k(a);if(!s)return;let l=a.dataset.assistantAutosaveBaseline||"",c=n(s);if(!c||c===l||a.dataset.assistantAutosaveBusy==="true")return;let o=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,t=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,r=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;a.dataset.assistantAutosaveBusy="true",o&&o("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",s),a.dataset.assistantAutosaveBaseline=c,t&&t("Updated")}catch(f){r&&r(`Error: ${f.message||"Failed to save."}`),console.error("Content Writer Assistant Settings Save Error:",f)}finally{a.dataset.assistantAutosaveBusy="false"}};function i(a){let s=a||document.getElementById("aipkit_content_writer_container"),l=document.getElementById("aipkit_cw_builder_sheet");if(!s||!l)return;let c=l.querySelector(".aipkit_builder_sheet_title"),o=l.querySelector(".aipkit_builder_sheet_description"),t=l.querySelectorAll(".aipkit_builder_sheet_section"),r=l.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'),f=l.querySelector(".aipkit_builder_sheet_close"),u=_=>{if(!_)return;let m=_.getAttribute("data-sheet-title")||"Sheet",g=_.getAttribute("data-sheet-description")||"",d=_.getAttribute("data-sheet-content")||"placeholder";c&&(c.textContent=m),o&&(o.textContent=g);let w=!1;if(t.forEach(h=>{h.dataset.sheet===d?(h.hidden=!1,w=!0):h.hidden=!0}),!w&&r&&(r.hidden=!1),l.classList.add("aipkit-active"),l.setAttribute("aria-hidden","false"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_cw_builder_sheet"),d==="assistant"&&(typeof window.aipkit_initMessageCloseButtons=="function"&&window.aipkit_initMessageCloseButtons("aipkit_content_writer_messages"),typeof window.aipkit_initEnhancerActionsUI=="function"&&window.aipkit_initEnhancerActionsUI(),!l.dataset.assistantAutosaveBound)){let h=k(l);l.dataset.assistantAutosaveBaseline=n(h),l.addEventListener("change",b=>{let A=b.target;!A||!A.matches("#aipkit_enhancer_editor_integration")&&!A.matches("#aipkit_enhancer_list_button")&&!A.matches('input[name="enhancer_insert_position_default"]')||e(l)}),l.dataset.assistantAutosaveBound="true"}f&&f.focus()},p=()=>{l.classList.remove("aipkit-active"),l.setAttribute("aria-hidden","true")};s.dataset.assistantSheetBound||(s.addEventListener("click",_=>{let m=_.target.closest(".aipkit_builder_sheet_trigger");m&&(_.preventDefault(),u(m))}),s.dataset.assistantSheetBound="true"),f&&f.dataset.assistantSheetBound!=="true"&&(f.addEventListener("click",p),f.dataset.assistantSheetBound="true"),l.dataset.assistantSheetBound||(l.addEventListener("click",_=>{_.target===l&&p()}),document.addEventListener("keydown",_=>{_.key==="Escape"&&l.classList.contains("aipkit-active")&&p()}),l.dataset.assistantSheetBound="true")}window.aipkit_initContentWriterAssistantSheet=i})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],n=t=>{let r=k.findIndex(f=>f.key===t);return r===-1?1:r},e=(t,r)=>{let f=Number(t);if(!f||Number.isNaN(f))return"medium";let u="medium",p=1/0;return Object.keys(r).forEach(_=>{let m=Math.abs(f-r[_]);m<p&&(p=m,u=_)}),u},i=(t,r)=>{if(!t)return;let f=t.querySelector(".aipkit_ai_behavior_value"),u=t.querySelector(".aipkit_ai_behavior_hint"),p=t.querySelector(".aipkit_ai_length_slider"),_=k[n(r)];f&&(f.textContent=_.label),u&&(u.textContent=`Approx. ${_.words} words`),p&&(p.value=String(n(r)+1))},a=t=>{let r=t.querySelector(".aipkit_ai_temperature_control");if(!r)return;let f=r.querySelector(".aipkit_ai_temperature_slider"),u=r.querySelector(".aipkit_ai_behavior_value");if(!f||!u||f.dataset.enhancedListenerAttached==="true")return;let p=()=>{u.textContent=f.value};f.addEventListener("input",p),p(),f.dataset.enhancedListenerAttached="true"},s=t=>{let r=t.querySelectorAll(".aipkit_ai_reasoning_input"),f=t.querySelector("[data-aipkit-reasoning-select]");if(!r.length||!f||f.dataset.reasoningSyncAttached==="true")return;let u=_=>_==="minimal"?"low":_,p=_=>{let m=u(_);t.querySelectorAll(".aipkit_ai_reasoning_option").forEach(d=>d.classList.remove("aipkit_ai_reasoning_option--selected"));let g=t.querySelector(`.aipkit_ai_reasoning_input[value="${m}"]`);if(g){g.checked=!0;let d=g.closest(".aipkit_ai_reasoning_option");d&&d.classList.add("aipkit_ai_reasoning_option--selected")}};r.forEach(_=>{_.dataset.reasoningListenerAttached!=="true"&&(_.addEventListener("change",()=>{_.checked&&(f.value=u(_.value),f.dispatchEvent(new Event("change",{bubbles:!0})),p(_.value))}),_.dataset.reasoningListenerAttached="true")}),f.addEventListener("change",()=>{p(f.value||"medium")}),p(f.value||"medium"),f.dataset.reasoningSyncAttached="true"},l=t=>{let r=t.querySelector(".aipkit_ai_length_control");if(!r)return;let f=r.querySelector(".aipkit_ai_length_slider"),u=r.querySelector("[data-aipkit-length-input]");if(!f||!u||f.dataset.lengthListenerAttached==="true")return;let p=r.dataset.aipkitLengthMode||"content_length",_={short:Number(r.dataset.aipkitLengthShort||2e3),medium:Number(r.dataset.aipkitLengthMedium||4e3),long:Number(r.dataset.aipkitLengthLong||6e3)},m=(d,w)=>{let h=k.some(b=>b.key===d)?d:"medium";if(i(r,h),p==="content_length")u.value!==h&&(u.value=h);else{let b=_[h]||_.medium;Number(u.value)!==b&&(u.value=String(b))}w&&u.dispatchEvent(new Event("change",{bubbles:!0}))},g=()=>{if(p==="content_length"){m(u.value||"medium",!1);return}let d=e(u.value,_);m(d,!1)};f.addEventListener("input",()=>{let d=Math.max(1,Math.min(3,Number(f.value||2)))-1,w=k[d]?.key||"medium";m(w,!0)}),u.addEventListener("change",g),g(),f.dataset.lengthListenerAttached="true"},c=t=>{!t||t.dataset.aiSettingsInit==="true"||(a(t),l(t),s(t),t.dataset.aiSettingsInit="true")};function o(t){let r=t||document.getElementById("aipkit_autogpt_container");r&&r.querySelectorAll(".aipkit_ai_settings_redesigned").forEach(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>o()):o(),window.aipkit_initAutogptAiSettingsRedesigned=o})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function k(e){if(typeof e!="string"||!e)return[];let i=new Set;return e==="aipkit_save_ai_settings"&&["settings","dashboard-home","chatbot","sources","content-writer","autogpt","ai-forms","image-generator"].forEach(a=>i.add(a)),(e==="aipkit_save_chatbot_settings"||/^aipkit_update_chatbot_/.test(e)||/^aipkit_(create|delete|duplicate|reset|rename)_chatbot$/.test(e))&&(i.add("chatbot"),i.add("dashboard-home")),/^aipkit_(save|duplicate|delete|delete_all)_ai_forms?$/.test(e)&&(i.add("ai-forms"),i.add("dashboard-home")),(/^aipkit_(save|delete)_automated_task$/.test(e)||/^aipkit_update_automated_task_/.test(e))&&(i.add("autogpt"),i.add("dashboard-home")),(/^aipkit_(save|delete)_cw_template$/.test(e)||e==="aipkit_reset_cw_starter_templates")&&(i.add("content-writer"),i.add("dashboard-home")),Array.from(i)}function n(e,i={},a={}){return new Promise((s,l)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return l(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let c=new FormData;c.append("action",e),!Object.prototype.hasOwnProperty.call(i,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&c.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let r in i)Object.prototype.hasOwnProperty.call(i,r)&&(Array.isArray(i[r])?i[r].forEach(f=>{c.append(r+"[]",f)}):c.append(r,i[r]));let o=new AbortController,t=setTimeout(()=>{o.abort()},a.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:c,credentials:"same-origin",signal:o.signal}).then(r=>(clearTimeout(t),r.json())).then(r=>{if(r.success)typeof window.aipkit_invalidateModuleCache=="function"&&k(e).forEach(u=>{window.aipkit_invalidateModuleCache(u)}),s(r.data);else{let f=r.data||{},u=f.message||"Unknown error",p=new Error(u);f.debug_error&&(p.debug=f.debug_error),p.data=f,f.code&&(p.code=f.code),f.details&&(p.details=f.details),l(p)}}).catch(r=>{clearTimeout(t),r.name==="AbortError"?l(new Error("Request timeout")):l(r)})})}window.aipkit_apiRequest=n})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_modulesMenu");if(n){let i=n.querySelector(".aipkit_dropdown-panel"),a=n.querySelector(".aipkit_menu-trigger");a&&a.addEventListener("click",function(s){s.stopPropagation(),n.classList.toggle("aipkit_show-menu")}),i&&i.addEventListener("click",function(s){s.stopPropagation()})}document.addEventListener("click",function(i){n&&n.classList.contains("aipkit_show-menu")&&(n.contains(i.target)||n.classList.remove("aipkit_show-menu"))});let e=document.getElementById("aipkit_modulesMenuMobile");if(e){e.addEventListener("click",function(a){a.stopPropagation(),e.classList.toggle("aipkit_show-menu")});let i=e.querySelector(".aipkit_dropdown-menu");i&&i.addEventListener("click",function(a){a.stopPropagation()})}}window.aipkit_initSettingsMenus=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_upgradeBtn"),a=document.getElementById("aipkit_upgradeModal");!i||!a||(i.addEventListener("click",function(s){s.preventDefault(),n(a)}),a.querySelectorAll("[data-close-modal]").forEach(function(s){s.addEventListener("click",function(l){l.preventDefault(),e(a)})}),document.addEventListener("keydown",function(s){s.key==="Escape"&&a.classList.contains("aipkit_active")&&e(a)}),a.querySelector(".aipkit_modal").addEventListener("click",function(s){s.stopPropagation()}))}function n(i){i.classList.add("aipkit_active"),document.body.classList.add("aipkit_upgrade_modal_open");let a=i.querySelector('button, a, [tabindex]:not([tabindex="-1"])');a&&setTimeout(()=>a.focus(),100)}function e(i){i.classList.remove("aipkit_active"),document.body.classList.remove("aipkit_upgrade_modal_open")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initUpgradeModal=k})();(function(){"use strict";let i=new Map,a=new Map,s=new Map,l=!1,c={"dashboard-home":"aipkit_initDashboardHome",settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",stats:"aipkit_initStats","image-generator":"aipkit_initImageGenerator",sources:"aipkit_initSources","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"},o=".aipkit_chatbot_builder_left",t="aipkit_last_module",r=(S,I)=>{if(!S)return;let T=I==="settings";S.classList.toggle("aipkit_module-container--settings-active",T);let x=S.closest(".aipkit_wrap");x&&x.classList.toggle("aipkit_wrap--settings-active",T)},f=(S,I={})=>{let T=Object.keys(I||{}).sort();if(!T.length)return`${S}::default`;let x={};return T.forEach(E=>{x[E]=I[E]}),`${S}::${JSON.stringify(x)}`},u=S=>s.get(S)||0,p=S=>{let I=u(S)+1;return s.set(S,I),I},_=S=>{if(!i.has(S))return null;let I=i.get(S);return!I||typeof I.html!="string"||Date.now()-(I.timestamp||0)>3e5?(i.delete(S),null):I},m=(S,I,T="",x=null)=>{!S||typeof I!="string"||T&&x!==null&&x!==u(T)||i.set(S,{html:I,timestamp:Date.now()})},g=S=>{if(l||typeof window.aipkit_apiRequest!="function")return;l=!0;let I=Array.from(document.querySelectorAll(".aipkit_module-link")).filter(E=>E&&E.offsetParent!==null).map(E=>String(E.getAttribute("data-module")||"").trim()).filter(E=>E&&E!==S);if(!I.length)return;let T=typeof window.requestIdleCallback=="function"?window.requestIdleCallback.bind(window):E=>setTimeout(E,400),x=(E=0)=>{if(E>=I.length)return;let v=I[E],y={module:v};if(v==="chatbot"){try{let W=localStorage.getItem("aipkit_last_selected_chatbot");W&&(y.force_active_bot_id=W)}catch{}try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(y.layout="next")}catch{}}let C={...y};delete C.module;let M=f(v,C),B=u(v);if(_(M)||a.has(M)){T(()=>x(E+1));return}let D=window.aipkit_apiRequest("aipkit_dashboard_load_module",y).then(W=>{W&&typeof W.html=="string"&&m(M,W.html,v,B)}).catch(()=>{}).finally(()=>{a.delete(M),T(()=>x(E+1))});a.set(M,D)};T(()=>x(0))},d=S=>{S&&(S.style.removeProperty("--aipkit-loader-left"),S.style.removeProperty("--aipkit-loader-top"))},w=(S,I)=>{if(d(S),!S||I!=="chatbot")return;let T=S.querySelector(o);if(!T)return;let x=S.getBoundingClientRect(),E=T.getBoundingClientRect();if(x.width<=0||x.height<=0||E.width<=0||E.height<=0)return;let v=E.left-x.left+E.width/2,y=E.top-x.top+E.height/2,C=Math.max(24,Math.min(x.width-24,v)),M=Math.max(24,Math.min(x.height-24,y));S.style.setProperty("--aipkit-loader-left",`${Math.round(C)}px`),S.style.setProperty("--aipkit-loader-top",`${Math.round(M)}px`)},h=S=>{if(!(!S||S==="dashboard-home"||S==="settings"))try{localStorage.setItem(t,S)}catch{}};async function b(S,I,T){let x={};typeof I=="function"?T=I:typeof I=="object"&&I!==null&&(x={...I});let E=x.aipkit_silent===!0;Object.prototype.hasOwnProperty.call(x,"aipkit_silent")&&delete x.aipkit_silent;let v=x.aipkit_force_refresh===!0;Object.prototype.hasOwnProperty.call(x,"aipkit_force_refresh")&&delete x.aipkit_force_refresh;let y=x.aipkit_bypass_leave_guard===!0;if(Object.prototype.hasOwnProperty.call(x,"aipkit_bypass_leave_guard")&&delete x.aipkit_bypass_leave_guard,!y&&typeof window.aipkit_beforeModuleChange=="function")try{if(await window.aipkit_beforeModuleChange(S)===!1)return typeof T=="function"&&T(new Error("Module switch cancelled.")),Promise.resolve()}catch(re){return console.error("AIPKit Loader: Module leave guard failed.",re),typeof T=="function"&&T(re),Promise.reject(re)}if(S==="chatbot"&&!x.force_active_bot_id&&!x.force_active_tab)try{let re=localStorage.getItem("aipkit_last_selected_chatbot");re&&(x.force_active_bot_id=re)}catch(re){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",re)}if(S==="chatbot"&&!x.layout)try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(x.layout="next")}catch(re){console.warn("AIPKit Loader: Failed to read chatbot layout flag from URL:",re)}document.querySelectorAll(".aipkit_module-link").forEach(re=>re.classList.remove("aipkit_active"));let M=document.querySelector(`.aipkit_module-link[data-module="${S}"]`);M&&M.classList.add("aipkit_active");let B=document.getElementById("aipkit_module-container");if(!B)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof T=="function"&&T(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));r(B,S);let D=B.innerHTML.trim()!=="",W=E||D,U=null,J=0,oe=()=>{let re=B.offsetHeight||0,ve=Math.round(window.innerHeight*.55),Ie=Math.max(re,ve,280);B.style.minHeight=`${Ie}px`},O=()=>{B.style.minHeight=""},L=()=>{requestAnimationFrame(()=>{B.classList.remove("aipkit_module-container--show-feedback"),B.classList.remove("aipkit_module-container--silent-loading"),O(),d(B)})},F=()=>{if(!W)return;if(U&&(clearTimeout(U),U=null),!J){L();return}let ve=220-(Date.now()-J);ve>0?setTimeout(L,ve):L()};if(W&&(w(B,S),B.classList.add("aipkit_module-container--silent-loading"),oe(),U=setTimeout(()=>{U=null,J=Date.now(),B.classList.add("aipkit_module-container--show-feedback")},120)),!W){let re=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",S):`Loading ${S}...`;B.innerHTML=`
                <div class="aipkit_container aipkit_loading-placeholder">
                    <div class="aipkit_container-body">
                        <p style="text-align: center; padding: 30px;">
                            <span class="aipkit_spinner"
                                style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                            </span>
                            ${re}
                        </p>
                    </div>
                </div>
            `}if(typeof window.aipkit_apiRequest!="function"){let re="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${S}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(B,S,re),typeof T=="function"&&T(new Error(re)),F(),Promise.reject(new Error(re))}let N={module:S,...x},R=f(S,x),H=u(S),K=re=>{if(!re||typeof re.html!="string")throw new Error('Missing or invalid "html" in response data');B.innerHTML=re.html,S==="chatbot"&&re.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=re.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let ve=c[S];if(ve&&typeof window[ve]=="function")try{window[ve]()}catch(Ie){let Ee=`Error initializing ${S} module scripts.`;throw new Error(`${Ee} (Details: ${Ie.message})`)}typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(B),h(S)};try{let re=v?null:_(R);if(re)return K({html:re.html}),typeof T=="function"&&T(),F(),g(S),Promise.resolve();let ve=await window.aipkit_apiRequest("aipkit_dashboard_load_module",N);return K(ve),ve&&typeof ve.html=="string"&&m(R,ve.html,S,H),typeof T=="function"&&T(),F(),g(S),Promise.resolve()}catch(re){return re&&re.debug?console.error(`AIPKit Loader: Module loading error for '${S}':`,re.message,`
Server debug:`,re.debug):console.error(`AIPKit Loader: Module loading error for '${S}':`,re),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(B,S,re.message),typeof T=="function"&&T(re),F(),Promise.reject(re)}}let A=S=>{if(!S)return;p(S);let I=`${S}::`;for(let T of Array.from(i.keys()))T.startsWith(I)&&i.delete(T)};window.aipkit_loadModule=b,window.aipkit_invalidateModuleCache=A})();(function(){"use strict";function k(n,e,i){if(!n)return;let a=window.aipkit_dashboard?.text||{},s=a.errorLoadingModuleTitle||"Error Loading Module",l=a.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",c=a.errorDetails||"Details:",o=l.replace("%s",e);n.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${s}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${o}</p>
                    <p><strong>${c}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${i||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_modulesMenu");if(!n)return;let e=n.querySelector(".aipkit_dropdown-panel");e&&(e.addEventListener("change",function(i){let a=i.target;if(a.matches&&a.matches(".aipkit_module-toggle")){let s=e.querySelectorAll(".aipkit_module-toggle");s.forEach(p=>p.disabled=!0),s.forEach(p=>p.disabled=!0);let l=a.getAttribute("data-module"),c=a.getAttribute("data-option-key"),o=a.getAttribute("data-icon"),t=a.getAttribute("data-label"),r=a.checked,f=document.querySelector(`.aipkit_module-link[data-module="${l}"]`);r?f?f.style.display="":console.log(`Module Toggle: Enabling '${l}'. Nav link will appear on refresh if needed.`):f&&(f.style.display="none");let u={moduleKey:c,enabled:r?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),a.checked=!r,f&&(f.style.display=r?"none":""),s.forEach(p=>p.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",u).then(()=>{console.log(`Module Toggle: '${l}' status updated successfully.`)}).catch(p=>{console.error("Error updating module setting:",p.message),alert(`Error updating module setting: ${p.message}`),a.checked=!r,f&&(f.style.display=r?"none":"")}).finally(()=>{s.forEach(p=>p.disabled=!1)})}}),e.addEventListener("click",function(i){let a=i.target.closest(".aipkit_module-item");if(a){let s=a.querySelector(".aipkit_toggle-switch");if(s&&!s.contains(i.target)){let l=a.querySelector(".aipkit_module-toggle");if(l&&!l.disabled){l.checked=!l.checked;let c=new Event("change",{bubbles:!0});l.dispatchEvent(c)}}}}))}window.aipkit_initModuleToggles=k})();(function(){"use strict";function k(){document.querySelectorAll(".aipkit_tabs").forEach(i=>{if(i.dataset.tabGroupListenerAttached==="true")return;let a=i.querySelectorAll(".aipkit_tab"),s=i.nextElementSibling;if(!s||!s.classList.contains("aipkit_tab_content_container")){let l=i.closest(".aipkit_container-body, .aipkit_container"),c=l?l.querySelector(".aipkit_tab_content_container"):null;if(!c)return;let o=c.querySelectorAll(".aipkit_tab-content");n(i,a,o)}else{let l=s.querySelectorAll(".aipkit_tab-content");n(i,a,l)}})}function n(e,i,a){i.forEach(s=>{s.addEventListener("click",function(){i.forEach(o=>o.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),a.forEach(o=>o.classList.remove("aipkit_active"));let l=this.getAttribute("data-tab"),c=Array.from(a).find(o=>o.id===l+"-content");c&&(c.classList.add("aipkit_active"),c.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),e.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=k})();(function(){"use strict";var k="aipkit_last_module";function n(d){return d?document.querySelector('.aipkit_module-tabs_list .aipkit_module-link[data-module="'+d+'"]'):null}function e(d,w){var h=n(d);if(h){if(w){h.hidden=!1,h.removeAttribute("aria-hidden"),h.removeAttribute("tabindex"),h.classList.remove("aipkit_module-tab--is-hidden");return}h.hidden=!0,h.setAttribute("aria-hidden","true"),h.setAttribute("tabindex","-1"),h.classList.add("aipkit_module-tab--is-hidden"),h.classList.remove("aipkit_active")}}function i(d){var w=n(d);return w?!w.hidden&&!w.classList.contains("aipkit_module-tab--is-hidden"):null}function a(d,w){if(!(w||!d||typeof window.aipkit_loadModule!="function")){var h=document.querySelector('.aipkit_module-link.aipkit_active[data-module="'+d+'"]');if(h){var b=n("dashboard-home");b&&!b.hidden&&window.aipkit_loadModule("dashboard-home")}}}function s(d,w,h,b){c(w,b),e(h,b),a(h,b),o(d)}function l(d){d.querySelectorAll(".aipkit_home_toggle_input").forEach(function(w){var h=w.getAttribute("data-module")||"",b=w.closest(".aipkit_home_module_row"),A=i(h);A===null&&(A=!!w.checked),w.checked!==A&&(w.checked=A),c(b,A)}),o(d)}function c(d,w){if(d){d.classList.toggle("is-disabled",!w);var h=d.getAttribute("data-module")||"",b=d.querySelector(".aipkit_home_module_main");b&&(w&&h?(b.setAttribute("data-aipkit-open-module",h),b.setAttribute("tabindex","0"),b.setAttribute("aria-disabled","false")):(b.removeAttribute("data-aipkit-open-module"),b.setAttribute("tabindex","-1"),b.setAttribute("aria-disabled","true")))}}function o(d){var w=d.querySelector("#aipkit_home_continue_btn");if(w){var h="";try{h=localStorage.getItem(k)||""}catch{h=""}if(!h){w.hidden=!0,w.removeAttribute("data-aipkit-open-module");return}var b=d.querySelector('.aipkit_home_module_row[data-module="'+h+'"]');if(!b||b.classList.contains("is-disabled")){w.hidden=!0,w.removeAttribute("data-aipkit-open-module");return}var A=b.getAttribute("data-module-label")||h,S=w.getAttribute("data-label-prefix")||"Continue:";w.textContent=S+" "+A,w.setAttribute("data-aipkit-open-module",h),w.hidden=!1}}function t(d){d.addEventListener("click",function(w){var h=w.target.closest("[data-aipkit-scroll-target]");if(!(!h||!d.contains(h))){var b=h.getAttribute("data-aipkit-scroll-target")||"";if(b){var A=d.querySelector(b);A&&(w.preventDefault(),A.scrollIntoView({behavior:"smooth",block:"start"}))}}})}function r(d){var w=d.querySelector(".aipkit_home_hero"),h=d.querySelector(".aipkit_home_panel--setup");if(!(!w||!h)){var b=window.matchMedia("(max-width: 1180px)").matches;if(b){w.style.minHeight="",w.style.height="";return}var A=Math.ceil(h.getBoundingClientRect().height);A>0&&(w.style.minHeight=A+"px",w.style.height=A+"px")}}function f(d){var w=d.querySelector(".aipkit_home_section--modules"),h=d.querySelector(".aipkit_home_panel--chart");if(!(!w||!h)){var b=window.matchMedia("(max-width: 1180px)").matches;if(b){w.style.minHeight="",w.style.height="";return}var A=Math.ceil(h.getBoundingClientRect().height);A>0&&(w.style.minHeight=A+"px",w.style.height=A+"px")}}function u(d){var w=function(){r(d),f(d)};typeof window.__aipkitHomeHeroHeightResizeHandler=="function"&&window.removeEventListener("resize",window.__aipkitHomeHeroHeightResizeHandler);var h=function(){window.requestAnimationFrame(w)};if(window.__aipkitHomeHeroHeightResizeHandler=h,window.addEventListener("resize",h,{passive:!0}),window.__aipkitHomeHeroHeightObserver&&typeof window.__aipkitHomeHeroHeightObserver.disconnect=="function"&&window.__aipkitHomeHeroHeightObserver.disconnect(),typeof window.ResizeObserver=="function"){var b=d.querySelector(".aipkit_home_panel--setup"),A=d.querySelector(".aipkit_home_panel--chart");if(b||A){var S=new ResizeObserver(function(){w()});b&&S.observe(b),A&&S.observe(A),window.__aipkitHomeHeroHeightObserver=S}}w()}function p(d){d.querySelectorAll(".aipkit_home_module_main").forEach(function(w){w.addEventListener("keydown",function(h){h.key!=="Enter"&&h.key!==" "||(h.preventDefault(),w.getAttribute("aria-disabled")!=="true"&&w.click())})})}function _(d){d.querySelectorAll(".aipkit_home_toggle_input").forEach(function(w){w.addEventListener("change",function(){var h=w.getAttribute("data-option-key"),b=w.getAttribute("data-module"),A=!!w.checked,S=w.closest(".aipkit_home_module_row"),I=S?!S.classList.contains("is-disabled"):!A;if(s(d,S,b,A),!h||typeof window.aipkit_apiRequest!="function"){w.checked=I,s(d,S,b,I);return}typeof window.aipkit_invalidateModuleCache=="function"&&(window.aipkit_invalidateModuleCache(b),window.aipkit_invalidateModuleCache("dashboard-home")),w.disabled=!0,window.aipkit_apiRequest("aipkit_update_module_setting",{moduleKey:h,enabled:A?"1":"0"}).catch(function(){w.checked=I,s(d,S,b,I),typeof window.aipkit_invalidateModuleCache=="function"&&(window.aipkit_invalidateModuleCache(b),window.aipkit_invalidateModuleCache("dashboard-home"))}).finally(function(){w.disabled=!1})})})}function m(){var d=document.getElementById("aipkit_token_usage_chart_container");if(!(!d||typeof window.aipkit_loadTokenUsageChart!="function")){var w=document.getElementById("aipkit_home_chart_period"),h=w&&parseInt(w.value,10)||7;window.aipkit_loadTokenUsageChart(h),w&&w.addEventListener("change",function(){var b=parseInt(w.value,10)||7;window.aipkit_loadTokenUsageChart(b)})}}function g(){var d=document.getElementById("aipkit_dashboard_home");d&&(t(d),u(d),p(d),l(d),_(d),m())}window.aipkit_initDashboardHome=g})();document.addEventListener("DOMContentLoaded",function(){(()=>{document.addEventListener("click",function(a){let s=a.target.closest("[data-aipkit-open-module], .aipkit_module-link[data-module]");if(!s)return;let l=s.getAttribute("data-aipkit-open-module")||s.getAttribute("data-module")||"";if(!(!l||typeof window.aipkit_loadModule!="function")){if(s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true"){a.preventDefault();return}a.preventDefault(),window.aipkit_loadModule(l)}})})(),typeof window.aipkit_initSettingsMenus=="function"&&window.aipkit_initSettingsMenus();let i=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(i)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let a=["dashboard-home","settings","chatbot","content-writer","ai-forms","image-generator","sources"],s=Array.from(document.querySelectorAll(".aipkit_module-link")),l=null;for(let c=0;c<a.length;c++){let o=a[c];if(s.find(r=>r.getAttribute("data-module")===o&&r.offsetParent!==null)){l=o;break}}if(!l){let c=s.find(o=>o.offsetParent!==null);c&&(l=c.getAttribute("data-module"))}if(l)window.aipkit_loadModule(l);else if(s.find(o=>o.getAttribute("data-module")==="dashboard-home"))window.aipkit_loadModule("dashboard-home");else{let o=document.getElementById("aipkit_module-container");o&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(o,"initial","No modules enabled or accessible. Please review module access and settings."):o&&(o.innerHTML='<p style="text-align:center; padding: 30px;">No modules are currently available.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!i){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let a=document.getElementById("aipkit_module-container");a&&(a.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector("#aipkit_sources_settings_popover");if(!e)return;let i=Array.from(e.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||e.dataset.panelsBound==="true")return;let a=e.querySelector(".aipkit_model_settings_popover_title"),s=e.querySelector(".aipkit_model_settings_popover_back"),l=n.querySelector("#aipkit_sources_settings_trigger"),c={root:e.dataset.titleRoot||"Settings",general:e.dataset.titleGeneral||"General","provider-credentials":e.dataset.titleProviderCredentials||"Provider credentials","document-chunking":e.dataset.titleDocumentChunking||"Document chunking"},o=null,t=r=>{let f=r||"root",u=e.querySelector(`[data-aipkit-settings-panel="${f}"]`)||e.querySelector('[data-aipkit-settings-panel="root"]');if(!u)return;let p=u.dataset.aipkitSettingsPanel||"root";p!==o&&(i.forEach(_=>{_.hidden=_!==u}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),o=p,e.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};e.addEventListener("click",r=>{let f=r.target.closest("[data-aipkit-panel-target]");if(!f)return;r.preventDefault();let u=f.dataset.aipkitPanelTarget;t(u)}),s&&s.addEventListener("click",r=>{r.preventDefault(),t("root")}),l&&l.addEventListener("click",()=>{t("root")}),t("root"),e.dataset.panelsBound="true"}window.aipkitSources_initSettingsPopoverPanels=k})();(function(){"use strict";let k=window.wp&&window.wp.i18n?window.wp.i18n:null,n=k&&typeof k.__=="function"?k.__:O=>O,e=k&&typeof k.sprintf=="function"?k.sprintf:(O,...L)=>O.replace(/%s/g,()=>L.shift()),i=k&&typeof k._n=="function"?k._n:(O,L,F)=>F===1?O:L,a=typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml:O=>String(O??""),s=60,l={openai:{singular:n("Vector store","gpt3-ai-content-generator"),plural:n("Vector stores","gpt3-ai-content-generator"),loading:n("Loading vector stores...","gpt3-ai-content-generator"),empty:n("No vector stores found.","gpt3-ai-content-generator")},pinecone:{singular:n("Index","gpt3-ai-content-generator"),plural:n("Indexes","gpt3-ai-content-generator"),loading:n("Loading indexes...","gpt3-ai-content-generator"),empty:n("No indexes found.","gpt3-ai-content-generator")},qdrant:{singular:n("Collection","gpt3-ai-content-generator"),plural:n("Collections","gpt3-ai-content-generator"),loading:n("Loading collections...","gpt3-ai-content-generator"),empty:n("No collections found.","gpt3-ai-content-generator")},default:{singular:n("Index","gpt3-ai-content-generator"),plural:n("Indexes","gpt3-ai-content-generator"),loading:n("Loading indexes...","gpt3-ai-content-generator"),empty:n("No indexes found.","gpt3-ai-content-generator")}},c={openai:{key:"openai",typeLabel:n("Vector stores","gpt3-ai-content-generator"),emptyLabel:n("No vector stores found.","gpt3-ai-content-generator"),loadingLabel:n("Loading vector stores...","gpt3-ai-content-generator"),listAction:"aipkit_list_vector_stores_openai",listKey:"stores",createAction:"aipkit_create_vector_store_openai",createKey:"store",nameLabel:n("Store name","gpt3-ai-content-generator"),namePlaceholder:n("e.g. Product FAQ","gpt3-ai-content-generator"),countSingular:n("store","gpt3-ai-content-generator"),countPlural:n("stores","gpt3-ai-content-generator"),needsDimension:!1},pinecone:{key:"pinecone",typeLabel:n("Indexes","gpt3-ai-content-generator"),emptyLabel:n("No indexes found.","gpt3-ai-content-generator"),loadingLabel:n("Loading indexes...","gpt3-ai-content-generator"),listAction:"aipkit_list_indexes_pinecone",listKey:"indexes",createAction:"aipkit_create_index_pinecone",createKey:"index",nameLabel:n("Index name","gpt3-ai-content-generator"),namePlaceholder:n("e.g. site-content","gpt3-ai-content-generator"),countSingular:n("index","gpt3-ai-content-generator"),countPlural:n("indexes","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536},qdrant:{key:"qdrant",typeLabel:n("Collections","gpt3-ai-content-generator"),emptyLabel:n("No collections found.","gpt3-ai-content-generator"),loadingLabel:n("Loading collections...","gpt3-ai-content-generator"),listAction:"aipkit_list_collections_qdrant",listKey:"collections",createAction:"aipkit_create_collection_qdrant",createKey:"collection",nameLabel:n("Collection name","gpt3-ai-content-generator"),namePlaceholder:n("e.g. docs","gpt3-ai-content-generator"),countSingular:n("collection","gpt3-ai-content-generator"),countPlural:n("collections","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536}},o={openai:"aipkit_vector_store_nonce_openai",pinecone:"aipkit_vector_store_pinecone_nonce_management",qdrant:"aipkit_vector_store_qdrant_nonce_management"},t={openai:{action:"aipkit_delete_vector_store_openai",param:"store_id",label:n("vector store","gpt3-ai-content-generator")},pinecone:{action:"aipkit_delete_index_pinecone",param:"index_name",label:n("index","gpt3-ai-content-generator")},qdrant:{action:"aipkit_delete_collection_qdrant",param:"collection_name",label:n("collection","gpt3-ai-content-generator")}},r="aipkit_sources_filters_v1";function f(){try{let O=window.localStorage.getItem(r);if(!O)return{};let L=JSON.parse(O);return L&&typeof L=="object"?L:{}}catch{return{}}}function u(O){try{window.localStorage.setItem(r,JSON.stringify(O))}catch{}}function p(O){if(!O)return[];try{let L=JSON.parse(O);return Array.isArray(L)?L:[]}catch{return[]}}function _(O,L){return O?O.length>L?`${O.slice(0,L)}...`:O:""}function m(O){return String(O||"").trim().toLowerCase()}function g(O){return c[m(O)]||null}function d(O){return t[m(O)]||null}function w(O){let L=m(O);return l[L]||l.default}function h(){let O=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return O&&typeof O=="object"?O:{}}function b(O){let L=m(O),F=h();return Object.prototype.hasOwnProperty.call(F,L)?!!F[L]:null}function A(O){let L=b(O);return L===!0?{label:n("Connected","gpt3-ai-content-generator"),className:"aipkit_status-success"}:L===!1?{label:n("Needs setup","gpt3-ai-content-generator"),className:"aipkit_status-warning"}:{label:n("Unknown","gpt3-ai-content-generator"),className:"aipkit_status-info"}}function S(O,L){return!L||typeof L!="object"?"":O==="openai"?L.id||L.vector_store_id||"":O==="pinecone"?L.name||L.id||"":O==="qdrant"?L.name||L.id||L.collection_name||"":L.id||L.name||""}function I(O,L){let F=S(O,L);return!L||typeof L!="object"?F||"\u2014":L.name||L.vector_store_name||F||"\u2014"}function T(O){let L=m(O);return L==="openai"?"openaiVectorStores":L==="pinecone"?"pineconeIndexes":L==="qdrant"?"qdrantCollections":""}function x(O,L){let F=T(O);if(!F)return;(!window.aipkit_chat_config||typeof window.aipkit_chat_config!="object")&&(window.aipkit_chat_config={});let N=Array.isArray(L)?L:[];window.aipkit_chat_config[F]=N,typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),window.dispatchEvent(new CustomEvent("aipkit:vector-store-list-updated",{detail:{provider:m(O),stores:N}}))}function E(O){let L=String(O?.message||"").toLowerCase(),F=m(O?.provider||""),N=String(O?.file_id||""),R=!!O?.post_id;if(L.includes("file content submitted for indexing")||L.includes("file content embedded and upserted")||L.includes("original filename:")||L.includes("file uploaded"))return{key:"file",label:n("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if((F==="pinecone"||F==="qdrant")&&N&&(N.includes("pinecone_file_")||N.includes("file_"))&&!N.startsWith("wp_post_")&&!N.startsWith("text_"))return{key:"file",label:n("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if(L.includes("text content submitted for indexing"))return{key:"text",label:n("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(F==="qdrant"&&L.includes("points upserted to qdrant"))return R||L.includes("post id:")?{key:"site",label:n("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"}:{key:"text",label:n("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(F==="pinecone"&&L.includes("vectors upserted")){if(N.startsWith("wp_post_"))return{key:"site",label:n("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(N.startsWith("text_"))return{key:"text",label:n("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(N.includes("pinecone_file_")||N.includes("file_"))return{key:"file",label:n("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"}}if(L.includes("wordpress post content submitted for indexing"))return{key:"site",label:n("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(R)return{key:"site",label:n("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(F==="pinecone"&&N){if(N.startsWith("wp_post_"))return{key:"site",label:n("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(N.startsWith("text_"))return{key:"text",label:n("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"}}return{key:"na",label:n("N/A","gpt3-ai-content-generator"),className:""}}function v(O){let L=O||"";return L==="indexed"||L==="skipped_already_indexed"||L==="success"?{label:n("Trained","gpt3-ai-content-generator"),className:"aipkit_status-success"}:L==="failed"?{label:L.replace(/_/g," "),className:"aipkit_status-warning"}:L?{label:L.replace(/_/g," "),className:"aipkit_status-info"}:{label:"\u2014",className:"aipkit_status-info"}}function y(O){return O.post_title?String(O.post_title):O.post_id?`${n("Post","gpt3-ai-content-generator")} #${O.post_id}`:O.indexed_content?String(O.indexed_content):O.message?String(O.message):O.file_id?String(O.file_id):O.vector_store_name?String(O.vector_store_name):"\u2014"}function C(O){let L=m(O);return L?{openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"}[L]||String(O):"\u2014"}function M(O){let L=m(O);return L&&["openai","pinecone","qdrant"].includes(L)?`aipkit_settings_select_picker_icon--${L}`:""}function B(O){return O.vector_store_name?String(O.vector_store_name):O.vector_store_id?String(O.vector_store_id):"\u2014"}function D(O,L,F){if(!O)return;let N=O.classList.contains("aipkit_training_status");if(O.textContent=L||"",N){O.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),L&&O.classList.add("is-visible"),F&&O.classList.add(`is-${F}`);return}O.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),F==="success"?O.classList.add("aipkit_form-help-success"):F==="error"&&O.classList.add("aipkit_form-help-error")}function W(O,L,F){O&&(O.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${a(F)}</td></tr>`,L&&(L.innerHTML=""))}function U(O,L){if(!O)return;if(!Array.isArray(L)||!L.length){W(O,null,n("No sources found.","gpt3-ai-content-generator"));return}let F=L.map(N=>{let R=E(N),H=v(N.status),K=N.status==="processing"||N.status==="queued",re=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(N.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(N.timestamp):N.timestamp||"\u2014",ve=C(N.provider),Ie=M(N.provider),Ee=Ie?`<span class="aipkit_settings_select_picker_icon ${a(Ie)}" aria-hidden="true"></span>`:"",Z=B(N),pe=_(Z,40),we=ve?`${ve} \xB7 ${Z}`:Z,de=String(y(N)||"\u2014"),ae=_(de,s),ne=N.indexed_content||"",ye=[];return R.key==="site"&&N.post_id&&N.vector_store_id&&N.file_id&&ye.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
              data-provider="${a(N.provider||"")}"
              data-store-id="${a(N.vector_store_id||"")}"
              data-vector-id="${a(N.file_id||"")}"
              data-log-id="${a(N.id||"")}"
              data-post-id="${a(N.post_id||"")}"
              data-embedding-provider="${a(N.embedding_provider||"")}"
              data-embedding-model="${a(N.embedding_model||"")}"
              ${K?'disabled aria-disabled="true"':""}
            >${a(n(K?"Training...":"Retrain","gpt3-ai-content-generator"))}</button>`),R.key==="text"&&ne&&N.vector_store_id&&N.file_id&&ye.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
              data-provider="${a(N.provider||"")}"
              data-store-id="${a(N.vector_store_id||"")}"
              data-vector-id="${a(N.file_id||"")}"
              data-log-id="${a(N.id||"")}"
              data-embedding-provider="${a(N.embedding_provider||"")}"
              data-embedding-model="${a(N.embedding_model||"")}"
              data-content="${a(encodeURIComponent(ne))}"
              ${K?'disabled aria-disabled="true"':""}
            >${a(n(K?"Training...":"Edit","gpt3-ai-content-generator"))}</button>`),ne&&ye.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_view"
              data-snippet="${a(ne)}"
              ${K?'disabled aria-disabled="true"':""}
            >${a(n("View","gpt3-ai-content-generator"))}</button>`),N.file_id&&ye.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
              data-provider="${a(N.provider||"")}"
              data-store-id="${a(N.vector_store_id||"")}"
              data-vector-id="${a(N.file_id||"")}"
              data-log-id="${a(N.id||"")}"
              ${K?'disabled aria-disabled="true"':""}
            >${a(n("Delete","gpt3-ai-content-generator"))}</button>`),`<tr data-log-id="${a(N.id||"")}">
          <td>${a(re)}</td>
          <td title="${a(we)}">
            <span class="aipkit_popover_option_label_group">
              ${Ee}
              <span>${a(pe)}</span>
            </span>
          </td>
          <td><span class="aipkit_content-type-tag ${a(R.className)}">${a(R.label)}</span></td>
          <td title="${a(de)}">${a(ae)}</td>
          <td><span class="aipkit_status-tag ${a(H.className)}">${a(H.label)}</span></td>
          <td class="aipkit_actions_cell">
            <div class="aipkit-table-actions-group">${ye.join("")}</div>
          </td>
        </tr>`}).join("");O.innerHTML=F}function J(O,L,F){if(!L)return;L.innerHTML="";let N=Number(O?.total_logs||0),R=Number(O?.total_pages||0),H=Number(O?.current_page||1);if(!N)return;let K=document.createElement("span");if(K.className="aipkit_pagination-count",K.textContent=`${N.toLocaleString()} ${i("source","sources",N,"gpt3-ai-content-generator")}`,L.appendChild(K),R<=1)return;let re=document.createElement("span");re.className="aipkit_pagination-links";let ve=document.createElement("button");ve.type="button",ve.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",ve.textContent=n("Prev","gpt3-ai-content-generator"),ve.disabled=H<=1,ve.addEventListener("click",()=>F(H-1));let Ie=document.createElement("span");Ie.className="aipkit_pagination-current",Ie.textContent=`${H}/${R}`;let Ee=document.createElement("button");Ee.type="button",Ee.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",Ee.textContent=n("Next","gpt3-ai-content-generator"),Ee.disabled=H>=R,Ee.addEventListener("click",()=>F(H+1)),re.appendChild(ve),re.appendChild(Ie),re.appendChild(Ee),L.appendChild(re)}function oe(){let O=document.getElementById("aipkit_sources_module_container");if(!O)return;let L=document.getElementById("aipkit_sources_table_body"),F=document.getElementById("aipkit_sources_pagination"),N=document.getElementById("aipkit_sources_status"),R=document.getElementById("aipkit_sources_provider_filter"),H=document.getElementById("aipkit_sources_index_filter"),K=document.getElementById("aipkit_sources_status_filter"),re=document.getElementById("aipkit_sources_type_filter"),ve=document.getElementById("aipkit_sources_search_input"),Ie=document.getElementById("aipkit_sources_provider_popover_body"),Ee=document.getElementById("aipkit_sources_settings_trigger"),Z=document.getElementById("aipkit_sources_settings_popover"),pe=document.getElementById("aipkit_sources_indexing_manage"),we=O.querySelector('[data-aipkit-settings-action="indexing-controls"]'),de=pe||we,ae=document.getElementById("aipkit_sources_settings_save"),ne=document.getElementById("aipkit_sources_settings_sheet"),ye=ne?ne.querySelector(".aipkit_builder_sheet_close"):null,Me=document.getElementById("aipkit_save_indexing_settings_btn"),nt=document.getElementById("aipkit_indexing_settings_messages"),se=document.getElementById("aipkit_sources_settings_sheet_messages"),be=document.getElementById("aipkit_sources_semantic_manage"),xe=O.querySelector('[data-aipkit-settings-action="semantic-search"]'),Re=be||xe,De=document.getElementById("aipkit_sources_semantic_sheet"),ze=De?De.querySelector(".aipkit_builder_sheet_close"):null,Ze=document.getElementById("aipkit_sources_semantic_vector_provider"),it=document.getElementById("aipkit_sources_semantic_target_id"),Pt=document.getElementById("aipkit_sources_semantic_target_label"),Mi=document.getElementById("aipkit_sources_semantic_embedding_model"),Qt=document.getElementById("aipkit_sources_semantic_embedding_provider"),ti=document.getElementById("aipkit_sources_semantic_num_results"),wt=document.getElementById("aipkit_sources_semantic_no_results_text"),at=document.getElementById("aipkit_sources_semantic_shortcode_copy"),et=document.getElementById("aipkit_sources_semantic_demo_form"),ei=document.getElementById("aipkit_sources_semantic_demo_input"),li=document.getElementById("aipkit_sources_semantic_demo_results"),Jt=document.getElementById("aipkit_sources_semantic_demo_submit"),Ut=document.getElementById("aipkit_sources_index_empty_action"),Di=document.getElementById("aipkit_sources_index_create_trigger"),xt=document.getElementById("aipkit_sources_editor_modal"),pi=xt?xt.querySelector(".aipkit_sources_editor_textarea"):null,Wt=xt?xt.querySelector(".aipkit_sources_editor_close"):null,Wi=xt?xt.querySelector(".aipkit_sources_editor_cancel"):null,Sn=xt?xt.querySelector(".aipkit_sources_editor_save"):null,Ki=document.getElementById("aipkit_sources_view_modal"),ln=Ki?Ki.querySelector(".aipkit_sources_view_textarea"):null,Vn=Ki?Ki.querySelector(".aipkit_sources_view_close"):null,Se=Ki?Ki.querySelector(".aipkit_sources_view_close_btn"):null,Fe=document.getElementById("aipkit_sources_delete_modal"),Ve=Fe?Fe.querySelector(".aipkit_sources_delete_close"):null,Tt=Fe?Fe.querySelector(".aipkit_sources_delete_cancel"):null,st=Fe?Fe.querySelector(".aipkit_sources_delete_confirm"):null;if(!L||typeof window.aipkit_apiRequest!="function")return;let qt=f(),fi=qt.indexByProvider&&typeof qt.indexByProvider=="object"?{...qt.indexByProvider}:{},Ht=qt.embeddingByProvider&&typeof qt.embeddingByProvider=="object"?{...qt.embeddingByProvider}:{};R&&typeof qt.provider=="string"&&Array.from(R.options).some(te=>te.value===qt.provider)&&(R.value=qt.provider),K&&typeof qt.status=="string"&&Array.from(K.options).some(te=>te.value===qt.status)&&(K.value=qt.status),re&&typeof qt.type=="string"&&Array.from(re.options).some(te=>te.value===qt.type)&&(re.value=qt.type),typeof window.aipkit_initChatSelectPickers=="function"&&window.aipkit_initChatSelectPickers();let hi=null,mi=null,Bi=null,gi=null,ii=null,ji=null,Ue={page:1,perPage:10,provider:R?R.value:"",status:K?K.value:"",type:re?re.value:"",search:ve?ve.value.trim():"",indexByProvider:fi,embeddingByProvider:Ht,openIndexCreateOnOpen:!1},ui={activeProvider:"",stores:{},syncTokens:{}},Hi={nonce:O.dataset.settingsNonce||"",isPro:O.dataset.settingsIsPro==="1"||O.dataset.settingsIsPro==="true"},En={initialized:!1,accordionsBound:!1,saveBound:!1,autosaveBound:!1,originalSettings:{}},Do=null,Ao=!1,Wo=!1,gn={nonce:O.dataset.semanticSearchNonce||"",pineconeIndexes:p(O.dataset.semanticPineconeIndexes),qdrantCollections:p(O.dataset.semanticQdrantCollections)},uo={initialized:!1,autosaveBound:!1,dirty:!1},Ca=null,Ho=!1,ta=!1,Vo={pinecone_api_key:O.dataset.pineconeApiKey||"",qdrant_api_key:O.dataset.qdrantApiKey||"",qdrant_url:O.dataset.qdrantUrl||""},ia=null,Mn=()=>{hi&&window.clearTimeout(hi),hi=window.setTimeout(()=>{D(N,"","")},3e3)},xr=()=>{gi&&window.clearTimeout(gi),gi=window.setTimeout(()=>{D(nt,"","")},3e3)},xa=()=>!H||H.disabled?"":H.value||"",Uo=()=>!H||!H.id?null:document.getElementById(`${H.id}_picker_btn`),Go=z=>{if(!H)return;let te=!z;H.hidden=te;let fe=Uo();fe&&(fe.hidden=te)},na=(z,te={})=>{if(!H)return;H.disabled=z;let fe=Uo();fe&&(te.disableTrigger!==!1?(fe.disabled=z,z?fe.setAttribute("aria-disabled","true"):fe.removeAttribute("aria-disabled")):(fe.disabled=!1,fe.removeAttribute("aria-disabled")))},_o=(z,te)=>{if(!Ut||!Di)return;Ut.hidden=!z;let fe=Uo();if(fe&&(z?fe.hidden=!0:(!H||!H.hidden)&&(fe.hidden=!1)),!z)return;let ue=m(te),Ae=w(ue);Di.textContent=e(n("Create new %s","gpt3-ai-content-generator"),Ae.singular.toLowerCase());let He=b(ue),Oe=!!ue&&He!==!1;Di.disabled=!Oe,Oe?(Di.removeAttribute("aria-disabled"),Di.removeAttribute("title")):(Di.setAttribute("aria-disabled","true"),Di.setAttribute("title",n("Add credentials to create.","gpt3-ai-content-generator")))},oa=z=>{let te=Uo();if(!te||!z)return;let fe=z.getBoundingClientRect(),ue={hidden:te.hidden,style:te.getAttribute("style")||""};te.hidden=!1,te.style.position="fixed",te.style.left=`${Math.round(fe.left)}px`,te.style.top=`${Math.round(fe.top)}px`,te.style.width=`${Math.round(fe.width)}px`,te.style.height=`${Math.round(fe.height)}px`,te.style.opacity="0",te.style.pointerEvents="none",te.click();let Ae=()=>{te.setAttribute("style",ue.style),ue.hidden&&(te.hidden=!0)};window.requestAnimationFrame(()=>{window.requestAnimationFrame(Ae)})},aa=()=>!H||!H.id?null:document.getElementById(`${H.id}_picker_popover`),An=()=>{let z=aa();if(!z)return null;z.classList.add("aipkit_sources_index_picker_popover");let te=z.querySelector(".aipkit_model_settings_popover_body");if(!te)return null;let fe=te.querySelector(".aipkit_sources_index_picker_actions");return fe||(fe=document.createElement("div"),fe.className="aipkit_sources_index_picker_actions",fe.innerHTML=`
          <div class="aipkit_sources_index_action_list">
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_sources_index_new_btn">
              <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
              ${Yt(n("New","gpt3-ai-content-generator"))}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_delete_btn" disabled aria-disabled="true">
              <span class="dashicons dashicons-trash" aria-hidden="true"></span>
              ${Yt(n("Delete","gpt3-ai-content-generator"))}
            </button>
          </div>
          <div class="aipkit_sources_index_inline_form" style="display: none;">
            <div class="aipkit_popover_options_list">
              <div class="aipkit_popover_option_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label aipkit_sources_index_create_label" for="aipkit_sources_index_name_input">
                    ${Yt(n("Create","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="text"
                      id="aipkit_sources_index_name_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--vector-wide aipkit_popover_option_input--framed"
                      placeholder=""
                      data-aipkit-provider-name-input
                    >
                  </div>
                </div>
              </div>
              <div class="aipkit_popover_option_row aipkit_sources_index_dimension_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label" for="aipkit_sources_index_dimension_input">
                    ${Yt(n("Dimension","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="number"
                      id="aipkit_sources_index_dimension_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--compact aipkit_popover_option_input--framed"
                      min="1"
                      placeholder="${Yt(n("e.g. 1536","gpt3-ai-content-generator"))}"
                      data-aipkit-provider-dimension-input
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="aipkit_sources_index_inline_actions">
              <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_create">
                ${Yt(n("Cancel","gpt3-ai-content-generator"))}
              </button>
              <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_sources_index_create_btn">
                ${Yt(n("Create","gpt3-ai-content-generator"))}
              </button>
            </div>
          </div>
          <div class="aipkit_inline_confirm aipkit_sources_index_inline_confirm" style="display: none;">
            <div class="aipkit_inline_confirm_content">
              <p class="aipkit_builder_help_text aipkit_sources_index_delete_confirm_text"></p>
              <div class="aipkit_inline_confirm_actions">
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_confirm_delete">
                  ${Yt(n("Confirm","gpt3-ai-content-generator"))}
                </button>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_delete">
                  ${Yt(n("Cancel","gpt3-ai-content-generator"))}
                </button>
              </div>
            </div>
          </div>
          <p class="aipkit_form-help aipkit_sources_index_status" aria-live="polite" style="display: none;"></p>
        `,te.appendChild(fe)),fe},fo=()=>{let z=An();return z?{footer:z,actionList:z.querySelector(".aipkit_sources_index_action_list"),newButton:z.querySelector(".aipkit_sources_index_new_btn"),deleteButton:z.querySelector(".aipkit_sources_index_delete_btn"),inlineForm:z.querySelector(".aipkit_sources_index_inline_form"),createButton:z.querySelector(".aipkit_sources_index_create_btn"),cancelCreate:z.querySelector(".aipkit_sources_index_cancel_create"),nameInput:z.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:z.querySelector("[data-aipkit-provider-dimension-input]"),dimensionRow:z.querySelector(".aipkit_sources_index_dimension_row"),createLabel:z.querySelector(".aipkit_sources_index_create_label"),deleteConfirm:z.querySelector(".aipkit_sources_index_inline_confirm"),deleteConfirmText:z.querySelector(".aipkit_sources_index_delete_confirm_text"),confirmDelete:z.querySelector(".aipkit_sources_index_confirm_delete"),cancelDelete:z.querySelector(".aipkit_sources_index_cancel_delete"),statusEl:z.querySelector(".aipkit_sources_index_status")}:null},Lo=(z,te)=>{let fe=fo(),ue=N||(fe?fe.statusEl:null);ue&&(D(ue,z,te),fe&&ue===fe.statusEl&&(ue.style.display=z?"block":"none"))},Io=()=>{Bi&&window.clearTimeout(Bi),Bi=window.setTimeout(()=>{Lo("","")},3e3)},Rn=()=>{let z=fo();z&&(z.inlineForm&&(z.inlineForm.style.display="none"),z.deleteConfirm&&(z.deleteConfirm.style.display="none"),z.actionList&&(z.actionList.style.display=""),z.nameInput&&(z.nameInput.value=""),z.dimensionInput&&(z.dimensionInput.value=""),Lo("",""))},Bn=z=>{let te=fo();if(!te)return;let fe=m(z),ue=fe?b(fe):null,Ae=!!fe&&ue!==!1,He=Ae&&!!(H&&H.value);te.nameInput&&(te.nameInput.disabled=!Ae),te.dimensionInput&&(te.dimensionInput.disabled=!Ae),te.newButton&&(te.newButton.disabled=!Ae,Ae?te.newButton.removeAttribute("aria-disabled"):te.newButton.setAttribute("aria-disabled","true")),te.createButton&&(te.createButton.disabled=!Ae,Ae?te.createButton.removeAttribute("aria-disabled"):te.createButton.setAttribute("aria-disabled","true")),te.deleteButton&&(te.deleteButton.disabled=!He,He?te.deleteButton.removeAttribute("aria-disabled"):te.deleteButton.setAttribute("aria-disabled","true"))},Aa=z=>{let te=fo();if(!te||!te.dimensionInput)return;let fe=m(z),ue=g(fe);if(!ue||!ue.needsDimension)return;let Ae=ue.defaultDimension||1536;te.dimensionInput.value||(te.dimensionInput.value=String(Ae))},Fn=z=>{let te=fo();if(!te)return;let fe=m(z),ue=g(fe),Ae=w(fe),He=ue?ue.namePlaceholder:"",Oe=ue?ue.nameLabel:Ae.singular;te.createLabel&&(te.createLabel.textContent=Ae.singular),te.nameInput&&(te.nameInput.placeholder=He,te.nameInput.setAttribute("aria-label",Oe)),te.dimensionRow&&(te.dimensionRow.style.display=ue&&ue.needsDimension?"":"none"),Bn(fe)},zn=()=>{let z=fo();if(!z||z.footer.dataset.indexActionsBound==="true")return;z.newButton&&z.newButton.addEventListener("click",()=>{Rn(),z.actionList&&(z.actionList.style.display="none"),z.inlineForm&&(z.inlineForm.style.display=""),Aa(R?R.value:""),z.nameInput&&(z.nameInput.focus(),z.nameInput.select())}),z.cancelCreate&&z.cancelCreate.addEventListener("click",()=>{Rn()}),z.deleteButton&&z.deleteButton.addEventListener("click",()=>{let fe=m(R?R.value:""),ue=H?H.value:"";if(!fe||!ue){let je=w(fe);Lo(e(n("Select a %s to delete.","gpt3-ai-content-generator"),je.singular.toLowerCase()),"error"),Io();return}let Ae=H&&H.selectedOptions?H.selectedOptions[0]:null,He=Ae?Ae.textContent:ue,Oe=d(fe),Qe=Oe?Oe.label:w(fe).singular.toLowerCase();z.deleteConfirmText&&(z.deleteConfirmText.textContent=e(n('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Qe,He)),z.actionList&&(z.actionList.style.display="none"),z.inlineForm&&(z.inlineForm.style.display="none"),z.deleteConfirm&&(z.deleteConfirm.style.display="")}),z.cancelDelete&&z.cancelDelete.addEventListener("click",()=>{Rn()}),z.createButton&&z.createButton.addEventListener("click",async()=>{let fe=m(R?R.value:"");if(!fe)return;let ue=await Mo(fe,z.createButton,{root:z.inlineForm,statusUpdater:Lo,clearStatusSoon:Io});Bn(fe),ue&&ue.success&&Rn()}),z.confirmDelete&&z.confirmDelete.addEventListener("click",async()=>{let fe=m(R?R.value:""),ue=H?H.value:"";if(!fe||!ue)return;let Ae=H&&H.selectedOptions?H.selectedOptions[0]:null,He=Ae?Ae.textContent:ue,Oe=await Po(fe,ue,He,z.confirmDelete,{skipConfirm:!0,statusUpdater:Lo,clearStatusSoon:Io,defaultLabel:n("Confirm","gpt3-ai-content-generator")});Un(),Oe&&(Rn(),yn(1))}),z.footer.dataset.indexActionsBound="true";let te=Uo();te&&te.dataset.indexActionsBound!=="true"&&(te.addEventListener("click",()=>{Rn(),Fn(Ue.provider||""),Ue.openIndexCreateOnOpen&&(Ue.openIndexCreateOnOpen=!1,z.actionList&&(z.actionList.style.display="none"),z.inlineForm&&(z.inlineForm.style.display=""),Aa(Ue.provider||""),z.nameInput&&(z.nameInput.focus(),z.nameInput.select()))}),te.dataset.indexActionsBound="true")},Qn=(z,te,fe={})=>{if(!H)return;let ue=m(z),Ae=ue&&Ue.indexByProvider[ue]||"",He=w(ue),Oe=!!ue;Go(Oe),H.dataset.aipkitPickerTitle=He.singular;let Qe=document.getElementById(`${H.id}_picker_title`);Qe&&(Qe.textContent=He.singular);let je=document.getElementById(`${H.id}_picker_search`);if(je){let yt=He.singular?`Search ${He.singular.toLowerCase()}...`:n("Search...","gpt3-ai-content-generator");je.setAttribute("placeholder",yt)}if(H.innerHTML="",!Oe){let yt=document.createElement("option");yt.value="",yt.textContent=He.plural,H.appendChild(yt),H.value="",na(!0),_o(!1,ue),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(ue);return}if(fe.loading){let yt=document.createElement("option");yt.value="",yt.textContent=He.loading,yt.disabled=!0,H.appendChild(yt),H.value="",na(!0,{disableTrigger:!1}),_o(!1,ue),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(ue);return}let Ge=Array.isArray(te)?te:[];if(!Ge.length){let yt=document.createElement("option");yt.value="",yt.textContent=fe.emptyLabel||He.empty,yt.disabled=!0,H.appendChild(yt),H.value="",na(!0,{disableTrigger:!1}),_o(!0,ue),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(ue);return}let gt=document.createElement("option");gt.value="",gt.textContent=e(n("All %s","gpt3-ai-content-generator"),He.plural.toLowerCase()),H.appendChild(gt),Ge.forEach(yt=>{let Xi=S(ue,yt),Ai=I(ue,yt);if(!Xi)return;let Mt=document.createElement("option");Mt.value=Xi,Mt.textContent=Ai||Xi,H.appendChild(Mt)});let Rt=Ue.indexByProvider[ue]||"",ni=Rt?Ge.some(yt=>S(ue,yt)===Rt):!1;Rt&&!ni&&(Ue.indexByProvider[ue]=""),H.value=ni?Rt:"",na(!1),_o(!1,ue),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),ue&&Ae!==Ue.indexByProvider[ue]&&u({provider:Ue.provider,status:Ue.status,type:Ue.type,indexByProvider:Ue.indexByProvider,embeddingByProvider:Ue.embeddingByProvider}),zn(),Fn(ue)},mo=()=>nt||N||(Ie?Ie.querySelector("#aipkit_sources_provider_panel_status"):null),an=(z,te)=>{let fe=mo();D(fe,z,te)},kn=()=>{mi&&window.clearTimeout(mi),mi=window.setTimeout(()=>{an("","")},3e3)},La=()=>{Ki&&(Ki.classList.remove("aipkit-active"),Ki.setAttribute("aria-hidden","true"),ln&&(ln.value=""))},Cn=z=>{!Ki||!ln||(ln.value=z||"",ln.scrollTop=0,Ki.classList.add("aipkit-active"),Ki.setAttribute("aria-hidden","false"),ln.focus())},Jn=()=>{xt&&(xt.classList.remove("aipkit-active"),xt.setAttribute("aria-hidden","true"),xt.dataset.provider="",xt.dataset.storeId="",xt.dataset.vectorId="",xt.dataset.logId="",xt.dataset.embeddingProvider="",xt.dataset.embeddingModel="",pi&&(pi.value=""))},er=z=>{!xt||!pi||(xt.dataset.provider=z.dataset.provider||"",xt.dataset.storeId=z.dataset.storeId||"",xt.dataset.vectorId=z.dataset.vectorId||"",xt.dataset.logId=z.dataset.logId||"",xt.dataset.embeddingProvider=z.dataset.embeddingProvider||"",xt.dataset.embeddingModel=z.dataset.embeddingModel||"",pi.value=z.dataset.content?decodeURIComponent(z.dataset.content):"",xt.classList.add("aipkit-active"),xt.setAttribute("aria-hidden","false"),setTimeout(()=>pi.focus(),0))},go=()=>{Fe&&(Fe.classList.remove("aipkit-active"),Fe.setAttribute("aria-hidden","true"),Fe.dataset.provider="",Fe.dataset.storeId="",Fe.dataset.vectorId="",Fe.dataset.logId="")},To=z=>{Fe&&(Fe.dataset.provider=z.provider||"",Fe.dataset.storeId=z.storeId||"",Fe.dataset.vectorId=z.vectorId||"",Fe.dataset.logId=z.logId||"",Fe.classList.add("aipkit-active"),Fe.setAttribute("aria-hidden","false"),st&&(st.disabled=!1))},Ii=z=>{let te=document.getElementById(z);return te?te.value:""},hn=z=>{let te=o[m(z)];return te?Ii(te):""},dn=()=>{let z={...h()};return z.pinecone=!!Vo.pinecone_api_key,z.qdrant=!!(Vo.qdrant_api_key&&Vo.qdrant_url),window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=z,z};dn();let qo=z=>z.startsWith("pinecone_")?"pinecone":z.startsWith("qdrant_")?"qdrant":"",tr=async()=>{if(!Ie)return;let z=Ie.querySelectorAll("[data-aipkit-provider-config]");if(!z.length)return;let te={},fe=!1,ue=new Set;if(z.forEach(Ae=>{let He=Ae.dataset.aipkitProviderConfig;if(!He)return;let Oe=Ae.value.trim();if(te[He]=Oe,Vo[He]!==Oe){fe=!0;let Qe=qo(He);Qe&&ue.add(Qe)}}),!!fe){an(n("Saving...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",te),Object.keys(te).forEach(Ae=>{Vo[Ae]=te[Ae]}),dn(),Un(),ue.forEach(Ae=>{b(Ae)!==!1&&(ui.activeProvider===Ae?pn(Ae,{silent:!0}):ui.stores[Ae]=null)}),an(n("Saved","gpt3-ai-content-generator"),"success"),kn()}catch(Ae){let He=Ae&&Ae.message?Ae.message:n("Save failed.","gpt3-ai-content-generator");an(`${n("Error:","gpt3-ai-content-generator")} ${He}`,"error"),kn()}}},ra=()=>{ia&&window.clearTimeout(ia),ia=window.setTimeout(()=>{tr()},600)},Yn=(z=Ie)=>z?{nameInput:z.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:z.querySelector("[data-aipkit-provider-dimension-input]"),deleteButton:z.querySelector("[data-aipkit-provider-delete-selected]")}:{},Un=()=>{let z=m(R?R.value:Ie?.dataset.provider||""),te=H?H.value:"",fe=!!z&&!!te&&b(z)===!0,{deleteButton:ue}=Yn();ue&&(ue.disabled=!fe,fe?ue.removeAttribute("aria-disabled"):ue.setAttribute("aria-disabled","true")),Bn(z)},$n=(z,te,fe={})=>{let ue=m(z),Ae=m(R?R.value:"");if(!ue){Qn("",[]),Un();return}ue===Ae&&(Qn(ue,te,{loading:fe.loading===!0,emptyLabel:fe.emptyLabel}),Un())},Xn=(z,te,fe,ue)=>{z&&(te?(z.disabled=!0,z.setAttribute("aria-disabled","true"),z.textContent=ue):(z.disabled=!1,z.removeAttribute("aria-disabled"),z.textContent=fe))},pn=async(z,te={})=>{let fe=g(z);if(!fe)return;let ue=m(z),Ae=te.silent===!0;if(b(ue)===!1){an(n("Add provider credentials to load stores.","gpt3-ai-content-generator"),"error"),kn();return}let Oe=hn(ue);if(!Oe){an(n("Provider nonce missing.","gpt3-ai-content-generator"),"error"),kn();return}let Qe=`${ue}-${Date.now()}`;ui.syncTokens[ue]=Qe,$n(ue,ui.stores[ue],{loading:!0}),Ae||an(n("Syncing stores...","gpt3-ai-content-generator"),"");let je={_ajax_nonce:Oe};ue==="openai"&&(je.limit=100,je.order="desc");let Ge=te.triggerButton||(Ie&&Ie.dataset.provider===ue?Ie.querySelector(".aipkit_sources_provider_sync"):null);Xn(Ge,!0,n("Sync","gpt3-ai-content-generator"),n("Syncing...","gpt3-ai-content-generator"));try{let gt=await window.aipkit_apiRequest(fe.listAction,je);if(ui.syncTokens[ue]!==Qe)return;let Rt=Array.isArray(gt[fe.listKey])?gt[fe.listKey]:[];ui.stores[ue]=Rt,x(ue,Rt),ue==="pinecone"?gn.pineconeIndexes=Rt:ue==="qdrant"&&(gn.qdrantCollections=Rt),Ze&&m(Ze.value)===ue&&ko(ue,{preserveValue:!0}),ui.activeProvider===ue&&$n(ue,Rt),Ae||(an(gt.message||n("Stores synced.","gpt3-ai-content-generator"),"success"),kn())}catch(gt){if(ui.syncTokens[ue]!==Qe)return;let Rt=gt&&gt.message?gt.message:n("Sync failed.","gpt3-ai-content-generator");an(`${n("Error:","gpt3-ai-content-generator")} ${Rt}`,"error"),kn(),$n(ue,ui.stores[ue])}finally{Xn(Ge,!1,n("Sync","gpt3-ai-content-generator"),n("Syncing...","gpt3-ai-content-generator"))}},Po=async(z,te,fe,ue,Ae={})=>{let He=d(z);if(!He)return!1;let Oe=m(z),Qe=typeof Ae.statusUpdater=="function"?Ae.statusUpdater:an,je=typeof Ae.clearStatusSoon=="function"?Ae.clearStatusSoon:kn,Ge=Ae.defaultLabel||(ue?ue.textContent.trim():"")||n("Delete","gpt3-ai-content-generator"),gt=Ae.loadingLabel||n("Deleting...","gpt3-ai-content-generator"),Rt=!1;if(!te)return Qe(n("Missing store identifier.","gpt3-ai-content-generator"),"error"),je(),!1;let ni=fe||te,yt=e(n('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),He.label,ni);if(Ae.skipConfirm!==!0&&!window.confirm(yt))return!1;let Xi=hn(Oe);if(!Xi)return Qe(n("Provider nonce missing.","gpt3-ai-content-generator"),"error"),je(),!1;Xn(ue,!0,Ge,gt),Qe(n("Deleting...","gpt3-ai-content-generator"),"");let Ai={_ajax_nonce:Xi};Ai[He.param]=te;try{let Mt=await window.aipkit_apiRequest(He.action,Ai),ki=(Array.isArray(ui.stores[Oe])?ui.stores[Oe]:[]).filter(Ti=>S(Oe,Ti)!==te);ui.stores[Oe]=ki,x(Oe,ki),Oe==="pinecone"?gn.pineconeIndexes=ki:Oe==="qdrant"&&(gn.qdrantCollections=ki),Ze&&m(Ze.value)===Oe&&ko(Oe,{preserveValue:!0}),ui.activeProvider===Oe&&$n(Oe,ki),Qe(Mt.message||n("Deleted.","gpt3-ai-content-generator"),"success"),je(),Rt=!0}catch(Mt){let _i=Mt&&Mt.message?Mt.message:n("Delete failed.","gpt3-ai-content-generator");Qe(`${n("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),je()}finally{Xn(ue,!1,Ge,gt)}return Rt},Mo=async(z,te,fe={})=>{let ue=g(z);if(!ue)return{success:!1,createdId:""};let Ae=m(z),He=typeof fe.statusUpdater=="function"?fe.statusUpdater:an,Oe=typeof fe.clearStatusSoon=="function"?fe.clearStatusSoon:kn,Qe=!1,je="";if(b(Ae)===!1)return He(n("Add provider credentials to create stores.","gpt3-ai-content-generator"),"error"),Oe(),{success:!1,createdId:""};let gt=hn(Ae);if(!gt)return He(n("Provider nonce missing.","gpt3-ai-content-generator"),"error"),Oe(),{success:!1,createdId:""};let{nameInput:Rt,dimensionInput:ni}=Yn(fe.root||Ie),yt=Rt?Rt.value.trim():"";if(!yt)return He(n("Name is required.","gpt3-ai-content-generator"),"error"),Oe(),{success:!1,createdId:""};let Xi=0;if(ue.needsDimension&&(Xi=ni?parseInt(ni.value,10):0,!Xi||Number.isNaN(Xi)))return He(n("Dimension is required.","gpt3-ai-content-generator"),"error"),Oe(),{success:!1,createdId:""};Xn(te,!0,n("Create","gpt3-ai-content-generator"),n("Creating...","gpt3-ai-content-generator")),He(n("Creating...","gpt3-ai-content-generator"),"");let Ai={_ajax_nonce:gt,name:yt};ue.needsDimension&&(Ai.dimension=Xi),Ae==="openai"&&(Ai.source_type="sources_module_create");try{let Mt=await window.aipkit_apiRequest(ue.createAction,Ai),_i=Mt[ue.createKey];if(_i){let ki=Array.isArray(ui.stores[Ae])?ui.stores[Ae].slice():[];je=S(Ae,_i),je&&ki.some(Ti=>S(Ae,Ti)===je)||ki.unshift(_i),ui.stores[Ae]=ki,x(Ae,ui.stores[Ae]),Ae==="pinecone"?gn.pineconeIndexes=ui.stores[Ae]:Ae==="qdrant"&&(gn.qdrantCollections=ui.stores[Ae]),Ze&&m(Ze.value)===Ae&&ko(Ae,{preserveValue:!0}),ui.activeProvider===Ae&&$n(Ae,ui.stores[Ae])}else await pn(Ae);Rt&&(Rt.value=""),ni&&(ni.value=""),He(Mt.message||n("Store created.","gpt3-ai-content-generator"),"success"),Oe(),Qe=!0}catch(Mt){let _i=Mt&&Mt.message?Mt.message:n("Create failed.","gpt3-ai-content-generator");He(`${n("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Oe()}finally{Xn(te,!1,n("Create","gpt3-ai-content-generator"),n("Creating...","gpt3-ai-content-generator"))}return{success:Qe,createdId:je}},Dn=z=>{let te=m(z);if(ui.activeProvider=te,Rn(),!te)Qn("",[]);else{let fe=ui.stores[te];if(Array.isArray(fe))$n(te,fe);else if(b(te))$n(te,[],{loading:!0}),pn(te,{silent:!0});else{let ue=w(te);$n(te,[],{emptyLabel:e(n("Add credentials to load %s.","gpt3-ai-content-generator"),ue.plural.toLowerCase())})}}Un()},sa=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():`text_${Date.now()}`,Bo=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now(),Fo=z=>typeof CSS<"u"&&CSS.escape?CSS.escape(String(z)):String(z).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),ir=async(z,te,fe,ue,Ae)=>{let He=z.toLowerCase();if(He==="openai"){let je=Ii("aipkit_vector_store_nonce_openai");if(!je)throw new Error(n("OpenAI nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:je,target_store_id:te,text_content:fe,source_type:"text_entry_global_form"});return}if(!ue||!Ae)throw new Error(n("Select an embedding model.","gpt3-ai-content-generator"));let Oe=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:fe,embedding_provider:ue,embedding_model:Ae}),Qe=Oe.embeddings&&Oe.embeddings.length?Oe.embeddings[0]:null;if(!Qe)throw new Error(n("Failed to generate embedding.","gpt3-ai-content-generator"));if(He==="pinecone"){let je=Ii("aipkit_vector_store_pinecone_nonce_management");if(!je)throw new Error(n("Pinecone nonce missing.","gpt3-ai-content-generator"));let Ge=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:je,vectors:JSON.stringify([{id:Ge,values:Qe,metadata:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:fe,vector_id:Ge}}]),embedding_provider:ue,embedding_model:Ae,original_text_content:fe,index_name:te});return}if(He==="qdrant"){let je=Ii("aipkit_vector_store_qdrant_nonce_management");if(!je)throw new Error(n("Qdrant nonce missing.","gpt3-ai-content-generator"));let Ge=Bo(),gt={_ajax_nonce:je,vectors:JSON.stringify([{id:Ge,vector:Qe,payload:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:fe,vector_id:Ge}}]),embedding_provider:ue,embedding_model:Ae,original_text_content:fe,collection_name:te,source_context:"sources_module_edit"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",gt);return}throw new Error(n("Unsupported provider for edit.","gpt3-ai-content-generator"))},Yt=window.aipkit_escapeHtml||(z=>z==null?"":String(z)),nr=(z,te)=>{let fe=document.createElement("div");fe.className="aipkit_indexing_settings_section";let ue=document.createElement("h5");ue.textContent=n("Basic Labels","gpt3-ai-content-generator"),fe.appendChild(ue);let Ae=document.createElement("table");Ae.className="wp-list-table widefat striped",Ae.innerHTML=`
        <thead>
          <tr>
            <th>${Yt(n("Label Type","gpt3-ai-content-generator"))}</th>
            <th>${Yt(n("Custom Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let He=Ae.querySelector("tbody"),Oe=["source_url","title","excerpt","content"],Qe=[n("Source URL","gpt3-ai-content-generator"),n("Title","gpt3-ai-content-generator"),n("Excerpt","gpt3-ai-content-generator"),n("Content","gpt3-ai-content-generator")];return Oe.forEach((je,Ge)=>{let gt=te&&te[je]?te[je]:Qe[Ge],Rt=En.originalSettings?.[z]?.basic_labels?.[je]||gt,ni=document.createElement("tr");ni.innerHTML=`
          <td><code>${Yt(Qe[Ge])}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Yt(z)}][basic_labels][${Yt(je)}]"
              value="${Yt(Rt)}"
              placeholder="${Yt(gt)}"
              ${Hi.isPro?"":"disabled"}
            >
          </td>
        `,He.appendChild(ni)}),fe.appendChild(Ae),fe},Ia=(z,te,fe,ue)=>{let Ae=document.createElement("div");if(Ae.className="aipkit_indexing_settings_section",!ue||Object.keys(ue).length===0)return Ae.innerHTML=`<p><em>${Yt(e(n("No %s found for this content type.","gpt3-ai-content-generator"),z.toLowerCase()))}</em></p>`,Ae;let He=document.createElement("h5");He.textContent=z,Ae.appendChild(He);let Oe=document.createElement("table");Oe.className="wp-list-table widefat striped",Oe.innerHTML=`
        <thead>
          <tr>
            <th class="check-column">
              <input type="checkbox" class="aipkit-indexing-select-all" ${Hi.isPro?"":"disabled"} />
            </th>
            <th>${Yt(n("Field / Taxonomy","gpt3-ai-content-generator"))}</th>
            <th>${Yt(n("Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Qe=Oe.querySelector("tbody");Object.keys(ue).forEach(Ge=>{let gt=ue[Ge],Rt=En.originalSettings?.[te]?.[fe]?.[Ge]||{},ni=typeof Rt.enabled=="boolean"?Rt.enabled:!0,yt=Rt.label||"",Xi=document.createElement("tr");Xi.innerHTML=`
          <th scope="row" class="check-column">
            <input
              type="checkbox"
              name="settings[${Yt(te)}][${Yt(fe)}][${Yt(Ge)}][enabled]"
              value="1"
              ${ni?"checked":""}
              ${Hi.isPro?"":"disabled"}
            >
          </th>
          <td><code>${Yt(Ge)}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Yt(te)}][${Yt(fe)}][${Yt(Ge)}][label]"
              value="${Yt(yt)}"
              placeholder="${Yt(gt)}"
              ${Hi.isPro?"":"disabled"}
            >
          </td>
        `,Qe.appendChild(Xi)});let je=Oe.querySelector(".aipkit-indexing-select-all");return je&&je.addEventListener("change",Ge=>{Qe.querySelectorAll('input[type="checkbox"]').forEach(gt=>{gt.checked=Ge.target.checked})}),Ae.appendChild(Oe),Ae},Ta=(z,te,fe)=>{let ue=document.createElement("div");ue.className="aipkit_accordion";let Ae=document.createElement("div");Ae.className="aipkit_accordion-header",Ae.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${Yt(te)}`;let He=document.createElement("div");return He.className="aipkit_accordion-content",He.appendChild(nr(z,fe.basic_labels||{})),He.appendChild(Ia(n("Custom Fields","gpt3-ai-content-generator"),z,"fields",fe.fields||{})),He.appendChild(Ia(n("Taxonomies","gpt3-ai-content-generator"),z,"taxonomies",fe.taxonomies||{})),z==="product"&&fe.woo_attributes&&He.appendChild(Ia(n("Product Data","gpt3-ai-content-generator"),z,"woo_attributes",fe.woo_attributes)),ue.appendChild(Ae),ue.appendChild(He),ue},qa=async()=>{let z=document.getElementById("aipkit_indexing_settings_form_container");if(z){if(z.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${Yt(n("Loading content types...","gpt3-ai-content-generator"))}</p>`,!Hi.nonce){z.innerHTML=`<p class="aipkit_text-danger">${Yt(n("Error: Security token is missing. Cannot load settings.","gpt3-ai-content-generator"))}</p>`;return}try{let te=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:Hi.nonce}),fe={},ue={};if(te&&typeof te.success<"u"){if(!te.success)throw new Error(te.data||"Failed to load content types.");fe=te.data?.cpt_data||{},ue=te.data?.saved_settings||{}}else te&&(fe=te.cpt_data||{},ue=te.saved_settings||{});if(En.originalSettings=ue||{},z.innerHTML="",!Object.keys(fe).length){z.innerHTML=`<p class="aipkit_text-center">${Yt(n("No content types found. Please add content and try again.","gpt3-ai-content-generator"))}</p>`;return}let Ae=document.createElement("div");Ae.className="aipkit_accordion-group",Object.keys(fe).forEach(Oe=>{let Qe=fe[Oe];Ae.appendChild(Ta(Oe,Qe.label||Oe,Qe))}),z.appendChild(Ae);let He=document.getElementById("aipkit_indexing_settings_form");He&&!En.accordionsBound&&(He.addEventListener("click",Oe=>{let Qe=Oe.target.closest(".aipkit_accordion-header");Qe&&(Qe.classList.toggle("aipkit_active"),Qe.nextElementSibling&&Qe.nextElementSibling.classList.toggle("aipkit_active"))}),En.accordionsBound=!0)}catch(te){z.innerHTML=`<p class="aipkit_text-danger">${Yt(te&&te.message?te.message:n("Failed to load content types.","gpt3-ai-content-generator"))}</p>`}}},or=()=>{let z=document.getElementById("aipkit_indexing_settings_form_container");if(!z)return{};let te={},fe=document.getElementById("aipkit_hide_user_uploads_checkbox");te.hide_user_uploads=fe?fe.checked:!0;let ue=document.getElementById("aipkit_show_index_button_checkbox");te.show_index_button=ue?ue.checked:!0;let Ae=document.getElementById("aipkit_chunk_avg_chars_per_token"),He=document.getElementById("aipkit_chunk_max_tokens_per_chunk"),Oe=document.getElementById("aipkit_chunk_overlap_tokens");if(Ae&&He&&Oe){let Qe=parseInt(Ae.value,10),je=parseInt(He.value,10),Ge=parseInt(Oe.value,10);Number.isNaN(Qe)||(te.chunk_avg_chars_per_token=Qe),Number.isNaN(je)||(te.chunk_max_tokens_per_chunk=je),Number.isNaN(Ge)||(te.chunk_overlap_tokens=Ge)}return z.querySelectorAll('input[type="checkbox"]').forEach(Qe=>{let je=Qe.name.match(/[^[\]']+/g);if(je&&je.length===5&&je[4]==="enabled"){let[,Ge,gt,Rt]=je;te[Ge]||(te[Ge]={}),te[Ge][gt]||(te[Ge][gt]={}),te[Ge][gt][Rt]||(te[Ge][gt][Rt]={}),te[Ge][gt][Rt].enabled=Qe.checked}}),z.querySelectorAll('input[type="text"]').forEach(Qe=>{let je=Qe.name.match(/[^[\]']+/g);if(je&&je.length===5&&je[4]==="label"){let[,Ge,gt,Rt]=je;te[Ge]||(te[Ge]={}),te[Ge][gt]||(te[Ge][gt]={}),te[Ge][gt][Rt]||(te[Ge][gt][Rt]={}),te[Ge][gt][Rt].label=Qe.value.trim()}else if(je&&je.length===4&&je[2]==="basic_labels"){let[,Ge,,gt]=je;te[Ge]||(te[Ge]={}),te[Ge].basic_labels||(te[Ge].basic_labels={}),te[Ge].basic_labels[gt]=Qe.value.trim()}}),te},ca=(z,te)=>{if(!z)return;z.dataset.label||(z.dataset.label=z.textContent.trim());let fe=z.dataset.label||n("Save","gpt3-ai-content-generator"),ue=z.querySelector(".aipkit_spinner"),Ae=z.querySelector(".aipkit_btn-text"),He=te?n("Saving...","gpt3-ai-content-generator"):fe;Ae?Ae.textContent=He:z.textContent=He,ue&&(ue.style.display=te?"inline-block":"none"),z.disabled=te},Pa=(z,te)=>{if(!nt)return;D(nt,te,{success:"success",error:"error",info:"loading"}[z]||""),(z==="success"||z==="error")&&xr()},la=async(z={})=>{let{button:te=null,mode:fe="manual"}=z;if(!Hi.nonce)return;te&&ca(te,!0),fe==="auto"&&Pa("info",n("Auto-saving...","gpt3-ai-content-generator"));let ue=or();try{let Ae=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:Hi.nonce,settings:JSON.stringify(ue)});En.originalSettings=ue;let He=Ae.message||n("Settings saved!","gpt3-ai-content-generator");Pa("success",fe==="auto"?n("Saved","gpt3-ai-content-generator"):He)}catch(Ae){let He=Ae&&Ae.message?Ae.message:n("Failed to save settings.","gpt3-ai-content-generator");Pa("error",He)}finally{te&&ca(te,!1)}},ar=z=>{let te=document.getElementById("aipkit_upgradeBtn");if(te){te.click();return}let fe=z&&z.dataset?z.dataset.upgradeUrl:"";fe&&window.open(fe,"_blank","noopener")},Ar=z=>{z.preventDefault();let te=z.currentTarget;if(te&&te.dataset&&te.dataset.upgradeOnly==="1"){ar(te);return}la({button:z.currentTarget,mode:"manual"})},Ma=async()=>{if(Ao){Wo=!0;return}Ao=!0,await la({mode:"auto"}),Ao=!1,Wo&&(Wo=!1,Ma())},Ba=()=>{Hi.nonce&&(Do&&window.clearTimeout(Do),Do=window.setTimeout(()=>{Ma()},600))},Fa=()=>{if(En.autosaveBound)return;[{element:document.getElementById("aipkit_hide_user_uploads_checkbox"),events:["change"]},{element:document.getElementById("aipkit_show_index_button_checkbox"),events:["change"]},{element:document.getElementById("aipkit_chunk_avg_chars_per_token"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_max_tokens_per_chunk"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_overlap_tokens"),events:["input","change"]}].forEach(({element:te,events:fe})=>{te&&(fe.forEach(ue=>{te.addEventListener(ue,Ba)}),te.addEventListener("blur",Ba))}),En.autosaveBound=!0},oo=()=>{if(En.initialized)return!0;let z=document.getElementById("indexing-settings-tab-content");return z?z.dataset.initialized==="true"?(En.initialized=!0,!0):(qa(),En.saveBound||(Me&&Me.addEventListener("click",Ar),En.saveBound=!0),Fa(),z.dataset.initialized="true",En.initialized=!0,!0):!1},rr=()=>{Z&&(Z.classList.remove("aipkit-active"),Z.setAttribute("aria-hidden","true"),Ee&&Ee.setAttribute("aria-expanded","false"))},Ko=()=>{ne&&(ne.classList.add("aipkit-active"),ne.setAttribute("aria-hidden","false"),ye&&ye.focus())},da=()=>{ne&&(ne.classList.remove("aipkit-active"),ne.setAttribute("aria-hidden","true"))},sr=()=>nt||N,Ji=(z,te)=>{let fe=sr();D(fe,z,te)},On=()=>{ii&&window.clearTimeout(ii),ii=window.setTimeout(()=>{Ji("","")},3e3)},pa=z=>{if(!Pt)return;let te=w(z);Pt.textContent=te.singular},ko=(z,te={})=>{if(!it)return;let fe=m(z),Ae=te.preserveValue===!0?it.value:"";it.innerHTML=`<option value="">${Yt(n("-- Select --","gpt3-ai-content-generator"))}</option>`;let He=[];if(fe==="pinecone"?He=gn.pineconeIndexes:fe==="qdrant"&&(He=gn.qdrantCollections),Array.isArray(He)&&He.forEach(Oe=>{let Qe=Oe?.name||Oe?.id||(typeof Oe=="string"?Oe:"");if(!Qe)return;let je=document.createElement("option");je.value=Qe,je.textContent=Qe,it.appendChild(je)}),Ae&&it.querySelector(`option[value="${Fo(Ae)}"]`))it.value=Ae;else if(Ae){let Oe=document.createElement("option");Oe.value=Ae,Oe.textContent=Ae,it.appendChild(Oe),it.value=Ae}},ua=()=>{if(!Qt||!Mi)return;let z=Mi.options[Mi.selectedIndex];z&&z.dataset.provider&&(Qt.value=z.dataset.provider)},wo=()=>({semantic_search_vector_provider:Ze?Ze.value:"",semantic_search_target_id:it?it.value:"",semantic_search_embedding_provider:Qt?Qt.value:"",semantic_search_embedding_model:Mi?Mi.value:"",semantic_search_num_results:ti?ti.value:"",semantic_search_no_results_text:wt?wt.value:""}),Zn=async(z={})=>{let te=z.mode||"auto";ua();let fe=wo();if(fe.semantic_search_vector_provider){te==="auto"&&Ji(n("Saving...","gpt3-ai-content-generator"),"loading");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",fe),uo.dirty=!1,Ji(n(te==="auto"?"Saved":"Settings saved!","gpt3-ai-content-generator"),"success"),On()}catch(ue){let Ae=ue&&ue.message?ue.message:n("Failed to save settings.","gpt3-ai-content-generator");Ji(`${n("Error:","gpt3-ai-content-generator")} ${Ae}`,"error"),On()}}},$a=async()=>{if(Ho){ta=!0;return}Ho=!0,await Zn({mode:"auto"}),Ho=!1,ta&&(ta=!1,$a())},eo=()=>{Ca&&window.clearTimeout(Ca),uo.dirty=!0,Ca=window.setTimeout(()=>{$a()},600)},di=()=>{if(uo.autosaveBound)return;let z=(te,fe=["change"])=>{te&&fe.forEach(ue=>te.addEventListener(ue,eo))};z(Ze),z(it),z(Mi),z(ti,["input","change"]),z(wt,["input","change"]),uo.autosaveBound=!0},ho=()=>uo.initialized||!Ze||!it||!Mi?!1:(pa(Ze.value),ko(Ze.value,{preserveValue:!0}),ua(),di(),uo.initialized=!0,!0),cr=()=>{De&&(ho(),De.classList.add("aipkit-active"),De.setAttribute("aria-hidden","false"),ze&&ze.focus())},_a=()=>{De&&(De.classList.remove("aipkit-active"),De.setAttribute("aria-hidden","true"))},Oa=z=>{if(!Jt)return;let te=Jt.querySelector(".aipkit_spinner");te&&(te.style.display=z?"inline-block":"none"),Jt.disabled=z,Jt.setAttribute("aria-disabled",z?"true":"false")},bi=(z,te="")=>{li&&(li.className="aipkit_sources_semantic_results aipkit_form-help",te&&li.classList.add(`aipkit_form-help-${te}`),li.textContent=z)},lr=async z=>{if(!li)return;let te=wo();if(!te.semantic_search_vector_provider||!te.semantic_search_target_id||!te.semantic_search_embedding_model){bi(n("Complete semantic search settings before running a demo.","gpt3-ai-content-generator"));return}if(!gn.nonce){bi(n("Security token missing. Please reload.","gpt3-ai-content-generator"),"error");return}(uo.dirty||Ho)&&await Zn({mode:"auto"}),Oa(!0),li.innerHTML='<div class="aipkit-search-loading"><span class="aipkit_spinner"></span></div>';try{let fe=await window.aipkit_apiRequest("aipkit_perform_semantic_search",{nonce:gn.nonce,query:z});li.className="aipkit_sources_semantic_results",li.innerHTML=fe.html||`<p>${Yt(te.semantic_search_no_results_text||n("No results found.","gpt3-ai-content-generator"))}</p>`}catch(fe){let ue=fe&&fe.message?fe.message:n("An error occurred while searching.","gpt3-ai-content-generator");bi(`${n("Error:","gpt3-ai-content-generator")} ${ue}`,"error")}finally{Oa(!1)}},yn=async(z=1)=>{Ue.page=z,D(N,"",""),L.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${Yt(n("Loading sources...","gpt3-ai-content-generator"))}</td></tr>`,F&&(F.innerHTML="");try{let te=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:Ue.page,per_page:Ue.perPage,provider:Ue.provider,status:Ue.status,type:Ue.type,search:Ue.search,store_id:xa()});U(L,te.logs||[]),J(te.pagination||{},F,yn)}catch(te){let fe=te&&te.message?te.message:n("Error loading sources.","gpt3-ai-content-generator");W(L,F,fe),D(N,fe,"error")}},rn=(()=>{let z=document.getElementById("aipkit_sources_training_toggle"),te=document.getElementById("aipkit_sources_training_card");if(!z||!te)return null;let fe=te.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),ue=te.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),Ae=te.querySelector(".aipkit_training_text_input"),He=te.querySelector("#aipkit_training_qa_question"),Oe=te.querySelector("#aipkit_training_qa_answer"),Qe=te.querySelector("#aipkit_training_files_input"),je=te.querySelector(".aipkit_training_files_button"),Ge=te.querySelector(".aipkit_builder_dropzone"),gt=te.querySelector("#aipkit_training_file_list"),Rt=te.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),ni=te.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),yt=te.querySelector(".aipkit_training_stop_btn"),Xi=te.querySelector(".aipkit_training_action_row"),Ai=te.querySelector("#aipkit_training_status")||N,Mt=document.getElementById("aipkit_sources_embedding_row"),_i=document.getElementById("aipkit_sources_embedding_model"),ki=te.querySelector("#aipkit_vs_wp_content_mode"),Ti=te.querySelector("#aipkit_vs_wp_content_status"),Bt=te.querySelector("#aipkit_vs_wp_content_status_specific"),qn=te.querySelector("#aipkit_vs_wp_content_list_area"),Vt=te.querySelector("#aipkit_vs_wp_content_pagination"),Na=te.querySelector("#aipkit_vs_wp_content_messages_area"),Ra=te.querySelector("#aipkit_vs_global_target_select"),un=te.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Si=te.querySelector("#aipkit_wp_content_bulk_panel"),Da=te.querySelector("#aipkit_wp_content_specific_panel"),pr=te.querySelector("#aipkit_wp_content_bulk_hint"),_n=te.querySelector("#aipkit_wp_content_specific_types_panel"),Xe=te.querySelector("#aipkit_wp_content_status_wrap_bulk"),Wa=te.querySelector("#aipkit_wp_content_status_wrap_specific"),Vi=new Map,zi={page:1,selectedIds:new Set},en=null,ao=null,$o=!1,Ui=(me,Ne)=>{Ai&&(Ai.textContent=me||"",Ai.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),me&&Ai.classList.add("is-visible"),Ne&&Ai.classList.add(`is-${Ne}`))},vn=(me=2500)=>{en&&window.clearTimeout(en),en=window.setTimeout(()=>{Ui("","")},me)},sn=(me,Ne="")=>{if(!Na)return;D(Na,me||"",Ne==="error"?"error":Ne==="success"?"success":"")},cn=(me=2500)=>{ao&&window.clearTimeout(ao),ao=window.setTimeout(()=>{sn("","")},me)},to=()=>{let me=m(R?R.value:""),Ne=H&&!H.disabled&&H.value||"";return!me||!Ne?null:{providerKey:me,storeId:Ne}},Ha=()=>{let me=m(R?R.value:"");if(!me||me==="all")return Ui(n("Select a provider first.","gpt3-ai-content-generator"),"error"),vn(),!1;let Ne=to();if(!Ne||!Ne.storeId){let Pe=w(me);return Ui(e(n("Select a %s first.","gpt3-ai-content-generator"),Pe.singular),"error"),vn(),!1}return!0},ma=me=>{if(!Number.isFinite(me))return"";let Ne=["B","KB","MB","GB"],Pe=me,Ye=0;for(;Pe>=1024&&Ye<Ne.length-1;)Pe/=1024,Ye+=1;let lt=Ye===0?0:1;return`${Pe.toFixed(lt)} ${Ne[Ye]}`},Ln=()=>{Ge&&(Ge.style.display=Vi.size>0&&$o?"none":"")},Fi=(me=1500)=>{gt&&window.setTimeout(()=>{Vi.clear(),gt.innerHTML="",Ln()},me)},vo=me=>{if(!gt||!me)return null;let Ne=`${me.name}_${me.size}_${me.lastModified}`;if(Vi.has(Ne))return Vi.get(Ne);let Pe=document.createElement("div");Pe.className="aipkit_training_file_row",Pe.dataset.fileKey=Ne;let Ye=document.createElement("div");Ye.className="aipkit_training_file_meta";let lt=document.createElement("span");lt.className="aipkit_training_file_name",lt.textContent=me.name;let Et=document.createElement("span");Et.className="aipkit_training_file_size",Et.textContent=ma(me.size);let ut=document.createElement("span");return ut.className="aipkit_training_file_status",ut.textContent=n("Queued","gpt3-ai-content-generator"),Ye.appendChild(lt),Ye.appendChild(Et),Pe.appendChild(Ye),Pe.appendChild(ut),gt.appendChild(Pe),Vi.set(Ne,Pe),Pe},qi=(me,Ne,Pe)=>{let Ye=vo(me);if(!Ye)return;let lt=Ye.querySelector(".aipkit_training_file_status");lt&&(lt.textContent=Ne||"",lt.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),Pe&&lt.classList.add(`is-${Pe}`))},Zi=async(me,Ne,Pe)=>{if(!me||!me.name||typeof window.aipkit_apiRequest!="function")return!1;let Ye=m(Ne);if(!Ye)return!1;let lt=String(me.name||"").trim();if(!lt)return!1;let Et=Lt=>String(Lt||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),ut=Et(lt),Dt=lt.replace(/\.[^/.]+$/,""),vt=[lt,ut,Dt&&Dt!==lt?Dt:""].filter(Boolean),$t=async(Lt,fn)=>{let oi=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:1,per_page:fn,provider:Ye,store_id:Pe||"",type:"file",search:Lt||""});return Array.isArray(oi.logs)?oi.logs:[]},ft=(Lt,fn)=>{if(!Lt.length)return null;let oi=fn.map(Et).filter(Boolean);return Lt.find(ai=>{let nn=Et(ai.message),Gi=Et(ai.post_title),Eo=Et(ai.file_id);return oi.some(Pn=>nn&&nn.includes(Pn)||Gi&&Gi.includes(Pn)||Eo&&Eo.includes(Pn))})||null};try{for(let oi of vt){let ai=await $t(oi,10),nn=ft(ai,[oi,ut]);if(nn){let Gi=String(nn.status||"").toLowerCase();if(Gi==="indexed"||Gi==="skipped_already_indexed"||Gi==="success")return qi(me,n("Trained","gpt3-ai-content-generator"),"success"),!0;if(Gi==="failed")return qi(me,n("Failed","gpt3-ai-content-generator"),"error"),!0;if(Gi==="processing"||Gi==="queued")return qi(me,n("Processing","gpt3-ai-content-generator"),"loading"),!0}}let Lt=await $t("",20),fn=ft(Lt,vt);if(fn){let oi=String(fn.status||"").toLowerCase();if(oi==="indexed"||oi==="skipped_already_indexed"||oi==="success")return qi(me,n("Trained","gpt3-ai-content-generator"),"success"),!0;if(oi==="failed")return qi(me,n("Failed","gpt3-ai-content-generator"),"error"),!0;if(oi==="processing"||oi==="queued")return qi(me,n("Processing","gpt3-ai-content-generator"),"loading"),!0}}catch{}return!1},ro=(me,Ne,Pe,Ye=0)=>{if(!me||!Ne||!Pe)return;if(Ye>=30){Zi(Pe,"openai",me).then(ut=>{ut||qi(Pe,n("Queued","gpt3-ai-content-generator"),"warning")});return}let Et=Ii("aipkit_vector_store_nonce_openai");if(!Et||typeof window.aipkit_apiRequest!="function"){Zi(Pe,"openai",me);return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:me,batch_id:Ne,_ajax_nonce:Et}).then(ut=>{let Dt=(ut.status||"").toLowerCase();if(Dt==="completed"){qi(Pe,n("Trained","gpt3-ai-content-generator"),"success"),yn(1);return}if(Dt==="failed"||Dt==="cancelled"){qi(Pe,n("Failed","gpt3-ai-content-generator"),"error");return}qi(Pe,n("Processing","gpt3-ai-content-generator"),"loading"),setTimeout(()=>{ro(me,Ne,Pe,Ye+1)},2500)}).catch(()=>{setTimeout(()=>{ro(me,Ne,Pe,Ye+1)},3e3)})},ur=me=>me?Array.isArray(me)?me.flatMap(Ne=>{if(Array.isArray(Ne))return Ne;if(Ne&&typeof Ne=="object"){if(Array.isArray(Ne.models))return Ne.models;if(Array.isArray(Ne.items))return Ne.items;if(Ne.id)return[Ne]}return[]}):typeof me=="object"?Object.values(me).flatMap(Ne=>Array.isArray(Ne)?Ne:[]):[]:[],jo=me=>{let Ne=window.aipkit_dashboard?.embeddingModels||{};return ur(Ne[me]||[])},ga=(me,Ne)=>{if(!Ne)return null;let Ye=jo(me).find(ut=>ut&&ut.id===Ne),lt=Ye?.dimensions||Ye?.dimension||Ye?.output_dimensionality||Ye?.outputDimensionality||Ye?.output_dimension,Et=lt?Number(lt):NaN;if(Number.isFinite(Et)&&Et>0)return Et;if(Ye&&typeof Ye.name=="string"){let ut=Ye.name.match(/\((\d{3,5})\)/);if(ut)return Number(ut[1])}return me==="google"?768:1536},tn=me=>{if(!_i)return;let Ne=m(me),Pe=Ne&&Ue.embeddingByProvider?Ue.embeddingByProvider[Ne]:"";if(!Pe)return;let Ye=Fo(Pe);_i.querySelector(`option[value="${Ye}"]`)&&(_i.value=Pe)},Gn=()=>{if(!_i)return;let me=_i.value||"",Ne=["openai","google","openrouter","azure"],Pe={openai:n("OpenAI","gpt3-ai-content-generator"),google:n("Google","gpt3-ai-content-generator"),openrouter:n("OpenRouter","gpt3-ai-content-generator"),azure:n("Azure","gpt3-ai-content-generator")};_i.innerHTML="";let Ye=document.createElement("option");Ye.value="",Ye.textContent=n("Select embedding model","gpt3-ai-content-generator"),_i.appendChild(Ye);let lt=!1;if(Ne.forEach(ut=>{let Dt=jo(ut);if(!Dt.length)return;let vt=document.createElement("optgroup");vt.label=Pe[ut]||ut,Dt.forEach($t=>{let ft=$t.id||"";if(!ft)return;let Lt=document.createElement("option");Lt.value=`${ut}::${ft}`,Lt.textContent=$t.name||ft,Lt.dataset.provider=ut,Lt.dataset.model=ft,vt.appendChild(Lt)}),vt.children.length&&(_i.appendChild(vt),lt=!0)}),!lt){_i.innerHTML="";let ut=document.createElement("option");ut.value="",ut.textContent=n("No embedding models found.","gpt3-ai-content-generator"),_i.appendChild(ut),_i.disabled=!0;return}if(_i.disabled=!1,me){let ut=Fo(me);if(_i.querySelector(`option[value="${ut}"]`)){_i.value=me;return}}let Et=_i.querySelector("optgroup option");Et&&(_i.value=Et.value)},Nn=()=>{if(!_i)return null;let me=_i.options[_i.selectedIndex],Ne=me&&me.dataset.provider||"",Pe=me&&me.dataset.model||"";if(!Ne||!Pe){let Ye=_i.value||"";if(Ye&&Ye.includes("::")){let[lt,Et]=Ye.split("::");Ne=lt||"",Pe=Et||""}}return!Ne||!Pe?null:{provider:Ne,model:Pe,dimension:ga(Ne,Pe)}},Va=me=>{!yt||!ni||(me?(yt.hidden=!1,yt.disabled=!1,ni.disabled=!0):(yt.hidden=!0,yt.disabled=!1,ni.disabled=!1))},$i=()=>{let me=to(),Ne=m(R?R.value:me?.providerKey||"");if(Rt.forEach(Pe=>{Pe.disabled=!1,Pe.removeAttribute("aria-disabled")}),Mt){let Pe=Ne==="pinecone"||Ne==="qdrant";Mt.hidden=!Pe,Pe&&tn(Ne)}if(Ra){let Pe=me?me.storeId:"";Ra.innerHTML=Pe?`<option value="${Yt(Pe)}">${Yt(Pe)}</option>`:'<option value=""></option>',Ra.value=Pe}},dt=me=>{if(!fe||!me)return;fe.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(Pe=>{let Ye=Pe.dataset.aipkitTab===me;Pe.classList.toggle("is-active",Ye),Pe.setAttribute("aria-selected",Ye?"true":"false")}),ue.forEach(Pe=>{let Ye=Pe.dataset.aipkitPanel===me;Pe.classList.toggle("is-active",Ye),Pe.hidden=!Ye}),ni&&(ni.style.display=me==="files"?"none":""),Xi&&Xi.classList.toggle("aipkit_builder_action_row--end",me==="files")},Oi=()=>{let me=fe?fe.querySelector(".aipkit_builder_tab.is-active"):null;return me?me.dataset.aipkitTab:""},Oo=()=>ki&&ki.value||"bulk",Ua=me=>{let Ne=me==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Pe=document.getElementById(Ne);return Pe?Array.from(Pe.selectedOptions).map(Ye=>Ye.value).filter(Boolean):[]},Ga=me=>{let Ne=me==="specific"?Bt:Ti;return Ne&&Ne.value||"publish"},bo=()=>qn?Array.from(qn.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(me=>me.value):[],ka=(me,Ne,Pe)=>{if(!Ne)return;Ne.innerHTML="";let Ye=Number(me?.total_posts||0),lt=Number(me?.total_pages||0),Et=Number(me?.current_page||1);if(!Ye)return;let ut=document.createElement("span");if(ut.className="aipkit_pagination-count",ut.textContent=`${Ye.toLocaleString()} ${i("item","items",Ye,"gpt3-ai-content-generator")}`,Ne.appendChild(ut),lt<=1)return;let Dt=document.createElement("span");Dt.className="aipkit_pagination-links";let vt=document.createElement("button");vt.type="button",vt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",vt.textContent=n("Prev","gpt3-ai-content-generator"),vt.disabled=Et<=1,vt.addEventListener("click",()=>Pe(Et-1));let $t=document.createElement("span");$t.className="aipkit_pagination-current",$t.textContent=`${Et}/${lt}`;let ft=document.createElement("button");ft.type="button",ft.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",ft.textContent=n("Next","gpt3-ai-content-generator"),ft.disabled=Et>=lt,ft.addEventListener("click",()=>Pe(Et+1)),Dt.appendChild(vt),Dt.appendChild($t),Dt.appendChild(ft),Ne.appendChild(Dt)},_r=(me,Ne)=>{if(!qn)return;if(qn.innerHTML="",!Array.isArray(me)||!me.length){qn.innerHTML=`<p class="aipkit_builder_help_text">${Yt(n("No posts found for selection.","gpt3-ai-content-generator"))}</p>`,Vt&&(Vt.innerHTML="");return}let Pe=document.createElement("ul"),Ye=document.createElement("div");Ye.className="aipkit_wp_content_select_all_wrapper";let lt=document.createElement("label");lt.className="aipkit_training_site_option";let Et=document.createElement("input");Et.type="checkbox",Et.checked=me.every(ut=>zi.selectedIds.has(String(ut.id))),lt.appendChild(Et),lt.appendChild(document.createTextNode(n("Select all","gpt3-ai-content-generator"))),Ye.appendChild(lt),qn.appendChild(Ye),qn.appendChild(Pe),me.forEach(ut=>{let Dt=document.createElement("li");Dt.className="aipkit_wp_content_list_item";let vt=document.createElement("input");vt.type="checkbox",vt.name="wp_content_to_index[]",vt.value=String(ut.id),vt.checked=zi.selectedIds.has(String(ut.id)),vt.addEventListener("change",()=>{vt.checked?zi.selectedIds.add(String(ut.id)):zi.selectedIds.delete(String(ut.id)),Et.checked=me.every(fn=>zi.selectedIds.has(String(fn.id)))});let $t=document.createElement("a");$t.className="aipkit_wp_content_title",$t.href=ut.edit_link||"#",$t.target="_blank",$t.rel="noopener noreferrer",$t.textContent=ut.title||n("Untitled","gpt3-ai-content-generator");let ft=document.createElement("span");ft.className="aipkit_wp_content_type",ft.textContent=ut.type_label||"";let Lt=document.createElement("span");Lt.className="aipkit_wp_content_indexed_status",Lt.textContent=ut.is_already_indexed?n("Indexed","gpt3-ai-content-generator"):"",Dt.appendChild(vt),Dt.appendChild($t),Dt.appendChild(ft),Dt.appendChild(Lt),Pe.appendChild(Dt)}),Et.addEventListener("change",()=>{Et.checked?me.forEach(ut=>zi.selectedIds.add(String(ut.id))):me.forEach(ut=>zi.selectedIds.delete(String(ut.id))),qn.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(ut=>{ut.checked=Et.checked})}),ka(Ne,Vt,so)},so=async me=>{if(!qn)return;let Ne=to(),Pe=Oo(),Ye=Ua(Pe);if(!Ye.length){qn.innerHTML="",Vt&&(Vt.innerHTML=""),sn(n("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let lt=Ii("aipkit_wp_content_fetch_nonce");if(!lt){sn(n("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let Et=Ga(Pe);try{sn(n("Loading content...","gpt3-ai-content-generator"),"");let ut=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:lt,post_types:Ye,post_status:Et,target_store_id:Ne?Ne.storeId:"",paged:me});zi.page=me,_r(ut.posts||[],ut.pagination||{}),sn("","")}catch(ut){sn(ut&&ut.message?ut.message:n("Failed to load content.","gpt3-ai-content-generator"),"error")}},zo=me=>{ki&&(ki.value=me),Si&&(Si.hidden=me!=="bulk"),_n&&(_n.hidden=me!=="specific"),Da&&(Da.hidden=me!=="specific"),Xe&&(Xe.hidden=me!=="bulk"),Wa&&(Wa.hidden=me!=="specific"),pr&&(pr.hidden=me!=="bulk"),me==="specific"&&so(1)},Ka=()=>{te.querySelectorAll(".aipkit_training_site_dropdown").forEach(Ne=>{let Pe=Ne.querySelector(".aipkit_training_site_dropdown_btn"),Ye=Ne.querySelector(".aipkit_training_site_dropdown_label"),lt=Ne.querySelector(".aipkit_training_site_dropdown_panel"),ut=Ne.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Dt=document.getElementById(ut);if(!Pe||!lt||!Dt)return;let vt=()=>{let ft=lt.querySelectorAll('input[type="checkbox"]:checked'),Lt=Ne.dataset.placeholder||n("Select types","gpt3-ai-content-generator"),fn=Ne.dataset.selectedLabel||n("selected","gpt3-ai-content-generator");Ye&&(ft.length?Ye.textContent=`${ft.length} ${fn}`:Ye.textContent=Lt)},$t=()=>{let ft=Array.from(lt.querySelectorAll('input[type="checkbox"]:checked')).map(Lt=>Lt.value);Array.from(Dt.options).forEach(Lt=>{Lt.selected=ft.includes(Lt.value)})};Pe.addEventListener("click",()=>{let ft=Pe.getAttribute("aria-expanded")==="true";Pe.setAttribute("aria-expanded",ft?"false":"true"),lt.hidden=ft}),lt.addEventListener("change",()=>{$t(),vt(),Oo()==="specific"&&so(1)}),document.addEventListener("click",ft=>{Ne.contains(ft.target)||(Pe.setAttribute("aria-expanded","false"),lt.hidden=!0)}),$t(),vt()})},ja=async(me,Ne,Pe)=>{let Ye=Ii("aipkit_wp_content_fetch_nonce");if(!Ye)throw new Error("WP content fetch nonce missing.");let lt=[],Et=1,ut=1;do{let Dt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Ye,post_types:me,post_status:Ne,target_store_id:Pe||"",paged:Et});(Array.isArray(Dt?.posts)?Dt.posts:[]).forEach(ft=>{lt.push({id:String(ft.id),title:ft.title||e(n("Post %s","gpt3-ai-content-generator"),ft.id)})});let $t=parseInt(Dt?.pagination?.total_pages||1,10);ut=Number.isNaN($t)?1:$t,Et+=1}while(Et<=ut);return lt},za=()=>qn?Array.from(qn.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(me=>{let Ne=me.closest(".aipkit_wp_content_list_item"),Pe=Ne?Ne.querySelector(".aipkit_wp_content_title"):null;return{id:String(me.value||""),title:Pe&&Pe.textContent.trim()||e(n("Post %s","gpt3-ai-content-generator"),me.value)}}):[],No=(me,Ne,Pe,Ye)=>{let lt=e(n("Post %s","gpt3-ai-content-generator"),me),Et=Ye&&Ye.get(String(me))||lt;return e(n("Training: %s (%d/%d)","gpt3-ai-content-generator"),Et,Ne+1,Pe)},Ro=async(me,Ne)=>{if(!window.aipkit_dashboard?.ajaxurl)throw new Error(n("AJAX configuration is missing.","gpt3-ai-content-generator"));me.set("action",Ne);let Pe=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:me,credentials:"same-origin"}),Ye=await Pe.json();if(!Pe.ok||!Ye.success){let lt=Ye?.data?.message||n("Upload failed.","gpt3-ai-content-generator");throw new Error(lt)}return Ye.data},wa=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`text_${Date.now()}`,ha=()=>{let me=Nn();return me||(Ui(n("Select an embedding model.","gpt3-ai-content-generator"),"warning"),vn(),null)},fr=async(me,Ne)=>{if(!window.aipkit_dashboard?.nonce)throw new Error(n("Embedding nonce missing.","gpt3-ai-content-generator"));let Pe=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:me,embedding_provider:Ne.provider,embedding_model:Ne.model,_ajax_nonce:window.aipkit_dashboard.nonce}),Ye=Pe.embeddings&&Pe.embeddings.length?Pe.embeddings[0]:null;if(!Ye)throw new Error(n("Failed to generate embedding.","gpt3-ai-content-generator"));return Ye},So=async({content:me,indexName:Ne,embedding:Pe,metadata:Ye})=>{let lt=Ii("aipkit_vector_store_pinecone_nonce_management");if(!lt)throw new Error(n("Pinecone nonce missing.","gpt3-ai-content-generator"));let Et=await fr(me,Pe);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:lt,vectors:JSON.stringify([{id:Ye.vector_id,values:Et,metadata:Ye}]),embedding_provider:Pe.provider,embedding_model:Pe.model,original_text_content:me,index_name:Ne})},mr=async({content:me,collectionName:Ne,embedding:Pe,metadata:Ye,sourceContext:lt})=>{let Et=Ii("aipkit_vector_store_qdrant_nonce_management");if(!Et)throw new Error(n("Qdrant nonce missing.","gpt3-ai-content-generator"));let ut=await fr(me,Pe),Dt={_ajax_nonce:Et,vectors:JSON.stringify([{id:Ye.vector_id,vector:ut,payload:Ye}]),embedding_provider:Pe.provider,embedding_model:Pe.model,original_text_content:me,collection_name:Ne,source_context:lt||"sources_module"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Dt)},io=async()=>{if($o)return;let me=to();if(!me){Ui(n("Select a provider and index first.","gpt3-ai-content-generator"),"warning"),vn();return}let Ne=Oi(),Pe="",Ye=[],lt=null,Et="text_entry_global_form",ut="file_upload_global_form";if(Ne==="text"){if(Pe=Ae?Ae.value.trim():"",!Pe){Ui(n("Add text to train.","gpt3-ai-content-generator"),"warning"),vn();return}}else if(Ne==="qa"){let vt=He?He.value.trim():"",$t=Oe?Oe.value.trim():"";if(!vt||!$t){Ui(n("Add a question and answer to train.","gpt3-ai-content-generator"),"warning"),vn();return}Pe=`Q: ${vt}
A: ${$t}`}else if(Ne==="files"){if(Ye=Qe?Array.from(Qe.files||[]):[],!Ye.length){Qe&&Qe.click(),Ui(n("Choose files to upload.","gpt3-ai-content-generator"),"warning"),vn();return}}else if(Ne==="website"){let vt=Oo(),$t=Ga(vt),ft=Ua(vt),Lt=bo();if(vt==="specific"&&!Lt.length){Ui(n("Select content to train.","gpt3-ai-content-generator"),"warning"),vn();return}if(vt==="bulk"&&!ft.length){Ui(n("Select at least one post type.","gpt3-ai-content-generator"),"warning"),vn();return}lt={mode:vt,statusValue:$t,postTypes:ft,selectedPostIds:Lt}}else{Ui(n("Select a training tab to continue.","gpt3-ai-content-generator"),"warning"),vn();return}let Dt=null;if(!((me.providerKey==="pinecone"||me.providerKey==="qdrant")&&(Dt=ha(),!Dt))){$o=!0,Va(!0),Rt.forEach(vt=>{vt.disabled=!0}),Ui(n("Preparing training...","gpt3-ai-content-generator"),"loading");try{if(Ne==="files"){Ln();for(let vt=0;vt<Ye.length;vt+=1){let $t=Ye[vt];Ui(e(n("Uploading %1$d of %2$d...","gpt3-ai-content-generator"),vt+1,Ye.length),"loading"),qi($t,n("Uploading","gpt3-ai-content-generator"),"loading");try{let ft=new FormData;if(me.providerKey==="openai"){let Lt=Ii("aipkit_vector_store_nonce_openai");if(!Lt)throw new Error(n("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));ft.append("aipkit_vs_global_file_to_submit",$t),ft.append("target_store_id",me.storeId),ft.append("source_type",ut),ft.append("_ajax_nonce",Lt);let fn=await Ro(ft,"aipkit_upload_and_add_file_to_store_direct_openai");qi($t,n("Processing","gpt3-ai-content-generator"),"loading");let oi=fn?.batch?.id;Zi($t,me.providerKey,me.storeId).then(ai=>{if(!ai){if(oi){ro(me.storeId,oi,$t);return}qi($t,n("Queued","gpt3-ai-content-generator"),"warning")}})}else if(me.providerKey==="pinecone"){let Lt=Ii("aipkit_vector_store_pinecone_nonce_management");if(!Lt)throw new Error(n("Pinecone nonce missing.","gpt3-ai-content-generator"));ft.append("file_to_upload",$t),ft.append("index_name",me.storeId),ft.append("embedding_provider",Dt.provider),ft.append("embedding_model",Dt.model),ft.append("_ajax_nonce",Lt),await Ro(ft,"aipkit_upload_file_and_upsert_to_pinecone"),qi($t,n("Trained","gpt3-ai-content-generator"),"success")}else if(me.providerKey==="qdrant"){let Lt=Ii("aipkit_vector_store_qdrant_nonce_management");if(!Lt)throw new Error(n("Qdrant nonce missing.","gpt3-ai-content-generator"));ft.append("file_to_upload",$t),ft.append("target_store_id",me.storeId),ft.append("embedding_provider",Dt.provider),ft.append("embedding_model",Dt.model),ft.append("source_context","sources_module_file_upload"),ft.append("_ajax_nonce",Lt),await Ro(ft,"aipkit_upload_file_and_upsert_to_qdrant"),qi($t,n("Trained","gpt3-ai-content-generator"),"success")}}catch(ft){throw qi($t,n("Failed","gpt3-ai-content-generator"),"error"),ft}}Qe&&(Qe.value=""),Ln(),Ui(n("Saved","gpt3-ai-content-generator"),"success"),sn(n("Saved","gpt3-ai-content-generator"),"success"),cn(),vn(),Fi(),yn(1);return}if(Ne==="website"&&lt){let{mode:vt,statusValue:$t,postTypes:ft}=lt,Lt=[],fn=new Map;if(vt==="bulk"){Ui(n("Preparing website content...","gpt3-ai-content-generator"),"loading");let oi=await ja(ft,$t,me.storeId);if(Lt=oi.map(ai=>ai.id),fn=new Map(oi.map(ai=>[String(ai.id),ai.title])),!Lt.length){sn(n("No posts found for selection.","gpt3-ai-content-generator"),"error"),Ui(n("Nothing to train.","gpt3-ai-content-generator"),"warning"),vn();return}}if(vt!=="bulk"){let oi=za();Lt=oi.map(ai=>ai.id),fn=new Map(oi.map(ai=>[String(ai.id),ai.title]))}if(Ui(n("Training...","gpt3-ai-content-generator"),"loading"),sn(e(n("Training %d item(s)...","gpt3-ai-content-generator"),Lt.length),""),me.providerKey==="openai"){let oi=Ii("aipkit_wp_content_index_nonce");if(!oi)throw new Error(n("WP content index nonce missing.","gpt3-ai-content-generator"));for(let ai=0;ai<Lt.length;ai+=1){let nn=Lt[ai];sn(No(nn,ai,Lt.length,fn),""),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{_ajax_nonce:oi,post_ids:[nn],target_store_id:me.storeId,provider:"openai"})}}else if(me.providerKey==="pinecone")for(let oi=0;oi<Lt.length;oi+=1){let ai=Lt[oi];sn(No(ai,oi,Lt.length,fn),"");let nn=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Ii("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[ai]}),Gi=nn.posts_content&&nn.posts_content[ai]?nn.posts_content[ai]:null;if(!Gi||!Gi.content)continue;let Eo=Bo(),Pn={source:"wordpress_post",created_at:new Date().toISOString(),post_id:ai,title:Gi.title||"",url:Gi.edit_link||"",vector_id:Eo};Pn.vector_id=Eo,await So({content:Gi.content,indexName:me.storeId,embedding:Dt,metadata:Pn})}else if(me.providerKey==="qdrant")for(let oi=0;oi<Lt.length;oi+=1){let ai=Lt[oi];sn(No(ai,oi,Lt.length,fn),"");let nn=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Ii("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[ai]}),Gi=nn.posts_content&&nn.posts_content[ai]?nn.posts_content[ai]:null;if(!Gi||!Gi.content)continue;let Eo=wa(),Pn={source:"wordpress_post",created_at:new Date().toISOString(),post_id:ai,title:Gi.title||"",url:Gi.edit_link||"",vector_id:Eo};await mr({content:Gi.content,collectionName:me.storeId,embedding:Dt,metadata:Pn,sourceContext:"sources_module_website"})}Ui(n("Saved","gpt3-ai-content-generator"),"success"),vn(),yn(1);return}if(me.providerKey==="openai"){let vt=Ii("aipkit_vector_store_nonce_openai");if(!vt)throw new Error(n("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:vt,target_store_id:me.storeId,text_content:Pe,source_type:Et})}else if(me.providerKey==="pinecone"){let vt=Bo(),$t={source:Et,created_at:new Date().toISOString(),original_content:Pe,vector_id:vt};await So({content:Pe,indexName:me.storeId,embedding:Dt,metadata:$t})}else if(me.providerKey==="qdrant"){let vt=Bo(),$t={source:Et,created_at:new Date().toISOString(),original_content:Pe,vector_id:vt};await mr({content:Pe,collectionName:me.storeId,embedding:Dt,metadata:$t,sourceContext:"sources_module_training"})}Ne==="text"&&Ae&&(Ae.value=""),Ne==="qa"&&(He&&(He.value=""),Oe&&(Oe.value="")),Ui(n("Saved","gpt3-ai-content-generator"),"success"),vn(),yn(1)}catch(vt){Ui(e(n("Error: %s","gpt3-ai-content-generator"),vt?.message||n("Training failed.","gpt3-ai-content-generator")),"error")}finally{$o=!1,Va(!1),$i(),Ln()}}};if(z.addEventListener("click",()=>{let me=te.hidden;te.hidden=!me,z.setAttribute("aria-expanded",me?"true":"false"),me&&($i(),Gn(),tn(R?R.value:""))}),fe){let me=fe.querySelector(".aipkit_builder_tab.is-active");me&&dt(me.dataset.aipkitTab),fe.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(Ne=>{Ne.addEventListener("click",()=>{dt(Ne.dataset.aipkitTab)})})}return je&&Qe&&je.addEventListener("click",()=>{Ha()&&Qe.click()}),Qe&&Qe.addEventListener("change",()=>{if(!Ha()){Qe.value="";return}let me=Array.from(Qe.files||[]);me.length&&(me.forEach(Ne=>{vo(Ne),qi(Ne,n("Queued","gpt3-ai-content-generator"))}),Ln(),io())}),Rt.forEach(me=>{me.addEventListener("click",io)}),yt&&yt.addEventListener("click",()=>{$o&&(yt.disabled=!0,Ui(n("Stopping...","gpt3-ai-content-generator"),"warning"))}),_i&&_i.addEventListener("change",()=>{let me=m(R?R.value:"");me&&(Ue.embeddingByProvider[me]=_i.value||"",u({provider:Ue.provider,status:Ue.status,type:Ue.type,indexByProvider:Ue.indexByProvider,embeddingByProvider:Ue.embeddingByProvider}))}),un.length&&un.forEach(me=>{me.addEventListener("change",()=>{me.checked&&zo(me.value)})}),Ti&&Ti.addEventListener("change",()=>{Oo()==="specific"&&so(1)}),Bt&&Bt.addEventListener("change",()=>{Oo()==="specific"&&so(1)}),Ka(),$i(),Gn(),tn(R?R.value:""),zo(Oo()),{updateTargetState:$i}})();R&&R.addEventListener("change",()=>{Ue.provider=R.value,Dn(Ue.provider),rn?.updateTargetState?.(),u({provider:Ue.provider,status:Ue.status,type:Ue.type,indexByProvider:Ue.indexByProvider,embeddingByProvider:Ue.embeddingByProvider}),yn(1)}),Di&&Di.addEventListener("click",()=>{m(R?R.value:"")&&(Ue.openIndexCreateOnOpen=!0,oa(Di))}),K&&K.addEventListener("change",()=>{Ue.status=K.value,u({provider:Ue.provider,status:Ue.status,type:Ue.type,indexByProvider:Ue.indexByProvider,embeddingByProvider:Ue.embeddingByProvider}),yn(1)}),re&&re.addEventListener("change",()=>{Ue.type=re.value,u({provider:Ue.provider,status:Ue.status,type:Ue.type,indexByProvider:Ue.indexByProvider,embeddingByProvider:Ue.embeddingByProvider}),yn(1)});let fa=()=>{if(!ve)return;let z=ve.value.trim();z!==Ue.search&&(Ue.search=z,yn(1))},dr=()=>{ve&&(ji&&window.clearTimeout(ji),ji=window.setTimeout(()=>{fa()},300))};if(ve&&(ve.addEventListener("input",dr),ve.addEventListener("search",fa),ve.addEventListener("keydown",z=>{z.key==="Enter"&&(z.preventDefault(),ji&&window.clearTimeout(ji),fa())})),H&&H.addEventListener("change",()=>{let z=m(R?R.value:"");z&&(Ue.indexByProvider[z]=H.value||"",u({provider:Ue.provider,status:Ue.status,type:Ue.type,indexByProvider:Ue.indexByProvider,embeddingByProvider:Ue.embeddingByProvider}),Un(),rn?.updateTargetState?.(),yn(1))}),Ie&&Ie.dataset.configListenersAttached!=="true"){let z=te=>{te.target.closest("[data-aipkit-provider-config]")&&ra()};Ie.addEventListener("input",z),Ie.addEventListener("change",z),Ie.dataset.configListenersAttached="true"}Wt&&Wt.addEventListener("click",Jn),Wi&&Wi.addEventListener("click",Jn),xt&&!xt.dataset.bound&&(document.addEventListener("keydown",z=>{z.key==="Escape"&&xt.classList.contains("aipkit-active")&&Jn()}),xt.dataset.bound="1"),Vn&&Vn.addEventListener("click",La),Se&&Se.addEventListener("click",La),Ve&&Ve.addEventListener("click",go),Tt&&Tt.addEventListener("click",go),st&&st.addEventListener("click",async()=>{if(!Fe)return;let z=Fe.dataset.provider||"",te=Fe.dataset.storeId||"",fe=Fe.dataset.vectorId||"",ue=Fe.dataset.logId||"";if(!z||!te||!fe||!ue){D(N,n("Missing source details.","gpt3-ai-content-generator"),"error"),Mn(),go();return}go();let Ae=null,He=[];if(L){let Oe=Fo(ue);if(Ae=L.querySelector(`tr[data-log-id="${Oe}"]`),Ae){He=Array.from(Ae.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")),He.forEach(je=>{je.disabled=!0,je.setAttribute("aria-disabled","true")});let Qe=Ae.querySelector(".aipkit_sources_action_delete");Qe&&(Qe.textContent=n("Deleting...","gpt3-ai-content-generator"))}}st&&(st.disabled=!0),D(N,n("Deleting...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:z,store_id:te,vector_id:fe,log_id:ue}),D(N,n("Deleted","gpt3-ai-content-generator"),"success"),Mn(),yn(Ue.page||1)}catch(Oe){let Qe=Oe&&Oe.message?Oe.message:n("Failed to delete source.","gpt3-ai-content-generator");D(N,`${n("Error:","gpt3-ai-content-generator")} ${Qe}`,"error"),Mn(),He.forEach(Ge=>{Ge.disabled=!1,Ge.removeAttribute("aria-disabled")});let je=Ae?Ae.querySelector(".aipkit_sources_action_delete"):null;je&&(je.textContent=n("Delete","gpt3-ai-content-generator"))}finally{st&&(st.disabled=!1)}}),Sn&&Sn.addEventListener("click",async()=>{if(!xt||!pi)return;let z=pi.value.trim();if(!z){D(N,n("Text cannot be empty.","gpt3-ai-content-generator"),"error"),Mn();return}let te=xt.dataset.provider||"",fe=xt.dataset.storeId||"",ue=xt.dataset.vectorId||"",Ae=xt.dataset.logId||"",He=xt.dataset.embeddingProvider||"",Oe=xt.dataset.embeddingModel||"";if(!te||!fe||!ue||!Ae){D(N,n("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}Jn();let Qe=[];if(L&&Ae){let je=Fo(Ae),Ge=L.querySelector(`tr[data-log-id="${je}"]`);Qe=Ge?Array.from(Ge.querySelectorAll(".aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[],Qe.forEach(gt=>{gt.disabled=!0,gt.setAttribute("aria-disabled","true"),gt.classList.contains("aipkit_sources_action_edit")&&(gt.textContent=n("Training...","gpt3-ai-content-generator"))})}D(N,n("Training...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:te,store_id:fe,vector_id:ue,log_id:Ae}),await ir(te,fe,z,He,Oe),D(N,n("Trained","gpt3-ai-content-generator"),"success"),Mn(),yn(Ue.page||1)}catch(je){let Ge=je&&je.message?je.message:n("Failed to save source.","gpt3-ai-content-generator");D(N,`${n("Error:","gpt3-ai-content-generator")} ${Ge}`,"error"),Mn(),Qe.forEach(gt=>{gt.disabled=!1,gt.removeAttribute("aria-disabled"),gt.classList.contains("aipkit_sources_action_edit")&&(gt.textContent=n("Edit","gpt3-ai-content-generator"))})}}),O.addEventListener("click",async z=>{let te=z.target.closest(".aipkit_sources_provider_create");if(te){let Qe=te.dataset.provider||"";Qe&&Mo(Qe,te);return}let fe=z.target.closest(".aipkit_sources_provider_delete_selected");if(fe){let Qe=m(R?R.value:fe.dataset.provider||""),je=H?H.value:"";if(!Qe||!je){let Rt=w(Qe);an(e(n("Select a %s to delete.","gpt3-ai-content-generator"),Rt.singular.toLowerCase()),"error"),kn();return}let Ge=H&&H.selectedOptions?H.selectedOptions[0]:null,gt=Ge?Ge.textContent:je;Po(Qe,je,gt,fe);return}let ue=z.target.closest(".aipkit_sources_action_edit");if(ue){er(ue);return}let Ae=z.target.closest(".aipkit_sources_action_view");if(Ae){let Qe=Ae.dataset.snippet||"";if(!Qe){D(N,n("No preview available for this source.","gpt3-ai-content-generator"),"error"),Mn();return}Cn(Qe);return}let He=z.target.closest(".aipkit_sources_action_delete");if(He){let Qe=He.dataset.provider||"",je=He.dataset.storeId||"",Ge=He.dataset.vectorId||"",gt=He.dataset.logId||"";if(!Qe||!je||!Ge||!gt){D(N,n("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}To({provider:Qe,storeId:je,vectorId:Ge,logId:gt});return}let Oe=z.target.closest(".aipkit_sources_action_retrain");if(Oe){let Qe=Oe.dataset.provider||"",je=Oe.dataset.storeId||"",Ge=Oe.dataset.vectorId||"",gt=Oe.dataset.logId||"",Rt=Oe.dataset.postId||"",ni=Oe.dataset.embeddingProvider||"",yt=Oe.dataset.embeddingModel||"";if(!Qe||!je||!Ge||!gt||!Rt){D(N,n("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}let Xi=Oe.closest("tr"),Ai=Xi?Array.from(Xi.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[];Ai.forEach(Mt=>{Mt.disabled=!0,Mt.setAttribute("aria-disabled","true")}),Oe.textContent=n("Training...","gpt3-ai-content-generator"),D(N,n("Retraining...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:Qe,store_id:je,vector_id:Ge,log_id:gt,post_id:Rt,embedding_provider:ni,embedding_model:yt}),D(N,n("Retrained","gpt3-ai-content-generator"),"success"),Mn(),yn(Ue.page||1)}catch(Mt){let _i=Mt&&Mt.message?Mt.message:n("Failed to retrain source.","gpt3-ai-content-generator");D(N,`${n("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Mn(),Ai.forEach(ki=>{ki.disabled=!1,ki.removeAttribute("aria-disabled")}),Oe.textContent=n("Retrain","gpt3-ai-content-generator")}}}),Ee&&Ee.addEventListener("click",()=>{oo()}),de&&de.addEventListener("click",z=>{z.preventDefault(),oo(),rr(),Ko()}),Re&&Re.addEventListener("click",z=>{z.preventDefault(),rr(),cr()}),ye&&ye.addEventListener("click",z=>{z.preventDefault(),da()}),ne&&ne.addEventListener("click",z=>{z.target===ne&&da()}),ze&&ze.addEventListener("click",z=>{z.preventDefault(),_a()}),De&&De.addEventListener("click",z=>{z.target===De&&_a()}),document.addEventListener("keydown",z=>{z.key==="Escape"&&ne&&ne.classList.contains("aipkit-active")&&da(),z.key==="Escape"&&De&&De.classList.contains("aipkit-active")&&_a()}),Ze&&Ze.addEventListener("change",()=>{let z=Ze.value;pa(z),ko(z),it&&(it.value=""),eo()}),it&&it.addEventListener("change",eo),Mi&&Mi.addEventListener("change",()=>{ua(),eo()}),ti&&(ti.addEventListener("input",eo),ti.addEventListener("change",eo)),wt&&(wt.addEventListener("input",eo),wt.addEventListener("change",eo)),at&&at.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode("[aipkit_semantic_search]",at)}),et&&et.addEventListener("submit",z=>{if(z.preventDefault(),!ei)return;let te=ei.value.trim();te&&lr(te)}),nt&&se&&(se.innerHTML=""),Dn(R?R.value:""),typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(O),typeof window.aipkitSources_initSettingsPopoverPanels=="function"&&window.aipkitSources_initSettingsPopoverPanels(O),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_sources_module_container"),yn(1)}window.aipkit_initSources=oe})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector("#aipkit_stats_settings_popover");if(!e)return;let i=Array.from(e.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||e.dataset.panelsBound==="true")return;let a=e.querySelector(".aipkit_model_settings_popover_title"),s=e.querySelector(".aipkit_model_settings_popover_back"),l=n.querySelector("#aipkit_stats_settings_trigger"),c={root:e.dataset.titleRoot||"Log Settings","log-retention":e.dataset.titleLogRetention||"Log retention"},o=null,t=r=>{let f=r||"root",u=e.querySelector(`[data-aipkit-settings-panel="${f}"]`)||e.querySelector('[data-aipkit-settings-panel="root"]');if(!u)return;let p=u.dataset.aipkitSettingsPanel||"root";p!==o&&(i.forEach(_=>{_.hidden=_!==u}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),o=p,e.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};e.addEventListener("click",r=>{let f=r.target.closest("[data-aipkit-panel-target]");if(!f)return;r.preventDefault();let u=f.dataset.aipkitPanelTarget;t(u)}),s&&s.addEventListener("click",r=>{r.preventDefault(),t("root")}),l&&l.addEventListener("click",()=>{t("root")}),t("root"),e.dataset.panelsBound="true"}window.aipkitStats_initSettingsPopoverPanels=k})();(function(){"use strict";let e="aipkit_stats_overview_open",i=t=>typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml(t):(t==null?"":String(t)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a=t=>{let r=Number(t||0);return Number.isNaN(r)?"0":r.toLocaleString()},s=t=>{let r=Number(t);if(!r)return"";let f=new Date(r*1e3);return Number.isNaN(f.getTime())?"":f.toLocaleString()},l=t=>{let r=Number(t);if(!r)return"";let f=Date.now()/1e3,u=Math.floor(f-r);if(Number.isNaN(u)||u<0)return s(r);if(u<60)return"Just now";let p=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],_=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let m of p)if(u>=m.seconds){let g=Math.floor(u/m.seconds);return _?_.format(-g,m.unit):`${g} ${m.unit}${g!==1?"s":""} ago`}return s(r)},c=t=>{if(typeof t=="string")return t;if(t==null)return"";try{return JSON.stringify(t,null,2)}catch{return String(t)}};function o(){let t=document.getElementById("aipkit_stats_container");if(!t)return;typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(t),typeof window.aipkitStats_initSettingsPopoverPanels=="function"&&window.aipkitStats_initSettingsPopoverPanels(t);let r={days:parseInt(t.dataset.defaultDays||30,10)||30,perPage:20,page:1,search:"",botId:"",module:"",selectedLogId:null},f=wp.i18n&&wp.i18n.__?wp.i18n.__:se=>se,u={page:1,search:"",botTitles:{}},p=null,_=null,m=null,g=!1,d={status:t.querySelector("#aipkit_stats_status"),overviewPanel:t.querySelector("#aipkit_stats_overview_panel"),overviewToggle:t.querySelector("#aipkit_stats_overview_toggle"),overviewPeriod:t.querySelector("#aipkit_stats_period_label"),totalConversations:t.querySelector("#aipkit_stats_total_conversations"),totalMessages:t.querySelector("#aipkit_stats_total_messages"),uniqueUsers:t.querySelector("#aipkit_stats_unique_users"),avgTokens:t.querySelector("#aipkit_stats_avg_tokens"),daysFilter:t.querySelector("#aipkit_stats_days_filter"),botFilter:t.querySelector("#aipkit_stats_bot_filter"),moduleFilter:t.querySelector("#aipkit_stats_module_filter"),searchInput:t.querySelector("#aipkit_stats_search_input"),exportBtn:t.querySelector("#aipkit_stats_export_btn"),deleteAllBtn:t.querySelector("#aipkit_stats_delete_all_btn"),tableMenu:t.querySelector("#aipkit_stats_table_menu"),tableMenuTrigger:t.querySelector("#aipkit_stats_table_menu_trigger"),tableBody:t.querySelector("#aipkit_stats_table_body"),pagination:t.querySelector("#aipkit_stats_pagination"),detailPanel:t.querySelector("#aipkit_stats_detail_panel"),conversationChart:t.querySelector("#aipkit_stats_conversation_chart"),moduleChart:t.querySelector("#aipkit_stats_module_chart"),settingsToggle:document.getElementById("aipkit_stats_auto_delete_toggle"),retentionSelect:document.getElementById("aipkit_stats_retention_days"),retentionRow:t.querySelector("[data-aipkit-stats-retention-row]"),cronRow:t.querySelector("[data-aipkit-stats-cron-row]"),cronStatus:document.getElementById("aipkit_stats_cron_status"),cronText:document.getElementById("aipkit_stats_cron_text"),cronLastRun:document.getElementById("aipkit_stats_cron_last_run"),settingsPopover:document.getElementById("aipkit_stats_settings_popover"),settingsTrigger:document.getElementById("aipkit_stats_settings_trigger"),settingsUsersNav:t.querySelector('[data-aipkit-settings-action="users"]'),userSheet:document.getElementById("aipkit_stats_user_sheet"),userSheetClose:document.getElementById("aipkit_stats_user_sheet_close"),userSearchInput:document.getElementById("aipkit_stats_user_search"),userTableBody:document.getElementById("aipkit_stats_user_table_body"),userTableFoot:document.querySelector("#aipkit_stats_user_sheet tfoot"),userPagination:document.getElementById("aipkit_stats_user_pagination"),userNoResults:document.getElementById("aipkit_stats_user_no_results"),shortcodeSnippet:document.getElementById("aipkit_stats_shortcode_snippet"),shortcodeToggle:document.getElementById("aipkit_stats_shortcode_toggle"),shortcodeConfig:document.getElementById("aipkit_stats_shortcode_config"),shortcodeOptions:t.querySelectorAll(".aipkit_stats_shortcode_option")},w=(()=>{try{let se=t.dataset.moduleLabels||"{}";return JSON.parse(se)}catch{return{}}})(),h=t.dataset.isPro==="1",b=t.dataset.userCreditsNonce||"",A=(se,be="")=>{if(!d.status)return;let xe=d.status,Re=xe.classList.contains("aipkit_training_status");if(xe.textContent=se||"",xe.classList.remove("aipkit_status_error","aipkit_status_success","aipkit_status_warning","aipkit_status_loading"),Re){xe.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),se&&xe.classList.add("is-visible"),be&&xe.classList.add(`is-${be}`);return}xe.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),be==="success"?xe.classList.add("aipkit_form-help-success"):be==="error"&&xe.classList.add("aipkit_form-help-error")},S=()=>{try{return localStorage.getItem(e)==="1"}catch{return!1}},I=se=>{d.retentionRow&&(d.retentionRow.hidden=!se),d.cronRow&&(d.cronRow.hidden=!se),d.retentionSelect&&(d.retentionSelect.disabled=!se||!h)},T=se=>{!se||!d.cronStatus||(se.state&&d.cronStatus.setAttribute("data-state",se.state),d.cronText&&se.status_text&&(d.cronText.textContent=se.status_text),d.cronLastRun&&se.last_run_label&&(d.cronLastRun.textContent=se.last_run_label))},x=se=>{d.tableBody&&(d.tableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${i(se)}</td>
                </tr>
            `)},E=se=>{d.userTableBody&&(d.userTableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${i(se)}</td>
                </tr>
            `,d.userNoResults&&(d.userNoResults.hidden=!0))},v=se=>{if(!se)return f("N/A","gpt3-ai-content-generator");let be=new Date(se*1e3);return Number.isNaN(be.getTime())?f("N/A","gpt3-ai-content-generator"):be.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},y=(se,be)=>{let xe=Array.isArray(se)?se:[],Re='<ul class="aipkit_stats_usage_list">';return xe.length?(xe.forEach((De,ze)=>{let Ze=ze>=2;Re+=`<li class="${Ze?"aipkit_stats_usage_extra":""}"${Ze?" hidden":""}>${De}</li>`}),Re+="</ul>",{html:Re,hasToggle:xe.length>2}):(Re+=`<li>${i(be)}</li>`,Re+="</ul>",{html:Re,hasToggle:!1})},C=(se,be)=>{if(!d.userTableBody)return;if(d.userTableBody.innerHTML="",!Array.isArray(se)||se.length===0){d.userNoResults&&(d.userNoResults.hidden=!1);return}d.userNoResults&&(d.userNoResults.hidden=!0);let xe=be||{};se.forEach(Re=>{let De=document.createElement("tr");De.dataset.userId=Re.id;let ze=document.createElement("td");ze.textContent=`${Re.display_name} (${Re.email})`,De.appendChild(ze);let Ze=document.createElement("td"),it=document.createElement("input");it.type="number",it.className="aipkit_form-input aipkit_stats_credits_balance_input",it.value=Re.token_balance||0,it.dataset.userId=Re.id,it.dataset.originalValue=Re.token_balance||0,it.setAttribute("min","0"),it.setAttribute("step","1"),it.title=f("Press Enter or blur to save changes","gpt3-ai-content-generator"),Ze.appendChild(it);let Pt=document.createElement("span");Pt.className="aipkit_stats_credits_balance_status",Ze.appendChild(Pt),De.appendChild(Ze);let Mi=document.createElement("td");Mi.textContent=a(Re.total_used_all_bots||0),De.appendChild(Mi);let Qt=document.createElement("td"),ti=[],wt=Re.tokens_used||{},at=Re.image_usage||{used:0};at.used>0&&ti.push(`<strong>${i(f("Image Generator","gpt3-ai-content-generator"))}:</strong> ${a(at.used)}`),Object.keys(wt||{}).sort((Wt,Wi)=>Number(Wt)-Number(Wi)).forEach(Wt=>{let Wi=wt[Wt]||0;if(Wi<=0)return;let Sn=xe[Wt]||`Bot #${Wt}`;ti.push(`<strong>${i(Sn)}:</strong> ${a(Wi)}`)});let et=y(ti,"-");Qt.innerHTML=et.html+(et.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${i(f("Show more","gpt3-ai-content-generator"))}...</button>`:""),De.appendChild(Qt);let ei=document.createElement("td"),li=[],Jt=Re.last_reset||{};at.used>0&&li.push(`<strong>${i(f("Image Generator","gpt3-ai-content-generator"))}:</strong> ${i(v(at.last_reset))}`);let Ut=new Set([...Object.keys(wt||{}),...Object.keys(Jt||{})]);Array.from(Ut).sort((Wt,Wi)=>Number(Wt)-Number(Wi)).forEach(Wt=>{if((wt||{})[Wt]<=0)return;let Wi=xe[Wt]||`Bot #${Wt}`;li.push(`<strong>${i(Wi)}:</strong> ${i(v(Jt[Wt]||0))}`)});let Di=ti.length>0?f("N/A","gpt3-ai-content-generator"):"-",xt=y(li,Di);ei.innerHTML=xt.html+(xt.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${i(f("Show more","gpt3-ai-content-generator"))}...</button>`:""),De.appendChild(ei);let pi=document.createElement("td");if(pi.className="aipkit_stats_user_actions_cell",Re.purchase_history&&Re.purchase_history.length){let Wt=document.createElement("button");Wt.type="button",Wt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_stats_purchase_history_btn",Wt.title=f("View purchase history","gpt3-ai-content-generator"),Wt.innerHTML='<span class="dashicons dashicons-cart" aria-hidden="true"></span>',Wt.dataset.userName=Re.display_name,Wt.dataset.history=JSON.stringify(Re.purchase_history),pi.appendChild(Wt)}else pi.textContent="-";De.appendChild(pi),d.userTableBody.appendChild(De)})},M=se=>{if(!d.userPagination||!d.userTableFoot)return;d.userPagination.innerHTML="";let be=Number(se?.total_users||0),xe=Number(se?.total_pages||0),Re=Number(se?.current_page||1);if(!be){d.userTableFoot.hidden=!0;return}let De=document.createElement("span");if(De.className="aipkit_pagination-count",De.textContent=`${be.toLocaleString()} ${f("users","gpt3-ai-content-generator")}`,d.userPagination.appendChild(De),xe<=1){d.userTableFoot.hidden=!0;return}let ze=document.createElement("span");ze.className="aipkit_pagination-links";let Ze=document.createElement("button");Ze.type="button",Ze.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Ze.textContent=`\xAB ${f("Previous","gpt3-ai-content-generator")}`,Ze.disabled=Re<=1,Ze.addEventListener("click",()=>B(Re-1,u.search));let it=document.createElement("span");it.className="aipkit_pagination-current",it.textContent=`${f("Page","gpt3-ai-content-generator")} ${Re} ${f("of","gpt3-ai-content-generator")} ${xe}`;let Pt=document.createElement("button");Pt.type="button",Pt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Pt.textContent=`${f("Next","gpt3-ai-content-generator")} \xBB`,Pt.disabled=Re>=xe,Pt.addEventListener("click",()=>B(Re+1,u.search)),ze.appendChild(Ze),ze.appendChild(it),ze.appendChild(Pt),d.userPagination.appendChild(ze),d.userTableFoot.hidden=!1},B=async(se=1,be="")=>{if(!(!d.userTableBody||typeof window.aipkit_apiRequest!="function")){E(f("Loading user credits...","gpt3-ai-content-generator")),u.page=se,u.search=be;try{let xe=await window.aipkit_apiRequest("aipkit_get_user_credits_data",{page:se,search:be});u.botTitles=xe.bot_titles||{},C(xe.users_data||[],u.botTitles),M(xe.pagination||{})}catch(xe){d.userTableBody&&(d.userTableBody.innerHTML=`
                        <tr>
                            <td colspan="6" class="aipkit_stats_table_placeholder aipkit_text-danger">${i(xe.message||f("Error loading user credits.","gpt3-ai-content-generator"))}</td>
                        </tr>
                    `),d.userNoResults&&(d.userNoResults.hidden=!0),d.userTableFoot&&(d.userTableFoot.hidden=!0)}}},D=()=>{d.settingsPopover&&(d.settingsPopover.classList.remove("aipkit-active"),d.settingsPopover.setAttribute("aria-hidden","true"),d.settingsTrigger&&d.settingsTrigger.setAttribute("aria-expanded","false"))},W=()=>{d.userSheet&&(d.userSheet.classList.add("aipkit-active"),d.userSheet.setAttribute("aria-hidden","false"),B(u.page,u.search),d.userSearchInput&&d.userSearchInput.focus())},U=()=>{d.userSheet&&(d.userSheet.classList.remove("aipkit-active"),d.userSheet.setAttribute("aria-hidden","true"))},J=()=>{if(!d.shortcodeSnippet||!d.shortcodeOptions)return;let se=!0,be=!0,xe=!0;d.shortcodeOptions.forEach(ze=>{ze.name==="cfg_show_chatbot"&&(se=ze.checked),ze.name==="cfg_show_aiforms"&&(be=ze.checked),ze.name==="cfg_show_imagegenerator"&&(xe=ze.checked)});let Re=[];se||Re.push('chatbot="false"'),be||Re.push('aiforms="false"'),xe||Re.push('imagegenerator="false"');let De="[aipkit_token_usage";Re.length&&(De+=` ${Re.join(" ")}`),De+="]",d.shortcodeSnippet.textContent=De},oe=(se,be)=>{let xe=Array.isArray(se)?se:[],Re=document.createElement("div");Re.className="aipkit-modal-overlay aipkit-active";let De=()=>xe.length?xe.map(Ze=>{let it=Ze?.date?.date?new Date(Ze.date.date):null,Pt=it&&!Number.isNaN(it.getTime())?it.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"",Mi=(Ze.products||[]).map(Qt=>`
                                <div class="aipkit_stats_purchase_product">
                                    <span class="aipkit_stats_purchase_product_name">${i(Qt.name)}</span>
                                    <span class="aipkit_stats_purchase_product_meta">
                                        ${Qt.quantity>1?`${Number(Qt.quantity)}x `:""}
                                        ${a(Qt.tokens_per_item)} ${i(f("tokens","gpt3-ai-content-generator"))}
                                    </span>
                                </div>
                            `).join("");return`
                            <div class="aipkit_stats_purchase_item">
                                <div class="aipkit_stats_purchase_header">
                                    <div class="aipkit_stats_purchase_date">${i(Pt)}</div>
                                    <div class="aipkit_stats_purchase_summary">
                                        <span class="aipkit_stats_purchase_tokens">+${a(Ze.tokens_granted)}</span>
                                        <span class="aipkit_stats_purchase_amount">${i(Ze.total_amount)} ${i(Ze.currency)}</span>
                                    </div>
                                </div>
                                <div class="aipkit_stats_purchase_order">${i(f("Order #","gpt3-ai-content-generator"))}${i(Ze.order_id)}</div>
                                ${Mi?`<div class="aipkit_stats_purchase_products">${Mi}</div>`:""}
                            </div>
                        `}).join(""):`<p>${i(f("No purchase history found for this user.","gpt3-ai-content-generator"))}</p>`;Re.innerHTML=`
                <div class="aipkit-modal-content aipkit_stats_purchase_modal">
                    <div class="aipkit-modal-header">
                        <h3 class="aipkit-modal-title">${i(f("Purchase History for","gpt3-ai-content-generator"))} ${i(be||"")}</h3>
                        <button class="aipkit-modal-close-btn" type="button" aria-label="${i(f("Close","gpt3-ai-content-generator"))}">&times;</button>
                    </div>
                    <div class="aipkit-modal-body">
                        <div class="aipkit_stats_purchase_history_list">${De()}</div>
                    </div>
                </div>
            `;let ze=()=>{Re.classList.remove("aipkit-active"),window.setTimeout(()=>{Re.parentNode&&Re.parentNode.removeChild(Re)},200)};Re.addEventListener("click",Ze=>{Ze.target===Re&&ze()}),Re.querySelector(".aipkit-modal-close-btn")?.addEventListener("click",ze),document.body.appendChild(Re)},O=se=>{if(!se)return;let be=se.dataset.userId,xe=se.parentElement?se.parentElement.querySelector(".aipkit_stats_credits_balance_status"):null,Re=se.dataset.originalValue||se.defaultValue,De=se.value;if(String(De)!==String(Re)){if(!b){xe&&(xe.textContent="ERR");return}xe&&(xe.innerHTML='<span class="aipkit_spinner"></span>'),clearTimeout(m),m=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",{_ajax_nonce:b,user_id:be,balance:De}).then(ze=>{xe&&(xe.textContent="OK"),se.dataset.originalValue=ze.new_balance,window.setTimeout(()=>{xe&&(xe.textContent="")},1500)}).catch(()=>{xe&&(xe.textContent="ERR"),se.value=Re,window.setTimeout(()=>{xe&&(xe.textContent="")},2500)})},400)}},L=se=>{if(!d.conversationChart)return;d.conversationChart.innerHTML="";let be=Object.entries(se||{});if(!be.length){d.conversationChart.innerHTML=`<div class="aipkit_stats_table_placeholder">${i("No data available.")}</div>`;return}let xe=Math.max(...be.map(([,ti])=>Number(ti)||0),1),Re=document.createElement("div");Re.className="aipkit_stats_chart_wrapper";let De=document.createElement("div");De.className="aipkit_stats_y_axis";let ze=4;for(let ti=ze;ti>=0;ti--){let wt=document.createElement("span");wt.className="aipkit_stats_y_label";let at=Math.round(xe/ze*ti);wt.textContent=at>=1e3?`${(at/1e3).toFixed(1)}k`:at,De.appendChild(wt)}Re.appendChild(De);let Ze=document.createElement("div");Ze.className="aipkit_stats_bars_container";for(let ti=0;ti<ze;ti++){let wt=document.createElement("div");wt.className="aipkit_stats_grid_line",wt.style.bottom=`${(ti+1)/ze*100}%`,Ze.appendChild(wt)}let it=document.createElement("div");it.className="aipkit_stats_bars_wrapper",be.forEach(([ti,wt])=>{let at=document.createElement("div");at.className="aipkit_stats_bar_group";let et=document.createElement("div"),ei=Math.max(2,Math.round(Number(wt)/xe*100));et.className="aipkit_stats_bar",et.style.height=`${ei}%`,et.title=`${ti}: ${wt}`,at.appendChild(et),it.appendChild(at)}),Ze.appendChild(it),Re.appendChild(Ze);let Pt=document.createElement("div");Pt.className="aipkit_stats_x_axis";let Mi=Math.min(be.length,7),Qt=Math.max(1,Math.floor(be.length/Mi));be.forEach(([ti],wt)=>{let at=document.createElement("span");if(at.className="aipkit_stats_x_label",wt%Qt===0||wt===be.length-1){let et=ti.split("-");at.textContent=et.length>=3?`${et[1]}/${et[2]}`:ti}Pt.appendChild(at)}),Re.appendChild(Pt),d.conversationChart.appendChild(Re)},F=se=>{if(d.moduleChart){if(typeof window.aipkit_renderTokenUsageChart!="function"){d.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${i("Chart renderer unavailable.")}</p>`;return}if(!se||Object.keys(se).length===0){d.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${i("No data available.")}</p>`;return}window.aipkit_renderTokenUsageChart(d.moduleChart,se)}},N=se=>se?w[se]?w[se]:se.replace(/[_-]/g," ").replace(/\b\w/g,be=>be.toUpperCase()):w.chatbot||"Chatbot",R=se=>{if(!d.tableBody)return;if(!Array.isArray(se)||!se.length){x("No logs found.");return}let be=se.map(xe=>{let Re=xe.last_message_content?String(xe.last_message_content):"",De=l(xe.last_message_ts),ze=s(xe.last_message_ts),Ze=a(xe.total_conversation_tokens||0),it=Number(xe.id);return`
                    <tr class="aipkit_stats_row${r.selectedLogId===it?" aipkit_stats_row_active":""}" data-log-id="${i(xe.id)}">
                        <td title="${i(ze)}">${i(De)}</td>
                        <td>${i(xe.user_display_name||"\u2014")}</td>
                        <td>${i(xe.bot_name||N(xe.module))}</td>
                        <td>${i(a(xe.message_count||0))}</td>
                        <td>${i(Ze)}</td>
                        <td><span class="aipkit_stats_preview">${i(Re)}</span></td>
                    </tr>
                `});d.tableBody.innerHTML=be.join("")},H=()=>({days:r.days,bot_id:r.botId,module:r.module,search:r.search}),K=(se,be)=>{let xe=new Blob([se],{type:"text/csv;charset=utf-8;"}),Re=URL.createObjectURL(xe),De=document.createElement("a");De.href=Re,De.download=be||"aipkit-logs.csv",document.body.appendChild(De),De.click(),De.remove(),URL.revokeObjectURL(Re)},re=async se=>{if(!(!se||!window.confirm("Delete this conversation?"))){A("Deleting conversation...");try{let xe=await window.aipkit_apiRequest("aipkit_stats_delete_log",{log_id:se});A(xe.message||"Conversation deleted."),r.selectedLogId===Number(se)&&(r.selectedLogId=null,pe(null)),ae(),window.setTimeout(()=>A(""),2e3)}catch(xe){A(xe.message||"Failed to delete conversation.","error")}}},ve=async()=>{if(window.confirm("Delete all logs that match the current filters?")){A("Deleting logs...");try{let be=await window.aipkit_apiRequest("aipkit_stats_delete_logs",H());A(be.message||"Logs deleted."),r.selectedLogId=null,pe(null),ae(),window.setTimeout(()=>A(""),2500)}catch(be){A(be.message||"Failed to delete logs.","error")}}},Ie=async()=>{A("Preparing export...");try{let se=await window.aipkit_apiRequest("aipkit_stats_export_logs",H());if(!se||!se.csv)throw new Error("Export failed.");K(se.csv,se.filename),A(se.message||"Export ready."),window.setTimeout(()=>A(""),2e3)}catch(se){A(se.message||"Failed to export logs.","error")}},Ee=se=>{if(!d.tableMenu||!d.tableMenuTrigger)return;let be=se??d.tableMenu.hidden;d.tableMenu.hidden=!be,d.tableMenuTrigger.setAttribute("aria-expanded",be?"true":"false")},Z=se=>{if(d.pagination){if(typeof window.aipkit_renderLogsPagination=="function"){window.aipkit_renderLogsPagination(se,d.pagination,be=>{r.page=be,ae()});return}d.pagination.innerHTML=""}},pe=se=>{if(!d.detailPanel)return;if(!se){d.detailPanel.innerHTML=`
                    <div class="aipkit_stats_detail_empty">
                        <div>
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.4; margin-bottom: 12px;">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <div>${i("Select a conversation to view details.")}</div>
                        </div>
                    </div>
                `;return}let be=at=>{let et=(at||"").toLowerCase();return et==="assistant"||et==="model"||et==="bot"?"bot":et==="user"?"user":et||"unknown"},xe=(at,et)=>{for(let ei=et+1;ei<at.length;ei+=1)if(be(at[ei]?.role)==="bot")return at[ei];return null},Re=at=>at>=85?"is-excellent":at>=70?"is-good":at>=50?"is-fair":"is-poor",De=`
                <div class="aipkit_stats_detail_header">
                    <div class="aipkit_stats_detail_title">${i(se.user_display_name||"User")}</div>
                    <div class="aipkit_stats_detail_meta">
                        ${i(se.bot_name||N(se.module))}
                        &middot; ${i(s(se.last_message_ts))}
                        &middot; ${i(a(se.message_count||0))} ${i("messages")}
                        ${se.ip_address?`&middot; ${i(`IP ${se.ip_address}`)}`:""}
                    </div>
                </div>
            `,ze=Array.isArray(se.messages)?se.messages:[],Ze=String(se.module||"").toLowerCase().replace(/[\s-]+/g,"_"),it=(()=>{if(typeof window.markdownit!="function")return null;let at=window.markdownit({html:!1,linkify:!0,typographer:!0});return window.hljs&&typeof window.markdownitHighlight=="function"&&at.use(window.markdownitHighlight,{hljs:window.hljs}),at})(),Pt=at=>{let et=String(at||"").trim().toLowerCase();return et?et.startsWith("generate ")||et.startsWith("content writer request"):!1},Mi=at=>{if(!at||typeof at!="object")return null;let et=at.payload_sent;if(!et||typeof et!="object")return null;let ei=Array.isArray(et.messages)?et.messages:Array.isArray(et.input)?et.input:null;if(!Array.isArray(ei))return null;let li=ei.find(Jt=>Jt&&Jt.role==="user"&&typeof Jt.content=="string"&&Jt.content.trim());return li?li.content.trim():null},Qt=(at,et)=>{if(!at||typeof at!="object")return null;let ei={"generate excerpt":"custom_excerpt_prompt","generate tags":"custom_tags_prompt","generate meta description":"custom_meta_prompt","generate focus keyword":"custom_keyword_prompt","generate image prompt":"image_prompt","generate featured image":"featured_image_prompt","generate title":"custom_title_prompt"},li=String(et||"").trim().toLowerCase(),Jt=ei[li];if(!Jt||typeof at[Jt]!="string")return null;let Ut=at[Jt].trim();return Ut||null},ti=at=>{if(!at||typeof at!="object")return null;for(let et in at){if(!Object.prototype.hasOwnProperty.call(at,et)||!/_prompt$/i.test(et))continue;let ei=at[et];if(typeof ei=="string"&&ei.trim())return ei.trim()}return null};if(Ze==="content_writer"&&Array.isArray(ze)&&ze.length)for(let at=0;at<ze.length;at+=1){let et=ze[at];if(!et||et.role!=="user"||typeof et.content!="string")continue;let ei=et.content.trim();if(!ei||!Pt(ei))continue;let li=null,Jt=ze[at+1]?.request_payload;Jt&&(li=Mi(Jt)),!li&&et.request_payload&&(li=Mi(et.request_payload)),!li&&et.request_payload&&(li=Qt(et.request_payload,ei)),!li&&et.request_payload&&(li=ti(et.request_payload)),li&&(et.original_content=et.content,et.content=li)}let wt=ze.map((at,et)=>{let ei=be(at.role),li=s(at.timestamp),Jt=c(at.content),Ut=ei==="user"?"User":ei==="bot"?"Assistant":ei,xt=String(at.message_id||`msg_${et}`).replace(/[^a-zA-Z0-9_-]/g,"")||`msg_${et}`,pi=[],Wt="",Wi="",Sn="";if(ei==="user"){let Tt=xe(ze,et),st=Tt?.provider||"",qt=Tt?.model||"",fi=Tt?.usage?.total_tokens??Tt?.usage?.totalTokenCount??null;st&&pi.push(st),qt&&pi.push(qt),typeof fi=="number"&&fi>0&&pi.push(`${a(fi)} tokens`);let Ht=Tt?.request_payload||null;if(pi.length||Ht)if(Ht){let hi=`aipkit_stats_payload_${xt}`,mi=pi.length?pi.join(" / "):"Request payload";Wt=`
                                <button type="button" class="aipkit_stats_meta_toggle" data-aipkit-stats-toggle="${hi}" aria-expanded="false">
                                    <span>${i(mi)}</span>
                                    <span class="aipkit_stats_meta_chevron" aria-hidden="true"></span>
                                </button>
                            `,Sn+=`
                                <div class="aipkit_stats_expandable" id="${hi}" hidden>
                                    <div class="aipkit_stats_expandable_header">${i("Request Payload")}</div>
                                    <div class="aipkit_stats_expandable_body">
                                        <pre class="aipkit_stats_payload">${i(JSON.stringify(Ht,null,2))}</pre>
                                    </div>
                                </div>
                            `}else pi.length&&(Wt=`<div class="aipkit_stats_meta_info">${i(pi.join(" / "))}</div>`)}if(ei==="bot"){let Tt=Array.isArray(at.vector_search_scores)?at.vector_search_scores:[];if(Tt.length>0){let st=Tt.reduce((mi,Bi)=>{let gi=Number(mi?.score??0);return Number(Bi?.score??0)>gi?Bi:mi},Tt[0]),qt=st?.score!==void 0?Math.round(Number(st.score)*100):0,fi=Re(qt),Ht=`aipkit_stats_scores_${xt}`;Wi=`
                            <button type="button" class="aipkit_stats_score_badge ${fi}" data-aipkit-stats-toggle="${Ht}" aria-expanded="false">
                                ${i(`Score ${qt}%`)}
                            </button>
                        `;let hi=Tt.map(mi=>{let Bi=mi?.provider||"Unknown",gi="";if(Bi==="OpenAI")gi=mi.store_name||mi.store_id?` \xB7 ${mi.store_name||mi.store_id}`:"";else if(Bi==="Pinecone"){let ui=mi.namespace?` \xB7 ${mi.namespace}`:"";gi=mi.index_name?` \xB7 ${mi.index_name}${ui}`:ui}else Bi==="Qdrant"&&(gi=mi.collection_name?` \xB7 ${mi.collection_name}`:"");let ii=mi?.score!==void 0?Math.round(Number(mi.score)*100):null,ji=ii!==null?Re(ii):"is-poor",Ue=mi?.content_preview||"";return`
                                <div class="aipkit_stats_score_item">
                                    <div class="aipkit_stats_score_title">${i(Bi)}${i(gi)}</div>
                                    <div class="aipkit_stats_score_value ${ji}">
                                        ${i(ii!==null?`${ii}%`:"\u2014")}
                                    </div>
                                    <div class="aipkit_stats_score_preview">${i(Ue)}</div>
                                </div>
                            `}).join("");Sn+=`
                            <div class="aipkit_stats_expandable" id="${Ht}" hidden>
                                <div class="aipkit_stats_expandable_header">${i("Vector Search Results")}</div>
                                <div class="aipkit_stats_expandable_body aipkit_stats_scores_list">
                                    ${hi}
                                </div>
                            </div>
                        `}}let Ki=!!Wt,ln=!!Wi,Se=Ki||ln?`
                    <div class="aipkit_stats_meta_bar${Ki&&!ln||!Ki&&ln?" aipkit_stats_meta_bar--compact":""}">
                        ${Ki?Wt:""}
                        <div class="aipkit_stats_meta_actions">
                            ${Wi||""}
                        </div>
                    </div>
                `:"",Fe=!!(it&&typeof Jt=="string"),Ve=Fe?it.render(Jt):i(Jt);return`
                    <div class="aipkit_stats_message aipkit_stats_message--${i(ei)}" style="animation-delay: ${et*.05}s">
                        <div class="aipkit_stats_message_meta">${i(Ut)}${li?` \xB7 ${i(li)}`:""}</div>
                        <div class="aipkit_stats_message_body${Fe?" aipkit_stats_message_body--markdown":""}">${Ve}</div>
                        ${Se}
                        ${Sn}
                    </div>
                `}).join("");d.detailPanel.innerHTML=`
                ${De}
                <div class="aipkit_stats_detail_messages">
                    ${wt||`<div class="aipkit_stats_table_placeholder">${i("No messages found.")}</div>`}
                    <div class="aipkit_stats_detail_footer">
                        <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_stats_detail_delete" data-log-id="${i(se.id)}">
                            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                            ${i("Delete")}
                        </button>
                    </div>
                </div>
            `},we=async()=>{A("Loading stats...");try{let se=await window.aipkit_apiRequest("aipkit_stats_get_overview",{days:r.days});d.totalConversations.textContent=a(se.summary?.total_conversations||0),d.totalMessages.textContent=a(se.summary?.total_messages||0),d.uniqueUsers.textContent=a(se.summary?.unique_users||0),d.avgTokens.textContent=a(se.summary?.avg_tokens||0),d.overviewPeriod&&(d.overviewPeriod.textContent=se.summary?.period_label||""),L(se.charts?.daily_conversations||{}),F(se.charts?.daily_tokens||{}),A("")}catch(se){A(se.message||"Failed to load stats.","error")}},de=(se,be=!0)=>{if(d.overviewPanel){if(d.overviewPanel.hidden=!se,d.overviewToggle&&(d.overviewToggle.setAttribute("aria-expanded",se?"true":"false"),d.overviewToggle.classList.toggle("is-active",se)),be)try{localStorage.setItem(e,se?"1":"0")}catch{}se&&we()}},ae=async()=>{x("Loading logs...");try{let se=await window.aipkit_apiRequest("aipkit_stats_get_logs",{days:r.days,page:r.page,per_page:r.perPage,bot_id:r.botId,module:r.module,search:r.search}),be=Array.isArray(se.logs)?se.logs:[];!r.selectedLogId&&!g&&be.length&&(r.selectedLogId=Number(be[0].id),g=!0),R(be),Z(se.pagination||{}),r.selectedLogId&&g&&ne(r.selectedLogId)}catch(se){x(se.message||"Failed to load logs.")}},ne=async se=>{if(!se){pe(null);return}d.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${i("Loading conversation...")}</div>`;try{let be=await window.aipkit_apiRequest("aipkit_stats_get_log_detail",{log_id:se});pe(be)}catch(be){d.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${i(be.message||"Failed to load conversation.")}</div>`}},ye=se=>{r.search=se.trim(),r.page=1,p&&clearTimeout(p),p=window.setTimeout(()=>{ae()},300)},Me=async()=>{if(d.cronStatus)try{let se=await window.aipkit_apiRequest("aipkit_stats_get_log_cron_status",{});T(se)}catch{}},nt=async()=>{if(!d.settingsToggle||!d.retentionSelect)return;let se=d.settingsToggle.checked?"1":"0",be=parseInt(d.retentionSelect.value,10)||90;A("Saving settings...","loading");try{let xe=await window.aipkit_apiRequest("aipkit_stats_save_settings",{enable_pruning:se,retention_period_days:be});I(d.settingsToggle.checked),A(xe.message||"Settings saved.","success"),Me(),window.setTimeout(()=>A(""),2e3)}catch(xe){A(xe.message||"Failed to save settings.","error")}};if(d.daysFilter&&(d.daysFilter.value=String(r.days),d.daysFilter.addEventListener("change",()=>{r.days=parseInt(d.daysFilter.value,10)||30,r.page=1,d.overviewPanel&&!d.overviewPanel.hidden&&we(),ae()})),d.botFilter&&d.botFilter.addEventListener("change",()=>{r.botId=d.botFilter.value,r.page=1,ae()}),d.moduleFilter&&d.moduleFilter.addEventListener("change",()=>{r.module=d.moduleFilter.value,r.page=1,ae()}),d.searchInput&&d.searchInput.addEventListener("input",se=>{ye(se.target.value||"")}),d.overviewToggle&&d.overviewPanel&&d.overviewToggle.addEventListener("click",()=>{let se=!d.overviewPanel.hidden;de(!se)}),d.tableBody&&d.tableBody.addEventListener("click",se=>{let be=se.target.closest("tr[data-log-id]");if(!be)return;let xe=be.getAttribute("data-log-id");xe&&(r.selectedLogId=Number(xe),d.tableBody.querySelectorAll("tr").forEach(Re=>{Re.classList.toggle("aipkit_stats_row_active",Re===be)}),ne(xe))}),d.detailPanel&&d.detailPanel.addEventListener("click",se=>{let be=se.target.closest(".aipkit_stats_detail_delete");if(!be){let xe=se.target.closest("[data-aipkit-stats-toggle]");if(!xe)return;let Re=xe.getAttribute("data-aipkit-stats-toggle");if(!Re)return;let De=document.getElementById(Re);if(!De)return;let ze=xe.getAttribute("aria-expanded")==="true";De.hidden=ze,xe.setAttribute("aria-expanded",ze?"false":"true"),xe.classList.toggle("is-expanded",!ze);return}re(be.getAttribute("data-log-id"))}),d.tableMenuTrigger&&d.tableMenu&&d.tableMenuTrigger.addEventListener("click",se=>{se.preventDefault(),se.stopPropagation(),Ee(d.tableMenu.hidden)}),document.addEventListener("click",se=>{!d.tableMenu||d.tableMenu.hidden||se.target.closest("#aipkit_stats_table_menu")||se.target.closest("#aipkit_stats_table_menu_trigger")||Ee(!1)}),document.addEventListener("keydown",se=>{se.key!=="Escape"||!d.tableMenu||d.tableMenu.hidden||Ee(!1)}),d.deleteAllBtn&&d.deleteAllBtn.addEventListener("click",()=>{Ee(!1),ve()}),d.exportBtn&&d.exportBtn.addEventListener("click",()=>{Ee(!1),Ie()}),d.settingsToggle&&d.settingsToggle.addEventListener("change",()=>{if(!h){d.settingsToggle.checked=!1,A("Upgrade to Pro to enable auto-delete.","error");return}I(d.settingsToggle.checked),nt()}),d.retentionSelect&&d.retentionSelect.addEventListener("change",()=>{h&&nt()}),d.shortcodeToggle&&d.shortcodeConfig&&d.shortcodeToggle.addEventListener("click",se=>{se.preventDefault();let be=!d.shortcodeConfig.hidden;d.shortcodeConfig.hidden=be,d.shortcodeToggle.setAttribute("aria-expanded",be?"false":"true"),d.shortcodeToggle.classList.toggle("is-active",!be)}),d.shortcodeOptions&&d.shortcodeOptions.length&&(d.shortcodeOptions.forEach(se=>{se.addEventListener("change",J)}),J()),d.shortcodeSnippet&&d.shortcodeSnippet.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(d.shortcodeSnippet.textContent,d.shortcodeSnippet)}),d.settingsUsersNav&&d.settingsUsersNav.addEventListener("click",se=>{se.preventDefault(),D(),W()}),d.userSheetClose&&d.userSheetClose.addEventListener("click",se=>{se.preventDefault(),U()}),d.userSheet&&d.userSheet.addEventListener("click",se=>{se.target===d.userSheet&&U()}),d.userSearchInput&&(d.userSearchInput.addEventListener("input",()=>{clearTimeout(_);let se=d.userSearchInput.value.trim();_=window.setTimeout(()=>{B(1,se)},350)}),d.userSearchInput.addEventListener("keydown",se=>{if(se.key==="Enter"){se.preventDefault(),clearTimeout(_);let be=d.userSearchInput.value.trim();B(1,be),d.userSearchClear&&(d.userSearchClear.hidden=be.length===0)}})),d.userSearchClear&&d.userSearchClear.addEventListener("click",()=>{d.userSearchInput&&(d.userSearchInput.value=""),d.userSearchClear.hidden=!0,B(1,"")}),d.userTableBody){let se="data-user-credits-listeners";d.userTableBody.getAttribute(se)||(d.userTableBody.addEventListener("change",be=>{be.target.matches(".aipkit_stats_credits_balance_input")&&O(be.target)}),d.userTableBody.addEventListener("keypress",be=>{be.key==="Enter"&&be.target.matches(".aipkit_stats_credits_balance_input")&&(be.preventDefault(),be.target.blur())}),d.userTableBody.addEventListener("click",be=>{let xe=be.target.closest(".aipkit_stats_usage_toggle");if(xe){be.preventDefault();let De=xe.closest("td");if(De){let ze=De.querySelectorAll(".aipkit_stats_usage_extra");if(ze.length){let Ze=ze[0].hidden;ze.forEach(it=>{it.hidden=!Ze}),xe.textContent=Ze?f("Show less","gpt3-ai-content-generator"):`${f("Show more","gpt3-ai-content-generator")}...`}}return}let Re=be.target.closest(".aipkit_stats_purchase_history_btn");if(Re){be.preventDefault();let De=Re.dataset.history?JSON.parse(Re.dataset.history):[];oe(De,Re.dataset.userName||"")}}),d.userTableBody.setAttribute(se,"true"))}document.addEventListener("keydown",se=>{se.key==="Escape"&&d.userSheet&&d.userSheet.classList.contains("aipkit-active")&&U()}),de(S(),!1),ae(),I(!!d.settingsToggle?.checked)}window.aipkit_initStats=o})();(function(){"use strict";function k(){let n={},e=document.getElementById("aipkit_settings_container");return e&&e.querySelectorAll("input[name], select[name], textarea[name]").forEach(a=>{a.type==="checkbox"?n[a.name]=a.checked?"1":"0":a.type==="radio"?a.checked&&(n[a.name]=a.value):n[a.name]=a.value}),n}window.aipkit_getCurrentFormData=k})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function k(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let n=window.aipkit_getCurrentFormData(),e=window.aipkit_lastSavedData||{};if(JSON.stringify(n)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let i="aipkit_settings_global_messages";window.aipkit_showSavingIndicator(i,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",n),window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"success","Settings saved!"),window.aipkit_lastSavedData=n,typeof window.aipkit_queueProviderAutoSync=="function"&&window.aipkit_queueProviderAutoSync(e,n)}catch(a){window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"error","Save failed: "+a.message),console.error("AIPKit Auto-Save Error:",a)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=k})();(function(){"use strict";function k(){let e=document.getElementById("aipkit_settings_container");if(!e)return;let i="data-autosave-listener-attached";e.getAttribute(i)||(e.addEventListener("change",function(a){let s=a.target;s.matches(".aipkit_autosave_trigger")&&s.id!=="aipkit_provider"&&(s.tagName.toLowerCase()==="select"||s.type==="checkbox"||s.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),e.addEventListener("blur",function(a){let s=a.target;if(s.matches(".aipkit_autosave_trigger")&&s.id!=="aipkit_provider"){let l=s.tagName.toLowerCase();(l==="input"||l==="textarea")&&s.type!=="range"&&s.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),e.setAttribute(i,"true"))}function n(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=k,window.aipkit_updateLastSavedData=n})();(function(){"use strict";function k(e){try{return new Date(e+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return e}}function n(e){return typeof e!="number"?e:e.toLocaleString()}window.aipkit_formatChartDate=k,window.aipkit_formatChartNumber=n})();(function(){"use strict";let k=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],n="#B0BEC5",e={};function i(s){e={};let l=0;s.forEach(c=>{if(c==="Other")e[c]=n;else{let o;do o=k[l%k.length],l++;while(o===n&&k.length>1);e[c]=o}})}function a(s){return e[s]||"#cccccc"}window.aipkit_assignModuleColors=i,window.aipkit_getModuleColor=a})();(function(){"use strict";function k(a,s){if(!s||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let l=a.target,c=l.getAttribute("data-date"),o=l.getAttribute("data-module"),t=parseInt(l.getAttribute("data-value"),10),r=parseInt(l.getAttribute("data-daily-total"),10),f=window.aipkit_getModuleColor(o),u=o?n(o.replace(/[-_]/g," ")):"Unknown";s.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(c)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${f}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${u}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(t)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(r)} tokens)</span>
        `,s.classList.add("aipkit_active"),e(a,s)}function n(a){return a?a.charAt(0).toUpperCase()+a.slice(1):""}function e(a,s){if(!s)return;let l=s.parentElement;if(!l)return;let c=l.getBoundingClientRect(),o=a.clientX-c.left,t=a.clientY-c.top,r=s.offsetWidth,f=s.offsetHeight,u=o+15,p=t-f-10;u+r>c.width-5&&(u=o-r-15),u<5&&(u=5),p<5&&(p=t+15),p+f>c.height-5&&(p=c.height-f-5),s.style.left=`${u}px`,s.style.top=`${p}px`,s.style.transform="translate(0, 0)"}function i(a){a&&a.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=k,window.aipkit_moveChartTooltip=e,window.aipkit_hideChartTooltip=i})();(function(){"use strict";let k="http://www.w3.org/2000/svg";function n(i,a){if(i.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),i.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let s=Object.keys(a);if(s.length===0){i.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let l=new Set;s.forEach(v=>{Object.keys(a[v]).forEach(y=>l.add(y))});let c=Array.from(l);c.sort((v,y)=>{if(v==="Other")return 1;if(y==="Other")return-1;let C=M=>M?e(M.replace(/[-_]/g," ")):"Unknown";return C(v).localeCompare(C(y))}),window.aipkit_assignModuleColors(c);let o=1;s.forEach(v=>{let y=Object.values(a[v]).reduce((C,M)=>C+M,0);y>o&&(o=y)}),o=o*1.05;let t=s.length,r=Math.max(250,i.clientHeight||250),f=c.length>0?Math.max(40,Math.ceil(c.length/3)*20):0,u={top:20,right:20,bottom:30+f,left:50},p=i.clientWidth-u.left-u.right,_=r-u.top-u.bottom,m=Math.max(1,p/t*.8),g=Math.max(0,p/t*.2),d=document.createElementNS(k,"svg");d.setAttribute("viewBox",`0 0 ${i.clientWidth} ${r}`),d.setAttribute("preserveAspectRatio","xMidYMid meet"),d.setAttribute("class","aipkit_token_usage_chart_svg"),d.setAttribute("aria-label","Token usage per module per day chart");let w=document.createElementNS(k,"g");w.setAttribute("transform",`translate(${u.left}, ${u.top})`),d.appendChild(w);let h=document.createElement("div");h.className="aipkit_chart_tooltip",i.style.position="relative",i.appendChild(h);let b=document.createElementNS(k,"g");b.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),w.appendChild(b);let A=document.createElementNS(k,"line");A.setAttribute("x1",0),A.setAttribute("y1",0),A.setAttribute("x2",0),A.setAttribute("y2",_),b.appendChild(A);let S=5;for(let v=0;v<S;v++){let y=Math.round(o*(v/(S-1))),C=_-_*(v/(S-1)),M=document.createElementNS(k,"text");M.setAttribute("x",-5),M.setAttribute("y",C+3),M.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),M.textContent=window.aipkit_formatChartNumber(y),b.appendChild(M);let B=document.createElementNS(k,"line");B.setAttribute("x1",0),B.setAttribute("y1",C),B.setAttribute("x2",p),B.setAttribute("y2",C),B.setAttribute("class","aipkit_chart_grid_line"),w.insertBefore(B,w.firstChild)}let I=document.createElementNS(k,"g");I.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),I.setAttribute("transform",`translate(0, ${_})`),w.appendChild(I);let T=document.createElementNS(k,"line");T.setAttribute("x1",0),T.setAttribute("y1",0),T.setAttribute("x2",p),T.setAttribute("y2",0),I.appendChild(T);let x=Math.max(1,Math.ceil(t/(p/60)));s.forEach((v,y)=>{if(y%x===0||y===t-1){let C=y*(m+g)+m/2+g/2,M=document.createElementNS(k,"text");M.setAttribute("x",C),M.setAttribute("y",u.bottom-f-10),M.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),M.textContent=window.aipkit_formatChartDate(v),I.appendChild(M)}});let E=document.createElementNS(k,"g");if(w.appendChild(E),s.forEach((v,y)=>{let C=a[v],M=_,B=0;c.filter(U=>C[U]>0).forEach(U=>{let J=C[U]||0;B+=J;let oe=J/o*_;M-=oe;let O=y*(m+g)+g/2,L=document.createElementNS(k,"rect");L.setAttribute("x",O),L.setAttribute("y",M),L.setAttribute("width",m),L.setAttribute("height",Math.max(.1,oe)),L.setAttribute("class","aipkit_chart_bar"),L.setAttribute("fill",window.aipkit_getModuleColor(U)),L.setAttribute("data-date",v),L.setAttribute("data-module",U),L.setAttribute("data-value",J),L.setAttribute("data-daily-total",0),L.addEventListener("mouseenter",F=>window.aipkit_showStackedTooltip(F,h)),L.addEventListener("mousemove",F=>window.aipkit_moveChartTooltip(F,h)),L.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(h)),E.appendChild(L)}),E.querySelectorAll(`rect[data-date="${v}"]`).forEach(U=>U.setAttribute("data-daily-total",B))}),c.length>0){let v=document.createElementNS(k,"g");v.setAttribute("class","aipkit_chart_legend"),v.setAttribute("transform",`translate(0, ${_+u.bottom-f+5})`),w.appendChild(v);let y=0,C=0,M=20,B=p,D=35;c.forEach(W=>{let U=e(W.replace(/[-_]/g," ")),oe=U.length*7+25+D;y>0&&y+oe>B&&(y=0,C+=M);let O=document.createElementNS(k,"g");O.setAttribute("transform",`translate(${y}, ${C})`);let L=document.createElementNS(k,"rect");L.setAttribute("width",10),L.setAttribute("height",10),L.setAttribute("y",-5),L.setAttribute("fill",window.aipkit_getModuleColor(W)),O.appendChild(L);let F=document.createElementNS(k,"text");F.setAttribute("x",15),F.setAttribute("y",0),F.setAttribute("class","aipkit_chart_legend_label"),F.textContent=U,O.appendChild(F),v.appendChild(O),y+=oe})}i.appendChild(d)}function e(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}window.aipkit_renderTokenUsageChart=n})();(function(){"use strict";function k(i){let a=i.getFullYear(),s=String(i.getMonth()+1).padStart(2,"0"),l=String(i.getDate()).padStart(2,"0");return`${a}-${s}-${l}`}function n(i){let a=Number.isFinite(i)&&i>0?i:7,s=new Date;s.setHours(0,0,0,0);let l={};for(let c=a-1;c>=0;c-=1){let o=new Date(s);o.setDate(s.getDate()-c),l[k(o)]={}}return l}function e(i){let a=document.getElementById("aipkit_token_usage_chart_container");if(!a){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let s=a.querySelector(".aipkit_chart_loading_placeholder"),l=a.querySelector(".aipkit_chart_error_placeholder"),c=a.querySelector(".aipkit_chart_nodata_placeholder");l&&(l.style.display="none"),c&&(c.style.display="none"),s&&(s.style.display="flex");let o=[3,7,14,30,90],t=parseInt(i,10);if(!t||isNaN(t)){try{let f=localStorage.getItem("aipkit_stats_period_days"),u=parseInt(f,10);f&&!isNaN(u)&&o.includes(u)&&(t=u)}catch{}let r=document.getElementById("aipkit_stats_period_select");if(r){let f=parseInt(r.value,10);(!t||isNaN(t))&&(t=!isNaN(f)&&o.includes(f)?f:3),o.includes(t)&&String(r.value)!==String(t)&&(r.value=String(t))}else a.dataset.defaultDays?t=parseInt(a.dataset.defaultDays,10)||3:t=3}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:t}).then(r=>{if(s&&(s.style.display="none"),r&&r.daily_token_data){let f=r.daily_token_data;if(f&&typeof f=="object"&&Object.values(f).some(p=>p&&typeof p=="object"&&Object.values(p).some(_=>Number(_)>0)))window.aipkit_renderTokenUsageChart(a,f);else{let p=Object.keys(f).length>0?f:n(t);window.aipkit_renderTokenUsageChart(a,p)}}else throw new Error("Invalid data received for chart.")}).catch(r=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",r),s&&(s.style.display="none"),l)l.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${r.message})`,l.style.display="flex";else{let f=document.createElement("div");f.className="aipkit_chart_error_placeholder",f.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${r.message})`,a.innerHTML="",a.appendChild(f)}})}window.aipkit_loadTokenUsageChart=e,document.addEventListener("change",function(i){let a=i.target;if(a&&a.id==="aipkit_stats_period_select"){let s=parseInt(a.value,10)||7;typeof window.aipkit_loadTokenUsageChart=="function"&&window.aipkit_loadTokenUsageChart(s);try{[3,7,14,30,90].includes(s)&&localStorage.setItem("aipkit_stats_period_days",String(s))}catch{}}})})();(function(){"use strict";let k=window.wp?.i18n?.__||function(e){return e};function n(e){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openai=e);let i=document.getElementById("aipkit_openai_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openai_model"]');if(!i&&a.length===0){console.warn("OpenAI Sync: No OpenAI model selects found (#aipkit_openai_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.openai||[],l=Array.isArray(s)?s:[],c=g=>{if(!g)return[];let d=k("Recommended","gpt3-ai-content-generator"),w=Array.from(g.querySelectorAll("optgroup")).find(h=>h.label===d||h.label==="Recommended");return w?Array.from(w.querySelectorAll("option")).map(h=>({id:h.value,name:h.textContent.trim()||h.value})).filter(h=>h.id):[]};if(l.length===0){let g=i||a[0];l=c(g)}let o=new Set(l.map(g=>g?.id).filter(Boolean)),t=e&&typeof e=="object"?e:{},r=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],f=Object.keys(t),u=r.filter(g=>f.includes(g)).concat(f.filter(g=>!r.includes(g)).sort()),p=g=>{let d=g.value;g.innerHTML="";let w=!1,h=!1;if(l.length>0){let b=document.createElement("optgroup");b.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(A=>{if(!A||typeof A!="object"||!A.id)return;let S=new Option(A.name||A.id,A.id);A.id===d&&(S.selected=!0,w=!0),b.appendChild(S)}),b.children.length>0&&(g.appendChild(b),h=!0)}if(u.forEach(b=>{let A=Array.isArray(t[b])?t[b].slice():[];if(A.length===0)return;A.sort((I,T)=>(I.name||I.id||"").localeCompare(T.name||T.id||""));let S=document.createElement("optgroup");S.label=b,A.forEach(I=>{let T=I?.id||"";if(!T||o.has(T))return;let x=new Option(I.name||T,T);T===d&&(x.selected=!0,w=!0),S.appendChild(x)}),S.children.length>0&&(g.appendChild(S),h=!0)}),!h){g.appendChild(new Option("No models found.",""));return}if(!w&&d&&!g.querySelector(`option[value="${CSS.escape(d)}"]`)){let b=new Option(d+"",d,!1,!0);g.insertBefore(b,g.firstChild),g.value=d,w=!0}if(g.options.length>0&&g.selectedIndex===-1){let b=-1;for(let A=0;A<g.options.length;A++)if(!g.options[A].disabled&&g.options[A].value){b=A;break}g.selectedIndex=b!==-1?b:0}};i&&p(i),a.forEach(p);let _=document.getElementById("aipkit_content_writer_provider"),m=document.getElementById("aipkit_content_writer_model");_&&m&&_.value==="openai"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(_,m)}window.aipkit_updateOpenAIModels=n})();(function(){"use strict";let k=window.wp?.i18n?.__||function(e){return e};function n(e){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openrouter=Array.isArray(e)?e:[]);let i=document.getElementById("aipkit_openrouter_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openrouter_model"]');if(!i&&a.length===0){console.warn("OpenRouter Sync: No OpenRouter model selects found (#aipkit_openrouter_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.openrouter||[],l=Array.isArray(s)?s:[],c=r=>{if(!r)return[];let f=k("Recommended","gpt3-ai-content-generator"),u=Array.from(r.querySelectorAll("optgroup")).find(p=>p.label===f||p.label==="Recommended");return u?Array.from(u.querySelectorAll("option")).map(p=>({id:p.value,name:p.textContent.trim()||p.value})).filter(p=>p.id):[]};if(l.length===0){let r=i||a[0];l=c(r)}let o=new Set(l.map(r=>r?.id).filter(Boolean)),t=r=>{let f=r.value;r.innerHTML="";let u=!1,p=!1;if(l.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(d=>{if(d&&typeof d=="object"&&d.id){let w=new Option(d.name||d.id,d.id);d.id===f&&(w.selected=!0,u=!0),g.appendChild(w)}}),g.children.length>0&&(r.appendChild(g),p=!0)}if(!e||!e.length){p||r.appendChild(new Option("No models found.",""));return}let _={};if(e.forEach(g=>{if(!g||!g.id||o.has(g.id))return;let d=g.id.split("/"),w=(d.length>1?d[0]:"other").toLowerCase();_[w]||(_[w]=[]),_[w].push(g)}),Object.keys(_).sort().forEach(g=>{let d=document.createElement("optgroup");d.label=g.charAt(0).toUpperCase()+g.slice(1),_[g].sort((w,h)=>(w.name||"").localeCompare(h.name||"")),_[g].forEach(w=>{let h=new Option(w.name||w.id,w.id);w.id===f&&(h.selected=!0,u=!0),d.appendChild(h)}),d.children.length>0&&(r.appendChild(d),p=!0)}),!u&&f&&!r.querySelector(`option[value="${CSS.escape(f)}"]`)){let g=new Option(f+"",f,!1,!0);r.insertBefore(g,r.firstChild)}if(!u&&r.options.length>0&&r.selectedIndex===-1){let g=-1;for(let d=0;d<r.options.length;d++)if(!r.options[d].disabled&&r.options[d].value){g=d;break}r.selectedIndex=g!==-1?g:0}};i&&t(i),a.forEach(t)}window.aipkit_updateOpenRouterModels=n})();(function(){"use strict";let k=window.wp?.i18n?.__||function(e){return e};function n(e){let i=document.getElementById("aipkit_google_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_google_model"]');if(!i&&a.length===0){console.warn("Google Sync: No Google model selects found (#aipkit_google_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.google||[],l=Array.isArray(s)?s:[],c=f=>{if(!f)return[];let u=k("Recommended","gpt3-ai-content-generator"),p=Array.from(f.querySelectorAll("optgroup")).find(_=>_.label===u||_.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(_=>({id:_.value,name:_.textContent.trim()||_.value})).filter(_=>_.id):[]};if(l.length===0){let f=i||a[0];l=c(f)}let o=new Set(l.map(f=>f?.id).filter(Boolean)),t=Array.isArray(e)?e.slice():[];t.sort((f,u)=>(f.name||f.id||"").localeCompare(u.name||u.id||""));let r=f=>{let u=f.value;f.innerHTML="";let p=!1,_=!1,m=l.length>0?document.createElement("optgroup"):null;if(m&&(m.label=k("All models","gpt3-ai-content-generator")),l.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(d=>{if(d&&typeof d=="object"&&d.id){let w=new Option(d.name||d.id,d.id);(d.id===u||`models/${d.id}`===u)&&(w.selected=!0,p=!0),g.appendChild(w)}}),g.children.length>0&&(f.appendChild(g),_=!0)}if(!t.length){_||f.appendChild(new Option("No models found.",""));return}if(t.forEach(g=>{let d=g.id||"",w=g.name||d;if(!d||o.has(d))return;let h=new Option(w,d);(d===u||`models/${d}`===u)&&(h.selected=!0,p=!0),m?m.appendChild(h):(f.appendChild(h),_=!0)}),m&&m.children.length>0&&(f.appendChild(m),_=!0),!p&&u){let g=u.startsWith("models/")?u.substring(7):u;if(!f.querySelector(`option[value="${CSS.escape(g)}"]`)){let d=g,w=new Option(d+"",u,!1,!0);f.insertBefore(w,f.firstChild),f.value=u}}if(f.options.length>0&&f.selectedIndex===-1){let g=-1;for(let d=0;d<f.options.length;d++)if(!f.options[d].disabled&&f.options[d].value){g=d;break}f.selectedIndex=g!==-1?g:0}};i&&r(i),a.forEach(r)}window.aipkit_updateGoogleModels=n})();(function(){"use strict";function k(n){let e=document.getElementById("aipkit_azure_deployment"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_azure_deployment"]');if(!e&&i.length===0){console.warn("Azure Sync: No Azure deployment selects found (#aipkit_azure_deployment or chat selects).");return}let a=s=>{let l=s.value;s.innerHTML="";let c=n&&typeof n=="object"&&!Array.isArray(n)&&(n["Chat Models"]||n["Embedding Models"]||n["Image Models"]);if(!n||Array.isArray(n)&&!n.length||c&&Object.keys(n).length===0){if(s.appendChild(new Option("No deployments found.","")),l){let t=new Option(l+"",l,!1,!0);s.appendChild(t),s.value=l}return}let o=!1;if(c)Object.keys(n).forEach(t=>{let r=n[t];if(r&&Array.isArray(r)&&r.length>0){let f=document.createElement("optgroup");f.label=t,r.sort((u,p)=>(u.id||"").localeCompare(p.id||"")),r.forEach(u=>{let p=u.id||"",_=u.name||p;if(!p)return;let m=p+(_&&_!==p?` (model: ${_})`:""),g=new Option(m,p);p===l&&(g.selected=!0,o=!0),f.appendChild(g)}),s.appendChild(f)}});else{let t=Array.isArray(n)?n:[];t.sort((r,f)=>(r.id||"").localeCompare(f.id||"")),t.forEach(r=>{let f=r.id||"",u=r.name||f;if(!f)return;let p=f+(u&&u!==f?` (model: ${u})`:""),_=new Option(p,f);f===l&&(_.selected=!0,o=!0),s.appendChild(_)})}if(!o&&s.value&&!s.querySelector(`option[value="${CSS.escape(s.value)}"]`)){let t=new Option(s.value+"",s.value,!1,!0);s.appendChild(t),o=!0}if(!o&&s.options.length>0&&s.selectedIndex===-1){let t=-1;for(let r=0;r<s.options.length;r++)if(!s.options[r].disabled&&s.options[r].value){t=r;break}s.selectedIndex=t!==-1?t:0}};e&&a(e),i.forEach(a)}window.aipkit_updateAzureDeployments=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(e){return e};function n(e){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.claude=Array.isArray(e)?e:[]);let i=document.getElementById("aipkit_claude_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_claude_model"]');if(!i&&a.length===0){console.warn("Claude Sync: No Claude model selects found (#aipkit_claude_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.claude||[],l=Array.isArray(s)?s:[],c=p=>{if(!p)return[];let _=k("Recommended","gpt3-ai-content-generator"),m=Array.from(p.querySelectorAll("optgroup")).find(g=>g.label===_||g.label==="Recommended");return m?Array.from(m.querySelectorAll("option")).map(g=>({id:g.value,name:g.textContent.trim()||g.value})).filter(g=>g.id):[]};if(l.length===0){let p=i||a[0];l=c(p)}let o=new Set(l.map(p=>p?.id).filter(Boolean)),t=Array.isArray(e)?e.slice():[];t.sort((p,_)=>(p.name||p.id||"").localeCompare(_.name||_.id||""));let r=p=>{let _=p.value;p.innerHTML="";let m=!1,g=!1,d=l.length>0?document.createElement("optgroup"):null;if(d&&(d.label=k("All models","gpt3-ai-content-generator")),l.length>0){let w=document.createElement("optgroup");w.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(h=>{if(!h||typeof h!="object"||!h.id)return;let b=new Option(h.name||h.id,h.id);h.id===_&&(b.selected=!0,m=!0),w.appendChild(b)}),w.children.length>0&&(p.appendChild(w),g=!0)}if(t.forEach(w=>{let h=w?.id||"",b=w?.name||h;if(!h||o.has(h))return;let A=new Option(b,h);h===_&&(A.selected=!0,m=!0),d?d.appendChild(A):(p.appendChild(A),g=!0)}),d&&d.children.length>0&&(p.appendChild(d),g=!0),!g){p.appendChild(new Option("No models found.",""));return}if(!m&&_&&!p.querySelector(`option[value="${CSS.escape(_)}"]`)){let w=new Option(_+"",_,!1,!0);p.insertBefore(w,p.firstChild),p.value=_}if(p.options.length>0&&p.selectedIndex===-1){let w=-1;for(let h=0;h<p.options.length;h++)if(!p.options[h].disabled&&p.options[h].value){w=h;break}p.selectedIndex=w!==-1?w:0}};i&&r(i),a.forEach(r);let f=document.getElementById("aipkit_content_writer_provider"),u=document.getElementById("aipkit_content_writer_model");f&&u&&f.value==="claude"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(f,u)}window.aipkit_updateClaudeModels=n})();(function(){"use strict";let k=window.wp?.i18n?.__||function(e){return e};function n(e){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.deepseek=Array.isArray(e)?e:[]);let i=document.getElementById("aipkit_deepseek_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_deepseek_model"]');if(!i&&a.length===0){console.warn("DeepSeek Sync: No DeepSeek model selects found (#aipkit_deepseek_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.deepseek||[],l=Array.isArray(s)?s:[],c=f=>{if(!f)return[];let u=k("Recommended","gpt3-ai-content-generator"),p=Array.from(f.querySelectorAll("optgroup")).find(_=>_.label===u||_.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(_=>({id:_.value,name:_.textContent.trim()||_.value})).filter(_=>_.id):[]};if(l.length===0){let f=i||a[0];l=c(f)}let o=Array.isArray(e)?e.slice():[];o.sort((f,u)=>(f.name||f.id||"").localeCompare(u.name||u.id||"")),l.length===0&&o.length>0&&(l=o.slice(0,3).map(f=>({id:f?.id||"",name:f?.name||f?.id||""})).filter(f=>f.id));let t=new Set(l.map(f=>f?.id).filter(Boolean)),r=f=>{let u=f.value;f.innerHTML="";let p=!1,_=!1,m=l.length>0?document.createElement("optgroup"):null;if(m&&(m.label=k("All models","gpt3-ai-content-generator")),l.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(d=>{if(!d||typeof d!="object"||!d.id)return;let w=new Option(d.name||d.id,d.id);d.id===u&&(w.selected=!0,p=!0),g.appendChild(w)}),g.children.length>0&&(f.appendChild(g),_=!0)}if(!o.length){_||f.appendChild(new Option("No models found.",""));return}if(o.forEach(g=>{let d=g?.id||"",w=g?.name||d;if(!d||t.has(d))return;let h=new Option(w,d);d===u&&(h.selected=!0,p=!0),m?m.appendChild(h):(f.appendChild(h),_=!0)}),m&&m.children.length>0&&(f.appendChild(m),_=!0),!p&&u&&!f.querySelector(`option[value="${CSS.escape(u)}"]`)){let g=new Option(u+"",u,!1,!0);f.insertBefore(g,f.firstChild)}if(f.options.length>0&&f.selectedIndex===-1){let g=-1;for(let d=0;d<f.options.length;d++)if(!f.options[d].disabled&&f.options[d].value){g=d;break}f.selectedIndex=g!==-1?g:0}};i&&r(i),a.forEach(r)}window.aipkit_updateDeepSeekModels=n})();(function(){"use strict";let k=window.wp?.i18n?.__||function(e){return e};function n(e){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.ollama=Array.isArray(e)?e:[]);let i=document.getElementById("aipkit_ollama_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_ollama_model"]');if(!i&&a.length===0){console.warn("Ollama Sync: No Ollama model selects found (#aipkit_ollama_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.ollama||[],l=Array.isArray(s)?s:[],c=f=>{if(!f)return[];let u=k("Recommended","gpt3-ai-content-generator"),p=Array.from(f.querySelectorAll("optgroup")).find(_=>_.label===u||_.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(_=>({id:_.value,name:_.textContent.trim()||_.value})).filter(_=>_.id):[]};if(l.length===0){let f=i||a[0];l=c(f)}let o=Array.isArray(e)?e.slice():[];o.sort((f,u)=>(f.name||f.id||"").localeCompare(u.name||u.id||"")),l.length===0&&o.length>0&&(l=o.slice(0,3).map(f=>({id:f?.id||"",name:f?.name||f?.id||""})).filter(f=>f.id));let t=new Set(l.map(f=>f?.id).filter(Boolean)),r=f=>{let u=f.value;f.innerHTML="";let p=!1,_=!1,m=l.length>0?document.createElement("optgroup"):null;if(m&&(m.label=k("All models","gpt3-ai-content-generator")),l.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(d=>{if(!d||typeof d!="object"||!d.id)return;let w=new Option(d.name||d.id,d.id);d.id===u&&(w.selected=!0,p=!0),g.appendChild(w)}),g.children.length>0&&(f.appendChild(g),_=!0)}if(!o.length){_||f.appendChild(new Option("No models found.",""));return}if(o.forEach(g=>{let d=g?.id||"",w=g?.name||d;if(!d||t.has(d))return;let h=new Option(w,d);d===u&&(h.selected=!0,p=!0),m?m.appendChild(h):(f.appendChild(h),_=!0)}),m&&m.children.length>0&&(f.appendChild(m),_=!0),!p&&u&&!f.querySelector(`option[value="${CSS.escape(u)}"]`)){let g=new Option(u+"",u,!1,!0);f.insertBefore(g,f.firstChild)}if(f.options.length>0&&f.selectedIndex===-1){let g=-1;for(let d=0;d<f.options.length;d++)if(!f.options[d].disabled&&f.options[d].value){g=d;break}f.selectedIndex=g!==-1?g:0}};i&&r(i),a.forEach(r)}window.aipkit_updateOllamaModels=n})();(function(){"use strict";function k(i,a){let s=Array.isArray(a)?a:[],l=JSON.stringify(s),o=`[id^="${i==="models"?"aipkit_elevenlabs_models_json_":"aipkit_elevenlabs_voices_json_"}"]`;document.querySelectorAll(o).forEach(t=>{i==="models"?t.dataset.models=l:t.dataset.voices=l})}function n(i,a="aipkit_elevenlabs_voice_id"){let s=Array.isArray(i)?i:[];k("voices",s);let l=document.getElementById(a);if(!l){console.warn(`ElevenLabs Sync (Voices): Select element #${a} not found.`);return}if(typeof a=="string"&&a.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){window.aipkit_chatTts_updateElevenLabsVoiceSelect(a,s,l.value||"");return}let c=l.value;if(l.innerHTML="",l.appendChild(new Option("-- Select a Voice (Optional) --","")),!s.length){c&&c!==""&&(l.appendChild(new Option(c+"",c,!1,!0)),l.value=c);return}let o=!1;if(s.sort((t,r)=>(t.name||t.id||"").localeCompare(r.name||r.id||"")),s.forEach(t=>{let r=t.id||"",f=t.name||r;if(!r)return;let u=new Option(f,r);r===c&&(u.selected=!0,o=!0),l.appendChild(u)}),!o&&c&&c!==""&&!l.querySelector(`option[value="${CSS.escape(c)}"]`)){let t=new Option(c+"",c,!1,!0);l.appendChild(t),l.value=c}}function e(i,a="aipkit_elevenlabs_tts_model_id"){let s=Array.isArray(i)?i:[];k("models",s);let l=document.getElementById(a);if(!l){console.warn(`ElevenLabs Sync (Models): Select element #${a} not found.`);return}if(typeof a=="string"&&a.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){window.aipkit_chatTts_updateElevenLabsModelsSelect(a,s,l.value||"");return}let c=l.value;if(l.innerHTML="",l.appendChild(new Option("-- Select a Model (Optional) --","")),!s.length){c&&c!==""&&(l.appendChild(new Option(c+"",c,!1,!0)),l.value=c);return}let o=!1;if(s.sort((t,r)=>(t.name||t.id||"").localeCompare(r.name||r.id||"")),s.forEach(t=>{let r=t.id||"",f=t.name||r;if(!r)return;let u=new Option(f,r);r===c&&(u.selected=!0,o=!0),l.appendChild(u)}),!o&&c&&c!==""&&!l.querySelector(`option[value="${CSS.escape(c)}"]`)){let t=new Option(c+"",c,!1,!0);l.appendChild(t),l.value=c}}window.aipkit_updateElevenLabsVoices=n,window.aipkit_updateElevenLabsModelsSelect=e})();(function(){"use strict";function k(n,e="aipkit_pinecone_default_index"){let i=document.getElementById(e);if(!i){console.warn(`Pinecone Sync: Select element #${e} not found.`);return}let a=i.value;if(i.innerHTML="",i.appendChild(new Option("-- Select Synced Index --","")),!n||!n.length){i.appendChild(new Option("(No indexes found - Sync again)","")),a&&a!==""&&(i.appendChild(new Option(a+"",a,!1,!0)),i.value=a);return}let s=!1;if(n.sort((l,c)=>(l.name||l.id||"").localeCompare(c.name||c.id||"")),n.forEach(l=>{let c=l.name||l.id||(typeof l=="string"?l:"");if(!c)return;let o=new Option(c,c);c===a&&(o.selected=!0,s=!0),i.appendChild(o)}),!s&&a&&a!==""&&!i.querySelector(`option[value="${CSS.escape(a)}"]`)){let l=new Option(a+"",a,!1,!0);i.appendChild(l),i.value=a}}window.aipkit_updatePineconeIndexes=k})();(function(){"use strict";function k(n,e="aipkit_qdrant_default_collection"){let i=document.getElementById(e);if(!i){console.warn(`Qdrant Sync: Select element #${e} not found.`);return}let a=i.multiple,s=a?Array.from(i.selectedOptions).map(c=>c.value).filter(Boolean):[i.value];if(i.innerHTML="",a||i.appendChild(new Option("-- Select Synced Collection --","")),!n||!n.length){i.appendChild(new Option("(No collections found - Sync again)","")),s.length&&(s.forEach(c=>{c&&i.appendChild(new Option(c+"",c,!1,!0))}),!a&&s[0]&&(i.value=s[0]));return}let l=new Set;if(n.sort((c,o)=>(c.name||c.id||"").localeCompare(o.name||o.id||"")),n.forEach(c=>{let o=c.name||c.id||"";if(!o)return;let t=s.includes(o),r=new Option(o,o,!1,t);t&&l.add(o),i.appendChild(r)}),s.forEach(c=>{if(c&&!l.has(c)&&!i.querySelector(`option[value="${CSS.escape(c)}"]`)){let o=new Option(c+"",c,!1,!0);i.appendChild(o)}}),!a&&s[0]&&!i.value&&(i.value=s[0]),typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let c=i.closest(".aipkit_popover_options_list")||i.closest(".aipkit_popover_option_main")||document;window.aipkit_populateQdrantCollectionsMultiSelect(c)}}window.aipkit_updateQdrantCollections=k})();(function(){"use strict";function k(n,e=""){let i=e||"aipkit_replicate_model",a=document.getElementById(i);if(window.aipkit_dashboard&&window.aipkit_dashboard.imageGeneratorModels&&(window.aipkit_dashboard.imageGeneratorModels.replicate=n),window.aipkit_image_generator_config_public&&(window.aipkit_image_generator_config_public.replicate_models=n),!a){e&&console.warn(`Replicate Sync: Select element #${i} not found.`);return}let s=a.value;if(a.innerHTML="",!n||!n.length){a.appendChild(new Option("(No models found - Sync again)","")),s&&s!==""&&(a.appendChild(new Option(s+"",s,!1,!0)),a.value=s);return}let l=!1;if(n.sort((c,o)=>(c.name||c.id||"").localeCompare(o.name||o.id||"")),n.forEach(c=>{let o=c.id||"",t=c.name||o;if(!o)return;let r=new Option(t,o);o===s&&(r.selected=!0,l=!0),a.appendChild(r)}),!l&&s&&s!==""&&!a.querySelector(`option[value="${CSS.escape(s)}"]`)){let c=new Option(s+"",s,!1,!0);a.insertBefore(c,a.firstChild),a.value=s}if(!a.value&&a.options.length>0){let c=-1;for(let o=0;o<a.options.length;o++)if(!a.options[o].disabled&&a.options[o].value){c=o;break}a.selectedIndex=c!==-1?c:0}}window.aipkit_updateReplicateModels=k})();(function(){"use strict";function k(m,g,d={}){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function")return console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing."),null;let w=d&&typeof d=="object"?d:{},h=!!w.silent,b=w.showErrors!==!1,A=w.showSuccess===!0,S=!!m,I=(O,L="")=>{let F=Array.isArray(O)?O:[],N=document.getElementById("aipkit_google_tts_voices_json_main");N&&(N.dataset.voices=JSON.stringify(F));let R=L||document.querySelector('select[name="tts_google_voice_id"]')?.id||"";if(R&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let H=document.getElementById(R);window.aipkit_updateGoogleVoiceSelect(R,F,H&&H.value||"")}},T=O=>{let L=Array.isArray(O)?O:[];window.aipkit_chat_config=window.aipkit_chat_config||{},window.aipkit_chat_config.openaiVectorStores=L,typeof window.aipkit_invalidateModuleCache=="function"&&["chatbot","sources","content-writer","autogpt","ai-forms"].forEach(F=>{window.aipkit_invalidateModuleCache(F)}),typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("aipkit:vector-store-list-updated",{detail:{provider:"openai",stores:L}}))},x={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,GoogleTtsVoices:I,OpenAIVectorStores:T,Azure:window.aipkit_updateAzureDeployments,Claude:window.aipkit_updateClaudeModels,DeepSeek:window.aipkit_updateDeepSeekModels,Ollama:window.aipkit_updateOllamaModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof x[g]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${g}.`),alert(`AIPKit Error: Cannot update UI for ${g}.`);return}let E="aipkit_settings_global_messages",v=S?!!m.closest(".aipkit_popover_options_list")&&!m.closest("#aipkit_settings_container .aipkit_settings_advanced_panel"):!1;!h&&!v&&document.getElementById(E)&&(window.aipkit_clearStatusMessages(E),window.aipkit_showSavingIndicator(E,!1));let y=S?m.querySelector(".aipkit_btn-text"):null,C=S?m.getAttribute("data-target-select"):w.targetSelectId||"",M=null,B=O=>!O||!(O instanceof Element)?null:O.querySelector(".aipkit_builder_card--shortcode .aipkit_model_sync_status")||O.querySelector(".aipkit_builder_card_status .aipkit_model_sync_status");if(v){let L=m.closest(".aipkit_popover_flyout_body")?.closest(".aipkit-modal-content")?.querySelector(".aipkit_popover_flyout_header")||m.closest(".aipkit_popover_context_flyout")?.querySelector(".aipkit_popover_flyout_header")||m.closest(".aipkit_popover_flyout_header");if(L&&(M=L.querySelector(".aipkit_popover_status_inline")),!M){let F=m.closest(".aipkit_model_settings_popover");F&&(M=F.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline.aipkit_model_sync_status"))}if(!M){let F=m.closest(".aipkit_popover_option_row");F&&(M=F.querySelector(".aipkit_popover_status_inline"))}if(!M){let F=m.closest(".aipkit_model_settings_panel");F&&(M=F.querySelector(".aipkit_popover_status_inline.aipkit_model_sync_status"))}}else{let O=S?m.closest(".aipkit_chatbot_model_field"):null,L=S?m.closest(".aipkit_chatbot_builder"):null;if(!L&&C){let F=document.getElementById(C);L=F?F.closest(".aipkit_chatbot_builder"):null}L||(L=document.querySelector('.aipkit_chatbot_builder[data-aipkit-chatbot-layout="next"]')),L&&L.getAttribute("data-aipkit-chatbot-layout")==="next"&&(M=B(L)),M||(M=O?O.querySelector(".aipkit_model_sync_status"):null)}if(!M){let O=document.querySelector('.aipkit_chatbot_builder[data-aipkit-chatbot-layout="next"]');O&&(M=B(O))}if(!M&&g){let O=document.querySelector(`.aipkit_chatbot_model_field[data-provider="${g}"]`);O&&(M=O.querySelector(".aipkit_model_sync_status"))}let D=(O,L,F)=>{if(!M)return;let N=M.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_save_status_container");N&&O&&(N.textContent="",N.className="aipkit_save_status_container"),M.textContent=O||"",M.classList.remove("success","error","loading"),L&&M.classList.add(L),F?M.setAttribute("title",F):M.removeAttribute("title"),M.classList.contains("aipkit_popover_status_inline")&&(M.style.display=O?"inline-block":"none")};D("Syncing\u2026","loading");let W=y?y.textContent:g.includes("ElevenLabs")||g.includes("Pinecone")||g.includes("Qdrant")||g.includes("VectorStores")||g.includes("Replicate")?"Sync Items":"Sync Models",U=null;return S&&(U=m.querySelector(".aipkit_spinner"),U||(U=document.createElement("span"),U.className="aipkit_spinner",m.appendChild(U)),U.style.display="inline-block",m.classList.add("aipkit_loading"),m.disabled=!0),(g==="GoogleTtsVoices"?window.aipkit_apiRequest("aipkit_sync_google_tts_voices"):window.aipkit_apiRequest("aipkit_sync_models",{provider:g})).then(O=>{g==="OpenRouter"&&Array.isArray(O?.embedding_models)&&(window.aipkit_dashboard=window.aipkit_dashboard||{},window.aipkit_dashboard.embeddingModels=window.aipkit_dashboard.embeddingModels||{},window.aipkit_dashboard.embeddingModels.openrouter=O.embedding_models);let L=g==="GoogleTtsVoices"?O.voices:g==="OpenAIVectorStores"?O.stores:O.models,F=Array.isArray(O?.recommended_models)?O.recommended_models:[],R={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"}[g]||"";R&&F.length>0&&(window.aipkit_dashboard=window.aipkit_dashboard||{},window.aipkit_dashboard.recommendedModels=window.aipkit_dashboard.recommendedModels||{},window.aipkit_dashboard.recommendedModels[R]=F),w.skipUpdate||(C?x[g](L,C):x[g](L)),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers(),(g==="PineconeIndexes"||g==="QdrantCollections")&&typeof window.aipkit_refreshTrainingSourcesCount=="function"&&window.aipkit_refreshTrainingSourcesCount(),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():h||console.warn("Model Sync Init: Cannot update autosave baseline.");let H="models";g==="ElevenLabs"||g==="GoogleTtsVoices"?H="voices":g==="ElevenLabsModels"?H="synthesis models":g==="PineconeIndexes"?H="indexes":g==="QdrantCollections"?H="collections":g==="OpenAIVectorStores"&&(H="vector stores"),(!h||A)&&!v&&document.getElementById(E)&&window.aipkit_showMessage(E,"success",`${g.replace(/Indexes|Collections|Models/,"")} ${H} synced!`),D("Saved","success"),M&&setTimeout(()=>D("",null),2500)}).catch(O=>{let L=O?.message||"Sync failed.";if(b&&!v&&document.getElementById(E)&&window.aipkit_showMessage(E,"error",`Sync failed: ${L}`),console.error(`AIPKit Sync Error (${g}):`,O),D(L,"error",L),M&&setTimeout(()=>D("",null),5e3),w.propagateError)throw O}).finally(()=>{if(S){m.disabled=!1,m.classList.remove("aipkit_loading");let O=m.querySelector(".aipkit_spinner");O&&(O.style.display="none"),y&&(y.textContent=W)}})}function n(m){if(!m)return;let g="data-sync-listener-attached";m.getAttribute(g)||(m.addEventListener("click",function(d){let w=d.target.closest(".aipkit_sync_btn");if(!w||w.disabled)return;d.preventDefault();let h=w.getAttribute("data-provider")||"";if(!h){let b=w.closest(".aipkit_chatbot_model_field");b&&b.getAttribute("data-provider")&&(h=b.getAttribute("data-provider"))}h?k(w,h):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",w)}),m.setAttribute(g,"true"))}function e(){n(document.getElementById("aipkit_module-container")),n(document.getElementById("aipkit_chatbot_main_tab_content_container"))}let i=[],a=!1;function s(m,g){if(!m||typeof m!="object")return"";let d=m[g];return d==null?"":String(d).trim()}function l(m,g,d){return d.some(w=>s(m,w)!==s(g,w))}function c(m){return s(m,"azure_api_key")!==""&&s(m,"azure_endpoint")!==""}function o(m,g){let d=String(m||"").trim();if(!d)return!1;if(d==="Ollama")return!0;if(d==="Azure")return c(g);let h={OpenAI:"openai_api_key",OpenRouter:"openrouter_api_key",Google:"google_api_key",Claude:"claude_api_key",DeepSeek:"deepseek_api_key"}[d];return h?s(g,h)!=="":!1}function t(m,g){return[{provider:"OpenAI",keys:["openai_api_key","openai_base_url","openai_api_version"],ready:w=>s(w,"openai_api_key")!==""},{provider:"OpenAIVectorStores",keys:["openai_api_key","openai_base_url","openai_api_version"],ready:w=>s(w,"openai_api_key")!==""},{provider:"OpenRouter",keys:["openrouter_api_key","openrouter_base_url","openrouter_api_version"],ready:w=>s(w,"openrouter_api_key")!==""},{provider:"Google",keys:["google_api_key","google_base_url","google_api_version"],ready:w=>s(w,"google_api_key")!==""},{provider:"GoogleTtsVoices",keys:["google_api_key","google_base_url","google_api_version"],ready:w=>s(w,"google_api_key")!==""},{provider:"Azure",keys:["azure_api_key","azure_endpoint","azure_authoring_version","azure_inference_version"],ready:w=>c(w)},{provider:"Claude",keys:["claude_api_key","claude_base_url","claude_api_version"],ready:w=>s(w,"claude_api_key")!==""},{provider:"DeepSeek",keys:["deepseek_api_key","deepseek_base_url","deepseek_api_version"],ready:w=>s(w,"deepseek_api_key")!==""},{provider:"Ollama",keys:["ollama_base_url"],ready:w=>s(w,"ollama_base_url")!==""},{provider:"ElevenLabs",keys:["elevenlabs_api_key"],ready:w=>s(w,"elevenlabs_api_key")!==""},{provider:"ElevenLabsModels",keys:["elevenlabs_api_key"],ready:w=>s(w,"elevenlabs_api_key")!==""},{provider:"Replicate",keys:["replicate_api_key"],ready:w=>s(w,"replicate_api_key")!==""},{provider:"PineconeIndexes",keys:["pinecone_api_key"],ready:w=>s(w,"pinecone_api_key")!==""},{provider:"QdrantCollections",keys:["qdrant_url","qdrant_api_key"],ready:w=>s(w,"qdrant_url")!==""&&s(w,"qdrant_api_key")!==""}].filter(w=>l(m,g,w.keys)&&w.ready(g)).map(w=>w.provider)}function r(m){return m?document.querySelector(`.aipkit_sync_btn[data-provider="${m}"]`):null}let f=null;function u(){if(a)return;let m=i.shift();if(!m)return;a=!0;let{provider:g,options:d,resolve:w,reject:h}=m,b=r(g),A=k(b,g,d);f={provider:g,promise:A},A&&typeof A.finally=="function"?A.then(S=>{typeof w=="function"&&w(S)}).catch(S=>{typeof h=="function"&&h(S)}).finally(()=>{f=null,a=!1,u()}):(f=null,typeof w=="function"&&w(null),a=!1,u())}function p(m,g={}){if(!m)return null;if(f&&f.provider===m&&f.promise)return f.promise;if(i.some(A=>A.provider===m)){let A=i.find(S=>S.provider===m);return A&&A.promise?A.promise:null}let w,h,b=new Promise((A,S)=>{w=A,h=S});return i.push({provider:m,options:g,resolve:w,reject:h,promise:b}),u(),b}function _(m,g){if(!m||!g)return;t(m,g).forEach(w=>p(w,{silent:!0,showSuccess:!0}))}window.aipkit_initSyncButtons=e,window.aipkit_syncModels=k,window.aipkit_queueProviderSync=p,window.aipkit_queueProviderAutoSync=_,window.aipkit_isProviderReadyForAutoSync=o})();(function(){"use strict";let k=window.wp?.i18n?.__||function(E){return E},n="#aipkit_settings_container #aipkit_provider, #aipkit_settings_container #aipkit_settings_integration_provider, #aipkit_settings_container .aipkit_model_field select.aipkit_form-input",e=null,i=null,a=!1,s=E=>{E&&(E.style.position="",E.style.left="",E.style.top="",E.style.bottom="",E.style.width="",E.style.maxWidth="",E.style.minWidth="")},l=(E,v)=>{if(!E||!v)return;E.classList.remove("aipkit_settings_dropdown--dropup");let y=12,C=E.getBoundingClientRect(),M=v.getBoundingClientRect().height||v.scrollHeight||0,B=window.innerHeight-C.bottom-y,D=C.top-y;M>B&&D>B&&E.classList.add("aipkit_settings_dropdown--dropup")},c=(E,v)=>{if(!E||!v)return;l(E,v);let y=12,C=E.getBoundingClientRect(),B=E.classList.contains("aipkit_settings_provider_dropdown")?220:260,D=Math.max(160,window.innerWidth-32),W=Math.min(Math.max(C.width,B),D);v.style.position="fixed",v.style.width=`${Math.round(W)}px`,v.style.minWidth=`${Math.round(Math.min(B,W))}px`,v.style.maxWidth=`${Math.round(W)}px`;let U=v.getBoundingClientRect().height||v.scrollHeight||0,oe=E.classList.contains("aipkit_settings_dropdown--dropup")?C.top-U-6:C.bottom+6;oe+U>window.innerHeight-y&&(oe=window.innerHeight-y-U),oe<y&&(oe=y);let O=C.left;O+W>window.innerWidth-y&&(O=window.innerWidth-y-W),O<y&&(O=y),v.style.left=`${Math.round(O)}px`,v.style.top=`${Math.round(oe)}px`,v.style.bottom="auto"},o=E=>{if(!E)return"";let v=E.getAttribute("data-aipkit-picker-title");if(v)return v;let y=E.id&&document.querySelector(`label[for="${E.id}"]`)||E.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");if(!y)return"";let C=y.cloneNode(!0);return C.querySelectorAll(".aipkit_form-label-helper").forEach(M=>{M.remove()}),C.textContent.replace(/\s+/g," ").trim()},t=E=>{if(!E)return"";let v=E.selectedOptions&&E.selectedOptions.length?E.selectedOptions[0]:E.querySelector("option[selected]");if(v)return v.textContent.trim();let y=E.querySelector("option");return y?y.textContent.trim():""},r=E=>E&&(E.id==="aipkit_provider"||E.id==="aipkit_settings_integration_provider"),f=E=>!!(E&&(E.classList.contains("aipkit_settings_provider_dropdown")||E.classList.contains("aipkit_settings_model_dropdown"))),u=E=>String(E||"").trim().toLowerCase(),p=(E,v)=>{if(!E)return;let y="aipkit_settings_select_picker_icon--";E.classList.forEach(M=>{M.startsWith(y)&&E.classList.remove(M)});let C=u(v);C&&E.classList.add(`${y}${C}`)},_=E=>({buttonId:`${E}_picker_btn`,labelId:`${E}_picker_label`,popoverId:`${E}_picker_popover`,titleId:`${E}_picker_title`,searchId:`${E}_picker_search`,listId:`${E}_picker_list`}),m=E=>{if(!E||!E.id)return null;let v=_(E.id);if(!document.getElementById("aipkit_settings_container"))return null;if(r(E)){let L=document.getElementById(v.popoverId);L&&!L.classList.contains("aipkit_settings_provider_dropdown")&&(L.remove(),L=null),L||(L=document.createElement("div"),L.id=v.popoverId,L.className="aipkit_popover_multiselect aipkit_settings_provider_dropdown",E.insertAdjacentElement("beforebegin",L));let F=document.getElementById(v.buttonId);if(F&&F.parentElement!==L&&(F.remove(),F=null),!F){F=document.createElement("button"),F.type="button",F.id=v.buttonId,F.className="aipkit_popover_multiselect_btn aipkit_settings_select_picker_btn aipkit_settings_select_picker_btn--provider",F.setAttribute("aria-expanded","false");let ve=document.createElement("span");ve.className="aipkit_settings_select_picker_icon",ve.setAttribute("aria-hidden","true"),F.appendChild(ve);let Ie=document.createElement("span");Ie.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",Ie.id=v.labelId,Ie.textContent=t(E)||k("Select","gpt3-ai-content-generator"),F.appendChild(Ie),L.appendChild(F)}let N=L.querySelector(".aipkit_popover_multiselect_panel");N||(N=document.createElement("div"),N.className="aipkit_popover_multiselect_panel aipkit_settings_provider_dropdown_panel",N.hidden=!0,N.setAttribute("role","menu"),L.appendChild(N));let R=N.querySelector(".aipkit_settings_select_picker_list");R||(R=document.createElement("div"),R.className="aipkit_popover_multiselect_options aipkit_settings_select_picker_list",R.id=v.listId,R.setAttribute("role","listbox"),N.appendChild(R));let H=`${v.popoverId}_panel`;N.id=H,F.setAttribute("aria-controls",H);let K=document.getElementById(v.labelId)||(()=>{let ve=document.createElement("span");return ve.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",ve.id=v.labelId,F.appendChild(ve),ve})(),re=F.querySelector(".aipkit_settings_select_picker_icon")||(()=>{let ve=document.createElement("span");return ve.className="aipkit_settings_select_picker_icon",ve.setAttribute("aria-hidden","true"),F.insertBefore(ve,F.firstChild),ve})();return p(re,E.value),E.classList.contains("screen-reader-text")||E.classList.add("screen-reader-text"),{ids:v,button:F,popover:L,label:K,search:null,list:R}}let C=document.getElementById(v.popoverId);C&&!C.classList.contains("aipkit_settings_model_dropdown")&&(C.remove(),C=null),C||(C=document.createElement("div"),C.id=v.popoverId,C.className="aipkit_popover_multiselect aipkit_settings_model_dropdown",E.insertAdjacentElement("beforebegin",C));let M=document.getElementById(v.buttonId);if(M&&M.parentElement!==C&&(M.remove(),M=null),!M){M=document.createElement("button"),M.type="button",M.id=v.buttonId,M.className="aipkit_popover_multiselect_btn aipkit_settings_select_picker_btn",M.setAttribute("aria-expanded","false");let L=document.createElement("span");L.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",L.id=v.labelId,L.textContent=t(E)||k("Select","gpt3-ai-content-generator"),M.appendChild(L),C.appendChild(M)}let B=C.querySelector(".aipkit_popover_multiselect_panel");B||(B=document.createElement("div"),B.className="aipkit_popover_multiselect_panel aipkit_settings_model_dropdown_panel",B.hidden=!0,B.setAttribute("role","menu"),C.appendChild(B));let D=B.querySelector(".aipkit_settings_select_picker_search");D||(D=document.createElement("div"),D.className="aipkit_settings_select_picker_search",B.appendChild(D));let W=document.getElementById(v.searchId);(!W||W.parentElement!==D)&&(W=document.createElement("input"),W.type="search",W.id=v.searchId,W.className="aipkit_form-input",D.appendChild(W));let U=o(E),J=U?`Search ${U.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");W.setAttribute("placeholder",J);let oe=B.querySelector(".aipkit_settings_select_picker_list");oe||(oe=document.createElement("div"),oe.className="aipkit_popover_multiselect_options aipkit_settings_select_picker_list",oe.id=v.listId,oe.setAttribute("role","listbox"),B.appendChild(oe));let O=`${v.popoverId}_panel`;return B.id=O,M.setAttribute("aria-controls",O),E.classList.contains("screen-reader-text")||E.classList.add("screen-reader-text"),{ids:v,button:M,popover:C,label:document.getElementById(v.labelId),search:document.getElementById(v.searchId),list:document.getElementById(v.listId)}},g=E=>{let v=[];return E&&Array.from(E.children).forEach(C=>{if(C.tagName==="OPTGROUP"){let M=Array.from(C.children).filter(B=>B.tagName==="OPTION").map(B=>({value:B.value,label:B.textContent.trim(),disabled:B.disabled,selected:B.selected}));v.push({groupLabel:C.label||"",options:M})}else C.tagName==="OPTION"&&v.push({groupLabel:"",options:[{value:C.value,label:C.textContent.trim(),disabled:C.disabled,selected:C.selected}]})}),v},d=(E,v,y="")=>{if(!E||!v)return;let C=y.trim().toLowerCase();if(v.innerHTML="",r(E)){let D=g(E).flatMap(W=>W.options||[]).filter(W=>C?W.label.toLowerCase().includes(C):!0);if(!D.length){let W=document.createElement("div");W.className="aipkit_popover_multiselect_empty aipkit_settings_select_picker_empty",W.textContent=k(C?"No matches found.":"No options available.","gpt3-ai-content-generator"),v.appendChild(W);return}D.forEach(W=>{let U=document.createElement("button");U.type="button",U.className="aipkit_settings_select_picker_item aipkit_popover_multiselect_item aipkit_settings_provider_dropdown_item",U.setAttribute("role","option"),U.dataset.value=W.value,U.dataset.label=W.label,W.disabled&&(U.classList.add("is-disabled"),U.setAttribute("aria-disabled","true")),E.value===W.value?(U.classList.add("is-active"),U.setAttribute("aria-selected","true")):U.setAttribute("aria-selected","false");let J=document.createElement("span");J.className="aipkit_settings_select_picker_icon",J.setAttribute("aria-hidden","true"),p(J,W.value);let oe=document.createElement("span");oe.className="aipkit_settings_select_picker_text aipkit_popover_multiselect_text",oe.textContent=W.label,U.appendChild(J),U.appendChild(oe),v.appendChild(U)});return}let M=g(E),B=!1;if(M.forEach(D=>{let W=D.options.filter(J=>C?J.label.toLowerCase().includes(C):!0);if(!W.length)return;if(D.groupLabel){let J=document.createElement("div");J.className="aipkit_settings_select_picker_group_label",J.textContent=D.groupLabel,v.appendChild(J)}let U=`aipkit_settings_picker_${E.id}`;W.forEach(J=>{let oe=document.createElement("label");oe.className="aipkit_settings_select_picker_item aipkit_popover_multiselect_item aipkit_settings_model_dropdown_item",oe.setAttribute("role","option"),oe.dataset.value=J.value,oe.dataset.label=J.label,J.disabled&&(oe.classList.add("is-disabled"),oe.setAttribute("aria-disabled","true")),E.value===J.value?(oe.classList.add("is-active"),oe.setAttribute("aria-selected","true")):oe.setAttribute("aria-selected","false");let O=document.createElement("span");O.className="aipkit_settings_model_dropdown_item_label";let L=document.createElement("input");L.type="radio",L.className="aipkit_settings_select_picker_radio",L.name=U,L.value=J.value,L.checked=E.value===J.value,L.disabled=!!J.disabled;let F=document.createElement("span");F.className="aipkit_settings_select_picker_text aipkit_popover_multiselect_text",F.textContent=J.label,O.appendChild(L),O.appendChild(F),oe.appendChild(O),v.appendChild(oe),B=!0})}),!B){let D=document.createElement("div");D.className="aipkit_settings_select_picker_empty",D.textContent=k(C?"No matches found.":"No options available.","gpt3-ai-content-generator"),v.appendChild(D)}},w=(E,v)=>{if(!E||!v)return;let y=t(E);if(v.textContent=y||k("Select","gpt3-ai-content-generator"),r(E)){let C=v.closest("button"),M=C?C.querySelector(".aipkit_settings_select_picker_icon"):null;p(M,E.value)}},h=(E,v)=>{if(!E||!v)return;if(v.closest(".aipkit_settings_provider_dropdown")||v.closest(".aipkit_settings_model_dropdown")){v.style.left="",v.style.top="";return}if(v.closest(".aipkit_settings_select_picker_popover")?.classList.contains("aipkit_settings_select_picker_popover--provider-anchor")){v.style.left="",v.style.top="";return}let y=E.getBoundingClientRect(),C=v.getBoundingClientRect(),M=C.width||320,B=C.height||0,D=window.innerWidth,W=window.innerHeight,U=12;if(E.dataset.aipkitPopoverPlacement==="bottom"){let O=y.left;O+M>D-U&&(O=y.right-M),O=Math.max(U,Math.min(O,D-M-U));let L=y.bottom+8;L+B>W-U&&(L=y.top-B-8),L=Math.max(U,Math.min(L,W-B-U)),v.style.left=`${Math.round(O)}px`,v.style.top=`${Math.round(L)}px`;return}let J=y.right+10;J+M>D-U&&(J=y.left-M-10),J=Math.max(U,Math.min(J,D-M-U));let oe=y.top;oe+B>W-U&&(oe=W-B-U),oe=Math.max(U,oe),v.style.left=`${Math.round(J)}px`,v.style.top=`${Math.round(oe)}px`},b=()=>{if(!(!e||!i||a)){if(f(e)){let E=e.querySelector(".aipkit_popover_multiselect_panel");c(e,E);return}a=!0,window.requestAnimationFrame(()=>{let E=e.querySelector(".aipkit_model_settings_popover_panel");h(i,E),a=!1})}},A=()=>{if(e){if(f(e)){e.classList.remove("is-open"),e.classList.remove("aipkit_settings_dropdown--dropup");let E=e.querySelector(".aipkit_popover_multiselect_panel");E&&(E.hidden=!0,s(E))}else e.classList.remove("aipkit-active"),e.setAttribute("aria-hidden","true");i&&i.setAttribute("aria-expanded","false"),e=null,i=null}},S=(E,v,y)=>{if(!E||!v)return;e&&e!==v&&A(),e=v,i=E;let C=f(v);if(C){v.classList.add("is-open");let W=v.querySelector(".aipkit_popover_multiselect_panel");W&&(W.hidden=!1)}else v.classList.add("aipkit-active"),v.setAttribute("aria-hidden","false");E.setAttribute("aria-expanded","true");let M=v.querySelector(".aipkit_settings_select_picker_search input"),B=v.querySelector(".aipkit_settings_select_picker_list");if(B&&d(y,B,M?M.value:""),C){let W=v.querySelector(".aipkit_popover_multiselect_panel");W&&window.requestAnimationFrame(()=>{c(v,W)})}if(M&&M.offsetParent!==null&&(M.focus(),M.select()),C)return;let D=v.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{h(E,D)})},I=(E,v)=>{if(!E||!v)return;let{button:y,popover:C,list:M,search:B}=v;if(y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("click",D=>{if(D.preventDefault(),e===C){A();return}S(y,C,E)}),y.dataset.pickerListenerAttached="true"),C&&!f(C)&&C.dataset.overlayListenerAttached!=="true"){C.addEventListener("click",W=>{W.target===C&&A()});let D=C.querySelector(".aipkit_model_settings_popover_close");D&&D.addEventListener("click",W=>{W.preventDefault(),A()}),C.dataset.overlayListenerAttached="true"}if(M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("click",D=>{let W=D.target.closest(".aipkit_settings_select_picker_item");if(!W||W.classList.contains("is-disabled"))return;let U=W.dataset.value??"";E.value=U,E.dispatchEvent(new Event("change",{bubbles:!0})),w(E,v.label),d(E,M,B?B.value:""),A()}),M.dataset.pickerListenerAttached="true"),B&&B.dataset.pickerListenerAttached!=="true"&&(B.addEventListener("input",()=>{d(E,M,B.value)}),B.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("change",()=>{w(E,v.label),d(E,M,B?B.value:"")}),E.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerObserverAttached!=="true"){let D=!1;new MutationObserver(()=>{D||(D=!0,window.requestAnimationFrame(()=>{w(E,v.label),d(E,M,B?B.value:""),D=!1}))}).observe(E,{childList:!0,subtree:!0}),E.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitSettingsPickerEscapeBound||(document.addEventListener("keydown",D=>{D.key==="Escape"&&e&&A()}),document.body.dataset.aipkitSettingsPickerEscapeBound="true"),document.body.dataset.aipkitSettingsPickerOutsideBound||(document.addEventListener("mousedown",D=>{if(!e||!f(e))return;let W=D.target;e.contains(W)||i&&i.contains(W)||A()}),document.body.dataset.aipkitSettingsPickerOutsideBound="true"),document.body.dataset.aipkitSettingsPickerRepositionBound||(window.addEventListener("resize",b),window.addEventListener("scroll",b,!0),document.body.dataset.aipkitSettingsPickerRepositionBound="true")};function T(){let E=document.getElementById("aipkit_settings_container");if(!E)return;let v=E.querySelectorAll(n);v.length&&v.forEach(y=>{if(!y.id||y.dataset.aipkitPickerInit==="true")return;let C=m(y);C&&(w(y,C.label),d(y,C.list,C.search?C.search.value:""),I(y,C),y.dataset.aipkitPickerInit="true")})}function x(){let E=document.getElementById("aipkit_settings_container");if(!E)return;E.querySelectorAll(n).forEach(y=>{if(!y.id)return;let C=m(y);C&&(w(y,C.label),d(y,C.list,C.search?C.search.value:""),I(y,C),y.dataset.aipkitPickerInit="true")})}window.aipkit_initSettingsSelectPickers=T,window.aipkit_refreshSettingsSelectPickers=x})();(function(){"use strict";function k(e,i,a){if(!e||!i)return;i.hidden=!a,i.style.display=a?"grid":"none",e.querySelectorAll(".aipkit_settings_advanced_toggle_link").forEach(l=>{l.setAttribute("aria-expanded",a?"true":"false"),l.classList.toggle("is-open",a)})}function n(){let e=document.getElementById("aipkit_settings_container");if(!e)return;let i=e.querySelector("#aipkit_settings_advanced_group");if(!i)return;let a=!i.hidden&&i.style.display!=="none";k(e,i,a),e.dataset.aipkitAdvancedToggleInit!=="true"&&(e.addEventListener("click",s=>{let l=s.target.closest(".aipkit_settings_advanced_toggle_link");if(!l||!e.contains(l))return;s.preventDefault();let c=i.hidden;k(e,i,c)}),e.dataset.aipkitAdvancedToggleInit="true")}window.aipkit_initSettingsAdvancedToggle=n})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_settings_container");if(!n)return;let e=n.querySelectorAll("[data-aipkit-settings-page-link]"),i=n.querySelectorAll("[data-aipkit-settings-page]");if(!e.length||!i.length)return;let a=new Set(Array.from(i).map(c=>c.dataset.aipkitSettingsPage||"")),s=a.has("ai")?"ai":Array.from(a)[0]||"",l=c=>{let o=a.has(c)?c:s;o&&(e.forEach(t=>{let r=t.dataset.aipkitSettingsPageLink===o;t.classList.toggle("is-active",r),t.setAttribute("aria-current",r?"page":"false")}),i.forEach(t=>{let r=t.dataset.aipkitSettingsPage===o;t.hidden=!r}),(o==="ai"||o==="integrations")&&typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers())};e.forEach(c=>{c.dataset.aipkitSettingsPageNavBound!=="true"&&(c.addEventListener("click",o=>{o.preventDefault(),l(c.dataset.aipkitSettingsPageLink||s)}),c.dataset.aipkitSettingsPageNavBound="true")}),l(s)}window.aipkit_initSettingsPageNav=k})();(function(){"use strict";let k="elevenlabs";function n(){return document.getElementById("aipkit_settings_container")}function e(){let l=n();return l?l.querySelector("#aipkit_settings_integration_provider"):null}function i(l,c){if(l){if(c){l.hidden=!1,l.style.display=l.classList.contains("aipkit_settings_simple_row")?"grid":"block";return}l.hidden=!0,l.style.display="none"}}function a(){let l=n();if(!l)return;let c=e();if(!c)return;let o=(c.value||k).trim().toLowerCase();l.querySelectorAll("[data-aipkit-integration-provider]").forEach(r=>{let f=String(r.getAttribute("data-aipkit-integration-provider")||"").trim().toLowerCase();i(r,f===o)}),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function s(){let l=e();if(l){if(l.dataset.aipkitIntegrationToggleBound==="true"){a();return}l.addEventListener("change",()=>{a()}),l.dataset.aipkitIntegrationToggleBound="true",a()}}window.aipkit_toggleIntegrationRows=a,window.aipkit_initIntegrationsProviderToggle=s})();(function(){"use strict";let k=window.wp?.i18n?.__||(_=>_),n="aipkit_settings_global_messages";function e(){return document.getElementById("aipkit_settings_container")}function i(){let _=e();return _?_.querySelector(".aipkit_settings_simple_form--others"):null}function a(_,m){if(typeof window.aipkit_showMessage=="function"){window.aipkit_showMessage(n,_,m);return}_==="error"?console.error(m):console.log(m)}function s(_,m,g=""){if(!_)return;if(m){_.dataset.originalLabel||(_.dataset.originalLabel=_.textContent||""),_.disabled=!0,_.classList.add("aipkit_loading");let w=_.querySelector(".aipkit_spinner");w||(w=document.createElement("span"),w.className="aipkit_spinner",_.appendChild(w)),w.style.display="inline-block",g&&(_.textContent=g,_.appendChild(w));return}_.disabled=!1,_.classList.remove("aipkit_loading"),_.dataset.originalLabel&&(_.textContent=_.dataset.originalLabel,delete _.dataset.originalLabel);let d=_.querySelector(".aipkit_spinner");d&&(d.style.display="none",_.appendChild(d))}function l(_,m){let g=JSON.stringify(_,null,2),d=new Blob([g],{type:"application/json"}),w=URL.createObjectURL(d),h=document.createElement("a");h.href=w,h.download=m,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(w)}function c(_,m){if(!_||typeof _!="object")return"";let g=_[m];return g==null?"":String(g).trim()}function o(_,m){switch(_){case"OpenAI":return c(m,"openai_api_key")!=="";case"OpenRouter":return c(m,"openrouter_api_key")!=="";case"Google":return c(m,"google_api_key")!=="";case"Azure":return c(m,"azure_api_key")!==""&&c(m,"azure_endpoint")!=="";case"Claude":return c(m,"claude_api_key")!=="";case"DeepSeek":return c(m,"deepseek_api_key")!=="";case"Ollama":return c(m,"ollama_base_url")!=="";case"ElevenLabs":case"ElevenLabsModels":return c(m,"elevenlabs_api_key")!=="";case"Replicate":return c(m,"replicate_api_key")!=="";case"PineconeIndexes":return c(m,"pinecone_api_key")!=="";case"QdrantCollections":return c(m,"qdrant_url")!==""&&c(m,"qdrant_api_key")!=="";default:return!1}}async function t(_){if(typeof window.aipkit_apiRequest!="function"){a("error",k("API helper missing.","gpt3-ai-content-generator"));return}s(_,!0,k("Exporting...","gpt3-ai-content-generator"));try{let m=await window.aipkit_apiRequest("aipkit_export_settings_backup");if(!m||typeof m!="object"||!m.export_data)throw new Error(k("Export payload was empty.","gpt3-ai-content-generator"));let g=m.filename||`aipkit-settings-backup-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`;l(m.export_data,g),a("success",m.message||k("Settings export completed.","gpt3-ai-content-generator"))}catch(m){a("error",k("Export failed: ","gpt3-ai-content-generator")+(m?.message||""))}finally{s(_,!1)}}async function r(_,m){let g=_?.files?.[0];if(g){if(typeof window.aipkit_apiRequest!="function"){a("error",k("API helper missing.","gpt3-ai-content-generator"));return}s(m,!0,k("Importing...","gpt3-ai-content-generator")),a("info",k("Importing settings...","gpt3-ai-content-generator"));try{let d=await window.aipkit_apiRequest("aipkit_import_settings_backup",{settings_backup_file:g});a("success",d?.message||k("Settings imported. Reloading...","gpt3-ai-content-generator")),s(m,!1),setTimeout(()=>{window.location.reload()},750)}catch(d){a("error",k("Import failed: ","gpt3-ai-content-generator")+(d?.message||"")),s(m,!1)}finally{_&&(_.value="")}}}async function f(_,m,g){if(typeof window.aipkit_apiRequest!="function")return a("error",k("API helper missing.","gpt3-ai-content-generator")),!1;s(_,!0,k("Working...","gpt3-ai-content-generator"));try{let d=await window.aipkit_apiRequest(m);return a("success",d?.message||g),typeof window.aipkit_updateLastSavedData=="function"&&window.aipkit_updateLastSavedData(),!0}catch(d){return a("error",k("Action failed: ","gpt3-ai-content-generator")+(d?.message||"")),!1}finally{s(_,!1)}}async function u(_){if(typeof window.aipkit_queueProviderSync!="function"){a("error",k("Model sync helper is not available.","gpt3-ai-content-generator"));return}let m=typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_getCurrentFormData():{},d=[{provider:"OpenAI",label:"OpenAI"},{provider:"OpenRouter",label:"OpenRouter"},{provider:"Google",label:"Google"},{provider:"Azure",label:"Azure"},{provider:"Claude",label:"Claude"},{provider:"DeepSeek",label:"DeepSeek"},{provider:"Ollama",label:"Ollama"},{provider:"ElevenLabs",label:"ElevenLabs Voices"},{provider:"ElevenLabsModels",label:"ElevenLabs Models"},{provider:"Replicate",label:"Replicate"},{provider:"PineconeIndexes",label:"Pinecone"},{provider:"QdrantCollections",label:"Qdrant"}].filter(b=>o(b.provider,m));if(!d.length){a("info",k("No providers are ready to sync yet.","gpt3-ai-content-generator"));return}s(_,!0,k("Syncing...","gpt3-ai-content-generator")),a("info",k("Running sync for all ready providers...","gpt3-ai-content-generator"));let w=[],h=[];for(let b of d)try{await window.aipkit_queueProviderSync(b.provider,{silent:!0,showErrors:!1,showSuccess:!1,propagateError:!0}),h.push(b.label)}catch(A){w.push({label:b.label,message:A?.message||k("Unknown error","gpt3-ai-content-generator")})}if(typeof window.aipkit_updateLastSavedData=="function"&&window.aipkit_updateLastSavedData(),w.length>0){let b=w.map(A=>A.label).join(", ");a("error",k("Sync completed with errors: ","gpt3-ai-content-generator")+b)}else a("success",k("Models synced for: ","gpt3-ai-content-generator")+h.join(", "));s(_,!1)}function p(){let _=i();if(!_||_.dataset.aipkitOthersActionsBound==="true")return;let m=_.querySelector("#aipkit_settings_import_trigger"),g=_.querySelector("#aipkit_settings_import_file");_.addEventListener("click",d=>{let w=d.target.closest("[data-aipkit-settings-action]");if(!w||w.disabled)return;let h=w.getAttribute("data-aipkit-settings-action");if(h)switch(d.preventDefault(),h){case"export-backup":t(w);break;case"import-trigger":g&&g.click();break;case"create-restore-point":f(w,"aipkit_create_settings_restore_point",k("Restore point created.","gpt3-ai-content-generator"));break;case"restore-restore-point":f(w,"aipkit_restore_settings_restore_point",k("Restore point applied. Reloading...","gpt3-ai-content-generator")).then(b=>{b&&setTimeout(()=>{window.location.reload()},750)});break;case"clear-model-cache":f(w,"aipkit_clear_settings_model_cache",k("Model cache cleared.","gpt3-ai-content-generator"));break;case"clear-transients":f(w,"aipkit_clear_settings_transients",k("Transient cache cleared.","gpt3-ai-content-generator"));break;case"sync-all-models":u(w);break;default:break}}),g&&g.addEventListener("change",()=>{r(g,m)}),_.dataset.aipkitOthersActionsBound="true"}window.aipkit_initSettingsOthersActions=p})();(function(){"use strict";let k=!1,n=window.aipkit_escapeHtml||(g=>g||""),e={},i={},a=120,s="aipkit_content_writer_messages";function l(g,d){if(!g||typeof g!="string")return"";if(g.length<=d)return g;let w=g.substring(0,d-1);return w.substring(0,w.lastIndexOf(" ")).trim()+"\u2026"}function c(g){let d={"":i.use_default_position||"Default",default:i.use_default_position||"Default",replace:i.replace_selection||"Replace",after:i.insert_after||"After",before:i.insert_before||"Before"};return d[g]||d[""]}function o(g){let d=document.createElement("div");d.className="aipkit_assistant_action_card",d.dataset.actionId=g.id,d.dataset.label=g.label,d.dataset.prompt=g.prompt,d.dataset.insertPosition=g.insert_position||"";let w=n(g.prompt),h=l(w,a),b=w.length>a;return d.innerHTML=`
      <div class="aipkit_assistant_action_drag" draggable="true" title="Drag to reorder">
        <span class="dashicons dashicons-move" aria-hidden="true"></span>
      </div>
      <div class="aipkit_assistant_action_content">
        <div class="aipkit_assistant_action_label">${n(g.label)}</div>
        <div class="aipkit_assistant_action_prompt ${b?"":"aipkit_assistant_action_prompt--full"}">${b?h:w}</div>
        ${b?'<button type="button" class="aipkit-enhancer-prompt-toggle" style="background:none;border:none;padding:0;color:#2271b1;font-size:11px;cursor:pointer;text-decoration:underline;">Show more</button>':""}
      </div>
      <div class="aipkit_assistant_action_controls">
        <button type="button" class="aipkit_assistant_action_btn_small aipkit-enhancer-edit-action-btn" aria-label="${n(i.edit_action||"Edit")}">
          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
        </button>
        <button type="button" class="aipkit_assistant_action_btn_small aipkit_assistant_action_btn_small--danger aipkit-enhancer-delete-action-btn" aria-label="${n(i.delete_action||"Delete")}">
          <span class="dashicons dashicons-trash" aria-hidden="true"></span>
        </button>
      </div>
    `,d}function t(g,d=!1){let w=(g.insert_position||"").trim();return`
      <div class="aipkit_assistant_action_edit_form">
        <div class="aipkit_assistant_action_edit_row">
          <div>
            <label class="aipkit_assistant_action_edit_label">${n(i.action_label||"Label")}</label>
            <input type="text" class="aipkit-edit-label" value="${n(g.label)}" placeholder="${n(i.action_label||"Action name")}" maxlength="50">
          </div>
          <div>
            <label class="aipkit_assistant_action_edit_label">${n(i.insert_position||"Position")}</label>
            <select class="aipkit-edit-position">
              <option value="" ${w===""?"selected":""}>${n(i.use_default_position||"Use default")}</option>
              <option value="replace" ${w==="replace"?"selected":""}>${n(i.replace_selection||"Replace selection")}</option>
              <option value="after" ${w==="after"?"selected":""}>${n(i.insert_after||"Insert after")}</option>
              <option value="before" ${w==="before"?"selected":""}>${n(i.insert_before||"Insert before")}</option>
            </select>
          </div>
        </div>
        <div>
          <label class="aipkit_assistant_action_edit_label">${n(i.action_prompt||"Prompt")}</label>
          <textarea class="aipkit-edit-prompt" rows="3" placeholder="${n("Enter prompt. Use %s for selected text.")}">${n(g.prompt)}</textarea>
        </div>
        <div class="aipkit_assistant_action_edit_actions">
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--secondary aipkit-enhancer-cancel-action-btn">
            ${n(i.cancel||"Cancel")}
          </button>
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--primary aipkit-enhancer-save-action-btn">
            ${n(i.save||"Save")}
          </button>
        </div>
      </div>
    `}function r(g){let d={id:g.dataset.actionId,label:g.dataset.label,prompt:g.dataset.prompt,insert_position:g.dataset.insertPosition||""};g.classList.add("aipkit_assistant_action_card--editing"),g.innerHTML=t(d);let w=g.querySelector(".aipkit-edit-prompt");w&&(w.value=d.prompt);let h=g.querySelector(".aipkit-edit-label");h&&(h.focus(),h.select())}function f(g,d){g.dataset.actionId=d.id,g.dataset.label=d.label,g.dataset.prompt=d.prompt,g.dataset.insertPosition=d.insert_position||"",g.classList.remove("aipkit_assistant_action_card--editing");let w=o(d);g.innerHTML=w.innerHTML}function u(g){if(g.querySelectorAll(".aipkit_assistant_action_card").length>=10){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",i.max_actions_reached||"Maximum of 10 actions reached.");return}if(g.querySelector('[data-action-id^="new-"]'))return;let w=document.createElement("div");w.className="aipkit_assistant_action_card aipkit_assistant_action_card--editing",w.dataset.actionId=`new-${Date.now()}`,w.dataset.label="",w.dataset.prompt="",w.dataset.insertPosition="",w.innerHTML=t({id:w.dataset.actionId,label:"",prompt:"",insert_position:""},!0),g.prepend(w);let h=w.querySelector(".aipkit-edit-label");h&&h.focus()}async function p(g){if(k)return;let d=g.querySelector(".aipkit-edit-label"),w=g.querySelector(".aipkit-edit-prompt"),h=g.querySelector(".aipkit-edit-position");if(!d||!w)return;g.querySelectorAll(".aipkit_form-help-error").forEach(E=>E.remove()),d.style.borderColor="",w.style.borderColor="";let b=d.value.trim(),A=w.value.trim(),S=h?h.value:"",I=g.dataset.actionId,T=!1;if(!b){d.style.borderColor="#dc2626";let E=document.createElement("div");E.className="aipkit_form-help aipkit_form-help-error",E.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",E.textContent=i.label_required||"Label is required",d.parentNode.appendChild(E),T=!0}if(!A){w.style.borderColor="#dc2626";let E=document.createElement("div");E.className="aipkit_form-help aipkit_form-help-error",E.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",E.textContent=i.prompt_required||"Prompt is required",w.parentNode.appendChild(E),T=!0}if(T)return;k=!0;let x=g.querySelector(".aipkit-enhancer-save-action-btn");x&&(x.textContent=i.saving_action||"Saving...",x.disabled=!0);try{let E=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:I,label:b,prompt:A,insert_position:S,_ajax_nonce:e.nonce_manage_actions});f(g,E.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",i.action_saved||"Action saved successfully")}catch(E){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${i.error||"Error"}: ${E.message}`),x&&(x.textContent=i.save||"Save",x.disabled=!1)}finally{k=!1}}async function _(g){let d=g.querySelector("#aipkit_enhancer_actions_list");d.innerHTML=`
      <div class="aipkit_assistant_loading" style="text-align:center;padding:24px;color:#64748b;">
        <span class="dashicons dashicons-update" style="animation:spin 1s linear infinite;"></span>
        <span style="margin-left:8px;">${n(i.loading_actions||"Loading actions...")}</span>
      </div>
    `;try{let w=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:e.nonce_manage_actions});d.innerHTML="";let h=w.actions||[];h.length===0?d.innerHTML=`
          <div class="aipkit_assistant_empty_state">
            <div class="aipkit_assistant_empty_state_icon">
              <span class="dashicons dashicons-edit-large" aria-hidden="true"></span>
            </div>
            <div class="aipkit_assistant_empty_state_text">
              ${n(i.no_actions||'No actions yet. Click "Add Action" to create one.')}
            </div>
          </div>
        `:h.forEach(b=>{d.appendChild(o(b))})}catch(w){d.innerHTML="",typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",w.message||i.loading_failed||"Failed to load actions.")}}function m(){let g=document.getElementById("aipkit_enhancer_actions_container");if(!g)return;let d=g.closest(".aipkit_assistant_settings_redesigned")||g;if(d.dataset.listenerAttached==="true")return;d.dataset.listenerAttached="true",g.dataset.listenerAttached="true";let w=g.closest(".aipkit_assistant_settings_redesigned")||d;e=window.aipkit_post_enhancer||{},i=e.text||{};let h=g.querySelector("#aipkit_enhancer_actions_list");if(!h)return;let b=w.querySelectorAll(".aipkit_assistant_position_option"),A=()=>{b.forEach(x=>{let E=x.querySelector("input[type=radio]");x.classList.toggle("aipkit_assistant_position_option--active",!!(E&&E.checked))})};A(),b.forEach(x=>{let E=x.querySelector("input[type=radio]");E&&E.addEventListener("change",A)});let S=null,I=null,T=async()=>{if(k)return;let x=Array.from(h.querySelectorAll(".aipkit_assistant_action_card")).map(C=>C.dataset.actionId).filter(C=>C&&!C.startsWith("new-"));if(!x.length)return;let E=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,v=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,y=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;k=!0,E&&E(i.saving_order||"Saving order...");try{await window.aipkit_apiRequest("aipkit_reorder_enhancer_actions",{order:x,_ajax_nonce:e.nonce_manage_actions}),v&&v(i.order_saved||"Order saved.")}catch(C){y?y(`${i.error||"Error"}: ${C.message}`):typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${i.error||"Error"}: ${C.message}`)}finally{k=!1}};h.addEventListener("dragstart",x=>{let E=x.target.closest(".aipkit_assistant_action_drag");if(!E)return;let v=E.closest(".aipkit_assistant_action_card");if(!v||v.classList.contains("aipkit_assistant_action_card--editing")){x.preventDefault();return}S=v,v.classList.add("aipkit_dragging");try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",v.dataset.actionId||"")}catch{}}),h.addEventListener("dragend",async()=>{S&&S.classList.remove("aipkit_dragging"),S=null,I=null,await T()}),h.addEventListener("dragover",x=>{if(!S)return;let E=x.target.closest(".aipkit_assistant_action_card");if(!E||E===S)return;x.preventDefault();let v=E.getBoundingClientRect(),C=x.clientY<v.top+v.height/2?E:E.nextSibling;(I!==E||S.nextSibling!==C)&&(h.insertBefore(S,C),I=E)}),h.addEventListener("drop",async x=>{S&&(x.preventDefault(),await T())}),d.addEventListener("click",async x=>{let E=x.target.closest(".aipkit-enhancer-add-new-btn"),v=x.target.closest(".aipkit-enhancer-reset-actions-btn"),y=x.target.closest(".aipkit-enhancer-edit-action-btn"),C=x.target.closest(".aipkit-enhancer-delete-action-btn"),M=x.target.closest(".aipkit-enhancer-save-action-btn"),B=x.target.closest(".aipkit-enhancer-cancel-action-btn"),D=x.target.closest(".aipkit-enhancer-prompt-toggle");if(E)u(h);else if(v){if(!confirm(i.confirm_reset_actions||"Reset all actions to defaults? This cannot be undone."))return;try{await window.aipkit_apiRequest("aipkit_reset_enhancer_actions",{_ajax_nonce:e.nonce_manage_actions}),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",i.actions_reset||"Actions reset to defaults."),_(g)}catch(W){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${i.error||"Error"}: ${W.message}`)}}else if(D){let W=D.closest(".aipkit_assistant_action_card"),U=W.querySelector(".aipkit_assistant_action_prompt"),J=W.dataset.prompt;D.textContent.toLowerCase().includes("more")?(U.textContent=n(J),U.classList.add("aipkit_assistant_action_prompt--full"),D.textContent="Show less"):(U.textContent=l(n(J),a),U.classList.remove("aipkit_assistant_action_prompt--full"),D.textContent="Show more")}else if(y)r(y.closest(".aipkit_assistant_action_card"));else if(M)await p(M.closest(".aipkit_assistant_action_card"));else if(B){let W=B.closest(".aipkit_assistant_action_card");W.dataset.actionId.startsWith("new-")?W.remove():f(W,{id:W.dataset.actionId,label:W.dataset.label,prompt:W.dataset.prompt,insert_position:W.dataset.insertPosition})}else if(C){if(k)return;let W=C.closest(".aipkit_assistant_action_card"),U=W.dataset.actionId;if(!confirm(i.confirm_delete_action||"Delete this action? This cannot be undone."))return;k=!0,C.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:U,_ajax_nonce:e.nonce_manage_actions}),W.style.transition="opacity 0.2s, transform 0.2s",W.style.opacity="0",W.style.transform="translateX(-10px)",setTimeout(()=>W.remove(),200),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",i.action_deleted||"Action deleted.")}catch(J){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${i.error||"Error"}: ${J.message}`),C.disabled=!1}finally{k=!1}}}),d.addEventListener("keydown",x=>{if(x.key==="Enter"&&x.target.matches("input[type=text]")){x.preventDefault();let E=x.target.closest(".aipkit_assistant_action_card--editing");E&&p(E)}}),window.aipkit_enhancer_reload_actions=()=>_(g),_(g)}window.aipkit_initEnhancerActionsUI=m})();(function(){"use strict";let k=[],n=[];function e(s){let l=document.getElementById("aipkit_semantic_search_target_id");if(!l)return;let c=l.value;l.innerHTML='<option value="">-- Select --</option>';let o=[];s==="pinecone"?o=k:s==="qdrant"&&(o=n),Array.isArray(o)&&o.forEach(t=>{let r=t.name||t.id||(typeof t=="string"?t:null);if(r){let f=document.createElement("option");f.value=r,f.textContent=r,l.appendChild(f)}}),l.querySelector(`option[value="${CSS.escape(c)}"]`)&&(l.value=c)}function i(s){let l=document.getElementById("aipkit_semantic_search_embedding_provider");if(!l||!s)return;let c=s.options[s.selectedIndex];c&&c.dataset.provider&&(l.value=c.dataset.provider)}function a(){let s=document.getElementById("aipkit_settings_container");if(!s)return;let l="data-semantic-search-listener-attached";if(s.getAttribute(l))return;let c=document.getElementById("aipkit_semantic_search_vector_provider"),o=document.getElementById("aipkit_pinecone_indexes_json_main"),t=document.getElementById("aipkit_qdrant_collections_json_main"),r=document.getElementById("aipkit_semantic_search_embedding_model");if(c){if(o&&o.dataset.indexes)try{k=JSON.parse(o.dataset.indexes)||[]}catch(f){console.error("Error parsing Pinecone indexes JSON:",f)}if(t&&t.dataset.collections)try{n=JSON.parse(t.dataset.collections)||[]}catch(f){console.error("Error parsing Qdrant collections JSON:",f)}c&&(c.addEventListener("change",f=>{if(e(f.target.value),typeof window.aipkit_handleAutoSave=="function"){let u=document.getElementById("aipkit_semantic_search_target_id");u&&(u.value=""),window.aipkit_handleAutoSave()}}),e(c.value)),r&&(r.addEventListener("change",f=>{i(f.target)}),i(r)),s.setAttribute(l,"true")}}window.aipkit_initSemanticSearchUI=a})();(function(){"use strict";function k(){let e=document.getElementById("aipkit_settings_container");if(!e)return;let i=e.querySelector("#aipkit_provider");if(!i)return;let a=i.value,s=e.querySelectorAll(".aipkit_api_key_field"),l=e.querySelectorAll(".aipkit_model_field"),c=e.querySelectorAll(".aipkit_advanced_settings_provider"),o=e.querySelector("#aipkit_safety_settings_accordion"),t=e.querySelectorAll(".aipkit_param_not_openai");s.forEach(p=>p.style.display="none"),l.forEach(p=>p.style.display="none"),c.forEach(p=>p.style.display="none"),o&&(o.style.display="none"),e.querySelectorAll(`.aipkit_api_key_field[data-provider="${a}"]`).forEach(p=>{p.style.display=p.classList.contains("aipkit_settings_simple_row")?"grid":"block"}),e.querySelectorAll(`.aipkit_model_field[data-provider="${a}"]`).forEach(p=>{p.style.display=p.classList.contains("aipkit_settings_simple_row")?"grid":"block"});let u=e.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${a}"]`);u&&(u.style.display="block"),a==="Google"&&o&&(o.style.display="block"),a==="OpenAI"||a==="Google"?t.forEach(p=>p.style.display="none"):t.forEach(p=>p.style.display="block"),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function n(){let e=document.getElementById("aipkit_provider");if(e){let i="data-provider-listener-attached";if(e.getAttribute(i)==="true")return;e.addEventListener("change",function(){let a=e.value;k();let s=function(){if(typeof window.aipkit_queueProviderSync!="function"||typeof window.aipkit_getCurrentFormData!="function"||typeof window.aipkit_isProviderReadyForAutoSync!="function")return;let c=window.aipkit_getCurrentFormData();if(window.aipkit_isProviderReadyForAutoSync(a,c)){window.aipkit_queueProviderSync(a,{silent:!0,showSuccess:!0});return}typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage("aipkit_settings_global_messages","info",a+" credentials missing. Add API key.")},l=null;typeof window.aipkit_handleAutoSave=="function"?l=window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found."),l&&typeof l.finally=="function"?l.finally(s):s()}),e.setAttribute(i,"true"),k()}}window.aipkit_toggleProviderFields=k,window.aipkit_initProviderSelectListener=n})();(function(){"use strict";function k(){let e=document.getElementById("aipkit_settings_container");!e||e.dataset.aipkitLabelClickGuard==="true"||(e.addEventListener("click",function(i){let a=i.target.closest(".aipkit_settings_simple_row > .aipkit_form-label, .aipkit_settings_advanced_label");!a||!e.contains(a)||i.preventDefault()}),e.dataset.aipkitLabelClickGuard="true")}function n(){k(),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),typeof window.aipkit_initIntegrationsProviderToggle=="function"?window.aipkit_initIntegrationsProviderToggle():console.error("Settings Init: aipkit_initIntegrationsProviderToggle not found."),typeof window.aipkit_initSettingsSelectPickers=="function"?window.aipkit_initSettingsSelectPickers():console.error("Settings Init: aipkit_initSettingsSelectPickers not found."),typeof window.aipkit_initSettingsAdvancedToggle=="function"?window.aipkit_initSettingsAdvancedToggle():console.error("Settings Init: aipkit_initSettingsAdvancedToggle not found."),typeof window.aipkit_initSettingsPageNav=="function"?window.aipkit_initSettingsPageNav():console.error("Settings Init: aipkit_initSettingsPageNav not found."),typeof window.aipkit_initSettingsOthersActions=="function"?window.aipkit_initSettingsOthersActions():console.error("Settings Init: aipkit_initSettingsOthersActions not found."),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(i=>{i.dataset.accordionListenerAttached!=="true"&&(i.addEventListener("click",function(){let a=this.nextElementSibling;if(a){this.classList.toggle("aipkit_active"),a.classList.toggle("aipkit_active");let s=this.closest(".aipkit_accordion");s?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(s.style.display="block")}}),i.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found."),typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found.")}window.aipkit_initSettings=n})();(function(){"use strict";let k=!1;function n(){let e=document.getElementById("aipkit_role_manager_container");if(!e){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let i=e.querySelector("#aipkit_save_roles_btn"),a=e.querySelector("#aipkit_role_manager_form"),s=e.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),s&&(s.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let l=window.aipkit_role_manager_config,c=l.text||{};if(!i||!a||!s){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let o="data-role-save-listener";i.getAttribute(o)||(i.addEventListener("click",function(t){if(t.preventDefault(),k)return;k=!0;let r=i.querySelector(".aipkit_btn-text"),f=i.querySelector(".aipkit_spinner");i.disabled=!0,f&&(f.style.display="inline-block"),r&&(r.textContent=c.saving||"Saving..."),s.innerHTML="",s.className="aipkit_settings_messages";let u=new FormData(a);u.append("action","aipkit_save_role_permissions"),fetch(l.ajaxurl,{method:"POST",body:u,credentials:"same-origin"}).then(p=>p.ok?p.json():p.json().then(_=>{throw new Error(_.data.message||`HTTP error! status: ${p.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${p.status}`)})).then(p=>{if(!p.success){let _=p.data&&p.data.message?p.data.message:"An unknown error occurred.";throw new Error(_)}return p.data}).then(p=>{let _=document.createElement("div");_.className="aipkit_settings_message aipkit_settings_message-success",_.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${p.message||c.success||"Permissions saved!"}`,s.appendChild(_),setTimeout(()=>{_.remove()},4e3)}).catch(p=>{console.error("AIPKit Role Manager Save Error:",p);let _=document.createElement("div");_.className="aipkit_settings_message aipkit_settings_message-error",_.innerHTML=`<span class="dashicons dashicons-warning"></span> ${p.message||c.fail||"Failed to save permissions."}`,s.appendChild(_),setTimeout(()=>{_.remove()},6e3)}).finally(()=>{k=!1,i.disabled=!1,f&&(f.style.display="none"),r&&(r.textContent=c.saveButton||"Save Permissions")})}),i.setAttribute(o,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&n()}),window.aipkit_initRoleManager=n})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}n.addEventListener("change",function(i){let a=i.target,s=a.closest(".aipkit_chatbot-settings-area");if(!s)return;if(a.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(s),window.aipkit_toggleOpenAISpecificSettingsVisibility(s),window.aipkit_toggleGoogleSpecificSettingsVisibility(s),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(s);return}if(a.matches('select[name$="_model"]')||a.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(s);return}let l=a.closest(".aipkit_stt_provider_select");if(l){let _=l.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");_?window.aipkit_toggleSttModelFields(_):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",l);return}let c=a.closest(".aipkit_vector_store_toggle_switch");if(c){let _=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");if(_){window.aipkit_toggleVectorStoreSettingsVisibility(_),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(_);let m=_.querySelector('.aipkit_feature_config_btn[data-feature="vector_store"]');m&&(m.disabled=!c.checked,m.title=c.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let o=a.closest(".aipkit_vector_store_provider_select");if(o){let _=o.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");_&&(window.aipkit_toggleVectorStoreProviderFields(_),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(_));return}let t=a.closest(".aipkit_vector_embedding_provider_select");if(t){let _=t.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");_&&window.aipkit_populateVectorEmbeddingModelSelect(_);return}let r=a.closest(".aipkit_openai_web_search_enable_toggle");if(r){let _=r.closest(".aipkit_chatbot-settings-area");if(_){window.aipkit_toggleOpenAIWebSearchSubSettings(_);let m=_.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');m&&(m.disabled=!r.checked)}return}let f=a.closest(".aipkit_openai_web_search_loc_type_select");if(f){let _=f.closest(".aipkit_chatbot-settings-area");_&&window.aipkit_toggleOpenAIWebSearchLocationDetails(_);return}let u=a.closest(".aipkit_google_search_grounding_enable_toggle");if(u){let _=u.closest(".aipkit_chatbot-settings-area");if(_){window.aipkit_toggleGoogleSearchGroundingSubSettings(_);let m=_.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');m&&(m.disabled=!u.checked)}return}let p=a.closest(".aipkit_google_grounding_mode_select");if(p){let _=p.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");_&&window.aipkit_toggleGoogleGroundingDynamicThreshold(_);return}}),n.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{i.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(i),window.aipkit_toggleOpenAISpecificSettingsVisibility(i),window.aipkit_toggleGoogleSpecificSettingsVisibility(i)),i.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(i),i.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(i),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(i));let a=i.querySelector(".aipkit_openai_web_search_enable_toggle"),s=i.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');s&&a&&(s.disabled=!a.checked,s.title=a.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure");let l=i.querySelector(".aipkit_google_search_grounding_enable_toggle"),c=i.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');c&&l&&(c.disabled=!l.checked,c.title=l.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")})}window.aipkit_initProviderSelectToggles=k})();(function(){"use strict";function k(n){if(!n){console.warn("AIPKit Chat Fields: No settings area provided to toggle model fields.");return}let e=n.querySelector(".aipkit_chatbot_provider_select");if(!e){console.warn("AIPKit Chat Fields: Provider select not found in the given settings area.");return}let i=e.value,a=["OpenAI","Google","Claude","OpenRouter","Azure","Ollama","DeepSeek"];n.querySelectorAll(".aipkit_chatbot_model_field").forEach(c=>{c.style.display="none";let o=c.querySelector(".aipkit_cb_web_search_toggle");o&&(o.style.display="none");let t=c.querySelector(".aipkit_cb_stateful_conv_toggle");t&&(t.style.display="none");let r=c.querySelector(".aipkit_cb_image_upload_toggle");r&&(r.style.display="none");let f=c.querySelector(".aipkit_cb_voice_input_toggle");f&&(f.style.display="none")});let l=n.querySelector(`.aipkit_chatbot_model_field[data-provider="${i}"]`);if(l){l.style.display="block",n.querySelectorAll(".aipkit_feature_toggle_item").forEach(u=>{let p=(u.dataset.providers||"").trim();if(!p||p==="*"){u.style.display="";return}let _=p.split(/\s+/);u.style.display=_.includes(i)?"":"none"}),typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(n),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(n);let o=l.querySelector(".aipkit_cb_web_search_toggle");o&&(o.dataset.provider||"").split(" ").includes(i)&&(o.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(n));let t=l.querySelector(".aipkit_cb_stateful_conv_toggle");t&&i==="OpenAI"&&(t.style.display="inline-flex");let r=l.querySelector(".aipkit_cb_image_upload_toggle");r&&(i==="OpenAI"||i==="Claude"?(r.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(n)):r.style.display="none");let f=l.querySelector(".aipkit_cb_voice_input_toggle");f&&(f.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(n)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(n)}}window.aipkit_toggleChatbotModelFields=k})();(function(){"use strict";function k(n){n&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(n)}window.aipkit_toggleOpenAISpecificSettingsVisibility=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector(".aipkit_chatbot_provider_select");e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=e?.value==="OpenAI",a=n.querySelector(".aipkit_openai_web_search_enable_toggle");a||(a=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),a||(a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let s=n.querySelector(".aipkit_openai_web_search_conditional_settings");if(!a||!s)return;let l=a.tagName==="SELECT"?a.value==="1":a.checked;if(s.style.display=i&&l?"block":"none",i&&l)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(n);else{let c=n.querySelector(".aipkit_openai_web_search_location_details");c&&(c.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector(".aipkit_openai_web_search_enable_toggle");e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let i=n.querySelector(".aipkit_openai_web_search_loc_type_select"),a=n.querySelector(".aipkit_openai_web_search_location_details");if(!i||!a){a&&(a.style.display="none");return}let s=e?e.tagName==="SELECT"?e.value==="1":e.checked:!1,l=(i.value||"")==="approximate";a.style.display=s&&l?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=k})();(function(){"use strict";function k(n){n&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(n)}window.aipkit_toggleGoogleSpecificSettingsVisibility=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector(".aipkit_chatbot_provider_select");e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=e?.value==="Google",a=n.querySelector(".aipkit_google_search_grounding_enable_toggle");a||(a=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),a||(a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let s=n.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!a||!s)return;let l=a.tagName==="SELECT"?a.value==="1":a.checked,c=i&&l;s.style.display=c?"block":"none",c?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(n):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(n,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=k})();(function(){"use strict";function k(n,e=null){if(!n)return;let i=n.querySelector(".aipkit_google_grounding_mode_select"),a=n.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),s=n.querySelector(".aipkit_google_search_grounding_enable_toggle");s||(s=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),s||(s=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let l=n.querySelector(".aipkit_google_search_grounding_conditional_settings"),c=l&&l.style.display==="none";if(!i||!a||!s){a&&(a.style.display="none");return}if(c){a.style.display="none";return}let o=e!==null?e:(s.tagName==="SELECT"?s.value==="1":s.checked)&&i.value==="MODE_DYNAMIC";a.style.display=o?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector(".aipkit_stt_provider_select");if(!e)return;let i=e.value;n.querySelectorAll(".aipkit_stt_model_field").forEach(s=>{s.style.display=s.getAttribute("data-stt-provider")===i?"block":"none"})}window.aipkit_toggleSttModelFields=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector(".aipkit_vector_store_toggle_switch");e||(e=n.querySelector(".aipkit_vector_store_enable_select")),e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let i=n.querySelector(".aipkit_vector_store_settings_conditional_row"),a=n.querySelector(".aipkit_context_grid"),s=n.querySelector(".aipkit_context_layout"),l=n.querySelector(".aipkit_vector_store_advanced_field"),c=n.querySelector(".aipkit_vector_store_top_k_field"),o=n.querySelector(".aipkit_vector_store_confidence_field");if(!e||!i)return;let t=e.tagName==="SELECT"?e.value==="1":e.checked;if(i.style.display=t?"block":"none",l){if(l.style.display=t?"block":"none",!t){let r=l.querySelector(".aipkit_vector_store_advanced_disclosure");r&&(r.open=!1)}c&&(c.style.display=""),o&&(o.style.display="")}else c&&(c.style.display=t?"block":"none"),o&&(o.style.display=t?"block":"none");t?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(n):(n.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_pinecone_key_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_qdrant_url_field, .aipkit_vector_store_qdrant_key_field, .aipkit_vector_store_embedding_config_row").forEach(r=>r.style.display="none"),a&&a.setAttribute("data-vector-provider",""),s&&s.setAttribute("data-vector-provider",""))}window.aipkit_toggleVectorStoreSettingsVisibility=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector(".aipkit_vector_store_provider_select"),i=n.querySelector(".aipkit_vector_store_toggle_switch");if(i||(i=n.querySelector(".aipkit_vector_store_enable_select")),i||(i=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select")),!e||!i)return;let a=n.closest(".aipkit_chatbot_builder")||document.querySelector(".aipkit_chatbot_builder"),s=n.querySelector(".aipkit_chatbot_provider_select")||(a?a.querySelector(".aipkit_chatbot_provider_select"):null),c=(s?String(s.value||"").trim():"").toLowerCase()==="claude",o=Array.from(e.options||[]).find(T=>T&&T.value==="claude_files");if(o){let T=!!o.disabled;if(o.disabled=!c,T!==o.disabled&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),o.disabled&&e.value==="claude_files"){let x=Array.from(e.options||[]).find(E=>E&&E.value&&!E.disabled&&E.value!=="claude_files");if(x&&e.value!==x.value){e.value=x.value,e.dispatchEvent(new Event("change",{bubbles:!0}));return}}}let t=e.value,r=i.tagName==="SELECT"?i.value==="1":i.checked,f=n.querySelector(".aipkit_context_grid"),u=n.querySelector(".aipkit_context_layout"),p=n.querySelector(".aipkit_vector_store_openai_field"),_=n.querySelector(".aipkit_vector_store_pinecone_field"),m=n.querySelector(".aipkit_vector_store_pinecone_key_field"),g=n.querySelector(".aipkit_vector_store_qdrant_field"),d=n.querySelector(".aipkit_vector_store_qdrant_url_field"),w=n.querySelector(".aipkit_vector_store_qdrant_key_field"),h=n.querySelector(".aipkit_vector_store_embedding_config_row"),b=n.querySelector(".aipkit_vector_store_advanced_field"),A=n.querySelector(".aipkit_vector_store_top_k_field"),S=n.querySelector(".aipkit_vector_store_confidence_field"),I=["openai","pinecone","qdrant"].includes(t);if(p&&(p.style.display=r&&t==="openai"?"block":"none"),_&&(_.style.display=r&&t==="pinecone"?"block":"none"),m&&(m.style.display=r&&t==="pinecone"?"block":"none"),g&&(g.style.display=r&&t==="qdrant"?"block":"none"),d&&(d.style.display=r&&t==="qdrant"?"block":"none"),w&&(w.style.display=r&&t==="qdrant"?"block":"none"),h&&(h.style.display=r&&(t==="pinecone"||t==="qdrant")?"block":"none"),b){if(b.style.display=r&&I?"block":"none",!r||!I){let T=b.querySelector(".aipkit_vector_store_advanced_disclosure");T&&(T.open=!1)}A&&(A.style.display=""),S&&(S.style.display="")}else A&&(A.style.display=r&&I?"block":"none"),S&&(S.style.display=r&&I?"block":"none");f&&f.setAttribute("data-vector-provider",r?t:""),u&&u.setAttribute("data-vector-provider",r?t:""),r&&t==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(n):r&&(t==="pinecone"||t==="qdrant")&&(t==="pinecone"&&typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(n),t==="qdrant"&&typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"&&window.aipkit_populateQdrantCollectionsMultiSelect(n),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(n),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(n))}window.aipkit_toggleVectorStoreProviderFields=k})();(function(){"use strict";let k=!1,n=window.wp&&window.wp.i18n?window.wp.i18n:null,e=n&&typeof n.__=="function"?n.__:l=>l;function i(l){let c=l.querySelector('select[name="openai_vector_store_ids[]"]'),o=window.aipkit_escapeHtml||function(T){return T};if(!c)return;let t=l.querySelector("[data-aipkit-vector-stores-dropdown]"),r=t?t.querySelector(".aipkit_popover_multiselect_btn"):null,f=t?t.querySelector(".aipkit_popover_multiselect_label"):null,u=t?t.querySelector(".aipkit_popover_multiselect_panel"):null,p=t?t.querySelector(".aipkit_popover_multiselect_options"):null,_=t?.dataset.placeholder||"Select stores",m=t?.dataset.selectedLabel||"selected",g=window.aipkit_chat_config?.openaiVectorStores||[],d=a(c),w=Array.from(c.options).filter(T=>T.selected).map(T=>T.value),h=d&&d.length?d:w;if(c.innerHTML="",g.length>0){let T=1;g.forEach(x=>{if(x&&x.id){let E="(Files: N/A)";x.file_counts&&typeof x.file_counts.total=="number"?E=`(${x.file_counts.total} ${x.file_counts.total===1?"File":"Files"})`:x.file_counts&&(E="(Files: ?)");let v=x.name||`Untitled store ${T}`,y=`${o(v)} ${E}`,C=document.createElement("option");C.value=x.id,C.textContent=y,h.includes(x.id)&&(C.selected=!0),c.appendChild(C),T+=1}})}g.length>0&&h.forEach(T=>{if(!g.some(E=>E.id===T)&&!c.querySelector(`option[value="${CSS.escape(T)}"]`)){let E=document.createElement("option");E.value=T,E.textContent=T,E.selected=!0,c.appendChild(E)}}),c.options.length===0&&(c.innerHTML='<option value="" disabled>-- No vector stores found --</option>');let b=()=>{if(!f)return;let T=Array.from(c.options).filter(E=>E.selected&&E.value);if(!T.length){f.textContent=_;return}let x=T.map(E=>E.textContent.trim()).filter(Boolean);if(x.length<=2){f.textContent=x.join(", ");return}f.textContent=`${x.length} ${m}`},A=()=>{if(!p)return;let T=Array.from(p.querySelectorAll('input[type="checkbox"]:checked'));if(T.length>2){let E=T[T.length-1];E&&(E.checked=!1)}let x=Array.from(p.querySelectorAll('input[type="checkbox"]:checked')).map(E=>E.value);Array.from(c.options).forEach(E=>{E.selected=x.includes(E.value)}),c.dispatchEvent(new Event("change",{bubbles:!0})),b()},S=()=>{if(!p)return;p.innerHTML="";let T=Array.from(c.options),x=T.filter(E=>E.value);if(!x.length){let E=document.createElement("div");E.className="aipkit_popover_multiselect_empty",E.textContent=T[0]?.textContent||"-- No Stores Found --",p.appendChild(E),b();return}x.forEach(E=>{let v=document.createElement("label");v.className="aipkit_popover_multiselect_item";let y=document.createElement("input");y.type="checkbox",y.value=E.value,y.checked=E.selected,y.disabled=E.disabled;let C=document.createElement("span");C.className="aipkit_popover_multiselect_text",C.textContent=E.textContent,v.appendChild(y),v.appendChild(C),p.appendChild(v)}),b()},I=T=>{!t||!r||(t.classList.toggle("is-open",T),r.setAttribute("aria-expanded",T?"true":"false"),u&&(u.hidden=!T))};t&&r&&!t.dataset.listenerAttached&&(r.addEventListener("click",T=>{T.preventDefault(),I(!t.classList.contains("is-open"))}),document.addEventListener("click",T=>{t.classList.contains("is-open")&&(t.contains(T.target)||I(!1))}),r.addEventListener("keydown",T=>{T.key==="Escape"&&I(!1)}),t.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",A),p.dataset.listenerAttached="true"),S(),s(l,{selectElement:c,dropdown:t,dropdownPanel:u,dropdownOptions:p,setOpenState:I,placeholder:_})}function a(l){if(!l||!l.dataset.aipkitPendingVectorSelection)return[];let c=[];try{let o=JSON.parse(l.dataset.aipkitPendingVectorSelection);Array.isArray(o)&&(c=o.map(t=>String(t||"").trim()).filter(Boolean).slice(-2))}catch{c=[]}return delete l.dataset.aipkitPendingVectorSelection,c}function s(l,c){let{selectElement:o,dropdown:t,dropdownPanel:r,dropdownOptions:f,setOpenState:u,placeholder:p}=c||{};if(!t||!r||!f||!o)return;let _=r.querySelector(".aipkit_vector_store_dropdown_actions");_||(_=document.createElement("div"),_.className="aipkit_vector_store_dropdown_actions",_.innerHTML=`
        <div class="aipkit_vector_store_dropdown_action_list">
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_vector_store_dropdown_new_btn">
            <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
            ${e("New Store","gpt3-ai-content-generator")}
          </button>
        </div>
        <div class="aipkit_vector_store_dropdown_inline_form" style="display:none;">
          <input
            type="text"
            class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--framed aipkit_vector_store_dropdown_name_input"
            placeholder="${e("e.g. Product FAQ","gpt3-ai-content-generator")}"
          />
          <div class="aipkit_vector_store_dropdown_inline_actions">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_vector_store_dropdown_cancel_btn">
              ${e("Cancel","gpt3-ai-content-generator")}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_vector_store_dropdown_create_btn">
              ${e("Create","gpt3-ai-content-generator")}
            </button>
          </div>
        </div>
        <p class="aipkit_form-help aipkit_vector_store_dropdown_status" style="display:none;" aria-live="polite"></p>
      `,r.insertBefore(_,f));let m=_.querySelector(".aipkit_vector_store_dropdown_action_list"),g=_.querySelector(".aipkit_vector_store_dropdown_inline_form"),d=_.querySelector(".aipkit_vector_store_dropdown_create_btn"),w=_.querySelector(".aipkit_vector_store_dropdown_cancel_btn"),h=_.querySelector(".aipkit_vector_store_dropdown_new_btn"),b=_.querySelector(".aipkit_vector_store_dropdown_name_input"),A=_.querySelector(".aipkit_vector_store_dropdown_status"),S=()=>{_&&typeof _._aipkitVectorStoreStatusTimer=="number"&&_._aipkitVectorStoreStatusTimer&&(window.clearTimeout(_._aipkitVectorStoreStatusTimer),_._aipkitVectorStoreStatusTimer=0)},I=(C=3200)=>{S(),_&&(_._aipkitVectorStoreStatusTimer=window.setTimeout(()=>{T("")},C))},T=(C,M="",B=0)=>{S(),A&&(A.textContent=C||"",A.style.display=C?"block":"none",A.classList.remove("aipkit_color_notice_success","aipkit_color_notice_error","aipkit_color_notice_info"),M==="success"?A.classList.add("aipkit_color_notice_success"):M==="error"?A.classList.add("aipkit_color_notice_error"):M==="info"&&A.classList.add("aipkit_color_notice_info"),C&&Number(B)>0&&I(Number(B)))},x=()=>{b&&(b.value=""),m&&(m.style.display=""),g&&(g.style.display="none"),T("")},E=()=>{m&&(m.style.display="none"),g&&(g.style.display="block"),T(""),b&&(b.focus(),b.select())},v=async()=>{if(!d||!b)return;let C=String(b.value||"").trim();if(!C){T(e("Store name is required.","gpt3-ai-content-generator"),"error",3e3);return}if(typeof window.aipkit_apiRequest!="function"){T(e("API request helper is unavailable.","gpt3-ai-content-generator"),"error",3e3);return}let M=document.getElementById("aipkit_vector_store_nonce_openai"),B=M?String(M.value||"").trim():"";if(!B){T(e("OpenAI nonce is missing.","gpt3-ai-content-generator"),"error",3e3);return}let D=d.textContent;d.disabled=!0,d.textContent=e("Creating...","gpt3-ai-content-generator"),w&&(w.disabled=!0),T("");try{let W=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:B,name:C,source_type:"chatbot_training_text"}),U=W?.store||W;if(!U||!U.id)throw new Error(e("OpenAI vector store creation failed.","gpt3-ai-content-generator"));window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]);let J=window.aipkit_chat_config.openaiVectorStores;J.some(F=>F&&F.id===U.id)||J.unshift(U);let L=Array.from(o.options).filter(F=>F.selected&&F.value).map(F=>F.value).filter(F=>F&&F!==U.id).slice(-1);L.push(U.id),o.dataset.aipkitPendingVectorSelection=JSON.stringify(L),i(l),u(!0),T(W?.message||e("Vector store created.","gpt3-ai-content-generator"),"success",2800)}catch(W){let U=W&&W.message?W.message:e("Create failed.","gpt3-ai-content-generator");T(`${e("Error:","gpt3-ai-content-generator")} ${U}`,"error",3200)}finally{d.disabled=!1,d.textContent=D,w&&(w.disabled=!1)}},y=typeof window.aipkit_apiRequest=="function";h&&(h.disabled=!y,y?h.removeAttribute("title"):h.setAttribute("title",e("Creation is unavailable right now.","gpt3-ai-content-generator"))),_.dataset.listenerAttached||(h&&h.addEventListener("click",()=>{E()}),w&&w.addEventListener("click",()=>{x()}),d&&d.addEventListener("click",v),b&&b.addEventListener("keydown",C=>{if(C.key==="Enter"){C.preventDefault(),v();return}C.key==="Escape"&&(C.preventDefault(),x())}),_.dataset.listenerAttached="true"),f.children.length?(h&&(h.textContent=e("New Store","gpt3-ai-content-generator")),(!g||g.style.display==="none")&&T("")):(T(e("No stores found. Create your first one.","gpt3-ai-content-generator"),"info"),h&&(h.textContent=e("Create Store","gpt3-ai-content-generator"))),!o.value&&p&&t&&!t.classList.contains("is-open")&&u(!1)}window.aipkit_populateOpenAIVectorStoresMultiSelect=i,k||(window.addEventListener("aipkit:vector-store-list-updated",l=>{if(String(l?.detail?.provider||"").toLowerCase()!=="openai")return;Array.from(document.querySelectorAll('select[name="openai_vector_store_ids[]"]')).forEach(t=>{let r=t.closest(".aipkit_settings_accordion_body")||t.closest(".aipkit_chatbot_builder")||t.parentElement;r&&i(r)})}),k=!0)})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector('select[name="qdrant_collection_names[]"]');if(!e)return;let i=n.querySelector("[data-aipkit-qdrant-collections-dropdown]"),a=i?i.querySelector(".aipkit_popover_multiselect_btn"):null,s=i?i.querySelector(".aipkit_popover_multiselect_label"):null,l=i?i.querySelector(".aipkit_popover_multiselect_panel"):null,c=i?i.querySelector(".aipkit_popover_multiselect_options"):null;if(!i||!c)return;let o=i.dataset.placeholder||"Select collections",t=i.dataset.selectedLabel||"selected",r=()=>{if(!s)return;let _=Array.from(e.options).filter(g=>g.selected&&g.value);if(!_.length){s.textContent=o;return}let m=_.map(g=>g.textContent.trim()).filter(Boolean);if(m.length<=2){s.textContent=m.join(", ");return}s.textContent=`${m.length} ${t}`},f=()=>{let _=Array.from(c.querySelectorAll('input[type="checkbox"]:checked')).map(m=>m.value);Array.from(e.options).forEach(m=>{m.selected=_.includes(m.value)}),e.dispatchEvent(new Event("change",{bubbles:!0})),r()},u=()=>{c.innerHTML="";let _=Array.from(e.options),m=_.filter(g=>g.value);if(!m.length){let g=document.createElement("div");g.className="aipkit_popover_multiselect_empty",g.textContent=_[0]?.textContent||"-- No Collections Found --",c.appendChild(g),r();return}m.forEach(g=>{let d=document.createElement("label");d.className="aipkit_popover_multiselect_item";let w=document.createElement("input");w.type="checkbox",w.value=g.value,w.checked=g.selected,w.disabled=g.disabled;let h=document.createElement("span");h.className="aipkit_popover_multiselect_text",h.textContent=g.textContent,d.appendChild(w),d.appendChild(h),c.appendChild(d)}),r()},p=_=>{!i||!a||(i.classList.toggle("is-open",_),a.setAttribute("aria-expanded",_?"true":"false"),l&&(l.hidden=!_))};i&&a&&!i.dataset.listenerAttached&&(a.addEventListener("click",_=>{_.preventDefault(),p(!i.classList.contains("is-open"))}),document.addEventListener("click",_=>{i.classList.contains("is-open")&&(i.contains(_.target)||p(!1))}),a.addEventListener("keydown",_=>{_.key==="Escape"&&p(!1)}),i.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",f),c.dataset.listenerAttached="true"),u()}window.aipkit_populateQdrantCollectionsMultiSelect=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector('select[name="pinecone_index_name"]');if(!e)return;let i=n.querySelector("[data-aipkit-pinecone-index-dropdown]"),a=i?i.querySelector(".aipkit_popover_multiselect_btn"):null,s=i?i.querySelector(".aipkit_popover_multiselect_label"):null,l=i?i.querySelector(".aipkit_popover_multiselect_panel"):null,c=i?i.querySelector(".aipkit_popover_multiselect_options"):null,o=window.aipkit_escapeHtml||function(A){return A},t=window.aipkit_chat_config?.pineconeIndexes||[],r=String(e.value||"").trim(),f=i&&i.dataset&&i.dataset.placeholder||"Select index",u=[],p=new Set;Array.isArray(t)&&t.forEach(A=>{let S=String(A?.name||A?.id||"").trim();if(!S||p.has(S))return;p.add(S);let I=String(A?.name||S),T=A?.total_vector_count,E=T!=null&&T!=="Error"&&T!=="No Host"?` (Vectors: ${Number(T).toLocaleString()})`:T==="Error"||T==="No Host"?" (Stats Err)":" (Vectors: ?)";u.push({value:S,label:o(`${I}${E}`),disabled:!1})}),r&&!p.has(r)&&(u.push({value:r,label:o(`${r}`),disabled:!1}),p.add(r)),u.length||u.push({value:"",label:"-- No Indexes Found (Sync in AI Settings) --",disabled:!0}),e.innerHTML="";let _=new Option(f,"");_.selected=!r,e.appendChild(_);let m=!1;u.forEach(A=>{let S=new Option(A.label,A.value);A.disabled&&(S.disabled=!0),!A.disabled&&A.value&&A.value===r&&(S.selected=!0,m=!0),e.appendChild(S)}),r&&!m&&(e.value="");let g=()=>{if(!s)return;let A=e.selectedOptions&&e.selectedOptions.length?e.selectedOptions[0]:null,S=A&&A.textContent?A.textContent.trim():"";s.textContent=S||f},d=()=>{if(!c)return;c.innerHTML="";let A=Array.from(e.options).filter(I=>!I.disabled&&I.value);if(!A.length){let I=document.createElement("div");I.className="aipkit_popover_multiselect_empty",I.textContent=e.options[0]?.textContent||"-- No Indexes Found (Sync in AI Settings) --",c.appendChild(I),g();return}let S=i.dataset.pineconeRadioName||`aipkit_pinecone_index_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;i.dataset.pineconeRadioName=S,A.forEach(I=>{let T=document.createElement("label");T.className="aipkit_popover_multiselect_item aipkit_vector_store_pinecone_item";let x=document.createElement("span");x.className="aipkit_vector_store_pinecone_item_label";let E=document.createElement("input");E.type="radio",E.name=S,E.className="aipkit_vector_store_pinecone_radio",E.value=I.value,E.checked=I.selected;let v=document.createElement("span");v.className="aipkit_popover_multiselect_text",v.textContent=I.textContent,x.appendChild(E),x.appendChild(v),T.appendChild(x),c.appendChild(T)}),g()},w=()=>{if(!c)return;let A=c.querySelector(".aipkit_vector_store_pinecone_radio:checked");if(!A)return;let S=A.value||"";(e.value||"")!==S?(e.value=S,e.dispatchEvent(new Event("change",{bubbles:!0}))):g()},h=()=>{if(!c){g();return}let A=e.value||"";c.querySelectorAll(".aipkit_vector_store_pinecone_radio").forEach(S=>{S.checked=S.value===A}),g()},b=A=>{!i||!a||(i.classList.toggle("is-open",A),a.setAttribute("aria-expanded",A?"true":"false"),l&&(l.hidden=!A))};i&&a&&!i.dataset.listenerAttached&&(a.addEventListener("click",A=>{A.preventDefault(),b(!i.classList.contains("is-open"))}),document.addEventListener("click",A=>{i.classList.contains("is-open")&&(i.contains(A.target)||b(!1))}),document.addEventListener("keydown",A=>{A.key==="Escape"&&b(!1)}),i.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",A=>{A.target&&A.target.matches(".aipkit_vector_store_pinecone_radio")&&(w(),b(!1))}),c.dataset.listenerAttached="true"),e.dataset.pineconeDropdownBound!=="1"&&(e.addEventListener("change",h),e.dataset.pineconeDropdownBound="1"),d(),h()}window.aipkit_populatePineconeIndexSelect=k})();(function(){"use strict";function k(n){let e=n.querySelector('select[name="vector_embedding_provider"]');e&&(e.value===""&&(e.value="openai"),e.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=k})();(function(){"use strict";function k(n){let e=n.querySelector('select[name="vector_embedding_provider"]'),i=n.querySelector('select[name="vector_embedding_model"]'),a=window.aipkit_escapeHtml||function(o){return o};if(!e||!i)return;let s=e.value,l=i.value;i.innerHTML="",i.appendChild(new Option(a("-- Select Model --"),""));let c=[];if(s==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?c=window.aipkit_chat_config.openaiEmbeddingModels:s==="google"&&window.aipkit_chat_config?.googleEmbeddingModels?c=window.aipkit_chat_config.googleEmbeddingModels:s==="openrouter"&&window.aipkit_chat_config?.openrouterEmbeddingModels?c=window.aipkit_chat_config.openrouterEmbeddingModels:s==="azure"&&window.aipkit_chat_config?.azureEmbeddingModels&&(c=window.aipkit_chat_config.azureEmbeddingModels),c.length>0&&c.forEach(o=>{if(o&&o.id){let t=new Option(a(o.name||o.id),o.id);o.id===l&&(t.selected=!0),i.appendChild(t)}}),l&&!i.querySelector(`option[value="${CSS.escape(l)}"]`)){let o=new Option(a(l)+"",l,!1,!0);i.appendChild(o),i.value=l}i.options.length<=1&&(i.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector(".aipkit_vector_store_toggle_switch");e||(e=n.querySelector(".aipkit_vector_store_enable_select")),e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let i=n.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),a=n.querySelector(".aipkit_vector_store_provider_select"),s=n.querySelector(".aipkit_chatbot_provider_select"),l=n.querySelector(".aipkit_file_upload_field_group");if(!e||!i||!l)return;let c=e.tagName==="SELECT"?e.value==="1":e.checked,o=i.dataset.isProPlan==="true",t=a?a.value:"",r=s?s.value:"",f=t==="claude_files",u=r==="Claude";if(a){let g=Array.from(a.options||[]).find(d=>d&&d.value==="claude_files");g&&(g.disabled=!u)}if(f&&!u&&a){let g=Array.from(a.options||[]).find(w=>w&&w.value&&w.value!=="claude_files"),d=g?g.value:"openai";if(a.value!==d){a.value=d,a.dispatchEvent(new Event("change",{bubbles:!0}));return}}let _=o&&c&&(!f||u),m="";o?f&&!u?m='Claude Files requires the chatbot "Provider" to be set to Claude.':c||(m='File upload requires "Enable Vector Store" to be active for this bot.'):m="File upload is a paid feature. Please upgrade.",_?(i.disabled=!1,l.classList.remove("aipkit_dimmed_row"),l.style&&(l.style.opacity=""),l.removeAttribute("title")):(i.checked&&(i.checked=!1,i.dispatchEvent(new Event("change",{bubbles:!0}))),i.disabled=!0,l.classList.add("aipkit_dimmed_row"),l.style&&l.style.opacity&&(l.style.opacity=""),l.setAttribute("title",m))}window.aipkit_toggleFileUploadAvailability=k})();(function(){"use strict";function k(e){if(!e)return;let i=e.querySelector('select[name="theme"]'),a=e.querySelector('input[name="theme"]:checked'),s=()=>i?i.value:a?a.value:"",l=e.querySelector(".aipkit_custom_theme_config_btn, .aipkit_open_custom_theme_modal_btn"),c=s()==="custom";l&&(l.style.display=c?"inline-flex":"none")}function n(){let e=document.querySelector(".aipkit_chatbot_module_container")||document.getElementById("aipkit_chatbot_main_tab_content_container");if(!e){console.warn("AIPKit Theme Toggle: Module container not found.");return}e.dataset.themeSettingsListenerAttached||(e.addEventListener("click",function(i){i.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(i):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),e.addEventListener("change",function(i){let a=i.target;if(a.matches&&a.matches('select[name="theme"]')||a.matches&&a.matches('input[name="theme"]')){let s=a.closest('.aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]')||a.closest(".aipkit_chatbot-settings-area")||e;if(s){k(s);let l=s.querySelector(".aipkit_open_custom_theme_modal_btn");if(l&&a.value==="custom"&&typeof window.aipkit_openChatbotSettingsModalById=="function"){let c=l.getAttribute("data-modal-target");c&&window.aipkit_openChatbotSettingsModalById(c)}}}}),e.dataset.themeSettingsListenerAttached="true"),document.documentElement.dataset.aipkitResetListenerAttached||(document.addEventListener("click",function(i){i.target.closest(".aipkit_chatbot_settings_modal .aipkit_reset_custom_theme_btn")&&typeof window.aipkit_handleResetCustomTheme=="function"&&window.aipkit_handleResetCustomTheme(i)}),document.documentElement.dataset.aipkitResetListenerAttached="true"),e.querySelectorAll('.aipkit_chatbot-settings-area, .aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]').forEach(i=>{k(i)})}window.aipkit_initChatThemeSettingsToggle=n})();(function(){"use strict";function k(n){let e=n.target.closest(".aipkit_reset_custom_theme_btn");if(!e)return;let i=e.dataset.botId,a=document.getElementById("aipkit_chatbot_main_tab_content_container"),s=document.getElementById(`aipkit_bot_${i}_custom_theme_settings_container`)||(a?a.querySelector(`#aipkit_bot_${i}_custom_theme_settings_container`):null),l=document.getElementById(`aipkit_reset_theme_status_${i}`)||(a?a.querySelector(`#aipkit_reset_theme_status_${i}`):null);if(!s||!l){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",i);return}let c=s.dataset.defaults;if(!c){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"error","Error: Defaults not found.",2e3);return}try{let o=JSON.parse(c);s.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(r=>{let u=r.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(u&&u[1]){let p=u[1];if(Object.prototype.hasOwnProperty.call(o,p)){r.type==="checkbox"?r.checked=String(o[p])==="1":r.value=o[p]!==null?String(o[p]):"";let _=new Event("change",{bubbles:!0,cancelable:!0});r.dispatchEvent(_)}else if(Object.prototype.hasOwnProperty.call(o,p+"_placeholder")){r.type==="checkbox"?r.checked=String(o[p+"_placeholder"])==="1":r.value=o[p+"_placeholder"]!==null?String(o[p+"_placeholder"]):"";let _=new Event("change",{bubbles:!0,cancelable:!0});r.dispatchEvent(_)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"success","\u2714 Reverted.",2e3)}catch(o){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",o),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=k})();(function(){"use strict";function k(_){let m=new Event("input",{bubbles:!0,cancelable:!0}),g=new Event("change",{bubbles:!0,cancelable:!0});_.dispatchEvent(m),_.dispatchEvent(g)}function n(){document.documentElement.dataset.aipkitApplyingThemePreset="1"}function e(){window.setTimeout(()=>{delete document.documentElement.dataset.aipkitApplyingThemePreset},0)}function i(_,m,g){let d=_.querySelector(`input[name="custom_theme_settings[${m}]"], select[name="custom_theme_settings[${m}]"]`);if(d){if(d.type==="checkbox"){let w=g==="1";d.checked!==w&&(d.checked=w,k(d));return}d.value!==g&&(d.value=g,k(d))}}function a(_){let m=_.closest(".aipkit_chatbot_settings_form");if(!m)return;let g=_.dataset.presetKey||"",d=m.querySelector('select[name="theme"]');if(d&&!d.disabled){let h=-1,b=Array.from(d.options||[]);g&&(h=b.findIndex(A=>(A.value||"")==="custom"&&A.dataset&&A.dataset.presetKey===g)),h<0&&(h=b.findIndex(A=>(A.value||"")==="custom"&&!(A.dataset&&A.dataset.presetKey))),h>=0&&d.selectedIndex!==h&&(d.selectedIndex=h,k(d));return}let w=m.querySelector('input[name="theme"][value="custom"]');w&&!w.checked&&(w.checked=!0,k(w))}function s(_,m){if(!_)return;let g=_.querySelector('input[name="theme_preset_key"]');g&&!g.disabled&&(g.value=m||"")}function l(_){return _?document.getElementById(`aipkit_bot_${_}_custom_theme_settings_container`):null}function c(_){let m=_.closest(".aipkit_custom_theme_settings_container");if(m)return m;let g=_.dataset.botId||_.closest("[data-bot-id]")?.dataset.botId;return l(g)}function o(_){let m=_.closest(".aipkit_chatbot_settings_form");if(!m)return null;let g=m.querySelector(".aipkit_custom_theme_settings_container");if(g)return g;let d=m.dataset.botId||m.closest("[data-bot-id]")?.dataset.botId;return l(d)}function t(_){let m=_.closest(".aipkit_custom_theme_presets");m&&m.querySelectorAll(".aipkit_custom_theme_preset").forEach(g=>{let d=g===_;g.classList.toggle("is-selected",d),g.setAttribute("aria-pressed",d?"true":"false")})}function r(_){let m=_.dataset.primary,g=_.dataset.secondary,d=_.dataset.presetKey||"";if(!m||!g)return;let w=c(_);if(!w)return;let h=_.closest(".aipkit_chatbot_settings_form");n(),a(_),s(h,d),i(w,"primary_color",m),i(w,"secondary_color",g),i(w,"auto_text_contrast","1"),e(),t(_)}function f(_){if(!_||_.disabled)return;let m=_.selectedOptions&&_.selectedOptions.length?_.selectedOptions[0]:null;if(!m||!m.dataset)return;let g=m.dataset.presetKey||"",d=m.dataset.primary||"",w=m.dataset.secondary||"";if(!g||!d||!w){let A=_.closest(".aipkit_chatbot_settings_form");s(A,"");return}let h=o(_);if(!h)return;let b=_.closest(".aipkit_chatbot_settings_form");n(),s(b,g),i(h,"primary_color",d),i(h,"secondary_color",w),i(h,"auto_text_contrast","1"),e()}function u(_){if(!_||!_.closest||document.documentElement.dataset.aipkitApplyingThemePreset==="1")return;let m=_.closest(".aipkit_chatbot_settings_form");m&&s(m,"")}function p(){document.documentElement.dataset.aipkitCustomThemePresetsBound||(document.addEventListener("click",_=>{let m=_.target.closest(".aipkit_custom_theme_preset");m&&(_.preventDefault(),r(m))}),document.addEventListener("change",_=>{let m=_.target;!m||!m.matches||!m.matches('select[name="theme"]')||f(m)}),document.addEventListener("change",_=>{let m=_.target;!m||!m.matches||!m.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')||u(m)}),document.documentElement.dataset.aipkitCustomThemePresetsBound="1")}window.aipkit_initCustomThemePresets=p})();(function(){"use strict";let k=".aipkit_builder_theme_row_content",n=".aipkit_builder_theme_row",e=".aipkit_theme_scroll_btn",i=".aipkit_theme_scroll_btn--prev",a=".aipkit_theme_scroll_btn--next";function s(u){let p=u.closest(n);return p?{row:p,prev:p.querySelector(i),next:p.querySelector(a)}:null}function l(u){return Math.max(180,Math.round(u.clientWidth*.75))}function c(u){let p=s(u);if(!p||!p.prev||!p.next)return;let _=Math.max(0,u.scrollWidth-u.clientWidth),m=u.scrollLeft<=1,g=u.scrollLeft>=_-1;p.prev.disabled=_===0||m,p.next.disabled=_===0||g}function o(u){let p=u.target.closest(e);if(!p||p.disabled)return;let _=p.closest(n),m=_?_.querySelector(k):null;if(!m)return;let g=p.classList.contains("aipkit_theme_scroll_btn--next")?1:-1;m.scrollBy({left:g*l(m),behavior:"smooth"})}function t(u){let p=u.target;!(p instanceof HTMLElement)||!p.matches(k)||c(p)}function r(){document.querySelectorAll(k).forEach(u=>{c(u)})}function f(u){let p=document.documentElement;p.dataset.aipkitThemeRowScrollBound||(document.addEventListener("click",o),document.addEventListener("scroll",t,!0),window.addEventListener("resize",r),p.dataset.aipkitThemeRowScrollBound="1"),u&&r()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>f(!0)):f(!0),window.aipkit_initThemeRowScroll=function(){f(!0)}})();(function(){"use strict";function k(c){if(!c)return;let o=c.querySelector(".aipkit_chatbot_provider_select");o||(o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let t=c.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');t||(t=document.querySelector('#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_model_field[data-provider="OpenAI"] select'));let r=c.querySelector(".aipkit_reasoning_effort_field"),f=r?r.querySelector(".aipkit_reasoning_effort_slider"):null,u=r?r.querySelector('input[name="reasoning_effort"]'):null,p=r?r.querySelector(".aipkit_reasoning_effort_label"):null,_=null;if(r?_=r.closest('section[data-section="reasoning"], .aipkit_reasoning_section'):_=c.querySelector(".aipkit_reasoning_section"),!r)return;let m=r.querySelector('select[name="reasoning_effort"]'),g=()=>{r.classList.add("aipkit_hidden"),_&&_.classList.add("aipkit_hidden"),m&&(m.disabled=!0),r.style.opacity="",r.removeAttribute("title")},d=()=>{r.classList.remove("aipkit_hidden"),_&&_.classList.remove("aipkit_hidden"),m&&(m.disabled=!1),r.style.opacity="",r.removeAttribute("title")};if(!o||!t){g();return}let w=(o.value||"").toLowerCase(),b=(t.value||"").toLowerCase();w==="openai"&&e(b)?(d(),n(f,u,p,b)):g()}function n(c,o,t,r){if(!c||!o)return;let f=a(r),u=f.allowed,p=u.map(g=>g==="medium"?"med":g);c.dataset.reasoningValues=JSON.stringify(u),c.dataset.reasoningLabels=JSON.stringify(p),c.max=String(Math.max(0,u.length-1));let _=o.value||"";_==="minimal"&&(_="low"),u.includes(_)||(_=f.defaultValue),u.includes(_)||(_=u[0]||""),_&&(o.value=_);let m=Math.max(0,u.indexOf(_));c.value=String(m),t&&(t.textContent=p[m]||p[0]||""),c.dispatchEvent(new Event("input",{bubbles:!0}))}function e(c){if(i(c))return!1;let o=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),t=c.includes("gpt-5");return o||t}function i(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let o=c.match(/gpt-5\.(\d+)/);if(o)return Number.parseInt(o[1],10)>=2;let t=c.match(/gpt-(\d+)/);return t?Number.parseInt(t[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_toggleReasoningEffort=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(I){return I},n="#aipkit_chatbot_builder_bot_select, #aipkit_sources_provider_filter, #aipkit_sources_index_filter, .aipkit_vector_store_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_model_field select",e=null,i=null,a=!1,s=I=>!!(I&&(I.classList.contains("aipkit_chatbot_provider_select")||I.classList.contains("aipkit_vector_store_provider_select")||I.id==="aipkit_sources_provider_filter")),l=I=>!!(I&&I.id==="aipkit_chatbot_builder_bot_select"),c=I=>{let T=String(I||"").trim().toLowerCase();return T==="claude_files"?"claude":T},o=(I,T)=>{if(!I)return;let x="aipkit_settings_select_picker_icon--";I.classList.forEach(v=>{v.startsWith(x)&&I.classList.remove(v)}),I.classList.remove("is-hidden");let E=c(T);if(!E){I.classList.add("is-hidden");return}I.classList.add(`${x}${E}`)},t=I=>{if(!I)return"";let T=I.getAttribute("data-aipkit-picker-title");if(T)return T;let x=I.id&&document.querySelector(`label[for="${I.id}"]`)||I.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return x?x.textContent.trim():""},r=I=>{if(!I)return"";let T=I.selectedOptions&&I.selectedOptions.length?I.selectedOptions[0]:I.querySelector("option[selected]");if(T)return T.textContent.trim();let x=I.querySelector("option");return x?x.textContent.trim():""},f=I=>({buttonId:`${I}_picker_btn`,labelId:`${I}_picker_label`,popoverId:`${I}_picker_popover`,titleId:`${I}_picker_title`,searchId:`${I}_picker_search`,listId:`${I}_picker_list`}),u=I=>{if(!I||!I.id)return null;let T=f(I.id),x=I.closest(".aipkit_chatbot_builder");if(!x)return null;let E=document.getElementById(T.buttonId);if(!E){if(E=document.createElement("button"),E.type="button",E.id=T.buttonId,E.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",E.setAttribute("data-aipkit-popover-target",T.popoverId),E.setAttribute("aria-controls",T.popoverId),E.setAttribute("aria-expanded","false"),E.dataset.aipkitPopoverPlacement="bottom",s(I)){E.classList.add("aipkit_settings_select_picker_btn--provider");let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),o(M,I.value),E.appendChild(M)}let y=document.createElement("span");y.className="aipkit_settings_select_picker_label",y.id=T.labelId,y.textContent=r(I)||k("Select","gpt3-ai-content-generator");let C=document.createElement("span");C.className="dashicons dashicons-arrow-down-alt2",C.setAttribute("aria-hidden","true"),E.appendChild(y),E.appendChild(C),I.insertAdjacentElement("beforebegin",E)}I.classList.contains("screen-reader-text")||I.classList.add("screen-reader-text");let v=document.getElementById(T.popoverId);if(!v){v=document.createElement("div"),v.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",s(I)&&v.classList.add("aipkit_settings_select_picker_popover--provider"),v.id=T.popoverId,v.setAttribute("aria-hidden","true");let y=document.createElement("div");y.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",y.setAttribute("role","dialog"),y.setAttribute("aria-labelledby",T.titleId);let C=document.createElement("div");C.className="aipkit_model_settings_popover_header";let M=document.createElement("span");M.className="aipkit_model_settings_popover_title",M.id=T.titleId,M.textContent=t(I)||k("Select","gpt3-ai-content-generator");let B=document.createElement("button");B.type="button",B.className="aipkit_model_settings_popover_close",B.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),B.innerHTML='<span class="dashicons dashicons-no-alt"></span>',C.appendChild(M),C.appendChild(B);let D=document.createElement("div");D.className="aipkit_model_settings_popover_body";let W=document.createElement("div");W.className="aipkit_settings_select_picker_search";let U=document.createElement("input");U.type="search",U.id=T.searchId,U.className="aipkit_form-input";let J=t(I),oe=J?`Search ${J.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");U.setAttribute("placeholder",oe),W.appendChild(U);let O=document.createElement("div");O.className="aipkit_settings_select_picker_list",O.id=T.listId,O.setAttribute("role","listbox"),D.appendChild(W),D.appendChild(O),y.appendChild(C),y.appendChild(D),v.appendChild(y),x.appendChild(v),(s(I)||l(I))&&(W.style.display="none")}return{ids:T,button:E,popover:v,label:document.getElementById(T.labelId),search:document.getElementById(T.searchId),list:document.getElementById(T.listId)}},p=I=>{let T=[];return I&&Array.from(I.children).forEach(E=>{if(E.tagName==="OPTGROUP"){let v=Array.from(E.children).filter(y=>y.tagName==="OPTION").map(y=>({value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}));T.push({groupLabel:E.label||"",options:v})}else E.tagName==="OPTION"&&T.push({groupLabel:"",options:[{value:E.value,label:E.textContent.trim(),disabled:E.disabled,selected:E.selected}]})}),T},_=(I,T,x="")=>{if(!I||!T)return;let E=x.trim().toLowerCase();if(T.innerHTML="",l(I)){let C=Array.from(I.options).map(J=>({value:J.value,label:J.textContent.trim(),disabled:J.disabled,selected:J.selected})),M=J=>J.disabled&&J.value===""&&/^-+$/.test(J.label.replace(/\s+/g,"")),B=C.filter(J=>J.value==="__new__"),D=C.filter(J=>J.value!=="__new__"&&!M(J)),W=E?D.filter(J=>J.label.toLowerCase().includes(E)):D,U=J=>{let oe=document.createElement("button");oe.type="button",oe.className="aipkit_settings_select_picker_item",oe.setAttribute("role","option"),oe.dataset.value=J.value,oe.dataset.label=J.label,J.disabled&&(oe.classList.add("is-disabled"),oe.setAttribute("aria-disabled","true")),I.value===J.value?(oe.classList.add("is-active"),oe.setAttribute("aria-selected","true")):oe.setAttribute("aria-selected","false");let O=document.createElement("span");O.className="aipkit_settings_select_picker_text",O.textContent=J.label;let L=document.createElement("span");L.className="dashicons dashicons-yes aipkit_settings_select_picker_check",oe.appendChild(O),oe.appendChild(L),T.appendChild(oe)};if(B.forEach(U),W.forEach(U),!B.length&&!W.length){let J=document.createElement("div");J.className="aipkit_settings_select_picker_empty",J.textContent=k(E?"No matches found.":"No options available.","gpt3-ai-content-generator"),T.appendChild(J)}return}let v=p(I),y=!1;if(v.forEach(C=>{let M=C.options.filter(B=>E?B.label.toLowerCase().includes(E):!0);if(M.length){if(C.groupLabel){let B=document.createElement("div");B.className="aipkit_settings_select_picker_group_label",B.textContent=C.groupLabel,T.appendChild(B)}M.forEach(B=>{let D=document.createElement("button");if(D.type="button",D.className="aipkit_settings_select_picker_item",D.setAttribute("role","option"),D.dataset.value=B.value,D.dataset.label=B.label,B.disabled&&(D.classList.add("is-disabled"),D.setAttribute("aria-disabled","true")),I.value===B.value?(D.classList.add("is-active"),D.setAttribute("aria-selected","true")):D.setAttribute("aria-selected","false"),s(I)){D.classList.add("aipkit_settings_select_picker_item--provider");let J=document.createElement("span");J.className="aipkit_settings_select_picker_icon",J.setAttribute("aria-hidden","true"),o(J,B.value),D.appendChild(J)}let W=document.createElement("span");W.className="aipkit_settings_select_picker_text",W.textContent=B.label;let U=document.createElement("span");U.className="dashicons dashicons-yes aipkit_settings_select_picker_check",D.appendChild(W),D.appendChild(U),T.appendChild(D),y=!0})}}),!y){let C=document.createElement("div");C.className="aipkit_settings_select_picker_empty",C.textContent=k(E?"No matches found.":"No options available.","gpt3-ai-content-generator"),T.appendChild(C)}},m=(I,T)=>{if(!I||!T)return;let x=r(I);if(T.textContent=x||k("Select","gpt3-ai-content-generator"),s(I)){let E=T.closest("button"),v=E?E.querySelector(".aipkit_settings_select_picker_icon"):null;o(v,I.value)}},g=(I,T)=>{if(!I||!T)return;let x=I.getBoundingClientRect(),E=T.getBoundingClientRect(),v=E.width||320,y=E.height||0,C=window.innerWidth,M=window.innerHeight,B=12,D=x.left;D+v>C-B&&(D=x.right-v),D=Math.max(B,Math.min(D,C-v-B));let W=x.bottom+8;W+y>M-B&&(W=x.top-y-8),W=Math.max(B,Math.min(W,M-y-B)),T.style.left=`${Math.round(D)}px`,T.style.top=`${Math.round(W)}px`},d=()=>{!e||!i||a||(a=!0,window.requestAnimationFrame(()=>{let I=e.querySelector(".aipkit_model_settings_popover_panel");g(i,I),a=!1}))},w=()=>{e&&(e.classList.remove("aipkit-active"),e.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),e=null,i=null)},h=(I,T,x)=>{if(!I||!T)return;e&&e!==T&&w(),e=T,i=I,T.classList.add("aipkit-active"),T.setAttribute("aria-hidden","false"),I.setAttribute("aria-expanded","true");let E=T.querySelector(".aipkit_settings_select_picker_search input"),v=T.querySelector(".aipkit_settings_select_picker_list");v&&_(x,v,E?E.value:""),E&&E.offsetParent!==null&&(E.focus(),E.select());let y=T.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{g(I,y)})},b=(I,T)=>{if(!I||!T)return;let{button:x,popover:E,list:v,search:y}=T;if(x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("click",C=>{if(C.preventDefault(),e===E){w();return}h(x,E,I)}),x.dataset.pickerListenerAttached="true"),E&&E.dataset.overlayListenerAttached!=="true"){E.addEventListener("click",M=>{M.target===E&&w()});let C=E.querySelector(".aipkit_model_settings_popover_close");C&&C.addEventListener("click",M=>{M.preventDefault(),w()}),E.dataset.overlayListenerAttached="true"}if(v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("click",C=>{let M=C.target.closest(".aipkit_settings_select_picker_item");if(!M||M.classList.contains("is-disabled"))return;let B=M.dataset.value??"";I.value=B,I.dispatchEvent(new Event("change",{bubbles:!0})),m(I,T.label),_(I,v,y?y.value:""),w()}),v.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("input",()=>{_(I,v,y.value)}),y.dataset.pickerListenerAttached="true"),I&&I.dataset.pickerListenerAttached!=="true"&&(I.addEventListener("change",()=>{m(I,T.label),_(I,v,y?y.value:""),e===E&&w()}),I.dataset.pickerListenerAttached="true"),I&&I.dataset.pickerObserverAttached!=="true"){let C=!1;new MutationObserver(()=>{C||(C=!0,window.requestAnimationFrame(()=>{m(I,T.label),_(I,v,y?y.value:""),C=!1}))}).observe(I,{childList:!0,subtree:!0}),I.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitChatPickerEscapeBound||(document.addEventListener("keydown",C=>{C.key==="Escape"&&e&&w()}),document.body.dataset.aipkitChatPickerEscapeBound="true"),document.body.dataset.aipkitChatPickerRepositionBound||(window.addEventListener("resize",d),window.addEventListener("scroll",d,!0),document.body.dataset.aipkitChatPickerRepositionBound="true")};function A(){let I=document.querySelector(".aipkit_chatbot_builder");if(!I)return;let T=I.querySelectorAll(n);T.length&&T.forEach(x=>{if(!x.id||x.dataset.aipkitPickerInit==="true")return;let E=u(x);E&&(m(x,E.label),_(x,E.list,E.search?E.search.value:""),b(x,E),x.dataset.aipkitPickerInit="true")})}function S(){let I=document.querySelector(".aipkit_chatbot_builder");if(!I)return;I.querySelectorAll(n).forEach(x=>{if(!x.id)return;let E=u(x);E&&(m(x,E.label),_(x,E.list,E.search?E.search.value:""),b(x,E),x.dataset.aipkitPickerInit="true")})}window.aipkit_initChatSelectPickers=A,window.aipkit_refreshChatSelectPickers=S})();(function(){"use strict";let k={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"};function n(i){let a=k[i];if(!a)return!0;let s=window.aipkit_dashboard?.providerStatus?.[a];return typeof s>"u"?!0:!!s}function e(i,a={}){return i?typeof window.aipkit_queueProviderSync!="function"?(console.warn("AIPKit Chatbot Sync: aipkit_queueProviderSync is not available."),!1):n(i)?(window.aipkit_queueProviderSync(i,a),!0):!1:!1}window.aipkit_requestChatbotModelSync=e})();(function(){"use strict";function k(e,i,a){let s=document.getElementById(e);if(!s)return;if(s.innerHTML="",!i||i.length===0){s.appendChild(new Option("(No voices found - Sync again)",""));return}s.appendChild(new Option("-- Select Voice --",""));let l={};i.forEach(o=>{let t=o.languageCodes[0]||"und";l[t]||(l[t]=[]),l[t].push(o)}),Object.keys(l).sort().forEach(o=>{let t=document.createElement("optgroup");try{let r=new Intl.DisplayNames(["en"],{type:"language"}).of(o.split("-")[0]);t.label=`${r} (${o})`}catch{t.label=o}l[o].sort((r,f)=>r.name.localeCompare(f.name)),l[o].forEach(r=>{let f=new Option(r.name,r.id);r.id===a&&(f.selected=!0),t.appendChild(f)}),s.appendChild(t)}),a&&!s.value&&(Array.from(s.options).some(t=>t.value===a)?s.value=a:console.warn(`AIPKit TTS: Saved Google voice ID "${a}" not found in synced list for ${e}.`))}function n(e){let i=e.getAttribute("data-target-select"),a=e.querySelector(".aipkit_spinner"),s=e.closest(".aipkit_popover_audio_flyout"),l=s?s.querySelector(".aipkit_tts_sync_status"):null;if(!l){let r=e.closest(".aipkit_popover_option_row");l=r?r.querySelector(".aipkit_tts_sync_status"):null}if(!l){let r=e.closest(".aipkit_form-group");l=r?r.querySelector(".aipkit_form-help"):null}if(!i){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(l||console.error("AIPKit TTS Sync (Google): Could not find message container for button:",e),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}let c=l&&l.classList.contains("aipkit_popover_status_inline"),o=(r,f)=>{!l||!c||(l.textContent=r||"",l.classList.remove("success","error","loading"),f&&l.classList.add(f),l.style.display=r?"inline-block":"none")};if(e.disabled=!0,e.classList.add("aipkit_loading"),a&&(a.style.display="inline-block"),l){let r=l.dataset.baseClass||l.className||"aipkit_form-help";l.dataset.baseClass||(l.dataset.baseClass=r),l.textContent="",l.className=r,l.style.display=r.includes("aipkit_popover_status_inline")?"none":""}c&&o("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(r=>{if(r&&r.voices){let f=document.getElementById(i),u=f?f.value:"";k(i,r.voices,u);let p=document.getElementById("aipkit_google_tts_voices_json_main");p&&(p.dataset.voices=JSON.stringify(r.voices)),l&&(c?o(r.message||"Sync successful!","success"):window.aipkit_showTemporaryMessage(l,"success",r.message||"Sync successful!"))}else throw new Error("Invalid response received from voice sync.")}).catch(r=>{console.error("AIPKit TTS Sync Error (Google):",r),l&&(c?o(`Sync failed: ${r.message||"Unknown error"}`,"error"):window.aipkit_showTemporaryMessage(l,"error",`Sync failed: ${r.message||"Unknown error"}`))}).finally(()=>{e.disabled=!1,e.classList.remove("aipkit_loading"),a&&(a.style.display="none")})}window.aipkit_updateGoogleVoiceSelect=k,window.aipkit_handleSyncGoogleVoices=n})();(function(){"use strict";function k(e,i,a){let s=document.getElementById(e);if(!s){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${e} not found.`);return}if(s.innerHTML="",!i||i.length===0){if(s.appendChild(new Option("(No voices found - Sync voices to load)","")),a){let c=new Option(a+"",a,!1,!0);s.appendChild(c),s.value=a}return}s.appendChild(new Option("-- Select Voice --","")),i.sort((c,o)=>(c.name||c.id||"").localeCompare(o.name||o.id||""));let l=!1;if(i.forEach(c=>{let o=new Option(c.name,c.id);c.id===a&&(o.selected=!0,l=!0),s.appendChild(o)}),a&&!l){let c=!1;for(let o=0;o<s.options.length;o++)if(s.options[o].value===a){c=!0,s.value=a;break}if(!c){let o=new Option(a+"",a,!1,!0);s.appendChild(o),s.value=a,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${a}" not found in synced list for #${e}, added as manual.`)}}else!a&&s.options.length>0&&(s.value="")}function n(e,i,a){let s=document.getElementById(e);if(!s){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${e} not found.`);return}if(s.innerHTML="",!i||i.length===0){if(s.appendChild(new Option("(No models found - Sync models to load)","")),a){let c=new Option(a+"",a,!1,!0);s.appendChild(c),s.value=a}return}s.appendChild(new Option("-- Select Model --","")),i.sort((c,o)=>(c.name||c.id||"").localeCompare(o.name||o.id||""));let l=!1;if(i.forEach(c=>{let o=c.id||"",t=c.name||o;if(!o)return;let r=new Option(t,o);o===a&&(r.selected=!0,l=!0),s.appendChild(r)}),a&&!l){let c=!1;for(let o=0;o<s.options.length;o++)if(s.options[o].value===a){c=!0,s.value=a;break}if(!c){let o=new Option(a+"",a,!1,!0);s.appendChild(o),s.value=a,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${a}" not found in synced list for #${e}, added as manual.`)}}else!a&&s.options.length>0&&(s.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=k,window.aipkit_chatTts_updateElevenLabsModelsSelect=n})();(function(){"use strict";function k(i,a){let s=i.querySelector(".aipkit_tts_conditional_settings"),l=i.querySelector(".aipkit_tts_auto_play_container");s&&(s.style.display=a?"block":"none"),l&&(l.style.display=a?"block":"none")}function n(i){let a=i.querySelector(".aipkit_tts_provider_select");if(!a)return;let s=a.value;i.querySelectorAll(".aipkit_tts_provider_settings").forEach(c=>{if(c.getAttribute("data-provider")===s){if(c.style.display="block",s==="OpenAI"){let o=c.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');o&&(o.style.display="block")}}else c.style.display="none"})}function e(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit TTS Settings: Main content container not found.");return}let a=typeof window.aipkit_updateGoogleVoiceSelect=="function",s=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",l=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",c=typeof window.aipkit_handleSyncGoogleVoices=="function";a||console.error("AIPKit TTS Settings: Google voice update function missing."),s||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),l||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),c||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),i.addEventListener("change",function(t){let r=t.target.closest(".aipkit_tts_toggle_switch"),f=t.target.closest(".aipkit_tts_provider_select");if(r){let u=r.closest(".aipkit_accordion-content");u&&(k(u,r.checked),r.checked&&n(u))}else if(f){let u=f.closest(".aipkit_accordion-content");u&&n(u)}}),i.addEventListener("click",function(t){let r=t.target.closest(".aipkit_sync_tts_voices_btn");r&&r.getAttribute("data-provider")==="Google"&&c&&window.aipkit_handleSyncGoogleVoices(r)}),i.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(t=>{let r=t.querySelector(".aipkit_tts_toggle_switch");r&&(k(t,r.checked),r.checked&&n(t));let f=t.querySelector('select[name="tts_google_voice_id"]');f&&!a&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync voices to load)</option>');let u=t.querySelector('select[name="tts_elevenlabs_voice_id"]');if(u&&s){let m="";if(u&&u.id){let w=u.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_voices_json_${m}`):null,d=g?g.dataset.voices:null;try{let w=d?JSON.parse(d):[],h=u.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(u.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",w),u.options.length<=1&&(u.innerHTML='<option value="">(Sync voices to load)</option>')}}else u&&u.options.length<=1&&(u.innerHTML='<option value="">(Sync voices to load)</option>');let p=t.querySelector('select[name="tts_elevenlabs_model_id"]');if(p&&l){let m="";if(p&&p.id){let w=p.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_models_json_${m}`):null,d=g?g.dataset.models:null;try{let w=d?JSON.parse(d):[],h=p.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(p.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",w),p.options.length<=1&&(p.innerHTML='<option value="">(Sync models to load)</option>')}}else p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync models to load)</option>');let _=t.querySelector('select[name="tts_openai_model_id"]');_&&_.options.length<=1&&(_.innerHTML='<option value="">(Sync models to load)</option>')})}window.aipkit_initTtsSettingsUI=e})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}n.addEventListener("submit",function(e){let i=e.target.closest(".aipkit_chatbot_settings_form");if(!i)return;e.preventDefault();let a=i.getAttribute("data-bot-id"),s=i.querySelector(".aipkit_save_bot_settings_btn");s||(s=document.getElementById("aipkit_chatbot_header_save_btn"));let l=document.getElementById("aipkit_chatbot_global_save_status_container"),c=i.querySelector(`#aipkit_action_feedback_${a}`);if(!a||!s||!l){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",i),l||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}c&&(c.innerHTML=""),l.textContent="",l.className="aipkit_save_status_container",s.disabled=!0,s.classList.add("aipkit_loading");let o=s.querySelector(".aipkit_spinner");o||(o=document.createElement("span"),o.className="aipkit_spinner",s.appendChild(o)),o.style.display="inline-block";let t=new FormData(i),r={};for(let[u,p]of t.entries())if(u.endsWith("[]")){let _=u.slice(0,-2);r[_]=t.getAll(u)}else r.hasOwnProperty(u)||(r[u]=p);r.bot_id=a,function(){let p=document.getElementById(`aipkit_bot_${a}_custom_theme_settings_container`);if(!p)return;p.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["], textarea[name^="custom_theme_settings["]').forEach(m=>{let g=m.getAttribute("name");if(!g)return;let d=!0;(m.type==="checkbox"||m.type==="radio")&&(d=m.checked),d?r[g]=m.value:m.type==="checkbox"&&(r[g]="0")})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_ai_params_modal`);if(!p)return;let _=p.querySelector(".aipkit_modal_body")||p;["temperature","max_completion_tokens","reasoning_effort"].forEach(g=>{let d=_.querySelector(`[name="${g}"]`);d&&(r[g]=d.value)})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_web_settings_modal`);if(!p)return;let _=p.querySelector(".aipkit_modal_body")||p,m=g=>_.querySelector(`[name="${g}"]`);["openai_web_search_context_size","openai_web_search_loc_type","openai_web_search_loc_country","openai_web_search_loc_city","openai_web_search_loc_region","openai_web_search_loc_timezone"].forEach(g=>{let d=m(g);d&&(r[g]=d.value)}),["google_grounding_mode","google_grounding_dynamic_threshold"].forEach(g=>{let d=m(g);d&&(r[g]=d.value)}),["claude_web_search_max_uses","claude_web_search_loc_type","claude_web_search_loc_country","claude_web_search_loc_city","claude_web_search_loc_region","claude_web_search_loc_timezone","claude_web_search_allowed_domains","claude_web_search_blocked_domains","claude_web_search_cache_ttl"].forEach(g=>{let d=m(g);d&&(r[g]=d.value)})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_vector_store_modal`);if(!p)return;let _=A=>p.querySelector(A),m=p.querySelector(".aipkit_modal_body")||p,g=m.querySelector('input[name="enable_vector_store"]');g&&(r.enable_vector_store=g.checked?"1":"0");let d=_('select[name="vector_store_provider"]');if(d&&(r.vector_store_provider=d.value),r.vector_store_provider==="openai"){let A=_('select[name="openai_vector_store_ids[]"]');A?r.openai_vector_store_ids=Array.from(A.selectedOptions).map(S=>S.value):r.openai_vector_store_ids=[]}else delete r.openai_vector_store_ids;if(r.vector_store_provider==="pinecone"){let A=_('select[name="pinecone_index_name"]');A&&(r.pinecone_index_name=A.value)}else delete r.pinecone_index_name;if(r.vector_store_provider==="qdrant"){let A=_('select[name="qdrant_collection_names[]"]');if(A){let S=Array.from(A.selectedOptions).map(I=>I.value);r.qdrant_collection_names=S,r.qdrant_collection_name=S[0]||""}else r.qdrant_collection_names=[],r.qdrant_collection_name=""}else delete r.qdrant_collection_names,delete r.qdrant_collection_name;if(r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant"){let A=_('select[name="vector_embedding_provider"]'),S=_('select[name="vector_embedding_model"]');A&&(r.vector_embedding_provider=A.value),S&&(r.vector_embedding_model=S.value)}else delete r.vector_embedding_provider,delete r.vector_embedding_model;let w=_('input[name="vector_store_top_k"]');w&&(r.vector_store_top_k=w.value);let h=_('input[name="vector_store_confidence_threshold"]');h&&(r.vector_store_confidence_threshold=h.value);let b=m.querySelector('input[name="content_aware_enabled"]');b&&(r.content_aware_enabled=b.checked?"1":"0")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_conversations_modal`);if(!p)return;let _=p.querySelector(".aipkit_modal_body")||p,m=_.querySelector('input[name="stream_enabled"]');m&&(r.stream_enabled=m.checked?"1":"0");let g=_.querySelector('input[name="openai_conversation_state_enabled"]');g&&(r.openai_conversation_state_enabled=g.checked?"1":"0");let d=_.querySelector('input[name="max_messages"]');d&&(r.max_messages=d.value);let w=_.querySelector('select[name="reasoning_effort"]');w&&(r.reasoning_effort=w.value)}(),function(){let p=document.getElementById(`aipkit_bot_${a}_images_modal`);if(!p)return;let _=p.querySelector(".aipkit_modal_body")||p,m=_.querySelector('select[name="chat_image_model_id"]'),g=_.querySelector('input[name="image_triggers"]');m&&(r.chat_image_model_id=m.value),g&&(r.image_triggers=g.value);let d=_.querySelector('input[name="enable_image_upload"]');d&&(r.enable_image_upload=d.checked?"1":"0")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_audio_settings_modal`);if(!p)return;let _=p.querySelector(".aipkit_modal_body")||p,m=w=>_.querySelector(`[name="${w}"]`);function g(w){let h=m(w);h&&(r[w]=h.checked?"1":"0")}function d(w){let h=m(w);h&&(r[w]=h.value)}g("enable_voice_input"),d("stt_provider"),d("stt_openai_model_id"),g("tts_enabled"),d("tts_provider"),d("tts_google_voice_id"),d("tts_openai_voice_id"),d("tts_openai_model_id"),d("tts_elevenlabs_voice_id"),d("tts_elevenlabs_model_id"),g("tts_auto_play"),g("enable_realtime_voice"),g("direct_voice_mode"),g("input_audio_noise_reduction"),d("realtime_model"),d("realtime_voice"),d("turn_detection"),d("input_audio_format"),d("output_audio_format"),d("speed")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_token_mgmt_modal`);if(!p)return;let _=p.querySelector(".aipkit_modal_body")||p,m=_.querySelector('input[name="token_guest_limit"]'),g=_.querySelector('input[name="token_user_limit"]'),d=_.querySelector('select[name="token_limit_mode"]'),w=_.querySelector('select[name="token_reset_period"]'),h=_.querySelector('input[name="token_limit_message"]');m&&(r.token_guest_limit=m.value),g&&(r.token_user_limit=g.value),d&&(r.token_limit_mode=d.value),w&&(r.token_reset_period=w.value),h&&(r.token_limit_message=h.value),_.querySelectorAll('input[name^="token_role_limits["]').forEach(A=>{let S=A.getAttribute("name");S&&(r[S]=A.value)})}(),function(){let p=document.getElementById("aipkit_starters_flyout");if(!p)return;let _=p.querySelector('textarea[name="conversation_starters"]');_&&(r.conversation_starters=_.value)}(),function(){let p=document.getElementById(`aipkit_bot_${a}_popup_settings_modal`);if(!p)return;let _=p.querySelector(".aipkit_modal_body")||p;function m(R){return _.querySelector(`[name="${R}"]`)}function g(R){return _.querySelector(`[name="${R}"]:checked`)}function d(R,H){typeof H<"u"&&H!==null&&(r[R]=H)}let w=m("popup_position");w&&d("popup_position",w.value);let h=m("popup_delay");h&&d("popup_delay",h.value);let b=m("site_wide_enabled");b&&d("site_wide_enabled",b.checked?"1":"0");let A=m("popup_icon_style");if(A)d("popup_icon_style",A.value);else{let R=g("popup_icon_style");R&&d("popup_icon_style",R.value)}let S=m("popup_icon_size");S&&d("popup_icon_size",S.value);let I=m("popup_icon_type");if(I)d("popup_icon_type",I.value);else{let R=g("popup_icon_type");R&&d("popup_icon_type",R.value)}let T=g("popup_icon_default");T&&d("popup_icon_default",T.value);let x=m("popup_icon_custom_url");x&&d("popup_icon_custom_url",x.value);let E=m("header_avatar_type");if(E)d("header_avatar_type",E.value);else{let R=g("header_avatar_type");R&&d("header_avatar_type",R.value)}let v=g("header_avatar_default");v&&d("header_avatar_default",v.value);let y=m("header_avatar_url");y&&d("header_avatar_url",y.value);let C=m("header_online_text");C&&d("header_online_text",C.value);let M=m("popup_label_enabled");M&&d("popup_label_enabled",M.checked?"1":"0");let B=m("popup_label_text");B&&d("popup_label_text",B.value);let D=m("popup_label_mode");D&&d("popup_label_mode",D.value);let W=m("popup_label_size");W&&d("popup_label_size",W.value);let U=m("popup_label_delay_seconds");U&&d("popup_label_delay_seconds",U.value);let J=m("popup_label_auto_hide_seconds");J&&d("popup_label_auto_hide_seconds",J.value);let oe=m("popup_label_dismissible");oe&&d("popup_label_dismissible",oe.checked?"1":"0");let O=m("popup_label_show_on_desktop");O&&d("popup_label_show_on_desktop",O.checked?"1":"0");let L=m("popup_label_show_on_mobile");L&&d("popup_label_show_on_mobile",L.checked?"1":"0");let F=m("popup_label_frequency");F&&d("popup_label_frequency",F.value);let N=m("popup_label_version");N&&d("popup_label_version",N.value)}();let f=r.provider;if(f==="OpenAI")r.model=r.openai_model;else if(f==="OpenRouter")r.model=r.openrouter_model;else if(f==="Google")r.model=r.google_model;else if(f==="Azure")r.model=r.azure_deployment;else if(f==="Claude")r.model=r.claude_model;else if(f==="DeepSeek")r.model=r.deepseek_model;else if(f==="Ollama"){let u=i.querySelector('select[name="ollama_model"]'),p=typeof r.ollama_model<"u"?r.ollama_model:u?u.value:"";r.model=p||""}else r.model="";delete r.openai_model,delete r.openrouter_model,delete r.google_model,delete r.azure_deployment,delete r.claude_model,delete r.deepseek_model,delete r.ollama_model,function(){let p=document.getElementById(`aipkit_bot_${a}_vector_store_modal`),_=g=>p?p.querySelector(g):null,m=g=>i.querySelector(g);if(r.vector_store_provider==="openai"){let g=_('select[name="openai_vector_store_ids[]"]')||m('select[name="openai_vector_store_ids[]"]');g?r.openai_vector_store_ids=Array.from(g.selectedOptions).map(d=>d.value):r.openai_vector_store_ids=[]}else r.hasOwnProperty("openai_vector_store_ids")&&delete r.openai_vector_store_ids;if(r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant"){if(r.vector_store_provider==="qdrant"){let w=_('select[name="qdrant_collection_names[]"]')||m('select[name="qdrant_collection_names[]"]');if(w){let h=Array.from(w.selectedOptions).map(b=>b.value);r.qdrant_collection_names=h,r.qdrant_collection_name=h[0]||""}else r.qdrant_collection_names=[],r.qdrant_collection_name=""}else if(r.vector_store_provider==="pinecone"){let w=_('select[name="pinecone_index_name"]')||m('select[name="pinecone_index_name"]');w&&(r.pinecone_index_name=w.value)}let g=_('select[name="vector_embedding_provider"]')||m('select[name="vector_embedding_provider"]');g&&(r.vector_embedding_provider=g.value);let d=_('select[name="vector_embedding_model"]')||m('select[name="vector_embedding_model"]');d&&(r.vector_embedding_model=d.value)}else delete r.pinecone_index_name,delete r.qdrant_collection_name,delete r.qdrant_collection_names,delete r.vector_embedding_provider,delete r.vector_embedding_model}(),aipkit_apiRequest("aipkit_save_chatbot_settings",r).then(u=>{l.textContent=u.message||"Settings Saved!",l.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(a)}).catch(u=>{l.textContent="Error: "+u.message,l.classList.add("error")}).finally(()=>{s.disabled=!1,s.classList.remove("aipkit_loading");let u=s.querySelector(".aipkit_spinner");if(u&&(u.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(s,"Save");else{let p=Array.from(s.childNodes).find(_=>_.nodeType===Node.TEXT_NODE);p?p.textContent="Save":s.insertBefore(document.createTextNode("Save"),s.firstChild),u&&s.appendChild(u)}setTimeout(()=>{l&&(l.textContent="",l.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Deleter: Main content container not found."),i&&i.querySelectorAll(".aipkit_delete_bot_btn").forEach(s=>{s.getAttribute("data-is-default")==="1"&&(s.disabled=!0)}),i&&i.addEventListener("click",function(s){let l=s.target.closest(".aipkit_delete_bot_btn");if(!l||l.disabled)return;let c=l.getAttribute("data-bot-id"),o=l.getAttribute("data-bot-name"),t=l.closest(".aipkit_chatbot_settings_form"),f=document.getElementById("aipkit_header_action_feedback")||(t?t.querySelector(`#aipkit_action_feedback_${c}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!f){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",l);return}let p=`aipkit_delete_confirmation_${c}`,_=f.querySelector(`#${p}`);_||(_=document.createElement("div"),_.id=p,_.className="aipkit_confirmation_message aipkit_delete_confirmation",_.style.display="none",f.insertBefore(_,f.firstChild));let m=`aipkit_action_status_${c}`,g=f.querySelector(`#${m}`);if(g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",f.appendChild(g)),_.style.display!=="none"&&_.innerHTML!=="")return;u&&(u.textContent="",u.className="aipkit_save_status_container");let d=f.querySelector(".aipkit_reset_confirmation");d&&(d.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",_.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
                </div>
            `,_.style.display="block";let w=_.querySelector(".aipkit_delete_confirm_btn"),h=_.querySelector(".aipkit_delete_cancel_btn"),b=()=>{_.innerHTML="",_.style.display="none",n(l,c,g,u)},A=()=>{_.innerHTML="",_.style.display="none"};w.addEventListener("click",b,{once:!0}),h.addEventListener("click",A,{once:!0})});let a=document.querySelector(".aipkit_chatbot_module_container");a&&a.addEventListener("click",function(s){let l=s.target.closest(".aipkit_header_delete_btn");if(!l)return;let c=l.closest(".aipkit_tab_dropdown_menu");c&&(c.style.display="none");let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),t=o?.dataset?.botId,r=o?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",u=document.getElementById("aipkit_header_action_feedback")||(o?o.querySelector(`#aipkit_action_feedback_${t}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!t||!u)return;if(r){u.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{u.innerHTML=""},3e3);return}let _=`aipkit_delete_confirmation_${t}`,m=u.querySelector(`#${_}`);m||(m=document.createElement("div"),m.id=_,m.className="aipkit_confirmation_message aipkit_delete_confirmation",m.style.display="none",u.insertBefore(m,u.firstChild));let g=`aipkit_action_status_${t}`,d=u.querySelector(`#${g}`);d||(d=document.createElement("div"),d.id=g,d.className="aipkit_action_status_message",u.appendChild(d)),p&&(p.textContent="",p.className="aipkit_save_status_container");let w=u.querySelector(".aipkit_reset_confirmation");w&&(w.style.display="none"),d.textContent="",d.className="aipkit_action_status_message",m.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
          </div>`,m.style.display="block";let h=m.querySelector(".aipkit_delete_confirm_btn"),b=m.querySelector(".aipkit_delete_cancel_btn");h?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none",n(l,t,d,p)},{once:!0}),b?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none"},{once:!0})})}function n(i,a,s,l){let c=i.querySelector(".aipkit_spinner"),o=document.getElementById("aipkit_chatbot_main_selector_container");l&&(l.textContent="",l.className="aipkit_save_status_container"),s.textContent="",s.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),c&&(c.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Deleting..."):i.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:a}).then(t=>{s.textContent=t.message||"Chatbot deleted successfully.",s.classList.add("success");let r=!1;if(o){let u=o.querySelector(`.aipkit_tab_button[data-bot-id="${a}"]`),p=o.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${a}"]`);if(u)r=u.classList.contains("aipkit_active"),u.remove();else if(p){r=p.classList.contains("aipkit_active"),p.remove();let _=o.querySelector(".aipkit_tab_dropdown_menu");if(_&&_.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let g=_.closest(".aipkit_tab_dropdown_container");g&&g.remove()}}}let f=document.getElementById(`chatbot-${a}-content`);if(f&&f.remove(),setTimeout(()=>{let u=document.getElementById(`aipkit_action_status_${a}`);u&&(u.textContent="",u.className="aipkit_action_status_message")},4e3),r){let u=o?.querySelector(".aipkit_tab_button_default");if(u)u.click();else{let p=o?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(p)p.click();else{let _=o?.querySelector(".aipkit_tab_dropdown_item");if(_)_.click();else{let m=o?.querySelector(".aipkit_create-new-button");if(m)m.click();else{let g=document.getElementById("aipkit_admin_chat_preview_container");g&&(g.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(t=>{s.textContent="Error: "+(t.message||"Failed to delete chatbot."),s.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),c&&(c.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Delete"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_action_status_message")},5e3)})}function e(i){if(!i)return"";let a=document.createElement("div");return a.textContent=i,a.innerHTML}window.aipkit_initDeleteBot=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Resetter: Main content container not found."),i&&i.addEventListener("click",function(s){let l=s.target.closest(".aipkit_reset_bot_btn");if(!l||l.disabled)return;let c=l.getAttribute("data-bot-id"),o=l.getAttribute("data-bot-name"),t=l.closest(".aipkit_chatbot_settings_form"),f=document.getElementById("aipkit_header_action_feedback")||(t?t.querySelector(`#aipkit_action_feedback_${c}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!f){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",l);return}let p=`aipkit_reset_confirmation_${c}`,_=f.querySelector(`#${p}`);_||(_=document.createElement("div"),_.id=p,_.className="aipkit_confirmation_message aipkit_reset_confirmation",_.style.display="none",f.insertBefore(_,f.firstChild));let m=`aipkit_action_status_${c}`,g=f.querySelector(`#${m}`);if(g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",f.appendChild(g)),_.style.display!=="none"&&_.innerHTML!=="")return;u&&(u.textContent="",u.className="aipkit_save_status_container");let d=f.querySelector(".aipkit_delete_confirmation");d&&(d.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",_.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm</button>
                </div>
            `,_.style.display="block";let w=_.querySelector(".aipkit_reset_confirm_btn"),h=_.querySelector(".aipkit_reset_cancel_btn"),b=()=>{_.innerHTML="",_.style.display="none",n(l,c,g,u)},A=()=>{_.innerHTML="",_.style.display="none"};w.addEventListener("click",b,{once:!0}),h.addEventListener("click",A,{once:!0})});let a=document.querySelector(".aipkit_chatbot_module_container");a&&a.addEventListener("click",function(s){let l=s.target.closest(".aipkit_header_reset_btn");if(!l)return;let c=l.closest(".aipkit_tab_dropdown_menu");c&&(c.style.display="none");let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),t=o?.dataset?.botId,f=document.getElementById("aipkit_header_action_feedback")||(o?o.querySelector(`#aipkit_action_feedback_${t}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!t||!f)return;let p=`aipkit_reset_confirmation_${t}`,_=f.querySelector(`#${p}`);_||(_=document.createElement("div"),_.id=p,_.className="aipkit_confirmation_message aipkit_reset_confirmation",_.style.display="none",f.insertBefore(_,f.firstChild));let m=`aipkit_action_status_${t}`,g=f.querySelector(`#${m}`);g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",f.appendChild(g)),u&&(u.textContent="",u.className="aipkit_save_status_container");let d=f.querySelector(".aipkit_delete_confirmation");d&&(d.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",_.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Reset</button>
          </div>`,_.style.display="block";let w=_.querySelector(".aipkit_reset_confirm_btn"),h=_.querySelector(".aipkit_reset_cancel_btn");w?.addEventListener("click",()=>{_.innerHTML="",_.style.display="none",n(l,t,g,u)},{once:!0}),h?.addEventListener("click",()=>{_.innerHTML="",_.style.display="none"},{once:!0})})}function n(i,a,s,l){let c=i.querySelector(".aipkit_spinner");l&&(l.textContent="",l.className="aipkit_save_status_container"),s.textContent="",s.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),c&&(c.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Resetting..."):i.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:a}).then(o=>{s.textContent=o.message||"Chatbot reset successfully!",s.classList.add("success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),aipkit_loadModule("chatbot",{force_active_bot_id:a,aipkit_force_refresh:!0},function(t){t&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",t),s.textContent="Reset OK, but UI refresh failed. Reload page.",s.classList.add("error"))}),setTimeout(()=>{let t=document.getElementById(`aipkit_action_status_${a}`);t&&(t.textContent="",t.className="aipkit_action_status_message")},4e3)}).catch(o=>{s.textContent="Error: "+(o.message||"Failed to reset chatbot."),s.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),c&&(c.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Reset"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_action_status_message")},5e3)})}function e(i){if(!i)return"";let a=document.createElement("div");return a.textContent=i,a.innerHTML}window.aipkit_initResetBot=k})();(function(){"use strict";function e(s,l=5,c=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(s)}catch(o){console.error("AIPKit Chat Preview: Error during chat initialization.",o),s.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else l>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${c}ms... (${l} retries left)`),setTimeout(()=>{e(s,l-1,c)},c)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),s.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function i(){let s=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),l=document.getElementById("aipkit_admin_chat_preview_container"),c=document.querySelector(".aipkit_chatbot-preview-column"),o=window.aipkit_dashboard?.text||{};if(!l||!c){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(l.innerHTML="",c.classList.remove("aipkit_loading"),s){let t=s.getAttribute("data-tab-type"),r=s.getAttribute("data-bot-id");t==="bot"&&r?a(r):t==="create"?l.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:t==="settings"?l.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:l.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?l.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:l.innerHTML=`<p class="aipkit_preview_placeholder">${o.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function a(s){let l=document.getElementById("aipkit_admin_chat_preview_container"),c=document.querySelector(".aipkit_chatbot-preview-column"),o=parseInt(s,10);if(!l||!c){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}if(!Number.isFinite(o)||o<=0){let _=window.aipkit_dashboard?.text||{};l.innerHTML=`<p class="aipkit_preview_placeholder">${_.previewPlaceholderSelect||"Select a chatbot to see the preview."}</p>`,c.classList.remove("aipkit_loading");return}let t=null,r=0,f=()=>{r=Date.now(),c.classList.add("aipkit_loading")},u=()=>{if(t&&(clearTimeout(t),t=null),!r){c.classList.remove("aipkit_loading");return}let m=240-(Date.now()-r);m>0?setTimeout(()=>{c.classList.remove("aipkit_loading")},m):c.classList.remove("aipkit_loading")};t=setTimeout(f,160),l.innerHTML="";let p=new URL(window.aipkit_dashboard.ajaxurl);p.searchParams.append("action","aipkit_get_chatbot_shortcode"),p.searchParams.append("bot_id",String(o)),p.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(p).then(_=>_.json()).then(_=>{if(_.success&&_.data&&_.data.html){l.innerHTML=_.data.html;let m=l.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");if(m){l.classList.toggle("aipkit-preview-inline",m.classList.contains("aipkit_chat_container")),l.classList.toggle("aipkit-preview-popup",m.classList.contains("aipkit_popup_wrapper"));let d=window.getComputedStyle(m).getPropertyValue("--aipkit-chat-container-border-radius").trim();d&&d!=="initial"&&d!=="inherit"&&d!=="unset"?l.style.setProperty("--aipkit-chat-container-border-radius",d):l.style.removeProperty("--aipkit-chat-container-border-radius"),e(m)}else console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${s} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,_.data.html),l.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>'}else{let m=_.data&&_.data.message?_.data.message:"Invalid response received for shortcode preview.";throw new Error(m)}}).catch(_=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${s}:`,_),l.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${_.message}</p>`}).finally(()=>{u()})}window.aipkit_loadInitialChatPreview=i,window.aipkit_refreshChatPreview=a})();(function(){"use strict";function k(){let l=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!l)return;let c=function(t){return t?t.tagName==="SELECT"?t.value==="1":!!t.checked:!1},o=function(t){let r=t.target.closest(".aipkit_popup_toggle_switch");if(r){let d=r.closest(".aipkit_chatbot-settings-area");if(d){n(d,r.checked),i(d,r);let w=d.querySelector(".aipkit_popup_config_btn_placeholder");w&&(w.disabled=!r.checked,w.title=r.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let f=t.target.closest('input[name="popup_icon_default"]');if(f){let d=f.closest(".aipkit_chatbot-settings-area");if(d){let w=f.value==="__custom__"?"custom":"default";e(d,w)}return}let u=t.target.closest('select[name="popup_icon_type"]');if(u){let d=u.closest(".aipkit_chatbot-settings-area");d&&e(d,u.value);return}let p=t.target.closest('input[name="popup_icon_type"]');if(p){let d=p.closest(".aipkit_chatbot-settings-area");d&&e(d,p.value);return}let _=t.target.closest(".aipkit_popup_hint_toggle_switch");if(_){let d=_.closest(".aipkit_chatbot-settings-area");d&&s(d,_.checked);return}let m=t.target.closest(".aipkit_starters_toggle_switch");if(m){let d=m.closest(".aipkit_chatbot-settings-area");if(d){let w=d.querySelector(".aipkit_starters_config_btn");if(w){let h=c(m);w.disabled=!h,w.title=h?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}}return}let g=t.target.closest(".aipkit_voice_input_toggle_switch");if(g){let d=g.closest(".aipkit_chatbot-settings-area");d&&a(d,g.checked);return}};l.addEventListener("change",o),l.querySelectorAll(".aipkit_chatbot-settings-area").forEach(t=>{let r=t.querySelector(".aipkit_popup_toggle_switch");if(r){n(t,r.checked),i(t,r);let g=t.querySelector(".aipkit_popup_config_btn_placeholder");g&&(g.disabled=!r.checked,g.title=r.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}let f=t.querySelector('input[name="popup_icon_default"]:checked');if(f){let g=f.value==="__custom__"?"custom":"default";e(t,g)}else{let g=t.querySelector('select[name="popup_icon_type"]');if(g)e(t,g.value);else{let d=t.querySelector('input[name="popup_icon_type"]:checked');d?e(t,d.value):e(t,"default")}}let u=t.querySelector(".aipkit_voice_input_toggle_switch");u&&a(t,u.checked);let p=t.querySelector(".aipkit_popup_hint_toggle_switch");p&&s(t,p.checked);let _=t.querySelector(".aipkit_starters_toggle_switch"),m=t.querySelector(".aipkit_starters_config_btn");if(m){let g=c(_);m.disabled=!g,m.title=g?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}})}function n(l,c){let o=l.querySelector(".aipkit_popup_settings_accordion");if(o&&(o.style.display=c?"block":"none",!c)){let r=o.querySelector(".aipkit_accordion-header"),f=o.querySelector(".aipkit_accordion-content");r&&r.classList.remove("aipkit_active"),f&&f.classList.remove("aipkit_active")}let t=l.querySelector(".aipkit_popup_icon_options_container");t&&(t.style.display=c?"block":"none")}function e(l,c){let o=l.querySelector(".aipkit_popup_icon_default_selector_container"),t=l.querySelector(".aipkit_popup_icon_custom_input_container"),r=!!l.querySelector(".aipkit_popup_icon_default_selector .aipkit_option_card--custom-url");o&&(o.style.display=r||c==="default"?"block":"none"),t&&(t.style.display=c==="custom"?"block":"none")}function i(l,c){let o=c.checked,t=c.getAttribute("data-sidebar-target"),r=l.querySelector("#"+t);if(!r)return;let f=r.querySelector(".aipkit_sidebar_toggle_switch"),u=r.querySelector("label");if(!f||!u)return;let p=r.getAttribute("data-tooltip-disabled")||"";o?(f.getAttribute("data-original-state")===null&&f.setAttribute("data-original-state",f.checked?"checked":"unchecked"),f.checked=!1,f.disabled=!0,r.setAttribute("title",p),r.classList.add("aipkit-disabled-tooltip"),u.style.opacity="0.6"):(f.disabled=!1,r.removeAttribute("title"),r.classList.remove("aipkit-disabled-tooltip"),u.style.opacity="1",f.getAttribute("data-original-state")==="checked"&&(f.checked=!0),f.removeAttribute("data-original-state"))}function a(l,c){let o=l.querySelector(".aipkit_stt_provider_conditional_row");o&&(o.style.display=c?"block":"none")}function s(l,c){let o=l.querySelector(".aipkit_popup_hint_conditional_row");o&&(o.style.display=c?"block":"none");let t=l.querySelectorAll(".aipkit_popup_hint_extra");t&&t.length&&t.forEach(r=>{r.style.display=c?"":"none"})}window.aipkit_initAppearanceToggles=k,window.aipkit_togglePopupDependentSettingsVisibility=n,window.aipkit_toggleSidebarCheckboxState=i,window.aipkit_togglePopupIconValueInputs=e,window.aipkit_toggleSttSettingsVisibility=a,window.aipkit_togglePopupHintSettingsVisibility=s})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n)return;let e=function(i){return i?i.tagName==="SELECT"?i.value==="1":!!i.checked:!1};n.addEventListener("change",function(i){let a=i.target.closest(".aipkit_starters_toggle_switch");if(!a)return;let s=a.closest(".aipkit_chatbot-settings-area");if(!s)return;let l=s.querySelector(".aipkit_starters_conditional_row");l&&(l.style.display=e(a)?"block":"none")}),n.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{let a=i.querySelector(".aipkit_starters_toggle_switch"),s=i.querySelector(".aipkit_starters_conditional_row");a&&s&&(s.style.display=e(a)?"block":"none")})}window.aipkit_initConversationStartersToggle=k})();(function(){"use strict";let k="aipkit_last_selected_chatbot",n="aipkit_chatbotAccordionState",e="aipkit_last_open_chatbot_accordion",i=()=>{try{let t=localStorage.getItem(e);return typeof t=="string"?t:""}catch{return""}},a=()=>{if(window[n]&&typeof window[n]=="object"){let t=window[n].openSectionKey;if(typeof t=="string")return t}return i()},s=(t="")=>{let r=String(t||"").trim();(!window[n]||typeof window[n]!="object")&&(window[n]={}),window[n].openSectionKey=r;try{r?localStorage.setItem(e,r):localStorage.removeItem(e)}catch{}},l=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now();function c(t){let r=document.getElementById("aipkit_admin_chat_preview_container");if(!r)return;r.classList.remove("aipkit-preview-inline","aipkit-preview-popup");let f=document.createElement("p");f.className="aipkit_preview_placeholder",f.textContent=t,r.innerHTML="",r.appendChild(f)}function o(){let t=document.querySelector(".aipkit_chatbot_builder");if(!t||t.dataset.aipkitContext==="sources")return;document.documentElement.classList.add("aipkit-chatbot-builder-page");let r=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:q=>q,f=window.wp&&window.wp.i18n&&window.wp.i18n._n?window.wp.i18n._n:(q,P,$)=>$===1?q:P,u=window.wp&&window.wp.i18n&&window.wp.i18n.sprintf?window.wp.i18n.sprintf:(q,...P)=>{if(!q||!P.length)return q;let $=0;return String(q).replace(/%\d*\$?[sd]/g,()=>{let G=$<P.length?P[$]:"";return $+=1,String(G)})},p={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0},_=t.getAttribute("data-aipkit-chatbot-layout")||"next",m=t.dataset.openaiApiKeySet==="true",g=t.dataset.pineconeApiKeySet==="true",d=t.dataset.qdrantApiKeySet==="true",w=t.dataset.qdrantUrlSet==="true",h=t.dataset.googleApiKeySet==="true",b=t.dataset.azureApiKeySet==="true",A=t.dataset.claudeApiKeySet==="true",S=t.querySelector("#aipkit_chatbot_builder_bot_select"),I=t.getAttribute("data-active-bot-id")||S&&S.value||"",T=String(I||""),x=new Map,E=new Map,v=null,y=!1;if(I)try{localStorage.setItem(k,I)}catch{}let C=t.querySelector(".aipkit_builder_new_bot_btn"),M=t.querySelector("[data-aipkit-bot-tabs]"),B=t.querySelector(".aipkit_builder_bot_overflow"),D=t.querySelector(".aipkit_builder_bot_overflow_trigger"),W=t.querySelector(".aipkit_builder_bot_overflow_menu"),U=10,J=null,oe=null,O=document.getElementById("aipkit_builder_sheet"),L=O?O.querySelector(".aipkit_builder_sheet_panel"):null,F=document.getElementById("aipkit_model_settings_popover"),N=document.getElementById("aipkit_settings_accordion"),R=N||(F?F.querySelector(".aipkit_model_settings_popover_panel"):null),H=F&&F.getAttribute("data-aipkit-mode")==="disabled",K=F?F.querySelector(".aipkit_model_settings_popover_close"):null,re=F?F.querySelector(".aipkit_model_settings_popover_title"):null,ve=F?F.querySelector(".aipkit_model_settings_popover_back"):null,Ie=F?F.querySelector(".aipkit_model_settings_popover_footer"):null,Ee=null,Z="root",pe=O?O.querySelector(".aipkit_builder_sheet_title"):null,we=O?O.querySelector(".aipkit_builder_sheet_description"):null,de=O?O.querySelector(".aipkit_builder_sheet_body"):null,ae=O?O.querySelectorAll(".aipkit_builder_sheet_section"):[],ne=O?O.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'):null,ye=O?O.querySelector(".aipkit_builder_sheet_close"):null,Me=t.querySelector(".aipkit_bot_name_input"),nt=t.querySelector("[data-aipkit-chatbot-summary]"),se=t.querySelector("[data-aipkit-interface-summary]"),be=t.querySelector("[data-aipkit-context-summary]"),xe=t.querySelector("[data-aipkit-behavior-summary]"),Re=t.querySelector("[data-aipkit-tools-summary]"),De=t.querySelector("[data-aipkit-safety-summary]"),ze=t.querySelector("[data-aipkit-limits-summary]"),Ze=t.querySelector("[data-aipkit-rules-summary]"),it=t.querySelector("[data-aipkit-popup-summary]"),Pt=t.querySelector('textarea[name="instructions"]'),Mi=t.querySelector(".aipkit_builder_instructions_expand"),Qt=document.getElementById("aipkit_builder_instructions_modal"),ti=Qt?Qt.querySelector(".aipkit_builder_instructions_close"):null,wt=Qt?Qt.querySelector(".aipkit_builder_instructions_modal_textarea"):null,at=Qt?Qt.querySelector(".aipkit_builder_instructions_count"):null,et=()=>{let q=t.querySelector(".aipkit_chatbot_provider_select");return q?q.value:""},ei=q=>{if(!q)return"";let P=t.querySelector(`.aipkit_chatbot_model_field[data-provider="${q}"]`);if(!P)return"";let $=P.querySelector("select");return $&&$.value||""},li=q=>{let P=String(q||"").toLowerCase();return/(?:^|[-_])chat(?:[-_]|$)/.test(P)?!1:P.indexOf("gpt-5")!==-1||P.indexOf("o1")!==-1||P.indexOf("o3")!==-1||P.indexOf("o4")!==-1},Jt=()=>{let q=et();return q!=="OpenAI"?!1:li(ei(q))},Ut=q=>{if(!q)return"";let P=q.selectedOptions&&q.selectedOptions.length?q.selectedOptions[0]:q.options&&q.selectedIndex>=0&&q.selectedIndex<q.options.length?q.options[q.selectedIndex]:null;return P&&P.textContent?P.textContent.trim():""},Di=q=>!q||!q.selectedOptions?[]:Array.from(q.selectedOptions).map(P=>P&&P.textContent?P.textContent.trim():"").filter(Boolean),xt=q=>String(q||"").replace(/\s+\([^)]*\)\s*$/,"").trim(),pi=()=>{let q=t.querySelector(".aipkit_vector_embedding_select"),P=Ut(q);if(!P){let $=t.querySelector('[name="vector_embedding_model"]');P=$?String($.value||""):""}return xt(P)},Wt=()=>{if(!nt)return;let q=nt.dataset.defaultSummary||"Select engine and model",P=t.querySelector(".aipkit_chatbot_provider_select"),$=P&&P.value||"",G=Ut(P),Q="";if($){let j=t.querySelector(`.aipkit_chatbot_model_field[data-provider="${$}"]`);if(j){let V=j.querySelector("select");Q=Ut(V)}}let X=[];G&&X.push(G),Q&&X.push(Q);let ie=X.length?X.join(" | "):q;nt.textContent=ie,nt.setAttribute("title",ie)},Wi=()=>{if(!it)return;let q=it.dataset.defaultSummary||"Popup settings",P=t.querySelector('select[name="popup_position"]'),$=t.querySelector('select[name="aipkit_deploy_popup_scope"]'),G=[],Q=Ut(P),X=Ut($);Q&&G.push(Q),X&&G.push(X);let ie=G.length?G.join(" | "):q;it.textContent=ie,it.setAttribute("title",ie)},Sn=()=>{let q=t.querySelector('.aipkit_custom_theme_presets .aipkit_custom_theme_preset.is-selected, .aipkit_custom_theme_presets .aipkit_custom_theme_preset[aria-pressed="true"]');if(!q)return"";let P=q.querySelector(".aipkit_custom_theme_preset_label");return P&&P.textContent?P.textContent.trim():""},Ki=()=>{let q=t.querySelector('select[name="theme"]');if(q&&!q.disabled){if((q.value||"")==="custom"){let $=Sn();if($)return $}return Ut(q)}let P=t.querySelector('input[name="theme"]:checked');if(P&&!P.disabled){if((P.value||"")==="custom"){let X=Sn();if(X)return X}let $=P.closest(".aipkit_theme_choice_card"),G=$?$.querySelector(".aipkit_theme_choice_label"):null,Q=G&&G.textContent?G.textContent.trim():"";if(Q)return Q}return""},ln=()=>{if(!se)return;let q=se.dataset.defaultSummary||"Select theme",$=Ki()||q;se.textContent=$,se.setAttribute("title",$)},Vn=()=>{if(!be)return;let q=be.dataset.defaultSummary||"",P=[],$=t.querySelector(".aipkit_vector_store_enable_select");if($&&$.checked){let X=t.querySelector(".aipkit_vector_store_provider_select"),ie=X&&X.value||"",j=Ut(X),V=[];if(ie==="openai")V=Di(t.querySelector('select[name="openai_vector_store_ids[]"]'));else if(ie==="pinecone"){let ce=Ut(t.querySelector('select[name="pinecone_index_name"]'));ce&&(V=[ce])}else ie==="qdrant"&&(V=Di(t.querySelector('select[name="qdrant_collection_names[]"]')));let Y=Array.from(new Set(V.map(ce=>xt(ce)).filter(Boolean)));if(j){let ce=Y.length?`${j}: ${Y.join(", ")}`:j;P.push(ce)}else Y.length&&P.push(Y.join(", "));if(ie==="pinecone"||ie==="qdrant"){let ce=pi();ce&&P.push(ce)}}let G=t.querySelector(".aipkit_content_aware_enable_select");G&&G.checked&&P.push(r("Page context","gpt3-ai-content-generator"));let Q=P.length?P.join(" | "):q;be.textContent=Q,be.setAttribute("title",Q)},Se=q=>{let P=String(q||"").toLowerCase(),$={none:r("None","gpt3-ai-content-generator"),low:r("Low","gpt3-ai-content-generator"),medium:r("Medium","gpt3-ai-content-generator"),high:r("High","gpt3-ai-content-generator"),xhigh:r("Very high","gpt3-ai-content-generator")};return $[P]||$.none},Fe=()=>{if(!xe)return;let q=xe.dataset.defaultSummary||r("Response length and memory","gpt3-ai-content-generator"),P=t.querySelector('[name="max_completion_tokens"]'),$=t.querySelector('[name="max_messages"]'),G=t.querySelector('[name="reasoning_effort"]'),Q=Jt(),X=P?String(P.value||"").trim():"",ie=$?String($.value||"").trim():"",j=Q?Se(G?G.value:""):"",Y=X!==""||ie!==""?Q?u(r("Response length: %1$s | Memory: %2$s | Reasoning: %3$s","gpt3-ai-content-generator"),X||"-",ie||"-",j):u(r("Response length: %1$s | Memory: %2$s","gpt3-ai-content-generator"),X||"-",ie||"-"):q;xe.textContent=Y,xe.setAttribute("title",Y)},Ve=()=>{let q=String(et()||"").toLowerCase(),$={openai:".aipkit_openai_web_search_enable_toggle",google:".aipkit_google_search_grounding_enable_toggle",claude:".aipkit_claude_web_search_enable_toggle",openrouter:".aipkit_openrouter_web_search_enable_toggle"}[q]||"";return $?t.querySelector($):null},Tt=()=>{if(!Re)return;let q=Re.dataset.defaultSummary||"",P=[],$=ht=>ht?ht.tagName==="SELECT"?ht.value==="1":!!ht.checked:!1,G=t.querySelector(".aipkit_file_upload_toggle_select");$(G)&&P.push(r("File Upload","gpt3-ai-content-generator"));let Q=String(et()||""),X=Q==="OpenAI"||Q==="Claude"||Q==="OpenRouter",ie=t.querySelector(".aipkit_image_analysis_checkbox");X&&$(ie)&&P.push(r("Image Analysis","gpt3-ai-content-generator"));let j=t.querySelector(".aipkit_tools_image_generation_toggle");$(j)&&P.push(r("Image generation","gpt3-ai-content-generator"));let V=Ve();$(V)&&P.push(r("Web Search","gpt3-ai-content-generator"));let Y=t.querySelector(".aipkit_voice_input_toggle_switch");$(Y)&&P.push(r("Speech to Text","gpt3-ai-content-generator"));let ce=t.querySelector(".aipkit_tts_toggle_switch");$(ce)&&P.push(r("Text to Speech","gpt3-ai-content-generator"));let ge=t.querySelector(".aipkit_enable_realtime_voice_toggle");$(ge)&&P.push(r("Realtime Voice","gpt3-ai-content-generator"));let Te=P.length,Je=Te>3?u(r("Enabled: %d","gpt3-ai-content-generator"),Te):Te>0?u(r("Enabled: %s","gpt3-ai-content-generator"),P.join(", ")):q;Re.textContent=Je,Re.setAttribute("title",Je)},st=()=>{if(!De)return;let q=De.dataset.defaultSummary||"",P=[],$=V=>V?V.tagName==="SELECT"?V.value==="1":!!V.checked:!1,G=t.querySelector('[name="enable_ip_anonymization"]');$(G)&&P.push(r("IP anonymization","gpt3-ai-content-generator"));let Q=t.querySelector('[name="enable_consent_compliance"]');$(Q)&&P.push(r("Consent notice","gpt3-ai-content-generator"));let X=t.querySelector('[name="openai_moderation_enabled"]'),ie=String(et()||"").toLowerCase();$(X)&&ie==="openai"&&P.push(r("Moderation","gpt3-ai-content-generator"));let j=P.length?`${r("Enabled","gpt3-ai-content-generator")}: ${P.join(", ")}`:q;De.textContent=j,De.setAttribute("title",j)},qt=q=>{let P=String(q||"").toLowerCase(),$={never:r("never","gpt3-ai-content-generator"),daily:r("1 day","gpt3-ai-content-generator"),weekly:r("1 week","gpt3-ai-content-generator"),monthly:r("1 month","gpt3-ai-content-generator")};return $[P]||$.monthly},fi=q=>String(q??"").trim()||r("Unlimited","gpt3-ai-content-generator"),Ht=()=>{if(!ze)return;let q=ze.dataset.defaultSummary||"",P=t.querySelector('[name="token_limit_mode"]'),$=P?String(P.value||""):"",G=q;if($==="role_based"){let Q=t.querySelector('[name="token_reset_period"]'),X=qt(Q?Q.value:"");G=u(r("Enabled: role based limit reset period: %s.","gpt3-ai-content-generator"),X)}else if($==="general"||$===""){let Q=t.querySelector('[name="token_guest_limit"]'),X=t.querySelector('[name="token_user_limit"]');G=u(r("Guests: %1$s Users: %2$s","gpt3-ai-content-generator"),fi(Q?Q.value:""),fi(X?X.value:""))}ze.textContent=G,ze.setAttribute("title",G)},hi=q=>{if(!q)return 0;if(Array.isArray(q))return q.length;if(typeof q=="string"){let P=q.trim();if(!P)return 0;try{return hi(JSON.parse(P))}catch{return 0}}if(typeof q=="object"){if(Array.isArray(q.triggers))return q.triggers.length;if(Array.isArray(q.rules))return q.rules.length}return 0},mi=(q,P,$)=>{let G=f(P,$,q,"gpt3-ai-content-generator");return/%\d*\$?[ds]/.test(G)?G.replace(/%\d*\$?[ds]/,String(q)):`${q} ${G}`},Bi=()=>{if(!Ze)return;let q=Ze.dataset.defaultSummary||"",P=t.querySelector('textarea[name="triggers_json"]'),$=P?hi(P.value):0,G=P&&$>0?mi($,"%d rule","%d rules"):q;Ze.textContent=G,Ze.setAttribute("title",G)};nt&&!t.dataset.chatbotSummaryBound&&(t.addEventListener("change",q=>{let P=q.target;P&&(P.matches(".aipkit_chatbot_provider_select")||P.closest(".aipkit_chatbot_model_field select"))&&Wt()}),t.dataset.chatbotSummaryBound="1"),se&&!t.dataset.interfaceSummaryBound&&(t.addEventListener("change",q=>{let P=q.target;P&&(P.matches('input[name="theme"]')||P.matches('select[name="theme"]'))&&ln()}),t.addEventListener("click",q=>{q.target.closest(".aipkit_custom_theme_preset")&&window.setTimeout(()=>{ln()},0)}),t.dataset.interfaceSummaryBound="1"),it&&!t.dataset.popupSummaryBound&&(t.addEventListener("change",q=>{let P=q.target;P&&(P.matches('select[name="popup_position"]')||P.matches('select[name="aipkit_deploy_popup_scope"]'))&&Wi()}),t.dataset.popupSummaryBound="1"),be&&!t.dataset.contextSummaryBound&&(t.addEventListener("change",q=>{let P=q.target;P&&(P.matches(".aipkit_vector_store_enable_select")||P.matches(".aipkit_vector_store_provider_select")||P.matches('select[name="openai_vector_store_ids[]"]')||P.matches('select[name="pinecone_index_name"]')||P.matches('select[name="qdrant_collection_names[]"]')||P.matches(".aipkit_vector_embedding_select")||P.matches('[name="vector_embedding_provider"]')||P.matches('[name="vector_embedding_model"]')||P.matches(".aipkit_content_aware_enable_select")||P.matches('[name="content_aware_enabled"]'))&&Vn()}),t.dataset.contextSummaryBound="1"),xe&&!t.dataset.behaviorSummaryBound&&(t.addEventListener("change",q=>{let P=q.target;P&&(P.matches(".aipkit_chatbot_provider_select")||P.closest(".aipkit_chatbot_model_field select")||P.matches('[name="max_completion_tokens"]')||P.matches('[name="max_messages"]')||P.matches('[name="reasoning_effort"]'))&&Fe()}),t.addEventListener("input",q=>{let P=q.target;P&&(P.matches('[name="max_completion_tokens"]')||P.matches('[name="max_messages"]'))&&Fe()}),t.dataset.behaviorSummaryBound="1"),Re&&!t.dataset.toolsSummaryBound&&(t.addEventListener("change",q=>{let P=q.target;P&&(P.matches(".aipkit_file_upload_toggle_select")||P.matches(".aipkit_image_analysis_checkbox")||P.matches(".aipkit_tools_image_generation_toggle")||P.matches(".aipkit_openai_web_search_enable_toggle")||P.matches(".aipkit_google_search_grounding_enable_toggle")||P.matches(".aipkit_claude_web_search_enable_toggle")||P.matches(".aipkit_openrouter_web_search_enable_toggle")||P.matches(".aipkit_voice_input_toggle_switch")||P.matches(".aipkit_tts_toggle_switch")||P.matches(".aipkit_enable_realtime_voice_toggle")||P.matches(".aipkit_chatbot_provider_select"))&&Tt()}),t.dataset.toolsSummaryBound="1"),De&&!t.dataset.safetySummaryBound&&(t.addEventListener("change",q=>{let P=q.target;P&&(P.matches('[name="enable_ip_anonymization"]')||P.matches('[name="enable_consent_compliance"]')||P.matches('[name="openai_moderation_enabled"]')||P.matches(".aipkit_chatbot_provider_select"))&&st()}),t.dataset.safetySummaryBound="1"),ze&&!t.dataset.limitsSummaryBound&&(t.addEventListener("change",q=>{let P=q.target;P&&(P.matches('[name="token_limit_mode"]')||P.matches('[name="token_guest_limit"]')||P.matches('[name="token_user_limit"]')||P.matches('[name="token_reset_period"]'))&&Ht()}),t.addEventListener("input",q=>{let P=q.target;P&&(P.matches('[name="token_guest_limit"]')||P.matches('[name="token_user_limit"]'))&&Ht()}),t.dataset.limitsSummaryBound="1"),Ze&&!t.dataset.rulesSummaryBound&&(t.addEventListener("input",q=>{let P=q.target;P&&(P.matches('textarea[name="triggers_json"]')||P.closest(".aipkit_trigger_builder_container"))&&window.setTimeout(()=>{Bi()},0)}),t.addEventListener("change",q=>{let P=q.target;P&&(P.matches('textarea[name="triggers_json"]')||P.closest(".aipkit_trigger_builder_container"))&&window.setTimeout(()=>{Bi()},0)}),t.addEventListener("click",q=>{q.target.closest(".aipkit_trigger_builder_container")&&window.setTimeout(()=>{Bi()},0)}),t.dataset.rulesSummaryBound="1"),Wt(),ln(),Wi(),Vn(),Fe(),Tt(),st(),Ht(),Bi();let gi=()=>{D&&D.setAttribute("aria-expanded","false"),W&&(W.hidden=!0)},ii=(q="")=>{if(!W)return;let P=String(q||"").trim().toLowerCase(),$=Array.from(W.querySelectorAll(".aipkit_builder_bot_overflow_item")),G=0;$.forEach(X=>{let ie=String(X.dataset.botLabel||"").toLowerCase(),j=P===""||ie.includes(P);X.hidden=!j,j&&(G+=1)});let Q=W.querySelector(".aipkit_builder_bot_overflow_empty");Q&&(Q.hidden=G>0)},ji=()=>{if(!W||!S)return;let q=String(S.value||"");W.innerHTML="";let P=Array.from(S.options||[]).filter(G=>G&&G.value&&G.value!=="__new__"&&!G.disabled),$=P.length>=U;if($){let G=document.createElement("div");G.className="aipkit_builder_bot_overflow_search",G.setAttribute("role","none");let Q=document.createElement("input");Q.type="search",Q.className="aipkit_builder_bot_overflow_search_input",Q.autocomplete="off",Q.setAttribute("placeholder",r("Search chatbots...","gpt3-ai-content-generator")),Q.setAttribute("aria-label",r("Search chatbots","gpt3-ai-content-generator")),G.appendChild(Q),W.appendChild(G)}if(P.forEach(G=>{let Q=String(G.value||""),X=(G.textContent||"").trim(),ie=Q===q,j=document.createElement("button");j.type="button",j.className="aipkit_builder_bot_overflow_item",ie&&j.classList.add("is-active"),j.dataset.botId=Q,j.dataset.botLabel=X.toLowerCase(),j.setAttribute("role","menuitemradio"),j.setAttribute("aria-checked",ie?"true":"false"),j.textContent=X,W.appendChild(j)}),$){let G=document.createElement("div");G.className="aipkit_builder_bot_overflow_empty",G.textContent=r("No matching chatbots.","gpt3-ai-content-generator"),G.hidden=!0,W.appendChild(G),ii("")}},Ue=()=>{if(!M)return;Array.from(M.querySelectorAll(".aipkit_builder_bot_tab_label")).forEach(P=>{let $=P.closest(".aipkit_builder_bot_tab");if(!$||$.hidden){P.classList.remove("aipkit_is_truncated");return}let G=Math.ceil(P.scrollWidth)>P.clientWidth+1;P.classList.toggle("aipkit_is_truncated",G)})},ui=()=>{if(!M)return;let q=Array.from(M.querySelectorAll(".aipkit_builder_bot_tab"));if(!q.length){D&&(D.hidden=!0),B&&(B.hidden=!0),gi(),ji();return}q.forEach(_t=>{_t.hidden=!1});let P=_t=>{if(!_t)return 0;let Le=_t.columnGap&&_t.columnGap!=="normal"?_t.columnGap:_t.gap,ke=parseFloat(Le||"0");return Number.isFinite(ke)?ke:0},$=_t=>{if(!_t)return 0;let Le=window.getComputedStyle(_t),ke=parseFloat(Le.width||"0"),tt=parseFloat(Le.marginLeft||"0"),Ce=parseFloat(Le.marginRight||"0"),ct=_t.getBoundingClientRect().width||_t.offsetWidth||ke,bt=Number.isFinite(ct)?ct:0,ri=Number.isFinite(tt)?tt:0,Zt=Number.isFinite(Ce)?Ce:0;return Math.ceil(bt+ri+Zt)},G=window.getComputedStyle(M),Q=P(G),X=M.closest(".aipkit_builder_bot_tabs_shell"),ie=X?window.getComputedStyle(X):null,j=P(ie),V=M.closest(".aipkit_builder_bot_tabs_row"),Y=V?V.getBoundingClientRect():M.getBoundingClientRect(),ce=Math.max(0,Math.floor(Y.width)),ge=$(C),Te=$(D),Je=ge>0?ge+j:0,ht=_t=>{let Le=_t.getBoundingClientRect();return Math.ceil(Le.width||_t.offsetWidth||0)},It=q.findIndex(_t=>_t.classList.contains("is-active")),Ot=_t=>{let Le=0,ke=[];if(q.forEach((tt,Ce)=>{let qe=ht(tt);if(qe<=0)return;let ct=ke.length===0?qe:Le+Q+qe;ct<=_t+.5&&(ke.push(Ce),Le=ct)}),It!==-1&&!ke.includes(It)){let tt=[],Ce=0;for(let qe=It;qe>=0;qe--){let ct=ht(q[qe]);if(ct<=0)continue;let bt=tt.length===0?ct:Ce+Q+ct;if(bt>_t+.5)break;tt.unshift(qe),Ce=bt}ke=tt.length>0?tt:[It]}return ke},Li=Math.max(0,ce-Je),kt=Ot(Li);if(kt.length<q.length&&Te>0){let _t=Te+j,Le=Math.max(0,ce-Je-_t);kt=Ot(Le)}let Xt=new Set(kt),Ct=0;q.forEach((_t,Le)=>{let ke=Xt.has(Le);_t.hidden=!ke,ke||(Ct+=1)}),Ue();let Gt=Ct>0;D&&(D.hidden=!Gt),B&&(B.hidden=!Gt),Gt||gi(),ji()},Hi=(q="")=>{if(!M||!S)return;let P=String(q||S.value||"");Array.from(M.querySelectorAll(".aipkit_builder_bot_tab")).forEach(Q=>{let X=String(Q.dataset.botId||""),ie=P!==""&&X===P;Q.classList.toggle("is-active",ie),Q.setAttribute("aria-selected",ie?"true":"false"),Q.setAttribute("tabindex",ie?"0":"-1");let j=Array.from(S.options||[]).find(V=>String(V.value||"")===X);if(j){let V=(j.textContent||"").trim(),Y=Q.querySelector(".aipkit_builder_bot_tab_label");Y?Y.textContent=V:Q.textContent=V}}),ui();let G=M.querySelector(".aipkit_builder_bot_tab.is-active:not([hidden])");G&&typeof G.scrollIntoView=="function"&&G.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})},En=q=>typeof window<"u"&&window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(q)):String(q).replace(/([ #;?%&,.+*~\\':"!^$\[\]()=>|/@])/g,"\\$1"),Do=q=>Array.isArray(q)?q.map(P=>String(P??"")):q==null||q===""?[]:[String(q)],Ao=q=>{if(Array.isArray(q))return q.some($=>Ao($));if(q===!0||q===1)return!0;let P=String(q??"").trim().toLowerCase();return P==="1"||P==="true"||P==="yes"||P==="on"},Wo=(q,P)=>{if(!q)return;let $=(q.tagName||"").toUpperCase(),G=(q.type||"").toLowerCase();if(G==="checkbox"){if(Array.isArray(P)){let Q=P.map(X=>String(X??""));q.checked=Q.includes(String(q.value||"1"));return}q.checked=Ao(P);return}if(G==="radio"){q.checked=String(q.value||"")===String(P??"");return}if($==="SELECT"&&q.multiple){let Q=Do(P);Array.from(q.options||[]).forEach(X=>{X.selected=Q.includes(String(X.value||""))});return}q.value=P==null?"":String(P)},gn=(q,P,$)=>{if(!q||!P)return!1;let G=`[name="${En(P)}"]`,Q=Array.from(q.querySelectorAll(G));return Q.length?(Q.forEach(X=>Wo(X,$)),!0):!1},uo=(q,P)=>{let $=String(q||"").trim(),G=String(P||"").trim();if(!$||!G||$===G)return;let Q=["aipkit_bot_","aipkit_theme_choice_","aipkit_image_model_choice_","aipkit_embed_code_","aipkit_embed_allowed_domains_","aipkit_reset_confirmation_","aipkit_delete_confirmation_","aipkit_elevenlabs_voices_json_","aipkit_elevenlabs_models_json_"],X=V=>{if(!V||typeof V!="string")return V;let Y=V;return Q.forEach(ce=>{let ge=`${ce}${$}`,Te=`${ce}${G}`;Y.includes(ge)&&(Y=Y.split(ge).join(Te))}),Y},ie=["id","for","aria-controls","aria-labelledby","data-target"];[t,O,F,Qt,document.getElementById("aipkit_builder_embed_modal")].filter(Boolean).forEach(V=>{[V,...Array.from(V.querySelectorAll("[id],[for],[aria-controls],[aria-labelledby],[data-target]"))].forEach(ce=>{ie.forEach(ge=>{if(!ce.hasAttribute(ge))return;let Te=ce.getAttribute(ge),Je=X(Te);Je!==Te&&ce.setAttribute(ge,Je)})})})},Ca=q=>{if(!q||typeof q!="object")return null;let P=String(q.bot_id||"").trim();return P?{bot_id:P,bot_name:String(q.bot_name||""),is_default:!!q.is_default,settings:q.settings&&typeof q.settings=="object"?{...q.settings}:{},deploy_mode:String(q.deploy_mode||"inline"),shortcode:String(q.shortcode||""),embed_code:String(q.embed_code||""),embed_allowed_domains:String(q.embed_allowed_domains||""),conversation_starters_text:String(q.conversation_starters_text||""),triggers_json:String(q.triggers_json||"[]")}:null},Ho=q=>{let P=Ca(q);return P?(x.set(P.bot_id,P),P):null},ta=(q="")=>{let P=String(q||"").trim();if(P&&x.has(P))return Promise.resolve(x.get(P));let $=P||"__all__";if(E.has($))return E.get($);if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Chatbot state API unavailable."));let G=P?{bot_id:P}:{},Q=window.aipkit_apiRequest("aipkit_get_chatbot_switch_state",G).then(X=>(X&&X.bot&&Ho(X.bot),X&&X.bots&&typeof X.bots=="object"&&Object.keys(X.bots).forEach(ie=>{Ho(X.bots[ie])}),P?x.get(P)||null:X)).finally(()=>{E.delete($)});return E.set($,Q),Q},Vo=()=>v||(S&&Array.from(S.options||[]).filter(P=>P.value&&P.value!=="__new__"&&!P.disabled).length>1?(v=ta().catch(()=>{}).finally(()=>{v=null}),v):Promise.resolve()),ia=(q,P)=>{let $=String(q||"").trim();if(!$||!P)return!1;let G=t.querySelector("form.aipkit_chatbot_settings_form");if(!G)return!1;let Q=String(T||G.dataset.botId||$).trim();Q&&Q!==$&&uo(Q,$),T=$,t.setAttribute("data-active-bot-id",$),G.dataset.botId=$,S&&String(S.value||"")!==$&&(S.value=$),Hi($);let X=P.settings&&typeof P.settings=="object"?P.settings:{};Object.entries(X).forEach(([ce,ge])=>{if(!ce)return;if(ce==="token_role_limits"&&ge&&typeof ge=="object"){Object.entries(ge).forEach(([Je,ht])=>{gn(t,`token_role_limits[${Je}]`,ht)});return}!gn(t,ce,ge)&&Array.isArray(ge)&&!ce.endsWith("[]")&&gn(t,`${ce}[]`,ge)}),Me&&(Me.value=P.bot_name||""),gn(t,"conversation_starters",P.conversation_starters_text),gn(t,"triggers_json",P.triggers_json),gn(t,"embed_allowed_domains",P.embed_allowed_domains);let ie=t.querySelector("[data-aipkit-top-mode-select]");ie&&P.deploy_mode&&(ie.value=P.deploy_mode),P.shortcode&&t.querySelectorAll(".aipkit_builder_shortcode_pill").forEach(ge=>{ge.setAttribute("data-shortcode",P.shortcode);let Te=ge.querySelector(".aipkit_shortcode_text");Te?Te.textContent=P.shortcode:ge.textContent=P.shortcode});let j=document.getElementById(`aipkit_embed_code_${$}`);j&&typeof P.embed_code=="string"&&(j.value=P.embed_code);let V=t.querySelector(".aipkit_active_bot_name_display");V&&(V.textContent=P.bot_name||"");let Y=t.querySelector('.aipkit_popover_footer_btn[data-action="delete"]');if(Y){let ce=!!P.is_default;Y.disabled=ce,Y.setAttribute("aria-disabled",ce?"true":"false"),Y.setAttribute("title",r(ce?"Default bot cannot be deleted.":"Delete chatbot","gpt3-ai-content-generator"))}io(),Yo(),Pn(),Qa(),ai(),Ta(),Gi(),Ir(),Br(),Fa(),nn(),Ja(N),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),Wt(),ln(),Wi(),Vn(),Fe(),Tt(),st(),Ht(),Bi();try{localStorage.setItem(k,$)}catch{}if(typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview($),O&&O.classList.contains("aipkit-active")&&typeof window.aipkit_initTriggerBuilderUI=="function"){let ce=O.querySelector('.aipkit_builder_sheet_section[data-sheet="triggers"]');ce&&!ce.hidden&&window.aipkit_initTriggerBuilderUI($)}return!0},Mn=async q=>{let P=String(q||"").trim();if(!P||P==="__new__"||y)return!1;if(x.has(P)){if(S&&String(S.value||"")!==P)return!1;y=!0;try{return ia(P,x.get(P))}finally{y=!1}}let $=await ta(P);if(!$||S&&String(S.value||"")!==P)return!1;y=!0;try{return ia(P,$)}finally{y=!1}},xr=q=>{if(!q)return p;let P=window.aipkit_dashboard&&window.aipkit_dashboard.models&&Array.isArray(window.aipkit_dashboard.models.openrouter)?window.aipkit_dashboard.models.openrouter:[],$=String(q).trim().toLowerCase();if(!$)return p;let G=P.find(Q=>(Q&&Q.id?String(Q.id):"").trim().toLowerCase()===$);return!G||!G.capabilities||typeof G.capabilities!="object"?p:{...p,...G.capabilities}},xa=q=>{if(!q||et()!=="OpenRouter")return!0;let $=ei("OpenRouter");return!!xr($)[q]},Uo=(q,P,$,G)=>{if(!q||!P)return;q.classList.toggle("aipkit_popover_option_row--disabled",$),q.setAttribute("aria-disabled",$?"true":"false"),P.disabled=!!$;let Q=q.querySelector(".aipkit_popover_option_label");Q&&(Q.dataset.defaultTooltip||(Q.dataset.defaultTooltip=Q.getAttribute("data-tooltip")||""),Q.setAttribute("data-tooltip",$&&G||Q.dataset.defaultTooltip))},Go=t.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),na=t.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),_o=t.querySelector(".aipkit_training_text_input"),oa=t.querySelector("#aipkit_training_qa_question"),aa=t.querySelector("#aipkit_training_qa_answer"),An=t.querySelector("#aipkit_training_files_input"),fo=t.querySelector(".aipkit_training_files_button"),Lo=t.querySelector(".aipkit_builder_dropzone"),Io=t.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),Rn=t.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),Bn=t.querySelector(".aipkit_training_stop_btn"),Aa=t.querySelector("#aipkit_sources_training_card .aipkit_builder_action_row"),Fn=t.querySelector("#aipkit_training_status"),zn=t.querySelector("#aipkit_training_file_list"),Qn=new Map,mo=null,an={page:1,selectedIds:new Set},kn=t.querySelector(".aipkit_training_sources_btn"),La=t.querySelector("#aipkit_sources_training_card"),Cn=t.querySelector("[data-aipkit-context-source-dropdown]"),Jn=Cn?Cn.querySelector(".aipkit_popover_multiselect_btn"):null,er=Cn?Cn.querySelector(".aipkit_popover_multiselect_label"):null,go=Cn?Cn.querySelector(".aipkit_popover_multiselect_panel"):null,To=Cn?Array.from(Cn.querySelectorAll(".aipkit_context_source_option")):[],Ii=t.querySelector(".aipkit_vector_store_enable_select"),hn=t.querySelector(".aipkit_content_aware_enable_select"),dn=t.querySelector("[data-aipkit-tools-enabled-dropdown]"),qo=dn?dn.querySelector(".aipkit_popover_multiselect_btn"):null,tr=dn?dn.querySelector(".aipkit_popover_multiselect_label"):null,ra=dn?dn.querySelector(".aipkit_popover_multiselect_panel"):null,Yn=dn?Array.from(dn.querySelectorAll(".aipkit_tools_enabled_option")):[],Un=t.querySelector("#aipkit_vs_wp_content_messages_area"),$n=t.querySelector("#aipkit_vs_wp_content_mode"),Xn=t.querySelector("#aipkit_vs_load_wp_content_btn"),pn=t.querySelector("#aipkit_vs_global_target_select"),Po=t.querySelector("#aipkit_vs_wp_content_status"),Mo=t.querySelector("#aipkit_vs_wp_content_status_specific"),Dn=t.querySelector("#aipkit_vs_wp_content_list_area"),sa=t.querySelector("#aipkit_vs_wp_content_pagination"),Bo=t.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Fo=t.querySelector("#aipkit_wp_content_bulk_panel"),ir=t.querySelector("#aipkit_wp_content_specific_panel"),Yt=t.querySelector("#aipkit_wp_content_bulk_hint"),nr=t.querySelector("#aipkit_wp_content_specific_types_panel"),Ia=()=>{let q=R&&R.querySelector(".aipkit_vector_store_enable_select")||t.querySelector(".aipkit_vector_store_enable_select");return q?q.tagName==="SELECT"?q.value==="1":!!q.checked:!1},Ta=()=>{if(!La)return;let q=Ia();La.hidden=!q};Ta();let qa=(q,P,$,G=2)=>{let Q=q.filter(ie=>ie&&ie.checked);if(!Q.length)return P?.dataset.placeholder||$;if(Q.length>G)return`${Q.length} selected`;let X=Q.map(ie=>{let j=ie.closest("label")?.querySelector(".aipkit_popover_multiselect_text");return j?j.textContent.trim():""}).filter(Boolean);return X.length?X.join(", "):`${Q.length} selected`},or=()=>{er&&(er.textContent=qa(To,Cn,"Select data source",2))},ca=()=>{if(!To.length)return;let q=!!(Ii&&(Ii.tagName==="SELECT"&&Ii.value==="1"||Ii.checked)),P=!!(hn&&(hn.tagName==="SELECT"&&hn.value==="1"||hn.checked));To.forEach($=>{$&&($.value==="vector"?$.checked=q:$.value==="page_context"&&($.checked=P))}),or()},Pa=()=>{let q=To.find($=>$.value==="vector"),P=To.find($=>$.value==="page_context");if(Ii&&q){let $=!!q.checked,G=Ii.tagName==="SELECT"?Ii.value==="1":!!Ii.checked;$!==G&&(Ii.tagName==="SELECT"?Ii.value=$?"1":"0":Ii.checked=$,Ii.dispatchEvent(new Event("change",{bubbles:!0})))}if(hn&&P){let $=!!P.checked,G=hn.tagName==="SELECT"?hn.value==="1":!!hn.checked;$!==G&&(hn.tagName==="SELECT"?hn.value=$?"1":"0":hn.checked=$,hn.dispatchEvent(new Event("change",{bubbles:!0})))}or()},la=()=>{!Jn||!go||(Jn.setAttribute("aria-expanded","false"),go.hidden=!0,Cn.classList.remove("is-open"))};Cn&&Jn&&go&&!Cn.dataset.bound&&(Jn.addEventListener("click",q=>{if(q.preventDefault(),Jn.getAttribute("aria-expanded")==="true"){la();return}Jn.setAttribute("aria-expanded","true"),go.hidden=!1,Cn.classList.add("is-open")}),To.forEach(q=>{q.addEventListener("change",()=>{Pa()})}),document.addEventListener("click",q=>{Cn.contains(q.target)||la()}),document.addEventListener("keydown",q=>{q.key==="Escape"&&la()}),Ii&&Ii.addEventListener("change",ca),hn&&hn.addEventListener("change",ca),ca(),Cn.dataset.bound="1");let ar=q=>q?q.tagName==="SELECT"?q.value==="1":!!q.checked:!1,Ar=(q,P)=>{if(!q||q.disabled)return;let $=!!P;ar(q)!==$&&(q.tagName==="SELECT"?q.value=$?"1":"0":q.checked=$,q.dispatchEvent(new Event("change",{bubbles:!0})))},Ma=q=>{switch(q){case"file_upload":return t.querySelector(".aipkit_file_upload_toggle_select");case"web_search":return Ve();case"image_analysis":return t.querySelector(".aipkit_image_analysis_checkbox");case"image_generation":return t.querySelector(".aipkit_tools_image_generation_toggle");case"speech_to_text":return t.querySelector(".aipkit_voice_input_toggle_switch");case"text_to_speech":return t.querySelector(".aipkit_tts_toggle_switch");case"realtime_voice":return t.querySelector(".aipkit_enable_realtime_voice_toggle");default:return null}},Ba=()=>{tr&&(tr.textContent=qa(Yn,dn,"Select tools",2))},Fa=()=>{if(!Yn.length)return;let q={};Yn.forEach(P=>{let $=P.dataset.toolKey||P.value;q[$]=!!P.checked}),t.querySelectorAll("[data-aipkit-tool-key]").forEach(P=>{let $=P.dataset.aipkitToolKey||"";if(!$)return;let G=q[$]!==!1;P.classList.toggle("aipkit_tools_feature_row--is-hidden",!G)})},oo=()=>{Yn.length&&(Yn.forEach(q=>{if(!q)return;let P=q.dataset.toolKey||q.value,$=Ma(P);$&&(q.checked=ar($));let Q=q.dataset.staticDisabled==="1"||!$||$.disabled;q.disabled=Q;let X=q.closest(".aipkit_tools_enabled_item");X&&X.classList.toggle("is-disabled",Q)}),Ba(),Fa())},rr=()=>{Yn.length&&(Yn.forEach(q=>{if(!q||q.disabled)return;let P=q.dataset.toolKey||q.value,$=Ma(P);$&&Ar($,q.checked)}),Ba(),Fa())},Ko=()=>{!qo||!ra||(qo.setAttribute("aria-expanded","false"),ra.hidden=!0,dn.classList.remove("is-open"),Kn())};if(dn&&qo&&ra&&!dn.dataset.bound){qo.addEventListener("click",P=>{if(P.preventDefault(),qo.getAttribute("aria-expanded")==="true"){Ko();return}qo.setAttribute("aria-expanded","true"),ra.hidden=!1,dn.classList.add("is-open"),Kn()}),Yn.forEach(P=>{P.addEventListener("change",()=>{rr()})}),document.addEventListener("click",P=>{dn.contains(P.target)||Ko()}),document.addEventListener("keydown",P=>{P.key==="Escape"&&Ko()}),[".aipkit_file_upload_toggle_select",".aipkit_openai_web_search_enable_toggle",".aipkit_google_search_grounding_enable_toggle",".aipkit_claude_web_search_enable_toggle",".aipkit_openrouter_web_search_enable_toggle",".aipkit_image_analysis_checkbox",".aipkit_tools_image_generation_toggle",".aipkit_voice_input_toggle_switch",".aipkit_tts_toggle_switch",".aipkit_enable_realtime_voice_toggle"].forEach(P=>{t.querySelectorAll(P).forEach($=>{$.addEventListener("change",oo)})});let q=t.querySelector(".aipkit_chatbot_provider_select");q&&q.addEventListener("change",()=>{window.requestAnimationFrame(oo)}),oo(),dn.dataset.bound="1"}let da=t.querySelector("#aipkit_wp_content_status_wrap_bulk"),sr=t.querySelector("#aipkit_wp_content_status_wrap_specific"),Ji=O?O.querySelector('.aipkit_builder_sheet_section[data-sheet="sources"]'):null,On=Ji?Ji.querySelector("#aipkit_sources_table_body"):null,pa=Ji?Ji.querySelector(".aipkit_sources_search_input"):null,ko=Ji?Ji.querySelector(".aipkit_sources_filter_select"):null,ua=Ji?Ji.querySelector(".aipkit_sources_refresh_btn"):null,wo=Ji?Ji.querySelector("#aipkit_sources_pagination"):null,Zn=Ji?Ji.querySelector("#aipkit_sources_status"):null,$a=Ji?Ji.querySelector("#aipkit_sources_provider_label"):null,eo=Ji?Ji.querySelector("#aipkit_sources_store_label"):null,di=document.getElementById("aipkit_sources_editor_modal"),ho=di?di.querySelector(".aipkit_sources_editor_textarea"):null,cr=di?di.querySelector(".aipkit_sources_editor_close"):null,_a=di?di.querySelector(".aipkit_sources_editor_cancel"):null,Oa=di?di.querySelector(".aipkit_sources_editor_save"):null,bi=document.getElementById("aipkit_sources_delete_modal"),lr=bi?bi.querySelector(".aipkit_sources_delete_close"):null,yn=bi?bi.querySelector(".aipkit_sources_delete_cancel"):null,yo=bi?bi.querySelector(".aipkit_sources_delete_confirm"):null,rn=document.getElementById("aipkit_builder_embed_modal"),fa=rn?rn.querySelector(".aipkit_builder_embed_close"):null,dr=rn?rn.querySelector(".aipkit_builder_embed_done"):null,z=document.getElementById("aipkit_image_settings_flyout"),te=z?z.querySelector(".aipkit_popover_flyout_close"):null,fe=null,ue=document.getElementById("aipkit_parameters_flyout"),Ae=ue?ue.querySelector(".aipkit_popover_flyout_close"):null,He=null,Oe=document.getElementById("aipkit_popup_hint_flyout"),Qe=Oe?Oe.querySelector(".aipkit_popover_flyout_close"):null,je=null,Ge=document.getElementById("aipkit_security_privacy_flyout"),gt=Ge?Ge.querySelector(".aipkit_popover_flyout_close"):null,Rt=R?R.querySelector('[data-aipkit-settings-panel="safety"]'):null,ni=null,yt=document.getElementById("aipkit_starters_flyout"),Xi=yt?yt.querySelector(".aipkit_popover_flyout_close"):null,Ai=null,Mt=document.getElementById("aipkit_custom_theme_flyout"),_i=Mt?Mt.querySelector(".aipkit_popover_flyout_close"):null,ki=null,Ti=null,Bt=document.getElementById("aipkit_builder_web_settings_modal"),qn=Bt?Bt.querySelector(".aipkit_builder_web_settings_close"):null,Vt=document.getElementById("aipkit_builder_context_settings_modal"),Na=Vt?Vt.querySelector(".aipkit_builder_context_settings_close"):null,Ra=R?R.querySelector('[data-aipkit-settings-panel="context"]'):null,un=null,Si=document.getElementById("aipkit_builder_token_limits_modal"),Da=Si?Si.querySelector(".aipkit_builder_token_limits_close"):null,pr=R?R.querySelector('[data-aipkit-settings-panel="limits"]'):null,_n=null,Xe=document.getElementById("aipkit_builder_audio_settings_modal"),Wa=Xe?Xe.querySelector(".aipkit_builder_audio_settings_close"):null,Vi=null,zi=t.querySelector("#aipkit_builder_popup_settings_panel"),en=t.querySelector("[data-aipkit-popup-launcher-dropdown]"),ao=en?en.querySelector(".aipkit_popover_multiselect_btn"):null,$o=en?en.querySelector(".aipkit_popover_multiselect_label"):null,Ui=en?en.querySelector(".aipkit_popover_multiselect_panel"):null,vn=en?Array.from(en.querySelectorAll(".aipkit_popup_launcher_radio")):[],sn={};["popup_position","popup_icon_style","popup_icon_size"].forEach(q=>{let P=t.querySelector(`select[name="${q}"]`);P&&(sn[q]=P)});let cn=t.querySelector("[data-aipkit-theme-dropdown]"),to=cn?cn.querySelector(".aipkit_popover_multiselect_btn"):null,Ha=cn?cn.querySelector(".aipkit_popover_multiselect_label"):null,ma=cn?cn.querySelector(".aipkit_popover_multiselect_panel"):null,Ln=cn?Array.from(cn.querySelectorAll(".aipkit_interface_theme_radio")):[],Fi=t.querySelector('select[name="theme"]'),vo=t.querySelector('input[name="theme_preset_key"]'),qi=t.querySelector(".aipkit_theme_config_btn"),Zi=t.querySelector("[data-aipkit-image-model-dropdown]"),ro=Zi?Zi.querySelector(".aipkit_popover_multiselect_btn"):null,ur=Zi?Zi.querySelector(".aipkit_popover_multiselect_label"):null,jo=Zi?Zi.querySelector(".aipkit_popover_multiselect_panel"):null,ga=Zi?Array.from(Zi.querySelectorAll(".aipkit_tools_image_model_radio")):[],tn=t.querySelector('select[name="chat_image_model_id"]'),Gn=t.querySelector("[data-aipkit-replicate-key-trigger]"),Nn=t.querySelector("[data-aipkit-replicate-key-popover]"),Va=Nn?Nn.querySelector("[data-aipkit-replicate-key-close]"):null,$i=document.getElementById("aipkit_chatbot_global_save_status_container"),dt=(q,P)=>{if(!$i)return;let $=typeof q=="string"?q:"",G=typeof P=="string"?P.trim():"",Q=!G&&/saving|syncing|deleting|duplicating|resetting|loading|refreshing/i.test($),X=$i.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_model_sync_status");X&&$&&(X.textContent="",X.classList.remove("success","error","loading")),$i.textContent=$,$i.className="aipkit_save_status_container",G?$i.classList.add(G):Q&&$i.classList.add("loading")},Oi=()=>{$i&&setTimeout(()=>{$i.textContent="",$i.className="aipkit_save_status_container"},2500)},Oo=()=>{let q=z&&z.querySelector('input[name="replicate_api_key"]')||R&&R.querySelector('input[name="replicate_api_key"]')||O?.querySelector('input[name="replicate_api_key"]');return q?String(q.value||"").trim():""},Ua=q=>{if(!(q!==void 0?String(q||"").trim():Oo())||typeof window.aipkit_queueProviderSync!="function")return null;dt("Syncing models...","loading");let $=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return $&&typeof $.then=="function"&&$.then(()=>{dt("Models synced!","success"),Oi()}).catch(G=>{dt(`Error: ${G?.message||"Sync failed."}`,"error"),Oi()}),$},Ga=t.dataset.modelSettingsTitle||"Settings",bo=q=>{if(!R||!q)return;let P=q.getBoundingClientRect(),$=R.getBoundingClientRect(),G=$.width||420,Q=$.height||0,X=window.innerWidth,ie=window.innerHeight,j=12,V=P.right+10;V+G>X-j&&(V=P.left-G-10),V=Math.max(j,Math.min(V,X-G-j));let Y=P.top;Y+Q>ie-j&&(Y=ie-Q-j),Y=Math.max(j,Y),R.style.left=`${Math.round(V)}px`,R.style.top=`${Math.round(Y)}px`,ue&&ue.classList.contains("is-open")&&He&&_r(He),z&&z.classList.contains("is-open")&&fe&&so(fe),Bt&&Bt.classList.contains("is-open")&&Ti&&No(Ti),Vt&&Vt.classList.contains("is-open")&&un&&Ro(un),Si&&Si.classList.contains("is-open")&&_n&&wa(_n),Xe&&Xe.classList.contains("is-open")&&Vi&&ha(Vi)},ka=q=>{if(!F)return;let P=Array.from(F.querySelectorAll("[data-aipkit-settings-panel]"));if(!P.length)return;let $=q||"root",G=F.querySelector(`[data-aipkit-settings-panel="${$}"]`)||F.querySelector('[data-aipkit-settings-panel="root"]');if(!G)return;let Q=G.dataset.aipkitSettingsPanel||"root";if(Q!==Z&&((()=>{ue&&(ue.classList.remove("is-open"),ue.setAttribute("aria-hidden","true")),He&&(He.setAttribute("aria-expanded","false"),He=null),z&&(z.classList.remove("is-open"),z.setAttribute("aria-hidden","true")),fe&&(fe.setAttribute("aria-expanded","false"),fe=null),Ge&&(Ge.classList.remove("is-open"),Ge.setAttribute("aria-hidden","true")),ni&&(ni.setAttribute("aria-expanded","false"),ni=null),ba(),Ko(),Bt&&(Bt.classList.remove("is-open"),Bt.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),Vt&&(Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true")),un&&(un.setAttribute("aria-expanded","false"),un=null),Si&&(Si.classList.remove("is-open"),Si.setAttribute("aria-hidden","true")),_n&&(_n.setAttribute("aria-expanded","false"),_n=null),Xe&&(Xe.classList.remove("is-open"),Xe.setAttribute("aria-hidden","true")),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null),yt&&(yt.classList.remove("is-open"),yt.setAttribute("aria-hidden","true")),Ai&&(Ai.setAttribute("aria-expanded","false"),Ai=null),Mt&&(Mt.classList.remove("is-open"),Mt.setAttribute("aria-hidden","true")),ki&&(ki.setAttribute("aria-expanded","false"),ki=null)})(),Z=Q),P.forEach(ie=>{ie.hidden=ie!==G}),re){let ie={root:F.dataset.titleRoot||"Settings",appearance:F.dataset.titleAppearance||"Appearance",behavior:F.dataset.titleBehavior||"Behavior",context:F.dataset.titleContext||"Context",tools:F.dataset.titleTools||"Tools",safety:F.dataset.titleSafety||"Safety",limits:F.dataset.titleLimits||"Limits"};re.textContent=ie[Q]||ie.root}ve&&(ve.hidden=Q==="root"),Ie&&(Ie.hidden=Q!=="root"),Q==="behavior"&&Ja(G),Q==="limits"&&Gi(),F.classList.contains("aipkit-active")&&Ee&&window.requestAnimationFrame(()=>{bo(Ee)})},_r=q=>{if(!ue||!q)return;let P=q.getBoundingClientRect(),$=R?R.getBoundingClientRect():null,G=$&&$.width>0&&$.height>0,Q=ue.getBoundingClientRect(),X=Q.width||320,ie=Q.height||260,j=window.innerWidth,V=window.innerHeight,Y=12,ce=($?$.right:P.right)+8;ce+X>j-Y&&(ce=($?$.left:P.left)-X-8),ce=Math.max(Y,Math.min(ce,j-X-Y));let ge=$?$.top:P.top-8;ge+ie>V-Y&&(ge=V-ie-Y),ge<Y&&(ge=Y),ue.style.left=`${Math.round(ce)}px`,ue.style.top=`${Math.round(ge)}px`},so=q=>{if(!z||!q)return;let P=q.getBoundingClientRect(),$=R?R.getBoundingClientRect():null,G=z.getBoundingClientRect(),Q=G.width||340,X=G.height||220,ie=window.innerWidth,j=window.innerHeight,V=12,Y=($?$.right:P.right)+8;Y+Q>ie-V&&(Y=($?$.left:P.left)-Q-8),Y=Math.max(V,Math.min(Y,ie-Q-V));let ce=$?$.top:P.top-8;ce+X>j-V&&(ce=j-X-V),ce<V&&(ce=V),z.style.left=`${Math.round(Y)}px`,z.style.top=`${Math.round(ce)}px`},zo=q=>{if(!Oe||!q)return;let P=q.getBoundingClientRect(),$=q.closest(".aipkit_builder_card--settings, .aipkit_settings_accordion"),G=$?$.getBoundingClientRect():P,Q=q.closest(".aipkit_popover_multiselect_panel"),X=Q?Q.getBoundingClientRect():null,ie=X&&X.width>0&&X.height>0?X:P,j=Oe.getBoundingClientRect(),V=j.width||320,Y=j.height||240,ce=window.innerWidth,ge=window.innerHeight,Te=12,Je=8,ht=Math.max(G.right,ie.right),It=Math.min(G.left,ie.left),Ot=ht+Je,Li=It-V-Je,kt=ce-Te-Ot,yi=Li-Te,Xt;kt>=V||kt>=yi?Xt=Ot:Xt=Li,Xt=Math.max(Te,Math.min(Xt,ce-V-Te));let Ct=ge-ie.bottom+Je;Ct<Te&&(Ct=Te),ge-Ct-Y<Te&&(Ct=Math.max(Te,ge-Y-Te)),Oe.style.left=`${Math.round(Xt)}px`,Oe.style.top="auto",Oe.style.bottom=`${Math.round(Ct)}px`},Ka=q=>{if(!yt||!q)return;let P=q.getBoundingClientRect(),$=q.closest(".aipkit_builder_card--settings, .aipkit_settings_accordion"),G=$?$.getBoundingClientRect():P,Q=q.closest(".aipkit_interface_cell--controls, .aipkit_interface_feature_row"),X=Q?Q.getBoundingClientRect():P,ie=yt.getBoundingClientRect(),j=ie.width||400,V=ie.height||240,Y=window.innerWidth,ce=window.innerHeight,ge=12,Te=8,Je=G.right+Te,ht=G.left-j-Te,It=Y-ge-Je,Ot=ht-ge,Li;It>=j||It>=Ot?Li=Je:Li=ht,Li=Math.max(ge,Math.min(Li,Y-j-ge));let kt=ce-X.bottom;kt<ge&&(kt=ge),ce-kt-V<ge&&(kt=Math.max(ge,ce-V-ge)),yt.style.left=`${Math.round(Li)}px`,yt.style.top="auto",yt.style.bottom=`${Math.round(kt)}px`},ja=q=>{if(!Ge||!q)return;let P=q.getBoundingClientRect(),$=R?R.getBoundingClientRect():null,G=$&&$.width>0&&$.height>0,X=Ge.getBoundingClientRect().width||400,ie=window.innerWidth,j=window.innerHeight,V=12,Y=(G?$.right:P.right)+8;Y+X>ie-V&&(Y=(G?$.left:P.left)-X-8),Y=Math.max(V,Math.min(Y,ie-X-V));let ce=G?j-$.bottom:j-P.bottom,ge=Math.max(V,ce);Ge.style.left=`${Math.round(Y)}px`,Ge.style.top="auto",Ge.style.bottom=`${Math.round(ge)}px`},za=q=>{if(!Mt||!q)return;let P=q.getBoundingClientRect();if(P.width===0&&P.height===0&&t){let Te=t.querySelector(".aipkit_theme_config_btn")||t.querySelector("[data-aipkit-theme-dropdown] .aipkit_popover_multiselect_btn")||t.querySelector('select[name="theme"]')||t.querySelector('.aipkit_theme_choice_card input[name="theme"][value="custom"]')?.closest(".aipkit_theme_choice_card");if(Te){let Je=Te.getBoundingClientRect();(Je.width>0||Je.height>0)&&(P=Je)}}let $=R?R.getBoundingClientRect():null,G=$&&$.width>0&&$.height>0,Q=Mt.getBoundingClientRect(),X=Q.width||400,ie=Q.height||260,j=window.innerWidth,V=window.innerHeight,Y=12,ce=(G?$.right:P.right)+8;ce+X>j-Y&&(ce=(G?$.left:P.left)-X-8),ce=Math.max(Y,Math.min(ce,j-X-Y));let ge=G?$.top:P.top-8;ge+ie>V-Y&&(ge=V-ie-Y),ge<Y&&(ge=Y),Mt.style.left=`${Math.round(ce)}px`,Mt.style.top=`${Math.round(ge)}px`},No=q=>{if(!Bt||!q)return;let P=R?R.getBoundingClientRect():null,$=P&&P.width>0&&P.height>0,G=q.getBoundingClientRect(),Q=Bt.querySelector(".aipkit-modal-content"),X=Q?Q.getBoundingClientRect():null,ie=X?X.width:520,j=X?X.height:420,V=window.innerWidth,Y=window.innerHeight,ce=12,ge=($?P.right:G.right)+10;ge+ie>V-ce&&(ge=($?P.left:G.left)-ie-10),ge=Math.max(ce,Math.min(ge,V-ie-ce));let Te=G.top-8;Te+j>Y-ce&&(Te=Y-j-ce),Te<ce&&(Te=ce),Bt.style.left=`${Math.round(ge)}px`,Bt.style.top=`${Math.round(Te)}px`,Bt.style.bottom="auto"},Ro=q=>{if(!Vt||!q)return;let P=R?R.getBoundingClientRect():null,$=q.getBoundingClientRect(),G=Vt.querySelector(".aipkit-modal-content"),Q=G?G.getBoundingClientRect():null,X=Q?Q.width:560,ie=window.innerWidth,j=12,V=(P?P.right:$.right)+8;V+X>ie-j&&(V=(P?P.left:$.left)-X-8),V=Math.max(j,Math.min(V,ie-X-j));let Y=P?P.top:j;Vt.style.left=`${Math.round(V)}px`,Vt.style.top=`${Math.round(Y)}px`},wa=q=>{if(!Si||!q)return;let P=R?R.getBoundingClientRect():null,$=q.getBoundingClientRect(),G=Si.querySelector(".aipkit-modal-content"),Q=G?G.getBoundingClientRect():null,X=Q?Q.width:620,ie=Q?Q.height:400,j=window.innerWidth,V=12,Y=(P?P.right:$.right)+8;Y+X>j-V&&(Y=(P?P.left:$.left)-X-8),Y=Math.max(V,Math.min(Y,j-X-V));let ce=P?P.bottom-ie:$.top-12;ce<V&&(ce=V),Si.style.left=`${Math.round(Y)}px`,Si.style.top=`${Math.round(ce)}px`},ha=q=>{if(!Xe||!q)return;let P=R?R.getBoundingClientRect():null,$=P&&P.width>0&&P.height>0,G=q.getBoundingClientRect(),Q=Xe.querySelector(".aipkit-modal-content"),X=Q?Q.getBoundingClientRect():null,ie=X?X.width:520,j=X?X.height:460,V=window.innerWidth,Y=12,ce=($?P.right:G.right)+10;ce+ie>V-Y&&(ce=($?P.left:G.left)-ie-10),ce=Math.max(Y,Math.min(ce,V-ie-Y));let ge=window.innerHeight,Te=G.top-8;Te+j>ge-Y&&(Te=ge-j-Y),Te<Y&&(Te=Y),Xe.style.left=`${Math.round(ce)}px`,Xe.style.top=`${Math.round(Te)}px`,Xe.style.bottom="auto"},fr=q=>{H||!F||!R||!q||(O&&O.classList.contains("aipkit-active")&&(O.classList.remove("aipkit-active"),O.setAttribute("aria-hidden","true")),ka("root"),Ee=q,F.classList.add("aipkit-active"),F.setAttribute("aria-hidden","false"),q.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_model_settings_popover"),Ja(R),io(),Yo(),nn(),window.requestAnimationFrame(()=>{bo(q)}))},So=()=>{F&&(ka("root"),Bt&&(Bt.classList.remove("is-open"),Bt.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),Vt&&(Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true")),un&&(un.setAttribute("aria-expanded","false"),un=null),Si&&(Si.classList.remove("is-open"),Si.setAttribute("aria-hidden","true")),_n&&(_n.setAttribute("aria-expanded","false"),_n=null),Xe&&(Xe.classList.remove("is-open"),Xe.setAttribute("aria-hidden","true")),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null),ue&&(ue.classList.remove("is-open"),ue.setAttribute("aria-hidden","true")),He&&(He.setAttribute("aria-expanded","false"),He=null),z&&(z.classList.remove("is-open"),z.setAttribute("aria-hidden","true")),fe&&(fe.setAttribute("aria-expanded","false"),fe=null),Ge&&(Ge.classList.remove("is-open"),Ge.setAttribute("aria-hidden","true")),ni&&(ni.setAttribute("aria-expanded","false"),ni=null),va(),ba(),Ko(),F.classList.remove("aipkit-active"),F.setAttribute("aria-hidden","true"),Ee&&Ee.setAttribute("aria-expanded","false"),Ee=null)},mr=()=>{if(!R)return;let q=t.querySelector(".aipkit_chatbot_provider_select"),P=q?q.value:"",$=xa("web_search_plugin"),G=ie=>ie?ie.tagName==="SELECT"?ie.value==="1":ie.type==="checkbox"?ie.checked:ie.value==="1":!1,Q={OpenAI:{row:R.querySelector(".aipkit_web_search_toggle_openai"),toggle:R.querySelector(".aipkit_openai_web_search_enable_toggle"),button:R.querySelector('.aipkit_web_search_config_btn[data-web-provider="openai"]')},Google:{row:R.querySelector(".aipkit_web_search_toggle_google"),toggle:R.querySelector(".aipkit_google_search_grounding_enable_toggle"),button:R.querySelector('.aipkit_web_search_config_btn[data-web-provider="google"]')},Claude:{row:R.querySelector(".aipkit_web_search_toggle_claude"),toggle:R.querySelector(".aipkit_claude_web_search_enable_toggle"),button:R.querySelector('.aipkit_web_search_config_btn[data-web-provider="claude"]')},OpenRouter:{row:R.querySelector(".aipkit_web_search_toggle_openrouter"),toggle:R.querySelector(".aipkit_openrouter_web_search_enable_toggle"),button:R.querySelector('.aipkit_web_search_config_btn[data-web-provider="openrouter"]')}};Object.entries(Q).forEach(([ie,j])=>{if(j.row&&(j.row.style.display=P===ie?"":"none"),j.button){let Y=ie==="OpenRouter"?$:!0;j.button.style.display=Y&&G(j.toggle)?"":"none"}}),Bt&&Ti&&Bt.classList.contains("is-open")&&(Ti.offsetParent!==null&&Ti.style.display!=="none"&&!Ti.hidden||(Bt.classList.remove("is-open"),Bt.setAttribute("aria-hidden","true"),Ti.setAttribute("aria-expanded","false"),Ti=null));let X=Q.OpenRouter;if(X.row&&X.toggle){let ie=P==="OpenRouter"&&!$;ie&&G(X.toggle)&&(X.toggle.tagName==="SELECT"?X.toggle.value="0":X.toggle.type==="checkbox"?X.toggle.checked=!1:X.toggle.value="0",X.toggle.dispatchEvent(new Event("change",{bubbles:!0}))),Uo(X.row,X.toggle,ie,r("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"))}oo()},io=()=>{let q=j=>j?j.tagName==="SELECT"?j.value==="1":j.type==="checkbox"?j.checked:j.value==="1":!1,P=j=>{if(!j)return;let V=R&&R.querySelector(".aipkit_claude_web_search_enable_toggle")||j.querySelector(".aipkit_claude_web_search_enable_toggle"),Y=q(V),ce=j.querySelector(".aipkit_claude_web_search_conditional_settings");ce&&(ce.style.display=Y?"":"none");let ge=j.querySelector(".aipkit_claude_web_search_loc_type_select"),Te=j.querySelector(".aipkit_claude_web_search_location_details");Te&&(Te.style.display=Y&&ge&&ge.value==="approximate"?"":"none")},$=(j,V)=>{if(!j)return;let Y=R&&R.querySelector(".aipkit_openrouter_web_search_enable_toggle")||j.querySelector(".aipkit_openrouter_web_search_enable_toggle"),ce=V&&q(Y);!V&&Y&&q(Y)&&(Y.tagName==="SELECT"?Y.value="0":Y.type==="checkbox"?Y.checked=!1:Y.value="0",Y.dispatchEvent(new Event("change",{bubbles:!0})));let ge=j.querySelector(".aipkit_openrouter_web_search_conditional_settings");ge&&(ge.style.display=ce?"":"none")},G=t.querySelector(".aipkit_chatbot_provider_select"),Q=G?G.value:"",X=xa("web_search_plugin"),ie=Bt||O;if(ie){let j=ie.querySelector(".aipkit_web_modal_section_openai"),V=ie.querySelector(".aipkit_web_modal_section_google"),Y=ie.querySelector(".aipkit_web_modal_section_claude"),ce=ie.querySelector(".aipkit_web_modal_section_openrouter");j&&(j.style.display=Q==="OpenAI"?"":"none"),V&&(V.style.display=Q==="Google"?"":"none"),Y&&(Y.style.display=Q==="Claude"?"":"none"),ce&&(ce.style.display=Q==="OpenRouter"&&X?"":"none"),typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(ie),typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(ie),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(ie),typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(ie),P(ie),$(ie,X)}mr()},me=()=>{let q=R&&R.querySelector(".aipkit_vector_store_enable_select")||t.querySelector(".aipkit_vector_store_enable_select");return q?q.tagName==="SELECT"?q.value==="1"?"1":"0":q.checked?"1":"0":"0"},Ne=()=>{if(!R)return"0";let q=R.querySelector(".aipkit_file_upload_toggle_select");return!q||q.disabled?"0":q.tagName==="SELECT"?q.value==="1"?"1":"0":q.checked?"1":"0"},Pe=()=>Ra||Vt,Ye=()=>pr||Si,lt=()=>{let q=Pe();return q?{providerSelect:q.querySelector('[name="vector_store_provider"]'),openaiStoresSelect:q.querySelector('select[name="openai_vector_store_ids[]"]'),pineconeIndexSelect:q.querySelector('[name="pinecone_index_name"]'),qdrantCollectionsSelect:q.querySelector('select[name="qdrant_collection_names[]"]'),pineconeKeyInput:q.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:q.querySelector('[name="qdrant_url"]'),qdrantKeyInput:q.querySelector('[name="qdrant_api_key"]')}:{}},Et=q=>q?Array.from(q.options).filter(P=>!P.disabled&&P.value):[],ut=q=>q?(q.selectedOptions?Array.from(q.selectedOptions):[]).some($=>!$.disabled&&$.value):!1,Dt=q=>{if(!q)return!1;let P=q.options[q.selectedIndex];if(P&&!P.disabled&&P.value)return!0;let $=Et(q)[0];return $?(q.value=$.value,q.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},vt=q=>{if(!q)return!1;if(ut(q))return!0;let P=Et(q)[0];return P?(P.selected=!0,q.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},$t=q=>{if(!R)return;let P=R.querySelector(".aipkit_vector_store_popover_row .aipkit_popover_warning");if(P){if(!q){P.classList.remove("is-visible"),P.setAttribute("aria-hidden","true"),P.setAttribute("data-tooltip",""),P.removeAttribute("aria-label");return}P.classList.add("is-visible"),P.setAttribute("aria-hidden","false"),P.setAttribute("data-tooltip",q),P.setAttribute("aria-label",q)}},ft=()=>{if(Ne()!=="1"){$t("");return}let{providerSelect:q,openaiStoresSelect:P,pineconeIndexSelect:$,qdrantCollectionsSelect:G,pineconeKeyInput:Q,qdrantUrlInput:X,qdrantKeyInput:ie}=lt(),j=q?q.value:"",V=t.querySelector(".aipkit_chatbot_provider_select"),Y=V?V.value:"",ce=!!(Q&&Q.value.trim()),ge=!!(X&&X.value.trim()),Te=!!(ie&&ie.value.trim()),Je=ut(P),ht=ut($),It=ut(G),Ot="";j?j==="openai"?m?Je||(Ot="No OpenAI vector stores found. Create a vector store."):Ot="Add your OpenAI API key to enable OpenAI vector stores.":j==="pinecone"?ce?ht||(Ot="No Pinecone indexes found. Create an index."):Ot="Add your Pinecone API key to enable Pinecone.":j==="qdrant"?!ge&&!Te?Ot="Add your Qdrant URL and API key to enable Qdrant.":ge?Te?It||(Ot="No Qdrant collections found. Create a collection."):Ot="Add your Qdrant API key to enable Qdrant.":Ot="Add your Qdrant URL to enable Qdrant.":j==="claude_files"?Y!=="Claude"?Ot="Claude Files requires the chatbot provider to be Claude.":A||(Ot="Add your Claude API key to enable Claude Files."):Ot="Select and configure a vector provider to use file uploads.":Ot="Select and configure a vector provider to use file uploads.",$t(Ot)},Lt=()=>{let q=Pe();if(!R||!q)return;let P=R.querySelector(".aipkit_vector_store_enable_select");P&&!P.checked&&(P.checked=!0,P.dispatchEvent(new Event("change",{bubbles:!0})));let{providerSelect:$,openaiStoresSelect:G,pineconeIndexSelect:Q,qdrantCollectionsSelect:X,pineconeKeyInput:ie,qdrantUrlInput:j,qdrantKeyInput:V}=lt(),Y=!!(ie&&ie.value.trim()),ce=!!(j&&j.value.trim()),ge=!!(V&&V.value.trim()),Te="";m?Te="openai":Y?Te="pinecone":(ge||ce)&&(Te="qdrant"),$&&Te&&$.value!==Te&&($.value=Te,$.dispatchEvent(new Event("change",{bubbles:!0}))),Te==="openai"?vt(G):Te==="pinecone"?Dt(Q):Te==="qdrant"&&vt(X),ft()},fn=()=>{let q=Pe();if(!q)return!1;let P=q.querySelector('[name="vector_store_provider"]');if(!P)return!1;let $=t.querySelector(".aipkit_chatbot_provider_select"),Q=($?$.value:"")==="Claude",X=Array.from(P.options||[]).find(V=>V&&V.value==="claude_files");if(!X)return!1;let ie=!Q,j=!1;if(X.disabled!==ie&&(X.disabled=ie,j=!0),ie&&P.value==="claude_files"){let V=Array.from(P.options||[]).find(ce=>ce&&ce.value&&!ce.disabled&&ce.value!=="claude_files"),Y=V?V.value:"openai";if(P.value!==Y)return P.value=Y,P.dispatchEvent(new Event("change",{bubbles:!0})),!0}return j&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),!1},oi=()=>{if(!R)return;let q=R.querySelector(".aipkit_file_upload_toggle_select");if(!q)return;let P=q.closest(".aipkit_popover_option_row"),$=P?P.querySelector(".aipkit_popover_option_label"):null,G=q.dataset.isProPlan==="true",Q=G,X=q.dataset.tooltipDefault||"",ie=Pe(),j=ie?ie.querySelector('[name="vector_store_provider"]'):null,V=j?j.value:"",Y=t.querySelector(".aipkit_chatbot_provider_select"),ce=Y?Y.value:"";if(fn())return;G?V==="claude_files"&&ce!=="Claude"&&(X="Claude Files requires the chatbot provider to be Claude.",Q=!1):(X=q.dataset.tooltipUpgrade||X,Q=!1),P&&P.classList.toggle("aipkit_popover_option_row--disabled",!Q),q.disabled=!Q,$&&$.setAttribute("data-tooltip",X);let ge=q.tagName==="SELECT"?q.value==="1":q.checked;!Q&&ge&&(q.tagName==="SELECT"?q.value="0":q.checked=!1,q.dispatchEvent(new Event("change",{bubbles:!0}))),oo()},ai=()=>{let q=Pe();q&&(typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(q),typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(q))},nn=()=>{if(!R)return;let q=me()==="1",P=R.querySelector(".aipkit_file_upload_toggle_select");!q&&P&&!P.disabled&&(P.tagName==="SELECT"?P.value==="1":P.checked)&&(P.tagName==="SELECT"?P.value="0":P.checked=!1,P.dispatchEvent(new Event("change",{bubbles:!0}))),ai(),oi(),ft(),Ta()},Gi=()=>{let q=Ye();if(!q)return;let P=q.querySelector(".aipkit_token_limit_mode_select"),$=q.querySelector(".aipkit_limits_primary_grid"),G=q.querySelector(".aipkit_token_general_user_limit_field"),Q=q.querySelector(".aipkit_token_role_limits_container");if(!P||!G||!Q)return;let X=P.value;$&&$.classList.toggle("aipkit_limits_primary_grid--role-based",X==="role_based"),G.style.display=X==="general"?"block":"none",Q.style.display=X==="role_based"?"block":"none"},Eo=()=>{if(!Xe)return;let q=(Xe.dataset.activeAudioFeature||"").trim(),P=Xe.querySelectorAll(".aipkit_audio_feature_group");P.length&&P.forEach($=>{if(!q){$.style.display="";return}$.style.display=$.classList.contains(`aipkit_audio_feature_group--${q}`)?"":"none"})},Pn=()=>{if(!Xe)return;let q=kt=>kt?kt.tagName==="SELECT"?kt.value==="1":kt.type==="checkbox"?kt.checked:kt.value==="1":!1,P=kt=>q(t.querySelector(kt)),$=(kt,yi)=>{t.querySelectorAll(`.aipkit_audio_settings_config_btn[data-audio-feature="${kt}"]`).forEach(Xt=>{Xt.style.display=yi?"":"none"})},G=P(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch"),Q=P(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch"),X=P(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle"),ie=Xe.querySelector(".aipkit_stt_provider_conditional_row"),j=Xe.querySelector(".aipkit_stt_provider_row"),V=j&&j.dataset.sttControlsHidden==="1";if(j&&(j.style.display=G&&!V?"block":"none"),ie&&(ie.style.display=G&&!V?"flex":"none"),G&&V&&j){let kt=j.dataset.sttDefaultProvider,yi=j.dataset.sttDefaultModel,Xt=Xe.querySelector(".aipkit_stt_provider_select"),Ct=Xe.querySelector('[name="stt_openai_model_id"]'),Gt=(_t,Le,ke)=>{if(!_t||!Le)return;if(!Array.from(_t.options).some(Ce=>Ce.value===Le)){let Ce=new Option(ke||Le,Le,!0,!0);_t.add(Ce)}_t.value=Le};Gt(Xt,kt),Gt(Ct,yi,"whisper-1")}$("stt",G&&!V),typeof window.aipkit_toggleSttModelFields=="function"&&window.aipkit_toggleSttModelFields(Xe);let Y=Xe.querySelector(".aipkit_tts_conditional_settings"),ce=Xe.querySelector(".aipkit_tts_provider_row"),ge=Xe.querySelector(".aipkit_tts_auto_play_container");ce&&(ce.style.display=Q?"block":"none"),Y&&(Y.style.display=Q?"flex":"none"),ge&&(ge.style.display=Q?"block":"none");let Te=Xe.querySelector(".aipkit_tts_provider_select");if(Te){let kt=Te.value;Xe.querySelectorAll(".aipkit_tts_field").forEach(Le=>{let ke=Le.getAttribute("data-provider");Le.style.display=Q&&ke===kt?"block":"none"});let yi=Xe.querySelector(".aipkit_tts_google_voice_inline"),Xt=Xe.querySelector(".aipkit_tts_openai_voice_inline"),Ct=Xe.querySelector(".aipkit_tts_openai_model_inline"),Gt=Xe.querySelector(".aipkit_tts_elevenlabs_voice_inline"),_t=Xe.querySelector(".aipkit_tts_elevenlabs_model_inline");yi&&(yi.style.display=Q&&kt==="Google"?"block":"none"),Xt&&(Xt.style.display=Q&&kt==="OpenAI"?"block":"none"),Ct&&(Ct.style.display=Q&&kt==="OpenAI"?"block":"none"),Gt&&(Gt.style.display=Q&&kt==="ElevenLabs"?"block":"none"),_t&&(_t.style.display=Q&&kt==="ElevenLabs"?"block":"none")}else if(Q===!1){Xe.querySelectorAll(".aipkit_tts_field").forEach(_t=>{_t.style.display="none"});let kt=Xe.querySelector(".aipkit_tts_google_voice_inline");kt&&(kt.style.display="none");let yi=Xe.querySelector(".aipkit_tts_openai_voice_inline");yi&&(yi.style.display="none");let Xt=Xe.querySelector(".aipkit_tts_openai_model_inline");Xt&&(Xt.style.display="none");let Ct=Xe.querySelector(".aipkit_tts_elevenlabs_voice_inline");Ct&&(Ct.style.display="none");let Gt=Xe.querySelector(".aipkit_tts_elevenlabs_model_inline");Gt&&(Gt.style.display="none")}$("tts",Q);let Je=Xe.querySelector(".aipkit_realtime_voice_settings_container"),ht=Xe.querySelector(".aipkit_realtime_voice_inline_controls"),It=Xe.querySelector(".aipkit_realtime_voice_inline_row"),Li=Je&&Je.getAttribute("data-force-visible")==="1"?!0:X;if(Je&&(Je.style.display=Li?"block":"none"),It&&(It.style.display=Li?"block":"none"),ht&&(ht.style.display=Li?"flex":"none"),Xe.querySelectorAll(".aipkit_rt_dependent").forEach(kt=>{kt.style.display=Li?"":"none"}),$("realtime",X),Xe.classList.contains("is-open")){let kt=String(Xe.dataset.activeAudioFeature||"").trim().toLowerCase();if(kt&&!(kt==="stt"&&G||kt==="tts"&&Q||kt==="realtime"&&X)){Xe.classList.remove("is-open"),Xe.setAttribute("aria-hidden","true"),delete Xe.dataset.activeAudioFeature,Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null);let Xt=Xe.querySelector("#aipkit_builder_audio_settings_title");Xt&&Xt.dataset.defaultTitle&&(Xt.textContent=Xt.dataset.defaultTitle)}}oo(),Eo()};function Kn(){if(!N)return;let q=en&&en.classList.contains("is-open")||cn&&cn.classList.contains("is-open")||dn&&dn.classList.contains("is-open")||Zi&&Zi.classList.contains("is-open")||Nn&&Nn.classList.contains("is-open")||!!t.querySelector("[data-aipkit-interface-controls-dropdown].is-open");N.classList.toggle("aipkit_settings_accordion--allow-overflow",q)}let ya=()=>{!ao||!Ui||(ao.setAttribute("aria-expanded","false"),Ui.hidden=!0,en.classList.remove("is-open"),Kn())},Qo=()=>{!to||!ma||!cn||(to.setAttribute("aria-expanded","false"),ma.hidden=!0,cn.classList.remove("is-open"),Kn())},va=()=>{!ro||!jo||!Zi||(ro.setAttribute("aria-expanded","false"),jo.hidden=!0,Zi.classList.remove("is-open"),Kn())},ba=()=>{!Gn||!Nn||(Gn.setAttribute("aria-expanded","false"),Nn.hidden=!0,Nn.classList.remove("is-open"),Kn())},Br=()=>{if(!qi||!Fi||!Ln.length)return;let q=Ln.find($=>{let G=$.getAttribute("data-theme-value")||$.value||"",Q=$.getAttribute("data-preset-key")||"";return G==="custom"&&Q===""}),P=!!(q&&!q.disabled);qi.hidden=!P,qi.disabled=!P,qi.setAttribute("aria-disabled",P?"false":"true"),!P&&ki===qi&&Jo()},Lr=()=>{if(!Ha||!Fi)return;let q=Fi.selectedOptions&&Fi.selectedOptions.length?Fi.selectedOptions[0]:null,P=q&&q.textContent?q.textContent.trim():"",$=(Fi.value||"")==="custom"?Sn():"";Ha.textContent=$||P||cn.dataset.placeholder||"Select theme",Br()},Fr=q=>{!vo||vo.disabled||(vo.value=q||"")},$r=(q,P)=>{if((q||"")!=="custom"){Fr("");return}Fr(P||"")},Yr=()=>{if($r("custom",""),t.querySelectorAll(".aipkit_custom_theme_preset").forEach(q=>{q.classList.remove("is-selected"),q.setAttribute("aria-pressed","false")}),Fi&&!Fi.disabled&&Fi.value==="custom"){let q=Array.from(Fi.options||[]).findIndex(P=>(P.value||"")==="custom"&&!(P.dataset&&P.dataset.presetKey));q>=0&&Fi.selectedIndex!==q&&(Fi.selectedIndex=q)}if(Ln.length){let q=Ln.find(P=>{let $=P.getAttribute("data-theme-value")||P.value||"",G=P.getAttribute("data-preset-key")||"";return $==="custom"&&G===""});q&&(q.checked=!0)}Lr()},gr=()=>{if(!Fi||!Ln.length){Lr();return}let q=Fi.selectedOptions&&Fi.selectedOptions.length?Fi.selectedOptions[0]:null,P=Fi.value||"",$=q&&q.dataset&&q.dataset.presetKey?q.dataset.presetKey:"",G=!1;if(Ln.forEach(j=>{let V=j.getAttribute("data-theme-value")||j.value||"",Y=j.getAttribute("data-preset-key")||"",ce=V===P&&Y===$;j.checked=ce,ce&&(G=!0)}),!G&&P){let j=Ln.find(V=>(V.getAttribute("data-theme-value")||V.value||"")===P);j&&(j.checked=!0)}let Q=Ln.find(j=>j.checked),X=Q?Q.getAttribute("data-theme-value")||Q.value||"":P,ie=Q?Q.getAttribute("data-preset-key")||"":$;$r(X,ie),Lr()},Or=q=>{if(!q||!Fi)return;let P=q.getAttribute("data-theme-value")||q.value||"",$=q.getAttribute("data-preset-key")||"";if(!P)return;let G=-1,Q=Array.from(Fi.options||[]);if(Q.forEach((ie,j)=>{if(G!==-1||(ie.value||"")!==P)return;(ie.dataset&&ie.dataset.presetKey?ie.dataset.presetKey:"")===$&&(G=j)}),G===-1&&(G=Q.findIndex(ie=>(ie.value||"")===P)),G<0||!Q[G])return;let X=Fi.selectedIndex!==G;Fi.selectedIndex=G,X?Fi.dispatchEvent(new Event("change",{bubbles:!0})):gr()},Nr=()=>{if(!ur||!tn)return;let q=tn.selectedOptions&&tn.selectedOptions.length?tn.selectedOptions[0]:null,P=q&&q.textContent?q.textContent.trim():"";ur.textContent=P||Zi.dataset.placeholder||"Select model"},kr=()=>{if(!tn||!ga.length){Nr();return}let q=tn.value||"",P=!1;if(ga.forEach($=>{let G=$.value===q;$.checked=G,G&&(P=!0)}),!P&&q){let $=ga.find(G=>G.value===q);$&&($.checked=!0)}Nr()},Xr=q=>{if(!q||!tn)return;let P=q.value||"";if(!P)return;let G=Array.from(tn.options||[]).findIndex(X=>(X.value||"")===P);if(G<0){let X=new Option(P,P,!0,!0);tn.add(X),G=tn.options.length-1}let Q=tn.selectedIndex!==G;tn.selectedIndex=G,Q?tn.dispatchEvent(new Event("change",{bubbles:!0})):kr()},wr=()=>{if(!$o)return;let q=[],P=Ut(sn.popup_position),$=Ut(sn.popup_icon_style),G=Ut(sn.popup_icon_size);P&&q.push(P),$&&q.push($),G&&q.push(G),$o.textContent=q.length>0?q.join(" \u2022 "):en.dataset.placeholder||"Position, style, size"},hr=()=>{if(!vn.length){wr();return}vn.forEach(q=>{let P=q.getAttribute("data-target-name");!P||!sn[P]||(q.checked=sn[P].value===q.value)}),wr()},Zr=q=>{if(!q)return;let P=q.getAttribute("data-target-name");if(!P)return;let $=sn[P];if(!(!$||$.disabled)){if($.value===q.value){wr();return}$.value=q.value,$.dispatchEvent(new Event("change",{bubbles:!0})),wr()}},Qa=()=>{if(!zi)return;let q=ht=>{let It=zi.querySelector(ht);if(!It)return;let Ot=(It.getAttribute("data-default-url")||"").trim();if(!Ot)return;let Li=(It.value||"").trim(),kt=Li.toLowerCase();(!Li||(kt==="spark"||kt==="chat-bubble"||kt==="openai"||kt==="plus"||kt==="question-mark"))&&(It.value=Ot)},P=zi.querySelector('input[name="popup_icon_default"]:checked'),$=P&&P.value==="__custom__"?"custom":"default",G=zi.querySelector(".aipkit_popup_icon_custom_input_container");G&&($==="custom"?(G.removeAttribute("hidden"),q('[name="popup_icon_custom_url"]')):G.setAttribute("hidden",""));let Q=zi.querySelector('[name="popup_icon_type"]');Q&&Q.value!==$&&(Q.value=$);let X=zi.querySelector('input[name="header_avatar_default"]:checked'),ie=X&&X.value==="__custom__"?"custom":"default",j=zi.querySelector(".aipkit_header_avatar_custom_input_container");j&&(ie==="custom"?(j.removeAttribute("hidden"),q('[name="header_avatar_url"]')):j.setAttribute("hidden",""));let V=zi.querySelector('[name="header_avatar_type"]');V&&V.value!==ie&&(V.value=ie);let Y=zi.querySelector('select[name="popup_icon_style"]');if(Y){let ht=zi.querySelectorAll('input[name="popup_icon_style"]');ht.length&&ht.forEach(It=>{It.checked=It.value===Y.value})}let ce=t.querySelector(".aipkit_popup_hint_toggle_switch"),ge=ce?ce.checked:!1;t.querySelectorAll(".aipkit_popup_hint_config_btn").forEach(ht=>{ht.hidden=!ge,ge||ht.setAttribute("aria-expanded","false")}),!ge&&Oe&&Oe.classList.contains("is-open")&&yr();let Je=Oe||zi;if(Je){Je.querySelectorAll(".aipkit_popup_hint_extra").forEach(It=>{ge?It.removeAttribute("hidden"):It.setAttribute("hidden","")});let ht=Je.querySelector(".aipkit_popup_hint_conditional_row");ht&&(ge?ht.removeAttribute("hidden"):ht.setAttribute("hidden",""))}hr()},yr=()=>{Oe&&(Oe.classList.remove("is-open"),Oe.setAttribute("aria-hidden","true"),je&&(je.setAttribute("aria-expanded","false"),je=null))},Rr=()=>{Ge&&(Ge.classList.remove("is-open"),Ge.setAttribute("aria-hidden","true"),ni&&(ni.setAttribute("aria-expanded","false"),ni=null))},Dr=()=>{let q=Rt||Ge;if(!q)return;let P=q.querySelector('[name="enable_consent_compliance"]'),$=P?P.tagName==="SELECT"?P.value==="1":P.checked:!1;q.querySelectorAll(".aipkit_consent_field_row").forEach(G=>{$?G.removeAttribute("hidden"):G.setAttribute("hidden","")}),F&&F.classList.contains("aipkit-active")&&Ee&&requestAnimationFrame(()=>{bo(Ee)})},Wr=()=>{let q=Rt||Ge;if(!q)return;let P=q.querySelector('[name="openai_moderation_enabled"]'),$=P?P.tagName==="SELECT"?P.value==="1":P.checked:!1;q.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(G=>{$?G.removeAttribute("hidden"):G.setAttribute("hidden","")}),F&&F.classList.contains("aipkit-active")&&Ee&&requestAnimationFrame(()=>{bo(Ee)})},Ir=()=>{let q=Rt||Ge;if(!q)return;let P=t.querySelector(".aipkit_chatbot_provider_select"),G=(P?P.value:"")==="OpenAI";if(q.querySelectorAll(".aipkit_openai_moderation_row").forEach(X=>{X.style.display=G?"":"none"}),G){Wr();return}q.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(X=>{X.setAttribute("hidden","")})},Tr=()=>{yt&&(yt.classList.remove("is-open"),yt.setAttribute("aria-hidden","true"),Ai&&(Ai.setAttribute("aria-expanded","false"),Ai=null))},Jo=()=>{Mt&&(Mt.classList.remove("is-open"),Mt.setAttribute("aria-hidden","true"),ki&&(ki.setAttribute("aria-expanded","false"),ki=null))},Hr=q=>{if(!Mt||!q)return;Mt.classList.contains("is-open")||(Mt.classList.add("is-open"),Mt.setAttribute("aria-hidden","false")),ki&&ki!==q&&ki.setAttribute("aria-expanded","false"),q.setAttribute&&q.setAttribute("aria-expanded","true"),ki=q,window.requestAnimationFrame(()=>{za(q)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_custom_theme_flyout")},Ja=q=>{if(!q)return;let P=q.querySelector(".aipkit_reasoning_effort_slider"),$=q.querySelector(".aipkit_reasoning_effort_label"),G=q.querySelector('input[name="reasoning_effort"]');if(!P||!$||!G)return;let Q=()=>{let X=[],ie=[];try{P.dataset.reasoningValues&&(X=JSON.parse(P.dataset.reasoningValues)),P.dataset.reasoningLabels&&(ie=JSON.parse(P.dataset.reasoningLabels))}catch{X=[],ie=[]}(!Array.isArray(X)||X.length===0)&&(X=["none","low","medium","high","xhigh"]),(!Array.isArray(ie)||ie.length===0)&&(ie=X.slice());let j=parseInt(P.value,10),V=Number.isNaN(j)?0:Math.min(X.length-1,Math.max(0,j)),Y=X[V]||X[0],ce=ie[V]||Y;G.value=Y,$.textContent=ce};Q(),P.dataset.reasoningBound||(P.addEventListener("input",Q),P.addEventListener("change",Q),P.dataset.reasoningBound="1")},Yo=()=>{if(!R)return;let q=()=>{let Je=R.querySelector(".aipkit_behavior_compact_row");if(!Je)return;if(window.innerWidth<=960){Je.style.gridTemplateColumns="";return}let ht=Array.from(Je.querySelectorAll(".aipkit_behavior_compact_cell")).filter(Ot=>!Ot||Ot.hidden?!1:window.getComputedStyle(Ot).display!=="none"),It=Math.max(1,ht.length);Je.style.gridTemplateColumns=`repeat(${It}, minmax(0, 1fr))`},P=t.querySelector(".aipkit_chatbot_provider_select"),$=P?P.value:"",G=$==="OpenAI",Q=Jt(),X=xa("image_input"),ie=$==="OpenAI"||$==="Claude"||$==="OpenRouter"&&X,j=R.querySelector(".aipkit_stateful_convo_checkbox"),V=R.querySelector(".aipkit_stateful_convo_group");j&&(j.disabled=!G),V&&(V.style.display=G?"":"none",V.removeAttribute("title"));let Y=R&&R.querySelector(".aipkit_reasoning_effort_field")||ue&&ue.querySelector(".aipkit_reasoning_effort_field");Y&&(Y.style.display=Q?"":"none"),Fe();let ce=R&&R.querySelector(".aipkit_image_analysis_popover_row")||z&&z.querySelector(".aipkit_image_analysis_popover_row");if(ce&&(ce.style.display=ie?"":"none"),$==="OpenRouter"&&!X){let Je=z&&z.querySelector(".aipkit_image_analysis_select")||R&&R.querySelector(".aipkit_image_analysis_select")||O.querySelector(".aipkit_image_analysis_select"),ht=z&&z.querySelector(".aipkit_image_analysis_checkbox")||R&&R.querySelector(".aipkit_image_analysis_checkbox")||O.querySelector(".aipkit_image_analysis_checkbox");Je&&Je.value!=="0"?(Je.value="0",Je.dispatchEvent(new Event("change",{bubbles:!0}))):ht&&ht.checked&&(ht.checked=!1,ht.dispatchEvent(new Event("change",{bubbles:!0})))}oo(),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(ue||R),q(),window.requestAnimationFrame(q);let ge=R.querySelector(".aipkit_model_settings_panel:not([hidden])"),Te=ge?ge.querySelector(".aipkit_popover_options_list"):R.querySelector(".aipkit_popover_options_list");if(Te){let Je=Te.querySelectorAll(".aipkit_popover_option_row");Je.forEach(It=>It.classList.remove("aipkit_last_visible_row"));let ht=null;Je.forEach(It=>{It.style.display!=="none"&&(ht=It)}),ht&&ht.classList.add("aipkit_last_visible_row")}F&&F.classList.contains("aipkit-active")&&Ee&&bo(Ee),t.dataset.behaviorCompactLayoutBound||(window.addEventListener("resize",q),t.dataset.behaviorCompactLayoutBound="1")};if(t.dataset.shortcodeCopyBound||(t.addEventListener("click",q=>{let P=q.target.closest(".aipkit_shortcode_pill");if(!P)return;let $=P.dataset.shortcode||P.querySelector(".aipkit_shortcode_text")?.textContent||"";$&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode($,P)}),t.dataset.shortcodeCopyBound="1"),t.dataset.embedCopyBound||(t.addEventListener("click",q=>{let P=q.target.closest(".aipkit_copy_embed_code_btn");if(!P)return;let $=P.dataset.target;if(!$)return;let G=document.getElementById($);if(!G)return;let Q=G.value||G.textContent||"";Q&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(Q,P)}),t.dataset.embedCopyBound="1"),N&&!t.dataset.accordionBound){let q=Array.from(N.querySelectorAll(".aipkit_accordion_section")),P=Q=>{if(!Q)return;let X=Q.querySelector(".aipkit_accordion_header"),ie=Q.querySelector(".aipkit_accordion_body");!X||!ie||(X.setAttribute("aria-expanded","false"),ie.hidden=!0)},$=(Q,X)=>{if(!Q)return;let ie=Q.querySelector(".aipkit_accordion_header"),j=Q.querySelector(".aipkit_accordion_body");if(!(!ie||!j)&&(ie.setAttribute("aria-expanded","true"),j.hidden=!1,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),X==="rules"&&typeof window.aipkit_initTriggerBuilderUI=="function")){let V=S&&S.value||t.getAttribute("data-active-bot-id");V&&V!=="__new__"&&window.aipkit_initTriggerBuilderUI(V)}};q.forEach(Q=>{let X=Q.querySelector(".aipkit_accordion_header"),ie=Q.querySelector(".aipkit_accordion_body");if(!X||!ie)return;let j=Q.getAttribute("data-aipkit-accordion")||"";X.setAttribute("aria-expanded","false"),ie.hidden=!0,!(j==="rules"&&X.classList.contains("aipkit_builder_sheet_trigger"))&&X.addEventListener("click",()=>{if(X.getAttribute("aria-expanded")==="true"){P(Q),s("");return}q.forEach(Y=>{Y!==Q&&P(Y)}),$(Q,j),s(j)})});let G=a();if(G&&G!=="rules"){let Q=q.find(X=>(X.getAttribute("data-aipkit-accordion")||"")===G);Q&&!Q.hidden?$(Q,G):s("")}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),Ja(N),io(),Yo(),nn(),t.dataset.accordionBound="1"}if(F&&!H&&t.querySelectorAll(".aipkit_cb_ai_settings_toggle").forEach(P=>{P.classList.add("aipkit_model_settings_popover_trigger"),P.setAttribute("aria-haspopup","dialog"),P.setAttribute("aria-expanded","false"),P.setAttribute("aria-controls","aipkit_model_settings_popover"),P.setAttribute("aria-label",Ga),P.setAttribute("title",Ga)}),M&&S&&!t.dataset.botTabsBound&&(M.addEventListener("click",q=>{let P=q.target.closest(".aipkit_builder_bot_tab");if(!P)return;gi();let $=String(P.dataset.botId||"");if(!$||$===String(S.value||"")){Hi(S.value||"");return}S.value=$,S.dispatchEvent(new Event("change",{bubbles:!0}))}),D&&W&&(D.addEventListener("click",q=>{if(q.preventDefault(),D.hidden)return;if(D.getAttribute("aria-expanded")==="true"){gi();return}ji(),W.hidden=!1,D.setAttribute("aria-expanded","true");let $=W.querySelector(".aipkit_builder_bot_overflow_search_input");$&&typeof $.focus=="function"&&window.requestAnimationFrame(()=>{$.focus(),typeof $.select=="function"&&$.select()})}),W.addEventListener("click",q=>{let P=q.target.closest(".aipkit_builder_bot_overflow_item");if(!P)return;let $=String(P.dataset.botId||"");if(!$){gi();return}$!==String(S.value||"")?(S.value=$,S.dispatchEvent(new Event("change",{bubbles:!0}))):Hi($),gi()}),W.addEventListener("input",q=>{let P=q.target.closest(".aipkit_builder_bot_overflow_search_input");P&&ii(P.value||"")}),document.addEventListener("click",q=>{!W||W.hidden||!B||q.target.closest(".aipkit_builder_bot_overflow")||gi()}),document.addEventListener("keydown",q=>{q.key==="Escape"&&gi()})),typeof ResizeObserver=="function"?(oe=new ResizeObserver(()=>{ui()}),oe.observe(M)):window.addEventListener("resize",ui),t.dataset.botTabsBound="1"),S){let q=S.value||"";Hi(q),S.addEventListener("change",async()=>{let P=S.value;if(!P){Hi(q);return}if(P==="__new__"){typeof J=="function"&&J();let G=q||t.getAttribute("data-active-bot-id")||"";if(G)S.value=G;else{let Q=Array.from(S.options).find(X=>X.value&&X.value!=="__new__"&&!X.disabled);Q&&(S.value=Q.value,q=Q.value)}Hi(S.value||q);return}q=P,Hi(P);try{localStorage.setItem(k,P)}catch(G){console.warn("AIPKit Chat Builder: Failed to store selected chatbot:",G)}let $=!1;try{$=await Mn(P)}catch{$=!1}!$&&typeof window.aipkit_loadModule=="function"&&(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),window.aipkit_loadModule("chatbot",{force_active_bot_id:P,layout:_,aipkit_silent:!0,aipkit_force_refresh:!0}))}),Vo()}if((C||S)&&!t.dataset.newBotActionBound){let q=!1;J=()=>{if(q||typeof window.aipkit_apiRequest!="function")return;let P=r("New Chatbot","gpt3-ai-content-generator");q=!0,C&&(C.disabled=!0),dt(r("Creating chatbot...","gpt3-ai-content-generator"),""),window.aipkit_apiRequest("aipkit_create_chatbot",{bot_name:P}).then($=>{let G=$&&$.bot_id?String($.bot_id):"";if(!G)throw new Error(r("Chatbot created but no bot ID was returned.","gpt3-ai-content-generator"));try{localStorage.setItem(k,G)}catch{}dt($.message||r("Chatbot created successfully.","gpt3-ai-content-generator"),"success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:G,layout:_,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(G),Oi()}).catch($=>{dt(`Error: ${$.message||r("Failed to create chatbot.","gpt3-ai-content-generator")}`,"error"),Oi()}).finally(()=>{q=!1,C&&(C.disabled=!1)})},C&&C.addEventListener("click",J),t.dataset.newBotActionBound="1"}if(O&&!t.dataset.sheetBound){let q=$=>{if(!O)return;F&&F.classList.contains("aipkit-active")&&So();let G=$.dataset.sheetTitle||"Sheet",Q=$.dataset.sheetDescription||"Settings will appear here.",X=$.dataset.sheetContent||"placeholder";if(pe&&(pe.textContent=G),we&&(we.textContent=Q),ae.length){let ie=!1;ae.forEach(j=>{let V=j.dataset.sheet===X;j.hidden=!V,V&&(ie=!0)}),!ie&&ne&&(ne.hidden=!1)}if(Wn&&(Wn.textContent="",Wn.classList.remove("success","error","loading"),Wn.style.display="none"),O.classList.add("aipkit-active"),O.setAttribute("aria-hidden","false"),ye&&ye.focus(),X==="sources"&&typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(),X==="triggers"&&typeof window.aipkit_initTriggerBuilderUI=="function"){let ie=S&&S.value||t.getAttribute("data-active-bot-id");ie&&ie!=="__new__"&&window.aipkit_initTriggerBuilderUI(ie)}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_sheet"),io(),Pn(),Yo(),Qa()},P=()=>{O.classList.remove("aipkit-active"),O.setAttribute("aria-hidden","true")};t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_builder_sheet_trigger");G&&($.preventDefault(),G.closest('[data-aipkit-accordion="rules"]')&&s(""),q(G))}),ye&&ye.addEventListener("click",P),O.addEventListener("click",$=>{$.target===O&&P()}),document.addEventListener("keydown",$=>{$.key==="Escape"&&O.classList.contains("aipkit-active")&&P()}),t.dataset.sheetBound="1"}if(R&&!t.dataset.modelPopoverBound){F&&(t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_model_settings_popover_trigger");if(G){if($.preventDefault(),$.stopPropagation(),F.classList.contains("aipkit-active")&&Ee===G){So();return}fr(G)}}),t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_style_settings_trigger");if(!G)return;$.preventDefault(),$.stopPropagation();let Q=G.dataset.aipkitPanelTarget||"appearance";ka(Q)})),t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_popover_params_config_btn");if(!G||($.preventDefault(),!ue))return;let Q=!ue.classList.contains("is-open");ue.classList.toggle("is-open",Q),ue.setAttribute("aria-hidden",Q?"false":"true"),He&&He!==G&&He.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",Q?"true":"false"),He=Q?G:null,Q&&(window.requestAnimationFrame(()=>{_r(G)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_parameters_flyout"),Ja(ue),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(ue))}),t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_image_settings_config_btn");if(!G||($.preventDefault(),!z))return;let Q=!z.classList.contains("is-open");z.classList.toggle("is-open",Q),z.setAttribute("aria-hidden",Q?"false":"true"),fe&&fe!==G&&fe.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",Q?"true":"false"),fe=Q?G:null,Q&&(window.requestAnimationFrame(()=>{so(G)}),Ua())}),t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_popup_hint_config_btn");if(!G||($.preventDefault(),!Oe))return;let Q=!Oe.classList.contains("is-open");Oe.classList.toggle("is-open",Q),Oe.setAttribute("aria-hidden",Q?"false":"true"),je&&je!==G&&je.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",Q?"true":"false"),je=Q?G:null,Q&&window.requestAnimationFrame(()=>{zo(G)})}),t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_starters_config_btn");if(!G||($.preventDefault(),!yt))return;let Q=!yt.classList.contains("is-open");yt.classList.toggle("is-open",Q),yt.setAttribute("aria-hidden",Q?"false":"true"),Ai&&Ai!==G&&Ai.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",Q?"true":"false"),Ai=Q?G:null,Q&&window.requestAnimationFrame(()=>{Ka(G)})}),t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_security_privacy_config_btn");if(!G||($.preventDefault(),!Ge))return;let Q=!Ge.classList.contains("is-open");Ge.classList.toggle("is-open",Q),Ge.setAttribute("aria-hidden",Q?"false":"true"),ni&&ni!==G&&ni.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",Q?"true":"false"),ni=Q?G:null,Q&&(window.requestAnimationFrame(()=>{ja(G)}),Dr(),Ir())});let q=()=>{z&&(z.classList.remove("is-open"),z.setAttribute("aria-hidden","true"),fe&&(fe.setAttribute("aria-expanded","false"),fe=null))};te&&te.addEventListener("click",$=>{$.preventDefault(),q()}),Qe&&Qe.addEventListener("click",$=>{$.preventDefault(),yr()}),gt&&gt.addEventListener("click",$=>{$.preventDefault(),Rr()}),Xi&&Xi.addEventListener("click",$=>{$.preventDefault(),Tr()}),_i&&_i.addEventListener("click",$=>{$.preventDefault(),Jo()}),document.addEventListener("click",$=>{!z||!z.classList.contains("is-open")||$.target.closest(".aipkit_image_settings_config_btn")||$.target.closest("#aipkit_image_settings_flyout")||q()}),document.addEventListener("click",$=>{!Oe||!Oe.classList.contains("is-open")||$.target.closest(".aipkit_popup_hint_config_btn")||$.target.closest("#aipkit_popup_hint_flyout")||yr()}),document.addEventListener("click",$=>{!Ge||!Ge.classList.contains("is-open")||$.target.closest(".aipkit_security_privacy_config_btn")||$.target.closest("#aipkit_security_privacy_flyout")||Rr()}),document.addEventListener("click",$=>{!yt||!yt.classList.contains("is-open")||$.target.closest(".aipkit_starters_config_btn")||$.target.closest("#aipkit_starters_flyout")||Tr()}),document.addEventListener("click",$=>{!Mt||!Mt.classList.contains("is-open")||$.target.closest(".aipkit_theme_config_btn")||$.target.closest("[data-aipkit-theme-dropdown]")||$.target.closest('select[name="theme"]')||$.target.closest(".aipkit_builder_theme_select")||$.target.closest(".aipkit_theme_choice_group")||$.target.closest("#aipkit_custom_theme_flyout")||Jo()});let P=()=>{ue&&(ue.classList.remove("is-open"),ue.setAttribute("aria-hidden","true"),He&&(He.setAttribute("aria-expanded","false"),He=null))};if(Ae&&Ae.addEventListener("click",$=>{$.preventDefault(),P()}),document.addEventListener("click",$=>{!ue||!ue.classList.contains("is-open")||$.target.closest(".aipkit_popover_params_config_btn")||$.target.closest("#aipkit_parameters_flyout")||P()}),K&&K.addEventListener("click",So),ve&&ve.addEventListener("click",()=>{ka("root")}),F&&F.addEventListener("click",$=>{$.target===F&&So()}),document.addEventListener("keydown",$=>{$.key==="Escape"&&F&&F.classList.contains("aipkit-active")&&So()}),R&&!R.dataset.footerActionsBound){let $=t.getAttribute("data-default-bot-id")||"",G=!1,Q=j=>{R.querySelectorAll(".aipkit_popover_footer_btn").forEach(Y=>{Y.disabled=!!j})},X=()=>{let j=Array.from(S&&S.options||[]).map(Y=>String(Y&&Y.value||"").trim()).filter(Y=>Y&&Y!=="__new__"),V=[S?String(S.value||"").trim():"",String(t.getAttribute("data-active-bot-id")||"").trim(),String((t.querySelector("form.aipkit_chatbot_settings_form")||{}).dataset?.botId||"").trim(),String((t.querySelector(".aipkit_builder_bot_tab.is-active[data-bot-id]")||{}).dataset?.botId||"").trim()];for(let Y of V)if(!(!Y||Y==="__new__")&&/^\d+$/.test(Y)&&(!j.length||j.includes(Y)))return Y;return j[0]||""},ie=j=>{let V=String(j||""),Y=Array.from(S&&S.options||[]).map(ge=>String(ge&&ge.value||"")).filter(ge=>ge&&ge!=="__new__");if(!Y.length)return"";let ce=Y.indexOf(V);if(ce===-1)return $&&String($)!==V?String($):Y[0]||"";for(let ge=ce-1;ge>=0;ge-=1){let Te=Y[ge];if(Te&&Te!==V)return Te}for(let ge=ce+1;ge<Y.length;ge+=1){let Te=Y[ge];if(Te&&Te!==V)return Te}return $&&String($)!==V?String($):""};R.addEventListener("click",j=>{let V=j.target.closest(".aipkit_popover_footer_btn");if(!V||(j.preventDefault(),G))return;let Y=V.getAttribute("data-action"),ce=X();if(!Y||!ce||typeof window.aipkit_apiRequest!="function"){Y&&typeof window.aipkit_apiRequest=="function"&&(dt(r("Error: Invalid chatbot selected.","gpt3-ai-content-generator"),"error"),Oi());return}if(Y==="delete"){if(V.disabled||ce===$)return;let ge=ie(ce);G=!0,Q(!0),dt("Deleting...",""),window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:ce}).then(Te=>{dt(Te.message||"Deleted","success");try{ge?localStorage.setItem(k,ge):localStorage.removeItem(k)}catch{}if(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"){let Je=String(ge||$||""),ht={layout:_,aipkit_silent:!0,aipkit_force_refresh:!0};Je&&Je!==String(ce)?ht.force_active_bot_id=Je:ht.force_active_tab="create",window.aipkit_loadModule("chatbot",ht)}else if(typeof window.aipkit_refreshChatPreview=="function"){let Je=String(ge||$||"");window.aipkit_refreshChatPreview(Je||ce)}Oi()}).catch(Te=>{dt(`Error: ${Te.message||"Failed to delete."}`,"error"),Oi()}).finally(()=>{G=!1,Q(!1)});return}if(Y==="duplicate"){G=!0,Q(!0),dt("Duplicating...",""),window.aipkit_apiRequest("aipkit_duplicate_chatbot",{bot_id:ce}).then(ge=>{let Te=String(ge&&ge.bot_id||"");if(dt(ge.message||"Duplicated","success"),Te)try{localStorage.setItem(k,Te)}catch{}typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:Te||ce,layout:_,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Te||ce),Oi()}).catch(ge=>{dt(`Error: ${ge.message||"Failed to duplicate."}`,"error"),Oi()}).finally(()=>{G=!1,Q(!1)});return}Y==="reset"&&(G=!0,Q(!0),dt("Resetting...",""),window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:ce}).then(ge=>{dt(ge.message||"Saved","success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:ce,layout:_,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ce),Oi()}).catch(ge=>{dt(`Error: ${ge.message||"Failed to reset."}`,"error"),Oi()}).finally(()=>{G=!1,Q(!1)}))}),R.dataset.footerActionsBound="1"}window.addEventListener("resize",()=>{F&&F.classList.contains("aipkit-active")&&Ee&&bo(Ee),Bt&&Bt.classList.contains("is-open")&&Ti&&No(Ti),Vt&&Vt.classList.contains("is-open")&&un&&Ro(un),Si&&Si.classList.contains("is-open")&&_n&&wa(_n),Xe&&Xe.classList.contains("is-open")&&Vi&&ha(Vi),z&&z.classList.contains("is-open")&&fe&&so(fe),Oe&&Oe.classList.contains("is-open")&&je&&zo(je),Ge&&Ge.classList.contains("is-open")&&ni&&ja(ni),yt&&yt.classList.contains("is-open")&&Ai&&Ka(Ai),Mt&&Mt.classList.contains("is-open")&&ki&&za(ki)}),window.addEventListener("scroll",()=>{F&&F.classList.contains("aipkit-active")&&Ee&&bo(Ee),Bt&&Bt.classList.contains("is-open")&&Ti&&No(Ti),Vt&&Vt.classList.contains("is-open")&&un&&Ro(un),Si&&Si.classList.contains("is-open")&&_n&&wa(_n),Xe&&Xe.classList.contains("is-open")&&Vi&&ha(Vi),z&&z.classList.contains("is-open")&&fe&&so(fe),Oe&&Oe.classList.contains("is-open")&&je&&zo(je),Ge&&Ge.classList.contains("is-open")&&ni&&ja(ni),yt&&yt.classList.contains("is-open")&&Ai&&Ka(Ai),Mt&&Mt.classList.contains("is-open")&&ki&&za(ki)},!0),t.dataset.modelPopoverBound="1"}if(Pt&&$i&&!Pt.dataset.autosaveBound){let q=Pt.value,P=!1,$=null,G=V=>{at&&(at.textContent=`${V.length.toLocaleString()} characters`)},Q=V=>{wt&&(wt.value=V,G(V))},X=V=>{let Y=S&&S.value||t.getAttribute("data-active-bot-id");Y&&(P=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_instructions",{bot_id:Y,instructions:V}).then(ce=>{q=V,Pt.dataset.dirty="0",dt(ce.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Y),Oi()}).catch(ce=>{dt(`Error: ${ce.message||"Failed to save."}`,"error"),Pt.dataset.dirty="1"}).finally(()=>{if(P=!1,$!==null&&$!==q){let ce=$;$=null,X(ce)}else $=null}))},ie=()=>{!Qt||!wt||(Q(Pt.value),Qt.classList.add("aipkit-active"),Qt.setAttribute("aria-hidden","false"),setTimeout(()=>wt.focus(),0))},j=V=>{if(!Qt||(Qt.classList.remove("aipkit-active"),Qt.setAttribute("aria-hidden","true"),!V||!wt))return;let Y=wt.value;if(Y!==Pt.value&&(Pt.value=Y,Pt.dataset.dirty="1"),Pt.dataset.dirty==="1"){if(P){$=Pt.value;return}X(Pt.value)}};wt&&!wt.dataset.bound&&(wt.addEventListener("input",()=>{G(wt.value),Pt.dataset.dirty="1"}),wt.dataset.bound="1"),Qt&&!Qt.dataset.bound&&(Mi&&Mi.addEventListener("click",ie),ti&&ti.addEventListener("click",()=>{j(!0)}),document.addEventListener("keydown",V=>{V.key==="Escape"&&Qt.classList.contains("aipkit-active")&&j(!0)}),Qt.dataset.bound="1"),Pt.addEventListener("input",()=>{Pt.dataset.dirty="1"}),Pt.addEventListener("blur",()=>{let V=Pt.value;if(Pt.dataset.dirty==="1"){if(V===q){Pt.dataset.dirty="0";return}if(P){$=V;return}X(V)}}),Pt.dataset.autosaveBound="1"}if(Go){let q=Go.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]"),P=G=>{G&&(q.forEach(Q=>{let X=Q.dataset.aipkitTab===G;Q.classList.toggle("is-active",X),Q.setAttribute("aria-selected",X?"true":"false")}),na.forEach(Q=>{let X=Q.dataset.aipkitPanel===G;Q.classList.toggle("is-active",X),Q.hidden=!X}),Rn&&(Rn.style.display=G==="files"?"none":""),Aa&&Aa.classList.toggle("aipkit_builder_action_row--end",G==="files"))},$=Go.querySelector(".aipkit_builder_tab.is-active");$&&P($.dataset.aipkitTab),q.forEach(G=>{G.addEventListener("click",()=>{P(G.dataset.aipkitTab)})})}let co=t.querySelector('textarea[name="triggers_json"]'),Ya=t.querySelector(".aipkit_trigger_builder_container"),Wn=t.querySelector(".aipkit_triggers_status");if((co||Ya)&&$i&&!t.dataset.triggersAutosaveBound){let q=co?co.value:"[]",P=!1,$=null,G=null,Q=()=>{let ge=S&&S.value||t.getAttribute("data-active-bot-id");if(!ge)return null;let Te="";if(typeof window.aipkit_getTriggerBuilderState=="function"){let Je=window.aipkit_getTriggerBuilderState(ge);Je&&Array.isArray(Je.triggers)&&(typeof window.aipkit_updateTriggersJsonForSave=="function"&&window.aipkit_updateTriggersJsonForSave(ge,Je.triggers),Te=co?co.value:JSON.stringify(Je.triggers,null,2))}return!Te&&co&&(Te=co.value),Te||(Te="[]"),{botId:ge,triggersJson:Te}},X=(ge,Te)=>{Wn&&(Wn.textContent=ge||"",Wn.classList.remove("success","error","loading"),Te&&Wn.classList.add(Te),Wn.style.display=ge?"inline-block":"none")},ie=()=>{Wn&&setTimeout(()=>{Wn.textContent="",Wn.classList.remove("success","error","loading"),Wn.style.display="none"},2500)},j=(ge,Te)=>{Te&&(P=!0,dt("Auto-saving...",""),X("Saving...","loading"),window.aipkit_apiRequest("aipkit_update_chatbot_triggers",{bot_id:Te,triggers_json:ge}).then(Je=>{q=ge,dt(Je.message||"Saved","success"),X("Saved","success"),Oi(),ie()}).catch(Je=>{dt(`Error: ${Je.message||"Failed to save."}`,"error"),X("Error","error"),ie()}).finally(()=>{if(P=!1,$!==null&&$!==q){let Je=$;$=null;let ht=Q();ht&&j(Je,ht.botId)}else $=null}))},V=ge=>{if(ge===q)return;if(P){$=ge;return}let Te=Q();Te&&j(ge,Te.botId)},Y=()=>{G&&clearTimeout(G),G=setTimeout(()=>{let ge=Q();ge&&V(ge.triggersJson)},900)};typeof window.aipkit_requestTriggerAutosave!="function"&&(window.aipkit_requestTriggerAutosave=Y);let ce=ge=>{ge.target&&ge.target.closest(".aipkit_trigger_builder_container")&&Y()};Ya&&(Ya.addEventListener("input",ce),Ya.addEventListener("change",ce),Ya.addEventListener("click",ce)),co&&(co.addEventListener("input",Y),co.addEventListener("blur",Y)),t.dataset.triggersAutosaveBound="1"}if(Bt&&!Bt.dataset.bound){let q=Bt.querySelector("#aipkit_builder_web_settings_title"),P=q?q.textContent.trim():r("Web search","gpt3-ai-content-generator"),$={openai:r("Web options (OpenAI)","gpt3-ai-content-generator"),google:r("Web options (Google)","gpt3-ai-content-generator"),claude:r("Web options (Claude)","gpt3-ai-content-generator"),openrouter:r("Web options (OpenRouter)","gpt3-ai-content-generator")},G=(ie="")=>{if(!q)return;let j=String(ie||"").trim().toLowerCase();q.textContent=$[j]||P},Q=ie=>{if(!Bt||!ie)return;let j=String(ie.dataset.webProvider||"").trim().toLowerCase();Bt.dataset.activeWebProvider=j,G(j),Bt.classList.add("is-open"),Bt.setAttribute("aria-hidden","false"),ie.setAttribute("aria-expanded","true"),Ti=ie,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_web_settings_modal"),io(),window.requestAnimationFrame(()=>{No(ie)})},X=()=>{Bt.classList.remove("is-open"),Bt.setAttribute("aria-hidden","true"),delete Bt.dataset.activeWebProvider,G(""),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null)};t.addEventListener("click",ie=>{let j=ie.target.closest(".aipkit_web_search_config_btn");if(j){if(ie.preventDefault(),Bt.classList.contains("is-open")&&Ti===j){X();return}Q(j)}}),qn&&qn.addEventListener("click",X),document.addEventListener("click",ie=>{Bt.classList.contains("is-open")&&(ie.target.closest(".aipkit_web_search_config_btn")||ie.target.closest("#aipkit_builder_web_settings_modal")||X())}),document.addEventListener("keydown",ie=>{ie.key==="Escape"&&Bt.classList.contains("is-open")&&X()}),Bt.dataset.bound="1"}if(Vt&&!Vt.dataset.bound){let q=$=>{!Vt||!$||(Vt.classList.add("is-open"),Vt.setAttribute("aria-hidden","false"),$.setAttribute("aria-expanded","true"),un=$,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_context_settings_modal"),ai(),window.requestAnimationFrame(()=>{Ro($)}))},P=()=>{Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true"),un&&(un.setAttribute("aria-expanded","false"),un=null)};t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_vector_store_config_btn");if(G){if($.preventDefault(),Vt.classList.contains("is-open")&&un===G){P();return}q(G)}}),Na&&Na.addEventListener("click",P),document.addEventListener("click",$=>{Vt.classList.contains("is-open")&&($.target.closest(".aipkit_vector_store_config_btn")||$.target.closest("#aipkit_builder_context_settings_modal")||P())}),document.addEventListener("keydown",$=>{$.key==="Escape"&&Vt.classList.contains("is-open")&&P()}),Vt.dataset.bound="1"}if(Si&&!Si.dataset.bound){let q=$=>{!Si||!$||(Si.classList.add("is-open"),Si.setAttribute("aria-hidden","false"),$.setAttribute("aria-expanded","true"),_n=$,Gi(),window.requestAnimationFrame(()=>{wa($)}))},P=()=>{Si.classList.remove("is-open"),Si.setAttribute("aria-hidden","true"),_n&&(_n.setAttribute("aria-expanded","false"),_n=null)};t.addEventListener("click",$=>{let G=$.target.closest(".aipkit_limit_usage_config_btn");if(G){if($.preventDefault(),Si.classList.contains("is-open")&&_n===G){P();return}q(G)}}),Da&&Da.addEventListener("click",P),document.addEventListener("click",$=>{Si.classList.contains("is-open")&&($.target.closest(".aipkit_limit_usage_config_btn")||$.target.closest("#aipkit_builder_token_limits_modal")||P())}),document.addEventListener("keydown",$=>{$.key==="Escape"&&Si.classList.contains("is-open")&&P()}),Si.dataset.bound="1"}if(Xe&&!Xe.dataset.bound){let q=Xe.querySelector("#aipkit_builder_audio_settings_title"),P=q?q.textContent.trim():r("Audio","gpt3-ai-content-generator");q&&!q.dataset.defaultTitle&&(q.dataset.defaultTitle=P);let $={stt:r("Speech to Text options","gpt3-ai-content-generator"),tts:r("Text to Speech options","gpt3-ai-content-generator"),realtime:r("Realtime voice options","gpt3-ai-content-generator")},G=(ie="")=>{if(!q)return;let j=String(ie||"").trim().toLowerCase();q.textContent=$[j]||P},Q=ie=>{if(!Xe||!ie)return;let j=String(ie.dataset.audioFeature||"").trim().toLowerCase();Xe.dataset.activeAudioFeature=j,G(j),Xe.classList.add("is-open"),Xe.setAttribute("aria-hidden","false"),ie.setAttribute("aria-expanded","true"),Vi=ie,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_audio_settings_modal"),Pn(),typeof window.aipkit_syncAudioTtsOnOpen=="function"&&window.aipkit_syncAudioTtsOnOpen().catch(()=>{}),window.requestAnimationFrame(()=>{ha(ie)})},X=()=>{Xe.classList.remove("is-open"),Xe.setAttribute("aria-hidden","true"),delete Xe.dataset.activeAudioFeature,G(""),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null)};t.addEventListener("click",ie=>{let j=ie.target.closest(".aipkit_audio_settings_config_btn");if(j){if(ie.preventDefault(),Xe.classList.contains("is-open")&&Vi===j){X();return}Q(j)}}),Wa&&Wa.addEventListener("click",X),document.addEventListener("click",ie=>{Xe.classList.contains("is-open")&&(ie.target.closest(".aipkit_audio_settings_config_btn")||ie.target.closest("#aipkit_builder_audio_settings_modal")||X())}),document.addEventListener("keydown",ie=>{ie.key==="Escape"&&Xe.classList.contains("is-open")&&X()}),Xe.dataset.bound="1"}if(Me&&$i&&!Me.dataset.autosaveBound){let q=Me.value.trim(),P=!1,$=null,G=X=>{if(!S)return;let ie=S.options[S.selectedIndex];ie&&(ie.text=X),Hi(S.value||"")},Q=X=>{let ie=S&&S.value||t.getAttribute("data-active-bot-id");ie&&(P=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:ie,new_name:X}).then(j=>{let V=(j.new_name||X).trim();q=V,Me.value=V,G(V),dt("Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ie),Oi()}).catch(j=>{dt(`Error: ${j.message||"Failed to save."}`,"error")}).finally(()=>{if(P=!1,$!==null&&$!==q){let j=$;$=null,Q(j)}else $=null}))};Me.addEventListener("keydown",X=>{X.key==="Enter"&&(X.preventDefault(),Me.blur())}),Me.addEventListener("blur",()=>{let X=Me.value.trim();if(!X){Me.value=q,dt("Name cannot be empty.","error");return}if(X!==q){if(P){$=X;return}Q(X)}}),Me.dataset.autosaveBound="1"}if($i&&!t.dataset.modelAutosaveBound){let q=t.querySelector(".aipkit_chatbot_provider_select");if(q){let P=!1,$=null,G=V=>{if(!V)return"";let Y=t.querySelector(`.aipkit_chatbot_model_field[data-provider="${V}"]`);if(!Y)return"";let ce=Y.querySelector("select");return ce?ce.value:""},Q=q.value||"",X=G(Q),ie=(V,Y)=>{let ce=S&&S.value||t.getAttribute("data-active-bot-id");ce&&(P=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_model_settings",{bot_id:ce,provider:V,model:Y}).then(ge=>{if(Q=V,X=Y,dt(ge.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ce),Oi(),typeof window.aipkit_requestChatbotModelSync=="function"){let Te=q?q.value||"":V,Je=G(Te);Te===V&&Je===Y&&window.aipkit_requestChatbotModelSync(V,{silent:!0})}}).catch(ge=>{dt(`Error: ${ge.message||"Failed to save."}`,"error")}).finally(()=>{if(P=!1,$){let{provider:ge,model:Te}=$;$=null,(ge!==Q||Te!==X)&&ie(ge,Te)}}))},j=(V,Y)=>{if(!(V===Q&&Y===X)){if(P){$={provider:V,model:Y};return}ie(V,Y)}};t.addEventListener("change",V=>{let Y=V.target;if(!Y)return;if(Y.matches(".aipkit_chatbot_provider_select")){let ge=Y.value||"",Te=G(ge);j(ge,Te),F&&F.classList.contains("aipkit-active")&&So(),io(),Yo(),Ir(),oi(),ft();return}let ce=Y.closest(".aipkit_chatbot_model_field select");if(ce){let ge=q.value||"",Te=ce.value||"";j(ge,Te),io(),Yo()}})}t.dataset.modelAutosaveBound="1"}if($i&&!t.dataset.deployWizardBound){let q=t.querySelector("[data-aipkit-top-mode-select]"),P=t.querySelector('textarea[name="embed_allowed_domains"]'),$=t.querySelector("[data-aipkit-appearance-popup-select]"),G=t.querySelector('select[name="aipkit_deploy_popup_scope"]'),Q=Array.from(t.querySelectorAll("[data-aipkit-popup-options]")),X=Array.from(t.querySelectorAll(".aipkit_interface_popup_scope_row")),ie=t.querySelector("[data-aipkit-popup-launcher-cell]"),j=ie?ie.closest(".aipkit_interface_theme_top_row--primary"):null;if(q||$||G||Q.length){let V=ke=>ke==="popup"||ke==="external"?ke:"inline",Y=()=>$?$.value==="1"?"popup":"inline":Q.some(ke=>!ke.hidden)?"popup":"inline",ce=()=>q?V(q.value):Y(),ge=()=>G&&G.value==="sitewide"?"sitewide":"page",Te=ke=>{let tt=t.querySelector(".aipkit_sidebar_toggle_group");if(!tt)return;let Ce=tt.querySelector(".aipkit_sidebar_toggle_switch"),qe=tt.querySelector(".aipkit_interface_toggle_label");if(!Ce)return;let ct=tt.getAttribute("data-tooltip-disabled")||"";if(ke){if(Ce.getAttribute("data-original-state")===null){let bt=Ce.tagName==="SELECT"?Ce.value==="1"?"checked":"unchecked":Ce.checked?"checked":"unchecked";Ce.setAttribute("data-original-state",bt)}Ce.tagName==="SELECT"?Ce.value="0":Ce.checked=!1,Ce.disabled=!0,tt.setAttribute("title",ct),Ce.setAttribute("title",ct),qe&&qe.setAttribute("title",ct),tt.classList.add("aipkit-disabled-tooltip"),qe&&(qe.style.opacity="0.6")}else Ce.disabled=!1,tt.removeAttribute("title"),Ce.removeAttribute("title"),qe&&qe.removeAttribute("title"),tt.classList.remove("aipkit-disabled-tooltip"),qe&&(qe.style.opacity="1"),Ce.getAttribute("data-original-state")==="checked"&&(Ce.tagName==="SELECT"?Ce.value="1":Ce.checked=!0),Ce.removeAttribute("data-original-state")},Je=ke=>{let tt=F||O;if(!tt)return;let Ce=tt.querySelectorAll('[data-popup-only="header-identity"]');Ce.length&&Ce.forEach(qe=>{qe.hidden=!ke})},ht=ke=>{let tt=t.querySelector(".aipkit_popup_status_text_group");if(!tt)return;let Ce=tt.querySelector('input[name="header_online_text"]');if(!Ce)return;let qe=tt.querySelector(".aipkit_popover_option_label"),ct=tt.getAttribute("data-tooltip-disabled")||"";if(ke){Ce.disabled=!1,tt.removeAttribute("title"),Ce.removeAttribute("title"),qe&&qe.removeAttribute("title"),tt.classList.remove("aipkit-disabled-tooltip");return}Ce.disabled=!0,ct&&(tt.setAttribute("title",ct),Ce.setAttribute("title",ct),qe&&qe.setAttribute("title",ct)),tt.classList.add("aipkit-disabled-tooltip")},It=ke=>{ie&&(ie.hidden=!ke,ie.setAttribute("aria-hidden",ke?"false":"true"),j&&j.classList.toggle("aipkit_interface_theme_top_row--no-launcher",!ke),ke||ya())},Ot=()=>{let ke=ce(),tt=ke==="popup";$&&ke!=="external"&&($.value=ke==="popup"?"1":"0"),Q.forEach(Ce=>{if(Ce.hidden=!tt,!tt){let qe=Ce.querySelector(".aipkit_accordion_header"),ct=Ce.querySelector(".aipkit_accordion_body");qe&&ct&&(qe.setAttribute("aria-expanded","false"),ct.hidden=!0),(Ce.getAttribute("data-aipkit-accordion")||"")==="popup"&&a()==="popup"&&s("")}}),X.forEach(Ce=>{Ce.hidden=!tt}),G&&(G.disabled=!tt),Te(tt),Je(tt),ht(tt),It(tt),Oe&&Oe.classList.contains("is-open")&&(tt&&je?window.requestAnimationFrame(()=>{zo(je)}):yr())},Li=()=>{if(!rn)return;rn.classList.add("aipkit-active"),rn.setAttribute("aria-hidden","false");let ke=rn.querySelector('textarea[name="embed_allowed_domains"]')||rn.querySelector(".aipkit_copy_embed_code_btn");ke&&typeof ke.focus=="function"&&window.setTimeout(()=>ke.focus(),0)},kt=()=>{rn&&(rn.classList.remove("aipkit-active"),rn.setAttribute("aria-hidden","true"))},yi=null,Xt=!1,Ct=null,Gt=()=>{let ke=ce(),tt=Y(),qe=(ke==="external"?tt:ke)==="popup"?"1":"0",ct=qe==="1"&&ge()==="sitewide"?"1":"0",bt={popup_enabled:qe,site_wide_enabled:ct};return P&&(bt.embed_allowed_domains=P.value||""),bt};yi=Gt();let _t=ke=>{let tt=S&&S.value||t.getAttribute("data-active-bot-id");if(!tt||!ke)return;Xt=!0,dt("Auto-saving...","");let Ce={bot_id:tt,popup_enabled:ke.popup_enabled,site_wide_enabled:ke.site_wide_enabled};Object.prototype.hasOwnProperty.call(ke,"embed_allowed_domains")&&(Ce.embed_allowed_domains=ke.embed_allowed_domains),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",Ce).then(qe=>{yi=ke,dt(qe.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(tt),Oi()}).catch(qe=>{dt(`Error: ${qe.message||"Failed to save."}`,"error")}).finally(()=>{if(Xt=!1,Ct){let qe=Ct;Ct=null,(!yi||JSON.stringify(qe)!==JSON.stringify(yi))&&_t(qe)}})},Le=ke=>{if(ke&&!(yi&&JSON.stringify(ke)===JSON.stringify(yi))){if(Xt){Ct=ke;return}_t(ke)}};if(q&&q.addEventListener("change",()=>{q.value=V(q.value),$&&q.value!=="external"&&($.value=q.value==="popup"?"1":"0"),q.value==="external"?Li():kt(),Ot(),Le(Gt())}),$&&$.addEventListener("change",()=>{$.value=$.value==="1"?"1":"0",q&&q.value!=="external"&&(q.value=$.value==="1"?"popup":"inline"),Ot(),Le(Gt())}),G&&G.addEventListener("change",()=>{G.value=G.value==="sitewide"?"sitewide":"page",Ot(),Le(Gt())}),P){let ke=null,tt=()=>{ke&&clearTimeout(ke),ke=setTimeout(()=>{Le(Gt())},350)};P.addEventListener("input",tt),P.addEventListener("change",()=>{ke&&(clearTimeout(ke),ke=null),Le(Gt())}),P.addEventListener("blur",()=>{ke&&(clearTimeout(ke),ke=null),Le(Gt())})}rn&&rn.dataset.bound!=="1"&&(fa&&fa.addEventListener("click",kt),dr&&dr.addEventListener("click",kt),rn.addEventListener("click",ke=>{ke.target===rn&&kt()}),document.addEventListener("keydown",ke=>{ke.key==="Escape"&&rn.classList.contains("aipkit-active")&&kt()}),rn.dataset.bound="1"),Ot(),t.dataset.deployWizardBound="1"}}if(R&&$i&&!t.dataset.aiParamsAutosaveBound){let q=!1,P=null,$=()=>{let Y=Je=>ue&&ue.querySelector(Je)||R.querySelector(Je),ce=Y('[name="temperature"]'),ge=Y('[name="max_completion_tokens"]'),Te=Y('[name="max_messages"]');return{temperature:ce?ce.value:"",maxTokens:ge?ge.value:"",maxMessages:Te?Te.value:""}},{temperature:G,maxTokens:Q,maxMessages:X}=$(),ie=(Y,ce,ge)=>{let Te=S&&S.value||t.getAttribute("data-active-bot-id");!Te||Y===""||ce===""||ge===""||(q=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_ai_parameters",{bot_id:Te,temperature:Y,max_completion_tokens:ce,max_messages:ge}).then(Je=>{G=Y,Q=ce,X=ge,dt(Je.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Te),Oi()}).catch(Je=>{dt(`Error: ${Je.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P){let{temperature:Je,maxTokens:ht,maxMessages:It}=P;P=null,(Je!==G||ht!==Q||It!==X)&&ie(Je,ht,It)}}))},j=(Y,ce,ge)=>{if(!(Y===G&&ce===Q&&ge===X)){if(q){P={temperature:Y,maxTokens:ce,maxMessages:ge};return}ie(Y,ce,ge)}},V=Y=>{let ce=Y.target;if(ce&&(ce.matches('[name="temperature"]')||ce.matches('[name="max_completion_tokens"]')||ce.matches('[name="max_messages"]'))){let{temperature:ge,maxTokens:Te,maxMessages:Je}=$();j(ge,Te,Je)}};R.addEventListener("change",V),ue&&ue.addEventListener("change",V),t.dataset.aiParamsAutosaveBound="1"}if((Bt||R)&&$i&&!t.dataset.webSettingsAutosaveBound){let q=!1,P=null,$=()=>{let j=Y=>{let ce=Bt?Bt.querySelector(Y):null;return ce?ce.value:""},V=Y=>{let ce=R&&R.querySelector(Y)||t&&t.querySelector(Y)||Bt&&Bt.querySelector(Y);return ce?ce.tagName==="SELECT"?ce.value==="1"?"1":"0":ce.checked?"1":"0":"0"};return{openai_web_search_enabled:V(".aipkit_openai_web_search_enable_toggle"),openai_web_search_context_size:j('[name="openai_web_search_context_size"]'),openai_web_search_loc_type:j('[name="openai_web_search_loc_type"]'),openai_web_search_loc_country:j('[name="openai_web_search_loc_country"]'),openai_web_search_loc_city:j('[name="openai_web_search_loc_city"]'),openai_web_search_loc_region:j('[name="openai_web_search_loc_region"]'),openai_web_search_loc_timezone:j('[name="openai_web_search_loc_timezone"]'),claude_web_search_enabled:V(".aipkit_claude_web_search_enable_toggle"),claude_web_search_max_uses:j('[name="claude_web_search_max_uses"]'),claude_web_search_loc_type:j('[name="claude_web_search_loc_type"]'),claude_web_search_loc_country:j('[name="claude_web_search_loc_country"]'),claude_web_search_loc_city:j('[name="claude_web_search_loc_city"]'),claude_web_search_loc_region:j('[name="claude_web_search_loc_region"]'),claude_web_search_loc_timezone:j('[name="claude_web_search_loc_timezone"]'),claude_web_search_allowed_domains:j('[name="claude_web_search_allowed_domains"]'),claude_web_search_blocked_domains:j('[name="claude_web_search_blocked_domains"]'),claude_web_search_cache_ttl:j('[name="claude_web_search_cache_ttl"]'),openrouter_web_search_enabled:V(".aipkit_openrouter_web_search_enable_toggle"),openrouter_web_search_engine:j('[name="openrouter_web_search_engine"]'),openrouter_web_search_max_results:j('[name="openrouter_web_search_max_results"]'),openrouter_web_search_search_prompt:j('[name="openrouter_web_search_search_prompt"]'),google_search_grounding_enabled:V(".aipkit_google_search_grounding_enable_toggle"),web_toggle_default_on:V(".aipkit_web_toggle_default_on"),google_grounding_mode:j('[name="google_grounding_mode"]'),google_grounding_dynamic_threshold:j('[name="google_grounding_dynamic_threshold"]')}},G=$(),Q=j=>{let V=S&&S.value||t.getAttribute("data-active-bot-id");V&&(q=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_web_settings",{bot_id:V,...j}).then(Y=>{G=j,dt(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{dt(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P){let Y=P;P=null,JSON.stringify(Y)!==JSON.stringify(G)&&Q(Y)}}))},X=j=>{if(JSON.stringify(j)!==JSON.stringify(G)){if(q){P=j;return}Q(j)}},ie=j=>{let V=j.target;V&&(V.matches(".aipkit_openai_web_search_enable_toggle")||V.matches(".aipkit_openai_web_search_loc_type_select")||V.matches('[name="openai_web_search_context_size"]')||V.matches('[name="openai_web_search_loc_country"]')||V.matches('[name="openai_web_search_loc_city"]')||V.matches('[name="openai_web_search_loc_region"]')||V.matches('[name="openai_web_search_loc_timezone"]')||V.matches(".aipkit_claude_web_search_enable_toggle")||V.matches(".aipkit_claude_web_search_loc_type_select")||V.matches('[name="claude_web_search_max_uses"]')||V.matches('[name="claude_web_search_loc_country"]')||V.matches('[name="claude_web_search_loc_city"]')||V.matches('[name="claude_web_search_loc_region"]')||V.matches('[name="claude_web_search_loc_timezone"]')||V.matches('[name="claude_web_search_allowed_domains"]')||V.matches('[name="claude_web_search_blocked_domains"]')||V.matches('[name="claude_web_search_cache_ttl"]')||V.matches(".aipkit_openrouter_web_search_enable_toggle")||V.matches('[name="openrouter_web_search_engine"]')||V.matches('[name="openrouter_web_search_max_results"]')||V.matches('[name="openrouter_web_search_search_prompt"]')||V.matches(".aipkit_google_search_grounding_enable_toggle")||V.matches(".aipkit_web_toggle_default_on")||V.matches(".aipkit_google_grounding_mode_select")||V.matches('[name="google_grounding_dynamic_threshold"]'))&&(io(),X($()))};R&&R.addEventListener("change",ie),Bt&&(!R||!R.contains(Bt))&&Bt.addEventListener("change",ie),t.dataset.webSettingsAutosaveBound="1"}if((Vt||R)&&$i&&!t.dataset.contextSettingsAutosaveBound){let q=!1,P=null,$=()=>{let ee=he=>{let Be=Pe(),We=Be?Be.querySelector(he):null;return We?We.value:""},le=he=>{let Be=R&&R.querySelector(he)||t&&t.querySelector(he)||Vt&&Vt.querySelector(he);return Be?Be.tagName==="SELECT"?Be.value==="1"?"1":"0":Be.checked?"1":"0":"0"},_e=he=>{let Be=Pe(),We=Be?Be.querySelector(he):null;return We?Array.from(We.selectedOptions).map($e=>$e.value).filter(Boolean):[]};return{enable_vector_store:le(".aipkit_vector_store_enable_select"),vector_store_provider:ee('[name="vector_store_provider"]'),openai_vector_store_ids:_e('select[name="openai_vector_store_ids[]"]'),pinecone_index_name:ee('[name="pinecone_index_name"]'),qdrant_collection_names:_e('select[name="qdrant_collection_names[]"]'),vector_embedding_provider:ee('[name="vector_embedding_provider"]'),vector_embedding_model:ee('[name="vector_embedding_model"]'),vector_store_top_k:ee('[name="vector_store_top_k"]'),vector_store_confidence_threshold:ee('[name="vector_store_confidence_threshold"]'),content_aware_enabled:le(".aipkit_content_aware_enable_select")}},G=$(),Q=R&&R.closest(".aipkit_model_settings_popover")?.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline")||Vt&&Vt.querySelector(".aipkit_popover_flyout_header .aipkit_popover_status_inline")||Vt&&Vt.querySelector(".aipkit_popover_status_inline")||R&&R.querySelector(".aipkit_popover_status_inline")||null,X=(ee,le)=>{Q&&(Q.textContent=ee||"",Q.classList.remove("success","error","loading"),le&&Q.classList.add(le),Q.style.display=ee?"inline-block":"none")},ie=()=>{Q&&setTimeout(()=>{Q.textContent="",Q.classList.remove("success","error","loading"),Q.style.display="none"},2500)},j=!1,V=null,Y={},ce=Pe();ce&&ce.querySelectorAll('[name="pinecone_api_key"], [name="qdrant_url"], [name="qdrant_api_key"]').forEach(ee=>{Y[ee.name]=ee.value});let ge=()=>{let{pineconeKeyInput:ee,qdrantUrlInput:le,qdrantKeyInput:_e}=lt(),he=!!(ee&&ee.value.trim()||g),Be=!!(le&&le.value.trim()||w),We=!!(_e&&_e.value.trim()||d);return{pinecone:he,qdrant:Be&&We}},Te=0,Je=(ee,le)=>ee?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(ee,{silent:!0,showErrors:!1,targetSelectId:le,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,ee,{silent:!0,showErrors:!1,targetSelectId:le,propagateError:!0}):null:null,ht=(ee,le)=>{let _e=++Te;X("Syncing...","loading");let he=Je(ee,le);if(he&&typeof he.then=="function"){he.then(()=>{Te===_e&&(X("Synced","success"),ie())}).catch(Be=>{Te===_e&&X(`Error: ${Be.message||"Sync failed."}`,"error")});return}ie()},It=ee=>{let le=ge();if(ee==="pinecone"&&le.pinecone){let{pineconeIndexSelect:_e}=lt();ht("PineconeIndexes",_e?_e.id:"")}else if(ee==="qdrant"&&le.qdrant){let{qdrantCollectionsSelect:_e}=lt();ht("QdrantCollections",_e?_e.id:"")}},Ot=ee=>{!ee||!Object.keys(ee).length||(j=!0,X("Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",ee).then(le=>{Object.keys(ee).forEach(_e=>{Y[_e]=ee[_e]}),Object.prototype.hasOwnProperty.call(ee,"pinecone_api_key")&&It("pinecone"),(Object.prototype.hasOwnProperty.call(ee,"qdrant_url")||Object.prototype.hasOwnProperty.call(ee,"qdrant_api_key"))&&It("qdrant"),X(le.message||"Saved","success"),ie()}).catch(le=>{X(`Error: ${le.message||"Failed to save."}`,"error")}).finally(()=>{if(j=!1,V){let le=V;V=null,Ot(le)}}))},Li=ee=>{if(!ee)return;let le=Object.keys(ee).reduce((_e,he)=>(ee[he]!==Y[he]&&(_e[he]=ee[he]),_e),{});if(Object.keys(le).length){if(j){V={...V||{},...le};return}Ot(le)}},kt=ee=>{let le=S&&S.value||t.getAttribute("data-active-bot-id");le&&(q=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_context_settings",{bot_id:le,...ee}).then(_e=>{G=ee,dt(_e.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(le),Oi()}).catch(_e=>{dt(`Error: ${_e.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P){let _e=P;P=null,JSON.stringify(_e)!==JSON.stringify(G)&&kt(_e)}}))},yi=ee=>{if(JSON.stringify(ee)!==JSON.stringify(G)){if(q){P=ee;return}kt(ee)}},Xt=ee=>{let le=ee.target;if(le){if(le.matches('[name="pinecone_api_key"]')||le.matches('[name="qdrant_url"]')||le.matches('[name="qdrant_api_key"]')){let _e=le.value||"";Li({[le.name]:_e}),ft(),In($());return}if(le.matches(".aipkit_vector_store_enable_select")||le.matches(".aipkit_vector_store_provider_select")||le.matches('select[name="openai_vector_store_ids[]"]')||le.matches('select[name="qdrant_collection_names[]"]')||le.matches('[name="pinecone_index_name"]')||le.matches(".aipkit_vector_embedding_select")||le.matches('[name="vector_embedding_provider"]')||le.matches('[name="vector_embedding_model"]')||le.matches('[name="vector_store_top_k"]')||le.matches('[name="vector_store_confidence_threshold"]')||le.matches('[name="content_aware_enabled"]')){if(le.matches(".aipkit_vector_embedding_select")&&rs(le),le.matches(".aipkit_vector_store_enable_select")&&(nn(),It($().vector_store_provider)),le.matches(".aipkit_vector_store_provider_select")&&(ai(),It(le.value||""),oi(),ft()),le.matches('[name="vector_embedding_provider"]')){let he=Pe();he&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(he),Pr(he)}if(le.matches('[name="vector_embedding_model"]')){let he=Pe();Pr(he)}let _e=$();yi(_e),ft(),In(_e),Le(_e),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(1)}}};R&&R.addEventListener("change",Xt),Vt&&Vt.addEventListener("change",Xt);let Ct=(ee,le)=>{Fn&&(Fn.textContent=ee||"",Fn.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ee&&Fn.classList.add("is-visible"),le&&Fn.classList.add(`is-${le}`))},Gt=(ee=2500)=>{Fn&&setTimeout(()=>{Fn.textContent="",Fn.classList.remove("is-visible","is-success","is-error","is-warning","is-loading")},ee)},_t=(ee,le="info")=>{if(Un){if(typeof window.aipkit_showOpenAIVectorStatus=="function"){window.aipkit_showOpenAIVectorStatus(ee||"",le,Un.id);return}Un.textContent=ee||""}},Le=(ee=null)=>{if(!pn)return;let le=ee||$();if(!le||le.enable_vector_store!=="1"){pn.innerHTML='<option value=""></option>',pn.value="";return}let _e="";le.vector_store_provider==="openai"?_e=(Array.isArray(le.openai_vector_store_ids)?le.openai_vector_store_ids.filter(Boolean):[])[0]||"":le.vector_store_provider==="pinecone"?_e=le.pinecone_index_name||"":le.vector_store_provider==="qdrant"&&(_e=(Array.isArray(le.qdrant_collection_names)?le.qdrant_collection_names.filter(Boolean):[])[0]||""),pn.innerHTML=_e?`<option value="${_e}">${_e}</option>`:'<option value=""></option>',pn.value=_e,pn.dispatchEvent(new Event("change"))},ke=()=>$n&&$n.value||"bulk",tt=ee=>{let le=ee==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",_e=document.getElementById(le);return _e?Array.from(_e.selectedOptions).map(he=>he.value).filter(Boolean):[]},Ce=ee=>{let le=ee==="specific"?Mo:Po;return le&&le.value||"publish"},qe=()=>{let ee=document.getElementById("aipkit_vs_wp_content_list_area");return ee?Array.from(ee.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(le=>le.value):[]},ct=(ee,le,_e)=>{if(!le)return;le.innerHTML="";let he=Number(ee?.total_posts||0),Be=Number(ee?.total_pages||0),We=Number(ee?.current_page||1);if(!he)return;let $e=document.createElement("span");if($e.className="aipkit_pagination-count",$e.textContent=`${he.toLocaleString()} ${f("item","items",he,"gpt3-ai-content-generator")}`,le.appendChild($e),Be<=1)return;let ot=document.createElement("span");ot.className="aipkit_pagination-links";let mt=document.createElement("button");mt.type="button",mt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",mt.textContent=r("Prev","gpt3-ai-content-generator"),mt.disabled=We<=1,mt.addEventListener("click",()=>_e(We-1));let wi=document.createElement("span");wi.className="aipkit_pagination-current",wi.textContent=`${We}/${Be}`;let Nt=document.createElement("button");Nt.type="button",Nt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Nt.textContent=r("Next","gpt3-ai-content-generator"),Nt.disabled=We>=Be,Nt.addEventListener("click",()=>_e(We+1)),ot.appendChild(mt),ot.appendChild(wi),ot.appendChild(Nt),le.appendChild(ot)},bt=(ee,le)=>{if(!Dn)return;if(Dn.innerHTML="",!Array.isArray(ee)||!ee.length){let $e=document.createElement("p");$e.className="aipkit_builder_help_text",$e.textContent=r("No posts found for selection.","gpt3-ai-content-generator"),Dn.appendChild($e),sa&&(sa.innerHTML="");return}let _e=document.createElement("ul"),he=document.createElement("div");he.className="aipkit_wp_content_select_all_wrapper";let Be=document.createElement("label");Be.className="aipkit_training_site_option";let We=document.createElement("input");We.type="checkbox",We.checked=ee.every($e=>an.selectedIds.has(String($e.id))),Be.appendChild(We),Be.appendChild(document.createTextNode(r("Select all","gpt3-ai-content-generator"))),he.appendChild(Be),Dn.appendChild(he),Dn.appendChild(_e),ee.forEach($e=>{let ot=document.createElement("li");ot.className="aipkit_wp_content_list_item";let mt=document.createElement("input");mt.type="checkbox",mt.name="wp_content_to_index[]",mt.value=String($e.id),mt.checked=an.selectedIds.has(String($e.id)),mt.addEventListener("change",()=>{mt.checked?an.selectedIds.add(String($e.id)):an.selectedIds.delete(String($e.id)),We.checked=ee.every(wn=>an.selectedIds.has(String(wn.id)))});let wi=document.createElement("a");wi.className="aipkit_wp_content_title",wi.href=$e.edit_link||"#",wi.target="_blank",wi.rel="noopener noreferrer",wi.textContent=$e.title||r("Untitled","gpt3-ai-content-generator");let Nt=document.createElement("span");Nt.className="aipkit_wp_content_type",Nt.textContent=$e.type_label||"";let vi=document.createElement("span");vi.className="aipkit_wp_content_indexed_status",vi.textContent=$e.is_already_indexed?r("Indexed","gpt3-ai-content-generator"):"",ot.appendChild(mt),ot.appendChild(wi),ot.appendChild(Nt),ot.appendChild(vi),_e.appendChild(ot)}),We.addEventListener("change",()=>{We.checked?ee.forEach($e=>an.selectedIds.add(String($e.id))):ee.forEach($e=>an.selectedIds.delete(String($e.id))),Dn.querySelectorAll('input[name="wp_content_to_index[]"]').forEach($e=>{$e.checked=We.checked})}),ct(le,sa,ri)},ri=async ee=>{if(!Dn)return;let le=ke(),_e=tt(le);if(!_e.length){Dn.innerHTML="",sa&&(sa.innerHTML=""),_t(r("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let he=Ri("aipkit_wp_content_fetch_nonce");if(!he){_t(r("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let Be=Ce(le),We=pn&&pn.value||"";try{_t(r("Loading content...","gpt3-ai-content-generator"),"");let $e=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:he,post_types:_e,post_status:Be,target_store_id:We,paged:ee});an.page=ee,bt($e.posts||[],$e.pagination||{}),_t("","")}catch($e){_t($e&&$e.message?$e.message:r("Failed to load content.","gpt3-ai-content-generator"),"error")}},Zt=ee=>{$n&&($n.value=ee),Fo&&(Fo.hidden=ee!=="bulk"),nr&&(nr.hidden=ee!=="specific"),ir&&(ir.hidden=ee!=="specific"),da&&(da.hidden=ee!=="bulk"),sr&&(sr.hidden=ee!=="specific"),Yt&&(Yt.hidden=ee!=="bulk"),ee==="specific"&&ri(1)},si=()=>{t.querySelectorAll(".aipkit_training_site_dropdown").forEach(le=>{let _e=le.querySelector(".aipkit_training_site_dropdown_btn"),he=le.querySelector(".aipkit_training_site_dropdown_label"),Be=le.querySelector(".aipkit_training_site_dropdown_panel"),$e=le.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",ot=document.getElementById($e);if(!_e||!Be||!ot)return;let mt=()=>{let Nt=Be.querySelectorAll('input[type="checkbox"]:checked'),vi=le.dataset.placeholder||r("Select types","gpt3-ai-content-generator"),wn=le.dataset.selectedLabel||r("selected","gpt3-ai-content-generator");he&&(Nt.length?he.textContent=`${Nt.length} ${wn}`:he.textContent=vi)},wi=()=>{let Nt=Array.from(Be.querySelectorAll('input[type="checkbox"]:checked')).map(vi=>vi.value);Array.from(ot.options).forEach(vi=>{vi.selected=Nt.includes(vi.value)})};_e.addEventListener("click",()=>{let Nt=_e.getAttribute("aria-expanded")==="true";_e.setAttribute("aria-expanded",Nt?"false":"true"),Be.hidden=Nt}),Be.addEventListener("change",()=>{wi(),mt(),ke()==="specific"&&ri(1)}),document.addEventListener("click",Nt=>{le.contains(Nt.target)||(_e.setAttribute("aria-expanded","false"),Be.hidden=!0)}),wi(),mt()})},zt=async(ee,le,_e)=>{let he=Ri("aipkit_wp_content_fetch_nonce");if(!he||!ee.length)return{total:0};let Be=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:he,post_types:ee,post_status:le,target_store_id:_e||"",paged:1}),We=parseInt(Be?.pagination?.total_posts||0,10);return{total:Number.isNaN(We)?0:We,totalPages:parseInt(Be?.pagination?.total_pages||1,10)}},Pi=async(ee,le,_e)=>{let he=Ri("aipkit_wp_content_fetch_nonce");if(!he)throw new Error("WP content fetch nonce missing.");let Be=[],We=1,$e=1;do{let ot=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:he,post_types:ee,post_status:le,target_store_id:_e||"",paged:We}),mt=Array.isArray(ot?.posts)?ot.posts:[];mt.length&&(window.aipkit_wpContentTitleMap=window.aipkit_wpContentTitleMap||{},mt.forEach(Nt=>{Nt&&Nt.id&&(window.aipkit_wpContentTitleMap[String(Nt.id)]=Nt.title||window.aipkit_wpContentTitleMap[String(Nt.id)]||"")})),Be.push(...mt.map(Nt=>String(Nt.id)));let wi=parseInt(ot?.pagination?.total_pages||1,10);$e=Number.isNaN(wi)?1:wi,_t(`Preparing... collected ${Be.length} item(s).`,"info"),We+=1}while(We<=$e);return Be},Ei=(ee,le)=>ee<=200||le!=="publish"?Promise.resolve(!1):new Promise(_e=>{let he=document.getElementById("aipkit_background_indexing_confirm"),Be=document.getElementById("aipkit_background_indexing_message"),We=document.getElementById("aipkit_background_indexing_yes"),$e=document.getElementById("aipkit_background_indexing_no"),ot=document.getElementById("aipkit_wp_content_bulk_hint");if(!he||!Be||!We||!$e){_e(window.confirm(`You're about to index ${ee} items. Run in the background?`));return}Be.textContent=`You're about to index ${ee} items. Run in the background?`,ot&&(ot.hidden=!0),he.hidden=!1;let mt=()=>{he.hidden=!0,ot&&(ot.hidden=!1),We.removeEventListener("click",wi),$e.removeEventListener("click",Nt)},wi=()=>{mt(),_e(!0)},Nt=()=>{mt(),_e(!1)};We.addEventListener("click",wi),$e.addEventListener("click",Nt)}),Yi=async({botId:ee,postTypes:le,provider:_e,targetStoreId:he,embeddingProvider:Be,embeddingModel:We})=>{let $e=window.aipkit_chat_config?.automationsNonce||"";if(!$e)throw new Error("Automations nonce missing.");let ot=`Chatbot ${ee} website indexing`,mt={_ajax_nonce:$e,task_id:0,task_name:ot,task_type:"content_indexing",task_status:"active",task_frequency:"one-time",index_existing_now_flag:"1",only_new_updated_flag:"0",post_types:le,target_store_provider:_e,target_store_id:he};return(_e==="pinecone"||_e==="qdrant")&&(mt.embedding_provider=Be||"",mt.embedding_model=We||""),window.aipkit_apiRequest("aipkit_save_automated_task",mt)};if($n&&!t.dataset.trainingWebsiteBound){if(typeof window.aipkit_initWpContentModeToggle=="function"&&window.aipkit_initWpContentModeToggle(),Xn&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&!Xn.dataset.listenerAttached&&(Xn.addEventListener("click",()=>{window.aipkit_fetchWordPressContentForTraining(1)}),Xn.dataset.listenerAttached="true"),typeof window.aipkit_updatePostTypeCounts=="function"&&(window.aipkit_updatePostTypeCounts(),Po&&!Po.dataset.listenerAttached&&(Po.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),Po.dataset.listenerAttached="true"),pn&&!pn.dataset.listenerAttached&&(pn.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),pn.dataset.listenerAttached="true")),Le($()),si(),Bo.length){Bo.forEach(le=>{le.dataset.listenerAttached||(le.addEventListener("change",()=>{Zt(le.value)}),le.dataset.listenerAttached="true")});let ee=Array.from(Bo).find(le=>le.checked);Zt(ee?ee.value:ke())}else Zt(ke());Mo&&!Mo.dataset.listenerAttached&&(Mo.addEventListener("change",()=>{ke()==="specific"&&ri(1)}),Mo.dataset.listenerAttached="true"),pn&&!pn.dataset.websiteListenerAttached&&(pn.addEventListener("change",()=>{ke()==="specific"&&ri(1)}),pn.dataset.websiteListenerAttached="true"),t.dataset.trainingWebsiteBound="1"}let Co=ee=>`${ee.name}::${ee.size}::${ee.lastModified}`,lo=ee=>{if(!Number.isFinite(ee)||ee<=0)return"0 KB";let le=["B","KB","MB","GB"],_e=ee,he=0;for(;_e>=1024&&he<le.length-1;)_e/=1024,he+=1;let Be=he===0?0:1;return`${_e.toFixed(Be)} ${le[he]}`},jn=()=>zn&&zn.dataset.upgradeUrl||"",Hn=()=>{if(!Lo)return;let ee=Qn.size>0;Lo.style.display=ee?"none":""},Xa=(ee=1500)=>{zn&&(mo&&window.clearTimeout(mo),mo=window.setTimeout(()=>{Qn.clear(),zn.innerHTML="",An&&(An.value=""),Hn(),mo=null},ee))},br=()=>Qn.size?Array.from(Qn.values()).every(ee=>{let le=ee.querySelector(".aipkit_training_file_status");return le?le.classList.contains("is-success")||le.classList.contains("is-error"):!1}):!1,Sr=()=>{mo&&!br()&&(window.clearTimeout(mo),mo=null),br()&&Xa(),Hn()},Sa=ee=>{if(!zn)return null;let le=Co(ee);if(Qn.has(le))return Qn.get(le);let _e=document.createElement("div");_e.className="aipkit_training_file_row",_e.dataset.fileKey=le;let he=document.createElement("div");he.className="aipkit_training_file_meta";let Be=document.createElement("span");Be.className="aipkit_training_file_name",Be.textContent=ee.name;let We=document.createElement("span");We.className="aipkit_training_file_size",We.textContent=lo(ee.size);let $e=document.createElement("span");return $e.className="aipkit_training_file_status",$e.textContent="Queued",he.appendChild(Be),he.appendChild(We),_e.appendChild(he),_e.appendChild($e),zn.appendChild(_e),Qn.set(le,_e),_e},on=(ee,le,_e)=>{let he=Sa(ee);if(!he)return;let Be=he.querySelector(".aipkit_training_file_status");if(Be){if(Be.textContent="",Be.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),_e&&Be.classList.add(`is-${_e}`),le==="Upgrade"&&jn()){Be.classList.add("is-upgrade");let We=document.createElement("a");We.className="aipkit_training_file_upgrade",We.href=jn(),We.textContent=le,Be.appendChild(We)}else Be.textContent=le;Sr()}},Xo=async(ee,le=null)=>{if(!ee||!ee.name||typeof window.aipkit_apiRequest!="function")return!1;let _e=S&&S.value||t.getAttribute("data-active-bot-id");if(!_e)return!1;let he=le||$();if(!he||he.enable_vector_store!=="1")return!1;let Be=String(ee.name||"").trim();if(!Be)return!1;let We=vi=>String(vi||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),$e=We(Be),ot=Be.replace(/\.[^/.]+$/,""),mt=[Be,$e,ot&&ot!==Be?ot:""].filter(Boolean),wi=async(vi,wn)=>{let mn=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",{bot_id:_e,page:1,per_page:wn,search:vi||"",enable_vector_store:he.enable_vector_store,vector_store_provider:he.vector_store_provider,openai_vector_store_ids:he.openai_vector_store_ids||[],pinecone_index_name:he.pinecone_index_name,qdrant_collection_names:he.qdrant_collection_names||[]});return Array.isArray(mn.logs)?mn.logs:[]},Nt=(vi,wn)=>{if(!vi.length)return null;let mn=wn.map(We).filter(Boolean);return vi.find(Tn=>{let xo=We(Tn.message),Ni=We(Tn.post_title),rt=We(Tn.file_id);return mn.some(St=>xo&&xo.includes(St)||Ni&&Ni.includes(St)||rt&&rt.includes(St))})||null};try{for(let mn of mt){let Tn=await wi(mn,10),xo=Nt(Tn,[mn,$e]);if(xo){let Ni=String(xo.status||"").toLowerCase();if(Ni==="indexed"||Ni==="skipped_already_indexed")return on(ee,"Trained","success"),!0;if(Ni==="failed")return on(ee,"Failed","error"),!0;if(Ni==="processing"||Ni==="queued")return on(ee,"Processing","loading"),!0}}let vi=await wi("",20),wn=Nt(vi,mt);if(wn){let mn=String(wn.status||"").toLowerCase();if(mn==="indexed"||mn==="skipped_already_indexed")return on(ee,"Trained","success"),!0;if(mn==="failed")return on(ee,"Failed","error"),!0;if(mn==="processing"||mn==="queued")return on(ee,"Processing","loading"),!0}}catch{}return!1},Zo=(ee,le,_e,he=0)=>{if(!ee||!le||!_e)return;if(he>=30){Xo(_e,$()).then($e=>{$e||on(_e,"Queued","warning")});return}let We=Ri("aipkit_vector_store_nonce_openai");if(!We||typeof window.aipkit_apiRequest!="function"){Xo(_e,$());return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:ee,batch_id:le,_ajax_nonce:We}).then($e=>{let ot=($e.status||"").toLowerCase();if(ot==="completed"){on(_e,"Trained","success"),In($()),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}if(ot==="failed"||ot==="cancelled"){on(_e,"Failed","error");return}on(_e,"Processing","loading"),setTimeout(()=>{Zo(ee,le,_e,he+1)},2500)}).catch(()=>{setTimeout(()=>{Zo(ee,le,_e,he+1)},3e3)})},po=ee=>{if(!kn)return;let le=kn.dataset.baseLabel||kn.querySelector(".aipkit_training_sources_label")?.textContent.trim()||kn.textContent.replace(/\(\d+\)/,"").trim(),_e=Number.isFinite(ee)?ee:0,he=kn.querySelector(".aipkit_training_sources_count");he?(he.textContent=String(_e),kn.setAttribute("aria-label",`${le} (${_e})`)):kn.textContent=`${le} (${_e})`},In=async(ee=null)=>{if(!kn||typeof window.aipkit_apiRequest!="function")return;if(ee&&ee.enable_vector_store!=="1"){po(0);return}let le=ee?ee.vector_store_provider:"";if(le==="openai"&&!(Array.isArray(ee.openai_vector_store_ids)?ee.openai_vector_store_ids:[]).length){po(0);return}if(le==="pinecone"&&!ee.pinecone_index_name){po(0);return}if(le==="qdrant"&&!(Array.isArray(ee.qdrant_collection_names)?ee.qdrant_collection_names:[]).length){po(0);return}let _e=S&&S.value||t.getAttribute("data-active-bot-id");if(!_e){po(0);return}try{let he={bot_id:_e};ee&&(he.enable_vector_store=ee.enable_vector_store,he.vector_store_provider=ee.vector_store_provider,he.openai_vector_store_ids=ee.openai_vector_store_ids||[],he.pinecone_index_name=ee.pinecone_index_name,he.qdrant_collection_names=ee.qdrant_collection_names||[]);let Be=await window.aipkit_apiRequest("aipkit_get_chatbot_training_source_count",he),We=Number(Be.count||0);po(Number.isNaN(We)?0:We)}catch{}};window.aipkit_refreshTrainingSourcesCount=()=>{In($())};let Za=()=>{if(!kn||t.dataset.trainingAutoSync)return;let ee=()=>{document.visibilityState==="visible"&&In($())},le=window.setInterval(ee,6e4);t.dataset.trainingAutoSync="1",t.dataset.trainingAutoSyncInterval=String(le),document.addEventListener("visibilitychange",ee)},Ri=ee=>{let le=document.getElementById(ee);return le?le.value:""},Ea=ee=>{let le=String(ee),_e=window.aipkit_wpContentTitleMap||{};if(_e&&_e[le])return _e[le];if(Dn){let he=Dn.querySelector(`input[name="wp_content_to_index[]"][value="${le}"]`);if(he){let Be=he.closest(".aipkit_wp_content_list_item"),We=Be?Be.querySelector(".aipkit_wp_content_title"):null,$e=We?We.textContent.trim():"";if($e)return $e}}return`${r("Post","gpt3-ai-content-generator")} ${le}`},qr=(ee,le,_e)=>{let he=Ea(ee);return`${r("Training","gpt3-ai-content-generator")}: ${he} (${le+1}/${_e})`},Gr=async ee=>{let le=Ri("aipkit_wp_content_fetch_nonce");if(!le)throw new Error("WP content fetch nonce missing.");let _e=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:le,get_content_for_ids:[String(ee)]});return(_e&&_e.posts_content?_e.posts_content:{})[String(ee)]||null},Kr=async(ee,le,_e)=>{if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let he=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ee,embedding_provider:le,embedding_model:_e,_ajax_nonce:window.aipkit_dashboard.nonce}),Be=he.embeddings&&he.embeddings.length?he.embeddings[0]:null;if(!Be)throw new Error("Failed to generate embedding.");return Be},ts=async(ee,le)=>{let _e=Array.isArray(ee)?ee:[];if(_e.length)for(let he=0;he<_e.length;he+=1){if(window.aipkit_isIndexingStopped){_t(r("Stopped.","gpt3-ai-content-generator"),"warning");return}let Be=_e[he];_t(qr(Be,he,_e.length),"info"),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{...le,post_ids:[Be]})}},is=async(ee,le)=>{let _e=Array.isArray(ee)?ee:[];if(_e.length)for(let he=0;he<_e.length;he+=1){if(window.aipkit_isIndexingStopped){_t(r("Stopped.","gpt3-ai-content-generator"),"warning");return}let Be=_e[he]||{},We=Be.postId||Be.id;if(!We)continue;_t(qr(We,he,_e.length),"info");let $e=await Gr(We);if(!$e||!$e.content)continue;let ot=Be.metadata&&Be.metadata.vector_id||`wp_post_${We}`,mt={source:"wordpress_post",created_at:new Date().toISOString(),post_id:We,title:$e.title||"",url:$e.edit_link||"",vector_id:ot},wi=await Kr($e.content,le.embedding_provider,le.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:le._ajax_nonce,vectors:JSON.stringify([{id:ot,values:wi,metadata:mt}]),embedding_provider:le.embedding_provider,embedding_model:le.embedding_model,original_text_content:$e.content,index_name:le.index_name})}},ns=async(ee,le)=>{let _e=Array.isArray(ee)?ee:[];if(_e.length)for(let he=0;he<_e.length;he+=1){if(window.aipkit_isIndexingStopped){_t(r("Stopped.","gpt3-ai-content-generator"),"warning");return}let Be=_e[he]||{},We=Be.postId||Be.id;if(!We)continue;_t(qr(We,he,_e.length),"info");let $e=await Gr(We);if(!$e||!$e.content)continue;let ot=l(),mt={source:"wordpress_post",created_at:new Date().toISOString(),post_id:We,title:$e.title||"",url:$e.edit_link||"",vector_id:ot},wi=await Kr($e.content,le.embedding_provider,le.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",{_ajax_nonce:le._ajax_nonce,vectors:JSON.stringify([{id:ot,vector:wi,payload:mt}]),embedding_provider:le.embedding_provider,embedding_model:le.embedding_model,original_text_content:$e.content,collection_name:le.collection_name,source_context:"chatbot_settings_website"})}};typeof window.aipkit_indexOpenAIBatch!="function"&&(window.aipkit_indexOpenAIBatch=ts),typeof window.aipkit_indexPineconeBatch!="function"&&(window.aipkit_indexPineconeBatch=is),typeof window.aipkit_indexQdrantBatch!="function"&&(window.aipkit_indexQdrantBatch=ns);let Er=ee=>ee?Array.isArray(ee)?ee.flatMap(le=>{if(Array.isArray(le))return le;if(le&&typeof le=="object"){if(Array.isArray(le.models))return le.models;if(Array.isArray(le.items))return le.items;if(le.id)return[le]}return[]}):typeof ee=="object"?Object.values(ee).flatMap(le=>Array.isArray(le)?le:[]):[]:[],jr=ee=>{let le=window.aipkit_chat_config||{};return ee==="openai"?Er(le.openaiEmbeddingModels):ee==="google"?Er(le.googleEmbeddingModels):ee==="openrouter"?Er(le.openrouterEmbeddingModels):ee==="azure"?Er(le.azureEmbeddingModels):[]},os=(ee,le)=>!ee||!le?"":`${ee}::${le}`,as=ee=>{let le=(ee||"").split("::"),_e=le.shift()||"",he=le.join("::")||"";return{provider:_e,model:he}},Pr=ee=>{if(!ee)return;let le=ee.querySelector(".aipkit_vector_embedding_select");if(!le)return;let _e=ee.querySelector('[name="vector_embedding_provider"]'),he=ee.querySelector('[name="vector_embedding_model"]'),Be=_e?_e.value:"",We=he?he.value:"",$e=os(Be,We);if(!$e||le.value===$e)return;let ot=typeof CSS<"u"&&CSS.escape?CSS.escape($e):$e.replace(/"/g,'\\"');le.querySelector(`option[value="${ot}"]`)&&(le.value=$e)},rs=ee=>{let le=Pe();if(!le||!ee)return;let _e=le.querySelector('[name="vector_embedding_provider"]'),he=le.querySelector('[name="vector_embedding_model"]'),Be=ee.selectedOptions[0],We=as(ee.value||""),$e=We.provider||Be&&Be.dataset.provider||"",ot=We.model||"";_e&&(_e.value=$e),he&&(he.value=ot),_e&&he&&$e&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&(he.value=ot,window.aipkit_populateVectorEmbeddingModelSelect(le),ot&&(he.value=ot))},zr=(ee,le)=>{if(!le)return null;let he=jr(ee).find($e=>$e&&$e.id===le),Be=he?.dimensions||he?.dimension||he?.output_dimensionality||he?.outputDimensionality||he?.output_dimension,We=Be?Number(Be):NaN;if(Number.isFinite(We)&&We>0)return We;if(he&&typeof he.name=="string"){let $e=he.name.match(/\((\d{3,5})\)/);if($e)return Number($e[1])}return ee==="google"?768:1536},Mr=()=>{let{pineconeKeyInput:ee,qdrantUrlInput:le,qdrantKeyInput:_e}=lt(),he=!!(ee&&ee.value.trim()||g),Be=!!(le&&le.value.trim()||w),We=!!(_e&&_e.value.trim()||d);return{openai:m,pinecone:he,qdrant:Be&&We}},ss=()=>{let ee=Mr();return ee.openai?"openai":ee.pinecone?"pinecone":ee.qdrant?"qdrant":""},cs=()=>m?"openai":h?"google":b?"azure":"",Qr=()=>{let ee=Pe();if(!ee)return{provider:"",model:""};let le=ee.querySelector('[name="vector_embedding_provider"]'),_e=ee.querySelector('[name="vector_embedding_model"]'),he=le?le.value:"";he||(he=cs(),le&&he&&(le.value=he,typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(ee)));let Be=_e?_e.value:"";if(!Be&&he){let We=jr(he);Be=We.length?We[0].id:"",_e&&Be&&(_e.value=Be)}return Pr(ee),{provider:he,model:Be}},Cr=ee=>{if(!ee)return"";let _e=(ee.selectedOptions?Array.from(ee.selectedOptions):[]).find(he=>he&&he.value);return _e?_e.value:""},Jr=(ee,le)=>{!ee||!le||Array.from(ee.options).forEach(_e=>{_e.selected=_e.value===le})},ls=async ee=>{let{openaiStoresSelect:le}=lt(),_e=Cr(le);if(!_e&&le&&(vt(le),_e=Cr(le)),!_e){let he=Ri("aipkit_vector_store_nonce_openai");if(!he)throw new Error("OpenAI vector store nonce missing.");let Be=`Chatbot ${ee} ${Date.now()}`,We=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:he,name:Be,source_type:"chatbot_training_text"}),$e=We.store||We;if(!$e||!$e.id)throw new Error("OpenAI vector store creation failed.");if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]),window.aipkit_chat_config.openaiVectorStores.some(mt=>mt&&mt.id===$e.id)||window.aipkit_chat_config.openaiVectorStores.push($e),typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"){let mt=Pe();mt&&window.aipkit_populateOpenAIVectorStoresMultiSelect(mt)}le&&Jr(le,$e.id),_e=$e.id}return _e},ds=async(ee,le)=>{let{pineconeIndexSelect:_e}=lt(),he=_e?_e.value:"";if(!he&&_e&&(Dt(_e),he=_e.value),!he){let Be=Ri("aipkit_vector_store_pinecone_nonce_management");if(!Be)throw new Error("Pinecone nonce missing.");let We=`chatbot-${ee}-${Date.now()}`,$e=await window.aipkit_apiRequest("aipkit_create_index_pinecone",{_ajax_nonce:Be,name:We,dimension:le,metric:"cosine"}),ot=$e.index||$e,mt=ot?.name||We;if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.pineconeIndexes)||(window.aipkit_chat_config.pineconeIndexes=[]),window.aipkit_chat_config.pineconeIndexes.some(Nt=>Nt&&Nt.name===mt||Nt===mt)||window.aipkit_chat_config.pineconeIndexes.push(ot||mt),typeof window.aipkit_populatePineconeIndexSelect=="function"){let Nt=Pe();Nt&&window.aipkit_populatePineconeIndexSelect(Nt)}_e&&(_e.value=mt),he=mt}return he},ps=async(ee,le)=>{let{qdrantCollectionsSelect:_e}=lt(),he=Cr(_e);if(!he&&_e&&(vt(_e),he=Cr(_e)),!he){let Be=Ri("aipkit_vector_store_qdrant_nonce_management");if(!Be)throw new Error("Qdrant nonce missing.");let We=`chatbot-${ee}-${Date.now()}`;if(await window.aipkit_apiRequest("aipkit_create_collection_qdrant",{_ajax_nonce:Be,name:We,dimension:le,metric:"Cosine"}),window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.qdrantCollections)||(window.aipkit_chat_config.qdrantCollections=[]),window.aipkit_chat_config.qdrantCollections.some(ot=>ot&&ot.name===We||ot===We||ot?.id===We)||window.aipkit_chat_config.qdrantCollections.push({name:We}),_e){if(!Array.from(_e.options).some(mt=>mt.value===We)){let mt=document.createElement("option");mt.value=We,mt.textContent=We,_e.appendChild(mt)}Jr(_e,We)}if(typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let ot=Pe();ot&&window.aipkit_populateQdrantCollectionsMultiSelect(ot)}he=We}return he};if(Io.length&&!t.dataset.trainingTextBound){let ee=!1,le=$e=>{!Bn||!Rn||($e?(Bn.hidden=!1,Bn.disabled=!1,Rn.disabled=!0):(Bn.hidden=!0,Bn.disabled=!1,Rn.disabled=!1))},_e=()=>{let $e=Go?Go.querySelector(".aipkit_builder_tab.is-active"):null;return $e?$e.dataset.aipkitTab:""},he=()=>{let $e=R?R.querySelector(".aipkit_file_upload_toggle_select"):null;return $e?$e.dataset.isProPlan==="true":window.aipkit_chat_config?.isProPlan===!0||window.aipkit_dashboard?.isProPlan===!0};fo&&An&&fo.addEventListener("click",()=>{An.click()});let Be=async()=>{if(ee)return;let $e=_e(),ot="",mt="chatbot_training_text",wi=[],Nt=null;if($e==="text"){if(ot=_o?_o.value.trim():"",!ot){Ct("Add text to train.","warning"),Gt();return}}else if($e==="qa"){let rt=oa?oa.value.trim():"",St=aa?aa.value.trim():"";if(!rt||!St){Ct("Add a question and answer to train.","warning"),Gt();return}ot=`Q: ${rt}
A: ${St}`,mt="chatbot_training_qa"}else if($e==="files"){if(!he()){Ct("Upgrade to use file uploads.","warning");return}if(wi=An?Array.from(An.files||[]):[],!wi.length){An&&An.click(),Ct("Choose files to upload.","warning"),Gt();return}mt="chatbot_training_file"}else if($e==="website"){let rt=ke(),St=Ce(rt),Ft=tt(rt),Ke=qe();if(rt==="specific"){if(!Ke.length){Ct("Select content to train.","warning"),Gt();return}}else if(!Ft.length){Ct("Select at least one post type.","warning"),Gt();return}Nt={mode:rt,statusValue:St,postTypes:Ft,selectedPostIds:Ke}}else{Ct("Select a training tab to continue.","warning"),Gt();return}let vi=S&&S.value||t.getAttribute("data-active-bot-id");if(!vi){Ct("Select a chatbot before training.","error"),Gt();return}let wn=lt(),mn=wn?wn.providerSelect:null,Tn=mn?mn.value:"";if(Tn==="claude_files"){Ct("Claude Files is available for frontend chat upload only. Use OpenAI, Pinecone, or Qdrant for training.","warning"),Gt();return}let xo=["openai","pinecone","qdrant"],Ni="";if(Tn&&xo.includes(Tn)?Ni=Tn:Ni=ss(),!Ni){Ct("Add an OpenAI, Pinecone, or Qdrant key to train.","error");return}ee=!0,le(!0),Io.forEach(rt=>{rt.disabled=!0}),Ct("Preparing training...","loading");try{let rt=R&&R.querySelector(".aipkit_vector_store_enable_select")||t.querySelector(".aipkit_vector_store_enable_select");rt&&(rt.tagName==="SELECT"?rt.value="1":rt.checked=!0),mn&&(mn.value=Ni),nn(),ai();let St="",Ft="",Ke="",Kt="",Ci="";if(Ni==="openai"){if(!m)throw new Error("OpenAI API key missing.");Ke=await ls(vi)}else if(Ni==="pinecone"){if(!Mr().pinecone)throw new Error("Pinecone API key missing.");let At=Qr();if(St=At.provider,Ft=At.model,!St||!Ft)throw new Error("Select an embedding provider and model.");let pt=zr(St,Ft);Kt=await ds(vi,pt)}else if(Ni==="qdrant"){if(!Mr().qdrant)throw new Error("Qdrant URL and API key are required.");let At=Qr();if(St=At.provider,Ft=At.model,!St||!Ft)throw new Error("Select an embedding provider and model.");let pt=zr(St,Ft);Ci=await ps(vi,pt)}if(yi($()),ft(),Le($()),$e==="files"){Hn();for(let ci=0;ci<wi.length;ci+=1){let At=wi[ci];Ct(`Uploading ${ci+1} of ${wi.length}...`,"loading"),on(At,"Uploading","loading");try{let pt=new FormData;if(Ni==="openai"){let jt=Ri("aipkit_vector_store_nonce_openai");if(!jt)throw new Error("OpenAI vector store nonce missing.");pt.append("aipkit_vs_global_file_to_submit",At),pt.append("target_store_id",Ke),pt.append("source_type",mt),pt.append("_ajax_nonce",jt);let xi=await window.aipkit_api_upsertFile(pt,"aipkit_upload_and_add_file_to_store_direct_openai");on(At,"Processing","loading");let Qi=xi?.batch?.id;Xo(At,$()).then(xn=>{if(!xn){if(Qi){Zo(Ke,Qi,At);return}on(At,"Queued","warning")}})}else if(Ni==="pinecone"){let jt=Ri("aipkit_vector_store_pinecone_nonce_management");if(!jt)throw new Error("Pinecone nonce missing.");pt.append("file_to_upload",At),pt.append("index_name",Kt),pt.append("embedding_provider",St),pt.append("embedding_model",Ft),pt.append("_ajax_nonce",jt),await window.aipkit_api_upsertFile(pt,"aipkit_upload_file_and_upsert_to_pinecone"),on(At,"Trained","success")}else if(Ni==="qdrant"){let jt=Ri("aipkit_vector_store_qdrant_nonce_management");if(!jt)throw new Error("Qdrant nonce missing.");pt.append("file_to_upload",At),pt.append("target_store_id",Ci),pt.append("embedding_provider",St),pt.append("embedding_model",Ft),pt.append("source_context","chatbot_settings_file_upload"),pt.append("_ajax_nonce",jt),await window.aipkit_api_upsertFile(pt,"aipkit_upload_file_and_upsert_to_qdrant"),on(At,"Trained","success")}}catch(pt){throw on(At,"Failed","error"),pt}}An&&(An.value=""),Hn(),Ct("Saved","success"),Gt(),In(),ee=!1,le(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}else if($e==="website"&&Nt){let{mode:ci,statusValue:At,postTypes:pt,selectedPostIds:jt}=Nt,xi=jt,Qi=xi.length;if(ci==="bulk"){if(Ct("Preparing website content...","loading"),Qi=(await zt(pt,At,Ke)).total,!Qi){_t("No posts found for selection.","error"),Ct("Nothing to train.","warning"),Gt();return}if(await Ei(Qi,At)){await Yi({botId:vi,postTypes:pt,provider:Ni,targetStoreId:Ni==="openai"?Ke:Ni==="pinecone"?Kt:Ci,embeddingProvider:St,embeddingModel:Ft}),_t("Queued in the background. You can monitor it in the Automate module. You can close this page.","success"),Ct("Queued","success"),Gt(),In($()),ee=!1,le(!1);return}if(Qi>200&&At!=="publish"&&_t("Background indexing supports published content only.","info"),xi=await Pi(pt,At,Ke),!xi.length){_t("No posts found for selection.","error"),Ct("Nothing to train.","warning"),Gt();return}}Ct("Training...","loading"),_t(`Training ${Qi||xi.length} item(s)...`,"info"),window.aipkit_isIndexingStopped=!1;let xn=Un?Un.id:"aipkit_training_wp_status";if(Ni==="openai"){let bn=Ri("aipkit_wp_content_index_nonce");if(!bn)throw new Error("WP content index nonce missing.");await window.aipkit_indexOpenAIBatch(xi,{_ajax_nonce:bn,target_store_id:Ke,provider:"openai",source_type:"wordpress_content"},xn)}else if(Ni==="pinecone"){let bn=Ri("aipkit_vector_store_pinecone_nonce_management");if(!bn)throw new Error("Pinecone nonce missing.");let no=xi.map(ea=>({id:`wp_post_${ea}`,postId:ea,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${ea}`}}));await window.aipkit_indexPineconeBatch(no,{_ajax_nonce:bn,index_name:Kt,embedding_provider:St,embedding_model:Ft,source_type:"wordpress_content"},xn)}else if(Ni==="qdrant"){let bn=Ri("aipkit_vector_store_qdrant_nonce_management");if(!bn)throw new Error("Qdrant nonce missing.");let no=xi.map(ea=>({id:typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`wp_post_${ea}`,postId:ea,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${ea}`}}));await window.aipkit_indexQdrantBatch(no,{_ajax_nonce:bn,collection_name:Ci,embedding_provider:St,embedding_model:Ft,source_type:"wordpress_content"},xn)}Ct("Saved","success"),Gt(),In($()),ee=!1,le(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}else{if(Ct("Training...","loading"),Ni==="openai"){let ci=Ri("aipkit_vector_store_nonce_openai");if(!ci)throw new Error("OpenAI vector store nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:ci,target_store_id:Ke,text_content:ot,source_type:mt})}else if(Ni==="pinecone"){let ci=Ri("aipkit_vector_store_pinecone_nonce_management");if(!ci)throw new Error("Pinecone nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let At=`text_${Date.now()}`,pt={source:mt,created_at:new Date().toISOString(),original_content:ot,vector_id:At},jt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ot,embedding_provider:St,embedding_model:Ft,_ajax_nonce:window.aipkit_dashboard.nonce}),xi=jt.embeddings&&jt.embeddings.length?jt.embeddings[0]:null;if(!xi)throw new Error("Failed to generate embedding.");await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:ci,vectors:JSON.stringify([{id:At,values:xi,metadata:pt}]),embedding_provider:St,embedding_model:Ft,original_text_content:ot,index_name:Kt})}else if(Ni==="qdrant"){let ci=Ri("aipkit_vector_store_qdrant_nonce_management");if(!ci)throw new Error("Qdrant nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let At=l(),pt={source:mt,created_at:new Date().toISOString(),original_content:ot,vector_id:At},jt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ot,embedding_provider:St,embedding_model:Ft,_ajax_nonce:window.aipkit_dashboard.nonce}),xi=jt.embeddings&&jt.embeddings.length?jt.embeddings[0]:null;if(!xi)throw new Error("Failed to generate embedding.");let Qi={_ajax_nonce:ci,vectors:JSON.stringify([{id:At,vector:xi,payload:pt}]),embedding_provider:St,embedding_model:Ft,original_text_content:ot,collection_name:Ci,source_context:"chatbot_settings_training"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Qi)}$e==="text"&&_o&&(_o.value=""),$e==="qa"&&(oa&&(oa.value=""),aa&&(aa.value="")),Ct("Saved","success"),Gt(),In(),ee=!1,le(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}}catch(rt){Ct(`Error: ${rt.message||"Training failed."}`,"error")}finally{ee=!1,le(!1),Io.forEach(rt=>{rt.disabled=!1}),Hn()}},We=()=>{if(!An)return;let $e=Array.from(An.files||[]);if($e.length){if($e.forEach(ot=>{Sa(ot),on(ot,"Queued")}),Hn(),!he()){Ct("Upgrade to use file uploads.","warning"),$e.forEach(ot=>{on(ot,"Upgrade","warning")});return}Be()}};An&&An.addEventListener("change",We),Io.forEach($e=>{$e.addEventListener("click",Be)}),Bn&&!Bn.dataset.listenerAttached&&(Bn.addEventListener("click",()=>{ee&&(window.aipkit_isIndexingStopped=!0,Bn.disabled=!0,Ct("Stopping...","warning"))}),Bn.dataset.listenerAttached="true"),In(),Za(),t.dataset.trainingTextBound="1"}if(Ji&&!t.dataset.sourcesSheetBound){let ee=window.aipkit_escapeHtml||function(rt){return rt},le={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant",claude_files:"Claude Files"},_e={page:1,search:"",status:""},he=null,Be=(rt,St)=>{Zn&&(Zn.textContent=rt||"",Zn.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),St==="success"&&Zn.classList.add("aipkit_form-help-success"),St==="error"&&Zn.classList.add("aipkit_form-help-error"))},We=()=>{Zn&&setTimeout(()=>{Zn.textContent="",Zn.classList.remove("aipkit_form-help-success","aipkit_form-help-error")},2500)},$e=(rt,St)=>{$a&&($a.textContent=rt||"\u2014"),eo&&(eo.textContent=St||"\u2014")},ot=()=>{let rt=$(),St=rt.vector_store_provider||"",Ft=le[St]||"",Ke=[],Kt="",Ci=Pe(),ci=Ci?Ci.querySelector('select[name="openai_vector_store_ids[]"]'):null;if(St==="openai"){if(Ke=Array.isArray(rt.openai_vector_store_ids)?rt.openai_vector_store_ids.filter(Boolean):[],ci){let At=Array.from(ci.selectedOptions).map(pt=>pt.textContent.trim()).filter(Boolean);At.length&&(Kt=At.join(", "))}Kt||(Kt=Ke.join(", "))}else St==="pinecone"?rt.pinecone_index_name&&(Ke=[rt.pinecone_index_name],Kt=rt.pinecone_index_name):St==="qdrant"&&(Ke=Array.isArray(rt.qdrant_collection_names)?rt.qdrant_collection_names.filter(Boolean):[],Kt=Ke.join(", "));return{contextSettings:rt,providerKey:St,providerLabel:Ft,storeIds:Ke,storeLabel:Kt}},mt=rt=>{On&&(On.innerHTML=`<tr><td colspan="5" class="aipkit_text-center">${ee(rt)}</td></tr>`,wo&&(wo.innerHTML=""))},wi=(rt,St)=>{if(!On)return;if(!rt.length){mt("No sources found.");return}let Ft=rt.map(Ke=>{let Kt=(Ke.provider||St||"").toLowerCase(),Ci=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(Ke.message||"",Ke.file_id||"",Kt,Ke):"N/A",ci=Ci==="Text"?"aipkit_type-text":Ci==="File Upload"?"aipkit_type-file":Ci==="Site Content"?"aipkit_type-site":"aipkit_type-na",At=Ke.status==="indexed"||Ke.status==="skipped_already_indexed"||Ke.status==="success"?"aipkit_status-success":Ke.status==="failed"?"aipkit_status-warning":"aipkit_status-info",pt="\u2014";Ke.status&&(pt=Ke.status==="indexed"||Ke.status==="skipped_already_indexed"||Ke.status==="success"?"Trained":Ke.status.replace(/_/g," "));let jt=Ke.status==="processing"||Ke.status==="queued",xi=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(Ke.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(Ke.timestamp):Ke.timestamp||"\u2014",Qi=Ke.indexed_content||"",xn=Ke.post_title||(Ke.post_id?`Post #${Ke.post_id}`:"")||Qi||Ke.message||Ke.file_id||"\u2014",bn=xn.length>60?`${xn.substring(0,60)}...`:xn,no=[];return Ci==="Site Content"&&Ke.post_id&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
                    data-provider="${ee(Ke.provider||St)}"
                    data-store-id="${ee(Ke.vector_store_id||"")}"
                    data-vector-id="${ee(Ke.file_id||"")}"
                    data-log-id="${ee(Ke.id||"")}"
                    data-post-id="${ee(Ke.post_id||"")}"
                    data-embedding-provider="${ee(Ke.embedding_provider||"")}"
                    data-embedding-model="${ee(Ke.embedding_model||"")}"
                    ${jt?'disabled aria-disabled="true"':""}
                  >${jt?"Training...":"Retrain"}</button>`),Ci==="Text"&&Qi&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
                    data-provider="${ee(Ke.provider||St)}"
                    data-store-id="${ee(Ke.vector_store_id||"")}"
                    data-vector-id="${ee(Ke.file_id||"")}"
                    data-log-id="${ee(Ke.id||"")}"
                    data-embedding-provider="${ee(Ke.embedding_provider||"")}"
                    data-embedding-model="${ee(Ke.embedding_model||"")}"
                    data-content="${encodeURIComponent(Qi)}"
                    ${jt?'disabled aria-disabled="true"':""}
                  >${jt?"Training...":"Edit"}</button>`),Qi&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_view_snippet_icon"
                    data-file-id="${ee(Ke.id||"")}"
                    data-snippet="${ee(Qi)}"
                    ${Ke.batch_id?`data-batch-id="${ee(Ke.batch_id)}" data-store-id="${ee(Ke.vector_store_id||"")}"`:""}
                    ${jt?'disabled aria-disabled="true"':""}
                  >View</button>`),Ke.file_id&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
                    data-provider="${ee(Ke.provider||St)}"
                    data-store-id="${ee(Ke.vector_store_id||"")}"
                    data-vector-id="${ee(Ke.file_id||"")}"
                    data-log-id="${ee(Ke.id||"")}"
                    ${jt?'disabled aria-disabled="true"':""}
                  >Delete</button>`),`<tr data-log-id="${ee(Ke.id||"")}">
                <td style="white-space: nowrap;">${ee(xi)}</td>
                <td><span class="aipkit_content-type-tag ${ci}">${ee(Ci)}</span></td>
                <td title="${ee(xn)}">${ee(bn)}</td>
                <td style="white-space: nowrap;"><span class="aipkit_status-tag ${At}">${ee(pt)}</span></td>
                <td class="aipkit_actions_cell">
                  <div class="aipkit-table-actions-group">${no.join("")}</div>
                </td>
              </tr>`}).join("");On.innerHTML=Ft,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(On,St)},Nt=async(rt=1)=>{if(!On||typeof window.aipkit_apiRequest!="function")return;let St=S&&S.value||t.getAttribute("data-active-bot-id");if(!St){mt("Select a chatbot to view sources.");return}let{contextSettings:Ft,providerKey:Ke,providerLabel:Kt,storeIds:Ci,storeLabel:ci}=ot();if($e(Kt,ci),Ft.enable_vector_store!=="1"){mt("Enable a knowledge base to view sources.");return}if(!Ke||!Ci.length){mt("Select a knowledge base store to view sources.");return}On.innerHTML='<tr><td colspan="5" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading sources...</td></tr>',wo&&(wo.innerHTML="");try{let At={bot_id:St,page:rt,search:_e.search,status:_e.status,enable_vector_store:Ft.enable_vector_store,vector_store_provider:Ft.vector_store_provider,openai_vector_store_ids:Ft.openai_vector_store_ids||[],pinecone_index_name:Ft.pinecone_index_name,qdrant_collection_names:Ft.qdrant_collection_names||[]},pt=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",At);_e.page=rt,wi(pt.logs||[],Kt),typeof window.aipkit_renderLogsPagination=="function"&&pt.pagination&&wo&&window.aipkit_renderLogsPagination(pt.pagination,wo,jt=>Nt(jt))}catch(At){mt(`Error loading sources: ${ee(At.message||"Unknown error")}`)}},vi=(rt=1)=>{!O||!O.classList.contains("aipkit-active")||Ji.hidden||Nt(rt)};window.aipkit_refreshSourcesSheet=vi;let wn=()=>{di&&(di.classList.remove("aipkit-active"),di.setAttribute("aria-hidden","true"),di.dataset.provider="",di.dataset.storeId="",di.dataset.vectorId="",di.dataset.logId="",di.dataset.embeddingProvider="",di.dataset.embeddingModel="",ho&&(ho.value=""))},mn=rt=>{!di||!ho||(di.dataset.provider=rt.dataset.provider||"",di.dataset.storeId=rt.dataset.storeId||"",di.dataset.vectorId=rt.dataset.vectorId||"",di.dataset.logId=rt.dataset.logId||"",di.dataset.embeddingProvider=rt.dataset.embeddingProvider||"",di.dataset.embeddingModel=rt.dataset.embeddingModel||"",ho.value=rt.dataset.content?decodeURIComponent(rt.dataset.content):"",di.classList.add("aipkit-active"),di.setAttribute("aria-hidden","false"),setTimeout(()=>ho.focus(),0))},Tn=()=>{bi&&(bi.classList.remove("aipkit-active"),bi.setAttribute("aria-hidden","true"),bi.dataset.provider="",bi.dataset.storeId="",bi.dataset.vectorId="",bi.dataset.logId="")},xo=rt=>{bi&&(bi.dataset.provider=rt.providerLabel||"",bi.dataset.storeId=rt.storeId||"",bi.dataset.vectorId=rt.vectorId||"",bi.dataset.logId=rt.logId||"",bi.classList.add("aipkit-active"),bi.setAttribute("aria-hidden","false"),yo&&(yo.disabled=!1))},Ni=async(rt,St,Ft,Ke,Kt)=>{let Ci=rt.toLowerCase();if(Ci==="openai"){let pt=Ri("aipkit_vector_store_nonce_openai");if(!pt)throw new Error("OpenAI nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:pt,target_store_id:St,text_content:Ft,source_type:"chatbot_training_text"});return}if(!Ke||!Kt){let pt=$();Ke=Ke||pt.vector_embedding_provider,Kt=Kt||pt.vector_embedding_model}if(!Ke||!Kt)throw new Error("Select an embedding provider and model.");let ci=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Ft,embedding_provider:Ke,embedding_model:Kt}),At=ci.embeddings&&ci.embeddings.length?ci.embeddings[0]:null;if(!At)throw new Error("Failed to generate embedding.");if(Ci==="pinecone"){let pt=Ri("aipkit_vector_store_pinecone_nonce_management");if(!pt)throw new Error("Pinecone nonce missing.");let jt=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:pt,vectors:JSON.stringify([{id:jt,values:At,metadata:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:Ft,vector_id:jt}}]),embedding_provider:Ke,embedding_model:Kt,original_text_content:Ft,index_name:St});return}if(Ci==="qdrant"){let pt=Ri("aipkit_vector_store_qdrant_nonce_management");if(!pt)throw new Error("Qdrant nonce missing.");let jt=l(),xi={_ajax_nonce:pt,vectors:JSON.stringify([{id:jt,vector:At,payload:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:Ft,vector_id:jt}}]),embedding_provider:Ke,embedding_model:Kt,original_text_content:Ft,collection_name:St,source_context:"chatbot_settings_sources_sheet"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",xi)}};pa&&pa.addEventListener("input",()=>{he&&window.clearTimeout(he),he=window.setTimeout(()=>{_e.search=pa.value.trim(),vi(1)},300)}),ko&&ko.addEventListener("change",()=>{_e.status=ko.value,vi(1)}),ua&&ua.addEventListener("click",()=>{vi(_e.page||1)}),cr&&cr.addEventListener("click",wn),_a&&_a.addEventListener("click",wn),di&&!di.dataset.bound&&(document.addEventListener("keydown",rt=>{rt.key==="Escape"&&di.classList.contains("aipkit-active")&&wn()}),di.dataset.bound="1"),Oa&&Oa.addEventListener("click",async()=>{if(!di||!ho)return;let rt=ho.value.trim();if(!rt){Be("Text cannot be empty.","error"),We();return}let St=di.dataset.provider||"",Ft=di.dataset.storeId||"",Ke=di.dataset.vectorId||"",Kt=di.dataset.logId||"",Ci=di.dataset.embeddingProvider||"",ci=di.dataset.embeddingModel||"";if(!St||!Ft||!Ke||!Kt){Be("Missing source details.","error"),We();return}if(wn(),On&&Kt){let At=typeof CSS<"u"&&CSS.escape?CSS.escape(String(Kt)):String(Kt).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),pt=On.querySelector(`tr[data-log-id="${At}"]`),jt=pt?pt.querySelector(".aipkit_sources_action_edit"):null,xi=pt?pt.querySelector(".aipkit_view_snippet_icon"):null,Qi=pt?pt.querySelector(".aipkit_sources_action_delete"):null;jt&&(jt.disabled=!0,jt.setAttribute("aria-disabled","true"),jt.textContent="Training..."),xi&&(xi.disabled=!0,xi.setAttribute("aria-disabled","true")),Qi&&(Qi.disabled=!0,Qi.setAttribute("aria-disabled","true"))}Be("Training...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:St,store_id:Ft,vector_id:Ke,log_id:Kt}),await Ni(St,Ft,rt,Ci,ci),Be("Trained","success"),We(),wn(),vi(_e.page||1),In($())}catch(At){Be(`Error: ${At.message||"Failed to save."}`,"error")}}),lr&&lr.addEventListener("click",Tn),yn&&yn.addEventListener("click",Tn),yo&&yo.addEventListener("click",async()=>{if(!bi)return;let rt=bi.dataset.provider||"",St=bi.dataset.storeId||"",Ft=bi.dataset.vectorId||"",Ke=bi.dataset.logId||"";if(!rt||!St||!Ft||!Ke){Be("Missing source details.","error"),We(),Tn();return}Tn();let Kt=null,Ci=null,ci=null,At=null,pt=null;if(On&&Ke){let jt=typeof CSS<"u"&&CSS.escape?CSS.escape(String(Ke)):String(Ke).replace(/[^a-zA-Z0-9_-]/g,"\\$&");Kt=On.querySelector(`tr[data-log-id="${jt}"]`),Kt&&(Ci=Kt.querySelector(".aipkit_sources_action_edit"),ci=Kt.querySelector(".aipkit_sources_action_retrain"),At=Kt.querySelector(".aipkit_view_snippet_icon"),pt=Kt.querySelector(".aipkit_sources_action_delete"),[Ci,ci,At,pt].forEach(xi=>{xi&&(xi.disabled=!0,xi.setAttribute("aria-disabled","true"))}),pt&&(pt.textContent="Deleting..."))}yo&&(yo.disabled=!0),Be("Deleting...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:rt,store_id:St,vector_id:Ft,log_id:Ke}),Be("Deleted","success"),We(),vi(_e.page||1),In($())}catch(jt){Be(`Error: ${jt.message||"Failed to delete."}`,"error"),[Ci,ci,At,pt].forEach(xi=>{xi&&(xi.disabled=!1,xi.removeAttribute("aria-disabled"))}),pt&&(pt.textContent="Delete")}finally{yo&&(yo.disabled=!1)}}),bi&&!bi.dataset.bound&&(document.addEventListener("keydown",rt=>{rt.key==="Escape"&&bi.classList.contains("aipkit-active")&&Tn()}),bi.dataset.bound="1"),Ji.addEventListener("click",async rt=>{let St=rt.target.closest(".aipkit_sources_action_edit");if(St){mn(St);return}let Ft=rt.target.closest(".aipkit_sources_action_delete");if(Ft){let Kt=Ft.dataset.provider||"",Ci=Ft.dataset.storeId||"",ci=Ft.dataset.vectorId||"",At=Ft.dataset.logId||"";if(!Kt||!Ci||!ci||!At){Be("Missing source details.","error"),We();return}xo({providerLabel:Kt,storeId:Ci,vectorId:ci,logId:At});return}let Ke=rt.target.closest(".aipkit_sources_action_retrain");if(Ke){let Kt=Ke.dataset.provider||"",Ci=Ke.dataset.storeId||"",ci=Ke.dataset.vectorId||"",At=Ke.dataset.logId||"",pt=Ke.dataset.postId||"",jt=Ke.dataset.embeddingProvider||"",xi=Ke.dataset.embeddingModel||"";if(!Kt||!Ci||!ci||!At||!pt){Be("Missing source details.","error"),We();return}Ke.disabled=!0,Ke.setAttribute("aria-disabled","true"),Ke.textContent="Training...";let Qi=Ke.closest("tr"),xn=Qi?Qi.querySelector(".aipkit_view_snippet_icon"):null,bn=Qi?Qi.querySelector(".aipkit_sources_action_delete"):null;xn&&(xn.disabled=!0,xn.setAttribute("aria-disabled","true")),bn&&(bn.disabled=!0,bn.setAttribute("aria-disabled","true")),Be("Retraining...","");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:Kt,store_id:Ci,vector_id:ci,log_id:At,post_id:pt,embedding_provider:jt,embedding_model:xi}),Be("Retrained","success"),We(),vi(_e.page||1),In($())}catch(no){Be(`Error: ${no.message||"Failed to retrain."}`,"error"),Ke.disabled=!1,Ke.removeAttribute("aria-disabled"),Ke.textContent="Retrain",xn&&(xn.disabled=!1,xn.removeAttribute("aria-disabled")),bn&&(bn.disabled=!1,bn.removeAttribute("aria-disabled"))}}}),t.dataset.sourcesSheetBound="1"}t.dataset.contextSettingsAutosaveBound="1"}let vr=Ye();if(vr&&$i&&!t.dataset.tokenLimitsAutosaveBound){let q=!1,P=null,$=()=>{let j=vr.querySelectorAll('input[name^="token_role_limits["]'),V={};return j.forEach(Y=>{let ce=Y.getAttribute("name");ce&&(V[ce]=Y.value)}),V},G=()=>{let j=V=>{let Y=vr.querySelector(V);return Y?Y.value:""};return{token_guest_limit:j('[name="token_guest_limit"]'),token_user_limit:j('[name="token_user_limit"]'),token_limit_mode:j('[name="token_limit_mode"]'),token_reset_period:j('[name="token_reset_period"]'),token_limit_message:j('[name="token_limit_message"]'),role_limits:$()}},Q=G(),X=j=>{let V=S&&S.value||t.getAttribute("data-active-bot-id");if(!V)return;q=!0,dt("Auto-saving...","");let Y={bot_id:V,token_guest_limit:j.token_guest_limit,token_user_limit:j.token_user_limit,token_limit_mode:j.token_limit_mode,token_reset_period:j.token_reset_period,token_limit_message:j.token_limit_message};Object.entries(j.role_limits).forEach(([ce,ge])=>{Y[ce]=ge}),window.aipkit_apiRequest("aipkit_update_chatbot_token_limits",Y).then(ce=>{Q=j,dt(ce.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(ce=>{dt(`Error: ${ce.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P){let ce=P;P=null,JSON.stringify(ce)!==JSON.stringify(Q)&&X(ce)}})},ie=j=>{if(JSON.stringify(j)!==JSON.stringify(Q)){if(q){P=j;return}X(j)}};vr.addEventListener("change",j=>{let V=j.target;if(V){if(V.matches(".aipkit_token_limit_mode_select")){Gi(),ie(G());return}(V.matches('[name="token_guest_limit"]')||V.matches('[name="token_user_limit"]')||V.matches('[name="token_reset_period"]')||V.matches('[name="token_limit_message"]')||V.matches('input[name^="token_role_limits["]'))&&ie(G())}}),t.dataset.tokenLimitsAutosaveBound="1"}let Vr=(N?N.querySelector('[data-aipkit-settings-panel="appearance"]'):null)||(F?F.querySelector('[data-aipkit-settings-panel="appearance"]'):null);if(Vr&&$i&&!t.dataset.styleSettingsAutosaveBound){let q=Vr;if(q){let P=!1,$=null,G=()=>{let Le=q.querySelector('[name="enable_conversation_starters"]'),ke=q.querySelector(".aipkit_starters_config_btn");if(!Le||!ke)return;let tt=!Le.disabled&&(Le.tagName==="SELECT"?Le.value==="1":!!Le.checked);ke.hidden=!tt,ke.disabled=!tt,ke.setAttribute("aria-disabled",tt?"false":"true"),tt||(ke.setAttribute("aria-expanded","false"),Tr())},Q=q.querySelector("[data-aipkit-interface-controls-dropdown]"),X=Q?Q.querySelector(".aipkit_popover_multiselect_btn"):null,ie=Q?Q.querySelector(".aipkit_popover_multiselect_label"):null,j=Q?Q.querySelector(".aipkit_popover_multiselect_panel"):null,V=Q?Array.from(Q.querySelectorAll(".aipkit_interface_control_option")):[],Y={};Array.from(q.querySelectorAll(".aipkit_interface_control_hidden_select")).forEach(Le=>{let ke=Le.getAttribute("name");ke&&(Y[ke]=Le)});let ce=q.querySelector(".aipkit_interface_control_option--sidebar"),ge=ce?ce.closest(".aipkit_interface_control_item--sidebar"):null,Te=t.querySelector("[data-aipkit-top-mode-select]"),Je=Le=>Le?Le.tagName==="SELECT"?Le.value==="1":!!Le.checked:!1,ht=(Le,ke)=>{if(!Le||Le.disabled)return;let tt=!!ke;Je(Le)!==tt&&(Le.tagName==="SELECT"?Le.value=tt?"1":"0":Le.checked=tt,Le.dispatchEvent(new Event("change",{bubbles:!0})))},It=()=>{ie&&(ie.textContent=qa(V,Q,"Select controls",2))},Ot=()=>{V.forEach(Le=>{if(!Le)return;let ke=Y[Le.value];ke&&(Le.checked=Je(ke))}),It()},Li=()=>{V.forEach(Le=>{if(!Le||Le.disabled)return;let ke=Y[Le.value];ke&&ht(ke,Le.checked)}),It()},kt=()=>{if(!ce||!ge)return;let Le=Y.enable_conversation_sidebar,ke=Le?Le.disabled:Te?Te.value==="popup"||Te.value==="external":!1,tt=ge.getAttribute("data-tooltip-disabled")||"";ke?(ce.disabled=!0,ge.classList.add("is-disabled"),tt&&ge.setAttribute("title",tt)):(ce.disabled=!1,ge.classList.remove("is-disabled"),ge.removeAttribute("title"))},yi=()=>{!X||!j||(X.setAttribute("aria-expanded","false"),j.hidden=!0,Q.classList.remove("is-open"),Kn())};Q&&X&&j&&!Q.dataset.bound&&(X.addEventListener("click",Le=>{if(Le.preventDefault(),X.getAttribute("aria-expanded")==="true"){yi();return}X.setAttribute("aria-expanded","true"),j.hidden=!1,Q.classList.add("is-open"),Kn()}),V.forEach(Le=>{Le.addEventListener("change",()=>{Li()})}),document.addEventListener("click",Le=>{Q.contains(Le.target)||yi()}),document.addEventListener("keydown",Le=>{Le.key==="Escape"&&yi()}),Object.values(Y).forEach(Le=>{Le.addEventListener("change",()=>{kt(),Ot()})}),Te&&Te.dataset.interfaceControlsBound!=="1"&&(Te.addEventListener("change",()=>{window.requestAnimationFrame(()=>{kt(),Ot()})}),Te.dataset.interfaceControlsBound="1"),kt(),Ot(),Q.dataset.bound="1"),cn&&to&&ma&&Fi&&!cn.dataset.bound&&(to.addEventListener("click",Le=>{if(Le.preventDefault(),to.getAttribute("aria-expanded")==="true"){Qo();return}to.setAttribute("aria-expanded","true"),ma.hidden=!1,cn.classList.add("is-open"),Kn(),gr()}),Ln.forEach(Le=>{Le.addEventListener("change",()=>{Le.checked&&(Or(Le),Qo())})}),document.addEventListener("click",Le=>{cn&&!cn.contains(Le.target)&&Qo()}),document.addEventListener("keydown",Le=>{Le.key==="Escape"&&Qo()}),cn.dataset.bound="1"),Fi&&Fi.dataset.themeDropdownBound!=="1"&&(Fi.addEventListener("change",()=>{gr()}),Fi.dataset.themeDropdownBound="1"),qi&&qi.dataset.bound!=="1"&&(qi.addEventListener("click",Le=>{if(Le.preventDefault(),qi.hidden||qi.disabled)return;let ke=Ln.find(qe=>{let ct=qe.getAttribute("data-theme-value")||qe.value||"",bt=qe.getAttribute("data-preset-key")||"";return ct==="custom"&&bt===""});if(ke&&!ke.disabled&&(ke.checked||(ke.checked=!0,Or(ke))),Qo(),Mt&&Mt.classList.contains("is-open")&&ki===qi){Jo();return}Hr(qi)}),qi.dataset.bound="1"),gr();let Xt=()=>{let Le={},ke=Ei=>{let Yi=q.querySelector(Ei);return!Yi||Yi.disabled?null:Yi.value||""},tt=Ei=>!Ei||Ei.disabled?null:Ei.tagName==="SELECT"?Ei.value==="1"?"1":"0":Ei.checked?"1":"0",Ce=q.querySelector('select[name="theme"]');if(Ce&&!Ce.disabled)Le.theme=Ce.value||"light";else{let Ei=q.querySelector('input[name="theme"]:checked');if(Ei&&!Ei.disabled)Le.theme=Ei.value||"light";else{let Yi=t.querySelector('input[name="theme"]:checked, select[name="theme"]');Yi&&!Yi.disabled&&(Le.theme=Yi.value||"light")}}let qe="";if((Le.theme||"")==="custom"&&(vo&&!vo.disabled&&(qe=vo.value||""),!qe&&Ce&&!Ce.disabled)){let Ei=Ce.selectedOptions&&Ce.selectedOptions.length?Ce.selectedOptions[0]:null;qe=Ei&&Ei.dataset&&Ei.dataset.presetKey?Ei.dataset.presetKey:""}Le.theme_preset_key=qe;let ct=ke('input[name="greeting"]');ct!==null&&(Le.greeting=ct);let bt=ke('input[name="subgreeting"]');bt!==null&&(Le.subgreeting=bt);let ri=ke('input[name="input_placeholder"]');ri!==null&&(Le.input_placeholder=ri);let Zt=ke('input[name="footer_text"]');Zt!==null&&(Le.footer_text=Zt);let si=ke('input[name="custom_typing_text"]');si!==null&&(Le.custom_typing_text=si);let zt=Ei=>{let Yi=q.querySelector(`[name="${Ei}"]`);if(!(!Yi||Yi.disabled)){if(Yi.tagName==="SELECT"){Le[Ei]=Yi.value==="1"?"1":"0";return}Le[Ei]=Yi.checked?"1":"0"}};zt("enable_download"),zt("enable_copy_button"),zt("enable_fullscreen"),zt("enable_feedback"),zt("enable_conversation_sidebar"),zt("enable_conversation_starters");let Pi=S&&S.value||t.getAttribute("data-active-bot-id");if(Pi){let Ei=document.getElementById(`aipkit_bot_${Pi}_enable_consent_compliance`),Yi=tt(Ei);Yi!==null&&(Le.enable_consent_compliance=Yi);let Co=document.getElementById(`aipkit_bot_${Pi}_enable_ip_anonymization`),lo=tt(Co);lo!==null&&(Le.enable_ip_anonymization=lo);let jn=document.getElementById(`aipkit_bot_${Pi}_consent_title`);jn&&!jn.disabled&&(Le.consent_title=jn.value||"");let Hn=document.getElementById(`aipkit_bot_${Pi}_consent_message`);Hn&&!Hn.disabled&&(Le.consent_message=Hn.value||"");let Xa=document.getElementById(`aipkit_bot_${Pi}_consent_button`);Xa&&!Xa.disabled&&(Le.consent_button=Xa.value||"");let br=document.getElementById(`aipkit_bot_${Pi}_openai_moderation_enabled`),Sr=tt(br);Sr!==null&&(Le.openai_moderation_enabled=Sr);let Sa=document.getElementById(`aipkit_bot_${Pi}_openai_moderation_message`);Sa&&!Sa.disabled&&(Le.openai_moderation_message=Sa.value||"");let on=document.getElementById(`aipkit_bot_${Pi}_banned_words`);on&&!on.disabled&&(Le.banned_words=on.value||"");let Xo=document.getElementById(`aipkit_bot_${Pi}_banned_words_message`);Xo&&!Xo.disabled&&(Le.banned_words_message=Xo.value||"");let Zo=document.getElementById(`aipkit_bot_${Pi}_banned_ips`);Zo&&!Zo.disabled&&(Le.banned_ips=Zo.value||"");let po=document.getElementById(`aipkit_bot_${Pi}_banned_ips_message`);po&&!po.disabled&&(Le.banned_ips_message=po.value||"");let In=document.getElementById(`aipkit_bot_${Pi}_custom_theme_settings_container`);In&&In.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(Ri=>{let Ea=Ri.getAttribute("name");Ea&&(Ri.type==="checkbox"?Le[Ea]=Ri.checked?"1":"0":Ri.type==="radio"?Ri.checked&&(Le[Ea]=Ri.value):Le[Ea]=Ri.value)});let Za=document.getElementById(`aipkit_bot_${Pi}_conversation_starters`);Za&&!Za.disabled&&(Le.conversation_starters=Za.value||"")}return Le},Ct=Xt(),Gt=Le=>{let ke=S&&S.value||t.getAttribute("data-active-bot-id");ke&&(P=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_style_settings",{bot_id:ke,...Le}).then(tt=>{Ct=Le,dt(tt.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ke),Oi()}).catch(tt=>{dt(`Error: ${tt.message||"Failed to save."}`,"error")}).finally(()=>{if(P=!1,$){let tt=$;$=null,JSON.stringify(tt)!==JSON.stringify(Ct)&&Gt(tt)}}))},_t=Le=>{if(JSON.stringify(Le)!==JSON.stringify(Ct)){if(P){$=Le;return}Gt(Le)}};q.addEventListener("change",Le=>{let ke=Le.target;if(ke&&((ke.matches('input[name="enable_conversation_starters"]')||ke.matches('select[name="enable_conversation_starters"]'))&&G(),ke.matches('input[name="greeting"]')||ke.matches('input[name="subgreeting"]')||ke.matches('input[name="input_placeholder"]')||ke.matches('input[name="footer_text"]')||ke.matches('input[name="custom_typing_text"]')||ke.matches('input[name="enable_download"]')||ke.matches('input[name="enable_copy_button"]')||ke.matches('input[name="enable_fullscreen"]')||ke.matches('input[name="enable_feedback"]')||ke.matches('input[name="enable_conversation_sidebar"]')||ke.matches('input[name="enable_conversation_starters"]')||ke.matches('select[name="enable_download"]')||ke.matches('select[name="enable_copy_button"]')||ke.matches('select[name="enable_fullscreen"]')||ke.matches('select[name="enable_feedback"]')||ke.matches('select[name="enable_conversation_sidebar"]')||ke.matches('select[name="enable_conversation_starters"]')||ke.matches('select[name="theme"]')||ke.matches('input[name="theme"]'))){if((ke.matches('select[name="theme"]')||ke.matches('input[name="theme"]'))&&typeof Jo=="function")if(ke.value!=="custom")Jo();else{let Ce=ke.matches&&ke.matches('select[name="theme"]')&&ke.selectedOptions&&ke.selectedOptions.length?ke.selectedOptions[0]:null;if(!!(Ce&&Ce.dataset&&Ce.dataset.presetKey))Jo();else{let ct=q.querySelector(".aipkit_theme_config_btn:not([hidden])")||q.querySelector("[data-aipkit-theme-dropdown] .aipkit_popover_multiselect_btn")||ke.closest(".aipkit_theme_choice_card")||ke;Hr(ct)}}_t(Xt())}}),G(),t.addEventListener("change",Le=>{let ke=Le.target;!ke||!ke.matches||!ke.matches('select[name="theme"]')&&!ke.matches('input[name="theme"]')||q.contains(ke)||_t(Xt())}),t.dataset.customThemeAutosaveBound||(document.addEventListener("change",Le=>{let ke=Le.target;ke&&ke.matches&&ke.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')&&(!(document.documentElement.dataset.aipkitApplyingThemePreset==="1")&&(Fi?.value||"")==="custom"&&Yr(),_t(Xt()))}),t.dataset.customThemeAutosaveBound="1"),q.addEventListener("blur",Le=>{let ke=Le.target;ke&&(ke.matches('input[name="greeting"]')||ke.matches('input[name="subgreeting"]')||ke.matches('input[name="input_placeholder"]')||ke.matches('input[name="footer_text"]')||ke.matches('input[name="custom_typing_text"]'))&&_t(Xt())},!0),document.addEventListener("change",Le=>{let ke=Le.target;ke&&ke.matches('textarea[name="conversation_starters"], [name="enable_consent_compliance"], [name="enable_ip_anonymization"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], [name="openai_moderation_enabled"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&(ke.matches('[name="enable_consent_compliance"]')&&Dr(),ke.matches('[name="openai_moderation_enabled"]')&&Wr(),_t(Xt()))}),document.addEventListener("blur",Le=>{let ke=Le.target;ke&&ke.matches('textarea[name="conversation_starters"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&_t(Xt())},!0),t.dataset.styleSettingsAutosaveBound="1"}}if(O&&$i&&!t.dataset.imageSettingsAutosaveBound){let q=!1,P=null;Zi&&ro&&jo&&tn&&!Zi.dataset.bound&&(ro.addEventListener("click",j=>{if(j.preventDefault(),ro.getAttribute("aria-expanded")==="true"){va();return}Qo(),ya(),ro.setAttribute("aria-expanded","true"),jo.hidden=!1,Zi.classList.add("is-open"),Kn(),kr()}),ga.forEach(j=>{j.addEventListener("change",()=>{j.checked&&(Xr(j),va())})}),document.addEventListener("click",j=>{Zi&&!Zi.contains(j.target)&&va()}),document.addEventListener("keydown",j=>{j.key==="Escape"&&va()}),Zi.dataset.bound="1"),tn&&tn.dataset.imageModelDropdownBound!=="1"&&(tn.addEventListener("change",()=>{kr()}),tn.dataset.imageModelDropdownBound="1"),kr(),Gn&&Nn&&!Gn.dataset.bound&&(Gn.addEventListener("click",j=>{if(j.preventDefault(),Gn.getAttribute("aria-expanded")==="true"){ba();return}Qo(),ya(),va(),Gn.setAttribute("aria-expanded","true"),Nn.hidden=!1,Nn.classList.add("is-open"),Kn()}),Va&&Va.addEventListener("click",j=>{j.preventDefault(),ba()}),document.addEventListener("click",j=>{Nn.classList.contains("is-open")&&(Gn.contains(j.target)||Nn.contains(j.target)||ba())}),document.addEventListener("keydown",j=>{j.key==="Escape"&&ba()}),Gn.dataset.bound="1");let $=()=>{let j=z&&z.querySelector('select[name="chat_image_model_id"]')||R&&R.querySelector('select[name="chat_image_model_id"]')||O.querySelector('select[name="chat_image_model_id"]'),V=z&&z.querySelector('input[name="image_triggers"]')||z&&z.querySelector('textarea[name="image_triggers"]')||R&&R.querySelector('input[name="image_triggers"]')||R&&R.querySelector('textarea[name="image_triggers"]')||O.querySelector('input[name="image_triggers"]')||O.querySelector('textarea[name="image_triggers"]');if(!j||!V)return null;let Y=z&&z.querySelector(".aipkit_image_analysis_select")||R&&R.querySelector(".aipkit_image_analysis_select")||O.querySelector(".aipkit_image_analysis_select"),ce=z&&z.querySelector(".aipkit_image_analysis_checkbox")||R&&R.querySelector(".aipkit_image_analysis_checkbox")||O.querySelector(".aipkit_image_analysis_checkbox"),ge=Y&&Y.value!==""?Y.value:ce&&ce.checked?"1":"0";return{chat_image_model_id:j.value||"",image_triggers:V.value||"",enable_image_upload:ge}},G=$()||{},Q=j=>{let V=S&&S.value||t.getAttribute("data-active-bot-id");V&&(q=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_image_settings",{bot_id:V,...j}).then(Y=>{G=j,dt(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{dt(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P){let Y=P;P=null,JSON.stringify(Y)!==JSON.stringify(G)&&Q(Y)}}))},X=j=>{if(j&&JSON.stringify(j)!==JSON.stringify(G)){if(q){P=j;return}Q(j)}},ie=j=>{let V=j.target;V&&(V.matches('select[name="chat_image_model_id"]')||V.matches('input[name="image_triggers"]')||V.matches('textarea[name="image_triggers"]')||V.matches(".aipkit_image_analysis_checkbox")||V.matches(".aipkit_image_analysis_select"))&&X($())};O.addEventListener("change",ie),R&&R.addEventListener("change",ie),z&&z.addEventListener("change",ie),t.dataset.imageSettingsAutosaveBound="1"}if(O&&$i&&!t.dataset.replicateKeyAutosaveBound){let P=z&&z.querySelector('input[name="replicate_api_key"]')||R&&R.querySelector('input[name="replicate_api_key"]')||O.querySelector('input[name="replicate_api_key"]');if(P){let $=!1,G=null,Q=P.value||"",X=V=>{$=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:V}).then(Y=>{Q=V,dt(Y.message||"Saved","success"),Oi(),Ua(V)}).catch(Y=>{dt(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if($=!1,G!==null){let Y=G;G=null,Y!==Q&&X(Y)}})},ie=V=>{if(V!==Q){if($){G=V;return}X(V)}},j=V=>{let Y=V.target;!Y||!Y.matches('input[name="replicate_api_key"]')||ie(Y.value||"")};O.addEventListener("change",j),O.addEventListener("blur",j,!0),R&&(R.addEventListener("change",j),R.addEventListener("blur",j,!0)),z&&(z.addEventListener("change",j),z.addEventListener("blur",j,!0)),t.dataset.replicateKeyAutosaveBound="1"}}if(Xe&&$i&&!t.dataset.audioSettingsAutosaveBound){let q=!1,P=null,$=()=>{let Ce=zt=>{let Pi=Xe.querySelector(zt);return Pi?Pi.value:null},qe=zt=>zt?zt.tagName==="SELECT"?zt.value:zt.type==="checkbox"?zt.checked?"1":"0":zt.value?zt.value:"0":null,ct=zt=>qe(t.querySelector(zt)),bt={},ri=ct(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch");if(ri!==null){bt.enable_voice_input=ri;let zt=Ce('[name="stt_provider"]');zt!==null&&(bt.stt_provider=zt);let Pi=Ce('[name="stt_openai_model_id"]');Pi!==null&&(bt.stt_openai_model_id=Pi)}let Zt=ct(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch");if(Zt!==null){bt.tts_enabled=Zt;let zt=qe('[name="tts_auto_play"]');zt!==null&&(bt.tts_auto_play=zt);let Pi=Ce('[name="tts_provider"]');Pi!==null&&(bt.tts_provider=Pi);let Ei=Ce('[name="tts_google_voice_id"]');Ei!==null&&(bt.tts_google_voice_id=Ei);let Yi=Ce('[name="tts_openai_voice_id"]');Yi!==null&&(bt.tts_openai_voice_id=Yi);let Co=Ce('[name="tts_openai_model_id"]');Co!==null&&(bt.tts_openai_model_id=Co);let lo=Ce('[name="tts_elevenlabs_voice_id"]');lo!==null&&(bt.tts_elevenlabs_voice_id=lo);let jn=Ce('[name="tts_elevenlabs_model_id"]');jn!==null&&(bt.tts_elevenlabs_model_id=jn)}let si=ct(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle");if(si!==null){bt.enable_realtime_voice=si;let zt=qe('[name="direct_voice_mode"]');zt!==null&&(bt.direct_voice_mode=zt);let Pi=qe('[name="input_audio_noise_reduction"]');Pi!==null&&(bt.input_audio_noise_reduction=Pi);let Ei=Ce('[name="realtime_model"]');Ei!==null&&(bt.realtime_model=Ei);let Yi=Ce('[name="realtime_voice"]');Yi!==null&&(bt.realtime_voice=Yi);let Co=Ce('[name="turn_detection"]');Co!==null&&(bt.turn_detection=Co);let lo=Ce('[name="input_audio_format"]');lo!==null&&(bt.input_audio_format=lo);let jn=Ce('[name="output_audio_format"]');jn!==null&&(bt.output_audio_format=jn);let Hn=Ce('[name="speed"]');Hn!==null&&(bt.speed=Hn)}return bt},G=$(),X=(()=>{let Ce=Xe.querySelector('[name="elevenlabs_api_key"]');return Ce?Ce.value:""})(),ie=!1,j=null,V=!1,Y=Xe.querySelector(".aipkit_tts_sync_status"),ce=(Ce,qe,ct)=>{Y&&(Y.textContent=Ce||"",Y.classList.remove("success","error","loading"),qe&&Y.classList.add(qe),ct?Y.setAttribute("title",ct):Y.removeAttribute("title"),Y.style.display=Ce?"inline-block":"none")},ge=(Ce=2500)=>{Y&&setTimeout(()=>{ce("")},Ce)},Te=()=>{let Ce=Xe.querySelector('[name="tts_provider"]');return Ce?Ce.value:""},Je=()=>{let Ce=Xe.querySelector(".aipkit_tts_toggle_switch");return Ce?Ce.tagName==="SELECT"?Ce.value==="1":!!Ce.checked:!1},ht=()=>{let Ce=Xe.querySelector('select[name="tts_google_voice_id"]');return!Ce||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_updateGoogleVoiceSelect!="function"||V?Promise.resolve():(V=!0,ce("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(qe=>{if(!qe||!qe.voices)throw new Error("Invalid response received from voice sync.");let ct=Ce.value||"";window.aipkit_updateGoogleVoiceSelect(Ce.id,qe.voices,ct);let bt=document.getElementById("aipkit_google_tts_voices_json_main");bt&&(bt.dataset.voices=JSON.stringify(qe.voices)),ce(qe.message||"Synced","success"),ge()}).catch(qe=>{let ct=qe?.message||"Sync failed.";throw ce(ct,"error",ct),ge(5e3),qe}).finally(()=>{V=!1}))},It=()=>{let Ce=_t();if(!Ce||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect!="function"||typeof window.aipkit_chatTts_updateElevenLabsModelsSelect!="function")return Promise.resolve();let qe=Xe.querySelector('select[name="tts_elevenlabs_voice_id"]'),ct=Xe.querySelector('select[name="tts_elevenlabs_model_id"]');if(!qe&&!ct||V)return Promise.resolve();V=!0,ce("Syncing...","loading");let bt=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabs"}).then(Zt=>{let si=Zt?.models||[];qe&&window.aipkit_chatTts_updateElevenLabsVoiceSelect(qe.id,si,qe.value||"");let zt=document.getElementById(`aipkit_elevenlabs_voices_json_${Ce}`);zt&&(zt.dataset.voices=JSON.stringify(si))}),ri=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabsModels"}).then(Zt=>{let si=Zt?.models||[];ct&&window.aipkit_chatTts_updateElevenLabsModelsSelect(ct.id,si,ct.value||"");let zt=document.getElementById(`aipkit_elevenlabs_models_json_${Ce}`);zt&&(zt.dataset.models=JSON.stringify(si))});return Promise.allSettled([bt,ri]).then(Zt=>{let si=Zt.find(zt=>zt.status==="rejected");if(si){let zt=si.reason?.message||"Sync failed.";throw ce(zt,"error",zt),ge(5e3),si.reason}return ce("Synced","success"),ge(),Zt}).finally(()=>{V=!1})},Ot=Ce=>{try{let qe=Ce?JSON.parse(Ce):[];return Array.isArray(qe)&&qe.length>0}catch{return!1}},Li=Ce=>Ce?!!(Ce.options&&Ce.options.length>1):!1,kt=()=>{let Ce=Xe.querySelector('select[name="tts_google_voice_id"]'),qe=document.getElementById("aipkit_google_tts_voices_json_main");return!Ot(qe?.dataset?.voices)||!Li(Ce)},yi=()=>{let Ce=_t();if(!Ce)return!1;let qe=Xe.querySelector('select[name="tts_elevenlabs_voice_id"]'),ct=Xe.querySelector('select[name="tts_elevenlabs_model_id"]'),bt=document.getElementById(`aipkit_elevenlabs_voices_json_${Ce}`),ri=document.getElementById(`aipkit_elevenlabs_models_json_${Ce}`),Zt=Ot(bt?.dataset?.voices),si=Ot(ri?.dataset?.models);return!Zt||!si||!Li(qe)||!Li(ct)},Xt=()=>{if(!Je())return Promise.resolve();let Ce=Te();return Ce==="Google"?kt()?ht():Promise.resolve():Ce==="ElevenLabs"&&yi()?It():Promise.resolve()};window.aipkit_syncAudioTtsOnOpen=Xt;let Ct=Ce=>{Ce!=null&&(ie=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{elevenlabs_api_key:Ce}).then(qe=>{X=Ce,dt(qe.message||"Saved","success"),Oi(),Te()==="ElevenLabs"&&Je()&&It().catch(()=>{})}).catch(qe=>{dt(`Error: ${qe.message||"Failed to save."}`,"error")}).finally(()=>{if(ie=!1,j!==null){let qe=j;j=null,qe!==X&&Ct(qe)}}))},Gt=Ce=>{if(Ce!=null&&Ce!==X){if(ie){j=Ce;return}Ct(Ce)}},_t=()=>S&&S.value||t.getAttribute("data-active-bot-id"),Le=()=>{let Ce=_t();Xe.querySelectorAll(".aipkit_audio_format_combo_select").forEach(Zt=>{let si=Zt.closest(".aipkit_popover_option_row"),zt=si?.querySelector('[name="input_audio_format"]'),Pi=si?.querySelector('[name="output_audio_format"]'),Ei=Zt.querySelector('option[value="current"]');!zt||!Pi||!Ei||(Ei.textContent=`In: ${zt.value} / Out: ${Pi.value}`,Zt.value="current")});let ct=Xe.querySelector('select[name="tts_google_voice_id"]');if(ct&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let Zt=document.getElementById("aipkit_google_tts_voices_json_main");try{let si=Zt?.dataset?.voices?JSON.parse(Zt.dataset.voices):[];window.aipkit_updateGoogleVoiceSelect(ct.id,si,ct.value||"")}catch(si){console.warn("AIPKit Builder: Failed to parse Google TTS voices data.",si)}}let bt=Xe.querySelector('select[name="tts_elevenlabs_voice_id"]');if(Ce&&bt&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){let Zt=document.getElementById(`aipkit_elevenlabs_voices_json_${Ce}`);try{let si=Zt?.dataset?.voices?JSON.parse(Zt.dataset.voices):[];window.aipkit_chatTts_updateElevenLabsVoiceSelect(bt.id,si,bt.value||"")}catch(si){console.warn("AIPKit Builder: Failed to parse ElevenLabs voices data.",si)}}let ri=Xe.querySelector('select[name="tts_elevenlabs_model_id"]');if(Ce&&ri&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){let Zt=document.getElementById(`aipkit_elevenlabs_models_json_${Ce}`);try{let si=Zt?.dataset?.models?JSON.parse(Zt.dataset.models):[];window.aipkit_chatTts_updateElevenLabsModelsSelect(ri.id,si,ri.value||"")}catch(si){console.warn("AIPKit Builder: Failed to parse ElevenLabs models data.",si)}}},ke=Ce=>{let qe=_t();qe&&(q=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_audio_settings",{bot_id:qe,...Ce}).then(ct=>{G=Ce,dt(ct.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(qe),Oi()}).catch(ct=>{dt(`Error: ${ct.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P){let ct=P;P=null,JSON.stringify(ct)!==JSON.stringify(G)&&ke(ct)}}))},tt=Ce=>{if(!(!Ce||Object.keys(Ce).length===0)&&JSON.stringify(Ce)!==JSON.stringify(G)){if(q){P=Ce;return}ke(Ce)}};t.addEventListener("change",Ce=>{let qe=Ce.target;!qe||!(qe.matches(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch")||qe.matches(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch")||qe.matches(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle"))||(Pn(),tt($()))}),Xe.addEventListener("change",Ce=>{let qe=Ce.target;if(qe){if(qe.matches(".aipkit_audio_format_combo_select")){let ct=qe.closest(".aipkit_popover_option_row"),bt=ct?.querySelector('[name="input_audio_format"]'),ri=ct?.querySelector('[name="output_audio_format"]'),Zt=qe.querySelector('option[value="current"]'),si=qe.value||"";if(!bt||!ri||!Zt||!si)return;si.startsWith("in:")?bt.value=si.replace("in:",""):si.startsWith("out:")&&(ri.value=si.replace("out:","")),Zt.textContent=`In: ${bt.value} / Out: ${ri.value}`,qe.value="current",bt.dispatchEvent(new Event("change",{bubbles:!0})),ri.dispatchEvent(new Event("change",{bubbles:!0}));return}if(qe.matches('[name="elevenlabs_api_key"]')){Gt(qe.value);return}if((qe.matches(".aipkit_voice_input_toggle_switch")||qe.matches(".aipkit_stt_provider_select")||qe.matches('[name="stt_openai_model_id"]')||qe.matches(".aipkit_tts_toggle_switch")||qe.matches('[name="tts_auto_play"]')||qe.matches(".aipkit_tts_provider_select")||qe.matches('[name="tts_google_voice_id"]')||qe.matches('[name="tts_openai_voice_id"]')||qe.matches('[name="tts_openai_model_id"]')||qe.matches('[name="tts_elevenlabs_voice_id"]')||qe.matches('[name="tts_elevenlabs_model_id"]')||qe.matches(".aipkit_enable_realtime_voice_toggle")||qe.matches('[name="direct_voice_mode"]')||qe.matches('[name="input_audio_noise_reduction"]')||qe.matches('[name="realtime_model"]')||qe.matches('[name="realtime_voice"]')||qe.matches('[name="turn_detection"]')||qe.matches('[name="input_audio_format"]')||qe.matches('[name="output_audio_format"]')||qe.matches('[name="speed"]'))&&(Pn(),tt($()),qe.matches(".aipkit_tts_provider_select")&&Je())){let ct=Te();ct==="Google"?ht().catch(()=>{}):ct==="ElevenLabs"&&It().catch(()=>{})}}}),Pn(),Le(),t.dataset.audioSettingsAutosaveBound="1"}if(zi&&$i&&!t.dataset.popupSettingsAutosaveBound){let q=!1,P=null;en&&ao&&Ui&&!en.dataset.bound&&(ao.addEventListener("click",j=>{if(j.preventDefault(),ao.getAttribute("aria-expanded")==="true"){ya();return}ao.setAttribute("aria-expanded","true"),Ui.hidden=!1,en.classList.add("is-open"),Kn(),hr()}),vn.forEach(j=>{j.addEventListener("change",()=>{j.checked&&Zr(j)})}),Object.values(sn).forEach(j=>{j.addEventListener("change",()=>{hr()})}),document.addEventListener("click",j=>{en&&!en.contains(j.target)&&ya()}),document.addEventListener("keydown",j=>{j.key==="Escape"&&ya()}),hr(),en.dataset.bound="1");let $=()=>{let j=ri=>zi&&zi.querySelector(ri)||Oe&&Oe.querySelector(ri)||t.querySelector(ri),V=ri=>{let Zt=j(ri);return Zt?Zt.value:null},Y=ri=>{let Zt=j(ri);return Zt?Zt.checked?"1":"0":null},ce={},ge=V('[name="popup_position"]');ge!==null&&(ce.popup_position=ge);let Te=V('[name="popup_delay"]');Te!==null&&(ce.popup_delay=Te);let Je=V('[name="popup_icon_style"]');Je!==null&&(ce.popup_icon_style=Je);let ht=V('[name="popup_icon_size"]');ht!==null&&(ce.popup_icon_size=ht);let It=V('[name="popup_icon_default"]:checked');if(It!==null)It==="__custom__"?ce.popup_icon_type="custom":(ce.popup_icon_type="default",ce.popup_icon_default=It);else{let ri=V('[name="popup_icon_type"]');ri!==null&&(ce.popup_icon_type=ri)}let Ot=V('[name="popup_icon_custom_url"]');Ot!==null&&(ce.popup_icon_custom_url=Ot);let Li=V('[name="header_avatar_default"]:checked');if(Li!==null)Li==="__custom__"?ce.header_avatar_type="custom":(ce.header_avatar_type="default",ce.header_avatar_default=Li);else{let ri=V('[name="header_avatar_type"]');ri!==null&&(ce.header_avatar_type=ri)}let kt=V('[name="header_avatar_url"]');kt!==null&&(ce.header_avatar_url=kt);let yi=V('[name="header_online_text"]');yi!==null&&(ce.header_online_text=yi);let Xt=Y('[name="popup_label_enabled"]');Xt!==null&&(ce.popup_label_enabled=Xt);let Ct=V('[name="popup_label_text"]');Ct!==null&&(ce.popup_label_text=Ct);let Gt=V('[name="popup_label_mode"]');Gt!==null&&(ce.popup_label_mode=Gt);let _t=V('[name="popup_label_size"]');_t!==null&&(ce.popup_label_size=_t);let Le=V('[name="popup_label_delay_seconds"]');Le!==null&&(ce.popup_label_delay_seconds=Le);let ke=V('[name="popup_label_auto_hide_seconds"]');ke!==null&&(ce.popup_label_auto_hide_seconds=ke);let tt=Y('[name="popup_label_dismissible"]');tt!==null&&(ce.popup_label_dismissible=tt);let Ce=Y('[name="popup_label_show_on_desktop"]');Ce!==null&&(ce.popup_label_show_on_desktop=Ce);let qe=Y('[name="popup_label_show_on_mobile"]');qe!==null&&(ce.popup_label_show_on_mobile=qe);let ct=V('[name="popup_label_frequency"]');ct!==null&&(ce.popup_label_frequency=ct);let bt=V('[name="popup_label_version"]');return bt!==null&&(ce.popup_label_version=bt),ce},G=$(),Q=()=>S&&S.value||t.getAttribute("data-active-bot-id"),X=j=>{let V=Q();V&&(q=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_popup_settings",{bot_id:V,...j}).then(Y=>{G=j,dt(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{dt(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P){let Y=P;P=null,JSON.stringify(Y)!==JSON.stringify(G)&&X(Y)}}))},ie=j=>{if(!(!j||Object.keys(j).length===0)&&JSON.stringify(j)!==JSON.stringify(G)){if(q){P=j;return}X(j)}};zi.addEventListener("change",j=>{let V=j.target;V&&((V.matches('[name="popup_icon_default"]')||V.matches('select[name="popup_icon_style"]')||V.matches('[name="header_avatar_default"]')||V.matches(".aipkit_popup_hint_toggle_switch"))&&Qa(),(V.matches('[name="popup_position"]')||V.matches('[name="popup_delay"]')||V.matches('[name="popup_icon_style"]')||V.matches('[name="popup_icon_size"]')||V.matches('[name="popup_icon_default"]')||V.matches('[name="popup_icon_custom_url"]')||V.matches('[name="header_avatar_default"]')||V.matches('[name="header_avatar_url"]')||V.matches('[name="header_online_text"]')||V.matches('[name="popup_label_enabled"]')||V.matches('[name="popup_label_text"]')||V.matches('[name="popup_label_mode"]')||V.matches('[name="popup_label_size"]')||V.matches('[name="popup_label_delay_seconds"]')||V.matches('[name="popup_label_auto_hide_seconds"]')||V.matches('[name="popup_label_dismissible"]')||V.matches('[name="popup_label_show_on_desktop"]')||V.matches('[name="popup_label_show_on_mobile"]')||V.matches('[name="popup_label_frequency"]')||V.matches('[name="popup_label_version"]'))&&ie($()))}),t.addEventListener("change",j=>{let V=j.target;!V||!V.matches||!(V.matches('[name="header_online_text"]')||V.matches('[name="popup_delay"]')||V.matches('[name="popup_label_enabled"]')||V.matches(".aipkit_popup_hint_toggle_switch")||V.matches('select[name="popup_position"]')||V.matches('select[name="popup_icon_style"]')||V.matches('select[name="popup_icon_size"]'))||((V.matches('[name="popup_label_enabled"]')||V.matches(".aipkit_popup_hint_toggle_switch"))&&Qa(),!zi.contains(V)&&ie($()))}),Oe&&Oe.addEventListener("change",j=>{let V=j.target;V&&(V.matches('[name="popup_label_text"]')||V.matches('[name="popup_label_mode"]')||V.matches('[name="popup_label_size"]')||V.matches('[name="popup_label_delay_seconds"]')||V.matches('[name="popup_label_auto_hide_seconds"]')||V.matches('[name="popup_label_dismissible"]')||V.matches('[name="popup_label_show_on_desktop"]')||V.matches('[name="popup_label_show_on_mobile"]')||V.matches('[name="popup_label_frequency"]')||V.matches('[name="popup_label_version"]'))&&ie($())}),Qa(),t.dataset.popupSettingsAutosaveBound="1"}if(R&&$i&&!t.dataset.conversationSettingsAutosaveBound){let q=!1,P=null,$=()=>{let j=Y=>{let ce=R&&R.querySelector(Y)||ue&&ue.querySelector(Y);return ce?ce.value:""},V=Y=>{let ce=R.querySelector(Y);return ce?ce.tagName==="SELECT"?ce.value==="1"?"1":"0":ce.checked?"1":"0":"0"};return{stream_enabled:V(".aipkit_stream_enable_toggle"),openai_conversation_state_enabled:V(".aipkit_stateful_convo_checkbox"),reasoning_effort:j('[name="reasoning_effort"]')}},G=$(),Q=j=>{let V=S&&S.value||t.getAttribute("data-active-bot-id");V&&(q=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_conversation_settings",{bot_id:V,...j}).then(Y=>{G=j,dt(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{dt(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P){let Y=P;P=null,JSON.stringify(Y)!==JSON.stringify(G)&&Q(Y)}}))},X=j=>{if(JSON.stringify(j)!==JSON.stringify(G)){if(q){P=j;return}Q(j)}},ie=j=>{let V=j.target;V&&(V.matches(".aipkit_stream_enable_toggle")||V.matches(".aipkit_stateful_convo_checkbox")||V.matches(".aipkit_reasoning_effort_slider")||V.matches('[name="reasoning_effort"]'))&&(Yo(),X($()))};R.addEventListener("change",ie),ue&&ue.addEventListener("change",ie),t.dataset.conversationSettingsAutosaveBound="1"}if(R&&$i&&!t.dataset.fileUploadAutosaveBound){let q=!1,P=null,$=()=>{let ie=R.querySelector('[name="enable_file_upload"]');return!ie||ie.disabled?"":ie.tagName==="SELECT"?ie.value==="1"?"1":"0":ie.checked?"1":"0"},G=$(),Q=ie=>{let j=S&&S.value||t.getAttribute("data-active-bot-id");!j||ie===""||(q=!0,dt("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_file_upload_settings",{bot_id:j,enable_file_upload:ie}).then(V=>{G=ie,dt(V.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(j),Oi()}).catch(V=>{dt(`Error: ${V.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,P!==null&&P!==G){let V=P;P=null,Q(V)}else P=null}))},X=ie=>{if(!(ie===""||ie===G)){if(q){P=ie;return}Q(ie)}};R.addEventListener("change",ie=>{let j=ie.target;j&&j.matches('[name="enable_file_upload"]')&&(X($()),Ne()==="1"?Lt():ft())}),t.dataset.fileUploadAutosaveBound="1"}let Ur=S&&S.value||t.getAttribute("data-active-bot-id");if(Ur&&typeof window.aipkit_refreshChatPreview=="function"){window.aipkit_refreshChatPreview(Ur);return}let es=window.aipkit_dashboard?.text?.previewPlaceholderSelect||"Select a bot to see the preview.";c(es)}window.aipkit_initChatbotBuilder=o})();(function(){"use strict";function k(e){if(!e)return;let i=e.querySelector(".aipkit_token_limit_mode_select"),a=e.querySelector(".aipkit_token_general_user_limit_field"),s=e.querySelector(".aipkit_token_role_limits_container");if(!i||!a||!s){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let l=i.value;a.style.display=l==="general"?"block":"none",s.style.display=l==="role_based"?"block":"none"}function n(){let e=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!e){console.warn("AIPKit Token Management JS: Main content container not found.");return}e.addEventListener("change",function(a){let s=a.target.closest(".aipkit_token_limit_mode_select");if(!s)return;let l=s.closest(".aipkit_accordion-content");l?k(l):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",s)}),e.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(a=>{let s=a.querySelector(".aipkit_accordion-content");s&&k(s)})}window.aipkit_initTokenManagementUI=n})();(function(){"use strict";function k(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let e=document.querySelector(".aipkit_chatbot_module_container");e&&(e.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js."),typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatSelectPickers=="function"?window.aipkit_initChatSelectPickers():console.error("AIPKit Chat Admin Main: aipkit_initChatSelectPickers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Chat Admin Main: aipkit_initSyncButtons function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles(".aipkit_chatbot_module_container"):console.error("AIPKit Chat Admin Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCustomThemePresets=="function"?window.aipkit_initCustomThemePresets():console.error("AIPKit Chat Admin Main: aipkit_initCustomThemePresets function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initChatbotBuilder=="function"&&window.aipkit_initChatbotBuilder(),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found.");let n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(n){let e=n.dataset.botId,i=document.getElementById(`aipkit_trigger_builder_${e}`);e&&i&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(e):e&&i&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${e}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy(),function(){let i=document.querySelector(".aipkit_chatbot_module_container");i&&i.addEventListener("click",function(a){if(a.target.closest(".aipkit_header_reset_btn, .aipkit_header_delete_btn, .aipkit_actions_dropdown_container .aipkit_tab_dropdown_trigger"))return;if(a.target.closest("#aipkit_chatbot_header_save_btn")){let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");o&&(typeof o.requestSubmit=="function"?o.requestSubmit():o.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})));return}if(a.target.closest(".aipkit_header_reset_btn")){let o=i.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");o&&(o.style.display="none");let r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form")?.dataset.botId,f=i.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",u=i.querySelector("#aipkit_header_action_feedback");if(!r||!u)return;u.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_reset_confirmation" id="aipkit_reset_confirmation_${r}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_inline">Confirm</button>
              </div>
            </div>`,u.querySelector(".aipkit_reset_cancel_inline")?.addEventListener("click",()=>{u.innerHTML=""},{once:!0}),u.querySelector(".aipkit_reset_confirm_inline")?.addEventListener("click",()=>{u.innerHTML='<span class="aipkit_action_status_message">Resetting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:r}).then(p=>{u.innerHTML=`<span class="aipkit_action_status_message success">${p.message||"Chatbot reset successfully!"}</span>`,typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:r,aipkit_silent:!0,aipkit_force_refresh:!0}),setTimeout(()=>{u.innerHTML=""},3e3)}).catch(p=>{u.innerHTML=`<span class="aipkit_action_status_message error">Error: ${p.message||"Failed to reset chatbot."}</span>`,setTimeout(()=>{u.innerHTML=""},4e3)})},{once:!0});return}if(a.target.closest(".aipkit_header_delete_btn")){let o=i.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");o&&(o.style.display="none");let t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),r=t?.dataset.botId,f=t?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",u=i.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",p=i.querySelector("#aipkit_header_action_feedback");if(!r||!p)return;if(f){p.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{p.innerHTML=""},3e3);return}p.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_delete_confirmation" id="aipkit_delete_confirmation_${r}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_inline">Confirm</button>
              </div>
            </div>`,p.querySelector(".aipkit_delete_cancel_inline")?.addEventListener("click",()=>{p.innerHTML=""},{once:!0}),p.querySelector(".aipkit_delete_confirm_inline")?.addEventListener("click",()=>{p.innerHTML='<span class="aipkit_action_status_message">Deleting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:r}).then(_=>{p.innerHTML=`<span class="aipkit_action_status_message success">${_.message||"Chatbot deleted successfully."}</span>`;let m=null,g=document.getElementById("aipkit_chatbot_main_selector_container");if(g){let d=Array.from(g.querySelectorAll(".aipkit_tab_dropdown_item[data-bot-id]")),w=d.filter(b=>{let A=b.getAttribute("data-bot-id");return A&&A!==String(r)}),h=d.findIndex(b=>b.getAttribute("data-bot-id")===String(r));if(h>0){let b=d[h-1],A=b?b.getAttribute("data-bot-id"):null;A&&A!==String(r)&&(m=A)}!m&&w.length>0&&(m=w[0].getAttribute("data-bot-id"))}if(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"){let d=m?{force_active_bot_id:m}:{};d.aipkit_silent=!0,d.aipkit_force_refresh=!0,window.aipkit_loadModule("chatbot",d)}setTimeout(()=>{p.innerHTML=""},3e3)}).catch(_=>{p.innerHTML=`<span class="aipkit_action_status_message error">Error: ${_.message||"Failed to delete chatbot."}</span>`,setTimeout(()=>{p.innerHTML=""},4e3)})},{once:!0});return}})}()}window.aipkit_initChatbot=k})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"modified",sortDirection:"desc",isLoading:!1}})();(function(){"use strict";function k(n){let e=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_ai_forms_container"),a=window.aipkit_escapeHtml||(o=>o),s=wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o,l=wp.i18n&&wp.i18n._n?wp.i18n._n:null,c=wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:null;e&&(e.innerHTML="",!(!n||n.length===0)&&n.forEach(o=>{let t=window.aipkit_dashboard?.isProPlan??!1,r=window.aipkit_dashboard?.upgradeUrl||"#",f="",u="";if(t)f=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label">${s("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="pdf_download" value="true">
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`;else{let y=s("This is a Pro feature. Please upgrade.","gpt3-ai-content-generator");f=`
              <div class="aipkit_popover_option_row aipkit_popover_option_row--disabled">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label" data-tooltip="${a(y)}">${s("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch" disabled>
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`,u=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main aipkit_popover_option_main--stacked">
                      <p class="aipkit_form-help">${s("Save as PDF is available on the Pro plan.","gpt3-ai-content-generator")}</p>
                      <a class="aipkit_btn aipkit_btn-primary" href="${a(r)}" target="_blank" rel="noopener noreferrer">
                        ${s("Upgrade to Pro","gpt3-ai-content-generator")}
                      </a>
                  </div>
              </div>`}let p=e.insertRow(),_=p.insertCell();_.classList.add("aipkit_ai_form_title_cell");let m=a(o.title||s("Untitled","gpt3-ai-content-generator")),g=o.updated_at||o.updatedAt||o.updated||"",d="",w="";g&&(typeof window.aipkit_formatRelativeDateTime=="function"?d=window.aipkit_formatRelativeDateTime(g):typeof window.aipkit_formatUtcDateTime=="function"?d=window.aipkit_formatUtcDateTime(g):d=g,typeof window.aipkit_formatUtcDateTime=="function"&&(w=window.aipkit_formatUtcDateTime(g)));let h=o.submissions_count??o.submission_count??o.submissionsCount??0,b=Number.isFinite(Number(h))?Number(h):0,A=[];if(d){let y=c?c(s("Updated %s","gpt3-ai-content-generator"),d):`${s("Updated","gpt3-ai-content-generator")} ${d}`,C=w?` title="${a(w)}"`:"";A.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_updated"${C}>${a(y)}</span>`)}if(b>0){let y=`${b} ${s(b===1?"submission":"submissions","gpt3-ai-content-generator")}`;l&&c&&(y=c(l("%s submission","%s submissions",b,"gpt3-ai-content-generator"),b)),A.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_count">${a(y)}</span>`)}let S=A.length?`
          <span class="aipkit_ai_form_meta">
            ${A.join('<span class="aipkit_ai_form_meta_sep" aria-hidden="true">&middot;</span>')}
          </span>
        `:"";_.innerHTML=`
        <span class="aipkit_ai_form_title_text" title="${m}">${m}</span>
        ${S}
      `;let I=p.insertCell();I.classList.add("aipkit_ai_form_model_cell");let T=o.model||s("Default","gpt3-ai-content-generator");I.textContent=T,I.title=T;let x=p.insertCell();x.classList.add("aipkit_shortcode_cell","aipkit_ai_form_shortcode_cell");let E=`aipkit_ai_form_theme_${o.id}`;x.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${o.id}" readonly value="${a(o.shortcode)}" data-aipkit-shortcode-display="${o.id}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${o.id}" title="${s("Shortcode settings","gpt3-ai-content-generator")}" aria-label="${s("Shortcode settings","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-shortcode" aria-hidden="true"></span>
              <span class="screen-reader-text">${s("Shortcode settings","gpt3-ai-content-generator")}</span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator aipkit_model_settings_popover_panel" id="aif-configurator-${o.id}" style="display: none;" role="dialog" aria-modal="false" aria-labelledby="aif-shortcode-title-${o.id}">
            <div class="aipkit_model_settings_popover_header">
                <span class="aipkit_model_settings_popover_title" id="aif-shortcode-title-${o.id}">
                  ${s("Shortcode Settings","gpt3-ai-content-generator")}
                </span>
                <button
                    type="button"
                    class="aipkit_model_settings_popover_close aipkit_aiform_shortcode_close"
                    aria-label="${s("Close","gpt3-ai-content-generator")}"
                >
                    <span class="dashicons dashicons-no-alt"></span>
                </button>
            </div>
            <div class="aipkit_model_settings_popover_body">
                <div class="aipkit_popover_options_list">
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Show Provider Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="show_provider" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Show Model Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="show_model" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Copy Button","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="copy_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Save as Post","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="save_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    ${f}
                    ${u}
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <label class="aipkit_popover_option_label" for="${E}">
                              ${s("Theme","gpt3-ai-content-generator")}
                            </label>
                            <div class="aipkit_popover_option_actions">
                                <select id="${E}" class="aipkit_popover_option_select aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="theme">
                                    <option value="light">${s("Light (default)","gpt3-ai-content-generator")}</option>
                                    <option value="dark">${s("Dark","gpt3-ai-content-generator")}</option>
                                    <option value="custom">${s("Custom","gpt3-ai-content-generator")}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Shortcode","gpt3-ai-content-generator")}</span>
                            <div class="aipkit_popover_option_actions">
                                <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" readonly value="${a(o.shortcode)}" data-aipkit-shortcode-display="${o.id}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="aipkit_popover_flyout_footer">
                <span class="aipkit_popover_flyout_footer_text">
                    ${s("Need help?","gpt3-ai-content-generator")}
                </span>
                <a
                    class="aipkit_popover_flyout_footer_link"
                    href="https://docs.aipower.org/docs/category/ai-forms"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    ${s("Documentation","gpt3-ai-content-generator")}
                </a>
            </div>
        </div>
      `,i&&typeof window.aipkitForms_applyStoredShortcodeConfig=="function"&&window.aipkitForms_applyStoredShortcodeConfig(o.id,i);let v=p.insertCell();v.classList.add("aipkit_form_actions_cell"),v.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_edit_ai_form_btn" data-form-id="${o.id}" title="${s("Edit","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            ${s("Edit","gpt3-ai-content-generator")}
          </button>
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_preview_ai_form_btn" data-form-id="${o.id}" data-form-title="${a(o.title||"")}" title="${s("Preview","gpt3-ai-content-generator")}" aria-label="${s("Preview","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-visibility" aria-hidden="true"></span>
            <span class="screen-reader-text">${s("Preview","gpt3-ai-content-generator")}</span>
          </button>
          <div class="aipkit_actions_menu">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_actions_menu_toggle" title="${s("More actions","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-ellipsis"></span>
            </button>
            <div class="aipkit_actions_dropdown_menu">
              <button type="button" class="aipkit_dropdown-item-btn aipkit_duplicate_ai_form_btn" data-form-id="${o.id}" title="${s("Duplicate","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-page"></span>
                <span>${s("Duplicate","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_export_ai_form_btn" data-form-id="${o.id}" title="${s("Export","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-download"></span>
                <span>${s("Export","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_dropdown-item--danger aipkit_delete_ai_form_btn" data-form-id="${o.id}" data-form-title="${a(o.title)}" title="${s("Delete","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-trash"></span>
                <span>${s("Delete","gpt3-ai-content-generator")}</span>
              </button>
            </div>
          </div>
        </div>
      `}))}window.aipkitForms_renderTable=k})();(function(){"use strict";function k(n){let e=window.aipkitAIFormsListState,i=document.getElementById("aipkit_ai_forms_pagination"),a=document.getElementById("aipkit_ai_forms_count_summary");if(!i||!n||!e)return;let s=wp.i18n&&wp.i18n.__?wp.i18n.__:r=>r,l=wp.i18n&&wp.i18n._n?wp.i18n._n:(r,f,u)=>u===1?r:f;i.innerHTML="";let{total_forms:c,total_pages:o}=n,t=e.currentPage;if(a){let r=l("form","forms",c,"gpt3-ai-content-generator");a.textContent=`${c.toLocaleString()} ${r}`}if(!(c<=0)&&o>1){let r=document.createElement("span");r.className="aipkit_pagination-links";let f=document.createElement("button");f.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",f.innerHTML=`\xAB ${s("Previous","gpt3-ai-content-generator")}`,f.disabled=t<=1,r.appendChild(f);let u=document.createElement("span");u.className="aipkit_pagination-current",u.textContent=`${s("Page","gpt3-ai-content-generator")} ${t} ${s("of","gpt3-ai-content-generator")} ${o}`,r.appendChild(u);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",p.innerHTML=`${s("Next","gpt3-ai-content-generator")} \xBB`,p.disabled=t>=o,r.appendChild(p),i.appendChild(r)}}window.aipkitForms_renderPagination=k})();(function(){"use strict";function k(){let n=window.aipkitAIFormsListState;if(!n||n.isLoading)return;n.isLoading=!0;let e=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_no_ai_forms_message"),a=document.getElementById("aipkit_ai_forms_pagination");e&&(e.innerHTML='<tr><td colspan="4" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),i&&(i.style.display="none"),a&&(a.innerHTML="");let l={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:n.currentPage,search:n.searchQuery,sort_by:n.sortColumn,sort_order:n.sortDirection};window.aipkit_apiRequest("aipkit_list_ai_forms",l).then(c=>{if(typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(c.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(c.pagination||{}),i&&(!c.forms||c.forms.length===0)){i.style.display="block";let o=!!n.searchQuery&&n.searchQuery.trim().length>0;i.textContent=o?"No forms found matching your search.":"No AI Forms have been created yet."}}).catch(c=>{e&&(e.innerHTML=`<tr><td colspan="4" style="color:red;text-align:center;">Error loading forms: ${c.message}</td></tr>`)}).finally(()=>{n.isLoading=!1})}window.aipkitForms_fetchForms=k})();(function(){"use strict";let k;function n(){let e=document.getElementById("aipkit_ai_forms_list_container");if(!e||e.dataset.listListenersAttached)return;e.dataset.listListenersAttached="true";let i=window.aipkitAIFormsListState;if(!i){console.error("AI Forms Events: List state object is not available.");return}e.addEventListener("click",function(s){let l=s.target,c=l.closest(".aipkit-sortable-col");if(c){let o=c.dataset.sortKey;i.sortColumn===o?i.sortDirection=i.sortDirection==="asc"?"desc":"asc":(i.sortColumn=o,i.sortDirection="asc"),i.currentPage=1,e.querySelectorAll(".aipkit-sortable-col").forEach(t=>t.removeAttribute("data-sort-direction")),c.setAttribute("data-sort-direction",i.sortDirection),window.aipkitForms_fetchForms();return}if(l.matches(".aipkit_pagination_prev")){i.currentPage>1&&(i.currentPage--,window.aipkitForms_fetchForms());return}if(l.matches(".aipkit_pagination_next")){i.currentPage++,window.aipkitForms_fetchForms();return}});let a=e.querySelector("#aipkit_ai_forms_search_input");a&&a.addEventListener("input",function(){clearTimeout(k),k=setTimeout(()=>{i.searchQuery=this.value,i.currentPage=1,window.aipkitForms_fetchForms()},400)})}window.aipkitForms_attachListEventListeners=n})();(function(){"use strict";function k(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=k})();(function(){"use strict";function k(n){let e=window.aipkitAIFormsState;if(!n){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=n.querySelector("#aipkit_ai_form_elements_palette"),a=n.querySelector("#aipkit_ai_form_designer_area"),s=n.querySelector("#aipkit_form_designer_placeholder");if(!i||!a){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&a.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(c=>{c.dataset.dragStartListenerAttached!=="true"&&(c.addEventListener("dragstart",o=>{e.draggedElementType=o.target.dataset.elementType,o.dataTransfer.setData("text/plain",e.draggedElementType),o.dataTransfer.effectAllowed="copy",o.target.classList.add("aipkit-dragging"),e.draggedElement=null}),c.addEventListener("dragend",o=>{o.target.classList.remove("aipkit-dragging"),e.draggedElementType=null}),c.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",a.dataset.dragListenersAttached!=="true"&&(a.addEventListener("dragstart",c=>{c.target.classList.contains("aipkit_dropped_element")&&(e.draggedElement=c.target,c.dataTransfer.setData("text/element-id",c.target.id),c.dataTransfer.effectAllowed="move",setTimeout(()=>{e.draggedElement&&(e.draggedElement.style.opacity="0.5")},0),e.draggedElementType=null)}),a.addEventListener("dragend",c=>{e.draggedElement&&(e.draggedElement.style.opacity="1",e.draggedElement=null)}),a.addEventListener("dragover",c=>{c.preventDefault();let o=c.target.closest(".aipkit_dropped_element");a.classList.add("aipkit-drag-over"),e.draggedElement&&o&&e.draggedElement!==o?c.dataTransfer.dropEffect="move":c.dataTransfer.dropEffect="copy"}),a.addEventListener("dragleave",c=>{a.contains(c.relatedTarget)||a.classList.remove("aipkit-drag-over")}),a.addEventListener("drop",c=>{c.preventDefault(),a.classList.remove("aipkit-drag-over");let o=c.dataTransfer.getData("text/element-id");if(e.draggedElement&&o===e.draggedElement.id){let t=c.target.closest(".aipkit_dropped_element"),r=null;if(t&&t!==e.draggedElement){let f=t.getBoundingClientRect();r=c.clientY>f.top+f.height/2?t.nextSibling:t}a.insertBefore(e.draggedElement,r),e.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(e.draggedElementType){if(s&&s.style.display!=="none"&&(s.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let t=window.aipkitForms_createNewFormElementData(e.draggedElementType);e.formStructure.push(t),window.aipkitForms_renderDroppedElement(a,t,null)}e.draggedElementType=null,e.draggedElement=null}),a.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=k})();(function(){"use strict";function k(){let n=window.aipkitAIFormsState,e=document.getElementById("aipkit_ai_form_designer_area");if(!e)return;let i=[];e.querySelectorAll(".aipkit_layout_row").forEach(s=>{let l=s.id,c=n.formStructure.find(r=>r.internalId===l);if(!c)return;let o={internalId:l,type:"layout-row",columns:[]};s.querySelectorAll(".aipkit_layout_column").forEach(r=>{let f=r.id,u=c.columns.find(m=>m.internalId===f);if(!u)return;let p={internalId:f,width:u.width,elements:[]};r.querySelectorAll(".aipkit_dropped_element").forEach(m=>{let g=m.id,d=null;n.formStructure.forEach(w=>{w.columns.forEach(h=>{let b=h.elements.find(A=>A.internalId===g);b&&(d=b)})}),d&&p.elements.push(d)}),o.columns.push(p)}),i.push(o)}),n.formStructure=i,typeof window.aipkitForms_notifyEditorMutation=="function"&&window.aipkitForms_notifyEditorMutation(document.getElementById("aipkit_ai_forms_container"))}window.aipkitForms_updateFormStructureOrder=k})();(function(){"use strict";function k(e){let i=window.aipkitAIFormsState;i.droppedElementCounter++;let a=`field_${e.replace(/-/g,"_")}_${i.droppedElementCounter}`;switch(e){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:e,label:`New ${e.replace(/-/g," ").replace(/\b\w/g,c=>c.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:a,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let s,l;return e==="select"?(s="New Dropdown",l="select"):e==="radio-button"?(s="New Radio Buttons",l="radio"):(s="New Checkbox Group",l="checkbox"),{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:e,label:s,fieldId:`${l}_${i.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${i.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function n(e){let i=Date.now(),a=[];switch(e){case"1-col":a=[{internalId:`col-${i}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":a=[{internalId:`col-${i}-1`,width:"50%",elements:[]},{internalId:`col-${i}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":a=[{internalId:`col-${i}-1`,width:"33.33%",elements:[]},{internalId:`col-${i}-2`,width:"33.33%",elements:[]},{internalId:`col-${i}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":a=[{internalId:`col-${i}-1`,width:"30%",elements:[]},{internalId:`col-${i}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":a=[{internalId:`col-${i}-1`,width:"70%",elements:[]},{internalId:`col-${i}-2`,width:"30%",elements:[]}];break;default:a=[{internalId:`col-${i}-1`,width:"100%",elements:[]}]}return{internalId:`row-${i}`,type:"layout-row",columns:a}}window.aipkitForms_createNewFormElementData=k,window.aipkitForms_createNewLayoutData=n})();(function(){"use strict";function k(n,e,i=null){let a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,s=window.aipkit_escapeHtml||function(p){return p},l=document.createElement("div");l.className="aipkit_dropped_element",l.id=e.internalId,l.dataset.elementType=e.type;let c=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${a("Drag to reorder","gpt3-ai-content-generator")}"></span>`,o="",t=`${e.internalId}-field`,r="";switch(e.helpText&&(r=`<p class="aipkit_dropped_element_help_text">${s(e.helpText)}</p>`),e.type){case"text-input":o=`<label class="aipkit_dropped_element_label" for="${t}">${s(e.label)} ${e.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${t}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${s(e.placeholder)}" readonly>
                    ${r}`;break;case"textarea":o=`<label class="aipkit_dropped_element_label" for="${t}">${s(e.label)} ${e.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${t}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${s(e.placeholder)}" readonly></textarea>
                    ${r}`;break;case"select":let p="";e.options&&e.options.length>0?e.options.forEach(g=>{p+=`<option value="${s(g.value)}">${s(g.text)}</option>`}):p=`<option>${a("No options configured","gpt3-ai-content-generator")}</option>`,o=`<label class="aipkit_dropped_element_label" for="${t}">${s(e.label)} ${e.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${t}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${p}</select>
                    ${r}`;break;case"radio-button":let _="";e.options&&e.options.length>0?e.options.forEach((g,d)=>{let w=`${t}-${d}`;_+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${w}" class="aipkit_dropped_element_field" name="preview-${e.internalId}" disabled>
                                    <label for="${w}">${s(g.text)}</label>
                                </div>`}):_=`<p class="aipkit-no-options-note">${a("No options configured","gpt3-ai-content-generator")}</p>`,o=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${s(e.label)} ${e.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${_}
                    </fieldset>
                    ${r}`;break;case"checkbox":let m="";e.options&&e.options.length>0?e.options.forEach((g,d)=>{let w=`${t}-${d}`;m+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${w}" class="aipkit_dropped_element_field" name="preview-${e.internalId}-${d}" disabled>
                                    <label for="${w}">${s(g.text)}</label>
                                </div>`}):m=`<p class="aipkit-no-options-note">${a("No options configured","gpt3-ai-content-generator")}</p>`,o=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${s(e.label)} ${e.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${m}
                    </fieldset>
                    ${r}`;break;case"file-upload":o=`<label class="aipkit_dropped_element_label" for="${t}">${s(e.label)} ${e.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${t}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${r}`;break;default:o=`<p>${s(e.label)}</p>${r}`}let f=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${a("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,u=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${a("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;l.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${o}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${c}
            ${f}
            ${u}
        </div>
    `,i?n.insertBefore(l,i):n.appendChild(l)}window.aipkitForms_renderFieldInColumn=k,window.aipkitForms_renderDroppedElement=k})();(function(){"use strict";function k(n,e){let i=window.aipkitAIFormsState,a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c;if(!e){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let s=e.querySelector("#aipkit_ai_form_designer_area");if(!s){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let l=s.querySelector(`#${CSS.escape(n)}`);if(l){if(l.remove(),i.formStructure.forEach(c=>{c.columns.forEach(o=>{o.elements=o.elements.filter(t=>t.internalId!==n)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(e),i.selectedDesignerElementId===n&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(e):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),s.querySelectorAll(".aipkit_dropped_element").length===0&&s.querySelectorAll(".aipkit_layout_row").length===0){let c=s.querySelector("#aipkit_form_designer_placeholder");c||(c=document.createElement("div"),c.className="aipkit_form_designer_placeholder",c.id="aipkit_form_designer_placeholder",c.innerHTML=`<span class="dashicons dashicons-layout"></span>${a("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,s.appendChild(c)),c.style.display="flex"}typeof window.aipkitForms_notifyEditorMutation=="function"&&window.aipkitForms_notifyEditorMutation(e)}}window.aipkitForms_deleteDroppedElement=k})();(function(){"use strict";function k(){let n=window.aipkitAIFormsState,e=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,i=document.getElementById("aipkit_form_editor_container");if(!i)return;let a=i.querySelector("#aipkit_ai_form_prompt_template"),s=i.querySelector("#aipkit_prompt_validation_results");if(!a||!s)return;let l=a.value,c=[],o=[],t=new Set;n.formStructure.forEach(m=>{m.columns.forEach(g=>{g.elements.forEach(d=>{d.fieldId&&t.add(d.fieldId)})})});let r=/{[a-zA-Z0-9_]+}/g,f=(l.match(r)||[]).map(m=>m.slice(1,-1)),u=new Set(f);f.forEach(m=>{t.has(m)||c.push(`Variable <code>{${m}}</code> is used in the prompt but not defined as a form field.`)}),t.forEach(m=>{u.has(m)||o.push(`Field <code>{${m}}</code> is defined but not used in the prompt.`)});let p=l;if(f.forEach(m=>{let g=new RegExp(`\\{${m}\\}`,"g");p=p.replace(g,"")}),/[{}]/.test(p)&&c.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),s.className="aipkit_form-help",s.innerHTML="",c.length>0){s.classList.add("aipkit-validation-error");let m=`<strong>${e("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;c.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>",s.innerHTML=m}else{s.classList.add("aipkit-validation-success");let m=`<strong>${e("Validation Passed!","gpt3-ai-content-generator")}</strong> (${f.length} of ${t.size} fields used).`;o.length>0&&(m+=`<br><strong>${e("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,o.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>"),s.innerHTML=m}s.style.display="block",s.dismissTimer&&clearTimeout(s.dismissTimer);let _=c.length>0?8e3:5e3;s.dismissTimer=setTimeout(()=>{s.style.display="none",s.innerHTML=""},_)}window.aipkitForms_validatePrompt=k})();(function(){"use strict";function k(n,e){let i=window.aipkitAIFormsState,a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,l=window.aipkit_escapeHtml||function(p){return p};if(!e){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}e.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(p=>p.classList.remove("aipkit-element-selected"));let c=e.querySelector(`#${CSS.escape(n)}`);c&&c.classList.add("aipkit-element-selected"),i.selectedDesignerElementId=n;let o=null;for(let p of i.formStructure){for(let _ of p.columns){let m=_.elements.find(g=>g.internalId===n);if(m){o=m;break}}if(o)break}if(!o){console.error(`showSettingsPanel: Could not find element data for ID ${n} in state.`,i.formStructure);return}let t=e.querySelector("#aipkit_ai_form_elements_palette"),r=e.querySelector("#aipkit_ai_form_element_settings_panel"),f=r?r.querySelector("#aipkit_settings_panel_fields"):null,u=r?r.querySelector("#aipkit_settings_panel_element_type"):null;if(!t||!r||!f||!u){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(u.textContent=`(${o.type.replace(/-/g," ").replace(/\b\w/g,p=>p.toUpperCase())})`,f.innerHTML="",f.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${o.internalId}">${s(a.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="label" value="${l(o.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${o.internalId}">${s(a.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="fieldId" value="${l(o.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${s("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${s(a.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(o.type==="text-input"||o.type==="textarea")&&(f.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${o.internalId}">${s(a.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="placeholder" value="${l(o.placeholder||"")}">
                </div>`),f.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${o.internalId}">
                    <input type="checkbox" id="setting-required-${o.internalId}" class="aipkit-setting-field" data-setting="required" ${o.required?"checked":""}>
                    ${s(a.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${o.internalId}">${s("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${o.internalId}" class="aipkit_form-input aipkit_builder_textarea aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${l(s("This text will appear under the field.","gpt3-ai-content-generator"))}">${l(o.helpText||"")}</textarea>
            </div>
        `,o.type==="select"||o.type==="radio-button"||o.type==="checkbox"){let p=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${s(a.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(o.options||[]).forEach((_,m)=>{p+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-value" data-option-index="${m}" value="${l(_.value)}" placeholder="${s(a.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-text" data-option-index="${m}" value="${l(_.text)}" placeholder="${s(a.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${s(a.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),p+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${s(a.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,f.innerHTML+=p}t.style.display="none",r.style.display="block"}window.aipkitForms_showSettingsPanel=k})();(function(){"use strict";function k(n){let e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!n){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let a=n.querySelector("#aipkit_ai_form_element_settings_panel");if(!a){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let s=a.querySelector("#aipkit_select_options_container");if(!s){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let l=s.querySelectorAll(".aipkit_select_option_row").length,c=document.createElement("div");c.className="aipkit_select_option_row",c.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${l}" placeholder="${i(e.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${l}" placeholder="${i(e.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${i(e.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,s.appendChild(c)}window.aipkitForms_addSelectOptionRow=k})();(function(){"use strict";function k(n){let e=window.aipkitAIFormsState;if(!n){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}n.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(s=>s.classList.remove("aipkit-element-selected")),e.selectedDesignerElementId=null;let i=n.querySelector("#aipkit_ai_form_elements_palette"),a=n.querySelector("#aipkit_ai_form_element_settings_panel");i&&(i.style.display="block"),a&&(a.style.display="none")}window.aipkitForms_hideSettingsPanel=k})();(function(){"use strict";function k(n,e){let i=window.aipkitAIFormsState,a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_;if(!e){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let l=null;for(let _ of i.formStructure){for(let m of _.columns){let g=m.elements.find(d=>d.internalId===n);if(g){l=g;break}}if(l)break}if(!l){console.error(`updateElementFromSettingsPanel: Element data for ID ${n} not found.`);return}let c=e.querySelector("#aipkit_ai_form_element_settings_panel");if(!c){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let o=c.querySelector('input[data-setting="label"]');o&&(l.label=o.value);let t=c.querySelector('input[data-setting="fieldId"]');if(t){let _=t.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!_){let g=l.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");g||(g=l.type.replace(/-/g,"_")),_=`${g}_${n.split("-").pop()}`}let m=!0;e:for(let g of i.formStructure)for(let d of g.columns)if(d.elements.some(w=>w.internalId!==n&&w.fieldId===_)){m=!1;break e}m&&_.length>0?(l.fieldId=_,t.value=_,t.classList.remove("aipkit_input_error")):_.length>0&&t.classList.add("aipkit_input_error")}let r=c.querySelector('input[data-setting="required"]');r&&(l.required=r.checked);let f=c.querySelector('textarea[data-setting="helpText"]');if(f&&(l.helpText=f.value),l.type==="text-input"||l.type==="textarea"){let _=c.querySelector('input[data-setting="placeholder"]');_&&(l.placeholder=_.value)}(l.type==="select"||l.type==="radio-button"||l.type==="checkbox")&&(l.options=[],c.querySelectorAll(".aipkit_select_option_row").forEach(m=>{let g=m.querySelector('input[data-setting="option-value"]'),d=m.querySelector('input[data-setting="option-text"]');g&&d&&g.value.trim()!==""?l.options.push({value:g.value,text:d.value}):g&&d&&g.value.trim()===""&&d.value.trim()!==""&&l.options.push({value:d.value,text:d.value})}));let u=e.querySelector("#aipkit_ai_form_designer_area"),p=u?u.querySelector(`#${CSS.escape(n)}`):null;if(p&&u){let _=p.parentElement,m=u.scrollTop,g=p.classList.contains("aipkit-element-selected"),d=p.nextElementSibling;if(p.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(_,l,d):console.error("AI Forms updateElement: renderFieldInColumn function missing."),g){let w=u.querySelector(`#${CSS.escape(n)}`);w&&w.classList.add("aipkit-element-selected")}u.scrollTop=m}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(e),typeof window.aipkitForms_notifyEditorMutation=="function"&&window.aipkitForms_notifyEditorMutation(e)}window.aipkitForms_updateElementFromSettingsPanel=k})();(function(){"use strict";function k(a){let s=window.aipkitAIFormsState;if(!a)return;let l=a.querySelector("#aipkit_prompt_snippets_container");if(!l)return;l.innerHTML="";let c=new Set;if(s.formStructure.forEach(o=>{o.columns.forEach(t=>{t.elements.forEach(r=>{r.fieldId&&c.add(r.fieldId)})})}),c.size>0){let o=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;c.forEach(t=>{let r=document.createElement("button");r.type="button",r.className="aipkit_prompt_snippet",r.dataset.fieldId=t,r.title=o("Click to copy","gpt3-ai-content-generator"),r.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${t}}`,l.appendChild(r)})}}function n(a){if(!a)return;let s=a.querySelector("#aipkit_form_editor_container");if(!s){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let l=s.querySelector("#aipkit_prompt_snippets_container");if(!l){console.warn("AI Forms: Prompt snippets container not found for init.");return}l.dataset.listenerAttached!=="true"&&(l.addEventListener("click",function(c){let o=c.target.closest(".aipkit_prompt_snippet");if(!o)return;let t=o.dataset.fieldId;t&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${t}}`,o)}),l.dataset.listenerAttached="true")}function e(a,s){if(!a)return;let l=a.querySelector("#aipkit_ai_form_ai_provider");l&&(l.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(s?l.dataset.aipkitProviderNoticeArmed="true":delete l.dataset.aipkitProviderNoticeArmed),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(a))}function i(a=null,s){let l=window.aipkitAIFormsState,c=window.aipkit_ai_forms_config||{text:{}},o=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,t=window.aipkit_escapeHtml||function(m){return m};if(!s){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}l.currentFormId=a,l.droppedElementCounter=0,l.formStructure=[],l.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(s):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let r=s.querySelector("#aipkit_form_editor_container"),f=s.querySelector("#aipkit_ai_forms_list_container"),u=s.querySelector("#aipkit_ai_forms_editor_actions"),p=s.querySelector("#aipkit_create_new_ai_form_btn"),_=s.querySelector("#aipkit_ai_forms_settings_trigger");f.style.display="none",r.style.display="block",u&&(u.style.display="flex"),p&&(p.style.display="none"),_&&(_.style.display="none"),requestAnimationFrame(()=>{let m=()=>{typeof window.aipkitForms_refreshSelectPickers=="function"&&window.aipkitForms_refreshSelectPickers(s)},g=s.querySelector("#aipkit_ai_form_title"),d=r.querySelector("#aipkit_ai_form_prompt_template"),w=r.querySelector("#aipkit_ai_form_id"),h=r.querySelector("#aipkit_ai_form_designer_area"),b=r.querySelector("#aipkit_ai_form_ai_provider"),A=r.querySelector("#aipkit_ai_form_ai_model"),S=r.querySelector("#aipkit_ai_form_temperature"),I=r.querySelector("#aipkit_ai_form_temperature_value"),T=r.querySelector("#aipkit_ai_form_max_tokens"),x=r.querySelector("#aipkit_ai_form_max_tokens_value"),E=r.querySelector("#aipkit_ai_form_top_p"),v=r.querySelector("#aipkit_ai_form_top_p_value"),y=r.querySelector("#aipkit_ai_form_frequency_penalty"),C=r.querySelector("#aipkit_ai_form_frequency_penalty_value"),M=r.querySelector("#aipkit_ai_form_presence_penalty"),B=r.querySelector("#aipkit_ai_form_presence_penalty_value"),D=s.querySelector("#aipkit_preview_ai_form_btn"),W=()=>{let K=document.createElement("div");return K.className="aipkit_form_designer_placeholder",K.id="aipkit_form_designer_placeholder",K.innerHTML=`<span class="dashicons dashicons-layout"></span>${o("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,K};if(!r||!f||!g||!d||!w||!h||!b||!A||!S||!T||!D||!I||!x||!E||!v||!y||!C||!M||!B){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:s.innerHTML.substring(0,500)});return}let U=s.querySelector("#aipkit_ai_forms_header_title_default"),J=s.querySelector("#aipkit_ai_forms_header_title_editor"),oe=s.querySelector("#aipkit_ai_forms_title_display"),O=s.querySelector("#aipkit_ai_forms_title_text"),L=o("New Form","gpt3-ai-content-generator"),F=()=>{if(!O||!oe||!g)return;let re=g.value.trim()||L;O.textContent=re,oe.setAttribute("title",re)},N=()=>{!oe||!g||(oe.style.display="none",g.style.display="inline-block",g.focus(),g.select())},R=()=>{!oe||!g||(g.style.display="none",oe.style.display="inline-flex",F())};U&&(U.style.display="none"),J&&(J.style.display="flex"),J&&J.dataset.inlineTitleBound!=="true"&&oe&&g&&(oe.addEventListener("click",N),g.addEventListener("blur",R),g.addEventListener("keydown",K=>{K.key==="Enter"&&(K.preventDefault(),g.blur())}),g.addEventListener("input",F),J.dataset.inlineTitleBound="true"),g.value="",d.value="",w.value="",h.innerHTML="",h.appendChild(W()),R(),k(s);let H={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Engine",model_label:"Model"};if(r.querySelectorAll('input[name^="labels["]').forEach(K=>{let re=K.name.match(/labels\[(.+)\]/),ve=re?re[1]:null;ve&&H[ve]!==void 0?K.value=H[ve]:K.value=""}),!a){if(b.value="OpenAI",S&&I){let K=window.aipkit_dashboard?.ai_params?.temperature||1;S.value=K,I.textContent=K}if(T&&x){let K=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;T.value=K,x.textContent=K}if(E&&v){let K=window.aipkit_dashboard?.ai_params?.top_p||1;E.value=K,v.textContent=K}if(y&&C){let K=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;y.value=K,C.textContent=K}if(M&&B){let K=window.aipkit_dashboard?.ai_params?.presence_penalty||0;M.value=K,B.textContent=K}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(r)),typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(b.value,r),m(),e(r,!0),typeof window.aipkitForms_onEditorReady=="function"&&window.aipkitForms_onEditorReady(s)}a?(D.disabled=!1,w.value=a,h.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${o("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:a,_ajax_nonce:c.nonce_manage_forms}).then(K=>{if(K.form){g.value=K.form.title||"",R(),d.value=K.form.prompt_template||"",b.value=K.form.ai_provider||"OpenAI",S&&I&&(S.value=K.form.temperature,I.textContent=K.form.temperature),T&&x&&(T.value=K.form.max_tokens,x.textContent=K.form.max_tokens),E&&v&&(E.value=K.form.top_p,v.textContent=K.form.top_p),y&&C&&(y.value=K.form.frequency_penalty,C.textContent=K.form.frequency_penalty),M&&B&&(M.value=K.form.presence_penalty,B.textContent=K.form.presence_penalty);let re=K.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(Jt=>{let Ut=r.querySelector(`input[name="labels[${Jt}]"]`);Ut&&(Ut.value=re[Jt]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(b.value,K.form.ai_model);let Ie=r.querySelector("#aipkit_ai_form_reasoning_effort");Ie&&(Ie.value=K.form.reasoning_effort||""),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(r);let Ee=r.querySelector('input[name="enable_vector_store"]'),Z=Ee?Ee.closest('[data-aipkit-settings-panel="context"]'):null;if(Z){let Jt=Z.querySelector('select[name="vector_store_provider"]'),Ut=Z.querySelector('select[name="openai_vector_store_ids[]"]'),Di=Z.querySelector('select[name="pinecone_index_name"]'),xt=Z.querySelector('select[name="qdrant_collection_name"]'),pi=Z.querySelector(".aipkit_vector_embedding_select"),Wt=Z.querySelector('select[name="vector_embedding_provider"]'),Wi=Z.querySelector('select[name="vector_embedding_model"]'),Sn=Z.querySelector('input[name="vector_store_top_k"]'),Ki=Z.querySelector("#aipkit_ai_form_vector_store_top_k_value"),ln=Z.querySelector('input[name="vector_store_confidence_threshold"]'),Vn=Z.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");if(Ee.checked=K.form.enable_vector_store==="1",Jt&&(Jt.value=K.form.vector_store_provider||"openai"),Di&&(Di.value=K.form.pinecone_index_name||""),Di&&K.form.pinecone_index_name&&!Array.from(Di.options).some(Se=>Se.value===K.form.pinecone_index_name)){let Se=new Option(`${K.form.pinecone_index_name}`,K.form.pinecone_index_name,!1,!0);Di.appendChild(Se),Di.value=K.form.pinecone_index_name}if(xt){let Se=Array.isArray(K.form.qdrant_collection_names)?K.form.qdrant_collection_names[0]:K.form.qdrant_collection_name||"";if(Se&&!Array.from(xt.options).some(Fe=>Fe.value===Se)){let Fe=new Option(`${Se}`,Se,!1,!0);xt.appendChild(Fe)}Se&&(xt.value=Se)}if(Wt&&(Wt.value=K.form.vector_embedding_provider||"openai"),Sn&&Ki){let Se=K.form.vector_store_top_k||3;Sn.value=Se,Ki.textContent=Se}if(ln&&Vn){let Se=K.form.vector_store_confidence_threshold||20;ln.value=Se,Vn.textContent=Se+"%"}if(Ut&&K.form.openai_vector_store_ids&&Array.isArray(K.form.openai_vector_store_ids)){let Se=new Set(Array.from(Ut.options).map(Fe=>Fe.value));K.form.openai_vector_store_ids.forEach((Fe,Ve)=>{if(Fe&&!Se.has(Fe)){let Tt=new Option(Fe,Fe,!1,!0);Ut.appendChild(Tt),Se.add(Fe)}}),Array.from(Ut.options).forEach(Fe=>{Fe.selected=K.form.openai_vector_store_ids.includes(Fe.value)})}typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(Z),Wi&&(Wi.value=K.form.vector_embedding_model||""),typeof window.aipkitForms_syncEmbeddingSelectFromInputs=="function"&&window.aipkitForms_syncEmbeddingSelectFromInputs(Z,pi),Ee.dispatchEvent(new Event("change",{bubbles:!0}))}let pe=r.querySelector('input[name="openai_web_search_enabled"]'),we=r.querySelector('input[name="claude_web_search_enabled"]'),de=r.querySelector('input[name="openrouter_web_search_enabled"]'),ae=r.querySelector('input[name="google_search_grounding_enabled"]');pe&&(pe.checked=K.form.openai_web_search_enabled==="1"),we&&(we.checked=K.form.claude_web_search_enabled==="1"),de&&(de.checked=K.form.openrouter_web_search_enabled==="1"),ae&&(ae.checked=K.form.google_search_grounding_enabled==="1");let ne=r.querySelector('select[name="openai_web_search_context_size"]'),ye=r.querySelector('select[name="openai_web_search_loc_type"]'),Me=r.querySelector('input[name="openai_web_search_loc_country"]'),nt=r.querySelector('input[name="openai_web_search_loc_city"]'),se=r.querySelector('input[name="openai_web_search_loc_region"]'),be=r.querySelector('input[name="openai_web_search_loc_timezone"]');ne&&(ne.value=K.form.openai_web_search_context_size||"medium"),ye&&(ye.value=K.form.openai_web_search_loc_type||"none"),Me&&(Me.value=K.form.openai_web_search_loc_country||""),nt&&(nt.value=K.form.openai_web_search_loc_city||""),se&&(se.value=K.form.openai_web_search_loc_region||""),be&&(be.value=K.form.openai_web_search_loc_timezone||"");let xe=r.querySelector('input[name="claude_web_search_max_uses"]'),Re=r.querySelector('select[name="claude_web_search_loc_type"]'),De=r.querySelector('input[name="claude_web_search_loc_country"]'),ze=r.querySelector('input[name="claude_web_search_loc_city"]'),Ze=r.querySelector('input[name="claude_web_search_loc_region"]'),it=r.querySelector('input[name="claude_web_search_loc_timezone"]'),Pt=r.querySelector('input[name="claude_web_search_allowed_domains"]'),Mi=r.querySelector('input[name="claude_web_search_blocked_domains"]'),Qt=r.querySelector('select[name="claude_web_search_cache_ttl"]');xe&&(xe.value=K.form.claude_web_search_max_uses||"5"),Re&&(Re.value=K.form.claude_web_search_loc_type||"none"),De&&(De.value=K.form.claude_web_search_loc_country||""),ze&&(ze.value=K.form.claude_web_search_loc_city||""),Ze&&(Ze.value=K.form.claude_web_search_loc_region||""),it&&(it.value=K.form.claude_web_search_loc_timezone||""),Pt&&(Pt.value=K.form.claude_web_search_allowed_domains||""),Mi&&(Mi.value=K.form.claude_web_search_blocked_domains||""),Qt&&(Qt.value=K.form.claude_web_search_cache_ttl||"none");let ti=r.querySelector('select[name="openrouter_web_search_engine"]'),wt=r.querySelector('input[name="openrouter_web_search_max_results"]'),at=r.querySelector('input[name="openrouter_web_search_search_prompt"]');ti&&(ti.value=K.form.openrouter_web_search_engine||"auto"),wt&&(wt.value=K.form.openrouter_web_search_max_results||"5"),at&&(at.value=K.form.openrouter_web_search_search_prompt||"");let et=r.querySelector('select[name="google_grounding_mode"]'),ei=r.querySelector('input[name="google_grounding_dynamic_threshold"]'),li=r.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(et&&(et.value=K.form.google_grounding_mode||"DEFAULT_MODE"),ei){let Jt=K.form.google_grounding_dynamic_threshold||.3;ei.value=Jt,li&&(li.textContent=Jt)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(b.value,r),pe&&pe.dispatchEvent(new Event("change",{bubbles:!0})),we&&we.dispatchEvent(new Event("change",{bubbles:!0})),de&&de.dispatchEvent(new Event("change",{bubbles:!0})),ae&&ae.dispatchEvent(new Event("change",{bubbles:!0})),K.form.structure&&Array.isArray(K.form.structure))if(l.formStructure=K.form.structure,h.innerHTML="",l.formStructure.length===0)h.appendChild(W());else{l.formStructure.forEach(Ut=>{window.aipkitForms_renderLayoutRow(h,Ut,null,s)});let Jt=0;l.formStructure.forEach(Ut=>{Ut.columns.forEach(Di=>{Di.elements.forEach(xt=>{let pi=xt.internalId.split("-"),Wt=parseInt(pi[pi.length-1],10)||0;Wt>Jt&&(Jt=Wt)})})}),l.droppedElementCounter=Jt}else h.innerHTML="",h.appendChild(W());m(),e(r,!0),k(s),typeof window.aipkitForms_onEditorReady=="function"&&window.aipkitForms_onEditorReady(s)}else throw new Error(K.message||o("Could not load form data.","gpt3-ai-content-generator"))}).catch(K=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(s,"error",K.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(s):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):(D.disabled=!0,R())})}window.aipkitForms_showFormEditor=i,window.aipkitForms_updatePromptSnippets=k,window.aipkitForms_initPromptSnippets=n})();(function(){"use strict";function k(n){let e=window.aipkitAIFormsState,i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p;if(!n){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}e.currentFormId=null,e.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(n):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let a=n.querySelector("#aipkit_form_editor_container"),s=n.querySelector("#aipkit_ai_forms_list_container"),l=n.querySelector("#aipkit_ai_forms_editor_actions"),c=n.querySelector("#aipkit_create_new_ai_form_btn"),o=n.querySelector("#aipkit_ai_forms_settings_trigger"),t=n.querySelector("#aipkit_ai_forms_header_title_default"),r=n.querySelector("#aipkit_ai_forms_header_title_editor");if(a&&(a.style.display="none"),s&&(s.style.display="block"),l&&(l.style.display="none"),c&&(c.style.display=""),o&&(o.style.display=""),t&&(t.style.display=""),r&&(r.style.display="none"),typeof window.aipkitForms_closePreviewSheet=="function"&&window.aipkitForms_closePreviewSheet(n),a){let p=a.querySelector("#aipkit_ai_form_ai_provider");p&&delete p.dataset.aipkitProviderNoticeArmed}let f=document.getElementById("aipkit_provider_notice_ai_forms");if(f&&f.classList.add("aipkit_provider_notice--hidden"),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(n),a){let p=a.querySelector("#aipkit_ai_form_preview_container");p&&(p.style.display="none",p.innerHTML="");let _=n.querySelector("#aipkit_preview_ai_form_btn");if(_&&_.classList.contains("aipkit-preview-active")){_.classList.remove("aipkit-preview-active");let m=_.querySelector(".aipkit_btn-text");m&&(m.textContent=i("Preview","gpt3-ai-content-generator"))}}let u=n.querySelector("#aipkit_ai_forms_messages");u&&(u.innerHTML=""),typeof window.aipkitForms_onEditorHidden=="function"&&window.aipkitForms_onEditorHidden(n)}window.aipkitForms_hideFormEditor=k})();(function(){"use strict";let k=null,n=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:r=>r,e=r=>{if(!Array.isArray(r)||r.length===0)return!1;for(let f of r)if(!(!f||!Array.isArray(f.columns))){for(let u of f.columns)if(!(!u||!Array.isArray(u.elements))&&u.elements.length>0)return!0}return!1},i=r=>r?r.querySelector("#aipkit_ai_forms_status"):null,a=(r,f,u)=>{let p=i(r);if(!p)return;let _=p.classList.contains("aipkit_training_status");if(p.textContent=f||"",_){p.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),f&&p.classList.add("is-visible"),u&&p.classList.add(`is-${u}`);return}p.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),u==="success"?p.classList.add("aipkit_form-help-success"):u==="error"&&p.classList.add("aipkit_form-help-error")},s=(r,f=2500)=>{k&&window.clearTimeout(k),k=window.setTimeout(()=>{a(r,"","")},f)},l=(r,f={})=>{let u=n();return new Promise(p=>{if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(r,{title:f.title||u("Confirm","gpt3-ai-content-generator"),confirmText:f.confirmText||u("Confirm","gpt3-ai-content-generator"),cancelText:f.cancelText||u("Cancel","gpt3-ai-content-generator"),onConfirm:()=>p(!0),onCancel:()=>p(!1)});return}p(window.confirm(r))})};function c(r,f={}){let u=window.aipkitAIFormsState,p=window.aipkit_ai_forms_config||{text:{}},_=n();if(!r)return{error:{code:"missing_container",message:"AI Forms saveForm: formsContainerElement not provided."}};let m=r.querySelector("#aipkit_form_editor_container");if(!m)return{error:{code:"missing_editor",message:"AI Forms saveForm: editorContainer not found in provided formsContainerElement."}};let g=r.querySelector("#aipkit_ai_form_title"),d=m.querySelector("#aipkit_ai_form_prompt_template"),w=m.querySelector("#aipkit_ai_form_id"),h=m.querySelector("#aipkit_ai_form_ai_provider"),b=m.querySelector("#aipkit_ai_form_ai_model"),A=m.querySelector("#aipkit_ai_form_temperature"),S=m.querySelector("#aipkit_ai_form_max_tokens"),I=m.querySelector("#aipkit_ai_form_top_p"),T=m.querySelector("#aipkit_ai_form_frequency_penalty"),x=m.querySelector("#aipkit_ai_form_presence_penalty"),E=m.querySelector("#aipkit_ai_form_reasoning_effort"),v=m.querySelector('input[name="enable_vector_store"]'),y=m.querySelector('select[name="vector_store_provider"]'),C=m.querySelector('select[name="openai_vector_store_ids[]"]'),M=m.querySelector('select[name="pinecone_index_name"]'),B=m.querySelector('select[name="qdrant_collection_name"]'),D=m.querySelector('select[name="vector_embedding_provider"]'),W=m.querySelector('select[name="vector_embedding_model"]'),U=m.querySelector('input[name="vector_store_top_k"]'),J=m.querySelector('input[name="vector_store_confidence_threshold"]'),oe=m.querySelector('input[name="openai_web_search_enabled"]'),O=m.querySelector('input[name="claude_web_search_enabled"]'),L=m.querySelector('input[name="openrouter_web_search_enabled"]'),F=m.querySelector('input[name="google_search_grounding_enabled"]'),N=m.querySelector('select[name="openai_web_search_context_size"]'),R=m.querySelector('select[name="openai_web_search_loc_type"]'),H=m.querySelector('input[name="openai_web_search_loc_country"]'),K=m.querySelector('input[name="openai_web_search_loc_city"]'),re=m.querySelector('input[name="openai_web_search_loc_region"]'),ve=m.querySelector('input[name="openai_web_search_loc_timezone"]'),Ie=m.querySelector('input[name="claude_web_search_max_uses"]'),Ee=m.querySelector('select[name="claude_web_search_loc_type"]'),Z=m.querySelector('input[name="claude_web_search_loc_country"]'),pe=m.querySelector('input[name="claude_web_search_loc_city"]'),we=m.querySelector('input[name="claude_web_search_loc_region"]'),de=m.querySelector('input[name="claude_web_search_loc_timezone"]'),ae=m.querySelector('input[name="claude_web_search_allowed_domains"]'),ne=m.querySelector('input[name="claude_web_search_blocked_domains"]'),ye=m.querySelector('select[name="claude_web_search_cache_ttl"]'),Me=m.querySelector('select[name="openrouter_web_search_engine"]'),nt=m.querySelector('input[name="openrouter_web_search_max_results"]'),se=m.querySelector('input[name="openrouter_web_search_search_prompt"]'),be=m.querySelector('select[name="google_grounding_mode"]'),xe=m.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!g||!d||!w||!h||!b||!A||!S||!I||!T||!x)return{error:{code:"missing_inputs",message:"AI Forms saveForm: One or more critical form editor inputs not found in editorContainer."}};let Re=g.value.trim(),De=d.value.trim(),ze=w.value;if(Re||(Re=_("New Form","gpt3-ai-content-generator"),g.value=Re,f.skipSyntheticInputEvent||g.dispatchEvent(new Event("input",{bubbles:!0}))),!De)return{error:{code:"prompt_required",message:p.text.promptTemplateRequired||"Prompt template is required."}};let Ze=new Set;if(Array.isArray(u?.formStructure)){for(let wt of u.formStructure)if(!(!wt||!Array.isArray(wt.columns))){for(let at of wt.columns)if(!(!at||!Array.isArray(at.elements))){for(let et of at.elements)if(et){if(!et.fieldId||!/^[a-zA-Z0-9_]+$/.test(et.fieldId))return{error:{code:"invalid_field_id",message:_(`Invalid Field Variable Name: "${et.fieldId||""}" for element "${et.label||""}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator"),elementInternalId:et.internalId}};if(Ze.has(et.fieldId))return{error:{code:"duplicate_field_id",message:_(`Duplicate Field Variable Name: "${et.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator"),elementInternalId:et.internalId}};Ze.add(et.fieldId)}}}}let it=Array.isArray(u?.formStructure)?u.formStructure:[];if(ze&&!f.allowEmptyStructure&&!e(it))return{error:{code:"empty_structure_confirmation_required",message:_(p.text.confirmSaveEmptyForm||"This form currently has no fields. Saving now will remove previously configured fields. Do you want to continue?","gpt3-ai-content-generator")}};let Pt=C?Array.from(C.selectedOptions).map(wt=>wt.value):[],Mi=m.querySelectorAll('input[name^="labels["]'),Qt={};Mi.forEach(wt=>{let at=wt.name.match(/\[(.*?)\]/);at&&at[1]&&(Qt[at[1]]=wt.value)});let ti={_ajax_nonce:p.nonce_manage_forms,form_id:ze||null,title:Re,prompt_template:De,form_structure:JSON.stringify(it),ai_provider:h.value,ai_model:b.value,temperature:A.value,max_tokens:S.value,top_p:I.value,frequency_penalty:T.value,presence_penalty:x.value,reasoning_effort:E?.value||"",enable_vector_store:v?.checked?"1":"0",vector_store_provider:y?.value,openai_vector_store_ids:Pt,pinecone_index_name:M?.value||"",qdrant_collection_name:B?.value||"",vector_embedding_provider:D?.value,vector_embedding_model:W?.value||"",vector_store_top_k:U?.value||3,vector_store_confidence_threshold:J?.value||20,openai_web_search_enabled:oe?.checked?"1":"0",claude_web_search_enabled:O?.checked?"1":"0",openrouter_web_search_enabled:L?.checked?"1":"0",google_search_grounding_enabled:F?.checked?"1":"0",openai_web_search_context_size:N?.value||"medium",openai_web_search_loc_type:R?.value||"none",openai_web_search_loc_country:H?.value||"",openai_web_search_loc_city:K?.value||"",openai_web_search_loc_region:re?.value||"",openai_web_search_loc_timezone:ve?.value||"",claude_web_search_max_uses:Ie?.value||"5",claude_web_search_loc_type:Ee?.value||"none",claude_web_search_loc_country:Z?.value||"",claude_web_search_loc_city:pe?.value||"",claude_web_search_loc_region:we?.value||"",claude_web_search_loc_timezone:de?.value||"",claude_web_search_allowed_domains:ae?.value||"",claude_web_search_blocked_domains:ne?.value||"",claude_web_search_cache_ttl:ye?.value||"none",openrouter_web_search_engine:Me?.value||"auto",openrouter_web_search_max_results:nt?.value||"5",openrouter_web_search_search_prompt:se?.value||"",google_grounding_mode:be?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:xe?.value||"0.30",labels:JSON.stringify(Qt)};return f.allowEmptyStructure&&(ti.allow_empty_structure="1"),{data:ti,formIdInput:w,currentFormIdValue:ze,formStructure:it,editorContainer:m}}function o(r,f,u){if(!r||!u)return;typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(u,f);let p=r.querySelector(`#setting-field-id-${u}`);p&&p.focus()}function t(r,f,u={}){let p=window.aipkit_ai_forms_config||{text:{}},_=n(),m=u.isAutosave===!0;if(!f)return console.error("AI Forms saveForm: formsContainerElement not provided."),Promise.reject(new Error("AI Forms saveForm: formsContainerElement not provided."));if(typeof window.aipkit_apiRequest!="function"){let T=new Error("AI Forms saveForm: aipkit_apiRequest not found.");return a(f,_("Error saving form.","gpt3-ai-content-generator"),"error"),Promise.reject(T)}let g=c(f,{suppressValidationAlerts:u.suppressValidationAlerts===!0,allowEmptyStructure:u.allowEmptyStructure===!0,skipSyntheticInputEvent:m});if(g.error){let T=new Error(g.error.message||"Unable to save form.");return T.code=g.error.code||"save_validation_failed",T.elementInternalId=g.error.elementInternalId||"",T.code==="invalid_field_id"||T.code==="duplicate_field_id"?(u.suppressValidationAlerts!==!0&&!m&&(alert(T.message),o(f.querySelector("#aipkit_form_editor_container"),f,T.elementInternalId)),m&&a(f,_("Unsaved changes","gpt3-ai-content-generator"),"warning"),Promise.reject(T)):T.code==="prompt_required"||T.code==="missing_inputs"||T.code==="missing_editor"||T.code==="missing_container"?(u.suppressValidationAlerts!==!0&&!m&&alert(T.message),m&&a(f,_("Unsaved changes","gpt3-ai-content-generator"),"warning"),Promise.reject(T)):T.code==="empty_structure_confirmation_required"&&!m&&u.allowEmptyStructure!==!0?l(T.message,{title:_("Confirm","gpt3-ai-content-generator"),confirmText:_("Save Empty Form","gpt3-ai-content-generator"),cancelText:_("Cancel","gpt3-ai-content-generator")}).then(x=>{if(!x){let E=new Error(_("Save cancelled.","gpt3-ai-content-generator"));return E.code="save_cancelled",Promise.reject(E)}return t(r,f,{...u,allowEmptyStructure:!0})}):(m?a(f,_("Unsaved changes","gpt3-ai-content-generator"),"warning"):u.suppressValidationAlerts!==!0&&alert(T.message),Promise.reject(T))}let{data:d,currentFormIdValue:w,formIdInput:h}=g,b=r&&r.nodeType===1?r:null,A=b?.querySelector(".aipkit_btn-text")||null,S=b?.querySelector(".aipkit_spinner")||null,I=A?A.textContent:b?b.textContent:"";return b&&!m&&(b.disabled=!0,S&&(S.style.display="inline-block"),A&&(A.textContent=_(p.text.savingForm||"Saving...","gpt3-ai-content-generator"))),a(f,_(m?"Auto-saving...":"Saving...","gpt3-ai-content-generator"),"loading"),window.aipkit_apiRequest("aipkit_save_ai_form",d).then(T=>{if(!w&&T.form_id){h&&(h.value=T.form_id),window.aipkitAIFormsState&&(window.aipkitAIFormsState.currentFormId=T.form_id);let E=f.querySelector("#aipkit_preview_ai_form_btn");E&&(E.disabled=!1)}if(typeof window.aipkitForms_onFormSaveSuccess=="function")try{window.aipkitForms_onFormSaveSuccess(f,T,{isAutosave:m,requestData:d})}catch(E){console.warn("AI Forms save hook failed:",E)}let x=m?_("All changes saved","gpt3-ai-content-generator"):T.message||_(p.text.formSaved||"Form saved!","gpt3-ai-content-generator");return a(f,x,"success"),s(f,m?1600:2500),!m&&u.skipFetchList!==!0&&typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms(),T}).catch(T=>{let x=T?.message||_(p.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator");throw a(f,x,"error"),s(f,4e3),T}).finally(()=>{b&&!m&&(b.disabled=!1,S&&(S.style.display="none"),A?A.textContent=I:b&&(b.textContent=I))})}window.aipkitForms_buildSavePayload=c,window.aipkitForms_saveForm=t,window.aipkitForms_setHeaderStatus=a})();(function(){"use strict";function k(n,e,i){let a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!i){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let l={_ajax_nonce:a.nonce_manage_forms,form_id:n},c=e.textContent;e.disabled=!0,e.textContent=s(a.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",l).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",o.message||s(a.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",o.message||s(a.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let t=i.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${n}"]`);t&&(t.disabled=!1,t.textContent=c)})}window.aipkitForms_deleteForm=k})();(function(){"use strict";function k(n,e){let i=window.aipkit_ai_forms_config||{text:{}},a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!e){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let s={_ajax_nonce:i.nonce_manage_forms},l=n.querySelector(".aipkit_btn-text")?.textContent||a("Delete All Forms","gpt3-ai-content-generator"),c=n.querySelector(".aipkit_spinner");n.disabled=!0,n.querySelector(".aipkit_btn-text")&&(n.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${a(i.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",s).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(e,"success",o.message||a(i.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(e,"error",o.message||a(i.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{n.querySelector(".aipkit_btn-text")&&(n.querySelector(".aipkit_btn-text").textContent=l),c&&(c.style.display="none"),n.disabled=!1})}window.aipkitForms_deleteAllForms=k})();(function(){"use strict";function k(n,e,i){let a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!i){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let l={_ajax_nonce:a.nonce_manage_forms,form_id:n},c=e.textContent;e.disabled=!0,e.textContent=s(a.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",l).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",o.message||s("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",o.message||s(a.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let o=i.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${n}"]`);o&&(o.disabled=!1,o.textContent=c)})}window.aipkitForms_duplicateForm=k})();(function(){"use strict";async function k(n){let e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s,a=n.textContent;n.disabled=!0,n.textContent=i("Exporting...","gpt3-ai-content-generator");try{let s=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:e.nonce_manage_forms});if(s.forms&&Array.isArray(s.forms)&&s.forms.length>0){let l=s.forms.map(p=>(delete p.id,delete p.status,p)),o=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,t=JSON.stringify(l,null,2),r=new Blob([t],{type:"application/json"}),f=URL.createObjectURL(r),u=document.createElement("a");u.href=f,u.download=o,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(f)}else throw new Error(i("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(s){alert(i("Error exporting forms: ","gpt3-ai-content-generator")+s.message)}finally{n.disabled=!1,n.textContent=a}}window.aipkitForms_exportAllForms=k})();(function(){"use strict";async function k(n,e){let i=window.aipkit_ai_forms_config||{text:{}},a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l,s=e.textContent;e.disabled=!0,e.textContent=a("Exporting...","gpt3-ai-content-generator");try{let l=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:n,_ajax_nonce:i.nonce_manage_forms});if(l.form){let c=l.form,o=c.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),t=`aipkit-form-${n}-${o}.json`;delete c.id,delete c.status;let r=JSON.stringify(c,null,2),f=new Blob([r],{type:"application/json"}),u=URL.createObjectURL(f),p=document.createElement("a");p.href=u,p.download=t,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(u)}else throw new Error(a("Form data not found in response.","gpt3-ai-content-generator"))}catch(l){alert(a("Error exporting form: ","gpt3-ai-content-generator")+l.message)}finally{e.disabled=!1,e.textContent=s}}window.aipkitForms_exportForm=k})();(function(){"use strict";let k=document.getElementById("aipkit_ai_forms_import_messages"),n;function e(s,l){if(!k)return;let c=window.aipkit_escapeHtml||(o=>o);k.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${s}">${c(l)}</div>`,n&&clearTimeout(n),n=setTimeout(()=>{k.innerHTML=""},8e3)}function i(){k&&(k.innerHTML=""),n&&clearTimeout(n)}async function a(s){let l=window.aipkit_ai_forms_config||{text:{}},c=window.wp?.i18n?.__||(f=>f),o=s.files;if(!o.length)return;let t=o[0];i(),e("info",c("Reading file...","gpt3-ai-content-generator"));let r=new FileReader;r.onload=async function(f){try{let u=f.target.result,p=JSON.parse(u);if(typeof p=="object"&&p!==null&&!Array.isArray(p)&&(p=[p]),!Array.isArray(p))throw new Error(c("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(p.length===0){e("warning",c("File contains no forms to import.","gpt3-ai-content-generator"));return}e("info",c("Importing...","gpt3-ai-content-generator"));let _=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:l.nonce_manage_forms,forms_json:JSON.stringify(p)});e(_.failed_count>0?"warning":"success",_.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(u){e("error",c("Error processing import file: ","gpt3-ai-content-generator")+u.message)}},r.onerror=function(){e("error",c("Error reading the selected file.","gpt3-ai-content-generator"))},r.readAsText(t)}window.aipkitForms_importForms=a})();(function(){"use strict";let k="aipkit_ai_forms_status",n=!1,e=null,i=null,a=null;function s(){return document.getElementById(k)}function l(w,h){let b=s();if(!b)return;let A=b.classList.contains("aipkit_training_status");if(b.textContent=w||"",A){b.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),w&&b.classList.add("is-visible"),h&&b.classList.add(`is-${h}`);return}b.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),h==="success"?b.classList.add("aipkit_form-help-success"):h==="error"&&b.classList.add("aipkit_form-help-error")}function c(w=2500){a&&window.clearTimeout(a),a=window.setTimeout(()=>{l("","")},w)}function o(){return document.getElementById("aipkit_ai_forms_settings_form")}function t(){let w=o();if(!w)return console.error("AI Forms Save Settings: Settings form not found."),null;let h=new FormData(w),b={};return h.forEach((A,S)=>{b[S]=A}),b}function r(w){if(!w)return"";let h={};return Object.keys(w).sort().forEach(b=>{h[b]=w[b]}),JSON.stringify(h)}function f(w){i=r(w)}function u(w){return r(w)!==i}async function p(w,h){let b=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:I=>I;if(typeof window.aipkit_apiRequest!="function"){console.error("AI Forms Save Settings: aipkit_apiRequest not found.");return}l(b("Saving...","gpt3-ai-content-generator"),"loading");let A="",S=null;h&&(A=h.querySelector(".aipkit_btn-text")?.textContent||b("Save AI Forms Settings","gpt3-ai-content-generator"),S=h.querySelector(".aipkit_spinner"),h.disabled=!0,S&&(S.style.display="inline-block"),h.querySelector(".aipkit_btn-text")&&(h.querySelector(".aipkit_btn-text").textContent=b("Saving...","gpt3-ai-content-generator")));try{let I=await window.aipkit_apiRequest("aipkit_save_ai_forms_settings",w);return l(I.message||b("Settings saved!","gpt3-ai-content-generator"),"success"),c(),f(w),I}catch(I){throw l(I.message||b("Failed to save settings.","gpt3-ai-content-generator"),"error"),c(4e3),console.error("AI Forms Save Settings Error:",I),I}finally{h&&(h.disabled=!1,S&&(S.style.display="none"),h.querySelector(".aipkit_btn-text")&&(h.querySelector(".aipkit_btn-text").textContent=A))}}function _(w,h){if(w){if(n){e=w;return}n=!0,p(w,h).catch(()=>{}).finally(()=>{if(n=!1,e){let b=e;e=null,u(b)&&_(b,null)}})}}function m(w){let h=t();_(h,w)}function g(){let w=t();!w||!u(w)||_(w,null)}function d(){let w=t();w&&f(w)}window.aipkitForms_saveAiFormsSettings=m,window.aipkitForms_handleSettingsAutosave=g,window.aipkitForms_updateSettingsAutosaveBaseline=d})();(function(){"use strict";let k="aipkit_ai_forms_editor_draft_v1_",e={activeContainer:null,baselineSignature:"",isDirty:!1,autosaveTimer:null,autosaveInFlight:!1,pendingAutosave:!1,suppressTracking:!1,activeDraftKey:"",restorePromptedKey:"",unloadBound:!1},i=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:de=>de,a=de=>de&&de.nodeType===1?de:document.getElementById("aipkit_ai_forms_container"),s=de=>de?de.querySelector("#aipkit_form_editor_container"):null,l=de=>{let ae=s(de);return ae?window.getComputedStyle(ae).display!=="none":!1},c=de=>{let ne=s(de)?.querySelector("#aipkit_ai_form_id");return ne?.value?String(ne.value):""},o=()=>{let de=window.aipkit_ai_forms_config||{};return String(de.current_user_id||0)},t=(de,ae=null)=>{let ne=ae!=null?String(ae):c(de),ye=ne?`form_${ne}`:"new";return`${k}${o()}_${ye}`},r=()=>{try{return window.localStorage}catch{return null}},f=de=>{let ae=r();if(!de||!ae)return null;try{return ae.getItem(de)}catch{return null}},u=(de,ae)=>{let ne=r();if(!(!de||!ne))try{ne.setItem(de,ae)}catch{}},p=de=>{let ae=r();if(!(!de||!ae))try{ae.removeItem(de)}catch{}},_=de=>{try{return JSON.parse(JSON.stringify(de))}catch{return Array.isArray(de)?[]:{}}},m=de=>Array.isArray(de)?`[${de.map(ae=>m(ae)).join(",")}]`:de&&typeof de=="object"?`{${Object.keys(de).sort().map(ne=>`${JSON.stringify(ne)}:${m(de[ne])}`).join(",")}}`:JSON.stringify(de),g=de=>{if(!de||typeof de!="object")return"";let ae={...de,savedAt:0};return m(ae)},d=de=>{let ae=0;return Array.isArray(de)&&de.forEach(ne=>{!ne||!Array.isArray(ne.columns)||ne.columns.forEach(ye=>{!ye||!Array.isArray(ye.elements)||ye.elements.forEach(Me=>{if(!Me||typeof Me.internalId!="string")return;let nt=Me.internalId.split("-"),se=parseInt(nt[nt.length-1],10)||0;se>ae&&(ae=se)})})}),ae},w=de=>{let ae={};return de&&de.querySelectorAll("input[name], select[name], textarea[name]").forEach(ye=>{if(!(!ye||!ye.name)&&!ye.closest(".aipkit_dropped_element")&&ye.type!=="file"){if(ye.tagName==="SELECT"&&ye.multiple){ae[ye.name]=Array.from(ye.selectedOptions).map(Me=>Me.value);return}if(ye.type==="checkbox"){ae[ye.name]=ye.checked?"1":"0";return}if(ye.type==="radio"){ye.checked&&(ae[ye.name]=ye.value);return}ae[ye.name]=ye.value}}),ae},h=de=>{let ae=a(de);if(!ae)return null;let ne=s(ae);if(!ne)return null;let ye=window.aipkitAIFormsState||{},Me=ae.querySelector("#aipkit_ai_form_title"),nt=ne.querySelector("#aipkit_ai_form_prompt_template"),se=ne.querySelector("#aipkit_ai_form_id");return{version:1,formId:se?.value?String(se.value):"",title:Me?.value||"",promptTemplate:nt?.value||"",structure:_(ye.formStructure||[]),controls:w(ne),savedAt:Date.now()}},b=(de,ae,ne)=>{if(typeof window.aipkitForms_setHeaderStatus=="function"){window.aipkitForms_setHeaderStatus(de,ae,ne);return}let ye=de?.querySelector("#aipkit_ai_forms_status");ye&&(ye.textContent=ae||"",ye.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ae&&ye.classList.add("is-visible"),ne&&ye.classList.add(`is-${ne}`))},A=de=>{let ae=f(de);if(!ae)return null;try{let ne=JSON.parse(ae);return!ne||typeof ne!="object"||!ne.snapshot||typeof ne.snapshot!="object"?null:ne}catch{return null}},S=(de,ae)=>{!de||!ae||typeof ae!="object"||u(de,JSON.stringify(ae))},I=de=>{let ae=a(de);if(!ae)return e.activeDraftKey="","";let ne=t(ae);if(!e.activeDraftKey)return e.activeDraftKey=ne,ne;if(e.activeDraftKey!==ne){let ye=A(ne),Me=A(e.activeDraftKey);!ye&&Me&&S(ne,Me),p(e.activeDraftKey),e.activeDraftKey=ne}return e.activeDraftKey},T=(de,ae=null)=>{let ne=a(de);if(!ne)return;let ye=ae||h(ne);if(!ye)return;let Me=I(ne);Me&&S(Me,{version:1,savedAt:Date.now(),snapshot:ye})},x=de=>{let ae=a(de);if(!ae)return;let ne=I(ae);p(ne)},E=(de,{clearDraft:ae=!1,resetRestorePrompt:ne=!1}={})=>{let ye=a(de);if(!ye)return;let Me=h(ye);e.baselineSignature=g(Me),e.isDirty=!1,e.pendingAutosave=!1,ae&&x(ye),ne&&(e.restorePromptedKey="")},v=de=>{let ae=a(de);if(!ae||!l(ae))return e.isDirty=!1,!1;let ne=h(ae),ye=g(ne);return e.baselineSignature?(e.isDirty=ye!==e.baselineSignature,e.isDirty):(e.isDirty=!1,!1)},y=()=>{e.autosaveTimer&&(window.clearTimeout(e.autosaveTimer),e.autosaveTimer=null)},C=(de,ae=!1)=>{let ne=a(de);if(!ne||e.suppressTracking)return;y(),e.pendingAutosave=!0;let ye=ae?80:1500;e.autosaveTimer=window.setTimeout(()=>{e.autosaveTimer=null,B(ne)},ye)},M=(de,{queueSave:ae=!0,immediate:ne=!1}={})=>{let ye=a(de);if(!ye||e.suppressTracking||!l(ye))return;let Me=h(ye),nt=g(Me);if(!e.baselineSignature){e.baselineSignature=nt,e.isDirty=!1;return}let se=nt!==e.baselineSignature;e.isDirty=se,se&&(T(ye,Me),e.autosaveInFlight||b(ye,i()("Unsaved changes","gpt3-ai-content-generator"),"warning"),ae&&C(ye,ne))};async function B(de){let ae=a(de);if(!ae)return;if(!l(ae)||!v(ae)){e.pendingAutosave=!1;return}if(e.autosaveInFlight){e.pendingAutosave=!0;return}if(typeof window.aipkitForms_saveForm!="function")return;e.autosaveInFlight=!0,e.pendingAutosave=!1;let ne=h(ae);T(ae,ne);try{await window.aipkitForms_saveForm(null,ae,{isAutosave:!0,suppressValidationAlerts:!0,skipFetchList:!0}),E(ae,{clearDraft:!0})}catch(ye){let Me=ye?.code==="prompt_required"||ye?.code==="invalid_field_id"||ye?.code==="duplicate_field_id"||ye?.code==="empty_structure_confirmation_required"?i()("Unsaved changes","gpt3-ai-content-generator"):ye?.message||i()("Autosave failed.","gpt3-ai-content-generator");b(ae,Me,"warning")}finally{e.autosaveInFlight=!1,e.pendingAutosave&&v(ae)&&C(ae,!0)}}let D=de=>{let ae=i(),ne=de.querySelector("#aipkit_form_designer_placeholder");ne||(ne=document.createElement("div"),ne.className="aipkit_form_designer_placeholder",ne.id="aipkit_form_designer_placeholder",ne.innerHTML=`<span class="dashicons dashicons-layout"></span>${ae("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,de.appendChild(ne)),ne.style.display="flex"},W=(de,ae)=>{let ne=a(de);if(!ne)return;let Me=s(ne)?.querySelector("#aipkit_ai_form_designer_area");if(!(!Me||!window.aipkitAIFormsState)){if(window.aipkitAIFormsState.formStructure=Array.isArray(ae)?_(ae):[],Me.innerHTML="",!Array.isArray(window.aipkitAIFormsState.formStructure)||window.aipkitAIFormsState.formStructure.length===0){D(Me),window.aipkitAIFormsState.droppedElementCounter=0;return}if(typeof window.aipkitForms_renderLayoutRow!="function"){D(Me);return}window.aipkitAIFormsState.formStructure.forEach(nt=>{window.aipkitForms_renderLayoutRow(Me,nt,null,ne)}),window.aipkitAIFormsState.droppedElementCounter=d(window.aipkitAIFormsState.formStructure)}},U=(de,ae)=>{if(!de||!ae||typeof ae!="object")return;let ye=Array.from(de.querySelectorAll("input[name], select[name], textarea[name]")).reduce((be,xe)=>(!xe||!xe.name||(be[xe.name]||(be[xe.name]=[]),be[xe.name].push(xe)),be),{});Object.keys(ae).forEach(be=>{let xe=ye[be]||[];if(!xe.length)return;let Re=ae[be];xe.forEach(De=>{if(De.tagName==="SELECT"&&De.multiple){let ze=Array.isArray(Re)?Re.map(Ze=>String(Ze)):[];Array.from(De.options).forEach(Ze=>{Ze.selected=ze.includes(Ze.value)});return}if(De.type==="checkbox"){De.checked=Re==="1"||Re===!0||Re==="true";return}if(De.type==="radio"){De.checked=String(Re)===String(De.value);return}De.value=Re??""})});let Me=de.querySelector("#aipkit_ai_form_ai_provider"),nt=de.querySelector("#aipkit_ai_form_ai_model");if(Me&&nt&&typeof window.aipkitForms_populateAiModels=="function"){let be=Me.value||"OpenAI",xe=ae.ai_model||nt.value||"";window.aipkitForms_populateAiModels(be,xe)}["#aipkit_ai_form_ai_provider",'input[name="enable_vector_store"]','input[name="openai_web_search_enabled"]','input[name="claude_web_search_enabled"]','input[name="openrouter_web_search_enabled"]','input[name="google_search_grounding_enabled"]'].forEach(be=>{let xe=de.querySelector(be);xe&&xe.dispatchEvent(new Event("change",{bubbles:!0}))}),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(de)},J=(de,ae)=>{let ne=a(de);if(!ne||!ae||typeof ae!="object")return;let ye=s(ne);if(!ye)return;e.suppressTracking=!0;let Me=ne.querySelector("#aipkit_ai_form_title"),nt=ye.querySelector("#aipkit_ai_form_prompt_template"),se=ye.querySelector("#aipkit_ai_form_id");Me&&(Me.value=ae.title||"",Me.dispatchEvent(new Event("input",{bubbles:!0}))),nt&&(nt.value=ae.promptTemplate||""),se&&ae.formId&&(se.value=String(ae.formId)),W(ne,ae.structure||[]),U(ye,ae.controls||{}),typeof window.aipkitForms_refreshSelectPickers=="function"&&window.aipkitForms_refreshSelectPickers(ne),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(ne),e.suppressTracking=!1},oe=(de,ae={})=>{let ne=i();return new Promise(ye=>{if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(de,{title:ae.title||ne("Confirm","gpt3-ai-content-generator"),confirmText:ae.confirmText||ne("Confirm","gpt3-ai-content-generator"),cancelText:ae.cancelText||ne("Cancel","gpt3-ai-content-generator"),onConfirm:()=>ye(!0),onCancel:()=>ye(!1)});return}ye(window.confirm(de))})},O=async de=>{let ae=a(de);if(!ae||!l(ae))return;let ne=I(ae);if(!ne||e.restorePromptedKey===ne)return;e.restorePromptedKey=ne;let ye=A(ne);if(!ye||!ye.snapshot)return;let Me=h(ae),nt=g(Me),se=g(ye.snapshot);if(!se||se===nt){p(ne);return}let be=i(),xe=ye.savedAt?be("A local unsaved draft was found. Do you want to restore it?","gpt3-ai-content-generator"):be("Restore local unsaved draft?","gpt3-ai-content-generator");if(!await oe(xe,{title:be("Restore Draft","gpt3-ai-content-generator"),confirmText:be("Restore","gpt3-ai-content-generator"),cancelText:be("Discard","gpt3-ai-content-generator")})){p(ne);return}J(ae,ye.snapshot),M(ae,{queueSave:!0,immediate:!0}),b(ae,be("Recovered local draft","gpt3-ai-content-generator"),"warning")},L=async de=>{let ae=i(),ne=ae("You have unsaved AI Form changes. Choose what to do before leaving.","gpt3-ai-content-generator");return typeof window.aipkit_showConfirmModal=="function"?new Promise(nt=>{window.aipkit_showConfirmModal(ne,{title:ae("Unsaved Changes","gpt3-ai-content-generator"),confirmText:ae("Save and Leave","gpt3-ai-content-generator"),secondaryText:ae("Leave Without Saving","gpt3-ai-content-generator"),cancelText:ae("Stay","gpt3-ai-content-generator"),onConfirm:()=>nt("save"),onSecondary:()=>nt("discard"),onCancel:()=>nt("stay")})}):await oe(ne,{title:ae("Unsaved Changes","gpt3-ai-content-generator"),confirmText:ae("Save and Leave","gpt3-ai-content-generator"),cancelText:ae("Leave Without Saving","gpt3-ai-content-generator")})?"save":await oe(ae("Leave without saving your recent changes?","gpt3-ai-content-generator"),{title:ae("Unsaved Changes","gpt3-ai-content-generator"),confirmText:ae("Leave Without Saving","gpt3-ai-content-generator"),cancelText:ae("Stay","gpt3-ai-content-generator")})?"discard":"stay"},F=async(de,ae={})=>{let ne=a(de);if(!ne||!l(ne)||!v(ne))return!0;let ye=await L(ne);if(ye==="stay")return!1;if(ye==="discard")return y(),e.pendingAutosave=!1,e.isDirty=!1,e.baselineSignature=g(h(ne)),ae.keepDraftOnDiscard!==!0&&x(ne),!0;if(ye==="save"){if(typeof window.aipkitForms_saveForm!="function")return!1;try{let Me=ae.skipFetchListOnSave===!0;return await window.aipkitForms_saveForm(null,ne,{isAutosave:!1,suppressValidationAlerts:!1,skipFetchList:Me}),!0}catch{return!1}}return!1},N=de=>{let ae=a(e.activeContainer);if(!(!ae||!l(ae))&&v(ae))return T(ae),de.preventDefault(),de.returnValue="",""},R=()=>{let de=a(e.activeContainer);!de||!l(de)||v(de)&&T(de)},H=()=>{e.unloadBound||(window.addEventListener("beforeunload",N),window.addEventListener("pagehide",R),e.unloadBound=!0)},K=de=>{let ae=a(de);if(!ae)return;if(ae.dataset.aipkitEditorPersistenceBound==="true"){e.activeContainer=ae,H();return}let ne=ye=>{if(e.suppressTracking||!ye?.isTrusted)return;let Me=ye.target;!Me||typeof Me.closest!="function"||Me.matches("input, select, textarea")&&Me.closest("#aipkit_form_editor_container")&&(Me.closest(".aipkit_dropped_element")||l(ae)&&M(ae,{queueSave:!0,immediate:!1}))};ae.addEventListener("input",ne,!0),ae.addEventListener("change",ne,!0),ae.dataset.aipkitEditorPersistenceBound="true",e.activeContainer=ae,H()},re=de=>{let ae=a(de);ae&&(e.activeContainer=ae,e.suppressTracking=!0,y(),e.pendingAutosave=!1,I(ae),E(ae,{resetRestorePrompt:!0}),e.suppressTracking=!1,O(ae))},ve=de=>{let ae=a(de);ae&&(y(),e.pendingAutosave=!1,e.autosaveInFlight=!1,e.isDirty=!1,e.baselineSignature="",e.restorePromptedKey="",e.activeContainer=ae)},Ie=de=>{let ae=a(de);ae&&(I(ae),E(ae,{clearDraft:!0}))},Ee=(de,ae={})=>{let ne=a(de);!ne||e.suppressTracking||!l(ne)||M(ne,{queueSave:ae.queueSave!==!1,immediate:ae.immediate===!0})},Z=async(de,ae,ne={})=>{let ye=a(de);return await F(ye,ne)?(typeof ae=="function"&&ae(),!0):!1},pe=async de=>{let ae=document.getElementById("aipkit_ai_forms_container");return!ae||de==="ai-forms"||!l(ae)?!0:F(ae,{keepDraftOnDiscard:!1,skipFetchListOnSave:!0})},we=typeof window.aipkit_beforeModuleChange=="function"?window.aipkit_beforeModuleChange:null;window.aipkit_beforeModuleChange=async function(de){return we&&await we(de)===!1?!1:pe(de)},window.aipkitForms_initEditorPersistence=K,window.aipkitForms_onEditorReady=re,window.aipkitForms_onEditorHidden=ve,window.aipkitForms_onFormSaveSuccess=Ie,window.aipkitForms_notifyEditorMutation=Ee,window.aipkitForms_hasUnsavedChanges=v,window.aipkitForms_requestLeaveEditor=F,window.aipkitForms_runWithLeaveGuard=Z})();(function(){"use strict";function k(n,e,i){let a=window.aipkit_escapeHtml||function(l){return l};if(!n){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let s=n.querySelector("#aipkit_ai_forms_messages");s?(s.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${e}">${a(i)}</div>`,setTimeout(()=>{s.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=k})();(function(){"use strict";function k(e){if(!e){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let i=e.querySelector(".aipkit_token_limit_mode_select"),a=e.querySelector(".aipkit_token_general_user_limit_field"),s=e.querySelector(".aipkit_token_role_limits_container");if(!i||!a||!s){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let l=i.value;a.hidden=l!=="general",s.hidden=l!=="role_based"}function n(e){if(!e){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let i="data-token-listener-attached";e.getAttribute(i)!=="true"&&(e.addEventListener("change",function(a){a.target.closest(".aipkit_token_limit_mode_select")&&k(e)}),k(e),e.setAttribute(i,"true"))}window.aipkit_initAIFormsTokenManagementUI=n})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_ai_forms_container");return n||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=k})();(function(){"use strict";function k(n){let e=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;n.dataset.clickListenerAttached!=="true"&&(n.addEventListener("click",function(a){let s=a.target,l=o=>s.closest(o),c=n.querySelector("#aipkit_form_editor_container");if(s.matches("#aipkit_create_new_ai_form_btn")||l("#aipkit_create_new_ai_form_btn")){a.preventDefault();let o=()=>{typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,n)};typeof window.aipkitForms_runWithLeaveGuard=="function"?window.aipkitForms_runWithLeaveGuard(n,o,{keepDraftOnDiscard:!1}):o()}else if(l(".aipkit_actions_menu_toggle")){a.preventDefault(),a.stopPropagation();let o=s.closest(".aipkit_actions_menu");if(!o)return;let t=o.querySelector(".aipkit_actions_dropdown_menu");if(!t)return;let r=t.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(f=>{f!==t&&(f.style.display="none")}),t.style.display=r?"none":"block",!r){let f=u=>{o.contains(u.target)||(t.style.display="none")};document.addEventListener("click",f,{once:!0,capture:!0})}}else if(l("#aipkit_import_ai_forms_btn")){a.preventDefault();let o=n.querySelector("#aipkit_ai_forms_import_file_input");o&&o.click()}else if(s.matches(".aipkit_edit_ai_form_btn")||l(".aipkit_edit_ai_form_btn")){a.preventDefault();let t=l(".aipkit_edit_ai_form_btn").dataset.formId,r=()=>{typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(t,n)};typeof window.aipkitForms_runWithLeaveGuard=="function"?window.aipkitForms_runWithLeaveGuard(n,r,{keepDraftOnDiscard:!1}):r()}else if(l(".aipkit_preview_ai_form_btn")){a.preventDefault();let o=l(".aipkit_preview_ai_form_btn"),t=o.dataset.formId,r=o.dataset.formTitle||"";typeof window.aipkitForms_openPreviewSheet=="function"&&window.aipkitForms_openPreviewSheet(t,r,n)}else if(s.matches(".aipkit_duplicate_ai_form_btn")||l(".aipkit_duplicate_ai_form_btn")){a.preventDefault();let o=l(".aipkit_duplicate_ai_form_btn"),t=o.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(t,o,n)}else if(s.matches("#aipkit_export_all_ai_forms_btn")||l("#aipkit_export_all_ai_forms_btn")){a.preventDefault();let o=l("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(o)}else if(s.matches(".aipkit_export_ai_form_btn")||l(".aipkit_export_ai_form_btn")){a.preventDefault();let o=l(".aipkit_export_ai_form_btn"),t=o.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(t,o)}else if(s.matches(".aipkit_delete_ai_form_btn")||l(".aipkit_delete_ai_form_btn")){a.preventDefault();let o=l(".aipkit_delete_ai_form_btn"),t=o.dataset.formId,r=o.dataset.formTitle||`Form ID ${t}`,u=`${i(e.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${r}`,p=()=>{typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(t,o,n)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(u,{title:i("Confirm","gpt3-ai-content-generator"),confirmText:i("Delete","gpt3-ai-content-generator"),cancelText:i("Cancel","gpt3-ai-content-generator"),onConfirm:p});return}confirm(u)&&p()}else if(s.matches("#aipkit_delete_all_ai_forms_btn")||l("#aipkit_delete_all_ai_forms_btn")){a.preventDefault();let o=l("#aipkit_delete_all_ai_forms_btn"),t=i(e.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"),r=()=>{typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(o,n)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(t,{title:i("Confirm","gpt3-ai-content-generator"),confirmText:i("Delete","gpt3-ai-content-generator"),cancelText:i("Cancel","gpt3-ai-content-generator"),onConfirm:r});return}confirm(t)&&r()}else if(s.matches(".aipkit_form_shortcode_input"))a.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(s.value,s);else if(l(".aipkit_aiform_settings_toggle")){a.preventDefault();let o=l(".aipkit_aiform_settings_toggle"),t=o.dataset.formId,r=n.querySelector(`#aif-configurator-${t}`);if(!r)return;let f=r.closest("tr"),u=()=>{let m=o.getBoundingClientRect(),g=r.getBoundingClientRect(),d=g.width||400,w=g.height||0,h=window.innerWidth,b=window.innerHeight,A=12,S=m.left;S+d>h-A&&(S=m.right-d),S=Math.max(A,Math.min(S,h-d-A));let I=m.bottom+8;I+w>b-A&&(I=m.top-w-8),I=Math.max(A,Math.min(I,b-w-A)),r.style.left=`${Math.round(S)}px`,r.style.top=`${Math.round(I)}px`};n.querySelectorAll(".aipkit_shortcode_configurator").forEach(m=>{m!==r&&(m.style.display="none");let g=m.closest("tr");g&&g.classList.remove("aipkit_shortcode_row_open")});let _=r.style.display==="flex";if(r.style.display=_?"none":"flex",f&&f.classList.toggle("aipkit_shortcode_row_open",!_),!_){u();let m=g=>{!r.contains(g.target)&&!o.contains(g.target)&&(r.style.display="none",f&&f.classList.remove("aipkit_shortcode_row_open"),document.removeEventListener("click",m,!0))};setTimeout(()=>{document.addEventListener("click",m,{capture:!0,once:!0})},0)}}else if(l(".aipkit_aiform_shortcode_close")){a.preventDefault();let t=l(".aipkit_aiform_shortcode_close").closest(".aipkit_shortcode_configurator");if(t){t.style.display="none";let r=t.closest("tr");r&&r.classList.remove("aipkit_shortcode_row_open")}}else if(s.matches("#aipkit_validate_prompt_btn")||l("#aipkit_validate_prompt_btn"))a.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(s.matches("#aipkit_save_ai_form_btn")||l("#aipkit_save_ai_form_btn")){a.preventDefault();let o=l("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(o,n).catch(()=>{})}else if(s.matches("#aipkit_cancel_edit_ai_form_btn")||l("#aipkit_cancel_edit_ai_form_btn")){a.preventDefault();let o=()=>{typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(n)};typeof window.aipkitForms_runWithLeaveGuard=="function"?window.aipkitForms_runWithLeaveGuard(n,o,{keepDraftOnDiscard:!1}):o()}else if(s.matches("#aipkit_preview_ai_form_btn")||l("#aipkit_preview_ai_form_btn")){a.preventDefault();let o=c.querySelector("#aipkit_ai_form_id").value;if(!o){alert(i("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}let t=n.querySelector("#aipkit_ai_form_title"),r=t?t.value:"";typeof window.aipkitForms_openPreviewSheet=="function"?window.aipkitForms_openPreviewSheet(o,r,n):console.error("AI Forms Preview: Preview sheet helper not available.")}else if(l(".aipkit_dropped_element_settings_btn")){a.preventDefault();let o=l(".aipkit_dropped_element");o&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(o.id,n)}else if(l(".aipkit_dropped_element_delete_btn")){a.preventDefault();let o=l(".aipkit_dropped_element");o&&confirm(i(e.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(o.id,n)}else if(l(".aipkit_layout_row_delete_btn")){if(a.preventDefault(),confirm(i("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let o=l(".aipkit_layout_row");o&&(Array.from(o.querySelectorAll(".aipkit_dropped_element")).map(r=>r.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(n),o.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(n))}}else if(l("#aipkit_settings_panel_close_btn"))a.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(n);else if(l(".aipkit_remove_option_btn")){a.preventDefault();let o=l(".aipkit_select_option_row");o&&(o.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,n))}else l("#aipkit_add_select_option_btn")&&(a.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(n))}),n.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=k})();(function(){"use strict";let k="aipkit_ai_forms_shortcode_config_v1_";function n(l){if(!l||!window.localStorage)return null;try{let c=window.localStorage.getItem(`${k}${l}`);if(!c)return null;let o=JSON.parse(c);return o&&typeof o=="object"?o:null}catch{return null}}function e(l,c){if(!(!l||!window.localStorage))try{window.localStorage.setItem(`${k}${l}`,JSON.stringify(c))}catch{}}function i(l,c){if(!l)return;let o=c.querySelector(`#aif-configurator-${l}`),t=c.querySelector(`#aif-shortcode-input-${l}`);if(!o||!t)return;let r=o.querySelectorAll(".aipkit-aiform-config-input"),f=[],u={};r.forEach(m=>{let g=m.dataset.attrName;g&&(m.type==="checkbox"?(u[g]=!!m.checked,m.checked&&f.push(`${g}="true"`)):m.type==="select-one"&&(u[g]=m.value,m.value&&m.value!=="light"&&f.push(`${g}="${m.value}"`)))});let p=`[aipkit_ai_form id=${l}`;f.length>0&&(p+=" "+f.join(" ")),p+="]",t.value=p,c.querySelectorAll(`[data-aipkit-shortcode-display="${l}"]`).forEach(m=>{m&&"value"in m&&(m.value=p)}),e(l,u)}function a(l,c){if(!l||!c)return;let o=n(l);if(!o)return;let t=c.querySelector(`#aif-configurator-${l}`);if(!t)return;t.querySelectorAll(".aipkit-aiform-config-input").forEach(f=>{let u=f.dataset.attrName;u&&(f.type==="checkbox"?Object.prototype.hasOwnProperty.call(o,u)&&(f.checked=!!o[u]):f.type==="select-one"&&typeof o[u]=="string"&&(f.value=o[u]))}),i(l,c)}function s(l){l.dataset.changeListenerAttached!=="true"&&(l.addEventListener("change",function(c){let o=c.target;if(o.matches(".aipkit-aiform-config-input")){let t=o.dataset.formId;i(t,l)}else o.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(o),o.value="")}),l.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=s,window.aipkitForms_applyStoredShortcodeConfig=a})();(function(){"use strict";function k(n){let e=window.aipkitAIFormsState,i=n.querySelector("#aipkit_ai_form_element_settings_panel");if(!i){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(i.dataset.inputListenerAttached==="true")return;let a=()=>{e.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(e.selectedDesignerElementId,n)};i.addEventListener("input",s=>{s.target.matches(".aipkit-setting-field")&&a()}),i.addEventListener("change",s=>{s.target.matches('.aipkit-setting-field[type="checkbox"]')&&a()}),i.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=k})();(function(){"use strict";function k(n){let e=window.aipkitAIFormsState;if(!n){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=n.querySelector("#aipkit_ai_form_elements_palette"),a=n.querySelector("#aipkit_ai_form_designer_area");if(!i||!a){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&a.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(l=>{l.dataset.dragStartListenerAttached!=="true"&&(l.addEventListener("dragstart",c=>{c.target.classList.add("aipkit-dragging"),e.draggedElement=null,c.target.dataset.layoutType?(e.draggedLayoutType=c.target.dataset.layoutType,e.draggedElementType=null,c.dataTransfer.setData("text/plain",e.draggedLayoutType),c.dataTransfer.effectAllowed="copy"):(e.draggedElementType=c.target.dataset.elementType,e.draggedLayoutType=null,c.dataTransfer.setData("text/plain",e.draggedElementType),c.dataTransfer.effectAllowed="copy")}),l.addEventListener("dragend",c=>{c.target.classList.remove("aipkit-dragging"),e.draggedElementType=null,e.draggedLayoutType=null}),l.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",a.dataset.dragListenersAttached!=="true"&&(a.addEventListener("dragstart",l=>{let c=l.target.closest(".aipkit_layout_row"),o=l.target.closest(".aipkit_dropped_element");if(c&&l.target.classList.contains("aipkit_layout_row_drag_handle"))e.draggedElement=c,l.dataTransfer.setData("text/row-id",c.id),l.dataTransfer.effectAllowed="move";else if(o&&l.target.classList.contains("aipkit_dropped_element_drag_handle"))e.draggedElement=o,l.dataTransfer.setData("text/element-id",o.id),l.dataTransfer.effectAllowed="move";else return;e.draggedElementType=null,e.draggedLayoutType=null,setTimeout(()=>{e.draggedElement&&e.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),a.addEventListener("dragend",l=>{e.draggedElement&&(e.draggedElement.classList.remove("aipkit-row-dragging-source"),e.draggedElement=null)}),a.addEventListener("dragover",l=>{l.preventDefault(),a.classList.add("aipkit-drag-over"),e.draggedElement?l.dataTransfer.dropEffect="move":l.dataTransfer.dropEffect="copy"}),a.addEventListener("dragleave",l=>{a.contains(l.relatedTarget)||a.classList.remove("aipkit-drag-over")}),a.addEventListener("drop",l=>{l.preventDefault(),l.stopPropagation(),a.classList.remove("aipkit-drag-over");let c=a.querySelector("#aipkit_form_designer_placeholder");if(e.draggedLayoutType){c&&(c.style.display="none");let o=window.aipkitForms_createNewLayoutData(e.draggedLayoutType);e.formStructure.push(o),window.aipkitForms_renderLayoutRow(a,o,null,n),e.draggedLayoutType=null}else if(e.draggedElement&&e.draggedElement.classList.contains("aipkit_layout_row")){let o=l.target.closest(".aipkit_layout_row");if(o&&o!==e.draggedElement){let t=o.getBoundingClientRect(),f=l.clientY>t.top+t.height/2?o.nextSibling:o;a.insertBefore(e.draggedElement,f)}window.aipkitForms_updateFormStructureOrder()}else if(e.draggedElementType){c&&(c.style.display="none");let o=window.aipkitForms_createNewLayoutData("1-col"),t=window.aipkitForms_createNewFormElementData(e.draggedElementType);o.columns[0].elements.push(t),e.formStructure.push(o),window.aipkitForms_renderLayoutRow(a,o,null,n),e.draggedElementType=null}e.draggedElement&&(e.draggedElement.classList.remove("aipkit-row-dragging-source"),e.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(n),typeof window.aipkitForms_notifyEditorMutation=="function"&&window.aipkitForms_notifyEditorMutation(n)}),a.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=k})();(function(){"use strict";function k(n){let e=n.querySelector("#aipkit_ai_forms_settings_form");e&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(e):console.error("AI Forms Init: Could not initialize token management UI for settings popover.")}window.aipkitForms_initializeTokenUI=k})();(function(){"use strict";function k(n){let e=(n||document).querySelector("#aipkit_ai_forms_settings_form");if(!e)return;let i="data-aipkit-aiforms-autosave-attached";if(e.getAttribute(i)==="true")return;let a=()=>{typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};e.addEventListener("change",s=>{let l=s.target;if(!l||!l.matches(".aipkit_autosave_trigger"))return;(l.tagName.toLowerCase()==="select"||l.type==="checkbox"||l.type==="range")&&a()}),e.addEventListener("blur",s=>{let l=s.target;if(!l||!l.matches(".aipkit_autosave_trigger"))return;let c=l.tagName.toLowerCase();(c==="input"||c==="textarea")&&l.type!=="range"&&l.type!=="checkbox"&&a()},!0),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),e.setAttribute(i,"true")}window.aipkitForms_initSettingsAutosave=k})();(function(){"use strict";function k(n){if(!n)return;let e="data-accordion-listener-attached";n.getAttribute(e)!=="true"&&(n.addEventListener("click",function(i){let a=i.target.closest(".aipkit_accordion-header");if(!a||!a.closest(".aipkit_ai_forms_container"))return;i.preventDefault();let s=a.closest(".aipkit_accordion-group"),l=a.dataset.aipkitContextAccordion==="1";if(s&&!a.classList.contains("aipkit_active")){let o=s.querySelector(".aipkit_accordion-header.aipkit_active");if(o){o.classList.remove("aipkit_active");let t=o.nextElementSibling;t&&t.classList.remove("aipkit_active")}}let c=a.nextElementSibling;c&&(a.classList.toggle("aipkit_active"),c.classList.toggle("aipkit_active"),l&&c.classList.contains("aipkit_active")&&typeof window.aipkitForms_refreshOpenaiStores=="function"&&window.aipkitForms_refreshOpenaiStores(c))}),n.setAttribute(e,"true"))}window.aipkitForms_initializeAccordions=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(_){return _},n={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0};function e(_){if(!_)return n;let m=Array.isArray(window.aipkit_dashboard?.models?.openrouter)?window.aipkit_dashboard.models.openrouter:[],g=String(_).trim().toLowerCase(),d=m.find(w=>(w?.id?String(w.id).trim().toLowerCase():"")===g);return!d||typeof d.capabilities!="object"?n:{...n,...d.capabilities}}function i(_,m,g){return _!=="OpenRouter"||!g?!0:!!e(m)[g]}function a(_,m,g,d){if(!_||!m)return;_.classList.toggle("aipkit_popover_option_row--disabled",g),_.setAttribute("aria-disabled",g?"true":"false"),m.disabled=!!g;let w=_.querySelector(".aipkit_popover_option_label");w&&(w.dataset.defaultTooltip||(w.dataset.defaultTooltip=w.getAttribute("data-tooltip")||""),w.setAttribute("data-tooltip",g&&d||w.dataset.defaultTooltip))}function s(_,m=""){let g=document.getElementById("aipkit_ai_form_ai_model"),d=window.aipkit_dashboard?.models||{};if(!g||!d)return;let w=_.toLowerCase(),h=d[w];(typeof h>"u"||h===null)&&(h=w==="openai"?{}:[]),g.innerHTML="",g.disabled=!1;let b=window.aipkit_dashboard?.recommendedModels?.[w]||[],A=Array.isArray(b)?b:[],S=new Set(A.map(T=>T?.id).filter(Boolean));if(!h||Array.isArray(h)&&h.length===0||!Array.isArray(h)&&Object.keys(h).length===0){let T=new Option("No models found. Sync in main settings.","");g.appendChild(T),g.disabled=!0;return}let I=!1;if(Array.isArray(h)){if(A.length>0){let x=document.createElement("optgroup");x.label=k("Recommended","gpt3-ai-content-generator"),A.forEach(E=>{if(E&&E.id){let v=new Option(E.name||E.id,E.id);E.id===m&&(v.selected=!0,I=!0),x.appendChild(v)}}),x.children.length>0&&g.appendChild(x)}let T=A.length>0?document.createElement("optgroup"):null;T&&(T.label=k("All models","gpt3-ai-content-generator")),h.forEach(x=>{if(x&&x.id&&S.has(x.id))return;let E=new Option(x.name,x.id);x.id===m&&(E.selected=!0,I=!0),T?T.appendChild(E):g.appendChild(E)}),T&&T.children.length>0&&g.appendChild(T)}else{if(A.length>0){let T=document.createElement("optgroup");T.label=k("Recommended","gpt3-ai-content-generator"),A.forEach(x=>{if(x&&x.id){let E=new Option(x.name||x.id,x.id);x.id===m&&(E.selected=!0,I=!0),T.appendChild(E)}}),T.children.length>0&&g.appendChild(T)}Object.keys(h).forEach(T=>{let x=document.createElement("optgroup");x.label=T,h[T].forEach(E=>{if(E&&E.id&&S.has(E.id))return;let v=new Option(E.name,E.id);E.id===m&&(v.selected=!0,I=!0),x.appendChild(v)}),x.children.length>0&&g.appendChild(x)})}if(!I&&m){let T=new Option(`${m}`,m,!1,!0);g.insertBefore(T,g.firstChild),T.selected=!0}g.selectedIndex===-1&&g.options.length>0&&(g.options[0].selected=!0),g.options.length||(g.disabled=!0)}function l(_,m){let g=m||document,d=g.querySelector("#aipkit_ai_form_ai_model"),w=d&&d.value||"",h=i(_,w,"web_search_plugin"),b=g.querySelector('input[name="openai_web_search_enabled"]'),A=g.querySelector('input[name="claude_web_search_enabled"]'),S=g.querySelector('input[name="openrouter_web_search_enabled"]'),I=g.querySelector('input[name="google_search_grounding_enabled"]'),T=g.querySelector(".aipkit_ai_form_web_search_row--openai"),x=g.querySelector(".aipkit_ai_form_web_search_row--claude"),E=g.querySelector(".aipkit_ai_form_web_search_row--openrouter"),v=g.querySelector(".aipkit_ai_form_web_search_row--google"),y=g.querySelector(".aipkit_ai_form_openai_web_search_settings"),C=g.querySelector(".aipkit_ai_form_claude_web_search_settings"),M=g.querySelector(".aipkit_ai_form_openrouter_web_search_settings"),B=g.querySelector(".aipkit_ai_form_google_search_grounding_settings"),D=g.querySelector(".aipkit_ai_form_openai_web_search_location_details"),W=g.querySelector(".aipkit_ai_form_claude_web_search_location_details"),U=g.querySelector(".aipkit_ai_form_web_search_empty_state"),J=_==="OpenAI";T&&(T.style.display=J?"block":"none"),!J&&b&&(b.checked=!1);let oe=J&&b&&b.checked;y&&(y.style.display=oe?"block":"none"),!oe&&D?D.style.display="none":oe&&typeof window.aipkitForms_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkitForms_toggleOpenAIWebSearchLocationDetails(g);let O=_==="Claude";x&&(x.style.display=O?"block":"none"),!O&&A&&(A.checked=!1);let L=O&&A&&A.checked;C&&(C.style.display=L?"block":"none"),!L&&W?W.style.display="none":L&&typeof window.aipkitForms_toggleClaudeWebSearchLocationDetails=="function"&&window.aipkitForms_toggleClaudeWebSearchLocationDetails(g);let F=_==="OpenRouter";E&&(E.style.display=F?"block":"none"),!F&&S&&(S.checked=!1);let N=F&&!h;S&&N&&(S.checked=!1),a(E,S,N,k("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"));let R=F&&h&&S&&S.checked;M&&(M.style.display=R?"block":"none");let H=_==="Google";v&&(v.style.display=H?"block":"none"),!H&&I&&(I.checked=!1);let K=H&&I&&I.checked;B&&(B.style.display=K?"block":"none"),K&&typeof window.aipkitForms_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkitForms_toggleGoogleGroundingDynamicThreshold(g),U&&(U.style.display=!J&&!O&&!F&&!H?"block":"none")}function c(_){let m=_.querySelector("#aipkit_ai_form_ai_provider"),g=_.querySelector("#aipkit_ai_form_ai_model"),d=_.querySelector(".aipkit_ai_form_reasoning_effort_field"),w=_.querySelector("#aipkit_ai_form_reasoning_effort");if(!m||!g||!d||!w){d&&(d.style.display="none");return}let h=m.value,A=(g.value||"").toLowerCase();if(!(h==="OpenAI"&&o(A))){d.style.display="none";return}d.style.display="block";let S=r(A),I=new Set(S.allowed),T=w.value||"";T==="minimal"&&(T="low"),Array.from(w.options).forEach(x=>{let E=I.has(x.value);x.hidden=!E,x.disabled=!E}),I.has(T)||(T=S.defaultValue),I.has(T)||(T=S.allowed[0]||""),T&&(w.value=T)}function o(_){if(t(_))return!1;let m=_.startsWith("o1")||_.startsWith("o3")||_.startsWith("o4"),g=_.includes("gpt-5");return m||g}function t(_){return/(?:^|[-_])chat(?:[-_]|$)/.test(_)}function r(_){return u(_)?{allowed:["high"],defaultValue:"high"}:_.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:f(_)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function f(_){let m=_.match(/gpt-5\.(\d+)/);if(m)return Number.parseInt(m[1],10)>=2;let g=_.match(/gpt-(\d+)/);return g?Number.parseInt(g[1],10)>=6:!1}function u(_){return/gpt-5(\.\d+)?-pro/.test(_)}function p(_){let m=_.querySelector("#aipkit_ai_form_ai_provider"),g=_.querySelector("#aipkit_ai_form_ai_model");!m||!g||(m.dataset.modelListenerAttached!=="true"&&(m.addEventListener("change",function(){s(this.value),l(this.value,_),c(_)}),m.dataset.modelListenerAttached="true"),g.dataset.reasoningListenerAttached!=="true"&&(g.addEventListener("change",function(){c(_),l(m.value,_)}),g.dataset.reasoningListenerAttached="true"),s(m.value),l(m.value,_),c(_))}window.aipkitForms_initAiConfig=p,window.aipkitForms_populateAiModels=s,window.aipkitForms_updateWebSearchVisibility=l,window.aipkitForms_toggleReasoningEffort=c})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(L){return L},n={loaded:!1,loading:!1},e=!1,i={saving:!1,queued:null,last:{pinecone_api_key:"",qdrant_url:"",qdrant_api_key:""}},a=()=>{let L=window.wp&&window.wp.i18n?window.wp.i18n:null;return{__:L&&typeof L.__=="function"?L.__:N=>N}},s=()=>{let L=window.aipkit_chat_config;return!L||typeof L!="object"||!Object.prototype.hasOwnProperty.call(L,"openaiVectorStores")?null:Array.isArray(L.openaiVectorStores)?L.openaiVectorStores:[]},l=()=>{let L=s();if(L!==null)return c(L),L;let F=window.aipkit_ai_forms_config||{},N=F.vectorStores?F.vectorStores.openai:[];return Array.isArray(N)?N:[]},c=L=>{window.aipkit_ai_forms_config||(window.aipkit_ai_forms_config={}),window.aipkit_ai_forms_config.vectorStores||(window.aipkit_ai_forms_config.vectorStores={}),window.aipkit_ai_forms_config.vectorStores.openai=L},o=L=>L?L.querySelector('select[name="openai_vector_store_ids[]"]'):null,t=L=>L?Array.from(L.options).some(F=>F.value&&!F.disabled):!1,r=(L,F)=>{let N=L.id||L.vector_store_id||"",H=L.name||L.vector_store_name||""||`Untitled store ${F}`,K=L.file_counts?L.file_counts.total:null,re=" (Files: N/A)";return typeof K=="number"&&(re=` (${K} ${K===1?"File":"Files"})`),{id:N,label:`${H}${re}`}},f=(L,F,N={})=>{if(!L)return;let{__:R}=a(),K=N.preserveSelection===!0?new Set(Array.from(L.selectedOptions||[]).map(Ie=>Ie.value)):new Set;L.innerHTML="";let re=Array.isArray(F)?F:[],ve=1;if(re.forEach(Ie=>{if(!Ie||typeof Ie!="object")return;let{id:Ee,label:Z}=r(Ie,ve);if(!Ee)return;let pe=new Option(k(Z),Ee);K.has(Ee)&&(pe.selected=!0),L.appendChild(pe),ve+=1}),!L.options.length){let Ie=new Option(R("No stores found.","gpt3-ai-content-generator"),"");Ie.disabled=!0,L.appendChild(Ie)}},u=L=>{let F=document.getElementById("aipkit_ai_forms_container");if(!F)return;Array.from(F.querySelectorAll('select[name="openai_vector_store_ids[]"]')).forEach(R=>{f(R,L,{preserveSelection:!0});let H=R.closest('[data-aipkit-settings-panel="context"]')||R.closest(".aipkit_vector_store_openai_field")||F;_(H)})},p=()=>{e||(window.addEventListener("aipkit:vector-store-list-updated",L=>{if(String(L?.detail?.provider||"").toLowerCase()!=="openai")return;let N=Array.isArray(L?.detail?.stores)?L.detail.stores:[];c(N),n.loaded=!0,n.loading=!1,u(N)}),e=!0)},_=L=>{L&&typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(L)},m=async(L,F={})=>{let N=o(L);if(!N)return;let{__:R}=a(),H=F.force===!0,K=l();if(K.length&&(!H||!n.loaded)){f(N,K,{preserveSelection:!0}),_(L),n.loaded=!0;return}if(!H&&n.loaded&&t(N)||n.loading)return;let re=document.getElementById("aipkit_vector_store_nonce_openai"),ve=re?re.value:"";if(!ve||typeof window.aipkit_apiRequest!="function")return;n.loading=!0,N.innerHTML="";let Ie=new Option(R("Loading vector stores...","gpt3-ai-content-generator"),"");Ie.disabled=!0,N.appendChild(Ie);try{let Ee=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:ve,limit:100,order:"desc"}),Z=Array.isArray(Ee.stores)?Ee.stores:[];c(Z),f(N,Z,{preserveSelection:!0}),_(L),n.loaded=!0}catch(Ee){let Z=Ee&&Ee.message?Ee.message:R("Unable to load stores.","gpt3-ai-content-generator");N.innerHTML="";let pe=new Option(Z,"");pe.disabled=!0,N.appendChild(pe)}finally{n.loading=!1}},g=L=>{L&&m(L,{force:!0})},d=L=>{if(!L)return null;let F=L.closest(".aipkit_model_settings_popover");return F?F.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline"):null},w=(L,F,N)=>{let R=d(L);R&&(R.textContent=F||"",R.classList.remove("success","error","loading"),N&&R.classList.add(N),R.style.display=F?"inline-block":"none")},h=(L,F=2500)=>{window.setTimeout(()=>{w(L,"","")},F)},b=L=>L?{pineconeKeyInput:L.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:L.querySelector('[name="qdrant_url"]'),qdrantKeyInput:L.querySelector('[name="qdrant_api_key"]')}:{},A=L=>{let F=L?.closest("#aipkit_ai_forms_container"),N=F?F.dataset:{},{pineconeKeyInput:R,qdrantUrlInput:H,qdrantKeyInput:K}=b(L),re=R?.value.trim(),ve=H?.value.trim(),Ie=K?.value.trim(),Ee=!!(re||N?.pineconeApiKeySet==="true"),Z=!!(ve||N?.qdrantUrlSet==="true")&&!!(Ie||N?.qdrantApiKeySet==="true");return{pinecone:Ee,qdrant:Z}},S=(L,F)=>L?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(L,{silent:!0,showErrors:!1,targetSelectId:F,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,L,{silent:!0,showErrors:!1,targetSelectId:F,propagateError:!0}):null:null,I=(L,F,N)=>{if(!F)return;w(L,"Syncing...","loading");let R=S(F,N);if(R&&typeof R.then=="function"){R.then(()=>{w(L,"Synced","success"),h(L)}).catch(H=>{w(L,`Error: ${H?.message||"Sync failed."}`,"error")});return}h(L)},T=(L,F)=>{if(!L||!F)return;if(F==="openai"){m(L);return}let N=A(L);F==="pinecone"&&N.pinecone?I(L,"PineconeIndexes","aipkit_ai_form_pinecone_index_name"):F==="qdrant"&&N.qdrant&&I(L,"QdrantCollections","aipkit_ai_form_qdrant_collection_name")},x=(L,F)=>{!F||!Object.keys(F).length||typeof window.aipkit_apiRequest=="function"&&(i.saving=!0,w(L,"Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",F).then(N=>{Object.keys(F).forEach(H=>{i.last[H]=F[H]});let R=L.closest("#aipkit_ai_forms_container");R&&(Object.prototype.hasOwnProperty.call(F,"pinecone_api_key")&&(R.dataset.pineconeApiKeySet=F.pinecone_api_key?"true":"false"),Object.prototype.hasOwnProperty.call(F,"qdrant_url")&&(R.dataset.qdrantUrlSet=F.qdrant_url?"true":"false"),Object.prototype.hasOwnProperty.call(F,"qdrant_api_key")&&(R.dataset.qdrantApiKeySet=F.qdrant_api_key?"true":"false")),Object.prototype.hasOwnProperty.call(F,"pinecone_api_key")&&T(L,"pinecone"),(Object.prototype.hasOwnProperty.call(F,"qdrant_url")||Object.prototype.hasOwnProperty.call(F,"qdrant_api_key"))&&T(L,"qdrant"),w(L,N.message||"Saved","success"),h(L)}).catch(N=>{w(L,`Error: ${N?.message||"Failed to save."}`,"error")}).finally(()=>{if(i.saving=!1,i.queued){let N=i.queued;i.queued=null,x(L,N)}}))},E=(L,F)=>{if(!F)return;let N=Object.keys(F).reduce((R,H)=>(F[H]!==i.last[H]&&(R[H]=F[H]),R),{});if(Object.keys(N).length){if(i.saving){i.queued={...i.queued||{},...N};return}x(L,N)}},v=L=>{if(!L)return;let F=L.querySelector(".aipkit_vector_store_enable_select"),N=L.querySelector(".aipkit_vector_store_settings_conditional_row"),R=L.querySelector(".aipkit_vector_store_provider_select"),H=L.querySelector(".aipkit_vector_store_openai_field"),K=L.querySelector(".aipkit_vector_store_pinecone_field"),re=L.querySelector(".aipkit_vector_store_pinecone_key_field"),ve=L.querySelector(".aipkit_vector_store_qdrant_field"),Ie=L.querySelector(".aipkit_vector_store_qdrant_url_field"),Ee=L.querySelector(".aipkit_vector_store_qdrant_key_field"),Z=L.querySelector(".aipkit_vector_store_embedding_config_row");if(!F||!N||!R)return;let pe=F.tagName==="SELECT"?F.value==="1":F.checked;if(N.style.display=pe?"block":"none",!pe){[H,K,re,ve,Ie,Ee,Z].forEach(de=>{de&&(de.style.display="none")});return}let we=R.value||"openai";H&&(H.style.display=we==="openai"?"block":"none"),K&&(K.style.display=we==="pinecone"?"block":"none"),re&&(re.style.display=we==="pinecone"?"block":"none"),ve&&(ve.style.display=we==="qdrant"?"block":"none"),Ie&&(Ie.style.display=we==="qdrant"?"block":"none"),Ee&&(Ee.style.display=we==="qdrant"?"block":"none"),Z&&(Z.style.display=we==="pinecone"||we==="qdrant"?"block":"none"),we==="openai"&&(m(L),_(L))},y=L=>{let F=(L||"").split("::"),N=F.shift()||"",R=F.join("::")||"";return{provider:N,model:R}},C=(L,F)=>!L||!F?"":`${L}::${F}`,M=(L,F,N)=>{if(!L||!F||!N)return;let R=C(F,N);if(!R)return;let H=typeof CSS<"u"&&CSS.escape?CSS.escape(R):R.replace(/"/g,'\\"');if(L.querySelector(`option[value="${H}"]`))return;let K=document.createElement("option");K.value=R,K.dataset.provider=F,K.textContent=`${N}`,L.appendChild(K)},B=(L,F)=>{if(!L)return;let N=F||L.querySelector(".aipkit_vector_embedding_select");if(!N)return;let R=L.querySelector('select[name="vector_embedding_provider"]'),H=L.querySelector('select[name="vector_embedding_model"]'),K=R?R.value:"",re=H?H.value:"",ve=C(K,re);if(ve){M(N,K,re),N.value=ve;return}N.value=""},D=(L,F)=>{if(!F||!L)return;let N=F.querySelector('select[name="vector_embedding_provider"]'),R=F.querySelector('select[name="vector_embedding_model"]'),{provider:H,model:K}=y(L.value);N&&(N.value=H),N&&R&&typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(F),R&&(R.value=K)};function W(L){let F=L.querySelector(".aipkit_vector_embedding_provider_select"),N=L.querySelector(".aipkit_vector_embedding_model_select"),H=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!F||!N||!H)return;let re=F.value.toLowerCase(),ve=H[re]||[];N.innerHTML="",N.appendChild(new Option(`-- Select ${F.options[F.selectedIndex]?.text||""} Model --`,"")),ve&&Array.isArray(ve)&&ve.length>0?(ve.forEach(Ie=>{N.appendChild(new Option(k(Ie.name),Ie.id))}),N.disabled=!1):(N.appendChild(new Option("(No models found - Sync in Settings)","")),N.disabled=!0)}function U(L){let F=L||document,N=F.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),R=F.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!N||!R)return;let H=N.value==="approximate";R.style.display=H?"block":"none"}function J(L){let F=L||document,N=F.querySelector(".aipkit_ai_form_claude_web_search_loc_type_select"),R=F.querySelector(".aipkit_ai_form_claude_web_search_location_details");if(!N||!R)return;let H=N.value==="approximate";R.style.display=H?"block":"none"}function oe(L){let F=L||document,N=F.querySelector(".aipkit_ai_form_google_grounding_mode_select"),R=F.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!N||!R)return;let H=N.value==="MODE_DYNAMIC";R.style.display=H?"block":"none"}function O(L){let F=L.querySelector("#aipkit_form_editor_container");if(!F)return;let N=F.querySelector("#aipkit_ai_form_settings_popover");if(!N)return;let R=N.querySelector('[data-aipkit-settings-panel="context"]'),H=N.querySelector('[data-aipkit-settings-panel="tools"]');if(!R)return;let K=F.querySelector("#aipkit_ai_form_ai_provider");p();let re=b(R);i.last={pinecone_api_key:re.pineconeKeyInput?.value||"",qdrant_url:re.qdrantUrlInput?.value||"",qdrant_api_key:re.qdrantKeyInput?.value||""};let ve="data-vector-config-listener-attached";if(R.getAttribute(ve)!=="true"&&(R.addEventListener("change",Ie=>{let Ee=Ie.target;if(Ee){if(Ee.matches('[name="pinecone_api_key"]')||Ee.matches('[name="qdrant_url"]')||Ee.matches('[name="qdrant_api_key"]')){E(R,{[Ee.name]:Ee.value||""});return}if(Ee.matches(".aipkit_vector_store_enable_select")||Ee.matches(".aipkit_vector_store_provider_select")){v(R);let Z=R.querySelector(".aipkit_vector_store_provider_select"),pe=Z?Z.value:"";T(R,pe);return}if(Ee.matches(".aipkit_vector_embedding_select")){D(Ee,R);return}if(Ee.matches(".aipkit_vector_embedding_provider_select")||Ee.matches(".aipkit_vector_embedding_model_select")){typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(R),B(R);return}Ee.matches('select[name="openai_vector_store_ids[]"]')&&_(R)}}),R.addEventListener("input",Ie=>{let Ee=Ie.target;if(Ee){if(Ee.matches("#aipkit_ai_form_vector_store_top_k")){let Z=R.querySelector("#aipkit_ai_form_vector_store_top_k_value");Z&&(Z.textContent=Ee.value)}else if(Ee.matches("#aipkit_ai_form_vector_store_confidence_threshold")){let Z=R.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");Z&&(Z.textContent=Ee.value+"%")}}}),R.setAttribute(ve,"true")),H){let Ie="data-tools-config-listener-attached";H.getAttribute(Ie)!=="true"&&(H.addEventListener("change",Ee=>{let Z=Ee.target;if(Z.matches(".aipkit_ai_form_openai_web_search_toggle")||Z.matches(".aipkit_ai_form_claude_web_search_toggle")||Z.matches(".aipkit_ai_form_openrouter_web_search_toggle")||Z.matches(".aipkit_ai_form_google_search_grounding_toggle")){if(typeof window.aipkitForms_updateWebSearchVisibility=="function"){let pe=K?K.value:"";window.aipkitForms_updateWebSearchVisibility(pe,F)}}else Z.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?U(H):Z.matches(".aipkit_ai_form_claude_web_search_loc_type_select")?J(H):Z.matches(".aipkit_ai_form_google_grounding_mode_select")&&oe(H)}),H.addEventListener("input",Ee=>{let Z=Ee.target;if(Z.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let pe=H.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");pe&&(pe.textContent=parseFloat(Z.value).toFixed(2))}}),H.setAttribute(Ie,"true"))}typeof window.aipkitForms_updateWebSearchVisibility=="function"&&K&&window.aipkitForms_updateWebSearchVisibility(K.value,F),v(R),W(R),B(R),_(R)}window.aipkitForms_initVectorConfig=O,window.aipkitForms_populateVectorEmbeddingModels=W,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=U,window.aipkitForms_toggleClaudeWebSearchLocationDetails=J,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=oe,window.aipkitForms_refreshOpenaiStores=g,window.aipkitForms_syncEmbeddingSelectFromInputs=B})();(function(){"use strict";function k(e,i,a,s){let l=window.aipkitAIFormsState,c=document.createElement("div");c.className="aipkit_layout_row",c.id=i.internalId;let o=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,t=document.createElement("div");t.className="aipkit_layout_row_columns_container",i.columns.forEach(r=>{let f=document.createElement("div");f.className="aipkit_layout_column",f.id=r.internalId,f.style.flexBasis=r.width,n(f,s),r.elements.forEach(u=>{window.aipkitForms_renderFieldInColumn(f,u)}),t.appendChild(f)}),c.innerHTML=o,c.appendChild(t),a?e.insertBefore(c,a):e.appendChild(c)}function n(e,i){let a=window.aipkitAIFormsState;e.addEventListener("dragover",s=>{s.preventDefault(),s.stopPropagation(),e.classList.add("aipkit-drag-over"),(a.draggedElement||a.draggedElementType)&&(s.dataTransfer.dropEffect=a.draggedElement?"move":"copy")}),e.addEventListener("dragleave",s=>{s.preventDefault(),s.stopPropagation(),e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",s=>{if(s.preventDefault(),e.classList.remove("aipkit-drag-over"),a.draggedElementType||a.draggedElement&&a.draggedElement.classList.contains("aipkit_dropped_element")){s.stopPropagation();let l=e.id;if(a.draggedElementType){let c=window.aipkitForms_createNewFormElementData(a.draggedElementType);a.formStructure.forEach(o=>{let t=o.columns.find(r=>r.internalId===l);t&&t.elements.push(c)}),window.aipkitForms_renderFieldInColumn(e,c,null,i)}else a.draggedElement&&(e.appendChild(a.draggedElement),window.aipkitForms_updateFormStructureOrder());a.draggedElementType=null,a.draggedElement&&(a.draggedElement.classList.remove("aipkit-row-dragging-source"),a.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector("#aipkit_ai_form_settings_popover");if(!e)return;let i=Array.from(e.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||e.dataset.panelsBound==="true")return;let a=e.querySelector(".aipkit_model_settings_popover_title"),s=e.querySelector(".aipkit_model_settings_popover_back"),l=n.querySelector("#aipkit_ai_form_settings_trigger"),c={root:e.dataset.titleRoot||"Settings",parameters:e.dataset.titleParameters||"Parameters",context:e.dataset.titleContext||"Context",tools:e.dataset.titleTools||"Tools"},o=null,t=r=>{let f=r||"root",u=e.querySelector(`[data-aipkit-settings-panel="${f}"]`)||e.querySelector('[data-aipkit-settings-panel="root"]');if(!u)return;let p=u.dataset.aipkitSettingsPanel||"root";p!==o&&(i.forEach(_=>{_.hidden=_!==u}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),o=p,e.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};e.addEventListener("click",r=>{let f=r.target.closest("[data-aipkit-panel-target]");if(!f)return;r.preventDefault();let u=f.dataset.aipkitPanelTarget;t(u)}),s&&s.addEventListener("click",r=>{r.preventDefault(),t("root")}),l&&l.addEventListener("click",()=>{t("root")}),t("root"),e.dataset.panelsBound="true"}window.aipkitForms_initEditorSettingsPopover=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector("#aipkit_form_editor_container");if(!e)return;let i=e.querySelector("#aipkit_ai_form_prompt_template"),a=e.querySelector(".aipkit_ai_form_prompt_expand"),s=document.getElementById("aipkit_ai_form_prompt_modal");if(!i||!a||!s)return;let l=s.querySelector(".aipkit_ai_form_prompt_modal_textarea"),c=s.querySelector(".aipkit_ai_form_prompt_count"),o=s.querySelector(".aipkit_ai_form_prompt_modal_close");if(s.dataset.bound==="1")return;let t=p=>{c&&(c.textContent=`${p.length.toLocaleString()} characters`)},r=p=>{l&&(l.value=p,t(p))},f=()=>{l&&(r(i.value||""),s.classList.add("aipkit-active"),s.setAttribute("aria-hidden","false"),setTimeout(()=>l.focus(),0))},u=p=>{if(s.classList.remove("aipkit-active"),s.setAttribute("aria-hidden","true"),!p||!l)return;let _=l.value;_!==i.value&&(i.value=_,i.dispatchEvent(new Event("input",{bubbles:!0})))};a.addEventListener("click",p=>{p.preventDefault(),f()}),o&&o.addEventListener("click",()=>{u(!0)}),document.addEventListener("keydown",p=>{p.key==="Escape"&&s.classList.contains("aipkit-active")&&u(!0)}),l&&l.dataset.bound!=="1"&&(l.addEventListener("input",()=>{t(l.value)}),l.dataset.bound="1"),s.dataset.bound="1"}window.aipkitForms_initPromptModal=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.querySelector("#aipkit_ai_forms_settings_popover");if(!e)return;let i=Array.from(e.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||e.dataset.panelsBound==="true")return;let a=e.querySelector(".aipkit_model_settings_popover_title"),s=e.querySelector(".aipkit_model_settings_popover_back"),l=e.querySelector(".aipkit_model_settings_popover_footer"),c=n.querySelector("#aipkit_ai_forms_settings_trigger"),o={root:e.dataset.titleRoot||"Settings",limits:e.dataset.titleLimits||"Limits","custom-css":e.dataset.titleCustomCss||"Custom CSS","provider-filtering":e.dataset.titleProviderFiltering||"Provider Filtering"},t=null,r=f=>{let u=f||"root",p=e.querySelector(`[data-aipkit-settings-panel="${u}"]`)||e.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let _=p.dataset.aipkitSettingsPanel||"root";_!==t&&(i.forEach(m=>{m.hidden=m!==p}),a&&(a.textContent=o[_]||o.root),s&&(s.hidden=_==="root"),l&&(l.hidden=_==="root"),_==="limits"&&typeof window.aipkitForms_initializeTokenUI=="function"&&window.aipkitForms_initializeTokenUI(n),t=_,e.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};e.addEventListener("click",f=>{let u=f.target.closest("[data-aipkit-panel-target]");if(!u)return;f.preventDefault();let p=u.dataset.aipkitPanelTarget;r(p)}),s&&s.addEventListener("click",f=>{f.preventDefault(),r("root")}),c&&c.addEventListener("click",()=>{r("root")}),r("root"),e.dataset.panelsBound="true"}window.aipkitForms_initSettingsPopoverPanels=k})();(function(){"use strict";let k=[{key:"openai",label:"OpenAI"},{key:"google",label:"Google"},{key:"claude",label:"Claude"},{key:"openrouter",label:"OpenRouter"},{key:"azure",label:"Azure",keepWhenEmpty:!0,emptyMessage:"No Azure deployments found. Sync Azure models in main settings first."},{key:"ollama",label:"Ollama",requiresPro:!0},{key:"deepseek",label:"DeepSeek"}],n=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c,e=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(c,o)=>c.replace("%d",o),i=c=>{if(!c)return null;if(typeof c=="string")return{id:c,name:c};if(typeof c=="object"){let o=c.id||c.name||"";return o?{id:o,name:c.name||c.id||o}:null}return null},a=c=>{if(!c)return null;if(Array.isArray(c))return c.map(i).filter(Boolean);if(typeof c=="object"){let o={};return Object.keys(c).forEach(t=>{let f=(Array.isArray(c[t])?c[t]:[]).map(i).filter(Boolean);f.length&&(o[t]=f)}),o}return null},s=c=>c?Array.isArray(c)?c.length>0:Object.keys(c).length>0:!1;function l(c){let o=c||document,t=o.querySelector("#aipkit_ai_forms_models_selector");if(!t||t.dataset.enhanced==="true")return;let r=o.querySelector("#aipkit_aiforms_frontend_models"),f=o.querySelector("#aipkit_aiforms_frontend_providers");if(!r||!f)return;let u=n(),p=e(),m=(t.dataset.initialValue||r.value||"").split(",").map(x=>x.trim()).filter(Boolean),g=new Set(m),d=window.aipkit_dashboard||{},w=d.models||{},h=!!d.isProPlan,b=k.filter(x=>!x.requiresPro||h).map(x=>({...x,models:a(w[x.key])})).filter(x=>x.keepWhenEmpty||s(x.models));t.innerHTML="",t.classList.add("aipkit_models_selector--ready");let A=document.createElement("input");A.type="search",A.placeholder=u("Filter models...","gpt3-ai-content-generator"),A.className="aipkit_models_selector-search",t.appendChild(A);let S=document.createElement("div");S.className="aipkit_models_selector-summary",t.appendChild(S);let I=document.createElement("div");I.className="aipkit_models_selector-providers",t.appendChild(I);let T=x=>{let E=Array.from(t.querySelectorAll('.aipkit_models_selector-item input[type="checkbox"]:checked')),v=E.map(M=>M.value.trim()).filter(Boolean),y=new Set;E.forEach(M=>{M.dataset.providerName&&y.add(M.dataset.providerName)});let C=v.length?b.map(M=>M.label).filter(M=>y.has(M)).join(", "):"";r.value=v.join(", "),f.value=C,v.length===0?S.textContent=u("Showing all models (none selected)","gpt3-ai-content-generator"):v.length===1?S.textContent=u("1 model selected","gpt3-ai-content-generator"):S.textContent=p(u("%d models selected","gpt3-ai-content-generator"),v.length),x&&typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};b.forEach(x=>{let E=document.createElement("div");E.className="aipkit_models_selector-provider",E.dataset.provider=x.key;let v=document.createElement("div");v.className="aipkit_models_selector-provider-header",v.innerHTML=`<strong>${x.label}</strong>`;let y=document.createElement("div");y.className="aipkit_models_selector-provider-actions";let C=document.createElement("button");C.type="button",C.className="aipkit_btn aipkit_btn-xs",C.textContent=u("All","gpt3-ai-content-generator");let M=document.createElement("button");M.type="button",M.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",M.textContent=u("None","gpt3-ai-content-generator"),y.appendChild(C),y.appendChild(M),v.appendChild(y),E.appendChild(v);let B=document.createElement("div");B.className="aipkit_models_selector-models";let D=W=>{if(!W||!W.id)return;let U=document.createElement("label");U.className="aipkit_models_selector-item",U.title=W.id;let J=document.createElement("input");J.type="checkbox",J.value=W.id,J.checked=g.has(W.id),J.dataset.providerName=x.label,J.addEventListener("change",()=>T(!0));let oe=document.createElement("span");oe.textContent=W.name||W.id,U.appendChild(J),U.appendChild(oe),B.appendChild(U)};if(Array.isArray(x.models)?x.models.forEach(W=>D(W)):x.models&&typeof x.models=="object"&&Object.keys(x.models).forEach(W=>{let U=x.models[W]||[];if(!U.length)return;let J=document.createElement("div");J.className="aipkit_models_selector-subgroup",J.textContent=W.charAt(0).toUpperCase()+W.slice(1),B.appendChild(J),U.forEach(oe=>D(oe))}),!s(x.models)){let W=document.createElement("div");W.className="aipkit_models_selector-empty",W.textContent=u(x.emptyMessage||"No models found.","gpt3-ai-content-generator"),B.appendChild(W)}C.addEventListener("click",()=>{B.querySelectorAll('input[type="checkbox"]').forEach(W=>{W.checked=!0}),T(!0)}),M.addEventListener("click",()=>{B.querySelectorAll('input[type="checkbox"]').forEach(W=>{W.checked=!1}),T(!0)}),E.appendChild(B),I.appendChild(E)}),A.addEventListener("input",()=>{let x=A.value.toLowerCase();I.querySelectorAll(".aipkit_models_selector-provider").forEach(E=>{let v=!1;E.querySelectorAll(".aipkit_models_selector-item").forEach(y=>{let M=y.textContent.toLowerCase().includes(x);y.style.display=M?"":"none",M&&(v=!0)}),E.style.display=v||x===""?"":"none"})}),T(!1),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),t.dataset.enhanced="true"}window.aipkitForms_initAllowedModelsSelector=l})();(function(){"use strict";let k=window.wp?.i18n?.__||function(I){return I},n="#aipkit_ai_forms_container #aipkit_ai_form_ai_provider, #aipkit_ai_forms_container #aipkit_ai_form_ai_model, #aipkit_ai_forms_container #aipkit_ai_form_vector_store_provider",e=null,i=null,a=!1,s=I=>!!(I&&(I.id==="aipkit_ai_form_ai_provider"||I.id==="aipkit_ai_form_vector_store_provider")),l=I=>!!(I&&s(I)),c=(I,T)=>{if(!I)return!1;let x=o(T);return x?["openai","openrouter","google","azure","claude","deepseek","ollama","pinecone","qdrant"].includes(x):!1},o=I=>String(I||"").trim().toLowerCase(),t=(I,T,x)=>{if(!I)return;let E="aipkit_settings_select_picker_icon--";I.classList.forEach(C=>{C.startsWith(E)&&I.classList.remove(C)});let v=o(x),y=c(T,v);I.hidden=!y,y&&I.classList.add(`${E}${v}`)},r=I=>{if(!I)return"";let T=I.getAttribute("data-aipkit-picker-title");if(T)return T;let x=I.id&&document.querySelector(`label[for="${I.id}"]`)||I.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return x?x.textContent.trim():""},f=I=>{if(!I)return"";let T=I.selectedOptions&&I.selectedOptions.length?I.selectedOptions[0]:I.querySelector("option[selected]");if(T)return T.textContent.trim();let x=I.querySelector("option");return x?x.textContent.trim():""},u=I=>({buttonId:`${I}_picker_btn`,labelId:`${I}_picker_label`,popoverId:`${I}_picker_popover`,titleId:`${I}_picker_title`,searchId:`${I}_picker_search`,listId:`${I}_picker_list`}),p=(I,T)=>{if(!I||!I.id||!T)return null;let x=u(I.id),E=document.getElementById(x.buttonId);if(!E){if(E=document.createElement("button"),E.type="button",E.id=x.buttonId,E.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",E.setAttribute("data-aipkit-popover-target",x.popoverId),E.setAttribute("aria-controls",x.popoverId),E.setAttribute("aria-expanded","false"),E.dataset.aipkitPopoverPlacement="bottom",s(I)){E.classList.add("aipkit_settings_select_picker_btn--provider");let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),t(M,I,I.value),E.appendChild(M)}let y=document.createElement("span");y.className="aipkit_settings_select_picker_label",y.id=x.labelId,y.textContent=f(I)||k("Select","gpt3-ai-content-generator");let C=document.createElement("span");C.className="dashicons dashicons-arrow-down-alt2",C.setAttribute("aria-hidden","true"),E.appendChild(y),E.appendChild(C),I.insertAdjacentElement("beforebegin",E)}I.classList.contains("screen-reader-text")||I.classList.add("screen-reader-text");let v=document.getElementById(x.popoverId);if(!v){v=document.createElement("div"),v.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",v.id=x.popoverId,v.setAttribute("aria-hidden","true"),s(I)&&v.classList.add("aipkit_settings_select_picker_popover--provider");let y=document.createElement("div");y.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",y.setAttribute("role","dialog"),y.setAttribute("aria-labelledby",x.titleId);let C=document.createElement("div");C.className="aipkit_model_settings_popover_header";let M=document.createElement("span");M.className="aipkit_model_settings_popover_title",M.id=x.titleId,M.textContent=r(I)||k("Select","gpt3-ai-content-generator");let B=document.createElement("button");B.type="button",B.className="aipkit_model_settings_popover_close",B.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),B.innerHTML='<span class="dashicons dashicons-no-alt"></span>',C.appendChild(M),C.appendChild(B);let D=document.createElement("div");D.className="aipkit_model_settings_popover_body";let W=document.createElement("div");W.className="aipkit_settings_select_picker_search";let U=document.createElement("input");U.type="search",U.id=x.searchId,U.className="aipkit_form-input";let J=r(I),oe=J?`Search ${J.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");U.setAttribute("placeholder",oe),W.appendChild(U);let O=document.createElement("div");O.className="aipkit_settings_select_picker_list",O.id=x.listId,O.setAttribute("role","listbox"),D.appendChild(W),D.appendChild(O),y.appendChild(C),y.appendChild(D),v.appendChild(y),T.appendChild(v),l(I)&&(W.style.display="none")}return{ids:x,button:E,popover:v,label:document.getElementById(x.labelId),search:document.getElementById(x.searchId),list:document.getElementById(x.listId)}},_=I=>{let T=[];return I&&Array.from(I.children).forEach(E=>{if(E.tagName==="OPTGROUP"){let v=Array.from(E.children).filter(y=>y.tagName==="OPTION").map(y=>({value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}));T.push({label:E.label,options:v})}else E.tagName==="OPTION"&&T.push({label:"",options:[{value:E.value,label:E.textContent.trim(),disabled:E.disabled,selected:E.selected}]})}),T},m=(I,T,x="")=>{if(!I||!T)return;T.innerHTML="";let E=_(I),v=x.trim().toLowerCase(),y=!1;if(E.forEach(C=>{let M=C.options.filter(B=>v?B.label.toLowerCase().includes(v):!0);if(M.length){if(C.label){let B=document.createElement("div");B.className="aipkit_settings_select_picker_group_label",B.textContent=C.label,T.appendChild(B)}M.forEach(B=>{let D=document.createElement("button");if(D.type="button",D.className="aipkit_settings_select_picker_item",B.disabled&&D.classList.add("is-disabled"),B.selected&&D.classList.add("is-active"),D.dataset.value=B.value,s(I)&&c(I,B.value)){let J=document.createElement("span");J.className="aipkit_settings_select_picker_icon",J.setAttribute("aria-hidden","true"),t(J,I,B.value),D.appendChild(J)}let W=document.createElement("span");W.className="aipkit_settings_select_picker_text",W.textContent=B.label||B.value;let U=document.createElement("span");U.className="dashicons dashicons-yes aipkit_settings_select_picker_check",U.setAttribute("aria-hidden","true"),D.appendChild(W),D.appendChild(U),T.appendChild(D),y=!0})}}),!y){let C=document.createElement("div");C.className="aipkit_settings_select_picker_empty",C.textContent=k(v?"No matches found.":"No options available.","gpt3-ai-content-generator"),T.appendChild(C)}},g=(I,T)=>{if(!I||!T)return;let x=f(I);if(T.textContent=x||k("Select","gpt3-ai-content-generator"),s(I)){let E=T.closest("button"),v=E?E.querySelector(".aipkit_settings_select_picker_icon"):null;t(v,I,I.value)}},d=(I,T)=>{if(!I||!T)return;let x=I.getBoundingClientRect(),E=T.getBoundingClientRect(),v=E.width||320,y=E.height||0,C=window.innerWidth,M=window.innerHeight,B=12;if(I.dataset.aipkitPopoverPlacement==="bottom"){let U=x.left;U+v>C-B&&(U=x.right-v),U=Math.max(B,Math.min(U,C-v-B));let J=x.bottom+8;J+y>M-B&&(J=x.top-y-8),J=Math.max(B,Math.min(J,M-y-B)),T.style.left=`${Math.round(U)}px`,T.style.top=`${Math.round(J)}px`;return}let D=x.right+10;D+v>C-B&&(D=x.left-v-10),D=Math.max(B,Math.min(D,C-v-B));let W=x.top;W+y>M-B&&(W=M-y-B),W=Math.max(B,W),T.style.left=`${Math.round(D)}px`,T.style.top=`${Math.round(W)}px`},w=()=>{!e||!i||a||(a=!0,window.requestAnimationFrame(()=>{let I=e.querySelector(".aipkit_model_settings_popover_panel");d(i,I),a=!1}))},h=()=>{e&&(e.classList.remove("aipkit-active"),e.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),e=null,i=null)},b=(I,T,x)=>{if(!I||!T)return;e&&e!==T&&h(),e=T,i=I,T.classList.add("aipkit-active"),T.setAttribute("aria-hidden","false"),I.setAttribute("aria-expanded","true");let E=T.querySelector(".aipkit_settings_select_picker_search input"),v=T.querySelector(".aipkit_settings_select_picker_list");v&&m(x,v,E?E.value:""),E&&E.offsetParent!==null&&(E.focus(),E.select());let y=T.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{d(I,y)})},A=(I,T)=>{if(!I||!T)return;let{button:x,popover:E,list:v,search:y}=T;if(x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("click",C=>{if(C.preventDefault(),e===E){h();return}b(x,E,I)}),x.dataset.pickerListenerAttached="true"),E&&E.dataset.overlayListenerAttached!=="true"){E.addEventListener("click",M=>{M.target===E&&h()});let C=E.querySelector(".aipkit_model_settings_popover_close");C&&C.addEventListener("click",M=>{M.preventDefault(),h()}),E.dataset.overlayListenerAttached="true"}if(v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("click",C=>{let M=C.target.closest(".aipkit_settings_select_picker_item");if(!M||M.classList.contains("is-disabled"))return;let B=M.dataset.value??"";I.value=B,I.dispatchEvent(new Event("change",{bubbles:!0})),g(I,T.label),m(I,v,y?y.value:""),h()}),v.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("input",()=>{m(I,v,y.value)}),y.dataset.pickerListenerAttached="true"),I&&I.dataset.pickerListenerAttached!=="true"&&(I.addEventListener("change",()=>{g(I,T.label),m(I,v,y?y.value:"")}),I.dataset.pickerListenerAttached="true"),I&&I.dataset.pickerObserverAttached!=="true"){let C=!1;new MutationObserver(()=>{C||(C=!0,window.requestAnimationFrame(()=>{g(I,T.label),m(I,v,y?y.value:""),C=!1}))}).observe(I,{childList:!0,subtree:!0}),I.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitAiFormsPickerEscapeBound||(document.addEventListener("keydown",C=>{C.key==="Escape"&&e&&h()}),document.body.dataset.aipkitAiFormsPickerEscapeBound="true"),document.body.dataset.aipkitAiFormsPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitAiFormsPickerRepositionBound="true")};function S(I){let T=I||document.getElementById("aipkit_ai_forms_container");if(!T)return;let x=T.querySelectorAll(n);x.length&&x.forEach(E=>{if(!E.id||E.dataset.aipkitPickerInit==="true")return;let v=p(E,T);v&&(g(E,v.label),m(E,v.list,v.search?v.search.value:""),A(E,v),E.dataset.aipkitPickerInit="true")})}window.aipkitForms_initSelectPickers=S,window.aipkitForms_refreshSelectPickers=function(I){let T=I||document.getElementById("aipkit_ai_forms_container");if(!T)return;let x=T.querySelectorAll(n);x.length&&x.forEach(E=>{if(!E.id)return;let v=p(E,T);v&&(g(E,v.label),m(E,v.list,v.search?v.search.value:""),A(E,v),E.dataset.aipkitPickerInit="true")})}})();(function(){"use strict";let k={css:new Set,js:new Set},n=()=>{let f=typeof wp<"u"&&wp.i18n?wp.i18n:null;return{__:f&&typeof f.__=="function"?f.__:u=>u}},e=window.aipkit_escapeHtml||(f=>f),i=f=>{if(!f||k.css.has(f))return;if(document.querySelector(`link[href="${f}"]`)){k.css.add(f);return}let u=document.createElement("link");u.rel="stylesheet",u.href=f,document.head.appendChild(u),k.css.add(f)},a=f=>!f||k.js.has(f)?Promise.resolve():new Promise((u,p)=>{if(document.querySelector(`script[src="${f}"]`)){k.js.add(f),u();return}let _=document.createElement("script");_.src=f,_.async=!0,_.onload=()=>{k.js.add(f),u()},_.onerror=()=>p(new Error(`Failed to load script: ${f}`)),document.body.appendChild(_)}),s=(f,u,p="info")=>{if(!f)return;let _=p==="error"?"aipkit_ai_forms_preview_message aipkit_ai_forms_preview_message--error":"aipkit_ai_forms_preview_message",m=p==="error"?"":'<span class="aipkit_spinner" aria-hidden="true"></span>';f.innerHTML=`
      <div class="${_}">
        ${m}
        <span>${e(u)}</span>
      </div>
    `},l=(f,u,p={})=>{let{__:_}=n(),m=window.aipkit_ai_forms_config||{},g=p.loadingText||_("Loading preview...","gpt3-ai-content-generator");return u?f?typeof window.aipkit_apiRequest!="function"?(s(u,_("Preview loader is unavailable.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("API request helper missing."))):(s(u,g),window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:f,_ajax_nonce:m.nonce_manage_forms}).then(d=>(d.config&&(window.aipkit_ai_forms_public_config=d.config),d.models&&(window.aipkit_ai_forms_models=d.models),d.assets&&d.assets.css&&Object.values(d.assets.css).forEach(i),u.innerHTML=d.html||"",d.assets&&d.assets.js?Promise.all(Object.values(d.assets.js).map(a)):null)).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(d=>{let w=d&&d.message?d.message:"Unknown error.";throw s(u,`${_("Preview failed:","gpt3-ai-content-generator")} ${w}`,"error"),d})):(s(u,_("Missing form ID for preview.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("Form ID missing."))):Promise.reject(new Error("Preview container not found."))},c=f=>{let u=f||document.getElementById("aipkit_ai_forms_container");if(!u)return null;let p=u.querySelector("#aipkit_ai_forms_preview_sheet");return p?{container:u,overlay:p,panel:p.querySelector(".aipkit_builder_sheet_panel"),closeButton:p.querySelector("#aipkit_ai_forms_preview_sheet_close"),title:p.querySelector("#aipkit_ai_forms_preview_sheet_title"),description:p.querySelector("#aipkit_ai_forms_preview_sheet_description"),previewFrame:p.querySelector("#aipkit_ai_forms_preview_frame")}:null},o=(f,u,p)=>{let{__:_}=n(),m=c(p);if(!m)return;let g=u&&String(u).trim()||_("Untitled","gpt3-ai-content-generator");m.title&&(m.title.textContent=_("Preview","gpt3-ai-content-generator")),m.description&&(m.description.textContent="",m.description.removeAttribute("title"),m.description.setAttribute("hidden","true")),m.overlay.classList.add("aipkit-active"),m.overlay.setAttribute("aria-hidden","false"),m.previewFrame&&l(f,m.previewFrame).catch(()=>{}),m.closeButton&&m.closeButton.focus()},t=f=>{let u=c(f);u&&(u.overlay.classList.remove("aipkit-active"),u.overlay.setAttribute("aria-hidden","true"),u.previewFrame&&(u.previewFrame.innerHTML=""))},r=f=>{let u=c(f);!u||u.overlay.dataset.previewSheetInitialized==="true"||(u.closeButton&&u.closeButton.addEventListener("click",p=>{p.preventDefault(),t(u.container)}),u.overlay.addEventListener("click",p=>{p.target===u.overlay&&t(u.container)}),document.addEventListener("keydown",p=>{p.key==="Escape"&&u.overlay.classList.contains("aipkit-active")&&t(u.container)}),u.overlay.dataset.previewSheetInitialized="true")};window.aipkitForms_loadFormPreview=l,window.aipkitForms_openPreviewSheet=o,window.aipkitForms_closePreviewSheet=t,window.aipkitForms_initPreviewSheet=r})();(function(){"use strict";function k(){let n=window.aipkitForms_validateContainer();if(!n)return;let e=()=>{typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(n):console.error("AI Forms Init: aipkit_initContentWriterPopovers function not found.")};if(n.dataset.aipkitInitialized==="true"){e(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initEditorPersistence=="function"&&window.aipkitForms_initEditorPersistence(n),typeof window.aipkitForms_initSettingsPopoverPanels=="function"&&window.aipkitForms_initSettingsPopoverPanels(n),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(n),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(n),typeof window.aipkitForms_initSettingsAutosave=="function"&&window.aipkitForms_initSettingsAutosave(n),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(n),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(n),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(n),window.aipkitForms_initializeDragAndDrop(n),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(n),window.aipkitForms_initializeTokenUI(n);return}e(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initEditorPersistence=="function"&&window.aipkitForms_initEditorPersistence(n),typeof window.aipkitForms_initSettingsPopoverPanels=="function"?window.aipkitForms_initSettingsPopoverPanels(n):console.error("AI Forms Init: aipkitForms_initSettingsPopoverPanels function not found."),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(n),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(n),typeof window.aipkitForms_initSettingsAutosave=="function"?window.aipkitForms_initSettingsAutosave(n):console.error("AI Forms Init: aipkitForms_initSettingsAutosave function not found."),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(n),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(n),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(n),window.aipkitForms_attachClickEventListeners(n),window.aipkitForms_attachChangeEventListeners(n),window.aipkitForms_attachSettingsPanelListeners(n),window.aipkitForms_initializeAccordions(n),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(n):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(n),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(n),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(n):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(n):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),n.dataset.aipkitInitialized="true"}window.aipkit_initAiForms=k})();(function(){"use strict";let k="",n={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",status:"task_config_status",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",status:"task_config_status",prompts:"task_config_ai",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",status:"task_config_status",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",status:"task_config_status",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function e(){let l=document.getElementById("aipkit_automated_task_form"),c=document.getElementById("aipkit_provider_notice_autogpt");if(!l||!c)return;l.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"][data-aipkit-provider-notice-defer="1"]').forEach(u=>{delete u.dataset.aipkitProviderNoticeArmed});let t=Array.from(l.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"]')),r=u=>u&&(u.offsetParent!==null||u.getClientRects().length>0),f=t.filter(r);if(!f.length){c.classList.add("aipkit_provider_notice--hidden");return}f.forEach(u=>{u.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(u.dataset.aipkitProviderNoticeArmed="true")}),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(l)}function i(l){if(!l)return null;let c="content_writing";return l==="content_indexing"?c="content_indexing":l==="community_reply_comments"?c="community_reply_comments":l==="enhance_existing_content"&&(c="enhance_existing_content"),window.aipkit_wizardConfig[c]||null}function a(l){let c=document.querySelector(".aipkit_wizard_content_container"),o=document.getElementById("aipkit_save_task_btn");if(!c)return;let t=i(l);if(!t){c.querySelectorAll(".aipkit_wizard_content_step").forEach(f=>{f.style.display="none",f.classList.remove("aipkit_active")}),o&&(o.style.display="none"),e();return}let r=new Set(Object.values(t.contentMap));c.querySelectorAll(".aipkit_wizard_content_step").forEach(f=>{let u=f.dataset.contentId||"";r.has(u)?(f.style.display="block",f.classList.add("aipkit_active")):(f.style.display="none",f.classList.remove("aipkit_active"))}),o&&(o.style.display="inline-flex"),e()}function s(l){k=l,a(l)}window.aipkit_renderWizard=s,window.aipkit_initWizardNavigation=()=>{},window.aipkit_resetWizard=()=>{k="",a("")},window.aipkit_wizardConfig=n})();(function(){"use strict";function k(){let e=window.aipkit_chat_config;return!e||typeof e!="object"||!Object.prototype.hasOwnProperty.call(e,"openaiVectorStores")?null:Array.isArray(e.openaiVectorStores)?e.openaiVectorStores:[]}function n(e){let i=window.aipkit_automated_tasks_config||{},a=i.text||{},s=window.aipkit_escapeHtml||function(t){return t},l=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!l)return Promise.resolve();l.innerHTML=`<option value="">${s(a.loading_stores||"Loading...")}</option>`,l.disabled=!0;let c=[],o=a.select_target_store||"-- Select Target Store --";if(e==="openai"){let t=k();t!==null?(c=t,i.openai_vector_stores=t,window.aipkit_automated_tasks_config=i):i.openai_vector_stores&&(c=i.openai_vector_stores)}else e==="pinecone"&&i.pinecone_indexes?(c=i.pinecone_indexes,o=a.select_target_index||"-- Select Target Index --"):e==="qdrant"&&i.qdrant_collections&&(c=i.qdrant_collections,o=a.select_target_collection||"-- Select Target Collection --");return l.innerHTML=`<option value="">${s(o)}</option>`,c&&Array.isArray(c)&&c.length>0?(c.forEach(t=>{let r=t.id||t.name,f=t.name||t.id,u=s(f);e==="openai"&&t.file_counts?.total!==void 0?u+=` (Files: ${t.file_counts.total})`:e==="pinecone"&&t.dimension!==void 0&&(u+=` (Dim: ${t.dimension})`),l.appendChild(new Option(u,r))}),l.disabled=!1):(l.appendChild(new Option(s(a.no_targets_found_configure||`No ${e} targets found. Configure in AI Training.`),"")),l.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=n})();(function(){"use strict";function k(){let n=window.aipkit_automated_tasks_config||{},e=n.text||{},i=window.aipkit_escapeHtml||function(u){return u},a=document.getElementById("aipkit_task_content_indexing_embedding_model"),s=window.aipkit_automated_tasks_form_state||{},l=s.pendingEmbeddingModelSelection;if(!a)return Promise.resolve();a.innerHTML=`<option value="">${i(e.select_embedding_model||"-- Select Model --")}</option>`;let c=n.openai_embedding_models||[],o=n.google_embedding_models||[],t=n.openrouter_embedding_models||[],r=n.azure_embedding_models||[],f=(u,p,_)=>{let m=document.createElement("optgroup");return m.label=i(u),p&&p.length>0&&p.forEach(g=>{let d=`${_}:${g.id}`;m.appendChild(new Option(i(g.name||g.id),d))}),m};if(a.appendChild(f("OpenAI",c,"openai")),a.appendChild(f("Google",o,"google")),a.appendChild(f("OpenRouter",t,"openrouter")),a.appendChild(f("Azure",r,"azure")),a.disabled=c.length===0&&o.length===0&&t.length===0&&r.length===0,a.disabled&&(a.innerHTML=`<option value="">${i(e.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),l&&a.querySelector(`option[value="${CSS.escape(l)}"]`))a.value=l,s.pendingEmbeddingModelSelection=null;else if(a.options.length>1){let u=a.querySelector("optgroup");u&&u.options.length>0&&(a.value=u.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=k})();(function(){"use strict";function k(n){let e=n.target.value,i=document.getElementById("aipkit_task_content_indexing_embedding_model_group"),a=document.getElementById("aipkit_task_content_indexing_embedding_model_divider");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(e):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),i){let s=e==="pinecone"||e==="qdrant";i.style.display=s?"block":"none",a&&(a.style.display=s?"flex":"none"),s&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=k})();(function(){"use strict";let k=!1;function n(){let s=window.aipkit_chat_config;return!s||typeof s!="object"||!Object.prototype.hasOwnProperty.call(s,"openaiVectorStores")?null:Array.isArray(s.openaiVectorStores)?s.openaiVectorStores:[]}function e(s=null){let l=Array.isArray(s)?s:n();l!==null&&((!window.aipkit_automated_tasks_config||typeof window.aipkit_automated_tasks_config!="object")&&(window.aipkit_automated_tasks_config={}),window.aipkit_automated_tasks_config.openai_vector_stores=l)}function i(){let s=document.getElementById("aipkit_autogpt_container");if(!s)return;typeof window.aipkit_autogptSyncOpenaiVectorStoreSelects=="function"&&window.aipkit_autogptSyncOpenaiVectorStoreSelects(s);let l=s.querySelector("#aipkit_task_content_indexing_target_store_provider");l&&l.value==="openai"&&typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing("openai")}function a(){let s=document.getElementById("aipkit_autogpt_container");if(!s)return;e(),k||(window.addEventListener("aipkit:vector-store-list-updated",c=>{if(String(c?.detail?.provider||"").toLowerCase()!=="openai")return;let t=Array.isArray(c?.detail?.stores)?c.detail.stores:[];e(t),i()}),k=!0);let l=s.querySelector("#aipkit_task_content_indexing_target_store_provider");if(l){if(l.dataset.listenerAttached==="true")return;typeof window.aipkit_handleTargetStoreProviderChange=="function"?(l.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:l}),l.dataset.listenerAttached="true"):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found.")}i()}window.aipkit_initContentIndexingTaskFormUI=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},n=window.wp?.i18n?.__||function(i){return i};function e(i,a){let s=i.value,l=s?s.toLowerCase():"",c=window.aipkit_dashboard?.models,o=window.aipkit_automated_tasks_form_state||{};if(!a)return;if(!c){a.innerHTML=`<option value="">${k("Error: Model data object not found")}</option>`,a.disabled=!0;return}let t=c[l];(typeof t>"u"||t===null)&&(console.warn(`AutoGPT Model Populator: No model data for provider '${l}'.`),t=l==="openai"?{}:[]);let r=o.pendingModelSelection||a.value;a.innerHTML="";let f=window.aipkit_dashboard?.recommendedModels?.[l]||[],u=Array.isArray(f)?f:[],p=new Set(u.map(_=>_?.id).filter(Boolean));if(l==="openai"&&typeof t=="object"&&!Array.isArray(t)){if(u.length>0){let _=document.createElement("optgroup");_.label=k(n("Recommended","gpt3-ai-content-generator")),u.forEach(m=>{m&&typeof m=="object"&&m.id&&_.appendChild(new Option(k(m.name||m.id),m.id))}),_.children.length>0&&a.appendChild(_)}Object.keys(t).forEach(_=>{let m=document.createElement("optgroup");m.label=k(_),Array.isArray(t[_])&&t[_].forEach(g=>{if(g&&g.id){if(p.has(g.id))return;m.appendChild(new Option(k(g.name||g.id),g.id))}}),a.appendChild(m)})}else if(Array.isArray(t)){if(u.length>0){let m=document.createElement("optgroup");m.label=k(n("Recommended","gpt3-ai-content-generator")),u.forEach(g=>{g&&typeof g=="object"&&g.id&&m.appendChild(new Option(k(g.name||g.id),g.id))}),m.children.length>0&&a.appendChild(m)}let _=u.length>0?document.createElement("optgroup"):null;_&&(_.label=k(n("All models","gpt3-ai-content-generator"))),t.forEach(m=>{if(m&&m.id){if(p.has(m.id))return;let g=new Option(k(m.name||m.id),m.id);_?_.appendChild(g):a.appendChild(g)}}),_&&_.children.length>0&&a.appendChild(_)}else console.warn(`AutoGPT Model Populator: Unexpected format for provider '${l}'.`),a.appendChild(new Option(k(`No models for ${s} (Format Error)`),""));if(a.options.length===0)a.appendChild(new Option(k(`No models for ${s}`),"")),a.disabled=!0;else{a.disabled=!1;let _=!1;if(r&&a.querySelector(`option[value="${CSS.escape(r)}"]`)&&(a.value=r,_=!0),!_&&a.options.length>0){let m=a.querySelector('option:not([value=""])');m&&(a.value=m.value)}}o&&(o.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort(),a&&a.dispatchEvent(new Event("change",{bubbles:!0}))}window.aipkit_task_cw_populateModels=e})();(function(){"use strict";function k(n){if(!n)return;let e=n.closest(".aipkit_slider_wrapper"),i=null;if(e&&(i=e.querySelector(".aipkit_slider_value")),!i){let a=n.closest(".aipkit_ai_temperature_control");a&&(i=a.querySelector(".aipkit_ai_behavior_value"))}i&&(i.textContent=n.value,n.dataset.listenerAttached||(n.addEventListener("input",()=>i.textContent=n.value),n.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=k})();(function(){"use strict";function k(n){if(!n)return;let e=n.closest(".aipkit_slider_wrapper"),i=e?e.querySelector(".aipkit_slider_value"):null;i&&(i.textContent=n.value,n.dataset.listenerAttached||(n.addEventListener("input",()=>i.textContent=n.value),n.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=k})();(function(){"use strict";function k(n){let e=n.target,i=e.closest(".aipkit_post_settings_redesigned")||e.closest(".aipkit_wizard_content_step")||document,a=i.querySelector("#aipkit_task_cw_schedule_options_wrapper"),s=i.querySelector("#aipkit_task_cw_smart_schedule_fields"),l=i.querySelector(".aipkit_task_schedule_from_input_option"),c=l?l.querySelector(".aipkit_post_schedule_radio_text"):null,o=l?l.querySelector(".aipkit_popover_warning[data-tooltip]"):null;if(!a)return;let t=e.value==="publish";a.style.display=t?"block":"none";let r=document.getElementById("aipkit_automated_task_type"),f=new Set(["content_writing_bulk","content_writing_csv","content_writing_gsheets"]),u=`Accepted formats: YYYY-MM-DD HH:MM[:SS], YYYY/MM/DD HH:MM, MM/DD/YYYY HH:MM, DD/MM/YYYY HH:MM, or ISO 8601.

Times use the site timezone unless an offset/Z is provided.`,p={content_writing_bulk:{label:"Use Dates from List",tooltip:`Use when your list includes a publish date on each line.

`+u},content_writing_csv:{label:"Use Dates from CSV",tooltip:`Use when your CSV includes a publish date column.

`+u},content_writing_gsheets:{label:"Use Dates from Sheets",tooltip:`Use when your Google Sheets includes a publish date column.

`+u}},_={label:"Use Dates from Input",tooltip:`Use when your input includes a publish date.

`+u},m=()=>{if(!r)return;let h=p[r.value]||_;c&&(c.textContent=h.label),o&&o.setAttribute("data-tooltip",h.tooltip)},g=r&&f.has(r.value);if(l&&(m(),l.style.display=g?"inline-flex":"none",!g)){let h=l.querySelector('input[name="schedule_mode"][value="from_input"]');if(h&&h.checked){let b=i.querySelector('input[name="schedule_mode"][value="immediate"]');b&&(b.checked=!0,b.dispatchEvent(new Event("change",{bubbles:!0})))}}r&&!r.dataset.fromInputCopyListener&&(r.addEventListener("change",()=>{m()}),r.dataset.fromInputCopyListener="true"),i.querySelectorAll('input[name="schedule_mode"]').forEach(h=>{h.dataset.listenerAttached||(h.addEventListener("change",function(){let b=r&&f.has(r.value);s&&(s.style.display=this.value==="smart"?"block":"none")}),h.dataset.listenerAttached="true")});let w=i.querySelector('input[name="schedule_mode"]:checked');w&&s&&(s.style.display=w.value==="smart"?"block":"none")}window.aipkit_toggleTaskCwScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||(_=>_);function n(){let _=window.aipkit_chat_config;return!_||typeof _!="object"||!Object.prototype.hasOwnProperty.call(_,"openaiVectorStores")?null:Array.isArray(_.openaiVectorStores)?_.openaiVectorStores:[]}function e(){let _=n();if(_!==null)return(!window.aipkit_automated_tasks_config||typeof window.aipkit_automated_tasks_config!="object")&&(window.aipkit_automated_tasks_config={}),window.aipkit_automated_tasks_config.openai_vector_stores=_,_;let m=window.aipkit_automated_tasks_config?.openai_vector_stores;return Array.isArray(m)?m:[]}function i(_,m){let g=String(_?.name||_?.id||`Untitled store ${m}`),d=_?.file_counts?.total;return typeof d=="number"?`${k(g)} (${d} ${d===1?"File":"Files"})`:`${k(g)} (Files: N/A)`}function a(_,m){if(!_)return;let g=new Set(Array.from(_.options).filter(h=>h.selected&&h.value).map(h=>h.value)),d=Array.isArray(m)?m:[];_.innerHTML="";let w=1;if(d.forEach(h=>{if(!h||typeof h!="object")return;let b=String(h.id||h.vector_store_id||"").trim();if(!b)return;let A=i(h,w),S=new Option(A,b);g.has(b)&&(S.selected=!0),_.appendChild(S),w+=1}),g.forEach(h=>{if(!h)return;if(!Array.from(_.options).some(A=>A.value===h)){let A=new Option(h,h);A.selected=!0,_.appendChild(A)}}),!_.options.length){let h=new Option("No stores found","");h.disabled=!0,_.appendChild(h)}}function s(_,m=null){if(!_)return;let g=Array.isArray(m)?m:e(),d=["#aipkit_task_cw_openai_vector_store_ids","#aipkit_task_ce_openai_vector_store_ids",'select[name="openai_vector_store_ids[]"]','select[name="ce_openai_vector_store_ids[]"]'],w=new Set;d.forEach(h=>{_.querySelectorAll(h).forEach(A=>{w.has(A)||(w.add(A),a(A,g))})}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(_)}function l(_){if(!_)return;let m=_.querySelector(".aipkit_task_cw_vector_store_toggle"),g=_.querySelectorAll(".aipkit_task_cw_vector_store_settings_container");if(!m||!g.length)return;let d=m.checked;g.forEach(w=>{w.style.display=d?"block":"none"}),d&&c(_)}function c(_){if(!_)return;let m=_.querySelector(".aipkit_task_cw_vector_store_provider_select");if(!m)return;let g=m.value,d=_.querySelector(".aipkit_task_cw_vector_openai_field"),w=_.querySelector(".aipkit_task_cw_vector_pinecone_field"),h=_.querySelector(".aipkit_task_cw_vector_qdrant_field"),b=_.querySelector(".aipkit_task_cw_vector_embedding_config_row"),A=(S,I)=>{S&&(S.style.display=I?"block":"none")};if(A(d,g==="openai"),A(w,g==="pinecone"),A(h,g==="qdrant"),b){let S=g==="pinecone"||g==="qdrant";b.style.display=S?"block":"none",S&&o(_)}}function o(_){let m=_.querySelector("#aipkit_task_cw_vector_embedding_model");if(!m)return;let g=_.querySelector("#aipkit_task_cw_vector_embedding_provider"),d=g?g.value:"openai",w=window.aipkit_automated_tasks_config||{},h=window.aipkit_automated_tasks_form_state||{},b=[];if(d==="google"?b=w.google_embedding_models||[]:d==="openrouter"?b=w.openrouter_embedding_models||[]:d==="azure"?b=w.azure_embedding_models||[]:b=w.openai_embedding_models||[],m.innerHTML="",b.length>0){m.add(new Option("-- Select Model --","")),b.forEach(S=>{m.add(new Option(k(S.name||S.id),S.id))}),m.disabled=!1;let A=h.pendingEmbeddingModelSelection;A&&Array.from(m.options).find(I=>I.value===A)&&(m.value=A,h.pendingEmbeddingModelSelection=null)}else m.add(new Option("No models found","")),m.disabled=!0}function t(_){if(!_)return;let m=_.getAttribute("aria-expanded")==="true",g=_.getAttribute("aria-controls"),d=document.getElementById(g);d&&(_.setAttribute("aria-expanded",(!m).toString()),d.setAttribute("aria-hidden",m?"true":"false"))}function r(_){if(!_)return;let m=document.getElementById(_.id+"_value");m&&(m.textContent=_.value)}function f(_){_&&(s(_),_.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(m=>{m.querySelector(".aipkit_task_cw_vector_store_toggle")&&(l(m),m.querySelectorAll(".aipkit_vector_slider").forEach(g=>{r(g)}))}))}function u(){let _=document.getElementById("aipkit_autogpt_container");!_||_.dataset.kbListenerAttached==="true"||(_.addEventListener("change",m=>{let g=m.target;if(g.matches(".aipkit_task_cw_vector_store_toggle")){let d=g.closest(".aipkit_vector_settings_redesigned");l(d)}else if(g.matches(".aipkit_task_cw_vector_store_provider_select")){let d=g.closest(".aipkit_vector_settings_redesigned");c(d)}else if(g.matches(".aipkit_task_cw_vector_embedding_provider_select")){let d=g.closest(".aipkit_vector_settings_redesigned");o(d)}}),_.addEventListener("input",m=>{let g=m.target;g.matches(".aipkit_vector_slider")&&r(g)}),_.addEventListener("click",m=>{let g=m.target.closest(".aipkit_vector_settings_chunk_header--collapsible");if(!g)return;let d=g.closest(".aipkit_vector_settings_redesigned");!d||!d.querySelector(".aipkit_task_cw_vector_store_toggle")||(m.preventDefault(),t(g))}),f(_),_.dataset.kbListenerAttached="true")}function p(){let _=document.getElementById("aipkit_autogpt_container");_&&(u(),s(_),_.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(m=>{m.querySelector(".aipkit_task_cw_vector_store_toggle")&&(l(m),c(m),o(m))}))}window.aipkit_initCwKnowledgeBaseUI=u,window.aipkit_cw_task_populateEmbeddingModelSelect=o,window.aipkit_updateCwKnowledgeBaseUI=p,window.aipkit_autogptSyncOpenaiVectorStoreSelects=s})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_automated_task_form");if(!i){console.warn("Content Writing UI Init: Could not find main form element.");return}let a=i.querySelector("#aipkit_task_cw_ai_provider"),s=i.querySelector("#aipkit_task_cw_ai_model");a&&s&&typeof window.aipkit_task_cw_populateModels=="function"&&(a.dataset.cwProviderListenerAttached||(a.addEventListener("change",()=>window.aipkit_task_cw_populateModels(a,s)),a.dataset.cwProviderListenerAttached="true"),s.dataset.cwModelListenerAttached||(s.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),s.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(a,s),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let l=i.querySelector("#aipkit_task_cw_ai_temperature");l&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(l);let c=i.querySelector("#aipkit_task_cw_post_status");c&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(c.dataset.cwStatusListenerAttached||(c.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),c.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:c})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect(i),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initTaskRssInputHandler=="function"?window.aipkit_initTaskRssInputHandler():typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let t=i.querySelector(".aipkit_task_cw_image_enable_toggle");t&&(t.dataset.cwImgListenerAttached||(t.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),t.dataset.cwImgListenerAttached="true"));let r=i.querySelector("#aipkit_task_cw_image_provider");r&&(r.dataset.cwImgListenerAttached||(r.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),r.dataset.cwImgListenerAttached="true"));let f=i.querySelector("#aipkit_task_cw_generate_featured_image");f&&(f.dataset.cwImgListenerAttached||(f.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),f.dataset.cwImgListenerAttached="true"));let u=i.querySelector(".aipkit_task_cw_image_placement_select");u&&(u.dataset.cwImgListenerAttached||(u.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),u.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100));let p=i.querySelector(".aipkit_image_settings_redesigned");p&&p.dataset.imageChunkListenerAttached!=="true"&&(p.addEventListener("click",b=>{let A=b.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!A)return;b.preventDefault();let S=A.getAttribute("aria-expanded")==="true",I=A.getAttribute("aria-controls");if(!I)return;let T=document.getElementById(I);A.setAttribute("aria-expanded",(!S).toString()),T&&T.setAttribute("aria-hidden",S?"true":"false")}),p.dataset.imageChunkListenerAttached="true");let _=async b=>{if(!b||!b.name)return;let A=b.value.trim(),S=b.dataset.apiKeyBaseline||"";if(A===S||b.dataset.apiKeySaving==="true"||typeof window.aipkit_apiRequest!="function")return;let I=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,T=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,x=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;b.dataset.apiKeySaving="true",b.dataset.apiKeyBaseline=A,I&&I("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[b.name]:A}),T&&T("Updated")}catch(E){b.dataset.apiKeyBaseline=S,x&&x(`Error: ${E.message||"Failed to save."}`)}finally{b.dataset.apiKeySaving="false"}};i.querySelectorAll(".aipkit_task_cw_stock_api_key, #aipkit_task_cw_replicate_api_key").forEach(b=>{if(b.dataset.apiKeyListenerAttached==="true")return;b.dataset.apiKeyBaseline=b.value.trim();let A=()=>{_(b)};b.addEventListener("change",A),b.addEventListener("blur",A),b.dataset.apiKeyListenerAttached="true"}),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let g=i.querySelector("#aipkit_task_cw_ai_settings_toggle"),d=i.querySelector("#aipkit_task_cw_ai_parameters_row");g&&d&&(g.dataset.cwAiSettingsListenerAttached||(g.addEventListener("click",()=>{let b=d.style.display==="none"||d.style.display==="";d.style.display=b?"block":"none",g.classList.toggle("aipkit_active",b),g.setAttribute("aria-expanded",b)}),g.dataset.cwAiSettingsListenerAttached="true"));let w=i.querySelector("#aipkit_task_config_ai");w&&(w.dataset.cwPromptListenerAttached||(w.addEventListener("click",b=>{let A=b.target.closest(".aipkit_textarea_toggle");if(!A)return;let S=A.dataset.target,I=document.getElementById(S),T=A.querySelector(".dashicons");if(!I||!T)return;I.classList.toggle("aipkit_collapsed")?(T.classList.remove("dashicons-minus"),T.classList.add("dashicons-plus-alt2"),A.title="Expand"):(T.classList.remove("dashicons-plus-alt2"),T.classList.add("dashicons-minus"),A.title="Collapse")}),w.dataset.cwPromptListenerAttached="true"));let h=i.querySelector("#aipkit_task_config_seo");h&&(h.dataset.cwSeoPromptListenerAttached||(h.addEventListener("click",b=>{let A=b.target.closest(".aipkit_textarea_toggle");if(!A)return;let S=A.dataset.target,I=document.getElementById(S),T=A.querySelector(".dashicons");if(!I||!T)return;I.classList.toggle("aipkit_collapsed")?(T.classList.remove("dashicons-minus"),T.classList.add("dashicons-plus-alt2"),A.title="Expand"):(T.classList.remove("dashicons-plus-alt2"),T.classList.add("dashicons-minus"),A.title="Collapse")}),h.dataset.cwSeoPromptListenerAttached="true"))}function n(){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let a=window.aipkit_debug||!1,s=i.querySelector(".aipkit_task_cw_image_enable_toggle"),l=i.querySelector("#aipkit_task_cw_generate_featured_image"),c=i.querySelector(".aipkit_task_cw_image_settings_container"),o=i.querySelector("#aipkit_task_cw_image_provider");if(!s||!l||!c||!o)return;let t=s.checked,r=l.checked,f=t||r,u=o.value,p=u==="pexels"||u==="pixabay";if(c.style.display=f?"block":"none",f){let _=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],m=i.querySelector(".aipkit_task_cw_image_placement_select"),g=i.querySelector(".aipkit_task_cw_image_placement_x_field"),d=i.querySelector("#aipkit_task_cw_pexels_options"),w=i.querySelector("#aipkit_task_cw_pixabay_options"),h=i.querySelector("#aipkit_task_cw_replicate_options"),b=i.querySelector(".aipkit_task_cw_image_display_chunk"),A=i.querySelector("#aipkit_task_cw_image_model_group"),S=i.querySelector("#aipkit_task_cw_image_model_divider");if(_.forEach(I=>{let T=i.querySelector(I);if(T){let x=T.closest(".aipkit_form-group");x&&(x.style.display=t?"block":"none")}}),b&&(b.style.display=t?"":"none"),m&&g){let I=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(m.value);g.style.display=t&&I?"block":"none"}d&&(d.style.display=f&&p&&u==="pexels"?"block":"none"),w&&(w.style.display=f&&p&&u==="pixabay"?"block":"none"),h&&(h.style.display=f&&u==="replicate"?"block":"none"),A&&(A.style.display=f&&!p?"":"none"),S&&(S.style.display=f&&!p?"":"none"),f&&!p&&typeof e=="function"&&e(u)}}function e(i){let a=document.getElementById("aipkit_task_cw_image_model");if(!a)return;let s=a.value,c=window.aipkit_dashboard?.imageGeneratorModels?.[i.toLowerCase()]||[],o=window.aipkit_escapeHtml||function(r){return r},t=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||a.value;if(a.innerHTML="",c.length>0?(c.forEach(r=>{a.appendChild(new Option(o(r.name),r.id))}),a.querySelector(`option[value="${CSS.escape(t)}"]`)&&(a.value=t)):a.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null),typeof window.aipkit_updateAutogptAiSummaries=="function"&&a.value!==s){let r=document.getElementById("aipkit_autogpt_container");window.aipkit_updateAutogptAiSummaries(r)}}window.aipkit_initContentWritingTaskFormUI=k,window.aipkit_updateTaskImageSettingsUI=n,window.aipkit_populateTaskImageModels=e})();(function(){"use strict";function k(){let n=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!n)return;let e=n.querySelector("#aipkit_task_cc_ai_provider"),i=n.querySelector("#aipkit_task_cc_ai_model");e&&i&&typeof window.aipkit_task_cw_populateModels=="function"&&(e.dataset.ccProviderListenerAttached||(e.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(e,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),e.dataset.ccProviderListenerAttached="true"),i.dataset.ccModelListenerAttached||(i.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),i.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(e,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let a=n.querySelector("#aipkit_task_cc_ai_temperature");a&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(a);let s=n.querySelector("#aipkit_task_cc_content_max_tokens");s&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(s);let l=n.querySelector("#aipkit_task_cc_ai_settings_toggle"),c=n.querySelector("#aipkit_task_cc_ai_parameters_row");l&&c&&(l.dataset.ccAiSettingsListenerAttached||(l.addEventListener("click",()=>{let o=c.style.display==="none"||c.style.display==="";c.style.display=o?"block":"none",l.classList.toggle("aipkit_active",o),l.setAttribute("aria-expanded",o)}),l.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=k})();(function(){"use strict";function k(e){if(!e)return;let i=e.querySelectorAll("[data-aipkit-popover-target]");if(!i.length)return;let a=null,s=null,l=!1,c=u=>u?e.querySelector(`#${u}`):null,o=(u,p)=>{if(!u||!p)return;let _=u.getBoundingClientRect(),m=p.getBoundingClientRect(),g=m.width||400,d=m.height||0,w=window.innerWidth,h=window.innerHeight,b=12;if(u.dataset.aipkitPopoverPlacement==="bottom"){let I=_.left;I+g>w-b&&(I=_.right-g),I=Math.max(b,Math.min(I,w-g-b));let T=_.bottom+8;T+d>h-b&&(T=_.top-d-8),T=Math.max(b,Math.min(T,h-d-b)),p.style.left=`${Math.round(I)}px`,p.style.top=`${Math.round(T)}px`;return}if(u.dataset.aipkitPopoverPlacement==="left"){let I=_.left-g-10;I<b&&(I=_.right+10),I=Math.max(b,Math.min(I,w-g-b));let T=_.top;T+d>h-b&&(T=h-d-b),T=Math.max(b,T),p.style.left=`${Math.round(I)}px`,p.style.top=`${Math.round(T)}px`;return}let A=_.right+10;A+g>w-b&&(A=_.right-g-10),A=Math.max(b,Math.min(A,w-g-b));let S=_.top;S+d>h-b&&(S=h-d-b),S=Math.max(b,S),p.style.left=`${Math.round(A)}px`,p.style.top=`${Math.round(S)}px`},t=()=>{!s||!a||l||(l=!0,window.requestAnimationFrame(()=>{let u=a.querySelector(".aipkit_model_settings_popover_panel");o(s,u),l=!1}))},r=()=>{a&&(a.classList.remove("aipkit-active"),a.setAttribute("aria-hidden","true"),s&&s.setAttribute("aria-expanded","false"),a=null,s=null)},f=u=>{if(!u)return;let p=u.getAttribute("data-aipkit-popover-target"),_=c(p);if(!_)return;a&&a!==_&&r(),a=_,s=u,_.classList.add("aipkit-active"),_.setAttribute("aria-hidden","false"),u.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${p}`),typeof window.aipkit_initAutogptPromptFlyouts=="function"&&window.aipkit_initAutogptPromptFlyouts(e);let m=_.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{o(u,m)})};i.forEach(u=>{u.dataset.popoverListenerAttached!=="true"&&(u.addEventListener("click",p=>{if(p.preventDefault(),!(u.dataset.aipkitPopoverKeepOpen==="true")&&a&&s===u&&a.classList.contains("aipkit-active")){r();return}f(u)}),u.dataset.popoverListenerAttached="true")}),e.querySelectorAll(".aipkit_model_settings_popover").forEach(u=>{u.dataset.overlayListenerAttached!=="true"&&(u.addEventListener("click",_=>{_.target===u&&r()}),u.dataset.overlayListenerAttached="true");let p=u.querySelector(".aipkit_model_settings_popover_close");p&&p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",_=>{_.preventDefault(),r()}),p.dataset.popoverListenerAttached="true"),u.querySelectorAll("[data-aipkit-popover-close]").forEach(_=>{_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",m=>{m.preventDefault(),r()}),_.dataset.popoverListenerAttached="true")})}),e.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",u=>{u.key==="Escape"&&a&&r()}),e.dataset.escapeListenerAttached="true"),e.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),e.dataset.repositionListenersAttached="true")}function n(){let e=document.getElementById("aipkit_autogpt_container");e&&k(e)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n(),window.aipkit_initAutogptPopovers=k})();(function(){"use strict";let k=o=>{if(!o)return"";let t=o.options?o.options[o.selectedIndex]:null;return t?t.textContent.trim():""},n=o=>o?Array.from(o.selectedOptions||[]).map(t=>t.textContent.trim()).filter(Boolean):[],e=(o,t)=>{let r=o.filter(Boolean);return r.length?r.join(", "):t||""},i=(o,t)=>{if(!o)return;o.textContent=t,o.title=t;let r=o.dataset.aipkitPlaceholder||"",f="active";r&&t===r&&(f="placeholder"),o.dataset.aipkitSummaryState=f},a=(o,t)=>{if(!o)return;let r=t||document,f=o.dataset.aipkitAutogptSummary||"",u=o.dataset.aipkitAutogptProvider||"",p=o.dataset.aipkitAutogptModel||"",_=p?r.querySelector(p):null,m=k(_),g=o.dataset.aipkitPlaceholder||"Select";if(f==="images"){let d=o.dataset.aipkitDisabledLabel||g,w=o.dataset.aipkitAutogptToggle||"",h=o.dataset.aipkitAutogptFeaturedToggle||"",b=w?r.querySelector(w):null,A=h?r.querySelector(h):null;if(!(b&&b.checked||A&&A.checked)){i(o,d);return}let I=u?r.querySelector(u):null,T=I?I.value:"",x=k(I);if(["pexels","pixabay"].includes(T)){i(o,x||g);return}i(o,m||x||g);return}if(f==="vector"){let d=o.dataset.aipkitDisabledLabel||g,w=o.dataset.aipkitAutogptToggle||"",h=w?r.querySelector(w):null;if(!(h?h.checked:!0)){i(o,d);return}let A=u?r.querySelector(u):null,S=A?A.value:"",I=k(A),T=o.dataset.aipkitAutogptStore||"",x=o.dataset.aipkitAutogptOpenaiStore||"",E=o.dataset.aipkitAutogptPineconeStore||"",v=o.dataset.aipkitAutogptQdrantStore||"",y="";if(S==="openai"&&x){let C=r.querySelector(x);y=n(C).join(", ")}else S==="pinecone"&&E?y=k(r.querySelector(E)):S==="qdrant"&&v?y=k(r.querySelector(v)):T&&(y=k(r.querySelector(T)));i(o,e([y,I],g));return}i(o,m||g)},s=(o,t)=>{if(!o||o.dataset.aipkitAutogptSummaryBound==="true")return;let r=t||document,f=o.dataset.aipkitAutogptProvider||"",u=o.dataset.aipkitAutogptModel||"",p=o.dataset.aipkitAutogptToggle||"",_=o.dataset.aipkitAutogptFeaturedToggle||"",m=[o.dataset.aipkitAutogptStore||"",o.dataset.aipkitAutogptOpenaiStore||"",o.dataset.aipkitAutogptPineconeStore||"",o.dataset.aipkitAutogptQdrantStore||""].filter(Boolean),g=f?r.querySelector(f):null,d=u?r.querySelector(u):null,w=p?r.querySelector(p):null,h=_?r.querySelector(_):null,b=()=>a(o,r);g&&g.addEventListener("change",b),d&&d.addEventListener("change",b),w&&w.addEventListener("change",b),h&&h.addEventListener("change",b),m.forEach(A=>{let S=r.querySelector(A);S&&S.addEventListener("change",b)}),o.dataset.aipkitAutogptSummaryBound="true",a(o,r)};function l(o){let t=o||document.getElementById("aipkit_autogpt_container");if(!t)return;t.querySelectorAll("[data-aipkit-autogpt-summary]").forEach(f=>{s(f,t),a(f,t)})}function c(){let o=document.getElementById("aipkit_autogpt_container");o&&l(o)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.aipkit_updateAutogptAiSummaries=l})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"]},n={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},e=r=>String(r??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),i=()=>{let r=document.getElementById("aipkit_automated_task_type"),f=r?r.value:"";return f==="content_writing"?"bulk":f&&f.startsWith("content_writing_")&&f.replace("content_writing_","")||"bulk"},a=(r,f)=>{let u=k[r]||[],p=n[f]||[],_=[...u,...p];return _.filter((m,g)=>_.indexOf(m)===g)},s=(r,f)=>{if(!r)return;let u=r.dataset.label||"Variables:",p=r.dataset.copyTitle||"Click to copy";r.innerHTML=`${e(u)} `,f.forEach((_,m)=>{let g=document.createElement("code");g.className="aipkit-placeholder",g.title=p,g.textContent=_,r.appendChild(g),m<f.length-1&&r.appendChild(document.createTextNode(" "))})},l=r=>{let f=r||document.getElementById("aipkit_autogpt_container");if(!f)return;let u=i(),p=f.querySelectorAll(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");p.length&&p.forEach(_=>{let m=_.dataset.promptType||"",g=a(m,u);g.length&&s(_,g)})};function c(r){let f=r.querySelectorAll(".aipkit_cw_prompt_library_select");if(!f.length)return;let u=new WeakMap,p=window.aipkit_prompt_library_api||null,_=v=>{let y=v?.getAttribute("data-aipkit-prompt-target");return y?r.querySelector(`#${y}`):null},m=v=>{let C=v?.closest(".aipkit_cw_prompt_editor")?.querySelector(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");return String(C?.dataset?.promptType||"")},g=v=>{let y=v?.selectedOptions?.[0];return y?{promptId:y.dataset.promptId||"",promptType:y.dataset.promptType||"",label:y.dataset.promptLabel||y.textContent||"",source:y.dataset.promptSource||"",isCustom:(y.dataset.promptSource||"")==="custom",prompt:String(y.value||"")}:{promptId:"",promptType:"",label:"",source:"",isCustom:!1,prompt:""}},d=(v,y)=>{if(v)switch(v.classList.remove("aipkit_btn-primary","aipkit_btn-secondary","aipkit_btn-ghost","aipkit_btn-danger"),y){case"primary":v.classList.add("aipkit_btn-primary");break;case"danger":v.classList.add("aipkit_btn-danger");break;case"secondary":v.classList.add("aipkit_btn-secondary");break;default:v.classList.add("aipkit_btn-ghost");break}},w=v=>{let y=v?.closest(".aipkit_cw_prompt_editor_toolbar");return y?{manageButton:y.querySelector(".aipkit_cw_prompt_library_manage_btn"),applyButton:y.querySelector(".aipkit_cw_prompt_library_apply_btn"),undoButton:y.querySelector(".aipkit_cw_prompt_library_undo_btn"),saveButton:y.querySelector(".aipkit_cw_prompt_library_save_btn"),updateButton:y.querySelector(".aipkit_cw_prompt_library_update_btn"),deleteButton:y.querySelector(".aipkit_cw_prompt_library_delete_btn")}:{manageButton:null,applyButton:null,undoButton:null,saveButton:null,updateButton:null,deleteButton:null}},h=(v,y)=>{if(!v||!y)return;let{manageButton:C,applyButton:M,undoButton:B,saveButton:D,updateButton:W,deleteButton:U}=w(v),J=g(v),oe=!!J.isCustom&&!!J.promptId;if(C&&(d(C,"secondary"),C.disabled=!p||typeof window.aipkit_openPromptLibraryManager!="function"),M){d(M,"primary");let O=String(v.value||"");M.disabled=O.trim()===""||O===y.value}B&&(d(B,"secondary"),B.disabled=!u.has(y)),D&&(d(D,oe?"secondary":"primary"),D.disabled=String(y.value||"").trim()===""),W&&(d(W,oe?"primary":"secondary"),W.disabled=!oe),U&&(d(U,"danger"),U.disabled=!oe)},b=v=>{let y=v.closest(".aipkit_cw_prompt_editor_toolbar");if(!y||y.querySelector(".aipkit_cw_prompt_library_actions"))return;let C=document.createElement("span");C.className="aipkit_cw_prompt_library_actions";let M=document.createElement("button");M.type="button",M.className="aipkit_cw_prompt_library_manage_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",M.textContent="Library";let B=document.createElement("button");B.type="button",B.className="aipkit_cw_prompt_library_apply_btn aipkit_btn aipkit_btn-secondary aipkit_btn-small",B.textContent="Apply";let D=document.createElement("button");D.type="button",D.className="aipkit_cw_prompt_library_undo_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",D.textContent="Undo",D.disabled=!0;let W=document.createElement("button");W.type="button",W.className="aipkit_cw_prompt_library_save_btn aipkit_btn aipkit_btn-secondary aipkit_btn-small",W.textContent="Save As";let U=document.createElement("button");U.type="button",U.className="aipkit_cw_prompt_library_update_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",U.textContent="Update",U.disabled=!0;let J=document.createElement("button");J.type="button",J.className="aipkit_cw_prompt_library_delete_btn aipkit_btn aipkit_btn-danger aipkit_btn-small",J.textContent="Delete",J.disabled=!0,C.appendChild(M),C.appendChild(B),C.appendChild(D),C.appendChild(W),C.appendChild(U),C.appendChild(J),y.appendChild(C)},A=()=>{f.forEach(v=>{let y=_(v);h(v,y)})},S=(v,y)=>{if(!v||!y)return!1;let C=Array.from(v.options).find(M=>(M.dataset.promptId||"")===y);return C?(v.value=C.value,!0):!1},I=(v,y)=>{!Array.isArray(y)||!y.length||y.forEach(C=>{let M=String(C?.label||"").trim(),B=String(C?.prompt||"");if(!M||!B)return;let D=C?.source||(C?.is_builtin?"builtin":"custom"),W=document.createElement("option");W.value=B,W.textContent=D==="custom"?`${M} (Custom)`:M,W.dataset.promptId=String(C?.id||""),W.dataset.promptType=String(C?.type||""),W.dataset.promptSource=String(D||""),W.dataset.promptLabel=M,v.appendChild(W)})},T=(v,y={})=>{if(!v)return;let C=v.options?.[0]?.cloneNode(!0);if(!C)return;let M=v.selectedOptions?.[0]?.dataset.promptId||"",B=String(v.value||""),D=m(v);if(!D)return;if(v.innerHTML="",v.appendChild(C),I(v,y[D]||[]),!S(v,M)&&B){let U=Array.from(v.options).find(J=>String(J.value||"")===B);U?v.value=U.value:v.selectedIndex=0}let W=_(v);h(v,W)},x=async(v=!1)=>{if(!(!p||!f.length))try{let C=(await p.list({force:v}))?.library||{};f.forEach(M=>{T(M,C)})}catch(y){console.error("AutoGPT prompt library refresh failed:",y)}},E=v=>{let y=v&&typeof v.message=="string"&&v.message.trim()?v.message.trim():"Prompt library request failed.";window.alert(y)};f.forEach(v=>{if(v.dataset.promptLibraryAttached==="true")return;let y=_(v);b(v),h(v,y),y&&y.dataset.promptEditorStateAttached!=="true"&&(y.addEventListener("input",()=>{A()}),y.dataset.promptEditorStateAttached="true");let{manageButton:C,applyButton:M,undoButton:B,saveButton:D,updateButton:W,deleteButton:U}=w(v);M&&M.dataset.promptLibraryAttached!=="true"&&(M.addEventListener("click",()=>{let J=String(v.value||"");if(!J||!y||J===y.value){h(v,y);return}u.set(y,y.value),y.value=J,y.dispatchEvent(new Event("input",{bubbles:!0})),h(v,y)}),M.dataset.promptLibraryAttached="true"),B&&B.dataset.promptLibraryAttached!=="true"&&(B.addEventListener("click",()=>{if(!y||!u.has(y)){h(v,y);return}let J=u.get(y);u.delete(y),y.value=J,y.dispatchEvent(new Event("input",{bubbles:!0})),h(v,y)}),B.dataset.promptLibraryAttached="true"),C&&C.dataset.promptLibraryAttached!=="true"&&(C.addEventListener("click",()=>{if(typeof window.aipkit_openPromptLibraryManager!="function")return;let J=g(v),oe=J.promptType||m(v),O=J.isCustom&&J.promptId?J.promptId:"",L=String(J.label||"").replace(/\s+\(Custom\)\s*$/i,"").trim();window.aipkit_openPromptLibraryManager({promptType:oe,promptId:O,label:L,promptText:String(y?.value||"")})}),C.dataset.promptLibraryAttached="true"),D&&D.dataset.promptLibraryAttached!=="true"&&(D.addEventListener("click",()=>{if(!p||!y||typeof window.aipkit_openPromptLibraryManager!="function")return;let J=m(v);if(!J)return;let O=(g(v).label||"").replace(/\s+\(Custom\)\s*$/i,"").trim();window.aipkit_openPromptLibraryManager({action:"create",promptType:J,label:O,promptText:String(y.value||"")})}),D.dataset.promptLibraryAttached="true"),W&&W.dataset.promptLibraryAttached!=="true"&&(W.addEventListener("click",()=>{if(!p||!y||typeof window.aipkit_openPromptLibraryManager!="function")return;let J=g(v);if(!J.isCustom||!J.promptId){h(v,y);return}let oe=J.label.replace(/\s+\(Custom\)\s*$/i,"").trim(),O=J.promptType||m(v);O&&window.aipkit_openPromptLibraryManager({action:"update",promptType:O,promptId:J.promptId,label:oe,promptText:String(y.value||"")})}),W.dataset.promptLibraryAttached="true"),U&&U.dataset.promptLibraryAttached!=="true"&&(U.addEventListener("click",async()=>{if(!p||!y)return;let J=g(v);if(!J.isCustom||!J.promptId){h(v,y);return}if(window.confirm("Delete the selected custom preset?")){U.disabled=!0;try{await p.remove({promptId:J.promptId,promptType:J.promptType||m(v)}),await x(!0),v.selectedIndex=0,h(v,y)}catch(O){E(O)}finally{U.disabled=!1}}}),U.dataset.promptLibraryAttached="true"),v.addEventListener("change",()=>{h(v,y)}),v.dataset.promptLibraryAttached="true"}),p&&(x(!0),r.dataset.promptLibrarySyncAttached!=="true"&&(window.addEventListener("aipkit_prompt_library_updated",()=>{x(!0)}),r.dataset.promptLibrarySyncAttached="true"))}function o(r){if(!r)return;let f=r.querySelectorAll("[data-aipkit-flyout-target]");if(!f.length)return;let u=null,p=null,_=!1,m="You have unsaved prompt edits in this panel. Close anyway?",g=x=>x?r.querySelector(`#${x}`):null,d=x=>x?.querySelector(".aipkit_cw_prompt_editor_textarea")||null,w=x=>{let E=d(x);E&&(x.dataset.aipkitPromptOpenValue=E.value,x.dataset.aipkitPromptDirty="false")},h=x=>{let E=d(x);if(!E)return!1;let v=typeof x.dataset.aipkitPromptOpenValue=="string"?x.dataset.aipkitPromptOpenValue:"";return E.value!==v},b=x=>!x||!h(x)?!0:window.confirm(m),A=(x,E,v)=>{if(!x||!E||!u)return;let y=x.getBoundingClientRect(),C=v?v.getBoundingClientRect():y,M=E.getBoundingClientRect(),B=M.width||580,D=M.height||420,W=window.innerWidth,U=window.innerHeight,J=12,oe=C.left-B-10;oe<J&&(oe=C.right+10),oe=Math.max(J,Math.min(oe,W-B-J));let O=C.top;O+D>U-J&&(O=U-D-J),O=Math.max(J,O),u.style.left=`${Math.round(oe)}px`,u.style.top=`${Math.round(O)}px`},S=()=>{!u||!p||_||(_=!0,window.requestAnimationFrame(()=>{let x=u.querySelector(".aipkit_cw_prompt_panel"),E=p.closest(".aipkit_model_settings_popover_panel");A(p,x,E),_=!1}))},I=()=>{u&&b(u)&&(u.classList.remove("is-open"),u.setAttribute("aria-hidden","true"),p&&p.setAttribute("aria-expanded","false"),u=null,p=null)},T=x=>{let E=x.getAttribute("data-aipkit-flyout-target"),v=g(E);v&&(u&&u!==v&&(I(),u)||(u=v,p=x,v.classList.add("is-open"),v.setAttribute("aria-hidden","false"),x.setAttribute("aria-expanded","true"),w(v),l(v),window.requestAnimationFrame(()=>{let y=v.querySelector(".aipkit_cw_prompt_panel"),C=x.closest(".aipkit_model_settings_popover_panel");A(x,y,C)})))};f.forEach(x=>{x.dataset.promptFlyoutListenerAttached!=="true"&&(x.addEventListener("click",E=>{if(E.preventDefault(),u&&p===x&&u.classList.contains("is-open")){I();return}T(x)}),x.dataset.promptFlyoutListenerAttached="true")}),r.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(x=>{x.dataset.overlayListenerAttached!=="true"&&(x.addEventListener("click",E=>{E.target===x&&I()}),x.dataset.overlayListenerAttached="true")}),r.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",x=>{x.key==="Escape"&&u&&I()}),r.dataset.promptFlyoutEscapeAttached="true"),r.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",x=>{if(!u)return;let E=x.target;E.closest(".aipkit_cw_prompt_flyout")||E.closest("[data-aipkit-flyout-target]")||I()}),r.dataset.promptFlyoutClickAttached="true"),r.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",S),window.addEventListener("scroll",S,!0),r.dataset.promptFlyoutRepositionAttached="true")}function t(r){let f=r||document.getElementById("aipkit_autogpt_container");f&&(c(f),o(f),l(f))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>t()):t(),window.aipkit_initAutogptPromptFlyouts=t,window.aipkit_updateAutogptPromptPlaceholders=()=>{l()}})();(function(){"use strict";function k(){let c=document.querySelector("#aipkit_task_cw_ai_provider"),o=document.querySelector("#aipkit_task_cw_ai_model"),t=document.querySelector(".aipkit_task_cw_reasoning_effort_field"),r=t?t.closest(".aipkit_ai_settings_redesigned"):null;if(!c||!o||!t){t&&(t.style.display="none");return}let f=(c.value||"").toLowerCase(),p=(o.value||"").toLowerCase();f==="openai"&&e(p)?(t.style.display="block",r&&n(r,p)):t.style.display="none"}function n(c,o){let t=c.querySelector("[data-aipkit-reasoning-select]"),r=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!t||!r.length)return;let f=a(o),u=new Set(f.allowed);r.forEach(g=>{let d=g.querySelector(".aipkit_ai_reasoning_input");if(!d)return;let w=d.value==="minimal"?"low":d.value,h=u.has(w);g.style.display=h?"":"none",h||(d.checked=!1)});let p=t.value||"";p==="minimal"&&(p="low"),u.has(p)||(p=f.defaultValue),u.has(p)||(p=f.allowed[0]||"");let _=t.value;p&&(t.value=p);let m=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(m){m.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(d=>d.classList.remove("aipkit_ai_reasoning_option--selected"));let g=m.closest(".aipkit_ai_reasoning_option");g&&g.classList.add("aipkit_ai_reasoning_option--selected")}_!==t.value&&t.dispatchEvent(new Event("change",{bubbles:!0}))}function e(c){if(i(c))return!1;let o=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),t=c.includes("gpt-5");return o||t}function i(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let o=c.match(/gpt-5\.(\d+)/);if(o)return Number.parseInt(o[1],10)>=2;let t=c.match(/gpt-(\d+)/);return t?Number.parseInt(t[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_autogpt_cw_toggleReasoningEffort=k})();(function(){"use strict";function k(){let c=document.querySelector("#aipkit_task_cc_ai_provider"),o=document.querySelector("#aipkit_task_cc_ai_model"),t=document.querySelector(".aipkit_task_cc_reasoning_effort_field"),r=t?t.closest(".aipkit_ai_settings_redesigned"):null;if(!c||!o||!t){t&&(t.style.display="none");return}let f=(c.value||"").toLowerCase(),p=(o.value||"").toLowerCase();f==="openai"&&e(p)?(t.style.display="block",r&&n(r,p)):t.style.display="none"}function n(c,o){let t=c.querySelector("[data-aipkit-reasoning-select]"),r=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!t||!r.length)return;let f=a(o),u=new Set(f.allowed);r.forEach(g=>{let d=g.querySelector(".aipkit_ai_reasoning_input");if(!d)return;let w=d.value==="minimal"?"low":d.value,h=u.has(w);g.style.display=h?"":"none",h||(d.checked=!1)});let p=t.value||"";p==="minimal"&&(p="low"),u.has(p)||(p=f.defaultValue),u.has(p)||(p=f.allowed[0]||"");let _=t.value;p&&(t.value=p);let m=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(m){m.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(d=>d.classList.remove("aipkit_ai_reasoning_option--selected"));let g=m.closest(".aipkit_ai_reasoning_option");g&&g.classList.add("aipkit_ai_reasoning_option--selected")}_!==t.value&&t.dispatchEvent(new Event("change",{bubbles:!0}))}function e(c){if(i(c))return!1;let o=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),t=c.includes("gpt-5");return o||t}function i(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let o=c.match(/gpt-5\.(\d+)/);if(o)return Number.parseInt(o[1],10)>=2;let t=c.match(/gpt-(\d+)/);return t?Number.parseInt(t[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_autogpt_cc_toggleReasoningEffort=k})();(function(){"use strict";function k(n,e){let i=document.getElementById("aipkit_save_task_btn"),a=i?i.querySelector(".aipkit_btn-text"):null,s=n.elements.task_id,l=n.elements.task_name,c=n.elements.task_type,o=n.elements.task_status,t=document.getElementById("aipkit_cancel_edit_task_btn"),f=(window.aipkit_automated_tasks_config||{}).text||{},u=document.getElementById("aipkit_autogpt_header_title_default"),p=document.getElementById("aipkit_autogpt_header_title_editor"),_=document.getElementById("aipkit_autogpt_title_display"),m=document.getElementById("aipkit_autogpt_title_text"),g=document.getElementById("aipkit_autogpt_task_title_input"),d=m&&m.dataset.defaultLabel||g&&g.placeholder||"New Task",w=()=>{let S=(g?g.value.trim():"")||d;m&&(m.textContent=S),_&&_.setAttribute("title",S),l&&(l.value=S)},h=()=>{!_||!g||(_.style.display="none",g.style.display="inline-block",g.focus(),g.select())},b=()=>{!_||!g||(g.style.display="none",_.style.display="inline-flex",w())};u&&(u.style.display="none"),p&&(p.style.display="flex"),p&&p.dataset.inlineTitleBound!=="true"&&_&&g&&(_.addEventListener("click",h),g.addEventListener("blur",b),g.addEventListener("keydown",A=>{A.key==="Enter"&&(A.preventDefault(),g.blur())}),g.addEventListener("input",w),p.dataset.inlineTitleBound="true"),e?(a&&(a.textContent=f.save_task_button||"Save Task"),s&&(s.value=e.id||""),g&&(g.value=e.task_name||d),w(),c&&(c.value=e.task_type||"content_indexing"),o&&(o.value=e.status||"active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),t&&(t.style.display="inline-flex")):(a&&(a.textContent=f.save_task_button||"Save Task"),s&&(s.value=""),g&&(g.value=d),w(),c&&(c.value="content_indexing"),o&&(o.value="active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),t&&(t.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(e){return e};function n(e){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let a=i.elements["post_types[]"];a&&(Array.from(a.options).forEach(l=>l.selected=!1),(e.post_types||[]).forEach(l=>{let c=a.querySelector(`option[value="${k(l)}"]`);c&&(c.selected=!0)}));let s=i.elements.target_store_provider;s&&(s.value=e.target_store_provider||"openai",s.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(e.target_store_provider||"openai").then(()=>{let l=i.elements.target_store_id;l&&(l.value=e.target_store_id||"")}),i.elements.index_existing_now_flag&&(i.elements.index_existing_now_flag.checked=e.index_existing_now_flag==="1"),i.elements.only_new_updated_flag&&(i.elements.only_new_updated_flag.checked=e.only_new_updated_flag==="1"),(e.target_store_provider==="pinecone"||e.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&e.embedding_provider&&e.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${e.embedding_provider}:${e.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),i.elements.task_frequency&&(i.elements.task_frequency.value=e.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(e){return e};function n(e){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let a=e.cw_generation_mode||"bulk";if(a==="bulk"||a==="single"||a==="task"){let A=i.elements.content_title_bulk;A&&(A.value=e.content_title||"")}else if(a==="csv"){let A=i.elements.content_title;A&&(A.value=e.content_title||"")}else if(a==="rss"){i.elements.rss_feeds&&(i.elements.rss_feeds.value=e.rss_feeds||""),i.elements.rss_include_keywords&&(i.elements.rss_include_keywords.value=e.rss_include_keywords||""),i.elements.rss_exclude_keywords&&(i.elements.rss_exclude_keywords.value=e.rss_exclude_keywords||"");let A=i.elements.rss_feeds;A&&(typeof window.aipkit_initTaskRssInputHandler=="function"&&window.aipkit_initTaskRssInputHandler(),A.dispatchEvent(new Event("input",{bubbles:!0})))}else if(a==="url")i.elements.url_list&&(i.elements.url_list.value=e.url_list||"");else if(a==="gsheets"){let A=i.elements.gsheets_credentials;if(A){let S=e.gsheets_credentials,I=A.closest(".aipkit_gsheets_section_container");typeof S=="object"&&S!==null?A.value=JSON.stringify(S,null,2):A.value=S||"",A.value?(A.dataset.filename="credentials.json",I&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(I),100)):(delete A.dataset.filename,I&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(I,"clear"))}i.elements.gsheets_sheet_id&&(i.elements.gsheets_sheet_id.value=e.gsheets_sheet_id||"")}i.elements.custom_title_prompt&&(i.elements.custom_title_prompt.value=e.custom_title_prompt||""),i.elements.custom_content_prompt&&(i.elements.custom_content_prompt.value=e.custom_content_prompt||"");let s=document.getElementById("aipkit_task_cw_ai_provider"),l=document.getElementById("aipkit_task_cw_ai_model");s&&(s.value=e.ai_provider?e.ai_provider.toLowerCase():"openai",e.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=e.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&l&&window.aipkit_task_cw_populateModels(s,l));let c=document.getElementById("aipkit_task_cw_ai_temperature");if(c){c.value=e.ai_temperature||"1.0";let A=document.getElementById("aipkit_task_cw_ai_temperature_value");A&&(A.textContent=c.value)}let o=document.getElementById("aipkit_task_cw_content_length");o&&(o.value=e.content_length||"medium",o.dispatchEvent(new Event("change",{bubbles:!0})));let t=i.elements.reasoning_effort;if(t){let A=e.reasoning_effort||"";A&&(t.value=A==="minimal"?"low":A,t.dispatchEvent(new Event("change",{bubbles:!0})))}l&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>l.dispatchEvent(new Event("change",{bubbles:!0})),100),i.elements.generate_meta_description&&(i.elements.generate_meta_description.checked=e.generate_meta_description==="1"),i.elements.custom_meta_prompt&&(i.elements.custom_meta_prompt.value=e.custom_meta_prompt||""),i.elements.generate_focus_keyword&&(i.elements.generate_focus_keyword.checked=e.generate_focus_keyword==="1"),i.elements.custom_keyword_prompt&&(i.elements.custom_keyword_prompt.value=e.custom_keyword_prompt||""),i.elements.generate_excerpt&&(i.elements.generate_excerpt.checked=e.generate_excerpt==="1"),i.elements.custom_excerpt_prompt&&(i.elements.custom_excerpt_prompt.value=e.custom_excerpt_prompt||""),i.elements.generate_tags&&(i.elements.generate_tags.checked=e.generate_tags==="1"),i.elements.custom_tags_prompt&&(i.elements.custom_tags_prompt.value=e.custom_tags_prompt||""),i.elements.generate_toc&&(i.elements.generate_toc.checked=e.generate_toc==="1"),i.elements.generate_seo_slug&&(i.elements.generate_seo_slug.checked=e.generate_seo_slug==="1"),i.elements.post_type&&(i.elements.post_type.value=e.post_type||"post");let r=i.elements.post_author;r&&(r.value=e.post_author||window.aipkit_dashboard?.currentUserId||"1");let f=document.getElementById("aipkit_task_cw_post_status");f&&(f.value=e.post_status||"draft");let u=e.schedule_mode||"immediate",p=i.querySelector(`input[name="schedule_mode"][value="${u}"]`);p&&(p.checked=!0),i.elements.smart_schedule_start_datetime&&(i.elements.smart_schedule_start_datetime.value=e.smart_schedule_start_datetime||""),i.elements.smart_schedule_interval_value&&(i.elements.smart_schedule_interval_value.value=e.smart_schedule_interval_value||"1"),i.elements.smart_schedule_interval_unit&&(i.elements.smart_schedule_interval_unit.value=e.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:f});let _=document.getElementById("aipkit_task_cw_post_categories");_&&_.options&&(Array.from(_.options).forEach(S=>S.selected=!1),(Array.isArray(e.post_categories)?e.post_categories.map(String):[]).forEach(S=>{let I=_.querySelector(`option[value="${k(S)}"]`);I&&(I.selected=!0)}),_.dispatchEvent(new Event("change",{bubbles:!0}))),i.elements.generate_images_enabled&&(i.elements.generate_images_enabled.checked=e.generate_images_enabled==="1"),i.elements.image_provider&&(i.elements.image_provider.value=(e.image_provider||"openai").toLowerCase()),i.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=e.image_model),i.elements.image_prompt&&(i.elements.image_prompt.value=e.image_prompt||""),i.elements.image_count&&(i.elements.image_count.value=e.image_count||"1"),i.elements.image_placement&&(i.elements.image_placement.value=e.image_placement||"after_first_h2"),i.elements.image_placement_param_x&&(i.elements.image_placement_param_x.value=e.image_placement_param_x||"2"),i.elements.image_size&&(i.elements.image_size.value=e.image_size||"large"),i.elements.image_alignment&&(i.elements.image_alignment.value=e.image_alignment||"none"),i.elements.generate_featured_image&&(i.elements.generate_featured_image.checked=e.generate_featured_image==="1"),i.elements.featured_image_prompt&&(i.elements.featured_image_prompt.value=e.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let m=i.querySelector('input[name="enable_vector_store"]');m&&(m.checked=e.enable_vector_store==="1",m.dispatchEvent(new Event("change",{bubbles:!0})));let g=i.querySelector("#aipkit_task_cw_vector_store_provider");g&&(g.value=e.vector_store_provider||"openai",g.dispatchEvent(new Event("change",{bubbles:!0})));let d=i.querySelector("#aipkit_task_cw_vector_store_top_k");if(d){d.value=e.vector_store_top_k||"3";let A=i.querySelector("#aipkit_task_cw_vector_store_top_k_value");A&&(A.textContent=d.value)}let w=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(w&&w.options){let A=Array.isArray(e.openai_vector_store_ids)?e.openai_vector_store_ids.map(String):[];Array.from(w.options).forEach(S=>{S.selected=A.includes(S.value)}),w.dispatchEvent(new Event("change",{bubbles:!0}))}let h=document.getElementById("aipkit_task_cw_pinecone_index_name");h&&(h.value=e.pinecone_index_name||"");let b=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(b&&(b.value=e.qdrant_collection_name||""),e.vector_store_provider==="pinecone"||e.vector_store_provider==="qdrant"){let A=document.getElementById("aipkit_task_cw_vector_embedding_provider");A&&(A.value=e.vector_embedding_provider||"openai",A.dispatchEvent(new Event("change",{bubbles:!0})))}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),e.vector_store_provider&&(e.vector_store_provider==="pinecone"||e.vector_store_provider==="qdrant")&&e.vector_embedding_model&&setTimeout(()=>{window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=e.vector_embedding_model);let A=i.querySelector("#aipkit_autogpt_cw_vector_settings_popover")||i;A&&typeof window.aipkit_cw_task_populateEmbeddingModelSelect=="function"&&window.aipkit_cw_task_populateEmbeddingModelSelect(A)},150),i.elements.task_frequency&&(i.elements.task_frequency.value=e.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=n})();(function(){"use strict";function k(n){let e=document.getElementById("aipkit_automated_task_form");if(!e)return;let i=document.getElementById("aipkit_task_cc_ai_provider"),a=document.getElementById("aipkit_task_cc_ai_model");i&&a&&(i.value=n.ai_provider?n.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&n.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=n.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(i,a));let s=document.getElementById("aipkit_task_cc_ai_temperature");if(s){s.value=n.ai_temperature||1;let _=document.getElementById(s.id+"_value");_&&(_.textContent=s.value)}let l=document.getElementById("aipkit_task_cc_content_max_tokens");if(l){l.value=n.content_max_tokens||4e3;let _=document.getElementById(l.id+"_value");_&&(_.textContent=l.value),l.dispatchEvent(new Event("change",{bubbles:!0}))}let c=e.elements.cc_reasoning_effort;if(c){let _=n.reasoning_effort||"";_&&(c.value=_==="minimal"?"low":_,c.dispatchEvent(new Event("change",{bubbles:!0})))}a&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>a.dispatchEvent(new Event("change",{bubbles:!0})),100);let o=document.getElementById("aipkit_task_cc_custom_content_prompt");o&&(o.value=n.custom_content_prompt||"");let t=document.getElementById("aipkit_task_comment_reply_include_keywords");t&&(t.value=n.include_keywords||"");let r=document.getElementById("aipkit_task_comment_reply_exclude_keywords");r&&(r.value=n.exclude_keywords||"");let f=e.elements["post_types_for_comments[]"];f&&(Array.from(f.options).forEach(_=>_.selected=!1),(n.post_types_for_comments||[]).forEach(_=>{let m=f.querySelector(`option[value="${_}"]`);m&&(m.selected=!0)}));let u=e.elements.reply_action;u&&(u.value=n.reply_action||"approve");let p=e.elements.no_reply_to_replies;p&&(p.checked=n.no_reply_to_replies==="1"),e.elements.task_frequency&&(e.elements.task_frequency.value=n.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_automated_task_form"),e=window.aipkit_automated_tasks_config||{},i=window.aipkit_dashboard||{},a=e.default_cw_prompts||{};if(!n)return;n.elements.custom_title_prompt&&(n.elements.custom_title_prompt.value=a.title||""),n.elements.custom_content_prompt&&(n.elements.custom_content_prompt.value=a.content||""),n.elements.custom_meta_prompt&&(n.elements.custom_meta_prompt.value=a.meta||""),n.elements.custom_keyword_prompt&&(n.elements.custom_keyword_prompt.value=a.keyword||""),n.elements.image_prompt&&(n.elements.image_prompt.value=a.image||""),n.elements.featured_image_prompt&&(n.elements.featured_image_prompt.value=a.featured_image||"");let s=document.getElementById("aipkit_task_cw_ai_provider"),l=document.getElementById("aipkit_task_cw_ai_model");if(s&&l){let o=(i.main_provider||"openai").toLowerCase();if(s.value=o,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(s,l);let t="",r=i?.models?.[o];switch(o){case"openai":t="gpt-4.1-mini";break;case"google":t="gemini-1.5-flash-latest";break;case"openrouter":t="moonshotai/kimi-k2.5";break;case"claude":t="claude-opus-4-6",Array.isArray(r)&&r.length>0&&(r.some(u=>u&&u.id==="claude-opus-4-6")||(t=r[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(r)&&r.length>0&&(t=r[0].id||"");break}l.querySelector(`option[value="${CSS.escape(t)}"]`)?l.value=t:console.warn(`Default model ${t} not found for provider ${o}.`)}}let c=document.getElementById("aipkit_task_cw_content_length");c&&(c.value="medium",c.dispatchEvent(new Event("change",{bubbles:!0}))),n.elements.generate_images_enabled&&(n.elements.generate_images_enabled.checked=!1),n.elements.image_provider&&(n.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{n.elements.image_model&&(n.elements.image_model.value="gpt-image-1")},0)),n.elements.image_count&&(n.elements.image_count.value="1"),n.elements.image_placement&&(n.elements.image_placement.value="after_first_h2"),n.elements.generate_featured_image&&(n.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_automated_task_form"),e=window.aipkit_dashboard||{};if(!n)return;let i=document.getElementById("aipkit_task_cc_custom_content_prompt");i&&(i.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let a=document.getElementById("aipkit_task_cc_ai_provider"),s=document.getElementById("aipkit_task_cc_ai_model");if(a&&s){let c=(e.main_provider||"openai").toLowerCase();if(a.value=c,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(a,s);let o="",t=(e.models||{})[c]||{};switch(c){case"openai":o="gpt-4o-mini";break;case"google":o="gemini-1.5-flash-latest";break;case"openrouter":o="moonshotai/kimi-k2.5";break;case"claude":o="claude-opus-4-6",Array.isArray(t)&&t.length>0&&(t.some(f=>f&&f.id==="claude-opus-4-6")||(o=t[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(t)&&t.length>0&&(o=t[0].id||"");break}s.querySelector(`option[value="${CSS.escape(o)}"]`)&&(s.value=o)}}let l=document.getElementById("aipkit_task_cc_content_max_tokens");l&&(l.value="4000",l.dispatchEvent(new Event("change",{bubbles:!0})))}window.aipkit_form_setCommentReplyDefaults=k})();(function(){"use strict";function k(n,e,i,a=null){let s=document.getElementById("aipkit_automated_task_form"),l=document.getElementById("aipkit_automated_task_queue_wrapper");if(!s){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),s.reset(),s.elements.task_id&&(s.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),a){let f=((window.aipkit_automated_tasks_config||{}).task_types||{})[a.task_type];if(f){let u=s.elements.task_category;if(u){u.value=f.category;let p=new Event("change",{bubbles:!0});u.dispatchEvent(p)}}}else{let r=s.elements.task_category,f=s.elements.task_type;r&&f&&(r.value="content_creation",r.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{f.value="content_writing_bulk",f.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(s,a):console.error("Show Task Form: aipkit_form_populateCommonFields function is missing.");let c=s.elements.task_type;if(c&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:c}),a){let r=JSON.parse(a.task_config||"{}");a.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(r):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):a.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(r):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):a.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(r):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):a.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(r):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}n&&(n.style.display="block"),e&&(e.style.display="none"),l&&(l.style.display="none"),i&&(i.style.display="none");let o=document.getElementById("aipkit_autogpt_editor_actions");o&&(o.style.display="flex");let t=document.getElementById("aipkit_autogpt_cron_info");t&&(t.style.display="none"),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers(),typeof window.aipkit_restoreAutogptPromptDraft=="function"&&setTimeout(()=>{window.aipkit_restoreAutogptPromptDraft({isEditing:!!a,silent:!!a})},120)}window.aipkit_form_showAutomatedTaskForm=k})();(function(){"use strict";function k(n,e,i){let a=document.getElementById("aipkit_automated_task_queue_wrapper");n&&(n.style.display="none"),e&&(e.style.display="block"),a&&(a.style.display="block"),i&&(i.style.display="inline-flex");let s=document.getElementById("aipkit_autogpt_editor_actions");s&&(s.style.display="none");let l=document.getElementById("aipkit_autogpt_cron_info");l&&(l.style.display="inline-flex");let c=document.getElementById("aipkit_automated_task_form"),o=document.getElementById("aipkit_automated_task_id"),t=document.getElementById("aipkit_automated_task_category"),r=document.getElementById("aipkit_autogpt_header_title_default"),f=document.getElementById("aipkit_autogpt_header_title_editor"),u=document.getElementById("aipkit_autogpt_title_display"),p=document.getElementById("aipkit_autogpt_task_title_input");c&&c.reset(),o&&(o.value=""),r&&(r.style.display="block"),f&&(f.style.display="none"),u&&(u.style.display="inline-flex"),p&&(p.style.display="none"),t&&(t.value="",t.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=k})();(function(){"use strict";let k=()=>{typeof window.aipkit_updateAutogptPromptPlaceholders=="function"&&window.aipkit_updateAutogptPromptPlaceholders()};function n(s,l,c,o){if(!s||!l)return;s.innerHTML="";let t={content_writing_bulk:{icon:"dashicons-edit"},content_writing_csv:{icon:"dashicons-media-spreadsheet"},content_writing_rss:{icon:"dashicons-rss"},content_writing_url:{icon:"dashicons-admin-links"},content_writing_gsheets:{icon:"dashicons-analytics"}};c.forEach(([r,f])=>{let u=document.createElement("label");u.className="aipkit_cw_mode_card aipkit_autogpt_task_type_card",u.classList.toggle("is-active",r===o);let p=document.createElement("input");p.type="radio",p.name="aipkit_task_type_radio",p.value=r,p.checked=r===o,p.disabled=!!f.disabled,p.className="aipkit_task_type_input",p.addEventListener("change",()=>{p.checked&&(l.value=r,l.dispatchEvent(new Event("change",{bubbles:!0})),s.querySelectorAll(".aipkit_cw_mode_card").forEach(w=>w.classList.remove("is-active")),u.classList.add("is-active"))});let _=t[r]||{},m=document.createElement("span");m.className="aipkit_cw_mode_icon",m.innerHTML=`<span class="dashicons ${_.icon||"dashicons-admin-generic"}"></span>`;let g=document.createElement("span");g.className="aipkit_cw_mode_text";let d=document.createElement("span");d.className="aipkit_cw_mode_title",d.textContent=f.label,g.appendChild(d),f.disabled&&(u.classList.add("is-disabled"),u.setAttribute("aria-disabled","true")),u.appendChild(p),u.appendChild(m),u.appendChild(g),s.appendChild(u)})}function e(s,l){s&&s.querySelectorAll('input[name="aipkit_task_type_radio"]').forEach(c=>{let o=c.value===l;c.checked=o;let t=c.closest(".aipkit_cw_mode_card");t&&t.classList.toggle("is-active",o)})}function i(s){let l=s.target.value,c=document.querySelector(".aipkit_autogpt_form_right"),o=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;if(c){let h=!o&&l==="content_enhancement";c.style.display=h?"none":""}let t=document.getElementById("aipkit_automated_task_type"),r=document.getElementById("aipkit_automated_task_type_group"),f=document.getElementById("aipkit_automated_task_type_radios"),u=(window.aipkit_automated_tasks_config||{}).task_types||{},p=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),_=p.lastTaskTypeByCategory||{};p.lastTaskTypeByCategory=_;let m=window.aipkit_escapeHtml||function(h){return h};t.innerHTML="",t.disabled=!0,r&&(r.style.display="none"),f&&(f.innerHTML="");let g=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(g&&g.querySelectorAll(".aipkit_task_config_section").forEach(h=>{h.id==="aipkit_task_cw_input_modes_wrapper"&&h.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(b=>{b.style.display="none"}),h.style.display="none"}),!l){t.appendChild(new Option(m("-- Select a category first --"),"")),t.dispatchEvent(new Event("change",{bubbles:!0}));return}let d=Object.entries(u).filter(([h,b])=>b.category===l);if(d.length===0)t.appendChild(new Option(m("-- No tasks in this category --"),""));else if(d.length===1){let[h,b]=d[0],A=new Option(m(b.label),h);b.disabled&&(A.disabled=!0),t.appendChild(A),t.value=h,t.disabled=!0,r&&(r.style.display="none")}else t.appendChild(new Option(m("-- Select a Task Type --"),"")),d.forEach(([h,b])=>{let A=new Option(m(b.label),h);b.disabled&&(A.disabled=!0),t.appendChild(A)}),t.disabled=!1;if(d.length>1){let h=_[l];!h&&l==="content_creation"&&(h="content_writing_bulk"),!h&&d.length>0&&t.options.length&&(h=d[0][0]),h&&(t.value=h)}let w=!!f&&d.length>1&&l==="content_creation";r&&(r.style.display=w?"":"none"),f&&(w?n(f,t,d,t.value):f.innerHTML=""),t.dispatchEvent(new Event("change",{bubbles:!0}))}function a(s){let l=s.target.value,c=document.getElementById("aipkit_automated_task_type_radios");e(c,l);let o=document.getElementById("aipkit_automated_task_id"),t=!o||!o.value,r=document.getElementById("aipkit_wizard_next_btn"),f=r?r.querySelector(".aipkit_btn-text"):null,u=document.getElementById("aipkit_save_task_btn"),p=u?u.querySelector(".aipkit_btn-text"):null,_=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,g=((window.aipkit_automated_tasks_config||{}).task_types||{})[l],d=g&&g.pro===!0,w=(window.aipkit_automated_tasks_config||{}).text||{};if(g){let v=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),y=v.lastTaskTypeByCategory||{};y[g.category]=l,v.lastTaskTypeByCategory=y}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(l):console.error("Task Type Change: aipkit_renderWizard function is missing.");let h=document.querySelector(".aipkit_task_schedule_frequency"),b=document.getElementById("aipkit_automated_task_frequency");if(h&&b){let v=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={});l==="content_writing_bulk"||l==="content_writing_csv"?(!v.lastVisibleFrequency&&b.value&&(v.lastVisibleFrequency=b.value),b.value="one-time",h.style.display="none"):(h.style.display="",v.lastVisibleFrequency&&b.value==="one-time"&&(b.value=v.lastVisibleFrequency),v.lastVisibleFrequency=b.value)}let A=document.querySelectorAll("[data-aipkit-task-publishing]");if(A.length){let v=l&&l.startsWith("content_writing");A.forEach(y=>{y.style.display=v?"":"none"})}d&&!_?(f&&r&&(r.dataset.action="next",f.textContent=w.wizard_next_button||"Next",r.style.display="none"),p&&u&&(u.dataset.action="save",p.textContent=w.save_task_button||"Save Task",u.style.display="none")):(f&&r&&(r.dataset.action="next",f.textContent=w.wizard_next_button||"Next",r.style.display=""),p&&u&&(u.dataset.action="save",p.textContent=w.save_task_button||"Save Task",u.style.display=""));let S=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!S){console.error("Task Type Change: Could not find setup pane.");return}let I=S.querySelector("#aipkit_task_ci_source_wrapper"),T=S.querySelector("#aipkit_task_cw_input_modes_wrapper"),x=S.querySelector("#aipkit_task_cc_source_wrapper"),E=S.querySelector("#aipkit_task_ce_content_selection_wrapper");if(I&&(I.style.display="none"),T&&(T.style.display="none"),x&&(x.style.display="none"),E&&(E.style.display="none"),!!l){if(l==="content_indexing")I&&(I.style.display="block");else if(l.startsWith("content_writing")){if(k(),T){T.style.display="block";let v=l.replace("content_writing_",""),y=v==="content_writing"?"bulk":v,C=document.getElementById("aipkit_task_cw_generation_mode");C&&(C.value=y),T.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(M=>{M.id===`aipkit_task_cw_input_mode_${y}`?M.style.display="block":M.style.display="none"})}}else if(l==="community_reply_comments")x&&(x.style.display="block");else if(l==="enhance_existing_content"){E&&(E.style.display="block");let v=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),y=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(v&&y){let C=v.querySelector("#aipkit_task_ce_post_types");if(C&&!C.dataset.placeholderListenerAttached){let M=()=>{let D=Array.from(C.selectedOptions).map(U=>U.value).includes("product");y.querySelectorAll(".aipkit-product-placeholders").forEach(U=>{U.style.display=D?"inline":"none"})};C.addEventListener("change",M),C.dataset.placeholderListenerAttached="true",M()}}}t&&(l.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():l==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():l==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),l==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():l.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():l==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():l==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=i,window.aipkit_form_handleTaskTypeChange=a})();(function(){"use strict";function k(n,e="info"){let i=document.getElementById("aipkit_automated_task_form_status");if(!i)return;let a=i.classList.contains("aipkit_training_status");if(!n){i.textContent="",a?i.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):i.className="aipkit_form-help";return}if(i.textContent=n,a){let s=e==="info"?"loading":e;i.classList.remove("is-success","is-error","is-warning","is-loading"),i.classList.add("is-visible"),s&&i.classList.add(`is-${s}`)}else i.className=`aipkit_form-help aipkit_settings_message-${e}`;setTimeout(()=>{i.textContent===n&&(i.textContent="",a?i.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):i.className="aipkit_form-help")},5e3)}window.aipkit_form_showAutomatedTaskFormStatus=k})();(function(){"use strict";function k(n){let e=new FormData(n),i=Object.fromEntries(e.entries());return i.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:e,data:i}}window.aipkit_save_task_extractBaseData=k})();(function(){"use strict";function k(n,e){if(n.task_type==="content_indexing"){if(n.post_types=e.getAll("post_types[]"),n.target_store_provider=e.get("target_store_provider")||"openai",n.target_store_id=e.get("target_store_id")||"",n.target_store_provider==="pinecone"||n.target_store_provider==="qdrant"){let a=e.get("embedding_model")||"";if(a&&a.includes(":")){let[s,l]=a.split(":",2);n.embedding_provider=s,n.embedding_model=l}else n.embedding_provider="",n.embedding_model=a}else delete n.embedding_provider,delete n.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(a=>delete n[a])}else delete n.post_types,delete n["post_types[]"],delete n.target_store_provider,delete n.target_store_id,delete n.index_existing_now_flag,delete n.only_new_updated_flag,delete n.embedding_model,delete n.embedding_provider;return n}window.aipkit_save_task_handleContentIndexing=k})();(function(){"use strict";function k(n,e){return n.task_type.startsWith("content_writing")?(n.post_categories=e.getAll("post_categories[]"),n.openai_vector_store_ids=e.getAll("openai_vector_store_ids[]"),delete n["post_categories[]"],delete n["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(a=>delete n[a]),delete n.replicate_api_key,delete n.pexels_api_key,delete n.pixabay_api_key):(delete n.content_title,delete n.content_title_bulk,delete n.content_keywords,delete n.content_length,delete n.ai_temperature,delete n.post_type,delete n.post_author,delete n.post_status,delete n["post_categories[]"],delete n.post_categories,delete n.prompt_mode,delete n.custom_title_prompt,delete n.custom_content_prompt,delete n.generate_meta_description,delete n.custom_meta_prompt,delete n.generate_focus_keyword,delete n.custom_keyword_prompt,delete n.cw_generation_mode,delete n.rss_feeds,delete n.gsheets_sheet_id,delete n.gsheets_credentials,delete n.url_list,delete n.generate_toc,delete n.generate_images_enabled,delete n.image_provider,delete n.image_model,delete n.image_prompt,delete n.image_count,delete n.image_placement,delete n.image_placement_param_x,delete n.image_alignment,delete n.image_size,delete n.generate_featured_image,delete n.featured_image_prompt,delete n.pexels_orientation,delete n.pexels_size,delete n.pexels_color,delete n.pexels_api_key,delete n.pixabay_orientation,delete n.pixabay_image_type,delete n.pixabay_category,delete n.pixabay_api_key,delete n.replicate_api_key,delete n.enable_vector_store,delete n.vector_store_provider,delete n["openai_vector_store_ids[]"],delete n.openai_vector_store_ids,delete n.pinecone_index_name,delete n.qdrant_collection_name,delete n.vector_embedding_provider,delete n.vector_embedding_model,delete n.vector_store_top_k,delete n.rss_include_keywords,delete n.rss_exclude_keywords),n}window.aipkit_save_task_handleContentWriting=k})();(function(){"use strict";function k(n){let i=(window.aipkit_automated_tasks_config||{}).text||{};if(!n.task_name)return i.task_name_required||"Task name is required.";if(!n.task_category)return i.task_category_required||"Task category is required.";if(!n.task_type)return i.task_type_required||"Task type is required.";if(n.task_type==="content_indexing"){if(!n.target_store_id)return i.target_store_required||"A target vector store/index must be selected.";if(!n.post_types||n.post_types.length===0)return i.content_type_required||"Please select content types for indexing.";if(n.target_store_provider==="pinecone"||n.target_store_provider==="qdrant"){if(!n.embedding_provider)return i.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!n.embedding_model)return i.embedding_model_required||"Embedding model is required for this vector provider."}}if(n.task_type.startsWith("content_writing")){let a=n.cw_generation_mode||"bulk";if(a==="bulk"){if(!n.content_title_bulk?.trim())return i.content_title_required_cw_task||"At least one topic is required for Bulk mode."}else if(a==="csv"){if(!n.content_title?.trim())return i.csv_required_cw_task||"Please upload a CSV file."}else{if(a==="rss"&&!n.rss_feeds?.trim())return i.rss_required_cw_task||"Please add at least one RSS feed.";if(a==="url"&&!n.url_list?.trim())return i.url_required_cw_task||"Please add at least one URL.";if(a==="gsheets"){if(!n.gsheets_sheet_id?.trim())return i.gsheets_id_required_cw_task||"Please add a Google Sheet ID.";if(!n.gsheets_credentials?.trim())return i.gsheets_credentials_required_cw_task||"Please add Google Sheets credentials."}else if(a==="single"&&!n.content_title?.trim())return i.content_title_required_cw_task||"Please add a topic."}if(!n.custom_content_prompt?.trim())return"The Content Prompt cannot be empty.";if(!n.ai_provider||!n.ai_model)return i.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}if(n.task_type==="enhance_existing_content"){if(!n.post_types||n.post_types.length===0)return"Please select at least one post type to update.";if(n.update_title!=="1"&&n.update_excerpt!=="1"&&n.update_content!=="1"&&n.update_meta!=="1")return"Please select at least one field to update (Title, Excerpt, Content, or Meta Description)."}return!0}window.aipkit_save_task_validateData=k})();(function(){"use strict";async function k(n){let e=window.aipkit_automated_tasks_config||{},i={...n,_ajax_nonce:e.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",i)}window.aipkit_save_task_submitRequest=k})();(function(){"use strict";function k(){typeof window.aipkit_clearActiveAutogptPromptDraft=="function"&&window.aipkit_clearActiveAutogptPromptDraft(),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=k})();(function(){"use strict";async function k(n){if(n.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let e=n.target,i=document.getElementById("aipkit_save_task_btn");if(i&&i.dataset.action==="upgrade"){let l=window.aipkit_dashboard?.upgradeUrl;l?window.open(l,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let a=(window.aipkit_automated_tasks_config||{}).text||{},s=a.save_task_button||"Save Task";try{let{formData:l,data:c}=window.aipkit_save_task_extractBaseData(e),o;c.task_type==="content_indexing"?o=window.aipkit_save_task_handleContentIndexing(c,l):c.task_type.startsWith("content_writing")?o=window.aipkit_save_task_handleContentWriting(c,l):c.task_type==="enhance_existing_content"?o=window.aipkit_save_task_handleContentEnhancement(c,l):o=c;let t=window.aipkit_save_task_validateData(o);if(t!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(t,"error"),new Error("Validation failed: "+t);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,s,a.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(a.saving_task||"Saving task...","info");let r=await window.aipkit_save_task_submitRequest(o);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(r.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(l){console.error("Save Task Error:",l),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&l.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${l.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,s)}}window.aipkit_form_handleSaveTask=k})();(function(){"use strict";let k="aipkit_autogpt_prompt_drafts_v1",e={content_writing:["aipkit_task_cw_custom_title_prompt","aipkit_task_cw_custom_content_prompt","aipkit_task_cw_custom_meta_prompt","aipkit_task_cw_custom_keyword_prompt","aipkit_task_cw_custom_excerpt_prompt","aipkit_task_cw_custom_tags_prompt","aipkit_task_cw_image_prompt","aipkit_task_cw_featured_image_prompt","aipkit_task_cw_generate_meta_desc","aipkit_task_cw_generate_focus_keyword","aipkit_task_cw_generate_excerpt","aipkit_task_cw_generate_tags"],enhance_existing_content:["aipkit_task_ce_title_prompt","aipkit_task_ce_excerpt_prompt","aipkit_task_ce_content_prompt","aipkit_task_ce_meta_prompt","aipkit_task_ce_update_title","aipkit_task_ce_update_excerpt","aipkit_task_ce_update_content","aipkit_task_ce_update_meta"],community_reply_comments:["aipkit_task_cc_custom_content_prompt"]},i=new Set(Object.values(e).flat()),a=u=>{let p=String(u||"");return p.startsWith("content_writing")?"content_writing":p==="enhance_existing_content"?"enhance_existing_content":p==="community_reply_comments"?"community_reply_comments":""},s=()=>{try{let u=localStorage.getItem(k);if(!u)return{};let p=JSON.parse(u);return p&&typeof p=="object"?p:{}}catch(u){return console.warn("AutoGPT: failed to load prompt drafts.",u),{}}},l=u=>{try{if(!u||!Object.keys(u).length){localStorage.removeItem(k);return}localStorage.setItem(k,JSON.stringify(u))}catch(p){console.warn("AutoGPT: failed to save prompt drafts.",p)}},c=(u,p)=>{let _=e[p]||[],m={},g=!1;return _.forEach(d=>{let w=u.querySelector(`#${d}`);if(w){if(w.tagName==="SELECT"&&w.multiple){let h=Array.from(w.selectedOptions).map(A=>A.value);m[d]=h;let b=Array.from(w.options).filter(A=>A.defaultSelected).map(A=>A.value);h.join("|")!==b.join("|")&&(g=!0);return}if(w.type==="checkbox"){m[d]=!!w.checked,!!w.checked!=!!w.defaultChecked&&(g=!0);return}m[d]=w.value,String(w.value||"")!==String(w.defaultValue||"")&&(g=!0)}}),{values:m,hasChanges:g}},o=u=>{if(!u||String(u.elements.task_id?.value||"").trim())return;let _=u.elements.task_type?.value||"",m=a(_);if(!m)return;let g=s(),{values:d,hasChanges:w}=c(u,m);if(!w){delete g[m],l(g);return}g[m]={updatedAt:Date.now(),taskType:String(_||""),values:d},l(g)};function t(u={}){let p=document.getElementById("aipkit_automated_task_form");if(!p)return!1;let{isEditing:_=!1,silent:m=!1}=u;if(_||String(p.elements.task_id?.value||"").trim())return!1;let g=p.elements.task_type?.value||"",d=a(g);if(!d)return!1;let w=s(),h=w[d];if(!h||typeof h!="object")return!1;if(typeof h.updatedAt!="number"||Date.now()-h.updatedAt>6048e5)return delete w[d],l(w),!1;let b=String(h.taskType||"");if(d==="content_writing"&&b&&!b.startsWith("content_writing")||d!=="content_writing"&&b&&b!==g)return!1;let A=!1;return Object.entries(h.values||{}).forEach(([S,I])=>{let T=p.querySelector(`#${S}`);if(T){if(T.tagName==="SELECT"&&T.multiple&&Array.isArray(I)){let x=new Set(I.map(String));Array.from(T.options).forEach(E=>{E.selected=x.has(String(E.value))}),T.dispatchEvent(new Event("change",{bubbles:!0})),A=!0;return}if(T.type==="checkbox"){T.checked=!!I,T.dispatchEvent(new Event("change",{bubbles:!0})),A=!0;return}T.value=String(I||""),T.dispatchEvent(new Event("input",{bubbles:!0})),A=!0}}),A&&!m&&typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("Prompt draft restored.","success"),A}function r(){let u=document.getElementById("aipkit_automated_task_form");if(!u)return;let p=u.elements.task_type?.value||"",_=a(p);if(!_)return;let m=s();Object.prototype.hasOwnProperty.call(m,_)&&(delete m[_],l(m))}function f(){let u=document.getElementById("aipkit_automated_task_form"),p=document.getElementById("aipkit_autogpt_task_status_toggle"),_=document.getElementById("aipkit_autogpt_task_status_input"),m=document.getElementById("aipkit_autogpt_task_status_label"),g=document.getElementById("aipkit_autogpt_task_status_card"),d=document.getElementById("aipkit_automated_task_category"),w=document.querySelector("[data-aipkit-autogpt-category-selector]"),h=w?Array.from(w.querySelectorAll(".aipkit_cw_mode_card")):[],b=document.getElementById("aipkit_automated_task_type"),A=document.getElementById("aipkit_cancel_edit_task_btn"),S=document.getElementById("aipkit_automated_task_form_wrapper"),I=document.getElementById("aipkit_automated_task_list_wrapper"),T=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),u&&typeof window.aipkit_form_handleSaveTask=="function"?u.addEventListener("submit",window.aipkit_form_handleSaveTask):u&&console.error("Automated Task Form Init: handleSaveTask function not found."),d&&typeof window.aipkit_form_handleCategoryChange=="function"?d.addEventListener("change",window.aipkit_form_handleCategoryChange):d&&console.error("Automated Task Form Init: handleCategoryChange function not found.");let x=v=>{h.length&&h.forEach(y=>{let C=y.dataset.category===v;y.classList.toggle("is-active",C),y.setAttribute("aria-pressed",C?"true":"false")})};d&&h.length&&(h.forEach(v=>{v.addEventListener("click",()=>{let y=v.dataset.category||"";!y||y===d.value||(d.value=y,d.dispatchEvent(new Event("change",{bubbles:!0})))})}),d.addEventListener("change",()=>{x(d.value)}),x(d.value||"")),b&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(b.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:b})):b&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),A&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?A.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(S,I,T)}):A&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI();let E=()=>{if(!p||!_||!m)return;let v=(_.value||"active")==="active";p.checked=v,m.textContent=v?"Active":"Paused",g&&(g.dataset.status=v?"active":"paused")};if(window.aipkit_syncTaskStatusToggle=E,p&&_&&m&&(p.dataset.statusListenerAttached||(p.addEventListener("change",()=>{_.value=p.checked?"active":"paused",E()}),p.dataset.statusListenerAttached="true"),E()),u&&u.dataset.promptDraftListenerAttached!=="true"){let v=null,y=()=>{v&&clearTimeout(v),v=setTimeout(()=>{v=null,o(u)},250)},C=M=>{let B=M.target;!B||!B.id||!i.has(B.id)||y()};u.addEventListener("input",C),u.addEventListener("change",C),u.dataset.promptDraftListenerAttached="true"}}window.aipkit_restoreAutogptPromptDraft=t,window.aipkit_clearActiveAutogptPromptDraft=r,window.aipkit_form_initAutomatedTaskForm=f})();(function(){"use strict";let k=!1,n=null,e=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return k},set isSubmitting(a){k=a},get pendingModelSelection(){return n},set pendingModelSelection(a){n=a},get pendingEmbeddingModelSelection(){return e},set pendingEmbeddingModelSelection(a){e=a}};function i(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=i})();(function(){"use strict";function k(n,e){n&&(n.classList.toggle("aipkit_loading",!!e),n.disabled=!!e)}window.aipkit_setAutogptActionButtonLoading=k})();(function(){"use strict";function k(n){let e=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_config||{},a=i.text||{},s=window.aipkit_escapeHtml||function(r){return r},l=window.aipkit_ucfirst||function(r){return r?r.charAt(0).toUpperCase()+r.slice(1):""},c=i.frequencies||{},o=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(r=>{r.removeAttribute("data-sort-direction"),o&&r.dataset.sortBy===o.sortBy&&r.setAttribute("data-sort-direction",o.sortOrder.toLowerCase())}),!e){console.warn("Render Tasks Table: Table body not found.");return}if(e.innerHTML="",!n||n.length===0){e.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${a.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}n.forEach(r=>{let f=JSON.parse(r.task_config||"{}"),u=e.insertRow(),p=u.insertCell();p.textContent=s(r.task_name);let _=u.insertCell(),g=(i.task_types?.[r.task_type]||{}).label||l(r.task_type.replace(/_/g," "));_.innerHTML=`<span class="aipkit_task_type_badge" data-type="${s(r.task_type)}">${s(g)}</span>`;let d=f.indexing_frequency||f.task_frequency||"N/A",w=c[d]||l(d.replace(/_/g," "));u.insertCell().textContent=s(w);let h=u.insertCell();h.innerHTML=`<span class="aipkit_job_status_${s(r.status)}">${s(l(r.status))}</span>`;let b=u.insertCell(),A=r.last_run_time?new Date(r.last_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):a.never_run||"Never",S=r.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(r.next_run_time):r.next_run_time?new Date(r.next_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):a.not_scheduled||"Not Scheduled";b.innerHTML=`
        <div class="aipkit_task_timing">
          <div class="aipkit_task_timing_last">
            <span class="aipkit_task_timing_label">${a.last_label||"Last"}</span>
            <span class="aipkit_task_timing_value${r.last_run_time?"":" aipkit_never"}">${s(A)}</span>
          </div>
          <div class="aipkit_task_timing_next">
            <span class="aipkit_task_timing_label">${a.next_label||"Next"}</span>
            <span class="aipkit_task_timing_value">${s(S)}</span>
          </div>
        </div>
      `;let I=u.insertCell();I.className="aipkit_actions_cell",I.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="edit" data-task-id="${r.id}" title="${a.edit_button||"Edit"}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${a.edit_button||"Edit"}</span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="${r.status==="active"?"pause":"resume"}" data-task-id="${r.id}" title="${r.status==="active"?a.pause_button||"Pause":a.resume_button||"Resume"}">
            <span class="dashicons ${r.status==="active"?"dashicons-controls-pause":"dashicons-controls-play"}" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${r.status==="active"?a.pause_button||"Pause":a.resume_button||"Resume"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="run_now" data-task-id="${r.id}" ${r.status!=="active"?"disabled":""} title="${r.status!=="active"?a.task_not_active_run_title||"Task must be active to run":a.run_now_button||"Run Now"}">
            <span class="dashicons dashicons-controls-skipforward" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${a.run_now_button||"Run"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete" data-task-id="${r.id}" title="${a.delete_button||"Delete"}">
            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
          </button>
        </div>
      `})}window.aipkit_list_renderTasksTable=k})();(function(){"use strict";function k(n){let e=document.getElementById("aipkit_automated_task_list_pagination"),a=(window.aipkit_automated_tasks_config||{}).text||{};if(!e){console.warn("Render List Pagination: Pagination container not found.");return}e.innerHTML="";let{total_items:s,total_pages:l,current_page:c}=n||{};if(!l||l<=1){s>0&&(e.innerHTML=`<span class="aipkit_pagination-count">${Number(s).toLocaleString()} ${Number(s)===1?a.task_singular||"task":a.task_plural||"tasks"}</span>`);return}let o=document.createElement("span");o.className="aipkit_pagination-count",o.textContent=`${Number(s).toLocaleString()} ${Number(s)===1?a.task_singular||"task":a.task_plural||"tasks"}`,e.appendChild(o);let t=document.createElement("span");t.className="aipkit_pagination-links";let r=document.createElement("button");r.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",r.innerHTML=`\xAB ${a.previous_button||"Previous"}`,r.disabled=Number(c)<=1,r.disabled||(r.dataset.page=Number(c)-1),t.appendChild(r);let f=document.createElement("span");f.className="aipkit_pagination-current",f.textContent=`${a.page_label||"Page"} ${Number(c)} ${a.of_label||"of"} ${Number(l)}`,t.appendChild(f);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML=`${a.next_button||"Next"} \xBB`,u.disabled=Number(c)>=Number(l),u.disabled||(u.dataset.page=Number(c)+1),t.appendChild(u),e.appendChild(t)}window.aipkit_list_renderListPagination=k})();(function(){"use strict";async function k(n=1){let e=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_list_state,a=window.aipkit_automated_tasks_config||{},s=a.text||{};if(!e){console.warn("Fetch Tasks: Table body not found.");return}e.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${s.loading_tasks||"Loading tasks..."}</td></tr>`,i&&(i.page=n);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let l={page:n,search:i?i.search:"",orderby:i?i.sortBy:"created_at",order:i?i.sortOrder:"DESC",_ajax_nonce:a.nonce_manage_tasks},c=await window.aipkit_apiRequest("aipkit_get_automated_tasks",l);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=c.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(c.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(c.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(l){console.error("Fetch Tasks Error:",l),e.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${s.error_loading_tasks||"Error loading tasks:"} ${l.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=k})();(function(){"use strict";function k(n){if(!n){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),n):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=k})();(function(){"use strict";async function k(n,e){let i=window.aipkit_automated_tasks_config||{},a=i.text||{},s=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!0,a.delete_button||"Delete",a.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:e,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(a.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${a.error_deleting_task||"Error deleting task:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,a.delete_button||"Delete")}},l=a.confirm_delete_task||"Are you sure you want to delete this task?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(l,{title:a.confirm_title||"Confirm",confirmText:a.delete_button||"Delete",cancelText:a.cancel_button||"Cancel",onConfirm:()=>{s()}});return}confirm(l)&&await s()}window.aipkit_handleDeleteTaskAction=k})();(function(){"use strict";async function k(n,e,i){let a=window.aipkit_automated_tasks_config||{},s=a.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(n,!0):(n.classList.add("aipkit_loading"),n.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:e,status:i,_ajax_nonce:a.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${s.task_status_updated||"Task status updated to"} ${i}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(l){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${s.error_updating_status||"Error updating task status:"} ${l.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(n,!1):(n.classList.remove("aipkit_loading"),n.disabled=!1)}}window.aipkit_handleToggleTaskStatusAction=k})();(function(){"use strict";async function k(n,e){let i=window.aipkit_automated_tasks_config||{},a=i.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(n,!0):(n.classList.add("aipkit_loading"),n.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:e,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(a.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(s){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${a.error_initiating_run||"Error initiating task run:"} ${s.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(n,!1):(n.classList.remove("aipkit_loading"),n.disabled=!1)}}window.aipkit_handleRunNowTaskAction=k})();(function(){"use strict";async function k(n){let e=n.target.closest("button[data-action]");if(!e)return;let i=e.dataset.action,a=e.dataset.taskId;if(!a)return;let l=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(c=>c.id.toString()===a.toString());switch(i){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(l);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(e,a);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let c=i==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(e,a,c)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(e,a);break;default:console.warn(`Unknown task action: ${i}`);break}}window.aipkit_list_handleTaskActionClick=k})();(function(){"use strict";function k(n){let e=n.target.closest("button[data-page]");if(e&&!e.disabled){let i=parseInt(e.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(i):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=k})();(function(){"use strict";function k(n,e="info"){if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(n,e);return}let i=document.getElementById("aipkit_automated_task_form_status");i&&(i.textContent=n,i.className=`aipkit_form-help aipkit_settings_message-${e}`,setTimeout(()=>{i.textContent===n&&(i.textContent="",i.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_automated_task_list_wrapper"),e=document.getElementById("aipkit_automated_tasks_tbody"),i=document.getElementById("aipkit_add_new_task_btn"),a=document.getElementById("aipkit_automated_task_form_wrapper"),s=document.getElementById("aipkit_automated_task_list_pagination"),l=document.getElementById("aipkit_task_list_search_input"),c=n?n.querySelector(".aipkit_data-table"):null;if(i&&a&&n&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&i.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(a,n,i)}),e&&typeof window.aipkit_list_handleTaskActionClick=="function"&&e.addEventListener("click",window.aipkit_list_handleTaskActionClick),s&&typeof window.aipkit_list_handleListPaginationClick=="function"&&s.addEventListener("click",window.aipkit_list_handleListPaginationClick),l){let o;l.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(()=>{let t=window.aipkit_automated_tasks_list_state;t&&(t.search=l.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}c&&c.addEventListener("click",o=>{let t=o.target.closest("th.aipkit-sortable-col");if(!t)return;let r=t.dataset.sortBy,f=window.aipkit_automated_tasks_list_state;if(!f)return;let u="DESC";f.sortBy===r&&(u=f.sortOrder==="DESC"?"ASC":"DESC"),f.sortBy=r,f.sortOrder=u,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=k})();(function(){"use strict";let k=[],n=1,e="",i="created_at",a="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...k]},set tasks(l){k=Array.isArray(l)?l:[]},get page(){return n},set page(l){n=l},get search(){return e},set search(l){e=l},get sortBy(){return i},set sortBy(l){i=l},get sortOrder(){return a},set sortOrder(l){a=l}};function s(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=s})();(function(){"use strict";function k(n){let e=document.getElementById("aipkit_automated_task_queue_tbody"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),a=window.aipkit_automated_tasks_config||{},s=a.text||{},l=window.aipkit_escapeHtml||function(f){return f},c=window.aipkit_ucfirst||function(f){return f?f.charAt(0).toUpperCase()+f.slice(1):""},o=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(f=>{f.removeAttribute("data-sort-direction"),o&&f.dataset.sortBy===o.sortBy&&f.setAttribute("data-sort-direction",o.sortOrder.toLowerCase())}),!e){console.warn("Render Queue Table: Table body not found.");return}e.innerHTML="";let r=Array.isArray(n)&&n.length>0;if(i&&(i.disabled=!r,i.setAttribute("aria-disabled",r?"false":"true"),r?i.title=s.delete_filtered_title||"Delete filtered items":i.title=s.queue_empty_delete||"No queue items available to delete."),!r){e.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${s.queue_empty||"Task queue is currently empty."}</td></tr>`;return}n.forEach(f=>{let u=e.insertRow(),p=u.insertCell(),_=document.createElement("textarea");_.innerHTML=f.target_title||`${s.target_id_prefix||"ID:"} ${f.target_identifier}`;let m=_.value,g=f.task_type.startsWith("content_writing"),d=f.task_type==="enhance_existing_content",w=null;g&&f.status==="completed"&&f.generated_post_id?w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${f.generated_post_id}&action=edit`:d&&!isNaN(parseInt(f.target_identifier,10))&&(w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${f.target_identifier}&action=edit`),w?p.innerHTML=`<a href="${w}" target="_blank" title="${l(s.edit_generated_post_title||"View post")}">${l(m)}</a>`:p.textContent=m,u.insertCell().textContent=l(f.task_name||`${s.task_id_prefix||"Task"} ${f.task_id}`);let h=u.insertCell(),b=a.task_types&&a.task_types[f.task_type]?a.task_types[f.task_type].label:c(f.task_type.replace(/_/g," "));h.innerHTML=`<span class="aipkit_task_type_badge" data-type="${l(f.task_type)}">${l(b)}</span>`;let A=u.insertCell(),S=`<span class="aipkit_job_status_${l(f.status)}">${l(c(f.status))}`;f.status==="failed"&&f.attempts>1&&(S+=` <small>(${f.attempts}x)</small>`),S+="</span>",f.status==="failed"&&f.error_message&&(S+=`<span class="aipkit_queue_error_message" title="${l(f.error_message)}">${l(f.error_message)}</span>`),A.innerHTML=S;let I=u.insertCell();if(f.added_at){let E=new Date(f.added_at.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(f.added_at):E,y=`<div class="aipkit_queue_time_entry aipkit_queue_time_added" title="${l(E)}">${l(v)}</div>`;if(f.scheduled_gmt_time){let C=new Date(f.scheduled_gmt_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(f.scheduled_gmt_time):C;y+=`<div class="aipkit_queue_time_entry aipkit_queue_time_scheduled" title="${l(C)}">${l(s.scheduled_for_label||"\u2192")} ${l(M)}</div>`}I.innerHTML=y}else I.textContent=s.not_applicable||"\u2014";let T=u.insertCell();T.className="aipkit_actions_cell";let x='<div class="aipkit-table-actions-group">';f.status==="failed"&&(x+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="retry_queue_item" data-item-id="${f.id}" title="${s.retry_button||"Retry"}"><span class="dashicons dashicons-controls-repeat" aria-hidden="true"></span><span class="aipkit_btn_label">${s.retry_button||"Retry"}</span></button>`),x+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete_queue_item" data-item-id="${f.id}" title="${s.delete_button||"Delete"}"><span class="dashicons dashicons-trash" aria-hidden="true"></span></button>`,x+="</div>",T.innerHTML=x})}window.aipkit_queue_renderQueueTable=k})();(function(){"use strict";function k(n){let e=document.getElementById("aipkit_automated_task_queue_pagination"),a=(window.aipkit_automated_tasks_config||{}).text||{};if(!e){console.warn("Render Queue Pagination: Pagination container not found.");return}e.innerHTML="";let{total_items:s,total_pages:l,current_page:c}=n||{};if(!s||s<=0)return;let o=document.createElement("span");if(o.className="aipkit_pagination-count",o.textContent=`${Number(s).toLocaleString()} ${Number(s)===1?a.item_singular||"item":a.item_plural||"items"}`,e.appendChild(o),l>1){let t=document.createElement("span");t.className="aipkit_pagination-links";let r=document.createElement("button");r.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",r.innerHTML=`\xAB ${a.previous_button||"Previous"}`,r.disabled=Number(c)<=1,r.disabled||(r.dataset.page=Number(c)-1),t.appendChild(r);let f=document.createElement("span");f.className="aipkit_pagination-current",f.textContent=`${a.page_label||"Page"} ${Number(c)} ${a.of_label||"of"} ${Number(l)}`,t.appendChild(f);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML=`${a.next_button||"Next"} \xBB`,u.disabled=Number(c)>=Number(l),u.disabled||(u.dataset.page=Number(c)+1),t.appendChild(u),e.appendChild(t)}}window.aipkit_queue_renderQueuePagination=k})();(function(){"use strict";async function k(n=1){let e=window.aipkit_automated_tasks_queue_state;e?e.page=n:console.warn("Fetch/Render Queue: Queue state object not available.");let i=document.getElementById("aipkit_automated_task_queue_tbody"),a=window.aipkit_automated_tasks_config||{},s=a.text||{};if(!i){console.warn("Fetch/Render Queue: Table body not found.");return}i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${s.loading_queue||"Loading queue items..."}</td></tr>`;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let l={page:n,search:e?e.search:"",status_filter:e?e.status:"all",orderby:e?e.sortBy:"q.added_at",order:e?e.sortOrder:"DESC",_ajax_nonce:a.nonce_manage_tasks},c=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",l);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(c.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(c.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(l){console.error("Fetch/Render Queue Error:",l),i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${s.error_loading_queue||"Error loading queue:"} ${l.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=k})();(function(){"use strict";async function k(n){let e=n.target.closest("button[data-action]");if(!e)return;let i=e.dataset.action,a=e.dataset.itemId;if(!a)return;let s=window.aipkit_automated_tasks_config||{},l=s.text||{},c=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1,o=(t,r)=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(t,r);return}typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(t,r)};if(i==="delete_queue_item"){let t=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!0,l.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:a,_ajax_nonce:s.nonce_manage_tasks}),o(l.queue_item_deleted||"Queue item deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(c)}catch(f){o(`${l.error_deleting_queue_item||"Error deleting item:"} ${f.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,l.delete_button||"Delete")}},r=l.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(r,{title:l.confirm_title||"Confirm",confirmText:l.delete_button||"Delete",cancelText:l.cancel_button||"Cancel",onConfirm:()=>{t()}});return}if(!confirm(r))return;await t()}else if(i==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!0,l.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:a,_ajax_nonce:s.nonce_manage_tasks}),o(l.item_marked_retry||"Item marked for retry. Queue processing will pick it up.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(c)}catch(t){o(`${l.error_retrying_item||"Error retrying item:"} ${t.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,l.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=k})();(function(){"use strict";async function k(){let n=document.getElementById("aipkit_delete_queue_by_status_btn"),e=document.getElementById("aipkit_task_queue_status_filter");if(!n||!e){console.error("Delete by status button or filter dropdown not found.");return}let i=e.value,a=e.options[e.selectedIndex].text.toLowerCase(),s=window.aipkit_automated_tasks_config||{},l=s.text||{},c=i==="all"?l.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(l.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",a),o=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(n,!0,l.delete_button||"Delete",l.deleting_task||"Deleting..."):n.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let t=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:i,_ajax_nonce:s.nonce_manage_tasks});typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(t.message||"Queue items deleted.","success"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(t.message||"Queue items deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(t){let r=`${l.errorDeletingAllItems||"Error deleting items:"} ${t.message||"Unknown error"}`;typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(r,"error"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(r,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(n,!1,l.delete_button||"Delete"):n.disabled=!1}};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(c,{title:l.confirm_title||"Confirm",confirmText:l.delete_button||"Delete",cancelText:l.cancel_button||"Cancel",onConfirm:()=>{o()}});return}confirm(c)&&await o()}window.aipkit_handleDeleteQueueByStatus=k})();(function(){"use strict";function k(n){let e=n.target.closest("button[data-page]");if(e&&!e.disabled){let i=parseInt(e.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(i):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_automated_task_queue_tbody"),e=document.getElementById("aipkit_refresh_task_queue_btn"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),a=document.getElementById("aipkit_automated_task_queue_pagination"),s=document.getElementById("aipkit_task_queue_search_input"),l=document.getElementById("aipkit_task_queue_status_filter"),c=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(e&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&e.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),i&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&i.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),s){let o;s.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(()=>{let t=window.aipkit_automated_tasks_queue_state;t&&(t.search=s.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}l&&l.addEventListener("change",()=>{let o=window.aipkit_automated_tasks_queue_state;o&&(o.status=l.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),c&&c.addEventListener("click",o=>{let t=o.target.closest("th.aipkit-sortable-col");if(!t)return;let r=t.dataset.sortBy,f=window.aipkit_automated_tasks_queue_state;if(!f)return;let u="DESC";f.sortBy===r&&(u=f.sortOrder==="DESC"?"ASC":"DESC"),f.sortBy=r,f.sortOrder=u,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),n&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&n.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),a&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&a.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=k})();(function(){"use strict";let k=1,n="",e="all",i="q.added_at",a="DESC";window.aipkit_automated_tasks_queue_state={get page(){return k},set page(l){k=l},get search(){return n},set search(l){n=l},get status(){return e},set status(l){e=l},get sortBy(){return i},set sortBy(l){i=l},get sortOrder(){return a},set sortOrder(l){a=l}};function s(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=s})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_autogpt_container");if(n&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():n&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),(()=>{if(!n)return;let i=n.querySelector("#aipkit_autogpt_cron_status [data-aipkit-cron-timestamp]");if(!i)return;let a=i.dataset.aipkitCronTimestamp,s=a?parseInt(a,10):0;if(!s||Number.isNaN(s))return;let l=new Date(s*1e3),c=l.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});i.textContent=c,i.title=l.toLocaleString()})(),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(i){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",i)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.");if(typeof window.aipkit_initAutogptPopovers=="function")try{window.aipkit_initAutogptPopovers(n)}catch(i){console.error("AIPKit AutoGPT: Error initializing settings popovers:",i)}if(typeof window.aipkit_updateAutogptAiSummaries=="function")try{window.aipkit_updateAutogptAiSummaries(n)}catch(i){console.error("AIPKit AutoGPT: Error updating AI summaries:",i)}if(typeof window.aipkit_initAutogptAiSettingsRedesigned=="function")try{window.aipkit_initAutogptAiSettingsRedesigned(n)}catch(i){console.error("AIPKit AutoGPT: Error initializing AI settings UI:",i)}if(typeof window.aipkit_initAutogptPromptFlyouts=="function")try{window.aipkit_initAutogptPromptFlyouts(n)}catch(i){console.error("AIPKit AutoGPT: Error initializing prompt flyouts:",i)}typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_autogpt_container"):console.warn("AIPKit AutoGPT: aipkit_initApiKeyToggles not found.")}window.aipkit_initAutogpt=k})();(function(){"use strict";let k=null;function n(c,o="",t=0){let r=document.getElementById("aipkit_content_writer_form_status");if(!r)return;k&&(clearTimeout(k),k=null);let f="aipkit_cw_status_badge",u=(p="")=>{r.className=p?`${f} ${p}`:f};switch(u(),c){case"progress":r.textContent=o,u("aipkit_settings_message-info");break;case"info":r.textContent=o,u("aipkit_settings_message-info");break;case"success":r.textContent=o,u("aipkit_settings_message-success");break;case"error":r.textContent=o,u("aipkit_settings_message-error");break;case"clear":default:r.textContent="",u();return}t&&(k=setTimeout(()=>{r.textContent===o&&e()},t))}function e(){n("clear")}function i(c){n("progress",c)}function a(c,o=3e3){n("info",c,o)}function s(c){n("success",c,3e3)}function l(c){n("error",c)}window.aipkit_updateGeneralStatus=n,window.aipkit_clearGeneralStatus=e,window.aipkit_showProgress=i,window.aipkit_showInfo=a,window.aipkit_showSuccess=s,window.aipkit_showError=l})();(function(){"use strict";window.aipkit_cw_isAutosaving=!1,window.aipkit_cw_lastSavedData=null;function k(){let a=window.aipkit_cw_template_state,s=a?.currentTemplateId;if(!s)return null;let l="";if(Array.isArray(a?.currentTemplates)){let o=a.currentTemplates.find(t=>String(t.id)===String(s));o?.template_name&&(l=o.template_name)}if(!l){let o=document.getElementById("aipkit_cw_template_select");o?.selectedOptions?.length&&(l=o.selectedOptions[0].textContent.trim())}let c=parseInt(s,10);return!l||Number.isNaN(c)?null:{id:c,name:l}}function n(){if(typeof window.aipkit_getContentWriterFormConfig!="function")return null;let a=document.getElementById("aipkit_content_writer_form");return a?window.aipkit_getContentWriterFormConfig(a):null}async function e(){if(window.aipkit_cw_autosave_suspended||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getContentWriterFormConfig!="function"||window.aipkit_cw_isAutosaving)return;let a=window.aipkit_cw_template_state;if(a?.isSavingOrDeleting)return;let s=n();if(!s)return;let l=window.aipkit_cw_lastSavedData||{};if(JSON.stringify(s)===JSON.stringify(l))return;let c=k();if(!c)return;let o=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,t=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,r=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_isAutosaving=!0,o&&o("Saving...");try{let f=document.getElementById("aipkit_content_writer_template_nonce_field");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:c.id,template_name:c.name,template_type:"content_writer",config:JSON.stringify(s),_ajax_nonce:f?f.value:""}),window.aipkit_cw_lastSavedData=s,a&&(a.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(s)),a.currentTemplateModified=!1),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(String(c.id)),t&&t("Updated")}catch(f){r&&r(`Error: ${f.message||"Failed to save."}`),console.error("Content Writer Auto-Save Error:",f)}finally{window.aipkit_cw_isAutosaving=!1}}function i(){let a=n();a&&(window.aipkit_cw_lastSavedData=a)}window.aipkit_handleContentWriterAutoSave=e,window.aipkit_updateContentWriterAutosaveBaseline=i})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_form");if(!n)return;let e="data-aipkit-cw-autosave-attached";n.getAttribute(e)||(n.addEventListener("change",i=>{let a=i.target;if(!a||!a.matches(".aipkit_autosave_trigger"))return;(a.tagName.toLowerCase()==="select"||a.type==="checkbox"||a.type==="range")&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()}),n.addEventListener("blur",i=>{let a=i.target;if(!a||!a.matches(".aipkit_autosave_trigger"))return;let s=a.tagName.toLowerCase();(s==="input"||s==="textarea")&&a.type!=="range"&&a.type!=="checkbox"&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()},!0),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline(),n.setAttribute(e,"true"))}window.aipkit_initContentWriterAutosave=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_container");if(!n){console.warn("Content Writer Accordions: Main container not found.");return}n.dataset.accordionListenerAttached!=="true"&&(n.addEventListener("click",function(e){let i=e.target.closest(".aipkit_accordion-header");if(!i)return;let a=i.closest(".aipkit_accordion");if(!a)return;let s=i.nextElementSibling;if(!s||!s.classList.contains("aipkit_accordion-content"))return;let l=a.closest(".aipkit_accordion-group");if(l&&!i.classList.contains("aipkit_active")){let c=l.querySelector(".aipkit_accordion-header.aipkit_active");if(c){c.classList.remove("aipkit_active");let o=c.nextElementSibling;o&&o.classList.remove("aipkit_active")}}i.classList.toggle("aipkit_active"),s.classList.toggle("aipkit_active")}),n.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(c){return c},n=null,e={title:"Title",content:"Content",image:"Image",meta:"Meta",keyword:"Keyword",tags:"Tags",excerpt:"Excerpt"},i=null;function a(c,o=""){if(n||(n=document.getElementById("aipkit_content_writer_form_status")),!n)return;i&&(clearTimeout(i),i=null),n.textContent=c;let t="aipkit_cw_status_badge";n.className=o?`${t} ${o}`:t}function s(c,o,t=""){let r=e[c]||"Step",f=t?k(t):"";switch(o){case"pending":break;case"generating":a(f||`Generating ${r}...`,"aipkit_settings_message-info");break;case"success":a(`${r} complete`,"aipkit_settings_message-success"),i=setTimeout(()=>{a("")},1400);break;case"error":a(`Error ${r}${f?": "+f:""}`,"aipkit_settings_message-error");break;case"skipped":f&&(a(`${r} skipped: ${f}`,"aipkit_settings_message-info"),i=setTimeout(()=>{a("")},1400));break}let u=document.getElementById(`aipkit_cw_status_${c}_generation`),p=u?u.querySelector(".aipkit_cw_status_icon"):null,_=u?u.querySelector(".status-text"):null;if(!(!u||!p||!_))switch(u.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),u.classList.add(`status-${o}`),o){case"pending":{_.textContent="Pending";let m="dashicons-text-page";c==="content"&&(m="dashicons-admin-post"),c==="image"&&(m="dashicons-format-image"),c==="excerpt"&&(m="dashicons-editor-quote"),c==="tags"&&(m="dashicons-tag"),c==="meta"&&(m="dashicons-search"),c==="keyword"&&(m="dashicons-flag"),p.className=`dashicons ${m} aipkit_cw_status_icon`;break}case"generating":_.textContent=f||"Generating...",p.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":_.textContent="Complete",p.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":_.textContent=`Error ${f?": "+f:""}`,p.className="dashicons dashicons-warning aipkit_cw_status_icon";break;case"skipped":_.textContent="Skipped",p.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function l(){a(""),["title","content","image","meta","keyword","excerpt","tags"].forEach(c=>{s(c,"pending")})}window.aipkit_updateCwGenerationStatus=s,window.aipkit_resetAllGenerationStatuses=l})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_form_status");n&&(n.textContent="",n.className="aipkit_cw_status_badge"),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending"))}window.aipkit_resetGenerationStatusIndicators=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(f){return f},n=window.aipkit_escapeHtml||function(f){return f},e=(f,u)=>(f?.elements?.[u]?.value||"").trim(),i=f=>String(f||"").split(/\r?\n/).map(u=>u.trim()).filter(Boolean),a=f=>f.map(u=>u.split("|")[0].trim()).filter(Boolean),s=f=>{try{let u=new URL(f);return u.protocol==="http:"||u.protocol==="https:"}catch{return!1}},l=f=>{let u=f?.querySelector(".aipkit_gsheets_indicator");return u?u.classList.contains("aipkit_gsheets_indicator--success"):!0};function c(f,u){f&&(f.textContent=u||k("Please review your input.","gpt3-ai-content-generator"),f.id==="aipkit_cw_action_validation"?f.className="aipkit_cw_action_validation":f.className="aipkit_cw_status_badge aipkit_settings_message-error")}function o(f){f&&(f.textContent="",f.id==="aipkit_cw_action_validation"?f.className="aipkit_cw_action_validation":f.className="aipkit_cw_status_badge")}function t(f,u){let p=u||document.getElementById("aipkit_cw_mode_select")?.value||"task";if(p==="single"&&(p="task"),p==="task")return a(i(e(f,"content_title_bulk"))).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one topic.","gpt3-ai-content-generator")};if(p==="csv"){let _=document.getElementById("aipkit_cw_csv_data_holder");return(_?_.value.trim():"")?{isValid:!0}:{isValid:!1,message:k("Please upload and parse a CSV file first.","gpt3-ai-content-generator")}}if(p==="rss")return i(e(f,"rss_feeds")).filter(s).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid RSS feed URL.","gpt3-ai-content-generator")};if(p==="url")return i(e(f,"url_list")).filter(s).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid website URL.","gpt3-ai-content-generator")};if(p==="gsheets"){let _=e(f,"gsheets_sheet_id"),m=e(f,"gsheets_credentials");return!_||!m?{isValid:!1,message:k("Please provide a Google Sheet ID and credentials.","gpt3-ai-content-generator")}:l(f)?{isValid:!0}:{isValid:!1,message:k("Verify access before generating.","gpt3-ai-content-generator")}}return{isValid:!0}}async function r(f,u,p){let _=new FormData(f),m=Object.fromEntries(_.entries()),g=f.elements["openai_vector_store_ids[]"];m.openai_vector_store_ids=g?Array.from(g.selectedOptions).map(T=>T.value):[],delete m["openai_vector_store_ids[]"];let d=window.aipkit_dashboard?.text||{},w=document.getElementById("aipkit_cw_mode_select"),h=w?w.value:"task";h==="single"&&(h="task"),m.cw_generation_mode=h;let b=document.getElementById("aipkit_cw_action_validation"),A=t(f,h);if(!A.isValid){let T=p||b;c(T,A.message),T!==b&&o(b);return}if(o(p),o(b),h==="csv"){let T=document.getElementById("aipkit_cw_csv_data_holder");m.content_title=T?T.value:""}else h==="url"?(m.url_list=f.elements.url_list?.value||"",m.content_title=m.url_list):h==="task"&&(m.content_title=f.elements.content_title_bulk?f.elements.content_title_bulk.value:"");delete m.content_title_bulk,delete m.content_title_csv;let S=document.getElementById("aipkit_cw_template_select"),I="";if(S&&S.selectedIndex>0){let T=S.options[S.selectedIndex];T&&(I=T.text)}if(I&&I.trim()!=="")m.task_name=I.trim();else{let T=(m.content_title||m.rss_feeds||m.gsheets_sheet_id||m.url_list||"").split(`
`)[0].trim();m.task_name=T||"Automated Content Writing Task"}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(u,!0,"Create Task","Creating Task..."):(u.disabled=!0,u.textContent="Creating Task..."),p&&(p.textContent="Creating automated task...",p.className="aipkit_cw_status_badge aipkit_settings_message-info");try{let T=document.getElementById("aipkit_content_writer_nonce");if(m._ajax_nonce=T?T.value:"",!m._ajax_nonce)throw new Error("Security token missing for task creation.");let x=await window.aipkit_apiRequest("aipkit_content_writer_create_task",m);p&&(p.textContent="",p.className="aipkit_cw_status_badge"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("autogpt"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("autogpt",{aipkit_force_refresh:!0})}catch(T){console.error("Content Writer Create Task Error:",T),p&&(p.textContent=`Error creating task: ${n(T.message||"Unknown error")}`,p.className="aipkit_cw_status_badge aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(u,!1,"Create Task"):(u.disabled=!1,u.textContent="Create Task")}}window.aipkit_createContentWriterTask=r,window.aipkit_validateContentWriterInputs=t,window.aipkit_showContentWriterValidationError=c,window.aipkit_clearContentWriterValidationMessage=o})();(function(){"use strict";let k=()=>{let p=document.getElementById("aipkit_cw_mode_select"),_=p?p.value:"task";return _==="single"?"task":_},n=()=>{let p=k();return p==="task"||p==="csv"},e=p=>{!p?.frequencySelect||!p.frequencySelect.querySelector('option[value="one-time"]')||p.frequencySelect.value!=="one-time"&&(p.frequencySelect.value="one-time",p.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})))},i=()=>{let p=document.getElementById("aipkit_content_writer_container");if(!p)return null;let _=p.querySelector(".aipkit_cw_generate_split");if(!_)return null;let m=_.querySelector("#aipkit_content_writer_generate_btn"),g=_.querySelector(".aipkit_cw_generate_toggle"),d=_.querySelector(".aipkit_cw_generate_menu"),w=d?d.querySelector('[data-menu-panel="actions"]'):null,h=d?d.querySelector('[data-menu-panel="intervals"]'):null,b=w?Array.from(w.querySelectorAll("[data-action]")):[],A=h?Array.from(h.querySelectorAll("[data-interval]")):[],S=h?h.querySelector("[data-menu-back]"):null,I=p.querySelector("#aipkit_cw_task_frequency");return{container:p,split:_,generateBtn:m,toggleBtn:g,menu:d,menuActions:w,menuIntervals:h,actionItems:b,intervalItems:A,backBtn:S,frequencySelect:I}},a=p=>{!p?.menu||!p?.toggleBtn||(p.menu.hidden=!0,p.toggleBtn.setAttribute("aria-expanded","false"))},s=p=>{if(!p?.menu||!p?.split)return;let _=p.menu,m=p.split.getBoundingClientRect(),g=window.innerWidth,d=12;_.style.position="fixed",_.style.right="auto",_.style.bottom="auto",_.style.zIndex="100000",_.style.visibility="hidden";let w=_.getBoundingClientRect(),h=m.right-w.width;h=Math.max(d,Math.min(h,g-w.width-d));let b=m.bottom+6;_.style.left=`${Math.round(h)}px`,_.style.top=`${Math.round(b)}px`,_.style.visibility="visible"},l=p=>{!p?.menu||!p?.toggleBtn||(p.menu.hidden=!1,s(p),p.toggleBtn.setAttribute("aria-expanded","true"))},c=(p,_)=>{if(!p?.menuActions||!p?.menuIntervals)return;let m=_==="intervals";p.menuActions.hidden=m,p.menuIntervals.hidden=!m},o=(p,_)=>{p&&(p.split.dataset.aipkitCwAction=_||"generate",p.actionItems.forEach(m=>{let g=m.dataset.action===_;m.classList.toggle("is-active",g),m.setAttribute("aria-checked",g?"true":"false")}))},t=p=>{if(!p?.frequencySelect)return;let _=p.frequencySelect.value||p.frequencySelect.options[0]?.value||"";p.intervalItems.forEach(m=>{let g=m.dataset.interval===_;m.classList.toggle("is-active",g),m.setAttribute("aria-checked",g?"true":"false")})},r=(p,_)=>{p?.frequencySelect&&(p.frequencySelect.value=_,p.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})),t(p),a(p),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState())},f=p=>{let _=i();if(!_)return;let m=p||"generate",g=m==="create_task"&&n();if(g&&e(_),o(_,m),typeof window.aipkit_updateContentWriterActionState=="function"&&(_.menu&&m==="create_task"&&!g&&(_.menu.dataset.keepOpen="true"),window.aipkit_updateContentWriterActionState()),m==="create_task"&&_.menuIntervals&&!g){c(_,"intervals"),t(_),l(_);return}c(_,"actions"),a(_),g&&m==="create_task"&&_.generateBtn&&setTimeout(()=>{_.generateBtn.click()},0)},u=()=>{let p=i();p&&p.split.dataset.listenerAttached!=="true"&&(p.split.dataset.aipkitCwAction||(p.split.dataset.aipkitCwAction="generate"),o(p,p.split.dataset.aipkitCwAction),t(p),p.toggleBtn&&p.toggleBtn.addEventListener("click",_=>{if(_.preventDefault(),p.toggleBtn.disabled)return;(p.split.dataset.aipkitCwAction||"generate")==="create_task"&&!n()?(c(p,"intervals"),t(p)):c(p,"actions"),p.menu&&p.menu.hidden?l(p):a(p)}),p.actionItems.forEach(_=>{_.addEventListener("click",m=>{m.preventDefault(),!_.disabled&&f(_.dataset.action||"generate")})}),p.intervalItems.forEach(_=>{_.addEventListener("click",m=>{m.preventDefault(),!_.disabled&&r(p,_.dataset.interval||"")})}),p.backBtn&&p.backBtn.addEventListener("click",_=>{_.preventDefault(),c(p,"actions"),l(p)}),document.addEventListener("click",_=>{let m=_.target;!p.menu||p.menu.hidden||p.split.contains(m)||a(p)}),document.addEventListener("keydown",_=>{_.key==="Escape"&&(!p.menu||p.menu.hidden||a(p))}),p.split.dataset.listenerAttached="true")};window.aipkit_initContentWriterGenerateMenu=u,window.aipkit_setCwGenerateAction=f,window.aipkit_getCwGenerateAction=()=>i()?.split?.dataset.aipkitCwAction||"generate"})();(function(){"use strict";let k=window.wp?.i18n?.__||function(L){return L},n=100,e=[{key:"write",label:k("Writing","gpt3-ai-content-generator"),steps:["title","content"],isEnabled:()=>!0},{key:"optimize",label:k("Optimizing","gpt3-ai-content-generator"),steps:["meta","focus","excerpt","tags"],isEnabled:L=>L.generateMeta||L.generateFocus||L.generateExcerpt||L.generateTags},{key:"publish",label:k("Publishing","gpt3-ai-content-generator"),steps:["image","featured","save"],isEnabled:()=>!0}],i={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Running","gpt3-ai-content-generator"),done:k("Done","gpt3-ai-content-generator"),skipped:k("Skipped","gpt3-ai-content-generator"),error:k("Error","gpt3-ai-content-generator")},a=[{key:"title",label:k("Title","gpt3-ai-content-generator"),isEnabled:L=>!!L.customTitlePrompt},{key:"content",label:k("Content","gpt3-ai-content-generator"),isEnabled:()=>!0},{key:"meta",label:k("Meta","gpt3-ai-content-generator"),isEnabled:L=>L.generateMeta},{key:"focus",label:k("Focus","gpt3-ai-content-generator"),isEnabled:L=>L.generateFocus},{key:"excerpt",label:k("Excerpt","gpt3-ai-content-generator"),isEnabled:L=>L.generateExcerpt},{key:"tags",label:k("Tags","gpt3-ai-content-generator"),isEnabled:L=>L.generateTags},{key:"image",label:k("Image","gpt3-ai-content-generator"),isEnabled:L=>L.generateImages},{key:"featured",label:k("Featured","gpt3-ai-content-generator"),isEnabled:L=>L.generateFeatured},{key:"save",label:k("Save","gpt3-ai-content-generator"),isEnabled:()=>!0}],s={active:!1,stopRequested:!1,items:[],rows:[],totals:{processed:0,completed:0,failed:0}},l=(L,F)=>({customTitlePrompt:String(L.custom_title_prompt||"").trim(),generateMeta:L.generate_meta_description==="1",generateFocus:L.generate_focus_keyword==="1",generateExcerpt:L.generate_excerpt==="1",generateTags:L.generate_tags==="1",generateImages:F.generate_images_enabled==="1",generateFeatured:F.generate_featured_image==="1"}),c=L=>{let F={};return a.forEach(N=>{F[N.key]=N.isEnabled(L)?"waiting":"skipped"}),F},o=(L,F)=>{let N=document.createElement("span");N.className=`aipkit_cw_batch_step aipkit_cw_batch_step--${F}`,N.dataset.step=L.key,N.dataset.status=F;let R=document.createElement("span");R.className="aipkit_cw_batch_step_label",R.textContent=L.label;let H=document.createElement("span");return H.className="aipkit_cw_batch_step_status",H.textContent=i[F]||F,N.appendChild(R),N.appendChild(H),{wrapper:N,status:H}},t=(L,F,N)=>{b(L,F,N)},r=L=>{L?.phases&&Object.keys(L.phases).forEach(F=>{let N=L.phases[F],R=N.dataset.status;R==="done"||R==="skipped"||(N.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",N.dataset.status="error")})},f=()=>{let L=document.getElementById("aipkit_content_writer_container");if(!L)return null;let F=L.querySelector("#aipkit_cw_batch_queue"),N=F?F.querySelector(".aipkit_cw_batch_list"):null,R=F?F.querySelector(".aipkit_cw_batch_count"):null,H=F?F.querySelector(".aipkit_cw_batch_progress"):null,K=F?F.querySelector(".aipkit_cw_batch_progress_bar"):null,re=L.querySelector("#aipkit_content_writer_form_status"),ve=L.querySelector("#aipkit_content_writer_generate_btn"),Ie=L.querySelector(".aipkit_cw_generate_toggle"),Ee=L.querySelector(".aipkit_cw_generate_menu"),Z=Ee?Array.from(Ee.querySelectorAll(".aipkit_cw_generate_menu_item")):[],pe=L.querySelector("#aipkit_content_writer_stop_btn");return{container:L,queue:F,list:N,count:R,progress:H,progressBar:K,status:re,generateBtn:ve,generateToggle:Ie,generateMenu:Ee,generateMenuItems:Z,stopBtn:pe}},u=()=>{s.totals.processed=0,s.totals.completed=0,s.totals.failed=0},p=()=>{let L=f();if(!L||!L.count||!L.progressBar||!L.progress)return;let F=s.items.length,N=s.totals.completed;L.count.textContent=`${N}/${F}`;let R=F>0?Math.round(N/F*100):0;L.progressBar.style.width=`${R}%`,L.progress.setAttribute("aria-valuenow",String(R))},_=(L,F)=>{let N=f();!N||!N.status||(N.status.textContent=L||"",N.status.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),F&&N.status.classList.add(`aipkit_settings_message-${F}`))},m=()=>{let L=f();!L||!L.list||(L.list.innerHTML="",s.rows=[],s.items=[],u(),p())},g=()=>{let L=f();L?.queue&&(L.queue.hidden=!1)},d=()=>{let L=f();L?.queue&&(L.queue.hidden=!0)},w=(L,F)=>{let N=document.createElement("div");N.className="aipkit_cw_batch_row";let R=document.createElement("div");R.className="aipkit_cw_batch_row_content";let H=document.createElement("span");H.className="aipkit_cw_batch_topic",H.textContent=L.topic||"";let K=document.createElement("div");K.className="aipkit_cw_batch_phases";let re={},ve=c(F),Ie={};e.forEach(de=>{let ae=de.steps.some(ye=>{let Me=a.find(nt=>nt.key===ye);return Me&&Me.isEnabled(F)});if(!de.isEnabled(F)&&!ae)return;let ne=document.createElement("span");ne.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--waiting",ne.dataset.phase=de.key,ne.dataset.status="waiting",ne.setAttribute("title",de.label),ne.setAttribute("aria-label",de.label),K.appendChild(ne),re[de.key]=ne,de.steps.forEach(ye=>{Ie[ye]={wrapper:ne,phaseKey:de.key,status:{textContent:""}}})});let Ee=document.createElement("span");Ee.className="aipkit_cw_batch_status aipkit_cw_batch_status--waiting",Ee.textContent=k("Waiting","gpt3-ai-content-generator");let Z=document.createElement("span");Z.className="aipkit_cw_batch_error",Z.hidden=!0;let pe=document.createElement("a");pe.className="aipkit_cw_batch_view",pe.textContent=k("View","gpt3-ai-content-generator"),pe.target="_blank",pe.rel="noopener noreferrer",pe.hidden=!0;let we=document.createElement("span");return we.className="aipkit_cw_batch_summary_text",R.appendChild(H),R.appendChild(K),R.appendChild(Ee),R.appendChild(Z),R.appendChild(pe),N.appendChild(R),{row:N,topic:H,summary:we,status:Ee,error:Z,view:pe,phases:re,steps:Ie}},h=L=>{let F=a.find(N=>N.key===L);return F?F.label:L},b=(L,F,N)=>{if(!L?.phases)return;let R=e.find(K=>K.steps.includes(F));if(!R)return;let H=L.phases[R.key];H&&(N==="running"?(H.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--running",H.dataset.status="running",L.status&&(L.status.textContent=`${R.label} \xB7 ${h(F)}`)):N==="done"?(H.dataset.status==="running"||F===R.steps[R.steps.length-1])&&(H.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",H.dataset.status="done"):N==="error"&&(H.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",H.dataset.status="error"))},A=(L,F)=>{let N=f();!N||!N.list||(N.list.innerHTML="",s.rows=L.map(R=>{let H=w(R,F);return N.list.appendChild(H.row),H}))},S=(L,F,N={})=>{if(!L)return;L.row.classList.toggle("is-active",F==="running"),L.status.className=`aipkit_cw_batch_status aipkit_cw_batch_status--${F}`;let R={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Generating","gpt3-ai-content-generator"),success:k("Done","gpt3-ai-content-generator"),error:k("Failed","gpt3-ai-content-generator"),stopped:k("Stopped","gpt3-ai-content-generator")};if(L.status.textContent=R[F]||F,L.error&&(L.error.hidden=!0,L.error.textContent="",L.error.removeAttribute("title")),F==="success"&&L.phases&&Object.keys(L.phases).forEach(H=>{let K=L.phases[H];K.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",K.dataset.status="done"}),N.summary!==void 0&&(L.summary.textContent=N.summary||""),N.viewLink?(L.view.href=N.viewLink,L.view.hidden=!1):F!=="success"&&(L.view.hidden=!0),F==="error"&&L.error){let H=T(N.summary);H&&(L.error.textContent=H,L.error.title=I(N.summary),L.error.hidden=!1)}},I=L=>String(L||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),T=L=>{let F=I(L);return F?F.length>140?`${F.slice(0,137)}\u2026`:F:""},x=(L,F)=>{let N=I(F||L);return N?N.length>140?`${N.slice(0,140)}\u2026`:N:""},E=L=>{let F=new FormData(L),N=Object.fromEntries(F.entries()),R=L.elements["openai_vector_store_ids[]"];N.openai_vector_store_ids=R?Array.from(R.selectedOptions).map(K=>K.value):[],delete N["openai_vector_store_ids[]"];let H=document.getElementById("aipkit_content_writer_nonce");return H&&H.value&&(N._ajax_nonce=H.value),N},v=L=>{let F=L.elements["post_categories[]"],N=F?Array.from(F.selectedOptions).map(H=>H.value):[],R=L.querySelector('input[name="schedule_mode"]:checked')?.value||"immediate";return{ai_provider:L.elements.ai_provider?.value||"",ai_model:L.elements.ai_model?.value||"",ai_temperature:L.elements.ai_temperature?.value||"",reasoning_effort:L.elements.reasoning_effort?.value||"",cw_generation_mode:L.elements.cw_generation_mode?.value||"",post_type:L.elements.post_type?.value||"post",post_author:L.elements.post_author?.value||"",post_status:L.elements.post_status?.value||"draft",post_schedule_date:L.elements.post_schedule_date?.value||"",post_schedule_time:L.elements.post_schedule_time?.value||"",schedule_mode:R,smart_schedule_start_datetime:L.elements.smart_schedule_start_datetime?.value||"",smart_schedule_interval_value:L.elements.smart_schedule_interval_value?.value||"",smart_schedule_interval_unit:L.elements.smart_schedule_interval_unit?.value||"",post_categories:N,generate_toc:L.elements.generate_toc?.checked?"1":"0",generate_seo_slug:L.elements.generate_seo_slug?.checked?"1":"0",generate_images_enabled:L.elements.generate_images_enabled?.checked?"1":"0",generate_featured_image:L.elements.generate_featured_image?.checked?"1":"0",image_provider:L.elements.image_provider?.value||"",image_model:L.elements.image_model?.value||"",image_prompt:L.elements.image_prompt?.value||"",featured_image_prompt:L.elements.featured_image_prompt?.value||"",image_count:L.elements.image_count?.value||"1",image_placement:L.elements.image_placement?.value||"after_first_h2",image_placement_param_x:L.elements.image_placement_param_x?.value||"",image_alignment:L.elements.image_alignment?.value||"none",image_size:L.elements.image_size?.value||"large",pexels_orientation:L.elements.pexels_orientation?.value||"",pexels_size:L.elements.pexels_size?.value||"",pexels_color:L.elements.pexels_color?.value||"",pixabay_orientation:L.elements.pixabay_orientation?.value||"",pixabay_image_type:L.elements.pixabay_image_type?.value||"",pixabay_category:L.elements.pixabay_category?.value||"",generate_image_title:L.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:L.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:L.elements.generate_image_caption?.checked?"1":"0",generate_image_description:L.elements.generate_image_description?.checked?"1":"0",image_title_prompt:L.elements.image_title_prompt?.value||"",image_alt_text_prompt:L.elements.image_alt_text_prompt?.value||"",image_caption_prompt:L.elements.image_caption_prompt?.value||"",image_description_prompt:L.elements.image_description_prompt?.value||""}},y=(L,F)=>{let N=F.content_title||F.topic||"",R=F.inline_keywords||F.keywords||"",H=R?`${N} | ${R}`:N,K={...L,content_title:H};return F.rss_description&&(K.rss_description=F.rss_description),F.source_url&&(K.source_url=F.source_url),F.url_content_context&&(K.url_content_context=F.url_content_context),{data:K,topic:N,keywords:R}},C=(L,F,N,R,H,K,re)=>({original_topic:F,final_title:N,post_title:N,keywords:R,excerpt:H||"",image_provider:L.image_provider,image_model:L.image_model,image_prompt:L.image_prompt,image_alignment:L.image_alignment,image_size:L.image_size,featured_image_prompt:L.featured_image_prompt,pexels_orientation:L.pexels_orientation,pexels_size:L.pexels_size,pexels_color:L.pexels_color,pixabay_orientation:L.pixabay_orientation,pixabay_image_type:L.pixabay_image_type,pixabay_category:L.pixabay_category,generate_image_title:L.generate_image_title,generate_image_alt_text:L.generate_image_alt_text,generate_image_caption:L.generate_image_caption,generate_image_description:L.generate_image_description,image_title_prompt:L.image_title_prompt,image_alt_text_prompt:L.image_alt_text_prompt,image_caption_prompt:L.image_caption_prompt,image_description_prompt:L.image_description_prompt,ai_provider:L.ai_provider,ai_model:L.ai_model,ai_temperature:L.ai_temperature,reasoning_effort:L.reasoning_effort,cw_generation_mode:L.cw_generation_mode,_ajax_nonce:K,generate_images_enabled:L.generate_images_enabled,image_count:L.image_count,generate_featured_image:L.generate_featured_image,image_placement:L.image_placement,image_placement_param_x:L.image_placement_param_x,conversation_uuid:re}),M=(L,F,N,R,H,K,re)=>{let ve=window.aipkit_getMarkdownRenderer?window.aipkit_getMarkdownRenderer():null,Ie=ve?ve.render(R):R,Ee=Array.isArray(F.post_categories)&&F.post_categories.length?F.post_categories:L.post_categories;return{post_title:N,post_content:Ie,generated_excerpt:H.excerpt||"",generated_tags:H.tags||"",meta_description:H.meta_description||"",focus_keyword:H.focus_keyword||"",post_type:F.post_type||L.post_type,post_author:F.post_author||L.post_author,post_status:L.post_status,post_schedule_date:F.post_schedule_date||L.post_schedule_date,post_schedule_time:F.post_schedule_time||L.post_schedule_time,post_categories:Ee,generate_toc:L.generate_toc,generate_seo_slug:L.generate_seo_slug,image_data:K?JSON.stringify(K):"",image_alignment:L.image_alignment,image_size:L.image_size,_ajax_nonce:re}},B=async(L,F,N,R,H)=>{let K=L.item_config||{},{data:re,topic:ve,keywords:Ie}=y(F,K),Ee=ve,Z=re.conversation_uuid||void 0;if(!!String(re.custom_title_prompt||"").trim()){t(R,"title","running");let nt=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",{...re,conversation_uuid:Z});if(!nt?.new_title)throw new Error(k("Title generation failed","gpt3-ai-content-generator"));Ee=nt.new_title,Z=nt.conversation_uuid||Z,t(R,"title","done")}else t(R,"title","skipped");t(R,"content","running");let de=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",{...re,conversation_uuid:Z});if(!de?.content)throw new Error(k("Content generation failed","gpt3-ai-content-generator"));t(R,"content","done"),Z=de.conversation_uuid||Z||void 0,t(R,"meta",H.generateMeta?"done":"skipped"),t(R,"focus",H.generateFocus?"done":"skipped"),t(R,"excerpt",H.generateExcerpt?"done":"skipped"),t(R,"tags",H.generateTags?"done":"skipped");let ae=null;if(N.generate_images_enabled==="1"||N.generate_featured_image==="1"){H.generateImages&&t(R,"image","running"),H.generateFeatured&&t(R,"featured","running");let nt=de.focus_keyword||Ie||F.content_keywords||"",se=C(N,ve,Ee,nt,de.excerpt||"",F._ajax_nonce,Z),be=N.generate_images_enabled==="1",xe=N.generate_featured_image==="1",Re=be&&xe,De=async(ze={})=>{let Ze=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...se,...ze});if(!Ze?.image_data)throw new Error(k("Image generation failed","gpt3-ai-content-generator"));return Ze.image_data};if(Re){let ze=null,Ze=it=>{ze||(ze={...it,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(be){let it=await De({generate_featured_image:"0"});Ze(it),Array.isArray(it.in_content_images)&&ze.in_content_images.push(...it.in_content_images),H.generateImages&&t(R,"image","done")}if(xe){let it=await De({generate_images_enabled:"0",image_count:0});Ze(it),it.featured_image_id&&(ze.featured_image_id=it.featured_image_id),it.featured_image_url&&(ze.featured_image_url=it.featured_image_url),H.generateFeatured&&t(R,"featured","done")}ae=ze}else ae=await De(),H.generateImages&&t(R,"image","done"),H.generateFeatured&&t(R,"featured","done")}else t(R,"image","skipped"),t(R,"featured","skipped");t(R,"save","running");let ye=M(N,K,Ee,de.content,de,ae,F._ajax_nonce),Me=await window.aipkit_apiRequest("aipkit_content_writer_save_post",ye);return t(R,"save","done"),{summary:x(de.content,de.excerpt),viewLink:Me.view_link||Me.edit_link}},D=()=>{let L=f();s.active=!1,s.stopRequested=!1,L?.generateBtn&&(typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():L.generateBtn.disabled=!1,L.generateBtn.removeAttribute("aria-disabled")),L?.generateToggle&&(L.generateToggle.disabled=!1,L.generateToggle.removeAttribute("aria-disabled")),L?.generateMenuItems?.length&&L.generateMenuItems.forEach(F=>{F.disabled=!1,F.removeAttribute("aria-disabled")}),L?.stopBtn&&(L.stopBtn.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()},W=()=>{s.active&&(s.stopRequested=!0,_(k("Stopping...","gpt3-ai-content-generator"),"info"))},U=L=>{s.items.slice(L).forEach((F,N)=>{let R=s.rows[L+N];S(R,"stopped")})},J=async()=>{for(let N=0;N<s.items.length;N+=1){if(s.stopRequested){U(N);break}let R=s.rows[N];S(R,"running");try{let H=await B(s.items[N],s.baseData,s.postConfig,R,s.stepContext);S(R,"success",H),s.totals.completed+=1}catch(H){r(R),S(R,"error",{summary:H?.message||k("Failed","gpt3-ai-content-generator")}),s.totals.failed+=1}s.totals.processed+=1,p()}let L=s.items.length,F=s.totals.completed;s.stopRequested?_(k("Generation stopped.","gpt3-ai-content-generator"),"error"):_(`${F}/${L} ${k("completed","gpt3-ai-content-generator")}`,"success"),D()},oe=async(L,F)=>{if(!L||!F)return;if(!window.aipkit_apiRequest){console.error("Batch generation: aipkit_apiRequest not available.");return}let N=f();if(!N?.generateBtn)return;if(s.active){_(k("Generation already in progress.","gpt3-ai-content-generator"),"info");return}let R=E(L),H=v(L),K=l(R,H);try{s.active=!0,s.stopRequested=!1,u(),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(N.generateBtn,!0,k("Generate","gpt3-ai-content-generator"),k("Preparing\u2026","gpt3-ai-content-generator")):N.generateBtn.disabled=!0,N.queue&&(N.queue.dataset.cwMode=F),_(k("Preparing items\u2026","gpt3-ai-content-generator"),"info");let re=await window.aipkit_apiRequest("aipkit_content_writer_prepare_batch",{...R,cw_generation_mode:F}),ve=Array.isArray(re.items)?re.items:[];if(!ve.length){_(k("No items found to generate.","gpt3-ai-content-generator"),"error"),D();return}m(),s.items=ve.slice(0,n),s.baseData=R,s.postConfig=H,s.stepContext=K,A(s.items,K),g(),p(),_(k("Generating content\u2026","gpt3-ai-content-generator"),"info"),await J()}catch(re){_(re?.message||k("Batch generation failed.","gpt3-ai-content-generator"),"error"),D()}},O=()=>{s.active=!1,s.stopRequested=!1,m(),d()};window.aipkit_cw_handleBatchGeneration=oe,window.aipkit_cw_resetBatchQueue=O,window.aipkit_cw_requestBatchStop=W,window.aipkit_cw_isBatchActive=()=>s.active===!0})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},n=window.wp?.i18n?.__||function(i){return i};function e(i,a){let s=i.value,l=s?s.toLowerCase():"",c=window.aipkit_dashboard?.models;if(!a){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!c){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),a.innerHTML='<option value="">'+k("Error: Model data object not found")+"</option>",a.disabled=!0;return}let o=c[l];(typeof o>"u"||o===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${l}'. Defaulting to empty.`),o=l==="openai"?{}:[]),a.innerHTML="";let t=window.aipkit_dashboard?.recommendedModels?.[l]||[],r=Array.isArray(t)?t:[],f=new Set(r.map(u=>u?.id).filter(Boolean));if(l==="openai"&&typeof o=="object"&&!Array.isArray(o)){if(r.length>0){let u=document.createElement("optgroup");u.label=k(n("Recommended","gpt3-ai-content-generator")),r.forEach(p=>{if(p&&typeof p=="object"&&p.id){let _=new Option(k(p.name||p.id),p.id);u.appendChild(_)}}),u.children.length>0&&a.appendChild(u)}Object.keys(o).forEach(u=>{let p=document.createElement("optgroup");p.label=k(u);let _=o[u];Array.isArray(_)?_.forEach(m=>{if(!(m&&typeof m=="object"&&m.id&&f.has(m.id)))if(m&&typeof m=="object"&&m.id){let g=new Option(k(m.name||m.id),m.id);p.appendChild(g)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${u}':`,m)}):console.warn(`Content Writer Model Populator: Items for group '${u}' under '${l}' is not an array.`),p.children.length>0&&a.appendChild(p)})}else if(Array.isArray(o)){if(r.length>0){let p=document.createElement("optgroup");p.label=k(n("Recommended","gpt3-ai-content-generator")),r.forEach(_=>{if(_&&typeof _=="object"&&_.id){let m=new Option(k(_.name||_.id),_.id);p.appendChild(m)}}),p.children.length>0&&a.appendChild(p)}let u=r.length>0?document.createElement("optgroup"):null;u&&(u.label=k(n("All models","gpt3-ai-content-generator"))),o.forEach(p=>{if(!(p&&typeof p=="object"&&p.id&&f.has(p.id)))if(p&&typeof p=="object"&&p.id){let _=new Option(k(p.name||p.id),p.id);u?u.appendChild(_):a.appendChild(_)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${l}':`,p)}),u&&u.children.length>0&&a.appendChild(u)}else console.warn(`Content Writer Model Populator: Data for provider '${l}' is not in expected format. Actual type: ${typeof o}`),a.appendChild(new Option(k(`No models for ${s} (Format Error)`),""));if(!a.options||typeof a.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),a.appendChild(new Option(k("Error loading models"),"")),a.disabled=!0;else if(a.options.length===0)a.appendChild(new Option(k(`No models for ${s} (Sync in settings)`),"")),a.disabled=!0;else{a.disabled=!1;let u=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let p=window.aipkit_cw_template_state.pendingModelSelection;a.querySelector(`option[value="${CSS.escape(p)}"]`)?u=p:console.warn(`Content Writer Model Populator: Pending model '${p}' not found in new list for provider '${s}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(u===null){let p=a.querySelector("optgroup");p&&p.options&&p.options.length>0&&p.options[0].value?u=p.options[0].value:a.options&&a.options.length>0&&a.options[0].value?u=a.options[0].value:u=""}a.value=u}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let u=document.getElementById("aipkit_content_writer_container");u&&window.aipkit_cw_toggleReasoningEffort(u)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}window.aipkit_populateModelsForContentWriter=e})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(f){return f},n=f=>f&&f!=="single"?f:"task",e=f=>typeof f=="string"&&f.startsWith("existing"),i=f=>f==="existing"?"existing-content":f,a={"existing-images":{title:{label:"Image Title",desc:"Optimize attachment title"},content:{label:"Description",desc:"Update image description"},excerpt:{label:"Caption",desc:"Short image caption"},keyword:{label:"Alt Text",desc:"Describe the image for accessibility"}},"existing-products":{title:{label:"Product Title",desc:"Generate product headline"},content:{label:"Product Description",desc:"Generate main product description"},meta:{label:"Meta Description",desc:"SEO meta for product pages"},keyword:{label:"Focus Keyword",desc:"Primary keyword for product SEO"},excerpt:{label:"Short Description",desc:"Short summary of the product"},tags:{label:"Tags",desc:"Auto-generate product tags"}}},s=f=>{let u=document.getElementById("aipkit_content_writer_container");if(!u)return;let p=u.querySelectorAll(".aipkit_prompt_toggle_card[data-prompt-key]");if(!p.length)return;let _=a[f]||null;p.forEach(m=>{let g=m.dataset.promptKey,d=m.querySelector(".aipkit_prompt_toggle_label"),w=m.querySelector(".aipkit_prompt_toggle_desc");if(!d||!w)return;m.dataset.defaultLabel||(m.dataset.defaultLabel=d.textContent||""),m.dataset.defaultDesc||(m.dataset.defaultDesc=w.textContent||"");let h=_&&g?_[g]:null;h?(d.textContent=h.label,w.textContent=h.desc):(d.textContent=m.dataset.defaultLabel,w.textContent=m.dataset.defaultDesc)})},l=f=>{let u=document.querySelectorAll(".aipkit_cw_prompt_flyout");if(!u.length)return;let p=f==="existing-images",_=f==="existing-products";u.forEach(m=>{let g=m.querySelector(".aipkit_cw_prompt_panel"),d=m.querySelector(".aipkit_cw_prompt_editor_title");if(!g||!d)return;if(!m.dataset.defaultTitle){let h=d.textContent||g.getAttribute("aria-label")||"";m.dataset.defaultTitle=h}let w=m.dataset.defaultTitle||"";p&&m.dataset.existingImagesTitle?w=m.dataset.existingImagesTitle:_&&m.dataset.existingProductsTitle&&(w=m.dataset.existingProductsTitle),w&&(d.textContent=w,g.setAttribute("aria-label",w))})};function c(f){if(!document.getElementById("aipkit_content_writer_form"))return;let p=n(f),_=i(p),m=document.getElementById("aipkit_cw_single_output_wrapper");m&&_!=="task"&&(m.style.display="none");let g=document.getElementById("aipkit_cw_output_card");if(g){let h=m&&m.style.display!=="none";g.style.display=_==="task"&&h?"block":"none"}let d=document.getElementById("aipkit_cw_content_prompt_placeholders");if(d){let h="Use placeholders: {topic}, {keywords}",b=e(_);_==="rss"?h+=", {description}, {source_url}":_==="url"&&(h+=", {url_content}"),h+=".";let A=h.replace(/(\{[a-zA-Z0-9_]+\})/g,S=>`<code class="aipkit-placeholder" title="Click to copy">${k(S)}</code>`);d.innerHTML=A,d.hidden=b}typeof window.aipkit_setContentWriterPromptMode=="function"&&window.aipkit_setContentWriterPromptMode(_),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState(_);let w=document.getElementById("aipkit_cw_batch_queue");if(w){let h=w.querySelector(".aipkit_cw_batch_list"),b=h?h.children.length>0:!1,A=typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive();w.hidden=!(A||b)}typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),_.startsWith("existing")&&typeof window.aipkit_fetchContentWriterExistingPosts=="function"&&window.aipkit_fetchContentWriterExistingPosts(1)}function o(f){let u=document.getElementById("aipkit_content_writer_form");if(!u)return;let p=document.getElementById("aipkit_content_writer_generate_btn"),_=p?p.querySelector(".aipkit_btn-text"):null,m=p?p.querySelector(".aipkit_cw_task_suffix"):null,g=document.querySelector(".aipkit_cw_post_summary_trigger"),d=document.querySelector(".aipkit_cw_generate_split"),w=d?d.querySelector(".aipkit_cw_generate_toggle"):null,h=d?d.querySelector(".aipkit_cw_generate_menu"):null,b=u.querySelector("#aipkit_cw_task_frequency"),A=h?Array.from(h.querySelectorAll(".aipkit_cw_generate_menu_item[data-action]")):[],S=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,I=new Set(["task","csv","rss","gsheets","url"]),T=new Set(["rss","gsheets","url"]),x=n(f||document.getElementById("aipkit_cw_mode_select")?.value||"task");x=i(x);let E=e(x),v=x==="existing-images",y=x==="existing-products",C=x==="existing-content",M=I.has(x),B=T.has(x),D=M&&(!B||S),W=x==="task"||x==="csv";u.classList.toggle("aipkit_cw_mode_existing",E),u.classList.toggle("aipkit_cw_mode_existing_images",v),u.classList.toggle("aipkit_cw_mode_existing_products",y),u.classList.toggle("aipkit_cw_mode_existing_content",C),u.querySelectorAll(".aipkit_model_settings_popover.aipkit-active").forEach(N=>{N.classList.remove("aipkit-active"),N.setAttribute("aria-hidden","true")}),u.querySelectorAll(".aipkit_cw_popover_trigger[aria-expanded='true']").forEach(N=>N.setAttribute("aria-expanded","false")),u.querySelectorAll("[data-aipkit-cw-mode-only]").forEach(N=>{let H=N.dataset.aipkitCwModeOnly===x;N.hidden=!H,N.setAttribute("aria-hidden",H?"false":"true"),!H&&N.classList.contains("aipkit_model_settings_popover")&&(N.classList.remove("aipkit-active"),N.setAttribute("aria-hidden","true")),!H&&N.classList.contains("aipkit_cw_popover_trigger")&&N.setAttribute("aria-expanded","false")}),s(x),l(x),typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),(()=>{if(!e)return;let N=window.aipkit_cw_template_state;if(!N)return;let H=(Array.isArray(N.currentTemplates)?N.currentTemplates.find(K=>String(K.id)===String(N.currentTemplateId||"")):null)?.config||N.initialConfigForSelectedTemplate;!H||typeof H!="object"||["generate_title","generate_content"].forEach(K=>{if(!Object.prototype.hasOwnProperty.call(H,K))return;let re=u.elements[K];if(!re)return;let ve=H[K];re.checked=ve==="1"||ve===1||ve===!0})})(),b&&W&&Array.from(b.options).some(R=>R.value==="one-time")&&b.value!=="one-time"&&(b.value="one-time");let J=!1;if(x==="rss"){let N=document.getElementById("aipkit_cw_rss_items_count");J=N&&parseInt(N.value,10)>0}let oe=d?.dataset?.aipkitCwAction||"generate";if(E?oe=!S&&y?"upgrade":"update":(M||(oe="generate"),!D&&B&&(oe="upgrade")),!E&&x==="rss"&&D?J?oe==="fetch_feeds"&&(oe="generate"):oe="fetch_feeds":oe==="fetch_feeds"&&(oe="generate"),!E&&oe==="create_task"&&!D&&(oe="generate"),!E&&D&&oe!=="generate"&&oe!=="create_task"&&oe!=="fetch_feeds"&&(oe="generate"),d&&(d.dataset.aipkitCwAction=oe),A.forEach(N=>{let R=N.dataset.action||"generate",H=!M||B&&!S||E;R==="create_task"&&(N.hidden=H);let K=R===oe;N.classList.toggle("is-active",K),N.setAttribute("aria-checked",K?"true":"false")}),w){let N=D&&!E&&!(x==="rss"&&!J);w.style.display=N?"":"none",w.disabled=!N}h&&(h.dataset.keepOpen==="true"||(h.hidden=!0),h.dataset.keepOpen="false"),d&&d.classList.toggle("is-single",!D||x==="rss"&&!J);let L={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",fetch_feeds:"Fetch Feeds",update:"Update"}[oe]||"Generate";if(_?_.textContent=L:p&&(typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(p,L):p.textContent=L),p&&(p.dataset.action=oe,E||(p.removeAttribute("aria-disabled"),p.dataset.aipkitExistingDisabled&&(p.disabled=!1,delete p.dataset.aipkitExistingDisabled))),m)if(oe==="create_task"&&b&&!W){let N=b.options[b.selectedIndex],R=N?N.text:"";R?(m.textContent=` / ${R}`,m.hidden=!1):(m.textContent="",m.hidden=!0)}else m.textContent="",m.hidden=!0;if(g&&(g.hidden=E,g.setAttribute("aria-hidden",E?"true":"false"),E&&g.setAttribute("aria-expanded","false")),typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0);return}p?.dataset?.aipkitStopMode==="true"&&typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),typeof window.aipkit_cw_resetBatchQueue=="function"&&(oe!=="generate"||!M)&&window.aipkit_cw_resetBatchQueue()}let t={task:{label:"Manual Entry",icon:"dashicons-edit"},csv:{label:"Import CSV",icon:"dashicons-media-spreadsheet"},rss:{label:"RSS Feed",icon:"dashicons-rss"},url:{label:"Website URL",icon:"dashicons-admin-links"},gsheets:{label:"Google Sheets",icon:"dashicons-analytics"},existing:{label:"Update Content",icon:"dashicons-update"},"existing-content":{label:"Update Content",icon:"dashicons-update"},"existing-images":{label:"Optimize Images",icon:"dashicons-format-image"},"existing-products":{label:"Optimize Products",icon:"dashicons-cart"}};function r(f){if(!f){console.error("Content Writer Mode: Scope element not provided for initialization.");return}let u=f.querySelector("#aipkit_cw_mode_select"),p=Array.from(f.querySelectorAll(".aipkit_cw_mode_card")),_=Array.from(f.querySelectorAll(".aipkit_cw_bulk_source_tab")),m=Array.from(f.querySelectorAll("[data-aipkit-bulk-source-panel]")),g=f.querySelector(".aipkit_cw_tab_content_container"),d=f.querySelector("[data-aipkit-source-selector]"),w=d?.querySelector("[data-aipkit-source-trigger]"),h=d?.querySelector(".aipkit_cw_source_menu"),b=h?Array.from(h.querySelectorAll(".aipkit_cw_source_option")):[],A=w?.querySelector("[data-source-label]"),S=w?.querySelector("[data-source-icon]");if(!u||!g){console.warn("Content Writer Mode: Mode selector or content container not found within the provided scope.");return}let I=C=>{p.length&&p.forEach(M=>{let B=M.dataset.mode===C;M.classList.toggle("is-active",B),M.setAttribute("aria-pressed",B?"true":"false")})},T=C=>{!_.length||!m.length||(_.forEach(M=>{let B=M.dataset.source===C;M.classList.toggle("is-active",B),M.setAttribute("aria-pressed",B?"true":"false")}),m.forEach(M=>{let B=M.dataset.aipkitBulkSourcePanel===C;M.classList.toggle("is-hidden",!B),M.hidden=!B,M.setAttribute("aria-hidden",B?"false":"true")}))},x=C=>{if(!b.length)return;let M=i(C),B=e(M);b.forEach(W=>{let U=W.dataset.source===M;W.classList.toggle("is-active",U),W.setAttribute("aria-selected",U?"true":"false")});let D=t[M]||t.task;if(A&&(A.dataset.defaultLabel||(A.dataset.defaultLabel=A.textContent||""),A.textContent=B?D.label:A.dataset.defaultLabel),S){let W=S.querySelector(".dashicons");if(W&&!S.dataset.defaultIcon){let U=W.className.split(" ").find(J=>J!=="dashicons");S.dataset.defaultIcon=U||"dashicons-plus-alt2"}if(W){let U=B?D.icon:S.dataset.defaultIcon||"dashicons-plus-alt2";W.className="dashicons "+U}S.dataset.sourceIcon=B?M:"more"}w&&w.classList.toggle("is-active",B)},E=(C=!1)=>{if(!h||!w)return;let M=w.getAttribute("aria-expanded")==="true",B=C||M;w.setAttribute("aria-expanded",B?"false":"true"),h.hidden=B},v=C=>{let M=n(C),B=i(M),D=B.startsWith("existing")?"existing":B;u.value!==M&&(u.value=M),g.querySelectorAll(".aipkit_cw_tab_content").forEach(W=>{W.classList.toggle("aipkit_active",W.dataset.pane===D)}),I(B),T(M==="csv"?"csv":"task"),x(B),c(B)};u.addEventListener("change",function(C){v(C.target.value)}),w&&w.addEventListener("click",C=>{C.stopPropagation(),E()}),b.length&&b.forEach(C=>{C.addEventListener("click",()=>{let M=C.dataset.source||"task";u.value!==M&&(u.value=M,u.dispatchEvent(new Event("change",{bubbles:!0}))),E(!0)})}),document.addEventListener("click",C=>{d&&!d.contains(C.target)&&E(!0)}),document.addEventListener("keydown",C=>{C.key==="Escape"&&h&&!h.hidden&&(E(!0),w?.focus())}),p.length&&p.forEach(C=>{C.dataset.listenerAttached||(C.addEventListener("click",()=>{let M=C.dataset.mode||"task";u.value!==M&&(u.value=M,u.dispatchEvent(new Event("change",{bubbles:!0})))}),C.dataset.listenerAttached="true")}),_.length&&_.forEach(C=>{C.dataset.listenerAttached||(C.addEventListener("click",()=>{let B=(C.dataset.source||"task")==="csv"?"csv":"task";u.value!==B&&(u.value=B,u.dispatchEvent(new Event("change",{bubbles:!0})))}),C.dataset.listenerAttached="true")});let y=u.value||"task";v(y==="single"?"task":y)}window.aipkit_initContentWriterTabs=r,window.aipkit_updateContentWriterActionState=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(g){return String(g||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},n=["keyword","title","excerpt","content","meta","tags"],e={keyword:"Focus keyword",title:"Title",excerpt:"Excerpt",content:"Content",meta:"Meta description",tags:"Tags",slug:"URL"},a={"existing-content":{fieldOrder:n,fieldLabels:e,postTypeOverride:"",allowMeta:!0,allowTags:!0,allowSlug:!0},"existing-images":{fieldOrder:["keyword","title","excerpt","content"],fieldLabels:{keyword:"Alt text",title:"Image title",excerpt:"Caption",content:"Description"},postTypeOverride:"attachment",allowMeta:!1,allowTags:!1,allowSlug:!1,useImageMetadataPrompts:!0},"existing-products":{fieldOrder:n,fieldLabels:e,postTypeOverride:"product",allowMeta:!0,allowTags:!0,allowSlug:!0}},s=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}"],l=["{price}","{regular_price}","{sale_price}","{sku}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{product_categories}"],c={title:["{original_title}"],content:["{original_content}","{short_description}"],meta:["{original_title}","{short_description}","{original_content}"],keyword:["{original_title}","{original_content}"],excerpt:["{short_description}","{original_content}","{original_excerpt}"],tags:["{original_content}","{attributes}","{product_categories}"]},o=["{file_name}","{original_title}","{original_alt}","{original_caption}","{original_description}"],t=["Generate product titles, descriptions, and SEO fields.","Use product data like price, SKU, and attributes.","Bulk optimize selected products."],r={short:2e3,medium:4e3,long:6e3},f=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,u=window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.aipkit_dashboard.upgradeUrl:"",p=2400;function _(g=1){if(typeof window.aipkit_cw_existing_handleFetch=="function"){window.aipkit_cw_existing_handleFetch(g);return}window.aipkit_cw_existing_pendingFetch=g}function m(g){if(!g)return;let d=g.querySelector("[data-aipkit-existing-panel]");if(!d||d.dataset.init==="true")return;let w=d.querySelector("#aipkit_cw_existing_post_type"),h=d.querySelector("#aipkit_cw_existing_post_status"),b=d.querySelector("#aipkit_cw_existing_media_filter"),A=d.querySelector("#aipkit_cw_existing_search"),S=d.querySelector("#aipkit_cw_existing_refresh"),I=d.querySelector("#aipkit_cw_existing_select_all"),T=d.querySelector("#aipkit_cw_existing_posts_body"),x=d.querySelector("#aipkit_cw_existing_page_status"),E=d.querySelector("#aipkit_cw_existing_page_prev"),v=d.querySelector("#aipkit_cw_existing_page_next"),y=d.querySelector("#aipkit_cw_existing_selected_count"),C=document.getElementById("aipkit_content_writer_generate_btn")||d.querySelector("#aipkit_cw_existing_open_assistant"),M=document.getElementById("aipkit_cw_mode_select");if(!T)return;let B=document.getElementById("aipkit_content_writer_nonce"),D=10,W=1,U=1,J=null,oe=!1,O=!1,L=!1,F=[],N=new Set,R=new Map,H=w?w.value:"",K=!1,re=C?C.querySelector(".aipkit_btn-text"):null,ve=C&&C.dataset.action||"generate",Ie=Se=>Se?Se==="existing"?"existing-content":Se.indexOf("existing-")===0?Se:"":"",Ee=()=>Ie(M?M.value:""),Z=()=>a[Ee()]||a["existing-content"],pe=()=>!!Ee(),we=document.getElementById("aipkit_content_writer_form_status"),de="",ae=null,ne=()=>{ae&&(clearTimeout(ae),ae=null)},ye=(Se,Fe)=>{we&&(ne(),we.textContent=Se||"",we.className="aipkit_cw_status_badge",Fe==="info"?we.classList.add("aipkit_settings_message-info"):Fe==="error"?we.classList.add("aipkit_settings_message-error"):Fe==="success"&&we.classList.add("aipkit_settings_message-success"),Se?we.dataset.cwUpdateStatus="1":delete we.dataset.cwUpdateStatus)},Me=()=>{O&&(L=!0,ye("Stopping...","info"))},nt=()=>{we&&(ne(),ae=setTimeout(()=>{we.dataset.cwUpdateStatus==="1"&&ye("","")},4e3))},se=Se=>{if(!we){de="";return}if(!Se){we.dataset.cwProNotice==="1"&&(!de||we.textContent.startsWith(de))&&(we.textContent="",we.className="aipkit_cw_status_badge"),delete we.dataset.cwProNotice,de="";return}let Fe=u?` <a class="aipkit_popover_upgrade_link" href="${k(u)}" target="_blank" rel="noopener noreferrer">Upgrade</a>`:"";de=Se,we.dataset.cwProNotice="1",we.className="aipkit_cw_status_badge aipkit_settings_message-info",we.innerHTML=`${k(Se)}${Fe}`};if(w&&!f){let Se=w.querySelector('option[value="product"]');Se&&!Se.dataset.proLabel&&(Se.dataset.proLabel=Se.textContent||"Products")}let be=Se=>{K=!!Se,C&&(C.dataset.action=K?"upgrade":ve,re&&pe()&&(re.textContent=K?"Upgrade":"Update"))},xe=Se=>{let Fe=[],Ve=[];return Se.forEach(Tt=>{let st=F.find(qt=>Number(qt.id)===Tt);st&&st.type==="product"?Fe.push(Tt):Ve.push(Tt)}),{productIds:Fe,otherIds:Ve}},Re=()=>{if(!pe()||Ee()!=="existing-content"){be(!1),se("");return}if(f){be(!1),se("");return}let Se=Array.from(N),{productIds:Fe,otherIds:Ve}=xe(Se);if(w&&w.value==="product"){be(!0);return}if(Fe.length&&!Ve.length){be(!0);return}if(Fe.length&&Ve.length){be(!1);return}be(!1),se("")},De=Se=>{T&&(T.innerHTML=`
        <tr class="aipkit_cw_existing_empty">
          <td colspan="7">${k(Se)}</td>
        </tr>
      `,ze())},ze=()=>{let Se=N.size;if(Re(),y&&(y.textContent=`${Se} selected`),C&&pe()){let Fe=K?O:Se===0||O;C.disabled=Fe,C.setAttribute("aria-disabled",Fe?"true":"false"),Fe?C.dataset.aipkitExistingDisabled="true":delete C.dataset.aipkitExistingDisabled}if(I){let Fe=F.length>0&&F.every(Ve=>N.has(Ve.id));I.checked=Fe}},Ze=()=>{x&&(x.textContent=`Page ${W} of ${U}`),E&&(E.disabled=W<=1),v&&(v.disabled=W>=U)},it=(Se,Fe)=>{if(F=Array.isArray(Se)?Se:[],W=Fe?.page||1,U=Fe?.total_pages||1,!F.length){De("No posts found."),Ze(),ze();return}let Ve=Ee()==="existing-images",Tt=F.map(st=>{let qt=Number(st.id),fi=k(st.title||"(Untitled)"),Ht=k(st.edit_link||"#"),hi=k(st.type_label||""),mi=k(st.status_label||""),Bi=Ve?k(st.alt_text||""):"",gi=Ve?k(st.caption||""):"",ii=Ve?k(st.description||""):"",ji=Ve?k(st.thumb_url||""):"",Ue=N.has(qt)?"checked":"",ui=k(st.type||"post"),Hi=fi?` title="${fi}"`:"",En=Bi?` title="${Bi}"`:"",Do=gi?` title="${gi}"`:"",Ao=ii?` title="${ii}"`:"",Wo=ji?`<span class="aipkit_cw_existing_thumb"><img src="${ji}" alt="" loading="lazy"></span>`:'<span class="aipkit_cw_existing_thumb aipkit_cw_existing_thumb--empty" aria-hidden="true"></span>',gn=Ve?`
                <div class="aipkit_cw_existing_title_stack">
                  ${Wo}
                  <div class="aipkit_cw_existing_title_meta">
                    <a class="row-title aipkit_cw_existing_truncate" href="${Ht}" target="_blank" rel="noopener noreferrer"${Hi}>${fi}</a>
                    <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                  </div>
                </div>
              `:`
                <div class="aipkit_cw_existing_title_inline">
                  <a class="row-title aipkit_cw_existing_truncate" href="${Ht}" target="_blank" rel="noopener noreferrer"${Hi}>${fi}</a>
                  <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                </div>
              `;return`
            <tr id="post-${qt}" data-post-type="${ui}">
              <td class="aipkit_cw_existing_col_check">
                <input type="checkbox" class="aipkit_cw_existing_row_checkbox" value="${qt}" ${Ue}>
              </td>
              <td class="aipkit_cw_existing_title">
                ${gn}
              </td>
              <td class="aipkit_cw_existing_col_type">${hi}</td>
              <td class="aipkit_cw_existing_col_status">${mi}</td>
              <td class="aipkit_cw_existing_col_alt"><span class="aipkit_cw_existing_truncate"${En}>${Bi}</span></td>
              <td class="aipkit_cw_existing_col_caption"><span class="aipkit_cw_existing_truncate"${Do}>${gi}</span></td>
              <td class="aipkit_cw_existing_col_description"><span class="aipkit_cw_existing_truncate"${Ao}>${ii}</span></td>
            </tr>
          `}).join("");T.innerHTML=Tt,Ze(),ze()},Pt=Se=>{let Fe=String(Se||"").trim();return Fe||"(Untitled)"},Mi=(Se,Fe)=>{let Ve=d.querySelector(`#post-${Se}`);if(!Ve)return;let Tt=Ve.querySelector(".row-title");if(!Tt)return;let st=Pt(Fe);Tt.textContent=st,Tt.setAttribute("title",st);let qt=F.find(fi=>Number(fi.id)===Se);qt&&(qt.title=st)},Qt=(Se,Fe,Ve)=>{let Tt=d.querySelector(`#post-${Se}`);if(!Tt)return;let st="",qt="";if(Fe==="keyword")st=".aipkit_cw_existing_col_alt .aipkit_cw_existing_truncate",qt="alt_text";else if(Fe==="excerpt")st=".aipkit_cw_existing_col_caption .aipkit_cw_existing_truncate",qt="caption";else if(Fe==="content")st=".aipkit_cw_existing_col_description .aipkit_cw_existing_truncate",qt="description";else return;let fi=Tt.querySelector(st);if(!fi)return;let Ht=String(Ve||"").trim();fi.textContent=Ht,Ht?fi.setAttribute("title",Ht):fi.removeAttribute("title");let hi=F.find(mi=>Number(mi.id)===Se);hi&&qt&&(hi[qt]=Ht)},ti=Se=>{let Fe=R.get(Se);Fe&&(clearTimeout(Fe),R.delete(Se))},wt=(Se,Fe,Ve)=>{let Tt=d.querySelector(`#post-${Se}`);if(!Tt)return;let st=Tt.querySelector(".aipkit_cw_existing_status");if(st){if(ti(Se),st.classList.remove("is-visible","is-error","is-success","is-processing","is-queued"),!Ve){st.textContent="";return}st.textContent=Ve,st.classList.add("is-visible"),Fe==="error"&&st.classList.add("is-error"),Fe==="success"&&st.classList.add("is-success"),Fe==="processing"&&st.classList.add("is-processing"),Fe==="queued"&&st.classList.add("is-queued")}},at=Se=>wt(Se,"",""),et=Se=>{ti(Se);let Fe=setTimeout(()=>at(Se),p);R.set(Se,Fe)},ei=Se=>{if(O=Se,C&&pe()){let Fe=C.dataset&&C.dataset.aipkitStopMode==="true",Ve=K?Se:N.size===0||Se&&!Fe;C.disabled=Ve,C.setAttribute("aria-disabled",Ve?"true":"false"),Ve?C.dataset.aipkitExistingDisabled="true":delete C.dataset.aipkitExistingDisabled}if(S&&(S.disabled=Se),w){let Fe=Z();w.disabled=Se||!!Fe.postTypeOverride}h&&(h.disabled=Se),A&&(A.disabled=Se),E&&(E.disabled=Se||W<=1),v&&(v.disabled=Se||W>=U),I&&(I.disabled=Se),T.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Fe=>{Fe.disabled=Se})},li=()=>{let Se=Z();w&&(Se.postTypeOverride?(w.value=Se.postTypeOverride,w.disabled=!0):(w.disabled=!1,w.value=H||"")),h&&Se.postTypeOverride==="attachment"&&(h.value="")},Jt=Se=>{!C||!pe()||C.dataset&&C.dataset.aipkitStopMode==="true"||(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(C,Se,"Update","Updating..."):C.disabled=Se)},Ut=(Se,Fe)=>{let Ve=`${Fe}_update`,Tt=Se&&Se[Ve]||Se&&Se[Fe]||"";return String(Tt||"").trim()},Di=Se=>{let Fe=document.getElementById("aipkit_content_writer_form");if(!Fe||typeof window.aipkit_getContentWriterFormConfig!="function")return{error:"Content Writer form is not ready yet."};let Ve=window.aipkit_getContentWriterFormConfig(Fe),Tt=!!Se.useImageMetadataPrompts;if(!f&&Se.postTypeOverride==="product")return{error:"Optimize Products is a Pro feature. Upgrade to continue."};let st=Ue=>Tt?Ue==="title"?Ve.generate_image_title==="1":Ue==="keyword"?Ve.generate_image_alt_text==="1":Ue==="excerpt"?Ve.generate_image_caption==="1":Ue==="content"?Ve.generate_image_description==="1":!1:Ue==="meta"&&!Se.allowMeta||Ue==="tags"&&!Se.allowTags?!1:Ue==="title"?Ve.generate_title!=="0":Ue==="content"?Ve.generate_content!=="0":Ue==="meta"?Ve.generate_meta_description==="1":Ue==="keyword"?Ve.generate_focus_keyword==="1":Ue==="excerpt"?Ve.generate_excerpt==="1":Ue==="tags"?Ve.generate_tags==="1":!1,qt=Tt?{title:st("title")?Ut(Ve,"image_title_prompt"):"",content:st("content")?Ut(Ve,"image_description_prompt"):"",meta:"",keyword:st("keyword")?Ut(Ve,"image_alt_text_prompt"):"",excerpt:st("excerpt")?Ut(Ve,"image_caption_prompt"):"",tags:""}:{title:st("title")?Ut(Ve,"custom_title_prompt"):"",content:st("content")?Ut(Ve,"custom_content_prompt"):"",meta:st("meta")?Ut(Ve,"custom_meta_prompt"):"",keyword:st("keyword")?Ut(Ve,"custom_keyword_prompt"):"",excerpt:st("excerpt")?Ut(Ve,"custom_excerpt_prompt"):"",tags:st("tags")?Ut(Ve,"custom_tags_prompt"):""},fi=[],Ht=Ue=>Se.fieldLabels?.[Ue]||e[Ue]||Ue;if(st("title")&&!qt.title&&fi.push(`${Ht("title")} prompt is required.`),st("content")&&!qt.content&&fi.push(`${Ht("content")} prompt is required.`),st("meta")&&!qt.meta&&fi.push(`${Ht("meta")} prompt is required.`),st("keyword")&&!qt.keyword&&fi.push(`${Ht("keyword")} prompt is required.`),st("excerpt")&&!qt.excerpt&&fi.push(`${Ht("excerpt")} prompt is required.`),st("tags")&&!qt.tags&&fi.push(`${Ht("tags")} prompt is required.`),fi.length)return{error:fi.join(" ")};let hi=[],mi=(Ue,ui)=>ui.some(Hi=>Ue.includes(Hi)),Bi=Ue=>Tt?o:Se.postTypeOverride==="product"&&c[Ue]||s;if(Se.fieldOrder.forEach(Ue=>{let ui=qt[Ue];if(!ui)return;let Hi=Bi(Ue);mi(ui,Hi)||hi.push(`${Ht(Ue)} prompt: add one of ${Hi.join(", ")}.`)}),hi.length)return{error:`${Tt?"Image optimization":Se.postTypeOverride==="product"?"Product update":"Update"} works best when prompts include source placeholders.

${hi.join(`
`)}`};let gi=String(Ve.content_length||"medium"),ii=r[gi]||r.medium,ji={ai_provider:Ve.ai_provider||"openai",ai_model:Ve.ai_model||"",temperature:parseFloat(Ve.ai_temperature||"1"),max_tokens:ii,reasoning_effort:Ve.reasoning_effort||"",generate_seo_slug:Se.allowSlug&&Ve.generate_seo_slug||"0",enable_vector_store:Ve.enable_vector_store||"0",vector_store_provider:Ve.vector_store_provider||"openai",vector_store_top_k:Ve.vector_store_top_k||"3",openai_vector_store_ids:Ve.openai_vector_store_ids||[],pinecone_index_name:Ve.pinecone_index_name||"",qdrant_collection_name:Ve.qdrant_collection_name||"",vector_embedding_provider:Ve.vector_embedding_provider||"",vector_embedding_model:Ve.vector_embedding_model||""};return{prompts:qt,baseConfig:ji}},xt=(Se,Fe,Ve)=>({[Se]:{prompt:Fe},ai_provider:Ve.ai_provider,ai_model:Ve.ai_model,temperature:Ve.temperature,max_tokens:Ve.max_tokens,reasoning_effort:Ve.reasoning_effort,enable_vector_store:Ve.enable_vector_store,vector_store_provider:Ve.vector_store_provider,vector_store_top_k:Ve.vector_store_top_k,openai_vector_store_ids:Ve.openai_vector_store_ids,pinecone_index_name:Ve.pinecone_index_name,qdrant_collection_name:Ve.qdrant_collection_name,vector_embedding_provider:Ve.vector_embedding_provider,vector_embedding_model:Ve.vector_embedding_model}),pi=async(Se=1)=>{if(!oe){if(typeof window.aipkit_apiRequest!="function"){console.error("Content Writer Existing: aipkit_apiRequest not found.");return}oe=!0,De("Loading posts...");try{let Ve=Z().postTypeOverride||(w?w.value:""),Tt=await window.aipkit_apiRequest("aipkit_content_writer_fetch_existing_posts",{_ajax_nonce:B?B.value:"",post_type:Ve,post_status:h?h.value:"",media_filter:b?b.value:"",search:A?A.value.trim():"",paged:Se,per_page:D});it(Tt.posts||[],Tt.pagination||{})}catch(Fe){console.error("Content Writer Existing: fetch failed",Fe),De("Unable to load posts. Please try again.")}finally{oe=!1}}},Wt=()=>{N.clear(),ze()};T.addEventListener("change",Se=>{let Fe=Se.target;if(!Fe||!Fe.classList.contains("aipkit_cw_existing_row_checkbox"))return;let Ve=Number(Fe.value||0);Ve&&(Fe.checked?N.add(Ve):N.delete(Ve),ze())}),I&&I.addEventListener("change",()=>{let Se=I.checked;F.forEach(Ve=>{Se?N.add(Number(Ve.id)):N.delete(Number(Ve.id))}),T.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Ve=>{Ve.checked=Se}),ze()}),E&&E.addEventListener("click",()=>{W>1&&pi(W-1)}),v&&v.addEventListener("click",()=>{W<U&&pi(W+1)}),S&&S.addEventListener("click",()=>{Wt(),pi(1)}),w&&w.addEventListener("change",()=>{Z().postTypeOverride||(H=w.value),Wt(),pi(1)}),h&&h.addEventListener("change",()=>{Wt(),pi(1)}),b&&b.addEventListener("change",()=>{Wt(),pi(1)}),A&&A.addEventListener("input",()=>{J&&clearTimeout(J),J=setTimeout(()=>{Wt(),pi(1)},300)});let Wi=Se=>{typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(Se,{title:"Update existing"}):alert(Se)},Sn=()=>{let Se="Bulk image optimization is available on Pro. Select one image or upgrade.";if(typeof window.aipkit_showAlertModal=="function"){let Fe=[];u&&Fe.push({label:"Upgrade to Pro",href:u,className:"aipkit_btn aipkit_btn-primary"}),Fe.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(Se,{title:"Optimize Images",actions:Fe})}else alert(Se)},Ki=()=>{let Se="Optimize Products is a Pro feature.";if(typeof window.aipkit_showAlertModal=="function"){let Fe=[];u&&Fe.push({label:"Upgrade to Pro",href:u,className:"aipkit_btn aipkit_btn-primary"}),Fe.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(Se,{title:"Optimize Products",bullets:t,actions:Fe})}else alert(Se)},ln=async(Se,Fe,Ve,Tt,st)=>{let qt=`cw-existing-${Se}-${Date.now()}`,fi=!1;if(L)return wt(Se,"","Stopped"),et(Se),{success:!1,stopped:!0};for(let Ht of st.fieldOrder){let hi=Fe[Ht];if(!hi)continue;if(L)return wt(Se,"","Stopped"),et(Se),{success:!1,stopped:!0};wt(Se,"processing",`Updating ${st.fieldLabels[Ht]||Ht}...`);let mi=xt(Ht,hi,Ve),Bi={_ajax_nonce:Tt,post_id:Se,field:Ht,enhancements:JSON.stringify(mi),conversation_uuid:qt};try{let gi=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",Bi,{timeout:18e4});gi&&Object.prototype.hasOwnProperty.call(gi,"updated_value")&&(Ht==="title"?Mi(Se,gi.updated_value):Qt(Se,Ht,gi.updated_value)),fi=!0}catch(gi){let ii=gi&&gi.message||"Update failed. Please try again.";return wt(Se,"error",ii),{success:!1}}}if(L)return wt(Se,"","Stopped"),et(Se),{success:!1,stopped:!0};if(Ve.generate_seo_slug==="1"&&fi){wt(Se,"processing","Updating URL...");try{await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",{_ajax_nonce:Tt,post_id:Se,action_type:"update_slug"},{timeout:3e4})}catch{return wt(Se,"error","URL update failed."),{success:!1}}}return fi?(wt(Se,"success","Updated"),et(Se),{success:!0}):(wt(Se,"error","No prompts selected."),{success:!1})},Vn=async()=>{if(O||!pe())return;let Se=Array.from(N);if(!Se.length)return;if(!f&&Ee()==="existing-content"){let{productIds:ii,otherIds:ji}=xe(Se);if(ii.length&&!ji.length){Ki(),ze();return}ii.length&&ji.length&&(ii.forEach(Ue=>{wt(Ue,"error","Skipped (Pro)"),et(Ue)}),Se=ji)}if(!Se.length){ze();return}if(!f&&Ee()==="existing-images"&&Se.length>1){Sn();return}if(typeof window.aipkit_apiRequest!="function"){Wi("Update service is not available yet.");return}let Fe=window.aipkit_post_enhancer?.nonce_generate_title;if(!Fe){Wi("Update permission is missing. Please reload the page.");return}let Ve=Z(),{prompts:Tt,baseConfig:st,error:qt}=Di(Ve);if(qt){!f&&Ve.postTypeOverride==="product"?Ki():Wi(qt);return}if(!Ve.fieldOrder.some(ii=>!!Tt[ii])){Wi("No prompts selected for update.");return}L=!1,Se.forEach(ii=>{wt(ii,"queued","Queued")});let Ht=0,hi=0,mi=Se.length,Bi=null,gi=()=>{let ii=[];return ii.push(`Updating ${mi} item${mi===1?"":"s"}...`),Ht&&ii.push(`${Ht} done`),hi&&ii.push(`${hi} error${hi===1?"":"s"}`),ii.join(" ")};ye(gi(),"info"),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):Jt(!0),ei(!0);for(let ii=0;ii<Se.length;ii+=1){let ji=Se[ii];if(L){Bi=ii;break}let Ue=await ln(ji,Tt,st,Fe,Ve);if(Ue&&Ue.stopped){L=!0,Bi=ii+1;break}Ue&&Ue.success?Ht+=1:hi+=1,ye(gi(),"info")}if(ei(!1),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():Jt(!1),L){(Bi!==null?Se.slice(Bi):[]).forEach(Ue=>{wt(Ue,"","Stopped"),et(Ue)});let ji=[`Update stopped: ${Ht} done`];hi&&ji.push(`${hi} error${hi===1?"":"s"}`),ye(ji.join(", ")+".","info")}else hi?ye(`Update complete: ${Ht} done, ${hi} error${hi===1?"":"s"}.`,"error"):ye(`Update complete: ${Ht} done.`,"success");nt(),ze()};d.dataset.init="true",window.aipkit_cw_existing_handleFetch=pi,window.aipkit_runContentWriterExistingUpdate=Vn,window.aipkit_cw_isExistingUpdateActive=()=>O,window.aipkit_cw_requestExistingUpdateStop=Me,M&&!M.dataset.aipkitExistingListener&&(M.addEventListener("change",()=>{b&&(b.value=""),li(),Wt()},!0),M.dataset.aipkitExistingListener="true"),li(),window.aipkit_cw_existing_pendingFetch&&(pi(window.aipkit_cw_existing_pendingFetch),window.aipkit_cw_existing_pendingFetch=null)}window.aipkit_initContentWriterExistingContent=m,window.aipkit_fetchContentWriterExistingPosts=_})();(function(){"use strict";let k=[{key:"custom_title_prompt",textareaId:"aipkit_cw_custom_title_prompt",updateInputId:"aipkit_cw_custom_title_prompt_update"},{key:"custom_content_prompt",textareaId:"aipkit_cw_custom_content_prompt",updateInputId:"aipkit_cw_custom_content_prompt_update"},{key:"custom_meta_prompt",textareaId:"aipkit_cw_custom_meta_prompt",updateInputId:"aipkit_cw_custom_meta_prompt_update"},{key:"custom_keyword_prompt",textareaId:"aipkit_cw_custom_keyword_prompt",updateInputId:"aipkit_cw_custom_keyword_prompt_update"},{key:"custom_excerpt_prompt",textareaId:"aipkit_cw_custom_excerpt_prompt",updateInputId:"aipkit_cw_custom_excerpt_prompt_update"},{key:"custom_tags_prompt",textareaId:"aipkit_cw_custom_tags_prompt",updateInputId:"aipkit_cw_custom_tags_prompt_update"},{key:"image_prompt",textareaId:"aipkit_cw_image_prompt",updateInputId:"aipkit_cw_image_prompt_update"},{key:"featured_image_prompt",textareaId:"aipkit_cw_featured_image_prompt",updateInputId:"aipkit_cw_featured_image_prompt_update"},{key:"image_title_prompt",textareaId:"aipkit_cw_image_title_prompt",updateInputId:"aipkit_cw_image_title_prompt_update"},{key:"image_alt_text_prompt",textareaId:"aipkit_cw_image_alt_text_prompt",updateInputId:"aipkit_cw_image_alt_text_prompt_update"},{key:"image_caption_prompt",textareaId:"aipkit_cw_image_caption_prompt",updateInputId:"aipkit_cw_image_caption_prompt_update"},{key:"image_description_prompt",textareaId:"aipkit_cw_image_description_prompt",updateInputId:"aipkit_cw_image_description_prompt_update"}],n={create:{},update:{}},e={},i=[],a="create",s=!1,l=g=>g&&g!=="single"?g:"task",c=()=>{let g=document.getElementById("aipkit_cw_mode_select");return l(g?.value||"task")},o=g=>g&&g.indexOf("existing")===0?"update":"create",t=(g,d,w)=>{if(w)return String(g||"");let h=String(g||"").trim()?g:d||"";return String(h||"")},r=()=>{if(s)return;let g=a==="update";i.forEach(({key:d,textarea:w,updateInput:h})=>{if(!w)return;let b=w.value||"";if(!g){n.create[d]=b;return}e[d]&&(n.update[d]=b,h&&(h.value=b))})},f=()=>{s=!0;let g=a==="update";i.forEach(({key:d,textarea:w,updateInput:h})=>{if(!w)return;let b=n.create[d]||"",A=n.update[d]||"",S=!!e[d],I=g?t(A,b,S):b;w.value=I||"",g&&h&&(h.value=S?A:"")}),s=!1},u=g=>{let d=o(l(g));d!==a&&(r(),a=d,f())},p=g=>{!g||g.dataset.aipkitPromptModeInit==="true"||(i=k.map(d=>{let w=g.querySelector(`#${d.textareaId}`)||document.getElementById(d.textareaId),h=g.querySelector(`#${d.updateInputId}`)||document.getElementById(d.updateInputId);return{...d,textarea:w,updateInput:h}}),i.some(d=>d.textarea)&&(i.forEach(d=>{let w=d.textarea&&d.textarea.value||"";n.create[d.key]=w;let h=d.updateInput&&d.updateInput.value||"";n.update[d.key]=h,e[d.key]=!!h,d.textarea&&!d.textarea.dataset.aipkitPromptModeListener&&(d.textarea.addEventListener("input",()=>{if(s)return;let b=d.textarea.value||"";a==="update"?(n.update[d.key]=b,e[d.key]=!0,d.updateInput&&(d.updateInput.value=b)):n.create[d.key]=b}),d.textarea.dataset.aipkitPromptModeListener="true")}),g.dataset.aipkitPromptModeInit="true",u(c())))},_=g=>{if(!g||typeof g!="object")return;let d=w=>Object.prototype.hasOwnProperty.call(g,w);i.forEach(w=>{let h=w.key,b=`${h}_update`;if(d(h)&&(n.create[h]=g[h]||""),d(b)){let A=g[b]||"";n.update[h]=A,e[h]=!!A,w.updateInput&&(w.updateInput.value=e[h]?A:"")}}),f()},m=()=>({create:{...n.create},update:{...n.update}});window.aipkit_initContentWriterPromptModeManager=p,window.aipkit_setContentWriterPromptMode=u,window.aipkit_applyContentWriterPromptSets=_,window.aipkit_getContentWriterPromptSets=m})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"],image_title:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_alt_text:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_caption:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_description:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"]},n=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}","{price}","{regular_price}","{sale_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{total_sales}","{product_categories}"],e={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},i={existing:{title:["{original_title}","{original_content}","{original_focus_keyword}"],content:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],meta:["{original_title}","{original_content}","{original_focus_keyword}","{original_tags}","{categories}"],keyword:["{original_title}","{original_content}"],excerpt:["{original_title}","{original_content}","{original_excerpt}"],tags:["{original_title}","{original_content}","{original_tags}","{categories}"],image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],featured_image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"]},"existing-images":{title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],content:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],excerpt:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],keyword:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_alt_text:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_caption:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_description:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],featured_image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"]},"existing-products":{title:n,content:n,meta:n,keyword:n,excerpt:n,tags:n}},a={aipkit_cw_image_title_prompt:"image_title",aipkit_cw_image_alt_text_prompt:"image_alt_text",aipkit_cw_image_caption_prompt:"image_caption",aipkit_cw_image_description_prompt:"image_description"},s=u=>String(u??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),l=()=>{let p=document.getElementById("aipkit_cw_mode_select")?.value||"task";return p==="single"&&(p="task"),p},c=(u,p)=>{let _=window.aipkit_content_writer_config?.default_prompts||{};if(p==="existing-images"){let m=`${u}_update`;if(_[m])return _[m]}return _[u]||""},o=(u,p)=>{let _=i[p]||(p.indexOf("existing")===0?i.existing:null);if(_&&_[u])return _[u];let m=k[u]||[],g=e[p]||[],d=[...m,...g];return d.filter((w,h)=>d.indexOf(w)===h)},t=(u,p)=>{if(!u)return;let _=u.dataset.label||"Variables:",m=u.dataset.copyTitle||"Click to copy";u.innerHTML=`${s(_)} `,p.forEach((g,d)=>{let w=document.createElement("code");w.className="aipkit-placeholder",w.title=m,w.textContent=g,u.appendChild(w),d<p.length-1&&u.appendChild(document.createTextNode(" "))})},r=u=>{let p=u?.querySelector(".aipkit_cw_prompt_editor_placeholders");if(!p)return;let _=p.dataset.promptType||"",m=l(),g=o(_,m);t(p,g)};function f(u){if(!u)return;let p=u.querySelectorAll("[data-aipkit-flyout-target]");if(!p.length)return;let _=u.querySelectorAll(".aipkit_cw_prompt_library_select"),m=new WeakMap,g=window.aipkit_prompt_library_api||null,d="You have unsaved prompt edits in this panel. Close anyway?",w=Z=>{let pe=Z?.getAttribute("data-aipkit-prompt-target");return pe?u.querySelector(`#${pe}`):null},h=Z=>{let pe=Z?.closest(".aipkit_cw_prompt_editor_toolbar");return pe?{manageButton:pe.querySelector(".aipkit_cw_prompt_library_manage_btn"),applyButton:pe.querySelector(".aipkit_cw_prompt_library_apply_btn"),undoButton:pe.querySelector(".aipkit_cw_prompt_library_undo_btn"),saveButton:pe.querySelector(".aipkit_cw_prompt_library_save_btn"),updateButton:pe.querySelector(".aipkit_cw_prompt_library_update_btn"),deleteButton:pe.querySelector(".aipkit_cw_prompt_library_delete_btn")}:{manageButton:null,applyButton:null,undoButton:null,saveButton:null,updateButton:null,deleteButton:null}},b=Z=>{let we=Z?.closest(".aipkit_cw_prompt_editor")?.querySelector(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");if(we?.dataset?.promptType)return String(we.dataset.promptType);let de=Z?.getAttribute("data-aipkit-prompt-target")||"";return a[de]||""},A=Z=>{let pe=b(Z);if(!pe)return{primaryType:"",secondaryType:""};let we=Z?.getAttribute("data-aipkit-prompt-target")||"";return a[we]?{primaryType:pe,secondaryType:`${pe}_update`}:{primaryType:pe,secondaryType:""}},S=Z=>{let pe=A(Z);return pe.secondaryType&&l()==="existing-images"?pe.secondaryType:pe.primaryType},I=Z=>{let pe=Z?.selectedOptions?.[0];return pe?{promptId:pe.dataset.promptId||"",promptType:pe.dataset.promptType||"",label:pe.dataset.promptLabel||pe.textContent||"",source:pe.dataset.promptSource||"",isCustom:(pe.dataset.promptSource||"")==="custom",prompt:String(pe.value||"")}:{promptId:"",promptType:"",label:"",source:"",isCustom:!1,prompt:""}},T=(Z,pe)=>{if(Z)switch(Z.classList.remove("aipkit_btn-primary","aipkit_btn-secondary","aipkit_btn-ghost","aipkit_btn-danger"),pe){case"primary":Z.classList.add("aipkit_btn-primary");break;case"danger":Z.classList.add("aipkit_btn-danger");break;case"secondary":Z.classList.add("aipkit_btn-secondary");break;default:Z.classList.add("aipkit_btn-ghost");break}},x=(Z,pe)=>{if(!Z||!pe)return;let{manageButton:we,applyButton:de,undoButton:ae,saveButton:ne,updateButton:ye,deleteButton:Me}=h(Z),nt=I(Z),se=!!nt.isCustom&&!!nt.promptId;if(we&&(T(we,"secondary"),we.disabled=!g||typeof window.aipkit_openPromptLibraryManager!="function"),de){T(de,"primary");let be=String(Z.value||"");de.disabled=be.trim()===""||be===pe.value}ae&&(T(ae,"secondary"),ae.disabled=!m.has(pe)),ne&&(T(ne,se?"secondary":"primary"),ne.disabled=String(pe.value||"").trim()===""),ye&&(T(ye,se?"primary":"secondary"),ye.disabled=!se),Me&&(T(Me,"danger"),Me.disabled=!se)},E=Z=>{let pe=Z.closest(".aipkit_cw_prompt_editor_toolbar");if(!pe||pe.querySelector(".aipkit_cw_prompt_library_actions"))return;let we=document.createElement("span");we.className="aipkit_cw_prompt_library_actions";let de=document.createElement("button");de.type="button",de.className="aipkit_cw_prompt_library_manage_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",de.textContent="Library";let ae=document.createElement("button");ae.type="button",ae.className="aipkit_cw_prompt_library_apply_btn aipkit_btn aipkit_btn-secondary aipkit_btn-small",ae.textContent="Apply";let ne=document.createElement("button");ne.type="button",ne.className="aipkit_cw_prompt_library_undo_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",ne.textContent="Undo",ne.disabled=!0;let ye=document.createElement("button");ye.type="button",ye.className="aipkit_cw_prompt_library_save_btn aipkit_btn aipkit_btn-secondary aipkit_btn-small",ye.textContent="Save As";let Me=document.createElement("button");Me.type="button",Me.className="aipkit_cw_prompt_library_update_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",Me.textContent="Update",Me.disabled=!0;let nt=document.createElement("button");nt.type="button",nt.className="aipkit_cw_prompt_library_delete_btn aipkit_btn aipkit_btn-danger aipkit_btn-small",nt.textContent="Delete",nt.disabled=!0,we.appendChild(de),we.appendChild(ae),we.appendChild(ne),we.appendChild(ye),we.appendChild(Me),we.appendChild(nt),pe.appendChild(we)},v=()=>{_.forEach(Z=>{let pe=w(Z);x(Z,pe)})},y=(Z,pe)=>{if(!Z||!pe)return!1;let we=Array.from(Z.options).find(de=>(de.dataset.promptId||"")===pe);return we?(Z.value=we.value,!0):!1},C=(Z,pe,we)=>{!Array.isArray(pe)||!pe.length||pe.forEach(de=>{let ae=String(de?.label||"").trim(),ne=String(de?.prompt||"");if(!ae||!ne)return;let ye=de?.source||(de?.is_builtin?"builtin":"custom"),Me=document.createElement("option");Me.value=ne,Me.textContent=ye==="custom"?`${ae} (Custom)`:ae,Me.dataset.promptId=String(de?.id||""),Me.dataset.promptType=String(de?.type||""),Me.dataset.promptSource=String(ye||""),Me.dataset.promptLabel=ae,Me.dataset.aipkitMode=we,Z.appendChild(Me)})},M=(Z,pe={})=>{if(!Z)return;let we=Z.options?.[0]?.cloneNode(!0);if(!we)return;let de=Z.selectedOptions?.[0]?.dataset.promptId||"",ae=String(Z.value||""),ne=A(Z);if(!ne.primaryType)return;if(Z.innerHTML="",Z.appendChild(we),ne.secondaryType?(C(Z,pe[ne.primaryType]||[],"create"),C(Z,pe[ne.secondaryType]||[],"update")):C(Z,pe[ne.primaryType]||[],"both"),!y(Z,de)&&ae){let Me=Array.from(Z.options).find(nt=>String(nt.value||"")===ae);Me?Z.value=Me.value:Z.selectedIndex=0}let ye=w(Z);x(Z,ye)},B=async(Z=!1)=>{if(!(!g||!_.length))try{let we=(await g.list({force:Z}))?.library||{};_.forEach(de=>{M(de,we)}),D(l())}catch(pe){console.error("Prompt library refresh failed:",pe)}},D=Z=>{_.length&&_.forEach(pe=>{let we=pe.getAttribute("data-aipkit-prompt-target"),de=a[we];if(!de)return;let ae=pe.options?pe.options[0]:null;if(!ae)return;if(Array.from(pe.options).forEach((Me,nt)=>{let se=Me.dataset.aipkitMode||"both",be=!0;nt!==0&&(Z==="existing-images"?be=se!=="create":be=se!=="update"),Me.hidden=!be}),pe.dataset.aipkitDefaultCreate||(pe.dataset.aipkitDefaultCreate=ae.value||""),Z==="existing-images"){let Me=c(de,Z);Me&&(pe.dataset.aipkitDefaultUpdate=Me,ae.value=Me)}else ae.value=pe.dataset.aipkitDefaultCreate||ae.value||"";pe.selectedOptions.length&&pe.selectedOptions[0].hidden&&(pe.selectedIndex=0);let ye=w(pe);x(pe,ye)})},W=Z=>Z?.querySelector(".aipkit_cw_prompt_editor_textarea")||null,U=Z=>{let pe=W(Z);pe&&(Z.dataset.aipkitPromptOpenValue=pe.value,Z.dataset.aipkitPromptDirty="false")},J=Z=>{let pe=W(Z);if(!pe)return!1;let we=typeof Z.dataset.aipkitPromptOpenValue=="string"?Z.dataset.aipkitPromptOpenValue:"";return pe.value!==we},oe=Z=>!Z||!J(Z)?!0:window.confirm(d),O=null,L=null,F=!1,N=Z=>Z?u.querySelector(`#${Z}`):null,R=(Z,pe,we)=>{if(!Z||!pe)return;let de=Z.getBoundingClientRect(),ae=we?we.getBoundingClientRect():de,ne=pe.getBoundingClientRect(),ye=ne.width||440,Me=ne.height||0,nt=window.innerWidth,se=window.innerHeight,be=12,xe=ae.left-ye-10;xe<be&&(xe=ae.right+10),xe=Math.max(be,Math.min(xe,nt-ye-be));let Re=ae.top;Re+Me>se-be&&(Re=se-Me-be),Re=Math.max(be,Re),O.style.left=`${Math.round(xe)}px`,O.style.top=`${Math.round(Re)}px`},H=()=>{!L||!O||F||(F=!0,window.requestAnimationFrame(()=>{let Z=O.querySelector(".aipkit_cw_prompt_panel"),pe=L.closest(".aipkit_model_settings_popover_panel");R(L,Z,pe),F=!1}))},K=()=>{O&&oe(O)&&(O.classList.remove("is-open"),O.setAttribute("aria-hidden","true"),L&&L.setAttribute("aria-expanded","false"),O=null,L=null)},re=Z=>{let pe=Z.getAttribute("data-aipkit-flyout-target"),we=N(pe);if(!we||O&&O!==we&&(K(),O))return;O=we,L=Z,we.classList.add("is-open"),we.setAttribute("aria-hidden","false"),Z.setAttribute("aria-expanded","true"),U(we),r(we);let de=we.querySelector(".aipkit_cw_prompt_panel"),ae=Z.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{R(Z,de,ae)})},ve=Z=>{let pe=Z&&typeof Z.message=="string"&&Z.message.trim()?Z.message.trim():"Prompt library request failed.";window.alert(pe)},Ie=()=>{typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()};p.forEach(Z=>{Z.dataset.flyoutListenerAttached!=="true"&&(Z.addEventListener("click",pe=>{if(pe.preventDefault(),O&&L===Z&&O.classList.contains("is-open")){K();return}re(Z)}),Z.dataset.flyoutListenerAttached="true")});let Ee=l();if(D(Ee),_.forEach(Z=>{let pe=Z.getAttribute("data-aipkit-prompt-target"),we=pe?u.querySelector(`#${pe}`):null;if(we&&typeof we.value=="string"&&we.value.trim()===""&&Z.value&&(we.value=Z.value),Z.dataset.promptLibraryAttached==="true")return;E(Z),x(Z,we),we&&we.dataset.promptEditorStateAttached!=="true"&&(we.addEventListener("input",()=>{O&&(O.dataset.aipkitPromptDirty=J(O)?"true":"false"),v()}),we.dataset.promptEditorStateAttached="true");let{applyButton:de,undoButton:ae}=h(Z);de&&de.dataset.promptLibraryAttached!=="true"&&(de.addEventListener("click",()=>{let se=String(Z.value||"");if(!se||!we||se===we.value){x(Z,we);return}m.set(we,we.value),we.value=se,we.dispatchEvent(new Event("input",{bubbles:!0})),Ie(),x(Z,we)}),de.dataset.promptLibraryAttached="true"),ae&&ae.dataset.promptLibraryAttached!=="true"&&(ae.addEventListener("click",()=>{if(!we||!m.has(we)){x(Z,we);return}let se=m.get(we);m.delete(we),we.value=se,we.dispatchEvent(new Event("input",{bubbles:!0})),Ie(),x(Z,we)}),ae.dataset.promptLibraryAttached="true");let{manageButton:ne,saveButton:ye,updateButton:Me,deleteButton:nt}=h(Z);ne&&ne.dataset.promptLibraryAttached!=="true"&&(ne.addEventListener("click",()=>{if(typeof window.aipkit_openPromptLibraryManager!="function")return;let se=I(Z),be=S(Z),xe=se.promptType||be,Re=se.isCustom&&se.promptId?se.promptId:"",De=String(se.label||"").replace(/\s+\(Custom\)\s*$/i,"").trim();window.aipkit_openPromptLibraryManager({promptType:xe,promptId:Re,label:De,promptText:String(we?.value||"")})}),ne.dataset.promptLibraryAttached="true"),ye&&ye.dataset.promptLibraryAttached!=="true"&&(ye.addEventListener("click",()=>{if(!g||!we||typeof window.aipkit_openPromptLibraryManager!="function")return;let se=S(Z);if(!se)return;let xe=(I(Z).label||"").replace(/\s+\(Custom\)\s*$/i,"").trim();window.aipkit_openPromptLibraryManager({action:"create",promptType:se,label:xe,promptText:String(we.value||"")})}),ye.dataset.promptLibraryAttached="true"),Me&&Me.dataset.promptLibraryAttached!=="true"&&(Me.addEventListener("click",()=>{if(!g||!we||typeof window.aipkit_openPromptLibraryManager!="function")return;let se=I(Z);if(!se.isCustom||!se.promptId){x(Z,we);return}let be=se.label.replace(/\s+\(Custom\)\s*$/i,"").trim(),xe=se.promptType||S(Z);xe&&window.aipkit_openPromptLibraryManager({action:"update",promptType:xe,promptId:se.promptId,label:be,promptText:String(we.value||"")})}),Me.dataset.promptLibraryAttached="true"),nt&&nt.dataset.promptLibraryAttached!=="true"&&(nt.addEventListener("click",async()=>{if(!g||!we)return;let se=I(Z);if(!se.isCustom||!se.promptId){x(Z,we);return}if(window.confirm("Delete the selected custom preset?")){nt.disabled=!0;try{await g.remove({promptId:se.promptId,promptType:se.promptType||S(Z)}),await B(!0),Z.selectedIndex=0,x(Z,we)}catch(xe){ve(xe)}finally{nt.disabled=!1}}}),nt.dataset.promptLibraryAttached="true"),Z.addEventListener("change",()=>{x(Z,we)}),Z.dataset.promptLibraryAttached="true"}),g&&_.length&&(B(!0),u.dataset.promptLibrarySyncAttached!=="true"&&(window.addEventListener("aipkit_prompt_library_updated",()=>{B(!0)}),u.dataset.promptLibrarySyncAttached="true")),u.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(Z=>{Z.dataset.overlayListenerAttached!=="true"&&(Z.addEventListener("click",we=>{we.target===Z&&K()}),Z.dataset.overlayListenerAttached="true");let pe=Z.querySelector(".aipkit_popover_flyout_close");pe&&pe.dataset.flyoutListenerAttached!=="true"&&(pe.addEventListener("click",we=>{we.preventDefault(),K()}),pe.dataset.flyoutListenerAttached="true")}),u.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",Z=>{Z.key==="Escape"&&O&&K()}),u.dataset.promptFlyoutEscapeAttached="true"),u.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",Z=>{if(!O)return;let pe=Z.target;pe.closest(".aipkit_cw_prompt_flyout")||pe.closest("[data-aipkit-flyout-target]")||K()}),u.dataset.promptFlyoutClickAttached="true"),u.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",H),window.addEventListener("scroll",H,!0),u.dataset.promptFlyoutRepositionAttached="true"),u.dataset.promptFlyoutModeAttached!=="true"){let Z=document.getElementById("aipkit_cw_mode_select");Z&&Z.addEventListener("change",()=>{D(l()),O&&r(O)}),u.dataset.promptFlyoutModeAttached="true"}window.aipkit_closeContentWriterPromptFlyout=K}window.aipkit_initContentWriterPromptFlyouts=f})();(function(){"use strict";let e=l=>String(l||"").replace(/\|/g," ").replace(/\r?\n/g," ").trim(),i=l=>{let c=String(l||"").trim();if(!c)return{value:"",raw:""};let o=c.match(/^(\d{4}-\d{2}-\d{2})(?:[T\s])(\d{2}:\d{2})(?::\d{2})?$/);return o?{value:`${o[1]}T${o[2]}`,raw:""}:{value:"",raw:c}},a=l=>l?l.replace("T"," ").trim():"";function s(l){let c=l||document.getElementById("aipkit_content_writer_container");if(!c)return;let o=c.querySelector("[data-aipkit-bulk-editor]");if(!o||o.dataset.bulkEditorAttached==="true")return;let t=o.querySelector("[data-aipkit-bulk-rows]"),r=o.querySelector("#aipkit_cw_bulk_row_template"),f=o.querySelector("#aipkit_cw_bulk_topics"),u=o.querySelector(".aipkit_cw_bulk_add_row"),p=o.querySelector(".aipkit_cw_bulk_toggle_raw"),_=o.querySelector("#aipkit_cw_bulk_raw"),m=o.querySelector(".aipkit_cw_bulk_grid"),g=o.querySelector(".aipkit_cw_bulk_toggle_details");if(!t||!r||!f)return;let d=!1,w,h=(B,D)=>B?B.querySelector(`[data-bulk-field="${D}"]`):null,b=()=>{Array.from(t.querySelectorAll("[data-aipkit-bulk-row]")).forEach((D,W)=>{let U=D.querySelector(".aipkit_cw_bulk_row_number");U&&(U.textContent=W+1)})},A=B=>{let D=e(h(B,"topic")?.value||""),W=e(h(B,"keywords")?.value||""),U=e(h(B,"category")?.value||""),J=e(h(B,"author")?.value||""),oe=e(h(B,"type")?.value||""),O=h(B,"schedule")?.value||"";return O?(O=a(O),B.dataset.rawSchedule=""):B.dataset.rawSchedule&&(O=B.dataset.rawSchedule),{topic:D,keywords:W,category:U,author:J,type:oe,schedule:O}},S=(B,D)=>{if(!B||!D)return;let W=(J,oe)=>{let O=h(B,J);O&&(O.value=oe||"")};W("topic",D.topic||""),W("keywords",D.keywords||""),W("category",D.category||""),W("author",D.author||""),W("type",D.type||"");let U=h(B,"schedule");if(U){let J=i(D.schedule||"");U.value=J.value,B.dataset.rawSchedule=J.raw||""}},I=()=>{let B=Array.from(t.querySelectorAll("[data-aipkit-bulk-row]")),D=[];return B.forEach(W=>{let{topic:U,keywords:J,category:oe,author:O,type:L,schedule:F}=A(W);if(!U)return;let N=[U,J,oe,O,L,F],R=-1;N.forEach((H,K)=>{H&&(R=K)}),R!==-1&&D.push(N.slice(0,R+1).join(" | "))}),D.join(`
`)},T=()=>{f&&(d=!0,f.value=I(),f.dispatchEvent(new Event("change",{bubbles:!0})),d=!1)},x=B=>{o.classList.toggle("is-details-open",B),g&&g.setAttribute("aria-expanded",B?"true":"false")},E=B=>{if(_){if(o.classList.toggle("is-raw-open",B),_.hidden=!B,p){p.setAttribute("aria-expanded",B?"true":"false");let D=B?p.dataset.labelGrid:p.dataset.labelRaw;if(D){let W=p.querySelector(".aipkit_cw_toggle_label");W?W.textContent=D:p.textContent=D}}m&&(m.hidden=B),u&&(u.hidden=B,u.disabled=B),g&&(g.hidden=B,B&&g.setAttribute("aria-expanded","false"))}},v=B=>{let W=document.importNode(r.content,!0).querySelector("[data-aipkit-bulk-row]");return W?(S(W,B||{}),W):null},y=()=>{let B=t.querySelectorAll("[data-aipkit-bulk-row]");if(B.length>=1)return;let D=1-B.length;for(let W=0;W<D;W++){let U=v();U&&t.appendChild(U)}},C=()=>{let B=Array.from(t.querySelectorAll("[data-aipkit-bulk-row]")),D=B[B.length-1];if(!D)return;let W=A(D);if(Object.values(W).some(J=>J)&&B.length<100){let J=v();J&&(t.appendChild(J),b())}},M=()=>{let D=(f.value||"").split(/\r?\n/).filter(U=>U.trim()!=="");t.innerHTML="";let W=[];if(D.slice(0,100).forEach(U=>{let J=U.split("|").map(L=>L.trim()),oe={topic:J[0]||"",keywords:J[1]||"",category:J[2]||"",author:J[3]||"",type:J[4]||"",schedule:J[5]||""},O=v(oe);O&&W.push(O)}),!W.length){y(),b(),T();return}W.forEach(U=>t.appendChild(U)),y(),b()};f.value.trim()?M():(y(),b(),T()),E(!_.hidden),g&&!g.dataset.listenerAttached&&(g.addEventListener("click",B=>{B.preventDefault();let D=o.classList.contains("is-details-open");x(!D)}),g.dataset.listenerAttached="true",x(!1)),t.addEventListener("input",B=>{let D=B.target;!D||!D.closest("[data-aipkit-bulk-row]")||(T(),C())}),t.addEventListener("change",B=>{let D=B.target;!D||!D.closest("[data-aipkit-bulk-row]")||(T(),C())}),t.addEventListener("click",B=>{let D=B.target.closest(".aipkit_cw_bulk_remove_row");if(!D)return;let W=D.closest("[data-aipkit-bulk-row]");if(!W)return;t.querySelectorAll("[data-aipkit-bulk-row]").length<=1?W.querySelectorAll("input, select").forEach(J=>{J.value=""}):W.remove(),T(),b(),C()}),u&&u.addEventListener("click",B=>{if(B.preventDefault(),t.querySelectorAll("[data-aipkit-bulk-row]").length>=100)return;let W=v();W&&t.appendChild(W),b()}),p&&_&&p.addEventListener("click",B=>{B.preventDefault();let D=!_.hidden;E(!D)}),f.addEventListener("input",()=>{d||(clearTimeout(w),w=setTimeout(()=>{M()},250))}),o.dataset.bulkEditorAttached="true"}window.aipkit_initContentWriterBulkEditor=s})();(function(){"use strict";let k=null,n=0;function e(){if(!k)return;let s=k;k=null,s.classList.remove("aipkit-active"),s.__aipkitAlertKeydown&&(document.removeEventListener("keydown",s.__aipkitAlertKeydown),s.__aipkitAlertKeydown=null);let l=()=>{s.parentNode&&s.parentNode.removeChild(s)};s.addEventListener("transitionend",l,{once:!0}),window.setTimeout(l,250)}function i(s,l={}){let c=l.title||"Notice",o=l.okText||"OK",t=l.okClass||"aipkit_btn-primary",r=Array.isArray(l.actions)?l.actions:null,f=Array.isArray(l.bullets)?l.bullets:null;k&&e();let u=document.createElement("div");u.className="aipkit-modal-overlay",u.addEventListener("click",I=>{I.target===u&&e()});let p=`aipkit_cw_alert_${Date.now()}_${n++}`,_=document.createElement("div");_.className="aipkit-modal-content aipkit_cw_alert_modal_content",_.setAttribute("role","dialog"),_.setAttribute("aria-modal","true"),_.setAttribute("aria-labelledby",`${p}_title`);let m=document.createElement("div");m.className="aipkit-modal-header";let g=document.createElement("h3");g.className="aipkit-modal-title",g.id=`${p}_title`,g.textContent=c;let d=document.createElement("button");d.type="button",d.className="aipkit-modal-close-btn",d.setAttribute("aria-label","Close"),d.textContent="\xD7",m.appendChild(g),m.appendChild(d);let w=document.createElement("div");w.className="aipkit-modal-body";let h=document.createElement("p");if(h.className="aipkit_cw_alert_modal_message",h.textContent=s||"",f&&f.length){let I=document.createElement("ul");I.className="aipkit_cw_alert_modal_list",f.forEach(T=>{let x=document.createElement("li");x.textContent=T,I.appendChild(x)}),w.appendChild(h),w.appendChild(I)}else w.appendChild(h);let b=document.createElement("div");b.className="aipkit_cw_alert_modal_actions";let A=null;if(r&&r.length)r.forEach((I,T)=>{let x=!!(I&&I.href),E=I?.label||(T===0?o:"Close"),v=I?.className||(T===0?"aipkit_btn aipkit_btn-primary":"aipkit_btn aipkit_btn-secondary"),y=document.createElement(x?"a":"button");y.className=v,y.textContent=E,x?(y.href=I.href,y.target=I.target||"_blank",y.rel=I.rel||"noopener noreferrer"):y.type="button";let C=()=>{typeof I?.onClick=="function"&&I.onClick(),I?.closeOnClick!==!1&&e()};y.addEventListener("click",C),b.appendChild(y),A||(A=y)});else{let I=document.createElement("button");I.type="button",I.className=`aipkit_btn ${t}`,I.textContent=o,I.addEventListener("click",e),b.appendChild(I),A=I}w.appendChild(b),_.appendChild(m),_.appendChild(w),u.appendChild(_),document.body.appendChild(u);let S=I=>{I.key==="Escape"&&e()};u.__aipkitAlertKeydown=S,document.addEventListener("keydown",S),d.addEventListener("click",e),window.requestAnimationFrame(()=>{u.classList.add("aipkit-active"),A&&A.focus()}),k=u}function a(s,l={}){let c=l.title||"Confirm",o=l.confirmText||"Confirm",t=l.secondaryText||"",r=l.cancelText||"Cancel",f=l.secondaryClass||"aipkit_btn aipkit_btn-danger",u=typeof l.onConfirm=="function"?l.onConfirm:null,p=typeof l.onSecondary=="function"?l.onSecondary:null,_=typeof l.onCancel=="function"?l.onCancel:null;k&&e();let m=document.createElement("div");m.className="aipkit-modal-overlay",m.addEventListener("click",y=>{y.target===m&&(e(),_&&_())});let g=`aipkit_cw_confirm_${Date.now()}_${n++}`,d=document.createElement("div");d.className="aipkit-modal-content aipkit_cw_alert_modal_content",d.setAttribute("role","dialog"),d.setAttribute("aria-modal","true"),d.setAttribute("aria-labelledby",`${g}_title`);let w=document.createElement("div");w.className="aipkit-modal-header";let h=document.createElement("h3");h.className="aipkit-modal-title",h.id=`${g}_title`,h.textContent=c;let b=document.createElement("button");b.type="button",b.className="aipkit-modal-close-btn",b.setAttribute("aria-label","Close"),b.textContent="\xD7",w.appendChild(h),w.appendChild(b);let A=document.createElement("div");A.className="aipkit-modal-body";let S=document.createElement("p");S.className="aipkit_cw_alert_modal_message",S.textContent=s||"";let I=document.createElement("div");I.className="aipkit_cw_alert_modal_actions";let T=document.createElement("button");T.type="button",T.className="aipkit_btn aipkit_btn-secondary",T.textContent=r;let x=document.createElement("button");x.type="button",x.className=f,x.textContent=t;let E=document.createElement("button");E.type="button",E.className="aipkit_btn aipkit_btn-primary",E.textContent=o,I.appendChild(T),t&&I.appendChild(x),I.appendChild(E),A.appendChild(S),A.appendChild(I),d.appendChild(w),d.appendChild(A),m.appendChild(d),document.body.appendChild(m);let v=y=>{y.key==="Escape"&&(e(),_&&_())};m.__aipkitAlertKeydown=v,document.addEventListener("keydown",v),b.addEventListener("click",()=>{e(),_&&_()}),T.addEventListener("click",()=>{e(),_&&_()}),t&&x.addEventListener("click",()=>{e(),p&&p()}),E.addEventListener("click",()=>{e(),u&&u()}),window.requestAnimationFrame(()=>{m.classList.add("aipkit-active"),E.focus()}),k=m}window.aipkit_showAlertModal=i,window.aipkit_showConfirmModal=a,window.aipkit_closeAlertModal=e})();(function(){"use strict";function k(n,e){if(!n||!e||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(n.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(n,e),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(n,e),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary();else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let i=window.aipkit_escapeHtml||function(a){return a};e.innerHTML='<option value="">'+i("Models unavailable (Data Object Missing)")+"</option>",e.disabled=!0}}window.aipkit_handleProviderModelDropdowns=k})();(function(){"use strict";function k(n){if(!n){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let e=document.getElementById("aipkit_content_writer_temperature_value");e?n.dataset.listenerAttached||(n.addEventListener("input",()=>e.textContent=n.value),n.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=k})();(function(){"use strict";function k(n){if(!n){console.warn("Copy Button Handler: Button element not provided.");return}n.dataset.listenerAttached||(n.addEventListener("click",()=>{let e=document.getElementById("aipkit_cw_generated_title_display"),i=document.getElementById("aipkit_cw_generated_content_area"),a="";e&&e.style.display!=="none"&&(a+=e.textContent+`

`),i&&(a+=i.innerText),a.trim()&&navigator.clipboard.writeText(a.trim()).then(()=>{let s=n.querySelector(".dashicons");if(s){let l=s.className;s.className="dashicons dashicons-yes",setTimeout(()=>{s.className=l},1500)}}).catch(s=>console.error("Failed to copy: ",s))}),n.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=k})();(function(){"use strict";function k(){let e=document.getElementById("aipkit_cw_single_output_wrapper"),i=document.getElementById("aipkit_cw_output_card"),a=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.querySelector(".aipkit_content_writer_output_actions"),c=document.getElementById("aipkit_cw_status_display_container"),o=document.getElementById("aipkit_cw_generated_title_display"),t=document.getElementById("aipkit_cw_meta_chunk"),r=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),f=document.getElementById("aipkit_cw_generated_meta_desc"),u=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),p=document.getElementById("aipkit_cw_generated_focus_keyword"),_=document.getElementById("aipkit_cw_excerpt_output_wrapper"),m=document.getElementById("aipkit_cw_generated_excerpt"),g=document.getElementById("aipkit_cw_tags_output_wrapper"),d=document.getElementById("aipkit_cw_generated_tags"),w=document.getElementById("aipkit_cw_image_data_holder"),h=document.getElementById("aipkit_content_writer_copy_btn"),b=document.getElementById("aipkit_content_writer_clear_btn");if(e&&(e.style.display="none"),i&&(i.style.display="none"),a&&s){s.classList.remove("is-streaming");let A=s.closest(".aipkit_cw_output_chunk--primary");A&&A.classList.remove("has-overflow"),s.innerHTML="",a.scrollTop=0,l&&(l.style.display="none"),h&&(h.disabled=!0),b&&(b.disabled=!0),typeof window.aipkit_resetContentWriterRawHtml=="function"&&window.aipkit_resetContentWriterRawHtml(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction();let S=document.getElementById("aipkit_content_writer_form_status");S&&(S.textContent=""),c&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():c&&(c.style.display="none"),o&&(o.style.display="none",o.textContent=""),t&&(t.style.display="none"),r&&(r.style.display="none"),f&&(f.value=""),u&&(u.style.display="none"),p&&(p.value=""),_&&(_.style.display="none"),m&&(m.value=""),g&&(g.style.display="none"),d&&(d.value=""),w&&(w.value=""),typeof window.aipkit_updateMetaCountBadge=="function"&&window.aipkit_updateMetaCountBadge(),typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_resetContentWriterPreviewCounter=="function"&&window.aipkit_resetContentWriterPreviewCounter()}}function n(e,i){if(!e){console.warn("Clear Button Handler: Button element not provided.");return}e.dataset.listenerAttached||(e.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),e.dataset.listenerAttached="true")}window.aipkit_handleClearButton=n,window.aipkit_clearContentWriterOutput=k})();(function(){"use strict";function k(){return document.getElementById("aipkit_cw_expand_preview_btn")}function n(t){return t?t.closest(".aipkit_cw_output_chunk--primary"):document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_chunk--primary")}function e(t,r,f){return t?r==="restore"?t.dataset.labelRestore||f:t.dataset.labelExpand||f:f}function i(t,r){if(!t)return;let f=t.querySelector(".aipkit_cw_expand_label"),u=t.querySelector(".dashicons"),p=r?e(t,"restore","Restore preview"):e(t,"expand","Expand preview");f&&(f.textContent=p),t.setAttribute("title",p),t.setAttribute("aria-pressed",r?"true":"false"),u&&(u.classList.toggle("dashicons-fullscreen-alt",!r),u.classList.toggle("dashicons-fullscreen-exit-alt",r))}function a(t){let r=document.getElementById("aipkit_content_writer_output_display");!r||!t||(r.scrollHeight>r.clientHeight?t.classList.add("has-overflow"):t.classList.remove("has-overflow"))}function s(t){let r=k(),f=n(r);!r||!f||(t?f.classList.add("is-expanded"):f.classList.remove("is-expanded"),i(r,t),requestAnimationFrame(()=>a(f)))}function l(t){let r=k();r&&(r.disabled=!t,r.setAttribute("aria-disabled",t?"false":"true"),t||s(!1))}function c(){s(!1)}function o(){document.body?.dataset?.aipkitPreviewToggleAttached!=="true"&&(document.addEventListener("click",t=>{let r=t.target.closest("#aipkit_cw_expand_preview_btn");if(!r||r.disabled)return;let f=n(r);if(!f)return;let u=f.classList.contains("is-expanded");s(!u)}),document.body&&(document.body.dataset.aipkitPreviewToggleAttached="true"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o(),window.aipkit_resetContentWriterPreviewSize=c,window.aipkit_setContentWriterPreviewExpandEnabled=l})();(function(){"use strict";let k=d=>!d||typeof d!="object"?"":d.media_library_url||d.url||d.src||d.image_url||d.preview_url||"",n=d=>d==null?"":String(d).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=()=>{if(typeof window.aipkit_getContentWriterRawHtml=="function")return window.aipkit_getContentWriterRawHtml()||"";let d=document.getElementById("aipkit_cw_generated_content_area");return d?d.innerHTML:""},i=()=>{let d=document.getElementById("aipkit_cw_generated_content_area");if(!d)return;let w=e();w&&(d.innerHTML=w)},a=()=>({preview:document.getElementById("aipkit_cw_image_preview"),featuredWrap:document.getElementById("aipkit_cw_featured_image"),featuredImg:document.getElementById("aipkit_cw_featured_image_img"),inlineToggle:document.getElementById("aipkit_cw_inline_images_toggle"),inlineCount:document.getElementById("aipkit_cw_inline_images_count"),inlineGrid:document.getElementById("aipkit_cw_inline_images_grid")}),s=(d,w,h="")=>{d&&(d.hidden=!w,w?d.style.display=h||"":d.style.display="none")},l=d=>{d&&(d.innerHTML="",s(d,!1,"grid"))},c=()=>{let d=a();d.preview&&(d.featuredImg&&d.featuredImg.removeAttribute("src"),s(d.featuredWrap,!1,"flex"),d.inlineToggle&&(d.inlineToggle.setAttribute("aria-expanded","false"),d.inlineToggle.classList.remove("is-open")),d.inlineCount&&(d.inlineCount.textContent="0"),l(d.inlineGrid),s(d.inlineToggle,!1,"inline-flex"),s(d.preview,!1,"flex"),i())},o=d=>{!d.inlineToggle||!d.inlineGrid||d.inlineToggle.dataset.listenerAttached!=="true"&&(d.inlineToggle.addEventListener("click",()=>{let w=d.inlineToggle.getAttribute("aria-expanded")==="true";d.inlineToggle.setAttribute("aria-expanded",w?"false":"true"),d.inlineToggle.classList.toggle("is-open",!w),s(d.inlineGrid,!w,"grid")}),d.inlineToggle.dataset.listenerAttached="true")},t=(d,w)=>{if(!d.inlineToggle||!d.inlineGrid||!w.length)return!1;l(d.inlineGrid);let h=document.createDocumentFragment();return w.forEach((b,A)=>{let S=document.createElement("div");S.className="aipkit_cw_inline_image";let I=document.createElement("img");I.src=b,I.alt=`Generated image ${A+1}`,I.loading="lazy",I.decoding="async",S.appendChild(I),h.appendChild(S)}),d.inlineGrid.appendChild(h),s(d.inlineGrid,!1,"grid"),s(d.inlineToggle,!0,"inline-flex"),d.inlineToggle.setAttribute("aria-expanded","false"),d.inlineToggle.classList.remove("is-open"),d.inlineCount&&(d.inlineCount.textContent=String(w.length)),o(d),!0},r=(d,w,h)=>{let b=k(d);if(!b)return"";let A=d.alt||d.revised_prompt||d.caption||"Image",S=[];return["left","right","center","none"].includes(w)&&S.push(`align${w}`),S.push(`size-${h||"large"}`),`<img class="${n(S.join(" "))}" src="${n(b)}" alt="${n(A)}" loading="lazy" decoding="async" />`},f=(d,w)=>w.length?`${d}

${w.join(`

`)}`:d,u=(d,w,h)=>{if(!w.length)return d;let b=w.shift(),A=d.toLowerCase(),S=`</${h}>`,I=A.indexOf(S);return I!==-1?d=d.slice(0,I+S.length)+`

${b}

`+d.slice(I+S.length):d+=`

${b}`,f(d,w)},p=(d,w,h,b)=>{if(!w.length)return d;if(!b||b<=0)return f(d,w);let A=d.split(new RegExp(`(</${h}>)`,"ig")),S="",I=0,T=0;for(let x=0;x<A.length;x+=1)S+=A[x],x%2===1&&(I+=1,I%b===0&&T<w.length&&(S+=`

${w[T]}

`,T+=1));for(;T<w.length;)S+=`

${w[T]}`,T+=1;return S},_=d=>{let w=document.getElementById("aipkit_cw_generated_content_area");if(!w)return;let h=Array.isArray(d?.in_content_images)?d.in_content_images:[];if(!h.length){i();return}let b=e();if(b||(b=w.innerHTML),!b)return;let A=document.getElementById("aipkit_content_writer_form"),S=d?.placement_settings?.placement||A?.elements.image_placement?.value||"after_first_h2",I=d?.placement_settings?.param_x||A?.elements.image_placement_param_x?.value||2,T=parseInt(I,10)||2,x=A?.elements.image_alignment?.value||"none",E=A?.elements.image_size?.value||"large",v=h.map(C=>r(C,x,E)).filter(Boolean);if(!v.length){i();return}let y=b;switch(S){case"after_first_h2":y=u(y,v,"h2");break;case"after_first_h3":y=u(y,v,"h3");break;case"after_every_x_h2":y=p(y,v,"h2",T);break;case"after_every_x_h3":y=p(y,v,"h3",T);break;case"after_every_x_p":y=p(y,v,"p",T);break;case"at_end":default:y=f(y,v);break}w.innerHTML=y,typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()},m=(d,w)=>!d.featuredWrap||!d.featuredImg||!w?!1:(d.featuredImg.src=w,s(d.featuredWrap,!0,"flex"),!0),g=d=>{let w=a();if(!w.preview)return;c();let h=d;if(typeof d=="string")try{h=JSON.parse(d)}catch{return}if(!h||typeof h!="object")return;let A=(Array.isArray(h.in_content_images)?h.in_content_images:[]).map(k).filter(Boolean),S=h.featured_image_url||k(h.featured_image)||k(h.featured_image_data),I=m(w,S),T=t(w,A);_(h),(I||T)&&s(w.preview,!0,"flex")};window.aipkit_renderContentWriterImagePreview=g,window.aipkit_clearContentWriterImagePreview=c})();(function(){"use strict";function k(){let e=document.getElementById("aipkit_content_writer_form");if(!e)return;let i=e.elements.generate_meta_description,a=e.elements.generate_focus_keyword,s=e.elements.generate_excerpt,l=e.elements.generate_tags,c=e.querySelector(".aipkit_cw_prompt_row--meta"),o=e.querySelector(".aipkit_cw_prompt_row--keyword"),t=e.querySelector(".aipkit_cw_prompt_row--excerpt"),r=e.querySelector(".aipkit_cw_prompt_row--tags"),f=!!(i&&i.checked),u=!!(a&&a.checked),p=!!(s&&s.checked),_=!!(l&&l.checked),m=(d,w)=>{if(!d)return;d.classList.toggle("aipkit_popover_option_row--disabled",!w);let h=d.querySelector(".aipkit_cw_prompt_trigger");h&&(h.disabled=!w,h.setAttribute("aria-disabled",w?"false":"true"))};m(c,f),m(o,u),m(t,p),m(r,_);let g=e.querySelector(".aipkit_cw_prompt_flyout.is-open");if(g){let d=[];f||d.push("aipkit_cw_meta_prompt_flyout"),u||d.push("aipkit_cw_keyword_prompt_flyout"),p||d.push("aipkit_cw_excerpt_prompt_flyout"),_||d.push("aipkit_cw_tags_prompt_flyout"),d.includes(g.id)&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout()}}function n(){let e=document.getElementById("aipkit_content_writer_form");if(!e||e.dataset.optionToggleListenerAttached)return;let i=e.elements.generate_meta_description,a=e.elements.generate_focus_keyword,s=e.elements.generate_excerpt,l=e.elements.generate_tags;i&&i.addEventListener("change",k),a&&a.addEventListener("change",k),s&&s.addEventListener("change",k),l&&l.addEventListener("change",k),e.dataset.optionToggleListenerAttached="true",k()}window.aipkit_cw_toggleCustomOptionPrompts=k,window.aipkit_cw_initOptionPromptToggles=n})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_container");if(!n){console.warn("Prompt Toggle Handler: Content writer container not found.");return}n.querySelectorAll(".aipkit_textarea_toggle").forEach(a=>{let s=a.dataset.target;if(!s)return;let l=`aipkit-cw-prompt-${s}-state`,c=localStorage.getItem(l),o=document.getElementById(s),t=a.querySelector(".dashicons");o&&t&&(c==="expanded"?(o.classList.remove("aipkit_collapsed"),t.classList.remove("dashicons-plus-alt2"),t.classList.add("dashicons-minus"),a.title="Collapse"):(o.classList.add("aipkit_collapsed"),t.classList.remove("dashicons-minus"),t.classList.add("dashicons-plus-alt2"),a.title="Expand"))});let i="data-prompt-toggle-listener-attached";n.getAttribute(i)||(n.addEventListener("click",function(a){let s=a.target.closest(".aipkit_textarea_toggle");if(!s)return;let l=s.dataset.target,c=document.getElementById(l),o=s.querySelector(".dashicons");if(!c||!o){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",s);return}let t=c.classList.toggle("aipkit_collapsed");t?(o.classList.remove("dashicons-minus"),o.classList.add("dashicons-plus-alt2"),s.title="Expand"):(o.classList.remove("dashicons-plus-alt2"),o.classList.add("dashicons-minus"),s.title="Collapse");let r=`aipkit-cw-prompt-${l}-state`;localStorage.setItem(r,t?"collapsed":"expanded")}),n.setAttribute(i,"true"))}window.aipkit_initPromptToggles=k})();(function(){"use strict";let k="";function n(u){k=typeof u=="string"?u:""}function e(){return k||""}function i(){k=""}function a(){let u=document.getElementById("aipkit_cw_meta_chunk");if(!u)return;let p=!1;u.querySelectorAll(".aipkit_cw_meta_field").forEach(m=>{window.getComputedStyle(m).display!=="none"&&(p=!0)}),u.style.display=p?"block":"none"}function s(){let u=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");u&&(u.style.display="flex")}function l(){let u=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");u&&(u.style.display="none")}function c(){let u=document.getElementById("aipkit_cw_article_counter"),p=document.getElementById("aipkit_cw_generated_content_area");if(!u||!p)return;if(p.querySelector(".aipkit_spinner")){u.textContent="",u.hidden=!0;return}let m=(p.textContent||"").trim(),g=m?m.split(/\s+/).length:0;if(!g){u.textContent="",u.hidden=!0;return}let d=g===1?"word":"words";u.textContent=`${g} ${d}`,u.hidden=!1}function o(){let u=document.getElementById("aipkit_cw_generated_content_area");if(!u)return;let p=!1,_=()=>{p||(p=!0,window.requestAnimationFrame(()=>{p=!1,c()}))};new MutationObserver(()=>{_()}).observe(u,{childList:!0,subtree:!0,characterData:!0}),_()}function t(){let u=document.getElementById("aipkit_cw_generated_meta_desc"),p=document.querySelector("#aipkit_content_writer_container .aipkit_cw_meta_char_count");if(!u||!p)return;function _(){let m=u.value.length,g=m>=120&&m<=160;p.textContent=`${m}/160`,p.style.color=g?"#16a34a":m>160?"#dc2626":"#94a3b8"}u.addEventListener("input",_),_()}function r(){if(!document.getElementById("aipkit_cw_meta_chunk"))return;let p=new MutationObserver(function(m){m.forEach(function(g){g.type==="attributes"&&g.attributeName==="style"&&a()})});["aipkit_cw_excerpt_output_wrapper","aipkit_cw_tags_output_wrapper","aipkit_cw_focus_keyword_output_wrapper","aipkit_cw_meta_desc_output_wrapper"].forEach(m=>{let g=document.getElementById(m);g&&p.observe(g,{attributes:!0,attributeFilter:["style"]})})}function f(){t(),r(),o()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f(),window.aipkit_updateMetaChunkVisibility=a,window.aipkit_showPrimaryAction=s,window.aipkit_hidePrimaryAction=l,window.aipkit_updateContentWriterPreviewCounter=c,window.aipkit_setContentWriterRawHtml=n,window.aipkit_getContentWriterRawHtml=e,window.aipkit_resetContentWriterRawHtml=i,window.aipkit_resetContentWriterPreviewCounter=function(){let u=document.getElementById("aipkit_cw_article_counter");u&&(u.textContent="",u.hidden=!0)}})();(function(){"use strict";function k(c){if(!c)return;let o=c.querySelector("#aipkit_content_writer_provider"),t=c.querySelector("#aipkit_content_writer_model"),r=c.querySelector(".aipkit_cw_reasoning_effort_field"),f=c.querySelector("#aipkit_content_writer_reasoning_effort");if(!o||!t||!r||!f){r&&(r.style.display="none");return}let u=(o.value||"").toLowerCase(),_=(t.value||"").toLowerCase();u==="openai"&&e(_)?(r.classList.contains("aipkit_popover_option_row")||r.classList.contains("aipkit_ai_behavior_control")?r.style.display="flex":r.style.display="block",n(c,_)):r.style.display="none"}function n(c,o){let t=c.querySelector("#aipkit_content_writer_reasoning_effort"),r=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!t||!r.length)return;let f=a(o),u=new Set(f.allowed);r.forEach(d=>{let w=d.querySelector(".aipkit_ai_reasoning_input");if(!w)return;let h=w.value==="minimal"?"low":w.value,b=u.has(h);d.style.display=b?"":"none",b||(w.checked=!1)});let p=t.value||"";p==="minimal"&&(p="low");let _=c.querySelector(".aipkit_ai_reasoning_input:checked");!u.has(p)&&_&&(p=_.value),u.has(p)||(p=f.defaultValue),u.has(p)||(p=f.allowed[0]||"");let m=t.value;p&&(t.value=p);let g=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(g){g.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(w=>w.classList.remove("aipkit_ai_reasoning_option--selected"));let d=g.closest(".aipkit_ai_reasoning_option");d&&d.classList.add("aipkit_ai_reasoning_option--selected")}m!==t.value&&t.dispatchEvent(new Event("change",{bubbles:!0}))}function e(c){if(i(c))return!1;let o=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),t=c.includes("gpt-5");return o||t}function i(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let o=c.match(/gpt-5\.(\d+)/);if(o)return Number.parseInt(o[1],10)>=2;let t=c.match(/gpt-(\d+)/);return t?Number.parseInt(t[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_cw_toggleReasoningEffort=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(g){return g},n=["pexels_api_key","pixabay_api_key"],e={},i={},a="",s=!1,l=!1,c="";function o(g){n.forEach(d=>{let w=g.querySelector(`.aipkit_cw_stock_api_key[name="${CSS.escape(d)}"]`);e[d]=w?w.value.trim():"",i[d]=!1})}function t(g){let d=g.querySelector("#aipkit_cw_replicate_api_key");a=d?d.value.trim():"",s=!1}async function r(g){if(!g||!g.name)return;let d=g.name;if(!n.includes(d))return;let w=g.value.trim(),h=e[d]||"";if(w===h||i[d]||typeof window.aipkit_apiRequest!="function")return;let b=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,A=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,S=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;i[d]=!0,e[d]=w,b&&b("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[d]:w}),A&&A("Updated")}catch(I){e[d]=h,S&&S(`Error: ${I.message||"Failed to save."}`),console.error("Content Writer Stock Image Key Save Error:",I)}finally{i[d]=!1}}async function f(g){if(!g)return;let d=g.value.trim(),w=a||"";if(d===w||s||typeof window.aipkit_apiRequest!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,b=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,A=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;s=!0,a=d,h&&h("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:d}),b&&b("Updated"),u(d,!0)}catch(S){a=w,A&&A(`Error: ${S.message||"Failed to save."}`),console.error("Content Writer Replicate Key Save Error:",S)}finally{s=!1}}function u(g,d=!1){let w=(g||"").trim();if(!w||l||!d&&w===c||typeof window.aipkit_queueProviderSync!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,b=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,A=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;l=!0,h&&h("Syncing models..."),window.aipkit_queueProviderSync("Replicate",{silent:!0,targetSelectId:"aipkit_cw_image_model",propagateError:!0}).then(()=>{c=w,b&&b("Models synced!")}).catch(S=>{A&&A(`Error: ${S.message||"Sync failed."}`),console.error("Content Writer Replicate Sync Error:",S)}).finally(()=>{l=!1})}function p(g){let d=document.getElementById("aipkit_cw_image_model");if(!d)return;let w=window.aipkit_dashboard?.imageGeneratorModels;if(!w){console.error("Image models data not found in aipkit_dashboard object."),d.innerHTML='<option value="">Error: Models not loaded</option>';return}let h=w[g.toLowerCase()]||[],b=window.aipkit_cw_template_state?.pendingImageModelSelection,A=d.value,S=b||A;d.innerHTML="",h.length>0?(h.forEach(I=>{d.appendChild(new Option(I.name,I.id))}),d.querySelector(`option[value="${CSS.escape(S)}"]`)?d.value=S:d.options.length>0&&(d.selectedIndex=0)):d.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function _(){let g=document.getElementById("aipkit_content_writer_container");if(!g)return;let d=g.querySelector(".aipkit_cw_image_enable_toggle"),w=g.querySelector("#aipkit_cw_generate_featured_image"),h=g.querySelector("#aipkit_cw_image_placement"),b=g.querySelector("#aipkit_cw_image_provider"),A=document.getElementById("aipkit_content_writer_form"),S=A?A.classList.contains("aipkit_cw_mode_existing_images"):!1,I=g.querySelectorAll(".aipkit_cw_image_settings_container"),T=g.querySelector(".aipkit_cw_prompt_row--image"),x=g.querySelector(".aipkit_cw_prompt_row--featured"),E=g.querySelector(".aipkit_cw_image_metadata_chunk"),v=Array.from(g.querySelectorAll(".aipkit_cw_image_metadata_subtoggle")).map(K=>{let re=K.closest(".aipkit_image_toggle_card");return{toggle:K,button:re?re.querySelector(".aipkit_cw_image_metadata_prompt_btn"):null}});if(!d||!w)return;let y=K=>K?K.closest(".aipkit_popover_option_row")||K.closest(".aipkit_form-group"):null,C=(K,re)=>{K&&(re?K.style.display=K.classList.contains("aipkit_popover_option_row")?"flex":"block":K.style.display="none")},M=d.checked,B=w.checked,D=M||B||S,W=b?b.value:"",U=W==="pexels"||W==="pixabay";I.forEach(K=>{K.style.display=D?"block":"none"});let J=M&&!U,oe=B&&!U,O=(K,re)=>{if(!K)return;K.style.display="",K.classList.toggle("aipkit_popover_option_row--disabled",!re);let ve=K.querySelector(".aipkit_cw_prompt_trigger");ve&&(ve.disabled=!re,ve.setAttribute("aria-disabled",re?"false":"true"))};O(T,J),O(x,oe);let L=S||D;if(E&&(E.style.display=L?"block":"none"),E){let K=E.querySelector(".aipkit_image_settings_chunk_header--collapsible"),re=E.querySelector(".aipkit_image_settings_chunk_body--collapsible");if(K&&re){let ve=S;K.setAttribute("aria-expanded",ve?"true":"false"),re.setAttribute("aria-hidden",ve?"false":"true")}}v.length>0&&v.forEach(({toggle:K,button:re})=>{let ve=L&&K.checked;re&&(re.disabled=!ve,re.setAttribute("aria-disabled",ve?"false":"true"))});let F=g.querySelector(".aipkit_cw_prompt_flyout.is-open"),N=F?g.querySelector(`.aipkit_cw_image_metadata_prompt_btn[data-aipkit-flyout-target="${CSS.escape(F.id)}"]`):null,R=N?N.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_cw_image_metadata_subtoggle"):null,H=R&&L?R.checked:!1;if(F&&(F.id==="aipkit_cw_image_prompt_flyout"&&!J||F.id==="aipkit_cw_featured_image_prompt_flyout"&&!oe||R&&!H&&["aipkit_cw_image_title_prompt_flyout","aipkit_cw_image_alt_text_prompt_flyout","aipkit_cw_image_caption_prompt_flyout","aipkit_cw_image_description_prompt_flyout"].includes(F.id))&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),D){let K=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],re=g.querySelector("#aipkit_cw_replicate_options"),ve=g.querySelector("#aipkit_cw_pexels_options"),Ie=g.querySelector("#aipkit_cw_pixabay_options"),Ee=g.querySelector("#aipkit_cw_image_model_group");if(K.forEach(pe=>{let we=g.querySelector(pe),de=y(we);C(de,M)}),h){let pe=g.querySelector(".aipkit_cw_image_placement_x_field");if(pe){let we=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(h.value);C(pe,M&&we)}}re&&(re.style.display=W==="replicate"?"block":"none"),ve&&(ve.style.display=U&&W==="pexels"?"block":"none"),Ie&&(Ie.style.display=U&&W==="pixabay"?"block":"none"),Ee&&(Ee.style.display=U?"none":"");let Z=g.querySelector("#aipkit_cw_image_model_wrapper");if(Z&&(Z.style.display=U?"none":""),!U&&W&&p(W),W==="replicate"){let pe=g.querySelector("#aipkit_cw_replicate_api_key");u(pe?pe.value:"",!1)}}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}function m(){let g=document.getElementById("aipkit_content_writer_container");g&&(g.dataset.imageHandlerAttached||(o(g),t(g),g.addEventListener("change",function(d){let w=d.target;if(w&&w.matches(".aipkit_cw_stock_api_key")){r(w);return}if(w&&w.matches(".aipkit_cw_replicate_api_key")){f(w);return}w.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider, .aipkit_cw_image_metadata_subtoggle")&&_()}),g.addEventListener("click",function(d){let w=d.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!w)return;let h=w.getAttribute("aria-expanded")==="true",b=w.getAttribute("aria-controls"),A=b?document.getElementById(b):null;w.setAttribute("aria-expanded",h?"false":"true"),A&&A.setAttribute("aria-hidden",h?"true":"false")}),_(),g.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=m,window.aipkit_updateImageSettingsUI=_})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(c){return c};function n(c){if(!c)return;let o=c.querySelector(".aipkit_cw_vector_store_toggle"),t=c.querySelectorAll(".aipkit_cw_vector_store_settings_container");if(o&&t.length>0){let r=o.checked;t.forEach(f=>{f.style.display=r?"block":"none"}),r&&e(c)}}function e(c){if(!c)return;let o=c.querySelector(".aipkit_cw_vector_store_provider_select");if(!o)return;let t=o.value,r=c.querySelector(".aipkit_cw_vector_openai_field"),f=c.querySelector(".aipkit_cw_vector_pinecone_field"),u=c.querySelector(".aipkit_cw_vector_qdrant_field"),p=c.querySelector(".aipkit_cw_vector_embedding_config_row"),_=(m,g)=>{m&&(m.style.display=g?"block":"none")};if(_(r,t==="openai"),_(f,t==="pinecone"),_(u,t==="qdrant"),p){let m=t==="pinecone"||t==="qdrant";if(p.style.display=m?"block":"none",m){let g=p.querySelector(".aipkit_cw_vector_embedding_provider_select");g&&i(g.value)}}}function i(c){let o=document.getElementById("aipkit_cw_vector_embedding_model");if(!o)return;let r=(window.aipkit_dashboard?.embeddingModels||{})[c.toLowerCase()]||[],f=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";o.innerHTML=`<option value="">${k("-- Select Model --")}</option>`,r.length>0?(r.forEach(u=>{if(u&&u.id){let p=new Option(k(u.name||u.id),u.id);u.id===f&&(p.selected=!0),o.appendChild(p)}}),o.disabled=!1):(o.disabled=!0,o.innerHTML=`<option value="">${k("-- No models found --")}</option>`)}function a(c){if(!c)return;let o=c.getAttribute("aria-expanded")==="true",t=c.getAttribute("aria-controls"),r=document.getElementById(t);r&&(c.setAttribute("aria-expanded",!o),r.setAttribute("aria-hidden",o))}function s(c){if(!c)return;let o=document.getElementById(c.id+"_value");if(!o)return;let t=c.value;c.id==="aipkit_cw_vector_store_confidence_threshold"&&(t=t+"%"),o.textContent=t}function l(){let c=document.getElementById("aipkit_content_writer_container");if(!c||c.dataset.vectorSettingsHandlerAttached)return;c.addEventListener("change",function(t){let r=t.target;if(r.matches(".aipkit_cw_vector_store_toggle")){let f=r.closest(".aipkit_vector_settings_redesigned")||r.closest(".aipkit_popover_options_list")||c;n(f)}else if(r.matches(".aipkit_cw_vector_store_provider_select")){let f=r.closest(".aipkit_vector_settings_redesigned")||r.closest(".aipkit_cw_vector_store_settings_container")||c;e(f)}else r.matches(".aipkit_cw_vector_embedding_provider_select")&&i(r.value);typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),c.addEventListener("input",function(t){let r=t.target;r.matches(".aipkit_vector_slider")&&s(r)}),c.addEventListener("click",function(t){let f=t.target.closest(".aipkit_vector_settings_chunk_header--collapsible");f&&(t.preventDefault(),a(f))}),c.querySelectorAll(".aipkit_vector_settings_redesigned, .aipkit_popover_options_list").forEach(t=>{t.querySelector(".aipkit_cw_vector_store_toggle")&&n(t)}),c.querySelectorAll(".aipkit_vector_slider").forEach(t=>{s(t)}),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),c.dataset.vectorSettingsHandlerAttached="true"}window.aipkit_initContentWriterVectorSettings=l,window.aipkit_cw_toggleVectorSettingsContainer=n,window.aipkit_cw_toggleProviderSpecificFields=e,window.aipkit_cw_populateEmbeddingModelSelect=i})();(function(){"use strict";function k(c){if(!c)return;let o=c.querySelector("#aipkit_content_writer_post_status"),t=c.querySelector(".aipkit_post_smart_schedule_container");if(!o)return;let r=o.value==="publish";t&&(t.style.display=r?"block":"none"),r&&n(c)}function n(c){if(!c)return;let o=c.querySelector('input[name="schedule_mode"]:checked'),t=c.querySelector(".aipkit_post_smart_schedule_fields");if(!t)return;let r=o&&o.value==="smart";t.style.display=r?"flex":"none"}function e(c){if(!c)return;let o=c.getAttribute("aria-expanded")==="true",t=c.getAttribute("aria-controls"),r=document.getElementById(t);r&&(c.setAttribute("aria-expanded",!o),r.setAttribute("aria-hidden",o))}function i(c){if(!c)return;let o=c.querySelector("#aipkit_content_writer_post_status");o&&(o.addEventListener("change",()=>{k(c)}),k(c)),c.querySelectorAll('input[name="schedule_mode"]').forEach(r=>{r.addEventListener("change",()=>{n(c)})}),n(c)}function a(){document.addEventListener("click",c=>{let o=c.target.closest(".aipkit_post_settings_chunk_header--collapsible");if(o){c.preventDefault(),e(o);return}}),document.addEventListener("keydown",c=>{if(c.key!=="Enter"&&c.key!==" ")return;let o=c.target.closest(".aipkit_post_settings_chunk_header--collapsible");o&&(c.preventDefault(),e(o))})}function s(c){let o=c.target;if(!o||!o.id||o.id!=="aipkit_cw_post_settings_popover")return;let t=o.querySelector(".aipkit_post_settings_redesigned");t&&!t.dataset.postSettingsInitialized&&(i(t),t.dataset.postSettingsInitialized="true")}function l(){a(),document.addEventListener("aipkit:popover:opened",s),document.querySelectorAll(".aipkit_post_settings_redesigned").forEach(t=>{t.dataset.postSettingsInitialized||(i(t),t.dataset.postSettingsInitialized="true")}),new MutationObserver(t=>{t.forEach(r=>{if(r.type==="attributes"&&r.attributeName==="aria-hidden"){let f=r.target.closest("#aipkit_cw_post_settings_popover");if(f&&r.target.getAttribute("aria-hidden")==="false"){let u=f.querySelector(".aipkit_post_settings_redesigned");u&&!u.dataset.postSettingsInitialized&&(i(u),u.dataset.postSettingsInitialized="true")}}})}).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["aria-hidden"]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),window.aipkit_initPostSettingsHandler=i})();(function(){"use strict";function k(n){let e=n||document.getElementById("aipkit_content_writer_container");if(!e)return;let i=e.querySelectorAll("[data-aipkit-vector-stores-dropdown]");i.length&&i.forEach(a=>{let s=a.closest(".aipkit_popover_option_main"),l=a.closest(".aipkit_cw_vector_openai_field"),c=s||l,o=c?c.querySelector(".aipkit_popover_multiselect_select"):null;if(!o)return;let t=a.querySelector(".aipkit_popover_multiselect_btn"),r=a.querySelector(".aipkit_popover_multiselect_label"),f=a.querySelector(".aipkit_popover_multiselect_panel"),u=a.querySelector(".aipkit_popover_multiselect_options"),p=a.dataset.placeholder||"Select stores",_=a.dataset.selectedLabel||"selected",m=()=>{if(!r)return;let b=Array.from(o.options).filter(S=>S.selected&&S.value);if(!b.length){r.textContent=p;return}let A=b.map(S=>S.textContent.trim()).filter(Boolean);if(A.length<=2){r.textContent=A.join(", ");return}r.textContent=`${A.length} ${_}`},g=()=>{if(!u)return;u.innerHTML="";let b=Array.from(o.options),A=b.filter(S=>S.value);if(!A.length){let S=document.createElement("div");S.className="aipkit_popover_multiselect_empty",S.textContent=b[0]?.textContent||"-- No Stores Found --",u.appendChild(S),m();return}A.forEach(S=>{let I=document.createElement("label");I.className="aipkit_popover_multiselect_item";let T=document.createElement("input");T.type="checkbox",T.value=S.value,T.checked=S.selected,T.disabled=S.disabled;let x=document.createElement("span");x.className="aipkit_popover_multiselect_text",x.textContent=S.textContent,I.appendChild(T),I.appendChild(x),u.appendChild(I)}),m()},d=()=>{if(!u){m();return}let b=new Set(Array.from(o.options).filter(A=>A.selected).map(A=>A.value));u.querySelectorAll('input[type="checkbox"]').forEach(A=>{A.checked=b.has(A.value)}),m()},w=b=>{if(!u)return;let A=Array.from(u.querySelectorAll('input[type="checkbox"]:checked'));if(A.length>2){let I=b&&b.target;if(I&&I.checked)I.checked=!1;else{let T=A[A.length-1];T&&(T.checked=!1)}}let S=Array.from(u.querySelectorAll('input[type="checkbox"]:checked')).map(I=>I.value);Array.from(o.options).forEach(I=>{I.selected=S.includes(I.value)}),o.dispatchEvent(new Event("change",{bubbles:!0})),m()},h=b=>{!a||!t||(a.classList.toggle("is-open",b),t.setAttribute("aria-expanded",b?"true":"false"),f&&(f.hidden=!b))};g(),d(),a.dataset.vectorStoreMultiselectAttached||(t&&(t.addEventListener("click",b=>{b.preventDefault(),h(!a.classList.contains("is-open"))}),t.addEventListener("keydown",b=>{b.key==="Escape"&&h(!1)})),document.addEventListener("click",b=>{a.classList.contains("is-open")&&(a.contains(b.target)||h(!1))}),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",w),u.dataset.listenerAttached="true"),o.dataset.listenerAttached||(o.addEventListener("change",d),o.dataset.listenerAttached="true"),a.dataset.vectorStoreMultiselectAttached="true")})}window.aipkit_initContentWriterVectorStoreMultiSelect=k})();(function(){"use strict";function k(n){let e=n||document.getElementById("aipkit_content_writer_container");if(!e)return;let i=e.querySelectorAll("[data-aipkit-categories-dropdown]");i.length&&i.forEach(a=>{let s=a.closest(".aipkit_popover_option_main"),l=a.closest(".aipkit_post_taxonomy_row"),c=s||l,o=c?c.querySelector('select[name="post_categories[]"]'):null;if(!o)return;let t=a.querySelector(".aipkit_popover_multiselect_btn"),r=a.querySelector(".aipkit_popover_multiselect_label"),f=a.querySelector(".aipkit_popover_multiselect_panel"),u=a.querySelector(".aipkit_popover_multiselect_options"),p=a.dataset.placeholder||"Select categories",_=a.dataset.selectedLabel||"selected",m=()=>{if(!r)return;let b=Array.from(o.options).filter(S=>S.selected&&S.value);if(!b.length){r.textContent=p;return}let A=b.map(S=>S.textContent.trim()).filter(Boolean);if(A.length<=2){r.textContent=A.join(", ");return}r.textContent=`${A.length} ${_}`},g=()=>{if(!u)return;u.innerHTML="";let b=Array.from(o.options),A=b.filter(S=>S.value);if(!A.length){let S=document.createElement("div");S.className="aipkit_popover_multiselect_empty",S.textContent=b[0]?.textContent||"-- No Categories --",u.appendChild(S),m();return}A.forEach(S=>{let I=document.createElement("label");I.className="aipkit_popover_multiselect_item";let T=document.createElement("input");T.type="checkbox",T.value=S.value,T.checked=S.selected,T.disabled=S.disabled;let x=document.createElement("span");x.className="aipkit_popover_multiselect_text",x.textContent=S.textContent,I.appendChild(T),I.appendChild(x),u.appendChild(I)}),m()},d=()=>{if(!u){m();return}let b=new Set(Array.from(o.options).filter(A=>A.selected).map(A=>A.value));u.querySelectorAll('input[type="checkbox"]').forEach(A=>{A.checked=b.has(A.value)}),m()},w=()=>{if(!u)return;let b=Array.from(u.querySelectorAll('input[type="checkbox"]:checked')).map(A=>A.value);Array.from(o.options).forEach(A=>{A.selected=b.includes(A.value)}),o.dispatchEvent(new Event("change",{bubbles:!0})),m()},h=b=>{!a||!t||(a.classList.toggle("is-open",b),t.setAttribute("aria-expanded",b?"true":"false"),f&&(f.hidden=!b))};g(),d(),a.dataset.categoriesMultiselectAttached||(t&&(t.addEventListener("click",b=>{b.preventDefault(),h(!a.classList.contains("is-open"))}),t.addEventListener("keydown",b=>{b.key==="Escape"&&h(!1)})),document.addEventListener("click",b=>{a.classList.contains("is-open")&&(a.contains(b.target)||h(!1))}),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",w),u.dataset.listenerAttached="true"),o.dataset.listenerAttached||(o.addEventListener("change",d),o.dataset.listenerAttached="true"),a.dataset.categoriesMultiselectAttached="true")})}window.aipkit_initContentWriterCategoriesMultiSelect=k})();(function(){"use strict";let k=" \xB7 ",n=t=>{if(!t)return"";let r=t.options?t.options[t.selectedIndex]:null;return r?r.textContent.trim():""},e=t=>!t||!t.options?[]:Array.from(t.options).filter(r=>r.selected&&r.value).map(r=>r.textContent.trim()).filter(Boolean),i=(t,r)=>{let f=t.filter(Boolean);return f.length?f.join(k):r},a=(t,r)=>{if(!t)return;t.textContent=r,t.title=r;let f=t.closest(".aipkit_cw_settings_summary_text");f&&(f.title=r);let u=t.dataset.aipkitPlaceholder,p=t.dataset.aipkitDisabledLabel,_="active";p&&r===p?_="disabled":u&&r===u&&(_="placeholder"),t.dataset.aipkitSummaryState=_},s=t=>String(t||"").trim().toLowerCase(),l=(t,r,f=null)=>{if(!t)return;let u="aipkit_settings_select_picker_icon--";t.classList.forEach(g=>{g.startsWith(u)&&t.classList.remove(g)});let p=s(r),_=!f||f.includes(p),m=!!(p&&_);t.hidden=!m,m&&t.classList.add(`${u}${p}`)},c=t=>{if(!t)return;let r=document.getElementById("aipkit_content_writer_form"),f=r?r.classList.contains("aipkit_cw_mode_existing_images"):!1,u=t.querySelector('[data-aipkit-cw-summary="ai"]');if(u){let g=u.dataset.aipkitPlaceholder||"Not set",d=n(t.querySelector("#aipkit_content_writer_provider")),w=n(t.querySelector("#aipkit_content_writer_model"));a(u,i([w],g));let h=t.querySelector("#aipkit_content_writer_provider")?.value,b=u.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon");l(b,h)}let p=t.querySelector('[data-aipkit-cw-summary="images"]');if(p){let g=p.dataset.aipkitPlaceholder||"Not set",d=p.dataset.aipkitDisabledLabel||"Disabled",w=["#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description"],h=t.querySelector("#aipkit_cw_generate_images_enabled"),b=t.querySelector("#aipkit_cw_generate_featured_image"),A=h&&h.checked||b&&b.checked,S=t.querySelector("#aipkit_cw_image_provider"),I=S?S.value:"",T=n(S),x=n(t.querySelector("#aipkit_cw_image_model")),E=p.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_settings_select_picker_icon"),v=["openai","google","azure","replicate"];if(l(E,I,v),f){l(E,"",v);let y=w.map(C=>{let M=t.querySelector(C);if(!M||!M.checked)return"";let B=M.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_image_toggle_label");return B?B.textContent.trim():""}).filter(Boolean);a(p,i(y,d||g))}else A?v.includes(I)?a(p,i([x],g)):["pexels","pixabay"].includes(I)?a(p,i([T],g)):a(p,i([T,x],g)):(l(E,"",v),a(p,d))}let _=t.querySelector('[data-aipkit-cw-summary="vector"]');if(_){let g=_.dataset.aipkitPlaceholder||"Not set",d=_.dataset.aipkitDisabledLabel||"Disabled",w=t.querySelector("#aipkit_cw_enable_vector_store"),h=_.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon"),b=["openai","pinecone","qdrant"];if(w&&!w.checked)l(h,"",b),a(_,d);else{let A=t.querySelector("#aipkit_cw_vector_store_provider"),S=A?A.value:"",I="";if(S==="openai"){let T=t.querySelector("#aipkit_cw_openai_vector_store_ids");I=e(T).join(", ")}else S==="pinecone"?I=n(t.querySelector("#aipkit_cw_pinecone_index_name")):S==="qdrant"&&(I=n(t.querySelector("#aipkit_cw_qdrant_collection_name")));l(h,S,b),a(_,i([I],g))}}let m=t.querySelector('[data-aipkit-cw-summary="post"]');if(m){let g=m.dataset.aipkitPlaceholder||"Not set",d=n(t.querySelector("#aipkit_content_writer_post_status"));a(m,i([d],g))}};function o(t){let r=t||document.getElementById("aipkit_content_writer_container");if(!r||r.dataset.cwSummaryAttached==="true")return;let f=["#aipkit_content_writer_provider","#aipkit_content_writer_model","#aipkit_cw_generate_images_enabled","#aipkit_cw_generate_featured_image","#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description","#aipkit_cw_image_provider","#aipkit_cw_image_model","#aipkit_cw_enable_vector_store","#aipkit_cw_vector_store_provider","#aipkit_cw_openai_vector_store_ids","#aipkit_cw_pinecone_index_name","#aipkit_cw_qdrant_collection_name","#aipkit_content_writer_categories","#aipkit_content_writer_post_author","#aipkit_content_writer_post_status"],u=p=>f.some(_=>p.matches(_));r.addEventListener("change",p=>{let _=p.target;!_||!u(_)||c(r)}),c(r),r.dataset.cwSummaryAttached="true"}window.aipkit_initContentWriterSettingsSummary=o,window.aipkit_updateContentWriterSettingsSummary=function(){let t=document.getElementById("aipkit_content_writer_container");c(t)}})();(function(){"use strict";let k=window.wp?.i18n?.__||function(y){return y},n="#aipkit_content_writer_provider, #aipkit_content_writer_model, #aipkit_cw_image_provider, #aipkit_cw_image_model, #aipkit_task_cw_image_provider, #aipkit_task_cw_image_model, #aipkit_cw_vector_store_provider, #aipkit_cw_vector_embedding_provider, #aipkit_task_cw_vector_store_provider, #aipkit_task_ce_vector_store_provider, #aipkit_task_cw_vector_embedding_provider, #aipkit_task_ce_vector_embedding_provider, #aipkit_task_content_indexing_target_store_provider, #aipkit_enhancer_insert_position_default, #aipkit_cw_pinecone_index_name, #aipkit_cw_qdrant_collection_name, #aipkit_cw_vector_embedding_model, #aipkit_task_cw_ai_provider, #aipkit_task_cw_ai_model, #aipkit_task_cc_ai_provider, #aipkit_task_cc_ai_model, #aipkit_task_ce_ai_provider, #aipkit_task_ce_ai_model",e=null,i=null,a=!1,s=new Set(["aipkit_content_writer_provider","aipkit_cw_image_provider","aipkit_cw_vector_store_provider","aipkit_cw_vector_embedding_provider","aipkit_task_cw_image_provider","aipkit_task_cw_vector_store_provider","aipkit_task_ce_vector_store_provider","aipkit_task_cw_vector_embedding_provider","aipkit_task_ce_vector_embedding_provider","aipkit_task_content_indexing_target_store_provider","aipkit_task_cw_ai_provider","aipkit_task_cc_ai_provider","aipkit_task_ce_ai_provider"]),l=y=>!!(y&&y.id&&s.has(y.id)),c=y=>!!(y&&y.dataset?.aipkitPickerIcons==="assistant-position"),o=y=>!!(y&&(l(y)||c(y)||y.id==="aipkit_cw_pinecone_index_name"||y.id==="aipkit_cw_qdrant_collection_name"||y.id==="aipkit_cw_vector_embedding_model")),t=(y,C)=>{if(!y)return!1;let M=r(C);return M?y.id==="aipkit_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(M):y.id==="aipkit_task_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(M):y.id==="aipkit_cw_vector_store_provider"?["openai","pinecone","qdrant"].includes(M):y.id==="aipkit_task_cw_vector_store_provider"||y.id==="aipkit_task_ce_vector_store_provider"||y.id==="aipkit_task_content_indexing_target_store_provider"?["openai","pinecone","qdrant"].includes(M):y.id==="aipkit_cw_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(M):y.id==="aipkit_task_cw_vector_embedding_provider"||y.id==="aipkit_task_ce_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(M):["openai","openrouter","claude","google","azure","deepseek","ollama"].includes(M):!1},r=y=>String(y||"").trim().toLowerCase(),f=(y,C,M)=>{if(!y)return;let B="aipkit_settings_select_picker_icon--";y.classList.forEach(U=>{U.startsWith(B)&&y.classList.remove(U)});let D=r(M),W=t(C,D);y.hidden=!W,W&&y.classList.add(`${B}${D}`)},u=(y,C)=>{if(!y)return;let M="aipkit_settings_select_picker_icon--assistant-";y.classList.forEach(D=>{D.startsWith(M)&&y.classList.remove(D)});let B=String(C||"").trim().toLowerCase();y.hidden=!B,B&&y.classList.add(`${M}${B}`)},p=y=>y&&(y.selectedOptions&&y.selectedOptions.length?y.selectedOptions[0]:y.querySelector("option[selected]"))?.dataset?.icon||"",_=y=>{if(!y)return"";let C=y.getAttribute("data-aipkit-picker-title");if(C)return C;let M=y.id&&document.querySelector(`label[for="${y.id}"]`)||y.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return M?M.textContent.trim():""},m=y=>{if(!y)return"";let C=y.selectedOptions&&y.selectedOptions.length?y.selectedOptions[0]:y.querySelector("option[selected]");if(C)return C.textContent.trim();let M=y.querySelector("option");return M?M.textContent.trim():""},g=y=>({buttonId:`${y}_picker_btn`,labelId:`${y}_picker_label`,popoverId:`${y}_picker_popover`,titleId:`${y}_picker_title`,searchId:`${y}_picker_search`,listId:`${y}_picker_list`}),d=y=>y?y.closest("#aipkit_cw_builder_sheet")||y.closest("#aipkit_content_writer_container")||y.closest("#aipkit_autogpt_container")||y.closest("#aipkit_ai_forms_container"):null,w=y=>{if(!y||!y.id)return null;let C=g(y.id),M=d(y);if(!M)return null;let B=document.getElementById(C.buttonId);if(!B){if(B=document.createElement("button"),B.type="button",B.id=C.buttonId,B.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",B.setAttribute("data-aipkit-popover-target",C.popoverId),B.setAttribute("aria-controls",C.popoverId),B.setAttribute("aria-expanded","false"),B.dataset.aipkitPopoverPlacement="bottom",l(y)){B.classList.add("aipkit_settings_select_picker_btn--provider");let J=document.createElement("span");J.className="aipkit_settings_select_picker_icon",J.setAttribute("aria-hidden","true"),f(J,y,y.value),B.appendChild(J)}else if(c(y)){let J=document.createElement("span");J.className="aipkit_settings_select_picker_icon",J.setAttribute("aria-hidden","true"),u(J,p(y)),B.appendChild(J)}let W=document.createElement("span");W.className="aipkit_settings_select_picker_label",W.id=C.labelId,W.textContent=m(y)||k("Select","gpt3-ai-content-generator");let U=document.createElement("span");U.className="dashicons dashicons-arrow-down-alt2",U.setAttribute("aria-hidden","true"),B.appendChild(W),B.appendChild(U),y.insertAdjacentElement("beforebegin",B)}y.classList.contains("screen-reader-text")||y.classList.add("screen-reader-text");let D=document.getElementById(C.popoverId);if(!D){D=document.createElement("div"),D.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",D.id=C.popoverId,D.setAttribute("aria-hidden","true"),l(y)&&D.classList.add("aipkit_settings_select_picker_popover--provider");let W=document.createElement("div");W.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",W.setAttribute("role","dialog"),W.setAttribute("aria-labelledby",C.titleId);let U=document.createElement("div");U.className="aipkit_model_settings_popover_header";let J=document.createElement("span");J.className="aipkit_model_settings_popover_title",J.id=C.titleId,J.textContent=_(y)||k("Select","gpt3-ai-content-generator");let oe=document.createElement("button");oe.type="button",oe.className="aipkit_model_settings_popover_close",oe.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),oe.innerHTML='<span class="dashicons dashicons-no-alt"></span>',U.appendChild(J),U.appendChild(oe);let O=document.createElement("div");O.className="aipkit_model_settings_popover_body";let L=document.createElement("div");L.className="aipkit_settings_select_picker_search";let F=document.createElement("input");F.type="search",F.id=C.searchId,F.className="aipkit_form-input";let N=_(y),R=N?`Search ${N.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");F.setAttribute("placeholder",R),L.appendChild(F);let H=document.createElement("div");H.className="aipkit_settings_select_picker_list",H.id=C.listId,H.setAttribute("role","listbox"),O.appendChild(L),O.appendChild(H),W.appendChild(U),W.appendChild(O),D.appendChild(W),M.appendChild(D),o(y)&&(L.style.display="none")}return{ids:C,button:B,popover:D,label:document.getElementById(C.labelId),search:document.getElementById(C.searchId),list:document.getElementById(C.listId)}},h=y=>{let C=[];return y&&Array.from(y.children).forEach(B=>{if(B.tagName==="OPTGROUP"){let D=Array.from(B.children).filter(W=>W.tagName==="OPTION").map(W=>({value:W.value,label:W.textContent.trim(),disabled:W.disabled,selected:W.selected,icon:W.dataset?.icon||""}));C.push({label:B.label,options:D})}else B.tagName==="OPTION"&&C.push({label:"",options:[{value:B.value,label:B.textContent.trim(),disabled:B.disabled,selected:B.selected,icon:B.dataset?.icon||""}]})}),C},b=(y,C,M="")=>{if(!y||!C)return;C.innerHTML="";let B=h(y),D=M.trim().toLowerCase(),W=!1;if(B.forEach(U=>{let J=U.options.filter(oe=>D?oe.label.toLowerCase().includes(D):!0);if(J.length){if(U.label){let oe=document.createElement("div");oe.className="aipkit_settings_select_picker_group_label",oe.textContent=U.label,C.appendChild(oe)}J.forEach(oe=>{let O=document.createElement("button");if(O.type="button",O.className="aipkit_settings_select_picker_item",oe.disabled&&O.classList.add("is-disabled"),oe.selected&&O.classList.add("is-active"),O.dataset.value=oe.value,l(y)&&t(y,oe.value)){let N=document.createElement("span");N.className="aipkit_settings_select_picker_icon",N.setAttribute("aria-hidden","true"),f(N,y,oe.value),O.appendChild(N)}else if(c(y)&&oe.icon){let N=document.createElement("span");N.className="aipkit_settings_select_picker_icon",N.setAttribute("aria-hidden","true"),u(N,oe.icon),O.appendChild(N)}let L=document.createElement("span");L.className="aipkit_settings_select_picker_text",L.textContent=oe.label||oe.value;let F=document.createElement("span");F.className="dashicons dashicons-yes aipkit_settings_select_picker_check",F.setAttribute("aria-hidden","true"),O.appendChild(L),O.appendChild(F),C.appendChild(O),W=!0})}}),!W){let U=document.createElement("div");U.className="aipkit_settings_select_picker_empty",U.textContent=k(D?"No matches found.":"No options available.","gpt3-ai-content-generator"),C.appendChild(U)}},A=(y,C)=>{if(!y||!C)return;let M=m(y);if(C.textContent=M||k("Select","gpt3-ai-content-generator"),l(y)){let B=C.closest("button"),D=B?B.querySelector(".aipkit_settings_select_picker_icon"):null;f(D,y,y.value)}else if(c(y)){let B=C.closest("button"),D=B?B.querySelector(".aipkit_settings_select_picker_icon"):null;u(D,p(y))}},S=(y,C)=>{if(!y||!C)return;let M=y.getBoundingClientRect(),B=C.getBoundingClientRect(),D=B.width||320,W=B.height||0,U=window.innerWidth,J=window.innerHeight,oe=12;if(y.dataset.aipkitPopoverPlacement==="bottom"){let F=M.left;F+D>U-oe&&(F=M.right-D),F=Math.max(oe,Math.min(F,U-D-oe));let N=M.bottom+8;N+W>J-oe&&(N=M.top-W-8),N=Math.max(oe,Math.min(N,J-W-oe)),C.style.left=`${Math.round(F)}px`,C.style.top=`${Math.round(N)}px`;return}let O=M.right+10;O+D>U-oe&&(O=M.left-D-10),O=Math.max(oe,Math.min(O,U-D-oe));let L=M.top;L+W>J-oe&&(L=J-W-oe),L=Math.max(oe,L),C.style.left=`${Math.round(O)}px`,C.style.top=`${Math.round(L)}px`},I=()=>{!e||!i||a||(a=!0,window.requestAnimationFrame(()=>{let y=e.querySelector(".aipkit_model_settings_popover_panel");S(i,y),a=!1}))},T=()=>{e&&(e.classList.remove("aipkit-active"),e.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),e=null,i=null)},x=(y,C,M)=>{if(!y||!C)return;e&&e!==C&&T(),e=C,i=y,C.classList.add("aipkit-active"),C.setAttribute("aria-hidden","false"),y.setAttribute("aria-expanded","true");let B=C.querySelector(".aipkit_settings_select_picker_search input"),D=C.querySelector(".aipkit_settings_select_picker_list");D&&b(M,D,B?B.value:""),B&&B.offsetParent!==null&&(B.focus(),B.select());let W=C.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{S(y,W)})},E=(y,C)=>{if(!y||!C)return;let{button:M,popover:B,list:D,search:W}=C;if(M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("click",U=>{if(U.preventDefault(),e===B){T();return}x(M,B,y)}),M.dataset.pickerListenerAttached="true"),B&&B.dataset.overlayListenerAttached!=="true"){B.addEventListener("click",J=>{J.target===B&&T()});let U=B.querySelector(".aipkit_model_settings_popover_close");U&&U.addEventListener("click",J=>{J.preventDefault(),T()}),B.dataset.overlayListenerAttached="true"}if(D&&D.dataset.pickerListenerAttached!=="true"&&(D.addEventListener("click",U=>{let J=U.target.closest(".aipkit_settings_select_picker_item");if(!J||J.classList.contains("is-disabled"))return;let oe=J.dataset.value??"";y.value=oe,y.dispatchEvent(new Event("change",{bubbles:!0})),A(y,C.label),b(y,D,W?W.value:""),T()}),D.dataset.pickerListenerAttached="true"),W&&W.dataset.pickerListenerAttached!=="true"&&(W.addEventListener("input",()=>{b(y,D,W.value)}),W.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("change",()=>{A(y,C.label),b(y,D,W?W.value:"")}),y.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerObserverAttached!=="true"){let U=!1;new MutationObserver(()=>{U||(U=!0,window.requestAnimationFrame(()=>{A(y,C.label),b(y,D,W?W.value:""),U=!1}))}).observe(y,{childList:!0,subtree:!0}),y.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitContentWriterPickerEscapeBound||(document.addEventListener("keydown",U=>{U.key==="Escape"&&e&&T()}),document.body.dataset.aipkitContentWriterPickerEscapeBound="true"),document.body.dataset.aipkitContentWriterPickerRepositionBound||(window.addEventListener("resize",I),window.addEventListener("scroll",I,!0),document.body.dataset.aipkitContentWriterPickerRepositionBound="true")};function v(){let y=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);y.length&&y.forEach(C=>{let M=C.querySelectorAll(n);M.length&&M.forEach(B=>{if(!B.id||B.dataset.aipkitPickerInit==="true")return;let D=w(B);D&&(A(B,D.label),b(B,D.list,D.search?D.search.value:""),E(B,D),B.dataset.aipkitPickerInit="true")})})}window.aipkit_initContentWriterSelectPickers=v,window.aipkit_refreshContentWriterSelectPickers=function(){let y=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);y.length&&y.forEach(C=>{let M=C.querySelectorAll(n);M.length&&M.forEach(B=>{if(!B.id)return;let D=w(B);D&&(A(B,D.label),b(B,D.list,D.search?D.search.value:""),E(B,D),B.dataset.aipkitPickerInit="true")})})}})();(function(){"use strict";function k(c){c||(c=document.getElementById("aipkit_content_writer_container")),c&&(n(c),i(c),a(c))}function n(c){let o=c.querySelectorAll(".aipkit_ai_reasoning_input"),t=c.querySelector("#aipkit_content_writer_reasoning_effort");!o.length||!t||(o.forEach(r=>{r.addEventListener("change",function(){if(this.checked){t.value=this.value,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(p=>{p.classList.remove("aipkit_ai_reasoning_option--selected")});let f=this.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected");let u=new Event("change",{bubbles:!0});t.dispatchEvent(u)}})}),e(c))}function e(c){let o=c.querySelector("#aipkit_content_writer_reasoning_effort");if(!o)return;let t=o.value||"medium";t==="minimal"&&(t="low");let r=c.querySelector(`.aipkit_ai_reasoning_input[value="${t}"]`);if(r&&!r.checked){r.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>{u.classList.remove("aipkit_ai_reasoning_option--selected")});let f=r.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}}function i(c){let o=c.querySelector("#aipkit_content_writer_temperature"),t=c.querySelector("#aipkit_content_writer_temperature_value");!o||!t||o.dataset.enhancedListenerAttached!=="true"&&(o.addEventListener("input",function(){t.textContent=this.value}),o.dataset.enhancedListenerAttached="true")}function a(c){let o=c.querySelector("#aipkit_content_writer_content_length_slider"),t=c.querySelector("#aipkit_content_writer_content_length_value"),r=c.querySelector("#aipkit_content_writer_content_length_hint"),f=c.querySelector("#aipkit_content_writer_content_length");if(!o||!t||!r||!f||o.dataset.enhancedListenerAttached==="true")return;let u=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],p="medium",_=d=>{let w=u.findIndex(h=>h.key===d);return w===-1?u.findIndex(h=>h.key===p):w},m=d=>{let w=_(d),h=u[w];t.textContent=h.label,r.textContent=`Approx. ${h.words} words`,o.value=String(w+1)},g=(d,w=!1)=>{let h=u.some(b=>b.key===d)?d:p;f.value!==h&&(f.value=h),m(h),w&&f.dispatchEvent(new Event("change",{bubbles:!0}))};o.addEventListener("input",function(){let d=Math.max(1,Math.min(3,parseInt(this.value,10)))-1,w=u[d]?.key||p;g(w,!0)}),f.addEventListener("change",function(){g(this.value,!1)}),g(f.value||p,!1),o.dataset.enhancedListenerAttached="true"}function s(c,o){if(!c||!o)return;let t=c.querySelector("#aipkit_content_writer_reasoning_effort");t&&(t.value=o==="minimal"?"low":o);let r=c.querySelector(`.aipkit_ai_reasoning_input[value="${o==="minimal"?"low":o}"]`);if(r){r.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>{u.classList.remove("aipkit_ai_reasoning_option--selected")});let f=r.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}}function l(c){if(!c)return"medium";let o=c.querySelector(".aipkit_ai_reasoning_input:checked");if(o)return o.value;let t=c.querySelector("#aipkit_content_writer_reasoning_effort");return t?t.value:"medium"}window.aipkit_initAiSettingsRedesigned=k,window.aipkit_setReasoningEffort=s,window.aipkit_getReasoningEffort=l})();(function(){"use strict";function k(n,e,i,a,s,l){if(typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(n,e):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(i):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(s):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(l,s):console.error("Content Writer UI: handleClearButton function not found."),typeof window.aipkit_initContentWriterSettingsSummary=="function"?window.aipkit_initContentWriterSettingsSummary():console.error("Content Writer UI: initContentWriterSettingsSummary function not found."),typeof window.aipkit_initContentWriterSelectPickers=="function"?window.aipkit_initContentWriterSelectPickers():console.error("Content Writer UI: initContentWriterSelectPickers function not found."),typeof window.aipkit_initAiSettingsRedesigned=="function"){let c=document.getElementById("aipkit_content_writer_container");window.aipkit_initAiSettingsRedesigned(c)}}window.aipkit_initContentWriterUI=k})();(function(){"use strict";let k={intervalId:null,startTime:null};function n(c){let o=Math.floor(c/1e3),t=Math.floor(o/60),r=o%60;return`${t}:${String(r).padStart(2,"0")}`}function e(c){if(!c)return null;let o=c.querySelector(".aipkit_cw_btn_timer");if(o)return o;o=document.createElement("span"),o.className="aipkit_cw_btn_timer",o.setAttribute("aria-hidden","true"),o.hidden=!0;let t=c.querySelector(".aipkit_btn-text");return t?c.insertBefore(o,t):c.insertBefore(o,c.firstChild),o}function i(c){if(!c||k.intervalId)return;let o=e(c);if(!o)return;k.startTime=Date.now();let t=()=>{let r=Date.now()-k.startTime;o.textContent=n(r),o.hidden=!1};t(),k.intervalId=window.setInterval(t,1e3)}function a(c){k.intervalId&&(clearInterval(k.intervalId),k.intervalId=null),k.startTime=null;let o=e(c);o&&(o.hidden=!0,o.textContent="")}function s(c){let o=document.getElementById("aipkit_content_writer_generate_btn");if(!o)return;let t=o.closest(".aipkit_cw_generate_split"),r=t?t.querySelector(".aipkit_cw_generate_toggle"):null,f=t?t.querySelector(".aipkit_cw_generate_menu"):null,u=f?Array.from(f.querySelectorAll(".aipkit_cw_generate_menu_item")):[],p=document.getElementById("aipkit_content_writer_stop_btn");if(c){if(o.dataset.aipkitStopMode="true",t&&t.classList.add("is-single"),i(o),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(o,"Stop");else{let _=o.querySelector(".aipkit_btn-text");_?_.textContent="Stop":o.textContent="Stop"}o.disabled=!1,o.removeAttribute("aria-disabled"),o.style.display="inline-flex",r&&(r.style.display="none",r.disabled=!0),f&&(f.hidden=!0),u.length&&u.forEach(_=>{_.disabled=!0,_.setAttribute("aria-disabled","true")}),p&&(p.style.display="none");return}o.dataset.aipkitStopMode&&delete o.dataset.aipkitStopMode,a(o),t&&t.classList.remove("is-single"),r&&(r.style.display="",r.disabled=!1,r.removeAttribute("aria-disabled")),u.length&&u.forEach(_=>{_.disabled=!1,_.removeAttribute("aria-disabled")}),p&&(p.style.display="none")}function l(){let c=document.getElementById("aipkit_content_writer_generate_btn"),o=document.getElementById("aipkit_content_writer_stop_btn"),t=c?.dataset?.action||"generate",f={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",update:"Update"}[t]||"Generate";c&&(a(c),c.dataset.aipkitStopMode&&delete c.dataset.aipkitStopMode,typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(c,!1,f):(c.disabled=!1,c.textContent=f),c.style.display="inline-flex"),o&&(o.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()}window.aipkit_setContentWriterStopMode=s,window.aipkit_resetContentWriterButtons=l})();(function(){"use strict";function k(n){n.current&&(n.current.close(),n.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let e=document.getElementById("aipkit_cw_generated_content_area"),i=document.getElementById("aipkit_content_writer_output_display"),a=document.querySelector(".aipkit_content_writer_output_actions"),s=document.getElementById("aipkit_content_writer_copy_btn"),l=document.getElementById("aipkit_content_writer_clear_btn");e&&(e.textContent.trim().length>0||!!e.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))&&(!i||!i.classList.contains("aipkit_content_writer_output_error"))?(a&&(a.style.display="flex"),s&&(s.disabled=!1),l&&(l.disabled=!1),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_showPrimaryAction=="function"&&window.aipkit_showPrimaryAction(),typeof window.aipkit_updateMetaChunkVisibility=="function"&&window.aipkit_updateMetaChunkVisibility(),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(a&&(a.style.display="none"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=k})();(function(){"use strict";function k(l,c,o,t){let r=l.querySelector("[data-csv-upload-zone]"),f=l.querySelector("[data-csv-status]"),u=l.querySelector("[data-csv-status-card]"),p=l.querySelector("[data-csv-status-icon]"),_=l.querySelector("[data-csv-file-name]"),m=l.querySelector("[data-csv-message]");if(!(!f||!u)){if(c==="idle"){r&&r.classList.remove("is-hidden"),f.hidden=!0;return}if(r&&r.classList.add("is-hidden"),f.hidden=!1,u.dataset.status=c,p){let g="dashicons-yes-alt";c==="loading"&&(g="dashicons-update"),c==="error"&&(g="dashicons-warning"),p.innerHTML=`<span class="dashicons ${g}" aria-hidden="true"></span>`;let d=p.querySelector(".dashicons");d&&c==="loading"&&(d.style.animation="aipkit_csv_spin 1s linear infinite")}_&&t?_.textContent=t:_&&(_.textContent=""),m&&(m.textContent=o||"")}}async function n(l){let c=l.target,o=c.closest(".aipkit_csv_import_container")||c.closest(".aipkit_form-group");if(!o)return;let t=o.querySelector("[data-csv-status]")!==null,r=o.querySelector(".aipkit_csv_analysis_results"),f=o.querySelector(".aipkit_csv_data_holder"),u=document.getElementById("aipkit_content_writer_nonce"),p=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,_=u?u.value:p;if(!f||!_){console.error("CSV Handler: Missing data holder or nonce field."),t?k(o,"error","Error: A required component is missing.",null):r&&(r.textContent="Error: A required UI component or security token is missing.",r.className="aipkit_form-help aipkit_settings_message-error");return}let m=c.files[0];if(!m){t?k(o,"idle",null,null):r&&(r.textContent="Please select a CSV file first.",r.className="aipkit_form-help aipkit_settings_message-error");return}if(!m.name.toLowerCase().endsWith(".csv")){t?k(o,"error","Invalid file type. Please upload a .csv file.",m.name):r&&(r.textContent="Invalid file type. Please upload a .csv file.",r.className="aipkit_form-help aipkit_settings_message-error");return}t?k(o,"loading","Parsing CSV...",m.name):r&&(r.textContent="Parsing CSV...",r.className="aipkit_form-help aipkit_settings_message-info");let g=new FormData;g.append("file",m),g.append("_ajax_nonce",_),g.append("action","aipkit_content_writer_parse_csv");try{let d=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:g,credentials:"same-origin"});if(!d.ok){let b=`Server returned status ${d.status}`;try{let A=await d.json();A&&A.data&&A.data.message&&(b=A.data.message)}catch{}throw new Error(b)}let w=await d.json();if(!w.success)throw new Error(w.data?.message||"Unknown server error.");let h=w.data;if(h.tasks_found>0){f.value=h.formatted_data;let A=c.id==="aipkit_task_cw_csv_file_input"||!!c.closest("#aipkit_autogpt_container")?`Found ${h.tasks_found} ${h.tasks_found===1?"topic":"topics"}. Ready to save the task.`:`Found ${h.tasks_found} ${h.tasks_found===1?"topic":"topics"}. Hit Generate to proceed.`;t?k(o,"success",A,m.name):r&&(r.textContent=`Success! Found ${h.tasks_found} topics in the CSV file. Ready.`,r.className="aipkit_form-help aipkit_settings_message-success")}else{f.value="";let b="No valid topics found in the CSV file.";t?k(o,"error",b,m.name):r&&(r.textContent=b,r.className="aipkit_form-help aipkit_settings_message-error")}}catch(d){f.value="";let w=d.message||"Failed to parse CSV file.";t?k(o,"error",w,m.name):r&&(r.textContent=`Error: ${w}`,r.className="aipkit_form-help aipkit_settings_message-error"),console.error("CSV Parse Error:",d)}}function e(l){let c=l.target.closest("[data-csv-clear]");if(!c)return;let o=c.closest(".aipkit_csv_import_container");if(!o)return;let t=o.querySelector("input[type='file']"),r=o.querySelector(".aipkit_csv_data_holder");t&&(t.value=""),r&&(r.value=""),k(o,"idle",null,null)}function i(l){if(!l||l.dataset.dragDropAttached==="true")return;let c=f=>{f.preventDefault(),f.stopPropagation()},o=()=>l.classList.add("is-dragover"),t=()=>l.classList.remove("is-dragover"),r=f=>{c(f),t();let p=f.dataTransfer.files;if(p.length>0){let _=l.querySelector("input[type='file']");if(_){let m=new DataTransfer;m.items.add(p[0]),_.files=m.files,_.dispatchEvent(new Event("change",{bubbles:!0}))}}};["dragenter","dragover","dragleave","drop"].forEach(f=>{l.addEventListener(f,c,!1)}),["dragenter","dragover"].forEach(f=>{l.addEventListener(f,o,!1)}),["dragleave","drop"].forEach(f=>{l.addEventListener(f,t,!1)}),l.addEventListener("drop",r,!1),l.dataset.dragDropAttached="true"}function a(){let l=document.getElementById("aipkit_cw_csv_file_input");if(!l||l.dataset.listenerAttached==="true")return;l.addEventListener("change",n),l.dataset.listenerAttached="true";let c=l.closest(".aipkit_csv_import_container");if(c){let o=c.querySelector(".aipkit_csv_dropzone");i(o);let t=c.querySelector("[data-csv-clear]");t&&t.dataset.listenerAttached!=="true"&&(t.addEventListener("click",e),t.dataset.listenerAttached="true")}}function s(){let l=document.getElementById("aipkit_task_cw_csv_file_input");if(!l||l.dataset.listenerAttached==="true")return;l.addEventListener("change",n),l.dataset.listenerAttached="true";let c=l.closest(".aipkit_csv_import_container");if(c){let o=c.querySelector(".aipkit_csv_dropzone");i(o);let t=c.querySelector("[data-csv-clear]");t&&t.dataset.listenerAttached!=="true"&&(t.addEventListener("click",e),t.dataset.listenerAttached="true")}}window.aipkit_initCsvUploadHandler=a,window.aipkit_initTaskCsvUploadHandler=s})();(function(){"use strict";function k(n,e){let i=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!i||!i.value)throw new Error("Security token missing for stream. Please reload.");let a=new URL(window.aipkit_dashboard.ajaxurl);a.searchParams.append("action","aipkit_frontend_chat_stream"),a.searchParams.append("cache_key",n),a.searchParams.append("_ajax_nonce",i.value),e.current&&e.current.close();try{let s=new EventSource(a.toString());return s.userStopped=!1,s}catch(s){throw console.error("EventSource Connection Setup: EventSource creation error:",s),new Error("Could not connect to stream. "+s.message)}}window.aipkit_stream_setupEventSourceConnection=k})();(function(){"use strict";function k(e){let i=e.parentElement,a=i?.closest(".aipkit_cw_output_chunk--primary");a&&(i.scrollHeight>i.clientHeight?a.classList.add("has-overflow"):a.classList.remove("has-overflow"))}function n(e,i,a,s){if(e.data)try{let l=JSON.parse(e.data);if(l.delta){if(i.fullContent+=l.delta,a.classList.contains("is-streaming")||a.classList.add("is-streaming"),!s&&typeof window.aipkit_getMarkdownRenderer=="function"&&(s=window.aipkit_getMarkdownRenderer()),s)a.innerHTML=s.render(i.fullContent);else{let o=a.textContent||"";a.textContent=o+l.delta}typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(a.innerHTML);let c=a.parentElement;c&&c.scrollTo({top:c.scrollHeight,behavior:"smooth"}),k(a),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()}}catch(l){console.error("Stream Message Handler: Error parsing event data.",l)}}window.aipkit_stream_handleMessage=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(e){return e};async function n(e,i,a,s,l,c){if(i.isDone)return;i.isDone=!0,c&&c.current&&(c.current.close(),c.current=null),a.classList.contains("is-streaming")&&a.classList.remove("is-streaming"),!s&&typeof window.aipkit_getMarkdownRenderer=="function"&&(s=window.aipkit_getMarkdownRenderer()),s&&(a.innerHTML=s.render(i.fullContent)),typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(a.innerHTML),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let o=document.getElementById("aipkit_content_writer_form"),t=o?o.elements.generate_meta_description:null,r=o?o.elements.generate_focus_keyword:null,f=o?o.elements.generate_excerpt:null,u=o?o.elements.generate_tags:null,p=document.getElementById("aipkit_content_writer_nonce")?.value,_=o.elements.ai_provider?.value,m=o.elements.ai_model?.value,g=o.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",d=document.getElementById("aipkit_cw_generated_title_display"),w=d?d.textContent:o.elements.content_title?.value.split("|")[0].trim()||"Untitled",h=o.elements.content_keywords?.value.trim()||"",b="",A=document.getElementById("aipkit_content_writer_title");if(A){let v=A.value.split("|")||[];v.length>1&&(b=v[1].trim())}let S=b||h,I=S;if(r?.checked&&!S&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let v=o.elements.enable_vector_store,y=v&&v.checked?"1":"0",C=o.elements.vector_store_provider?.value,M=o.elements["openai_vector_store_ids[]"],B=M?Array.from(M.selectedOptions).map(L=>L.value):[],D=o.elements.pinecone_index_name?.value,W=o.elements.qdrant_collection_name?.value,U=o.elements.vector_store_top_k?.value,J=o.elements.vector_store_confidence_threshold?.value,oe={generated_content:i.fullContent,final_title:w,provider:_,model:m,prompt_mode:g,custom_keyword_prompt:o.elements.custom_keyword_prompt.value,enable_vector_store:y,vector_store_provider:C,openai_vector_store_ids:B,pinecone_index_name:D,qdrant_collection_name:W,vector_store_top_k:U,vector_store_confidence_threshold:J,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},O=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",oe);if(O&&O.focus_keyword){I=O.focus_keyword;let L=document.getElementById("aipkit_cw_generated_focus_keyword"),F=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");L&&F&&(L.value=I,F.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(v){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",v.message||"Failed")}}else if(S){let v=document.getElementById("aipkit_cw_generated_focus_keyword"),y=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");v&&y&&(v.value=S.split(",")[0].trim(),y.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let T=o?o.elements.generate_images_enabled:null,x=o?o.elements.generate_featured_image:null;if((T?.checked||x?.checked)&&i.fullContent.trim()!==""){let v=T?.checked,y=x?.checked,C=String(o.elements.image_provider?.value||"").toLowerCase(),M=String(o.elements.image_model?.value||"").toLowerCase(),B=C==="openai"&&M.startsWith("gpt-image-1"),D=v?parseInt(o.elements.image_count?.value,10)||1:0,W=document.getElementById("aipkit_cw_generated_excerpt"),U=D+(y?1:0),J=v&&y?D>1?`Generating ${D} content images and 1 featured image...`:"Generating 1 content image and 1 featured image...":y?"Generating featured image...":v?D>1?`Generating ${D} content images...`:"Generating content image...":U>1?`Generating ${U} images...`:U===1?"Generating 1 image...":"Generating images...",oe={original_topic:A?A.value.split("|")[0].trim():w,final_title:w,post_title:w,keywords:I,excerpt:W?W.value:"",ai_provider:o.elements.ai_provider?.value,ai_model:o.elements.ai_model?.value,ai_temperature:o.elements.ai_temperature?.value,reasoning_effort:o.elements.reasoning_effort?.value,image_provider:o.elements.image_provider?.value,image_model:o.elements.image_model?.value,image_prompt:o.elements.image_prompt?.value,image_alignment:o.elements.image_alignment?.value,image_size:o.elements.image_size?.value,featured_image_prompt:o.elements.featured_image_prompt?.value,generate_image_title:o.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:o.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:o.elements.generate_image_caption?.checked?"1":"0",generate_image_description:o.elements.generate_image_description?.checked?"1":"0",image_title_prompt:o.elements.image_title_prompt?.value,image_alt_text_prompt:o.elements.image_alt_text_prompt?.value,image_caption_prompt:o.elements.image_caption_prompt?.value,image_description_prompt:o.elements.image_description_prompt?.value,pexels_orientation:o.elements.pexels_orientation?.value,pexels_size:o.elements.pexels_size?.value,pexels_color:o.elements.pexels_color?.value,pixabay_orientation:o.elements.pixabay_orientation?.value,pixabay_image_type:o.elements.pixabay_image_type?.value,pixabay_category:o.elements.pixabay_category?.value,_ajax_nonce:p,generate_images_enabled:v?"1":"0",image_count:D,generate_featured_image:y?"1":"0",image_placement:o.elements.image_placement?.value,image_placement_param_x:o.elements.image_placement_param_x?.value,cw_generation_mode:o.elements.cw_generation_mode?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0},O=F=>{let N=document.getElementById("aipkit_cw_image_data_holder");N&&(N.value=JSON.stringify(F)),typeof window.aipkit_renderContentWriterImagePreview=="function"&&window.aipkit_renderContentWriterImagePreview(F)},L=async(F={},N="")=>{typeof window.aipkit_updateCwGenerationStatus=="function"&&N&&window.aipkit_updateCwGenerationStatus("image","generating",N);let R=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...oe,...F});if(!R?.image_data)throw new Error("Image generation failed or returned no data.");return R.image_data};try{let F=v&&y,N=B&&v&&D>1,R=null,H=K=>{R||(R={...K,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(F){if(v&&D>0)if(N&&D>1)for(let K=0;K<D;K++){let re=await L({generate_featured_image:"0",image_count:1,image_start_index:K+1},`Generating content image ${K+1} of ${D}...`);H(re),Array.isArray(re.in_content_images)&&R.in_content_images.push(...re.in_content_images),O(R)}else{let K=await L({generate_featured_image:"0"},D>1?`Generating ${D} content images...`:"Generating content image...");H(K),R.in_content_images=K.in_content_images||[],O(R)}if(y){let K=await L({generate_images_enabled:"0",image_count:0},"Generating featured image...");H(K),R.featured_image_id=K.featured_image_id||null,R.featured_image_url=K.featured_image_url||null}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",J),R=await L();if(R)O(R),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success");else throw new Error("Image generation failed or returned no data.")}catch(F){typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",F.message||"Failed")}}else typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(f?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let v=o.elements.enable_vector_store,y=v&&v.checked?"1":"0",C=o.elements.vector_store_provider?.value,M=o.elements["openai_vector_store_ids[]"],B=M?Array.from(M.selectedOptions).map(L=>L.value):[],D=o.elements.pinecone_index_name?.value,W=o.elements.qdrant_collection_name?.value,U=o.elements.vector_store_top_k?.value,J=o.elements.vector_store_confidence_threshold?.value,oe={generated_content:i.fullContent,final_title:w,keywords:I,provider:_,model:m,prompt_mode:g,custom_excerpt_prompt:o.elements.custom_excerpt_prompt.value,enable_vector_store:y,vector_store_provider:C,openai_vector_store_ids:B,pinecone_index_name:D,qdrant_collection_name:W,vector_store_top_k:U,vector_store_confidence_threshold:J,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},O=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",oe);if(O&&O.excerpt){let L=document.getElementById("aipkit_cw_generated_excerpt"),F=document.getElementById("aipkit_cw_excerpt_output_wrapper");L&&F&&(L.value=O.excerpt,F.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(v){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",v.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(u?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let v=o.elements.enable_vector_store,y=v&&v.checked?"1":"0",C=o.elements.vector_store_provider?.value,M=o.elements["openai_vector_store_ids[]"],B=M?Array.from(M.selectedOptions).map(L=>L.value):[],D=o.elements.pinecone_index_name?.value,W=o.elements.qdrant_collection_name?.value,U=o.elements.vector_store_top_k?.value,J=o.elements.vector_store_confidence_threshold?.value,oe={generated_content:i.fullContent,final_title:w,keywords:I,provider:_,model:m,prompt_mode:g,custom_tags_prompt:o.elements.custom_tags_prompt.value,enable_vector_store:y,vector_store_provider:C,openai_vector_store_ids:B,pinecone_index_name:D,qdrant_collection_name:W,vector_store_top_k:U,vector_store_confidence_threshold:J,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},O=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",oe);if(O&&O.tags){let L=document.getElementById("aipkit_cw_generated_tags"),F=document.getElementById("aipkit_cw_tags_output_wrapper");L&&F&&(L.value=O.tags,F.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(v){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",v.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(t?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let v=o.elements.enable_vector_store,y=v&&v.checked?"1":"0",C=o.elements.vector_store_provider?.value,M=o.elements["openai_vector_store_ids[]"],B=M?Array.from(M.selectedOptions).map(L=>L.value):[],D=o.elements.pinecone_index_name?.value,W=o.elements.qdrant_collection_name?.value,U=o.elements.vector_store_top_k?.value,J=o.elements.vector_store_confidence_threshold?.value,oe={generated_content:i.fullContent,final_title:w,keywords:I,provider:_,model:m,prompt_mode:g,custom_meta_prompt:o.elements.custom_meta_prompt.value,enable_vector_store:y,vector_store_provider:C,openai_vector_store_ids:B,pinecone_index_name:D,qdrant_collection_name:W,vector_store_top_k:U,vector_store_confidence_threshold:J,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},O=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",oe);if(O&&O.meta_description){let L=document.getElementById("aipkit_cw_generated_meta_desc"),F=document.getElementById("aipkit_cw_meta_desc_output_wrapper");L&&F&&(L.value=O.meta_description,F.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(v){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",v.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c)}window.aipkit_stream_handleDone=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(e){return e};function n(e,i,a,s,l){if(i.isDone)return;if(l.current&&l.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(l);return}let c="Error during streaming.";if(e.data)try{c=JSON.parse(e.data).error||c}catch{}console.error("Stream Error Handler: Error event received:",e),a&&(a.textContent="",a.className="aipkit_cw_status_badge"),s&&s.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",c),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(l)}window.aipkit_stream_handleError=n})();(function(){"use strict";let k={current:null};function n(e,i){let a=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_form_status");if(!a||!s||!l){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let c=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let t of c)if(typeof window[t]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${t}`),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let o={fullContent:"",isDone:!1};s.innerHTML="",a.classList.remove("aipkit_content_writer_output_error"),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),window.aipkit_updateCwGenerationStatus("content","generating");try{i.current=window.aipkit_stream_setupEventSourceConnection(e,i);let t=window.aipkit_getMarkdownRenderer();i.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},i.current.onmessage=function(r){window.aipkit_stream_handleMessage(r,o,s,t)},i.current.addEventListener("done",function(r){window.aipkit_stream_handleDone(r,o,s,t,l,i)}),i.current.addEventListener("error",function(r){window.aipkit_stream_handleError(r,o,l,a,i)})}catch(t){console.error("EventSource Orchestrator: Error during setup:",t),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=n,window.aipkit_contentWriterEventSourceInstanceRef=k})();(function(){"use strict";function k(n){n&&n.current&&n.current.close()}window.aipkit_stopContentWriterEventSource=k})();(function(){"use strict";async function k(n){let e=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),a=document.getElementById("aipkit_content_writer_form_status"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn"),o=document.querySelector(".aipkit_content_writer_progress_bar_container"),t=document.querySelector(".aipkit_content_writer_output_actions"),r=function(m){if(!m)return"Error";let g=m.message||"Error",d=m.details||m.data?.details,w=d?.provider,h=d?.model;return w||h?`${g} (${[w,h].filter(Boolean).join(" \xB7 ")})`:g};if(!e||!i||!a||!s||!l||!c||!t){console.error("Handle SSE: Missing UI elements.");return}let f=new FormData(e),u=Object.fromEntries(f.entries()),p=e.elements["openai_vector_store_ids[]"];if(u.openai_vector_store_ids=p?Array.from(p.selectedOptions).map(m=>m.value):[],delete u["openai_vector_store_ids[]"],!u.conversation_uuid){let m=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();m&&(u.conversation_uuid=m)}if(!u.content_title){a.textContent="",a.className="aipkit_cw_status_badge";return}let _=document.getElementById("aipkit_content_writer_nonce");if(_&&_.value)u._ajax_nonce=_.value;else{a.textContent="",a.className="aipkit_cw_status_badge";return}typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0),o&&(o.style.display="none"),t.style.display="none",s&&(s.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'),l.disabled=!0,c.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),a.textContent="",a.className="aipkit_cw_status_badge";try{u.content_title=document.getElementById("aipkit_content_writer_title").value;let m=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",u);if(!m.cache_key)throw new Error(m.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=m.cache_key,m.conversation_uuid){window.aipkit_current_conversation_uuid=m.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",m.conversation_uuid)}catch{}}if(typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(m.cache_key,n);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(m){console.error("Content Writer Init Stream Error:",m),a&&(a.textContent=r(m),a.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),window.aipkit_setLoadingStateOpenAI(i,!1,"Generate"),typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),s&&(s.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},n=function(i){if(!i)return"Error";let a=i.message||"Error",s=i.details||i.data?.details,l=s?.provider,c=s?.model;return l||c?`${a} (${[l,c].filter(Boolean).join(" \xB7 ")})`:a};async function e(){let i=document.getElementById("aipkit_content_writer_form"),a=document.getElementById("aipkit_content_writer_generate_btn"),s=document.getElementById("aipkit_content_writer_stop_btn"),l=document.getElementById("aipkit_content_writer_form_status"),c=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_content_writer_copy_btn"),t=document.getElementById("aipkit_content_writer_clear_btn"),r=document.querySelector(".aipkit_content_writer_progress_bar_container"),f=r?r.querySelector(".aipkit_content_writer_progress_bar"):null,u=document.querySelector(".aipkit_content_writer_output_actions"),p=document.getElementById("aipkit_cw_status_display_container");if(!i||!a||!s||!l||!c||!o||!t){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),l.textContent="",l.className="aipkit_cw_status_badge";return}let _=new FormData(i),m=Object.fromEntries(_.entries()),g=i.elements["openai_vector_store_ids[]"];if(m.openai_vector_store_ids=g?Array.from(g.selectedOptions).map(S=>S.value):[],delete m["openai_vector_store_ids[]"],!m.conversation_uuid){let S=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();S&&(m.conversation_uuid=S)}if(!m.content_title){l.textContent="",l.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let d=document.getElementById("aipkit_content_writer_nonce");if(d&&d.value)m._ajax_nonce=d.value;else{l.textContent="",l.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}p&&(p.style.display="block");let w=document.getElementById("aipkit_cw_generate_meta_desc"),h=document.getElementById("aipkit_cw_generate_focus_keyword"),b=document.getElementById("aipkit_cw_generate_excerpt"),A=document.getElementById("aipkit_cw_generate_tags");typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",b?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",A?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",w?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",h?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(a,!0,"Generate","Generating..."),s.style.display="none",u&&(u.style.display="none"),c&&(c.innerHTML=""),o.disabled=!0,t.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),l.textContent="Generating content, please wait...",l.className="aipkit_cw_status_badge aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),r&&f&&(r.style.display="block",f.style.width="0%",f.classList.add("aipkit_indeterminate"));try{let S=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",m);if(S.content){if(S.conversation_uuid){window.aipkit_current_conversation_uuid=S.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",S.conversation_uuid)}catch{}}let I=window.aipkit_getMarkdownRenderer();if(c&&(I?c.innerHTML=I.render(S.content):c.textContent=S.content,typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(c.innerHTML)),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),u&&(u.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),o.disabled=!1,t.disabled=!1,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),S.content&&b?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let T=i.elements.enable_vector_store,x=T&&T.checked?"1":"0",E=i.elements.vector_store_provider?.value,v=i.elements["openai_vector_store_ids[]"],y=v?Array.from(v.selectedOptions).map(J=>J.value):[],C=i.elements.pinecone_index_name?.value,M=i.elements.qdrant_collection_name?.value,B=i.elements.vector_store_top_k?.value,D=i.elements.vector_store_confidence_threshold?.value,W={generated_content:S.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_excerpt_prompt:m.custom_excerpt_prompt,enable_vector_store:x,vector_store_provider:E,openai_vector_store_ids:y,pinecone_index_name:C,qdrant_collection_name:M,vector_store_top_k:B,vector_store_confidence_threshold:D,vector_embedding_provider:i.elements.vector_embedding_provider?.value,vector_embedding_model:i.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},U=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",W);if(U&&U.excerpt){let J=document.getElementById("aipkit_cw_generated_excerpt"),oe=document.getElementById("aipkit_cw_excerpt_output_wrapper");J&&oe&&(J.value=U.excerpt,oe.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",T.message||"Not returned")}}if(S.content&&A?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let T=i.elements.enable_vector_store,x=T&&T.checked?"1":"0",E=i.elements.vector_store_provider?.value,v=i.elements["openai_vector_store_ids[]"],y=v?Array.from(v.selectedOptions).map(J=>J.value):[],C=i.elements.pinecone_index_name?.value,M=i.elements.qdrant_collection_name?.value,B=i.elements.vector_store_top_k?.value,D=i.elements.vector_store_confidence_threshold?.value,W={generated_content:S.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_tags_prompt:m.custom_tags_prompt,enable_vector_store:x,vector_store_provider:E,openai_vector_store_ids:y,pinecone_index_name:C,qdrant_collection_name:M,vector_store_top_k:B,vector_store_confidence_threshold:D,vector_embedding_provider:i.elements.vector_embedding_provider?.value,vector_embedding_model:i.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},U=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",W);if(U&&U.tags){let J=document.getElementById("aipkit_cw_generated_tags"),oe=document.getElementById("aipkit_cw_tags_output_wrapper");J&&oe&&(J.value=U.tags,oe.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",T.message||"Not returned")}}if(S.meta_description){let T=document.getElementById("aipkit_cw_generated_meta_desc"),x=document.getElementById("aipkit_cw_meta_desc_output_wrapper");T&&x&&(T.value=S.meta_description,x.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else w?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(S.focus_keyword){let T=document.getElementById("aipkit_cw_generated_focus_keyword"),x=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");T&&x&&(T.value=S.focus_keyword,x.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else h?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(S.message||"No content received.")}catch(S){console.error("Content Writer AJAX Error:",S),l&&(l.textContent=n(S),l.className="aipkit_cw_status_badge aipkit_settings_message-error"),c&&(c.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",S.message),b?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),A?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),w?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),h?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),u&&(u.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(a,!1,"Generate"),r&&(r.style.display="none"),f&&f.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=e})();(function(){"use strict";let k=window.wp?.i18n?.__||function(e){return e};function n(e){let i=document.getElementById("aipkit_content_writer_generate_btn"),a=()=>{if(i){if(typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(i,k("Stopping...","gpt3-ai-content-generator"));else{let l=i.querySelector(".aipkit_btn-text");l?l.textContent=k("Stopping...","gpt3-ai-content-generator"):i.textContent=k("Stopping...","gpt3-ai-content-generator")}i.disabled=!0,i.setAttribute("aria-disabled","true")}};if(typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){a(),typeof window.aipkit_cw_requestBatchStop=="function"&&window.aipkit_cw_requestBatchStop();return}if(typeof window.aipkit_cw_isExistingUpdateActive=="function"&&window.aipkit_cw_isExistingUpdateActive()){a(),typeof window.aipkit_cw_requestExistingUpdateStop=="function"&&window.aipkit_cw_requestExistingUpdateStop();return}if(!e||!e.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let s=document.getElementById("aipkit_content_writer_form_status");s&&(s.textContent=k("Stopping...","gpt3-ai-content-generator"),s.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),s.classList.add("aipkit_settings_message-info")),a(),e.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(e):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=n})();(function(){"use strict";let k={rss:["{description}"],url:["{url_content}"]},n=new Set(["task","csv","gsheets"]),e="{topic}",i=f=>{if(!f)return"Error";let u=f.message||"Error",p=f.details||f.data?.details,_=p?.provider,m=p?.model;return _||m?`${u} (${[_,m].filter(Boolean).join(" \xB7 ")})`:u},a=(f,u)=>{let p=f.querySelector(u);return p?String(p.value||""):""},s=(f,u)=>u.filter(p=>!f.includes(p)),l=(f,u,p)=>{let _=[],m=f==="rss"?"RSS":"URL";return u.length&&_.push(`Title prompt: missing ${u.join(", ")}.`),p.length&&_.push(`Content prompt: missing ${p.join(", ")}.`),_.length?`${m} mode works best when your prompts include the source placeholders.

${_.join(`
`)}

Please update your prompts and try again.`:""},c=(f,u)=>{let p=k[u];if(!p)return{shouldWarn:!1,message:""};let _=a(f,"#aipkit_cw_custom_title_prompt").trim(),m=a(f,"#aipkit_cw_custom_content_prompt").trim(),g=_?s(_,p):[],d=m?s(m,p):p.slice(),w=l(u,g,d);return{shouldWarn:!!w,message:w}},o=(f,u)=>u.length?`${f} mode requires ${e} in your prompts.

${u.join(`
`)}

Please update your prompts and try again.`:"",t=(f,u)=>{if(!n.has(u))return{shouldWarn:!1,message:""};let _={task:"Manual entry",csv:"CSV",gsheets:"Google Sheets"}[u]||"This",m=[{selector:"#aipkit_cw_custom_title_prompt",label:"Title prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_content_prompt",label:"Content prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_meta_prompt",label:"Meta description prompt",enabled:()=>!!f.querySelector("#aipkit_cw_generate_meta_desc")?.checked},{selector:"#aipkit_cw_custom_keyword_prompt",label:"Focus keyword prompt",enabled:()=>!!f.querySelector("#aipkit_cw_generate_focus_keyword")?.checked},{selector:"#aipkit_cw_custom_excerpt_prompt",label:"Excerpt prompt",enabled:()=>!!f.querySelector("#aipkit_cw_generate_excerpt")?.checked},{selector:"#aipkit_cw_custom_tags_prompt",label:"Tags prompt",enabled:()=>!!f.querySelector("#aipkit_cw_generate_tags")?.checked}],g=[];m.forEach(w=>{if(!w.enabled())return;let h=a(f,w.selector).trim();(h?s(h,[e]):[e]).length&&g.push(`${w.label}: missing ${e}.`)});let d=o(_,g);return{shouldWarn:!!d,message:d}};function r(f,u,p,_){f&&(f.dataset.listenerAttached||(f.addEventListener("click",async()=>{if(f.dataset.aipkitStopMode==="true"){typeof window.aipkit_handleStopGeneration=="function"&&window.aipkit_handleStopGeneration(_);return}try{delete window.aipkit_current_conversation_uuid,sessionStorage.removeItem("aipkit_current_conversation_uuid")}catch{}typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview();let m=document.getElementById("aipkit_cw_image_data_holder");if(m&&(m.value=""),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),f.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Upgrade URL not found. Please visit our website.",{title:"Upgrade"}):alert("Upgrade URL not found. Please visit our website.");return}if(f.dataset.action==="fetch_feeds"){typeof window.aipkit_handleRssFetchFromGenerateButton=="function"?window.aipkit_handleRssFetchFromGenerateButton(f):console.error("Fetch Feeds: Handler function not found.");return}let g=document.getElementById("aipkit_content_writer_form_status"),d=document.getElementById("aipkit_cw_action_validation"),w=f.dataset.action||"generate",h=w==="generate_single"?"generate":w,b=document.getElementById("aipkit_cw_mode_select"),A=b?b.value:"task";if(A==="single"&&(A="task"),A==="existing"||A.indexOf("existing-")===0){if(typeof window.aipkit_runContentWriterExistingUpdate=="function")window.aipkit_runContentWriterExistingUpdate();else{let N="Update panel is not ready yet. Please refresh the page and try again.";typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(N,{title:"Update existing"}):alert(N)}return}let S=N=>String(N||"").split(/\r?\n/).map(R=>R.trim()).filter(Boolean),I=N=>{let R=String(N||"").split("|").map(H=>H.trim());return{topic:R[0]||"",keywords:R[1]||"",category:R[2]||"",authorLogin:R[3]||"",type:R[4]||"",schedule:R[5]||""}},T=()=>{let N=Array.from(u.querySelectorAll("[data-aipkit-bulk-row]"));for(let R of N){let H=R.querySelector('[data-bulk-field="topic"]'),K=H?H.value.trim():"";if(!K)continue;let re=R.querySelector('[data-bulk-field="keywords"]')?.value.trim()||"",ve=R.querySelector('[data-bulk-field="category"]')?.value.trim()||"",Ie=R.querySelector('[data-bulk-field="author"]'),Ee=Ie?Ie.value.trim():"",Z=Ie?.selectedOptions?.[0]?.dataset?.userId||"",pe=R.querySelector('[data-bulk-field="type"]')?.value.trim()||"",we=R.querySelector('[data-bulk-field="schedule"]')?.value.trim()||"";return{topic:K,keywords:re,category:ve,authorLogin:Ee,authorId:Z,type:pe,schedule:we}}return null},x=N=>{if(!N||!N.topic)return;let R=document.getElementById("aipkit_content_writer_title"),H=N.keywords?`${N.topic} | ${N.keywords}`:N.topic;R&&(R.value=H,R.dispatchEvent(new Event("change",{bubbles:!0})));let K=u.elements.post_type;K&&N.type&&(K.value=N.type,K.dispatchEvent(new Event("change",{bubbles:!0})));let re=u.elements["post_categories[]"];re&&N.category&&(Array.from(re.options).forEach(Ie=>{Ie.selected=Ie.value===N.category}),re.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect());let ve=u.elements.post_author;if(ve){let Ie=N.authorId||"";if(!Ie&&N.authorLogin){let Ee=Array.from(ve.options).find(Z=>Z.dataset.login===N.authorLogin||Z.value===N.authorLogin);Ee&&(Ie=Ee.value)}Ie&&(ve.value=Ie,ve.dispatchEvent(new Event("change",{bubbles:!0})))}};if(h!=="upgrade"){let N=typeof window.aipkit_validateContentWriterInputs=="function"?window.aipkit_validateContentWriterInputs(u,A):{isValid:!0};if(!N.isValid){typeof window.aipkit_showContentWriterValidationError=="function"?window.aipkit_showContentWriterValidationError(g||d,N.message):g&&(g.textContent=N.message||"",g.className="aipkit_cw_status_badge aipkit_settings_message-error");return}}if(typeof window.aipkit_clearContentWriterValidationMessage=="function"?(window.aipkit_clearContentWriterValidationMessage(g),window.aipkit_clearContentWriterValidationMessage(d)):d&&(d.textContent=""),h==="generate"||h==="create_task"){let{shouldWarn:N,message:R}=c(u,A);if(N){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(R,{title:"Update prompts",okText:"Review prompts"}):alert(R);return}let H=t(u,A);if(H.shouldWarn){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(H.message,{title:"Update prompts",okText:"Review prompts"}):alert(H.message);return}}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let E=document.getElementById("aipkit_cw_status_display_container"),v=document.getElementById("aipkit_cw_generated_title_display"),y=document.getElementById("aipkit_content_writer_title");if(h==="create_task"){E&&(E.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(u,f,g):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),g&&(g.textContent="",g.className="aipkit_cw_status_badge"));return}let C=u.elements.content_title_bulk,M=S(C?C.value:""),B=h==="generate"&&A==="task"&&M.length===1;if(B){let N=T()||I(M[0]);x(N),typeof window.aipkit_cw_resetBatchQueue=="function"&&window.aipkit_cw_resetBatchQueue()}if(h==="generate"&&!B){typeof window.aipkit_cw_handleBatchGeneration=="function"?window.aipkit_cw_handleBatchGeneration(u,A):console.error("Generate Button Listener: aipkit_cw_handleBatchGeneration function not found.");return}let D=document.getElementById("aipkit_cw_single_output_wrapper"),W=document.getElementById("aipkit_cw_output_card");D&&(D.style.display="block"),W&&(W.style.display="block"),E&&(E.style.display="block");let U=document.getElementById("aipkit_content_writer_stream_mode"),oe=u.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),p&&(p.style.display="flex");let O={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[N,R]of Object.entries(O)){let H=document.getElementById(R);H&&!H.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(N,"skipped")}let L=document.getElementById("aipkit_cw_generate_images_enabled"),F=document.getElementById("aipkit_cw_generate_featured_image");if(L&&F&&!L.checked&&!F.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),oe){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),v&&(v.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(f,!0,"Generate","Generating...");let N=new FormData(u),R=Object.fromEntries(N.entries()),H=u.elements["openai_vector_store_ids[]"];R.openai_vector_store_ids=H?Array.from(H.selectedOptions).map(ve=>ve.value):[],delete R["openai_vector_store_ids[]"];let K=document.getElementById("aipkit_content_writer_nonce");R._ajax_nonce=K?K.value:"",window.aipkit_current_conversation_uuid&&(R.conversation_uuid=window.aipkit_current_conversation_uuid);let re=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",R);if(re&&re.new_title){if(re.conversation_uuid){window.aipkit_current_conversation_uuid=re.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",re.conversation_uuid)}catch{}}v&&(v.textContent=re.new_title,v.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success")}else throw new Error(re.message||"Failed to generate new title.")}catch(N){console.error("Title Generation Error:",N),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",N.message),g&&(g.textContent=i(N),g.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),v&&y&&(v.textContent=y.value.split("|")[0].trim(),v.style.display="block");!U||U.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(_):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),f.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=r})();(function(){"use strict";function k(n,e){n&&(n.dataset.listenerAttached||(n.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(e):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),n.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=k})();(function(){"use strict";function k(n,e){if(n===e)return!0;if(n==null||typeof n!="object"||e==null||typeof e!="object")return!1;let i=Object.keys(n),a=Object.keys(e);if(i.length!==a.length)return!1;for(let s of i)if(!a.includes(s)||!k(n[s],e[s]))return!1;return!0}window.aipkit_deepEqual=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_provider"),e=document.getElementById("aipkit_content_writer_temperature"),i=document.getElementById("aipkit_content_writer_post_author"),a=i?i.value:window.aipkit_dashboard?.currentUserId||"1",l=(n&&n.options.length>0?n.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),c=n?n.value.toLowerCase():l,o="",t=window.aipkit_dashboard?.models?.[c];switch(c){case"openai":o="gpt-4.1-mini";break;case"google":o="gemini-2.5-flash";break;case"openrouter":o="moonshotai/kimi-k2.5";break;case"claude":o="claude-opus-4-6",Array.isArray(t)&&t.length>0&&(t.some(p=>p&&p.id==="claude-opus-4-6")||(o=t[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(t)&&t.length>0?o=t[0].id||"":o="";break;default:o=""}let r=e&&e.defaultValue||"1.0",f=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:c,ai_model:o,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:r,reasoning_effort:"medium",post_type:"post",post_author:a,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:f.title,custom_content_prompt:f.content,generate_title:"1",generate_content:"1",generate_meta_description:"1",custom_meta_prompt:f.meta,generate_focus_keyword:"1",custom_keyword_prompt:f.keyword,generate_excerpt:"1",custom_excerpt_prompt:f.excerpt,generate_tags:"1",custom_tags_prompt:f.tags,custom_title_prompt_update:"",custom_content_prompt_update:"",custom_meta_prompt_update:"",custom_keyword_prompt_update:"",custom_excerpt_prompt_update:"",custom_tags_prompt_update:"",cw_generation_mode:"task",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"dall-e-3",image_prompt:f.image||"A high-quality, relevant image for an article about: {topic}",image_prompt_update:"",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",image_title_prompt:f.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt:f.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt:f.image_caption||"Write a short image caption based on: {topic}",image_description_prompt:f.image_description||"Write a brief image description based on: {topic}",image_title_prompt_update:f.image_title_update||f.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt_update:f.image_alt_text_update||f.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt_update:f.image_caption_update||f.image_caption||"Write a short image caption based on: {topic}",image_description_prompt_update:f.image_description_update||f.image_description||"Write a brief image description based on: {topic}",generate_featured_image:"0",featured_image_prompt:f.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",featured_image_prompt_update:"",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",vector_store_confidence_threshold:"20",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=k})();(function(){"use strict";function k(n){let e={};if(!n)return e;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","custom_title_prompt_update","custom_content_prompt_update","custom_meta_prompt_update","custom_keyword_prompt_update","custom_excerpt_prompt_update","custom_tags_prompt_update","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_prompt_update","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","image_title_prompt_update","image_alt_text_prompt_update","image_caption_prompt_update","image_description_prompt_update","featured_image_prompt","featured_image_prompt_update","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(S=>{n.elements[S]&&(e[S]=n.elements[S].value)});let a=n.elements.generate_meta_description;a?e.generate_meta_description=a.checked?"1":"0":e.generate_meta_description="0";let s=n.elements.generate_focus_keyword;s?e.generate_focus_keyword=s.checked?"1":"0":e.generate_focus_keyword="0";let l=n.elements.generate_excerpt;l?e.generate_excerpt=l.checked?"1":"0":e.generate_excerpt="0";let c=n.elements.generate_tags;c?e.generate_tags=c.checked?"1":"0":e.generate_tags="0";let o=n.elements.generate_title;o?e.generate_title=o.checked?"1":"0":e.generate_title="1";let t=n.elements.generate_content;t?e.generate_content=t.checked?"1":"0":e.generate_content="1";let r=n.elements.generate_toc;r?e.generate_toc=r.checked?"1":"0":e.generate_toc="0";let f=n.elements.generate_seo_slug;f?e.generate_seo_slug=f.checked?"1":"0":e.generate_seo_slug="0";let u=n.elements.generate_images_enabled;u?e.generate_images_enabled=u.checked?"1":"0":e.generate_images_enabled="0";let p=n.elements.generate_featured_image;p?e.generate_featured_image=p.checked?"1":"0":e.generate_featured_image="0",["generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(S=>{let I=n.elements[S];I?e[S]=I.checked?"1":"0":e[S]="1"});let _=n.elements.enable_vector_store;_?e.enable_vector_store=_.checked?"1":"0":e.enable_vector_store="0";let m=n.elements["openai_vector_store_ids[]"];m?e.openai_vector_store_ids=Array.from(m.selectedOptions).map(S=>S.value):e.openai_vector_store_ids=[];let g=n.querySelector("#aipkit_cw_prompt_mode_hidden_input");g?e.prompt_mode=g.value:e.prompt_mode="custom";let d=n.querySelector("#aipkit_cw_mode_select"),w=d?d.value:"task";e.cw_generation_mode=w==="single"?"task":w;let h=n.elements["post_categories[]"];h?e.post_categories=Array.from(h.selectedOptions).map(S=>S.value):e.post_categories=[];let b=["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt"],A=typeof window.aipkit_getContentWriterPromptSets=="function"?window.aipkit_getContentWriterPromptSets():null;return A&&A.create&&b.forEach(S=>{Object.prototype.hasOwnProperty.call(A.create,S)&&(e[S]=A.create[S])}),A&&A.update&&b.forEach(S=>{let I=`${S}_update`;Object.prototype.hasOwnProperty.call(A.update,S)&&(e[I]=A.update[S])}),e}window.aipkit_getContentWriterFormConfig=k})();(function(){"use strict";function k(n){if(!n||!n.value)return!1;let e=n.value,i=window.aipkit_cw_template_state.currentTemplates.find(a=>String(a.id)===String(e));return i&&String(i.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_post_status"),e=document.getElementById("aipkit_cw_schedule_options_wrapper"),i=document.getElementById("aipkit_cw_smart_schedule_fields"),a=document.querySelector(".aipkit_schedule_from_input_help"),s=document.querySelector(".aipkit_schedule_from_input_option");if(!n||!e)return;let l=n.value==="publish";e.style.display=l?"block":"none";let c=document.getElementById("aipkit_cw_mode_select"),o=c?c.value:"task",t=new Set(["task","csv","gsheets"]),r=t.has(o);if(s){s.style.display=r?"inline-flex":"none";let p=s.querySelector('input[name="schedule_mode"]');if(!r&&p&&p.checked){let _=document.querySelector('input[name="schedule_mode"][value="immediate"]');_&&(_.checked=!0,_.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(p=>{p.dataset.listenerAttached||(p.addEventListener("change",function(){let _=document.getElementById("aipkit_cw_mode_select"),m=_?_.value:"task",g=t.has(m);i&&(i.style.display=this.value==="smart"?"block":"none"),a&&(a.style.display=this.value==="from_input"&&g?"block":"none")}),p.dataset.listenerAttached="true")});let u=document.querySelector('input[name="schedule_mode"]:checked');u&&i&&(i.style.display=u.value==="smart"?"block":"none"),u&&a&&(a.style.display=u.value==="from_input"&&r?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(s){return s},n={image_title_prompt:"aipkit_cw_image_title_prompt",image_alt_text_prompt:"aipkit_cw_image_alt_text_prompt",image_caption_prompt:"aipkit_cw_image_caption_prompt",image_description_prompt:"aipkit_cw_image_description_prompt"};function e(s){if(!s)return"";let l=document.querySelector(`.aipkit_cw_prompt_library_select[data-aipkit-prompt-target="${CSS.escape(s)}"]`);if(!l)return"";let c=l.querySelector("option");return c?c.value:""}function i(){let s=document.getElementById("aipkit_cw_single_output_wrapper"),l=document.getElementById("aipkit_cw_generated_title_display"),c=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_cw_meta_chunk"),t=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),r=document.querySelector(".aipkit_content_writer_output_actions");s&&(s.style.display="none"),l&&(l.style.display="none",l.textContent=""),c&&(c.innerHTML=""),o&&(o.style.display="none"),t&&(t.style.display="none"),r&&(r.style.display="none"),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction()}function a(s,l=!1){let c=window.aipkit_cw_autosave_suspended===!0;window.aipkit_cw_autosave_suspended=!0;try{let o=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,t=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.currentTemplateId=s,s?sessionStorage.setItem("aipkit_cw_last_template_id",s):sessionStorage.removeItem("aipkit_cw_last_template_id");let r=window.aipkit_cw_template_state.currentTemplates.find(_=>String(_.id)===String(s)),f;if(r)f=JSON.parse(JSON.stringify(r.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),t&&!l&&t("Error: Cannot load default template.");return}f=window.aipkit_getDefaultContentWriterTemplateConfig()}let u=f&&f.template_scope==="prompts_only";u||(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(f)),window.aipkit_cw_template_state.currentTemplateModified=!1),i();let p=document.getElementById("aipkit_content_writer_form");if(!p){console.error("Apply Template: Content writer form not found.");return}if(!u&&f.ai_model&&p.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=f.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,f.image_model&&p.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=f.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,u){let _=document.getElementById("aipkit_cw_prompt_mode_hidden_input");_&&(_.value=f.prompt_mode||"custom"),["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt"].forEach(S=>{let I=Object.prototype.hasOwnProperty.call(f,S),T=p.elements[S];if(!T)return;let x=f[S]===null||typeof f[S]>"u"?"":f[S],E=!!n[S],v=typeof x=="string"?x.trim()==="":x==="";if((!I||v)&&E){T.value=e(n[S]);return}I&&(T.value=x)}),["generate_images_enabled","generate_featured_image","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(S=>{if(!Object.prototype.hasOwnProperty.call(f,S))return;let I=p.elements[S];if(!I)return;let T=f[S];I.checked=T==="1"||T===1||T===!0}),["generate_title","generate_content","generate_meta_description","generate_focus_keyword","generate_excerpt","generate_tags"].forEach(S=>{if(!Object.prototype.hasOwnProperty.call(f,S))return;let I=p.elements[S];if(!I)return;let T=f[S];I.checked=T==="1"||T===1||T===!0});let w=p.elements.content_length;w&&Object.prototype.hasOwnProperty.call(f,"content_length")&&(w.value=f.content_length||"medium",w.dispatchEvent(new Event("change",{bubbles:!0})));let h=p.elements.image_provider;h&&Object.prototype.hasOwnProperty.call(f,"image_provider")&&(h.value=f.image_provider||"",h.dispatchEvent(new Event("change",{bubbles:!0}))),["image_count","image_size","image_alignment","image_placement"].forEach(S=>{if(!Object.prototype.hasOwnProperty.call(f,S))return;let I=p.elements[S];if(!I)return;let T=f[S]===null||typeof f[S]>"u"?"":f[S];I.type==="checkbox"?I.checked=T==="1"||T===1||T===!0:I.value=T});let A=p.elements.image_model;if(A&&Object.prototype.hasOwnProperty.call(f,"image_model")){let S=f.image_model||"";S&&A.querySelector(`option[value="${CSS.escape(S)}"]`)&&(A.value=S)}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI()}else{["ai_provider","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(E=>{let v=p.elements[E];if(v){let y=Object.prototype.hasOwnProperty.call(f,E),C=f[E]===null||typeof f[E]>"u"?"":f[E],M=!!n[E],B=typeof C=="string"?C.trim()==="":C==="";if((!y||B)&&M){v.value=e(n[E]);return}if(E==="gsheets_credentials"&&typeof C=="object"&&C!==null)v.value=JSON.stringify(C,null,2);else if((E==="ai_temperature"||E==="vector_store_top_k"||E==="vector_store_confidence_threshold")&&v.type==="range"){v.value=C||(E==="ai_temperature"?"1.0":E==="vector_store_top_k"?"3":E==="vector_store_confidence_threshold"?"20":"");let D=document.getElementById(v.id+"_value");D&&(D.textContent=E==="vector_store_confidence_threshold"?v.value+"%":v.value)}else v.type==="checkbox"?v.checked=C==="1":v.value=C;E==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),E==="content_length"&&v.dispatchEvent(new Event("change",{bubbles:!0}))}});let m=p.elements.gsheets_credentials;if(m){let E=f.gsheets_credentials,v=m.closest(".aipkit_gsheets_section_container");m.value=typeof E=="object"&&E!==null?JSON.stringify(E,null,2):E||"",m.value?(m.dataset.filename="credentials.json",v&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(v),100)):(delete m.dataset.filename,v&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(v,"clear"))}let g={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",enable_vector_store:"0"};for(let[E,v]of Object.entries(g)){let y=p.elements[E];if(y){let C=Object.prototype.hasOwnProperty.call(f,E)?f[E]:v;y.checked=C==="1"||C===1||C===!0}}let d=document.getElementById("aipkit_cw_prompt_mode_hidden_input");d&&(d.value=f.prompt_mode||"custom");let w=p.querySelector("#aipkit_cw_mode_select"),h=f.cw_generation_mode||"task",b=h==="single"?"task":h;w&&(w.value=b,w.dispatchEvent(new Event("change",{bubbles:!0})));let A=p.elements["post_categories[]"];if(A){let E=Array.isArray(f.post_categories)?f.post_categories.map(v=>String(v)):[];Array.from(A.options).forEach(v=>{v.selected=E.includes(v.value)}),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect()}let S=p.elements["openai_vector_store_ids[]"];if(S){let E=Array.isArray(f.openai_vector_store_ids)?f.openai_vector_store_ids.map(String):[];Array.from(S.options).forEach(v=>{v.selected=E.includes(v.value)}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect()}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI();let I=p.elements.enable_vector_store;I&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(I.closest(".aipkit_popover_options_list")||I.closest(".aipkit_cw_settings_popover_body")||document.getElementById("aipkit_content_writer_container"));let T=p.elements.vector_store_provider;T&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(T.value=f.vector_store_provider||"openai",T.dispatchEvent(new Event("change",{bubbles:!0})));let x=p.elements.ai_provider;if(x){let E=x.value,v=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),y=(f.ai_provider||v).toLowerCase();if(E!==y)x.value=y,x.dispatchEvent(new Event("change",{bubbles:!0}));else{let C=p.elements.ai_model;C&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(x,C):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}x.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(s?x.dataset.aipkitProviderNoticeArmed="true":delete x.dataset.aipkitProviderNoticeArmed,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(p))}}if(typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts(),typeof window.aipkit_applyContentWriterPromptSets=="function"&&window.aipkit_applyContentWriterPromptSets(f),u&&(typeof window.aipkit_getContentWriterFormConfig=="function"&&(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=window.aipkit_getContentWriterFormConfig(p)),window.aipkit_cw_template_state.currentTemplateModified=!1),!l&&o&&o("Updated"),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(s),typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(s),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let _=document.getElementById("aipkit_content_writer_container");_&&window.aipkit_cw_toggleReasoningEffort(_)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers(),typeof window.aipkit_refreshUrlCounter=="function"&&window.aipkit_refreshUrlCounter(),typeof window.aipkit_refreshRssCounter=="function"&&window.aipkit_refreshRssCounter()}finally{c||(window.aipkit_cw_autosave_suspended=!1),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline()}}window.aipkit_applyContentWriterTemplate=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(e){return e};async function n(e){if(!e){console.error("Fetch & Populate Templates: Select element is missing.");return}let i=document.getElementById("aipkit_content_writer_template_nonce_field"),a=typeof window.aipkit_clearGeneralStatus=="function"?window.aipkit_clearGeneralStatus:null,s=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;e.innerHTML=`<option value="">${k("Loading templates...")}</option>`,e.disabled=!0,a&&a();try{let l=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:i?i.value:""});window.aipkit_cw_template_state.currentTemplates=l.templates||[],e.innerHTML="";let c=new Option(k("-- Select Template --"),"");e.appendChild(c);let o=window.aipkit_cw_template_state.currentTemplates||[],t=window.aipkit_dashboard?.currentUserId?.toString(),r=null,f=[],u=[],p={};o.forEach(d=>{if(String(d.is_default)==="1"&&d.user_id.toString()===t&&(r=d.id),d.user_id.toString()===t)String(d.is_starter)==="1"||d.is_starter===!0?f.push(d):u.push(d);else{let w=d.display_name||`User ID: ${d.user_id}`;p[w]||(p[w]=[]),p[w].push(d)}});let _=d=>{if(d&&d.starter_order!==void 0&&d.starter_order!==null&&d.starter_order!==""){let A=Number(d.starter_order);if(Number.isFinite(A))return A}let h=(d&&d.template_name?String(d.template_name):"").match(/(\d[\d,]*)/);if(!h)return null;let b=parseInt(h[1].replace(/,/g,""),10);return Number.isFinite(b)?b:null};if(u.sort((d,w)=>d.is_default==="1"?-1:w.is_default==="1"?1:d.template_name.localeCompare(w.template_name)),f.sort((d,w)=>{let h=_(d),b=_(w);return h!==null&&b!==null?h-b:h!==null?-1:b!==null?1:d.template_name.localeCompare(w.template_name)}),f.length>0){let d=document.createElement("optgroup");d.label=k("Starter Templates"),f.forEach(w=>{d.appendChild(new Option(k(w.template_name),w.id))}),e.appendChild(d)}if(u.length>0){let d=document.createElement("optgroup");d.label=k("My Templates"),u.forEach(w=>{d.appendChild(new Option(k(w.template_name),w.id))}),e.appendChild(d)}Object.keys(p).sort().forEach(d=>{let w=document.createElement("optgroup");w.label=k(d),p[d].forEach(h=>{w.appendChild(new Option(k(h.template_name),h.id))}),e.appendChild(w)}),e.disabled=!1;let g=sessionStorage.getItem("aipkit_cw_last_template_id");g&&e.querySelector(`option[value="${CSS.escape(g)}"]`)?(e.value=g,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(g,!0)):r?(e.value=r,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(r,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(e)}catch(l){console.error("Error fetching templates:",l),e.innerHTML=`<option value="">${k("Error loading templates")}</option>`,s&&s(`Error: ${l.message||"Failed to load templates."}`),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(e)}}window.aipkit_fetchAndPopulateTemplates=n})();(function(){"use strict";async function k(n,e,i){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let a=document.getElementById("aipkit_content_writer_template_nonce_field"),s=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,l=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,c=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;s&&s("Updating...");try{let o=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:n,template_name:e,config:JSON.stringify(i),_ajax_nonce:a?a.value:""});l&&l("Updated"),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(o.template_config||i)),window.aipkit_cw_template_state.currentTemplateModified=!1,typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline();let t=document.getElementById("aipkit_cw_template_select"),r=o.template_id?String(o.template_id):"";r&&(window.aipkit_cw_template_state.currentTemplateId=r,sessionStorage.setItem("aipkit_cw_last_template_id",r)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&t&&(await window.aipkit_fetchAndPopulateTemplates(t),r&&(t.value=r,typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(r))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(r||window.aipkit_cw_template_state.currentTemplateId)}catch(o){console.error("Error saving template:",o),c&&c(`Error: ${o.message||"Failed to save template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=k})();(function(){"use strict";function k(n){let e=document.getElementById("aipkit_cw_rename_template_btn"),i=document.getElementById("aipkit_cw_delete_template_btn"),a=window.aipkit_dashboard||{},s=a.isAdmin||!1,l=a.currentUserId?String(a.currentUserId):"0",c=window.aipkit_cw_template_state.currentTemplates.find(f=>String(f.id)===String(n));if(!c){e&&(e.disabled=!0),i&&(i.disabled=!0);return}let o=String(c.user_id)===l,t=o||s,r=o||s;e&&(e.disabled=!t),i&&(i.disabled=!r)}window.aipkit_updateTemplateActionButtonsState=k})();(function(){"use strict";function k(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let n=document.getElementById("aipkit_content_writer_form");if(!n)return;let e=window.aipkit_getContentWriterFormConfig(n),i=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(e,i),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=k})();(function(){"use strict";function k(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(e){return e};function n(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let e=document.getElementById("aipkit_cw_template_select"),i=e.value,a=e.options[e.selectedIndex],s=a?a.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(a)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot rename the default template or no template is selected.",{title:"Template"}):alert("Cannot rename the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("rename",s)}window.aipkit_handleRenameContentWriterTemplate=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(e){return e};function n(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let e=document.getElementById("aipkit_cw_template_select"),i=e.value,a=e.options[e.selectedIndex],s=a?a.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete: core function missing.",{title:"Template"}):alert("Cannot delete: core function missing."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(a)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete the default template or no template is selected.",{title:"Template"}):alert("Cannot delete the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateDeleteConfirm(s)}window.aipkit_handleDeleteContentWriterTemplate=n})();(function(){"use strict";let k=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,n=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,e=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;async function i(){if(!window.aipkit_cw_template_state||window.aipkit_cw_template_state.isSavingOrDeleting)return;let s=document.getElementById("aipkit_content_writer_template_nonce_field"),l=document.getElementById("aipkit_cw_template_select");window.aipkit_cw_template_state.isSavingOrDeleting=!0,k&&k("Resetting starter templates...");try{await window.aipkit_apiRequest("aipkit_reset_cw_starter_templates",{_ajax_nonce:s?s.value:""}),sessionStorage.removeItem("aipkit_cw_last_template_id"),l&&typeof window.aipkit_fetchAndPopulateTemplates=="function"&&await window.aipkit_fetchAndPopulateTemplates(l),n&&n("Starter templates reset."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover()}catch(c){console.error("Error resetting starter templates:",c),e&&e(`Error: ${c.message||"Failed to reset starter templates."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}function a(){let s="Reset starter templates to their original defaults?",l="Starter Templates";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(s,{title:l,confirmText:"Reset",cancelText:"Cancel",onConfirm:i});return}window.confirm(s)&&i()}window.aipkit_handleResetStarterTemplates=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(p){return p},n={short:"Quick reads, ideal for news or updates",medium:"Standard blog posts with good depth",long:"In-depth guides and pillar content"};function e(p){let _=p.toLowerCase();return _.includes("short")?n.short:_.includes("medium")?n.medium:_.includes("long")?n.long:/\b600\b/.test(_)?n.short:/\b1200\b/.test(_)?n.medium:/\b2000\b/.test(_)?n.long:""}function i(p,_){if(_){let m=p.template_name.toLowerCase();return m.includes("short")?"dashicons-text-page":m.includes("medium")?"dashicons-text":m.includes("long")?"dashicons-media-document":"dashicons-star-filled"}return p.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function a(){return{select:document.getElementById("aipkit_cw_template_select"),button:document.getElementById("aipkit_cw_template_picker_btn"),label:document.getElementById("aipkit_cw_template_picker_label"),list:document.getElementById("aipkit_cw_template_picker_list"),search:document.getElementById("aipkit_cw_template_picker_search"),searchClear:document.getElementById("aipkit_cw_template_picker_search_clear")}}function s(p,_){let m=[],g=[],d={};p.forEach(b=>{if(b.user_id.toString()===_)String(b.is_starter)==="1"||b.is_starter===!0?m.push(b):g.push(b);else{let A=b.display_name||`User ID: ${b.user_id}`;d[A]||(d[A]=[]),d[A].push(b)}});let w=b=>{if(b&&b.starter_order!==void 0&&b.starter_order!==null&&b.starter_order!==""){let T=Number(b.starter_order);if(Number.isFinite(T))return T}let S=(b&&b.template_name?String(b.template_name):"").match(/(\d[\d,]*)/);if(!S)return null;let I=parseInt(S[1].replace(/,/g,""),10);return Number.isFinite(I)?I:null};m.sort((b,A)=>{let S=w(b),I=w(A);return S!==null&&I!==null?S-I:S!==null?-1:I!==null?1:b.template_name.localeCompare(A.template_name)}),g.sort((b,A)=>b.is_default==="1"?-1:A.is_default==="1"?1:b.template_name.localeCompare(A.template_name));let h={};return Object.keys(d).sort().forEach(b=>{h[b]=d[b].sort((A,S)=>A.template_name.localeCompare(S.template_name))}),{starterTemplates:m,myTemplates:g,otherUsersTemplates:h}}function l(p){let{label:_,button:m}=a();if(!_||!m||!p)return;let g=p.options[p.selectedIndex],d=g?g.text:k("Select template");_.textContent=d||k("Select template")}function c(p,_){if(!p)return;let m=String(_||"");p.querySelectorAll(".aipkit_cw_template_list_item").forEach(g=>{let w=(g.dataset.templateId||"")===m;g.classList.toggle("is-active",w),g.setAttribute("aria-selected",w?"true":"false")})}function o(p,_=""){let{list:m}=a();if(!m||!p)return;let g=window.aipkit_cw_template_state?.currentTemplates||[],d=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!g.length){let x=p.disabled&&p.options.length&&p.options[0].text.toLowerCase().includes("loading"),E=document.createElement("div");E.className="aipkit_cw_template_picker_empty",E.textContent=k(x?"Loading templates...":"No templates found."),m.appendChild(E),l(p);return}let w=s(g,d),h=document.createDocumentFragment(),b=_.toLowerCase().trim(),A=(x,E)=>{let v=document.createElement("div");if(v.className="aipkit_cw_template_group_label",E){let C=document.createElement("span");C.className=`dashicons ${E}`,C.setAttribute("aria-hidden","true"),v.appendChild(C)}let y=document.createElement("span");return y.textContent=k(x),v.appendChild(y),v},S=(x,E)=>{let v=document.createElement("button");v.type="button",v.className="aipkit_cw_template_list_item",E&&v.classList.add("is-starter"),x.is_default==="1"&&v.classList.add("is-default"),v.dataset.templateId=String(x.id),v.dataset.templateLabel=x.template_name.toLowerCase(),v.setAttribute("role","option"),v.setAttribute("aria-selected","false");let y=i(x,E),C=document.createElement("span");C.className=`aipkit_cw_template_list_icon dashicons ${y}`,C.setAttribute("aria-hidden","true");let M=document.createElement("span");M.className="aipkit_cw_template_list_content";let B=document.createElement("span");if(B.className="aipkit_cw_template_list_name",B.textContent=k(x.template_name),M.appendChild(B),E){let W=e(x.template_name);if(W){let U=document.createElement("span");U.className="aipkit_cw_template_list_desc",U.textContent=k(W),M.appendChild(U)}}let D=document.createElement("span");return D.className="aipkit_cw_template_list_check dashicons dashicons-yes",D.setAttribute("aria-hidden","true"),v.appendChild(C),v.appendChild(M),v.appendChild(D),v},I=(x,E,v,y=!1)=>{let C=b?E.filter(B=>B.template_name.toLowerCase().includes(b)):E;if(!C.length)return 0;let M=document.createElement("div");return M.className="aipkit_cw_template_group",y&&M.classList.add("is-starter-group"),M.appendChild(A(x,v)),C.forEach(B=>{M.appendChild(S(B,y))}),h.appendChild(M),C.length},T=0;if(T+=I("Starter Templates",w.starterTemplates,"dashicons-star-filled",!0),T+=I("My Templates",w.myTemplates,"dashicons-admin-users",!1),Object.keys(w.otherUsersTemplates).forEach(x=>{T+=I(x,w.otherUsersTemplates[x],"dashicons-groups",!1)}),T===0){let x=document.createElement("div");x.className="aipkit_cw_template_picker_empty",x.textContent=k(b?"No templates match your search.":"No templates found."),m.appendChild(x)}else m.appendChild(h);l(p),c(m,p.value)}function t(p){let{select:_}=a();_&&o(_,p)}function r(){let{search:p,searchClear:_}=a();if(!p)return;let m=null;p.addEventListener("input",d=>{let w=d.target.value;_&&(_.style.display=w?"flex":"none"),clearTimeout(m),m=setTimeout(()=>{t(w)},150)}),_&&_.addEventListener("click",()=>{p.value="",_.style.display="none",t(""),p.focus()});let g=document.getElementById("aipkit_cw_template_picker_popover");g&&new MutationObserver(w=>{w.forEach(h=>{h.attributeName==="aria-hidden"&&g.getAttribute("aria-hidden")==="true"&&p.value&&(p.value="",_&&(_.style.display="none"),t(""))})}).observe(g,{attributes:!0})}function f(){let{select:p,list:_,button:m}=a();!p||!_||(r(),_.dataset.listenerAttached||(_.addEventListener("click",g=>{let d=g.target.closest(".aipkit_cw_template_list_item");if(!d||!p)return;let w=d.dataset.templateId||"";p.value=w,p.dispatchEvent(new Event("change",{bubbles:!0})),c(_,w),m&&m.click()}),_.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",()=>{l(p),c(_,p.value)}),p.dataset.listenerAttached="true"),o(p))}function u(p){let{select:_,list:m}=a();_&&(p!==void 0&&(_.value=p),l(_),c(m,_.value))}window.aipkit_initTemplatePicker=f,window.aipkit_renderTemplatePicker=o,window.aipkit_updateTemplatePickerSelection=u})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_template_action_list"),s=document.getElementById("aipkit_cw_template_inline_form"),l=document.getElementById("aipkit_cw_template_inline_delete_confirm"),c=document.getElementById("aipkit_cw_template_name_input");a&&(a.style.display=""),s&&(s.style.display="none",delete s.dataset.mode),l&&(l.style.display="none"),c&&(c.value="")}function n(){k()}function e(a,s=""){let l=document.getElementById("aipkit_cw_template_inline_form"),c=document.getElementById("aipkit_cw_template_name_input"),o=document.getElementById("aipkit_cw_template_action_list");!l||!c||(o&&(o.style.display="none"),l.style.display="flex",l.dataset.mode=a,c.value=s,c.focus())}function i(){let a=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_name_input");!a||!s||n()}window.aipkit_showTemplateNameForm=e,window.aipkit_hideTemplateNameForm=i,window.aipkit_closeTemplateActionsPopover=n,window.aipkit_resetTemplateActionsPanel=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function n(i){let a=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_inline_delete_confirm"),l=document.getElementById("aipkit_cw_template_delete_confirm_text"),c=document.getElementById("aipkit_cw_template_action_list");!a||!s||!l||(a.style.display="none",c&&(c.style.display="none"),s.style.display="flex",l.innerHTML=`Delete "<strong>${k(i)}</strong>"?`)}function e(){let i=document.getElementById("aipkit_cw_template_inline_delete_confirm"),a=document.getElementById("aipkit_cw_template_action_list");i&&(i.style.display="none",a&&(a.style.display=""),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover())}window.aipkit_showTemplateDeleteConfirm=n,window.aipkit_hideTemplateDeleteConfirm=e})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_cw_template_save_inline_btn"),e=document.getElementById("aipkit_cw_template_cancel_inline_btn"),i=document.getElementById("aipkit_cw_template_inline_form"),a=document.getElementById("aipkit_cw_template_name_input");if(!n||!e||!i||!a){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}e.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),n.addEventListener("click",async()=>{let s=i.dataset.mode,l=a.value.trim();if(!l){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}let c=document.getElementById("aipkit_content_writer_form"),o=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let t=window.aipkit_getContentWriterFormConfig(c);if(s==="new")await window.aipkit_saveContentWriterTemplate(0,l,t);else if(s==="rename"){let r=o.value;r&&await window.aipkit_saveContentWriterTemplate(parseInt(r),l,t)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_cw_template_confirm_delete_btn"),e=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!n||!e){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}e.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),n.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),a=i.value,s=document.getElementById("aipkit_content_writer_template_nonce_field"),l=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,c=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,o=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.isSavingOrDeleting=!0,l&&l("Updating...");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:a,_ajax_nonce:s?s.value:""}),c&&c("Updated"),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(i)}catch(t){console.error("Error deleting template:",t),o&&o(`Error: ${t.message||"Failed to delete template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_cw_template_select");if(!n){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(n):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?n.addEventListener("change",e=>window.aipkit_applyContentWriterTemplate(e.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_cw_save_as_template_btn");if(!n){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?n.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_cw_rename_template_btn");if(!n){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?n.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_cw_delete_template_btn");if(!n){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?n.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_cw_reset_starter_templates_btn");if(!n){console.warn("bindResetStarterTemplatesBtn: Button not found.");return}typeof window.aipkit_handleResetStarterTemplates=="function"?n.addEventListener("click",window.aipkit_handleResetStarterTemplates):console.error("bindResetStarterTemplatesBtn: handleResetStarterTemplates function missing.")}window.aipkit_bindResetStarterTemplatesBtn=k})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_post_status");if(!n){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(n.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=k})();(function(){"use strict";function k(){let n=document.querySelector(".aipkit_content_writer_inputs");if(!n){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(n.addEventListener("input",window.aipkit_checkFormForModifications),n.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=k})();(function(){"use strict";function k(){let n=["aipkit_initTemplateSelect","aipkit_initTemplatePicker","aipkit_bindSaveAsTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindResetStarterTemplatesBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let i of n)if(typeof window[i]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${i}`);return}window.aipkit_initTemplateSelect(),window.aipkit_initTemplatePicker(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindResetStarterTemplatesBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let e=document.getElementById("aipkit_cw_template_select");e&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(e.value):e&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function n(){let i=document.getElementById("aipkit_cw_save_as_post_btn");if(!i){console.warn("Save as Post Handler: Button not found.");return}i.addEventListener("click",e)}async function e(){let i=document.getElementById("aipkit_content_writer_form"),a=document.getElementById("aipkit_cw_save_as_post_btn"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_output_display"),c=document.getElementById("aipkit_cw_save_post_status");if(!i||!a||!s||!l||!c){console.error("Save as Post: Missing required UI elements.");return}let t=(typeof window.aipkit_getContentWriterRawHtml=="function"?window.aipkit_getContentWriterRawHtml():"")||s.innerHTML;if(!(s.textContent.trim().length>0||!!s.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))){c&&(c.textContent="Nothing to save. Please generate content first.",c.className="aipkit_cw_save_status aipkit_settings_message-error");return}let f=document.getElementById("aipkit_cw_generated_title_display"),u={post_title:f?f.textContent:"Untitled AI Post",post_content:t,generated_excerpt:i.elements.generated_excerpt?.value||"",generated_tags:i.elements.generated_tags?.value||"",meta_description:i.elements.meta_description?i.elements.meta_description.value:"",focus_keyword:i.elements.focus_keyword?i.elements.focus_keyword.value:"",post_type:i.elements.post_type?i.elements.post_type.value:"post",post_author:i.elements.post_author?i.elements.post_author.value:1,post_status:i.elements.post_status?i.elements.post_status.value:"draft",post_schedule_date:i.elements.post_schedule_date?i.elements.post_schedule_date.value:"",post_schedule_time:i.elements.post_schedule_time?i.elements.post_schedule_time.value:"",post_categories:i.elements["post_categories[]"]?Array.from(i.elements["post_categories[]"].selectedOptions).map(p=>p.value):[],generate_toc:i.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:i.elements.image_alignment?i.elements.image_alignment.value:"none",image_size:i.elements.image_size?i.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};c&&(c.textContent="Saving post...",c.className="aipkit_cw_save_status aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(a,!0,"Save","Saving...");try{let p=await window.aipkit_apiRequest("aipkit_content_writer_save_post",u);c&&(c.textContent=p.message||"Post saved successfully!",c.className="aipkit_cw_save_status aipkit_settings_message-success",p.edit_link&&(c.innerHTML+=` <a href="${k(p.edit_link)}" target="_blank">Edit Post</a>`))}catch(p){console.error("Error saving post:",p),c&&(c.textContent=`Error: ${p.message||"Failed to save post."}`,c.className="aipkit_cw_save_status aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(a,!1,"Save as Post"),setTimeout(()=>{c&&(c.textContent="",c.className="aipkit_cw_save_status")},5e3)}}window.aipkit_initSaveAsPostButton=n})();(function(){"use strict";function k(){let n=document.getElementById("aipkit_content_writer_container");if(!n){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let e=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),a=document.getElementById("aipkit_content_writer_stop_btn"),s=document.getElementById("aipkit_content_writer_copy_btn"),l=document.getElementById("aipkit_content_writer_clear_btn"),c=document.getElementById("aipkit_content_writer_provider"),o=document.getElementById("aipkit_content_writer_model"),t=document.getElementById("aipkit_content_writer_temperature"),r=document.getElementById("aipkit_cw_save_as_post_btn"),f=document.querySelector(".aipkit_cw_generation_status_indicators");if(!e||!i||!a||!s||!l||!c||!o||!t||!r){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(n):console.error("Content Writer Main: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initContentWriterAssistantSheet=="function"&&window.aipkit_initContentWriterAssistantSheet(n),typeof window.aipkit_initContentWriterPromptFlyouts=="function"?window.aipkit_initContentWriterPromptFlyouts(n):console.error("Content Writer Main: aipkit_initContentWriterPromptFlyouts function not found."),typeof window.aipkit_initContentWriterPromptModeManager=="function"?window.aipkit_initContentWriterPromptModeManager(n):console.error("Content Writer Main: aipkit_initContentWriterPromptModeManager function not found."),typeof window.aipkit_initContentWriterBulkEditor=="function"?window.aipkit_initContentWriterBulkEditor(n):console.error("Content Writer Main: aipkit_initContentWriterBulkEditor function not found."),typeof window.aipkit_initContentWriterGenerateMenu=="function"?window.aipkit_initContentWriterGenerateMenu():console.error("Content Writer Main: aipkit_initContentWriterGenerateMenu function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_content_writer_container"),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(n):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_initContentWriterExistingContent=="function"?window.aipkit_initContentWriterExistingContent(n):console.error("Content Writer Main: aipkit_initContentWriterExistingContent function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(c.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(n)}),o.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(n)}),window.aipkit_cw_toggleReasoningEffort(n)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_content_writer_container"):console.error("Content Writer Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"?window.aipkit_initContentWriterVectorStoreMultiSelect(n):console.error("Content Writer Main: aipkit_initContentWriterVectorStoreMultiSelect function not found."),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"?window.aipkit_initContentWriterCategoriesMultiSelect(n):console.error("Content Writer Main: aipkit_initContentWriterCategoriesMultiSelect function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(c,o,t,i,s,l):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initContentWriterAutosave=="function"?window.aipkit_initContentWriterAutosave():console.error("Content Writer Main: aipkit_initContentWriterAutosave function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let u=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;u&&typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),u&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():u&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),u&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():u&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(i,e,f,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(a,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){r&&(r.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){r&&(r.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=k})();(function(){"use strict";let k=!1,n=null,e=null,i=null,a=!1,s=null,l="aipkit_image_generator_status",c="aipkit_image_gen_preview_theme",o=["dark","light"];function t(){let O=document.getElementById("aipkit_image_generator_container");if(!O){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(O.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(F){console.error("AIPKit Image Generator: Error calling public UI initializer:",F);let N=document.getElementById("aipkit_public_image_results");N&&(N.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let F=document.getElementById("aipkit_public_image_results");F&&(F.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}U(O),D(O),v(O),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_image_generator_container"):console.error("AIPKit Image Generator: aipkit_initApiKeyToggles function not found.")}function r(){return document.getElementById(l)}function f(O,L){let F=r();if(!F)return;let N=F.classList.contains("aipkit_training_status");if(F.textContent=O||"",N){F.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),O&&F.classList.add("is-visible"),L&&F.classList.add(`is-${L}`);return}F.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),L==="success"?F.classList.add("aipkit_form-help-success"):L==="error"&&F.classList.add("aipkit_form-help-error")}function u(O=2500){i&&window.clearTimeout(i),i=window.setTimeout(()=>{f("","")},O)}function p(O){window.aipkit_dashboard||(window.aipkit_dashboard={});let L=window.aipkit_dashboard.providerStatus||{};L.replicate=!!String(O||"").trim(),window.aipkit_dashboard.providerStatus=L,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(document)}function _(){return document.getElementById("aipkit_image_generator_settings_form")}function m(){let O=_();if(!O)return console.error("AIPKit Image Settings: Settings form not found."),null;let L=new FormData(O);if(L.has("frontend_models")){let N=O.querySelector("#aipkit_image_gen_frontend_models");N&&N.value===""&&L.set("frontend_models","")}else{let N=O.querySelector("#aipkit_image_gen_frontend_models");N&&L.append("frontend_models",N.value||"")}let F={};return L.forEach((N,R)=>{F[R]=N}),Object.prototype.hasOwnProperty.call(F,"replicate_api_key")&&delete F.replicate_api_key,F}function g(O){if(!O)return"";let L={};return Object.keys(O).sort().forEach(F=>{L[F]=O[F]}),JSON.stringify(L)}function d(O){e=g(O)}function w(O){return g(O)!==e}function h(O){if(!(O||"").trim()||typeof window.aipkit_queueProviderSync!="function")return null;let F=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:R=>R;f(F("Syncing models...","gpt3-ai-content-generator"),"loading");let N=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return N&&typeof N.then=="function"&&N.then(()=>{f(F("Models synced!","gpt3-ai-content-generator"),"success"),u()}).catch(R=>{f(R?.message||F("Sync failed.","gpt3-ai-content-generator"),"error"),u(4e3)}),N}async function b(O){let L=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:F=>F;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Settings: aipkit_apiRequest not found.");return}f(L("Saving...","gpt3-ai-content-generator"),"loading");try{let F=await window.aipkit_apiRequest("aipkit_save_image_settings",O);return f(F.message||L("Settings saved!","gpt3-ai-content-generator"),"success"),u(),d(O),F}catch(F){throw f(F.message||L("Failed to save settings.","gpt3-ai-content-generator"),"error"),u(4e3),console.error("AIPKit Image Settings Save Error:",F),F}}async function A(O){let L=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:F=>F;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Generator: aipkit_apiRequest not found.");return}f(L("Saving...","gpt3-ai-content-generator"),"loading");try{let F=await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:O});return p(O),f(F.message||L("Replicate key saved!","gpt3-ai-content-generator"),"success"),u(),h(O),F}catch(F){throw f(F.message||L("Failed to save Replicate key.","gpt3-ai-content-generator"),"error"),u(4e3),console.error("AIPKit Replicate Key Save Error:",F),F}}function S(O){if(O){if(k){n=O;return}k=!0,b(O).catch(()=>{}).finally(()=>{if(k=!1,n){let L=n;n=null,w(L)&&S(L)}})}}function I(){let O=m();!O||!w(O)||S(O)}function T(){let O=m();O&&d(O)}function x(O){if(!O)return;let L="data-aipkit-image-autosave-attached";if(O.hasAttribute(L))return;let F=()=>{I()};O.addEventListener("change",N=>{let R=N.target;!R||!R.matches(".aipkit_autosave_trigger")||F()}),O.addEventListener("blur",N=>{let R=N.target;!R||!R.matches(".aipkit_autosave_trigger")||F()},!0),O.setAttribute(L,"true"),T()}function E(O){let L=O.querySelector("#aipkit_replicate_api_key");if(!L)return;let F="data-replicate-autosave-attached";if(L.hasAttribute(F))return;s=L.value||"",p(s);let N=()=>{let R=L.value||"";R===s||a||(a=!0,A(R).then(()=>{s=R}).catch(()=>{}).finally(()=>{a=!1;let H=m();H&&d(H)}))};L.addEventListener("change",N),L.addEventListener("blur",N),L.setAttribute(F,"true")}function v(O){let L=O.querySelector("#aipkit_image_generator_settings_popover");if(!L)return;typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(O):console.error("AIPKit Image Generator: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),y(L);let F="data-token-listener-attached";L.hasAttribute(F)||(L.addEventListener("change",function(N){N.target.closest(".aipkit_token_limit_mode_select")&&C(L)}),L.setAttribute(F,"true")),C(L);try{M(L)}catch(N){console.error("AIPKit Image Settings: Failed to init model selector",N)}x(L),E(L)}function y(O){let L=O.querySelector("#aipkit_image_generator_settings_panel");if(!L)return;let F=Array.from(L.querySelectorAll("[data-aipkit-settings-panel]"));if(!F.length||L.dataset.panelsBound==="true")return;let N=O.querySelector(".aipkit_model_settings_popover_title"),R=O.querySelector(".aipkit_model_settings_popover_back"),H=document.getElementById("aipkit_image_generator_settings_trigger"),K={root:L.dataset.titleRoot||"Settings","token-management":L.dataset.titleTokenManagement||"Token Management",replicate:L.dataset.titleReplicate||"Replicate","ui-text":L.dataset.titleUiText||"UI Text","custom-css":L.dataset.titleCustomCss||"Custom CSS","provider-filtering":L.dataset.titleProviderFiltering||"Provider Filtering"},re=null,ve=Ie=>{let Ee=Ie||"root",Z=L.querySelector(`[data-aipkit-settings-panel="${Ee}"]`)||L.querySelector('[data-aipkit-settings-panel="root"]');if(!Z)return;let pe=Z.dataset.aipkitSettingsPanel||"root";if(pe!==re){if(F.forEach(we=>{we.hidden=we!==Z}),N&&(N.textContent=K[pe]||K.root),R&&(R.hidden=pe==="root"),pe==="token-management"&&C(O),pe==="replicate"){let we=O.querySelector("#aipkit_replicate_api_key");h(we?we.value:"")}re=pe,O.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))})}};L.addEventListener("click",Ie=>{let Ee=Ie.target.closest("[data-aipkit-panel-target]");Ee&&(Ie.preventDefault(),ve(Ee.dataset.aipkitPanelTarget))}),R&&R.addEventListener("click",Ie=>{Ie.preventDefault(),ve("root")}),H&&H.addEventListener("click",()=>{ve("root")}),ve("root"),L.dataset.panelsBound="true"}function C(O){if(!O)return;let L=O.querySelector(".aipkit_token_limit_mode_select"),F=O.querySelector(".aipkit_token_general_user_limit_field"),N=O.querySelector(".aipkit_token_role_limits_container");if(!L||!F||!N)return;let R=L.value;F&&(F.hidden=R!=="general"),N&&(N.hidden=R!=="role_based")}function M(O){let L=O.querySelector("#aipkit_image_gen_models_selector");if(!L||L.getAttribute("data-enhanced")==="true")return;let F=O.querySelector("#aipkit_image_gen_frontend_models"),N=L.dataset.initialValue||"",H=!0&&N===""?[]:N.split(",").map(ne=>ne.trim()).filter(Boolean),K=new Set(H),re=window.aipkit_image_generator_config_public||{},ve=ne=>{if(!ne||typeof ne!="object")return!1;let ye={image_output:!0,image_generation:!0};if(!ne.capabilities||typeof ne.capabilities!="object")return!0;let Me={...ye,...ne.capabilities};return!!(Me.image_output||Me.image_generation)},Ie=re.azure_models||[];if((!Ie||Ie.length===0)&&window.aipkit_dashboard_providers)try{Array.isArray(window.aipkit_dashboard_providers.AzureImage)&&(Ie=window.aipkit_dashboard_providers.AzureImage.map(ne=>typeof ne=="string"?{id:ne,name:ne}:ne))}catch{}let Ee=[{key:"openai",label:"OpenAI",type:"flat",models:(re.openai_models||[]).map(ne=>({id:ne.id,name:ne.name}))},{key:"openrouter",label:"OpenRouter",type:"flat",models:(re.openrouter_image_models||[]).filter(ne=>ve(ne)).map(ne=>({id:ne.id||ne.name||ne,name:ne.name||ne.id||ne}))},{key:"azure",label:"Azure",type:"flat",models:Ie.map(ne=>ne.id?ne:{id:ne.id||ne.name||ne,name:ne.name||ne.id||ne})},{key:"google",label:"Google",type:"grouped",models:re.google_models||{}},{key:"replicate",label:"Replicate",type:"flat",models:(re.replicate_models||[]).map(ne=>ne.id?ne:{id:ne.id||ne.name||ne,name:ne.name||ne.id||ne})}].filter(ne=>ne.key==="azure"||ne.key==="openrouter"?!0:ne.models&&(Array.isArray(ne.models)?ne.models.length:Object.keys(ne.models).length));L.innerHTML="",L.classList.add("aipkit_models_selector--ready");let Z=document.createElement("input");Z.type="search",Z.placeholder="Filter models...",Z.className="aipkit_models_selector-search",L.appendChild(Z);let pe=document.createElement("div");pe.className="aipkit_models_selector-summary",L.appendChild(pe);let we=document.createElement("div");we.className="aipkit_models_selector-providers",L.appendChild(we),Ee.forEach(ne=>{let ye=document.createElement("div");ye.className="aipkit_models_selector-provider",ye.dataset.provider=ne.key;let Me=document.createElement("div");Me.className="aipkit_models_selector-provider-header",Me.innerHTML=`<strong>${ne.label}</strong>`;let nt=document.createElement("div");nt.className="aipkit_models_selector-provider-actions";let se=document.createElement("button");se.type="button",se.className="aipkit_btn aipkit_btn-xs",se.textContent="All";let be=document.createElement("button");be.type="button",be.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",be.textContent="None",nt.appendChild(se),nt.appendChild(be),Me.appendChild(nt),ye.appendChild(Me);let xe=document.createElement("div");xe.className="aipkit_models_selector-models";let Re=De=>{if(!De||!De.id)return;let ze=De.id,Ze=document.createElement("label");Ze.className="aipkit_models_selector-item",Ze.title=ze;let it=document.createElement("input");it.type="checkbox",it.value=ze,it.checked=K.has(ze),it.dataset.modelId=ze,it.addEventListener("change",()=>{ae(!0)});let Pt=document.createElement("span");Pt.textContent=De.name||ze,Ze.appendChild(it),Ze.appendChild(Pt),xe.appendChild(Ze)};if(ne.type==="grouped"?Object.keys(ne.models).forEach(De=>{let ze=ne.models[De];if(!Array.isArray(ze))return;let Ze=document.createElement("div");Ze.className="aipkit_models_selector-subgroup",Ze.textContent=De.charAt(0).toUpperCase()+De.slice(1),xe.appendChild(Ze),ze.forEach(it=>Re(it))}):ne.models.forEach(De=>Re(De)),ne.key==="azure"&&ne.models.length===0){let De=document.createElement("div");De.className="aipkit_models_selector-empty",De.textContent="No Azure image models found. Sync Azure Image models in the main Models settings first.",xe.appendChild(De)}if(ne.key==="openrouter"&&ne.models.length===0){let De=document.createElement("div");De.className="aipkit_models_selector-empty",De.textContent="No image-capable OpenRouter models found. Sync OpenRouter models in the main Models settings first.",xe.appendChild(De)}se.addEventListener("click",()=>{xe.querySelectorAll('input[type="checkbox"]').forEach(De=>{De.checked=!0}),ae(!0)}),be.addEventListener("click",()=>{xe.querySelectorAll('input[type="checkbox"]').forEach(De=>{De.checked=!1}),ae(!0)}),ye.appendChild(xe),we.appendChild(ye)}),Z.addEventListener("input",()=>{let ne=Z.value.toLowerCase();we.querySelectorAll(".aipkit_models_selector-item").forEach(ye=>{let Me=ye.textContent.toLowerCase();ye.style.display=Me.includes(ne)?"":"none"})}),L.setAttribute("data-enhanced","true"),de();function de(){let ne=Array.from(L.querySelectorAll(".aipkit_models_selector-item input:checked")).map(ye=>ye.value);ne.length===0?pe.textContent="Showing all models (none selected)":pe.textContent=`${ne.length} model${ne.length>1?"s":""} selected`}function ae(ne=!1){let ye=Array.from(L.querySelectorAll(".aipkit_models_selector-item input:checked")).map(Me=>Me.value.trim()).filter(Boolean);F&&(F.value=ye.join(", ")),de(),ne&&I()}window.aipkit_syncAllowedModelsHiddenField=ae}function B(O=!1){typeof window.aipkit_syncAllowedModelsHiddenField=="function"&&window.aipkit_syncAllowedModelsHiddenField(O)}function D(O){let L=O.querySelector("#aipkit_theme_switcher_toggle_btn"),F=O.querySelector(".aipkit_image_generator_admin_preview_wrapper");if(!L||!F){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",O);return}let N=o.indexOf(localStorage.getItem(c)||"dark");N===-1&&(N=o.indexOf("dark")),W(o[N],F,L),L.hasAttribute("data-listener-attached")||(L.addEventListener("click",function(){N=(N+1)%o.length;let R=o[N];W(R,F,L),localStorage.setItem(c,R)}),L.setAttribute("data-listener-attached","true"))}function W(O,L,F){let N=L.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");N&&(o.forEach(K=>N.classList.remove(`aipkit-theme-${K}`)),N.classList.add(`aipkit-theme-${O}`));let R=O.charAt(0).toUpperCase()+O.slice(1),H="Toggle Preview Theme";F.title=`${H} (Current: ${R})`}function U(O){let L=O.querySelector("#aipkit_image_generator_shortcode_snippet"),F=O.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),N=O.querySelector("#aipkit_image_generator_shortcode_configurator"),R=O.querySelector("#aipkit_image_generator_shortcode_configurator .aipkit_model_settings_popover_close"),H=O.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!L||!F||!N||H.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",O);return}F.hasAttribute("data-listener-attached")||(F.addEventListener("click",()=>{let K=N.style.display==="none"||!N.style.display;N.style.display=K?"flex":"none",F.classList.toggle("aipkit_active",K),F.setAttribute("aria-expanded",K.toString())}),R&&R.addEventListener("click",()=>{N.style.display="none",F.classList.remove("aipkit_active"),F.setAttribute("aria-expanded","false")}),J(N),H.forEach(K=>K.addEventListener("change",()=>{K.name==="cfg_mode"&&J(N),oe(O)})),L.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(L.textContent,L):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),oe(O),F.setAttribute("data-listener-attached","true"))}function J(O){if(!O)return;let L=O.querySelector('select[name="cfg_mode"]');if(!L)return;let F=O.querySelector(".aipkit_image_shortcode_default_mode_row"),N=O.querySelector(".aipkit_image_shortcode_mode_switch_row"),R=O.querySelector('select[name="cfg_default_mode"]'),H=O.querySelector('input[name="cfg_show_mode_switch"]'),K=L.value==="both";F&&(F.hidden=!K),N&&(N.hidden=!K),K||(R&&(R.value=L.value==="edit"?"edit":"generate"),H&&(H.checked=!0))}function oe(O){let L=O.querySelector("#aipkit_image_generator_shortcode_snippet"),F=O.querySelector("#aipkit_image_generator_shortcode_configurator");if(!L||!F)return;let N=F.querySelector('input[name="cfg_show_provider"]').checked,R=F.querySelector('input[name="cfg_show_model"]').checked,H=F.querySelector('input[name="cfg_show_history"]').checked,K=F.querySelector('select[name="cfg_mode"]'),re=F.querySelector('select[name="cfg_default_mode"]'),ve=F.querySelector('input[name="cfg_show_mode_switch"]'),Ie=F.querySelector('select[name="cfg_theme"]'),Ee=F.querySelector('input[name="cfg_theme"]:checked'),Z=Ie?Ie.value:Ee?Ee.value:"dark",pe=K?K.value:"generate",we=re?re.value:"generate",de=ve?ve.checked:!0,ae="[aipkit_image_generator";N||(ae+=' show_provider="false"'),R||(ae+=' show_model="false"'),H&&(ae+=' history="true"'),pe!=="generate"&&(ae+=` mode="${pe}"`),pe==="both"&&we!=="generate"&&(ae+=` default_mode="${we}"`),pe==="both"&&!de&&(ae+=' show_mode_switch="false"'),Z!=="dark"&&(ae+=` theme="${Z}"`),ae+="]",L.textContent=ae}window.aipkit_initImageGenerator=t})();(function(){"use strict";function k(n,e,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof e=="function"&&e(new Error("API function missing."),null,i);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_title,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof e=="function"&&e(new Error("Configuration missing (nonce)."),null,i);return}let c={_ajax_nonce:s,post_id:n};window.aipkit_apiRequest("aipkit_generate_title_suggestions",c).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(l.no_suggestions_title||"No title suggestions generated.");typeof e=="function"&&e(null,o.suggestions,i)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Title):",o),typeof e=="function"&&e(o,null,i)})}window.aipkit_fetchTitleSuggestions=k})();(function(){"use strict";let k=null;function n(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function e(s,l,c){k&&n();let o=window.aipkit_escapeHtml||function(d){return d},t=window.aipkit_escapeAttribute||o,r=c?.default_ai_provider||"N/A",f=c?.default_ai_model||"N/A",u=c?.default_ai_params||{},p=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(r)}</strong>`).replace("%2$s",`<strong>${o(f)}</strong>`).replace("%3$s",o(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",d=>{d.target===k&&n()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=s,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(l.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${t(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(l.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",n),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(f){return f},t=window.aipkit_escapeAttribute||o;c.innerHTML=`
            <p>${o(l.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(f=>`<li data-new-title="${t(f)}">${o(f)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let r=c.querySelector(".aipkit-suggestions-list");r&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(r):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(t){return t};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(l.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${o(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=e,window.aipkit_updateModalWithSuggestions=i,window.aipkit_updateModalWithError=a,window.aipkit_closePostTitleModal=n})();(function(){"use strict";let k=!1;function n(){k=!1}function e(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),o=c?.dataset.postId,t=l.dataset.newTitle,r=c?.querySelector(".aipkit-modal-status"),f=c?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!o||!t||!r||!f){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),r&&(r.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),k=!1;return}f.forEach(p=>p.classList.add("aipkit-disabled")),r.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_title||"Updating Title..."}`,r.style.color="",i(o,t,r,f,u)}function i(s,l,c,o,t){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let r=window.aipkit_post_enhancer?.nonce_update_title;if(!r){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let f={_ajax_nonce:r,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_title",f).then(u=>{let p=document.querySelector(`#post-${s} .row-title`);p?p.textContent=l:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${s}.`);let _=document.getElementById(`post-${s}`);if(_){let m=_.querySelector(`#inline_${s}`);if(m){let g=m.querySelector(".post_title");g?g.textContent=l:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${s}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${s}.`)}window.aipkit_closePostTitleModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Title):",u),c.innerHTML=`<span class="error">${u.message||t.error_updating_title||"Error updating title."}</span>`,o.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-title]");c&&e({currentTarget:c})})}window.aipkit_attachSuggestionClickListener=a,window.aipkit_resetTitleUpdateFlag=n})();(function(){"use strict";function k(n,e,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof e=="function"&&e(new Error("API function missing."),null,i);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_excerpt,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof e=="function"&&e(new Error("Configuration missing (nonce)."),null,i);return}let c={_ajax_nonce:s,post_id:n};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",c).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(l.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof e=="function"&&e(null,o.suggestions,i)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",o),typeof e=="function"&&e(o,null,i)})}window.aipkit_fetchExcerptSuggestions=k})();(function(){"use strict";let k=null;function n(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function e(s,l,c){k&&n();let o=window.aipkit_escapeHtml||function(d){return d},t=window.aipkit_escapeAttribute||o,r=c?.default_ai_provider||"N/A",f=c?.default_ai_model||"N/A",u=c?.default_ai_params||{},p=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(r)}</strong>`).replace("%2$s",`<strong>${o(f)}</strong>`).replace("%3$s",o(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",d=>{d.target===k&&n()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=s,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(l.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${t(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(l.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",n),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(f){return f},t=window.aipkit_escapeAttribute||o;c.innerHTML=`
            <p>${o(l.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(f=>`<li data-new-excerpt="${t(f)}">${o(f)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let r=c.querySelector(".aipkit-suggestions-list");r&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(r):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(t){return t};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(l.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${o(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=e,window.aipkit_updateModalWithExcerptSuggestions=i,window.aipkit_updateModalWithErrorExcerpt=a,window.aipkit_closePostExcerptModal=n})();(function(){"use strict";let k=!1;function n(){k=!1}function e(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),o=c?.dataset.postId,t=l.dataset.newExcerpt,r=c?.querySelector(".aipkit-modal-status"),f=c?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!o||t===void 0||!r||!f){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:o,newExcerpt:t,statusDiv:r,listItems:f}),r&&(r.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),k=!1;return}f.forEach(p=>p.classList.add("aipkit-disabled")),r.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_excerpt||"Updating Excerpt..."}`,r.style.color="",i(o,t,r,f,u)}function i(s,l,c,o,t){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let r=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!r){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let f={_ajax_nonce:r,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_excerpt",f).then(u=>{window.aipkit_closePostExcerptModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",u),c.innerHTML=`<span class="error">${u.message||t.error_updating_excerpt||"Error updating excerpt."}</span>`,o.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-excerpt]");c&&e({currentTarget:c})})}window.aipkit_attachExcerptSuggestionClickListener=a,window.aipkit_resetExcerptUpdateFlag=n})();(function(){"use strict";function k(n,e,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof e=="function"&&e(new Error("API function missing."),null,i);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_meta,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof e=="function"&&e(new Error("Configuration missing (nonce)."),null,i);return}let c={_ajax_nonce:s,post_id:n};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",c).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(l.no_suggestions_meta||"No meta description suggestions generated.");typeof e=="function"&&e(null,o.suggestions,i)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",o),typeof e=="function"&&e(o,null,i)})}window.aipkit_fetchMetaSuggestions=k})();(function(){"use strict";let k=null;function n(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function e(s,l,c){k&&n();let o=window.aipkit_escapeHtml||function(d){return d},t=window.aipkit_escapeAttribute||o,r=c?.default_ai_provider||"N/A",f=c?.default_ai_model||"N/A",u=c?.default_ai_params||{},p=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(r)}</strong>`).replace("%2$s",`<strong>${o(f)}</strong>`).replace("%3$s",o(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",d=>{d.target===k&&n()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=s,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(l.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${t(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(l.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",n),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(f){return f},t=window.aipkit_escapeAttribute||o;c.innerHTML=`
            <p>${o(l.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(f=>`<li data-new-meta="${t(f)}">${o(f)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let r=c.querySelector(".aipkit-suggestions-list");r&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(r):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||function(t){return t};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(l.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${o(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=e,window.aipkit_updateModalWithMetaSuggestions=i,window.aipkit_updateModalWithErrorMeta=a,window.aipkit_closePostMetaModal=n})();(function(){"use strict";let k=!1;function n(){k=!1}function e(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),o=c?.dataset.postId,t=l.dataset.newMeta,r=c?.querySelector(".aipkit-modal-status"),f=c?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!o||t===void 0||!r||!f){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:o,newMetaDesc:t,statusDiv:r,listItems:f}),r&&(r.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),k=!1;return}f.forEach(p=>p.classList.add("aipkit-disabled")),r.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_meta||"Updating Meta Desc..."}`,r.style.color="",i(o,t,r,f,u)}function i(s,l,c,o,t){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let r=window.aipkit_post_enhancer?.nonce_update_meta;if(!r){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let f={_ajax_nonce:r,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_meta_desc",f).then(u=>{try{let m=`${`#post-${s}`} .column-wpseo-metadesc`,g=document.querySelector(m);g&&(g.textContent=window.aipkit_escapeHtml(l),g.style.transition="background-color 0.1s ease-out",g.style.backgroundColor="#f0f7ff",setTimeout(()=>{g.style.backgroundColor=""},300))}catch(p){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",p)}window.aipkit_closePostMetaModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Meta):",u),c.innerHTML=`<span class="error">${u.message||t.error_updating_meta||"Error updating meta description."}</span>`,o.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-meta]");c&&e({currentTarget:c})})}window.aipkit_attachMetaSuggestionClickListener=a,window.aipkit_resetMetaUpdateFlag=n})();(function(){"use strict";function k(n,e,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof e=="function"&&e(new Error("API function missing."),null,i);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_tags,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof e=="function"&&e(new Error("Configuration missing (nonce)."),null,i);return}let c={_ajax_nonce:s,post_id:n};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",c).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(l.no_suggestions_tags||"No tag suggestions generated.");typeof e=="function"&&e(null,o.suggestions,i)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",o),typeof e=="function"&&e(o,null,i)})}window.aipkit_fetchTagsSuggestions=k})();(function(){"use strict";let k=null;function n(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function e(s,l,c){k&&n();let o=window.aipkit_escapeHtml||(d=>d),t=window.aipkit_escapeAttribute||o,r=c?.default_ai_provider||"N/A",f=c?.default_ai_model||"N/A",u=c?.default_ai_params||{},p=u.temperature!==void 0?parseFloat(u.temperature).toFixed(1):"N/A",m=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(r)}</strong>`).replace("%2$s",`<strong>${o(f)}</strong>`).replace("%3$s",o(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",d=>{d.target===k&&n()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=s,g.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${o(l.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${t(l.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${o(l.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${m}</p>
            </div>
        </div>
    `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",n),requestAnimationFrame(()=>k.classList.add("aipkit-active")),k}function i(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||(f=>f),t=window.aipkit_escapeAttribute||o;c.innerHTML=`
        <p>${o(l.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${s.map(f=>`<li data-new-tags="${t(f)}">${o(f)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let r=c.querySelector(".aipkit-suggestions-list");r&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(r):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let o=window.aipkit_escapeHtml||(t=>t);c.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${o(l.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${o(s)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=e,window.aipkit_updateModalWithTagsSuggestions=i,window.aipkit_updateModalWithErrorTags=a,window.aipkit_closePostTagsModal=n})();(function(){"use strict";let k=!1;function n(){k=!1}function e(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),o=c?.dataset.postId,t=l.dataset.newTags,r=c?.querySelector(".aipkit-modal-status"),f=c?.querySelectorAll(".aipkit-suggestions-list li"),u=window.aipkit_post_enhancer?.text||{};if(!o||t===void 0||!r||!f){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:o,newTags:t,statusDiv:r,listItems:f}),r&&(r.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),k=!1;return}f.forEach(p=>p.classList.add("aipkit-disabled")),r.innerHTML=`<span class="aipkit_spinner"></span> ${u.updating_tags||"Updating Tags..."}`,r.style.color="",i(o,t,r,f,u)}function i(s,l,c,o,t){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let r=window.aipkit_post_enhancer?.nonce_update_tags;if(!r){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(u=>u.classList.remove("aipkit-disabled")),k=!1;return}let f={_ajax_nonce:r,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_tags",f).then(u=>{let p=document.getElementById(`post-${s}`);if(p){let _=p.querySelector(".column-tags");_&&(_.textContent=l.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(u=>{console.error("AIPKit Post Enhancer Update Error (Tags):",u),c.innerHTML=`<span class="error">${u.message||t.error_updating_tags||"Error updating tags."}</span>`,o.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-tags]");c&&e({currentTarget:c})})}window.aipkit_attachTagsSuggestionClickListener=a,window.aipkit_resetTagsUpdateFlag=n})();(function(){"use strict";function k(n,e,i){let s=(window.aipkit_post_enhancer||{}).text||{};n?window.aipkit_updateModalWithErrorTags(n.message||s.error_loading_tags,s):e?window.aipkit_updateModalWithTagsSuggestions(e,s):window.aipkit_updateModalWithErrorTags(s.error_loading_tags||"Unknown error occurred.",s)}window.aipkit_handleTagsSuggestionsResult=k})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function k(o,t=60){return o.length<=t?o:o.substring(0,t-3)+"..."}function n(o,t="info"){let r=document.getElementById("aipkit-enhancer-bulk-status-log");if(r){let f=document.createElement("div");f.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${t}`,f.textContent=o,r.appendChild(f),r.scrollTop=r.scrollHeight}}function e(){let o=document.getElementById("aipkit-enhancer-bulk-progress-bar"),t=document.getElementById("aipkit-enhancer-progress-text"),r=document.getElementById("aipkit-enhancer-progress-stats");if(o&&window.aipkit_enhancer_bulkState.total>0){let f=window.aipkit_enhancer_bulkState.completed,u=window.aipkit_enhancer_bulkState.failed,p=window.aipkit_enhancer_bulkState.total,_=f+u,m=Math.round(_/p*100);o.style.width=`${m}%`,t&&(_===p?t.textContent="Update complete!":t.textContent=`Processing ${_+1} of ${p}...`),r&&(u>0?r.innerHTML=`${m}% \u2022 <span style="color: #28a745;">${f} successful</span> \u2022 <span style="color: #dc3545;">${u} failed</span>`:r.textContent=`${m}%`)}}function i(o){let t=document.getElementById("aipkit-enhancer-bulk-status-log");if(!t)return;let f=(window.aipkit_enhancer_postTitles||{})[o]||`Post #${o}`;f=k(f,60);let u=document.createElement("div");u.className="aipkit_enhancer_post_steps",u.id=`aipkit_enhancer_post_${o}_steps`;let p=document.createElement("div");p.className="aipkit_enhancer_post_header",p.innerHTML=`<strong>${f}</strong>`;let _=document.createElement("div");_.className="aipkit_enhancer_steps_container",_.id=`aipkit_enhancer_steps_${o}`,u.appendChild(p),u.appendChild(_),t.appendChild(u),t.scrollTop=t.scrollHeight;let m=[],g=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(d=>{g[d]&&g[d].prompt&&m.push({field:d,display_name:d.charAt(0).toUpperCase()+d.slice(1).replace("_"," ")})}),g.generate_seo_slug==="1"&&m.push({field:"slug",display_name:"URL"}),m.forEach(d=>{let w=document.createElement("div");w.className="aipkit_enhancer_step aipkit_enhancer_step--pending",w.id=`aipkit_enhancer_step_${o}_${d.field}`,w.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${d.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,_.appendChild(w)})}function a(o,t,r,f=""){let u=document.getElementById(`aipkit_enhancer_step_${o}_${t}`);if(!u)return;u.className=`aipkit_enhancer_step aipkit_enhancer_step--${r}`;let p="\u23F3",_="Pending";switch(r){case"processing":p="\u{1F504}",_="Processing...";break;case"completed":p="\u2705",_="Completed";break;case"error":p="\u274C",_="Failed";break;case"pending":p="\u23F3",_="Pending";break}u.querySelector(".aipkit_enhancer_step_icon").textContent=p,u.querySelector(".aipkit_enhancer_step_status").textContent=_,f&&(u.title=f);let m=document.getElementById("aipkit-enhancer-bulk-status-log");m&&(m.scrollTop=m.scrollHeight)}function s(o,t,r){let f=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!f||r.length===0)return;let u=t.length+r.length,p=document.createElement("div");p.className="aipkit_enhancer_completion_message",t.length===0?p.innerHTML=`<strong style="color: #dc3545;">\u274C All ${u} enhancement steps failed!</strong>`:p.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${t.length} of ${u} steps. ${r.length} failed.</strong>`,f.appendChild(p);let _=document.getElementById("aipkit-enhancer-bulk-status-log");_&&(_.scrollTop=_.scrollHeight)}function l(o,t){let r=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!r)return;t.forEach(_=>{let m=document.getElementById(`aipkit_enhancer_step_${o}_${_.field}`);if(m){m.className=`aipkit_enhancer_step aipkit_enhancer_step--${_.status}`;let g="\u23F3";switch(_.status){case"completed":g="\u2705";break;case"error":g="\u274C";break;case"processing":g="\u{1F504}";break;case"pending":g="\u23F3";break}m.querySelector(".aipkit_enhancer_step_icon").textContent=g,m.querySelector(".aipkit_enhancer_step_status").textContent=_.status.charAt(0).toUpperCase()+_.status.slice(1),_.message&&(m.title=_.message)}});let f=t.filter(_=>_.status==="completed").length,u=t.length;if(f!==u){let _=document.createElement("div");_.className="aipkit_enhancer_completion_message";let m=t.filter(g=>g.status==="error").length;_.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${f} of ${u} steps. ${m} failed.</strong>`,r.appendChild(_)}let p=document.getElementById("aipkit-enhancer-bulk-status-log");p&&(p.scrollTop=p.scrollHeight)}function c(o,t){let r=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!r)return;r.querySelectorAll(".aipkit_enhancer_step").forEach(_=>{_.classList.contains("aipkit_enhancer_step--completed")||(_.className="aipkit_enhancer_step aipkit_enhancer_step--error",_.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",_.querySelector(".aipkit_enhancer_step_status").textContent="Failed",_.title=t)});let u=document.createElement("div");u.className="aipkit_enhancer_completion_message",u.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${t}</strong>`,r.appendChild(u);let p=document.getElementById("aipkit-enhancer-bulk-status-log");p&&(p.scrollTop=p.scrollHeight)}window.aipkit_enhancer_logToModal=n,window.aipkit_enhancer_updateProgressBar=e,window.aipkit_enhancer_initStepProgress=i,window.aipkit_enhancer_updateFieldStatus=a,window.aipkit_enhancer_showPostCompletion=s,window.aipkit_enhancer_displayStepResults=l,window.aipkit_enhancer_showStepError=c,window.aipkit_enhancer_truncateTitle=k})();(function(){"use strict";function k(e="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let i=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!i)return;e==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let a=i.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");a&&(a.textContent="Start");let s=i.querySelector("#aipkit_bulk_enhancer_start_btn");s&&(s.disabled=!1,s.hidden=!0),i.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let l=i.querySelector("#aipkit_bulk_enhancer_cancel_btn");l&&(l.hidden=!1),i.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!1}function n(){let e=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!e)return;window.aipkit_enhancer_bulkState.isRunning&&k("user"),e.querySelector("#aipkit-enhancer-bulk-config").hidden=!1,e.querySelector("#aipkit-enhancer-bulk-progress").hidden=!0;let i=e.querySelector("#aipkit_bulk_enhancer_start_btn");i&&(i.disabled=!1,i.hidden=!1);let a=e.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");a&&(a.textContent="Start"),e.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let s=e.querySelector("#aipkit_bulk_enhancer_cancel_btn");s&&(s.hidden=!1),e.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0;let l=e.querySelector("#aipkit-enhancer-bulk-status-log");l&&(l.innerHTML="");let c=e.querySelector("#aipkit-enhancer-bulk-progress-bar");c&&(c.style.width="0%");let o=e.querySelector("#aipkit-enhancer-progress-text");o&&(o.textContent="Processing posts...");let t=e.querySelector("#aipkit-enhancer-progress-stats");t&&(t.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=k,window.aipkit_enhancer_returnToSettings=n})();(function(){"use strict";function k(o){let t=o.querySelector("#aipkit_bulk_ai_provider"),r=o.querySelector("#aipkit_bulk_ai_model"),f=o.querySelector(".aipkit_enhancer_reasoning_effort_field"),u=o.querySelector("#aipkit_bulk_reasoning_effort");if(!t||!r||!f||!u){f&&(f.style.display="none");return}let p=(t.value||"").toLowerCase(),m=(r.value||"").toLowerCase();if(!(p==="openai"&&e(m))){f.style.display="none";return}f.style.display="block",n(o,m)}function n(o,t){let r=o.querySelector("#aipkit_bulk_reasoning_effort");if(!r)return;let f=a(t),u=new Set(f.allowed),p=r.value||"";p==="minimal"&&(p="low"),Array.from(r.options).forEach(_=>{let m=u.has(_.value);_.hidden=!m,_.disabled=!m}),u.has(p)||(p=f.defaultValue),u.has(p)||(p=f.allowed[0]||""),p&&(r.value=p)}function e(o){if(i(o))return!1;let t=o.startsWith("o1")||o.startsWith("o3")||o.startsWith("o4"),r=o.includes("gpt-5");return t||r}function i(o){return/(?:^|[-_])chat(?:[-_]|$)/.test(o)}function a(o){return l(o)?{allowed:["high"],defaultValue:"high"}:o.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(o)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(o){let t=o.match(/gpt-5\.(\d+)/);if(t)return Number.parseInt(t[1],10)>=2;let r=o.match(/gpt-(\d+)/);return r?Number.parseInt(r[1],10)>=6:!1}function l(o){return/gpt-5(\.\d+)?-pro/.test(o)}function c(o,t){let r=o.value.toLowerCase(),u=(window.aipkit_dashboard?.models||{})[r]||[],p=window.aipkit_escapeHtml||(h=>h),_=window.wp?.i18n?.__||(h=>h),m=window.aipkit_dashboard?.recommendedModels?.[r]||[],g=Array.isArray(m)?m:[],d=new Set(g.map(h=>h?.id).filter(Boolean));if(t.innerHTML="",g.length>0){let h=document.createElement("optgroup");h.label=p(_("Recommended","gpt3-ai-content-generator")),g.forEach(b=>{b&&b.id&&h.appendChild(new Option(p(b.name||b.id),b.id))}),h.children.length>0&&t.appendChild(h)}if(r==="openai"&&typeof u=="object"&&!Array.isArray(u))Object.keys(u).forEach(h=>{let b=document.createElement("optgroup");b.label=p(h),Array.isArray(u[h])&&u[h].forEach(A=>{A&&A.id&&d.has(A.id)||A&&A.id&&b.appendChild(new Option(p(A.name||A.id),A.id))}),b.children.length>0&&t.appendChild(b)});else if(Array.isArray(u)){let h=g.length?document.createElement("optgroup"):null;h&&(h.label=p(_("All models","gpt3-ai-content-generator"))),u.forEach(b=>{if(!(b&&b.id&&d.has(b.id))&&b&&b.id){let A=new Option(p(b.name||b.id),b.id);h?h.appendChild(A):t.appendChild(A)}}),h&&h.children.length>0&&t.appendChild(h)}if(t.options.length===0)t.appendChild(new Option(p(`No models for ${o.value}`),"")),t.disabled=!0;else{t.disabled=!1;let h;switch(r){case"openai":h="gpt-4o-mini";break;case"google":h="gemini-1.5-flash-latest";break;case"openrouter":h="moonshotai/kimi-k2.5";break;case"claude":h="claude-opus-4-6",Array.isArray(u)&&u.length>0&&(u.some(A=>A&&A.id==="claude-opus-4-6")||(h=u[0].id||null));break;case"azure":case"deepseek":case"ollama":Array.isArray(u)&&u.length>0?h=u[0].id||null:h=null;break;default:h=null;break}h&&t.querySelector(`option[value="${CSS.escape(h)}"]`)?t.value=h:t.selectedIndex=0}let w=o.closest(".aipkit-enhancer-bulk-modal-overlay");w&&k(w)}window.aipkit_enhancer_populateBulkModels=c,window.aipkit_enhancer_toggleReasoningEffort=k})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],n=s=>{let l=parseInt(s,10);if(Number.isFinite(l)){if(l>=1&&l<=k.length)return k[l-1];let c=k.find(o=>o.tokens===l);if(c)return c}return k[1]};async function e(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let s=window.aipkit_enhancer_bulkState.queue.shift();await i(s),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(e,200)}async function i(s){try{let l=`enhancer-bulk-${s}-${Date.now()}`;typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(s);let c=window.aipkit_post_enhancer?.nonce_generate_title;if(!c)throw new Error("Security nonce not found.");let o=window.aipkit_enhancer_bulkState.enhancementsConfig,t=["keyword","title","excerpt","content","meta","tags"],r=[];t.forEach(p=>{o[p]&&o[p].prompt&&r.push(p)});let f=[],u=[];for(let p of r){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"processing");let _={_ajax_nonce:c,post_id:s,field:p,enhancer_source:"post_enhancer",enhancements:JSON.stringify({[p]:o[p],ai_provider:o.ai_provider,ai_model:o.ai_model,temperature:o.temperature,max_tokens:o.max_tokens,reasoning_effort:o.reasoning_effort,enable_vector_store:o.enable_vector_store,vector_store_provider:o.vector_store_provider,vector_store_top_k:o.vector_store_top_k,openai_vector_store_ids:o.openai_vector_store_ids,pinecone_index_name:o.pinecone_index_name,qdrant_collection_name:o.qdrant_collection_name,vector_embedding_provider:o.vector_embedding_provider,vector_embedding_model:o.vector_embedding_model}),conversation_uuid:l},m=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",_,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"completed",m.message),f.push(p)}catch(_){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"error",_.message||"Processing failed"),u.push(p),console.error(`Failed to process field ${p} for post ${s}:`,_)}}if(o.generate_seo_slug==="1"&&f.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","processing");let p={_ajax_nonce:c,post_id:s,action_type:"update_slug",enhancer_source:"post_enhancer"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",p,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(s,f,u),f.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let _=(window.aipkit_enhancer_postTitles||{})[s]||`Post #${s}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(_=window.aipkit_enhancer_truncateTitle(_,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${_}". No fields were processed successfully.`,"error")}}catch(l){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(s,l.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let o=(window.aipkit_enhancer_postTitles||{})[s]||`Post #${s}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(o=window.aipkit_enhancer_truncateTitle(o,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${o}": ${l.message||"Unknown error"}`,"error")}}}function a(s){let l=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!l)return;let c={},o=l.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(o.length===0){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select at least one field to update.","error");return}o.forEach(h=>{let b=h.value,A=l.querySelector(`#aipkit_bulk_prompt_${b}`);A&&(c[b]={prompt:A.value})});let t=l.querySelector("#aipkit_bulk_ai_provider").value,r=l.querySelector("#aipkit_bulk_ai_model").value,f=l.querySelector("#aipkit_bulk_ai_temperature").value,u=l.querySelector("#aipkit_bulk_content_max_tokens"),p=n(u?u.value:""),_=l.querySelector("#aipkit_bulk_reasoning_effort").value;if(!t||!r){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select an AI Provider and Model.","error");return}c.ai_provider=t,c.ai_model=r,c.temperature=f,c.max_tokens=p.tokens,c.reasoning_effort=_;let m=l.querySelector("#aipkit_bulk_generate_seo_slug");m&&(c.generate_seo_slug=m.checked?"1":"0");let g=l.querySelector('input[name="enable_vector_store"]');if(g&&g.checked){if(c.enable_vector_store="1",c.vector_store_provider=l.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",c.vector_store_top_k=l.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,c.vector_store_provider==="openai"){let h=l.querySelector("#aipkit_bulk_openai_vector_store_ids");h&&(c.openai_vector_store_ids=Array.from(h.selectedOptions).map(b=>b.value))}else c.vector_store_provider==="pinecone"?c.pinecone_index_name=l.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":c.vector_store_provider==="qdrant"&&(c.qdrant_collection_name=l.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(c.vector_store_provider==="pinecone"||c.vector_store_provider==="qdrant")&&(c.vector_embedding_provider=l.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",c.vector_embedding_model=l.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else c.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...s],isRunning:!0,completed:0,failed:0,total:s.length,enhancementsConfig:c},l.querySelector("#aipkit-enhancer-bulk-config").hidden=!0,l.querySelector("#aipkit-enhancer-bulk-progress").hidden=!1;let d=l.querySelector("#aipkit_bulk_enhancer_start_btn");d&&(d.disabled=!0,d.hidden=!0),l.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!1;let w=l.querySelector("#aipkit_bulk_enhancer_cancel_btn");w&&(w.hidden=!0),l.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0,typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),e()}window.aipkit_enhancer_startBulkProcess=a})();(function(){"use strict";let k={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,isAutosaving:!1,autosaveSuspended:!1,autosaveTimer:null,autosaveDelay:800,lastSavedConfig:null,headerStatusTimeout:null,modalElement:null},n="aipkit_bulk_enhancer_selected_template",e=window.aipkit_escapeHtml||function(v){return v},i=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],a=()=>String(window.aipkit_post_enhancer?.default_ai_provider||"").trim().toLowerCase(),s=v=>{let y=parseInt(v,10);if(Number.isFinite(y)){if(y>=1&&y<=i.length)return i[y-1];let C=i.find(M=>M.tokens===y);if(C)return C}return i[1]},l=v=>{let y=v?.content_max_tokens??v?.max_tokens??v?.max_completion_tokens??"",C=parseInt(y,10);if(Number.isFinite(C)){let W=C>=1&&C<=i.length,U=i.some(J=>J.tokens===C);return W||U?s(C):C<=i[0].tokens?i[0]:C<=i[1].tokens?i[1]:i[2]}let M=String(v?.content_length||"").trim().toLowerCase(),B=i.find(W=>W.key===M);if(B)return B;let D=parseInt(window.aipkit_post_enhancer?.default_ai_params?.max_completion_tokens??window.aipkit_post_enhancer?.default_ai_params?.max_tokens??"",10);return Number.isFinite(D)?D<=i[0].tokens?i[0]:D<=i[1].tokens?i[1]:i[2]:i[1]};function c(v){try{v&&String(v)!==""?localStorage.setItem(n,String(v)):localStorage.removeItem(n)}catch(y){console.warn("Failed to save template to localStorage:",y)}}function o(){try{return localStorage.getItem(n)}catch(v){return console.warn("Failed to load template from localStorage:",v),null}}function t(){let v=k.modalElement;if(!v)return{};let y={};["title","excerpt","content","meta","keyword","tags"].forEach(W=>{let U=v.querySelector(`#aipkit_bulk_enhance_${W}`),J=v.querySelector(`#aipkit_bulk_prompt_${W}`);U&&J&&(y[W]={enabled:U.checked?"1":"0",prompt:J.value})}),y.ai_provider=v.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",y.ai_model=v.querySelector("#aipkit_bulk_ai_model")?.value||"",y.ai_temperature=v.querySelector("#aipkit_bulk_ai_temperature")?.value;let M=v.querySelector("#aipkit_bulk_content_max_tokens"),B=s(M?M.value:"");y.content_max_tokens=String(B.tokens),y.reasoning_effort=v.querySelector("#aipkit_bulk_reasoning_effort")?.value||"",y.generate_seo_slug=v.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let D=v.querySelector('input[name="enable_vector_store"]');if(D&&D.checked){if(y.enable_vector_store="1",y.vector_store_provider=v.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",y.vector_store_top_k=v.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",y.vector_store_provider==="openai"){let W=v.querySelector("#aipkit_bulk_openai_vector_store_ids");W&&(y.openai_vector_store_ids=Array.from(W.selectedOptions).map(U=>U.value))}else y.vector_store_provider==="pinecone"?y.pinecone_index_name=v.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":y.vector_store_provider==="qdrant"&&(y.qdrant_collection_name=v.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(y.vector_store_provider==="pinecone"||y.vector_store_provider==="qdrant")&&(y.vector_embedding_provider=v.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",y.vector_embedding_model=v.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else y.enable_vector_store="0";return y}function r(v){k.autosaveSuspended=!0,k.currentTemplateId=v,c(v),window.aipkit_bulk_template_state&&(window.aipkit_bulk_template_state.currentTemplateId=v),typeof window.aipkit_updateBulkTemplatePickerSelection=="function"&&window.aipkit_updateBulkTemplatePickerSelection(v,k.modalElement);let y=k.templates.find(N=>String(N.id)===String(v)),C=y?JSON.parse(JSON.stringify(y.config)):{};if(!C.content_max_tokens&&C.content_length){let N=i.find(R=>R.key===String(C.content_length).toLowerCase());C.content_max_tokens=String(N?.tokens||i[1].tokens)}Object.prototype.hasOwnProperty.call(C,"content_length")&&delete C.content_length,k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(C));let M=k.modalElement;if(!M)return;let B=M.querySelector("#aipkit_bulk_ai_provider"),D=M.querySelector("#aipkit_bulk_ai_model"),W=M.querySelector("#aipkit_bulk_ai_temperature"),U=M.querySelector("#aipkit_bulk_ai_temperature_value"),J=M.querySelector("#aipkit_bulk_content_max_tokens"),oe=M.querySelector("#aipkit_bulk_content_max_tokens_value"),O=M.querySelector("#aipkit_bulk_reasoning_effort");if(B){let N=a();B.value=C.ai_provider||N||"openai",B.dispatchEvent(new Event("change",{bubbles:!0}))}if(D&&C.ai_model&&setTimeout(()=>{D.querySelector(`option[value="${CSS.escape(C.ai_model)}"]`)&&(D.value=C.ai_model,D.dispatchEvent(new Event("change")))},150),W&&(W.value=C.ai_temperature||"1.0"),U&&(U.textContent=C.ai_temperature||"1.0"),J){let N=l(C),R=Math.max(0,i.findIndex(H=>H.key===N.key));J.value=String(R+1),oe&&(oe.textContent=`${N.words} words`)}O&&(O.value=C.reasoning_effort==="minimal"?"low":C.reasoning_effort||"",typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&window.aipkit_enhancer_toggleReasoningEffort(M)),["title","excerpt","content","meta","keyword","tags"].forEach(N=>{let R=M.querySelector(`#aipkit_bulk_enhance_${N}`),H=M.querySelector(`#aipkit_bulk_prompt_${N}`);if(R&&H){let K=C[N]?.enabled==="1";R.checked!==K&&(R.checked=K,R.dispatchEvent(new Event("change"))),H.value=C[N]?.prompt||H.defaultValue}});let L=M.querySelector("#aipkit_bulk_generate_seo_slug");if(L){let N=C.generate_seo_slug==="1";L.checked!==N&&(L.checked=N,L.dispatchEvent(new Event("change")))}let F=M.querySelector('input[name="enable_vector_store"]');if(F&&(F.checked=C.enable_vector_store==="1",F.dispatchEvent(new Event("change"))),C.enable_vector_store==="1"){let N=M.querySelector("#aipkit_bulk_vector_store_provider");N&&(N.value=C.vector_store_provider||"openai",N.dispatchEvent(new Event("change",{bubbles:!0})));let R=M.querySelector("#aipkit_bulk_vector_store_top_k");if(R){R.value=C.vector_store_top_k||"3";let H=M.querySelector("#aipkit_bulk_vector_store_top_k_value");H&&(H.textContent=R.value)}setTimeout(()=>{if(C.vector_store_provider==="openai"){let H=M.querySelector("#aipkit_bulk_openai_vector_store_ids");H&&Array.isArray(C.openai_vector_store_ids)&&Array.from(H.options).forEach(K=>{K.selected=C.openai_vector_store_ids.includes(K.value)})}else if(C.vector_store_provider==="pinecone"){let H=M.querySelector("#aipkit_bulk_pinecone_index_name");H&&(H.value=C.pinecone_index_name||"",H.dispatchEvent(new Event("change",{bubbles:!0})))}else if(C.vector_store_provider==="qdrant"){let H=M.querySelector("#aipkit_bulk_qdrant_collection_name");H&&(H.value=C.qdrant_collection_name||"",H.dispatchEvent(new Event("change",{bubbles:!0})))}if(C.vector_store_provider==="pinecone"||C.vector_store_provider==="qdrant"){let H=M.querySelector("#aipkit_bulk_vector_embedding_provider"),K=M.querySelector("#aipkit_bulk_vector_embedding_model");H&&(H.value=C.vector_embedding_provider||"openai",H.dispatchEvent(new Event("change"))),K&&C.vector_embedding_model&&setTimeout(()=>{K.value=C.vector_embedding_model,K.dispatchEvent(new Event("change",{bubbles:!0}))},150)}},100)}k.currentTemplateModified=!1,u(),window.clearTimeout(k.autosaveTimer),k.autosaveTimer=null,window.setTimeout(()=>{k.lastSavedConfig=t(),k.autosaveSuspended=!1},200)}function f(){let v=t();k.currentTemplateModified=!window.aipkit_deepEqual(v,k.initialConfigForSelectedTemplate),u(),S()}function u(){let v=k.modalElement;if(!v)return;let y=v.querySelector("#aipkit_enhancer_template_select").value,C=y&&String(y)!=="";v.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!C,v.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!C}function p(){let v=k.modalElement;if(!v)return;let y=v.querySelector("#aipkit_enhancer_template_action_list"),C=v.querySelector("#aipkit_enhancer_template_inline_form"),M=v.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),B=v.querySelector("#aipkit_enhancer_template_name_input");y&&(y.style.display=""),C&&(C.style.display="none",delete C.dataset.mode),M&&(M.style.display="none"),B&&(B.value="")}function _(v,y=""){let C=k.modalElement;if(!C)return;let M=C.querySelector("#aipkit_enhancer_template_inline_form"),B=C.querySelector("#aipkit_enhancer_template_name_input"),D=C.querySelector("#aipkit_enhancer_template_action_list"),W=C.querySelector("#aipkit_enhancer_template_inline_delete_confirm");!M||!B||(D&&(D.style.display="none"),W&&(W.style.display="none"),M.style.display="flex",M.dataset.mode=v,B.value=y,B.focus())}function m(){p()}function g(v){let y=k.modalElement;if(!y)return;let C=y.querySelector("#aipkit_enhancer_template_inline_form"),M=y.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),B=y.querySelector("#aipkit_enhancer_template_delete_confirm_text"),D=y.querySelector("#aipkit_enhancer_template_action_list");!M||!B||(C&&(C.style.display="none"),D&&(D.style.display="none"),M.style.display="flex",B.innerHTML=`Delete "<strong>${e(v)}</strong>"?`)}function d(){p()}function w(v,y="info"){h(v,y)}function h(v,y="info"){let C=k.modalElement?.querySelector("#aipkit_bulk_autosave_status");if(C){if(k.headerStatusTimeout&&(clearTimeout(k.headerStatusTimeout),k.headerStatusTimeout=null),!v){C.textContent="",C.className="aipkit_cw_save_status aipkit_enhancer_modal_status";return}C.textContent=e(v),C.className=`aipkit_cw_save_status aipkit_enhancer_modal_status aipkit_settings_message-${y}`,y==="success"&&(k.headerStatusTimeout=setTimeout(()=>{C.textContent="",C.className="aipkit_cw_save_status aipkit_enhancer_modal_status"},2500))}}function b(){let v=k.currentTemplateId;if(!v)return null;let y="",C=k.templates.find(B=>String(B.id)===String(v));if(C?.template_name&&(y=C.template_name),!y){let B=k.modalElement?.querySelector("#aipkit_enhancer_template_select");B?.selectedOptions?.length&&(y=B.selectedOptions[0].textContent.trim())}let M=parseInt(v,10);return!y||Number.isNaN(M)?null:{id:M,name:y}}async function A(){if(k.autosaveSuspended||k.isSavingOrDeleting||k.isAutosaving)return;let v=t();if(!v||k.lastSavedConfig&&window.aipkit_deepEqual(v,k.lastSavedConfig))return;let y=b();if(y){k.isAutosaving=!0,h("Saving...","info");try{let C=window.aipkit_post_enhancer?.nonce_manage_templates;if(!C)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:y.id,template_name:y.name,config:JSON.stringify(v),template_type:"enhancer",_ajax_nonce:C}),k.lastSavedConfig=JSON.parse(JSON.stringify(v)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(v)),k.currentTemplateModified=!1,u(),h("Saved","success")}catch(C){h(`Error: ${C.message||"Failed to save."}`,"error"),console.error("Bulk Enhancer Auto-Save Error:",C)}finally{k.isAutosaving=!1}}}function S(){k.autosaveSuspended||k.isSavingOrDeleting||k.currentTemplateId&&(k.autosaveTimer&&clearTimeout(k.autosaveTimer),k.autosaveTimer=setTimeout(()=>{k.autosaveTimer=null,A()},k.autosaveDelay))}async function I(){let v=k.modalElement.querySelector("#aipkit_enhancer_template_select");v.innerHTML='<option value="">Loading...</option>',v.disabled=!0;try{let y=window.aipkit_post_enhancer?.nonce_manage_templates;if(!y)throw new Error("Security nonce for templates not found.");let C=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:y});k.templates=C.templates||[],v.innerHTML='<option value="">-- Select Template --</option>',k.templates.forEach(B=>{v.appendChild(new Option(e(B.template_name),B.id))}),v.disabled=!1;let M=o();M&&(k.templates.some(D=>String(D.id)===String(M))?(v.value=M,r(M)):c(null)),window.aipkit_bulk_template_state={templates:k.templates,currentTemplateId:k.currentTemplateId},typeof window.aipkit_renderBulkTemplatePicker=="function"&&window.aipkit_renderBulkTemplatePicker(k.modalElement)}catch(y){w("Error loading templates: "+y.message,"error")}}async function T(v,y){if(!k.isSavingOrDeleting){k.isSavingOrDeleting=!0,w("Saving template...","info");try{let C=t(),M=window.aipkit_post_enhancer?.nonce_manage_templates;if(!M)throw new Error("Security nonce for templates not found.");let B=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:v,template_name:y,config:JSON.stringify(C),template_type:"enhancer",_ajax_nonce:M});w(B.message,"success"),await I(),k.modalElement.querySelector("#aipkit_enhancer_template_select").value=B.template_id,k.currentTemplateId=B.template_id,c(B.template_id),k.currentTemplateModified=!1,k.lastSavedConfig=JSON.parse(JSON.stringify(C)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(C)),h("Saved","success"),u()}catch(C){w("Error saving: "+C.message,"error")}finally{k.isSavingOrDeleting=!1}}}async function x(){let v=k.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!v||k.isSavingOrDeleting)){k.isSavingOrDeleting=!0,w("Deleting...","info");try{let y=window.aipkit_post_enhancer?.nonce_manage_templates;if(!y)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:v,_ajax_nonce:y}),w("Template deleted.","success"),await I(),k.currentTemplateId=null;let C=o();C&&String(C)===String(v)&&c(null),k.lastSavedConfig=null,h("Template deleted","success"),u()}catch(y){w("Error deleting: "+y.message,"error")}finally{k.isSavingOrDeleting=!1}}}function E(v){k.modalElement=v;let y=v.querySelector("#aipkit_enhancer_template_select");y.addEventListener("change",oe=>{h(""),p(),r(oe.target.value)}),v.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{_("new")}),v.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let oe=y.options[y.selectedIndex];k.currentTemplateId&&oe&&_("rename",oe.text)}),v.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",()=>{let oe=y.options[y.selectedIndex];oe&&g(oe.text)});let C=v.querySelector("#aipkit_enhancer_template_inline_form"),M=v.querySelector("#aipkit_enhancer_template_save_inline_btn"),B=v.querySelector("#aipkit_enhancer_template_cancel_inline_btn"),D=v.querySelector("#aipkit_enhancer_template_name_input");M&&B&&C&&D&&(B.addEventListener("click",m),M.addEventListener("click",async()=>{let oe=C.dataset.mode,O=D.value.trim();if(!O){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}if(oe==="new")await T(0,O);else if(oe==="rename"){let L=y.value;L&&await T(parseInt(L,10),O)}m()}));let W=v.querySelector("#aipkit_enhancer_template_confirm_delete_btn"),U=v.querySelector("#aipkit_enhancer_template_cancel_delete_btn");W&&U&&(U.addEventListener("click",d),W.addEventListener("click",async()=>{await x(),d()})),I(),typeof window.aipkit_initBulkTemplatePicker=="function"&&window.aipkit_initBulkTemplatePicker(v);let J=oe=>{oe.target?.id!=="aipkit_enhancer_template_select"&&f()};v.addEventListener("input",J),v.addEventListener("change",J)}window.aipkit_enhancer_initTemplateControls=E,window.aipkit_enhancer_setHeaderStatus=h})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(u){return u},n=u=>u||document.querySelector(".aipkit_enhancer_bulk_modal");function e(u){let p=n(u);return{root:p,select:p?.querySelector("#aipkit_enhancer_template_select")||null,button:p?.querySelector("#aipkit_enhancer_template_picker_btn")||null,label:p?.querySelector("#aipkit_enhancer_template_picker_label")||null,list:p?.querySelector("#aipkit_enhancer_template_picker_list")||null,search:p?.querySelector("#aipkit_enhancer_template_picker_search")||null,searchClear:p?.querySelector("#aipkit_enhancer_template_picker_search_clear")||null,popover:p?.querySelector("#aipkit_enhancer_template_picker_popover")||null}}function i(u,p){let _=[],m={};u.forEach(d=>{if(!(String(d.is_starter)==="1"||d.is_starter===!0))if(p&&d.user_id?.toString()===p)_.push(d);else{let h=d.display_name||`User ID: ${d.user_id}`;m[h]||(m[h]=[]),m[h].push(d)}}),_.sort((d,w)=>d.is_default==="1"?-1:w.is_default==="1"?1:d.template_name.localeCompare(w.template_name));let g={};return Object.keys(m).sort().forEach(d=>{g[d]=m[d].sort((w,h)=>w.template_name.localeCompare(h.template_name))}),{myTemplates:_,otherUsersTemplates:g}}function a(u){return u.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function s(u,p){let{label:_}=e(p);if(!_||!u)return;let m=u.options[u.selectedIndex],g=m?m.text:k("Select template");_.textContent=g||k("Select template")}function l(u,p){if(!u)return;let _=String(p||"");u.querySelectorAll(".aipkit_cw_template_list_item").forEach(m=>{let d=(m.dataset.templateId||"")===_;m.classList.toggle("is-active",d),m.setAttribute("aria-selected",d?"true":"false")})}function c(u,p=""){let{select:_,list:m}=e(u);if(!_||!m)return;let g=window.aipkit_bulk_template_state?.templates||[],d=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!g.length){let x=_.disabled&&_.options.length&&_.options[0].text.toLowerCase().includes("loading"),E=document.createElement("div");E.className="aipkit_cw_template_picker_empty",E.textContent=k(x?"Loading templates...":"No templates found."),m.appendChild(E),s(_,u);return}let w=i(g,d),h=document.createDocumentFragment(),b=p.toLowerCase().trim(),A=(x,E)=>{let v=document.createElement("div");if(v.className="aipkit_cw_template_group_label",E){let C=document.createElement("span");C.className=`dashicons ${E}`,C.setAttribute("aria-hidden","true"),v.appendChild(C)}let y=document.createElement("span");return y.textContent=k(x),v.appendChild(y),v},S=x=>{let E=document.createElement("button");E.type="button",E.className="aipkit_cw_template_list_item",x.is_default==="1"&&E.classList.add("is-default"),E.dataset.templateId=String(x.id),E.dataset.templateLabel=x.template_name.toLowerCase(),E.setAttribute("role","option"),E.setAttribute("aria-selected","false");let v=a(x),y=document.createElement("span");y.className=`aipkit_cw_template_list_icon dashicons ${v}`,y.setAttribute("aria-hidden","true");let C=document.createElement("span");C.className="aipkit_cw_template_list_content";let M=document.createElement("span");M.className="aipkit_cw_template_list_name",M.textContent=k(x.template_name),C.appendChild(M);let B=document.createElement("span");return B.className="aipkit_cw_template_list_check dashicons dashicons-yes",B.setAttribute("aria-hidden","true"),E.appendChild(y),E.appendChild(C),E.appendChild(B),E},I=(x,E,v)=>{let y=b?E.filter(M=>M.template_name.toLowerCase().includes(b)):E;if(!y.length)return 0;let C=document.createElement("div");return C.className="aipkit_cw_template_group",C.appendChild(A(x,v)),y.forEach(M=>{C.appendChild(S(M))}),h.appendChild(C),y.length},T=0;if(T+=I("My Templates",w.myTemplates,"dashicons-admin-users"),Object.keys(w.otherUsersTemplates).forEach(x=>{T+=I(x,w.otherUsersTemplates[x],"dashicons-groups")}),T===0){let x=document.createElement("div");x.className="aipkit_cw_template_picker_empty",x.textContent=k(b?"No templates match your search.":"No templates found."),m.appendChild(x)}else m.appendChild(h);s(_,u),l(m,_.value)}function o(u,p){c(u,p)}function t(u){let{search:p,searchClear:_,popover:m}=e(u);if(!p)return;let g=null;p.addEventListener("input",d=>{let w=d.target.value;_&&(_.style.display=w?"flex":"none"),clearTimeout(g),g=setTimeout(()=>{o(u,w)},150)}),_&&_.addEventListener("click",()=>{p.value="",_.style.display="none",o(u,""),p.focus()}),m&&new MutationObserver(w=>{w.forEach(h=>{h.attributeName==="aria-hidden"&&m.getAttribute("aria-hidden")==="true"&&p.value&&(p.value="",_&&(_.style.display="none"),o(u,""))})}).observe(m,{attributes:!0})}function r(u){let{select:p,list:_,button:m}=e(u);!p||!_||(t(u),_.dataset.listenerAttached||(_.addEventListener("click",g=>{let d=g.target.closest(".aipkit_cw_template_list_item");if(!d||!p)return;let w=d.dataset.templateId||"";p.value=w,p.dispatchEvent(new Event("change",{bubbles:!0})),l(_,w),m&&m.click()}),_.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",()=>{s(p,u),l(_,p.value)}),p.dataset.listenerAttached="true"),c(u))}function f(u,p){let{select:_,list:m}=e(p);_&&(u!==void 0&&(_.value=u),s(_,p),l(m,_.value))}window.aipkit_initBulkTemplatePicker=r,window.aipkit_renderBulkTemplatePicker=c,window.aipkit_updateBulkTemplatePickerSelection=f})();(function(){"use strict";function k(n){let{postCount:e,providerOptions:i,defaultPrompts:a,promptLibrary:s,postType:l}=n,c=h=>String(h??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=h=>c(h).replace(/"/g,"&quot;").replace(/'/g,"&#39;"),t=(h=[])=>h.map(b=>!b?.label||!b?.prompt?"":`<option value="${o(b.prompt)}">${c(b.label)}</option>`).join(""),r=s||{},f=`<option value="${o(a.title||"")}">Default</option>${t(r.title)}`,u=`<option value="${o(a.content||"")}">Default</option>${t(r.content)}`,p=`<option value="${o(a.meta||"")}">Default</option>${t(r.meta)}`,_=`<option value="${o(a.keyword||"")}">Default</option>${t(r.keyword)}`,m=`<option value="${o(a.excerpt||"")}">Default</option>${t(r.excerpt)}`,g=`<option value="${o(a.tags||"")}">Default</option>${t(r.tags)}`,d="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}, {original_tags}, {categories}.";l==="product"&&(d+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),d=d.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let w="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}, {original_tags}, {categories}.";return l==="product"&&(w+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),w=w.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div id="aipkit_enhancer_bulk_modal" class="aipkit-modal-content aipkit-enhancer-bulk-modal-content aipkit_enhancer_bulk_modal" data-post-type="${o(l)}">
          <div class="aipkit-modal-header aipkit_enhancer_modal_header">
            <div class="aipkit_enhancer_header_left">
              <span class="aipkit_enhancer_header_icon" aria-hidden="true">
                <span class="dashicons dashicons-edit-large"></span>
              </span>
              <div class="aipkit_enhancer_header_text">
                <h3 class="aipkit-modal-title">Content Assistant</h3>
                <span class="aipkit_enhancer_modal_subtitle">Bulk content update</span>
              </div>
            </div>
            <div class="aipkit_enhancer_header_center">
              <div
                id="aipkit_bulk_autosave_status"
                class="aipkit_cw_save_status aipkit_enhancer_modal_status"
                aria-live="polite"
              ></div>
            </div>
            <div class="aipkit_enhancer_header_right">
              <button type="button" class="aipkit-modal-close-btn aipkit_enhancer_close_btn" aria-label="Close">\xD7</button>
            </div>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <div class="aipkit_enhancer_section aipkit_enhancer_engine_card">
                <div class="aipkit_enhancer_engine_fields">
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Template</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <button
                          type="button"
                          id="aipkit_enhancer_template_picker_btn"
                          class="aipkit_popover_option_btn aipkit_settings_select_picker_btn"
                          data-aipkit-popover-target="aipkit_enhancer_template_picker_popover"
                          data-aipkit-popover-placement="bottom"
                          data-aipkit-bulk-popover="templates"
                          aria-controls="aipkit_enhancer_template_picker_popover"
                          aria-expanded="false"
                        >
                          <span class="aipkit_settings_select_picker_label" id="aipkit_enhancer_template_picker_label">Select template</span>
                          <span class="dashicons dashicons-arrow-down-alt2" aria-hidden="true"></span>
                        </button>
                        <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_enhancer_engine_select screen-reader-text">
                        <option value="">-- Select Template --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Provider</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_provider" class="aipkit_enhancer_engine_select">${i}</select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Model</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_model" class="aipkit_enhancer_engine_select">
                          <option value="">-- Select Provider --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field aipkit_enhancer_engine_field--action">
                    <button
                      type="button"
                      class="aipkit_enhancer_settings_btn"
                      data-aipkit-popover-target="aipkit_bulk_settings_popover"
                      data-aipkit-popover-placement="bottom"
                      data-aipkit-bulk-popover="settings"
                      aria-controls="aipkit_bulk_settings_popover"
                      aria-expanded="false"
                      title="Advanced settings"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="aipkit_enhancer_section aipkit_enhancer_prompt_section"
                id="aipkit_bulk_prompt_section"
              >
                <div class="aipkit_enhancer_section_header">
                  <h4>What to update</h4>
                </div>
                <div class="aipkit_prompts_redesigned">
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="title">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Title</span>
                        <span class="aipkit_prompt_toggle_desc">Post title</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_title_prompt_flyout"
                          aria-controls="aipkit_bulk_title_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="content">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Content</span>
                        <span class="aipkit_prompt_toggle_desc">Rewrite the main body</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_content_prompt_flyout"
                          aria-controls="aipkit_bulk_content_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="meta">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Meta Description</span>
                        <span class="aipkit_prompt_toggle_desc">SEO snippet for search</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_meta_prompt_flyout"
                          aria-controls="aipkit_bulk_meta_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="keyword">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Focus Keyword</span>
                        <span class="aipkit_prompt_toggle_desc">Primary SEO keyword</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_keyword_prompt_flyout"
                          aria-controls="aipkit_bulk_keyword_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="excerpt">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Excerpt</span>
                        <span class="aipkit_prompt_toggle_desc">Short summary text</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_excerpt_prompt_flyout"
                          aria-controls="aipkit_bulk_excerpt_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="tags">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Tags</span>
                        <span class="aipkit_prompt_toggle_desc">Suggested tags list</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_tags_prompt_flyout"
                          aria-controls="aipkit_bulk_tags_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="seo_slug">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Optimize URL</span>
                        <span class="aipkit_prompt_toggle_desc">Generate a new slug</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1" class="aipkit_toggle_switch">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_bulk_settings_popover" data-aipkit-bulk-popover="settings" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_model_settings_popover_panel--wide aipkit_model_settings_popover_panel--allow-overflow aipkit_cw_settings_popover_panel" role="dialog" aria-label="Settings">
                <div class="aipkit_model_settings_popover_header">
                  <span class="aipkit_model_settings_popover_title">Settings</span>
                  <button type="button" class="aipkit_model_settings_popover_close" aria-label="Close">
                    <span class="dashicons dashicons-no-alt"></span>
                  </button>
                </div>
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_enhancer_settings_popover">
                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <!-- Sliders Row (2 columns) -->
                        <div class="aipkit_enhancer_sliders_row">
                          <!-- Temperature Slider (Creativity) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_temperature_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_ai_temperature">Creativity</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_ai_temperature_value">1.0</span>
                            </div>
                            <div class="aipkit_enhancer_temperature_slider_wrapper">
                              <div class="aipkit_enhancer_temperature_labels">
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--low">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                  Focused
                                </span>
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--high">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                  Creative
                                </span>
                              </div>
                              <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_enhancer_temperature_slider" min="0" max="2" step="0.1" value="1.0">
                            </div>
                          </div>

                          <!-- Max Tokens Slider (Content Length) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_tokens_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_content_max_tokens">Content Length</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_content_max_tokens_value">1200-1600 words</span>
                            </div>
                            <div class="aipkit_enhancer_tokens_slider_wrapper">
                              <div class="aipkit_enhancer_tokens_labels">
                                <span class="aipkit_enhancer_tokens_label">Short</span>
                                <span class="aipkit_enhancer_tokens_label">Medium</span>
                                <span class="aipkit_enhancer_tokens_label">Long</span>
                              </div>
                              <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_enhancer_tokens_slider" min="1" max="3" step="1" value="2">
                            </div>
                          </div>
                        </div>

                        <div class="aipkit_popover_option_row aipkit_enhancer_reasoning_effort_field">
                          <div class="aipkit_popover_option_main">
                            <div class="aipkit_popover_option_text">
                              <label class="aipkit_popover_option_label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                              <span class="aipkit_popover_option_helper">Controls thinking effort for supported models.</span>
                            </div>
                            <div class="aipkit_popover_option_actions">
                              <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_popover_option_select">
                                <option value="none">None</option>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="xhigh">XHigh</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <div class="aipkit_enhancer_vector_settings">
                      <!-- Enable Toggle -->
                      <div class="aipkit_enhancer_vector_toggle_card">
                        <div class="aipkit_enhancer_vector_toggle_row">
                          <div class="aipkit_enhancer_vector_toggle_info">
                            <span class="aipkit_enhancer_vector_toggle_label">Knowledge Base</span>
                            <span class="aipkit_enhancer_vector_toggle_desc">Use your vector stores for RAG-enhanced content</span>
                          </div>
                          <div class="aipkit_enhancer_vector_toggle_controls">
                            <label class="aipkit_switch">
                              <input type="checkbox" name="enable_vector_store" value="1" class="aipkit_toggle_switch">
                              <span class="aipkit_switch_slider"></span>
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Source Selector (shown when enabled) -->
                      <div class="aipkit_cw_vector_store_settings_container aipkit_enhancer_vector_source_container" hidden>
                        <div class="aipkit_enhancer_vector_source_selector">
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_store_provider">Provider</label>
                            <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="pinecone">Pinecone</option>
                              <option value="qdrant">Qdrant</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <!-- OpenAI Stores (Multiselect) -->
                            <div class="aipkit_cw_vector_openai_field">
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_openai_vector_store_ids">Vector Store</label>
                              <div
                                class="aipkit_popover_multiselect aipkit_vector_multiselect aipkit_enhancer_vector_multiselect"
                                data-aipkit-vector-stores-dropdown
                                data-placeholder="Select stores"
                                data-selected-label="selected"
                              >
                                <button
                                  type="button"
                                  class="aipkit_popover_multiselect_btn aipkit_vector_multiselect_btn aipkit_enhancer_vector_multiselect_btn"
                                  aria-expanded="false"
                                  aria-controls="aipkit_bulk_openai_vector_store_panel"
                                >
                                  <span class="aipkit_popover_multiselect_label">Select stores</span>
                                </button>
                                <div
                                  id="aipkit_bulk_openai_vector_store_panel"
                                  class="aipkit_popover_multiselect_panel aipkit_enhancer_vector_multiselect_panel"
                                  role="menu"
                                  hidden
                                >
                                  <div class="aipkit_popover_multiselect_options"></div>
                                </div>
                              </div>
                              <select
                                id="aipkit_bulk_openai_vector_store_ids"
                                name="openai_vector_store_ids[]"
                                class="aipkit_popover_multiselect_select"
                                multiple
                                size="3"
                                hidden
                                aria-hidden="true"
                                tabindex="-1"
                              ></select>
                            </div>
                            
                            <!-- Pinecone Index -->
                            <div class="aipkit_cw_vector_pinecone_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_pinecone_index_name">Index</label>
                              <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                            
                            <!-- Qdrant Collection -->
                            <div class="aipkit_cw_vector_qdrant_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                              <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                          </div>
                        </div>

                        <!-- Embedding Config (for Pinecone/Qdrant) -->
                        <div class="aipkit_cw_vector_embedding_config_row aipkit_enhancer_vector_embedding_selector" hidden>
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_provider">Embedding</label>
                            <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="google">Google</option>
                              <option value="azure">Azure</option>
                              <option value="openrouter">OpenRouter</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_model">Model</label>
                            <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_enhancer_vector_settings_select"></select>
                          </div>
                        </div>

                        <!-- Results Limit Slider -->
                        <div class="aipkit_vector_slider_group">
                          <div class="aipkit_vector_slider_header">
                            <label class="aipkit_vector_settings_label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                            <span class="aipkit_vector_slider_value" id="aipkit_bulk_vector_store_top_k_value">3</span>
                          </div>
                          <div class="aipkit_vector_slider_wrapper">
                            <div class="aipkit_vector_slider_labels">
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--min">
                                <span class="dashicons dashicons-minus" aria-hidden="true"></span>
                                Fewer
                              </span>
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--max">
                                More
                                <span class="dashicons dashicons-plus" aria-hidden="true"></span>
                              </span>
                            </div>
                            <input type="range" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_vector_slider" value="3" min="1" max="20" step="1">
                          </div>
                          <p class="aipkit_vector_slider_hint">Number of matching chunks to retrieve</p>
                        </div>
                      </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_enhancer_template_picker_popover" data-aipkit-bulk-popover="templates" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_cw_settings_popover_panel aipkit_cw_template_picker_popover_panel" role="dialog" aria-label="Templates">
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_cw_template_picker_search_wrap">
                    <span class="dashicons dashicons-search aipkit_cw_template_picker_search_icon" aria-hidden="true"></span>
                    <input
                      type="text"
                      id="aipkit_enhancer_template_picker_search"
                      class="aipkit_cw_template_picker_search"
                      placeholder="Search templates..."
                      autocomplete="off"
                    >
                    <button
                      type="button"
                      id="aipkit_enhancer_template_picker_search_clear"
                      class="aipkit_cw_template_picker_search_clear"
                      aria-label="Clear search"
                      style="display: none;"
                    >
                      <span class="dashicons dashicons-no-alt" aria-hidden="true"></span>
                    </button>
                  </div>
                  <div class="aipkit_cw_template_picker_list" id="aipkit_enhancer_template_picker_list" role="listbox" aria-label="Template list">
                    <div class="aipkit_cw_template_picker_empty">
                      Loading templates...
                    </div>
                  </div>
                  <div class="aipkit_cw_template_picker_actions">
                    <div class="aipkit_cw_template_action_list" id="aipkit_enhancer_template_action_list">
                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">
                        <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
                        New
                      </button>
                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        Rename
                      </button>
                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                        Delete
                      </button>
                    </div>
                    <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                      <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                    <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                      <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_title_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Title Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Title Prompt</span>
                    <select id="aipkit_bulk_title_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_title" title="Load template">
                      ${f}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_title" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.title||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="title" data-label="Placeholders:" data-copy-title="Click to copy">${d}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_content_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Content Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Content Prompt</span>
                    <select id="aipkit_bulk_content_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_content" title="Load template">
                      ${u}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_content" class="aipkit_cw_prompt_editor_textarea" rows="10">${c(a.content||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="content" data-label="Placeholders:" data-copy-title="Click to copy">${d}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_meta_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Meta Description Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Meta Description Prompt</span>
                    <select id="aipkit_bulk_meta_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_meta" title="Load template">
                      ${p}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_meta" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.meta||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="meta" data-label="Placeholders:" data-copy-title="Click to copy">${w}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_keyword_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Focus Keyword Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Focus Keyword Prompt</span>
                    <select id="aipkit_bulk_keyword_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_keyword" title="Load template">
                      ${_}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.keyword||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="keyword" data-label="Placeholders:" data-copy-title="Click to copy">${d}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_excerpt_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Excerpt Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Excerpt Prompt</span>
                    <select id="aipkit_bulk_excerpt_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_excerpt" title="Load template">
                      ${m}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.excerpt||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="excerpt" data-label="Placeholders:" data-copy-title="Click to copy">${d}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_tags_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Tags Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Tags Prompt</span>
                    <select id="aipkit_bulk_tags_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_tags" title="Load template">
                      ${g}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_tags" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.tags||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="tags" data-label="Placeholders:" data-copy-title="Click to copy">${d}</span>
                  </div>
                </div>
              </div>
            </div>

            <div id="aipkit-enhancer-bulk-progress" hidden>
              <div class="aipkit_enhancer_progress_header">
                <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
              </div>
              <div class="aipkit_progress_bar_container">
                <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled"></div>
              </div>
              <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <div class="aipkit_enhancer_footer_info">
              <div class="aipkit_enhancer_selection_badge">
                <span class="aipkit_enhancer_selection_count">${e}</span>
                <span class="aipkit_enhancer_selection_label">item${e===1?"":"s"} selected</span>
              </div>
            </div>
            <div class="aipkit_enhancer_footer_actions">
              <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-ghost" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span>Back</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                <span>Stop</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-success">
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                <span class="aipkit_btn-text">Start Processing</span>
                <span class="aipkit_spinner" hidden></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=k})();(function(){"use strict";function k(n,e){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let i={};n.forEach(_=>{let m=document.querySelector(`tr#post-${_}`);if(m){let g=m.querySelector(".row-title")||m.querySelector("strong a")||m.querySelector(".title a")||m.querySelector("a.row-title")||m.querySelector(".column-title strong a")||m.querySelector(".column-title .row-title");g&&(i[_]=g.textContent.trim())}i[_]||(i[_]=`Post #${_}`)}),window.aipkit_enhancer_postTitles=i;let a=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},s=window.aipkit_post_enhancer?.prompt_library||{},l=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],c=window.aipkit_post_enhancer?.default_ai_provider||"",o=String(c||"").trim().toLowerCase(),t={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",claude:"Claude",deepseek:"DeepSeek",ollama:"Ollama"},r=l.map(_=>{let m=_.toLowerCase();return`<option value="${m}" ${o&&m===o?"selected":""}>${t[m]||_.toUpperCase()}</option>`}).join(""),f=window.aipkit_enhancer_getBulkModalHtml({postCount:n.length,providerOptions:r,defaultPrompts:a,promptLibrary:s,postType:e});document.body.insertAdjacentHTML("beforeend",f);let u=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(u,n):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available.");let p=u.querySelector("#aipkit_bulk_ai_provider");p&&o&&Array.from(p.options).some(m=>m.value===o)&&(p.value=o,p.dispatchEvent(new Event("change",{bubbles:!0}))),requestAnimationFrame(()=>{u.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(x){return x},n=".aipkit_enhancer_bulk_modal",e=["#aipkit_bulk_ai_provider","#aipkit_bulk_ai_model","#aipkit_bulk_vector_store_provider","#aipkit_bulk_vector_embedding_provider","#aipkit_bulk_pinecone_index_name","#aipkit_bulk_qdrant_collection_name","#aipkit_bulk_vector_embedding_model"].join(", "),i=null,a=null,s=!1,l=new Set(["aipkit_bulk_ai_provider","aipkit_bulk_vector_store_provider","aipkit_bulk_vector_embedding_provider"]),c=x=>!!(x&&x.id&&l.has(x.id)),o=x=>String(x||"").trim().toLowerCase(),t=(x,E)=>{if(!x)return;let v="aipkit_settings_select_picker_icon--";x.classList.forEach(C=>{C.startsWith(v)&&x.classList.remove(C)}),x.classList.remove("is-hidden");let y=o(E);if(!y){x.classList.add("is-hidden");return}x.classList.add(`${v}${y}`)},r=x=>{if(!x)return"";let E=x.getAttribute("data-aipkit-picker-title");if(E)return E;let v=x.id&&document.querySelector(`label[for="${x.id}"]`)||x.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return v?v.textContent.trim():""},f=x=>{if(!x)return"";let E=x.selectedOptions&&x.selectedOptions.length?x.selectedOptions[0]:x.querySelector("option[selected]");if(E)return E.textContent.trim();let v=x.querySelector("option");return v?v.textContent.trim():""},u=x=>({buttonId:`${x}_picker_btn`,labelId:`${x}_picker_label`,popoverId:`${x}_picker_popover`,titleId:`${x}_picker_title`,searchId:`${x}_picker_search`,listId:`${x}_picker_list`}),p=(x,E)=>{if(!x||!x.id||!E)return null;let v=u(x.id),y=E.querySelector(`#${v.buttonId}`);if(!y){if(y=document.createElement("button"),y.type="button",y.id=v.buttonId,y.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",y.setAttribute("data-aipkit-popover-target",v.popoverId),y.setAttribute("aria-controls",v.popoverId),y.setAttribute("aria-expanded","false"),y.dataset.aipkitPopoverPlacement="bottom",c(x)){y.classList.add("aipkit_settings_select_picker_btn--provider");let D=document.createElement("span");D.className="aipkit_settings_select_picker_icon",D.setAttribute("aria-hidden","true"),t(D,x.value),y.appendChild(D)}let M=document.createElement("span");M.className="aipkit_settings_select_picker_label",M.id=v.labelId,M.textContent=f(x)||k("Select","gpt3-ai-content-generator");let B=document.createElement("span");B.className="dashicons dashicons-arrow-down-alt2",B.setAttribute("aria-hidden","true"),y.appendChild(M),y.appendChild(B),x.insertAdjacentElement("beforebegin",y)}x.classList.contains("screen-reader-text")||x.classList.add("screen-reader-text");let C=E.querySelector(`#${v.popoverId}`);if(!C){C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",c(x)&&C.classList.add("aipkit_settings_select_picker_popover--provider"),C.id=v.popoverId,C.setAttribute("aria-hidden","true");let M=document.createElement("div");M.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",M.setAttribute("role","dialog"),M.setAttribute("aria-labelledby",v.titleId);let B=document.createElement("div");B.className="aipkit_model_settings_popover_header";let D=document.createElement("span");D.className="aipkit_model_settings_popover_title",D.id=v.titleId,D.textContent=r(x)||k("Select","gpt3-ai-content-generator");let W=document.createElement("button");W.type="button",W.className="aipkit_model_settings_popover_close",W.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),W.innerHTML='<span class="dashicons dashicons-no-alt"></span>',B.appendChild(D),B.appendChild(W);let U=document.createElement("div");U.className="aipkit_model_settings_popover_body";let J=document.createElement("div");J.className="aipkit_settings_select_picker_search";let oe=document.createElement("input");oe.type="search",oe.id=v.searchId,oe.className="aipkit_form-input";let O=r(x),L=O?`Search ${O.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");oe.setAttribute("placeholder",L),J.appendChild(oe);let F=document.createElement("div");F.className="aipkit_settings_select_picker_list",F.id=v.listId,F.setAttribute("role","listbox"),U.appendChild(J),U.appendChild(F),M.appendChild(B),M.appendChild(U),C.appendChild(M),E.appendChild(C),c(x)&&(J.style.display="none")}return{ids:v,button:y,popover:C,label:E.querySelector(`#${v.labelId}`),search:E.querySelector(`#${v.searchId}`),list:E.querySelector(`#${v.listId}`)}},_=x=>{let E=[];return x&&Array.from(x.children).forEach(y=>{if(y.tagName==="OPTGROUP"){let C=Array.from(y.children).filter(M=>M.tagName==="OPTION").map(M=>({value:M.value,label:M.textContent.trim(),disabled:M.disabled,selected:M.selected}));E.push({groupLabel:y.label||"",options:C})}else y.tagName==="OPTION"&&E.push({groupLabel:"",options:[{value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}]})}),E},m=(x,E,v="")=>{if(!x||!E)return;let y=v.trim().toLowerCase();E.innerHTML="";let C=_(x),M=!1;if(C.forEach(B=>{let D=B.options.filter(W=>y?W.label.toLowerCase().includes(y):!0);if(D.length){if(B.groupLabel){let W=document.createElement("div");W.className="aipkit_settings_select_picker_group_label",W.textContent=B.groupLabel,E.appendChild(W)}D.forEach(W=>{let U=document.createElement("button");if(U.type="button",U.className="aipkit_settings_select_picker_item",U.setAttribute("role","option"),U.dataset.value=W.value,U.dataset.label=W.label,W.disabled&&(U.classList.add("is-disabled"),U.setAttribute("aria-disabled","true")),x.value===W.value?(U.classList.add("is-active"),U.setAttribute("aria-selected","true")):U.setAttribute("aria-selected","false"),c(x)){U.classList.add("aipkit_settings_select_picker_item--provider");let O=document.createElement("span");O.className="aipkit_settings_select_picker_icon",O.setAttribute("aria-hidden","true"),t(O,W.value),U.appendChild(O)}let J=document.createElement("span");J.className="aipkit_settings_select_picker_text",J.textContent=W.label;let oe=document.createElement("span");oe.className="dashicons dashicons-yes aipkit_settings_select_picker_check",U.appendChild(J),U.appendChild(oe),E.appendChild(U),M=!0})}}),!M){let B=document.createElement("div");B.className="aipkit_settings_select_picker_empty",B.textContent=k(y?"No matches found.":"No options available.","gpt3-ai-content-generator"),E.appendChild(B)}},g=(x,E)=>{if(!x||!E)return;let v=f(x);if(E.textContent=v||k("Select","gpt3-ai-content-generator"),c(x)){let y=E.closest("button"),C=y?y.querySelector(".aipkit_settings_select_picker_icon"):null;t(C,x.value)}},d=(x,E)=>{if(!x||!E)return;let v=x.getBoundingClientRect(),y=E.getBoundingClientRect(),C=y.width||320,M=y.height||0,B=window.innerWidth,D=window.innerHeight,W=12,U=v.left;U+C>B-W&&(U=v.right-C),U=Math.max(W,Math.min(U,B-C-W));let J=v.bottom+8;J+M>D-W&&(J=v.top-M-8),J=Math.max(W,Math.min(J,D-M-W)),E.style.left=`${Math.round(U)}px`,E.style.top=`${Math.round(J)}px`},w=()=>{!i||!a||s||(s=!0,window.requestAnimationFrame(()=>{let x=i.querySelector(".aipkit_model_settings_popover_panel");d(a,x),s=!1}))},h=()=>{i&&(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),i=null,a=null)},b=(x,E,v)=>{if(!x||!E)return;i&&i!==E&&h(),i=E,a=x,E.classList.add("aipkit-active"),E.setAttribute("aria-hidden","false"),x.setAttribute("aria-expanded","true");let y=E.querySelector(".aipkit_settings_select_picker_search input"),C=E.querySelector(".aipkit_settings_select_picker_list");C&&m(v,C,y?y.value:""),y&&y.offsetParent!==null&&(y.focus(),y.select());let M=E.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{d(x,M)})},A=(x,E)=>{if(!x||!E)return;let{button:v,popover:y,list:C,search:M}=E;if(v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("click",B=>{if(B.preventDefault(),i===y){h();return}b(v,y,x)}),v.dataset.pickerListenerAttached="true"),y&&y.dataset.overlayListenerAttached!=="true"){y.addEventListener("click",D=>{D.target===y&&h()});let B=y.querySelector(".aipkit_model_settings_popover_close");B&&B.addEventListener("click",D=>{D.preventDefault(),h()}),y.dataset.overlayListenerAttached="true"}if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",B=>{let D=B.target.closest(".aipkit_settings_select_picker_item");if(!D||D.classList.contains("is-disabled"))return;let W=D.dataset.value??"";x.value=W,x.dispatchEvent(new Event("change",{bubbles:!0})),g(x,E.label),m(x,C,M?M.value:""),h()}),C.dataset.pickerListenerAttached="true"),M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("input",()=>{m(x,C,M.value)}),M.dataset.pickerListenerAttached="true"),x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("change",()=>{g(x,E.label),m(x,C,M?M.value:""),i===y&&h()}),x.dataset.pickerListenerAttached="true"),x&&x.dataset.pickerObserverAttached!=="true"){let B=!1;new MutationObserver(()=>{B||(B=!0,window.requestAnimationFrame(()=>{g(x,E.label),m(x,C,M?M.value:""),B=!1}))}).observe(x,{childList:!0,subtree:!0}),x.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitBulkPickerEscapeBound||(document.addEventListener("keydown",B=>{B.key==="Escape"&&i&&h()}),document.body.dataset.aipkitBulkPickerEscapeBound="true"),document.body.dataset.aipkitBulkPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitBulkPickerRepositionBound="true")};function S(x){if(!x||x.dataset.aipkitBulkPickerInit==="true")return;let E=x.querySelectorAll(e);E.length&&(E.forEach(v=>{if(!v.id||v.dataset.aipkitPickerInit==="true")return;let y=p(v,x);y&&(g(v,y.label),m(v,y.list,y.search?y.search.value:""),A(v,y),v.dataset.aipkitPickerInit="true")}),x.dataset.aipkitBulkPickerInit="true")}function I(){document.querySelectorAll(n).forEach(S)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I(),new MutationObserver(I).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initBulkEnhancerSelectPickers=S})();(function(){"use strict";let k=window.aipkit_escapeHtml||(r=>String(r??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),n=["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],e=["{original_title}","{original_content}","{original_focus_keyword}","{original_meta_description}","{original_tags}","{categories}"],i=["{price}","{regular_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{purchase_note}","{product_categories}"],a=r=>r?.querySelector(".aipkit_enhancer_bulk_modal")?.dataset?.postType||"",s=(r,f)=>{let p=[...r==="meta"?e:n];return f==="product"&&p.push(...i),p.filter((_,m)=>p.indexOf(_)===m)},l=(r,f)=>{if(!r)return;let u=r.dataset.label||"Placeholders:",p=r.dataset.copyTitle||"Click to copy";r.innerHTML=`${k(u)} `,f.forEach((_,m)=>{let g=document.createElement("code");g.className="aipkit-placeholder",g.title=p,g.textContent=_,r.appendChild(g),m<f.length-1&&r.appendChild(document.createTextNode(" "))})},c=(r,f)=>{if(!r)return;let u=r.querySelector(".aipkit_bulk_prompt_placeholders");if(!u)return;let p=u.dataset.promptType||"",_=s(p,f);l(u,_)};function o(r){if(!r)return;let f=r.querySelectorAll("[data-aipkit-bulk-popover]");if(!f.length)return;let u=null,p=null,_=!1,m=b=>b?r.querySelector(`#${b}`):null,g=(b,A)=>{if(!b||!A)return;let S=b.getBoundingClientRect(),I=A.getBoundingClientRect(),T=I.width||400,x=I.height||0,E=window.innerWidth,v=window.innerHeight,y=12,C=S.left;C+T>E-y&&(C=S.right-T),C=Math.max(y,Math.min(C,E-T-y));let M=S.bottom+8;M+x>v-y&&(M=S.top-x-8),M=Math.max(y,Math.min(M,v-x-y)),A.style.left=`${Math.round(C)}px`,A.style.top=`${Math.round(M)}px`},d=()=>{!p||!u||_||(_=!0,window.requestAnimationFrame(()=>{let b=u.querySelector(".aipkit_model_settings_popover_panel");g(p,b),_=!1}))},w=()=>{u&&(u.classList.remove("aipkit-active"),u.setAttribute("aria-hidden","true"),p&&p.setAttribute("aria-expanded","false"),u?.dataset?.aipkitBulkPopover==="prompts"&&typeof window.aipkit_enhancer_closeBulkPromptFlyout=="function"&&window.aipkit_enhancer_closeBulkPromptFlyout(),u=null,p=null)},h=b=>{if(!b)return;let A=b.getAttribute("data-aipkit-popover-target"),S=m(A);if(!S)return;u&&u!==S&&w(),u=S,p=b,S.classList.add("aipkit-active"),S.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let I=S.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{g(b,I)})};f.forEach(b=>{b.dataset.popoverListenerAttached!=="true"&&(b.addEventListener("click",A=>{if(A.preventDefault(),u&&p===b){w();return}h(b)}),b.dataset.popoverListenerAttached="true")}),r.querySelectorAll(".aipkit_model_settings_popover[data-aipkit-bulk-popover]").forEach(b=>{b.dataset.overlayListenerAttached!=="true"&&(b.addEventListener("click",S=>{S.target===b&&w()}),b.dataset.overlayListenerAttached="true");let A=b.querySelector(".aipkit_model_settings_popover_close");A&&A.dataset.popoverListenerAttached!=="true"&&(A.addEventListener("click",S=>{S.preventDefault(),w()}),A.dataset.popoverListenerAttached="true")}),r.dataset.bulkPromptPopoverEscapeAttached!=="true"&&(document.addEventListener("keydown",b=>{b.key==="Escape"&&u&&w()}),r.dataset.bulkPromptPopoverEscapeAttached="true"),r.dataset.bulkPromptPopoverRepositionAttached!=="true"&&(window.addEventListener("resize",d),window.addEventListener("scroll",d,!0),r.dataset.bulkPromptPopoverRepositionAttached="true")}function t(r){if(!r)return;let f=r.querySelectorAll(".aipkit_prompt_edit_btn");if(!f.length)return;let u=a(r),p=new WeakMap,_=window.aipkit_prompt_library_api||null,m=r.querySelectorAll(".aipkit_cw_prompt_library_select"),g="You have unsaved prompt edits in this panel. Close anyway?",d=null,w=null,h=!1,b=H=>H?r.querySelector(`#${H}`):null,A=H=>{let K=H?.getAttribute("data-aipkit-prompt-target");return K?r.querySelector(`#${K}`):null},S=H=>{let re=H?.closest(".aipkit_cw_prompt_editor")?.querySelector(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");return String(re?.dataset?.promptType||"")},I=H=>{let K=H?.selectedOptions?.[0];return K?{promptId:K.dataset.promptId||"",promptType:K.dataset.promptType||"",label:K.dataset.promptLabel||K.textContent||"",source:K.dataset.promptSource||"",isCustom:(K.dataset.promptSource||"")==="custom",prompt:String(K.value||"")}:{promptId:"",promptType:"",label:"",source:"",isCustom:!1,prompt:""}},T=(H,K)=>{if(H)switch(H.classList.remove("aipkit_btn-primary","aipkit_btn-secondary","aipkit_btn-ghost","aipkit_btn-danger"),K){case"primary":H.classList.add("aipkit_btn-primary");break;case"danger":H.classList.add("aipkit_btn-danger");break;case"secondary":H.classList.add("aipkit_btn-secondary");break;default:H.classList.add("aipkit_btn-ghost");break}},x=H=>{let K=H?.closest(".aipkit_cw_prompt_editor_toolbar");return K?{manageButton:K.querySelector(".aipkit_cw_prompt_library_manage_btn"),applyButton:K.querySelector(".aipkit_cw_prompt_library_apply_btn"),undoButton:K.querySelector(".aipkit_cw_prompt_library_undo_btn"),saveButton:K.querySelector(".aipkit_cw_prompt_library_save_btn"),updateButton:K.querySelector(".aipkit_cw_prompt_library_update_btn"),deleteButton:K.querySelector(".aipkit_cw_prompt_library_delete_btn")}:{manageButton:null,applyButton:null,undoButton:null,saveButton:null,updateButton:null,deleteButton:null}},E=(H,K)=>{if(!H||!K)return;let{manageButton:re,applyButton:ve,undoButton:Ie,saveButton:Ee,updateButton:Z,deleteButton:pe}=x(H),we=I(H),de=!!we.isCustom&&!!we.promptId;if(re&&(T(re,"secondary"),re.disabled=!_||typeof window.aipkit_openPromptLibraryManager!="function"),ve){T(ve,"primary");let ae=String(H.value||"");ve.disabled=ae.trim()===""||ae===K.value}Ie&&(T(Ie,"secondary"),Ie.disabled=!p.has(K)),Ee&&(T(Ee,de?"secondary":"primary"),Ee.disabled=String(K.value||"").trim()===""),Z&&(T(Z,de?"primary":"secondary"),Z.disabled=!de),pe&&(T(pe,"danger"),pe.disabled=!de)},v=H=>{let K=H.closest(".aipkit_cw_prompt_editor_toolbar");if(!K||K.querySelector(".aipkit_cw_prompt_library_actions"))return;let re=document.createElement("span");re.className="aipkit_cw_prompt_library_actions";let ve=document.createElement("button");ve.type="button",ve.className="aipkit_cw_prompt_library_manage_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",ve.textContent="Library";let Ie=document.createElement("button");Ie.type="button",Ie.className="aipkit_cw_prompt_library_apply_btn aipkit_btn aipkit_btn-secondary aipkit_btn-small",Ie.textContent="Apply";let Ee=document.createElement("button");Ee.type="button",Ee.className="aipkit_cw_prompt_library_undo_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",Ee.textContent="Undo",Ee.disabled=!0;let Z=document.createElement("button");Z.type="button",Z.className="aipkit_cw_prompt_library_save_btn aipkit_btn aipkit_btn-secondary aipkit_btn-small",Z.textContent="Save As";let pe=document.createElement("button");pe.type="button",pe.className="aipkit_cw_prompt_library_update_btn aipkit_btn aipkit_btn-ghost aipkit_btn-small",pe.textContent="Update",pe.disabled=!0;let we=document.createElement("button");we.type="button",we.className="aipkit_cw_prompt_library_delete_btn aipkit_btn aipkit_btn-danger aipkit_btn-small",we.textContent="Delete",we.disabled=!0,re.appendChild(ve),re.appendChild(Ie),re.appendChild(Ee),re.appendChild(Z),re.appendChild(pe),re.appendChild(we),K.appendChild(re)},y=H=>H?.querySelector(".aipkit_cw_prompt_editor_textarea")||null,C=H=>{let K=y(H);K&&(H.dataset.aipkitPromptOpenValue=K.value,H.dataset.aipkitPromptDirty="false")},M=H=>{let K=y(H);if(!K)return!1;let re=typeof H.dataset.aipkitPromptOpenValue=="string"?H.dataset.aipkitPromptOpenValue:"";return K.value!==re},B=H=>!H||!M(H)?!0:window.confirm(g),D=()=>{m.forEach(H=>{let K=A(H);E(H,K)})},W=(H,K)=>{if(!H||!K)return!1;let re=Array.from(H.options).find(ve=>(ve.dataset.promptId||"")===K);return re?(H.value=re.value,!0):!1},U=(H,K)=>{!Array.isArray(K)||!K.length||K.forEach(re=>{let ve=String(re?.label||"").trim(),Ie=String(re?.prompt||"");if(!ve||!Ie)return;let Ee=re?.source||(re?.is_builtin?"builtin":"custom"),Z=document.createElement("option");Z.value=Ie,Z.textContent=Ee==="custom"?`${ve} (Custom)`:ve,Z.dataset.promptId=String(re?.id||""),Z.dataset.promptType=String(re?.type||""),Z.dataset.promptSource=String(Ee||""),Z.dataset.promptLabel=ve,H.appendChild(Z)})},J=(H,K={})=>{if(!H)return;let re=H.options?.[0]?.cloneNode(!0);if(!re)return;let ve=H.selectedOptions?.[0]?.dataset.promptId||"",Ie=String(H.value||""),Ee=S(H);if(!Ee)return;if(H.innerHTML="",H.appendChild(re),U(H,K[Ee]||[]),!W(H,ve)&&Ie){let pe=Array.from(H.options).find(we=>String(we.value||"")===Ie);pe?H.value=pe.value:H.selectedIndex=0}let Z=A(H);E(H,Z)},oe=async(H=!1)=>{if(!(!_||!m.length))try{let re=(await _.list({force:H}))?.library||{};m.forEach(ve=>{J(ve,re)})}catch(K){console.error("Enhancer prompt library refresh failed:",K)}},O=H=>{let K=H&&typeof H.message=="string"&&H.message.trim()?H.message.trim():"Prompt library request failed.";window.alert(K)},L=(H,K,re)=>{if(!H||!K)return;let ve=H.getBoundingClientRect(),Ie=K.getBoundingClientRect(),Ee=re?re.getBoundingClientRect():ve,Z=Ie.width||580,pe=Ie.height||0,we=window.innerWidth,de=window.innerHeight,ae=12,ne=Ee.left-Z-12;ne<ae&&(ne=Ee.right+12),ne=Math.max(ae,Math.min(ne,we-Z-ae));let ye=Ee.top;ye+pe>de-ae&&(ye=de-pe-ae),ye=Math.max(ae,ye),d.style.left=`${Math.round(ne)}px`,d.style.top=`${Math.round(ye)}px`},F=()=>{!w||!d||h||(h=!0,window.requestAnimationFrame(()=>{let H=d.querySelector(".aipkit_cw_prompt_panel"),K=w.closest(".aipkit_model_settings_popover_panel");L(w,H,K),h=!1}))},N=()=>{d&&B(d)&&(d.classList.remove("is-open"),d.setAttribute("aria-hidden","true"),w&&w.setAttribute("aria-expanded","false"),d=null,w=null)},R=H=>{let K=H.getAttribute("data-aipkit-flyout-target"),re=b(K);if(!re||d&&d!==re&&(N(),d))return;d=re,w=H,re.classList.add("is-open"),re.setAttribute("aria-hidden","false"),H.setAttribute("aria-expanded","true"),C(re),c(re,u);let ve=re.querySelector(".aipkit_cw_prompt_panel"),Ie=H.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{L(H,ve,Ie)})};f.forEach(H=>{H.dataset.flyoutListenerAttached!=="true"&&(H.addEventListener("click",K=>{if(K.preventDefault(),d&&w===H){N();return}R(H)}),H.dataset.flyoutListenerAttached="true")}),m.forEach(H=>{let K=H.getAttribute("data-aipkit-prompt-target"),re=K?r.querySelector(`#${K}`):null;if(re&&re.value.trim()===""&&H.value&&(re.value=H.value),H.dataset.promptLibraryAttached==="true")return;v(H),E(H,re),re&&re.dataset.promptEditorStateAttached!=="true"&&(re.addEventListener("input",()=>{d&&(d.dataset.aipkitPromptDirty=M(d)?"true":"false"),D()}),re.dataset.promptEditorStateAttached="true");let{manageButton:ve,applyButton:Ie,undoButton:Ee,saveButton:Z,updateButton:pe,deleteButton:we}=x(H);Ie&&Ie.dataset.promptLibraryAttached!=="true"&&(Ie.addEventListener("click",()=>{let de=String(H.value||"");if(!de||!re||de===re.value){E(H,re);return}p.set(re,re.value),re.value=de,re.dispatchEvent(new Event("input",{bubbles:!0})),E(H,re)}),Ie.dataset.promptLibraryAttached="true"),Ee&&Ee.dataset.promptLibraryAttached!=="true"&&(Ee.addEventListener("click",()=>{if(!re||!p.has(re)){E(H,re);return}let de=p.get(re);p.delete(re),re.value=de,re.dispatchEvent(new Event("input",{bubbles:!0})),E(H,re)}),Ee.dataset.promptLibraryAttached="true"),ve&&ve.dataset.promptLibraryAttached!=="true"&&(ve.addEventListener("click",()=>{if(typeof window.aipkit_openPromptLibraryManager!="function")return;let de=I(H),ae=de.promptType||S(H),ne=de.isCustom&&de.promptId?de.promptId:"",ye=String(de.label||"").replace(/\s+\(Custom\)\s*$/i,"").trim();window.aipkit_openPromptLibraryManager({promptType:ae,promptId:ne,label:ye,promptText:String(re?.value||"")})}),ve.dataset.promptLibraryAttached="true"),Z&&Z.dataset.promptLibraryAttached!=="true"&&(Z.addEventListener("click",()=>{if(!_||!re||typeof window.aipkit_openPromptLibraryManager!="function")return;let de=S(H);if(!de)return;let ne=(I(H).label||"").replace(/\s+\(Custom\)\s*$/i,"").trim();window.aipkit_openPromptLibraryManager({action:"create",promptType:de,label:ne,promptText:String(re.value||"")})}),Z.dataset.promptLibraryAttached="true"),pe&&pe.dataset.promptLibraryAttached!=="true"&&(pe.addEventListener("click",()=>{if(!_||!re||typeof window.aipkit_openPromptLibraryManager!="function")return;let de=I(H);if(!de.isCustom||!de.promptId){E(H,re);return}let ae=de.label.replace(/\s+\(Custom\)\s*$/i,"").trim(),ne=de.promptType||S(H);ne&&window.aipkit_openPromptLibraryManager({action:"update",promptType:ne,promptId:de.promptId,label:ae,promptText:String(re.value||"")})}),pe.dataset.promptLibraryAttached="true"),we&&we.dataset.promptLibraryAttached!=="true"&&(we.addEventListener("click",async()=>{if(!_||!re)return;let de=I(H);if(!de.isCustom||!de.promptId){E(H,re);return}if(window.confirm("Delete the selected custom preset?")){we.disabled=!0;try{await _.remove({promptId:de.promptId,promptType:de.promptType||S(H)}),await oe(!0),H.selectedIndex=0,E(H,re)}catch(ne){O(ne)}finally{we.disabled=!1}}}),we.dataset.promptLibraryAttached="true"),H.addEventListener("change",()=>{E(H,re)}),H.dataset.promptLibraryAttached="true"}),_&&(oe(!0),r.dataset.promptLibrarySyncAttached!=="true"&&(window.addEventListener("aipkit_prompt_library_updated",()=>{oe(!0)}),r.dataset.promptLibrarySyncAttached="true")),r.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(H=>{H.dataset.overlayListenerAttached!=="true"&&(H.addEventListener("click",K=>{K.target===H&&N()}),H.dataset.overlayListenerAttached="true")}),r.dataset.bulkPromptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",H=>{H.key==="Escape"&&d&&N()}),r.dataset.bulkPromptFlyoutEscapeAttached="true"),r.dataset.bulkPromptFlyoutClickAttached!=="true"&&(document.addEventListener("click",H=>{if(!d)return;let K=H.target;K.closest(".aipkit_cw_prompt_flyout")||K.closest("[data-aipkit-flyout-target]")||N()}),r.dataset.bulkPromptFlyoutClickAttached="true"),r.dataset.bulkPromptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",F),window.addEventListener("scroll",F,!0),r.dataset.bulkPromptFlyoutRepositionAttached="true"),window.aipkit_enhancer_closeBulkPromptFlyout=N}window.aipkit_enhancer_initBulkPromptPopovers=o,window.aipkit_enhancer_initBulkPromptFlyouts=t})();(function(){"use strict";let k=window.aipkit_escapeHtml||(d=>d||""),n=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],e="aipkit_bulk_enhancer_prompt_draft_v1",i=24*60*60*1e3,a=["title","excerpt","content","meta","keyword","tags"],s=d=>{let w=parseInt(d,10);if(Number.isFinite(w)){if(w>=1&&w<=n.length)return n[w-1];let h=n.find(b=>b.tokens===w);if(h)return h}return n[1]};function l(d){if(!d)return null;let w={},h={},b=!1;return a.forEach(A=>{let S=d.querySelector(`#aipkit_bulk_prompt_${A}`),I=d.querySelector(`#aipkit_bulk_enhance_${A}`),T=S?S.value:"",x=S?String(S.defaultValue||""):"";w[A]=T,h[A]=I?I.checked:!1,!b&&(S&&T!==x||h[A])&&(b=!0)}),b?{updatedAt:Date.now(),templateId:d.querySelector("#aipkit_enhancer_template_select")?.value||"",prompts:w,enabled:h}:null}function c(d){try{let w=l(d);if(!w){localStorage.removeItem(e);return}localStorage.setItem(e,JSON.stringify(w))}catch(w){console.warn("Bulk Enhancer: failed to save prompt draft.",w)}}function o(){try{let d=localStorage.getItem(e);if(!d)return null;let w=JSON.parse(d);return!w||typeof w!="object"||typeof w.updatedAt!="number"||Date.now()-w.updatedAt>i?(localStorage.removeItem(e),null):w}catch(d){return console.warn("Bulk Enhancer: failed to load prompt draft.",d),null}}function t(d){let w=o();if(!d||!w)return!1;let h=d.querySelector("#aipkit_enhancer_template_select"),b=h?String(h.value||""):"",A=String(w.templateId||"");return A&&b&&A!==b?!1:(a.forEach(S=>{let I=d.querySelector(`#aipkit_bulk_prompt_${S}`),T=d.querySelector(`#aipkit_bulk_enhance_${S}`);I&&w.prompts&&Object.prototype.hasOwnProperty.call(w.prompts,S)&&(I.value=String(w.prompts[S]||""),I.dispatchEvent(new Event("input",{bubbles:!0}))),T&&w.enabled&&Object.prototype.hasOwnProperty.call(w.enabled,S)&&(T.checked=!!w.enabled[S],T.dispatchEvent(new Event("change",{bubbles:!0})))}),!0)}function r(d,w){let h=window.aipkit_post_enhancer||{},b,A,S,I,T;d==="openai"?(b=w.querySelector("#aipkit_bulk_openai_vector_store_ids"),A=h.openai_vector_stores||[],S="id",I="name",T="No OpenAI stores found."):d==="pinecone"?(b=w.querySelector("#aipkit_bulk_pinecone_index_name"),A=h.pinecone_indexes||[],S="name",I="name",T="No Pinecone indexes found."):d==="qdrant"&&(b=w.querySelector("#aipkit_bulk_qdrant_collection_name"),A=h.qdrant_collections||[],S="name",I="name",T="No Qdrant collections found."),b&&(b.innerHTML="",A.length>0?b.multiple?A.forEach(x=>{b.add(new Option(k(x[I]),x[S]))}):(b.add(new Option("-- Select --","")),A.forEach(x=>{b.add(new Option(k(x[I]),x[S]))})):(b.add(new Option(T,"")),b.disabled=!0),d==="openai"&&f(w))}function f(d){let w=d.querySelector("[data-aipkit-vector-stores-dropdown]");if(!w)return;let h=w.closest(".aipkit_cw_vector_openai_field"),b=h?h.querySelector(".aipkit_popover_multiselect_select"):null;if(!b)return;let A=w.querySelector(".aipkit_popover_multiselect_btn"),S=w.querySelector(".aipkit_popover_multiselect_label"),I=w.querySelector(".aipkit_popover_multiselect_panel"),T=w.querySelector(".aipkit_popover_multiselect_options"),x=w.dataset.placeholder||"Select stores",E=w.dataset.selectedLabel||"selected",v=()=>{if(!S)return;let D=Array.from(b.options).filter(U=>U.selected&&U.value);if(!D.length){S.textContent=x;return}let W=D.map(U=>U.textContent.trim()).filter(Boolean);if(W.length<=2){S.textContent=W.join(", ");return}S.textContent=`${W.length} ${E}`},y=()=>{if(!T)return;T.innerHTML="";let D=Array.from(b.options),W=D.filter(U=>U.value);if(!W.length){let U=document.createElement("div");U.className="aipkit_popover_multiselect_empty",U.textContent=D[0]?.textContent||"-- No Stores Found --",T.appendChild(U),v();return}W.forEach(U=>{let J=document.createElement("label");J.className="aipkit_popover_multiselect_item";let oe=document.createElement("input");oe.type="checkbox",oe.value=U.value,oe.checked=U.selected,oe.disabled=U.disabled;let O=document.createElement("span");O.className="aipkit_popover_multiselect_text",O.textContent=U.textContent,J.appendChild(oe),J.appendChild(O),T.appendChild(J)}),v()},C=()=>{if(!T){v();return}let D=new Set(Array.from(b.options).filter(W=>W.selected).map(W=>W.value));T.querySelectorAll('input[type="checkbox"]').forEach(W=>{W.checked=D.has(W.value)}),v()},M=D=>{if(!T)return;let W=Array.from(T.querySelectorAll('input[type="checkbox"]:checked'));if(W.length>2){let J=D&&D.target;if(J&&J.checked)J.checked=!1;else{let oe=W[W.length-1];oe&&(oe.checked=!1)}}let U=Array.from(T.querySelectorAll('input[type="checkbox"]:checked')).map(J=>J.value);Array.from(b.options).forEach(J=>{J.selected=U.includes(J.value)}),b.dispatchEvent(new Event("change",{bubbles:!0})),v()},B=D=>{!w||!A||(w.classList.toggle("is-open",D),A.setAttribute("aria-expanded",D?"true":"false"),I&&(I.hidden=!D))};y(),C(),w.dataset.vectorStoreMultiselectAttached||(A&&(A.addEventListener("click",D=>{D.preventDefault(),D.stopPropagation(),B(!w.classList.contains("is-open"))}),A.addEventListener("keydown",D=>{D.key==="Escape"&&B(!1)})),document.addEventListener("click",D=>{w.classList.contains("is-open")&&(w.contains(D.target)||B(!1))}),T&&!T.dataset.listenerAttached&&(T.addEventListener("change",M),T.dataset.listenerAttached="true"),b.dataset.listenerAttached||(b.addEventListener("change",C),b.dataset.listenerAttached="true"),w.dataset.vectorStoreMultiselectAttached="true")}function u(d,w){let h=w.querySelector("#aipkit_bulk_vector_embedding_model");if(!h)return;let b=window.aipkit_post_enhancer||{},A=[];d==="google"?A=b.googleEmbeddingModels||[]:d==="openrouter"?A=b.openrouterEmbeddingModels||[]:d==="azure"?A=b.azureEmbeddingModels||[]:A=b.openaiEmbeddingModels||[],h.innerHTML="",A.length>0?(h.add(new Option("-- Select Model --","")),A.forEach(S=>{h.add(new Option(k(S.name||S.id),S.id))}),h.disabled=!1):(h.add(new Option("No models found","")),h.disabled=!0)}function p(d){let w=d.querySelector("#aipkit_bulk_vector_store_provider").value,h=d.querySelector(".aipkit_cw_vector_openai_field"),b=d.querySelector(".aipkit_cw_vector_pinecone_field"),A=d.querySelector(".aipkit_cw_vector_qdrant_field"),S=d.querySelector(".aipkit_cw_vector_embedding_config_row");h&&(h.hidden=!0),b&&(b.hidden=!0),A&&(A.hidden=!0),S&&(S.hidden=!0),w==="openai"?(h&&(h.hidden=!1),r("openai",d)):w==="pinecone"?(b&&(b.hidden=!1),S&&(S.hidden=!1),r("pinecone",d),u("openai",d)):w==="qdrant"&&(A&&(A.hidden=!1),S&&(S.hidden=!1),r("qdrant",d),u("openai",d))}function _(d){let w=d.querySelector('input[name="enable_vector_store"]'),h=d.querySelector(".aipkit_cw_vector_store_settings_container"),b=d.querySelector("#aipkit_bulk_vector_store_provider"),A=d.querySelector("#aipkit_bulk_vector_embedding_provider"),S=d.querySelector("#aipkit_bulk_vector_store_top_k"),I=d.querySelector("#aipkit_bulk_vector_store_top_k_value");if(!(!w||!h||!b)){if(w.addEventListener("change",()=>{h.hidden=!w.checked}),b.addEventListener("change",()=>p(d)),A&&A.addEventListener("change",T=>u(T.target.value,d)),S&&I){let T=()=>{I.textContent=S.value};S.addEventListener("input",T),T()}h.hidden=!w.checked,p(d)}}function m(d){let w=d.querySelectorAll(".aipkit_prompt_toggle_card, .aipkit_enhancer_prompt_card");w.length&&w.forEach(h=>{let b=h.querySelector('input[name="bulk_enhance_fields"], input[name="generate_seo_slug"]');if(!b)return;let A=()=>{h.classList.toggle("is-disabled",!b.checked)};A(),b.addEventListener("change",A),h.dataset.promptToggleAttached!=="true"&&(h.addEventListener("click",S=>{S.target.closest(".aipkit_prompt_edit_btn")||S.target.closest("a")||b.disabled||(S.target.closest(".aipkit_switch")&&S.preventDefault(),b.checked=!b.checked,b.dispatchEvent(new Event("change",{bubbles:!0})))}),h.dataset.promptToggleAttached="true")})}function g(d,w){if(!d)return;let h=null,b=d.querySelector("#aipkit-enhancer-bulk-config"),A=d.querySelector("#aipkit-enhancer-bulk-progress"),S=d.querySelector("#aipkit_bulk_enhancer_start_btn"),I=d.querySelector("#aipkit_bulk_enhancer_stop_btn"),T=d.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn");if(b&&(b.hidden=!1),A&&(A.hidden=!0),S){S.disabled=!1;let O=S.querySelector(".aipkit_btn-text");O&&(O.textContent="Start")}I&&(I.hidden=!0),T&&(T.hidden=!0);let x=d.querySelectorAll(".aipkit_enhancer_advanced_details");x.length&&x.forEach(O=>{if(O.dataset.toggleListenerAttached==="true")return;let L=O.querySelector("summary");L&&(L.addEventListener("click",F=>{F.preventDefault(),O.hasAttribute("open")?O.removeAttribute("open"):O.setAttribute("open","")}),O.dataset.toggleListenerAttached="true")});let E=d.querySelector(".aipkit_enhancer_settings_popover");E&&E.dataset.checkboxDelegateAttached!=="true"&&(E.addEventListener("click",O=>{let L=O.target?.closest?.(".aipkit_switch");if(L&&E.contains(L)){let R=L.querySelector('input[type="checkbox"]');if(!R||R.disabled)return;O.preventDefault(),R.checked=!R.checked,R.dispatchEvent(new Event("change",{bubbles:!0}));return}let F=O.target.closest(".aipkit_checkbox-label");if(!F||!E.contains(F))return;let N=F.querySelector('input[type="checkbox"]');!N||N.disabled||O.target!==N&&(O.preventDefault(),N.checked=!N.checked,N.dispatchEvent(new Event("change",{bubbles:!0})))}),E.dataset.checkboxDelegateAttached="true");function v(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),c(d),d&&(d.classList.remove("aipkit-active"),d.addEventListener("transitionend",()=>d.remove(),{once:!0}),setTimeout(()=>d?.remove(),500))}d.querySelector(".aipkit-modal-close-btn").addEventListener("click",v);let y=d.querySelector("#aipkit_bulk_ai_provider"),C=d.querySelector("#aipkit_bulk_ai_model"),M=d.querySelector("#aipkit_bulk_ai_temperature"),B=d.querySelector("#aipkit_bulk_ai_temperature_value"),D=d.querySelector("#aipkit_bulk_content_max_tokens"),W=d.querySelector("#aipkit_bulk_content_max_tokens_value");if(y&&C&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(y.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(y,C)),window.aipkit_enhancer_populateBulkModels(y,C)),C&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&C.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(d)),M&&B&&M.addEventListener("input",()=>B.textContent=M.value),D&&W){let O=()=>{let L=s(D.value);W.textContent=`${L.words} words`};D.addEventListener("input",O),O()}typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(d),m(d),typeof window.aipkit_enhancer_initBulkPromptPopovers=="function"&&window.aipkit_enhancer_initBulkPromptPopovers(d),typeof window.aipkit_enhancer_initBulkPromptFlyouts=="function"&&window.aipkit_enhancer_initBulkPromptFlyouts(d);let U=[...a.map(O=>`#aipkit_bulk_prompt_${O}`),...a.map(O=>`#aipkit_bulk_enhance_${O}`)],J=O=>!O||!O.matches?!1:U.some(L=>O.matches(L)),oe=()=>{h&&clearTimeout(h),h=setTimeout(()=>{h=null,c(d)},250)};d.addEventListener("input",O=>{J(O.target)&&oe()}),d.addEventListener("change",O=>{J(O.target)&&oe()}),setTimeout(()=>{t(d)&&typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Prompt draft restored","success")},450),d.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(w)}),d.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),d.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),_(d)}window.aipkit_enhancer_attachBulkModalListeners=g})();(function(){"use strict"})();(function(){"use strict";function k(n,e,i){let s=(window.aipkit_post_enhancer||{}).text||{};n?window.aipkit_updateModalWithError(n.message||s.error_loading_title,s):e?window.aipkit_updateModalWithSuggestions(e,s):window.aipkit_updateModalWithError(s.error_loading_title||"Unknown error occurred.",s)}window.aipkit_handleTitleSuggestionsResult=k})();(function(){"use strict";function k(n,e,i){let s=(window.aipkit_post_enhancer||{}).text||{};n?window.aipkit_updateModalWithErrorExcerpt(n.message||s.error_loading_excerpt,s):e?window.aipkit_updateModalWithExcerptSuggestions(e,s):window.aipkit_updateModalWithErrorExcerpt(s.error_loading_excerpt||"Unknown error occurred.",s)}window.aipkit_handleExcerptSuggestionsResult=k})();(function(){"use strict";function k(n,e,i){let s=(window.aipkit_post_enhancer||{}).text||{};n?window.aipkit_updateModalWithErrorMeta(n.message||s.error_loading_meta,s):e?window.aipkit_updateModalWithMetaSuggestions(e,s):window.aipkit_updateModalWithErrorMeta(s.error_loading_meta||"Unknown error occurred.",s)}window.aipkit_handleMetaSuggestionsResult=k})();(function(){"use strict";function k(){}function n(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=n})();(function(){"use strict";function k(e){let i=e.target.closest(".aipkit_enhancer_item"),a=e.target.closest("#aipkit_bulk_enhance_btn");if(i){if(i.classList.contains("aipkit_enhancer_placeholder")){e.target.tagName==="A"&&e.preventDefault();return}e.preventDefault();let s=i.getAttribute("data-post-id"),l=i.getAttribute("data-action-type");if(!s||!l)return;let c=window.aipkit_post_enhancer||{},o=c.text||{};switch(l){case"title":window.aipkit_showLoadingModal(s,o,c),window.aipkit_fetchTitleSuggestions(s,window.aipkit_handleTitleSuggestionsResult,i);break;case"excerpt":window.aipkit_showLoadingExcerptModal(s,o,c),window.aipkit_fetchExcerptSuggestions(s,window.aipkit_handleExcerptSuggestionsResult,i);break;case"meta":window.aipkit_showLoadingMetaModal(s,o,c),window.aipkit_fetchMetaSuggestions(s,window.aipkit_handleMetaSuggestionsResult,i);break;case"tags":window.aipkit_showLoadingTagsModal(s,o,c),window.aipkit_fetchTagsSuggestions(s,window.aipkit_handleTagsSuggestionsResult,i);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${l}'.`);break}}else if(a){e.preventDefault();let s=document.querySelectorAll('input[name="post[]"]:checked');if(s.length===0){alert("Please select at least one post.");return}let l=Array.from(s).map(o=>o.value),c=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(l,c):alert("Error: Bulk processing feature is not available.")}}function n(){let e=document;if(!e)return;let i="data-post-enhancer-listener";document.body.getAttribute(i)||(e.addEventListener("click",k),document.body.setAttribute(i,"true"))}window.aipkit_initEnhancerEventListeners=n})();(function(){"use strict";function k(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(e=>typeof window[e]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),function(){let i=new WeakMap;function a(t){l(t),t.classList.add("aipkit-open")}function s(t){l(t);let r=setTimeout(()=>{t.classList.remove("aipkit-open")},180);i.set(t,r)}function l(t){let r=i.get(t);r&&(clearTimeout(r),i.delete(t))}function c(t){if(!t||t.dataset.aipkitHoverBound==="1")return;t.dataset.aipkitHoverBound="1",t.addEventListener("mouseenter",()=>a(t)),t.addEventListener("mouseleave",()=>s(t));let r=t.querySelector(".aipkit_enhancer_popover");r&&(r.addEventListener("mouseenter",()=>a(t)),r.addEventListener("mouseleave",()=>s(t)))}function o(){document.querySelectorAll(".aipkit_enhancer_action").forEach(c),new MutationObserver(f=>{for(let u of f)u.addedNodes&&u.addedNodes.length&&u.addedNodes.forEach(p=>{p.nodeType===1&&(p.matches&&p.matches(".aipkit_enhancer_action")&&c(p),p.querySelectorAll&&p.querySelectorAll(".aipkit_enhancer_action").forEach(c))})}).observe(document.body,{childList:!0,subtree:!0})}o()}()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initPostEnhancer=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function n(){e()}function e(){let i=document.getElementById("aipkit_vpp_embedding_model_select");if(!i){console.error("VPP Embedding Util: Embedding model select not found.");return}let a=window.aipkit_vpp_config||{},s=a.text||{};i.innerHTML=`<option value="">${k(s.select_model||"-- Select Model --")}</option>`;let l=[{key:"openai",label:"OpenAI",models:a.openaiEmbeddingModels||[]},{key:"google",label:"Google",models:a.googleEmbeddingModels||[]},{key:"openrouter",label:"OpenRouter",models:a.openrouterEmbeddingModels||[]},{key:"azure",label:"Azure",models:a.azureEmbeddingModels||[]}],c=!1;l.forEach(o=>{if(!o.models||o.models.length===0)return;c=!0;let t=document.createElement("optgroup");t.label=o.label,o.models.forEach(r=>{if(r&&r.id){let f=document.createElement("option");f.value=r.id,f.textContent=k(r.name||r.id),f.dataset.provider=o.key,t.appendChild(f)}}),t.children.length&&i.appendChild(t)}),c?(i.disabled=!1,i.options.length>1&&(i.selectedIndex=1)):(i.appendChild(new Option(k(s.no_embedding_models||"(No embedding models - Sync in AI Settings)"),"")),i.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=n,window.aipkit_vpp_populateEmbeddingModelSelect=e})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(c){return c};function n(c){let o="(Files: N/A)";return c.file_counts&&typeof c.file_counts.total=="number"?o=`(${c.file_counts.total} ${c.file_counts.total===1?"File":"Files"})`:c.file_counts&&(o="(Files: ?)"),`${k(c.name||c.id)} ${o}`}function e(c,o=""){let t=window.aipkit_vpp_config||{};if(t.openai_vector_stores=Array.isArray(c)?c:[],window.aipkit_vpp_config=t,s(),!o)return;let r=document.getElementById("aipkit_vpp_openai_vector_store_id");!r||!Array.from(r.options).some(u=>u.value===o)||(r.value=o,r.dispatchEvent(new Event("change",{bubbles:!0})))}async function i(c=""){let t=(window.aipkit_vpp_config||{}).nonce_openai_store_list||"";if(!t||typeof window.aipkit_apiRequest!="function")return!1;try{let r=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:t,limit:100,order:"desc"});return!r||!Array.isArray(r.stores)?!1:(e(r.stores,c),!0)}catch(r){return console.warn("VPP OpenAI Provider: Failed to refresh vector stores after indexing.",r),!1}}function a(c,o){let t=Number(o);if(!c||!Number.isFinite(t)||t<=0)return!1;let r=window.aipkit_vpp_config||{},f=Array.isArray(r.openai_vector_stores)?r.openai_vector_stores:[],u=!1,p=f.map(_=>{if(!_||_.id!==c)return _;u=!0;let m={..._},g=_.file_counts&&typeof _.file_counts=="object"?{..._.file_counts}:{},d=Number(g.total);return g.total=Number.isFinite(d)&&d>=0?d+t:t,m.file_counts=g,m});return u?(e(p,c),!0):!1}function s(){let c=document.getElementById("aipkit_vpp_openai_vector_store_id"),o=document.getElementById("aipkit_vpp_openai_store_status"),t=window.aipkit_vpp_config||{},r=t.text||{},f=t.openai_vector_stores||[];if(!c){console.error("VPP OpenAI Provider: Store select not found.");return}c.innerHTML="",o&&(o.textContent=""),f.length>0?(c.appendChild(new Option(`-- ${k(r.select_store||"Select Existing Store")} --`,"")),f.forEach(u=>{let p=n(u),_=new Option(p,u.id);c.appendChild(_)})):c.appendChild(new Option(k(r.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),c.disabled=f.length===0}async function l(c,o,t,r){let f=window.aipkit_vpp_config||{},u=f.text||{},p=c.length,_=0,m=0,g=0,d=[];try{let w=f.nonce_index_posts;if(!w)throw new Error("Nonce for indexing posts is missing in config.");for(let b of c){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}_++;let A=document.querySelector(`#post-${b}`),S=A?A.querySelector(".title .row-title"):null,I=S?S.textContent.trim():`Post #${b}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(b,"processing","",I),typeof window.aipkit_vpp_updateProgress=="function"){let x=_/p*100,E=(u.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",_).replace("%2$d",p)+` "${k(I)}"`;window.aipkit_vpp_updateProgress(x,E)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let T={_ajax_nonce:w,post_ids:[b],post_type:r,target_store_id:o,new_store_name_openai:t||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",T),m++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(b,"success","",I)}catch(x){if(g++,d.push({id:b,title:I,error:x.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${b}:`,x),typeof window.aipkit_vpp_updateProgressItem=="function"){let E=x?.message||u.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(b,"error",E,I)}}}let h=`Indexing complete. ${m} successful, ${g} failed.`;window.aipkit_isIndexingStopped&&_<p?h=`Indexing stopped. ${m} successful, ${g} failed.`:g>0&&console.error("Failed Posts:",d),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(h,g>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${m}/${p}`),m>0&&o&&(await i(o)||a(o,m))}catch(w){console.error("VPP OpenAI Provider: Indexing setup error:",w),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,u.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(w.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),g>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=s,window.aipkit_vpp_startIndexingOpenAI=l})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function n(){let i=document.getElementById("aipkit_vpp_pinecone_target_index_select"),a=document.getElementById("aipkit_vpp_pinecone_index_status"),s=window.aipkit_vpp_config||{},l=s.text||{},c=s.pinecone_indexes||[];if(!i){console.error("VPP Pinecone Provider: Index select not found.");return}i.innerHTML="",a&&(a.textContent=""),c.length>0?(i.appendChild(new Option(`-- ${k(l.select_pinecone_index||"Select Pinecone Index")} --`,"")),c.forEach(o=>{let t=o.name||o.id;if(t){let r=`${k(t)} (${o.dimension||"?"})`;i.appendChild(new Option(r,t))}})):i.appendChild(new Option(k(l.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),i.disabled=c.length===0}async function e(i,a,s,l,c){let o=window.aipkit_vpp_config||{},t=o.text||{},r=i.length,f=0,u=0,p=0,_=[];try{let m=o.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let d of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}f++;let w=document.querySelector(`#post-${d}`),h=w?w.querySelector(".title .row-title"):null,b=h?h.textContent.trim():`Post #${d}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(d,"processing","",b),typeof window.aipkit_vpp_updateProgress=="function"){let S=f/r*100,I=(t.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",f).replace("%2$d",r)+` "${k(b)}"`;window.aipkit_vpp_updateProgress(S,I)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let A={_ajax_nonce:m,post_ids:[d],post_type:c,target_index_id:a,provider:"pinecone",embedding_provider:s,embedding_model:l};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",A),u++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(d,"success","",b)}catch(S){if(p++,_.push({id:d,title:b,error:S.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${d}:`,S),typeof window.aipkit_vpp_updateProgressItem=="function"){let I=S?.message||t.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(d,"error",I,b)}}}let g=`Indexing complete. ${u} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&f<r?g=`Indexing stopped. ${u} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",_),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${u}/${r}`)}catch(m){console.error("VPP Pinecone Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,t.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=n,window.aipkit_vpp_startIndexingPinecone=e})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function n(){let i=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),a=document.getElementById("aipkit_vpp_qdrant_collection_status"),s=window.aipkit_vpp_config||{},l=s.text||{},c=s.qdrant_collections||[];if(!i){console.error("VPP Qdrant Provider: Collection select not found.");return}i.innerHTML="",a&&(a.textContent=""),c.length>0?(i.appendChild(new Option(`-- ${k(l.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),c.forEach(o=>{let t=o.name||o.id;t&&i.appendChild(new Option(k(t),t))})):i.appendChild(new Option(k(l.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),i.disabled=c.length===0}async function e(i,a,s,l,c){let o=window.aipkit_vpp_config||{},t=o.text||{},r=i.length,f=0,u=0,p=0,_=[];try{let m=o.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let d of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}f++;let w=document.querySelector(`#post-${d}`),h=w?w.querySelector(".title .row-title"):null,b=h?h.textContent.trim():`Post #${d}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(d,"processing","",b),typeof window.aipkit_vpp_updateProgress=="function"){let S=f/r*100,I=(t.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",f).replace("%2$d",r)+` "${k(b)}"`;window.aipkit_vpp_updateProgress(S,I)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let A={_ajax_nonce:m,post_ids:[d],post_type:c,target_collection_name:a,provider:"qdrant",embedding_provider:s,embedding_model:l};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",A),u++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(d,"success","",b)}catch(S){if(p++,_.push({id:d,title:b,error:S.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${d}:`,S),typeof window.aipkit_vpp_updateProgressItem=="function"){let I=S?.message||t.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(d,"error",I,b)}}}let g=`Indexing complete. ${u} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&f<r?g=`Indexing stopped. ${u} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",_),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${u}/${r}`)}catch(m){console.error("VPP Qdrant Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,t.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=n,window.aipkit_vpp_startIndexingQdrant=e})();(function(){"use strict";let k=window.wp?.i18n?.__||function(x){return x},n="#aipkit_vpp_modal",e=["#aipkit_vpp_vector_store_provider","#aipkit_vpp_openai_vector_store_id","#aipkit_vpp_pinecone_target_index_select","#aipkit_vpp_qdrant_target_collection_select","#aipkit_vpp_embedding_model_select"].join(", "),i=null,a=null,s=!1,l=new Set(["aipkit_vpp_vector_store_provider"]),c=x=>!!(x&&x.id&&l.has(x.id)),o=x=>String(x||"").trim().toLowerCase(),t=(x,E)=>{if(!x)return;let v="aipkit_settings_select_picker_icon--";x.classList.forEach(C=>{C.startsWith(v)&&x.classList.remove(C)}),x.classList.remove("is-hidden");let y=o(E);if(!y){x.classList.add("is-hidden");return}x.classList.add(`${v}${y}`)},r=x=>{if(!x)return"";let E=x.getAttribute("data-aipkit-picker-title");if(E)return E;let v=x.id&&document.querySelector(`label[for="${x.id}"]`)||x.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return v?v.textContent.trim():""},f=x=>{if(!x)return"";let E=x.selectedOptions&&x.selectedOptions.length?x.selectedOptions[0]:x.querySelector("option[selected]");if(E)return E.textContent.trim();let v=x.querySelector("option");return v?v.textContent.trim():""},u=x=>({buttonId:`${x}_picker_btn`,labelId:`${x}_picker_label`,popoverId:`${x}_picker_popover`,titleId:`${x}_picker_title`,searchId:`${x}_picker_search`,listId:`${x}_picker_list`}),p=(x,E)=>{if(!x||!x.id||!E)return null;let v=u(x.id),y=E.querySelector(`#${v.buttonId}`);if(!y){if(y=document.createElement("button"),y.type="button",y.id=v.buttonId,y.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",y.setAttribute("data-aipkit-popover-target",v.popoverId),y.setAttribute("aria-controls",v.popoverId),y.setAttribute("aria-expanded","false"),y.dataset.aipkitPopoverPlacement="bottom",c(x)){y.classList.add("aipkit_settings_select_picker_btn--provider");let D=document.createElement("span");D.className="aipkit_settings_select_picker_icon",D.setAttribute("aria-hidden","true"),t(D,x.value),y.appendChild(D)}let M=document.createElement("span");M.className="aipkit_settings_select_picker_label",M.id=v.labelId,M.textContent=f(x)||k("Select","gpt3-ai-content-generator");let B=document.createElement("span");B.className="dashicons dashicons-arrow-down-alt2",B.setAttribute("aria-hidden","true"),y.appendChild(M),y.appendChild(B),x.insertAdjacentElement("beforebegin",y)}y.disabled=x.disabled,x.classList.contains("screen-reader-text")||x.classList.add("screen-reader-text");let C=E.querySelector(`#${v.popoverId}`);if(!C){C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",c(x)&&C.classList.add("aipkit_settings_select_picker_popover--provider"),C.id=v.popoverId,C.setAttribute("aria-hidden","true");let M=document.createElement("div");M.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",M.setAttribute("role","dialog"),M.setAttribute("aria-labelledby",v.titleId);let B=document.createElement("div");B.className="aipkit_model_settings_popover_header";let D=document.createElement("span");D.className="aipkit_model_settings_popover_title",D.id=v.titleId,D.textContent=r(x)||k("Select","gpt3-ai-content-generator");let W=document.createElement("button");W.type="button",W.className="aipkit_model_settings_popover_close",W.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),W.innerHTML='<span class="dashicons dashicons-no-alt"></span>',B.appendChild(D),B.appendChild(W);let U=document.createElement("div");U.className="aipkit_model_settings_popover_body";let J=document.createElement("div");J.className="aipkit_settings_select_picker_search";let oe=document.createElement("input");oe.type="search",oe.id=v.searchId,oe.className="aipkit_form-input";let O=r(x),L=O?`Search ${O.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");oe.setAttribute("placeholder",L),J.appendChild(oe);let F=document.createElement("div");F.className="aipkit_settings_select_picker_list",F.id=v.listId,F.setAttribute("role","listbox"),U.appendChild(J),U.appendChild(F),M.appendChild(B),M.appendChild(U),C.appendChild(M),E.appendChild(C),(c(x)||x.dataset.aipkitPickerSearch==="false")&&(J.style.display="none")}return{ids:v,button:y,popover:C,label:E.querySelector(`#${v.labelId}`),search:E.querySelector(`#${v.searchId}`),list:E.querySelector(`#${v.listId}`)}},_=x=>{let E=[];return x&&Array.from(x.children).forEach(y=>{if(y.tagName==="OPTGROUP"){let C=Array.from(y.children).filter(M=>M.tagName==="OPTION").map(M=>({value:M.value,label:M.textContent.trim(),disabled:M.disabled,selected:M.selected}));E.push({groupLabel:y.label||"",options:C})}else y.tagName==="OPTION"&&E.push({groupLabel:"",options:[{value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}]})}),E},m=(x,E,v="")=>{if(!x||!E)return;let y=v.trim().toLowerCase();E.innerHTML="";let C=_(x),M=!1;if(C.forEach(B=>{let D=B.options.filter(W=>y?W.label.toLowerCase().includes(y):!0);if(D.length){if(B.groupLabel){let W=document.createElement("div");W.className="aipkit_settings_select_picker_group_label",W.textContent=B.groupLabel,E.appendChild(W)}D.forEach(W=>{let U=document.createElement("button");if(U.type="button",U.className="aipkit_settings_select_picker_item",U.setAttribute("role","option"),U.dataset.value=W.value,U.dataset.label=W.label,W.disabled&&(U.classList.add("is-disabled"),U.setAttribute("aria-disabled","true")),x.value===W.value?(U.classList.add("is-active"),U.setAttribute("aria-selected","true")):U.setAttribute("aria-selected","false"),c(x)){U.classList.add("aipkit_settings_select_picker_item--provider");let O=document.createElement("span");O.className="aipkit_settings_select_picker_icon",O.setAttribute("aria-hidden","true"),t(O,W.value),U.appendChild(O)}let J=document.createElement("span");J.className="aipkit_settings_select_picker_text",J.textContent=W.label;let oe=document.createElement("span");oe.className="dashicons dashicons-yes aipkit_settings_select_picker_check",U.appendChild(J),U.appendChild(oe),E.appendChild(U),M=!0})}}),!M){let B=document.createElement("div");B.className="aipkit_settings_select_picker_empty",B.textContent=k(y?"No matches found.":"No options available.","gpt3-ai-content-generator"),E.appendChild(B)}},g=(x,E,v)=>{if(!x||!E)return;let y=f(x);if(E.textContent=y||k("Select","gpt3-ai-content-generator"),v&&(v.disabled=x.disabled),c(x)){let C=v?v.querySelector(".aipkit_settings_select_picker_icon"):null;t(C,x.value)}},d=(x,E)=>{if(!x||!E)return;let v=x.getBoundingClientRect(),y=E.getBoundingClientRect(),C=y.width||320,M=y.height||0,B=window.innerWidth,D=window.innerHeight,W=12,U=v.left;U+C>B-W&&(U=v.right-C),U=Math.max(W,Math.min(U,B-C-W));let J=v.bottom+8;J+M>D-W&&(J=v.top-M-8),J=Math.max(W,Math.min(J,D-M-W)),E.style.left=`${Math.round(U)}px`,E.style.top=`${Math.round(J)}px`},w=()=>{!i||!a||s||(s=!0,window.requestAnimationFrame(()=>{let x=i.querySelector(".aipkit_model_settings_popover_panel");d(a,x),s=!1}))},h=()=>{i&&(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),i=null,a=null)},b=(x,E,v)=>{if(!x||!E)return;i&&i!==E&&h(),i=E,a=x,E.classList.add("aipkit-active"),E.setAttribute("aria-hidden","false"),x.setAttribute("aria-expanded","true");let y=E.querySelector(".aipkit_settings_select_picker_search input"),C=E.querySelector(".aipkit_settings_select_picker_list");C&&m(v,C,y?y.value:""),y&&y.offsetParent!==null&&(y.focus(),y.select());let M=E.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{d(x,M)})},A=(x,E)=>{if(!x||!E)return;let{button:v,popover:y,list:C,search:M,label:B}=E;if(v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("click",D=>{if(D.preventDefault(),!v.disabled){if(i===y){h();return}b(v,y,x)}}),v.dataset.pickerListenerAttached="true"),y&&y.dataset.overlayListenerAttached!=="true"){y.addEventListener("click",W=>{W.target===y&&h()});let D=y.querySelector(".aipkit_model_settings_popover_close");D&&D.addEventListener("click",W=>{W.preventDefault(),h()}),y.dataset.overlayListenerAttached="true"}if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",D=>{let W=D.target.closest(".aipkit_settings_select_picker_item");if(!W||W.classList.contains("is-disabled"))return;let U=W.dataset.value??"";x.value=U,x.dispatchEvent(new Event("change",{bubbles:!0})),g(x,B,v),m(x,C,M?M.value:""),h()}),C.dataset.pickerListenerAttached="true"),M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("input",()=>{m(x,C,M.value)}),M.dataset.pickerListenerAttached="true"),x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("change",()=>{g(x,B,v),m(x,C,M?M.value:""),i===y&&h()}),x.dataset.pickerListenerAttached="true"),x&&x.dataset.pickerObserverAttached!=="true"){let D=!1;new MutationObserver(()=>{D||(D=!0,window.requestAnimationFrame(()=>{g(x,B,v),m(x,C,M?M.value:""),D=!1}))}).observe(x,{childList:!0,subtree:!0}),x.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitVppPickerEscapeBound||(document.addEventListener("keydown",D=>{D.key==="Escape"&&i&&h()}),document.body.dataset.aipkitVppPickerEscapeBound="true"),document.body.dataset.aipkitVppPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitVppPickerRepositionBound="true")};function S(x){if(!x||x.dataset.aipkitVppPickerInit==="true")return;let E=x.querySelectorAll(e);E.length&&(E.forEach(v=>{if(!v.id||v.dataset.aipkitPickerInit==="true")return;let y=p(v,x);y&&(g(v,y.label,y.button),m(v,y.list,y.search?y.search.value:""),A(v,y),v.dataset.aipkitPickerInit="true")}),x.dataset.aipkitVppPickerInit="true")}function I(){document.querySelectorAll(n).forEach(S)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I(),new MutationObserver(I).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initVppSelectPickers=S})();(function(){"use strict";let k="aipkit_vpp_modal",n=window.aipkit_escapeHtml||function(h){return h},e=window.aipkit_escapeAttribute||n,i=[],a="",s=!1,l=h=>{if(!h)return"Post";let b=window.aipkit_vpp_postTitles||{};if(b[h])return b[h];let A=document.querySelector(`#post-${h}`),S=A?A.querySelector(".title .row-title")||A.querySelector("strong a")||A.querySelector(".title a")||A.querySelector("a.row-title")||A.querySelector(".column-title strong a")||A.querySelector(".column-title .row-title"):null,I=S?S.textContent.trim():`Post #${h}`;return b[h]=I,window.aipkit_vpp_postTitles=b,I},c=h=>{let b=window.aipkit_vpp_config?.text||{};return{pending:b.status_pending||"Pending",processing:b.status_processing||"Processing",success:b.status_completed||"Completed",error:b.status_failed||"Failed",stopped:b.status_stopped||"Stopped"}[h]||h},o=(h,b)=>{let A=document.createElement("div");A.className="aipkit_vpp_progress_item aipkit_vpp_progress_item--pending",A.dataset.postId=h;let S=document.createElement("div");S.className="aipkit_vpp_progress_item_main";let I=document.createElement("div");I.className="aipkit_vpp_progress_item_title",I.textContent=b;let T=document.createElement("div");T.className="aipkit_vpp_progress_item_message",T.textContent="",T.style.display="none";let x=document.createElement("div");return x.className="aipkit_vpp_progress_item_status",x.textContent=c("pending"),S.appendChild(I),S.appendChild(T),A.appendChild(S),A.appendChild(x),A};function t(h,b){if(document.getElementById(k)){console.warn("VPP Modal UI: Modal already exists.");return}i=h,a=b,s=!1;let S=(window.aipkit_vpp_config||{}).text||{},I="",T=h.length;T===1?I=n(S.items_selected_singular||"You have selected %d item to index.").replace("%d",`<strong>${T}</strong>`):I=n(S.items_selected_plural||"You have selected %d items to index.").replace("%d",`<strong>${T}</strong>`);let x=document.createElement("div");x.id=k,x.className="aipkit-modal-overlay aipkit-active";let E=document.createElement("div");E.className="aipkit-modal-content aipkit_vpp_modal_content",E.innerHTML=`
            <div class="aipkit-modal-header aipkit_vpp_modal_header">
                <div class="aipkit_vpp_header_left">
                    <span class="aipkit_vpp_header_icon" aria-hidden="true">
                        <span class="dashicons dashicons-database"></span>
                    </span>
                    <div class="aipkit_vpp_header_text">
                        <h3 class="aipkit-modal-title">${n(S.modal_title||"Add Content to Vector Store")}</h3>
                        <span class="aipkit_vpp_header_subtitle">${n(S.modal_subtitle||"Index selected content for retrieval")}</span>
                    </div>
                </div>
                <button type="button" class="aipkit-modal-close-btn aipkit_vpp_close_btn" aria-label="${e(S.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body aipkit_vpp_modal_body">
                <div id="aipkit_vpp_status_message" class="aipkit_vpp_status_message" aria-live="polite"></div>

                <div class="aipkit_vpp_selection_card">
                    <span class="aipkit_vpp_selection_text">${I}</span>
                </div>

                <div class="aipkit_vpp_engine_card">
                    <div class="aipkit_enhancer_engine_card">
                        <div class="aipkit_enhancer_engine_fields">
                            <div class="aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_vector_store_provider">${n(S.provider_label||"Provider")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_vector_store_provider" class="aipkit_enhancer_engine_select">
                                            <option value="openai" selected>OpenAI</option>
                                            <option value="pinecone">Pinecone</option>
                                            <option value="qdrant">Qdrant</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_openai_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_openai_vector_store_id">${n(S.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_enhancer_engine_select">
                                            <option value="">${n(S.loading_stores||"Loading stores...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_pinecone_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_pinecone_target_index_select">${n(S.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${n(S.loading_indexes||"Loading indexes...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_qdrant_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_qdrant_target_collection_select">${n(S.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${n(S.loading_indexes||"Loading collections...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_embedding_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_embedding_model_select">${n(S.embedding_label||"Embedding")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_embedding_model_select" class="aipkit_enhancer_engine_select" data-aipkit-picker-search="false">
                                            <option value="">${n(S.select_model||"-- Select Model --")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="aipkit_vpp_progress_area" class="aipkit_vpp_section aipkit_vpp_section--progress" hidden>
                    <div class="aipkit_vpp_section_header">
                        <span class="aipkit_vpp_section_title">${n(S.section_progress_title||"Progress")}</span>
                    </div>
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <div id="aipkit_vpp_progress_text" class="aipkit_vpp_progress_text"></div>
                    <div id="aipkit_vpp_progress_log" class="aipkit_vpp_progress_log" role="list"></div>
                </div>
            </div>
            <div class="aipkit-modal-footer aipkit_vpp_modal_footer">
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${n(S.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" hidden></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                     <span class="aipkit_btn-text">${n(S.stop||"Stop")}</span>
                </button>
            </div>
        `,x.appendChild(E),document.body.appendChild(x),E.addEventListener("click",y=>{let C=y.target;C.closest(".aipkit-modal-close-btn")||C.closest(".aipkit_vpp_modal_close_btn")?f():C.closest("#aipkit_vpp_start_indexing_btn")?w():C.closest("#aipkit_vpp_stop_indexing_btn")&&r()}),x.addEventListener("click",y=>{y.target===x&&f()});let v=document.getElementById("aipkit_vpp_vector_store_provider");v&&(v.addEventListener("change",d),d({target:v}))}function r(){window.aipkit_isIndexingStopped=!0;let h=document.getElementById("aipkit_vpp_stop_indexing_btn"),b=window.aipkit_vpp_config?.text||{};if(h){h.disabled=!0;let A=h.querySelector(".aipkit_btn-text");A&&(A.textContent=b.stopping||"Stopping...")}}function f(){window.aipkit_isIndexingStopped=!0;let h=document.getElementById(k);h&&(h.classList.remove("aipkit-active"),setTimeout(()=>{h.parentNode&&h.parentNode.removeChild(h)},300))}function u(h,b){let A=document.querySelector(`#${k} .aipkit_vpp_progress_bar`),S=document.getElementById("aipkit_vpp_progress_text");A&&(A.style.width=`${Math.max(0,Math.min(100,h))}%`),S&&(S.textContent=b)}function p(h){let b=document.getElementById("aipkit_vpp_progress_log");if(!b)return;b.innerHTML="";let A=document.createDocumentFragment();(h||[]).forEach(S=>{let I=l(S);A.appendChild(o(S,I))}),b.appendChild(A),b.scrollTop=0}function _(h,b,A="",S=""){let I=document.getElementById("aipkit_vpp_progress_log");if(!I)return;let T=`.aipkit_vpp_progress_item[data-post-id="${h}"]`,x=I.querySelector(T);if(!x){let y=S||l(h);x=o(h,y),I.appendChild(x)}x.className=`aipkit_vpp_progress_item aipkit_vpp_progress_item--${b}`;let E=x.querySelector(".aipkit_vpp_progress_item_status"),v=x.querySelector(".aipkit_vpp_progress_item_message");E&&(E.textContent=c(b)),v&&(v.textContent=A||"",v.style.display=A?"":"none"),I.scrollTop=I.scrollHeight}function m(h,b="info"){let A=document.getElementById("aipkit_vpp_status_message");A&&(A.textContent=h,A.className=`aipkit_vpp_status_message aipkit_message-${b}`)}function g(){s=!1;let h=document.getElementById("aipkit_vpp_start_indexing_btn"),b=document.getElementById("aipkit_vpp_stop_indexing_btn"),A=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`),S=window.aipkit_vpp_config?.text||{};if(h){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(h,S.start_indexing||"Start Indexing"),h.disabled=!1,h.hidden=!1;let T=h.querySelector(".aipkit_spinner");T&&(T.hidden=!0)}if(b){b.hidden=!0,b.disabled=!1;let T=b.querySelector(".aipkit_btn-text");T&&(T.textContent=S.stop||"Stop")}A.forEach(T=>T.disabled=!1);let I=document.getElementById("aipkit_vpp_progress_area");I&&(I.hidden=!1)}function d(h){let b=h.target.value,A=document.getElementById("aipkit_vpp_openai_options"),S=document.getElementById("aipkit_vpp_pinecone_options"),I=document.getElementById("aipkit_vpp_qdrant_options"),T=document.getElementById("aipkit_vpp_embedding_options");A&&(A.hidden=!0),S&&(S.hidden=!0),I&&(I.hidden=!0),T&&(T.hidden=!0),b==="openai"?(A&&(A.hidden=!1),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):b==="pinecone"?(S&&(S.hidden=!1),T&&(T.hidden=!1),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):b==="qdrant"&&(I&&(I.hidden=!1),T&&(T.hidden=!1),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function w(){if(s)return;window.aipkit_isIndexingStopped=!1;let h=document.getElementById("aipkit_vpp_vector_store_provider").value,b=window.aipkit_vpp_config?.text||{},A="",S={post_ids:i,post_type:a,provider:h};if(h==="openai"){if(A=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!A){m(b.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}S.target_store_id=A}else if(h==="pinecone"){if(A=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!A){m(b.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}S.target_index_id=A;let v=document.getElementById("aipkit_vpp_embedding_model_select"),y=v?.selectedOptions&&v.selectedOptions.length?v.selectedOptions[0]:null;if(S.embedding_model=v?v.value:"",S.embedding_provider=y&&y.dataset.provider||"",!S.embedding_provider||!S.embedding_model){m(b.error_no_embedding_config||"Please select an embedding model for Pinecone.","error");return}}else if(h==="qdrant"){if(A=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!A){m(b.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}S.target_collection_name=A;let v=document.getElementById("aipkit_vpp_embedding_model_select"),y=v?.selectedOptions&&v.selectedOptions.length?v.selectedOptions[0]:null;if(S.embedding_model=v?v.value:"",S.embedding_provider=y&&y.dataset.provider||"",!S.embedding_provider||!S.embedding_model){m(b.error_no_embedding_config||"Please select an embedding model for Qdrant.","error");return}}else{m(`Provider ${h} not yet supported for indexing.`,"error");return}s=!0;let I=document.getElementById("aipkit_vpp_start_indexing_btn"),T=document.getElementById("aipkit_vpp_stop_indexing_btn"),x=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`);if(I&&(I.hidden=!0),T){T.hidden=!1,T.disabled=!1;let v=T.querySelector(".aipkit_btn-text");v&&(v.textContent=b.stop||"Stop")}let E=document.getElementById("aipkit_vpp_progress_area");E&&(E.hidden=!1),typeof window.aipkit_vpp_initProgressLog=="function"&&window.aipkit_vpp_initProgressLog(i),u(0,b.status_preparing||"Preparing..."),h==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(i,A,null,a):h==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(i,A,S.embedding_provider,S.embedding_model,a):h==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(i,A,S.embedding_provider,S.embedding_model,a)}window.aipkit_vpp_showModal=t,window.aipkit_vpp_closeModal=f,window.aipkit_vpp_updateProgress=u,window.aipkit_vpp_initProgressLog=p,window.aipkit_vpp_updateProgressItem=_,window.aipkit_vpp_updateStatus=m,window.aipkit_vpp_resetModalAfterProcessing=g})();(function(){"use strict";let k="aipkit_add_to_vector_store_btn";function e(){let s=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(s.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let l=Array.from(s).map(c=>c.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(l,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function i(){let s=document.getElementById(k);return s&&!s.dataset.vppBound?(s.addEventListener("click",e),s.dataset.vppBound="1",!0):!!(s&&s.dataset.vppBound)}function a(){if(i())return;let s=document.querySelector("#wpbody-content")||document.body,l=Date.now();if(!s)return;let c=new MutationObserver(()=>{(i()||Date.now()-l>15e3)&&c.disconnect()});c.observe(s,{childList:!0,subtree:!0});let o=setInterval(()=>{(i()||Date.now()-l>15e3)&&clearInterval(o)},300)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",a):a()})();})();
