(()=>{(function(){"use strict";function d(i,n){if(!i)return;let e=i.querySelector(".aipkit_btn-text");if(e){e.textContent=n;return}let t=i.querySelector(".aipkit_spinner"),o=Array.from(i.childNodes).find(s=>s.nodeType===Node.TEXT_NODE);o?o.textContent=n+(t?" ":""):i.insertBefore(document.createTextNode(n+(t?" ":"")),i.firstChild),t&&i.appendChild(t)}function a(i,n,e,t=4e3){if(!i)return;let o=i.dataset.baseClass||"aipkit_form-help";i.dataset.baseClass||(i.dataset.baseClass=o),i.messageTimeoutId&&(clearTimeout(i.messageTimeoutId),i.messageTimeoutId=null),i.textContent=e,i.className=o,i.classList.add(`aipkit_form-help-${n}`),i.style.opacity="1",i.style.display="block",i.messageTimeoutId=setTimeout(()=>{i.style.opacity="0",setTimeout(()=>{i.textContent===e&&(i.textContent="",i.className=o,i.style.display="",i.messageTimeoutId=null)},300)},t)}window.aipkit_setButtonText=d,window.aipkit_showTemporaryMessage=a})();(function(){"use strict";function d(i){return i===null||typeof i>"u"?"":String(i).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function a(i){return d(i)}window.aipkit_escapeHtml=d,window.aipkit_escapeAttribute=a})();(function(){"use strict";function d(i){let n=document.createElement("div");if(n.textContent="Copied!",Object.assign(n.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:9999,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)"}),document.body.appendChild(n),i){let{top:e,left:t,width:o}=i.getBoundingClientRect();n.style.top=`${e+window.scrollY+2}px`,n.style.left=`${t+window.scrollX+o+5}px`}else n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateY(0)"}),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateY(-5px)",n.addEventListener("transitionend",()=>n.remove(),{once:!0}),setTimeout(()=>{n.parentNode&&n.remove()},500)},1e3)}async function a(i,n){if(i)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(i),d(n);return}throw new Error("Clipboard API not available")}catch(e){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",e);try{let t=document.createElement("textarea");t.value=i,t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",t.style.opacity="0",t.setAttribute("readonly",""),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999);let o=document.execCommand("copy");if(document.body.removeChild(t),o)d(n);else throw new Error('document.execCommand("copy") failed.')}catch(t){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",t),window.prompt("Please copy the shortcode manually:",i)}}}window.aipkit_copyShortcode=a})();(function(){"use strict";function d(n){let e=Number(n);if(!e||isNaN(e))return"";try{let t=new Date(e*1e3);if(isNaN(t.getTime()))return"";let o=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),r=String(t.getSeconds()).padStart(2,"0");return`${o}:${s}:${r}`}catch(t){return console.error("Error formatting timestamp:",n,t),""}}function a(n){if(!n)return"";try{let e=new Date(n.replace(" ","T")+"Z");if(isNaN(e.getTime()))return"";let t=new Date,o=(e.getTime()-t.getTime())/1e3;if(o<0)return"In the past";if(o<60)return"in less than a minute";if(o<3600){let l=Math.round(o/60);return`in ${l} minute${l!==1?"s":""}`}let s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),c=new Date(e.getFullYear(),e.getMonth(),e.getDate());return c.getTime()===s.getTime()?`Today at ${e.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:c.getTime()===r.getTime()?`Tomorrow at ${e.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${e.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(e){return console.error("Error formatting relative time:",n,e),n}}function i(n){if(!n)return"N/A";try{let e=new Date(n.replace(" ","T")+"Z");return isNaN(e.getTime())?"Invalid Date":e.toLocaleString()}catch(e){return console.error("Error formatting UTC date string:",n,e),n}}window.aipkit_formatTimestamp=d,window.aipkit_formatFriendlyFutureDate=a,window.aipkit_formatUtcDateTime=i})();(function(){"use strict";function d(a){return!a||typeof a!="string"?"":a.charAt(0).toUpperCase()+a.slice(1)}window.aipkit_ucfirst=d,window.ucfirst=d})();(function(){"use strict";function d(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let a=window.markdownit({html:!1,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&a.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=a,a}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=d})();(function(){"use strict";function d(a){let i=document.querySelector(a);if(!i)return;i.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(e=>{let t=e.id+"_value",o=i.querySelector(`#${CSS.escape(t)}`);o&&(o.textContent=e.value,e.hasAttribute("data-range-listener-attached")||(e.addEventListener("input",function(){o.textContent=this.value}),e.setAttribute("data-range-listener-attached","true")))})}window.aipkit_attachRangeValueHandlers=d})();(function(){"use strict";function d(a){let i=document.querySelector(a);if(!i)return;let n="data-apikey-toggle-listener-attached";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_api-key-toggle");if(!t)return;let o=t.closest(".aipkit_api-key-wrapper");if(!o)return;let s=o.querySelector(".aipkit_form-input"),r=t.querySelector(".dashicons");!s||!r||(s.type==="password"?(s.type="text",r.classList.remove("dashicons-visibility"),r.classList.add("dashicons-hidden")):(s.type="password",r.classList.remove("dashicons-hidden"),r.classList.add("dashicons-visibility")))}),i.setAttribute(n,"true"))}window.aipkit_initApiKeyToggles=d})();(function(){"use strict";function d(a){let i=document.querySelector(a);if(!i)return;let n="data-restore-icon-listener-attached";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_restore-default-icon");if(!t)return;let o=t.getAttribute("data-target-input"),s=t.getAttribute("data-default-value");if(!o||s===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",t);return}let r=document.getElementById(o);if(r){if(r.value!==s){r.value=s;let l=new Event("change",{bubbles:!0,cancelable:!0}),p=new Event("blur",{bubbles:!0,cancelable:!0});if(r.dispatchEvent(l),r.dispatchEvent(p),r.type==="range"){let _=document.getElementById(`${o}_value`);_&&(_.textContent=s)}}}else console.warn(`AIPKit Restore Default: Target input element #${o} not found.`)}),i.setAttribute(n,"true"))}window.aipkit_initRestoreDefaultIcons=d})();(function(){"use strict";function d(e){!e||!e.parentNode||e.classList.contains("aipkit_message_fadeout")||(e.classList.add("aipkit_message_fadeout"),e.addEventListener("animationend",()=>{e.parentNode&&e.parentNode.removeChild(e)},{once:!0}),setTimeout(()=>{e&&e.parentNode&&e.parentNode.removeChild(e)},500))}function a(e,t,o){let s=document.getElementById(e);if(!s){console.error(`AIPKit Message Handler: Container #${e} not found.`);return}s.querySelectorAll(".aipkit_settings_message").forEach(m=>{m.dataset.timerId&&clearTimeout(parseInt(m.dataset.timerId,10)),m.remove()});let c=s.querySelector(".aipkit_saving-indicator");c&&c.remove();let l=document.createElement("div");l.className=`aipkit_settings_message aipkit_settings_message-${t}`;let p=t==="success"?"dashicons-yes-alt":t==="error"?"dashicons-warning":"dashicons-info-alt",_=document.createElement("span");_.className=`dashicons ${p}`,_.style.marginRight="5px",l.appendChild(_),l.appendChild(document.createTextNode(` ${o}`));let f=document.createElement("span");f.className="dashicons dashicons-dismiss aipkit_settings_message-close",f.setAttribute("aria-label","Dismiss message"),f.title="Dismiss message",l.appendChild(f),s.appendChild(l);let u=setTimeout(()=>{d(l)},5e3);l.dataset.timerId=u}function i(e){let t=document.getElementById(e);if(!t){console.error(`AIPKit Message Handler: Container #${e} not found for close button init.`);return}let o=`data-close-listener-${e}`;t.getAttribute(o)!=="true"&&(t.addEventListener("click",function(s){let r=s.target.closest(".aipkit_settings_message-close");if(r){let c=r.closest(".aipkit_settings_message");c&&(c.dataset.timerId&&clearTimeout(parseInt(c.dataset.timerId,10)),d(c))}}),t.setAttribute(o,"true"))}function n(e){let t=document.getElementById(e);if(t){let o=t.querySelector(".aipkit_saving-indicator");o&&o.remove(),t.querySelectorAll(".aipkit_settings_message").forEach(r=>{r.dataset.timerId&&clearTimeout(parseInt(r.dataset.timerId,10)),r.remove()})}else console.warn(`AIPKit Message Handler: Container #${e} not found for clearing messages.`)}window.aipkit_showMessage=a,window.aipkit_initMessageCloseButtons=i,window.aipkit_clearStatusMessages=n})();(function(){"use strict";function d(n,e){let t=document.getElementById(n);if(!t){console.error(`AIPKit Saving Indicator: Container #${n} not found.`);return}let o=t.querySelector(".aipkit_saving-indicator");if(e)if(!o)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(n):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),o=document.createElement("span"),o.className="aipkit_saving-indicator",o.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',t.appendChild(o),requestAnimationFrame(()=>{let s=t.querySelector(".aipkit_saving-indicator");s&&s.classList.add("aipkit_active")});else{o.style.display="inline-flex",o.classList.add("aipkit_active");let s=o.querySelector(".aipkit_spinner");s&&(s.style.display="inline-block")}else o&&(o.classList.remove("aipkit_active"),setTimeout(()=>{o&&o.parentNode&&o.remove()},200))}function a(n){i(n);let e=document.createElement("span");e.className="aipkit-title-spinner aipkit_spinner",e.style.display="inline-block",n.parentNode.insertBefore(e,n.nextSibling)}function i(n){let e=n.parentNode.querySelector(".aipkit-title-spinner");e&&e.remove()}window.aipkit_showSavingIndicator=d,window.aipkit_showLinkSpinner=a,window.aipkit_hideLinkSpinner=i})();(function(){"use strict";function d(n){let e=n.textContent;n.textContent="Copied!",n.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{n&&n.classList.contains("aipkit-placeholder--copied")&&(n.textContent=e,n.classList.remove("aipkit-placeholder--copied"))},1500)}function a(n){let e=n.target;if(!e.matches(".aipkit-placeholder"))return;n.preventDefault(),n.stopPropagation();let t=e.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(t).then(()=>{d(e)}).catch(o=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",o)})}function i(){let n=document.body;if(n){let e="data-placeholder-copy-listener-attached";n.getAttribute(e)||(n.addEventListener("click",a),n.setAttribute(e,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",i)})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function d(a,i={},n={}){return new Promise((e,t)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return t(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let o=new FormData;o.append("action",a),!Object.prototype.hasOwnProperty.call(i,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&o.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let c in i)Object.prototype.hasOwnProperty.call(i,c)&&(Array.isArray(i[c])?i[c].forEach(l=>{o.append(c+"[]",l)}):o.append(c,i[c]));let s=new AbortController,r=setTimeout(()=>{s.abort()},n.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:o,credentials:"same-origin",signal:s.signal}).then(c=>(clearTimeout(r),c.json())).then(c=>{if(c.success)e(c.data);else{let l=c.data&&c.data.message?c.data.message:"Unknown error";t(new Error(l))}}).catch(c=>{clearTimeout(r),c.name==="AbortError"?t(new Error("Request timeout")):t(c)})})}window.aipkit_apiRequest=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_modulesMenu");if(a){let o=a.querySelector(".aipkit_dropdown-menu");a.addEventListener("click",function(s){s.stopPropagation(),a.classList.toggle("aipkit_show-menu"),o&&(o.style.display=a.classList.contains("aipkit_show-menu")?"block":"none")}),o&&o.addEventListener("click",function(s){s.stopPropagation()})}let i=document.getElementById("aipkit_top_nav"),n=document.querySelector(".aipkit_mobile-nav-toggle"),e=document.getElementById("aipkit_nav_links_container");n&&i&&e&&(n.addEventListener("click",function(o){o.stopPropagation(),i.classList.toggle("aipkit_nav-open");let s=i.classList.contains("aipkit_nav-open");n.setAttribute("aria-expanded",s.toString()),e.style.display=s?"flex":"none"}),e.addEventListener("click",function(o){o.target.closest(".aipkit_nav-item")&&i.classList.contains("aipkit_nav-open")&&(i.classList.remove("aipkit_nav-open"),n.setAttribute("aria-expanded","false"),e.style.display="none")})),document.addEventListener("click",function(o){if(a&&a.classList.contains("aipkit_show-menu")){let s=a.querySelector(".aipkit_dropdown-menu");a.contains(o.target)||(a.classList.remove("aipkit_show-menu"),s&&(s.style.display="none"))}i&&e&&i.classList.contains("aipkit_nav-open")&&(i.contains(o.target)||(i.classList.remove("aipkit_nav-open"),n&&n.setAttribute("aria-expanded","false"),e.style.display="none"))});let t=document.getElementById("aipkit_modulesMenuMobile");if(t){t.addEventListener("click",function(s){s.stopPropagation(),t.classList.toggle("aipkit_show-menu")});let o=t.querySelector(".aipkit_dropdown-menu");o&&o.addEventListener("click",function(s){s.stopPropagation()})}}window.aipkit_initSettingsMenus=d})();(function(){"use strict";let d={settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",addons:"aipkit_initAddons",logs:"aipkit_initLogs","user-credits":"aipkit_initUserCredits","image-generator":"aipkit_initImageGenerator","ai-training":"aipkit_initAiTraining","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"};async function a(i,n,e){let t={};if(typeof n=="function"?e=n:typeof n=="object"&&n!==null&&(t=n),i==="chatbot"&&!t.force_active_bot_id&&!t.force_active_tab)try{let p=localStorage.getItem("aipkit_last_selected_chatbot");p&&(t.force_active_bot_id=p)}catch(p){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",p)}document.querySelectorAll(".aipkit_module-link").forEach(p=>p.classList.remove("aipkit_active"));let s=document.querySelector(`.aipkit_module-link[data-module="${i}"]`);s&&s.classList.add("aipkit_active");let r=document.getElementById("aipkit_module-container");if(!r)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof e=="function"&&e(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));let c=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",i):`Loading ${i}...`;if(r.innerHTML=`
            <div class="aipkit_container aipkit_loading-placeholder">
                <div class="aipkit_container-body">
                    <p style="text-align: center; padding: 30px;">
                        <span class="aipkit_spinner"
                            style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                        </span>
                        ${c}
                    </p>
                </div>
            </div>
        `,typeof window.aipkit_apiRequest!="function"){let p="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${i}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(r,i,p),typeof e=="function"&&e(new Error(p)),Promise.reject(new Error(p))}let l={module:i,...t};try{let p=await window.aipkit_apiRequest("aipkit_dashboard_load_module",l);if(!p||typeof p.html!="string")throw new Error('Missing or invalid "html" in response data');r.innerHTML=p.html,i==="chatbot"&&p.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=p.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let _=d[i];if(_&&typeof window[_]=="function")try{window[_]()}catch(f){let u=`Error initializing ${i} module scripts.`;return console.error(`AIPKit Loader: Error executing initializer '${_}':`,f),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(r,i,u+` (Details: ${f.message})`),typeof e=="function"&&e(new Error(u+` (Details: ${f.message})`)),Promise.reject(new Error(u+` (Details: ${f.message})`))}return typeof e=="function"&&e(),Promise.resolve()}catch(p){return console.error(`AIPKit Loader: Module loading error for '${i}':`,p),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(r,i,p.message),typeof e=="function"&&e(p),Promise.reject(p)}}window.aipkit_loadModule=a})();(function(){"use strict";function d(a,i,n){if(!a)return;let e=window.aipkit_dashboard?.text||{},t=e.errorLoadingModuleTitle||"Error Loading Module",o=e.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",s=e.errorDetails||"Details:",r=o.replace("%s",i);a.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${t}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${r}</p>
                    <p><strong>${s}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${n||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_modulesMenu");if(!a)return;let i=a.querySelector(".aipkit_dropdown-menu");i&&i.addEventListener("change",function(n){let e=n.target;if(e.matches&&e.matches(".aipkit_module-toggle")){let t=i.querySelectorAll(".aipkit_module-toggle");t.forEach(f=>f.disabled=!0);let o=e.getAttribute("data-module"),s=e.getAttribute("data-option-key"),r=e.getAttribute("data-icon"),c=e.getAttribute("data-label"),l=e.checked,p=document.querySelector(`.aipkit_module-link[data-module="${o}"]`);l?p?p.style.display="":console.log(`Module Toggle: Enabling '${o}'. Nav link will appear on refresh if needed.`):p&&(p.style.display="none");let _={moduleKey:s,enabled:l?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),e.checked=!l,p&&(p.style.display=l?"none":""),t.forEach(f=>f.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",_).then(()=>{console.log(`Module Toggle: '${o}' status updated successfully.`)}).catch(f=>{console.error("Error updating module setting:",f.message),alert(`Error updating module setting: ${f.message}`),e.checked=!l,p&&(p.style.display=l?"none":"")}).finally(()=>{t.forEach(f=>f.disabled=!1)})}})}window.aipkit_initModuleToggles=d})();(function(){"use strict";function d(){document.querySelectorAll(".aipkit_tabs").forEach(n=>{if(n.dataset.tabGroupListenerAttached==="true")return;let e=n.querySelectorAll(".aipkit_tab"),t=n.nextElementSibling;if(!t||!t.classList.contains("aipkit_tab_content_container")){let o=n.closest(".aipkit_container-body, .aipkit_container"),s=o?o.querySelector(".aipkit_tab_content_container"):null;if(!s)return;let r=s.querySelectorAll(".aipkit_tab-content");a(n,e,r)}else{let o=t.querySelectorAll(".aipkit_tab-content");a(n,e,o)}})}function a(i,n,e){n.forEach(t=>{t.addEventListener("click",function(){n.forEach(r=>r.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),e.forEach(r=>r.classList.remove("aipkit_active"));let o=this.getAttribute("data-tab"),s=Array.from(e).find(r=>r.id===o+"-content");s&&(s.classList.add("aipkit_active"),s.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),i.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=d})();(function(){"use strict";function d(){let e=document.getElementById("aipkit_addons_container");if(!e){console.warn("AIPKit Addons: Container #aipkit_addons_container not found for event delegation.");return}let t="data-addon-listeners-attached";if(e.getAttribute(t)){n();return}e.addEventListener("click",function(o){let s=o.target.closest(".aipkit_addon_toggle_btn"),r=o.target.closest(".aipkit_filter_link");s?a(s):r&&i(r)}),e.setAttribute(t,"true"),n()}function a(e){if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Addons: API request function missing."),alert("Error: Cannot update addon status.");return}let t=e.getAttribute("data-addon-key"),o=e.getAttribute("data-active")==="1",s=o?"0":"1",r=e.closest(".aipkit_stat-card"),c=r?r.querySelector(".aipkit_addon_status_msg"):null,l=e.querySelector(".aipkit_btn-text"),p=e.querySelector(".aipkit_spinner");if(!t||!r||!c||!l||!p){console.warn("AIPKit Addons: Missing required elements for toggle button:",e);return}e.disabled=!0,p.style.display="inline-block";let _=l.textContent;l.textContent=o?"Deactivating...":"Activating...",c.textContent="",c.className="aipkit_addon_status_msg",window.aipkit_apiRequest("aipkit_update_addon_status",{addonKey:t,active:s}).then(f=>{let u=o;e.setAttribute("data-active",s),r.setAttribute("data-status",s==="1"?"active":"inactive"),e.classList.toggle("aipkit_btn-primary",u),e.classList.toggle("aipkit_btn-secondary",!u),l.textContent=s==="1"?"Deactivate":"Activate",c.textContent=f.message||"Status updated!",c.style.color="green",setTimeout(()=>{c.textContent="",c.style.color=""},3e3),n()}).catch(f=>{console.error("Error updating addon status:",f),l.textContent=_,c.textContent="Error: "+(f.message||"Could not update status."),c.style.color="red",setTimeout(()=>{c.textContent="",c.style.color=""},5e3)}).finally(()=>{e.disabled=!1,p.style.display="none"})}function i(e){if(e.classList.contains("aipkit_active"))return;let t=e.closest(".aipkit_filter_group");t&&(t.querySelectorAll(".aipkit_filter_link").forEach(o=>o.classList.remove("aipkit_active")),e.classList.add("aipkit_active"),n())}function n(){let e=document.getElementById("aipkit_addons_container");if(!e)return;let t=e.querySelector('.aipkit_filter_group[data-filter-group="category"] .aipkit_filter_link.aipkit_active'),o=t?t.getAttribute("data-filter-value"):"all",s=document.getElementById("aipkit_addons_grid"),r=document.getElementById("aipkit_no_addons_message");if(!s||!r)return;let c=s.querySelectorAll(".aipkit_stat-card"),l=0;c.forEach(p=>{let f=(p.getAttribute("data-categories")||"").split(" ").filter(m=>m);o==="all"||f.includes(o)?(p.classList.remove("aipkit_hidden"),l++):p.classList.add("aipkit_hidden")}),r.style.display=l===0?"block":"none"}window.aipkit_initAddons=d})();document.addEventListener("DOMContentLoaded",function(){typeof window.aipkit_initSettingsMenus=="function"?window.aipkit_initSettingsMenus():console.error("AIPKit Main: aipkit_initSettingsMenus function not found."),typeof window.aipkit_initModuleToggles=="function"?window.aipkit_initModuleToggles():console.error("AIPKit Main: aipkit_initModuleToggles function not found.");let d=document.getElementById("aipkit_top_nav"),a=document.querySelector(".aipkit_mobile-nav-toggle");a&&d&&a.addEventListener("click",function(){d.classList.toggle("aipkit_nav-open")});let i=document.getElementById("aipkit_migration_notice");if(i){let o=i.querySelector(".aipkit_notification_bar__close");o&&o.addEventListener("click",()=>{i.style.display="none"});let s=document.getElementById("aipkit_dismiss_migration_notice_btn");s&&s.addEventListener("click",()=>{if(typeof window.aipkit_apiRequest!="function"){alert("Error: API function missing.");return}s.disabled=!0,s.textContent="Dismissing...",window.aipkit_apiRequest("aipkit_dismiss_migration_notice").then(()=>{i.style.display="none"}).catch(r=>{alert("Error dismissing notice: "+r.message),s.disabled=!1,s.textContent="Dismiss Forever"})})}let t=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(t)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let o=["settings","chatbot","content-writer","ai-forms","image-generator","ai-training","addons"],s=Array.from(document.querySelectorAll(".aipkit_module-link")),r=null;for(let c=0;c<o.length;c++){let l=o[c];if(s.find(_=>_.getAttribute("data-module")===l&&_.offsetParent!==null)){r=l;break}}if(!r){let c=s.find(l=>l.offsetParent!==null);c&&(r=c.getAttribute("data-module"))}if(r)window.aipkit_loadModule(r);else if(s.find(l=>l.getAttribute("data-module")==="settings"))window.aipkit_loadModule("settings");else{let l=document.getElementById("aipkit_module-container");l&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(l,"initial","No modules enabled or accessible. Please activate modules via the top-right menu or check permissions."):l&&(l.innerHTML='<p style="text-align:center; padding: 30px;">No modules enabled. Activate modules via the top-right menu.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!t){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let o=document.getElementById("aipkit_module-container");o&&(o.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function d(){let a={},i=document.getElementById("aipkit_settings_container");return i?(i.querySelectorAll("input[name], select[name], textarea[name]").forEach(e=>{e.type==="checkbox"?a[e.name]=e.checked?"1":"0":e.type==="radio"?e.checked&&(a[e.name]=e.value):a[e.name]=e.value}),a):(console.warn("AIPKit Autosave: Could not find settings container."),a)}window.aipkit_getCurrentFormData=d})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function d(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let a=window.aipkit_getCurrentFormData();if(JSON.stringify(a)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let i="aipkit_settings_messages";window.aipkit_showSavingIndicator(i,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",a),window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"success","Settings saved!"),window.aipkit_lastSavedData=a}catch(n){window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"error","Save failed: "+n.message),console.error("AIPKit Auto-Save Error:",n)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=d})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_settings_container");if(!i)return;let n="data-autosave-listener-attached";i.getAttribute(n)||(i.addEventListener("change",function(e){let t=e.target;t.matches(".aipkit_autosave_trigger")&&t.id!=="aipkit_provider"&&(t.tagName.toLowerCase()==="select"||t.type==="checkbox"||t.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),i.addEventListener("blur",function(e){let t=e.target;if(t.matches(".aipkit_autosave_trigger")&&t.id!=="aipkit_provider"){let o=t.tagName.toLowerCase();(o==="input"||o==="textarea")&&t.type!=="range"&&t.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),i.setAttribute(n,"true"))}function a(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=d,window.aipkit_updateLastSavedData=a})();(function(){"use strict";function d(i){try{return new Date(i+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return i}}function a(i){return typeof i!="number"?i:i.toLocaleString()}window.aipkit_formatChartDate=d,window.aipkit_formatChartNumber=a})();(function(){"use strict";let d=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],a="#B0BEC5",i={};function n(t){i={};let o=0;t.forEach(s=>{if(s==="Other")i[s]=a;else{let r;do r=d[o%d.length],o++;while(r===a&&d.length>1);i[s]=r}})}function e(t){return i[t]||"#cccccc"}window.aipkit_assignModuleColors=n,window.aipkit_getModuleColor=e})();(function(){"use strict";function d(e,t){if(!t||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let o=e.target,s=o.getAttribute("data-date"),r=o.getAttribute("data-module"),c=parseInt(o.getAttribute("data-value"),10),l=parseInt(o.getAttribute("data-daily-total"),10),p=window.aipkit_getModuleColor(r),_=r?a(r.replace(/[-_]/g," ")):"Unknown";t.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(s)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${p}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${_}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(c)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(l)} tokens)</span>
        `,t.classList.add("aipkit_active"),i(e,t)}function a(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function i(e,t){if(!t)return;let o=t.parentElement;if(!o)return;let s=o.getBoundingClientRect(),r=e.clientX-s.left,c=e.clientY-s.top,l=t.offsetWidth,p=t.offsetHeight,_=r+15,f=c-p-10;_+l>s.width-5&&(_=r-l-15),_<5&&(_=5),f<5&&(f=c+15),f+p>s.height-5&&(f=s.height-p-5),t.style.left=`${_}px`,t.style.top=`${f}px`,t.style.transform="translate(0, 0)"}function n(e){e&&e.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=d,window.aipkit_moveChartTooltip=i,window.aipkit_hideChartTooltip=n})();(function(){"use strict";let d="http://www.w3.org/2000/svg";function a(n,e){if(n.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),n.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let t=Object.keys(e);if(t.length===0){n.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let o=new Set;t.forEach(M=>{Object.keys(e[M]).forEach(T=>o.add(T))});let s=Array.from(o);s.sort((M,T)=>{if(M==="Other")return 1;if(T==="Other")return-1;let P=C=>C?i(C.replace(/[-_]/g," ")):"Unknown";return P(M).localeCompare(P(T))}),window.aipkit_assignModuleColors(s);let r=1;t.forEach(M=>{let T=Object.values(e[M]).reduce((P,C)=>P+C,0);T>r&&(r=T)}),r=r*1.05;let c=t.length,l=250,p=s.length>0?Math.max(40,Math.ceil(s.length/3)*20):0,_={top:20,right:20,bottom:30+p,left:50},f=n.clientWidth-_.left-_.right,u=l-_.top-_.bottom,m=Math.max(1,f/c*.8),g=Math.max(0,f/c*.2),k=document.createElementNS(d,"svg");k.setAttribute("viewBox",`0 0 ${n.clientWidth} ${l}`),k.setAttribute("preserveAspectRatio","xMidYMid meet"),k.setAttribute("class","aipkit_token_usage_chart_svg"),k.setAttribute("aria-label","Token usage per module per day chart");let w=document.createElementNS(d,"g");w.setAttribute("transform",`translate(${_.left}, ${_.top})`),k.appendChild(w);let h=document.createElement("div");h.className="aipkit_chart_tooltip",n.style.position="relative",n.appendChild(h);let b=document.createElementNS(d,"g");b.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),w.appendChild(b);let y=document.createElementNS(d,"line");y.setAttribute("x1",0),y.setAttribute("y1",0),y.setAttribute("x2",0),y.setAttribute("y2",u),b.appendChild(y);let S=5;for(let M=0;M<S;M++){let T=Math.round(r*(M/(S-1))),P=u-u*(M/(S-1)),C=document.createElementNS(d,"text");C.setAttribute("x",-5),C.setAttribute("y",P+3),C.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),C.textContent=window.aipkit_formatChartNumber(T),b.appendChild(C);let v=document.createElementNS(d,"line");v.setAttribute("x1",0),v.setAttribute("y1",P),v.setAttribute("x2",f),v.setAttribute("y2",P),v.setAttribute("class","aipkit_chart_grid_line"),w.insertBefore(v,w.firstChild)}let I=document.createElementNS(d,"g");I.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),I.setAttribute("transform",`translate(0, ${u})`),w.appendChild(I);let x=document.createElementNS(d,"line");x.setAttribute("x1",0),x.setAttribute("y1",0),x.setAttribute("x2",f),x.setAttribute("y2",0),I.appendChild(x);let q=Math.max(1,Math.ceil(c/(f/60)));t.forEach((M,T)=>{if(T%q===0||T===c-1){let P=T*(m+g)+m/2+g/2,C=document.createElementNS(d,"text");C.setAttribute("x",P),C.setAttribute("y",_.bottom-p-10),C.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),C.textContent=window.aipkit_formatChartDate(M),I.appendChild(C)}});let $=document.createElementNS(d,"g");if(w.appendChild($),t.forEach((M,T)=>{let P=e[M],C=u,v=0;s.filter(A=>P[A]>0).forEach(A=>{let F=P[A]||0;v+=F;let B=F/r*u;C-=B;let D=T*(m+g)+g/2,O=document.createElementNS(d,"rect");O.setAttribute("x",D),O.setAttribute("y",C),O.setAttribute("width",m),O.setAttribute("height",Math.max(.1,B)),O.setAttribute("class","aipkit_chart_bar"),O.setAttribute("fill",window.aipkit_getModuleColor(A)),O.setAttribute("data-date",M),O.setAttribute("data-module",A),O.setAttribute("data-value",F),O.setAttribute("data-daily-total",0),O.addEventListener("mouseenter",N=>window.aipkit_showStackedTooltip(N,h)),O.addEventListener("mousemove",N=>window.aipkit_moveChartTooltip(N,h)),O.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(h)),$.appendChild(O)}),$.querySelectorAll(`rect[data-date="${M}"]`).forEach(A=>A.setAttribute("data-daily-total",v))}),s.length>0){let M=document.createElementNS(d,"g");M.setAttribute("class","aipkit_chart_legend"),M.setAttribute("transform",`translate(0, ${u+_.bottom-p+5})`),w.appendChild(M);let T=0,P=0,C=20,v=f,E=35;s.forEach(L=>{let A=i(L.replace(/[-_]/g," ")),B=A.length*7+25+E;T>0&&T+B>v&&(T=0,P+=C);let D=document.createElementNS(d,"g");D.setAttribute("transform",`translate(${T}, ${P})`);let O=document.createElementNS(d,"rect");O.setAttribute("width",10),O.setAttribute("height",10),O.setAttribute("y",-5),O.setAttribute("fill",window.aipkit_getModuleColor(L)),D.appendChild(O);let N=document.createElementNS(d,"text");N.setAttribute("x",15),N.setAttribute("y",0),N.setAttribute("class","aipkit_chart_legend_label"),N.textContent=A,D.appendChild(N),M.appendChild(D),T+=B})}n.appendChild(k)}function i(n){return n?n.charAt(0).toUpperCase()+n.slice(1):""}window.aipkit_renderTokenUsageChart=a})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_token_usage_chart_container");if(!a){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let i=a.querySelector(".aipkit_chart_loading_placeholder"),n=a.querySelector(".aipkit_chart_error_placeholder"),e=a.querySelector(".aipkit_chart_nodata_placeholder");n&&(n.style.display="none"),e&&(e.style.display="none"),i&&(i.style.display="flex"),window.aipkit_apiRequest("aipkit_get_token_usage_chart_data").then(t=>{if(i&&(i.style.display="none"),t&&t.daily_token_data){let o=t.daily_token_data;if(Object.values(o).some(r=>Object.values(r).some(c=>c>0)))window.aipkit_renderTokenUsageChart(a,o);else if(e)e.style.display="flex";else{let r=document.createElement("div");r.className="aipkit_chart_nodata_placeholder",r.textContent=window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.",a.innerHTML="",a.appendChild(r)}}else throw new Error("Invalid data received for chart.")}).catch(t=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",t),i&&(i.style.display="none"),n)n.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,n.style.display="flex";else{let o=document.createElement("div");o.className="aipkit_chart_error_placeholder",o.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,a.innerHTML="",a.appendChild(o)}})}window.aipkit_loadTokenUsageChart=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_openai_model");if(!i){console.warn("OpenAI Sync: Select element #aipkit_openai_model not found.");return}let n=i.value;if(i.innerHTML="",!a||Object.keys(a).length===0){i.appendChild(new Option("No models found.",""));return}let e=!1,t=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],o=Object.keys(a);if(t.filter(r=>o.includes(r)).concat(o.filter(r=>!t.includes(r)).sort()).forEach(r=>{let c=a[r]||[];if(c.length===0)return;let l=document.createElement("optgroup");l.label=r,c.sort((p,_)=>(p.name||p.id||"").localeCompare(_.name||_.id||"")),c.forEach(p=>{let _=new Option(p.name||p.id,p.id);p.id===n&&(_.selected=!0,e=!0),l.appendChild(_)}),i.appendChild(l)}),!e&&n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let r=new Option(n+" (manual)",n,!1,!0),c=i.querySelector('optgroup[label="Other"]');c?c.appendChild(r):i.insertBefore(r,i.firstChild),i.value=n,e=!0}if(!e&&i.options.length>0&&i.selectedIndex===-1){let r=-1;for(let c=0;c<i.options.length;c++)if(!i.options[c].disabled&&i.options[c].value){r=c;break}i.selectedIndex=r!==-1?r:0}}window.aipkit_updateOpenAIModels=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_openrouter_model");if(!i){console.warn("OpenRouter Sync: Select element #aipkit_openrouter_model not found.");return}let n=i.value;if(i.innerHTML="",!a||!a.length){i.appendChild(new Option("No models found.",""));return}let e=!1,t={};if(a.forEach(s=>{let r=s.id.split("/"),c=(r.length>1?r[0]:"other").toLowerCase();t[c]||(t[c]=[]),t[c].push(s)}),Object.keys(t).sort().forEach(s=>{let r=document.createElement("optgroup");r.label=s.charAt(0).toUpperCase()+s.slice(1),t[s].sort((c,l)=>(c.name||"").localeCompare(l.name||"")),t[s].forEach(c=>{let l=new Option(c.name,c.id);c.id===n&&(l.selected=!0,e=!0),r.appendChild(l)}),i.appendChild(r)}),!e&&n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let s=new Option(n+" (manual)",n,!1,!0);i.insertBefore(s,i.firstChild),i.value=n,e=!0}if(!e&&i.options.length>0&&i.selectedIndex===-1){let s=-1;for(let r=0;r<i.options.length;r++)if(!i.options[r].disabled&&i.options[r].value){s=r;break}i.selectedIndex=s!==-1?s:0}}window.aipkit_updateOpenRouterModels=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_google_model");if(!i){console.warn("Google Sync: Select element #aipkit_google_model not found.");return}let n=i.value;if(i.innerHTML="",!a||!a.length){i.appendChild(new Option("No models found.",""));return}let e=!1;if(a.sort((t,o)=>(t.name||t.id||"").localeCompare(o.name||o.id||"")),a.forEach(t=>{let o=t.id||"",s=t.name||o;if(!o)return;let r=new Option(s,o);(o===n||`models/${o}`===n)&&(r.selected=!0,e=!0),i.appendChild(r)}),!e&&n){let t=n.startsWith("models/")?n.substring(7):n;if(!i.querySelector(`option[value="${CSS.escape(t)}"]`)){let o=t,s=new Option(o+" (manual)",n,!1,!0);i.insertBefore(s,i.firstChild),i.value=n,e=!0}}if(!e&&i.options.length>0&&i.selectedIndex===-1){let t=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){t=o;break}i.selectedIndex=t!==-1?t:0}}window.aipkit_updateGoogleModels=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_azure_deployment");if(!i){console.warn("Azure Sync: Select element #aipkit_azure_deployment not found.");return}let n=i.value;if(i.innerHTML="",!a||!a.length){if(i.appendChild(new Option("No deployments found.","")),n){let t=new Option(n+" (manual)",n,!1,!0);i.appendChild(t),i.value=n}return}let e=!1;if(a.sort((t,o)=>(t.id||"").localeCompare(o.id||"")),a.forEach(t=>{let o=t.id||"",s=t.name||o;if(!o)return;let r=o+(s&&s!==o?` (model: ${s})`:""),c=new Option(r,o);o===n&&(c.selected=!0,e=!0),i.appendChild(c)}),!e&&n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let t=new Option(n+" (not in synced list)",n,!1,!0);i.appendChild(t),i.value=n,e=!0}if(!e&&i.options.length>0&&i.selectedIndex===-1){let t=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){t=o;break}i.selectedIndex=t!==-1?t:0}}window.aipkit_updateAzureDeployments=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_deepseek_model");if(!i){console.warn("DeepSeek Sync: Select element #aipkit_deepseek_model not found.");return}let n=i.value;if(i.innerHTML="",!a||!a.length){i.appendChild(new Option("No models found.",""));return}let e=!1;if(a.sort((t,o)=>(t.name||t.id||"").localeCompare(o.name||o.id||"")),a.forEach(t=>{let o=t.id||"",s=t.name||o;if(!o)return;let r=new Option(s,o);o===n&&(r.selected=!0,e=!0),i.appendChild(r)}),!e&&n&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let t=new Option(n+" (manual)",n,!1,!0);i.insertBefore(t,i.firstChild),i.value=n,e=!0}if(!e&&i.options.length>0&&i.selectedIndex===-1){let t=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){t=o;break}i.selectedIndex=t!==-1?t:0}}window.aipkit_updateDeepSeekModels=d})();(function(){"useastrict";function d(i,n="aipkit_elevenlabs_voice_id"){let e=document.getElementById(n);if(!e){console.warn(`ElevenLabs Sync (Voices): Select element #${n} not found.`);return}let t=e.value;if(e.innerHTML="",e.appendChild(new Option("-- Select a Voice (Optional) --","")),!i||!i.length){t&&t!==""&&(e.appendChild(new Option(t+" (manual/not synced)",t,!1,!0)),e.value=t);return}let o=!1;if(i.sort((s,r)=>(s.name||s.id||"").localeCompare(r.name||r.id||"")),i.forEach(s=>{let r=s.id||"",c=s.name||r;if(!r)return;let l=new Option(c,r);r===t&&(l.selected=!0,o=!0),e.appendChild(l)}),!o&&t&&t!==""&&!e.querySelector(`option[value="${CSS.escape(t)}"]`)){let s=new Option(t+" (manual/not synced)",t,!1,!0);e.appendChild(s),e.value=t}}function a(i,n="aipkit_elevenlabs_tts_model_id"){let e=document.getElementById(n);if(!e){console.warn(`ElevenLabs Sync (Models): Select element #${n} not found.`);return}let t=e.value;if(e.innerHTML="",e.appendChild(new Option("-- Select a Model (Optional) --","")),!i||!i.length){t&&t!==""&&(e.appendChild(new Option(t+" (manual/not synced)",t,!1,!0)),e.value=t);return}let o=!1;if(i.sort((s,r)=>(s.name||s.id||"").localeCompare(r.name||r.id||"")),i.forEach(s=>{let r=s.id||"",c=s.name||r;if(!r)return;let l=new Option(c,r);r===t&&(l.selected=!0,o=!0),e.appendChild(l)}),!o&&t&&t!==""&&!e.querySelector(`option[value="${CSS.escape(t)}"]`)){let s=new Option(t+" (manual/not synced)",t,!1,!0);e.appendChild(s),e.value=t}}window.aipkit_updateElevenLabsVoices=d,window.aipkit_updateElevenLabsModelsSelect=a})();(function(){"use strict";function d(a,i="aipkit_pinecone_default_index"){let n=document.getElementById(i);if(!n){console.warn(`Pinecone Sync: Select element #${i} not found.`);return}let e=n.value;if(n.innerHTML="",n.appendChild(new Option("-- Select Default Index --","")),!a||!a.length){n.appendChild(new Option("(No indexes found - Sync again)","")),e&&e!==""&&(n.appendChild(new Option(e+" (manual/not synced)",e,!1,!0)),n.value=e);return}let t=!1;if(a.sort((o,s)=>(o.name||o.id||"").localeCompare(s.name||s.id||"")),a.forEach(o=>{let s=o.name||o.id||(typeof o=="string"?o:"");if(!s)return;let r=new Option(s,s);s===e&&(r.selected=!0,t=!0),n.appendChild(r)}),!t&&e&&e!==""&&!n.querySelector(`option[value="${CSS.escape(e)}"]`)){let o=new Option(e+" (manual/not synced)",e,!1,!0);n.appendChild(o),n.value=e}}window.aipkit_updatePineconeIndexes=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_qdrant_default_collection");if(!i){console.warn("Qdrant Sync: Select element #aipkit_qdrant_default_collection not found.");return}let n=i.value;if(i.innerHTML="",i.appendChild(new Option("-- Select Collection (Optional) --","")),!a||!a.length){i.appendChild(new Option("(No collections found - Sync again)","")),n&&n!==""&&(i.appendChild(new Option(n+" (manual/not synced)",n,!1,!0)),i.value=n);return}let e=!1;if(a.sort((t,o)=>(t.name||t.id||"").localeCompare(o.name||o.id||"")),a.forEach(t=>{let o=t.name||t.id||"";if(!o)return;let s=new Option(o,o);o===n&&(s.selected=!0,e=!0),i.appendChild(s)}),!e&&n&&n!==""&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let t=new Option(n+" (manual/not synced)",n,!1,!0);i.appendChild(t),i.value=n}}window.aipkit_updateQdrantCollections=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_replicate_model");if(!i){console.warn("Replicate Sync: Select element #aipkit_replicate_model not found.");return}let n=i.value;if(i.innerHTML="",!a||!a.length){i.appendChild(new Option("(No models found - Sync again)","")),n&&n!==""&&(i.appendChild(new Option(n+" (manual/not synced)",n,!1,!0)),i.value=n);return}let e=!1;if(a.sort((t,o)=>(t.name||t.id||"").localeCompare(o.name||o.id||"")),a.forEach(t=>{let o=t.id||"",s=t.name||o;if(!o)return;let r=new Option(s,o);o===n&&(r.selected=!0,e=!0),i.appendChild(r)}),!e&&n&&n!==""&&!i.querySelector(`option[value="${CSS.escape(n)}"]`)){let t=new Option(n+" (manual)",n,!1,!0);i.insertBefore(t,i.firstChild),i.value=n}if(!i.value&&i.options.length>0){let t=-1;for(let o=0;o<i.options.length;o++)if(!i.options[o].disabled&&i.options[o].value){t=o;break}i.selectedIndex=t!==-1?t:0}}window.aipkit_updateReplicateModels=d})();(function(){"use strict";function d(i,n){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing.");return}let e={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,Azure:window.aipkit_updateAzureDeployments,DeepSeek:window.aipkit_updateDeepSeekModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof e[n]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${n}.`),alert(`AIPKit Error: Cannot update UI for ${n}.`);return}let t="aipkit_settings_messages";window.aipkit_clearStatusMessages(t),window.aipkit_showSavingIndicator(t,!1);let o=i.querySelector(".aipkit_btn-text"),s=o?o.textContent:n.includes("ElevenLabs")||n.includes("Pinecone")||n.includes("Qdrant")||n.includes("Replicate")?"Sync Items":"Sync Models";o&&(o.textContent="");let r=i.querySelector(".aipkit_spinner");r||(r=document.createElement("span"),r.className="aipkit_spinner",i.appendChild(r)),r.style.display="inline-block",i.classList.add("aipkit_loading"),i.disabled=!0,window.aipkit_apiRequest("aipkit_sync_models",{provider:n}).then(c=>{e[n](c.models),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.warn("Model Sync Init: Cannot update autosave baseline.");let l="models";n==="ElevenLabs"?l="voices":n==="ElevenLabsModels"?l="synthesis models":n==="PineconeIndexes"?l="indexes":n==="QdrantCollections"&&(l="collections"),window.aipkit_showMessage(t,"success",`${n.replace(/Indexes|Collections|Models/,"")} ${l} synced!`)}).catch(c=>{window.aipkit_showMessage(t,"error",`Sync failed: ${c.message}`),console.error(`AIPKit Sync Error (${n}):`,c)}).finally(()=>{i.disabled=!1,i.classList.remove("aipkit_loading");let c=i.querySelector(".aipkit_spinner");c&&(c.style.display="none"),o&&(o.textContent=s)})}function a(){let i=document.getElementById("aipkit_module-container");if(!i){console.error("AIPKit Model Sync Init: Main module container not found.");return}let n="data-sync-listener-attached";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_sync_btn");if(!t||t.disabled)return;e.preventDefault();let o=t.getAttribute("data-provider");o?d(t,o):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",t)}),i.setAttribute(n,"true"))}window.aipkit_initSyncButtons=a})();(function(){"use strict";let d=!1,a=window.aipkit_escapeHtml||(f=>f||""),i={},n={},e=100;function t(f,u){if(!f||typeof f!="string")return"";if(f.length<=u)return f;let m=f.substring(0,u-1);return m.substring(0,m.lastIndexOf(" ")).trim()+"\u2026"}function o(f){let u=document.createElement("tr");u.dataset.actionId=f.id,u.dataset.label=f.label,u.dataset.prompt=f.prompt;let m=`
            <button type="button" class="button button-small aipkit-enhancer-edit-action-btn" aria-label="${a(n.edit_action||"Edit")}"><span class="dashicons dashicons-edit"></span></button>
            <button type="button" class="button button-small button-link-delete aipkit-enhancer-delete-action-btn" aria-label="${a(n.delete_action||"Delete")}"><span class="dashicons dashicons-trash"></span></button>
        `,g=a(f.prompt),k=`<span class="aipkit-enhancer-prompt-text">${g}</span>`;return g.length>e&&(k=`
          <span class="aipkit-enhancer-prompt-text">${t(g,e)}</span>
          <button type="button" class="aipkit-enhancer-prompt-toggle">Show more</button>
      `),u.innerHTML=`
            <td class="aipkit-action-label-cell"><strong>${a(f.label)}</strong></td>
            <td class="aipkit-action-prompt-cell"><div class="aipkit-enhancer-prompt-text-wrapper">${k}</div></td>
            <td class="aipkit_enhancer_action_buttons">${m}</td>
        `,u}function s(f){let u=f.querySelector(".aipkit-action-label-cell"),m=f.querySelector(".aipkit-action-prompt-cell"),g=f.querySelector(".aipkit_enhancer_action_buttons");if(!u||!m||!g)return;let k=f.dataset.label,w=f.dataset.prompt;u.innerHTML=`<input type="text" class="widefat" value="${a(k)}" maxlength="50">`,m.innerHTML="";let h=document.createElement("textarea");h.className="widefat",h.rows=3,h.value=w,m.appendChild(h),g.innerHTML=`
            <button type="button" class="button button-primary button-small aipkit-enhancer-save-action-btn">${a("Save")}</button>
            <button type="button" class="button button-secondary button-small aipkit-enhancer-cancel-action-btn">${a("Cancel")}</button>
        `,f.classList.add("is-editing"),u.querySelector("input").focus()}function r(f,u){f.dataset.actionId=u.id,f.dataset.label=u.label,f.dataset.prompt=u.prompt,f.classList.remove("is-editing");let m=o(u);f.innerHTML=m.innerHTML}function c(f){let u="aipkit_enhancer_actions_status";if(f.rows.length>=10){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(u,"error","Maximum of 10 actions (3 default + 7 custom) reached."):alert("Maximum of 10 actions reached.");return}if(f.querySelector('tr[data-action-id^="new-"]'))return;let m=document.createElement("tr");m.dataset.actionId=`new-${Date.now()}`,m.classList.add("is-editing"),m.innerHTML=`
            <td class="aipkit-action-label-cell">
                <input type="text" class="widefat" placeholder="New Label" maxlength="50">
            </td>
            <td class="aipkit-action-prompt-cell"><textarea class="widefat" rows="3" placeholder="Enter prompt. Use %s for selected text."></textarea></td>
            <td class="aipkit_enhancer_action_buttons">
                <button type="button" class="button button-primary button-small aipkit-enhancer-save-action-btn">${a("Save")}</button>
                <button type="button" class="button button-secondary button-small aipkit-enhancer-cancel-action-btn">${a("Cancel")}</button>
            </td>
        `,f.prepend(m),m.querySelector("input").focus()}async function l(f){if(d)return;let u=f.querySelector(".aipkit-action-label-cell"),m=f.querySelector(".aipkit-action-prompt-cell"),g=u.querySelector("input"),k=m.querySelector("textarea"),w="aipkit_enhancer_actions_status";if(!g||!k)return;u.querySelectorAll(".aipkit_form-help-error").forEach(x=>x.remove()),m.querySelectorAll(".aipkit_form-help-error").forEach(x=>x.remove()),g.style.borderColor="",k.style.borderColor="";let h=g.value.trim(),b=k.value.trim(),y=f.dataset.actionId,S=!1;if(!h){g.style.borderColor="red";let x=document.createElement("div");x.className="aipkit_form-help aipkit_form-help-error",x.textContent="Label cannot be empty.",u.appendChild(x),S=!0}if(!b){k.style.borderColor="red";let x=document.createElement("div");x.className="aipkit_form-help aipkit_form-help-error",x.textContent="Prompt cannot be empty.",m.appendChild(x),S=!0}if(S)return;d=!0;let I=f.querySelector(".aipkit-enhancer-save-action-btn");I&&(I.textContent=n.saving_action||"Saving...",I.disabled=!0);try{let x=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:y,label:h,prompt:b,_ajax_nonce:i.nonce_manage_actions});r(f,x.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(w,"success",n.action_saved||"Action saved.")}catch(x){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(w,"error",`Error: ${x.message}`):alert(`Error saving action: ${x.message}`),I&&(I.textContent="Save")}finally{I&&(I.disabled=!1),d=!1}}async function p(f){let u=f.querySelector("#aipkit_enhancer_actions_list"),m=f.querySelector("#aipkit_enhancer_actions_status");u.innerHTML=`<tr><td colspan="3" style="text-align:center;">${a(n.loading_actions||"Loading...")}</td></tr>`;try{let g=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:i.nonce_manage_actions});u.innerHTML="",(g.actions||[]).forEach(k=>{u.appendChild(o(k))})}catch(g){m.innerHTML=`<span class="error">${a(g.message||"Failed to load actions.")}</span>`}}function _(){let f=document.getElementById("aipkit_enhancer_actions_container");if(!f||f.dataset.listenerAttached)return;f.dataset.listenerAttached="true",i=window.aipkit_post_enhancer||{},n=i.text||{};let u=f.querySelector("#aipkit_enhancer_actions_list");f.addEventListener("click",async m=>{let g=m.target.closest(".aipkit-enhancer-add-new-btn"),k=m.target.closest(".aipkit-enhancer-edit-action-btn"),w=m.target.closest(".aipkit-enhancer-delete-action-btn"),h=m.target.closest(".aipkit-enhancer-save-action-btn"),b=m.target.closest(".aipkit-enhancer-cancel-action-btn"),y=m.target.closest(".aipkit-enhancer-prompt-toggle");if(g)c(u);else if(y){let I=y.closest(".aipkit-enhancer-prompt-text-wrapper").querySelector(".aipkit-enhancer-prompt-text"),x=y.closest("tr").dataset.prompt;y.textContent.toLowerCase().includes("more")?(I.textContent=a(x),y.textContent="Show less"):(I.textContent=t(a(x),e),y.textContent="Show more")}else if(k)s(k.closest("tr"));else if(h)await l(h.closest("tr"));else if(b){let S=b.closest("tr");S.dataset.actionId.startsWith("new-")?S.remove():r(S,{id:S.dataset.actionId,label:S.dataset.label,prompt:S.dataset.prompt,is_default:!1})}else if(w){if(d)return;let S=w.closest("tr"),I=S.dataset.actionId,x="aipkit_enhancer_actions_status";if(!confirm(n.confirm_delete_action||"Are you sure you want to delete this action? This cannot be undone."))return;d=!0,w.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:I,_ajax_nonce:i.nonce_manage_actions}),S.remove(),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(x,"success",n.action_deleted||"Action deleted.")}catch(q){typeof window.aipkit_showMessage=="function"?window.aipkit_showMessage(x,"error",`Error: ${q.message}`):alert(`Error deleting: ${q.message}`),w.disabled=!1}finally{d=!1}}}),f.addEventListener("keydown",m=>{if(m.key==="Enter"&&m.target.matches("input[type=text]")&&!m.target.matches("textarea")){m.preventDefault();let g=m.target.closest("tr.is-editing");g&&l(g)}}),window.aipkit_enhancer_reload_actions=()=>p(f),p(f)}window.aipkit_initEnhancerActionsUI=_})();(function(){"use strict";let d=[],a=[];function i(t){let o=document.getElementById("aipkit_semantic_search_target_id");if(!o)return;let s=o.value;o.innerHTML='<option value="">-- Select --</option>';let r=[];t==="pinecone"?r=d:t==="qdrant"&&(r=a),Array.isArray(r)&&r.forEach(c=>{let l=c.name||c.id||(typeof c=="string"?c:null);if(l){let p=document.createElement("option");p.value=l,p.textContent=l,o.appendChild(p)}}),o.querySelector(`option[value="${CSS.escape(s)}"]`)&&(o.value=s)}function n(t){let o=document.getElementById("aipkit_semantic_search_embedding_provider");if(!o||!t)return;let s=t.options[t.selectedIndex];s&&s.dataset.provider&&(o.value=s.dataset.provider)}function e(){let t=document.getElementById("aipkit_settings_container");if(!t)return;let o="data-semantic-search-listener-attached";if(t.getAttribute(o))return;let s=document.getElementById("aipkit_semantic_search_vector_provider"),r=document.getElementById("aipkit_pinecone_indexes_json_main"),c=document.getElementById("aipkit_qdrant_collections_json_main"),l=document.getElementById("aipkit_semantic_search_embedding_model");if(s){if(r&&r.dataset.indexes)try{d=JSON.parse(r.dataset.indexes)||[]}catch(p){console.error("Error parsing Pinecone indexes JSON:",p)}if(c&&c.dataset.collections)try{a=JSON.parse(c.dataset.collections)||[]}catch(p){console.error("Error parsing Qdrant collections JSON:",p)}s&&(s.addEventListener("change",p=>{if(i(p.target.value),typeof window.aipkit_handleAutoSave=="function"){let _=document.getElementById("aipkit_semantic_search_target_id");_&&(_.value=""),window.aipkit_handleAutoSave()}}),i(s.value)),l&&(l.addEventListener("change",p=>{n(p.target)}),n(l)),t.setAttribute(o,"true")}}window.aipkit_initSemanticSearchUI=e})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_settings_container");if(!i)return;let n=i.querySelector("#aipkit_provider");if(!n)return;let e=n.value,t=e.toLowerCase(),o=i.querySelectorAll(".aipkit_api_key_field"),s=i.querySelectorAll(".aipkit_model_field"),r=i.querySelectorAll(".aipkit_advanced_settings_provider"),c=i.querySelector("#aipkit_safety_settings_accordion"),l=i.querySelector(".aipkit_openai_store_field"),p=i.querySelectorAll(".aipkit_param_not_openai");o.forEach(m=>m.style.display="none"),s.forEach(m=>m.style.display="none"),r.forEach(m=>m.style.display="none"),c&&(c.style.display="none"),l&&(l.style.display="none"),i.querySelectorAll(`.aipkit_api_key_field[data-provider="${e}"]`).forEach(m=>m.style.display="block"),i.querySelectorAll(`.aipkit_model_field[data-provider="${e}"]`).forEach(m=>m.style.display="block");let u=i.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${e}"]`);u&&(u.style.display="block"),e==="Google"?c&&(c.style.display="block"):e==="OpenAI"&&l&&(l.style.display="block"),e==="OpenAI"||e==="Google"?p.forEach(m=>m.style.display="none"):p.forEach(m=>m.style.display="block")}function a(){let i=document.getElementById("aipkit_provider");if(i){let n="data-provider-listener-attached";if(i.getAttribute(n)==="true")return;i.addEventListener("change",function(){d(),typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found.")}),i.setAttribute(n,"true"),d()}}window.aipkit_toggleProviderFields=d,window.aipkit_initProviderSelectListener=a})();(function(){"use strict";function d(){typeof window.aipkit_initMessageCloseButtons=="function"?window.aipkit_initMessageCloseButtons("aipkit_settings_messages"):console.error("Settings Init: aipkit_initMessageCloseButtons not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(o=>{o.dataset.accordionListenerAttached!=="true"&&(o.addEventListener("click",function(){let s=this.nextElementSibling;if(s){this.classList.toggle("aipkit_active"),s.classList.toggle("aipkit_active");let r=this.closest(".aipkit_accordion");r?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(r.style.display="block")}}),o.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found.");let i=document.getElementById("aipkit_elevenlabs_voice_id"),n=document.getElementById("aipkit_elevenlabs_voices_json_main");if(i&&n&&typeof window.aipkit_updateElevenLabsVoices=="function")try{let o=JSON.parse(n.dataset.voices||"[]"),s=i.value||"";window.aipkit_updateElevenLabsVoices(o,i.id)}catch(o){console.error("AIPKit Settings Init: Failed to parse initial ElevenLabs voices JSON from main settings.",o)}let e=document.getElementById("aipkit_elevenlabs_tts_model_id"),t=document.getElementById("aipkit_elevenlabs_models_json_main");if(e&&t&&typeof window.aipkit_updateElevenLabsModelsSelect=="function")try{let o=JSON.parse(t.dataset.models||"[]");window.aipkit_updateElevenLabsModelsSelect(o,e.id)}catch(o){console.error("AIPKit Settings Init: Failed to parse initial ElevenLabs models JSON from main settings.",o)}typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found.")}window.aipkit_initSettings=d})();(function(){"use strict";function d(a,i,n){let e=document.getElementById("aipkit_user_credits_table_body");if(!e)return;let t=wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(e.innerHTML="",!a||a.length===0)return;let o=window.aipkit_escapeHtml||function(s){return s};a.forEach(s=>{let r=e.insertRow();r.dataset.userId=s.id,r.insertCell().textContent=`${s.display_name} (${s.email})`;let c=r.insertCell(),l=document.createElement("input");l.type="number",l.className="aipkit_form-input aipkit_user_credits_balance_input",l.value=s.token_balance||0,l.dataset.userId=s.id,l.dataset.originalValue=s.token_balance||0,l.setAttribute("min","0"),l.setAttribute("step","1"),l.title=t("Press Enter or blur to save changes","gpt3-ai-content-generator"),c.appendChild(l);let p=document.createElement("span");p.className="aipkit_user_credits_balance_status",c.appendChild(p);let _=s.total_used_all_bots||0;r.insertCell().textContent=_.toLocaleString();let f=r.insertCell(),u=[],m=s.tokens_used||{},g=s.image_usage||{used:0},k=t("Image Generator","gpt3-ai-content-generator");g.used>0&&u.push(`<li><strong>${o(k)}:</strong> ${g.used.toLocaleString()}</li>`),Object.keys(m).length>0&&Object.keys(m).sort((T,P)=>T-P).forEach(T=>{let P=n[T]||`Bot #${T}`,C=m[T]||0;u.push(`<li><strong>${o(P)}:</strong> ${C.toLocaleString()}</li>`)});let w='<ul class="aipkit_usage_detail_list">';u.length===0?w+="<li>-</li>":u.forEach((T,P)=>{P>=2?w+=T.replace("<li",'<li class="aipkit_usage_detail_extra" style="display: none;"'):w+=T}),w+="</ul>",u.length>2&&(w+=`<button type="button" class="aipkit_btn-as-link aipkit-show-more-details-btn">${t("Show more","gpt3-ai-content-generator")}...</button>`),f.innerHTML=w;let h=r.insertCell(),b=[],y=s.last_reset||{},S=g.last_reset||0,I=t("N/A","gpt3-ai-content-generator");if(g.used>0){let M=S>0?new Date(S*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):I;b.push(`<li><strong>${o(k)}:</strong> ${M}</li>`)}let x=new Set([...Object.keys(s.tokens_used||{}),...Object.keys(s.last_reset||{})]);x.size>0&&Array.from(x).sort((T,P)=>T-P).forEach(T=>{if((s.tokens_used||{})[T]>0){let P=n[T]||`Bot #${T}`,C=(s.last_reset||{})[T]||0,v=C>0?new Date(C*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):I;b.push(`<li><strong>${o(P)}:</strong> ${v}</li>`)}});let q='<ul class="aipkit_usage_detail_list">';b.length===0?u.length>0?q+=`<li>${I}</li>`:q+="<li>-</li>":b.forEach((T,P)=>{P>=2?q+=T.replace("<li",'<li class="aipkit_usage_detail_extra" style="display: none;"'):q+=T}),q+="</ul>",b.length>2&&(q+=`<button type="button" class="aipkit_btn-as-link aipkit-show-more-details-btn">${t("Show more","gpt3-ai-content-generator")}...</button>`),h.innerHTML=q;let $=r.insertCell();if($.className="aipkit-user-credits-actions-cell",s.purchase_history&&s.purchase_history.length>0){let M=document.createElement("button");M.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit-view-purchase-history-btn",M.title=t("View Purchase History","gpt3-ai-content-generator"),M.innerHTML='<span class="dashicons dashicons-cart"></span>',M.dataset.userId=s.id,M.dataset.userName=s.display_name,M.dataset.history=JSON.stringify(s.purchase_history),$.appendChild(M)}else $.innerHTML="\u2013"})}window.aipkit_renderUserCreditsTable=d})();(function(){"use strict";function d(a,i,n){let e=document.getElementById("aipkit_user_credits_pagination");if(!e)return;e.innerHTML="";let{total_pages:t,total_users:o}=a;if(!t||t<=0||!o||o<=0){o===0&&n!==""?e.innerHTML=`<span class="aipkit_pagination-count">${o.toLocaleString()} user(s) found for search.</span>`:o===0&&(e.innerHTML='<span class="aipkit_pagination-count">No users found.</span>');return}let s=document.createElement("span");if(s.className="aipkit_pagination-count",s.textContent=`${o.toLocaleString()} user(s)`,e.appendChild(s),t>1){let r=document.createElement("span");r.className="aipkit_pagination-links";let c=document.createElement("button");c.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",c.innerHTML="\xAB Previous",c.disabled=i<=1,c.disabled||c.addEventListener("click",_=>{_.preventDefault(),typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(i-1,n):console.error("Pagination: Fetch function not found.")}),r.appendChild(c);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`Page ${i} of ${t}`,r.appendChild(l);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",p.innerHTML="Next \xBB",p.disabled=i>=t,p.disabled||p.addEventListener("click",_=>{_.preventDefault(),typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(i+1,n):console.error("Pagination: Fetch function not found.")}),r.appendChild(p),e.appendChild(r)}}window.aipkit_renderUserCreditsPagination=d})();(function(){"use strict";function d(a,i){let n=document.getElementById("aipkit_user_credits_stats_grid");if(!n)return;let e=n.querySelector("#aipkit_stat_total_users"),t=n.querySelector("#aipkit_stat_total_tokens"),o=n.querySelector("#aipkit_stat_avg_tokens"),s=i?.total_users??0,r=i?.per_page??a.length,c=a.length,l=0;a.forEach(m=>{l+=m.total_used_all_bots||0});let p=c>0?c:1,_=Math.round(l/p);e&&(e.textContent=s.toLocaleString());let f=s>r;t&&(t.textContent=l.toLocaleString()+(f?"*":"")),o&&(o.textContent=_.toLocaleString()+(f?"*":""));let u=n.querySelector(".aipkit_stats_note");f?(u||(u=document.createElement("p"),u.className="aipkit_form-help aipkit_stats_note",u.style.gridColumn="1 / -1",u.style.textAlign="center",u.style.marginTop="-10px",u.style.marginBottom="10px",n.appendChild(u)),u.textContent="* Token stats based on currently displayed users."):u&&u.remove()}window.aipkit_updateUserCreditsStats=d})();(function(){"use strict";let d=1,a="",i={};function n(e=1,t=""){if(typeof window.aipkit_renderUserCreditsTable!="function"||typeof window.aipkit_renderUserCreditsPagination!="function"||typeof window.aipkit_updateUserCreditsStats!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit User Credits Fetch: Missing required render, pagination, stats, or API functions.");return}let o=document.getElementById("aipkit_user_credits_table_body"),s=document.getElementById("aipkit_user_credits_pagination"),r=document.querySelector("#aipkit_user_credits_table tfoot"),c=document.getElementById("aipkit_user_credits_no_results"),l=document.getElementById("aipkit_user_credits_stats_grid"),p=window.aipkit_dashboard?.text||{},_=p.userCreditsLoading||"Loading user credits...";if(o&&(o.innerHTML=`<tr><td colspan="6" style="text-align: center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> ${_}</td></tr>`),c&&(c.style.display="none"),s&&(s.innerHTML=""),r&&(r.style.display="none"),l){l.querySelectorAll(".aipkit_stat-value").forEach(m=>m.textContent="-");let u=l.querySelector(".aipkit_stats_note");u&&u.remove()}d=e,a=t;let f={page:e,search:t};window.aipkit_apiRequest("aipkit_get_user_credits_data",f).then(u=>{i=u.bot_titles||{},o&&window.aipkit_renderUserCreditsTable(u.users_data||[],p,i),s&&r&&(window.aipkit_renderUserCreditsPagination(u.pagination||{},d,a),r.style.display=u.pagination&&u.pagination.total_pages>1?"":"table-footer-group"),c&&(c.style.display=!u.users_data||u.users_data.length===0?"block":"none",c.textContent=p.userCreditsNoUsers||"No user token data found."),window.aipkit_updateUserCreditsStats(u.users_data||[],u.pagination||{})}).catch(u=>{console.error("AIPKit User Credits: Error fetching data:",u);let m=u?.message||p.userCreditsError||"Error loading user credits.",g=(p.userCreditsError||"Error loading user credits.")+` (${m})`;o&&(o.innerHTML=`<tr><td colspan="6" style="text-align: center; padding: 20px; color: red;">${g}</td></tr>`),c&&(c.textContent=g,c.style.display="block")})}window.aipkit_fetchUserCreditsData=n,window.aipkit_getCurrentCreditsPage=()=>d,window.aipkit_getCurrentCreditsSearch=()=>a})();(function(){"use strict";let d;function a(){let i=document.getElementById("aipkit_user_search"),n=document.getElementById("aipkit_user_search_btn"),e=document.getElementById("aipkit_user_reset_search_btn");if(!i||!n||!e){console.warn("AIPKit User Credits Search: Missing search elements.");return}let t=()=>{clearTimeout(d);let o=i.value.trim();d=setTimeout(()=>{typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,o),e.style.display=o?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")},350)};n.addEventListener("click",()=>{clearTimeout(d);let o=i.value.trim();typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,o),e.style.display=o?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")}),i.addEventListener("input",t),i.addEventListener("keypress",o=>{if(o.key==="Enter"){clearTimeout(d),o.preventDefault();let s=i.value.trim();typeof window.aipkit_fetchUserCreditsData=="function"?(window.aipkit_fetchUserCreditsData(1,s),e.style.display=s?"inline-block":"none"):console.error("Credits Search: Fetch function not found.")}}),e.addEventListener("click",()=>{clearTimeout(d),i.value="",typeof window.aipkit_fetchUserCreditsData=="function"?window.aipkit_fetchUserCreditsData(1,""):console.error("Credits Search: Fetch function not found."),e.style.display="none"}),e.style.display=i.value.trim()?"inline-block":"none"}window.aipkit_initUserCreditsSearch=a})();(function(){"use strict";let d;function a(t,o,s){if(!t||t.length===0)return`<p>${o("No purchase history found for this user.","gpt3-ai-content-generator")}</p>`;let r="";return t.forEach(c=>{let p=new Date(c.date.date).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}),_=(c.products||[]).map(f=>`
        <div class="aipkit_purchase_product">
          <span class="aipkit_product_name">${s(f.name)}</span>
          <span class="aipkit_product_details">
            ${f.quantity>1?`${f.quantity}x `:""}
            ${parseInt(f.tokens_per_item,10).toLocaleString()} tokens = 
            ${parseInt(f.total_tokens,10).toLocaleString()} tokens
          </span>
        </div>
      `).join("");r+=`
        <div class="aipkit_purchase_item">
          <div class="aipkit_purchase_header">
            <div class="aipkit_purchase_date"><strong>${p}</strong></div>
            <div class="aipkit_purchase_summary_info">
              <span class="aipkit_purchase_tokens">+${parseInt(c.tokens_granted,10).toLocaleString()} ${o("tokens","gpt3-ai-content-generator")}</span>
              <span class="aipkit_purchase_amount">${c.total_amount} ${c.currency}</span>
            </div>
          </div>
          <div class="aipkit_purchase_details">
            <div class="aipkit_purchase_order_info">
              <span class="aipkit_purchase_order_id">${o("Order #","gpt3-ai-content-generator")}${c.order_id}</span>
            </div>
            ${_?`<div class="aipkit_purchase_products">${_}</div>`:""}
          </div>
        </div>
      `}),r}function i(t){let o=JSON.parse(t.dataset.history),s=t.dataset.userName,r=wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u,c=window.aipkit_escapeHtml||(u=>u||""),l=document.createElement("div");l.className="aipkit-modal-overlay aipkit-active";let p=a(o,r,c),_=`
          <div class="aipkit-modal-content aipkit_purchase_history_modal_content">
              <div class="aipkit-modal-header">
                  <h3 class="aipkit-modal-title">${c(r("Purchase History for","gpt3-ai-content-generator"))} ${c(s)}</h3>
                  <button class="aipkit-modal-close-btn">\xD7</button>
              </div>
              <div class="aipkit-modal-body">
                  <div class="aipkit_purchase_history_list">${p}</div>
              </div>
          </div>
      `;l.innerHTML=_,document.body.appendChild(l);let f=()=>{l.classList.remove("aipkit-active"),setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},200)};l.querySelector(".aipkit-modal-close-btn").addEventListener("click",f),l.addEventListener("click",u=>{u.target===l&&f()})}function n(t){let o=t.target,s=o.dataset.userId,r=o.parentElement.querySelector(".aipkit_user_credits_balance_status"),c=o.dataset.originalValue||o.defaultValue,l=o.value;if(l===c)return;r&&(r.innerHTML='<span class="aipkit_spinner" style="display:inline-block; width:14px; height:14px; border-width:2px; vertical-align:middle;"></span>');let p=document.getElementById("aipkit_user_credits_nonce_field")?.value;if(!p){console.error("User Credits Actions: Nonce field not found."),r&&(r.innerHTML="\u274C");return}let _={_ajax_nonce:p,user_id:s,balance:l};clearTimeout(d),d=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",_).then(f=>{r&&(r.innerHTML="\u2714",o.dataset.originalValue=f.new_balance),setTimeout(()=>{r&&(r.innerHTML="")},2e3)}).catch(f=>{console.error("Error updating token balance:",f),r&&(r.innerHTML="\u274C",o.value=c,setTimeout(()=>{r&&(r.innerHTML="")},4e3))})},500)}function e(){let t=document.getElementById("aipkit_refresh_credits_btn"),o=document.getElementById("aipkit_user_credits_table_body");if(t&&t.addEventListener("click",()=>{if(typeof window.aipkit_fetchUserCreditsData=="function"&&typeof window.aipkit_getCurrentCreditsPage=="function"&&typeof window.aipkit_getCurrentCreditsSearch=="function"){let s=window.aipkit_getCurrentCreditsPage(),r=window.aipkit_getCurrentCreditsSearch();window.aipkit_fetchUserCreditsData(s,r)}else console.error("Credits Actions: Fetch or state getter function not found for refresh.")}),o){let s="data-credits-action-listener-attached";o.getAttribute(s)||(o.addEventListener("change",r=>{r.target.matches(".aipkit_user_credits_balance_input")&&n(r)}),o.addEventListener("keypress",r=>{r.key==="Enter"&&r.target.matches(".aipkit_user_credits_balance_input")&&(r.preventDefault(),r.target.blur())}),o.addEventListener("click",r=>{let c=r.target.closest(".aipkit-show-more-details-btn"),l=r.target.closest(".aipkit-view-purchase-history-btn");if(c){r.preventDefault();let p=wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f,_=c.closest("td");if(_){let f=_.querySelectorAll(".aipkit_usage_detail_extra");if(f.length>0){let u=f[0].style.display==="none";f.forEach(m=>{m.style.display=u?"list-item":"none"}),c.textContent=u?p("Show less","gpt3-ai-content-generator"):p("Show more","gpt3-ai-content-generator")+"..."}}}else l&&(r.preventDefault(),i(l))}),o.setAttribute(s,"true"))}else console.warn("AIPKit Credits Actions: Table body not found for attaching delegated listeners.")}window.aipkit_initUserCreditsActions=e})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_token_usage_shortcode_configurator"),n=document.getElementById("aipkit_token_usage_shortcode_snippet");if(!i||!n)return;let e=i.querySelector('input[name="cfg_show_chatbot"]').checked,t=i.querySelector('input[name="cfg_show_aiforms"]').checked,o=i.querySelector('input[name="cfg_show_imagegenerator"]').checked,s=[];e||s.push('chatbot="false"'),t||s.push('aiforms="false"'),o||s.push('imagegenerator="false"');let r="[aipkit_token_usage";s.length>0&&(r+=" "+s.join(" ")),r+="]",n.textContent=r}function a(){let i=document.querySelector(".aipkit_user_credits_shortcode_config_wrapper");if(!i)return;let n=i.querySelector("#aipkit_token_usage_shortcode_settings_toggle"),e=i.querySelector("#aipkit_token_usage_shortcode_configurator"),t=i.querySelector("#aipkit_token_usage_shortcode_snippet"),o=e.querySelectorAll(".aipkit_config_input");if(!n||!e||!t||!o.length){console.warn("User Credits Shortcode Config: Missing one or more UI elements.");return}n.dataset.listenerAttached!=="true"&&(n.addEventListener("click",s=>{s.stopPropagation();let r=e.style.display==="none"||!e.style.display;e.style.display=r?"block":"none",n.classList.toggle("aipkit_active",r),n.setAttribute("aria-expanded",r)}),document.addEventListener("click",s=>{i.contains(s.target)||(e.style.display="none",n.classList.remove("aipkit_active"),n.setAttribute("aria-expanded","false"))}),o.forEach(s=>{s.addEventListener("change",d)}),t.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(t.textContent,t):console.error("aipkit_copyShortcode function not found.")}),d(),n.dataset.listenerAttached="true")}window.aipkit_initUserCreditsShortcodeConfig=a})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_token_usage_chart_container_credits");if(!a)return;if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit User Credits Chart: Missing required API or render functions."),a.innerHTML='<p style="color:red">Error: Chart components failed to load.</p>';return}let i=a.querySelector(".aipkit_chart_loading_placeholder"),n=a.querySelector(".aipkit_chart_error_placeholder"),e=a.querySelector(".aipkit_chart_nodata_placeholder");n&&(n.style.display="none"),e&&(e.style.display="none"),i&&(i.style.display="flex"),window.aipkit_apiRequest("aipkit_get_token_usage_chart_data").then(t=>{if(i&&(i.style.display="none"),t&&t.daily_token_data){let o=t.daily_token_data;Object.values(o).some(r=>Object.values(r).reduce((c,l)=>c+l,0)>0)?window.aipkit_renderTokenUsageChart(a,o):e&&(e.style.display="flex",e.textContent=window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.")}else throw new Error("Invalid data received for chart.")}).catch(t=>{console.error("AIPKit User Credits Chart: Error loading data:",t),i&&(i.style.display="none"),n&&(n.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,n.style.display="flex")})}window.aipkit_loadUserCreditsChart=d})();(function(){"use strict";function d(){if(typeof window.aipkit_fetchUserCreditsData=="function")window.aipkit_fetchUserCreditsData(1);else{console.error("AIPKit User Credits Init: fetchUserCreditsData function not found.");let a=document.getElementById("aipkit_user_credits_table_body");a&&(a.innerHTML='<tr><td colspan="5" style="color:red;">Error: Could not load user data script.</td></tr>')}typeof window.aipkit_initUserCreditsSearch=="function"?window.aipkit_initUserCreditsSearch():console.error("AIPKit User Credits Init: initUserCreditsSearch function not found."),typeof window.aipkit_initUserCreditsActions=="function"?window.aipkit_initUserCreditsActions():console.error("AIPKit User Credits Init: initUserCreditsActions function not found."),typeof window.aipkit_initUserCreditsShortcodeConfig=="function"?window.aipkit_initUserCreditsShortcodeConfig():console.error("AIPKit User Credits Init: initUserCreditsShortcodeConfig function not found."),typeof window.aipkit_loadUserCreditsChart=="function"?window.aipkit_loadUserCreditsChart():console.error("AIPKit User Credits Init: aipkit_loadUserCreditsChart function not found.")}window.aipkit_initUserCredits=d})();(function(){"use strict";let d=!1;function a(){let i=document.getElementById("aipkit_role_manager_container");if(!i){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let n=i.querySelector("#aipkit_save_roles_btn"),e=i.querySelector("#aipkit_role_manager_form"),t=i.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),t&&(t.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let o=window.aipkit_role_manager_config,s=o.text||{};if(!n||!e||!t){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let r="data-role-save-listener";n.getAttribute(r)||(n.addEventListener("click",function(c){if(c.preventDefault(),d)return;d=!0;let l=n.querySelector(".aipkit_btn-text"),p=n.querySelector(".aipkit_spinner");n.disabled=!0,p&&(p.style.display="inline-block"),l&&(l.textContent=s.saving||"Saving..."),t.innerHTML="",t.className="aipkit_settings_messages";let _=new FormData(e);_.append("action","aipkit_save_role_permissions"),fetch(o.ajaxurl,{method:"POST",body:_,credentials:"same-origin"}).then(f=>f.ok?f.json():f.json().then(u=>{throw new Error(u.data.message||`HTTP error! status: ${f.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${f.status}`)})).then(f=>{if(!f.success){let u=f.data&&f.data.message?f.data.message:"An unknown error occurred.";throw new Error(u)}return f.data}).then(f=>{let u=document.createElement("div");u.className="aipkit_settings_message aipkit_settings_message-success",u.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${f.message||s.success||"Permissions saved!"}`,t.appendChild(u),setTimeout(()=>{u.remove()},4e3)}).catch(f=>{console.error("AIPKit Role Manager Save Error:",f);let u=document.createElement("div");u.className="aipkit_settings_message aipkit_settings_message-error",u.innerHTML=`<span class="dashicons dashicons-warning"></span> ${f.message||s.fail||"Failed to save permissions."}`,t.appendChild(u),setTimeout(()=>{u.remove()},6e3)}).finally(()=>{d=!1,n.disabled=!1,p&&(p.style.display="none"),l&&(l.textContent=s.saveButton||"Save Permissions")})}),n.setAttribute(r,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&a()}),window.aipkit_initRoleManager=a})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a){console.warn("AIPKit Chat AI Settings Toggle: Main content container not found.");return}let i="data-cb-ai-settings-toggle-listener-attached";a.getAttribute(i)||(a.addEventListener("click",function(n){let e=n.target.closest(".aipkit_cb_ai_settings_toggle");if(!e)return;let t=e.closest(".aipkit_accordion-content");if(!t)return;let o=t.querySelector(".aipkit_cb_ai_parameters_row");if(!o)return;let s=o.style.display==="none";o.style.display=s?"block":"none",e.classList.toggle("aipkit_active",s),e.setAttribute("aria-expanded",s)}),a.setAttribute(i,"true"))}window.aipkit_initChatAiSettingsToggle=d})();(function(){"use strict";function d(i){let n=i.querySelector(".aipkit_cb_web_search_toggle");if(!n||n.style.display==="none")return;let e=i.querySelector(".aipkit_chatbot_provider_select")?.value,t;e==="OpenAI"?t=i.querySelector(".aipkit_openai_web_search_enable_toggle"):e==="Google"&&(t=i.querySelector(".aipkit_google_search_grounding_enable_toggle")),t&&n.classList.toggle("aipkit_active",t.checked)}function a(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-websearch-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_web_search_toggle");if(!t)return;let o=t.closest(".aipkit_chatbot-settings-area");if(!o)return;let s=o.querySelector(".aipkit_chatbot_provider_select")?.value,r;if(s==="OpenAI")r=o.querySelector(".aipkit_openai_web_search_enable_toggle");else if(s==="Google")r=o.querySelector(".aipkit_google_search_grounding_enable_toggle");else return;r&&(r.checked=!r.checked,t.classList.toggle("aipkit_active",r.checked),r.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"))}window.aipkit_initWebSearchToggle=a,window.aipkit_setInitialWebSearchToggleState=d})();(function(){"use strict";function d(i){let n=i.querySelector(".aipkit_cb_stream_mode_toggle");if(!n)return;let e=i.querySelector(".aipkit_stream_enable_toggle");if(e){let t=e.checked;n.classList.toggle("aipkit_active",t),n.setAttribute("aria-pressed",t)}}function a(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-stream-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_stream_mode_toggle");if(!t)return;let o=t.closest(".aipkit_chatbot-settings-area");if(!o)return;let s=o.querySelector(".aipkit_stream_enable_toggle");s&&(s.checked=!s.checked,t.classList.toggle("aipkit_active",s.checked),t.setAttribute("aria-pressed",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"))}window.aipkit_initStreamModeToggle=a,window.aipkit_setInitialStreamToggleState=d})();(function(){"use strict";function d(i){let n=i.querySelector(".aipkit_cb_stateful_conv_toggle");if(!n)return;let e=i.querySelector(".aipkit_openai_conversation_state_enable_toggle");if(e){let t=e.checked;n.classList.toggle("aipkit_active",t),n.setAttribute("aria-pressed",t)}}function a(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-stateful-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_stateful_conv_toggle");if(!t)return;let o=t.closest(".aipkit_chatbot-settings-area");if(!o)return;let s=o.querySelector(".aipkit_openai_conversation_state_enable_toggle");s&&(s.checked=!s.checked,t.classList.toggle("aipkit_active",s.checked),t.setAttribute("aria-pressed",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"))}window.aipkit_initStatefulConvToggle=a,window.aipkit_setInitialStatefulConvState=d})();(function(){"use strict";function d(i){let n=i.querySelector(".aipkit_cb_image_upload_toggle");if(!n)return;let e=i.querySelector(".aipkit_image_upload_enable_toggle");if(e){let t=e.checked;n.classList.toggle("aipkit_active",t),n.setAttribute("aria-pressed",t)}}function a(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-image-upload-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_image_upload_toggle");if(!t)return;let o=t.closest(".aipkit_chatbot-settings-area");if(!o)return;let s=o.querySelector(".aipkit_image_upload_enable_toggle");s&&(s.checked=!s.checked,t.classList.toggle("aipkit_active",s.checked),t.setAttribute("aria-pressed",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"))}window.aipkit_initImageUploadToggle=a,window.aipkit_setInitialImageUploadToggleState=d})();(function(){"use strict";function d(i){let n=i.querySelector(".aipkit_cb_voice_input_toggle");if(!n)return;let e=i.querySelector(".aipkit_voice_input_enable_toggle");if(e){let t=e.checked;n.classList.toggle("aipkit_active",t),n.setAttribute("aria-pressed",t)}}function a(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let n="data-voice-input-toggle-listener";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_cb_voice_input_toggle");if(!t)return;let o=t.closest(".aipkit_chatbot-settings-area");if(!o)return;let s=o.querySelector(".aipkit_voice_input_enable_toggle");s&&(s.checked=!s.checked,t.classList.toggle("aipkit_active",s.checked),t.setAttribute("aria-pressed",s.checked),s.dispatchEvent(new Event("change",{bubbles:!0})))}),i.setAttribute(n,"true"))}window.aipkit_initVoiceInputToggle=a,window.aipkit_setInitialVoiceInputToggleState=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}typeof window.aipkit_initChatAiSettingsToggle=="function"?window.aipkit_initChatAiSettingsToggle():console.error("AIPKit Chat Fields: aipkit_initChatAiSettingsToggle function not found."),typeof window.aipkit_initWebSearchToggle=="function"?window.aipkit_initWebSearchToggle():console.error("AIPKit Chat Fields: aipkit_initWebSearchToggle function not found."),typeof window.aipkit_initStreamModeToggle=="function"?window.aipkit_initStreamModeToggle():console.error("AIPKit Chat Fields: aipkit_initStreamModeToggle function not found."),typeof window.aipkit_initStatefulConvToggle=="function"?window.aipkit_initStatefulConvToggle():console.error("AIPKit Chat Fields: aipkit_initStatefulConvToggle function not found."),typeof window.aipkit_initImageUploadToggle=="function"?window.aipkit_initImageUploadToggle():console.error("AIPKit Chat Fields: aipkit_initImageUploadToggle function not found."),typeof window.aipkit_initVoiceInputToggle=="function"?window.aipkit_initVoiceInputToggle():console.error("AIPKit Chat Fields: aipkit_initVoiceInputToggle function not found."),a.addEventListener("change",function(n){let e=n.target,t=e.closest(".aipkit_chatbot-settings-area");if(!t)return;if(e.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(t),window.aipkit_toggleOpenAISpecificSettingsVisibility(t),window.aipkit_toggleGoogleSpecificSettingsVisibility(t);return}if(e.matches('select[name$="_model"]')||e.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(t);return}let o=e.closest(".aipkit_stt_provider_select");if(o){let u=o.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u?window.aipkit_toggleSttModelFields(u):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",o);return}let s=e.closest(".aipkit_vector_store_toggle_switch");if(s){let u=s.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&(window.aipkit_toggleVectorStoreSettingsVisibility(u),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(u));return}let r=e.closest(".aipkit_vector_store_provider_select");if(r){let u=r.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_toggleVectorStoreProviderFields(u);return}let c=e.closest(".aipkit_vector_embedding_provider_select");if(c){let u=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_populateVectorEmbeddingModelSelect(u);return}let l=e.closest(".aipkit_openai_web_search_enable_toggle");if(l){let u=l.closest(".aipkit_chatbot-settings-area");u&&window.aipkit_toggleOpenAIWebSearchSubSettings(u);return}let p=e.closest(".aipkit_openai_web_search_loc_type_select");if(p){let u=p.closest(".aipkit_chatbot-settings-area");u&&window.aipkit_toggleOpenAIWebSearchLocationDetails(u);return}let _=e.closest(".aipkit_google_search_grounding_enable_toggle");if(_){let u=_.closest(".aipkit_chatbot-settings-area");u&&window.aipkit_toggleGoogleSearchGroundingSubSettings(u);return}let f=e.closest(".aipkit_google_grounding_mode_select");if(f){let u=f.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");u&&window.aipkit_toggleGoogleGroundingDynamicThreshold(u);return}}),a.querySelectorAll(".aipkit_chatbot-settings-area").forEach(n=>{n.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(n),window.aipkit_toggleOpenAISpecificSettingsVisibility(n),window.aipkit_toggleGoogleSpecificSettingsVisibility(n)),n.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(n),n.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(n),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(n))})}window.aipkit_initProviderSelectToggles=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_chatbot_provider_select");if(!i)return;let n=i.value;a.querySelectorAll(".aipkit_chatbot_model_field").forEach(o=>{o.style.display="none";let s=o.querySelector(".aipkit_cb_web_search_toggle");s&&(s.style.display="none");let r=o.querySelector(".aipkit_cb_stateful_conv_toggle");r&&(r.style.display="none");let c=o.querySelector(".aipkit_cb_image_upload_toggle");c&&(c.style.display="none");let l=o.querySelector(".aipkit_cb_voice_input_toggle");l&&(l.style.display="none")});let t=a.querySelector(`.aipkit_chatbot_model_field[data-provider="${n}"]`);if(t){t.style.display="block",typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(a),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(a);let o=t.querySelector(".aipkit_cb_web_search_toggle");o&&(o.dataset.provider||"").split(" ").includes(n)&&(o.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(a));let s=t.querySelector(".aipkit_cb_stateful_conv_toggle");s&&n==="OpenAI"&&(s.style.display="inline-flex");let r=t.querySelector(".aipkit_cb_image_upload_toggle");r&&(n==="OpenAI"?(r.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(a)):r.style.display="none");let c=t.querySelector(".aipkit_cb_voice_input_toggle");c&&(c.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(a)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(a)}}window.aipkit_toggleChatbotModelFields=d})();(function(){"use strict";function d(a){a&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(a)}window.aipkit_toggleOpenAISpecificSettingsVisibility=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_chatbot_provider_select"),n=i?i.value==="OpenAI":!1,e=a.querySelector(".aipkit_openai_web_search_enable_toggle"),t=a.querySelector(".aipkit_openai_web_search_conditional_settings");if(!e||!t)return;let o=e.checked;if(t.style.display=n&&o?"block":"none",n&&o)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(a);else{let s=a.querySelector(".aipkit_openai_web_search_location_details");s&&(s.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_openai_web_search_enable_toggle"),n=a.querySelector(".aipkit_openai_web_search_loc_type_select"),e=a.querySelector(".aipkit_openai_web_search_location_details");if(!i||!n||!e){e&&(e.style.display="none");return}let t=i.checked,o=n.value==="approximate";e.style.display=t&&o?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=d})();(function(){"use strict";function d(a){a&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(a)}window.aipkit_toggleGoogleSpecificSettingsVisibility=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_chatbot_provider_select"),n=i?i.value==="Google":!1,e=a.querySelector(".aipkit_google_search_grounding_enable_toggle"),t=a.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!e||!t)return;let o=e.checked,s=n&&o;t.style.display=s?"block":"none",s?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(a):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(a,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=d})();(function(){"use strict";function d(a,i=null){if(!a)return;let n=a.querySelector(".aipkit_google_grounding_mode_select"),e=a.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),t=a.querySelector(".aipkit_google_search_grounding_enable_toggle"),o=a.querySelector(".aipkit_google_search_grounding_conditional_settings"),s=o&&o.style.display==="none";if(!n||!e||!t){e&&(e.style.display="none");return}if(s){e.style.display="none";return}let r=i!==null?i:t.checked&&n.value==="MODE_DYNAMIC";e.style.display=r?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_stt_provider_select");if(!i)return;let n=i.value;a.querySelectorAll(".aipkit_stt_model_field").forEach(t=>{t.style.display=t.getAttribute("data-stt-provider")===n?"block":"none"})}window.aipkit_toggleSttModelFields=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_vector_store_toggle_switch"),n=a.querySelector(".aipkit_vector_store_settings_conditional_row"),e=a.querySelector(".aipkit_vector_store_top_k_field");if(!i||!n)return;let t=i.checked;n.style.display=t?"block":"none",e&&(e.style.display=t?"block":"none"),t?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(a):a.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_embedding_config_row").forEach(o=>o.style.display="none")}window.aipkit_toggleVectorStoreSettingsVisibility=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_vector_store_provider_select"),n=a.querySelector(".aipkit_vector_store_toggle_switch");if(!i||!n)return;let e=i.value,t=n.checked,o=a.querySelector(".aipkit_vector_store_openai_field"),s=a.querySelector(".aipkit_vector_store_pinecone_field"),r=a.querySelector(".aipkit_vector_store_qdrant_field"),c=a.querySelector(".aipkit_vector_store_embedding_config_row"),l=a.querySelector(".aipkit_vector_store_top_k_field");o&&(o.style.display=t&&e==="openai"?"block":"none"),s&&(s.style.display=t&&e==="pinecone"?"block":"none"),r&&(r.style.display=t&&e==="qdrant"?"block":"none"),c&&(c.style.display=t&&(e==="pinecone"||e==="qdrant")?"block":"none"),l&&(l.style.display=t?"block":"none"),t&&e==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(a):t&&e==="pinecone"&&(typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(a),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(a),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(a))}window.aipkit_toggleVectorStoreProviderFields=d})();(function(){"use strict";function d(a){let i=a.querySelector('select[name="openai_vector_store_ids[]"]'),n=window.aipkit_escapeHtml||function(o){return o};if(!i)return;let e=window.aipkit_chat_config?.openaiVectorStores||[],t=Array.from(i.options).filter(o=>o.selected).map(o=>o.value);i.innerHTML="",e.length>0&&e.forEach(o=>{if(o&&o.id){let s="(Files: N/A)";o.file_counts&&typeof o.file_counts.total=="number"?s=`(${o.file_counts.total} ${o.file_counts.total===1?"File":"Files"})`:o.file_counts&&(s="(Files: ?)");let r=`${n(o.name||o.id)} ${s}`,c=document.createElement("option");c.value=o.id,c.textContent=r+` (ID: ${n(o.id.substring(0,15))}...)`,t.includes(o.id)&&(c.selected=!0),i.appendChild(c)}}),t.forEach(o=>{if(!e.some(r=>r.id===o)&&!i.querySelector(`option[value="${CSS.escape(o)}"]`)){let r=document.createElement("option");r.value=o,r.textContent=`${n(o)} (Manual/Not Synced)`,r.selected=!0,i.appendChild(r)}}),i.options.length===0&&(i.innerHTML='<option value="" disabled>-- No Stores Found (Sync in AI Training) --</option>')}window.aipkit_populateOpenAIVectorStoresMultiSelect=d})();(function(){"use strict";function d(a){let i=a.querySelector('select[name="pinecone_index_name"]'),n=window.aipkit_escapeHtml||function(o){return o};if(!i)return;let e=window.aipkit_chat_config?.pineconeIndexes||[],t=i.value;if(i.innerHTML="",i.appendChild(new Option(n("-- Select Index --"),"")),e.length>0&&e.forEach(o=>{let s=o.name||o.id||"",r=o.name||s,c=o.total_vector_count!==void 0&&o.total_vector_count!==null&&o.total_vector_count!=="Error"&&o.total_vector_count!=="No Host"?` (Vectors: ${Number(o.total_vector_count).toLocaleString()})`:(o.total_vector_count||"")==="Error"||(o.total_vector_count||"")==="No Host"?" (Stats Err)":" (Vectors: ?)",l=n(r+c),p=new Option(l,s);s===t&&(p.selected=!0),i.appendChild(p)}),t&&!i.querySelector(`option[value="${CSS.escape(t)}"]`)){let o=new Option(n(t)+" (Manual/Not Synced)",t,!1,!0);i.appendChild(o),i.value=t}i.options.length<=1&&(i.innerHTML='<option value="" disabled>-- No Indexes Found (Sync in AI Settings) --</option>')}window.aipkit_populatePineconeIndexSelect=d})();(function(){"use strict";function d(a){let i=a.querySelector('select[name="vector_embedding_provider"]');i&&(i.value===""&&(i.value="openai"),i.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=d})();(function(){"use strict";function d(a){let i=a.querySelector('select[name="vector_embedding_provider"]'),n=a.querySelector('select[name="vector_embedding_model"]'),e=window.aipkit_escapeHtml||function(r){return r};if(!i||!n)return;let t=i.value,o=n.value;n.innerHTML="",n.appendChild(new Option(e("-- Select Model --"),""));let s=[];if(t==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?s=window.aipkit_chat_config.openaiEmbeddingModels:t==="google"&&window.aipkit_chat_config?.googleEmbeddingModels&&(s=window.aipkit_chat_config.googleEmbeddingModels),s.length>0&&s.forEach(r=>{if(r&&r.id){let c=new Option(e(r.name||r.id),r.id);r.id===o&&(c.selected=!0),n.appendChild(c)}}),o&&!n.querySelector(`option[value="${CSS.escape(o)}"]`)){let r=new Option(e(o)+" (Manual/Not Synced)",o,!1,!0);n.appendChild(r),n.value=o}n.options.length<=1&&(n.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_vector_store_toggle_switch"),n=a.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),e=a.querySelector(".aipkit_file_upload_field_group");if(!i||!n||!e)return;let t=i.checked,o=n.dataset.isProPlan==="true",s=n.dataset.addonActive==="true",c=o&&s&&t,l="";o?s?t||(l='File upload requires "Enable Vector Store" to be active for this bot.'):l='The "File Upload" addon is not active. Please activate it in Add-ons.':l="File upload is a Pro feature. Please upgrade.",c?(n.disabled=!1,e.style.opacity="1",e.removeAttribute("title")):(n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change",{bubbles:!0}))),n.disabled=!0,e.style.opacity="0.5",e.setAttribute("title",l))}window.aipkit_toggleFileUploadAvailability=d})();(function(){"use strict";function d(i){if(!i)return;let n=i.querySelector('select[name="theme"]'),e=i.querySelector(".aipkit_custom_theme_settings_container");!n||!e||(e.style.display=n.value==="custom"?"block":"none")}function a(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit Theme Toggle: Main content container not found.");return}i.dataset.themeSettingsListenerAttached||(i.addEventListener("click",function(n){n.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(n):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),i.addEventListener("change",function(n){let e=n.target;if(e.matches&&e.matches('select[name="theme"]')){let t=e.closest(".aipkit_chatbot-settings-area");t&&d(t)}}),i.dataset.themeSettingsListenerAttached="true"),i.querySelectorAll(".aipkit_chatbot-settings-area").forEach(n=>{d(n)})}window.aipkit_initChatThemeSettingsToggle=a})();(function(){"use strict";function d(a){let i=a.target.closest(".aipkit_reset_custom_theme_btn");if(!i)return;let n=i.dataset.botId,e=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!e){console.error("AIPKit Theme Reset: Main content container not found for bot",n);return}let t=e.querySelector(`#aipkit_bot_${n}_custom_theme_settings_container`),o=e.querySelector(`#aipkit_reset_theme_status_${n}`);if(!t||!o){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",n);return}let s=t.dataset.defaults;if(!s){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(o,"error","Error: Defaults not found.",2e3);return}try{let r=JSON.parse(s);t.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(l=>{let _=l.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(_&&_[1]){let f=_[1];if(Object.prototype.hasOwnProperty.call(r,f)){l.value=r[f]!==null?String(r[f]):"";let u=new Event("change",{bubbles:!0,cancelable:!0});l.dispatchEvent(u)}else if(Object.prototype.hasOwnProperty.call(r,f+"_placeholder")){l.value=r[f+"_placeholder"]!==null?String(r[f+"_placeholder"]):"";let u=new Event("change",{bubbles:!0,cancelable:!0});l.dispatchEvent(u)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(o,"success","\u2714 Reverted.",2e3)}catch(r){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",r),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(o,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector(".aipkit_chatbot_provider_select"),n=a.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select'),e=a.querySelector(".aipkit_reasoning_effort_field");if(!i||!n||!e){e&&(e.style.display="none");return}let t=i.value,s=(n.value||"").toLowerCase(),r=s.startsWith("o1")||s.startsWith("o3")||s.startsWith("o4"),c=s.includes("gpt-5");t==="OpenAI"&&(r||c)?e.style.display="block":e.style.display="none"}window.aipkit_toggleReasoningEffort=d})();(function(){"use strict";function d(i,n,e){let t=document.getElementById(i);if(!t)return;if(t.innerHTML="",!n||n.length===0){t.appendChild(new Option("(No voices found - Sync again)",""));return}t.appendChild(new Option("-- Select Voice --",""));let o={};n.forEach(r=>{let c=r.languageCodes[0]||"und";o[c]||(o[c]=[]),o[c].push(r)}),Object.keys(o).sort().forEach(r=>{let c=document.createElement("optgroup");try{let l=new Intl.DisplayNames(["en"],{type:"language"}).of(r.split("-")[0]);c.label=`${l} (${r})`}catch{c.label=r}o[r].sort((l,p)=>l.name.localeCompare(p.name)),o[r].forEach(l=>{let p=new Option(l.name,l.id);l.id===e&&(p.selected=!0),c.appendChild(p)}),t.appendChild(c)}),e&&!t.value&&(Array.from(t.options).some(c=>c.value===e)?t.value=e:console.warn(`AIPKit TTS: Saved Google voice ID "${e}" not found in synced list for ${i}.`))}function a(i){let n=i.getAttribute("data-target-select"),e=i.querySelector(".aipkit_spinner"),t=i.closest(".aipkit_form-group"),o=t?t.querySelector(".aipkit_form-help"):null;if(!n){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(o||console.error("AIPKit TTS Sync (Google): Could not find message container (.aipkit_form-help) for button:",i),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_setButtonText!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}i.disabled=!0,e&&(e.style.display="inline-block"),window.aipkit_setButtonText(i,"Syncing..."),o&&(o.textContent="",o.className="aipkit_form-help"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(r=>{if(r&&r.voices){let c=document.getElementById(n),l=c?c.value:"";d(n,r.voices,l);let p=document.getElementById("aipkit_google_tts_voices_json_main");p&&(p.dataset.voices=JSON.stringify(r.voices)),o&&window.aipkit_showTemporaryMessage(o,"success",r.message||"Sync successful!")}else throw new Error("Invalid response received from voice sync.")}).catch(r=>{console.error("AIPKit TTS Sync Error (Google):",r),o&&window.aipkit_showTemporaryMessage(o,"error",`Sync failed: ${r.message||"Unknown error"}`)}).finally(()=>{i.disabled=!1,e&&(e.style.display="none"),window.aipkit_setButtonText(i,"Sync Voices")})}window.aipkit_updateGoogleVoiceSelect=d,window.aipkit_handleSyncGoogleVoices=a})();(function(){"use strict";function d(i,n,e){let t=document.getElementById(i);if(!t){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${i} not found.`);return}if(t.innerHTML="",!n||n.length===0){if(t.appendChild(new Option("(No voices found - Sync in Main Settings)","")),e){let s=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(s),t.value=e}return}t.appendChild(new Option("-- Select Voice --","")),n.sort((s,r)=>(s.name||s.id||"").localeCompare(r.name||r.id||""));let o=!1;if(n.forEach(s=>{let r=new Option(s.name,s.id);s.id===e&&(r.selected=!0,o=!0),t.appendChild(r)}),e&&!o){let s=!1;for(let r=0;r<t.options.length;r++)if(t.options[r].value===e){s=!0,t.value=e;break}if(!s){let r=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(r),t.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${e}" not found in synced list for #${i}, added as manual.`)}}else!e&&t.options.length>0&&(t.value="")}function a(i,n,e){let t=document.getElementById(i);if(!t){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${i} not found.`);return}if(t.innerHTML="",!n||n.length===0){if(t.appendChild(new Option("(No models found - Sync in Main Settings)","")),e){let s=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(s),t.value=e}return}t.appendChild(new Option("-- Select Model --","")),n.sort((s,r)=>(s.name||s.id||"").localeCompare(r.name||r.id||""));let o=!1;if(n.forEach(s=>{let r=s.id||"",c=s.name||r;if(!r)return;let l=new Option(c,r);r===e&&(l.selected=!0,o=!0),t.appendChild(l)}),e&&!o){let s=!1;for(let r=0;r<t.options.length;r++)if(t.options[r].value===e){s=!0,t.value=e;break}if(!s){let r=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(r),t.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${e}" not found in synced list for #${i}, added as manual.`)}}else!e&&t.options.length>0&&(t.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=d,window.aipkit_chatTts_updateElevenLabsModelsSelect=a})();(function(){"use strict";function d(n,e){let t=n.querySelector(".aipkit_tts_conditional_settings"),o=n.querySelector(".aipkit_tts_auto_play_container");t&&(t.style.display=e?"block":"none"),o&&(o.style.display=e?"block":"none")}function a(n){let e=n.querySelector(".aipkit_tts_provider_select");if(!e)return;let t=e.value;n.querySelectorAll(".aipkit_tts_provider_settings").forEach(s=>{if(s.getAttribute("data-provider")===t){if(s.style.display="block",t==="OpenAI"){let r=s.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');r&&(r.style.display="block")}}else s.style.display="none"})}function i(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit TTS Settings: Main content container not found.");return}let e=typeof window.aipkit_updateGoogleVoiceSelect=="function",t=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",o=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",s=typeof window.aipkit_handleSyncGoogleVoices=="function";e||console.error("AIPKit TTS Settings: Google voice update function missing."),t||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),o||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),s||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),n.addEventListener("change",function(c){let l=c.target.closest(".aipkit_tts_toggle_switch"),p=c.target.closest(".aipkit_tts_provider_select");if(l){let _=l.closest(".aipkit_accordion-content");_&&(d(_,l.checked),l.checked&&a(_))}else if(p){let _=p.closest(".aipkit_accordion-content");_&&a(_)}}),n.addEventListener("click",function(c){let l=c.target.closest(".aipkit_sync_tts_voices_btn");l&&l.getAttribute("data-provider")==="Google"&&s&&window.aipkit_handleSyncGoogleVoices(l)}),n.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(c=>{let l=c.querySelector(".aipkit_tts_toggle_switch");l&&(d(c,l.checked),l.checked&&a(c));let p=c.querySelector('select[name="tts_google_voice_id"]');p&&!e&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync in Main Settings)</option>');let _=c.querySelector('select[name="tts_elevenlabs_voice_id"]');if(_&&t){let m="";if(_&&_.id){let w=_.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_voices_json_${m}`):null,k=g?g.dataset.voices:null;try{let w=k?JSON.parse(k):[],h=_.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(_.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",w),_.options.length<=1&&(_.innerHTML='<option value="">(Sync in Main Settings)</option>')}}else _&&_.options.length<=1&&(_.innerHTML='<option value="">(Sync in Main Settings)</option>');let f=c.querySelector('select[name="tts_elevenlabs_model_id"]');if(f&&o){let m="";if(f&&f.id){let w=f.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);w&&w[1]&&(m=w[1])}let g=m?document.getElementById(`aipkit_elevenlabs_models_json_${m}`):null,k=g?g.dataset.models:null;try{let w=k?JSON.parse(k):[],h=f.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(f.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",w),f.options.length<=1&&(f.innerHTML='<option value="">(Sync in Main Settings)</option>')}}else f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync in Main Settings)</option>');let u=c.querySelector('select[name="tts_openai_model_id"]');u&&u.options.length<=1&&(u.innerHTML='<option value="">(Sync models in Main Settings)</option>')})}window.aipkit_initTtsSettingsUI=i})();(function(){"use strict";function d(a,i,n,e){let t=e||function(s){return s},o=`debug-pre-${t(n)}`;return`
            <div class="aipkit_log_debug_info" style="margin-top: 5px; border-top: 1px dashed #eee; padding-top: 4px;">
                <a href="#" class="aipkit_log_debug_toggle" aria-controls="${o}" aria-expanded="false" style="font-size: 0.9em; color: #555; text-decoration: none;">
                    <span class="dashicons dashicons-arrow-right-alt2"></span> ${t(a)}
                </a>
                <div id="${o}" style="display: none; margin-top: 3px; max-height: 150px; overflow: auto; background: #f0f0f0; padding: 5px; border-radius: 3px;">
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px; font-size: 0.85em; max-height: 120px; overflow-y: auto;">${t(i)}</pre>
                </div>
            </div>`}window.aipkit_createExpandableDetail=d})();(function(){"use strict";function d(a,i,n,e){let t=a.trigger_log_details||{},o=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(a.timestamp||null):a.timestamp||"N/A",s=`${a.message_id||"trigger"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,r='<div class="aipkit_single_trigger_log_entry">';if(r+=`<div class="aipkit_message_header">
                        <strong class="aipkit_trigger_log_main_title"><span class="dashicons dashicons-admin-generic"></span>Trigger Event</strong>`,o&&(r+=`<span class="aipkit_message_timestamp">${o}</span>`),r+="</div>",r+=`<div class="aipkit_trigger_log_summary">${e(a.content||"Trigger activity logged.")}</div>`,r+='<div class="aipkit_trigger_log_basic_details">',t.log_subtype!=="trigger_processing_start"&&(r+=`<div><strong>Trigger:</strong> ${e(t.trigger_name||"N/A")} (ID: ${e(t.trigger_id||"N/A")})</div>`),r+=`<div><strong>Processed Event:</strong> ${e(t.event_name_processed||"N/A")}</div>`,t.log_subtype==="trigger_evaluation")r+=`<div><strong>Conditions Met:</strong> ${t.conditions_met?"Yes":"No"}</div>`,t.conditions_summary&&typeof window.aipkit_createExpandableDetail=="function"?r+=window.aipkit_createExpandableDetail("Evaluation Summary",t.conditions_summary,`eval-${s}`,e):t.conditions_summary&&(r+=`<div><strong>Evaluation Summary:</strong> ${e(t.conditions_summary)}</div>`);else if(t.log_subtype==="action_execution_start"){let c=t.action_type?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(t.action_type.replace(/_/g," ")):t.action_type:"N/A";if(r+=`<div><strong>Action Started:</strong> ${e(c)}</div>`,t.action_payload_summary&&typeof window.aipkit_createExpandableDetail=="function"){let l="";typeof t.action_payload_summary=="object"?l=JSON.stringify(t.action_payload_summary,null,2):l=String(t.action_payload_summary),r+=window.aipkit_createExpandableDetail("Payload Summary",l,`payload-${s}`,e)}else t.action_payload_summary&&(r+=`<div><strong>Payload Summary:</strong> <pre>${e(JSON.stringify(t.action_payload_summary,null,2))}</pre></div>`)}else if(t.log_subtype==="action_execution_result"){let c=t.action_type?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(t.action_type.replace(/_/g," ")):t.action_type:"N/A",l=t.status?typeof window.aipkit_ucfirst=="function"?window.aipkit_ucfirst(t.status):t.status:"N/A";r+=`<div><strong>Action Result:</strong> ${e(c)} - <strong>Status:</strong> ${e(l)}</div>`,t.result_summary&&typeof window.aipkit_createExpandableDetail=="function"?r+=window.aipkit_createExpandableDetail("Outcome Details",t.result_summary,`outcome-${s}`,e):t.result_summary&&(r+=`<div><strong>Outcome:</strong> ${e(t.result_summary)}</div>`),t.error_details&&(r+=`<div style="color: red;"><strong>Error Details:</strong> ${e(t.error_details)}</div>`)}else if(t.log_subtype==="form_submission_stored"&&(r+=`<div><strong>Form ID:</strong> ${e(t.form_id||"N/A")}</div>`,t.submitted_data_snapshot&&typeof window.aipkit_createExpandableDetail=="function")){let c="";typeof t.submitted_data_snapshot=="object"?c=JSON.stringify(t.submitted_data_snapshot,null,2):c=String(t.submitted_data_snapshot),r+=window.aipkit_createExpandableDetail("Submitted Form Data",c,`formdata-${s}`,e)}return r+="</div>",r+="</div>",r}window.aipkit_renderTriggerLogEntryHTML=d})();(function(){"use strict";function d(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}function a(i,n,e,t,o,s){let r=o||function(m){return m},c=s||d,l=window.aipkit_chat_config||{},p=l.isProPlan&&l.isTriggersAddonActive,_=null;if(typeof n=="object"&&n!==null&&Array.isArray(n.messages)?_=n.messages:Array.isArray(n)&&(_=n),!_||_.length===0){i.innerHTML=`<p style="text-align:center;padding:20px;font-style:italic;">${t.noLogsFound||"No conversation history found."}</p>`;return}let f=null;window.markdownit&&(f=window.markdownit({html:!1,linkify:!0,typographer:!0}),window.hljs&&typeof window.markdownitHighlight=="function"&&f.use(window.markdownitHighlight,{hljs:window.hljs}));let u="";for(let m=0;m<_.length;m++){let g=_[m],k=g.role==="assistant"||g.role==="model"?"bot":g.role||"unknown",w=g.message_id||"msg-"+Math.random().toString(16).slice(2)+m;if(k==="user"||k==="bot"){let h=g.content||"",b=g.provider||"",y=g.model||"",S=g.timestamp||null,I=g.feedback||null,x=g.usage||null,q=x?x.total_tokens??x.totalTokenCount??null:null,$=k==="bot"&&(g.request_payload||null),M=k==="bot"&&h.toLowerCase().startsWith("error:"),T="";k==="bot"?T=e.bot_name||t.logBotLabel||"Bot":k==="user"?T=e.user_display_name||t.logUserLabel||"User":T=c(k);let P=k==="bot"?"aipkit_message_bot":"aipkit_message_user";M&&(P+=" aipkit_message_error");let C=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(S):S||"",v=f?f.render(h):r(h).replace(/\n/g,"<br>");if(u+=`<div class="aipkit_message ${P}" id="${r(w)}">`,u+=`<div class="aipkit_message_header"><strong>${r(T)}:</strong>`,C&&(u+=`<span class="aipkit_message_timestamp">${C}</span>`),u+="</div>",u+=`<div>${v}</div>`,k==="bot"&&(b||y||q!==null)){let A=[];b&&A.push(`${b}`),y&&A.push(`${y}`),q!==null&&q>0&&A.push(`${Number(q).toLocaleString()} tokens`),A.length>0&&(u+=`<div class="aipkit_bot_model_label">${r(A.join(" / "))}</div>`)}if(I&&(u+=`<span class="dashicons ${I==="up"?"dashicons-thumbs-up":"dashicons-thumbs-down"} aipkit_log_detail_feedback_indicator ${I==="up"?"aipkit_feedback_up":"aipkit_feedback_down"}" title="${r(I==="up"?"Liked":"Disliked")}"></span>`),k==="bot"&&$&&typeof window.aipkit_createExpandableDetail=="function"){let A=`aipkit-debug-${w}`;u+=window.aipkit_createExpandableDetail("Request Payload",JSON.stringify($,null,2),A,r)}u+="</div>";let E="",L=0;for(let A=m+1;A<_.length;A++){let F=_[A];if(F.role==="system"&&F.event_sub_type==="trigger_log"&&F.trigger_log_details&&typeof window.aipkit_renderTriggerLogEntryHTML=="function")E+=window.aipkit_renderTriggerLogEntryHTML(F,e,t,r),L++;else break}if(L>0&&p){let A=`trigger_details_for_${r(w)}`;u+='<div class="aipkit_message_related_triggers">',u+=`<a href="#" class="aipkit_trigger_activity_toggle" aria-controls="${A}" aria-expanded="false">
<span class="dashicons dashicons-arrow-right-alt2"></span>
${r(L===1?"Show Trigger Log":`Show ${L} Trigger Logs`)}
</a>`,u+=`<div class="aipkit_trigger_activity_details" id="${A}" style="display:none;">${E}</div>`,u+="</div>",m+=L}else L>0&&!p&&(m+=L)}else g.role==="system"&&g.event_sub_type==="trigger_log"&&g.trigger_log_details&&typeof window.aipkit_renderTriggerLogEntryHTML=="function"&&(u+=window.aipkit_renderTriggerLogEntryHTML(g,e,t,r))}i.innerHTML=u}window.aipkit_renderChatConversation=a})();(function(){"use strict";function d(a,i,n,e,t,o){let s=t||function(S){return S},r=window.aipkit_escapeAttribute||s,c=o||function(S){return S?S.charAt(0).toUpperCase()+S.slice(1):""},l=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)&&i.messages.length>0)l=i.messages[0];else{a.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">Invalid log data format for Image Generator.</p>';return}let p=l.request_payload||{},_=l.response_data||{},f=l.content||"",u=l.provider||"N/A",m=l.model||"N/A",g=l.timestamp||n.created_at,k=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(g):g||"N/A",w=f.startsWith("Error:"),h=p.prompt||"N/A",b=null;_.images&&_.images[0]&&_.images[0].revised_prompt&&(b=_.images[0].revised_prompt);let y='<div class="aipkit_log_image_gen_details" style="font-size: 13px;">';if(y+=`<p><strong>Time:</strong> ${s(k)}</p>`,y+=`<p><strong>Provider:</strong> ${s(u)}</p>`,y+=`<p><strong>Model:</strong> ${s(m)}</p>`,y+="<h5>Request Details:</h5><ul>",y+=`<li><strong>Prompt:</strong> ${s(h)}</li>`,y+=`<li><strong>Size:</strong> ${s(p.options?.size||"N/A")}</li>`,y+=`<li><strong>Number:</strong> ${s(p.options?.n||"N/A")}</li>`,p.options?.quality&&(y+=`<li><strong>Quality:</strong> ${s(p.options.quality)}</li>`),p.options?.style&&(y+=`<li><strong>Style:</strong> ${s(p.options.style)}</li>`),y+="</ul><h5>Response:</h5>",w?(y+=`<p style="color: red;">${s(f)}</p>`,_.error_code&&(y+=`<p><strong>Error Code:</strong> ${s(_.error_code)}</p>`)):(b&&(y+=`<p><strong>Revised Prompt:</strong><br><em style="font-size: 0.95em;">${s(b)}</em></p>`),_.images&&_.images.length>0?(y+='<div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">',_.images.forEach((S,I)=>{let x=S.media_library_url||S.url;y+='<div style="flex: 0 0 100px; border: 1px solid #ccc; padding: 5px; border-radius: 3px; text-align: center;">',x?y+=`<a href="${r(x)}" target="_blank" rel="noopener noreferrer"><img src="${r(x)}" alt="Generated Image ${I+1}" style="max-width: 90px; height: auto; display: block; margin: 0 auto 5px;"></a>`:S.has_b64?y+='<span style="font-size: 10px; color: #777;">(Base64 Image)</span>':y+='<span style="font-size: 10px; color: #777;">(No URL)</span>',y+="</div>"}),y+="</div>"):y+=`<p><em>${s(f)}</em></p>`),p&&typeof window.aipkit_createExpandableDetail=="function"){let S=`aipkit-debug-${l.message_id||"imgpayload"}`;y+=window.aipkit_createExpandableDetail("Request Data",JSON.stringify(p,null,2),S,s)}y+="</div>",a.innerHTML=y}window.aipkit_renderImageGeneratorLog=d})();(function(){"use strict";function d(a,i,n,e,t,o){let s=t||function(x){return x},r=o||function(x){return x?x.charAt(0).toUpperCase()+x.slice(1):""},c=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)&&i.messages.length>0)c=i.messages[0];else{a.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">Invalid log data format for Post Enhancer.</p>';return}let l=c.content||"",p=c.provider||"N/A",_=c.model||"N/A",f=c.timestamp||n.created_at,u=c.usage||null,m=u?u.total_tokens??u.totalTokenCount??null:null,g=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(f):f||"N/A",k=l.match(/Post ID: (\d+)/),w=k?k[1]:"N/A",h=l.match(/Prompt Snippet: (.*?)\.\.\./s),b=h?h[1]:"(Not found)",y=l.match(/Result:\n(.*)/s),S=y?y[1].trim():l,I='<div class="aipkit_log_enhancer_details">';if(I+=`<p><strong>Post ID:</strong> ${s(w)}</p>`,I+=`<p><strong>Time:</strong> ${s(g)}</p>`,I+=`<p><strong>Provider:</strong> ${s(p)}</p>`,I+=`<p><strong>Model:</strong> ${s(_)}</p>`,m!==null&&(I+=`<p><strong>Tokens Used:</strong> ${Number(m).toLocaleString()}</p>`),I+=`<h5>Prompt Snippet:</h5><pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px;">${s(b)}...</pre>`,I+="<h5>Result:</h5>",l.startsWith("Error:")?I+=`<p style="color: red;">${s(l)}</p>`:I+=`<pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px;">${s(S)}</pre>`,c.request_payload&&typeof window.aipkit_createExpandableDetail=="function"){let x=`aipkit-debug-${c.message_id||"enhancerpayload"}`;I+=window.aipkit_createExpandableDetail("Request Payload",JSON.stringify(c.request_payload,null,2),x,s)}I+="</div>",a.innerHTML=I}window.aipkit_renderPostEnhancerLog=d})();(function(){"use strict";function d(a,i,n,e,t,o){let s=t||function(f){return f},r=null;window.markdownit&&(r=window.markdownit({html:!1,linkify:!0,typographer:!0}),window.hljs&&typeof window.markdownitHighlight=="function"&&r.use(window.markdownitHighlight,{hljs:window.hljs}));let c=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)&&(c=i.messages),!c||c.length===0){a.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">No log data found.</p>';return}let l=c.find(f=>f.role==="user"),p=c.find(f=>f.role==="bot"),_='<div class="aipkit_log_generic_details">';if(l){let f=l.request_payload||{},u=l.content?l.content.replace("AI Form Submission (ID: "+(f.form_id||"")+"): ",""):"AI Form Submission",m=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(l.timestamp):l.timestamp||"";if(_+='<div class="aipkit_message aipkit_message_user">',_+=`<div class="aipkit_message_header"><strong>${s(u)}</strong>`,m&&(_+=`<span class="aipkit_message_timestamp">${m}</span>`),_+="</div>",f.inputs&&Object.keys(f.inputs).length>0){_+="<h5>Submitted Data:</h5><ul>";for(let g in f.inputs)if(Object.hasOwnProperty.call(f.inputs,g)){let k=f.inputs[g];_+=`<li><strong>${s(g)}:</strong> ${s(k)}</li>`}_+="</ul>"}f.constructed_prompt&&typeof window.aipkit_createExpandableDetail=="function"&&(_+=window.aipkit_createExpandableDetail("Constructed Prompt Sent to AI",f.constructed_prompt,`aipkit-debug-prompt-${l.message_id||"prompt"}`,s)),_+="</div>"}if(p){let f=p.provider||"N/A",u=p.model||"N/A",m=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(p.timestamp):p.timestamp||"",g=p.usage||null,k=g?g.total_tokens??g.totalTokenCount??null:null,w=p.content||"",h=w.toLowerCase().startsWith("error:"),b=r?r.render(w):s(w).replace(/\n/g,"<br>");_+=`<div class="aipkit_message aipkit_message_bot ${h?"aipkit_message_error":""}">`,_+='<div class="aipkit_message_header"><strong>AI Response:</strong>',m&&(_+=`<span class="aipkit_message_timestamp">${m}</span>`),_+="</div>";let S=[];f!=="N/A"&&S.push(`${f}`),u!=="N/A"&&S.push(`${u}`),k!==null&&k>0&&S.push(`${Number(k).toLocaleString()} tokens`),S.length>0&&(_+=`<div class="aipkit_bot_model_label">${s(S.join(" / "))}</div>`),_+=`<div>${b}</div>`,p.request_payload&&typeof window.aipkit_createExpandableDetail=="function"&&(_+=window.aipkit_createExpandableDetail("Full Request Payload",JSON.stringify(p.request_payload,null,2),`aipkit-debug-payload-${p.message_id||"payload"}`,s)),_+="</div>"}_+="</div>",a.innerHTML=_}window.aipkit_renderAiFormsLog=d})();(function(){"use strict";function d(a,i,n,e,t,o){let s=t||function(w){return w},r=o||function(w){return w?w.charAt(0).toUpperCase()+w.slice(1):""},c=null;if(typeof i=="object"&&i!==null&&Array.isArray(i.messages)&&i.messages.length>0)c=i.messages[0];else if(Array.isArray(i)&&i.length>0)c=i[0];else{a.innerHTML='<p style="text-align:center;padding:20px;font-style:italic;">Unknown log data format.</p>';return}let l=c.content||"(No Content)",p=c.provider||"N/A",_=c.model||"N/A",f=c.timestamp||n.created_at,u=c.usage||null,m=u?u.total_tokens??u.totalTokenCount??null:null,g=typeof window.aipkit_formatTimestamp=="function"?window.aipkit_formatTimestamp(f):f||"N/A",k='<div class="aipkit_log_generic_details">';k+=`<p><strong>Time:</strong> ${s(g)}</p>`,k+=`<p><strong>Provider:</strong> ${s(p)}</p>`,k+=`<p><strong>Model:</strong> ${s(_)}</p>`,m!==null&&(k+=`<p><strong>Tokens Used:</strong> ${Number(m).toLocaleString()}</p>`),k+=`<h5>Log Content:</h5><pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; border: 1px solid #eee; padding: 5px;">${s(l)}</pre>`,k+="</div>",a.innerHTML=k}window.aipkit_renderGenericLog=d})();(function(){"use strict";function d(a){a.querySelectorAll(".aipkit_log_debug_toggle").forEach(i=>{let n=i.cloneNode(!0),e=i.parentNode;e&&e.replaceChild(n,i),n.addEventListener("click",t=>{t.preventDefault();let o=n.getAttribute("aria-controls"),s=document.getElementById(o);if(s){let r=s.style.display==="block";s.style.display=r?"none":"block",n.setAttribute("aria-expanded",!r);let c=n.querySelector(".dashicons");c&&(c.className=r?"dashicons dashicons-arrow-right-alt2":"dashicons dashicons-arrow-down-alt2")}})})}window.aipkit_attachDebugToggleListeners=d})();(function(){"use strict";function d(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}function a(i){let n=document.getElementById("aipkit_log_detail_view");if(!n)return;let e=n.querySelector("#aipkit_log_detail_title"),t=n.querySelector("#aipkit_log_detail_ip"),o=n.querySelector("#aipkit_log_detail_conversation"),s=window.aipkit_dashboard?.text||{},r=window.aipkit_escapeHtml||function(g){return g},c=window.aipkit_ucfirst||d,l=i.user_display_name||(i.is_guest?s.guestLabel||"Guest":s.unknownUserLabel||"Unknown User"),p=i.bot_name;!p&&i.module?p=`(${c(i.module.replace(/_/g," "))})`:p||(p="(Unknown Source)"),e&&(e.textContent=`${l} with ${p}`);let _=s.logIpLabel||"IP";if(i.ip_address&&t?t.innerHTML=`<strong>${r(_)}:</strong> ${r(i.ip_address)}`:t&&(t.innerHTML=""),!o)return;let f=i.messages||"[]",u;try{u=JSON.parse(f)}catch(g){console.error("AIPKit Log Detail Renderer: Failed to parse messages JSON.",g),o.innerHTML='<p style="color:red;text-align:center;padding:15px;">Error parsing log data.</p>';return}let m=i.module||"chat";m==="image_generator"&&typeof window.aipkit_renderImageGeneratorLog=="function"?window.aipkit_renderImageGeneratorLog(o,u,i,s,r,c):m==="ai_forms"&&typeof window.aipkit_renderAiFormsLog=="function"?window.aipkit_renderAiFormsLog(o,u,i,s,r,c):(m==="chat"||m==="chat_trigger_system")&&typeof window.aipkit_renderChatConversation=="function"?window.aipkit_renderChatConversation(o,u,i,s,r,c):m==="ai_post_enhancer"&&typeof window.aipkit_renderPostEnhancerLog=="function"?window.aipkit_renderPostEnhancerLog(o,u,i,s,r,c):typeof window.aipkit_renderGenericLog=="function"?window.aipkit_renderGenericLog(o,u,i,s,r,c):o.innerHTML=`<p style="color:red;text-align:center;padding:15px;">Error: Log rendering function missing for module type '${m}'.</p>`,o.scrollTop=0,typeof window.aipkit_attachDebugToggleListeners=="function"&&window.aipkit_attachDebugToggleListeners(o),o.querySelectorAll(".aipkit_trigger_activity_toggle").forEach(g=>{let k=g.cloneNode(!0),w=g.parentNode;w&&w.replaceChild(k,g),k.addEventListener("click",h=>{h.preventDefault();let b=k.getAttribute("aria-controls"),y=document.getElementById(b);if(y){let S=y.style.display==="block";y.style.display=S?"none":"block",k.setAttribute("aria-expanded",!S);let I=k.querySelector(".dashicons"),x=k.childNodes[k.childNodes.length-1];if(I&&(I.className=S?"dashicons dashicons-arrow-right-alt2":"dashicons dashicons-arrow-down-alt2"),x&&x.nodeType===Node.TEXT_NODE){let q=x.textContent.trim();S?x.textContent=q.replace("Hide","Show"):x.textContent=q.replace("Show","Hide")}}})})}window.aipkit_displayLogDetails=a})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_log_table_view"),n=document.getElementById("aipkit_log_detail_view");if(!i||!n){console.warn("AIPKit Log Row Handler: Missing containers for logs or detail view.");return}let e="data-log-row-listener-attached";i.getAttribute(e)||(i.addEventListener("click",a),i.setAttribute(e,"true"))}function a(i){let n=i.target.closest(".aipkit_log_row");if(!n)return;let e=n.getAttribute("data-conversation-uuid"),t=n.getAttribute("data-bot-id"),o=n.getAttribute("data-user-id"),s=n.getAttribute("data-session-id");if(!e){console.error("AIPKit Log Row Handler: Missing conversation UUID from clicked row.");return}if(!o&&!s){console.error("AIPKit Log Row Handler: Missing User ID and Session ID from clicked row data.");return}let r=document.getElementById("aipkit_log_table_view");if(r){let m=r.querySelector(".aipkit_log_row.aipkit_selected");m&&m.classList.remove("aipkit_selected"),n.classList.add("aipkit_selected")}let c=document.getElementById("aipkit_log_detail_view");if(!c)return;let l=c.querySelector("#aipkit_log_detail_title"),p=c.querySelector("#aipkit_log_detail_ip"),_=c.querySelector("#aipkit_log_detail_conversation"),f=window.aipkit_dashboard?.text||{};l&&(l.textContent=f.logLoading||"Loading..."),p&&(p.innerHTML=""),_&&(_.innerHTML='<div class="aipkit_detail_spinner"></div>');let u={bot_id:t||null,conversation_uuid:e,user_id:o||null,session_id:s||null};if(typeof window.aipkit_displayLogDetails!="function"){console.error("AIPKit Log Row Handler: aipkit_displayLogDetails function is not defined globally."),_&&(_.innerHTML='<p style="color:red;">Error: Detail rendering function missing.</p>');return}aipkit_apiRequest("aipkit_admin_get_conversation_history",u).then(m=>{if(m&&m.log_data)window.aipkit_displayLogDetails(m.log_data);else throw new Error("Received invalid data for log details.")}).catch(m=>{console.error("AIPKit Log Row Handler: Error fetching log details:",m),l&&(l.textContent=f.logErrorLoading||"Error"),p&&(p.innerHTML=""),_&&(_.innerHTML=`<p style="color:red;text-align:center;padding:15px;">${f.logErrorLoading||"Failed to load details:"} ${window.aipkit_escapeHtml(m.message||"Unknown error")}</p>`)})}window.aipkit_initLogRowClickListener=d})();(function(){"use strict";function d(i=1){let n=document.getElementById("aipkit_logs_container");if(!n){console.error("AIPKit Chat Logs Fetch: Main logs module container (#aipkit_logs_container) not found.");return}let e=n.querySelector("#aipkit_log_table_view"),t=n.querySelector("#aipkit_log_detail_view"),o=window.aipkit_dashboard?.text||{};if(!e||!t){console.error("AIPKit Chat Logs Fetch: Required log containers (#aipkit_log_table_view or #aipkit_log_detail_view) not found inside #aipkit_logs_container.");return}e.innerHTML=`
          <p style="text-align:center; padding:30px;">
            <span class="aipkit_spinner"
                  style="display:inline-block;width:20px;height:20px;border-width:3px;vertical-align:middle;margin-right:10px;"
            ></span>
            ${o.logLoading||"Loading logs..."}
          </p>`;let s=t.querySelector("#aipkit_log_detail_title"),r=t.querySelector("#aipkit_log_detail_ip"),c=t.querySelector("#aipkit_log_detail_conversation"),l=o.logViewTitle||"Chat Log Details";s&&(s.textContent=l),r&&(r.innerHTML=""),c&&(c.innerHTML='<div class="aipkit_detail_spinner"></div>');let p=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{},_={log_page:i,filter_user_name:p.user_name||"",filter_chatbot_id:p.chatbot_id||"",filter_message_like:p.message_like||""};aipkit_apiRequest("aipkit_get_chat_logs_html",_).then(f=>{if(f&&f.html){e.innerHTML=f.html,a(),typeof window.aipkit_initLogRowClickListener=="function"?window.aipkit_initLogRowClickListener():console.error("AIPKit Logs Fetch: Cannot initialize row click listener."),typeof window.aipkit_initLogFiltersUI=="function"?window.aipkit_initLogFiltersUI():console.error("AIPKit Logs Fetch: Cannot initialize filter UI.");let u=e.querySelector(".aipkit_log_row");u?setTimeout(()=>{let m=e.querySelector(".aipkit_log_row");m&&m===u&&!e.querySelector(".aipkit_log_row.aipkit_selected")&&u.click()},100):(s&&(s.textContent=l),r&&(r.innerHTML=""),c&&(c.innerHTML=`<p style="text-align:center; padding:20px; font-style:italic;">${o.noLogsFound||"No logs found matching your criteria."}</p>`))}else throw new Error("Invalid HTML content for logs.")}).catch(f=>{console.error("AIPKit Chat Logs Fetch: Error fetching logs:",f),e.innerHTML=`<p style="color:red; text-align:center; padding:20px;">${o.logErrorLoading||"Failed to load logs:"} ${aipkit_escapeHtml(f.message||"Unknown error")}</p>`,s&&(s.textContent=l),r&&(r.innerHTML=""),c&&(c.innerHTML=`<p style="color:red; text-align:center; padding:15px;">${o.logErrorLoading||"Error loading logs."}</p>`)})}function a(){let i=document.getElementById("aipkit_log_table_view");if(!i)return;let n="data-pagination-listener-attached";i.getAttribute(n)||(i.addEventListener("click",function(e){let t=e.target.closest(".aipkit-log-footer .aipkit_pagination-links a");if(!(!t||!t.href)){e.preventDefault();try{let s=new URL(t.href).searchParams.get("log_page")||1;d(parseInt(s,10))}catch(o){console.error("AIPKit Logs Fetch: Error parsing pagination URL:",o)}}}),i.setAttribute(n,"true"))}window.aipkit_fetchAndDisplayLogs=d,window.aipkit_initLogPagination=a})();(function(){"use strict";let d={user_name:"",chatbot_id:"",message_like:""};function a(){return{...d}}function i(){return!!(d.user_name||d.chatbot_id||d.message_like)}function n(){let c=document.getElementById("aipkit_log_table_view");if(!c)return;s(c),r(c);let l={chatbot:"chatbot_id",user:"user_name",message:"message_like"};c.querySelectorAll(".aipkit_log_filter_btn").forEach(_=>{let f=_.getAttribute("data-filter-type");if(f==="module")return;let u=l[f];u&&d[u]?_.querySelector(".dashicons").className="dashicons dashicons-image-rotate":_.querySelector(".dashicons").className="dashicons dashicons-filter"});let p="data-log-filter-outside-click";document.body.getAttribute(p)||(document.addEventListener("click",function(_){let f=document.querySelector('.aipkit_log_filter_box[style*="display: block"]');if(!f)return;let u=f.getAttribute("data-filter-box"),m=document.querySelector(`.aipkit_log_filter_btn[data-filter-type="${u}"]`);!f.contains(_.target)&&(!m||!m.contains(_.target))&&(f.style.display="none")},!0),document.body.setAttribute(p,"true"))}function e(){let c=document.getElementById("aipkit_log_table_view");if(!c)return;let l="data-log-filter-delegate-listener";if(c.getAttribute(l))return;let p={chatbot:"chatbot_id",user:"user_name",message:"message_like"};c.addEventListener("click",function(_){let f=_.target.closest(".aipkit_log_filter_btn");if(!f)return;let u=f.getAttribute("data-filter-type");if(!u||u==="module")return;let m=p[u];if(m)if(d[m])d[m]="",typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1);else{let g=c.querySelector(`.aipkit_log_filter_box[data-filter-box="${u}"]`);if(!g)return;c.querySelectorAll(".aipkit_log_filter_box").forEach(w=>{w!==g&&w.style.display==="block"&&(w.style.display="none")});let k=g.style.display==="none"||!g.style.display;if(g.style.display=k?"block":"none",k){let w=g.querySelector(".aipkit_log_filter_input, .aipkit_log_filter_select");w&&w.focus()}}}),c.addEventListener("change",t),c.addEventListener("keydown",t),c.setAttribute(l,"true")}function t(c){let l=c.target;l.matches(".aipkit_log_filter_select")&&c.type==="change"?o(l):l.matches(".aipkit_log_filter_input")&&c.type==="keydown"&&c.key==="Enter"&&(c.preventDefault(),o(l))}function o(c){let l=c.getAttribute("data-filter-field");if(!l)return;let p=c.value.trim();d[l]!==p&&(d[l]=p,typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1));let _=c.closest(".aipkit_log_filter_box");_&&(_.style.display="none")}function s(c){let l=document.getElementById("aipkit_available_bots_json");if(!l)return;let p=l.getAttribute("data-bots")||"[]",_=[];try{_=JSON.parse(p)}catch(u){console.error("AIPKit Logs Filters: Failed to parse chatbot JSON for filter",u);return}let f=c.querySelector('select[data-filter-field="chatbot_id"]');if(f){for(;f.options.length>1;)f.remove(1);Array.isArray(_)&&_.forEach(u=>{let m=document.createElement("option");m.value=u.id,m.textContent=u.title,f.appendChild(m)})}}function r(c){c.querySelectorAll(".aipkit_log_filter_input, .aipkit_log_filter_select").forEach(p=>{let _=p.getAttribute("data-filter-field");_&&d.hasOwnProperty(_)&&(p.value=d[_])})}window.aipkit_initLogFiltersUI=n,window.aipkit_attachLogFilterDelegatedListeners=e,window.aipkit_getCurrentLogFilters=a})();(function(){"use strict";let d=!1,a=!1;function i(){let k=document.getElementById("aipkit_log_table_view"),w=document.getElementById("aipkit_logs_container");if(!w){console.warn("AIPKit Log Actions: Main Logs container (#aipkit_logs_container) not found.");return}let h="data-log-bulk-action-listener-attached";w.getAttribute(h)||(w.addEventListener("click",n),document.addEventListener("click",o,!0),w.setAttribute(h,"true"))}function n(k){let w=k.target.closest("#aipkit_log_bulk_actions_btn"),h=k.target.closest('.aipkit_log_action_menu_item[data-action="export-all"]'),b=k.target.closest('.aipkit_log_action_menu_item[data-action="delete-all"]'),y=k.target.closest(".aipkit_log_export_confirm_btn"),S=k.target.closest(".aipkit_log_delete_confirm_btn"),I=k.target.closest(".aipkit_log_action_cancel_btn");if(w)k.stopPropagation(),e();else if(h){if(k.stopPropagation(),t(),d||a){console.warn("AIPKit Log Actions: Another bulk action is already in progress.");return}s(!1)}else if(b){if(k.stopPropagation(),t(),d||a){console.warn("AIPKit Log Actions: Another bulk action is already in progress.");return}r(!1)}else y?(c(),_()):S?(c(),m()):I&&c()}function e(){let k=document.getElementById("aipkit_log_bulk_action_menu"),w=document.getElementById("aipkit_log_bulk_actions_btn");if(k&&w){let h=w.getBoundingClientRect();k.style.display=k.style.display==="block"?"none":"block",k.style.display==="block"&&(k.style.top=`${h.bottom+window.scrollY+2}px`,k.style.left=`${h.left+window.scrollX}px`)}}function t(){let k=document.getElementById("aipkit_log_bulk_action_menu");k&&(k.style.display="none")}function o(k){let w=document.getElementById("aipkit_log_bulk_action_menu"),h=document.getElementById("aipkit_log_bulk_actions_btn");w&&w.style.display==="block"&&!w.contains(k.target)&&(!h||!h.contains(k.target))&&t();let b=document.getElementById("aipkit_log_bulk_action_confirmation_area");if(b&&b.style.display==="block"&&!b.contains(k.target)){let y=document.querySelector(".aipkit_log_action_menu_item");(!y||!y.contains(k.target))&&c()}}function s(k){let w=window.aipkit_dashboard?.text||{},h=document.getElementById("aipkit_log_bulk_action_confirmation_area"),b=document.getElementById("aipkit_log_bulk_actions_btn");if(!h||!b)return;let y=!1;if(k){let x=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};y=Object.values(x).some(q=>q&&q!=="")}let S=k&&y?w.logExportFilteredConfirmMsg||"Export all messages matching current filters?":w.logExportAllConfirmMsg||"Export all messages? This might take a while for large datasets.";h.innerHTML=`
            <p>${S}</p>
            <div class="aipkit_log_bulk_action_confirmation_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_log_action_cancel_btn">${w.cancel||"Cancel"}</button>
                <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_log_export_confirm_btn">${w.confirm||"Confirm"}</button>
            </div>`,h.style.display="block",h.setAttribute("data-action-type","export");let I=b.getBoundingClientRect();h.style.top=`${I.bottom+window.scrollY+2}px`,h.style.right="auto",h.style.left=`${I.left+window.scrollX}px`,p()}function r(k){let w=window.aipkit_dashboard?.text||{},h=document.getElementById("aipkit_log_bulk_action_confirmation_area"),b=document.getElementById("aipkit_log_bulk_actions_btn");if(!h||!b)return;let y=!1;if(k){let q=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};y=Object.values(q).some($=>$&&$!=="")}let S=k&&y?w.logDeleteFilteredConfirmMsg||"Delete all messages matching current filters? This cannot be undone.":w.logDeleteAllConfirmMsg||"Delete ALL messages? This will remove ALL chat history and cannot be undone.",I=k&&y?w.confirmDeleteFiltered||"Confirm Delete Filtered":w.confirmDeleteAll||"Confirm Delete ALL";h.innerHTML=`
            <p style="color:#c53030;font-weight:bold;">${S}</p>
            <div class="aipkit_log_bulk_action_confirmation_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_log_action_cancel_btn">${w.cancel||"Cancel"}</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_log_delete_confirm_btn">${I}</button>
            </div>`,h.style.display="block",h.setAttribute("data-action-type","delete");let x=b.getBoundingClientRect();h.style.top=`${x.bottom+window.scrollY+2}px`,h.style.right="auto",h.style.left=`${x.left+window.scrollX}px`,p()}function c(){let k=document.getElementById("aipkit_log_bulk_action_confirmation_area");k&&(k.style.display="none")}function l(k,w,h="info"){let b=document.getElementById("aipkit_log_bulk_action_status_area"),y=b?.querySelector(".aipkit_log_bulk_action_spinner"),S=b?.querySelector(".aipkit_log_bulk_action_message");!b||!y||!S||(S.textContent=k,y.style.display=w?"inline-block":"none",b.style.display="inline-flex",b.className=`aipkit_log_bulk_action_status_area aipkit_status-${h}`)}function p(){let k=document.getElementById("aipkit_log_bulk_action_status_area");k&&(k.style.display="none")}function _(){if(d||a)return;d=!0;let k=window.aipkit_dashboard?.text||{};l(k.logExportStarting||"Starting...",!0);let w=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};f(0,w,"",-1)}function f(k,w,h,b){let y=window.aipkit_dashboard?.text||{},S={page:k,total_count:b,filter_user_name:w.user_name||"",filter_chatbot_id:w.chatbot_id??"",filter_message_like:w.message_like||""},I=b>0?(y.logExportProgress||"Exporting conversation %d / %d...").replace("%d",k*50).replace("%d",b):y.logExportStarting||"Starting...";l(I,!0),aipkit_apiRequest("aipkit_export_chat_logs",S).then(x=>{let q=x.total_count??-1;if(q===0&&k===0){l(y.logExportNoLogs||"No messages found to export.",!1,"info"),setTimeout(p,3e3),d=!1;return}let $=x.csv_chunk||"",M=h+$,T=x.exported_count||0,P=x.is_last_batch||!1,C=q>0?q:T,v=(y.logExportProgress||"Exporting conversation %d / %d...").replace("%d",T).replace("%d",C);l(v,!0),P?(u(M),l(y.logExportComplete||"Done!",!1,"success"),setTimeout(p,4e3),d=!1):setTimeout(()=>{f(k+1,w,M,q)},100)}).catch(x=>{console.error("AIPKit Log Export: Error fetching export batch:",x),l(`${y.logExportError||"Export failed:"} ${x.message}`,!1,"error"),setTimeout(p,6e3),d=!1})}function u(k){if(!k)return;let w="\uFEFF",h=new Blob([w+k],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a"),y=URL.createObjectURL(h),I=new Date().toISOString().slice(0,10);b.setAttribute("href",y),b.setAttribute("download",`aipkit-chat-logs-${I}.csv`),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(y)}function m(){if(d||a)return;a=!0;let k=window.aipkit_dashboard?.text||{};l(k.logDeleteStarting||"Starting...",!0,"info");let w=typeof window.aipkit_getCurrentLogFilters=="function"?window.aipkit_getCurrentLogFilters():{};g(0,w,0,-1)}function g(k,w,h,b){let y=window.aipkit_dashboard?.text||{},S={page:k,deleted_count:h,total_count:b,filter_user_name:w.user_name||"",filter_chatbot_id:w.chatbot_id??"",filter_message_like:w.message_like||""},I=b>0?(y.logDeleteProgress||"Deleting conversation %d / %d...").replace("%d",h).replace("%d",b):y.logDeleteStarting||"Starting...";l(I,!0,"info"),aipkit_apiRequest("aipkit_delete_chat_logs",S).then(x=>{let q=x.total_count??-1;if(q===0&&k===0){l(y.logDeleteNoLogs||"No messages found to delete.",!1,"info"),setTimeout(p,3e3),a=!1;return}let $=x.deleted_total||h,M=x.is_last_batch||!1,T=q>0?q:$,P=(y.logDeleteProgress||"Deleting conversation %d / %d...").replace("%d",$).replace("%d",T);l(P,!0,"info"),M?(l(y.logDeleteComplete||"Done!",!1,"success"),setTimeout(()=>{p(),typeof window.aipkit_fetchAndDisplayLogs=="function"&&window.aipkit_fetchAndDisplayLogs(1)},3e3),a=!1):setTimeout(()=>{g(k+1,w,$,q)},200)}).catch(x=>{console.error("AIPKit Log Delete: Error processing delete batch:",x),l(`${y.logDeleteError||"Deletion failed:"} ${x.message}`,!1,"error"),setTimeout(p,6e3),a=!1})}window.aipkit_initLogBulkActions=i})();(function(){"use strict";function d(){if(typeof window.aipkit_attachLogFilterDelegatedListeners=="function"?window.aipkit_attachLogFilterDelegatedListeners():console.error("AIPKit Logs Main: aipkit_attachLogFilterDelegatedListeners function not found."),typeof window.aipkit_fetchAndDisplayLogs=="function")window.aipkit_fetchAndDisplayLogs(1);else{console.error("AIPKit Logs Main: aipkit_fetchAndDisplayLogs function not found. Cannot fetch logs.");let a=document.getElementById("aipkit_log_table_view");a&&(a.innerHTML='<p style="color:red;">Error: Log fetching script failed to load.</p>')}typeof window.aipkit_initLogRowClickListener=="function"?window.aipkit_initLogRowClickListener():console.error("AIPKit Logs Main: aipkit_initLogRowClickListener function not found."),typeof window.aipkit_initLogBulkActions=="function"?window.aipkit_initLogBulkActions():console.error("AIPKit Logs Main: aipkit_initLogBulkActions function not found.")}window.aipkit_initLogs=d})();(function(){"use strict";function d(){let a=document.getElementById("chatbot-create-new-content");if(!a){console.warn("AIPKit Chat Creator: 'Create New' content pane not found.");return}let i=a.querySelector("#aipkit_create_new_bot_btn"),n=a.querySelector("#aipkit_new_bot_name"),e=a.querySelector("#aipkit_create_bot_message");if(!i||!n||!e){console.warn("AIPKit Chat Creator: Missing required elements (button, name input, or message div) within create pane.");return}let t=i.querySelector(".aipkit_spinner");i.addEventListener("click",function(){let o=n.value.trim();if(!o){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Please enter a name for the chatbot."):(e.textContent="Please enter a name for the chatbot.",e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),n.focus();return}i.disabled=!0,t&&(t.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Creating..."):i.textContent="Creating...",e.textContent="",e.className="aipkit_form-help",aipkit_apiRequest("aipkit_create_chatbot",{bot_name:o}).then(s=>{let r=s.message||"Chatbot created!";typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"success",r):(e.textContent=r,e.style.color="green",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),n.value="";let c=s.bot_id;if(!c){console.error("AIPKit Chat Creator: 'bot_id' missing in success response!",s),typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Creation succeeded but failed to get bot ID. Please reload."):(e.textContent="Creation succeeded but failed to get bot ID. Please reload.",e.style.color="red");return}aipkit_loadModule("chatbot",{force_active_bot_id:c},function(l){if(l){console.error("AIPKit Chat Creator: Error during module reload after creation:",l),typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Bot created, but UI failed to refresh. Please reload."):(e.textContent="Bot created, but UI failed to refresh. Please reload.",e.style.color="red");return}setTimeout(()=>{typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(c)},50)})}).catch(s=>{let r="Error: "+(s.message||"Unknown error during creation.");typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error",r):(e.textContent=r,e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3))}).finally(()=>{i.disabled=!1,t&&(t.style.display="none"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Start Creating"):(i.textContent="Start Creating",t&&i.appendChild(t))})})}window.aipkit_initCreateNewBot=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}a.addEventListener("submit",function(i){let n=i.target.closest(".aipkit_chatbot_settings_form");if(!n)return;i.preventDefault();let e=n.getAttribute("data-bot-id"),t=n.querySelector(".aipkit_save_bot_settings_btn"),o=document.getElementById("aipkit_chatbot_global_save_status_container"),s=n.querySelector(`#aipkit_action_feedback_${e}`);if(!e||!t||!o){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",n),o||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}s&&(s.innerHTML=""),o.textContent="",o.className="aipkit_save_status_container",t.disabled=!0,t.classList.add("aipkit_loading");let r=t.querySelector(".aipkit_spinner");if(r||(r=document.createElement("span"),r.className="aipkit_spinner",t.appendChild(r)),r.style.display="inline-block",typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(t,"Saving...");else{let _=Array.from(t.childNodes).find(f=>f.nodeType===Node.TEXT_NODE);_?_.textContent="Saving... ":t.insertBefore(document.createTextNode("Saving... "),t.firstChild)}let c=new FormData(n),l={};for(let[_,f]of c.entries())if(_.endsWith("[]")){let u=_.slice(0,-2);l[u]=c.getAll(_)}else l.hasOwnProperty(_)||(l[_]=f);l.bot_id=e;let p=l.provider;if(p==="OpenAI"?l.model=l.openai_model:p==="OpenRouter"?l.model=l.openrouter_model:p==="Google"?l.model=l.google_model:p==="Azure"?l.model=l.azure_deployment:p==="DeepSeek"?l.model=l.deepseek_model:l.model="",delete l.openai_model,delete l.openrouter_model,delete l.google_model,delete l.azure_deployment,delete l.deepseek_model,l.vector_store_provider==="openai"){let _=n.querySelector('select[name="openai_vector_store_ids[]"]');_?l.openai_vector_store_ids=Array.from(_.selectedOptions).map(f=>f.value):l.openai_vector_store_ids=[]}else l.hasOwnProperty("openai_vector_store_ids")&&delete l.openai_vector_store_ids;if(l.vector_store_provider==="pinecone"||l.vector_store_provider==="qdrant"){if(l.vector_store_provider==="qdrant"){let u=n.querySelector('select[name="qdrant_collection_name"]');u&&(l.qdrant_collection_name=u.value)}else if(l.vector_store_provider==="pinecone"){let u=n.querySelector('select[name="pinecone_index_name"]');u&&(l.pinecone_index_name=u.value)}let _=n.querySelector('select[name="vector_embedding_provider"]');_&&(l.vector_embedding_provider=_.value);let f=n.querySelector('select[name="vector_embedding_model"]');f&&(l.vector_embedding_model=f.value)}else delete l.pinecone_index_name,delete l.qdrant_collection_name,delete l.vector_embedding_provider,delete l.vector_embedding_model;aipkit_apiRequest("aipkit_save_chatbot_settings",l).then(_=>{o.textContent=_.message||"Settings Saved!",o.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(e)}).catch(_=>{o.textContent="Error: "+_.message,o.classList.add("error")}).finally(()=>{t.disabled=!1,t.classList.remove("aipkit_loading");let _=t.querySelector(".aipkit_spinner");if(_&&(_.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(t,"Save");else{let f=Array.from(t.childNodes).find(u=>u.nodeType===Node.TEXT_NODE);f?f.textContent="Save":t.insertBefore(document.createTextNode("Save"),t.firstChild),_&&t.appendChild(_)}setTimeout(()=>{o&&(o.textContent="",o.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=d})();(function(){"use strict";function d(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit Chat Deleter: Main content container not found.");return}n.querySelectorAll(".aipkit_delete_bot_btn").forEach(e=>{e.getAttribute("data-is-default")==="1"&&(e.disabled=!0)}),n.addEventListener("click",function(e){let t=e.target.closest(".aipkit_delete_bot_btn");if(!t||t.disabled)return;let o=t.getAttribute("data-bot-id"),s=t.getAttribute("data-bot-name"),r=t.closest(".aipkit_chatbot_settings_form"),c=r?r.querySelector(`#aipkit_action_feedback_${o}`):null,l=document.getElementById("aipkit_chatbot_global_save_status_container");if(!o||!c){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",t);return}let p=`aipkit_delete_confirmation_${o}`,_=c.querySelector(`#${p}`);_||(_=document.createElement("div"),_.id=p,_.className="aipkit_confirmation_message aipkit_delete_confirmation",_.style.display="none",c.insertBefore(_,c.firstChild));let f=`aipkit_action_status_${o}`,u=c.querySelector(`#${f}`);if(u||(u=document.createElement("div"),u.id=f,u.className="aipkit_action_status_message",c.appendChild(u)),_.style.display!=="none"&&_.innerHTML!=="")return;l&&(l.textContent="",l.className="aipkit_save_status_container");let m=c.querySelector(".aipkit_reset_confirmation");m&&(m.style.display="none"),u.textContent="",u.className="aipkit_action_status_message",_.innerHTML=`
                <p>Delete <strong>${i(s)}</strong>? This cannot be undone.</p>
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm Delete</button>
                </div>
            `,_.style.display="block";let g=_.querySelector(".aipkit_delete_confirm_btn"),k=_.querySelector(".aipkit_delete_cancel_btn"),w=()=>{_.innerHTML="",_.style.display="none",a(t,o,u,l)},h=()=>{_.innerHTML="",_.style.display="none"};g.addEventListener("click",w,{once:!0}),k.addEventListener("click",h,{once:!0})})}function a(n,e,t,o){let s=n.querySelector(".aipkit_spinner"),r=document.getElementById("aipkit_chatbot_main_selector_container");o&&(o.textContent="",o.className="aipkit_save_status_container"),t.textContent="",t.className="aipkit_action_status_message",n.disabled=!0,n.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(n,"Deleting..."):n.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:e}).then(c=>{t.textContent=c.message||"Chatbot deleted successfully.",t.classList.add("success");let l=!1;if(r){let _=r.querySelector(`.aipkit_tab_button[data-bot-id="${e}"]`),f=r.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${e}"]`);if(_)l=_.classList.contains("aipkit_active"),_.remove();else if(f){l=f.classList.contains("aipkit_active"),f.remove();let u=r.querySelector(".aipkit_tab_dropdown_menu");if(u&&u.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let g=u.closest(".aipkit_tab_dropdown_container");g&&g.remove()}}}let p=document.getElementById(`chatbot-${e}-content`);if(p&&p.remove(),setTimeout(()=>{let _=document.getElementById(`aipkit_action_status_${e}`);_&&(_.textContent="",_.className="aipkit_action_status_message")},4e3),l){let _=r?.querySelector(".aipkit_tab_button_default");if(_)_.click();else{let f=r?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(f)f.click();else{let u=r?.querySelector(".aipkit_tab_dropdown_item");if(u)u.click();else{let m=r?.querySelector(".aipkit_create-new-button");if(m)m.click();else{let g=document.getElementById("aipkit_admin_chat_preview_container");g&&(g.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(c=>{t.textContent="Error: "+(c.message||"Failed to delete chatbot."),t.classList.add("error"),n.disabled=!1,n.classList.remove("aipkit_loading"),s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(n,"Delete"),setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_action_status_message")},5e3)})}function i(n){if(!n)return"";let e=document.createElement("div");return e.textContent=n,e.innerHTML}window.aipkit_initDeleteBot=d})();(function(){"use strict";function d(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n){console.warn("AIPKit Chat Resetter: Main content container not found.");return}n.addEventListener("click",function(e){let t=e.target.closest(".aipkit_reset_bot_btn");if(!t||t.disabled)return;let o=t.getAttribute("data-bot-id"),s=t.getAttribute("data-bot-name"),r=t.closest(".aipkit_chatbot_settings_form"),c=r?r.querySelector(`#aipkit_action_feedback_${o}`):null,l=document.getElementById("aipkit_chatbot_global_save_status_container");if(!o||!c){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",t);return}let p=`aipkit_reset_confirmation_${o}`,_=c.querySelector(`#${p}`);_||(_=document.createElement("div"),_.id=p,_.className="aipkit_confirmation_message aipkit_reset_confirmation",_.style.display="none",c.insertBefore(_,c.firstChild));let f=`aipkit_action_status_${o}`,u=c.querySelector(`#${f}`);if(u||(u=document.createElement("div"),u.id=f,u.className="aipkit_action_status_message",c.appendChild(u)),_.style.display!=="none"&&_.innerHTML!=="")return;l&&(l.textContent="",l.className="aipkit_save_status_container");let m=c.querySelector(".aipkit_delete_confirmation");m&&(m.style.display="none"),u.textContent="",u.className="aipkit_action_status_message",_.innerHTML=`
                <p>Reset <strong>${i(s)}</strong> to defaults?</p>
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm Reset</button>
                </div>
            `,_.style.display="block";let g=_.querySelector(".aipkit_reset_confirm_btn"),k=_.querySelector(".aipkit_reset_cancel_btn"),w=()=>{_.innerHTML="",_.style.display="none",a(t,o,u,l)},h=()=>{_.innerHTML="",_.style.display="none"};g.addEventListener("click",w,{once:!0}),k.addEventListener("click",h,{once:!0})})}function a(n,e,t,o){let s=n.querySelector(".aipkit_spinner");o&&(o.textContent="",o.className="aipkit_save_status_container"),t.textContent="",t.className="aipkit_action_status_message",n.disabled=!0,n.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(n,"Resetting..."):n.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:e}).then(r=>{t.textContent=r.message||"Chatbot reset successfully!",t.classList.add("success"),aipkit_loadModule("chatbot",{force_active_bot_id:e},function(c){c&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",c),t.textContent="Reset OK, but UI refresh failed. Reload page.",t.classList.add("error"))}),setTimeout(()=>{let c=document.getElementById(`aipkit_action_status_${e}`);c&&(c.textContent="",c.className="aipkit_action_status_message")},4e3)}).catch(r=>{t.textContent="Error: "+(r.message||"Failed to reset chatbot."),t.classList.add("error"),n.disabled=!1,n.classList.remove("aipkit_loading"),s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(n,"Reset"),setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_action_status_message")},5e3)})}function i(n){if(!n)return"";let e=document.createElement("div");return e.textContent=n,e.innerHTML}window.aipkit_initResetBot=d})();(function(){"use strict";function d(n,e=5,t=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(n)}catch(o){console.error("AIPKit Chat Preview: Error during chat initialization.",o),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else e>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${t}ms... (${e} retries left)`),setTimeout(()=>{d(n,e-1,t)},t)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function a(){let n=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),e=document.getElementById("aipkit_admin_chat_preview_container"),t=document.querySelector(".aipkit_chatbot-preview-column"),o=window.aipkit_dashboard?.text||{};if(!e||!t){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(e.innerHTML="",t.classList.remove("aipkit_loading"),n){let s=n.getAttribute("data-tab-type"),r=n.getAttribute("data-bot-id");s==="bot"&&r?i(r):s==="create"?e.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:s==="settings"?e.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?e.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${o.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function i(n){let e=document.getElementById("aipkit_admin_chat_preview_container"),t=document.querySelector(".aipkit_chatbot-preview-column");if(!e||!t){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}t.classList.add("aipkit_loading"),e.innerHTML="";let o=new URL(window.aipkit_dashboard.ajaxurl);o.searchParams.append("action","aipkit_get_chatbot_shortcode"),o.searchParams.append("bot_id",n),o.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(o).then(s=>s.json()).then(s=>{if(s.success&&s.data&&s.data.html){e.innerHTML=s.data.html;let r=e.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");r?d(r):(console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${n} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,s.data.html),e.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>')}else{let r=s.data&&s.data.message?s.data.message:"Invalid response received for shortcode preview.";throw new Error(r)}}).catch(s=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${n}:`,s),e.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${s.message}</p>`}).finally(()=>{t.classList.remove("aipkit_loading")})}window.aipkit_loadInitialChatPreview=a,window.aipkit_refreshChatPreview=i})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a){console.warn("AIPKit Chat Accordions: Main content container not found.");return}a.addEventListener("click",function(i){let n=i.target.closest(".aipkit_accordion-header");if(!n)return;let e=n.closest(".aipkit_accordion");if(!e)return;let t=n.nextElementSibling;if(!t||!t.classList.contains("aipkit_accordion-content"))return;if(e.classList.contains("aipkit_popup_settings_accordion")){e.style.display!=="none"&&(n.classList.toggle("aipkit_active"),t.classList.toggle("aipkit_active"));return}let o=e.closest(".aipkit_accordion-group");o&&o.querySelectorAll(".aipkit_accordion").forEach(s=>{if(s!==e){let r=s.querySelector(".aipkit_accordion-header"),c=s.querySelector(".aipkit_accordion-content");r&&r.classList.contains("aipkit_active")&&r.classList.remove("aipkit_active"),c&&c.classList.contains("aipkit_active")&&c.classList.remove("aipkit_active")}}),n.classList.toggle("aipkit_active"),t.classList.toggle("aipkit_active")})}window.aipkit_initChatAccordions=d})();(function(){"use strict";function d(){let t=document.getElementById("aipkit_chatbot_main_tab_content_container");t&&(t.addEventListener("change",function(o){let s=o.target.closest(".aipkit_popup_toggle_switch");if(s){let l=s.closest(".aipkit_chatbot-settings-area");l&&(a(l,s.checked),n(l,s));return}let r=o.target.closest('input[name="popup_icon_type"]');if(r){let l=r.closest(".aipkit_chatbot-settings-area");l&&i(l,r.value);return}let c=o.target.closest(".aipkit_voice_input_toggle_switch");if(c){let l=c.closest(".aipkit_chatbot-settings-area");l&&e(l,c.checked);return}}),t.querySelectorAll(".aipkit_chatbot-settings-area").forEach(o=>{let s=o.querySelector(".aipkit_popup_toggle_switch");s&&(a(o,s.checked),n(o,s));let r=o.querySelector('input[name="popup_icon_type"]:checked');r?i(o,r.value):o.querySelector('input[name="popup_icon_type"][value="default"]')&&i(o,"default");let c=o.querySelector(".aipkit_voice_input_toggle_switch");c&&e(o,c.checked)}))}function a(t,o){let s=t.querySelector(".aipkit_popup_settings_accordion");if(s&&(s.style.display=o?"block":"none",!o)){let c=s.querySelector(".aipkit_accordion-header"),l=s.querySelector(".aipkit_accordion-content");c&&c.classList.remove("aipkit_active"),l&&l.classList.remove("aipkit_active")}let r=t.querySelector(".aipkit_popup_icon_options_container");r&&(r.style.display=o?"block":"none")}function i(t,o){let s=t.querySelector(".aipkit_popup_icon_default_selector_container"),r=t.querySelector(".aipkit_popup_icon_custom_input_container");s&&(s.style.display=o==="default"?"block":"none"),r&&(r.style.display=o==="custom"?"block":"none")}function n(t,o){let s=o.checked,r=o.getAttribute("data-sidebar-target"),c=t.querySelector("#"+r);if(!c)return;let l=c.querySelector(".aipkit_sidebar_toggle_switch"),p=c.querySelector("label");if(!l||!p)return;let _=c.getAttribute("data-tooltip-disabled")||"";s?(l.getAttribute("data-original-state")===null&&l.setAttribute("data-original-state",l.checked?"checked":"unchecked"),l.checked=!1,l.disabled=!0,c.setAttribute("title",_),c.classList.add("aipkit-disabled-tooltip"),p.style.opacity="0.6"):(l.disabled=!1,c.removeAttribute("title"),c.classList.remove("aipkit-disabled-tooltip"),p.style.opacity="1",l.getAttribute("data-original-state")==="checked"&&(l.checked=!0),l.removeAttribute("data-original-state"))}function e(t,o){let s=t.querySelector(".aipkit_stt_provider_conditional_row");s&&(s.style.display="none")}window.aipkit_initAppearanceToggles=d,window.aipkit_togglePopupDependentSettingsVisibility=a,window.aipkit_toggleSidebarCheckboxState=n,window.aipkit_togglePopupIconValueInputs=i,window.aipkit_toggleSttSettingsVisibility=e})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");a&&(a.addEventListener("change",function(i){let n=i.target.closest(".aipkit_starters_toggle_switch");if(!n)return;let e=n.closest(".aipkit_chatbot-settings-area");if(!e)return;let t=e.querySelector(".aipkit_starters_conditional_row");t&&(t.style.display=n.checked?"block":"none")}),a.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{let n=i.querySelector(".aipkit_starters_toggle_switch"),e=i.querySelector(".aipkit_starters_conditional_row");n&&e&&(e.style.display=n.checked?"block":"none")}))}window.aipkit_initConversationStartersToggle=d})();(function(){"use strict";function d(i){let n=i.closest(".aipkit_tab_dropdown_container");if(!n)return;let e=n.querySelector(".aipkit_tab_dropdown_menu");if(!e)return;let t=e.style.display==="none"||!e.style.display;e.style.display=t?"block":"none"}function a(){let i=document.getElementById("aipkit_chatbot_main_selector_container");if(!i)return;let n="data-dropdown-outside-click-listener";document.body.getAttribute(n)||(document.addEventListener("click",function(e){let t=i.querySelector('.aipkit_tab_dropdown_menu[style*="display: block"]');if(!t)return;let o=i.querySelector(".aipkit_tab_dropdown_trigger");!t.contains(e.target)&&(!o||!o.contains(e.target))&&(t.style.display="none")},!0),document.body.setAttribute(n,"true"))}window.aipkit_chatTabs_toggleMoreBotsDropdown=d,window.aipkit_chatTabs_initDropdownOutsideClickListener=a})();(function(){"use strict";function d(e){let t=e.target.closest(".aipkit_tab_button, .aipkit_tab_dropdown_item");t&&(e.key==="Enter"?(e.preventDefault(),window.aipkit_chatTabs_saveNewName(t)):e.key==="Escape"&&(e.preventDefault(),window.aipkit_chatTabs_exitEditMode(t)))}function a(e){let t=e.querySelector(".aipkit_tab_name_display"),o=e.querySelector(".aipkit_tab_edit_container"),s=e.querySelector(".aipkit_tab_edit_btn"),r=e.querySelector(".aipkit_tab_icon");if(!t||!o){console.error("AIPKit Edit Mode Error: nameDisplay or editContainer not found!");return}let c=t.textContent.trim(),l=window.aipkit_escapeHtml||(f=>f),p=window.aipkit_escapeAttribute||(f=>f);o.innerHTML=`
            <input type="text" class="aipkit_tab_name_input" value="${l(c)}" aria-label="${p("New chatbot name")}">
            <button type="button" class="aipkit_btn-save-name" title="${p("Save name")}"><span class="dashicons dashicons-yes-alt"></span></button>
            <button type="button" class="aipkit_btn-cancel-name" title="${p("Cancel rename")}"><span class="dashicons dashicons-no"></span></button>
        `,e.classList.add("aipkit_tab-editing"),t.style.display="none",s&&(s.style.display="none"),r&&(r.style.display="none");let _=o.querySelector(".aipkit_tab_name_input");_?(o.style.display="inline-flex",setTimeout(()=>{_.focus(),_.select()},0),_.removeEventListener("keydown",d),_.addEventListener("keydown",d)):console.error("AIPKit Edit Mode Error: Input field could not be found after creation.")}function i(e,t=null){let o=e.querySelector(".aipkit_tab_name_display"),s=e.querySelector(".aipkit_tab_edit_container"),r=s?s.querySelector(".aipkit_tab_name_input"):null,c=e.querySelector(".aipkit_tab_edit_btn"),l=e.querySelector(".aipkit_tab_icon");if(r&&r.removeEventListener("keydown",d),s&&(s.innerHTML="",s.style.display="none"),e.classList.remove("aipkit_tab-editing"),o&&(o.style.display=""),c&&(c.style.display=""),l&&(l.style.display=""),t!==null&&o&&(o.textContent=t,e.classList.contains("aipkit_active"))){let f=document.getElementById("aipkit_chatbot_main_selector_container")?.querySelector(".aipkit_active_bot_name_display");f&&(f.textContent=t)}let p=e.querySelector(".aipkit_tab_rename_status");p&&p.textContent!==""&&setTimeout(()=>{p&&(p.textContent=""),p.className="aipkit_tab_rename_status"},3e3)}function n(e){let t=e.querySelector(".aipkit_tab_name_input"),o=e.querySelector(".aipkit_tab_rename_status");if(!t||!o)return;let s=e.getAttribute("data-bot-id"),r=t.value.trim(),c=e.querySelector(".aipkit_tab_name_display"),l=c?c.textContent.trim():"";if(!s||!r||r===l){i(e);return}t.disabled=!0,o.textContent="Saving...",o.className="aipkit_tab_rename_status",window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:s,new_name:r}).then(p=>{o.textContent=p.message||"Renamed!",o.classList.add("success"),i(e,p.new_name||r)}).catch(p=>{console.error("AIPKit Debug: Rename error:",p),o.textContent="Error: "+(p.message||"Could not rename"),o.classList.add("error"),t.disabled=!1,t.focus(),setTimeout(()=>{o&&(o.textContent=""),o.className="aipkit_tab_rename_status"},4e3)})}window.aipkit_chatTabs_enterEditMode=a,window.aipkit_chatTabs_exitEditMode=i,window.aipkit_chatTabs_saveNewName=n})();(function(){"use strict";let d="aipkit_last_selected_chatbot";function a(s){try{localStorage.setItem(d,s)}catch(r){console.warn("AIPKit Chat: Failed to save chatbot to localStorage:",r)}}function i(){try{return localStorage.getItem(d)}catch(s){return console.warn("AIPKit Chat: Failed to retrieve chatbot from localStorage:",s),null}}function n(){try{localStorage.removeItem(d)}catch(s){console.warn("AIPKit Chat: Failed to clear chatbot from localStorage:",s)}}function e(){let s=i();s&&setTimeout(()=>{let r=document.querySelector(`[data-bot-id="${s}"]`);if(!r){localStorage.removeItem(d);return}if(!r.classList.contains("aipkit_active")&&typeof window.aipkit_loadModule=="function"){let c={force_active_bot_id:s};window.aipkit_loadModule("chatbot",c)}},200)}function t(){let s=document.getElementById("aipkit_chatbot_main_selector_container");if(!s){console.warn("AIPKit Chat Main Tabs: Container not found.");return}typeof window.aipkit_chatTabs_initDropdownOutsideClickListener=="function"&&window.aipkit_chatTabs_initDropdownOutsideClickListener(),s.addEventListener("click",function(r){let c=r.target,l=c.closest(".aipkit_tab_button, .aipkit_tab_dropdown_item");if(c.closest(".aipkit_tab_dropdown_trigger")){r.stopPropagation(),typeof window.aipkit_chatTabs_toggleMoreBotsDropdown=="function"&&window.aipkit_chatTabs_toggleMoreBotsDropdown(c.closest(".aipkit_tab_dropdown_trigger"));return}let p=c.closest(".aipkit_tab_dropdown_item");if(p){if(c.matches(".aipkit_tab_edit_btn")||c.closest(".aipkit_tab_edit_btn")){if(r.stopPropagation(),!p.classList.contains("aipkit_tab-editing")&&typeof window.aipkit_chatTabs_enterEditMode=="function"){let m=s.querySelector(".aipkit_tab_dropdown_item.aipkit_tab-editing");m&&m!==p&&window.aipkit_chatTabs_exitEditMode(m),window.aipkit_chatTabs_enterEditMode(p)}return}if(c.matches(".aipkit_btn-save-name")||c.closest(".aipkit_btn-save-name")){r.stopPropagation(),typeof window.aipkit_chatTabs_saveNewName=="function"&&window.aipkit_chatTabs_saveNewName(p);return}if(c.matches(".aipkit_btn-cancel-name")||c.closest(".aipkit_btn-cancel-name")){r.stopPropagation(),typeof window.aipkit_chatTabs_exitEditMode=="function"&&window.aipkit_chatTabs_exitEditMode(p);return}if(c.closest(".aipkit_tab_edit_container"))return}if(!l)return;if(l.classList.contains("aipkit_active")){if(l.classList.contains("aipkit_tab_dropdown_item")){let m=l.closest(".aipkit_tab_dropdown_menu");m&&(m.style.display="none")}return}let _=l.getAttribute("data-tab-type"),f=l.getAttribute("data-bot-id")||"";if(typeof window.aipkit_loadModule!="function"){console.error("AIPKit Tabs: aipkit_loadModule function is not available."),alert("Error: Cannot switch chatbot view.");return}if(l.classList.contains("aipkit_tab_dropdown_item")){let m=l.closest(".aipkit_tab_dropdown_menu");m&&(m.style.display="none")}let u={};_==="bot"&&f?(u={force_active_bot_id:f},a(f)):_==="create"&&(u={force_active_tab:"create"}),window.aipkit_loadModule("chatbot",u)})}function o(){e()}window.aipkit_initChatbotMainTabs=t,window.aipkit_loadLastSelectedChatbot=o,window.aipkit_clearLastSelectedChatbot=n})();(function(){"use strict";function d(i){if(!i)return;let n=i.querySelector(".aipkit_token_limit_mode_select"),e=i.querySelector(".aipkit_token_general_user_limit_field"),t=i.querySelector(".aipkit_token_role_limits_container");if(!n||!e||!t){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let o=n.value;e.style.display=o==="general"?"block":"none",t.style.display=o==="role_based"?"block":"none"}function a(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit Token Management JS: Main content container not found.");return}i.addEventListener("change",function(e){let t=e.target.closest(".aipkit_token_limit_mode_select");if(!t)return;let o=t.closest(".aipkit_accordion-content");o?d(o):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",t)}),i.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(e=>{let t=e.querySelector(".aipkit_accordion-content");t&&d(t)})}window.aipkit_initTokenManagementUI=a})();(function(){"use strict";window.aipkitIndexingIntervals=window.aipkitIndexingIntervals||{};let a=window.aipkit_escapeHtml||(v=>v||"");function i(){return window.aipkit_index_content_nonce||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||""}function n(v,E){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is not available.")):window.aipkit_apiRequest(v,{...E,_ajax_nonce:i()})}function e(v,E){v&&(v.innerHTML=`
            <div class="aipkit_indexing_error">
                <h4>\u274C Setup Failed</h4>
                <div>${a(E)}</div>
                <button type="button" class="aipkit_btn aipkit_btn-outline" data-action="close-setup">Close</button>
            </div>`)}function t(v,E,L="info"){let A=document.getElementById(`aipkit_indexing_status_${v}`);if(A){let F=new Date().toLocaleTimeString(),B=document.createElement("div");B.className=`aipkit_status_message_${L}`,B.innerHTML=`<span class="aipkit_message_timestamp">[${F}]</span> ${a(E)}`,A.appendChild(B),A.scrollTop=A.scrollHeight}}function o(v,E,L,A=null,F=null){let B=document.getElementById(`aipkit_progress_bar_${v}`),D=document.getElementById(`aipkit_progress_text_${v}`);if(B&&(B.style.width=`${Math.max(0,Math.min(100,E))}%`),D){let O=L||"Processing...";A!==null&&F!==null&&F>0&&(O=`Indexing post ${A} of ${F}`),D.innerHTML=a(O)}}function s(v){if(!v)return;let E=v.id.match(/(\d+)/);if(E){let L=E[1];window.aipkitIndexingIntervals[L]&&(clearInterval(window.aipkitIndexingIntervals[L]),delete window.aipkitIndexingIntervals[L])}v.style.display="none",v.innerHTML=""}function r(v){return`
            <div class="aipkit_indexing_progress">
                <div><h4 id="aipkit_progress_text_${v}">Initializing...</h4></div>
                <div class="aipkit_progress_bar_container"><div id="aipkit_progress_bar_${v}" class="aipkit_progress_bar"></div></div>
                <div class="aipkit_control_buttons">
                    <button type="button" id="aipkit_stop_indexing_${v}" class="aipkit_btn aipkit_btn-danger" data-action="stop-indexing">Stop</button>
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_details_toggle" data-action="toggle-details">Details</button>
                </div>
                <div id="aipkit_indexing_details_${v}" class="aipkit_indexing_details" style="display: none;">
                    <div id="aipkit_indexing_status_${v}" class="aipkit_indexing_status"><div>Starting process...</div></div>
                </div>
            </div>`}function c(v){return Array.from(document.querySelectorAll(`input[name="post_types_${v}"]:checked`)).map(E=>E.value)}function l(v,E){let L=E.querySelector(".aipkit_config_summary");if(!!!E.querySelector("select[data-is-inline-edit]"))return JSON.parse(L.dataset.config||"{}");let F=document.getElementById(`aipkit_inline_provider_${v}`);if(!F)return console.error("Could not find provider select in edit mode."),JSON.parse(L.dataset.config||"{}");let B={provider:F.value},D=document.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${v}"] .aipkit_tab_name_display, .aipkit_tab_button[data-bot-id="${v}"] .aipkit_tab_name_display`),O=D?D.textContent.trim().toLowerCase().replace(/[^a-z0-9]/g,"-"):"bot",N=new Date().toISOString().slice(0,19).replace(/[-T:]/g,"");if(B.provider==="openai"?B.store_name=`chatbot-${O}-${v}-${N}`:B.provider==="pinecone"?B.index_name=`chatbot-${v}-${N}`:B.provider==="qdrant"&&(B.collection_name=`chatbot_${O}_${v}_${N}`),B.provider!=="openai"){let U=document.getElementById(`aipkit_inline_embedding_provider_${v}`),K=document.getElementById(`aipkit_inline_embedding_model_${v}`);U&&K&&(B.embedding_provider=U.value,B.embedding_model=K.value)}return B}function p(v,E,L){let{content_types:A,display_info:F}=L,B=`
            <div class="aipkit_content_selection">
                <h5>Content to Index:</h5>
                <div class="aipkit_checkbox_group">
                    ${A.map(O=>`<label><input type="checkbox" name="post_types_${v}" value="${a(O.slug)}" checked> ${a(O.label)} (${O.count})</label>`).join("")}
                </div>
            </div>`,D=y(v,F);E.innerHTML=`
            <div class="aipkit_config_summary" data-config='${a(JSON.stringify(L.config))}'>
                <div class="aipkit_config_summary_header">${D}</div>
                ${B}
            </div>
            <div class="aipkit_setup_actions">
                <button type="button" class="aipkit_btn aipkit_btn-outline aipkit_btn-small" data-action="close-setup">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-success aipkit_btn-small" data-action="start-indexing">Proceed</button>
            </div>`}function _(v,E){let L=document.getElementById(`aipkit_progress_text_${v}`),F={completed:{icon:"yes-alt",text:"Completed",log:`\u{1F389} Indexing completed! Indexed ${E.indexed_posts} of ${E.total_posts} items.`,type:"success",reload:!0,delay:2e3},failed:{icon:"dismiss",text:"Failed",log:`\u274C Indexing failed: ${E.error_message}`,type:"error",reload:!1,delay:3e3},cancelled:{icon:"controls-pause",text:"Cancelled",log:"\u23F9\uFE0F Indexing process was cancelled.",type:"info",reload:!1,delay:2e3}}[E.status];F&&(L&&(L.innerHTML=`<span class="dashicons dashicons-${F.icon} aipkit_status_${E.status}"></span> ${F.text}`),t(v,F.log,F.type),setTimeout(()=>{if(F.reload)location.reload();else{let B=document.getElementById(`aipkit_bot_${v}_index_setup_container`);B&&s(B)}},F.delay)),window.aipkitIndexingIntervals[v]&&(clearInterval(window.aipkitIndexingIntervals[v]),delete window.aipkitIndexingIntervals[v])}function f(v,E){let L=async()=>{try{let A=await n("aipkit_get_indexing_progress",{process_id:E});if(o(v,A.percentage,A.current_task,A.indexed_posts,A.total_posts),A.messages?.length){let F=document.getElementById(`aipkit_indexing_status_${v}`);F&&(F.innerHTML=""),A.messages.forEach(B=>t(v,B.text,B.type))}["completed","failed","cancelled"].includes(A.status)&&_(v,A)}catch(A){_(v,{status:"failed",error_message:A.message})}};window.aipkitIndexingIntervals[v]=setInterval(L,2e3)}async function u(v,E){try{let L=await n("aipkit_get_indexing_progress",{process_id:E});if(o(v,L.percentage,L.current_task||"Resuming...",L.indexed_posts,L.total_posts),L.messages?.length){let A=document.getElementById(`aipkit_indexing_status_${v}`);A&&(A.innerHTML=""),L.messages.forEach(F=>t(v,F.text,F.type))}["completed","failed","cancelled"].includes(L.status)&&_(v,L)}catch(L){console.warn(`Failed to get current progress for bot ${v}:`,L),t(v,"\u26A0\uFE0F Failed to resume progress display.","warning")}}function m(v,E,L){L.innerHTML=r(v),L.style.display="block";let A=document.getElementById(`aipkit_stop_indexing_${v}`);A&&(A.dataset.processId=E),t(v,"\u{1F504} Resuming process...","info"),f(v,E),u(v,E)}async function g(v,E){try{let L=await n("aipkit_check_indexing_status",{bot_id:v});if(L.active_process&&L.process_id)return m(v,L.process_id,E),!0}catch(L){console.warn(`Failed to check indexing status for bot ${v}:`,L)}return!1}async function k(v,E){E.innerHTML='<div class="aipkit_indexing_loading"><span class="aipkit_spinner"></span> Analyzing configuration...</div>',E.style.display="block";try{let L=await n("aipkit_analyze_express_setup",{bot_id:v});p(v,E,L)}catch(L){e(E,L.message)}}async function w(v,E){let L=c(v),A=l(v,E);E.innerHTML=r(v);try{let F=await n("aipkit_start_content_indexing",{bot_id:v,mode:"express",content_types:JSON.stringify(L),config:JSON.stringify(A)}),B=document.getElementById(`aipkit_stop_indexing_${v}`);B&&(B.dataset.processId=F.process_id),f(v,F.process_id)}catch(F){e(E,F.message)}}async function h(v){let E=document.getElementById(`aipkit_stop_indexing_${v}`),L=E?.dataset.processId;if(!L){console.error("Stop Error: Process ID is missing."),t(v,"\u26A0\uFE0F Error: Process ID not found.","error");return}E.disabled=!0,E.textContent="Stopping...",window.aipkitIndexingIntervals[v]&&(clearInterval(window.aipkitIndexingIntervals[v]),delete window.aipkitIndexingIntervals[v]);try{await n("aipkit_cancel_content_indexing",{process_id:L}),t(v,"\u23F9\uFE0F Stop signal sent. Process will halt shortly.","info")}catch(A){t(v,`\u26A0\uFE0F Could not send stop signal: ${A.message}`,"error")}finally{let A=document.getElementById(`aipkit_progress_text_${v}`);A&&(A.innerHTML='<span class="dashicons dashicons-controls-pause aipkit_status_stopped"></span> Stopped'),setTimeout(()=>{let F=document.getElementById(`aipkit_bot_${v}_index_setup_container`);F&&s(F)},2e3)}}function b(v){let E={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"},L={openai:"OpenAI",google:"Google"},A={provider_name:E[v.provider]||C(v.provider),provider_key:v.provider};return v.provider==="openai"?(A.store_label="Vector Store",A.store_name=v.store_name):(A.store_label=v.provider==="pinecone"?"Index":"Collection",A.store_name=v.provider==="pinecone"?v.index_name:v.collection_name,A.embedding_provider=L[v.embedding_provider]||C(v.embedding_provider),A.embedding_model=v.embedding_model),A}function y(v,E){let L=`
            <div class="aipkit_provider_info_item"><strong>Vector DB:</strong> ${a(E.provider_name)} <a href="#" data-action="edit-setup" class="aipkit_edit_setup_link">- Change</a></div>
            <div class="aipkit_provider_info_item"><strong>${a(E.store_label)}:</strong> ${a(E.store_name)}</div>`;return E.embedding_provider&&(L+=`<div class="aipkit_provider_info_item"><strong>Embedding Provider:</strong> ${a(E.embedding_provider)}</div>`),E.embedding_model&&(L+=`<div class="aipkit_provider_info_item"><strong>Embedding Model:</strong> ${a(E.embedding_model)}</div>`),`<div>${L}</div>`}function S(v,E){let L=E.provider==="pinecone"?"Index":E.provider==="qdrant"?"Collection":"Vector Store",A=E.provider==="pinecone"?E.index_name:E.provider==="qdrant"?E.collection_name:E.store_name,F=`
            <div class="aipkit_provider_info_item"><strong>Vector DB:</strong>
                <select id="aipkit_inline_provider_${v}" class="aipkit_form-input" data-is-inline-edit="true" style="display: inline-block; width: auto; margin-left: 5px;">
                    <option value="openai" ${E.provider==="openai"?"selected":""}>OpenAI</option>
                    <option value="pinecone" ${E.provider==="pinecone"?"selected":""}>Pinecone</option>
                    <option value="qdrant" ${E.provider==="qdrant"?"selected":""}>Qdrant</option>
                </select>
                <a href="#" data-action="edit-setup" class="aipkit_edit_setup_link">- Hide</a>
            </div>
            <div class="aipkit_provider_info_item"><strong>${a(L)}:</strong> <span>${a(A)}</span></div>`;return E.provider!=="openai"&&(F+=`
                <div class="aipkit_provider_info_item"><strong>Embedding Provider:</strong>
                    <select id="aipkit_inline_embedding_provider_${v}" class="aipkit_form-input" data-is-inline-edit="true" style="display: inline-block; width: auto; margin-left: 5px;">
                        <option value="openai" ${E.embedding_provider==="openai"?"selected":""}>OpenAI</option>
                        <option value="google" ${E.embedding_provider==="google"?"selected":""}>Google</option>
                    </select>
                </div>
                <div class="aipkit_provider_info_item"><strong>Embedding Model:</strong>
                    <select id="aipkit_inline_embedding_model_${v}" class="aipkit_form-input" data-is-inline-edit="true" style="display: inline-block; width: auto; margin-left: 5px;"></select>
                </div>`),`<div>${F}</div>`}function I(v,E=null){let L=document.getElementById(`aipkit_inline_embedding_provider_${v}`),A=document.getElementById(`aipkit_inline_embedding_model_${v}`);if(!L||!A)return;let F=L.value;A.innerHTML="";let B=(F==="openai"?window.aipkit_chat_config.openaiEmbeddingModels:window.aipkit_chat_config.googleEmbeddingModels)||[];B.length>0?B.forEach(D=>{let O=new Option(a(D.name||D.id),D.id);E&&D.id===E&&(O.selected=!0),A.appendChild(O)}):A.innerHTML='<option value="">(Sync in AI Settings)</option>'}function x(v,E){let L=document.getElementById(`aipkit_inline_provider_${v}`),A=document.getElementById(`aipkit_inline_embedding_provider_${v}`);L&&L.addEventListener("change",()=>q(v,E)),A&&A.addEventListener("change",()=>I(v))}function q(v,E){let L=document.getElementById(`aipkit_inline_provider_${v}`).value,A={provider:L,embedding_provider:"openai"},F=document.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${v}"] .aipkit_tab_name_display, .aipkit_tab_button[data-bot-id="${v}"] .aipkit_tab_name_display`),B=F?F.textContent.trim().toLowerCase().replace(/[^a-z0-9]/g,"-"):"bot",D=new Date().toISOString().slice(0,19).replace(/[-T:]/g,"");L==="openai"?A.store_name=`chatbot-${B}-${v}-${D}`:L==="pinecone"?A.index_name=`chatbot-${v}-${D}`:L==="qdrant"&&(A.collection_name=`chatbot_${B}_${v}_${D}`);let O=E.querySelector(".aipkit_config_summary_header");O.innerHTML=S(v,A),I(v),x(v,E)}function $(v,E){let L=E.querySelector(".aipkit_config_summary"),A=E.querySelector(".aipkit_config_summary_header");if(!!E.querySelector("select[data-is-inline-edit]")){let B=JSON.parse(L.dataset.config||"{}"),D=document.getElementById(`aipkit_inline_provider_${v}`);if(D&&D.value!==B.provider){let O=l(v,E),N=b(O);A.innerHTML=y(v,N),L.dataset.config=JSON.stringify(O)}else{let O=b(B);A.innerHTML=y(v,O)}}else{let B=JSON.parse(L.dataset.config||"{}");A.innerHTML=S(v,B),I(v,B.embedding_model),x(v,E)}}async function M(v){v.preventDefault();let L=v.currentTarget.dataset.botId,A=document.getElementById(`aipkit_bot_${L}_index_setup_container`);if(!A)return;if(A.style.display!=="none"&&A.innerHTML.trim()!==""){s(A);return}await g(L,A)||await k(L,A)}function T(){document.querySelectorAll(".aipkit_index_content_trigger").forEach(async v=>{let E=v.dataset.botId,L=document.getElementById(`aipkit_bot_${E}_index_setup_container`);L&&await g(E,L)})}function P(){document.querySelectorAll(".aipkit_index_content_trigger").forEach(E=>{E.addEventListener("click",M)});let v=document.getElementById("aipkit_chatbot_main_tab_content_container");v&&v.addEventListener("click",function(E){let L=E.target.closest("button, a");if(!L)return;let A=L.dataset.action,F=L.closest(".aipkit_index_setup_container"),B=L.closest(".aipkit_indexing_progress"),D=F?.id.match(/(\d+)/)?.[1]||B?.closest(".aipkit_index_setup_container")?.id.match(/(\d+)/)?.[1];if(!D)return;let O=document.getElementById(`aipkit_bot_${D}_index_setup_container`);switch(A){case"close-setup":O&&s(O);break;case"start-indexing":O&&w(D,O);break;case"stop-indexing":h(D);break;case"edit-setup":E.preventDefault(),O&&$(D,O);break;case"toggle-details":let N=document.getElementById(`aipkit_indexing_details_${D}`);if(N){let U=N.style.display==="none";N.style.display=U?"block":"none",L.textContent=U?"Hide":"Details",L.classList.toggle("aipkit_active",U)}break}}),T()}function C(v){return v?v.charAt(0).toUpperCase()+v.slice(1):""}window.aipkitIndexContent={hideSetup:v=>s(document.getElementById(`aipkit_bot_${v}_index_setup_container`))},window.aipkit_initChatbotIndexContent=P})();(function(){"use strict";function d(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let i=document.querySelector(".aipkit_chatbot_module_container");i&&(i.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js."),typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCreateNewBot=="function"?window.aipkit_initCreateNewBot():console.error("AIPKit Chat Admin Main: aipkit_initCreateNewBot function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initChatAccordions=="function"?window.aipkit_initChatAccordions():console.error("AIPKit Chat Admin Main: aipkit_initChatAccordions function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_initChatbotMainTabs=="function"?window.aipkit_initChatbotMainTabs():console.error("AIPKit Chat Admin Main: aipkit_initChatbotMainTabs function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found."),typeof window.aipkit_initChatbotIndexContent=="function"?window.aipkit_initChatbotIndexContent():console.error("AIPKit Chat Admin Main: aipkit_initChatbotIndexContent function not found.");let a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(a){let i=a.dataset.botId,n=document.getElementById(`aipkit_trigger_builder_${i}`);i&&n&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(i):i&&n&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${i}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy()}window.aipkit_initChatbot=d})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"title",sortDirection:"asc",filterProvider:"all",isLoading:!1}})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_ai_forms_list_tbody"),n=window.aipkit_escapeHtml||(t=>t),e=wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t;i&&(i.innerHTML="",!(!a||a.length===0)&&a.forEach(t=>{let o=window.aipkit_dashboard?.isProPlan??!1,r=(window.aipkit_dashboard?.addons??{}).pdf_download??!1,c="";if(o&&r)c=`
              <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="pdf_download" value="true">
                  <span>${e("Save as PDF","gpt3-ai-content-generator")}</span>
              </label>`;else{let f=e(o?"Activate the 'PDF Download' addon to use this feature.":"This is a Pro feature. Please upgrade.","gpt3-ai-content-generator"),u=o?`<span class="aipkit_status-tag">${e("Addon inactive","gpt3-ai-content-generator")}</span>`:`<a href="${window.aipkit_dashboard.upgradeUrl}" target="_blank" class="aipkit_status-tag" style="background-color: #fef3c7; color: #92400e; border: 1px solid #fde68a;">${e("Pro","gpt3-ai-content-generator")}</a>`;c=`
              <div class="aipkit_config_item_locked" title="${n(f)}">
                  <label class="aipkit_config_item" style="opacity: 0.5; cursor: not-allowed;">
                      <input type="checkbox" disabled>
                      <span>${e("Save as PDF","gpt3-ai-content-generator")}</span>
                  </label>
                  ${u}
              </div>`}let l=i.insertRow();l.insertCell().textContent=t.id,l.insertCell().textContent=n(t.title),l.insertCell().innerHTML=`<span class="aipkit_status-tag">${n(t.provider||"Default")}</span>`,l.insertCell().textContent=n(t.model||"Default");let p=l.insertCell();p.classList.add("aipkit_shortcode_cell"),p.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${t.id}" readonly value="${n(t.shortcode)}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${t.id}" title="${e("Configure Shortcode","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-settings"></span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator" id="aif-configurator-${t.id}" style="display: none;">
            <div class="aipkit_config_section">
                <h6>${e("Display Options","gpt3-ai-content-generator")}</h6>
                <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="show_provider" value="true">
                  <span>${e("Show Provider Select","gpt3-ai-content-generator")}</span>
                </label>
                <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="show_model" value="true">
                  <span>${e("Show Model Select","gpt3-ai-content-generator")}</span>
                </label>
            </div>
            <div class="aipkit_config_section">
                <h6>${e("Functionality","gpt3-ai-content-generator")}</h6>
                 <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="copy_button" value="true">
                  <span>${e("Copy Button","gpt3-ai-content-generator")}</span>
                </label>
                 <label class="aipkit_config_item">
                  <input type="checkbox" class="aipkit-aiform-config-input" data-form-id="${t.id}" data-attr-name="save_button" value="true">
                  <span>${e("Save as Post","gpt3-ai-content-generator")}</span>
                </label>
                ${c}
            </div>
            <div class="aipkit_config_section">
                <h6>${e("Theme","gpt3-ai-content-generator")}</h6>
                <select class="aipkit-aiform-config-input aipkit_form-input" data-form-id="${t.id}" data-attr-name="theme">
                    <option value="light">${e("Light (default)","gpt3-ai-content-generator")}</option>
                    <option value="dark">${e("Dark","gpt3-ai-content-generator")}</option>
                    <option value="custom">${e("Custom","gpt3-ai-content-generator")}</option>
                </select>
            </div>
        </div>
      `;let _=l.insertCell();_.classList.add("aipkit_form_actions_cell"),_.innerHTML=`
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_edit_ai_form_btn" data-form-id="${t.id}" title="${e("Edit","gpt3-ai-content-generator")}"><span class="dashicons dashicons-edit"></span></button>
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_duplicate_ai_form_btn" data-form-id="${t.id}" title="${e("Duplicate","gpt3-ai-content-generator")}"><span class="dashicons dashicons-admin-page"></span></button>
        <button class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn aipkit_export_ai_form_btn" data-form-id="${t.id}" title="${e("Export","gpt3-ai-content-generator")}"><span class="dashicons dashicons-download"></span></button>
        <button class="aipkit_btn aipkit_btn-danger aipkit_icon_btn aipkit_delete_ai_form_btn" data-form-id="${t.id}" data-form-title="${n(t.title)}" title="${e("Delete","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
      `}))}window.aipkitForms_renderTable=d})();(function(){"use strict";function d(a){let i=window.aipkitAIFormsListState,n=document.getElementById("aipkit_ai_forms_pagination");if(!n||!a||!i)return;n.innerHTML="";let{total_forms:e,total_pages:t}=a,o=i.currentPage;if(e<=0)return;let s=document.createElement("span");if(s.className="aipkit_pagination-count",s.textContent=`${e.toLocaleString()} form(s) found`,n.appendChild(s),t>1){let r=document.createElement("span");r.className="aipkit_pagination-links";let c=document.createElement("button");c.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",c.innerHTML="\xAB Previous",c.disabled=o<=1,r.appendChild(c);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`Page ${o} of ${t}`,r.appendChild(l);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",p.innerHTML="Next \xBB",p.disabled=o>=t,r.appendChild(p),n.appendChild(r)}}window.aipkitForms_renderPagination=d})();(function(){"use strict";function d(){let a=window.aipkitAIFormsListState;if(!a||a.isLoading)return;a.isLoading=!0;let i=document.getElementById("aipkit_ai_forms_list_tbody"),n=document.getElementById("aipkit_no_ai_forms_message"),e=document.getElementById("aipkit_ai_forms_pagination");i&&(i.innerHTML='<tr><td colspan="6" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),n&&(n.style.display="none"),e&&(e.innerHTML="");let o={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:a.currentPage,search:a.searchQuery,sort_by:a.sortColumn,sort_order:a.sortDirection,filter_provider:a.filterProvider};window.aipkit_apiRequest("aipkit_list_ai_forms",o).then(s=>{typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(s.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(s.pagination||{}),n&&(!s.forms||s.forms.length===0)&&(n.style.display="block",n.textContent=a.searchQuery?"No forms found matching your search.":"No AI Forms have been created yet.")}).catch(s=>{i&&(i.innerHTML=`<tr><td colspan="6" style="color:red;text-align:center;">Error loading forms: ${s.message}</td></tr>`)}).finally(()=>{a.isLoading=!1})}window.aipkitForms_fetchForms=d})();(function(){"use strict";let d;function a(){let i=document.getElementById("aipkit_ai_forms_list_container");if(!i||i.dataset.listListenersAttached)return;i.dataset.listListenersAttached="true";let n=window.aipkitAIFormsListState;if(!n){console.error("AI Forms Events: List state object is not available.");return}i.addEventListener("click",function(o){let s=o.target,r=wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l,c=s.closest(".aipkit-sortable-col");if(c){let l=c.dataset.sortKey;n.sortColumn===l?n.sortDirection=n.sortDirection==="asc"?"desc":"asc":(n.sortColumn=l,n.sortDirection="asc"),n.currentPage=1,i.querySelectorAll(".aipkit-sortable-col").forEach(p=>p.removeAttribute("data-sort-direction")),c.setAttribute("data-sort-direction",n.sortDirection),window.aipkitForms_fetchForms();return}if(s.matches(".aipkit_pagination_prev")){n.currentPage>1&&(n.currentPage--,window.aipkitForms_fetchForms());return}if(s.matches(".aipkit_pagination_next")){n.currentPage++,window.aipkitForms_fetchForms();return}});let e=i.querySelector("#aipkit_ai_forms_search_input");e&&e.addEventListener("input",function(){clearTimeout(d),d=setTimeout(()=>{n.searchQuery=this.value,n.currentPage=1,window.aipkitForms_fetchForms()},400)});let t=i.querySelector("#aipkit_ai_forms_provider_filter");t&&t.addEventListener("change",function(){n.filterProvider=this.value,n.currentPage=1,window.aipkitForms_fetchForms()})}window.aipkitForms_attachListEventListeners=a})();(function(){"use strict";function d(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=d})();(function(){"use strict";function d(a){let i=window.aipkitAIFormsState;if(!a){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let n=a.querySelector("#aipkit_ai_form_elements_palette"),e=a.querySelector("#aipkit_ai_form_designer_area"),t=a.querySelector("#aipkit_form_designer_placeholder");if(!n||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(n.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;n.querySelectorAll(".aipkit_form_element_item").forEach(s=>{s.dataset.dragStartListenerAttached!=="true"&&(s.addEventListener("dragstart",r=>{i.draggedElementType=r.target.dataset.elementType,r.dataTransfer.setData("text/plain",i.draggedElementType),r.dataTransfer.effectAllowed="copy",r.target.classList.add("aipkit-dragging"),i.draggedElement=null}),s.addEventListener("dragend",r=>{r.target.classList.remove("aipkit-dragging"),i.draggedElementType=null}),s.dataset.dragStartListenerAttached="true")}),n.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",s=>{s.target.classList.contains("aipkit_dropped_element")&&(i.draggedElement=s.target,s.dataTransfer.setData("text/element-id",s.target.id),s.dataTransfer.effectAllowed="move",setTimeout(()=>{i.draggedElement&&(i.draggedElement.style.opacity="0.5")},0),i.draggedElementType=null)}),e.addEventListener("dragend",s=>{i.draggedElement&&(i.draggedElement.style.opacity="1",i.draggedElement=null)}),e.addEventListener("dragover",s=>{s.preventDefault();let r=s.target.closest(".aipkit_dropped_element");e.classList.add("aipkit-drag-over"),i.draggedElement&&r&&i.draggedElement!==r?s.dataTransfer.dropEffect="move":s.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",s=>{e.contains(s.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",s=>{s.preventDefault(),e.classList.remove("aipkit-drag-over");let r=s.dataTransfer.getData("text/element-id");if(i.draggedElement&&r===i.draggedElement.id){let c=s.target.closest(".aipkit_dropped_element"),l=null;if(c&&c!==i.draggedElement){let p=c.getBoundingClientRect();l=s.clientY>p.top+p.height/2?c.nextSibling:c}e.insertBefore(i.draggedElement,l),i.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(i.draggedElementType){if(t&&t.style.display!=="none"&&(t.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let c=window.aipkitForms_createNewFormElementData(i.draggedElementType);i.formStructure.push(c),window.aipkitForms_renderDroppedElement(e,c,null)}i.draggedElementType=null,i.draggedElement=null}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=d})();(function(){"use strict";function d(){let a=window.aipkitAIFormsState,i=document.getElementById("aipkit_ai_form_designer_area");if(!i)return;let n=[];i.querySelectorAll(".aipkit_layout_row").forEach(t=>{let o=t.id,s=a.formStructure.find(l=>l.internalId===o);if(!s)return;let r={internalId:o,type:"layout-row",columns:[]};t.querySelectorAll(".aipkit_layout_column").forEach(l=>{let p=l.id,_=s.columns.find(m=>m.internalId===p);if(!_)return;let f={internalId:p,width:_.width,elements:[]};l.querySelectorAll(".aipkit_dropped_element").forEach(m=>{let g=m.id,k=null;a.formStructure.forEach(w=>{w.columns.forEach(h=>{let b=h.elements.find(y=>y.internalId===g);b&&(k=b)})}),k&&f.elements.push(k)}),r.columns.push(f)}),n.push(r)}),a.formStructure=n}window.aipkitForms_updateFormStructureOrder=d})();(function(){"use strict";function d(i){let n=window.aipkitAIFormsState;n.droppedElementCounter++;let e=`field_${i.replace(/-/g,"_")}_${n.droppedElementCounter}`;switch(i){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:i,label:`New ${i.replace(/-/g," ").replace(/\b\w/g,s=>s.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:e,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let t,o;return i==="select"?(t="New Dropdown",o="select"):i==="radio-button"?(t="New Radio Buttons",o="radio"):(t="New Checkbox Group",o="checkbox"),{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:i,label:t,fieldId:`${o}_${n.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${n.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${n.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function a(i){let n=Date.now(),e=[];switch(i){case"1-col":e=[{internalId:`col-${n}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":e=[{internalId:`col-${n}-1`,width:"50%",elements:[]},{internalId:`col-${n}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":e=[{internalId:`col-${n}-1`,width:"33.33%",elements:[]},{internalId:`col-${n}-2`,width:"33.33%",elements:[]},{internalId:`col-${n}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":e=[{internalId:`col-${n}-1`,width:"30%",elements:[]},{internalId:`col-${n}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":e=[{internalId:`col-${n}-1`,width:"70%",elements:[]},{internalId:`col-${n}-2`,width:"30%",elements:[]}];break;default:e=[{internalId:`col-${n}-1`,width:"100%",elements:[]}]}return{internalId:`row-${n}`,type:"layout-row",columns:e}}window.aipkitForms_createNewFormElementData=d,window.aipkitForms_createNewLayoutData=a})();(function(){"use strict";function d(a,i,n=null){let e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f,t=window.aipkit_escapeHtml||function(f){return f},o=document.createElement("div");o.className="aipkit_dropped_element",o.id=i.internalId,o.dataset.elementType=i.type;let s=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${e("Drag to reorder","gpt3-ai-content-generator")}"></span>`,r="",c=`${i.internalId}-field`,l="";switch(i.helpText&&(l=`<p class="aipkit_dropped_element_help_text">${t(i.helpText)}</p>`),i.type){case"text-input":r=`<label class="aipkit_dropped_element_label" for="${c}">${t(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${c}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${t(i.placeholder)}" readonly>
                    ${l}`;break;case"textarea":r=`<label class="aipkit_dropped_element_label" for="${c}">${t(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${c}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${t(i.placeholder)}" readonly></textarea>
                    ${l}`;break;case"select":let f="";i.options&&i.options.length>0?i.options.forEach(g=>{f+=`<option value="${t(g.value)}">${t(g.text)}</option>`}):f=`<option>${e("No options configured","gpt3-ai-content-generator")}</option>`,r=`<label class="aipkit_dropped_element_label" for="${c}">${t(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${c}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${f}</select>
                    ${l}`;break;case"radio-button":let u="";i.options&&i.options.length>0?i.options.forEach((g,k)=>{let w=`${c}-${k}`;u+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${w}" class="aipkit_dropped_element_field" name="preview-${i.internalId}" disabled>
                                    <label for="${w}">${t(g.text)}</label>
                                </div>`}):u=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,r=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${t(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${u}
                    </fieldset>
                    ${l}`;break;case"checkbox":let m="";i.options&&i.options.length>0?i.options.forEach((g,k)=>{let w=`${c}-${k}`;m+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${w}" class="aipkit_dropped_element_field" name="preview-${i.internalId}-${k}" disabled>
                                    <label for="${w}">${t(g.text)}</label>
                                </div>`}):m=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,r=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${t(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${m}
                    </fieldset>
                    ${l}`;break;case"file-upload":r=`<label class="aipkit_dropped_element_label" for="${c}">${t(i.label)} ${i.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${c}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${l}`;break;default:r=`<p>${t(i.label)}</p>${l}`}let p=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${e("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,_=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${e("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;o.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${r}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${s}
            ${p}
            ${_}
        </div>
    `,n?a.insertBefore(o,n):a.appendChild(o)}window.aipkitForms_renderFieldInColumn=d,window.aipkitForms_renderDroppedElement=d})();(function(){"use strict";function d(a,i){let n=window.aipkitAIFormsState,e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!i){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let t=i.querySelector("#aipkit_ai_form_designer_area");if(!t){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let o=t.querySelector(`#${CSS.escape(a)}`);if(o&&(o.remove(),n.formStructure.forEach(s=>{s.columns.forEach(r=>{r.elements=r.elements.filter(c=>c.internalId!==a)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(i),n.selectedDesignerElementId===a&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(i):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),t.querySelectorAll(".aipkit_dropped_element").length===0&&t.querySelectorAll(".aipkit_layout_row").length===0)){let s=t.querySelector("#aipkit_form_designer_placeholder");s||(s=document.createElement("div"),s.className="aipkit_form_designer_placeholder",s.id="aipkit_form_designer_placeholder",s.innerHTML=`<span class="dashicons dashicons-layout"></span>${e("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,t.appendChild(s)),s.style.display="flex"}}window.aipkitForms_deleteDroppedElement=d})();(function(){"use strict";function d(){let a=window.aipkitAIFormsState,i=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,n=document.getElementById("aipkit_form_editor_container");if(!n)return;let e=n.querySelector("#aipkit_ai_form_prompt_template"),t=n.querySelector("#aipkit_prompt_validation_results");if(!e||!t)return;let o=e.value,s=[],r=[],c=new Set;a.formStructure.forEach(m=>{m.columns.forEach(g=>{g.elements.forEach(k=>{k.fieldId&&c.add(k.fieldId)})})});let l=/{[a-zA-Z0-9_]+}/g,p=(o.match(l)||[]).map(m=>m.slice(1,-1)),_=new Set(p);p.forEach(m=>{c.has(m)||s.push(`Variable <code>{${m}}</code> is used in the prompt but not defined as a form field.`)}),c.forEach(m=>{_.has(m)||r.push(`Field <code>{${m}}</code> is defined but not used in the prompt.`)});let f=o;if(p.forEach(m=>{let g=new RegExp(`\\{${m}\\}`,"g");f=f.replace(g,"")}),/[{}]/.test(f)&&s.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),t.className="aipkit_form-help",t.innerHTML="",s.length>0){t.classList.add("aipkit-validation-error");let m=`<strong>${i("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;s.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>",t.innerHTML=m}else{t.classList.add("aipkit-validation-success");let m=`<strong>${i("Validation Passed!","gpt3-ai-content-generator")}</strong> (${p.length} of ${c.size} fields used).`;r.length>0&&(m+=`<br><strong>${i("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,r.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>"),t.innerHTML=m}t.style.display="block",t.dismissTimer&&clearTimeout(t.dismissTimer);let u=s.length>0?8e3:5e3;t.dismissTimer=setTimeout(()=>{t.style.display="none",t.innerHTML=""},u)}window.aipkitForms_validatePrompt=d})();(function(){"use strict";function d(a,i){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f,o=window.aipkit_escapeHtml||function(f){return f};if(!i){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}i.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(f=>f.classList.remove("aipkit-element-selected"));let s=i.querySelector(`#${CSS.escape(a)}`);s&&s.classList.add("aipkit-element-selected"),n.selectedDesignerElementId=a;let r=null;for(let f of n.formStructure){for(let u of f.columns){let m=u.elements.find(g=>g.internalId===a);if(m){r=m;break}}if(r)break}if(!r){console.error(`showSettingsPanel: Could not find element data for ID ${a} in state.`,n.formStructure);return}let c=i.querySelector("#aipkit_ai_form_elements_palette"),l=i.querySelector("#aipkit_ai_form_element_settings_panel"),p=l?l.querySelector("#aipkit_settings_panel_fields"):null,_=l?l.querySelector("#aipkit_settings_panel_element_type"):null;if(!c||!l||!p||!_){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(_.textContent=`(${r.type.replace(/-/g," ").replace(/\b\w/g,f=>f.toUpperCase())})`,p.innerHTML="",p.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${r.internalId}">${t(e.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${r.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="label" value="${o(r.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${r.internalId}">${t(e.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${r.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="fieldId" value="${o(r.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${t("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${t(e.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(r.type==="text-input"||r.type==="textarea")&&(p.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${r.internalId}">${t(e.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${r.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="placeholder" value="${o(r.placeholder||"")}">
                </div>`),p.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${r.internalId}">
                    <input type="checkbox" id="setting-required-${r.internalId}" class="aipkit-setting-field" data-setting="required" ${r.required?"checked":""}>
                    ${t(e.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${r.internalId}">${t("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${r.internalId}" class="aipkit_form-input aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${o(t("This text will appear under the field.","gpt3-ai-content-generator"))}">${o(r.helpText||"")}</textarea>
            </div>
        `,r.type==="select"||r.type==="radio-button"||r.type==="checkbox"){let f=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${t(e.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(r.options||[]).forEach((u,m)=>{f+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${m}" value="${o(u.value)}" placeholder="${t(e.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${m}" value="${o(u.text)}" placeholder="${t(e.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${t(e.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),f+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${t(e.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,p.innerHTML+=f}c.style.display="none",l.style.display="block"}window.aipkitForms_showSettingsPanel=d})();(function(){"use strict";function d(a){let i=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:r=>r;if(!a){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let e=a.querySelector("#aipkit_ai_form_element_settings_panel");if(!e){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let t=e.querySelector("#aipkit_select_options_container");if(!t){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let o=t.querySelectorAll(".aipkit_select_option_row").length,s=document.createElement("div");s.className="aipkit_select_option_row",s.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${o}" placeholder="${n(i.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${o}" placeholder="${n(i.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${n(i.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,t.appendChild(s)}window.aipkitForms_addSelectOptionRow=d})();(function(){"use strict";function d(a){let i=window.aipkitAIFormsState;if(!a){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}a.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(t=>t.classList.remove("aipkit-element-selected")),i.selectedDesignerElementId=null;let n=a.querySelector("#aipkit_ai_form_elements_palette"),e=a.querySelector("#aipkit_ai_form_element_settings_panel");n&&(n.style.display="block"),e&&(e.style.display="none")}window.aipkitForms_hideSettingsPanel=d})();(function(){"use strict";function d(a,i){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u;if(!i){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let o=null;for(let u of n.formStructure){for(let m of u.columns){let g=m.elements.find(k=>k.internalId===a);if(g){o=g;break}}if(o)break}if(!o){console.error(`updateElementFromSettingsPanel: Element data for ID ${a} not found.`);return}let s=i.querySelector("#aipkit_ai_form_element_settings_panel");if(!s){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let r=s.querySelector('input[data-setting="label"]');r&&(o.label=r.value);let c=s.querySelector('input[data-setting="fieldId"]');if(c){let u=c.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!u){let g=o.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");g||(g=o.type.replace(/-/g,"_")),u=`${g}_${a.split("-").pop()}`}let m=!0;e:for(let g of n.formStructure)for(let k of g.columns)if(k.elements.some(w=>w.internalId!==a&&w.fieldId===u)){m=!1;break e}m&&u.length>0?(o.fieldId=u,c.value=u,c.classList.remove("aipkit_input_error")):u.length>0&&c.classList.add("aipkit_input_error")}let l=s.querySelector('input[data-setting="required"]');l&&(o.required=l.checked);let p=s.querySelector('textarea[data-setting="helpText"]');if(p&&(o.helpText=p.value),o.type==="text-input"||o.type==="textarea"){let u=s.querySelector('input[data-setting="placeholder"]');u&&(o.placeholder=u.value)}(o.type==="select"||o.type==="radio-button"||o.type==="checkbox")&&(o.options=[],s.querySelectorAll(".aipkit_select_option_row").forEach(m=>{let g=m.querySelector('input[data-setting="option-value"]'),k=m.querySelector('input[data-setting="option-text"]');g&&k&&g.value.trim()!==""?o.options.push({value:g.value,text:k.value}):g&&k&&g.value.trim()===""&&k.value.trim()!==""&&o.options.push({value:k.value,text:k.value})}));let _=i.querySelector("#aipkit_ai_form_designer_area"),f=_?_.querySelector(`#${CSS.escape(a)}`):null;if(f&&_){let u=f.parentElement,m=_.scrollTop,g=f.classList.contains("aipkit-element-selected"),k=f.nextElementSibling;if(f.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(u,o,k):console.error("AI Forms updateElement: renderFieldInColumn function missing."),g){let w=_.querySelector(`#${CSS.escape(a)}`);w&&w.classList.add("aipkit-element-selected")}_.scrollTop=m}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(i)}window.aipkitForms_updateElementFromSettingsPanel=d})();(function(){"use strict";function d(n){let e=window.aipkitAIFormsState;if(!n)return;let t=n.querySelector("#aipkit_prompt_snippets_container");if(!t)return;t.innerHTML="";let o=new Set;if(e.formStructure.forEach(s=>{s.columns.forEach(r=>{r.elements.forEach(c=>{c.fieldId&&o.add(c.fieldId)})})}),o.size>0){let s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:r=>r;o.forEach(r=>{let c=document.createElement("button");c.type="button",c.className="aipkit_prompt_snippet",c.dataset.fieldId=r,c.title=s("Click to copy","gpt3-ai-content-generator"),c.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${r}}`,t.appendChild(c)})}}function a(n){if(!n)return;let e=n.querySelector("#aipkit_form_editor_container");if(!e){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let t=e.querySelector("#aipkit_prompt_snippets_container");if(!t){console.warn("AI Forms: Prompt snippets container not found for init.");return}t.dataset.listenerAttached!=="true"&&(t.addEventListener("click",function(o){let s=o.target.closest(".aipkit_prompt_snippet");if(!s)return;let r=s.dataset.fieldId;r&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${r}}`,s)}),t.dataset.listenerAttached="true")}function i(n=null,e){let t=window.aipkitAIFormsState,o=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,r=window.aipkit_escapeHtml||function(p){return p};if(!e){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}t.currentFormId=n,t.droppedElementCounter=0,t.formStructure=[],t.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(e):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let c=e.querySelector("#aipkit_form_editor_container"),l=e.querySelector("#aipkit_ai_forms_list_container");l.style.display="none",c.style.display="block",requestAnimationFrame(()=>{let p=c.querySelector("#aipkit_ai_form_title"),_=c.querySelector("#aipkit_ai_form_prompt_template"),f=c.querySelector("#aipkit_ai_form_id"),u=c.querySelector("#aipkit_ai_form_designer_area"),m=c.querySelector("#aipkit_ai_form_ai_provider"),g=c.querySelector("#aipkit_ai_form_ai_model"),k=c.querySelector("#aipkit_ai_form_temperature"),w=c.querySelector("#aipkit_ai_form_temperature_value"),h=c.querySelector("#aipkit_ai_form_max_tokens"),b=c.querySelector("#aipkit_ai_form_max_tokens_value"),y=c.querySelector("#aipkit_ai_form_top_p"),S=c.querySelector("#aipkit_ai_form_top_p_value"),I=c.querySelector("#aipkit_ai_form_frequency_penalty"),x=c.querySelector("#aipkit_ai_form_frequency_penalty_value"),q=c.querySelector("#aipkit_ai_form_presence_penalty"),$=c.querySelector("#aipkit_ai_form_presence_penalty_value"),M=c.querySelector("#aipkit_preview_ai_form_btn"),T=()=>{let C=document.createElement("div");return C.className="aipkit_form_designer_placeholder",C.id="aipkit_form_designer_placeholder",C.innerHTML=`<span class="dashicons dashicons-layout"></span>${s("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,C};if(!c||!l||!p||!_||!f||!u||!m||!g||!k||!h||!M||!w||!b||!y||!S||!I||!x||!q||!$){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:e.innerHTML.substring(0,500)});return}p.value="",_.value="",f.value="",u.innerHTML="",u.appendChild(T()),d(e);let P={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Provider",model_label:"Model"};if(c.querySelectorAll('input[name^="labels["]').forEach(C=>{let v=C.name.match(/labels\[(.+)\]/),E=v?v[1]:null;E&&P[E]!==void 0?C.value=P[E]:C.value=""}),!n){if(m.value="OpenAI",k&&w){let C=window.aipkit_dashboard?.ai_params?.temperature||1;k.value=C,w.textContent=C}if(h&&b){let C=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;h.value=C,b.textContent=C}if(y&&S){let C=window.aipkit_dashboard?.ai_params?.top_p||1;y.value=C,S.textContent=C}if(I&&x){let C=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;I.value=C,x.textContent=C}if(q&&$){let C=window.aipkit_dashboard?.ai_params?.presence_penalty||0;q.value=C,$.textContent=C}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(c))}n?(M.disabled=!1,f.value=n,u.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${s("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:n,_ajax_nonce:o.nonce_manage_forms}).then(C=>{if(C.form){p.value=C.form.title||"",_.value=C.form.prompt_template||"",m.value=C.form.ai_provider||"OpenAI",k&&w&&(k.value=C.form.temperature,w.textContent=C.form.temperature),h&&b&&(h.value=C.form.max_tokens,b.textContent=C.form.max_tokens),y&&S&&(y.value=C.form.top_p,S.textContent=C.form.top_p),I&&x&&(I.value=C.form.frequency_penalty,x.textContent=C.form.frequency_penalty),q&&$&&(q.value=C.form.presence_penalty,$.textContent=C.form.presence_penalty);let v=C.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(G=>{let H=c.querySelector(`input[name="labels[${G}]"]`);H&&(H.value=v[G]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(m.value,C.form.ai_model);let L=c.querySelector("#aipkit_ai_form_reasoning_effort");L&&(L.value=C.form.reasoning_effort||"low"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(c);let A=c.querySelector('input[name="enable_vector_store"]'),F=A?A.closest(".aipkit_accordion-content"):null;if(F){let G=F.querySelector('select[name="vector_store_provider"]'),H=F.querySelector('select[name="openai_vector_store_ids[]"]'),W=F.querySelector('select[name="pinecone_index_name"]'),R=F.querySelector('select[name="qdrant_collection_name"]'),V=F.querySelector('select[name="vector_embedding_provider"]'),z=F.querySelector('select[name="vector_embedding_model"]'),ee=F.querySelector('input[name="vector_store_top_k"]'),te=F.querySelector("#aipkit_ai_form_vector_store_top_k_value");if(A.checked=C.form.enable_vector_store==="1",G&&(G.value=C.form.vector_store_provider||"openai"),W&&(W.value=C.form.pinecone_index_name||""),R&&(R.value=C.form.qdrant_collection_name||""),V&&(V.value=C.form.vector_embedding_provider||"openai"),ee&&te){let J=C.form.vector_store_top_k||3;ee.value=J,te.textContent=J}H&&C.form.openai_vector_store_ids&&Array.isArray(C.form.openai_vector_store_ids)&&Array.from(H.options).forEach(J=>{J.selected=C.form.openai_vector_store_ids.includes(J.value)}),typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(F),z&&(z.value=C.form.vector_embedding_model||""),A.dispatchEvent(new Event("change",{bubbles:!0}))}let B=c.querySelector('input[name="openai_web_search_enabled"]'),D=c.querySelector('input[name="google_search_grounding_enabled"]');B&&(B.checked=C.form.openai_web_search_enabled==="1"),D&&(D.checked=C.form.google_search_grounding_enabled==="1");let O=c.querySelector('select[name="openai_web_search_context_size"]'),N=c.querySelector('select[name="openai_web_search_loc_type"]'),U=c.querySelector('input[name="openai_web_search_loc_country"]'),K=c.querySelector('input[name="openai_web_search_loc_city"]'),Y=c.querySelector('input[name="openai_web_search_loc_region"]'),j=c.querySelector('input[name="openai_web_search_loc_timezone"]');O&&(O.value=C.form.openai_web_search_context_size||"medium"),N&&(N.value=C.form.openai_web_search_loc_type||"none"),U&&(U.value=C.form.openai_web_search_loc_country||""),K&&(K.value=C.form.openai_web_search_loc_city||""),Y&&(Y.value=C.form.openai_web_search_loc_region||""),j&&(j.value=C.form.openai_web_search_loc_timezone||"");let X=c.querySelector('select[name="google_grounding_mode"]'),Z=c.querySelector('input[name="google_grounding_dynamic_threshold"]'),Q=c.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(X&&(X.value=C.form.google_grounding_mode||"DEFAULT_MODE"),Z){let G=C.form.google_grounding_dynamic_threshold||.3;Z.value=G,Q&&(Q.textContent=G)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(m.value),B&&B.dispatchEvent(new Event("change",{bubbles:!0})),D&&D.dispatchEvent(new Event("change",{bubbles:!0})),C.form.structure&&Array.isArray(C.form.structure))if(t.formStructure=C.form.structure,u.innerHTML="",t.formStructure.length===0)u.appendChild(T());else{t.formStructure.forEach(H=>{window.aipkitForms_renderLayoutRow(u,H,null,e)});let G=0;t.formStructure.forEach(H=>{H.columns.forEach(W=>{W.elements.forEach(R=>{let V=R.internalId.split("-"),z=parseInt(V[V.length-1],10)||0;z>G&&(G=z)})})}),t.droppedElementCounter=G}else u.innerHTML="",u.appendChild(T());d(e)}else throw new Error(C.message||s("Could not load form data.","gpt3-ai-content-generator"))}).catch(C=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(e,"error",C.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(e):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):M.disabled=!0})}window.aipkitForms_showFormEditor=i,window.aipkitForms_updatePromptSnippets=d,window.aipkitForms_initPromptSnippets=a})();(function(){"use strict";function d(a){let i=window.aipkitAIFormsState,n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!a){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}i.currentFormId=null,i.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(a):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let e=a.querySelector("#aipkit_form_editor_container"),t=a.querySelector("#aipkit_ai_forms_list_container");if(e&&(e.style.display="none"),t&&(t.style.display="block"),e){let s=e.querySelector("#aipkit_ai_form_preview_container");s&&(s.style.display="none",s.innerHTML="");let r=e.querySelector("#aipkit_preview_ai_form_btn");if(r&&r.classList.contains("aipkit-preview-active")){r.classList.remove("aipkit-preview-active");let c=r.querySelector(".aipkit_btn-text");c&&(c.textContent=n("Preview","gpt3-ai-content-generator"))}}let o=a.querySelector("#aipkit_ai_forms_messages");o&&(o.innerHTML="")}window.aipkitForms_hideFormEditor=d})();(function(){"use strict";function d(a,i){let n=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:H=>H;if(!i){console.error("AI Forms saveForm: formsContainerElement not provided.");return}let o=i.querySelector("#aipkit_form_editor_container");if(!o){console.error("AI Forms saveForm: editorContainer not found in provided formsContainerElement.");return}let s=o.querySelector("#aipkit_ai_form_title"),r=o.querySelector("#aipkit_ai_form_prompt_template"),c=o.querySelector("#aipkit_ai_form_id"),l=o.querySelector("#aipkit_ai_form_ai_provider"),p=o.querySelector("#aipkit_ai_form_ai_model"),_=o.querySelector("#aipkit_ai_form_temperature"),f=o.querySelector("#aipkit_ai_form_max_tokens"),u=o.querySelector("#aipkit_ai_form_top_p"),m=o.querySelector("#aipkit_ai_form_frequency_penalty"),g=o.querySelector("#aipkit_ai_form_presence_penalty"),k=o.querySelector("#aipkit_ai_form_reasoning_effort"),w=o.querySelector('input[name="enable_vector_store"]'),h=o.querySelector('select[name="vector_store_provider"]'),b=o.querySelector('select[name="openai_vector_store_ids[]"]'),y=o.querySelector('select[name="pinecone_index_name"]'),S=o.querySelector('select[name="qdrant_collection_name"]'),I=o.querySelector('select[name="vector_embedding_provider"]'),x=o.querySelector('select[name="vector_embedding_model"]'),q=o.querySelector('input[name="vector_store_top_k"]'),$=o.querySelector('input[name="openai_web_search_enabled"]'),M=o.querySelector('input[name="google_search_grounding_enabled"]'),T=o.querySelector('select[name="openai_web_search_context_size"]'),P=o.querySelector('select[name="openai_web_search_loc_type"]'),C=o.querySelector('input[name="openai_web_search_loc_country"]'),v=o.querySelector('input[name="openai_web_search_loc_city"]'),E=o.querySelector('input[name="openai_web_search_loc_region"]'),L=o.querySelector('input[name="openai_web_search_loc_timezone"]'),A=o.querySelector('select[name="google_grounding_mode"]'),F=o.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!s||!r||!c||!l||!p||!_||!f||!u||!m||!g){console.error("AI Forms saveForm: One or more critical form editor inputs not found in editorContainer.");return}let B=s.value.trim(),D=r.value.trim(),O=c.value;if(!B){alert(t(e.text.formTitleRequired||"Form title is required.","gpt3-ai-content-generator"));return}if(!D){alert(t(e.text.promptTemplateRequired||"Prompt template is required.","gpt3-ai-content-generator"));return}let N=new Set,U=!0;e:for(let H of n.formStructure)for(let W of H.columns)for(let R of W.elements){if(!R.fieldId||!/^[a-zA-Z0-9_]+$/.test(R.fieldId)){alert(t(`Invalid Field Variable Name: "${R.fieldId||""}" for element "${R.label}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(R.internalId,i);let V=o.querySelector(`#setting-field-id-${R.internalId}`);V&&V.focus(),U=!1;break e}if(N.has(R.fieldId)){alert(t(`Duplicate Field Variable Name: "${R.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(R.internalId,i);let V=o.querySelector(`#setting-field-id-${R.internalId}`);V&&V.focus(),U=!1;break e}N.add(R.fieldId)}if(!U)return;let K=b?Array.from(b.selectedOptions).map(H=>H.value):[],Y=o.querySelectorAll('input[name^="labels["]'),j={};Y.forEach(H=>{let W=H.name.match(/\[(.*?)\]/);if(W&&W[1]){let R=W[1];j[R]=H.value}});let X=JSON.stringify(j),Z={_ajax_nonce:e.nonce_manage_forms,form_id:O||null,title:B,prompt_template:D,form_structure:JSON.stringify(n.formStructure),ai_provider:l.value,ai_model:p.value,temperature:_.value,max_tokens:f.value,top_p:u.value,frequency_penalty:m.value,presence_penalty:g.value,reasoning_effort:k?.value,enable_vector_store:w?.checked?"1":"0",vector_store_provider:h?.value,openai_vector_store_ids:K,pinecone_index_name:y?.value||"",qdrant_collection_name:S?.value||"",vector_embedding_provider:I?.value,vector_embedding_model:x?.value||"",vector_store_top_k:q?.value||3,openai_web_search_enabled:$?.checked?"1":"0",google_search_grounding_enabled:M?.checked?"1":"0",openai_web_search_context_size:T?.value||"medium",openai_web_search_loc_type:P?.value||"none",openai_web_search_loc_country:C?.value||"",openai_web_search_loc_city:v?.value||"",openai_web_search_loc_region:E?.value||"",openai_web_search_loc_timezone:L?.value||"",google_grounding_mode:A?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:F?.value||"0.30",labels:X},Q=a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent:a.textContent,G=a.querySelector(".aipkit_spinner");a.disabled=!0,G&&(G.style.display="inline-block"),a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent=t(e.text.savingForm||"Saving...","gpt3-ai-content-generator"):a.firstChild.textContent=t(e.text.savingForm||"Saving...","gpt3-ai-content-generator")+" ",window.aipkit_apiRequest("aipkit_save_ai_form",Z).then(H=>{if(!O&&H.form_id){c&&(c.value=H.form_id),n.currentFormId=H.form_id;let W=o.querySelector("#aipkit_preview_ai_form_btn");W&&(W.disabled=!1)}typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",H.message||t(e.text.formSaved||"Form saved!","gpt3-ai-content-generator")),typeof window.aipkitForms_hideFormEditor=="function"&&window.aipkitForms_hideFormEditor(i),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(H=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",H.message||t(e.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator"))}).finally(()=>{a.disabled=!1,G&&(G.style.display="none"),a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent=Q:a.firstChild.textContent=Q})}window.aipkitForms_saveForm=d})();(function(){"use strict";function d(a,i,n){let e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:r=>r;if(!n){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let o={_ajax_nonce:e.nonce_manage_forms,form_id:a},s=i.textContent;i.disabled=!0,i.textContent=t(e.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",o).then(r=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",r.message||t(e.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(r=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",r.message||t(e.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let c=n.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${a}"]`);c&&(c.disabled=!1,c.textContent=s)})}window.aipkitForms_deleteForm=d})();(function(){"use strict";function d(a,i){let n=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:r=>r;if(!i){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let t={_ajax_nonce:n.nonce_manage_forms},o=a.querySelector(".aipkit_btn-text")?.textContent||e("Delete All Forms","gpt3-ai-content-generator"),s=a.querySelector(".aipkit_spinner");a.disabled=!0,a.querySelector(".aipkit_btn-text")&&(a.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${e(n.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",t).then(r=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",r.message||e(n.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(r=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",r.message||e(n.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{a.querySelector(".aipkit_btn-text")&&(a.querySelector(".aipkit_btn-text").textContent=o),s&&(s.style.display="none"),a.disabled=!1})}window.aipkitForms_deleteAllForms=d})();(function(){"use strict";function d(a,i,n){let e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:r=>r;if(!n){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let o={_ajax_nonce:e.nonce_manage_forms,form_id:a},s=i.textContent;i.disabled=!0,i.textContent=t(e.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",o).then(r=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"success",r.message||t("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(r=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(n,"error",r.message||t(e.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let r=n.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${a}"]`);r&&(r.disabled=!1,r.textContent=s)})}window.aipkitForms_duplicateForm=d})();(function(){"use strict";async function d(a){let i=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,e=a.textContent;a.disabled=!0,a.textContent=n("Exporting...","gpt3-ai-content-generator");try{let t=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:i.nonce_manage_forms});if(t.forms&&Array.isArray(t.forms)&&t.forms.length>0){let o=t.forms.map(f=>(delete f.id,delete f.status,f)),r=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,c=JSON.stringify(o,null,2),l=new Blob([c],{type:"application/json"}),p=URL.createObjectURL(l),_=document.createElement("a");_.href=p,_.download=r,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(p)}else throw new Error(n("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(t){alert(n("Error exporting forms: ","gpt3-ai-content-generator")+t.message)}finally{a.disabled=!1,a.textContent=e}}window.aipkitForms_exportAllForms=d})();(function(){"use strict";async function d(a,i){let n=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o,t=i.textContent;i.disabled=!0,i.textContent=e("Exporting...","gpt3-ai-content-generator");try{let o=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:a,_ajax_nonce:n.nonce_manage_forms});if(o.form){let s=o.form,r=s.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),c=`aipkit-form-${a}-${r}.json`;delete s.id,delete s.status;let l=JSON.stringify(s,null,2),p=new Blob([l],{type:"application/json"}),_=URL.createObjectURL(p),f=document.createElement("a");f.href=_,f.download=c,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(_)}else throw new Error(e("Form data not found in response.","gpt3-ai-content-generator"))}catch(o){alert(e("Error exporting form: ","gpt3-ai-content-generator")+o.message)}finally{i.disabled=!1,i.textContent=t}}window.aipkitForms_exportForm=d})();(function(){"use strict";let d=document.getElementById("aipkit_ai_forms_import_messages"),a;function i(t,o){if(!d)return;let s=window.aipkit_escapeHtml||(r=>r);d.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${t}">${s(o)}</div>`,a&&clearTimeout(a),a=setTimeout(()=>{d.innerHTML=""},8e3)}function n(){d&&(d.innerHTML=""),a&&clearTimeout(a)}async function e(t){let o=window.aipkit_ai_forms_config||{text:{}},s=window.wp?.i18n?.__||(p=>p),r=t.files;if(!r.length)return;let c=r[0];n(),i("info",s("Reading file...","gpt3-ai-content-generator"));let l=new FileReader;l.onload=async function(p){try{let _=p.target.result,f=JSON.parse(_);if(typeof f=="object"&&f!==null&&!Array.isArray(f)&&(f=[f]),!Array.isArray(f))throw new Error(s("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(f.length===0){i("warning",s("File contains no forms to import.","gpt3-ai-content-generator"));return}i("info",s("Importing...","gpt3-ai-content-generator"));let u=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:o.nonce_manage_forms,forms_json:JSON.stringify(f)});i(u.failed_count>0?"warning":"success",u.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(_){i("error",s("Error processing import file: ","gpt3-ai-content-generator")+_.message)}},l.onerror=function(){i("error",s("Error reading the selected file.","gpt3-ai-content-generator"))},l.readAsText(c)}window.aipkitForms_importForms=e})();(function(){"use strict";function d(a){let i=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l,e=document.getElementById("aipkit_ai_forms_settings_form");if(!e){console.error("AI Forms Save Settings: Settings form not found.");return}let t="aipkit_aiforms_settings_save_status";window.aipkit_showSavingIndicator(t,!1);let o=a.querySelector(".aipkit_btn-text")?.textContent||n("Save AI Forms Settings","gpt3-ai-content-generator"),s=a.querySelector(".aipkit_spinner");a.disabled=!0,s&&(s.style.display="inline-block"),a.querySelector(".aipkit_btn-text")&&(a.querySelector(".aipkit_btn-text").textContent=n("Saving...","gpt3-ai-content-generator"));let r=new FormData(e),c=Object.fromEntries(r.entries());window.aipkit_apiRequest("aipkit_save_ai_forms_settings",c).then(l=>{window.aipkit_showMessage(t,"success",l.message||n("Settings saved!","gpt3-ai-content-generator"))}).catch(l=>{window.aipkit_showMessage(t,"error",l.message||n("Failed to save settings.","gpt3-ai-content-generator")),console.error("AI Forms Save Settings Error:",l)}).finally(()=>{a.disabled=!1,s&&(s.style.display="none"),a.querySelector(".aipkit_btn-text")&&(a.querySelector(".aipkit_btn-text").textContent=o)})}window.aipkitForms_saveAiFormsSettings=d})();(function(){"use strict";function d(a,i,n){let e=window.aipkit_escapeHtml||function(o){return o};if(!a){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let t=a.querySelector("#aipkit_ai_forms_messages");t?(t.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${i}">${e(n)}</div>`,setTimeout(()=>{t.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=d})();(function(){"use strict";function d(i){if(!i){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let n=i.querySelector(".aipkit_token_limit_mode_select"),e=i.querySelector(".aipkit_token_general_user_limit_field"),t=i.querySelector(".aipkit_token_role_limits_container");if(!n||!e||!t){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let o=n.value;e.style.display=o==="general"?"block":"none",t.style.display=o==="role_based"?"block":"none"}function a(i){if(!i){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let n="data-token-listener-attached";i.getAttribute(n)!=="true"&&(i.addEventListener("change",function(e){e.target.closest(".aipkit_token_limit_mode_select")&&d(i)}),d(i),i.setAttribute(n,"true"))}window.aipkit_initAIFormsTokenManagementUI=a})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_ai_forms_container");return a||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=d})();(function(){"use strict";function d(a){let i=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,e=window.aipkit_escapeHtml||function(t){return t};a.dataset.clickListenerAttached!=="true"&&(a.addEventListener("click",function(t){let o=t.target,s=c=>o.closest(c),r=a.querySelector("#aipkit_form_editor_container");if(o.matches("#aipkit_create_new_ai_form_btn")||s("#aipkit_create_new_ai_form_btn")){t.preventDefault();let c=a.querySelector('.aipkit_tab[data-tab="forms-main"]');c&&!c.classList.contains("aipkit_active")&&c.click(),typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,a)}else if(s(".aipkit_actions_menu_toggle")){t.preventDefault(),t.stopPropagation();let c=o.closest(".aipkit_actions_menu");if(!c)return;let l=c.querySelector(".aipkit_actions_dropdown_menu");if(!l)return;let p=l.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(_=>{_!==l&&(_.style.display="none")}),l.style.display=p?"none":"block",!p){let _=f=>{c.contains(f.target)||(l.style.display="none")};document.addEventListener("click",_,{once:!0,capture:!0})}}else if(s("#aipkit_import_ai_forms_btn")){t.preventDefault();let c=a.querySelector("#aipkit_ai_forms_import_file_input");c&&c.click()}else if(o.matches(".aipkit_edit_ai_form_btn")||s(".aipkit_edit_ai_form_btn")){t.preventDefault();let l=s(".aipkit_edit_ai_form_btn").dataset.formId;typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(l,a)}else if(o.matches(".aipkit_duplicate_ai_form_btn")||s(".aipkit_duplicate_ai_form_btn")){t.preventDefault();let c=s(".aipkit_duplicate_ai_form_btn"),l=c.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(l,c,a)}else if(o.matches("#aipkit_export_all_ai_forms_btn")||s("#aipkit_export_all_ai_forms_btn")){t.preventDefault();let c=s("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(c)}else if(o.matches(".aipkit_export_ai_form_btn")||s(".aipkit_export_ai_form_btn")){t.preventDefault();let c=s(".aipkit_export_ai_form_btn"),l=c.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(l,c)}else if(o.matches(".aipkit_delete_ai_form_btn")||s(".aipkit_delete_ai_form_btn")){t.preventDefault();let c=s(".aipkit_delete_ai_form_btn"),l=c.dataset.formId,p=c.dataset.formTitle||`Form ID ${l}`;confirm(`${n(i.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${p}`)&&typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(l,c,a)}else if(o.matches("#aipkit_delete_all_ai_forms_btn")||s("#aipkit_delete_all_ai_forms_btn")){t.preventDefault();let c=s("#aipkit_delete_all_ai_forms_btn");confirm(n(i.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"))&&typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(c,a)}else if(o.matches(".aipkit_form_shortcode_input"))t.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(o.value,o);else if(s(".aipkit_aiform_settings_toggle")){t.preventDefault();let c=s(".aipkit_aiform_settings_toggle"),l=c.dataset.formId,p=a.querySelector(`#aif-configurator-${l}`);if(!p)return;a.querySelectorAll(".aipkit_shortcode_configurator").forEach(u=>{u!==p&&(u.style.display="none")});let f=p.style.display==="block";if(p.style.display=f?"none":"block",!f){let u=m=>{!p.contains(m.target)&&!c.contains(m.target)&&(p.style.display="none",document.removeEventListener("click",u,!0))};setTimeout(()=>{document.addEventListener("click",u,{capture:!0,once:!0})},0)}}else if(o.matches("#aipkit_validate_prompt_btn")||s("#aipkit_validate_prompt_btn"))t.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(s("#aipkit_ai_form_toggle_params_btn")){t.preventDefault();let c=s("#aipkit_ai_form_toggle_params_btn"),l=r.querySelector("#aipkit_ai_form_advanced_params_container");if(l){let p=l.style.display!=="none";l.style.display=p?"none":"block",c.classList.toggle("aipkit-active",!p)}}else if(o.matches("#aipkit_save_ai_form_btn")||s("#aipkit_save_ai_form_btn")){t.preventDefault();let c=s("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(c,a)}else if(o.matches("#aipkit_cancel_edit_ai_form_btn")||s("#aipkit_cancel_edit_ai_form_btn"))t.preventDefault(),typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(a);else if(o.matches("#aipkit_preview_ai_form_btn")||s("#aipkit_preview_ai_form_btn")){let f=function(m){if(!document.querySelector(`link[href="${m}"]`)){let g=document.createElement("link");g.rel="stylesheet",g.href=m,document.head.appendChild(g)}},u=function(m){return new Promise((g,k)=>{if(document.querySelector(`script[src="${m}"]`)){g();return}let h=document.createElement("script");h.src=m,h.async=!0,h.onload=()=>g(),h.onerror=()=>k(new Error(`Failed to load script: ${m}`)),document.body.appendChild(h)})};t.preventDefault();let c=s("#aipkit_preview_ai_form_btn"),l=r.querySelector("#aipkit_ai_form_preview_container"),p=c.querySelector(".aipkit_btn-text");if(!c||!l||!p){console.error("AI Forms Preview: Missing required UI elements (button, container, or text span).");return}if(c.classList.contains("aipkit-preview-active")){l.style.display="none",l.innerHTML="",c.classList.remove("aipkit-preview-active"),p.textContent=n("Preview","gpt3-ai-content-generator");return}let _=r.querySelector("#aipkit_ai_form_id").value;if(!_){alert(n("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}c.classList.add("aipkit-preview-active"),p.textContent=n("Close Preview","gpt3-ai-content-generator"),l.innerHTML='<p style="text-align:center;"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading Preview...</p>',l.style.display="block",window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:_,_ajax_nonce:i.nonce_manage_forms}).then(m=>{if(m.config&&(window.aipkit_ai_forms_public_config=m.config),m.models&&(window.aipkit_ai_forms_models=m.models),m.assets&&m.assets.css&&Object.values(m.assets.css).forEach(g=>f(g)),l.innerHTML=m.html,m.assets&&m.assets.js){let g=Object.values(m.assets.js).map(k=>u(k));return Promise.all(g)}}).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(m=>{console.error("Error fetching form preview:",m),l.innerHTML=`<p style="color:red;">Error: ${e(m.message)}</p>`,c.classList.remove("aipkit-preview-active"),p.textContent=n("Preview","gpt3-ai-content-generator")})}else if(s(".aipkit_dropped_element_settings_btn")){t.preventDefault();let c=s(".aipkit_dropped_element");c&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(c.id,a)}else if(s(".aipkit_dropped_element_delete_btn")){t.preventDefault();let c=s(".aipkit_dropped_element");c&&confirm(n(i.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(c.id,a)}else if(s(".aipkit_layout_row_delete_btn")){if(t.preventDefault(),confirm(n("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let c=s(".aipkit_layout_row");c&&(Array.from(c.querySelectorAll(".aipkit_dropped_element")).map(p=>p.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(a),c.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(a))}}else if(s("#aipkit_settings_panel_close_btn"))t.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(a);else if(s(".aipkit_remove_option_btn")){t.preventDefault();let c=s(".aipkit_select_option_row");c&&(c.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,a))}else if(s("#aipkit_add_select_option_btn"))t.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(a);else if(s("#aipkit_save_ai_forms_settings_btn")){t.preventDefault();let c=s("#aipkit_save_ai_forms_settings_btn");typeof window.aipkitForms_saveAiFormsSettings=="function"&&window.aipkitForms_saveAiFormsSettings(c)}}),a.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=d})();(function(){"use strict";function d(i,n){if(!i)return;let e=n.querySelector(`#aif-configurator-${i}`),t=n.querySelector(`#aif-shortcode-input-${i}`);if(!e||!t)return;let o=e.querySelectorAll(".aipkit-aiform-config-input"),s=[];o.forEach(c=>{let l=c.dataset.attrName;l&&(c.type==="checkbox"?c.checked&&s.push(`${l}="true"`):c.type==="select-one"&&c.value&&c.value!=="light"&&s.push(`${l}="${c.value}"`))});let r=`[aipkit_ai_form id=${i}`;s.length>0&&(r+=" "+s.join(" ")),r+="]",t.value=r}function a(i){i.dataset.changeListenerAttached!=="true"&&(i.addEventListener("change",function(n){let e=n.target;if(e.matches(".aipkit-aiform-config-input")){let t=e.dataset.formId;d(t,i)}else e.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(e),e.value="")}),i.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=a})();(function(){"use strict";function d(a){let i=window.aipkitAIFormsState,n=a.querySelector("#aipkit_ai_form_element_settings_panel");if(!n){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(n.dataset.inputListenerAttached==="true")return;let e=()=>{i.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(i.selectedDesignerElementId,a)};n.addEventListener("input",t=>{t.target.matches(".aipkit-setting-field")&&e()}),n.addEventListener("change",t=>{t.target.matches('.aipkit-setting-field[type="checkbox"]')&&e()}),n.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=d})();(function(){"use strict";function d(a){let i=window.aipkitAIFormsState;if(!a){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let n=a.querySelector("#aipkit_ai_form_elements_palette"),e=a.querySelector("#aipkit_ai_form_designer_area");if(!n||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(n.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;n.querySelectorAll(".aipkit_form_element_item").forEach(o=>{o.dataset.dragStartListenerAttached!=="true"&&(o.addEventListener("dragstart",s=>{s.target.classList.add("aipkit-dragging"),i.draggedElement=null,s.target.dataset.layoutType?(i.draggedLayoutType=s.target.dataset.layoutType,i.draggedElementType=null,s.dataTransfer.setData("text/plain",i.draggedLayoutType),s.dataTransfer.effectAllowed="copy"):(i.draggedElementType=s.target.dataset.elementType,i.draggedLayoutType=null,s.dataTransfer.setData("text/plain",i.draggedElementType),s.dataTransfer.effectAllowed="copy")}),o.addEventListener("dragend",s=>{s.target.classList.remove("aipkit-dragging"),i.draggedElementType=null,i.draggedLayoutType=null}),o.dataset.dragStartListenerAttached="true")}),n.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",o=>{let s=o.target.closest(".aipkit_layout_row"),r=o.target.closest(".aipkit_dropped_element");if(s&&o.target.classList.contains("aipkit_layout_row_drag_handle"))i.draggedElement=s,o.dataTransfer.setData("text/row-id",s.id),o.dataTransfer.effectAllowed="move";else if(r&&o.target.classList.contains("aipkit_dropped_element_drag_handle"))i.draggedElement=r,o.dataTransfer.setData("text/element-id",r.id),o.dataTransfer.effectAllowed="move";else return;i.draggedElementType=null,i.draggedLayoutType=null,setTimeout(()=>{i.draggedElement&&i.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),e.addEventListener("dragend",o=>{i.draggedElement&&(i.draggedElement.classList.remove("aipkit-row-dragging-source"),i.draggedElement=null)}),e.addEventListener("dragover",o=>{o.preventDefault(),e.classList.add("aipkit-drag-over"),i.draggedElement?o.dataTransfer.dropEffect="move":o.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",o=>{e.contains(o.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",o=>{o.preventDefault(),o.stopPropagation(),e.classList.remove("aipkit-drag-over");let s=e.querySelector("#aipkit_form_designer_placeholder");if(i.draggedLayoutType){s&&(s.style.display="none");let r=window.aipkitForms_createNewLayoutData(i.draggedLayoutType);i.formStructure.push(r),window.aipkitForms_renderLayoutRow(e,r,null,a),i.draggedLayoutType=null}else if(i.draggedElement&&i.draggedElement.classList.contains("aipkit_layout_row")){let r=o.target.closest(".aipkit_layout_row");if(r&&r!==i.draggedElement){let c=r.getBoundingClientRect(),p=o.clientY>c.top+c.height/2?r.nextSibling:r;e.insertBefore(i.draggedElement,p)}window.aipkitForms_updateFormStructureOrder()}else if(i.draggedElementType){s&&(s.style.display="none");let r=window.aipkitForms_createNewLayoutData("1-col"),c=window.aipkitForms_createNewFormElementData(i.draggedElementType);r.columns[0].elements.push(c),i.formStructure.push(r),window.aipkitForms_renderLayoutRow(e,r,null,a),i.draggedElementType=null}i.draggedElement&&(i.draggedElement.classList.remove("aipkit-row-dragging-source"),i.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(a)}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=d})();(function(){"use strict";function d(a){let i=a.querySelector("#forms-settings-content");i&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(i):console.error("AI Forms Init: Could not initialize token management UI for settings tab.")}window.aipkitForms_initializeTokenUI=d})();(function(){"use strict";function d(a){if(!a)return;let i="data-accordion-listener-attached";a.getAttribute(i)!=="true"&&(a.addEventListener("click",function(n){let e=n.target.closest(".aipkit_accordion-header");if(!e||!e.closest(".aipkit_ai_forms_container"))return;n.preventDefault();let t=e.closest(".aipkit_accordion-group");if(t&&!e.classList.contains("aipkit_active")){let s=t.querySelector(".aipkit_accordion-header.aipkit_active");if(s){s.classList.remove("aipkit_active");let r=s.nextElementSibling;r&&r.classList.remove("aipkit_active")}}let o=e.nextElementSibling;o&&(e.classList.toggle("aipkit_active"),o.classList.toggle("aipkit_active"))}),a.setAttribute(i,"true"))}window.aipkitForms_initializeAccordions=d})();(function(){"use strict";function d(e,t=""){let o=document.getElementById("aipkit_ai_form_ai_model"),s=window.aipkit_dashboard?.models||{};if(!o||!s)return;let r=e.toLowerCase(),c=s[r]||[];if(o.innerHTML="",!c||Array.isArray(c)&&c.length===0||!Array.isArray(c)&&Object.keys(c).length===0){let p=new Option("No models found. Sync in main settings.","");o.appendChild(p);return}let l=!1;if(Array.isArray(c)?c.forEach(p=>{let _=new Option(p.name,p.id);p.id===t&&(_.selected=!0,l=!0),o.appendChild(_)}):Object.keys(c).forEach(p=>{let _=document.createElement("optgroup");_.label=p,c[p].forEach(f=>{let u=new Option(f.name,f.id);f.id===t&&(u.selected=!0,l=!0),_.appendChild(u)}),o.appendChild(_)}),!l&&t){let p=new Option(`${t} (Manual/Not Synced)`,t,!1,!0);o.insertBefore(p,o.firstChild),p.selected=!0}o.selectedIndex===-1&&o.options.length>0&&(o.options[0].selected=!0)}function a(e){let t=document.querySelector('input[name="openai_web_search_enabled"]'),o=document.querySelector('input[name="google_search_grounding_enabled"]'),s=t?.closest(".aipkit_form-group"),r=o?.closest(".aipkit_form-group"),c=document.querySelector(".aipkit_ai_form_openai_web_search_settings"),l=document.querySelector(".aipkit_ai_form_google_search_grounding_settings");s&&(e==="OpenAI"?s.style.display="block":(s.style.display="none",t&&(t.checked=!1),c&&(c.style.display="none"))),r&&(e==="Google"?r.style.display="block":(r.style.display="none",o&&(o.checked=!1),l&&(l.style.display="none")))}function i(e){let t=e.querySelector("#aipkit_ai_form_ai_provider"),o=e.querySelector("#aipkit_ai_form_ai_model"),s=e.querySelector(".aipkit_ai_form_reasoning_effort_field");if(!t||!o||!s){s&&(s.style.display="none");return}let r=t.value,l=(o.value||"").toLowerCase(),p=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),_=l.includes("gpt-5");r==="OpenAI"&&(p||_)?s.style.display="block":s.style.display="none"}function n(e){let t=e.querySelector("#aipkit_ai_form_ai_provider"),o=e.querySelector("#aipkit_ai_form_ai_model");!t||!o||(t.dataset.modelListenerAttached!=="true"&&(t.addEventListener("change",function(){d(this.value),a(this.value),i(e)}),t.dataset.modelListenerAttached="true"),o.dataset.reasoningListenerAttached!=="true"&&(o.addEventListener("change",function(){i(e)}),o.dataset.reasoningListenerAttached="true"),d(t.value),a(t.value),i(e))}window.aipkitForms_initAiConfig=n,window.aipkitForms_populateAiModels=d,window.aipkitForms_updateWebSearchVisibility=a,window.aipkitForms_toggleReasoningEffort=i})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(o){return o};function a(o){if(!o)return;let s=o.closest("#aipkit_form_editor_container");if(!s)return;let r=s.querySelector("#aipkit_ai_form_ai_provider"),c=r?r.value:"OpenAI",l=o.querySelector(".aipkit_ai_form_vector_store_toggle"),p=o.querySelector(".aipkit_ai_form_openai_web_search_toggle"),_=o.querySelector(".aipkit_ai_form_google_search_grounding_toggle"),f=o.querySelector(".aipkit_ai_form_vector_store_conditional_settings"),u=o.querySelector(".aipkit_ai_form_openai_web_search_settings"),m=o.querySelector(".aipkit_ai_form_google_search_grounding_settings"),g=o.querySelector(".aipkit_ai_form_vector_store_provider_select"),k=o.querySelector(".aipkit_ai_form_embedding_config_row");if(!l||!p||!_||!f||!u||!m||!g)return;let w=l.checked,h=p.checked,b=_.checked;if(f.style.display=w?"block":"none",w){let y=g.value;f.querySelectorAll(".aipkit_ai_form_vector_openai_field, .aipkit_ai_form_vector_pinecone_field, .aipkit_ai_form_vector_qdrant_field").forEach(x=>x.style.display="none");let I=f.querySelector(`.aipkit_ai_form_vector_${y}_field`);I&&(I.style.display="block"),k&&(k.style.display=y==="pinecone"||y==="qdrant"?"block":"none")}u.style.display=h?"block":"none",m.style.display=b?"block":"none",h&&n(o),b&&e(o)}function i(o){let s=o.querySelector(".aipkit_ai_form_vector_embedding_provider_select"),r=o.querySelector(".aipkit_ai_form_vector_embedding_model_select"),l=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!s||!r||!l)return;let _=s.value.toLowerCase(),f=l[_]||[];r.innerHTML="",r.appendChild(new Option(`-- Select ${s.options[s.selectedIndex].text} Model --`,"")),f&&Array.isArray(f)&&f.length>0?(f.forEach(u=>{r.appendChild(new Option(d(u.name),u.id))}),r.disabled=!1):(r.appendChild(new Option("(No models found - Sync in Settings)","")),r.disabled=!0)}function n(o){let s=o.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),r=o.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!s||!r)return;let c=s.value==="approximate";r.style.display=c?"block":"none"}function e(o){let s=o.querySelector(".aipkit_ai_form_google_grounding_mode_select"),r=o.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!s||!r)return;let c=s.value==="MODE_DYNAMIC";r.style.display=c?"block":"none"}function t(o){let s=o.querySelector("#aipkit_form_editor_container");if(!s)return;let r=s.querySelector('.aipkit_accordion-content:has(input[name="enable_vector_store"])');if(!r)return;let c=s.querySelector("#aipkit_ai_form_ai_provider");c&&c.addEventListener("change",()=>{a(r)});let l="data-vector-config-listener-attached";r.getAttribute(l)!=="true"&&(r.addEventListener("change",p=>{let _=p.target;_.matches(".aipkit_ai_form_vector_store_toggle")||_.matches(".aipkit_ai_form_vector_store_provider_select")||_.matches(".aipkit_ai_form_openai_web_search_toggle")||_.matches(".aipkit_ai_form_google_search_grounding_toggle")?a(r):_.matches(".aipkit_ai_form_vector_embedding_provider_select")?i(r):_.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?n(r):_.matches(".aipkit_ai_form_google_grounding_mode_select")&&e(r)}),r.addEventListener("input",p=>{let _=p.target;if(_.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let f=r.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");f&&(f.textContent=parseFloat(_.value).toFixed(2))}}),a(r),i(r),r.setAttribute(l,"true"))}window.aipkitForms_initVectorConfig=t,window.aipkitForms_toggleVectorConfigVisibility=a,window.aipkitForms_populateVectorEmbeddingModels=i,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=n,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=e})();(function(){"use strict";function d(i,n,e,t){let o=window.aipkitAIFormsState,s=document.createElement("div");s.className="aipkit_layout_row",s.id=n.internalId;let r=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,c=document.createElement("div");c.className="aipkit_layout_row_columns_container",n.columns.forEach(l=>{let p=document.createElement("div");p.className="aipkit_layout_column",p.id=l.internalId,p.style.flexBasis=l.width,a(p,t),l.elements.forEach(_=>{window.aipkitForms_renderFieldInColumn(p,_)}),c.appendChild(p)}),s.innerHTML=r,s.appendChild(c),e?i.insertBefore(s,e):i.appendChild(s)}function a(i,n){let e=window.aipkitAIFormsState;i.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),i.classList.add("aipkit-drag-over"),(e.draggedElement||e.draggedElementType)&&(t.dataTransfer.dropEffect=e.draggedElement?"move":"copy")}),i.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation(),i.classList.remove("aipkit-drag-over")}),i.addEventListener("drop",t=>{if(t.preventDefault(),i.classList.remove("aipkit-drag-over"),e.draggedElementType||e.draggedElement&&e.draggedElement.classList.contains("aipkit_dropped_element")){t.stopPropagation();let o=i.id;if(e.draggedElementType){let s=window.aipkitForms_createNewFormElementData(e.draggedElementType);e.formStructure.forEach(r=>{let c=r.columns.find(l=>l.internalId===o);c&&c.elements.push(s)}),window.aipkitForms_renderFieldInColumn(i,s,null,n)}else e.draggedElement&&(i.appendChild(e.draggedElement),window.aipkitForms_updateFormStructureOrder());e.draggedElementType=null,e.draggedElement&&(e.draggedElement.classList.remove("aipkit-row-dragging-source"),e.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=d})();(function(){"use strict";function d(){let a=window.aipkitForms_validateContainer();if(a){if(a.dataset.aipkitInitialized==="true"){window.aipkitForms_initializeDragAndDrop(a),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(a);return}window.aipkitForms_attachClickEventListeners(a),window.aipkitForms_attachChangeEventListeners(a),window.aipkitForms_attachSettingsPanelListeners(a),window.aipkitForms_initializeAccordions(a),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(a):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(a),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(a),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(a):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(a):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),a.dataset.aipkitInitialized="true"}}window.aipkit_initAiForms=d})();(function(){"use strict";function d(a,i="",n="",e={}){if(!a)return"N/A";let t=a.toLowerCase();if(t.includes("text content submitted for indexing"))return"Text";if(t.includes("file content submitted for indexing")||t.includes("file content embedded and upserted")||t.includes("original filename:"))return"File Upload";if(t.includes("wordpress post content submitted for indexing"))return"Site Content";if(n==="openai")return"N/A";if(n==="pinecone"&&t.includes("vectors upserted")){if(i.startsWith("wp_post_"))return"Site Content";if(i.startsWith("text_"))return"Text";if(i.includes("pinecone_file_")||i.includes("file_"))return"File Upload"}if(n==="qdrant"){if(t.includes("points upserted to qdrant"))return e.post_id||t.includes("post id:")?"Site Content":"Text";if(t.includes("wordpress post content submitted for indexing"))return"Site Content"}if(i&&n==="pinecone"){if(i.startsWith("wp_post_"))return"Site Content";if(i.startsWith("text_"))return"Text";if(i.includes("file_")||i.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=d})();(function(){"use strict";function d(i,n,e=""){let t=window.aipkit_escapeHtml||function(_){return _},o=document.createElement("div");o.className="aipkit-snippet-modal-overlay";let s=document.createElement("div");s.className="aipkit-snippet-modal-content";let r=e?`${e} Indexed Snippet`:"Indexed Snippet",c=n?` (${t(n)})`:"";s.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${r}${c}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">\xD7</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        <pre class="aipkit-snippet-modal-content-text">${t(i)}</pre>
      </div>
    `,o.appendChild(s),document.body.appendChild(o);function l(){o.classList.remove("active"),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)}s.querySelector(".aipkit-snippet-modal-close").addEventListener("click",l),o.addEventListener("click",_=>{_.target===o&&l()});function p(_){_.key==="Escape"&&(l(),document.removeEventListener("keydown",p))}document.addEventListener("keydown",p),requestAnimationFrame(()=>{o.classList.add("active")})}function a(i,n=""){i&&i.querySelectorAll(".aipkit_view_snippet_icon").forEach(e=>{let t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",o=>{o.preventDefault();let s=t.dataset.snippet,r=t.dataset.fileId;d(s,r,n)})})}window.aipkit_showSnippetModal=d,window.aipkit_attachSnippetModalListeners=a})();(function(){"use strict";let d=localStorage.getItem("aipkit_last_global_vector_provider")||"openai";function a(){return d}function i(n){d=n}window.aipkit_getCurrentGlobalVectorProvider=a,window.aipkit_setCurrentGlobalVectorProvider=i})();(function(){"use strict";function d(a,i,n="block",e=null){if(!a||!Array.isArray(i)){console.warn("aipkit_ui_showSection: Invalid arguments provided.");return}i.forEach(t=>{let o=null;e&&e[t]&&e[t]instanceof HTMLElement?o=e[t]:typeof t=="string"&&(o=document.getElementById(t)),o&&(o.id===a||t===a&&e&&e[t]===o?(o.style.display=n,o.classList.add("aipkit-active")):(o.style.display="none",o.classList.remove("aipkit-active")))})}window.aipkit_ui_showSection=d})();(function(){"use strict";function d(a,i,n){if(!a||!i||typeof n!="function"){i&&(i.innerHTML="");return}i.innerHTML="";let{total_logs:e,total_pages:t,current_page:o}=a,s=parseInt(o,10);if(!e||e<=0||!t||t<=1)return;let r=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,c=wp.i18n&&wp.i18n._n?wp.i18n._n:(m,g,k)=>k>1?g:m,l=document.createElement("span");l.className="aipkit_pagination-count",l.textContent=`${e.toLocaleString()} ${c("item","items",e)}`,i.appendChild(l);let p=document.createElement("span");p.className="aipkit_pagination-links";let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML="\xAB "+r("Previous","gpt3-ai-content-generator"),_.disabled=s<=1,_.disabled||_.addEventListener("click",m=>{m.preventDefault(),n(s-1)}),p.appendChild(_);let f=document.createElement("span");f.className="aipkit_pagination-current",f.textContent=`${r("Page","gpt3-ai-content-generator")} ${s} ${r("of","gpt3-ai-content-generator")} ${t}`,p.appendChild(f);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",u.innerHTML=r("Next","gpt3-ai-content-generator")+" \xBB",u.disabled=s>=t,u.disabled||u.addEventListener("click",m=>{m.preventDefault(),n(s+1)}),p.appendChild(u),i.appendChild(p)}window.aipkit_renderLogsPagination=d})();(function(){"use strict";async function d(a){let i=a.target.closest(".aipkit-delete-vector-log-btn");if(!i)return;let n=i.dataset.provider,e=i.dataset.storeId,t=i.dataset.vectorId,o=i.dataset.logId;if(!n||!e||!t||!o){console.error("Delete Vector Log: Missing data attributes on the delete button.",i.dataset),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Could not delete record, missing data.","error","aipkit_knowledge_base_global_status");return}let s=window.aipkit_escapeHtml||function(c){return c};if(!confirm(`Are you sure you want to delete this record?

ID: ${s(t)}

This will remove the entry from both ${s(n)} and your local logs. This action cannot be undone.`))return;if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Vector Log: Missing required UI or API helper functions.");return}let r="aipkit_knowledge_base_global_status";window.aipkit_setLoadingStateOpenAI(i,!0,"","..."),window.aipkit_showOpenAIVectorStatus(`Deleting record ${s(t)}...`,"info",r);try{let c={_ajax_nonce:window.aipkit_dashboard.nonce,provider:n,store_id:e,vector_id:t,log_id:o},l=await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",c);window.aipkit_showOpenAIVectorStatus(l.message||"Record deleted successfully!","success",r);let p=i.closest("tr");p&&(p.style.opacity="0",setTimeout(()=>p.remove(),300))}catch(c){console.error("Delete Vector Log Error:",c),window.aipkit_showOpenAIVectorStatus(`Error: ${c.message||"Failed to delete the record."}`,"error",r),window.aipkit_setLoadingStateOpenAI(i,!1,"","")}}window.aipkit_handleDeleteVectorLogEntryClick=d})();(function(){"use strict";async function d(a){let i=a.target.closest(".aipkit-reindex-vector-log-btn");if(!i)return;let n=i.dataset.provider,e=i.dataset.storeId,t=i.dataset.vectorId,o=i.dataset.logId,s=i.dataset.postId,r=i.dataset.embeddingProvider,c=i.dataset.embeddingModel;if(!n||!e||!t||!o||!s){console.error("Re-index Vector Log: Missing data attributes on the re-index button.",i.dataset),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Could not re-index record, missing data.","error","aipkit_knowledge_base_global_status");return}let l=window.aipkit_escapeHtml||function(_){return _};if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Re-index Vector Log: Missing required UI or API helper functions.");return}let p="aipkit_knowledge_base_global_status";window.aipkit_setLoadingStateOpenAI(i,!0,"","..."),window.aipkit_showOpenAIVectorStatus(`Re-indexing Post ID ${l(s)}...`,"info",p);try{let _={_ajax_nonce:window.aipkit_dashboard.nonce,provider:n,store_id:e,vector_id:t,log_id:o,post_id:s,embedding_provider:r||"",embedding_model:c||""},f=await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",_);window.aipkit_showOpenAIVectorStatus(f.message||"Content re-indexed successfully!","success",p);let u=1,m=i.closest(".aipkit_kb_detail_body").querySelector(".aipkit_logs_pagination_container"),g=u;if(m){let k=m.querySelector(".aipkit_pagination-current");if(k){let w=k.textContent.match(/Page (\d+)/);w&&w[1]&&(g=parseInt(w[1],10))}}n==="OpenAI"&&typeof window.aipkit_fetchAndRenderOpenAIIndexingLogs=="function"?window.aipkit_fetchAndRenderOpenAIIndexingLogs(e,g):n==="Pinecone"&&typeof window.aipkit_fetchAndRenderPineconeIndexingLogs=="function"?window.aipkit_fetchAndRenderPineconeIndexingLogs(e,g):n==="Qdrant"&&typeof window.aipkit_fetchAndRenderQdrantIndexingLogs=="function"&&window.aipkit_fetchAndRenderQdrantIndexingLogs(e,g)}catch(_){console.error("Re-index Vector Log Error:",_),window.aipkit_showOpenAIVectorStatus(`Error: ${_.message||"Failed to re-index the record."}`,"error",p),window.aipkit_setLoadingStateOpenAI(i,!1,"","")}}window.aipkit_handleReindexVectorLogEntryClick=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_knowledge_base_global_status"),n=window.aipkit_escapeHtml||function(p){return p};if(!i){console.warn("Update Provider Status: Status div (#aipkit_knowledge_base_global_status) not found.");return}i.innerHTML="",i.style.display="none";let e=!0,t=!0,o=window.aipkit_openai_vs_config||{},s=window.aipkit_pinecone_vs_config||{},r=window.aipkit_qdrant_vs_config||{};a==="openai"?e=o.apiKeyIsSet!==!1:a==="pinecone"?e=s.apiKeyIsSet!==!1:a==="qdrant"&&(e=r.apiKeyIsSet!==!1,t=r.urlIsSet!==!1);let c="",l=a.charAt(0).toUpperCase()+a.slice(1);if(e||(c+=`${l} API Key not set. `),!t&&a==="qdrant"&&(c+=`${l} URL not set. `),c.trim()!==""){let p=a==="openai"||a==="google"?"providers":"integrations",_=`${window.aipkit_dashboard.adminUrl}?page=wpaicg#${p}`;i.innerHTML=`<span class="aipkit_text-danger">${n(c.trim())} <a href="${n(_)}">Configure Now</a></span>`,i.style.display="block"}}window.aipkit_updateGlobalProviderStatusMessage=d})();(function(){"use strict";let d="aipkit_last_global_vector_provider",a={openai:"Store",pinecone:"Index",qdrant:"Collection"};async function i(n){let e=n.target.value;if(!e)return;let t=["aipkit_setCurrentGlobalVectorProvider","aipkit_updateTargetLabel","aipkit_ui_showSection","aipkit_updateGlobalProviderStatusMessage","aipkit_populateGlobalOpenAITargetSelect","aipkit_listPineconeIndexes","aipkit_listQdrantCollections","aipkit_handleGlobalTargetSelectChange","aipkit_populateGlobalEmbeddingModelSelect"];for(let u of t)if(typeof window[u]!="function"){console.error(`AIPKit Handle Provider Switch: Missing dependency function: ${u}.`);return}window.aipkit_setCurrentGlobalVectorProvider(e),localStorage.setItem(d,e),window.aipkit_updateTargetLabel(a[e]||"Target Store/Index/Collection");let o=["aipkit_vector_openai_management_ui","aipkit_vector_pinecone_management_ui","aipkit_vector_qdrant_management_ui"],s=`aipkit_vector_${e}_management_ui`;window.aipkit_ui_showSection(s,o,"block");let r=document.getElementById(s),l={openai:window.aipkit_initOpenAIVectorStore,pinecone:window.aipkit_initPineconeUI,qdrant:window.aipkit_initQdrantVectorStoreUI}[e];if(r&&typeof l=="function"&&!r.dataset.providerUiInitialized)try{l(),r.dataset.providerUiInitialized="true"}catch(u){console.error(`Error initializing UI for ${e}:`,u)}let p=document.getElementById("aipkit_vs_global_target_select");if(p){p.innerHTML='<option value="">Loading...</option>',p.disabled=!0;let u;e==="openai"?u=window.aipkit_populateGlobalOpenAITargetSelect(!1):e==="pinecone"?u=window.aipkit_listPineconeIndexes(null,!0):e==="qdrant"?u=window.aipkit_listQdrantCollections(null,!0):(p.innerHTML='<option value="" disabled>-- Select Provider First --</option>',u=Promise.resolve()),await u,window.aipkit_handleGlobalTargetSelectChange({target:p})}window.aipkit_updateGlobalProviderStatusMessage(e);let _=document.getElementById("aipkit_vs_global_embedding_model_inline_group");e==="pinecone"||e==="qdrant"?(_&&(_.style.display="block"),window.aipkit_populateGlobalEmbeddingModelSelect()):_&&(_.style.display="none");let f={openai:document.getElementById("aipkit_vs_global_add_openai_store_btn"),pinecone:document.getElementById("aipkit_vs_global_add_pinecone_index_btn"),qdrant:document.getElementById("aipkit_vs_global_add_qdrant_collection_btn")};for(let u in f)if(f[u]){let m=u===e,g=p?p.value.startsWith("_create_new_"):!1;f[u].style.display=m&&!g?"inline-flex":"none"}}window.aipkit_handleGlobalProviderSwitch=i,window.aipkit_updateTargetLabel=function(n){let e=document.getElementById("aipkit_vs_global_target_label");e&&(e.textContent=n)}})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_vs_global_provider_select");if(a){if(typeof window.aipkit_setCurrentGlobalVectorProvider!="function"||typeof window.aipkit_handleGlobalProviderSwitch!="function"){console.error("AIPKit Provider Switcher Init: Missing required utility functions (setCurrentGlobalVectorProvider or handleGlobalProviderSwitch).");return}let i=localStorage.getItem("aipkit_last_global_vector_provider")||"openai";a.value=i,window.aipkit_setCurrentGlobalVectorProvider(i),window.aipkit_handleGlobalProviderSwitch({target:a}),a.addEventListener("change",window.aipkit_handleGlobalProviderSwitch)}else console.warn("AIPKit Provider Switcher Init: Global provider select element (#aipkit_vs_global_provider_select) not found.")}window.aipkit_initGlobalProviderSwitcher=d})();(function(){"use strict";function d(a,i=2){if(!+a)return"0 B";let n=1024,e=i<0?0:i,t=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(a)/Math.log(n));return`${parseFloat((a/Math.pow(n,o)).toFixed(e))} ${t[o]}`}window.aipkit_formatFileSize=d})();(function(){"use strict";function d(a,i="info",n="aipkit_knowledge_base_global_status"){let e=document.getElementById(n);if(!e){console.warn(`showOpenAIVectorStatus: Status container #${n} not found.`);return}e.messageTimeoutId&&clearTimeout(e.messageTimeoutId),e.messageTimeoutId=null;let t=a?a.trim():"";t!==""?(e.className="aipkit_form-help",i==="success"?e.classList.add("aipkit_settings_message-success"):i==="error"?e.classList.add("aipkit_settings_message-error"):e.classList.add("aipkit_settings_message-info"),e.textContent=t,e.style.display="block",e.style.opacity="1",e.classList.add("aipkit-active"),e.messageTimeoutId=setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.textContent===t&&(e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.classList.remove("aipkit-active"))},300)},5e3)):(e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.style.opacity="0",e.classList.remove("aipkit-active"))}window.aipkit_showOpenAIVectorStatus=d})();(function(){"use strict";function d(a,i,n){console.error(`AIPKit OpenAI Vector Store (${i}):`,a);let e=a?.message||`Failed to ${i.replace(/_/g," ")}.`;typeof window.aipkit_showOpenAIVectorStatus=="function"?window.aipkit_showOpenAIVectorStatus(e,"error",n):alert("Error: "+e)}window.aipkit_handleOpenAIAjaxError=d})();(function(){"use strict";function d(a,i,n="Submit",e="Processing..."){if(!a)return;let t=a.querySelector(".aipkit_btn-text")||a.querySelector(".aipkit_btn_text"),o=a.querySelector(".aipkit_spinner"),s=a.querySelector(".dashicons");if(i){if(a.disabled=!0,!a.dataset.originalText)if(t)a.dataset.originalText=t.textContent;else{let c="";a.childNodes.forEach(l=>{l.nodeType===Node.TEXT_NODE&&(c+=l.textContent.trim())}),a.dataset.originalText=c.trim()||n}s&&(s.dataset.originalDisplay||(s.dataset.originalDisplay=s.style.display||"inline-block"),s.style.display="none");let r=a.dataset.loadingText||e;t?(a.dataset.originalText||(a.dataset.originalText=t.textContent),t.textContent=r):(!s||s.style.display==="none")&&(Array.from(a.childNodes).forEach(c=>{c.nodeType===Node.TEXT_NODE&&c.remove()}),r&&a.insertBefore(document.createTextNode(r),a.firstChild)),o&&(o.style.display="inline-block")}else{a.disabled=!1;let r=a.dataset.originalText||n;s&&s.dataset.originalDisplay&&(s.style.display=s.dataset.originalDisplay,delete s.dataset.originalDisplay),t?t.textContent=r:(!s||s.style.display!=="none")&&(Array.from(a.childNodes).forEach(c=>{c.nodeType===Node.TEXT_NODE&&c.remove()}),r&&(!s||s.style.display==="none")&&a.insertBefore(document.createTextNode(r),a.firstChild)),o&&(o.style.display="none"),delete a.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=d})();(function(){"use strict";function d(a){let i=window.aipkit_openai_vs_refs;if(!i.rightColumnContainer){console.error("showRightColumnSection: refs.rightColumnContainer (OpenAI main content area) is not defined or found.");return}let n=[i.rightColumnPlaceholder,i.manageFilesPanel,i.searchStoreFormWrapper],e=!1;n.forEach(t=>{t&&t.id&&(t.id===a?(t.style.display="block",t.classList.add("aipkit-active"),e=!0):(t.style.display="none",t.classList.remove("aipkit-active")))}),!e&&i.rightColumnPlaceholder&&(i.rightColumnPlaceholder.style.display="block",i.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showRightColumnSection=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};async function a(i,n){let e=document.getElementById(i);if(e&&!(e.dataset.limitsLoaded==="true"&&e.innerHTML!=="")){if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Display Upload Limits: Missing showOpenAIVectorStatus or aipkit_apiRequest."),e.innerHTML='<span class="aipkit_text-danger">Error: UI components missing.</span>',e.style.display="block";return}try{window.aipkit_showOpenAIVectorStatus("Fetching upload limits...","info",n);let t=document.getElementById("aipkit_vector_store_nonce_openai");if(!t||!t.value)throw new Error("Nonce field not found for upload limits.");let o=await window.aipkit_apiRequest("aipkit_get_upload_limits",{_ajax_nonce:t.value});if(o&&o.effective_upload_limit_formatted)e.innerHTML=`<strong>Max file size:</strong> ${d(o.effective_upload_limit_formatted)}. Server limits: PHP upload_max_filesize: ${d(o.upload_max_filesize_hr)}, PHP post_max_size: ${d(o.post_max_size_hr)}.`,e.style.display="block",e.dataset.limitsLoaded="true",window.aipkit_showOpenAIVectorStatus("","info",n);else throw new Error("Invalid limit data received.")}catch(t){console.error("Error fetching upload limits:",t),e.innerHTML='<span class="aipkit_text-danger">Could not retrieve upload limits.</span>',e.style.display="block",window.aipkit_showOpenAIVectorStatus("Could not retrieve upload limits.","error",n)}}}window.aipkit_displayUploadLimits=a})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(e){return e},i="aipkit_last_openai_vs_id";window.aipkit_openai_fetched_stores_data=window.aipkit_openai_fetched_stores_data||{};async function n(e=!1){let t=document.getElementById("aipkit_vs_global_target_select"),o="aipkit_knowledge_base_global_status";if(!t)return console.error("Populate Global Target Select: Select element #aipkit_vs_global_target_select not found."),Promise.reject(new Error("Global target select not found."));let s=t.value,r=localStorage.getItem(i),c=t.offsetWidth;c>0&&(t.style.minWidth=`${c}px`,t.style.width=`${c}px`),t.innerHTML=`<option value="">${a(d.loading_stores||"Loading stores...")}</option>`,t.disabled=!0,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("","info",o);let l=null;if(!e&&window.aipkit_initial_openai_stores&&Array.isArray(window.aipkit_initial_openai_stores))l=window.aipkit_initial_openai_stores,l.length===0&&typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No OpenAI stores found in local registry. Sync or create one.","info",o);else try{let f=document.getElementById("aipkit_vector_store_nonce_openai");if(!f||!f.value)throw new Error("OpenAI Vector Store nonce not found for populating global select.");let u={_ajax_nonce:f.value,limit:100,order:"desc"};l=(await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",u)).stores,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Stores synced with OpenAI.","success",o)}catch(f){return console.error("Populate Global Target Select: Error fetching stores via API:",f),t.innerHTML=`<option value="">${a(d.error_fetching_stores||"Error loading stores.")}</option>`,typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(f.message||"Failed to load stores for global select.","error",o),t.disabled=!1,t.style.minWidth="",t.style.width="",Promise.reject(f)}t.innerHTML="",t.appendChild(new Option(`${a(d.selectTargetStore||"-- Select Store --")}`,"")),l&&Array.isArray(l)?(window.aipkit_openai_fetched_stores_data={},l.forEach(f=>{if(f&&f.id){window.aipkit_openai_fetched_stores_data[f.id]=f;let u="(Files: N/A)";f.file_counts&&typeof f.file_counts.total=="number"?u=`(${f.file_counts.total} ${f.file_counts.total===1?"File":"Files"})`:f.file_counts&&(u="(Files: ?)");let m=`${a(f.name||f.id)} ${u}`,g=new Option(m,f.id);t.appendChild(g)}}),l.length===0&&!e&&window.aipkit_initial_openai_stores||l.length===0&&e&&typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No OpenAI stores found. You can create one via the API.","info",o)):(console.error("Populate Global Target Select: Invalid stores data received.",l),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error processing store list.","error",o));let p=new Option("+ "+(d.createNewStoreButton||"Create New Store..."),"_create_new_openai_");t.appendChild(p);let _=s;return!_&&r&&(_=r),_&&_!=="_create_new_openai_"&&t.querySelector(`option[value="${CSS.escape(_)}"]`)?t.value=_:t.options.length>1&&t.options[0].value===""?t.selectedIndex=0:t.options.length>0&&(t.selectedIndex=t.options[0].value===""?0:t.options.length>1?1:0),t.disabled=!1,t.style.minWidth="",t.style.width="",Promise.resolve()}window.aipkit_populateGlobalOpenAITargetSelect=n})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{};function a(e){let t=document.getElementById("aipkit_vs_global_new_store_inline_form_openai"),o=document.getElementById("aipkit_vs_global_new_store_name_openai");t&&(t.style.display=e?"block":"none",e&&o&&(o.value="",o.focus()))}function i(){let e=document.getElementById("aipkit_vs_global_new_store_name_openai"),t=document.getElementById("aipkit_vs_global_create_store_btn_openai"),o="aipkit_knowledge_base_global_status";if(!e||!t){console.error("Create New OpenAI Store Inline: Missing required elements.");return}let s=e.value.trim();if(!s){typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("New store name cannot be empty.","error",o),e.focus();return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_handleOpenAIAjaxError!="function"||typeof window.aipkit_populateGlobalOpenAITargetSelect!="function"){console.error("Create New OpenAI Store Inline: Missing required UI or API helper functions."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Core UI components missing for store creation.","error",o);return}window.aipkit_setLoadingStateOpenAI(t,!0,d.createStoreButton||"Create Store",d.creatingStore||"Creating..."),window.aipkit_showOpenAIVectorStatus("Creating new OpenAI store...","info",o);let r=document.getElementById("aipkit_vector_store_nonce_openai");if(!r||!r.value){typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(new Error("OpenAI Vector Store nonce not found."),"create_vector_store_inline",o),typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,d.createStoreButton||"Create Store");return}let c={_ajax_nonce:r.value,name:s,source_type:"inline_global_form_create"};window.aipkit_apiRequest("aipkit_create_vector_store_openai",c).then(l=>{window.aipkit_showOpenAIVectorStatus(l.message||"Store created successfully!","success",o),a(!1);let p=l.store;p&&p.id?(window.aipkit_openai_fetched_stores_data&&(window.aipkit_openai_fetched_stores_data[p.id]=p),window.aipkit_initial_openai_stores&&Array.isArray(window.aipkit_initial_openai_stores)&&(window.aipkit_initial_openai_stores.some(_=>_.id===p.id)||window.aipkit_initial_openai_stores.unshift(p)),window.aipkit_populateGlobalOpenAITargetSelect(!1).then(()=>{let _=document.getElementById("aipkit_vs_global_target_select");_&&(_.value=p.id,_.dispatchEvent(new Event("change")))})):window.aipkit_populateGlobalOpenAITargetSelect(!0)}).catch(l=>{typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(l,"create_vector_store_inline",o)}).finally(()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,d.createStoreButton||"Create Store")})}function n(){let e=document.getElementById("aipkit_vs_global_add_openai_store_btn"),t=document.getElementById("aipkit_vs_global_create_store_btn_openai"),o=document.getElementById("aipkit_vs_global_cancel_create_store_btn_openai");e&&e.addEventListener("click",()=>a(!0)),t&&t.addEventListener("click",i),o&&o.addEventListener("click",()=>a(!1))}window.aipkit_initOpenAIInlineStoreCreator=n})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};function i(n,e=null){if(!n){console.warn("Delete Store (Management): No store ID provided."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("No store selected to delete.","error","aipkit_knowledge_base_global_status");return}if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_showRightColumnSection!="function"){console.error("Delete Store (Management): Missing one or more UI/API helper functions.");return}let t="aipkit_knowledge_base_global_status",o=e;!o&&window.aipkit_openai_vs_refs&&(o=window.aipkit_openai_vs_refs.deleteSelectedStoreButtonPanel),window.aipkit_showOpenAIVectorStatus("Deleting vector store...","info",t),o&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!0,d.deleteStoreButton||"Delete Store",d.deletingStore||"Deleting..."),window.aipkit_apiRequest("aipkit_delete_vector_store_openai",{store_id:n,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value}).then(s=>{window.aipkit_showOpenAIVectorStatus(s.message||"Vector store deleted.","success",t);let r=document.querySelector(`.aipkit_vector_store_list_item[data-provider="OpenAI"][data-id="${n}"]`);r&&r.remove();let c=document.querySelector(".aipkit_vector_store_list_container"),l=c?.querySelector(".aipkit_vector_store_list_table tbody");c&&l&&l.children.length===0&&(c.innerHTML=`<p class="aipkit_text-center" style="padding: 15px;">${a(d.noKnowledgeBasesFound||'No knowledge bases found. Click "Add Content" to create one.')}</p>`),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"?window.aipkit_populateGlobalOpenAITargetSelect(!0):console.error("Delete Store (Management): populateGlobalOpenAITargetSelect function not found. Cannot refresh global dropdown."),typeof window.aipkit_switchKbView=="function"&&window.aipkit_switchKbView("cards")}).catch(s=>{o&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,d.deleteStoreButton||"Delete Store"),typeof window.aipkit_handleOpenAIAjaxError=="function"?window.aipkit_handleOpenAIAjaxError(s,"delete_vector_store",t):console.error("Delete Store (Management): aipkit_handleOpenAIAjaxError function not found.")}).finally(()=>{o&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,d.deleteStoreButton||"Delete Store")})}window.aipkit_deleteOpenAIVectorStore=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(n,e){let t=window.aipkit_openai_vs_refs.panelStatusDiv;if(t){if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_populateGlobalOpenAITargetSelect!="function"){console.error("List Files (Sync): Missing one or more required UI or API helper functions.");return}window.aipkit_setLoadingStateOpenAI(e,!0,"Sync Files from API","Syncing...");try{let r=`Successfully synced ${(await window.aipkit_apiRequest("aipkit_list_files_in_vector_store_openai",{store_id:n,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value})).files?.length||0} file(s) from OpenAI. File counts are updated.`;typeof window.aipkit_showOpenAIVectorStatus=="function"?window.aipkit_showOpenAIVectorStatus(r,"success","aipkit_knowledge_base_global_status"):(t.textContent=r,t.className="aipkit_form-help aipkit_settings_message-success",t.style.display="block"),await window.aipkit_populateGlobalOpenAITargetSelect(!0)}catch(o){typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(o,"list_files_in_store","aipkit_knowledge_base_global_status")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Sync Files from API")}}}window.aipkit_listFilesInStoreForPanel=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(n,e=1){let o=window.aipkit_openai_vs_refs?.panelFilesTableBody,s=document.getElementById("aipkit_openai_logs_pagination");if(!o||!s){console.error("Fetch OpenAI Logs: Log table body or pagination container not found.");return}o.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${a(d.loading_logs||"Loading records...")}</td></tr>`,s.innerHTML="";try{let r=document.getElementById("aipkit_vector_store_nonce_openai");if(!r||!r.value)throw new Error("OpenAI management nonce for logs not found.");let c=await window.aipkit_apiRequest("aipkit_get_openai_indexing_logs",{_ajax_nonce:r.value,store_id:n,page:e}),l=c.logs||[];if(l.length===0){o.innerHTML=`<tr><td colspan="7" class="aipkit_text-center">${a(d.noLogsForStore||"No records found for this store.")}</td></tr>`;return}let p="";l.forEach(_=>{let u=`<span class="aipkit_status-tag ${_.status==="indexed"||_.status==="skipped_already_indexed"?"aipkit_status-success":_.status==="failed"?"aipkit_status-warning":"aipkit_status-info"}" style="white-space: nowrap;">${a(_.status.replace(/_/g," "))}</span>`,m=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(_.message||"",_.file_id||"","openai",_):"N/A",g=m==="Text"?"aipkit_type-text":m==="File Upload"?"aipkit_type-file":m==="Site Content"?"aipkit_type-site":"aipkit_type-na",k=_.message?_.message.length>50?a(_.message.substring(0,50))+"...":a(_.message):"",w=_.indexed_content||"",h=_.post_title||(_.post_id?`Post #${_.post_id}`:_.file_id&&w?w.length>50?w.substring(0,50)+"...":w:_.file_id?"Text/File Upload":"Action"),b=h.length>30?h.substring(0,30)+"...":h,y=_.file_id||"N/A",S=y.length>10?y.substring(0,10)+"...":y,I=typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(_.timestamp):_.timestamp||"N/A",x="";w&&(x=`<button type="button" class="button button-secondary button-small aipkit_view_snippet_icon"
                                    data-file-id="${a(_.id)}" 
                                    data-snippet="${a(w)}" 
                                    title="${a("View Indexed Snippet")}">
                                ${a("View")}
                             </button>`);let q="";m==="Site Content"&&_.post_id&&(q=`<button type="button" class="button button-primary button-small aipkit-reindex-vector-log-btn"
                                            data-provider="OpenAI"
                                            data-store-id="${a(n)}"
                                            data-vector-id="${a(_.file_id)}"
                                            data-log-id="${a(_.id||"")}"
                                            data-post-id="${a(_.post_id)}"
                                            title="${a("Re-index this post. This will delete the current entry and index the latest content.")}">
                                        ${a("Re-index")}
                                 </button>`);let $="";_.file_id&&($=`<button type="button" class="button button-link-delete button-small aipkit-delete-vector-log-btn" 
                                                   data-provider="OpenAI" 
                                                   data-store-id="${a(n)}" 
                                                   data-vector-id="${a(_.file_id)}"
                                                   data-log-id="${a(_.id||"")}"
                                                   title="${a("This will attempt to remove the file from OpenAI and delete this log. This action cannot be undone.")}">
                                                   ${a("Delete")}
                                            </button>`),p+=`<tr data-log-id="${a(_.id||"")}">
                    <td style="white-space: nowrap;">${a(I)}</td>
                    <td class="aipkit-code-snippet aipkit-code-snippet-cell" style="white-space: nowrap;" title="${a(y)}">${a(S)}</td>
                    <td style="white-space: nowrap;">${u}</td>
                    <td style="white-space: nowrap;"><span class="aipkit_content-type-tag ${g}">${a(m)}</span></td>
                    <td title="${a(_.message||"")}">${k}</td>
                    <td title="${a(h)}">${a(b)}</td>
                    <td class="aipkit_actions_cell">
                        <div class="aipkit-table-actions-group">
                            ${q}
                            ${x}
                            ${$}
                        </div>
                    </td>
                </tr>`}),o.innerHTML=p,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(o,"OpenAI"),typeof window.aipkit_renderLogsPagination=="function"&&c.pagination&&window.aipkit_renderLogsPagination(c.pagination,s,_=>i(n,_))}catch(r){console.error("Fetch OpenAI Logs Error:",r),o.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">Error loading logs: ${a(r.message||"Unknown error")}</td></tr>`}}window.aipkit_fetchAndRenderOpenAIIndexingLogs=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};function i(n,e,t){let o=window.aipkit_openai_vs_refs.panelStatusDiv;o&&(o.innerHTML="Deleting file from store...",o.className="aipkit_form-help aipkit_settings_message-info",o.style.display="block"),t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!0,"Delete","Deleting..."),window.aipkit_apiRequest("aipkit_delete_file_from_vector_store_openai",{store_id:n,file_id:e,_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value}).then(s=>{o&&(o.textContent=s.message||"File deleted successfully.",o.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{o.textContent===(s.message||"File deleted successfully.")&&(o.textContent="",o.style.display="none")},4e3));let r=window.aipkit_openai_vs_refs.manageFilesPanel?.querySelector("#aipkit_manage_files_panel_title_openai"),l=(r?r.textContent:"").match(/Files in:\s*(.*)/),p=l&&l[1]?l[1].trim():n;typeof window.aipkit_listFilesInStoreForPanel=="function"&&window.aipkit_listFilesInStoreForPanel(n,p),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"&&window.aipkit_populateGlobalOpenAITargetSelect()}).catch(s=>{o&&(o.textContent=s.message||"Failed to delete file.",o.className="aipkit_form-help aipkit_settings_message-error",setTimeout(()=>{o.textContent===(s.message||"Failed to delete file.")&&(o.textContent="",o.style.display="none")},6e3))}).finally(()=>{t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,"Delete")})}window.aipkit_deleteFileFromStoreOpenAI=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};function i(n,e){let t=window.aipkit_openai_vs_refs;if(!t.manageFilesPanel||!t.rightColumnContainer){console.error("Show Files Panel: Manage files panel or main content area not found in global refs.");return}t.manageFilesPanel.dataset.activeStoreId=n;let o=t.manageFilesPanel.querySelector("#aipkit_manage_files_panel_title_openai"),s=t.panelStatusDiv;if(!s){console.error("Show Files Panel: One or more required child elements of the files panel are missing."),typeof window.aipkit_showRightColumnSection=="function"&&t.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(t.rightColumnPlaceholder.id);return}o&&(o.innerHTML=`Recent Indexing Activity for: <strong>${a(e)}</strong>`),s.innerHTML="",typeof window.aipkit_fetchAndRenderOpenAIIndexingLogs=="function"?window.aipkit_fetchAndRenderOpenAIIndexingLogs(n):console.error("Show Files Panel: aipkit_fetchAndRenderOpenAIIndexingLogs function not found."),typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_showRightColumnSection(t.manageFilesPanel.id)}window.aipkit_showStoreFilesPanel=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};function i(){let n=window.aipkit_openai_vs_refs,e=n.searchStoreFormWrapper?.querySelector("#aipkit_search_vector_store_btn_openai"),t=n.searchStoreFormWrapper?.querySelector("#aipkit_search_vector_store_id_openai"),o=n.searchStoreFormWrapper?.querySelector("#aipkit_search_query_text_openai"),s=n.searchStoreFormWrapper?.querySelector("#aipkit_search_top_k_openai"),r=n.searchStoreFormWrapper?.querySelector("#aipkit_search_results_area_openai"),c="aipkit_knowledge_base_global_status";if(!e||!t||!o||!s||!r){console.error("Search Store: Missing required form or results elements within the search wrapper."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Error: Search UI elements missing.","error",c);return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_handleOpenAIAjaxError!="function"){console.error("Search Store: Missing one or more UI/API helper functions."),window.aipkit_showOpenAIVectorStatus("Error: Core functions missing for search.","error",c);return}let l=t.value,p=o.value.trim(),_=parseInt(s.value,10)||3;if(!l){window.aipkit_showOpenAIVectorStatus("Vector Store ID is missing.","error",c);return}if(!p){window.aipkit_showOpenAIVectorStatus("Search query cannot be empty.","error",c);return}window.aipkit_setLoadingStateOpenAI(e,!0,d.searchButton||"Search",d.searching||"Searching..."),window.aipkit_showOpenAIVectorStatus(d.vectorSearching||"Searching vector store...","info",c),r.innerHTML=`<p class="aipkit_text-center">${d.loading||"Loading..."}</p>`;let f={_ajax_nonce:document.getElementById("aipkit_vector_store_nonce_openai").value,store_id:l,query_text:p,top_k:_};window.aipkit_apiRequest("aipkit_search_vector_store_openai",f).then(u=>{if(window.aipkit_setLoadingStateOpenAI(e,!1,d.searchButton||"Search"),r.innerHTML="",u.results&&Array.isArray(u.results))if(u.results.length===0)r.innerHTML=`<p class="aipkit_text-center">No results found for "${a(p)}".</p>`,window.aipkit_showOpenAIVectorStatus("No results found.","info",c);else{let m=document.createElement("ul");m.style.listStyleType="decimal",m.style.paddingLeft="20px",u.results.forEach(g=>{let k=document.createElement("li");k.style.marginBottom="10px",k.style.borderBottom="1px dashed #eee",k.style.paddingBottom="5px";let w=`<strong>File ID:</strong> ${a(g.id||"N/A")}<br>`;g.score!==null&&typeof g.score<"u"&&(w+=`<strong>Score:</strong> ${Number(g.score).toFixed(4)}<br>`);let h="[No text content found]";if(g.content&&Array.isArray(g.content)){let b=g.content.filter(y=>y.type==="text"&&y.text).map(y=>y.text);b.length>0&&(h=b.join(`

`))}else g.content&&typeof g.content=="string"&&(h=g.content);if(h){let b=h.length>300?h.substring(0,300)+"...":h;w+=`<strong>Content Snippet:</strong><pre>${a(b)}</pre>`}g.metadata&&Object.keys(g.metadata).length>0&&(w+=`<strong>Metadata:</strong><pre>${a(JSON.stringify(g.metadata,null,2))}</pre>`),k.innerHTML=w,m.appendChild(k)}),r.appendChild(m),window.aipkit_showOpenAIVectorStatus(`Found ${u.results.length} results.`,"success",c)}else throw new Error(u.message||"Invalid response format for search results.")}).catch(u=>{window.aipkit_setLoadingStateOpenAI(e,!1,d.searchButton||"Search"),typeof window.aipkit_handleOpenAIAjaxError=="function"&&window.aipkit_handleOpenAIAjaxError(u,"search_vector_store",c),r.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">${a(u.message||"Failed to perform search.")}</p>`})}window.aipkit_searchOpenAIVectorStore=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};function i(n,e){let o=window.aipkit_openai_vs_refs.searchStoreFormWrapper;if(!o){console.error("Show Search Form: Search form wrapper not found in global refs.");return}let s=o.querySelector("#aipkit_search_vector_store_id_openai"),r=o.querySelector("#aipkit_search_store_form_title_openai"),c=o.querySelector("#aipkit_search_results_area_openai"),l=o.querySelector("#aipkit_search_query_text_openai");s&&(s.value=n),r&&(r.textContent=`Search in: ${a(e)}`),c&&(c.innerHTML=""),l&&(l.value=""),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("","info","aipkit_vs_global_provider_status"),typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_showRightColumnSection(o.id)}window.aipkit_showSearchFormForStore=i})();(function(){"use strict";window.aipkit_openai_vs_refs=window.aipkit_openai_vs_refs||{},window.aipkit_initial_openai_stores=null;function d(){window.aipkit_openai_vs_config&&window.aipkit_openai_vs_config.initialStores?window.aipkit_initial_openai_stores=window.aipkit_openai_vs_config.initialStores:console.warn("AIPKit OpenAI Init: Initial OpenAI stores not found in localized config.");let a=document.getElementById("aipkit_vector_openai_management_ui");if(!a){console.warn("AIPKit AI Training (OpenAI Init): OpenAI management block (#aipkit_vector_openai_management_ui) not found.");return}let i=window.aipkit_openai_vs_refs;if(i.rightColumnContainer=a.querySelector("#aipkit_openai_vs_main_content_area"),i.rightColumnPlaceholder=a.querySelector("#aipkit_openai_vs_right_col_placeholder"),i.manageFilesPanel=a.querySelector("#aipkit_manage_files_panel_openai"),i.manageFilesPanel&&(i.panelFilesTableBody=i.manageFilesPanel.querySelector("#aipkit_vector_store_files_table_body_openai"),i.panelStatusDiv=i.manageFilesPanel.querySelector("#aipkit_manage_files_panel_status_openai")),i.searchStoreFormWrapper=a.querySelector("#aipkit_search_store_form_openai_wrapper_modal_placeholder"),i.apiKeyIsSet=!!document.getElementById("aipkit_vector_store_nonce_openai"),!i.apiKeyIsSet&&window.aipkit_openai_vs_config?.apiKeyIsSet===!1){i.rightColumnPlaceholder&&i.rightColumnContainer&&(i.rightColumnContainer.innerHTML=`<div class="aipkit_ai_training_section_wrapper aipkit_openai_vs_content_section" id="aipkit_openai_vs_right_col_placeholder" style="display: flex;">
                                                            <div class="aipkit_ai_training_section_header"><h5>Store Details</h5></div>
                                                            <p class="aipkit_text-center" style="padding: 20px;">OpenAI API Key not set. Store details cannot be displayed. Configure in Main Settings.</p>
                                                        </div>`),console.warn("AIPKit AI Training (OpenAI Init): API key not set. Management features disabled.");return}if(typeof window.aipkit_showRightColumnSection=="function"&&i.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(i.rightColumnPlaceholder.id),a.dataset.openaiManagementListenersAttached!=="true"){if(i.manageFilesPanel){let n=i.manageFilesPanel.querySelector("#aipkit_openai_vs_refresh_files_btn");n&&typeof window.aipkit_listFilesInStoreForPanel=="function"&&n.addEventListener("click",()=>{let e=i.manageFilesPanel.dataset.activeStoreId;e&&window.aipkit_listFilesInStoreForPanel(e,n)}),i.panelFilesTableBody?.addEventListener("click",e=>{let t=e.target.closest(".aipkit-delete-vector-log-btn"),o=e.target.closest(".aipkit-reindex-vector-log-btn"),s=e.target.closest(".aipkit_view_snippet_icon");t&&!t.disabled?typeof window.aipkit_handleDeleteVectorLogEntryClick=="function"&&window.aipkit_handleDeleteVectorLogEntryClick(e):o&&!o.disabled&&typeof window.aipkit_handleReindexVectorLogEntryClick=="function"&&window.aipkit_handleReindexVectorLogEntryClick(e)})}i.searchStoreFormWrapper&&i.searchStoreFormWrapper.addEventListener("click",n=>{let e=n.target.closest("#aipkit_search_vector_store_btn_openai"),t=n.target.closest("#aipkit_close_search_panel_btn_openai");if(e)typeof window.aipkit_searchOpenAIVectorStore=="function"&&window.aipkit_searchOpenAIVectorStore();else if(t){let o=i.manageFilesPanel?.dataset.activeStoreId;if(o&&typeof window.aipkit_showStoreFilesPanel=="function"){let s=window.aipkit_openai_fetched_stores_data?window.aipkit_openai_fetched_stores_data[o]:null,r=s?.name||o;window.aipkit_showStoreFilesPanel(o,r,s)}else typeof window.aipkit_showRightColumnSection=="function"&&i.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(i.rightColumnPlaceholder.id)}}),a.dataset.openaiManagementListenersAttached="true"}}window.aipkit_initOpenAIVectorStore=d})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(e){return e},i="aipkit_last_pinecone_index_id";function n(e=null){let t=document.getElementById("aipkit_vs_global_target_select"),o=localStorage.getItem(i);if(!t){console.error("Populate Global Pinecone Target: Select element #aipkit_vs_global_target_select not found.");return}let s=t.value;t.innerHTML=`<option value="">${a(d.selectTargetIndex||"-- Select Index --")}</option>`;let r=e!==null?e:window.aipkit_pinecone_vs_refs.syncedIndexes||[];r&&Array.isArray(r)&&r.length>0?r.forEach(p=>{let _=p.name||p.id;if(_){let f=p.name||_,u=p.total_vector_count!==void 0&&p.total_vector_count!==null&&p.total_vector_count!=="Error"&&p.total_vector_count!=="No Host"?` (Vectors: ${Number(p.total_vector_count).toLocaleString()})`:(p.total_vector_count||"")==="Error"||(p.total_vector_count||"")==="No Host"?" (Stats Err)":" (Vectors: ?)",m=`${a(f)}${u}`,g=new Option(m,_);t.appendChild(g)}}):t.appendChild(new Option(a(d.noPineconeIndexesFound||"No Pinecone indexes found. Sync or create one."),""));let c=new Option("+ "+(d.createNewIndexButton||"Create New Index..."),"_create_new_pinecone_");t.appendChild(c);let l=null;s&&s!=="_create_new_pinecone_"&&t.querySelector(`option[value="${CSS.escape(s)}"]`)?l=s:o&&t.querySelector(`option[value="${CSS.escape(o)}"]`)&&(l=o),l?t.value=l:t.options.length>1&&t.options[0].value===""?t.selectedIndex=0:t.options.length>0&&(t.selectedIndex=t.options[0].value===""?0:t.options.length>1?1:0),t.disabled=!(r&&r.length>0&&t.options.length>1)}window.aipkit_populateGlobalPineconeTargetSelect=n})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(e){return e},i="aipkit_last_pinecone_index_id";window.aipkit_pinecone_vs_refs=window.aipkit_pinecone_vs_refs||{},window.aipkit_pinecone_vs_refs.syncedIndexes=window.aipkit_pinecone_vs_config?.initialIndexes||[];async function n(e=null,t=!1){let o=window.aipkit_pinecone_vs_refs,s="aipkit_knowledge_base_global_status";if(typeof window.aipkit_populateGlobalPineconeTargetSelect!="function")return console.error("AIPKit Pinecone List: aipkit_populateGlobalPineconeTargetSelect function not found."),Promise.reject(new Error("Dependency missing for populating select."));if(t&&o.syncedIndexes&&o.syncedIndexes.length>0){window.aipkit_populateGlobalPineconeTargetSelect(o.syncedIndexes);let r=document.getElementById("aipkit_vs_global_target_select"),c=localStorage.getItem(i),l=r?r.value:null;if(!l&&c&&r&&r.querySelector(`option[value="${CSS.escape(c)}"]`)&&(r.value=c,l=c),l&&typeof window.aipkit_showPineconeIndexDetails=="function"){let p=o.syncedIndexes.find(_=>_.name===l);p&&window.aipkit_showPineconeIndexDetails(l,p)}return Promise.resolve()}e&&typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(e,!0,d.syncIndexesButton||"Sync Indexes",d.syncing||"Syncing..."):e&&(e.disabled=!0,e.textContent=d.syncing||"Syncing..."),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus("Syncing Pinecone indexes...","info",s);try{let r=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!r||!r.value)throw new Error("Pinecone management nonce not found for listing indexes.");let c=await window.aipkit_apiRequest("aipkit_list_indexes_pinecone",{_ajax_nonce:r.value});o.syncedIndexes=c.indexes||[],window.aipkit_pinecone_vs_refs.syncedIndexes=o.syncedIndexes,window.aipkit_populateGlobalPineconeTargetSelect(o.syncedIndexes),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(c.message||"Pinecone indexes synced successfully.","success",s)}catch(r){console.error("Pinecone List Indexes Error:",r),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(`Error: ${r.message||"Failed to sync Pinecone indexes."}`,"error",s)}finally{e&&typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(e,!1,d.syncIndexesButton||"Sync Indexes"):e&&(e.disabled=!1,e.textContent=d.syncIndexesButton||"Sync Indexes")}}window.aipkit_listPineconeIndexes=n})();(function(){"use strict";function d(a,i="info"){let n=window.aipkit_pinecone_vs_refs?.searchStatusDiv;n&&(n.textContent=a,n.className=`aipkit_form-help aipkit_settings_message-${i}`,n.style.display=a?"block":"none",a&&i!=="info"&&setTimeout(()=>{n.textContent===a&&(n.textContent="",n.style.display="none")},5e3))}window.aipkit_showPineconeSearchStatus=d})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};function i(n,e){let t=window.aipkit_pinecone_vs_refs;if(!t.searchFormWrapper||!t.searchIndexIdInput||!t.searchFormTitle||!t.searchResultsArea||!t.searchQueryVectorInput||!t.searchNamespaceInput){console.error("Pinecone Search (Show Form): Missing required search form elements in refs.");return}t.searchIndexIdInput.value=n,t.searchFormTitle.textContent=`Search in Index: ${a(e)}`,t.searchQueryVectorInput.value="",t.searchNamespaceInput.value="",t.searchResultsArea.innerHTML="",t.searchStatusDiv&&(t.searchStatusDiv.innerHTML=""),t.manageIndexPanel&&(t.manageIndexPanel.style.display="none"),t.rightColumnPlaceholder&&(t.rightColumnPlaceholder.style.display="none"),t.createFormWrapperGlobal&&(t.createFormWrapperGlobal.style.display="none"),t.searchFormWrapper.style.display="block"}window.aipkit_showSearchFormForPineconeIndex=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(){let n=window.aipkit_pinecone_vs_refs;if(!n.searchSubmitButton||!n.searchIndexIdInput||!n.searchQueryVectorInput||!n.searchTopKInput||!n.searchResultsArea||!n.searchStatusDiv||!n.searchNamespaceInput){console.error("Pinecone Search (Perform): Missing search form submit or input elements in refs for search action.");return}if(typeof window.aipkit_showPineconeSearchStatus!="function"||typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Pinecone Search (Perform): Missing required UI or API helper functions.");return}let e=n.searchIndexIdInput.value,t=n.searchQueryVectorInput.value.trim(),o=n.searchNamespaceInput.value.trim(),s=parseInt(n.searchTopKInput.value,10)||3,r=document.getElementById("aipkit_vs_global_embedding_model_select"),c=r?r.value:"",l=r&&r.options[r.selectedIndex]?.dataset.provider||"openai";if(!e){window.aipkit_showPineconeSearchStatus("Index ID missing.","error");return}if(!t){window.aipkit_showPineconeSearchStatus("Search query empty.","error");return}if(!c){window.aipkit_showPineconeSearchStatus('Select embedding model from "Add Content" form.',"error");return}window.aipkit_setLoadingStateOpenAI(n.searchSubmitButton,!0,d.searchButton||"Search",d.searching||"Searching..."),window.aipkit_showPineconeSearchStatus(d.vectorSearching||"Searching index...","info"),n.searchResultsArea.innerHTML=`<p class="aipkit_text-center">${d.loading||"Loading..."}</p>`;let p={_ajax_nonce:document.getElementById("aipkit_vector_store_pinecone_nonce_management").value,index_id:e,query_text:t,embedding_provider:l,embedding_model:c,top_k:s,...o&&{namespace:o}};try{let _=await window.aipkit_apiRequest("aipkit_search_pinecone_index",p);if(window.aipkit_showPineconeSearchStatus(_.message||"Search complete.","success"),_.results&&Array.isArray(_.results))if(_.results.length===0)n.searchResultsArea.innerHTML=`<p class="aipkit_text-center">No results for "${a(t)}".</p>`;else{let f=document.createElement("ul");f.style.listStyleType="decimal",f.style.paddingLeft="20px",_.results.forEach(u=>{let m=document.createElement("li");m.style.marginBottom="10px",m.style.borderBottom="1px dashed #eee",m.style.paddingBottom="5px";let g=`<strong>ID:</strong> ${a(u.id||"N/A")}<br>`;u.score!==null&&typeof u.score<"u"&&(g+=`<strong>Score:</strong> ${Number(u.score).toFixed(4)}<br>`),u.metadata&&Object.keys(u.metadata).length>0&&(g+=`<strong>Metadata:</strong><pre style="white-space: pre-wrap; word-wrap: break-word; max-height: 100px; overflow-y: auto; background: #f0f0f0; border:1px solid #ddd; padding: 5px;">${a(JSON.stringify(u.metadata,null,2))}</pre>`,u.metadata.url&&u.metadata.title&&(g+=`<a href="${a(u.metadata.url)}" target="_blank" rel="noopener noreferrer">${a(u.metadata.title)}</a><br>`)),m.innerHTML=g,f.appendChild(m)}),n.searchResultsArea.innerHTML="",n.searchResultsArea.appendChild(f)}else n.searchResultsArea.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Invalid search response.</p>'}catch(_){window.aipkit_showPineconeSearchStatus(`Search Error: ${_.message||"Unknown error"}`,"error"),n.searchResultsArea.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">${a(_.message||"Failed search.")}</p>`}finally{window.aipkit_setLoadingStateOpenAI(n.searchSubmitButton,!1,d.searchButton||"Search")}}window.aipkit_searchPineconeIndex=i})();(function(){"use strict";function d(a,i="info",n=!0){let e=window.aipkit_pinecone_vs_refs,t=n?e?.createIndexStatusDivGlobal:null;t&&(t.textContent=a,t.className=`aipkit_form-help aipkit_settings_message-${i}`,t.style.display=a?"block":"none",a&&i!=="info"&&setTimeout(()=>{t.textContent===a&&(t.textContent="",t.style.display="none")},5e3))}window.aipkit_showPineconeCreateStatus=d})();(function(){"use strict";function d(){let a=window.aipkit_pinecone_vs_refs;a.createFormWrapperGlobal&&(a.createFormWrapperGlobal.style.display="none"),a.rightColumnPlaceholder&&(a.rightColumnPlaceholder.style.display="block")}window.aipkit_hideCreatePineconeIndexFormGlobal=d})();(function(){"use strict";function d(){let a=window.aipkit_pinecone_vs_refs;if(!a.createFormWrapperGlobal||!a.newIndexNameInputGlobal||!a.newIndexDimensionInputGlobal){console.error("Show Global Pinecone Create Form: Missing essential global form elements.");return}a.newIndexNameInputGlobal.value="",a.newIndexDimensionInputGlobal.value="1536",a.createIndexStatusDivGlobal&&(a.createIndexStatusDivGlobal.innerHTML=""),a.manageIndexPanel&&(a.manageIndexPanel.style.display="none"),a.searchFormWrapper&&(a.searchFormWrapper.style.display="none"),a.rightColumnPlaceholder&&(a.rightColumnPlaceholder.style.display="none"),a.createFormWrapperGlobal.style.display="block",a.newIndexNameInputGlobal.focus()}window.aipkit_showCreatePineconeIndexFormGlobal=d})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(n=!1){let e=window.aipkit_pinecone_vs_refs,t=n?e.newIndexNameInputGlobal:null,o=n?e.newIndexDimensionInputGlobal:null,s=n?e.createIndexSubmitButtonGlobal:null,r=n?e.createIndexStatusDivGlobal:null,c=n?e.createFormWrapperGlobal:null;if(!s||!t||!o||!r||!c){console.error("Create Pinecone Index: Missing required form elements for ",n?"global form.":"panel form (not supported).");return}let l=t.value.trim(),p=parseInt(o.value,10);if(!l){typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus("Index name is required.","error",n):console.error("aipkit_showPineconeCreateStatus not defined");return}if(!p||p<=0){typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus("Valid vector dimension is required.","error",n):console.error("aipkit_showPineconeCreateStatus not defined");return}window.aipkit_setLoadingStateOpenAI(s,!0,d.createIndexButton||"Create Index",d.creatingIndex||"Creating..."),typeof window.aipkit_showPineconeCreateStatus=="function"?window.aipkit_showPineconeCreateStatus(d.creatingIndex||"Creating index...","info",n):console.error("aipkit_showPineconeCreateStatus not defined");try{let _=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!_||!_.value)throw new Error("Pinecone management nonce not found for create operation.");let f={_ajax_nonce:_.value,name:l,dimension:p,metric:"cosine",spec_cloud:"aws",spec_region:"us-east-1"},u=await window.aipkit_apiRequest("aipkit_create_index_pinecone",f);typeof window.aipkit_showPineconeCreateStatus=="function"&&window.aipkit_showPineconeCreateStatus(u.message||"Index created successfully!","success",n),c&&(c.style.display="none"),typeof window.aipkit_listPineconeIndexes=="function"&&await window.aipkit_listPineconeIndexes(null,!1);let m=document.getElementById("aipkit_vs_global_target_select");if(m){let g=!1;for(let k=0;k<m.options.length;k++)if(m.options[k].value===l){g=!0;break}g?(m.value=l,m.dispatchEvent(new Event("change"))):e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="block")}else e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="block")}catch(_){typeof window.aipkit_showPineconeCreateStatus=="function"&&window.aipkit_showPineconeCreateStatus(`Error: ${_.message||"Failed to create index."}`,"error",n)}finally{window.aipkit_setLoadingStateOpenAI(s,!1,d.createIndexButton||"Create Index")}}window.aipkit_handleCreatePineconeIndex=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(n,e=null){let t=window.aipkit_pinecone_vs_refs,o="aipkit_knowledge_base_global_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Pinecone Index: Missing required UI or API helper functions."),e&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,d.deleteIndexButton||"Delete Index");return}window.aipkit_showOpenAIVectorStatus(`Deleting Pinecone index "${a(n)}"...`,"info",o),e&&window.aipkit_setLoadingStateOpenAI(e,!0,d.deleteIndexButton||"Delete Index",d.deletingIndex||"Deleting...");try{let s=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!s||!s.value)throw new Error("Pinecone management nonce not found for delete operation.");let r=await window.aipkit_apiRequest("aipkit_delete_index_pinecone",{_ajax_nonce:s.value,index_name:n});window.aipkit_showOpenAIVectorStatus(r.message||`Pinecone index "${a(n)}" deleted.`,"success",o);let c=document.querySelector(`.aipkit_vector_store_list_item[data-provider="Pinecone"][data-id="${n}"]`);c&&c.remove();let l=document.querySelector(".aipkit_vector_store_list_container"),p=l?.querySelector(".aipkit_vector_store_list_table tbody");l&&p&&p.children.length===0&&(l.innerHTML=`<p class="aipkit_text-center" style="padding: 15px;">${a(d.noKnowledgeBasesFound||'No knowledge bases found. Click "Add Content" to create one.')}</p>`),typeof window.aipkit_listPineconeIndexes=="function"&&await window.aipkit_listPineconeIndexes(null,!1),typeof window.aipkit_switchKbView=="function"&&window.aipkit_switchKbView("cards")}catch(s){console.error(`Delete Pinecone Index Error for "${a(n)}":`,s),window.aipkit_showOpenAIVectorStatus(`Error deleting index: ${a(s.message)||"Unknown error."}`,"error",o)}finally{e&&window.aipkit_setLoadingStateOpenAI(e,!1,d.deleteIndexButton||"Delete Index")}}window.aipkit_deletePineconeIndex=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(n,e=1){let t=window.aipkit_pinecone_vs_refs;if(!t.indexLogsContainer){console.error("Fetch Pinecone Logs: Log container not found in refs.");return}let o=document.getElementById("aipkit_pinecone_logs_pagination");if(!o){console.error("Fetch Pinecone Logs: Pagination container not found.");return}t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${a(d.loading_logs||"Loading records...")}</p>`,o.innerHTML="";try{let s=document.getElementById("aipkit_vector_store_pinecone_nonce_management");if(!s||!s.value)throw new Error("Pinecone management nonce for logs not found.");let r=await window.aipkit_apiRequest("aipkit_get_pinecone_indexing_logs",{_ajax_nonce:s.value,index_name:n,page:e}),c=r.logs||[];if(c.length===0){t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center">${a(d.noLogsForStore||"No records found for this index.")}</p>`;return}let l='<div class="aipkit_data-table aipkit_index_logs_table"><table>';if(l+='<thead><tr><th>Time</th><th>Vector ID</th><th style="white-space: nowrap;">Status</th><th style="white-space: nowrap;">Type</th><th>Message</th><th>Embedding</th><th>Source</th><th class="aipkit_actions_cell_header">Actions</th></tr></thead><tbody>',c.forEach(p=>{let f=`<span class="aipkit_status-tag ${p.status==="indexed"||p.status==="skipped_already_indexed"?"aipkit_status-success":p.status==="failed"?"aipkit_status-warning":"aipkit_status-info"}" style="white-space: nowrap;">${a(p.status)}</span>`,u=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(p.message||"",p.file_id||"","pinecone",p):"N/A",m=u==="Text"?"aipkit_type-text":u==="File Upload"?"aipkit_type-file":u==="Site Content"?"aipkit_type-site":"aipkit_type-na",g=p.message?p.message.length>50?a(p.message.substring(0,50))+"...":a(p.message):"",k=p.file_id&&p.file_id.startsWith("chatfile_"),w=`<span class="aipkit_content-type-tag ${m}">${a(u)}</span>`;k&&(w+=' <span class="dashicons dashicons-admin-users aipkit_user_upload_icon" title="User uploaded record"></span>');let h=p.file_id?p.file_id.length>10?p.file_id.substring(0,10)+"...":p.file_id:"N/A",b=p.indexed_content||"",y="";b&&(y=`<button type="button" class="button button-secondary button-small aipkit_view_snippet_icon" 
                                      data-file-id="${a(p.id)}" 
                                      data-snippet="${a(b)}" 
                                      title="${a("View Indexed Snippet")}">
                                      ${a("View")}
                              </button>`);let S="";u==="Site Content"&&p.post_id&&(S=`<button type="button" class="button button-primary button-small aipkit-reindex-vector-log-btn"
                                            data-provider="Pinecone"
                                            data-store-id="${a(n)}"
                                            data-vector-id="${a(p.file_id)}"
                                            data-log-id="${a(p.id||"")}"
                                            data-post-id="${a(p.post_id)}"
                                            data-embedding-provider="${a(p.embedding_provider)}"
                                            data-embedding-model="${a(p.embedding_model)}"
                                            title="${a("Re-index this post. This will delete the current entry and index the latest content.")}">
                                        ${a("Re-index")}
                                 </button>`);let I="";p.file_id&&(I=`<button type="button" class="button button-link-delete button-small aipkit-delete-vector-log-btn" 
                                                   data-provider="Pinecone" 
                                                   data-store-id="${a(n)}" 
                                                   data-vector-id="${a(p.file_id)}" 
                                                   data-log-id="${a(p.id||"")}"
                                                   title="${a("Delete this record from Pinecone and local logs")}">
                                                   ${a("Delete")}
                                            </button>`);let x=typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(p.timestamp):p.timestamp||"N/A",q=`${a(p.embedding_provider||"N/A")} / ${a(p.embedding_model||"N/A")}`,$=p.post_id?`Post ID: ${p.post_id}`:p.file_id&&b?b.length>50?b.substring(0,50)+"...":b:p.file_id?"Text/File Upload":"N/A",M=$.length>30?$.substring(0,30)+"...":$;l+=`<tr data-log-id="${a(p.id||"")}">
                    <td style="white-space: nowrap;">${a(x)}</td>
                    <td class="aipkit-code-snippet aipkit-code-snippet-cell" style="white-space: nowrap;" title="${a(p.file_id||"N/A")}">${a(h)}</td>
                    <td style="white-space: nowrap;">${f}</td>
                    <td style="white-space: nowrap;">${w}</td>
                    <td title="${a(p.message||"")}">${g}</td>
                    <td style="white-space: nowrap;">${q}</td>
                    <td title="${a($)}">${a(M)}</td>
                    <td class="aipkit_actions_cell">
                        <div class="aipkit-table-actions-group">
                            ${S}
                            ${y}
                            ${I}
                        </div>
                    </td>
                </tr>`}),l+="</tbody></table></div>",t.indexLogsContainer.innerHTML=l,typeof window.aipkit_attachSnippetModalListeners=="function"){let p=t.indexLogsContainer.querySelector("table");p&&window.aipkit_attachSnippetModalListeners(p,"Pinecone")}typeof window.aipkit_renderLogsPagination=="function"&&r.pagination&&window.aipkit_renderLogsPagination(r.pagination,o,p=>i(n,p))}catch(s){console.error("Fetch Pinecone Logs Error:",s),t.indexLogsContainer.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">Error loading logs: ${a(s.message||"Unknown error")}</p>`}}window.aipkit_fetchAndRenderPineconeIndexingLogs=i})();(function(){"use strict";function d(a){let i=window.aipkit_pinecone_vs_refs;if(!i||!i.managementBlock){console.error("showPineconeSection: Pinecone refs or management block not initialized.");return}let n=[i.rightColumnPlaceholder,i.manageIndexPanel,i.searchFormWrapper,i.createFormWrapperGlobal],e=!1;n.forEach(t=>{t&&((t===i.rightColumnPlaceholder?"placeholder":t===i.manageIndexPanel?"manage_panel":t===i.searchFormWrapper?"search_form":t===i.createFormWrapperGlobal?"create_form_global":null)===a?(t.style.display="block",t.classList.add("aipkit-active"),e=!0):(t.style.display="none",t.classList.remove("aipkit-active")))}),!e&&i.rightColumnPlaceholder&&(i.rightColumnPlaceholder.style.display="block",i.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showPineconeSection=d})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(n){let e=window.aipkit_pinecone_vs_refs;if(!e.manageIndexPanel||!e.indexLogsContainer){console.error("Pinecone Details: Missing one or more UI elements in refs for showing index details.");return}e.manageIndexPanel.dataset.activeIndexName=n,window.aipkit_showPineconeSection("manage_panel"),typeof window.aipkit_fetchAndRenderPineconeIndexingLogs=="function"?aipkit_fetchAndRenderPineconeIndexingLogs(n):(console.error("Dependency missing: aipkit_fetchAndRenderPineconeIndexingLogs"),e.indexLogsContainer.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Error: Log fetching component is not available.</p>')}window.aipkit_showPineconeIndexDetails=i})();(function(){"use strict";window.aipkit_pinecone_vs_refs=window.aipkit_pinecone_vs_refs||{},window.aipkit_pinecone_vs_refs.syncedIndexes=window.aipkit_pinecone_vs_config?.initialIndexes||[];let d=window.aipkit_escapeHtml||function(n){return n},a=window.aipkit_dashboard?.text||{};function i(){let n=document.getElementById("aipkit_vector_pinecone_management_ui");if(!n){console.warn("Pinecone Init: Pinecone management block (#aipkit_vector_pinecone_management_ui) not found.");return}let e=window.aipkit_pinecone_vs_refs;if(e.managementBlock=n,e.rightColumnPlaceholder=n.querySelector("#aipkit_pinecone_vs_right_col_placeholder"),e.manageIndexPanel=n.querySelector("#aipkit_manage_selected_pinecone_index_panel"),e.manageIndexPanel&&(e.panelTitle=e.manageIndexPanel.querySelector("#aipkit_manage_pinecone_index_panel_title"),e.panelStatusDiv=e.manageIndexPanel.querySelector("#aipkit_manage_pinecone_index_panel_status"),e.indexLogsContainer=e.manageIndexPanel.querySelector("#aipkit_pinecone_index_logs_container")),e.searchFormWrapper=n.querySelector("#aipkit_search_pinecone_index_form_wrapper"),e.searchFormWrapper&&(e.searchFormTitle=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_form_title"),e.searchIndexIdInput=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_id"),e.searchQueryVectorInput=e.searchFormWrapper.querySelector("#aipkit_search_query_vector_pinecone"),e.searchNamespaceInput=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_namespace"),e.searchTopKInput=e.searchFormWrapper.querySelector("#aipkit_search_top_k_pinecone"),e.searchSubmitButton=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_btn"),e.searchCloseButton=e.searchFormWrapper.querySelector("#aipkit_close_search_pinecone_panel_btn"),e.searchResultsArea=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_results_area"),e.searchStatusDiv=e.searchFormWrapper.querySelector("#aipkit_search_pinecone_index_form_status")),e.createFormWrapperGlobal=document.getElementById("aipkit_vs_global_new_store_inline_form_pinecone"),e.createFormWrapperGlobal&&(e.newIndexNameInputGlobal=e.createFormWrapperGlobal.querySelector("#aipkit_vs_global_new_store_name_pinecone"),e.newIndexDimensionInputGlobal=e.createFormWrapperGlobal.querySelector("#aipkit_vs_global_new_store_dimension_pinecone"),e.createIndexSubmitButtonGlobal=e.createFormWrapperGlobal.querySelector("#aipkit_vs_global_create_store_btn_pinecone"),e.createIndexCloseButtonGlobal=e.createFormWrapperGlobal.querySelector("#aipkit_vs_global_cancel_create_store_btn_pinecone"),e.createIndexStatusDivGlobal=e.createFormWrapperGlobal.querySelector("#aipkit_create_pinecone_index_status_global")),e.apiKeyIsSet=!!window.aipkit_pinecone_vs_config?.apiKeyIsSet,!e.apiKeyIsSet){e.manageIndexPanel&&(e.manageIndexPanel.style.display="none"),e.searchFormWrapper&&(e.searchFormWrapper.style.display="none"),e.createFormWrapperGlobal&&(e.createFormWrapperGlobal.style.display="none");return}e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="block"),e.manageIndexPanel&&(e.manageIndexPanel.style.display="none"),e.searchFormWrapper&&(e.searchFormWrapper.style.display="none"),e.createFormWrapperGlobal&&(e.createFormWrapperGlobal.style.display="none");let t="data-pinecone-listener-attached";if(n.getAttribute(t))return;e.manageIndexPanel&&e.manageIndexPanel.addEventListener("click",s=>{let r=s.target.closest(".aipkit-delete-vector-log-btn"),c=s.target.closest(".aipkit-reindex-vector-log-btn");r&&typeof window.aipkit_handleDeleteVectorLogEntryClick=="function"?window.aipkit_handleDeleteVectorLogEntryClick(s):c&&typeof window.aipkit_handleReindexVectorLogEntryClick=="function"&&window.aipkit_handleReindexVectorLogEntryClick(s)}),e.searchFormWrapper&&(e.searchSubmitButton&&typeof window.aipkit_searchPineconeIndex=="function"&&e.searchSubmitButton.addEventListener("click",window.aipkit_searchPineconeIndex),e.searchCloseButton&&e.searchCloseButton.addEventListener("click",()=>{let s=e.searchIndexIdInput?.value;s&&e.syncedIndexes?.find(r=>r.name===s)&&typeof window.aipkit_showPineconeIndexDetails=="function"?window.aipkit_showPineconeIndexDetails(s,e.syncedIndexes.find(r=>r.name===s)):e.rightColumnPlaceholder&&(e.rightColumnPlaceholder.style.display="block",e.manageIndexPanel&&(e.manageIndexPanel.style.display="none"),e.searchFormWrapper&&(e.searchFormWrapper.style.display="none"),e.createFormWrapperGlobal&&(e.createFormWrapperGlobal.style.display="none"))}));let o=document.getElementById("aipkit_vs_global_add_pinecone_index_btn");o&&typeof window.aipkit_showCreatePineconeIndexFormGlobal=="function"&&(o.dataset.listenerAttached||(o.addEventListener("click",window.aipkit_showCreatePineconeIndexFormGlobal),o.dataset.listenerAttached="true")),e.createIndexSubmitButtonGlobal&&typeof window.aipkit_handleCreatePineconeIndex=="function"&&(e.createIndexSubmitButtonGlobal.dataset.listenerAttached||(e.createIndexSubmitButtonGlobal.addEventListener("click",()=>window.aipkit_handleCreatePineconeIndex(!0)),e.createIndexSubmitButtonGlobal.dataset.listenerAttached="true")),e.createIndexCloseButtonGlobal&&typeof window.aipkit_hideCreatePineconeIndexFormGlobal=="function"&&(e.createIndexCloseButtonGlobal.dataset.listenerAttached||(e.createIndexCloseButtonGlobal.addEventListener("click",window.aipkit_hideCreatePineconeIndexFormGlobal),e.createIndexCloseButtonGlobal.dataset.listenerAttached="true")),n.setAttribute(t,"true")}window.aipkit_initPineconeUI=i})();(function(){"use strict";function d(a){let i=window.aipkit_qdrant_vs_refs;if(!i||!i.managementBlock){console.error("showQdrantSection: Qdrant refs or management block not initialized.");return}let n=[i.rightColumnPlaceholder,i.manageCollectionPanel,i.searchFormWrapper,i.createFormWrapperGlobal],e=!1;n.forEach(t=>{t&&((t===i.rightColumnPlaceholder?"placeholder":t===i.manageCollectionPanel?"manage_panel":t===i.searchFormWrapper?"search_form":t===i.createFormWrapperGlobal?"create_form_global":null)===a?(t.style.display="block",t.classList.add("aipkit-active"),e=!0):(t.style.display="none",t.classList.remove("aipkit-active")))}),!e&&i.rightColumnPlaceholder&&(i.rightColumnPlaceholder.style.display="block",i.rightColumnPlaceholder.classList.add("aipkit-active"))}window.aipkit_showQdrantSection=d})();(function(){"use strict";function d(a,i="info",n=!0,e=!1){let t=window.aipkit_qdrant_vs_refs,o=null;if(e?o=t?.searchStatusDiv:n?o=t?.createCollectionStatusDivGlobal:o=t?.panelStatusDiv,!o&&(o=document.getElementById("aipkit_vs_global_provider_status"),!o)){console.warn("showQdrantStatus: No status div found.");return}o.messageTimeoutId&&clearTimeout(o.messageTimeoutId),o.messageTimeoutId=null;let s=a?a.trim():"";s!==""?(o.className="aipkit_form-help",i==="success"?o.classList.add("aipkit_settings_message-success"):i==="error"?o.classList.add("aipkit_settings_message-error"):o.classList.add("aipkit_settings_message-info"),o.textContent=s,o.style.display="block",o.style.opacity="1",o.classList.add("aipkit-active"),o.messageTimeoutId=setTimeout(()=>{o.style.opacity="0",setTimeout(()=>{o.textContent===s&&(o.textContent="",o.className="aipkit_form-help",o.style.display="none",o.classList.remove("aipkit-active"))},300)},5e3)):(o.textContent="",o.className="aipkit_form-help",o.style.display="none",o.style.opacity="0",o.classList.remove("aipkit-active"))}window.aipkit_showQdrantStatus=d})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(t){return t},i="aipkit_last_qdrant_collection_id";function n(t=null){let o=document.getElementById("aipkit_vs_global_target_select"),s=localStorage.getItem(i);if(!o){console.error("Populate Global Qdrant Target: Select element #aipkit_vs_global_target_select not found.");return}let r=o.value,c=o.offsetWidth;c>0&&(o.style.minWidth=`${c}px`,o.style.width=`${c}px`),o.innerHTML=`<option value="">${a(d.selectTargetCollection||"-- Select Collection --")}</option>`;let l=t!==null?t:window.aipkit_qdrant_vs_refs?.syncedCollections||window.aipkit_qdrant_vs_config?.initialCollections||[];l&&l.length>0?l.forEach(f=>{let u=f.name||f.id;if(u){let m=new Option(a(u),u);o.appendChild(m)}}):o.appendChild(new Option(a(d.noQdrantCollectionsFound||"No Qdrant collections. Sync or create one."),""));let p=new Option("+ "+(d.createNewCollectionButton||"Create New Collection..."),"_create_new_qdrant_");o.appendChild(p);let _=null;r&&r!=="_create_new_qdrant_"&&o.querySelector(`option[value="${CSS.escape(r)}"]`)?_=r:s&&o.querySelector(`option[value="${CSS.escape(s)}"]`)&&(_=s),_?o.value=_:o.options.length>1&&o.options[0].value===""?o.selectedIndex=0:o.options.length>0&&(o.selectedIndex=o.options[0].value===""?0:o.options.length>1?1:0),o.disabled=!(l&&l.length>0&&o.options.length>1),o.style.minWidth="",o.style.width=""}async function e(t=null,o=!1){let s=window.aipkit_qdrant_vs_refs||{},r="aipkit_knowledge_base_global_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_apiRequest!="function")return console.error("List Qdrant Collections: Missing required UI or API helper functions."),Promise.reject(new Error("Dependencies missing."));if(o&&window.aipkit_qdrant_vs_config?.initialCollections&&window.aipkit_qdrant_vs_config.initialCollections.length>0){s.syncedCollections=window.aipkit_qdrant_vs_config.initialCollections,n(s.syncedCollections);let c=document.getElementById("aipkit_vs_global_target_select"),l=localStorage.getItem(i),p=c?c.value:null;return!p&&l&&c&&c.querySelector(`option[value="${CSS.escape(l)}"]`)&&(c.value=l,p=l),p&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"&&window.aipkit_fetchAndShowQdrantCollectionDetails(p),Promise.resolve()}t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!0,"Sync Collections","Syncing..."),window.aipkit_showOpenAIVectorStatus("Syncing Qdrant collections...","info",r);try{let c=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!c||!c.value)throw new Error("Qdrant management nonce not found for listing collections.");let l=await window.aipkit_apiRequest("aipkit_list_collections_qdrant",{_ajax_nonce:c.value});s.syncedCollections=l.collections||[],window.aipkit_qdrant_vs_refs.syncedCollections=s.syncedCollections,n(s.syncedCollections),window.aipkit_showOpenAIVectorStatus(l.message||"Qdrant collections synced.","success",r)}catch(c){console.error("List Qdrant Collections Error:",c),window.aipkit_showOpenAIVectorStatus(`Error: ${c.message||"Failed to sync Qdrant collections."}`,"error",r)}finally{t&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(t,!1,"Sync Collections")}}window.aipkit_populateGlobalQdrantTargetSelect=n,window.aipkit_listQdrantCollections=e})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{};function a(){let e=window.aipkit_qdrant_vs_refs;if(!e.createFormWrapperGlobal||!e.newCollectionNameInputGlobal||!e.newCollectionVectorSizeInputGlobal){console.error("Show Global Qdrant Create Form: Missing essential global form elements.");return}e.newCollectionNameInputGlobal.value="",e.newCollectionVectorSizeInputGlobal.value="1536",e.createCollectionStatusDivGlobal&&(e.createCollectionStatusDivGlobal.innerHTML=""),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("create_form_global"),e.newCollectionNameInputGlobal.focus()}function i(){typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}async function n(e=!0){let t=window.aipkit_qdrant_vs_refs,o=e?t.newCollectionNameInputGlobal:null,s=e?t.newCollectionVectorSizeInputGlobal:null,r=e?t.createCollectionSubmitButtonGlobal:null;if(!r||!o||!s){console.error("Create Qdrant Collection: Missing required form elements for ",e?"global form.":"panel form (deprecated).");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showQdrantStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Create Qdrant Collection: Missing core UI/API helper functions.");return}let c=o.value.trim(),l=parseInt(s.value,10);if(!c){window.aipkit_showQdrantStatus("Collection name is required.","error",e);return}if(!l||l<=0){window.aipkit_showQdrantStatus("Valid vector size (dimension) is required.","error",e);return}window.aipkit_setLoadingStateOpenAI(r,!0,d.createCollectionButton||"Create Collection",d.creatingCollection||"Creating..."),window.aipkit_showQdrantStatus(d.creatingCollection||"Creating collection...","info",e);try{let p=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!p||!p.value)throw new Error("Qdrant management nonce not found for create.");let _={_ajax_nonce:p.value,name:c,dimension:l,metric:"Cosine"},f=await window.aipkit_apiRequest("aipkit_create_collection_qdrant",_);window.aipkit_showQdrantStatus(f.message||"Collection created successfully!","success",e),e&&i(),typeof window.aipkit_listQdrantCollections=="function"&&await window.aipkit_listQdrantCollections(null,!1);let u=document.getElementById("aipkit_vs_global_target_select");u&&Array.from(u.options).some(g=>g.value===c)?(u.value=c,u.dispatchEvent(new Event("change"))):typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}catch(p){window.aipkit_showQdrantStatus(`Error: ${p.message||"Failed to create collection."}`,"error",e)}finally{window.aipkit_setLoadingStateOpenAI(r,!1,d.createCollectionButton||"Create Collection")}}window.aipkit_showCreateQdrantCollectionFormGlobal=a,window.aipkit_hideCreateQdrantCollectionFormGlobal=i,window.aipkit_handleCreateQdrantCollection=n})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(n,e){let t=window.aipkit_qdrant_vs_refs,o="aipkit_knowledge_base_global_status";if(typeof window.aipkit_showOpenAIVectorStatus!="function"||typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Delete Qdrant Collection: Missing required UI or API helper functions."),e&&typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(e,!1,"Delete Collection");return}window.aipkit_showOpenAIVectorStatus(`Deleting Qdrant collection "${a(n)}"...`,"info",o),e&&window.aipkit_setLoadingStateOpenAI(e,!0,"Delete Collection","Deleting...");try{let s=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!s||!s.value)throw new Error("Qdrant management nonce not found for delete.");let r=await window.aipkit_apiRequest("aipkit_delete_collection_qdrant",{_ajax_nonce:s.value,collection_name:n});window.aipkit_showOpenAIVectorStatus(r.message||`Collection "${a(n)}" deleted.`,"success",o);let c=document.querySelector(`.aipkit_vector_store_list_item[data-provider="Qdrant"][data-id="${n}"]`);c&&c.remove();let l=document.querySelector(".aipkit_vector_store_list_container"),p=l?.querySelector(".aipkit_vector_store_list_table tbody");l&&p&&p.children.length===0&&(l.innerHTML=`<p class="aipkit_text-center" style="padding: 15px;">${a(d.noKnowledgeBasesFound||'No knowledge bases found. Click "Add Content" to create one.')}</p>`),typeof window.aipkit_listQdrantCollections=="function"&&await window.aipkit_listQdrantCollections(null,!1),typeof window.aipkit_switchKbView=="function"&&window.aipkit_switchKbView("cards")}catch(s){console.error(`Delete Qdrant Collection Error for "${a(n)}":`,s),window.aipkit_showOpenAIVectorStatus(`Error deleting collection: ${a(s.message)||"Unknown error."}`,"error",o)}finally{e&&window.aipkit_setLoadingStateOpenAI(e,!1,"Delete Collection")}}window.aipkit_deleteQdrantCollection=i})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(e){return e};async function i(e){let t=window.aipkit_qdrant_vs_refs;if(!t.manageCollectionPanel||!t.collectionLogsContainer){console.error("Qdrant Details: Missing one or more UI elements in refs for showing collection details."),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder");return}t.manageCollectionPanel.dataset.activeCollectionName=e,window.aipkit_showQdrantSection("manage_panel"),n(e,1)}async function n(e,t=1){let o=window.aipkit_qdrant_vs_refs;if(!o.collectionLogsContainer)return;let s=document.getElementById("aipkit_qdrant_logs_pagination");if(!s){console.error("Fetch Qdrant Logs: Pagination container not found.");return}o.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${a(d.loading_logs||"Loading records...")}</p>`,s.innerHTML="";try{let r=document.getElementById("aipkit_vector_store_qdrant_nonce_management");if(!r||!r.value)throw new Error("Nonce for Qdrant logs not found.");let c=await window.aipkit_apiRequest("aipkit_get_vector_data_source_logs_for_store",{_ajax_nonce:r.value,provider:"Qdrant",store_id:e,page:t}),l=c.logs||[];if(l.length===0){o.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center">${a(d.noLogsForStore||"No records found for this collection.")}</p>`;return}let p='<div class="aipkit_data-table aipkit_index_logs_table"><table>';if(p+='<thead><tr><th>Time</th><th>Point ID</th><th style="white-space: nowrap;">Status</th><th style="white-space: nowrap;">Type</th><th>Message</th><th>Embedding</th><th>Source</th><th class="aipkit_actions_cell_header">Actions</th></tr></thead><tbody>',l.forEach(_=>{let u=`<span class="aipkit_status-tag ${_.status==="indexed"||_.status==="skipped_already_indexed"?"aipkit_status-success":_.status==="failed"?"aipkit_status-warning":"aipkit_status-info"}" style="white-space: nowrap;">${a(_.status)}</span>`,m=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(_.message||"",_.file_id||"","qdrant",_):"N/A",g=m==="Text"?"aipkit_type-text":m==="File Upload"?"aipkit_type-file":m==="Site Content"?"aipkit_type-site":"aipkit_type-na",k=_.message?_.message.length>50?a(_.message.substring(0,50))+"...":a(_.message):"",w=_.status==="success",h=`<span class="aipkit_content-type-tag ${g}">${a(m)}</span>`;w&&(h+=' <span class="dashicons dashicons-admin-users aipkit_user_upload_icon" title="User uploaded record"></span>');let b=_.file_id?_.file_id.length>10?_.file_id.substring(0,10)+"...":_.file_id:"N/A",y=_.indexed_content||"",S="";y&&(S=`<button type="button" class="button button-secondary button-small aipkit_view_snippet_icon"
                                    data-file-id="${a(_.id)}" 
                                    data-snippet="${a(y)}" 
                                    title="${a("View Indexed Snippet")}">
                                    ${a("View")}
                              </button>`);let I="";m==="Site Content"&&_.post_id&&(I=`<button type="button" class="button button-primary button-small aipkit-reindex-vector-log-btn"
                                            data-provider="Qdrant"
                                            data-store-id="${a(e)}"
                                            data-vector-id="${a(_.file_id)}"
                                            data-log-id="${a(_.id||"")}"
                                            data-post-id="${a(_.post_id)}"
                                            data-embedding-provider="${a(_.embedding_provider)}"
                                            data-embedding-model="${a(_.embedding_model)}"
                                            title="${a("Re-index this post. This will delete the current entry and index the latest content.")}">
                                        ${a("Re-index")}
                                 </button>`);let x="";_.file_id&&(x=`<button type="button" class="button button-link-delete button-small aipkit-delete-vector-log-btn" 
                                                   data-provider="Qdrant" 
                                                   data-store-id="${a(e)}" 
                                                   data-vector-id="${a(_.file_id)}"
                                                   data-log-id="${a(_.id||"")}"
                                                   title="${a("Delete this record from Qdrant and local logs")}">
                                                   ${a("Delete")}
                                            </button>`);let q=typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(_.timestamp):_.timestamp||"N/A",$=`${a(_.embedding_provider||"N/A")} / ${a(_.embedding_model||"N/A")}`,M=_.post_id?`Post ID: ${_.post_id}`:_.file_id&&y?y.length>50?y.substring(0,50)+"...":y:_.file_id?"Text/File Upload":"N/A",T=M.length>30?M.substring(0,30)+"...":M;p+=`<tr data-log-id="${a(_.id||"")}">
                    <td style="white-space: nowrap;">${a(q)}</td>
                    <td class="aipkit-code-snippet aipkit-code-snippet-cell" style="white-space: nowrap;" title="${a(_.file_id||"N/A")}">${a(b)}</td>
                    <td style="white-space: nowrap;">${u}</td>
                    <td style="white-space: nowrap;">${h}</td>
                    <td title="${a(_.message||"")}">${k}</td>
                    <td style="white-space: nowrap;">${$}</td>
                    <td title="${a(M)}">${a(T)}</td>
                    <td class="aipkit_actions_cell">
                        <div class="aipkit-table-actions-group">
                           ${I}
                           ${S}
                           ${x}
                        </div>
                    </td>
                </tr>`}),p+="</tbody></table></div>",o.collectionLogsContainer.innerHTML=p,typeof window.aipkit_attachSnippetModalListeners=="function"){let _=o.collectionLogsContainer.querySelector("table");_&&window.aipkit_attachSnippetModalListeners(_,"Qdrant")}typeof window.aipkit_renderLogsPagination=="function"&&c.pagination&&window.aipkit_renderLogsPagination(c.pagination,s,_=>n(e,_))}catch(r){console.error("Fetch Qdrant Logs Error:",r),o.collectionLogsContainer.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">Error loading logs: ${a(r.message||"Unknown error")}</p>`}}window.aipkit_fetchAndShowQdrantCollectionDetails=i,window.aipkit_fetchAndRenderQdrantIndexingLogs=n})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};function a(i,n){let e=window.aipkit_qdrant_vs_refs;if(!e.searchFormWrapper||!e.searchCollectionIdInput||!e.searchFormTitle||!e.searchResultsArea||!e.searchQueryTextInput||!e.searchFilterInput){console.error("Qdrant Search (Show Form): Missing required search form elements in refs."),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder");return}e.searchCollectionIdInput.value=i,e.searchFormTitle.textContent=`Search in Collection: ${d(n)}`,e.searchQueryTextInput.value="",e.searchFilterInput.value="",e.searchResultsArea.innerHTML="",e.searchStatusDiv&&(e.searchStatusDiv.innerHTML=""),typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("search_form")}window.aipkit_showSearchFormForQdrantCollection=a})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{},a=window.aipkit_escapeHtml||function(n){return n};async function i(){let n=window.aipkit_qdrant_vs_refs;if(!n.searchSubmitButton||!n.searchCollectionIdInput||!n.searchQueryTextInput||!n.searchTopKInput||!n.searchResultsArea||!n.searchFilterInput){console.error("Qdrant Search (Perform): Missing search form submit or input elements in refs for search action.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showQdrantStatus!="function"||typeof window.aipkit_apiRequest!="function"){console.error("Qdrant Search (Perform): Missing essential UI/API helper functions.");return}let e=n.searchCollectionIdInput.value,t=n.searchQueryTextInput.value.trim(),o=parseInt(n.searchTopKInput.value,10)||3,s=n.searchFilterInput.value.trim(),r=document.getElementById("aipkit_vs_global_embedding_model_select"),c=r?r.value:"",l=r&&r.options[r.selectedIndex]?.dataset.provider||"openai";if(!e){window.aipkit_showQdrantStatus("Collection ID missing.","error",!1,!0);return}if(!t){window.aipkit_showQdrantStatus("Search query empty.","error",!1,!0);return}if(!c){window.aipkit_showQdrantStatus('Select embedding model from "Add Content" form.',"error",!1,!0);return}let p=null;if(s)try{p=JSON.parse(s)}catch{window.aipkit_showQdrantStatus("Invalid JSON in filter.","error",!1,!0);return}window.aipkit_setLoadingStateOpenAI(n.searchSubmitButton,!0,"Search","Searching..."),window.aipkit_showQdrantStatus("Searching...","info",!1,!0),n.searchResultsArea.innerHTML=`<p class="aipkit_text-center">${d.loading||"Loading..."}</p>`;let _={_ajax_nonce:document.getElementById("aipkit_vector_store_qdrant_nonce_management").value,collection_id:e,query_text:t,embedding_provider:l,embedding_model:c,top_k:o,...p&&{filter:JSON.stringify(p)}};try{let f=await window.aipkit_apiRequest("aipkit_search_qdrant_collection",_);if(window.aipkit_showQdrantStatus(f.message||"Search complete.","success",!1,!0),f.results&&Array.isArray(f.results))if(f.results.length===0)n.searchResultsArea.innerHTML=`<p class="aipkit_text-center">No results for "${a(t)}".</p>`;else{let u="<ul>";f.results.forEach(m=>{let g=`<li><strong>ID:</strong> ${a(m.id||"N/A")}<br>`;m.score!==null&&typeof m.score<"u"&&(g+=`<strong>Score:</strong> ${Number(m.score).toFixed(4)}<br>`),m.metadata&&Object.keys(m.metadata).length>0&&(g+=`<strong>Payload:</strong><pre style="max-height: 100px; overflow-y: auto;">${a(JSON.stringify(m.metadata,null,2))}</pre>`,m.metadata.url&&m.metadata.title&&(g+=`<a href="${a(m.metadata.url)}" target="_blank" rel="noopener noreferrer">${a(m.metadata.title)}</a><br>`)),u+=`${g}</li>`}),u+="</ul>",n.searchResultsArea.innerHTML=u}else n.searchResultsArea.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Invalid search response.</p>'}catch(f){window.aipkit_showQdrantStatus(`Search Error: ${f.message||"Unknown error"}`,"error",!1,!0),n.searchResultsArea.innerHTML=`<p class="aipkit_text-center aipkit_text-danger">${a(f.message||"Failed search.")}</p>`}finally{window.aipkit_setLoadingStateOpenAI(n.searchSubmitButton,!1,"Search")}}window.aipkit_searchQdrantCollection=i})();(function(){"use strict";window.aipkit_qdrant_vs_refs=window.aipkit_qdrant_vs_refs||{},window.aipkit_qdrant_vs_refs.syncedCollections=window.aipkit_qdrant_vs_config?.initialCollections||[];function d(){let a=document.getElementById("aipkit_vector_qdrant_management_ui");if(!a){console.warn("Qdrant Init: Qdrant management block (#aipkit_vector_qdrant_management_ui) not found.");return}let i=window.aipkit_qdrant_vs_refs;i.syncedCollections=window.aipkit_qdrant_vs_config?.initialCollections||[],i.urlIsSet=window.aipkit_qdrant_vs_config?.urlIsSet||!1,i.apiKeyIsSet=window.aipkit_qdrant_vs_config?.apiKeyIsSet||!1,i.managementBlock=a,i.rightColumnPlaceholder=a.querySelector("#aipkit_qdrant_vs_right_col_placeholder"),i.manageCollectionPanel=a.querySelector("#aipkit_manage_selected_qdrant_collection_panel"),i.manageCollectionPanel&&(i.panelTitle=i.manageCollectionPanel.querySelector("#aipkit_manage_qdrant_collection_panel_title"),i.panelStatusDiv=i.manageCollectionPanel.querySelector("#aipkit_manage_qdrant_collection_panel_status"),i.collectionLogsContainer=i.manageCollectionPanel.querySelector("#aipkit_qdrant_collection_logs_container")),i.searchFormWrapper=a.querySelector("#aipkit_search_qdrant_collection_form_wrapper"),i.searchFormWrapper&&(i.searchFormTitle=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_form_title"),i.searchCollectionIdInput=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_id"),i.searchQueryTextInput=i.searchFormWrapper.querySelector("#aipkit_search_query_text_qdrant"),i.searchTopKInput=i.searchFormWrapper.querySelector("#aipkit_search_top_k_qdrant"),i.searchFilterInput=i.searchFormWrapper.querySelector("#aipkit_search_filter_qdrant"),i.searchSubmitButton=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_btn"),i.searchCloseButton=i.searchFormWrapper.querySelector("#aipkit_close_search_qdrant_panel_btn"),i.searchResultsArea=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_results_area"),i.searchStatusDiv=i.searchFormWrapper.querySelector("#aipkit_search_qdrant_collection_form_status")),i.createFormWrapperGlobal=document.getElementById("aipkit_vs_global_new_store_inline_form_qdrant"),i.createFormWrapperGlobal&&(i.newCollectionNameInputGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_vs_global_new_store_name_qdrant"),i.newCollectionVectorSizeInputGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_vs_global_new_store_dimension_qdrant"),i.createCollectionSubmitButtonGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_vs_global_create_store_btn_qdrant"),i.createCollectionCloseButtonGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_vs_global_cancel_create_store_btn_qdrant"),i.createCollectionStatusDivGlobal=i.createFormWrapperGlobal.querySelector("#aipkit_create_qdrant_collection_status_global")),typeof window.aipkit_showQdrantSection=="function"?window.aipkit_showQdrantSection("placeholder"):console.error("Qdrant Init: showQdrantSection function not found.");let n="data-qdrant-ui-listener-attached";a.getAttribute(n)||(a.addEventListener("click",function(t){let o=t.target.closest("button");if(!o)return;let s=t.target.closest(".aipkit-reindex-vector-log-btn");if(o.id==="aipkit_search_qdrant_collection_btn"&&i.searchSubmitButton&&typeof window.aipkit_searchQdrantCollection=="function")window.aipkit_searchQdrantCollection();else if(o.id==="aipkit_close_search_qdrant_panel_btn"&&i.searchCloseButton){let r=i.searchCollectionIdInput?.value;r&&i.syncedCollections?.find(c=>c.name===r)&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"?window.aipkit_fetchAndShowQdrantCollectionDetails(r):typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")}else o.classList.contains("aipkit-delete-vector-log-btn")?typeof window.aipkit_handleDeleteVectorLogEntryClick=="function"&&window.aipkit_handleDeleteVectorLogEntryClick(t):s&&typeof window.aipkit_handleReindexVectorLogEntryClick=="function"&&window.aipkit_handleReindexVectorLogEntryClick(t)}),a.setAttribute(n,"true"));let e=document.getElementById("aipkit_vs_global_add_qdrant_collection_btn");e&&!e.dataset.listenerAttached&&(e.addEventListener("click",()=>{typeof window.aipkit_showCreateQdrantCollectionFormGlobal=="function"&&window.aipkit_showCreateQdrantCollectionFormGlobal()}),e.dataset.listenerAttached="true"),i.createCollectionSubmitButtonGlobal&&!i.createCollectionSubmitButtonGlobal.dataset.listenerAttached&&(i.createCollectionSubmitButtonGlobal.addEventListener("click",()=>{typeof window.aipkit_handleCreateQdrantCollection=="function"&&window.aipkit_handleCreateQdrantCollection(!0)}),i.createCollectionSubmitButtonGlobal.dataset.listenerAttached="true"),i.createCollectionCloseButtonGlobal&&!i.createCollectionCloseButtonGlobal.dataset.listenerAttached&&(i.createCollectionCloseButtonGlobal.addEventListener("click",()=>{typeof window.aipkit_hideCreateQdrantCollectionFormGlobal=="function"&&window.aipkit_hideCreateQdrantCollectionFormGlobal()}),i.createCollectionCloseButtonGlobal.dataset.listenerAttached="true")}window.aipkit_initQdrantVectorStoreUI=d})();(function(){"use strict";let d="aipkit_last_openai_vs_id",a="aipkit_last_pinecone_index_id",i="aipkit_last_qdrant_collection_id";function n(e){let t=e.target.value,o=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai",s=document.getElementById("aipkit_vs_global_provider_status");s&&!s.querySelector(".aipkit_text-danger")&&(typeof window.aipkit_showOpenAIVectorStatus=="function"?window.aipkit_showOpenAIVectorStatus("","info","aipkit_vs_global_provider_status"):s&&(s.textContent=""));let r={openai:document.getElementById("aipkit_vs_global_new_store_inline_form_openai"),pinecone:document.getElementById("aipkit_vs_global_new_store_inline_form_pinecone"),qdrant:document.getElementById("aipkit_vs_global_new_store_inline_form_qdrant")},c={openai:document.getElementById("aipkit_vs_global_add_openai_store_btn"),pinecone:document.getElementById("aipkit_vs_global_add_pinecone_index_btn"),qdrant:document.getElementById("aipkit_vs_global_add_qdrant_collection_btn")};for(let _ in r)r[_]&&(r[_].style.display="none"),c[_]&&(c[_].style.display=_===o?"inline-flex":"none");let l=`_create_new_${o}_`;if(t===l&&(c[o]&&(c[o].style.display="none"),r[o])){r[o].style.display="block";let _=r[o].querySelector('input[type="text"]');_&&(_.value="",_.focus())}if(o==="openai")if(t&&t!=="_create_new_openai_"?localStorage.setItem(d,t):t!=="_create_new_openai_"&&localStorage.removeItem(d),t&&t!=="_create_new_openai_"&&typeof window.aipkit_showStoreFilesPanel=="function"){let _=window.aipkit_openai_fetched_stores_data?window.aipkit_openai_fetched_stores_data[t]:null,f=_?.name||t;window.aipkit_showStoreFilesPanel(t,f,_)}else t!=="_create_new_openai_"&&typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_openai_vs_refs?.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(window.aipkit_openai_vs_refs.rightColumnPlaceholder.id);else if(o==="pinecone")if(t&&t!=="_create_new_pinecone_"?localStorage.setItem(a,t):t!=="_create_new_pinecone_"&&localStorage.removeItem(a),t&&t!=="_create_new_pinecone_"&&typeof window.aipkit_showPineconeIndexDetails=="function"){let _=window.aipkit_pinecone_vs_refs?.syncedIndexes?.find(f=>f.name===t);window.aipkit_showPineconeIndexDetails(t,_)}else t!=="_create_new_pinecone_"&&typeof window.aipkit_ui_showSection=="function"&&window.aipkit_pinecone_vs_refs?.rightColumnPlaceholder&&window.aipkit_ui_showSection("placeholder",["placeholder","manageIndexPanel","searchFormWrapper","createFormWrapperGlobal"],window.aipkit_pinecone_vs_refs);else o==="qdrant"?(t&&t!=="_create_new_qdrant_"?localStorage.setItem(i,t):t!=="_create_new_qdrant_"&&localStorage.removeItem(i),t&&t!=="_create_new_qdrant_"&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"?window.aipkit_fetchAndShowQdrantCollectionDetails(t):t!=="_create_new_qdrant_"&&typeof window.aipkit_showQdrantSection=="function"&&window.aipkit_showQdrantSection("placeholder")):typeof window.aipkit_showRightColumnSection=="function"&&window.aipkit_openai_vs_refs?.rightColumnPlaceholder&&window.aipkit_showRightColumnSection(window.aipkit_openai_vs_refs.rightColumnPlaceholder.id);let p=document.getElementById("aipkit_vs_global_data_source");if(p&&p.value==="wordpress_content"&&t&&!t.startsWith("_create_new_")&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&typeof window.aipkit_getWPCurrentPageForTraining=="function"){let _=window.aipkit_getWPCurrentPageForTraining();window.aipkit_fetchWordPressContentForTraining(_)}}window.aipkit_handleGlobalTargetSelectChange=n})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_vs_global_target_select");a?typeof window.aipkit_handleGlobalTargetSelectChange=="function"?a.addEventListener("change",window.aipkit_handleGlobalTargetSelectChange):console.error("AIPKit Global Target Handler Init: aipkit_handleGlobalTargetSelectChange function not found."):console.warn("AIPKit Global Target Handler Init: Global target select element (#aipkit_vs_global_target_select) not found.")}window.aipkit_initGlobalTargetHandler=d})();(function(){"use strict";function d(a){let i=a.target.value;if(typeof window.aipkit_ui_showSection!="function"){console.error("AIPKit Handle Source Change: aipkit_ui_showSection utility function not found.");return}let n=["aipkit_vs_global_text_entry","aipkit_vs_global_file_upload","aipkit_vs_global_wp_content_selector"],e="";i==="text_entry"?e="aipkit_vs_global_text_entry":i==="file_upload"?e="aipkit_vs_global_file_upload":i==="wordpress_content"&&(e="aipkit_vs_global_wp_content_selector"),window.aipkit_ui_showSection(e,n,"block");let t=document.getElementById("aipkit_vs_global_submit_upload_limits_info"),o=document.getElementById("aipkit_vs_wp_content_messages_area"),s=document.getElementById("aipkit_vs_global_file_upload_actual_input_wrapper"),r=document.getElementById("aipkit_vs_global_file_upload_pro_notice"),c=document.getElementById("aipkit_vs_global_submit_data_btn");if(i==="file_upload")if(window.aipkit_dashboard?.isProPlan===!0||window.aipkit_dashboard?.isProPlan==="1"||window.aipkit_dashboard?.isProPlan===1)s&&(s.style.display="block"),r&&(r.style.display="none"),typeof window.aipkit_displayUploadLimits=="function"&&window.aipkit_displayUploadLimits("aipkit_vs_global_submit_upload_limits_info","aipkit_vs_global_provider_status"),c&&(c.disabled=!1);else{if(s&&(s.style.display="none"),r){let p=window.aipkit_dashboard?.upgradeUrl||"#";r.innerHTML=`File Upload is a Pro feature. <a href="${p}" target="_blank">Upgrade to Pro</a> to enable.`,r.style.display="block"}t&&(t.style.display="none"),c&&(c.disabled=!0)}else t&&(t.style.display="none"),c&&(c.disabled=!1),s&&(s.style.display="block"),r&&(r.style.display="none");if(i==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"){let l=document.getElementById("aipkit_vs_global_wp_content_selector");l&&l.style.display==="block"&&window.aipkit_fetchWordPressContentForTraining(1)}else if(i!=="wordpress_content"){let l=document.getElementById("aipkit_vs_wp_content_list_area"),p=document.getElementById("aipkit_vs_wp_content_pagination"),_=window.aipkit_dashboard?.text||{},f=window.aipkit_escapeHtml||function(u){return u};l&&(l.innerHTML=`<p class="aipkit_text-center aipkit_text-secondary">${f(_.selectWPCriteria||'Select criteria and click "Load Content".')}</p>`),p&&(p.innerHTML=""),o&&(o.innerHTML="")}}window.aipkit_handleGlobalDataSourceChange=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_vs_global_data_source");a?typeof window.aipkit_handleGlobalDataSourceChange=="function"?(window.aipkit_handleGlobalDataSourceChange({target:a}),a.addEventListener("change",window.aipkit_handleGlobalDataSourceChange)):console.error("AIPKit Global Data Source Init: aipkit_handleGlobalDataSourceChange function not found."):console.warn("AIPKit Global Data Source Init: Global data source select element (#aipkit_vs_global_data_source) not found.")}window.aipkit_initGlobalDataSourceSwitcher=d})();(function(){"use strict";let d="aipkit_last_embedding_model",a=window.aipkit_escapeHtml||function(n){return n};function i(){let n=document.getElementById("aipkit_vs_global_embedding_model_select");if(!n)return;let e=n.value;n.innerHTML=`<option value="">${a("-- Select Embedding Model --")}</option>`;let t=window.aipkit_openai_vs_config||{},o=[{providerKey:"openai",label:"OpenAI",models:t.openaiEmbeddingModels||[]},{providerKey:"google",label:"Google",models:t.googleEmbeddingModels||[]}],s=0;o.forEach(l=>{if(l.models&&Array.isArray(l.models)&&l.models.length>0){s+=l.models.length;let p=document.createElement("optgroup");p.label=l.label,l.models.forEach(_=>{if(_&&_.id){let f=new Option(a(_.name||_.id),_.id);f.dataset.provider=l.providerKey,p.appendChild(f)}}),n.appendChild(p)}});let r=null,c=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai";if(c==="pinecone"||c==="qdrant"){let l=localStorage.getItem(d);l&&n.querySelector(`option[value="${CSS.escape(l)}"]`)&&(r=l)}if(!r&&e&&n.querySelector(`option[value="${CSS.escape(e)}"]`)&&(r=e),r)n.value=r;else if(n.options.length>1&&n.options[0].value==="")n.selectedIndex=0;else if(n.options.length>0){let l=n.querySelector("optgroup");if(l){let p=l.querySelector("option");p&&p.value&&(n.value=p.value)}else n.options.length>0&&n.options[0].value&&(n.selectedIndex=0)}n.disabled=!(s>0),s===0&&n.appendChild(new Option(a("(No embedding models found - Sync in AI Settings)"),""))}window.aipkit_populateGlobalEmbeddingModelSelect=i})();(function(){"use strict";let d="aipkit_last_embedding_model";function a(){let i=document.getElementById("aipkit_vs_global_embedding_model_select");i?typeof window.aipkit_populateGlobalEmbeddingModelSelect=="function"?(window.aipkit_populateGlobalEmbeddingModelSelect(),i.addEventListener("change",n=>{let e=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():null;(e==="pinecone"||e==="qdrant")&&localStorage.setItem(d,n.target.value)})):console.error("AIPKit Global Embedding Config Init: aipkit_populateGlobalEmbeddingModelSelect function not found."):console.warn("AIPKit Global Embedding Config Init: Embedding model select element (#aipkit_vs_global_embedding_model_select) not found.")}window.aipkit_initGlobalEmbeddingConfig=a})();(function(){"use strict";let d=1;function a(n){d=parseInt(n,10)||1}function i(){return d}window.aipkit_setWPCurrentPageForTraining=a,window.aipkit_getWPCurrentPageForTraining=i})();(function(){"use strict";function d(a,i){let n=document.getElementById("aipkit_vs_wp_content_list_area"),e=document.getElementById("aipkit_vs_wp_content_pagination"),t=window.aipkit_escapeHtml||function(r){return r};if(!n||!e){console.error("Render WP List: Missing list or pagination area elements.");return}if(typeof window.aipkit_fetchWordPressContentForTraining!="function"&&console.error("Render WP List: aipkit_fetchWordPressContentForTraining function not found for pagination."),!a||a.length===0){n.innerHTML=`<p class="aipkit_text-center aipkit_text-secondary">${window.aipkit_dashboard?.text?.noWPCPostsFound||"No posts found matching your criteria."}</p>`,e.innerHTML="";return}let o=`<div class="aipkit_wp_content_select_all_wrapper">
                            <label class="aipkit_checkbox-label">
                                <input type="checkbox" id="aipkit_vs_wp_content_select_all">
                                ${t("Select All on Page")}
                            </label>
                        </div><ul>`;if(a.forEach(r=>{let c=r.is_already_indexed?"aipkit_wp_content_indexed_status":"",l=r.is_already_indexed?"\u2713 Indexed":"",p="",_=r.edit_link?`<a href="${t(r.edit_link)}" target="_blank" class="aipkit_wp_content_title">${t(r.title)}</a>`:`<span class="aipkit_wp_content_title">${t(r.title)}</span>`;o+=`<li class="aipkit_wp_content_list_item">
                            <input type="checkbox" name="wp_content_to_index[]" value="${t(r.id)}" ${p}>
                            ${_}
                            <span class="aipkit_wp_content_type">${t(r.type_label)}</span>
                            ${l?`<span class="${c}">${t(l)}</span>`:""}
                         </li>`}),o+="</ul>",n.innerHTML=o,e.innerHTML="",i&&i.total_pages>1){let r=i.total_posts||0,c=parseInt(i.current_page,10),l=parseInt(i.total_pages,10),p=wp.i18n?.__||(w=>w),_=wp.i18n?._n||((w,h,b)=>b>1?h:w),f=document.createElement("span");f.className="aipkit_pagination-count",f.textContent=`${r.toLocaleString()} ${_("item","items",r)}`,e.appendChild(f);let u=document.createElement("span");u.className="aipkit_pagination-links";let m=document.createElement("button");m.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",m.innerHTML="\xAB "+p("Previous","gpt3-ai-content-generator"),m.disabled=c<=1,m.disabled||m.addEventListener("click",w=>{w.preventDefault(),window.aipkit_fetchWordPressContentForTraining(c-1)}),u.appendChild(m);let g=document.createElement("span");g.className="aipkit_pagination-current",g.textContent=`${p("Page","gpt3-ai-content-generator")} ${c} ${p("of","gpt3-ai-content-generator")} ${l}`,u.appendChild(g);let k=document.createElement("button");k.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",k.innerHTML=p("Next","gpt3-ai-content-generator")+" \xBB",k.disabled=c>=l,k.disabled||k.addEventListener("click",w=>{w.preventDefault(),window.aipkit_fetchWordPressContentForTraining(c+1)}),u.appendChild(k),e.appendChild(u)}let s=document.getElementById("aipkit_vs_wp_content_select_all");s&&s.addEventListener("change",function(){n.querySelectorAll('input[name="wp_content_to_index[]"]:not(:disabled)').forEach(r=>{r.checked=this.checked})})}window.aipkit_renderWordPressContentListForTraining=d})();(function(){"use strict";async function d(a=1){let i=document.getElementById("aipkit_vs_wp_content_list_area"),n=document.getElementById("aipkit_vs_wp_content_pagination"),e=document.getElementById("aipkit_vs_wp_content_messages_area"),t=document.getElementById("aipkit_vs_load_wp_content_btn"),o=document.getElementById("aipkit_vs_global_target_select"),s=o?o.value:"";if(typeof window.aipkit_setWPCurrentPageForTraining=="function"?window.aipkit_setWPCurrentPageForTraining(a):console.warn("aipkit_setWPCurrentPageForTraining not defined in wp-content-state.js"),!i||!n||!e||!t){console.error("Fetch WP Content: Missing required UI elements (list, pagination, status, or loadButton).");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderWordPressContentListForTraining!="function"){console.error("Fetch WP Content: Missing UI/API helper or render functions."),e&&(e.innerHTML='<p class="aipkit_text-danger">Error: Core UI functions missing.</p>');return}let r=document.getElementById("aipkit_vs_wp_content_post_types"),c=document.getElementById("aipkit_vs_wp_content_status"),l=r?Array.from(r.selectedOptions).map(u=>u.value):[],p=c?c.value:"publish";if(l.length===0){e&&(e.innerHTML='<p class="aipkit_text-danger">Please select at least one post type.</p>');return}window.aipkit_setLoadingStateOpenAI(t,!0,"Load Content","Loading..."),i.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading content...</p>',n.innerHTML="",e&&(e.innerHTML="");let _=document.getElementById("aipkit_wp_content_fetch_nonce");if(!_||!_.value){e&&(e.innerHTML='<p class="aipkit_text-danger">Error: Security token missing.</p>'),window.aipkit_setLoadingStateOpenAI(t,!1,"Load Content");return}let f={_ajax_nonce:_.value,post_types:l,post_status:p,target_store_id:s,paged:a};try{let u=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",f);window.aipkit_renderWordPressContentListForTraining(u.posts,u.pagination)}catch(u){console.error("Fetch WP Content Error:",u),e&&(e.innerHTML=`<p class="aipkit_text-danger">Error loading content: ${u.message||"Unknown error"}</p>`),i&&(i.innerHTML='<p class="aipkit_text-center aipkit_text-danger">Failed to load content.</p>')}finally{window.aipkit_setLoadingStateOpenAI(t,!1,"Load Content")}}window.aipkit_fetchWordPressContentForTraining=d})();(function(){"use strict";function d(a,i,n){return a==="text_entry"?{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:i,vector_id:n}:a==="wp_post"?{source:"wordpress_post",post_id:String(i),vector_id:n}:{}}window.aipkit_utils_extractEmbeddingMeta=d})();(function(){"use strict";function d(){let a=document.querySelectorAll('#aipkit_vs_wp_content_list_area input[name="wp_content_to_index[]"]:checked');return Array.from(a).map(i=>i.value)}window.aipkit_utils_getSelectedPostIds=d})();(function(){"use strict";function d(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,a=>(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16))}window.aipkit_generateUUIDv4=d})();(function(){"use strict";function d(){let a=window.aipkit_dashboard?.text||{},i=document.getElementById("aipkit_vs_global_data_source")?.value,n=document.getElementById("aipkit_vs_global_provider_select")?.value,e=document.getElementById("aipkit_vs_global_target_select"),t=e?e.value:"",o=document.getElementById("aipkit_vs_global_new_store_name_openai"),s=o?o.value.trim():"",r=null,c=null,l=[],p="",_=null;if(!n)return{isValid:!1,message:"Please select a Vector Provider.",values:null};if(!t)return{isValid:!1,message:"Please select a target Store/Index/Collection.",values:null};if(n==="openai"&&t.startsWith("_create_new_")&&!s)return{isValid:!1,message:"Please provide a name for the new OpenAI store.",values:null};if((n==="pinecone"||n==="qdrant")&&t.startsWith("_create_new_"))return{isValid:!1,message:"Please create the Pinecone Index or Qdrant Collection in its management panel first.",values:null};if(n==="pinecone"||n==="qdrant"){let f=document.getElementById("aipkit_vs_global_embedding_model_select");if(f&&f.value){let u=f.options[f.selectedIndex];c=u.value,r=u.dataset.provider||null}if(!r||!c)return{isValid:!1,message:"Please select an Embedding Model for this provider.",values:null}}if(i==="text_entry"){if(p=document.getElementById("aipkit_vs_global_text_content")?.value.trim()||"",!p)return{isValid:!1,message:"Text content cannot be empty.",values:null}}else if(i==="file_upload"){if(_=document.getElementById("aipkit_vs_global_file_to_submit"),!_?.files||_.files.length===0)return{isValid:!1,message:"Please select a file to upload.",values:null}}else if(i==="wordpress_content"){let f=document.querySelectorAll('#aipkit_vs_wp_content_list_area input[name="wp_content_to_index[]"]:checked');if(l=Array.from(f).map(u=>u.value),l.length===0)return{isValid:!1,message:"Please select WordPress content to index.",values:null}}else return{isValid:!1,message:"Invalid data source selected.",values:null};return{isValid:!0,message:null,values:{dataSource:i,vectorStoreProvider:n,targetStoreId:t,newStoreNameOpenAI:s,embeddingProvider:r,embeddingModel:c,textContent:p,fileInput:_,postIds:l}}}window.aipkit_validateGlobalFormState=d})();(function(){"use strict";function d(a,i){return(i==="pinecone"||i==="qdrant")&&(a==="text_entry"||a==="wordpress_content")?{isIterative:!0,type:i}:i==="openai"&&a==="wordpress_content"?{isIterative:!0,type:"openai"}:{isIterative:!1,type:null}}window.aipkit_determineIterationMode=d})();(function(){"use strict";function d(a,i){let n="";return a==="text_entry"?i==="openai"?n="aipkit_add_text_to_vector_store_openai":i==="pinecone"?n="aipkit_upsert_to_pinecone_index":i==="qdrant"&&(n="aipkit_upsert_to_qdrant_collection"):a==="file_upload"&&(i==="openai"?n="aipkit_upload_and_add_file_to_store_direct_openai":i==="pinecone"?n="aipkit_upload_file_and_upsert_to_pinecone":i==="qdrant"&&(n="aipkit_upload_file_and_upsert_to_qdrant")),n}window.aipkit_determineAjaxAction=d})();(function(){"use strict";function d(a){let{dataSource:i,vectorStoreProvider:n,targetStoreId:e,newStoreNameOpenAI:t,embeddingProvider:o,embeddingModel:s,textContent:r,fileInput:c,postIds:l}=a,p=new FormData,_={provider:n,source_type:i,...o&&{embedding_provider:o},...s&&{embedding_model:s}};n==="openai"?(_.target_store_id=e.startsWith("_create_new_")?"":e,_.new_store_name_openai=t):n==="pinecone"?_.index_name=e.startsWith("_create_new_")?"":e:n==="qdrant"&&(_.collection_name=e.startsWith("_create_new_")?"":e);for(let g in _)p.append(g,_[g]);if(i==="text_entry")_.text_content=r,_.original_text_content=r,p.append("text_content",r);else if(i==="file_upload"){if(c&&c.files[0]){let g=n==="openai"?"aipkit_vs_global_file_to_submit":"file_to_upload";p.append(g,c.files[0])}(n==="pinecone"||n==="qdrant")&&e&&p.append("target_store_id",e)}else i==="wordpress_content"&&(_.post_ids=l,p.delete("post_ids"),l.forEach(g=>p.append("post_ids[]",g)));let f="",u="";n==="openai"?u="aipkit_vector_store_nonce_openai":n==="pinecone"?u="aipkit_vector_store_pinecone_nonce_management":n==="qdrant"&&(u="aipkit_vector_store_qdrant_nonce_management"),i==="wordpress_content"&&n==="openai"&&(u="aipkit_wp_content_index_nonce");let m=document.getElementById(u);return m?.value?(f=m.value,p.append("_ajax_nonce",f),_._ajax_nonce=f):console.error(`BuildSubmissionData: Nonce field #${u} not found.`),{formDataForFetch:p,requestDataForAJAX:_}}window.aipkit_buildSubmissionData=d})();(function(){"use strict";function d(a,i,n="Submit",e="Processing..."){if(!a)return;let t=a.querySelector(".aipkit_btn-text"),o=a.querySelector(".aipkit_spinner"),s=a.querySelector(".dashicons");if(i){if(a.disabled=!0,!a.dataset.originalText)if(t)a.dataset.originalText=t.textContent;else{let c="";a.childNodes.forEach(l=>{l.nodeType===Node.TEXT_NODE&&(c+=l.textContent.trim())}),a.dataset.originalText=c.trim()||n}s&&(s.dataset.originalDisplay||(s.dataset.originalDisplay=s.style.display||"inline-block"),s.style.display="none");let r=a.dataset.loadingText||e;t?t.textContent=r:(!s||s.style.display==="none")&&(Array.from(a.childNodes).forEach(c=>{c.nodeType===Node.TEXT_NODE&&c.remove()}),r&&a.insertBefore(document.createTextNode(r),a.firstChild)),o&&(o.style.display="inline-block")}else{a.disabled=!1;let r=a.dataset.originalText||n;s&&s.dataset.originalDisplay&&(s.style.display=s.dataset.originalDisplay,delete s.dataset.originalDisplay),t?t.textContent=r:(!s||s.style.display!=="none")&&(Array.from(a.childNodes).forEach(c=>{c.nodeType===Node.TEXT_NODE&&c.remove()}),r&&(!s||s.style.display==="none")&&a.insertBefore(document.createTextNode(r),a.firstChild)),o&&(o.style.display="none"),delete a.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=d})();(function(){"use strict";function d(a,i="info",n="aipkit_knowledge_base_global_status"){let e=document.getElementById(n);if(!e){console.warn(`showOpenAIVectorStatus: Status container #${n} not found.`);return}e.messageTimeoutId&&clearTimeout(e.messageTimeoutId),e.messageTimeoutId=null;let t=a?a.trim():"";t!==""?(e.className="aipkit_form-help",i==="success"?e.classList.add("aipkit_settings_message-success"):i==="error"?e.classList.add("aipkit_settings_message-error"):e.classList.add("aipkit_settings_message-info"),e.textContent=t,e.style.display="block",e.style.opacity="1",e.classList.add("aipkit-active"),e.messageTimeoutId=setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.textContent===t&&(e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.classList.remove("aipkit-active"))},300)},5e3)):(e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.style.opacity="0",e.classList.remove("aipkit-active"))}window.aipkit_showOpenAIVectorStatus=d})();(function(){"use strict";function d(a){if(a==="text_entry"){let i=document.getElementById("aipkit_vs_global_text_content");i&&(i.value="")}else if(a==="file_upload"){let i=document.getElementById("aipkit_vs_global_file_to_submit");i&&(i.value="")}}window.aipkit_clearSubmissionFields=d})();(function(){"use strict";function d(a,i,n){let e=a?.message||"An unknown error occurred.";if(console.error(`AIPKit Submission Error (${i}):`,a),typeof window.aipkit_showOpenAIVectorStatus=="function")window.aipkit_showOpenAIVectorStatus(`Error: ${e}`,"error",n);else{let t=document.getElementById(n);t?(t.textContent=`Error: ${e}`,t.className="aipkit_form-help aipkit_settings_message-error"):alert(`Error: ${e}`)}}window.aipkit_reportSubmissionError=d})();(function(){"use strict";async function d(a,i,n,e){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let t={_ajax_nonce:e,content_to_embed:a,embedding_provider:i,embedding_model:n};return window.aipkit_apiRequest("aipkit_generate_embedding",t)}window.aipkit_api_generateEmbedding=d})();(function(){"use strict";async function d(a,i){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let n={_ajax_nonce:i,get_content_for_ids:a};return window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",n)}window.aipkit_api_fetchWpPostContent=d})();(function(){"use strict";async function d(i){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",i)}async function a(i,n){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));i.set("action",n);let e=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:i,credentials:"same-origin"}),t=await e.json();if(!e.ok||!t.success)throw new Error(t.data?.message||`HTTP error! status: ${e.status}`);return t.data}window.aipkit_api_upsertOpenAIText=d,window.aipkit_api_upsertFile=a})();(function(){"use strict";async function d(a,i){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let n={...a,_ajax_nonce:i};return window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",n)}window.aipkit_api_upsertToPinecone=d})();(function(){"use strict";async function d(a,i){if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Core API request function is missing."));let n={...a,_ajax_nonce:i};return window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",n)}window.aipkit_api_upsertToQdrant=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};async function a(i,n,e){let t=0,o=0,s="aipkit_index_selected_wp_content";try{for(let[c,l]of i.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",e);break}let p=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${l}"]`),_=p?p.closest("li").querySelector(".aipkit_wp_content_title"):null,f=_?_.textContent.trim():`Post #${l}`;window.aipkit_showOpenAIVectorStatus(`Processing ${c+1}/${i.length}: "${d(f)}"`,"info",e);let u={...n,post_ids:[l]};try{await window.aipkit_apiRequest(s,u),t++}catch(m){o++,console.error(`AI Training Indexing Error (Post ID ${l}):`,m)}}let r=`Indexing complete. ${t} successful, ${o} failed.`;window.aipkit_isIndexingStopped&&t+o<i.length?r=`Indexing stopped. ${t} successful, ${o} failed.`:o>0&&(r+=" See browser console for details on failed posts."),window.aipkit_showOpenAIVectorStatus(r,o>0||window.aipkit_isIndexingStopped?"warning":"success",e),typeof window.aipkit_fetchWordPressContentForTraining=="function"&&typeof window.aipkit_getWPCurrentPageForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_populateGlobalOpenAITargetSelect=="function"&&window.aipkit_populateGlobalOpenAITargetSelect(!0)}catch(r){console.error("AIPKit OpenAI Indexer: Loop-level error:",r),window.aipkit_showOpenAIVectorStatus(`Error during batch processing: ${r.message}`,"error",e)}finally{setTimeout(()=>{typeof window.aipkit_toggleAddContentForm=="function"&&window.aipkit_toggleAddContentForm(!1)},2e3)}}window.aipkit_indexOpenAIBatch=a})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};async function a(i,n,e){let t=0,o=0,{embedding_provider:s,embedding_model:r,index_name:c,_ajax_nonce:l}=n;window.aipkit_showOpenAIVectorStatus(`Preparing to index ${i.length} item(s) for Pinecone...`,"info",e);try{for(let[_,f]of i.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",e);break}try{let u=f.content,m={...f.metadata},g=f.metadata.title||`Item ${_+1}`;if(f.type==="wp_post"){let b=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${f.postId}"]`),y=b?b.closest("li").querySelector(".aipkit_wp_content_title"):null;g=y?y.textContent.trim():`Post #${f.postId}`}if(window.aipkit_showOpenAIVectorStatus(`Processing ${_+1}/${i.length}: "${d(g)}"`,"info",e),f.type==="wp_post"){let b=document.getElementById("aipkit_wp_content_fetch_nonce");if(!b?.value)throw new Error("WP Content fetch nonce missing.");let y=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:b.value,get_content_for_ids:[f.postId]});if(!y.posts_content||!y.posts_content[f.postId])throw new Error(`Could not fetch content for Post ID ${f.postId}.`);let S=y.posts_content[f.postId];u=S.content,m.title=S.title||"N/A",m.type=S.type_label||"N/A",m.url=S.edit_link||"#"}if(!u)throw new Error(`Content to embed is empty for item ${f.id}`);let k=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:u,embedding_provider:s,embedding_model:r,_ajax_nonce:window.aipkit_dashboard.nonce});if(!k.embeddings||k.embeddings.length===0)throw new Error(`Embedding failed: ${k.message||"No vector returned"}`);let w=k.embeddings[0],h={_ajax_nonce:l,vectors:JSON.stringify([{id:f.id,values:w,metadata:m}]),embedding_provider:s,embedding_model:r,original_text_content:u,index_name:c};await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",h),t++}catch(u){o++,console.error(`Error processing Pinecone item ${d(f.id)}:`,u)}}let p=`Indexing complete. ${t} successful, ${o} failed.`;o>0&&(p+=" See console for details."),window.aipkit_showOpenAIVectorStatus(p,t>0&&o===0?"success":"warning",e),n.source_type==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_listPineconeIndexes=="function"&&window.aipkit_listPineconeIndexes(null,!1).then(()=>{if(c){let _=document.getElementById("aipkit_vs_global_target_select");_&&(_.value=c,_.dispatchEvent(new Event("change")))}})}catch(p){console.error("AIPKit Pinecone Indexer: Loop-level error:",p),window.aipkit_showOpenAIVectorStatus(`Error during batch processing: ${p.message}`,"error",e)}finally{setTimeout(()=>{typeof window.aipkit_toggleAddContentForm=="function"&&window.aipkit_toggleAddContentForm(!1)},2e3)}}window.aipkit_indexPineconeBatch=a})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};async function a(i,n,e){let t=0,o=0,{embedding_provider:s,embedding_model:r,collection_name:c,_ajax_nonce:l}=n;window.aipkit_showOpenAIVectorStatus(`Preparing to index ${i.length} item(s) for Qdrant...`,"info",e);try{for(let[_,f]of i.entries()){if(window.aipkit_isIndexingStopped){window.aipkit_showOpenAIVectorStatus("Indexing stopped by user.","warning",e);break}try{let u=f.content,m={...f.metadata},g=f.metadata.title||`Item ${_+1}`;if(f.type==="wp_post"){let b=document.querySelector(`#aipkit_vs_wp_content_list_area input[value="${f.postId}"]`),y=b?b.closest("li").querySelector(".aipkit_wp_content_title"):null;g=y?y.textContent.trim():`Post #${f.postId}`}if(window.aipkit_showOpenAIVectorStatus(`Processing ${_+1}/${i.length}: "${d(g)}"`,"info",e),f.type==="wp_post"){let b=document.getElementById("aipkit_wp_content_fetch_nonce");if(!b?.value)throw new Error("WP Content fetch nonce missing.");let y=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:b.value,get_content_for_ids:[f.postId]});if(!y.posts_content||!y.posts_content[f.postId])throw new Error(`Could not fetch content for Post ID ${f.postId}.`);let S=y.posts_content[f.postId];u=S.content,m.title=S.title||"N/A",m.type=S.type_label||"N/A",m.url=S.edit_link||"#"}if(!u)throw new Error(`Content to embed is empty for item ${f.id}`);let k=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:u,embedding_provider:s,embedding_model:r,_ajax_nonce:window.aipkit_dashboard.nonce});if(!k.embeddings||k.embeddings.length===0)throw new Error(`Embedding failed: ${k.message||"No vector returned"}`);let w=k.embeddings[0],h={_ajax_nonce:l,vectors:JSON.stringify([{id:f.id,vector:w,payload:m}]),embedding_provider:s,embedding_model:r,original_text_content:u,collection_name:c};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",h),t++}catch(u){o++,console.error(`Error processing Qdrant item ${d(f.id)}:`,u)}}let p=`Indexing complete. ${t} successful, ${o} failed.`;o>0&&(p+=" See console for details."),window.aipkit_showOpenAIVectorStatus(p,t>0&&o===0?"success":"warning",e),n.source_type==="wordpress_content"&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&window.aipkit_fetchWordPressContentForTraining(window.aipkit_getWPCurrentPageForTraining()),typeof window.aipkit_listQdrantCollections=="function"&&window.aipkit_listQdrantCollections(null,!1).then(()=>{if(c){let _=document.getElementById("aipkit_vs_global_target_select");_&&(_.value=c,_.dispatchEvent(new Event("change")))}})}catch(p){console.error("AIPKit Qdrant Indexer: Loop-level error:",p),window.aipkit_showOpenAIVectorStatus(`Error during batch processing: ${p.message}`,"error",e)}finally{setTimeout(()=>{typeof window.aipkit_toggleAddContentForm=="function"&&window.aipkit_toggleAddContentForm(!1)},2e3)}}window.aipkit_indexQdrantBatch=a})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{};async function a(i){i.preventDefault();let n=document.getElementById("aipkit_vs_global_submit_data_btn"),e=document.getElementById("aipkit_vs_global_stop_indexing_btn"),t=document.getElementById("aipkit_vs_global_cancel_add_content_btn"),o,s=window.aipkit_validateGlobalFormState(),r="aipkit_knowledge_base_global_status";if(!s.isValid){window.aipkit_showOpenAIVectorStatus(s.message,"error",r);return}let{dataSource:c,vectorStoreProvider:l,...p}=s.values;window.aipkit_isIndexingStopped=!1,window.aipkit_setLoadingStateOpenAI(n,!0,d.addContentButton||"Add Content",d.processingButton||"Processing..."),window.aipkit_showOpenAIVectorStatus(d.processingRequest||"Processing request...","info",r),n.style.display="none",t&&(t.style.display="none");try{let _=window.aipkit_determineIterationMode(c,l),{requestDataForAJAX:f,formDataForFetch:u}=window.aipkit_buildSubmissionData(s.values);if(_.isIterative&&(e&&(e.style.display="inline-flex",e.disabled=!1,e.textContent=d.stopButton||"Stop"),o=()=>{window.aipkit_isIndexingStopped=!0,e&&(e.disabled=!0,e.textContent=d.stoppingButton||"Stopping...")},e&&e.addEventListener("click",o,{once:!0})),_.isIterative){let m=[];if(c==="text_entry"){let g=l==="qdrant"?window.aipkit_generateUUIDv4():`text_${Date.now()}`;m.push({id:g,content:p.textContent,type:"text_entry",metadata:window.aipkit_utils_extractEmbeddingMeta("text_entry",p.textContent,g)})}else c==="wordpress_content"&&(m=p.postIds.map(g=>{let k=l==="qdrant"?window.aipkit_generateUUIDv4():`wp_post_${g}`;return{id:k,postId:g,type:"wp_post",metadata:window.aipkit_utils_extractEmbeddingMeta("wp_post",g,k)}}));_.type==="openai"?await window.aipkit_indexOpenAIBatch(p.postIds,f,r):_.type==="pinecone"?await window.aipkit_indexPineconeBatch(m,f,r):_.type==="qdrant"&&await window.aipkit_indexQdrantBatch(m,f,r)}else{let m=window.aipkit_determineAjaxAction(c,l);if(!m)throw new Error("No AJAX action defined for this submission type.");let w=await(c==="file_upload"?window.aipkit_api_upsertFile(u,m):window.aipkit_api_upsertOpenAIText(f));window.aipkit_showOpenAIVectorStatus(w.message||"Content added successfully!","success",r),window.aipkit_clearSubmissionFields(c);let h=w.new_store_id||w.store_id||p.targetStoreId;l==="openai"?window.aipkit_populateGlobalOpenAITargetSelect(!0).then(()=>{if(h){let b=document.getElementById("aipkit_vs_global_target_select");b&&(b.value=h,b.dispatchEvent(new Event("change")))}}):l==="pinecone"?window.aipkit_listPineconeIndexes(null,!1).then(()=>{if(h){let b=document.getElementById("aipkit_vs_global_target_select");b&&(b.value=h,b.dispatchEvent(new Event("change")))}}):l==="qdrant"&&window.aipkit_listQdrantCollections(null,!1).then(()=>{if(h){let b=document.getElementById("aipkit_vs_global_target_select");b&&(b.value=h,b.dispatchEvent(new Event("change")))}}),setTimeout(()=>{typeof window.aipkit_toggleAddContentForm=="function"&&window.aipkit_toggleAddContentForm(!1)},1500)}}catch(_){window.aipkit_reportSubmissionError(_,`${l} ${c} submission`,r)}finally{o?e&&e.removeEventListener("click",o):(window.aipkit_setLoadingStateOpenAI(n,!1,d.addContentButton||"Add Content"),n.style.display="inline-flex",e&&(e.style.display="none"),t&&(t.style.display="inline-flex"))}}window.aipkit_handleGlobalSubmitDataToStore=a})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_vs_global_submit_data_btn");a?typeof window.aipkit_handleGlobalSubmitDataToStore=="function"?a.addEventListener("click",window.aipkit_handleGlobalSubmitDataToStore):console.error("AIPKit Submit Init: aipkit_handleGlobalSubmitDataToStore function not found."):console.warn("AIPKit Submit Init: Global submit button (#aipkit_vs_global_submit_data_btn) not found.")}window.aipkit_initGlobalSubmitButton=d})();(function(){"use strict";let d=window.aipkit_dashboard?.text||{};function a(n){let e=n.currentTarget,t=typeof window.aipkit_getCurrentGlobalVectorProvider=="function"?window.aipkit_getCurrentGlobalVectorProvider():"openai",o="aipkit_knowledge_base_global_status";if(!t||!e){console.warn("Global Refresh Data: Missing provider slug or refresh button.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showOpenAIVectorStatus!="function"){console.error("Global Refresh Data: Missing required UI helper functions (setLoadingState or showStatus).");return}window.aipkit_setLoadingStateOpenAI(e,!0,"Sync","");let s=Promise.resolve();if(t==="openai"&&typeof window.aipkit_populateGlobalOpenAITargetSelect=="function")s=window.aipkit_populateGlobalOpenAITargetSelect(!0);else if(t==="pinecone"&&typeof window.aipkit_listPineconeIndexes=="function")s=window.aipkit_listPineconeIndexes(null,!1);else if(t==="qdrant"&&typeof window.aipkit_listQdrantCollections=="function")s=window.aipkit_listQdrantCollections(null,!1);else{console.warn(`Global Refresh Data: No specific refresh action defined for provider '${t}'.`),window.aipkit_setLoadingStateOpenAI(e,!1,"Sync");return}s.then(()=>{}).catch(r=>{console.error(`Global Refresh Data: Error refreshing data for ${t}:`,r),window.aipkit_showOpenAIVectorStatus(`Failed to sync ${t} data. ${r.message||""}`,"error",o)}).finally(()=>{window.aipkit_setLoadingStateOpenAI(e,!1,"Sync")})}function i(){let n=document.getElementById("aipkit_vs_global_refresh_data_btn");n&&(n.dataset.listenerAttached||(n.addEventListener("click",a),n.dataset.listenerAttached="true"))}window.aipkit_initGlobalRefreshButton=i})();(function(){"use strict";function d(){if(!document.getElementById("aipkit_vector_store_management_area")){console.warn("AIPKit Global Form UI Manager: Parent management area not found. Global Form UI not fully initialized.");return}typeof window.aipkit_initGlobalProviderSwitcher=="function"?window.aipkit_initGlobalProviderSwitcher():console.error("AIPKit Global Form UI Init: aipkit_initGlobalProviderSwitcher not found."),typeof window.aipkit_initGlobalTargetHandler=="function"?window.aipkit_initGlobalTargetHandler():console.error("AIPKit Global Form UI Init: aipkit_initGlobalTargetHandler not found."),typeof window.aipkit_initGlobalDataSourceSwitcher=="function"?window.aipkit_initGlobalDataSourceSwitcher():console.error("AIPKit Global Form UI Init: aipkit_initGlobalDataSourceSwitcher not found."),typeof window.aipkit_initGlobalEmbeddingConfig=="function"?window.aipkit_initGlobalEmbeddingConfig():console.error("AIPKit Global Form UI Init: aipkit_initGlobalEmbeddingConfig not found."),typeof window.aipkit_initOpenAIInlineStoreCreator=="function"?window.aipkit_initOpenAIInlineStoreCreator():console.error("AIPKit Global Form UI Init: aipkit_initOpenAIInlineStoreCreator not found.");let i=document.getElementById("aipkit_vs_load_wp_content_btn");i&&typeof window.aipkit_fetchWordPressContentForTraining=="function"?i.dataset.listenerAttached||(i.addEventListener("click",()=>window.aipkit_fetchWordPressContentForTraining(1)),i.dataset.listenerAttached="true"):i&&console.error("AIPKit Global Form UI Init: aipkit_fetchWordPressContentForTraining not found for WP Content button."),typeof window.aipkit_initGlobalSubmitButton=="function"?window.aipkit_initGlobalSubmitButton():console.error("AIPKit Global Form UI Init: aipkit_initGlobalSubmitButton function not found."),typeof window.aipkit_initGlobalRefreshButton=="function"?window.aipkit_initGlobalRefreshButton():console.error("AIPKit Global Form UI Init: aipkit_initGlobalRefreshButton function not found.")}window.aipkit_initGlobalFormUIManager=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||(c=>c||""),a={};async function i(){if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Indexing Settings: aipkit_apiRequest function not available!");return}if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl){console.error("AIPKit Indexing Settings: aipkit_dashboard object not available!");return}let c=document.getElementById("aipkit_indexing_settings_form_container");if(!c){console.error("AIPKit Indexing Settings: Container not found!");return}c.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading content types...</p>';let l=window.aipkit_ai_training_settings_config||{};if(!l.settings_nonce){console.error("AIPKit Indexing Settings: NONCE IS MISSING from config object."),c.innerHTML='<p class="aipkit_text-danger">Error: Security token is missing. Cannot load settings.</p>';return}try{let p=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:l.settings_nonce});if(!p){console.error("AIPKit Indexing Settings: No response received"),c.innerHTML='<p class="aipkit_text-danger">Error: No response received from server. Please try again.</p>';return}let _,f;if(p.success!==void 0){if(!p.success){console.error("AIPKit Indexing Settings: AJAX request failed:",p),c.innerHTML=`<p class="aipkit_text-danger">Error: ${d(p.data||"Failed to load content type settings. Please try again.")}</p>`;return}_=p.data?.cpt_data||{},f=p.data?.saved_settings||{}}else _=p.cpt_data||{},f=p.saved_settings||{};if(a=f,c.innerHTML="",Object.keys(_).length===0){c.innerHTML='<p class="aipkit_text-center">No content types found. Please ensure you have posts or pages in your WordPress site.</p>';return}let u=document.createElement("div");u.className="aipkit_accordion-group";let m=l.isPro===!0||l.isPro==="1";for(let k in _){let w=_[k],h=n(k,w.label,w,m);u.appendChild(h)}c.appendChild(u);let g=document.getElementById("aipkit_indexing_settings_form");g&&g.addEventListener("click",function(k){let w=k.target.closest(".aipkit_accordion-header");w&&(w.classList.toggle("aipkit_active"),w.nextElementSibling.classList.toggle("aipkit_active"))})}catch(p){console.error("AIPKit Indexing Settings: Error fetching CPT indexing options:",p),c.innerHTML=`<p class="aipkit_text-danger">Error: ${d(p.message||"Could not load content type settings.")}</p>`}}function n(c,l,p,_){let f=document.createElement("div");f.className="aipkit_accordion";let u=document.createElement("div");u.className="aipkit_accordion-header",u.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${d(l)}`;let m=document.createElement("div");return m.className="aipkit_accordion-content",m.appendChild(t(c,p.basic_labels,_)),m.appendChild(e("Custom Fields",c,"fields",p.fields,_)),m.appendChild(e("Taxonomies",c,"taxonomies",p.taxonomies,_)),c==="product"&&p.woo_attributes&&m.appendChild(e("Product Data",c,"woo_attributes",p.woo_attributes,_)),f.appendChild(u),f.appendChild(m),f}function e(c,l,p,_,f){let u=document.createElement("div");if(u.className="aipkit_indexing_settings_section",_&&Object.keys(_).length>0){let m=document.createElement("h5");m.textContent=c,u.appendChild(m);let g=document.createElement("table");g.className="wp-list-table widefat striped",g.innerHTML=`
        <thead>
            <tr>
                <th class="check-column"><input type="checkbox" class="aipkit-indexing-select-all" ${f?"":"disabled"}/></th>
                <th>Field / Taxonomy</th>
                <th>Label for AI Context</th>
            </tr>
        </thead>
        <tbody></tbody>`;let k=g.querySelector("tbody");for(let h in _){let b=_[h],y=a[l]?.[p]?.[h]||{},S=y.enabled!==void 0?y.enabled:!0,I=y.label||"",x=document.createElement("tr");x.innerHTML=`
            <th scope="row" class="check-column">
                <input type="checkbox" name="settings[${l}][${p}][${h}][enabled]" value="1" ${S?"checked":""} ${f?"":"disabled"}>
            </th>
            <td><code>${d(h)}</code></td>
            <td>
                <input type="text" class="regular-text" name="settings[${l}][${p}][${h}][label]" value="${d(I)}" placeholder="${d(b)}" ${f?"":"disabled"}>
            </td>
        `,k.appendChild(x)}u.appendChild(g),g.querySelector(".aipkit-indexing-select-all").addEventListener("change",h=>{k.querySelectorAll('input[type="checkbox"]').forEach(b=>{b.checked=h.target.checked})})}else u.innerHTML=`<p><em>No ${c.toLowerCase()} found for this content type.</em></p>`;return u}function t(c,l,p){let _=document.createElement("div");_.className="aipkit_indexing_settings_section";let f=document.createElement("h5");f.textContent="Basic Labels",_.appendChild(f);let u=document.createElement("table");u.className="wp-list-table widefat striped",u.innerHTML=`
      <thead>
          <tr>
              <th>Label Type</th>
              <th>Custom Label for AI Context</th>
          </tr>
      </thead>
      <tbody></tbody>`;let m=u.querySelector("tbody"),g=["source_url","title","excerpt","content"],k=["Source URL","Title","Excerpt","Content"];return g.forEach((w,h)=>{let b=l[w]||k[h],y=a[c]?.basic_labels?.[w]||b,S=document.createElement("tr");S.innerHTML=`
          <td><code>${d(k[h])}</code></td>
          <td>
              <input type="text" class="regular-text" name="settings[${c}][basic_labels][${w}]" value="${d(y)}" placeholder="${d(b)}" ${p?"":"disabled"}>
          </td>
      `,m.appendChild(S)}),_.appendChild(u),_}function o(){let c=document.getElementById("aipkit_indexing_settings_form_container"),l=document.getElementById("general-training-settings-content");if(!c||!l)return{};let p={},_=l.querySelector("#aipkit_hide_user_uploads_checkbox");p.hide_user_uploads=_?_.checked:!0;let f=c.querySelectorAll('input[type="checkbox"]'),u=c.querySelectorAll('input[type="text"]');return f.forEach(m=>{let g=m.name.match(/[^[\]']+/g);if(g&&g.length===5&&g[4]==="enabled"){let[,k,w,h]=g;p[k]||(p[k]={}),p[k][w]||(p[k][w]={}),p[k][w][h]||(p[k][w][h]={}),p[k][w][h].enabled=m.checked}}),u.forEach(m=>{let g=m.name.match(/[^[\]']+/g);if(g&&g.length===5&&g[4]==="label"){let[,k,w,h]=g;p[k]||(p[k]={}),p[k][w]||(p[k][w]={}),p[k][w][h]||(p[k][w][h]={}),p[k][w][h].label=m.value.trim()}else if(g&&g.length===4&&g[2]==="basic_labels"){let[,k,,w]=g;p[k]||(p[k]={}),p[k].basic_labels||(p[k].basic_labels={}),p[k].basic_labels[w]=m.value.trim()}}),p}async function s(c){let l=c.currentTarget;if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_showMessage!="function")return;window.aipkit_setLoadingStateOpenAI(l,!0,"Save Settings","Saving...");let p=o(),_=window.aipkit_ai_training_settings_config||{};try{let f=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:_.settings_nonce,settings:JSON.stringify(p)});window.aipkit_showMessage("aipkit_indexing_settings_messages","success",f.message||"Settings saved!"),a=p}catch(f){console.error("Error saving indexing settings:",f),window.aipkit_showMessage("aipkit_indexing_settings_messages","error",f.message||"Failed to save settings.")}finally{window.aipkit_setLoadingStateOpenAI(l,!1,"Save Settings")}}function r(){let c=document.getElementById("indexing-settings-tab-content");if(!c||c.dataset.initialized==="true")return;i();let l=document.getElementById("aipkit_save_indexing_settings_btn");l&&l.addEventListener("click",s),c.dataset.initialized="true"}window.aipkit_initIndexingSettings=r})();(function(){"use strict";function d(s){let r=document.getElementById("aipkit_toggle_add_content_form_btn"),c=document.getElementById("aipkit_add_content_form_container"),l=document.getElementById("aipkit_kb_card_view"),p=document.getElementById("aipkit_kb_detail_view");if(!r||!c||!l||!p)return;let _=typeof s=="boolean"?s:c.style.display==="none";c.style.display=_?"block":"none",l.style.display=_?"none":"block",p.style.display="none",r.classList.toggle("aipkit_active",_),_&&!c.dataset.initialized&&(typeof window.aipkit_initGlobalFormUIManager=="function"?window.aipkit_initGlobalFormUIManager():console.error("AIPKit AI Training: aipkit_initGlobalFormUIManager not found."),c.dataset.initialized="true")}function a(s){let r=document.getElementById("aipkit_kb_card_view"),c=document.getElementById("aipkit_kb_detail_view"),l=document.getElementById("aipkit_add_content_form_container");!r||!c||!l||(l.style.display="none",r.style.display=s==="cards"?"block":"none",c.style.display=s==="details"?"block":"none",s==="cards"&&i())}async function i(){let s=document.querySelectorAll(".aipkit_kb_card");if(s.length===0)return;let r=Array.from(s).map(c=>{let l=c.dataset.provider,p=c.dataset.id,_=c.querySelector('[data-stat="doc-count"]'),f=c.querySelector('[data-stat="last-updated"]');return!l||!p?Promise.resolve():window.aipkit_apiRequest("aipkit_sync_knowledge_base_stats",{provider:l,store_id:p}).then(u=>{if(_){let m=u.document_count;typeof m=="number"&&!isNaN(m)?_.textContent=m.toLocaleString():_.textContent=m||"N/A"}f&&(f.textContent=u.last_updated||"N/A")}).catch(u=>{console.error(`Error fetching stats for ${l}:${p}`,u),u&&u.message&&u.message.includes("404")?(_&&(_.textContent="NA"),f&&(f.textContent="NA")):(_&&(_.textContent="Error"),f&&(f.textContent="Error"))})});await Promise.all(r)}async function n(){let s=document.getElementById("aipkit_resync_all_providers_btn");if(!s)return;let r=s.querySelector(".aipkit_spinner"),c=s.querySelector(".dashicons");s.disabled=!0,r&&(r.style.display="inline-block"),c&&(c.style.display="none");let l=["PineconeIndexes","QdrantCollections"],p={success:[],failed:[]};try{try{let u=document.getElementById("aipkit_vector_store_nonce_openai");if(!u||!u.value)throw new Error("OpenAI nonce not found for sync.");await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:u.value,limit:100}),p.success.push("OpenAI")}catch(u){console.error("Failed to sync OpenAI:",u),p.failed.push({provider:"OpenAI",error:u.message})}for(let u of l)try{await window.aipkit_apiRequest("aipkit_sync_models",{provider:u}),p.success.push(u.replace("Indexes","").replace("Collections",""))}catch(m){console.error(`Failed to sync ${u}:`,m),p.failed.push({provider:u.replace("Indexes","").replace("Collections",""),error:m.message})}if(document.querySelector(".aipkit_kb_card_grid"))try{let u=await window.aipkit_apiRequest("aipkit_refresh_knowledge_base_cards",{});if(u&&u.html){let m=document.getElementById("aipkit_kb_card_view");m&&(m.innerHTML=u.html,await i())}}catch(u){console.error("Failed to refresh knowledge base cards:",u),await i()}let f="";if(p.success.length>0){let u=p.success.join(", ");f+=`Successfully synced: ${u}. `}if(p.failed.length>0){let u=p.failed.map(m=>m.provider).join(", ");f+=`Failed to sync: ${u}. `}typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(f.trim()||"Sync complete.",p.failed.length>0?"warning":"success","aipkit_knowledge_base_global_status")}catch(_){console.error("Re-sync All error:",_),typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(_.message||"An unexpected error occurred during sync.","error","aipkit_knowledge_base_global_status")}finally{s.disabled=!1,r&&(r.style.display="none"),c&&(c.style.display="inline-block")}}function e(){let s=document.querySelectorAll(".aipkit_source_card"),r=document.getElementById("aipkit_vs_global_data_source");!s.length||!r||s.forEach(c=>{c.addEventListener("click",()=>{let l=c.dataset.source;s.forEach(p=>p.classList.remove("aipkit_source_card_active")),c.classList.add("aipkit_source_card_active"),r.value=l,r.dispatchEvent(new Event("change"))})})}function t(){let s=document.getElementById("aipkit_toggle_add_content_form_btn");s&&s.addEventListener("click",()=>d());let r=document.getElementById("aipkit_resync_all_providers_btn");r&&r.addEventListener("click",()=>n());let c=document.getElementById("aipkit_vs_global_cancel_add_content_btn");c&&c.addEventListener("click",()=>d(!1)),e();let l=document.getElementById("aipkit_kb_card_view");l&&l.addEventListener("click",f=>{let u=f.target.closest(".aipkit_kb_card");if(!u)return;let m=u.dataset.provider,g=u.dataset.id,k=u.dataset.name;a("details");let w=document.getElementById("aipkit_kb_detail_view");w&&(w.dataset.provider=m,w.dataset.storeId=g,w.dataset.storeName=k);let h=document.getElementById("aipkit_kb_detail_title");h&&(h.textContent=k),document.getElementById("aipkit_kb_detail_view").querySelectorAll(".aipkit_vector_provider_management_block").forEach(S=>{S.style.display=S.dataset.provider===m.toLowerCase()?"block":"none"}),m.toLowerCase()==="openai"&&typeof window.aipkit_showStoreFilesPanel=="function"?window.aipkit_showStoreFilesPanel(g,k):m.toLowerCase()==="pinecone"&&typeof window.aipkit_showPineconeIndexDetails=="function"?window.aipkit_showPineconeIndexDetails(g):m.toLowerCase()==="qdrant"&&typeof window.aipkit_fetchAndShowQdrantCollectionDetails=="function"&&window.aipkit_fetchAndShowQdrantCollectionDetails(g)});let p=document.getElementById("aipkit_kb_back_to_list_btn");p&&p.addEventListener("click",()=>a("cards"));let _=document.getElementById("aipkit_kb_detail_view");_&&(_.addEventListener("click",f=>{let u=f.target.closest("#aipkit_kb_detail_search_btn"),m=f.target.closest("#aipkit_kb_detail_delete_btn"),g=f.target.closest(".aipkit_actions_toggle_btn"),k=_.querySelector(".aipkit_actions_dropdown_menu");if(g){k&&(k.style.display=k.style.display==="block"?"none":"block");return}let w=_.dataset.provider,h=_.dataset.storeId,b=_.dataset.storeName;if(u)w.toLowerCase()==="openai"&&typeof window.aipkit_showSearchFormForStore=="function"?window.aipkit_showSearchFormForStore(h,b):w.toLowerCase()==="pinecone"&&typeof window.aipkit_showSearchFormForPineconeIndex=="function"?window.aipkit_showSearchFormForPineconeIndex(h,b):w.toLowerCase()==="qdrant"&&typeof window.aipkit_showSearchFormForQdrantCollection=="function"&&window.aipkit_showSearchFormForQdrantCollection(h,b);else if(m&&confirm(`Are you sure you want to delete the "${b}" knowledge base? This action cannot be undone.`)){let y;w.toLowerCase()==="openai"&&typeof window.aipkit_deleteOpenAIVectorStore=="function"?y=window.aipkit_deleteOpenAIVectorStore(h,m):w.toLowerCase()==="pinecone"&&typeof window.aipkit_deletePineconeIndex=="function"?y=window.aipkit_deletePineconeIndex(h,m):w.toLowerCase()==="qdrant"&&typeof window.aipkit_deleteQdrantCollection=="function"&&(y=window.aipkit_deleteQdrantCollection(h,m))}k&&(k.style.display="none")}),document.addEventListener("click",f=>{let u=_.querySelector(".aipkit_actions_menu");if(u&&!u.contains(f.target)){let m=u.querySelector(".aipkit_actions_dropdown_menu");m&&(m.style.display="none")}}))}function o(){t(),i(),typeof window.aipkit_initOpenAIVectorStore=="function"&&window.aipkit_initOpenAIVectorStore(),typeof window.aipkit_initPineconeUI=="function"&&window.aipkit_initPineconeUI(),typeof window.aipkit_initQdrantVectorStoreUI=="function"&&window.aipkit_initQdrantVectorStoreUI();let s=document.getElementById("indexing-settings-tab-content");s&&s.classList.contains("aipkit_active")&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings()}window.aipkit_initAiTraining=o,window.aipkit_toggleAddContentForm=d,window.aipkit_switchKbView=a})();(function(){"use strict";let d=1,a={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"knowledge_base",label:"Context"},{id:"seo",label:"SEO"},{id:"images",label:"Images"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",prompts:"task_config_ai",knowledge_base:"task_config_knowledge_base",seo:"task_config_seo",images:"task_form_image_settings",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"knowledge_base",label:"Context"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",knowledge_base:"task_config_enhancement_knowledge_base",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function i(){let o=document.querySelectorAll(".aipkit_wizard_step"),s=document.querySelector(".aipkit_wizard_content_container"),r=document.getElementById("aipkit_wizard_prev_btn"),c=document.getElementById("aipkit_wizard_next_btn"),l=document.getElementById("aipkit_save_task_btn");if(!o.length||!s)return;let p="";o.forEach(_=>{let f=parseInt(_.dataset.step,10);_.classList.remove("aipkit_active","aipkit_completed"),f<d?_.classList.add("aipkit_completed"):f===d&&(_.classList.add("aipkit_active"),p=_.dataset.contentId)}),s.querySelectorAll(".aipkit_wizard_content_step").forEach(_=>{(_.dataset.contentId||"")===p?(_.style.display="block",_.classList.add("aipkit_active")):(_.style.display="none",_.classList.remove("aipkit_active"))}),r&&(r.style.display=d>1?"inline-flex":"none"),c&&(c.style.display=d<o.length?"inline-flex":"none"),l&&(l.style.display=d===o.length?"inline-flex":"none")}function n(o){let s=document.querySelectorAll(".aipkit_wizard_step").length;d=Math.max(1,Math.min(o,s||1)),i()}function e(){let o=document.querySelector(".aipkit_wizard_nav");if(!o)return;let s="data-nav-listener-attached";if(o.getAttribute(s))return;let r=document.getElementById("aipkit_wizard_prev_btn"),c=document.getElementById("aipkit_wizard_next_btn");if(!r||!c){console.warn("Wizard Nav: Previous or Next button not found.");return}r.addEventListener("click",()=>{typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),n(d-1)}),c.addEventListener("click",()=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),c.dataset.action==="upgrade"){let l=window.aipkit_dashboard?.upgradeUrl;l?window.open(l,"_blank"):console.error("Upgrade URL not found.");return}if(typeof window.aipkit_form_validateWizardStep=="function"){let l=window.aipkit_form_validateWizardStep(d);if(l!==!0){typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(l,"error");return}}n(d+1)}),o.setAttribute(s,"true")}function t(o){let s=document.querySelector(".aipkit_wizard_steps");if(!s)return;s.innerHTML="";let r="content_writing";o==="content_indexing"?r="content_indexing":o==="community_reply_comments"?r="community_reply_comments":o==="enhance_existing_content"&&(r="enhance_existing_content");let c=window.aipkit_wizardConfig[r];if(!c){console.warn(`No wizard configuration found for task type: ${o}`);return}c.steps.forEach((l,p)=>{let _=p+1,f=document.createElement("div");f.className="aipkit_wizard_step",f.dataset.step=_,f.dataset.contentId=c.contentMap[l.id],f.innerHTML=`
                <div class="aipkit_step_indicator_circle">${_}</div>
                <span>${l.label}</span>
            `,s.appendChild(f)}),typeof window.aipkit_initWizardNavigation=="function"&&window.aipkit_initWizardNavigation(),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_renderWizard=t,window.aipkit_initWizardNavigation=e,window.aipkit_resetWizard=()=>n(1),window.aipkit_wizardConfig=a})();(function(){"use strict";function d(a){let i=window.aipkit_automated_tasks_config||{},n=i.text||{},e=window.aipkit_escapeHtml||function(r){return r},t=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!t)return Promise.resolve();t.innerHTML=`<option value="">${e(n.loading_stores||"Loading...")}</option>`,t.disabled=!0;let o=[],s=n.select_target_store||"-- Select Target Store --";return a==="openai"&&i.openai_vector_stores?o=i.openai_vector_stores:a==="pinecone"&&i.pinecone_indexes?(o=i.pinecone_indexes,s=n.select_target_index||"-- Select Target Index --"):a==="qdrant"&&i.qdrant_collections&&(o=i.qdrant_collections,s=n.select_target_collection||"-- Select Target Collection --"),t.innerHTML=`<option value="">${e(s)}</option>`,o&&Array.isArray(o)&&o.length>0?(o.forEach(r=>{let c=r.id||r.name,l=r.name||r.id,p=e(l);a==="openai"&&r.file_counts?.total!==void 0?p+=` (Files: ${r.file_counts.total})`:a==="pinecone"&&r.dimension!==void 0&&(p+=` (Dim: ${r.dimension})`),t.appendChild(new Option(p,c))}),t.disabled=!1):(t.appendChild(new Option(e(n.no_targets_found_configure||`No ${a} targets found. Configure in AI Training.`),"")),t.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=d})();(function(){"use strict";function d(){let a=window.aipkit_automated_tasks_config||{},i=a.text||{},n=window.aipkit_escapeHtml||function(l){return l},e=document.getElementById("aipkit_task_content_indexing_embedding_model"),t=window.aipkit_automated_tasks_form_state||{},o=t.pendingEmbeddingModelSelection;if(!e)return Promise.resolve();e.innerHTML=`<option value="">${n(i.select_embedding_model||"-- Select Model --")}</option>`;let s=a.openai_embedding_models||[],r=a.google_embedding_models||[],c=(l,p,_)=>{let f=document.createElement("optgroup");return f.label=n(l),p&&p.length>0&&p.forEach(u=>{let m=`${_}:${u.id}`;f.appendChild(new Option(n(u.name||u.id),m))}),f};if(e.appendChild(c("OpenAI",s,"openai")),e.appendChild(c("Google",r,"google")),e.disabled=s.length===0&&r.length===0,e.disabled&&(e.innerHTML=`<option value="">${n(i.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),o&&e.querySelector(`option[value="${CSS.escape(o)}"]`))e.value=o,t.pendingEmbeddingModelSelection=null;else if(e.options.length>1){let l=e.querySelector("optgroup");l&&l.options.length>0&&(e.value=l.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=d})();(function(){"use strict";function d(a){let i=a.target.value,n=document.getElementById("aipkit_task_content_indexing_embedding_model_group");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(i):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),n){let e=i==="pinecone"||i==="qdrant";n.style.display=e?"block":"none",e&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_task_config_content_indexing");if(!a)return;let i=a.querySelector("#aipkit_task_content_indexing_target_store_provider");i&&(typeof window.aipkit_handleTargetStoreProviderChange=="function"?(i.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:i})):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found."))}window.aipkit_initContentIndexingTaskFormUI=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};function a(i,n){let e=i.value,t=e?e.toLowerCase():"",o=window.aipkit_dashboard?.models,s=window.aipkit_automated_tasks_form_state||{};if(!n)return;if(!o){n.innerHTML=`<option value="">${d("Error: Model data object not found")}</option>`,n.disabled=!0;return}let r=o[t],c=s.pendingModelSelection||n.value;if(n.innerHTML="",t==="openai"&&typeof r=="object"&&!Array.isArray(r)?Object.keys(r).forEach(l=>{let p=document.createElement("optgroup");p.label=d(l),Array.isArray(r[l])&&r[l].forEach(_=>{_&&_.id&&p.appendChild(new Option(d(_.name||_.id),_.id))}),n.appendChild(p)}):Array.isArray(r)&&r.forEach(l=>{l&&l.id&&n.appendChild(new Option(d(l.name||l.id),l.id))}),n.options.length===0)n.appendChild(new Option(d(`No models for ${e}`),"")),n.disabled=!0;else{n.disabled=!1;let l=!1;if(c&&n.querySelector(`option[value="${CSS.escape(c)}"]`)&&(n.value=c,l=!0),!l&&n.options.length>0){let p=n.querySelector('option:not([value=""])');p&&(n.value=p.value)}}s&&(s.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}window.aipkit_task_cw_populateModels=a})();(function(){"use strict";function d(a){if(!a)return;let i=a.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");i&&(i.textContent=a.value,a.dataset.listenerAttached||(a.addEventListener("input",()=>i.textContent=a.value),a.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");i&&(i.textContent=a.value,a.dataset.listenerAttached||(a.addEventListener("input",()=>i.textContent=a.value),a.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=d})();(function(){"use strict";function d(a){let i=a.target,n=i.closest(".aipkit_wizard_content_step");if(!n)return;let e=n.querySelector("#aipkit_task_cw_schedule_options_wrapper"),t=n.querySelector("#aipkit_task_cw_smart_schedule_fields"),o=n.querySelector(".aipkit_task_schedule_from_input_option"),s=n.querySelector(".aipkit_task_schedule_from_input_help");if(!e)return;let r=i.value==="publish";e.style.display=r?"block":"none";let c=document.getElementById("aipkit_automated_task_type");if(o){let _=c&&c.value==="content_writing_rss";if(o.style.display=_?"none":"inline-flex",_){let f=o.querySelector('input[name="schedule_mode"][value="from_input"]');if(f&&f.checked){let u=n.querySelector('input[name="schedule_mode"][value="immediate"]');u&&(u.checked=!0,u.dispatchEvent(new Event("change",{bubbles:!0})))}}}n.querySelectorAll('input[name="schedule_mode"]').forEach(_=>{_.dataset.listenerAttached||(_.addEventListener("change",function(){if(t&&(t.style.display=this.value==="smart"?"block":"none"),s){let f=c&&c.value==="content_writing_rss";s.style.display=this.value==="from_input"&&!f?"block":"none"}}),_.dataset.listenerAttached="true")});let p=n.querySelector('input[name="schedule_mode"]:checked');if(p&&t&&(t.style.display=p.value==="smart"?"block":"none"),p&&s){let _=c&&c.value==="content_writing_rss";s.style.display=p.value==="from_input"&&!_?"block":"none"}}window.aipkit_toggleTaskCwScheduleFields=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||(e=>e);function a(e,t){let o=t.querySelector(".aipkit_task_cw_vector_openai_field"),s=t.querySelector(".aipkit_task_cw_vector_pinecone_field"),r=t.querySelector(".aipkit_task_cw_vector_qdrant_field"),c=t.querySelector(".aipkit_task_cw_vector_embedding_config_row");o&&(o.style.display="none"),s&&(s.style.display="none"),r&&(r.style.display="none"),c&&(c.style.display="none"),e==="openai"&&o?o.style.display="block":e==="pinecone"&&s&&c?(s.style.display="block",c.style.display="block"):e==="qdrant"&&r&&c&&(r.style.display="block",c.style.display="block")}function i(e){let t=e.querySelector("#aipkit_task_cw_vector_embedding_model");if(!t)return;let o=window.aipkit_automated_tasks_config||{},s=o.openai_embedding_models||[],r=o.google_embedding_models||[];t.innerHTML=`<option value="">${d("-- Select Model --")}</option>`;let c=document.createElement("optgroup");c.label="OpenAI",s.forEach(p=>c.appendChild(new Option(d(p.name),p.id))),t.appendChild(c);let l=document.createElement("optgroup");l.label="Google",r.forEach(p=>l.appendChild(new Option(d(p.name),p.id))),t.appendChild(l)}function n(){let e=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_knowledge_base"]');if(!e||e.dataset.kbListenerAttached)return;let t=e.querySelector(".aipkit_task_cw_vector_store_toggle"),o=e.querySelector(".aipkit_task_cw_vector_store_settings_container"),s=e.querySelector(".aipkit_task_cw_vector_store_provider_select"),r=e.querySelector(".aipkit_task_cw_vector_embedding_provider_select");t&&o&&t.addEventListener("change",()=>{o.style.display=t.checked?"block":"none"}),s&&o&&(s.addEventListener("change",()=>a(s.value,o)),a(s.value,o)),r&&r.addEventListener("change",()=>{i(o)}),o&&i(o),e.dataset.kbListenerAttached="true"}window.aipkit_initCwKnowledgeBaseUI=n})();(function(){"use strict";function d(){let n=document.getElementById("aipkit_automated_task_form");if(!n){console.warn("Content Writing UI Init: Could not find main form element.");return}let e=n.querySelector("#aipkit_task_cw_ai_provider"),t=n.querySelector("#aipkit_task_cw_ai_model");e&&t&&typeof window.aipkit_task_cw_populateModels=="function"&&(e.dataset.cwProviderListenerAttached||(e.addEventListener("change",()=>window.aipkit_task_cw_populateModels(e,t)),e.dataset.cwProviderListenerAttached="true"),t.dataset.cwModelListenerAttached||(t.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),t.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(e,t),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let o=n.querySelector("#aipkit_task_cw_ai_temperature");o&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(o);let s=n.querySelector("#aipkit_task_cw_content_max_tokens");s&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(s);let r=n.querySelector("#aipkit_task_cw_post_status");r&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(r.dataset.cwStatusListenerAttached||(r.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),r.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:r}));let c=n.querySelector("#aipkit_task_cw_generate_meta_desc"),l=n.querySelector(".aipkit_task_cw_custom_meta_prompt"),p=n.querySelector("#aipkit_task_cw_generate_focus_keyword"),_=n.querySelector(".aipkit_task_cw_custom_keyword_prompt"),f=n.querySelector("#aipkit_task_cw_generate_excerpt"),u=n.querySelector(".aipkit_task_cw_custom_excerpt_prompt"),m=n.querySelector("#aipkit_task_cw_generate_tags"),g=n.querySelector(".aipkit_task_cw_custom_tags_prompt"),k=()=>{l&&(l.style.display=c?.checked?"block":"none"),_&&(_.style.display=p?.checked?"block":"none"),u&&(u.style.display=f?.checked?"block":"none"),g&&(g.style.display=m?.checked?"block":"none")};c&&(c.dataset.cwSeoListenerAttached||(c.addEventListener("change",k),c.dataset.cwSeoListenerAttached="true")),p&&(p.dataset.cwSeoListenerAttached||(p.addEventListener("change",k),p.dataset.cwSeoListenerAttached="true")),f&&(f.dataset.cwSeoListenerAttached||(f.addEventListener("change",k),f.dataset.cwSeoListenerAttached="true")),m&&(m.dataset.cwSeoListenerAttached||(m.addEventListener("change",k),m.dataset.cwSeoListenerAttached="true")),k(),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let h=n.querySelector(".aipkit_task_cw_image_enable_toggle");h&&(h.dataset.cwImgListenerAttached||(h.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),h.dataset.cwImgListenerAttached="true"));let b=n.querySelector("#aipkit_task_cw_image_provider");b&&(b.dataset.cwImgListenerAttached||(b.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),b.dataset.cwImgListenerAttached="true"));let y=n.querySelector("#aipkit_task_cw_generate_featured_image");y&&(y.dataset.cwImgListenerAttached||(y.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),y.dataset.cwImgListenerAttached="true"));let S=n.querySelector(".aipkit_task_cw_image_placement_select");S&&(S.dataset.cwImgListenerAttached||(S.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),S.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100)),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let I=n.querySelector("#aipkit_task_cw_ai_settings_toggle"),x=n.querySelector("#aipkit_task_cw_ai_parameters_row");I&&x&&(I.dataset.cwAiSettingsListenerAttached||(I.addEventListener("click",()=>{let M=x.style.display==="none"||x.style.display==="";x.style.display=M?"block":"none",I.classList.toggle("aipkit_active",M),I.setAttribute("aria-expanded",M)}),I.dataset.cwAiSettingsListenerAttached="true"));let q=n.querySelector("#aipkit_task_config_ai");q&&(q.dataset.cwPromptListenerAttached||(q.addEventListener("click",M=>{let T=M.target.closest(".aipkit_textarea_toggle");if(!T)return;let P=T.dataset.target,C=document.getElementById(P),v=T.querySelector(".dashicons");if(!C||!v)return;C.classList.toggle("aipkit_collapsed")?(v.classList.remove("dashicons-minus"),v.classList.add("dashicons-plus-alt2"),T.title="Expand"):(v.classList.remove("dashicons-plus-alt2"),v.classList.add("dashicons-minus"),T.title="Collapse")}),q.dataset.cwPromptListenerAttached="true"));let $=n.querySelector("#aipkit_task_config_seo");$&&($.dataset.cwSeoPromptListenerAttached||($.addEventListener("click",M=>{let T=M.target.closest(".aipkit_textarea_toggle");if(!T)return;let P=T.dataset.target,C=document.getElementById(P),v=T.querySelector(".dashicons");if(!C||!v)return;C.classList.toggle("aipkit_collapsed")?(v.classList.remove("dashicons-minus"),v.classList.add("dashicons-plus-alt2"),T.title="Expand"):(v.classList.remove("dashicons-plus-alt2"),v.classList.add("dashicons-minus"),T.title="Collapse")}),$.dataset.cwSeoPromptListenerAttached="true"))}function a(){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=window.aipkit_debug||!1,t=n.querySelector(".aipkit_task_cw_image_enable_toggle"),o=n.querySelector("#aipkit_task_cw_generate_featured_image"),s=n.querySelector(".aipkit_task_cw_image_settings_container"),r=n.querySelector("#aipkit_task_cw_image_provider");if(!t||!o||!s||!r)return;let c=t.checked,l=o.checked,p=c||l,_=r.value,f=_==="pexels"||_==="pixabay";if(s.style.display=p?"block":"none",p){let u=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],m=n.querySelector("#aipkit_task_cw_image_prompt")?.closest(".aipkit_form-group"),g=n.querySelector(".aipkit_task_cw_featured_image_prompt_field"),k=n.querySelector(".aipkit_task_cw_image_placement_select"),w=n.querySelector(".aipkit_task_cw_image_placement_x_field"),h=n.querySelector("#aipkit_task_cw_pexels_options"),b=n.querySelector("#aipkit_task_cw_pixabay_options"),y=n.querySelector("#aipkit_task_cw_image_model_group");if(u.forEach(S=>{let I=n.querySelector(S);if(I){let x=I.closest(".aipkit_form-group");x&&(x.style.display=c?"block":"none")}}),k&&w){let S=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(k.value);w.style.display=c&&S?"block":"none"}m&&(m.style.display=c&&!f?"block":"none"),g&&(g.style.display=l&&!f?"block":"none"),h&&(h.style.display=p&&f&&_==="pexels"?"flex":"none"),b&&(b.style.display=p&&f&&_==="pixabay"?"flex":"none"),y&&(y.style.display=p&&!f?"block":"none"),p&&!f&&typeof i=="function"&&i(_)}}function i(n){let e=document.getElementById("aipkit_task_cw_image_model");if(!e)return;let o=window.aipkit_dashboard?.imageGeneratorModels?.[n.toLowerCase()]||[],s=window.aipkit_escapeHtml||function(c){return c},r=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||e.value;e.innerHTML="",o.length>0?(o.forEach(c=>{e.appendChild(new Option(s(c.name),c.id))}),e.querySelector(`option[value="${CSS.escape(r)}"]`)&&(e.value=r)):e.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null)}window.aipkit_initContentWritingTaskFormUI=d,window.aipkit_updateTaskImageSettingsUI=a,window.aipkit_populateTaskImageModels=i})();(function(){"use strict";function d(){let a=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!a)return;let i=a.querySelector("#aipkit_task_cc_ai_provider"),n=a.querySelector("#aipkit_task_cc_ai_model");i&&n&&typeof window.aipkit_task_cw_populateModels=="function"&&(i.dataset.ccProviderListenerAttached||(i.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(i,n),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),i.dataset.ccProviderListenerAttached="true"),n.dataset.ccModelListenerAttached||(n.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),n.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(i,n),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let e=a.querySelector("#aipkit_task_cc_ai_temperature");e&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(e);let t=a.querySelector("#aipkit_task_cc_content_max_tokens");t&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(t);let o=a.querySelector("#aipkit_task_cc_ai_settings_toggle"),s=a.querySelector("#aipkit_task_cc_ai_parameters_row");o&&s&&(o.dataset.ccAiSettingsListenerAttached||(o.addEventListener("click",()=>{let r=s.style.display==="none"||s.style.display==="";s.style.display=r?"block":"none",o.classList.toggle("aipkit_active",r),o.setAttribute("aria-expanded",r)}),o.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=d})();(function(){"use strict";function d(){let a=document.querySelector("#aipkit_task_cw_ai_provider"),i=document.querySelector("#aipkit_task_cw_ai_model"),n=document.querySelector(".aipkit_task_cw_reasoning_effort_field");if(!a||!i||!n){n&&(n.style.display="none");return}let e=a.value,o=(i.value||"").toLowerCase(),s=o.startsWith("o1")||o.startsWith("o3")||o.startsWith("o4"),r=o.includes("gpt-5");e.toLowerCase()==="openai"&&(s||r)?n.style.display="block":n.style.display="none"}window.aipkit_autogpt_cw_toggleReasoningEffort=d})();(function(){"use strict";function d(){let a=document.querySelector("#aipkit_task_cc_ai_provider"),i=document.querySelector("#aipkit_task_cc_ai_model"),n=document.querySelector(".aipkit_task_cc_reasoning_effort_field");if(!a||!i||!n){n&&(n.style.display="none");return}let e=a.value,o=(i.value||"").toLowerCase(),s=o.startsWith("o1")||o.startsWith("o3")||o.startsWith("o4"),r=o.includes("gpt-5");e.toLowerCase()==="openai"&&(s||r)?n.style.display="block":n.style.display="none"}window.aipkit_autogpt_cc_toggleReasoningEffort=d})();(function(){"use strict";function d(a,i){let n=document.getElementById("aipkit_automated_task_form_title"),e=a.querySelector("#aipkit_save_task_btn"),t=e?e.querySelector(".aipkit_btn-text"):null,o=a.elements.task_id,s=a.elements.task_name,r=a.elements.task_type,c=a.elements.task_status,l=document.getElementById("aipkit_cancel_edit_task_btn"),_=(window.aipkit_automated_tasks_config||{}).text||{};i?(n&&(n.textContent=_.edit_task_title||"Edit Automated Task"),t&&(t.textContent=_.save_task_button||"Save Task"),o&&(o.value=i.id||""),s&&(s.value=i.task_name||""),r&&(r.value=i.task_type||"content_indexing"),c&&(c.value=i.status||"active"),l&&(l.style.display="inline-flex")):(n&&(n.textContent=_.create_task_title||"Create New Automated Task"),t&&(t.textContent=_.create_task_button||"Create Task"),o&&(o.value=""),s&&(s.value=""),r&&(r.value="content_indexing"),c&&(c.value="active"),l&&(l.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};function a(i){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=n.elements["post_types[]"];e&&(Array.from(e.options).forEach(o=>o.selected=!1),(i.post_types||[]).forEach(o=>{let s=e.querySelector(`option[value="${d(o)}"]`);s&&(s.selected=!0)}));let t=n.elements.target_store_provider;t&&(t.value=i.target_store_provider||"openai"),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(i.target_store_provider||"openai").then(()=>{let o=n.elements.target_store_id;o&&(o.value=i.target_store_id||"")}),n.elements.index_existing_now_flag&&(n.elements.index_existing_now_flag.checked=i.index_existing_now_flag==="1"),n.elements.only_new_updated_flag&&(n.elements.only_new_updated_flag.checked=i.only_new_updated_flag==="1"),(i.target_store_provider==="pinecone"||i.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&i.embedding_provider&&i.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${i.embedding_provider}:${i.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),n.elements.task_frequency&&(n.elements.task_frequency.value=i.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=a})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};function a(i){let n=document.getElementById("aipkit_automated_task_form");if(!n)return;let e=i.cw_generation_mode||"bulk";if(e==="bulk"||e==="single"||e==="task"){let y=n.elements.content_title_bulk;y&&(y.value=i.content_title||"")}else if(e==="csv"){let y=n.elements.content_title;y&&(y.value=i.content_title||"")}else if(e==="rss")n.elements.rss_feeds&&(n.elements.rss_feeds.value=i.rss_feeds||""),n.elements.rss_include_keywords&&(n.elements.rss_include_keywords.value=i.rss_include_keywords||""),n.elements.rss_exclude_keywords&&(n.elements.rss_exclude_keywords.value=i.rss_exclude_keywords||"");else if(e==="url")n.elements.url_list&&(n.elements.url_list.value=i.url_list||"");else if(e==="gsheets"){let y=n.elements.gsheets_credentials;if(y){let S=i.gsheets_credentials,I=y.closest(".aipkit_gsheets_section_container");typeof S=="object"&&S!==null?y.value=JSON.stringify(S,null,2):y.value=S||"",y.value?(y.dataset.filename="credentials.json",I&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(I),100)):(delete y.dataset.filename,I&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(I,"clear"))}n.elements.gsheets_sheet_id&&(n.elements.gsheets_sheet_id.value=i.gsheets_sheet_id||"")}n.elements.custom_title_prompt&&(n.elements.custom_title_prompt.value=i.custom_title_prompt||""),n.elements.custom_content_prompt&&(n.elements.custom_content_prompt.value=i.custom_content_prompt||"");let t=document.getElementById("aipkit_task_cw_ai_provider"),o=document.getElementById("aipkit_task_cw_ai_model");t&&(t.value=i.ai_provider?i.ai_provider.toLowerCase():"openai",i.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=i.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&o&&window.aipkit_task_cw_populateModels(t,o));let s=document.getElementById("aipkit_task_cw_ai_temperature");if(s){s.value=i.ai_temperature||"1.0";let y=document.getElementById("aipkit_task_cw_ai_temperature_value");y&&(y.textContent=s.value)}let r=document.getElementById("aipkit_task_cw_content_max_tokens");if(r){r.value=i.content_max_tokens||"4000";let y=document.getElementById("aipkit_task_cw_content_max_tokens_value");y&&(y.textContent=r.value)}let c=n.elements.reasoning_effort;c&&(c.value=i.reasoning_effort||"low"),o&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>o.dispatchEvent(new Event("change",{bubbles:!0})),100),n.elements.generate_meta_description&&(n.elements.generate_meta_description.checked=i.generate_meta_description==="1"),n.elements.custom_meta_prompt&&(n.elements.custom_meta_prompt.value=i.custom_meta_prompt||""),n.elements.generate_focus_keyword&&(n.elements.generate_focus_keyword.checked=i.generate_focus_keyword==="1"),n.elements.custom_keyword_prompt&&(n.elements.custom_keyword_prompt.value=i.custom_keyword_prompt||""),n.elements.generate_excerpt&&(n.elements.generate_excerpt.checked=i.generate_excerpt==="1"),n.elements.custom_excerpt_prompt&&(n.elements.custom_excerpt_prompt.value=i.custom_excerpt_prompt||""),n.elements.generate_tags&&(n.elements.generate_tags.checked=i.generate_tags==="1"),n.elements.custom_tags_prompt&&(n.elements.custom_tags_prompt.value=i.custom_tags_prompt||""),n.elements.generate_toc&&(n.elements.generate_toc.checked=i.generate_toc==="1"),n.elements.generate_seo_slug&&(n.elements.generate_seo_slug.checked=i.generate_seo_slug==="1"),n.elements.post_type&&(n.elements.post_type.value=i.post_type||"post");let l=n.elements.post_author;l&&(l.value=i.post_author||window.aipkit_dashboard?.currentUserId||"1");let p=document.getElementById("aipkit_task_cw_post_status");p&&(p.value=i.post_status||"draft");let _=i.schedule_mode||"immediate",f=n.querySelector(`input[name="schedule_mode"][value="${_}"]`);f&&(f.checked=!0),n.elements.smart_schedule_start_datetime&&(n.elements.smart_schedule_start_datetime.value=i.smart_schedule_start_datetime||""),n.elements.smart_schedule_interval_value&&(n.elements.smart_schedule_interval_value.value=i.smart_schedule_interval_value||"1"),n.elements.smart_schedule_interval_unit&&(n.elements.smart_schedule_interval_unit.value=i.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:p});let u=document.getElementById("aipkit_task_cw_post_categories");u&&u.options&&(Array.from(u.options).forEach(S=>S.selected=!1),(Array.isArray(i.post_categories)?i.post_categories.map(String):[]).forEach(S=>{let I=u.querySelector(`option[value="${d(S)}"]`);I&&(I.selected=!0)})),n.elements.generate_images_enabled&&(n.elements.generate_images_enabled.checked=i.generate_images_enabled==="1"),n.elements.image_provider&&(n.elements.image_provider.value=(i.image_provider||"openai").toLowerCase()),n.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=i.image_model),n.elements.image_prompt&&(n.elements.image_prompt.value=i.image_prompt||""),n.elements.image_count&&(n.elements.image_count.value=i.image_count||"1"),n.elements.image_placement&&(n.elements.image_placement.value=i.image_placement||"after_first_h2"),n.elements.image_placement_param_x&&(n.elements.image_placement_param_x.value=i.image_placement_param_x||"2"),n.elements.image_size&&(n.elements.image_size.value=i.image_size||"large"),n.elements.image_alignment&&(n.elements.image_alignment.value=i.image_alignment||"none"),n.elements.generate_featured_image&&(n.elements.generate_featured_image.checked=i.generate_featured_image==="1"),n.elements.featured_image_prompt&&(n.elements.featured_image_prompt.value=i.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let m=n.querySelector('input[name="enable_vector_store"]');m&&(m.checked=i.enable_vector_store==="1");let g=n.querySelector("#aipkit_task_cw_vector_store_provider");g&&(g.value=i.vector_store_provider||"openai");let k=n.querySelector("#aipkit_task_cw_vector_store_top_k");k&&(k.value=i.vector_store_top_k||"3");let w=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(w&&w.options){let y=Array.isArray(i.openai_vector_store_ids)?i.openai_vector_store_ids.map(String):[];Array.from(w.options).forEach(S=>{S.selected=y.includes(S.value)})}let h=document.getElementById("aipkit_task_cw_pinecone_index_name");h&&(h.value=i.pinecone_index_name||"");let b=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(b&&(b.value=i.qdrant_collection_name||""),i.vector_store_provider==="pinecone"||i.vector_store_provider==="qdrant"){let y=document.getElementById("aipkit_task_cw_vector_embedding_provider");y&&(y.value=i.vector_embedding_provider||"openai"),window.aipkit_automated_tasks_form_state&&i.vector_embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=i.vector_embedding_model)}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),n.elements.task_frequency&&(n.elements.task_frequency.value=i.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=a})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let n=document.getElementById("aipkit_task_cc_ai_provider"),e=document.getElementById("aipkit_task_cc_ai_model");n&&e&&(n.value=a.ai_provider?a.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&a.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=a.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(n,e));let t=document.getElementById("aipkit_task_cc_ai_temperature");if(t){t.value=a.ai_temperature||1;let u=document.getElementById(t.id+"_value");u&&(u.textContent=t.value)}let o=document.getElementById("aipkit_task_cc_content_max_tokens");if(o){o.value=a.content_max_tokens||4e3;let u=document.getElementById(o.id+"_value");u&&(u.textContent=o.value)}let s=i.elements.cc_reasoning_effort;s&&(s.value=a.reasoning_effort||"low"),e&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>e.dispatchEvent(new Event("change",{bubbles:!0})),100);let r=document.getElementById("aipkit_task_cc_custom_content_prompt");r&&(r.value=a.custom_content_prompt||"");let c=document.getElementById("aipkit_task_comment_reply_include_keywords");c&&(c.value=a.include_keywords||"");let l=document.getElementById("aipkit_task_comment_reply_exclude_keywords");l&&(l.value=a.exclude_keywords||"");let p=i.elements["post_types_for_comments[]"];p&&(Array.from(p.options).forEach(u=>u.selected=!1),(a.post_types_for_comments||[]).forEach(u=>{let m=p.querySelector(`option[value="${u}"]`);m&&(m.selected=!0)}));let _=i.elements.reply_action;_&&(_.value=a.reply_action||"approve");let f=i.elements.no_reply_to_replies;f&&(f.checked=a.no_reply_to_replies==="1"),i.elements.task_frequency&&(i.elements.task_frequency.value=a.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_automated_task_form"),i=window.aipkit_automated_tasks_config||{},n=window.aipkit_dashboard||{},e=i.default_cw_prompts||{};if(!a)return;a.elements.custom_title_prompt&&(a.elements.custom_title_prompt.value=e.title||""),a.elements.custom_content_prompt&&(a.elements.custom_content_prompt.value=e.content||""),a.elements.custom_meta_prompt&&(a.elements.custom_meta_prompt.value=e.meta||""),a.elements.custom_keyword_prompt&&(a.elements.custom_keyword_prompt.value=e.keyword||""),a.elements.image_prompt&&(a.elements.image_prompt.value=e.image||""),a.elements.featured_image_prompt&&(a.elements.featured_image_prompt.value=e.featured_image||"");let t=document.getElementById("aipkit_task_cw_ai_provider"),o=document.getElementById("aipkit_task_cw_ai_model");if(t&&o){let s=(n.main_provider||"openai").toLowerCase();if(t.value=s,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(t,o);let r="",c=n?.models?.[s];switch(s){case"openai":r="gpt-4.1-mini";break;case"google":r="gemini-1.5-flash-latest";break;case"openrouter":r="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":Array.isArray(c)&&c.length>0&&(r=c[0].id||"");break}o.querySelector(`option[value="${CSS.escape(r)}"]`)?o.value=r:console.warn(`Default model ${r} not found for provider ${s}.`)}}a.elements.generate_images_enabled&&(a.elements.generate_images_enabled.checked=!1),a.elements.image_provider&&(a.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{a.elements.image_model&&(a.elements.image_model.value="gpt-image-1")},0)),a.elements.image_count&&(a.elements.image_count.value="1"),a.elements.image_placement&&(a.elements.image_placement.value="after_first_h2"),a.elements.generate_featured_image&&(a.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_automated_task_form"),i=window.aipkit_dashboard||{};if(!a)return;let n=document.getElementById("aipkit_task_cc_custom_content_prompt");n&&(n.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let e=document.getElementById("aipkit_task_cc_ai_provider"),t=document.getElementById("aipkit_task_cc_ai_model");if(e&&t){let o=(i.main_provider||"openai").toLowerCase();if(e.value=o,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(e,t);let s="",r=(i.models||{})[o]||{};switch(o){case"openai":s="gpt-4o-mini";break;case"google":s="gemini-1.5-flash-latest";break;case"openrouter":s="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":Array.isArray(r)&&r.length>0&&(s=r[0].id||"");break}t.querySelector(`option[value="${CSS.escape(s)}"]`)&&(t.value=s)}}}window.aipkit_form_setCommentReplyDefaults=d})();(function(){"use strict";function d(a,i,n,e=null){let t=document.getElementById("aipkit_automated_task_form"),o=document.getElementById("aipkit_automated_task_queue_wrapper");if(!t){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),t.reset(),t.elements.task_id&&(t.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),e){let c=((window.aipkit_automated_tasks_config||{}).task_types||{})[e.task_type];if(c){let l=t.elements.task_category;if(l){l.value=c.category;let p=new Event("change",{bubbles:!0});l.dispatchEvent(p)}}}else{let r=t.elements.task_category,c=t.elements.task_type;r&&c&&(r.value="content_creation",r.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{c.value="content_writing_bulk",c.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(t,e):(console.error("Show Task Form: aipkit_form_populateCommonFields function is missing."),document.getElementById("aipkit_automated_task_form_title").textContent=e?"Edit Task":"Create Task");let s=t.elements.task_type;if(s&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:s}),e){let r=JSON.parse(e.task_config||"{}");e.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(r):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):e.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(r):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):e.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(r):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):e.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(r):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}a&&(a.style.display="block"),i&&(i.style.display="none"),o&&(o.style.display="none"),n&&(n.style.display="none")}window.aipkit_form_showAutomatedTaskForm=d})();(function(){"use strict";function d(a,i,n){let e=document.getElementById("aipkit_automated_task_queue_wrapper");a&&(a.style.display="none"),i&&(i.style.display="block"),e&&(e.style.display="block"),n&&(n.style.display="inline-flex");let t=document.getElementById("aipkit_automated_task_form"),o=document.getElementById("aipkit_automated_task_id"),s=document.getElementById("aipkit_automated_task_category");t&&t.reset(),o&&(o.value=""),s&&(s.value="",s.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=d})();(function(){"use strict";function d(n,e){let t=document.getElementById(n),o=window.aipkit_escapeHtml||function(p){return p};if(!t)return;let s=e.startsWith("content_writing_")?e.replace("content_writing_",""):"bulk",r=["{topic}","{keywords}"];s==="rss"?(r.push("{description}"),r.push("{source_url}")):s==="url"&&r.push("{url_content}");let l=("Use placeholders: "+r.join(", ")+".").replace(/(\{[a-zA-Z0-9_]+\})/g,p=>`<code class="aipkit-placeholder" title="Click to copy">${o(p)}</code>`);t.innerHTML=l}function a(n){let e=n.target.value,t=document.getElementById("aipkit_automated_task_type"),o=(window.aipkit_automated_tasks_config||{}).task_types||{},s=window.aipkit_escapeHtml||function(l){return l};t.innerHTML="",t.disabled=!0;let r=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(r&&r.querySelectorAll(".aipkit_task_config_section").forEach(l=>{l.id==="aipkit_task_cw_input_modes_wrapper"&&l.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(p=>{p.style.display="none"}),l.style.display="none"}),!e){t.appendChild(new Option(s("-- Select a category first --"),"")),t.dispatchEvent(new Event("change",{bubbles:!0}));return}let c=Object.entries(o).filter(([l,p])=>p.category===e);c.length===0?t.appendChild(new Option(s("-- No tasks in this category --"),"")):(t.appendChild(new Option(s("-- Select a Task Type --"),"")),c.forEach(([l,p])=>{let _=new Option(s(p.label),l);p.disabled&&(_.disabled=!0),t.appendChild(_)}),t.disabled=!1),e==="knowledge_base"?t.value="content_indexing":e==="community_engagement"?t.value="community_reply_comments":e==="content_enhancement"&&(t.value="enhance_existing_content"),t.dispatchEvent(new Event("change",{bubbles:!0}))}function i(n){let e=n.target.value,t=document.getElementById("aipkit_automated_task_id"),o=!t||!t.value,s=document.getElementById("aipkit_wizard_next_btn"),r=s?s.querySelector(".aipkit_btn-text"):null,c=document.getElementById("aipkit_save_task_btn"),l=c?c.querySelector(".aipkit_btn-text"):null,p=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,f=((window.aipkit_automated_tasks_config||{}).task_types||{})[e],u=f&&f.pro===!0,m=(window.aipkit_automated_tasks_config||{}).text||{};if(u&&!p)r&&s&&(s.dataset.action="upgrade",r.textContent="Upgrade to Pro"),l&&c&&(c.dataset.action="upgrade",l.textContent="Upgrade to Pro");else if(r&&s&&(s.dataset.action="next",r.textContent=m.wizard_next_button||"Next"),l&&c){c.dataset.action="save";let y=t&&t.value;l.textContent=y?m.save_task_button||"Save Task":m.create_task_button||"Create Task"}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(e):console.error("Task Type Change: aipkit_renderWizard function is missing.");let g=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!g){console.error("Task Type Change: Could not find setup pane.");return}let k=g.querySelector("#aipkit_task_ci_source_wrapper"),w=g.querySelector("#aipkit_task_cw_input_modes_wrapper"),h=g.querySelector("#aipkit_task_cc_source_wrapper"),b=g.querySelector("#aipkit_task_ce_content_selection_wrapper");if(k&&(k.style.display="none"),w&&(w.style.display="none"),h&&(h.style.display="none"),b&&(b.style.display="none"),!!e){if(e==="content_indexing")k&&(k.style.display="block");else if(e.startsWith("content_writing")){if(d("aipkit_task_cw_content_prompt_placeholders",e),d("aipkit_task_cw_image_prompt_placeholders",e),w){w.style.display="block";let y=e.replace("content_writing_",""),S=y==="content_writing"?"bulk":y;w.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(I=>{I.id===`aipkit_task_cw_input_mode_${S}`?I.style.display="block":I.style.display="none"})}}else if(e==="community_reply_comments")h&&(h.style.display="block");else if(e==="enhance_existing_content"){b&&(b.style.display="block");let y=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),S=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(y&&S){let I=y.querySelector("#aipkit_task_ce_post_types");if(I&&!I.dataset.placeholderListenerAttached){let x=()=>{let $=Array.from(I.selectedOptions).map(T=>T.value).includes("product");S.querySelectorAll(".aipkit-product-placeholders").forEach(T=>{T.style.display=$?"inline":"none"})};I.addEventListener("change",x),I.dataset.placeholderListenerAttached="true",x()}}}o&&(e.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():e==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():e==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),e==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():e.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():e==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():e==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=a,window.aipkit_form_handleTaskTypeChange=i})();(function(){"use strict";function d(a,i="info"){let n=document.getElementById("aipkit_automated_task_form_status");if(n){if(!a){n.textContent="",n.className="aipkit_form-help";return}n.textContent=a,n.className=`aipkit_form-help aipkit_settings_message-${i}`,setTimeout(()=>{n.textContent===a&&(n.textContent="",n.className="aipkit_form-help")},5e3)}}window.aipkit_form_showAutomatedTaskFormStatus=d})();(function(){"use strict";function d(a){let i=new FormData(a),n=Object.fromEntries(i.entries());return n.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:i,data:n}}window.aipkit_save_task_extractBaseData=d})();(function(){"use strict";function d(a,i){if(a.task_type==="content_indexing"){if(a.post_types=i.getAll("post_types[]"),a.target_store_provider=i.get("target_store_provider")||"openai",a.target_store_id=i.get("target_store_id")||"",a.target_store_provider==="pinecone"||a.target_store_provider==="qdrant"){let e=i.get("embedding_model")||"";if(e&&e.includes(":")){let[t,o]=e.split(":",2);a.embedding_provider=t,a.embedding_model=o}else a.embedding_provider="",a.embedding_model=e}else delete a.embedding_provider,delete a.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete a[e])}else delete a.post_types,delete a["post_types[]"],delete a.target_store_provider,delete a.target_store_id,delete a.index_existing_now_flag,delete a.only_new_updated_flag,delete a.embedding_model,delete a.embedding_provider;return a}window.aipkit_save_task_handleContentIndexing=d})();(function(){"use strict";function d(a,i){return a.task_type.startsWith("content_writing")?(a.post_categories=i.getAll("post_categories[]"),a.openai_vector_store_ids=i.getAll("openai_vector_store_ids[]"),delete a["post_categories[]"],delete a["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete a[e])):(delete a.content_title,delete a.content_title_bulk,delete a.content_keywords,delete a.ai_temperature,delete a.content_max_tokens,delete a.post_type,delete a.post_author,delete a.post_status,delete a["post_categories[]"],delete a.post_categories,delete a.prompt_mode,delete a.custom_title_prompt,delete a.custom_content_prompt,delete a.generate_meta_description,delete a.custom_meta_prompt,delete a.generate_focus_keyword,delete a.custom_keyword_prompt,delete a.cw_generation_mode,delete a.rss_feeds,delete a.gsheets_sheet_id,delete a.gsheets_credentials,delete a.url_list,delete a.generate_toc,delete a.generate_images_enabled,delete a.image_provider,delete a.image_model,delete a.image_prompt,delete a.image_count,delete a.image_placement,delete a.image_placement_param_x,delete a.image_alignment,delete a.image_size,delete a.generate_featured_image,delete a.featured_image_prompt,delete a.pexels_orientation,delete a.pexels_size,delete a.pexels_color,delete a.pixabay_orientation,delete a.pixabay_image_type,delete a.pixabay_category,delete a.enable_vector_store,delete a.vector_store_provider,delete a["openai_vector_store_ids[]"],delete a.openai_vector_store_ids,delete a.pinecone_index_name,delete a.qdrant_collection_name,delete a.vector_embedding_provider,delete a.vector_embedding_model,delete a.vector_store_top_k,delete a.rss_include_keywords,delete a.rss_exclude_keywords),a}window.aipkit_save_task_handleContentWriting=d})();(function(){"use strict";function d(a){let n=(window.aipkit_automated_tasks_config||{}).text||{};if(!a.task_name)return n.task_name_required||"Task name is required.";if(!a.task_type)return n.task_type_required||"Task type is required.";if(a.task_type==="content_indexing"){if(!a.target_store_id)return n.target_store_required||"A target vector store/index must be selected.";if(!a.post_types||a.post_types.length===0)return n.content_type_required||"Please select content types for indexing.";if(a.target_store_provider==="pinecone"||a.target_store_provider==="qdrant"){if(!a.embedding_provider)return n.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!a.embedding_model)return n.embedding_model_required||"Embedding model is required for this vector provider."}}if(a.task_type.startsWith("content_writing")){let e=a.cw_generation_mode;if(e==="bulk"||e==="csv"||e==="single"){if(!a.content_title)return n.content_title_required_cw_task||"Content Title/Topic is required for this Content Writing task mode."}else{if(e==="rss"&&!a.rss_feeds)return"RSS Feed URLs are required for this task mode.";if(e==="url"&&!a.url_list)return"Website URLs are required for this task mode.";if(e==="gsheets"&&(!a.gsheets_sheet_id||!a.gsheets_credentials))return"Google Sheet ID and Credentials are required for this task mode."}if(!a.ai_provider||!a.ai_model)return n.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}return!0}window.aipkit_save_task_validateData=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_automated_task_form");if(!i)return console.error("Wizard Validation: Form element not found."),"An internal error occurred: Form not found.";let n=document.querySelector(`.aipkit_wizard_step[data-step="${a}"]`);if(!n)return console.warn(`Validation: Step indicator for step ${a} not found.`),!0;let e=n.dataset.contentId;if(!e)return console.warn(`Validation: Could not find content ID for step ${a}`),!0;let t=(window.aipkit_automated_tasks_config||{}).text||{};switch(e){case"task_form_setup":{if(!i.elements.task_name.value.trim())return t.task_name_required||"Task name is required.";if(!i.elements.task_category.value)return"Task category is required.";let o=i.elements.task_type.value;if(!o)return t.task_type_required||"Task type is required.";if(o==="content_indexing"){let s=i.elements["post_types[]"];if(!s||!Array.from(s.selectedOptions).some(r=>r.value))return t.content_type_required||"Please select at least one post type to index."}else if(o.startsWith("content_writing")){let s=o.replace("content_writing_","");if(s==="bulk"&&!i.elements.content_title_bulk.value.trim())return"At least one topic is required for Bulk mode.";if(s==="csv"){let r=document.getElementById("aipkit_task_cw_csv_data_holder");if(!r||!r.value.trim())return"A parsed CSV file is required for CSV mode."}if(s==="rss"&&!i.elements.rss_feeds.value.trim())return"RSS Feed URL(s) are required for RSS mode.";if(s==="url"&&!i.elements.url_list.value.trim())return"Website URL(s) are required for URL mode.";if(s==="gsheets"&&!i.elements.gsheets_sheet_id.value.trim())return"Google Sheet ID is required for Google Sheets mode."}else if(o==="enhance_existing_content"){let s=document.getElementById("aipkit_task_ce_post_types");if(!s||!Array.from(s.selectedOptions).some(_=>_.value))return"Please select at least one post type to enhance.";let r=document.getElementById("aipkit_task_ce_update_title"),c=document.getElementById("aipkit_task_ce_update_excerpt"),l=document.getElementById("aipkit_task_ce_update_content"),p=document.getElementById("aipkit_task_ce_update_meta");if(!r?.checked&&!c?.checked&&!p?.checked&&!l?.checked)return"Please select at least one field to enhance (Title, Excerpt, Content, or Meta Description)."}break}case"task_config_ai":{let o=i.elements.custom_content_prompt;if(!o||!o.value.trim())return"The Content Prompt cannot be empty.";break}case"task_config_content_indexing":{if(!i.elements.target_store_id.value)return t.target_store_required||"A target vector store/index must be selected.";if(i.elements.target_store_provider.value==="pinecone"||i.elements.target_store_provider.value==="qdrant"){if(!i.elements.embedding_provider.value)return"Embedding provider is required for this vector provider.";if(!i.elements.embedding_model.value)return"Embedding model is required for this vector provider."}break}case"task_config_seo":case"task_form_image_settings":case"task_config_content_writing":break;default:break}return!0}window.aipkit_form_validateWizardStep=d})();(function(){"use strict";async function d(a){let i=window.aipkit_automated_tasks_config||{},n={...a,_ajax_nonce:i.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",n)}window.aipkit_save_task_submitRequest=d})();(function(){"use strict";function d(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=d})();(function(){"use strict";async function d(a){if(a.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let i=a.target,n=i.querySelector("#aipkit_save_task_btn");if(n&&n.dataset.action==="upgrade"){let s=window.aipkit_dashboard?.upgradeUrl;s?window.open(s,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let e=(window.aipkit_automated_tasks_config||{}).text||{},o=!!(i.elements.task_id&&i.elements.task_id.value)?e.save_task_button||"Save Task":e.create_task_button||"Create Task";try{let{formData:s,data:r}=window.aipkit_save_task_extractBaseData(i),c;r.task_type==="content_indexing"?c=window.aipkit_save_task_handleContentIndexing(r,s):r.task_type.startsWith("content_writing")?c=window.aipkit_save_task_handleContentWriting(r,s):r.task_type==="enhance_existing_content"?c=window.aipkit_save_task_handleContentEnhancement(r,s):c=r;let l=window.aipkit_save_task_validateData(c);if(l!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(l,"error"),new Error("Validation failed: "+l);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!0,o,e.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(e.saving_task||"Saving task...","info");let p=await window.aipkit_save_task_submitRequest(c);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(p.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(s){console.error("Save Task Error:",s),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&s.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${s.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(n,!1,o)}}window.aipkit_form_handleSaveTask=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_automated_task_form"),i=document.getElementById("aipkit_automated_task_category"),n=document.getElementById("aipkit_automated_task_type"),e=document.getElementById("aipkit_cancel_edit_task_btn"),t=document.getElementById("aipkit_automated_task_form_wrapper"),o=document.getElementById("aipkit_automated_task_list_wrapper"),s=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),a&&typeof window.aipkit_form_handleSaveTask=="function"?a.addEventListener("submit",window.aipkit_form_handleSaveTask):a&&console.error("Automated Task Form Init: handleSaveTask function not found."),i&&typeof window.aipkit_form_handleCategoryChange=="function"?i.addEventListener("change",window.aipkit_form_handleCategoryChange):i&&console.error("Automated Task Form Init: handleCategoryChange function not found."),n&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(n.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:n})):n&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),e&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?e.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(t,o,s)}):e&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI()}window.aipkit_form_initAutomatedTaskForm=d})();(function(){"use strict";let d=!1,a=null,i=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return d},set isSubmitting(e){d=e},get pendingModelSelection(){return a},set pendingModelSelection(e){a=e},get pendingEmbeddingModelSelection(){return i},set pendingEmbeddingModelSelection(e){i=e}};function n(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=n})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_automated_tasks_tbody"),n=window.aipkit_automated_tasks_config||{},e=n.text||{},t=window.aipkit_escapeHtml||function(l){return l},o=window.aipkit_ucfirst||function(l){return l?l.charAt(0).toUpperCase()+l.slice(1):""},s=n.frequencies||{},r=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(l=>{l.removeAttribute("data-sort-direction"),r&&l.dataset.sortBy===r.sortBy&&l.setAttribute("data-sort-direction",r.sortOrder.toLowerCase())}),!i){console.warn("Render Tasks Table: Table body not found.");return}if(i.innerHTML="",!a||a.length===0){i.innerHTML=`<tr><td colspan="7" class="aipkit_text-center">${e.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}a.forEach(l=>{let p=JSON.parse(l.task_config||"{}"),_=i.insertRow();_.insertCell().textContent=t(l.task_name);let u=(n.task_types?.[l.task_type]||{}).label||o(l.task_type.replace(/_/g," "));_.insertCell().textContent=t(u);let m=p.indexing_frequency||p.task_frequency||"N/A",g=s[m]||o(m.replace(/_/g," "));_.insertCell().textContent=t(g);let k=_.insertCell();k.innerHTML=`<span class="aipkit_job_status_${t(l.status)}">${t(o(l.status))}</span>`,_.insertCell().textContent=l.last_run_time?new Date(l.last_run_time.replace(" ","T")+"Z").toLocaleString():e.never_run||"Never",_.insertCell().textContent=l.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(l.next_run_time):l.next_run_time?new Date(l.next_run_time.replace(" ","T")+"Z").toLocaleString():e.not_scheduled||"Not Scheduled";let w=_.insertCell();w.className="aipkit_automated_tasks_table_actions",w.innerHTML=`
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="edit" data-task-id="${l.id}">${e.edit_button||"Edit"}</button>
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="${l.status==="active"?"pause":"resume"}" data-task-id="${l.id}">${l.status==="active"?e.pause_button||"Pause":e.resume_button||"Resume"}</button>
                <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="run_now" data-task-id="${l.id}" ${l.status!=="active"?"disabled":""} title="${l.status!=="active"?e.task_not_active_run_title||"Task must be active to run":""}">${e.run_now_button||"Run Now"}</button>
                <button class="aipkit_btn aipkit_btn-danger aipkit_btn-small" data-action="delete" data-task-id="${l.id}">${e.delete_button||"Delete"}</button>
            `})}window.aipkit_list_renderTasksTable=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_automated_task_list_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!i){console.warn("Render List Pagination: Pagination container not found.");return}i.innerHTML="";let{total_items:t,total_pages:o,current_page:s}=a||{};if(!o||o<=1){t>0&&(i.innerHTML=`<span class="aipkit_pagination-count">${Number(t).toLocaleString()} ${Number(t)===1?e.task_singular||"task":e.task_plural||"tasks"}</span>`);return}let r=document.createElement("span");r.className="aipkit_pagination-count",r.textContent=`${Number(t).toLocaleString()} ${Number(t)===1?e.task_singular||"task":e.task_plural||"tasks"}`,i.appendChild(r);let c=document.createElement("span");c.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",l.innerHTML=`\xAB ${e.previous_button||"Previous"}`,l.disabled=Number(s)<=1,l.disabled||(l.dataset.page=Number(s)-1),c.appendChild(l);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${e.page_label||"Page"} ${Number(s)} ${e.of_label||"of"} ${Number(o)}`,c.appendChild(p);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=`${e.next_button||"Next"} \xBB`,_.disabled=Number(s)>=Number(o),_.disabled||(_.dataset.page=Number(s)+1),c.appendChild(_),i.appendChild(c)}window.aipkit_list_renderListPagination=d})();(function(){"use strict";async function d(a=1){let i=document.getElementById("aipkit_automated_tasks_tbody"),n=window.aipkit_automated_tasks_list_state,e=window.aipkit_automated_tasks_config||{},t=e.text||{};if(!i){console.warn("Fetch Tasks: Table body not found.");return}i.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${t.loading_tasks||"Loading tasks..."}</td></tr>`,n&&(n.page=a);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let o={page:a,search:n?n.search:"",orderby:n?n.sortBy:"created_at",order:n?n.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},s=await window.aipkit_apiRequest("aipkit_get_automated_tasks",o);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=s.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(s.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(s.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(o){console.error("Fetch Tasks Error:",o),i.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${t.error_loading_tasks||"Error loading tasks:"} ${o.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=d})();(function(){"use strict";function d(a){if(!a){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),a):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=d})();(function(){"use strict";async function d(a,i){let n=window.aipkit_automated_tasks_config||{},e=n.text||{};if(confirm(e.confirm_delete_task||"Are you sure you want to delete this task?")){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!0,e.delete_button||"Delete",e.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:i,_ajax_nonce:n.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(t){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_deleting_task||"Error deleting task:"} ${t.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!1,e.delete_button||"Delete")}}}window.aipkit_handleDeleteTaskAction=d})();(function(){"use strict";async function d(a,i,n){let e=window.aipkit_automated_tasks_config||{},t=e.text||{},o=n==="paused",s=o?t.pausing_task||"Pausing...":t.resuming_task||"Resuming...",r=o?t.pause_button||"Pause":t.resume_button||"Resume";typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!0,r,s);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:i,status:n,_ajax_nonce:e.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${t.task_status_updated||"Task status updated to"} ${n}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${t.error_updating_status||"Error updating task status:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!1,r)}}window.aipkit_handleToggleTaskStatusAction=d})();(function(){"use strict";async function d(a,i){let n=window.aipkit_automated_tasks_config||{},e=n.text||{};typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!0,e.run_now_button||"Run Now",e.running_task||"Initiating Run...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:i,_ajax_nonce:n.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(t){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_initiating_run||"Error initiating task run:"} ${t.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!1,e.run_now_button||"Run Now")}}window.aipkit_handleRunNowTaskAction=d})();(function(){"use strict";async function d(a){let i=a.target.closest("button[data-action]");if(!i)return;let n=i.dataset.action,e=i.dataset.taskId;if(!e)return;let o=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(s=>s.id.toString()===e.toString());switch(n){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(o);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(i,e);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let s=n==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(i,e,s)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(i,e);break;default:console.warn(`Unknown task action: ${n}`);break}}window.aipkit_list_handleTaskActionClick=d})();(function(){"use strict";function d(a){let i=a.target.closest("button[data-page]");if(i&&!i.disabled){let n=parseInt(i.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(n):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=d})();(function(){"use strict";function d(a,i="info"){let n=document.getElementById("aipkit_automated_task_status");n&&(n.textContent=a,n.className=`aipkit_form-help aipkit_settings_message-${i}`,setTimeout(()=>{n.textContent===a&&(n.textContent="",n.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_automated_task_list_wrapper"),i=document.getElementById("aipkit_automated_tasks_tbody"),n=document.getElementById("aipkit_add_new_task_btn"),e=document.getElementById("aipkit_automated_task_form_wrapper"),t=document.getElementById("aipkit_automated_task_list_pagination"),o=document.getElementById("aipkit_task_list_search_input"),s=a?a.querySelector(".aipkit_data-table"):null;if(n&&e&&a&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&n.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(e,a,n)}),i&&typeof window.aipkit_list_handleTaskActionClick=="function"&&i.addEventListener("click",window.aipkit_list_handleTaskActionClick),t&&typeof window.aipkit_list_handleListPaginationClick=="function"&&t.addEventListener("click",window.aipkit_list_handleListPaginationClick),o){let r;o.addEventListener("input",()=>{clearTimeout(r),r=setTimeout(()=>{let c=window.aipkit_automated_tasks_list_state;c&&(c.search=o.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}s&&s.addEventListener("click",r=>{let c=r.target.closest("th.aipkit-sortable-col");if(!c)return;let l=c.dataset.sortBy,p=window.aipkit_automated_tasks_list_state;if(!p)return;let _="DESC";p.sortBy===l&&(_=p.sortOrder==="DESC"?"ASC":"DESC"),p.sortBy=l,p.sortOrder=_,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=d})();(function(){"use strict";let d=[],a=1,i="",n="created_at",e="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...d]},set tasks(o){d=Array.isArray(o)?o:[]},get page(){return a},set page(o){a=o},get search(){return i},set search(o){i=o},get sortBy(){return n},set sortBy(o){n=o},get sortOrder(){return e},set sortOrder(o){e=o}};function t(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=t})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_automated_task_queue_tbody"),n=window.aipkit_automated_tasks_config||{},e=n.text||{},t=window.aipkit_escapeHtml||function(c){return c},o=window.aipkit_ucfirst||function(c){return c?c.charAt(0).toUpperCase()+c.slice(1):""},s=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(c=>{c.removeAttribute("data-sort-direction"),s&&c.dataset.sortBy===s.sortBy&&c.setAttribute("data-sort-direction",s.sortOrder.toLowerCase())}),!i){console.warn("Render Queue Table: Table body not found.");return}if(i.innerHTML="",!a||a.length===0){i.innerHTML=`<tr><td colspan="7" class="aipkit_text-center">${e.queue_empty||"Task queue is currently empty."}</td></tr>`;return}a.forEach(c=>{let l=i.insertRow(),p=l.insertCell(),_=document.createElement("textarea");_.innerHTML=c.target_title||`${e.target_id_prefix||"Target ID:"} ${c.target_identifier}`;let f=_.value,u=c.task_type.startsWith("content_writing"),m=c.task_type==="enhance_existing_content",g=null;u&&c.status==="completed"&&c.generated_post_id?g=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${c.generated_post_id}&action=edit`:m&&!isNaN(parseInt(c.target_identifier,10))&&(g=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${c.target_identifier}&action=edit`),g?p.innerHTML=`<a href="${g}" target="_blank" title="${t(e.edit_generated_post_title||"Edit generated post")}">${t(f)}</a>`:p.textContent=f,l.insertCell().textContent=t(c.task_name||`${e.task_id_prefix||"Task ID:"} ${c.task_id}`);let k=n.task_types&&n.task_types[c.task_type]?n.task_types[c.task_type].label:o(c.task_type.replace(/_/g," "));l.insertCell().textContent=t(k);let w=l.insertCell(),h=`<span class="aipkit_job_status_${t(c.status)}">${t(o(c.status))}</span>`;c.status==="failed"&&c.error_message&&(h+=`<span class="aipkit_queue_error_message" title="${t(c.error_message)}">${t(c.error_message)}</span>`),w.innerHTML=h,l.insertCell().textContent=c.attempts,l.insertCell().textContent=c.added_at?new Date(c.added_at.replace(" ","T")+"Z").toLocaleString():e.not_applicable||"N/A";let b=l.insertCell();b.className="aipkit_automated_tasks_table_actions";let y=`<button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="delete_queue_item" data-item-id="${c.id}">${e.delete_button||"Delete"}</button>`;c.status==="failed"&&(y+=` <button class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" data-action="retry_queue_item" data-item-id="${c.id}">${e.retry_button||"Retry"}</button>`),b.innerHTML=y})}window.aipkit_queue_renderQueueTable=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_automated_task_queue_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!i){console.warn("Render Queue Pagination: Pagination container not found.");return}i.innerHTML="";let{total_items:t,total_pages:o,current_page:s}=a||{};if(!t||t<=0)return;let r=document.createElement("span");if(r.className="aipkit_pagination-count",r.textContent=`${Number(t).toLocaleString()} ${Number(t)===1?e.item_singular||"item":e.item_plural||"items"}`,i.appendChild(r),o>1){let c=document.createElement("span");c.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",l.innerHTML=`\xAB ${e.previous_button||"Previous"}`,l.disabled=Number(s)<=1,l.disabled||(l.dataset.page=Number(s)-1),c.appendChild(l);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${e.page_label||"Page"} ${Number(s)} ${e.of_label||"of"} ${Number(o)}`,c.appendChild(p);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=`${e.next_button||"Next"} \xBB`,_.disabled=Number(s)>=Number(o),_.disabled||(_.dataset.page=Number(s)+1),c.appendChild(_),i.appendChild(c)}}window.aipkit_queue_renderQueuePagination=d})();(function(){"use strict";async function d(a=1){let i=window.aipkit_automated_tasks_queue_state;i?i.page=a:console.warn("Fetch/Render Queue: Queue state object not available.");let n=document.getElementById("aipkit_automated_task_queue_tbody"),e=document.getElementById("aipkit_automated_task_queue_status"),t=window.aipkit_automated_tasks_config||{},o=t.text||{};if(!n){console.warn("Fetch/Render Queue: Table body not found.");return}n.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${o.loading_queue||"Loading queue items..."}</td></tr>`,e&&(e.textContent="");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let s={page:a,search:i?i.search:"",status_filter:i?i.status:"all",orderby:i?i.sortBy:"q.added_at",order:i?i.sortOrder:"DESC",_ajax_nonce:t.nonce_manage_tasks},r=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",s);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(r.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(r.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(s){console.error("Fetch/Render Queue Error:",s),n.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${o.error_loading_queue||"Error loading queue:"} ${s.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=d})();(function(){"use strict";async function d(a){let i=a.target.closest("button[data-action]");if(!i)return;let n=i.dataset.action,e=i.dataset.itemId;if(!e)return;let t=document.getElementById("aipkit_automated_task_queue_status"),o=window.aipkit_automated_tasks_config||{},s=o.text||{},r=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1;if(n==="delete_queue_item"){if(confirm(s.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?")){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,s.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:e,_ajax_nonce:o.nonce_manage_tasks}),t&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(t,"success",s.queue_item_deleted||"Queue item deleted."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(r)}catch(c){t&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(t,"error",`${s.error_deleting_queue_item||"Error deleting item:"} ${c.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,s.delete_button||"Delete")}}}else if(n==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,s.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:e,_ajax_nonce:o.nonce_manage_tasks}),t&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(t,"success",s.item_marked_retry||"Item marked for retry. Queue processing will pick it up."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(r)}catch(c){t&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(t,"error",`${s.error_retrying_item||"Error retrying item:"} ${c.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,s.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=d})();(function(){"use strict";async function d(){let a=document.getElementById("aipkit_delete_queue_by_status_btn"),i=document.getElementById("aipkit_task_queue_status_filter");if(!a||!i){console.error("Delete by status button or filter dropdown not found.");return}let n=i.value,e=i.options[i.selectedIndex].text.toLowerCase(),t=window.aipkit_automated_tasks_config||{},o=t.text||{},s=n==="all"?o.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(o.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",e);if(confirm(s)){typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(a,!0,o.delete_button||"Delete",o.deleting_task||"Deleting..."):a.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let r=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:n,_ajax_nonce:t.nonce_manage_tasks}),c=document.getElementById("aipkit_automated_task_queue_status");c&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"success",r.message||"Queue items deleted."),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(r){let c=document.getElementById("aipkit_automated_task_queue_status");c&&typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"error",`${o.errorDeletingAllItems||"Error deleting items:"} ${r.message||"Unknown error"}`)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(a,!1,o.delete_button||"Delete"):a.disabled=!1}}}window.aipkit_handleDeleteQueueByStatus=d})();(function(){"use strict";function d(a){let i=a.target.closest("button[data-page]");if(i&&!i.disabled){let n=parseInt(i.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(n):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_automated_task_queue_tbody"),i=document.getElementById("aipkit_refresh_task_queue_btn"),n=document.getElementById("aipkit_delete_queue_by_status_btn"),e=document.getElementById("aipkit_automated_task_queue_pagination"),t=document.getElementById("aipkit_task_queue_search_input"),o=document.getElementById("aipkit_task_queue_status_filter"),s=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(i&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&i.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),n&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&n.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),t){let r;t.addEventListener("input",()=>{clearTimeout(r),r=setTimeout(()=>{let c=window.aipkit_automated_tasks_queue_state;c&&(c.search=t.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}o&&o.addEventListener("change",()=>{let r=window.aipkit_automated_tasks_queue_state;r&&(r.status=o.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),s&&s.addEventListener("click",r=>{let c=r.target.closest("th.aipkit-sortable-col");if(!c)return;let l=c.dataset.sortBy,p=window.aipkit_automated_tasks_queue_state;if(!p)return;let _="DESC";p.sortBy===l&&(_=p.sortOrder==="DESC"?"ASC":"DESC"),p.sortBy=l,p.sortOrder=_,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),a&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&a.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),e&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&e.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=d})();(function(){"use strict";let d=1,a="",i="all",n="q.added_at",e="DESC";window.aipkit_automated_tasks_queue_state={get page(){return d},set page(o){d=o},get search(){return a},set search(o){a=o},get status(){return i},set status(o){i=o},get sortBy(){return n},set sortBy(o){n=o},get sortOrder(){return e},set sortOrder(o){e=o}};function t(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=t})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_autogpt_container");if(a&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():a&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(i){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",i)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.")}window.aipkit_initAutogpt=d})();(function(){"use strict";function d(e,t=""){let o=document.getElementById("aipkit_content_writer_form_status");if(o)switch(e){case"progress":o.textContent=t;break;case"success":o.textContent=t,o.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{o.textContent===t&&a()},3e3);break;case"clear":default:o.textContent="";break}}function a(){d("clear")}function i(e){d("progress",e)}function n(e){d("success",e)}window.aipkit_updateGeneralStatus=d,window.aipkit_clearGeneralStatus=a,window.aipkit_showProgress=i,window.aipkit_showSuccess=n})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.warn("Content Writer Accordions: Main container not found.");return}a.dataset.accordionListenerAttached!=="true"&&(a.addEventListener("click",function(i){let n=i.target.closest(".aipkit_accordion-header");if(!n)return;let e=n.closest(".aipkit_accordion");if(!e)return;let t=n.nextElementSibling;if(!t||!t.classList.contains("aipkit_accordion-content"))return;let o=e.closest(".aipkit_accordion-group");if(o&&!n.classList.contains("aipkit_active")){let s=o.querySelector(".aipkit_accordion-header.aipkit_active");if(s){s.classList.remove("aipkit_active");let r=s.nextElementSibling;r&&r.classList.remove("aipkit_active")}}n.classList.toggle("aipkit_active"),t.classList.toggle("aipkit_active")}),a.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(e){return e},a=new Set;function i(e,t,o=""){let s=document.getElementById(`aipkit_cw_status_${e}_generation`),r=s?s.querySelector(".aipkit_cw_status_icon"):null,c=s?s.querySelector(".status-text"):null;if(!s||!r||!c){console.warn(`Could not find all elements for status indicator step: ${e}`);return}if(!(a.has(e)&&t==="generating"))switch((t==="success"||t==="skipped")&&a.add(e),t==="pending"&&a.delete(e),s.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),s.classList.add(`status-${t}`),t){case"pending":c.textContent="Pending";let l="dashicons-text-page";e==="content"&&(l="dashicons-admin-post"),e==="image"&&(l="dashicons-format-image"),e==="excerpt"&&(l="dashicons-editor-quote"),e==="tags"&&(l="dashicons-tag"),e==="meta"&&(l="dashicons-search"),e==="keyword"&&(l="dashicons-flag"),r.className=`dashicons ${l} aipkit_cw_status_icon`;break;case"generating":c.textContent=o||"Generating...",r.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":c.textContent="Complete",r.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":c.textContent=`Error ${o?": "+d(o):""}`,r.className="dashicons dashicons-warning aipkit_cw_status_icon",a.delete(e);break;case"skipped":c.textContent="Skipped",r.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function n(){a.clear(),["title","content","image","meta","keyword","excerpt","tags"].forEach(e=>{i(e,"pending")})}window.aipkit_updateCwGenerationStatus=i,window.aipkit_resetAllGenerationStatuses=n})();(function(){"use strict";function d(){let a=document.querySelector(".aipkit_cw_generation_status_indicators");a&&(a.style.display="flex",typeof window.aipkit_updateCwGenerationStatus=="function"?(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending")):console.error("Reset Status Indicators: aipkit_updateCwGenerationStatus function not found."))}window.aipkit_resetGenerationStatusIndicators=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};async function a(i,n,e){let t=new FormData(i),o=Object.fromEntries(t.entries()),s=window.aipkit_dashboard?.text||{},r=document.querySelector(".aipkit_cw_tab.aipkit_active"),c=r?r.dataset.mode:"task";if(o.cw_generation_mode=c,c==="csv"){let f=document.getElementById("aipkit_cw_csv_data_holder");o.content_title=f?f.value:""}else c==="url"?(o.url_list=i.elements.url_list?.value||"",o.content_title=o.url_list):c==="task"?o.content_title=i.elements.content_title_bulk?i.elements.content_title_bulk.value:"":c==="single"&&(o.content_title=i.elements.content_title?i.elements.content_title.value:"");delete o.content_title_bulk,delete o.content_title_csv;let l=document.getElementById("aipkit_cw_template_select"),p="";if(l&&l.selectedIndex>0){let f=l.options[l.selectedIndex];f&&(p=f.text)}if(p&&p.trim()!=="")o.task_name=p.trim();else{let f=(o.content_title||o.rss_feeds||o.gsheets_sheet_id||o.url_list||"").split(`
`)[0].trim();o.task_name=f||"Automated Content Writing Task"}if((c==="task"||c==="csv"||c==="single")&&!o.content_title){e&&(e.textContent=c==="csv"?"Please upload and parse a valid CSV file first.":"Content Title/Topic is required for automated tasks.",e.className="aipkit_form-help aipkit_settings_message-error");return}if(c==="rss"&&!o.rss_feeds){e&&(e.textContent="RSS Feed URL(s) are required for this task mode.",e.className="aipkit_form-help aipkit_settings_message-error");return}if(c==="gsheets"&&(!o.gsheets_sheet_id||!o.gsheets_credentials)){e&&(e.textContent="Google Sheet ID and Credentials are required for this task mode.",e.className="aipkit_form-help aipkit_settings_message-error");return}if(c==="url"&&!o.url_list){e&&(e.textContent="Website URL(s) are required for this task mode.",e.className="aipkit_form-help aipkit_settings_message-error");return}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(n,!0,"Create Task","Creating Task..."):(n.disabled=!0,n.textContent="Creating Task..."),e&&(e.textContent="Creating automated task...",e.className="aipkit_form-help aipkit_settings_message-info");try{let f=document.getElementById("aipkit_content_writer_nonce");if(o._ajax_nonce=f?f.value:"",!o._ajax_nonce)throw new Error("Security token missing for task creation.");let u=await window.aipkit_apiRequest("aipkit_content_writer_create_task",o);e&&(e.textContent=u.message||(s.task_queued_content_writing??"Your content writing task is queued. You can track it under the Automated Tasks tab."),e.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{e&&(e.textContent="",e.className="aipkit_form-help")},5e3))}catch(f){console.error("Content Writer Create Task Error:",f),e&&(e.textContent=`Error creating task: ${d(f.message||"Unknown error")}`,e.className="aipkit_form-help aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(n,!1,"Create Task"):(n.disabled=!1,n.textContent="Create Task")}}window.aipkit_createContentWriterTask=a})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};function a(i,n){let e=i.value,t=e?e.toLowerCase():"",o=window.aipkit_dashboard?.models;if(!n){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!o){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),n.innerHTML='<option value="">'+d("Error: Model data object not found")+"</option>",n.disabled=!0;return}let s=o[t];if((typeof s>"u"||s===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${t}'. Defaulting to empty.`),s=t==="openai"?{}:[]),n.innerHTML="",t==="openai"&&typeof s=="object"&&!Array.isArray(s)?Object.keys(s).forEach(r=>{let c=document.createElement("optgroup");c.label=d(r);let l=s[r];Array.isArray(l)?l.forEach(p=>{if(p&&typeof p=="object"&&p.id){let _=new Option(d(p.name||p.id),p.id);c.appendChild(_)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${r}':`,p)}):console.warn(`Content Writer Model Populator: Items for group '${r}' under '${t}' is not an array.`),n.appendChild(c)}):Array.isArray(s)?s.forEach(r=>{if(r&&typeof r=="object"&&r.id){let c=new Option(d(r.name||r.id),r.id);n.appendChild(c)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${t}':`,r)}):(console.warn(`Content Writer Model Populator: Data for provider '${t}' is not in expected format. Actual type: ${typeof s}`),n.appendChild(new Option(d(`No models for ${e} (Format Error)`),""))),!n.options||typeof n.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),n.appendChild(new Option(d("Error loading models"),"")),n.disabled=!0;else if(n.options.length===0)n.appendChild(new Option(d(`No models for ${e} (Sync in settings)`),"")),n.disabled=!0;else{n.disabled=!1;let r=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let c=window.aipkit_cw_template_state.pendingModelSelection;n.querySelector(`option[value="${CSS.escape(c)}"]`)?r=c:console.warn(`Content Writer Model Populator: Pending model '${c}' not found in new list for provider '${e}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(r===null){let c=n.querySelector("optgroup");c&&c.options&&c.options.length>0&&c.options[0].value?r=c.options[0].value:n.options&&n.options.length>0&&n.options[0].value?r=n.options[0].value:r=""}n.value=r}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let r=document.getElementById("aipkit_content_writer_container");r&&window.aipkit_cw_toggleReasoningEffort(r)}}window.aipkit_populateModelsForContentWriter=a})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function a(n){if(!document.getElementById("aipkit_content_writer_form"))return;let t=document.getElementById("aipkit_content_writer_generate_btn"),o=t?t.querySelector(".aipkit_btn-text"):null,s=document.getElementById("aipkit_cw_task_options"),r=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,c=new Set(["task","csv","rss","gsheets","url"]),l=new Set(["rss","gsheets","url"]),p=document.getElementById("aipkit_cw_single_output_wrapper");p&&n!=="single"&&(p.style.display="none");let _=document.getElementById("aipkit_cw_content_prompt_placeholders");if(_){let f="Use placeholders: {topic}, {keywords}";n==="rss"?f+=", {description}, {source_url}":n==="url"&&(f+=", {url_content}"),f+=".";let u=f.replace(/(\{[a-zA-Z0-9_]+\})/g,m=>`<code class="aipkit-placeholder" title="Click to copy">${d(m)}</code>`);_.innerHTML=u}o&&t&&(c.has(n)?l.has(n)&&!r?(o.textContent="Upgrade to Pro",t.dataset.action="upgrade"):(o.textContent="Create Task",t.dataset.action="create_task"):(o.textContent="Generate",t.dataset.action="generate_single")),s&&(s.style.display=c.has(n)?"flex":"none"),typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields()}function i(n){if(!n){console.error("Content Writer Tabs: Scope element not provided for initialization.");return}let e=n.querySelector(".aipkit_cw_tabs"),t=n.querySelector(".aipkit_cw_tab_content_container");if(!e||!t){console.warn("Content Writer Tabs: Tab or content container not found within the provided scope.");return}e.addEventListener("click",function(s){let r=s.target.closest(".aipkit_cw_tab");if(!r||r.classList.contains("aipkit_active"))return;e.querySelectorAll(".aipkit_cw_tab").forEach(p=>p.classList.remove("aipkit_active")),t.querySelectorAll(".aipkit_cw_tab_content").forEach(p=>p.classList.remove("aipkit_active"));let c=r.dataset.mode;r.classList.add("aipkit_active");let l=t.querySelector(`.aipkit_cw_tab_content[data-pane="${c}"]`);l&&l.classList.add("aipkit_active"),a(c)});let o=e.querySelector(".aipkit_cw_tab.aipkit_active");o&&a(o.dataset.mode)}window.aipkit_initContentWriterTabs=i})();(function(){"use strict";function d(a,i){if(!a||!i||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(a.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(a,i)}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(a,i);else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let n=window.aipkit_escapeHtml||function(e){return e};i.innerHTML='<option value="">'+n("Models unavailable (Data Object Missing)")+"</option>",i.disabled=!0}}window.aipkit_handleProviderModelDropdowns=d})();(function(){"use strict";function d(a){if(!a){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let i=document.getElementById("aipkit_content_writer_temperature_value");i?a.dataset.listenerAttached||(a.addEventListener("input",()=>i.textContent=a.value),a.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=d})();(function(){"use strict";function d(a){if(!a){console.error("Max Tokens Slider Handler: Slider element was not passed or not found.");return}let i=document.getElementById("aipkit_content_writer_max_tokens_value");i&&(i.textContent=a.value,a.dataset.listenerAttached||(a.addEventListener("input",function(){i.textContent=this.value}),a.dataset.listenerAttached="true"))}window.aipkit_handleMaxTokensSlider=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.warn("AI Settings Toggle: Content writer container not found.");return}let i=a.querySelector(".aipkit_ai_settings_toggle"),n=a.querySelector(".aipkit_cw_ai_parameters_row");if(!i||!n){console.warn("AI Settings Toggle: Toggle button or settings row not found.");return}let e="data-settings-toggle-listener-attached";i.getAttribute(e)||(i.addEventListener("click",function(){let t=n.style.display==="none";n.style.display=t?"block":"none",i.classList.toggle("aipkit_active",t),i.setAttribute("aria-expanded",t)}),i.setAttribute(e,"true"))}window.aipkit_initAiSettingsToggle=d})();(function(){"use strict";function d(a){if(!a){console.warn("Copy Button Handler: Button element not provided.");return}a.dataset.listenerAttached||(a.addEventListener("click",()=>{let i=document.getElementById("aipkit_content_writer_output_display");i&&navigator.clipboard.writeText(i.innerText).then(()=>{let n=a.innerHTML;a.innerHTML='<span class="dashicons dashicons-yes"></span> Copied!',setTimeout(()=>{a.innerHTML=n},2e3)}).catch(n=>console.error("Failed to copy: ",n))}),a.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=d})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_cw_single_output_wrapper"),n=document.getElementById("aipkit_content_writer_output_display"),e=document.getElementById("aipkit_cw_generated_content_area"),t=document.querySelector(".aipkit_content_writer_output_actions"),o=document.getElementById("aipkit_cw_status_display_container"),s=document.getElementById("aipkit_cw_generated_title_display"),r=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),c=document.getElementById("aipkit_cw_generated_meta_desc"),l=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),p=document.getElementById("aipkit_cw_generated_focus_keyword"),_=document.getElementById("aipkit_cw_excerpt_output_wrapper"),f=document.getElementById("aipkit_cw_generated_excerpt"),u=document.getElementById("aipkit_cw_tags_output_wrapper"),m=document.getElementById("aipkit_cw_generated_tags"),g=document.getElementById("aipkit_content_writer_copy_btn"),k=document.getElementById("aipkit_content_writer_clear_btn");if(i&&(i.style.display="none"),n&&e){e.innerHTML=`
            <div class="aipkit_cw_output_placeholder">
                <span class="dashicons dashicons-edit-large"></span>
                <span>Your article will appear here...</span>
            </div>`,n.scrollTop=0,t&&(t.style.display="none"),g&&(g.disabled=!0),k&&(k.disabled=!0),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton();let w=document.getElementById("aipkit_content_writer_form_status");w&&(w.textContent=""),o&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():o&&(o.style.display="none"),s&&(s.style.display="none",s.textContent=""),r&&(r.style.display="none"),c&&(c.value=""),l&&(l.style.display="none"),p&&(p.value=""),_&&(_.style.display="none"),f&&(f.value=""),u&&(u.style.display="none"),m&&(m.value="")}}function a(i,n){if(!i){console.warn("Clear Button Handler: Button element not provided.");return}i.dataset.listenerAttached||(i.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),i.dataset.listenerAttached="true")}window.aipkit_handleClearButton=a,window.aipkit_clearContentWriterOutput=d})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_content_writer_form");if(!i)return;let n=i.elements.generate_meta_description,e=i.querySelector("#aipkit_cw_custom_meta_prompt_field"),t=i.elements.generate_focus_keyword,o=i.querySelector("#aipkit_cw_custom_keyword_prompt_field"),s=i.elements.generate_excerpt,r=i.querySelector(".aipkit_cw_custom_excerpt_prompt"),c=i.elements.generate_tags,l=i.querySelector(".aipkit_cw_custom_tags_prompt");e&&(e.style.display=n&&n.checked?"block":"none"),o&&(o.style.display=t&&t.checked?"block":"none"),r&&(r.style.display=s&&s.checked?"block":"none"),l&&(l.style.display=c&&c.checked?"block":"none")}function a(){let i=document.getElementById("aipkit_content_writer_form");if(!i||i.dataset.optionToggleListenerAttached)return;let n=i.elements.generate_meta_description,e=i.elements.generate_focus_keyword,t=i.elements.generate_excerpt,o=i.elements.generate_tags;n&&n.addEventListener("change",d),e&&e.addEventListener("change",d),t&&t.addEventListener("change",d),o&&o.addEventListener("change",d),i.dataset.optionToggleListenerAttached="true",d()}window.aipkit_cw_toggleCustomOptionPrompts=d,window.aipkit_cw_initOptionPromptToggles=a})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.warn("Prompt Toggle Handler: Content writer container not found.");return}a.querySelectorAll(".aipkit_textarea_toggle").forEach(e=>{let t=e.dataset.target;if(!t)return;let o=`aipkit-cw-prompt-${t}-state`,s=localStorage.getItem(o),r=document.getElementById(t),c=e.querySelector(".dashicons");r&&c&&(s==="expanded"?(r.classList.remove("aipkit_collapsed"),c.classList.remove("dashicons-plus-alt2"),c.classList.add("dashicons-minus"),e.title="Collapse"):(r.classList.add("aipkit_collapsed"),c.classList.remove("dashicons-minus"),c.classList.add("dashicons-plus-alt2"),e.title="Expand"))});let n="data-prompt-toggle-listener-attached";a.getAttribute(n)||(a.addEventListener("click",function(e){let t=e.target.closest(".aipkit_textarea_toggle");if(!t)return;let o=t.dataset.target,s=document.getElementById(o),r=t.querySelector(".dashicons");if(!s||!r){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",t);return}let c=s.classList.toggle("aipkit_collapsed");c?(r.classList.remove("dashicons-minus"),r.classList.add("dashicons-plus-alt2"),t.title="Expand"):(r.classList.remove("dashicons-plus-alt2"),r.classList.add("dashicons-minus"),t.title="Collapse");let l=`aipkit-cw-prompt-${o}-state`;localStorage.setItem(l,c?"collapsed":"expanded")}),a.setAttribute(n,"true"))}window.aipkit_initPromptToggles=d})();(function(){"use strict";function d(a){if(!a)return;let i=a.querySelector("#aipkit_content_writer_provider"),n=a.querySelector("#aipkit_content_writer_model"),e=a.querySelector(".aipkit_cw_reasoning_effort_field");if(!i||!n||!e){e&&(e.style.display="none");return}let t=i.value,s=(n.value||"").toLowerCase(),r=s.startsWith("o1")||s.startsWith("o3")||s.startsWith("o4"),c=s.includes("gpt-5");t==="openai"&&(r||c)?e.style.display="block":e.style.display="none"}window.aipkit_cw_toggleReasoningEffort=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(e){return e};function a(e){let t=document.getElementById("aipkit_cw_image_model");if(!t)return;let o=window.aipkit_dashboard?.imageGeneratorModels;if(!o){console.error("Image models data not found in aipkit_dashboard object."),t.innerHTML='<option value="">Error: Models not loaded</option>';return}let s=o[e.toLowerCase()]||[],r=window.aipkit_cw_template_state?.pendingImageModelSelection,c=t.value,l=r||c;t.innerHTML="",s.length>0?(s.forEach(p=>{t.appendChild(new Option(p.name,p.id))}),t.querySelector(`option[value="${CSS.escape(l)}"]`)?t.value=l:t.options.length>0&&(t.selectedIndex=0)):t.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function i(){let e=document.getElementById("aipkit_content_writer_container");if(!e)return;let t=e.querySelector(".aipkit_cw_image_enable_toggle"),o=e.querySelector("#aipkit_cw_generate_featured_image"),s=e.querySelector("#aipkit_cw_image_placement"),r=e.querySelector("#aipkit_cw_image_provider"),c=t?.closest(".aipkit_accordion-content")?.querySelector(".aipkit_cw_image_settings_container"),l=o?.closest(".aipkit_accordion-content")?.querySelector(".aipkit_cw_featured_image_prompt_field"),p=e.querySelector("#aipkit_cw_image_prompt")?.closest(".aipkit_form-group");if(!t||!o||!c||!l||!p)return;let _=t.checked,f=o.checked,u=_||f,m=r.value,g=m==="pexels"||m==="pixabay";if(c.style.display=u?"block":"none",u){let k=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],w=e.querySelector("#aipkit_cw_pexels_options"),h=e.querySelector("#aipkit_cw_pixabay_options"),b=e.querySelector("#aipkit_cw_image_model_group");if(k.forEach(y=>{let S=e.querySelector(y);if(S){let I=S.closest(".aipkit_form-group");I&&(I.style.display=_?"block":"none")}}),s){let y=s.closest(".aipkit_form-row")?.querySelector(".aipkit_cw_image_placement_x_field");if(y){let S=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(s.value);y.style.display=_&&S?"block":"none"}}p.style.display=_&&!g?"block":"none",l.style.display=f&&!g?"block":"none",w&&(w.style.display=g&&m==="pexels"?"flex":"none"),h&&(h.style.display=g&&m==="pixabay"?"flex":"none"),b&&(b.style.display=g?"none":"block"),g||a(m)}}function n(){let e=document.getElementById("aipkit_content_writer_container");e&&(e.dataset.imageHandlerAttached||(e.addEventListener("change",function(t){t.target.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider")&&i()}),i(),e.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=n,window.aipkit_updateImageSettingsUI=i})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(t){return t};function a(t){let o=t.querySelector(".aipkit_cw_vector_store_toggle"),s=t.querySelector(".aipkit_cw_vector_store_settings_container");if(o&&s){let r=o.checked;s.style.display=r?"block":"none",r&&i(t)}}function i(t){let o=t.querySelector(".aipkit_cw_vector_store_provider_select");if(!o)return;let s=o.value,r=t.querySelector(".aipkit_cw_vector_openai_field"),c=t.querySelector(".aipkit_cw_vector_pinecone_field"),l=t.querySelector(".aipkit_cw_vector_qdrant_field"),p=t.querySelector(".aipkit_cw_vector_embedding_config_row");if(r&&(r.style.display=s==="openai"?"block":"none"),c&&(c.style.display=s==="pinecone"?"block":"none"),l&&(l.style.display=s==="qdrant"?"block":"none"),p){let _=s==="pinecone"||s==="qdrant";if(p.style.display=_?"block":"none",_){let f=p.querySelector(".aipkit_cw_vector_embedding_provider_select");f&&n(f.value)}}}function n(t){let o=document.getElementById("aipkit_cw_vector_embedding_model");if(!o)return;let r=(window.aipkit_dashboard?.embeddingModels||{})[t.toLowerCase()]||[],c=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";o.innerHTML=`<option value="">${d("-- Select Model --")}</option>`,r.length>0?(r.forEach(l=>{if(l&&l.id){let p=new Option(d(l.name||l.id),l.id);l.id===c&&(p.selected=!0),o.appendChild(p)}}),o.disabled=!1):(o.disabled=!0,o.innerHTML=`<option value="">${d("-- No models found --")}</option>`)}function e(){let t=document.getElementById("aipkit_content_writer_container");t&&(t.dataset.vectorSettingsHandlerAttached||(t.addEventListener("change",function(o){let s=o.target;s.matches(".aipkit_cw_vector_store_toggle")?a(s.closest(".aipkit_accordion-content")):s.matches(".aipkit_cw_vector_store_provider_select")?i(s.closest(".aipkit_cw_vector_store_settings_container")):s.matches(".aipkit_cw_vector_embedding_provider_select")&&n(s.value)}),t.querySelectorAll(".aipkit_accordion-content").forEach(o=>{o.querySelector(".aipkit_cw_vector_store_toggle")&&a(o)}),t.dataset.vectorSettingsHandlerAttached="true"))}window.aipkit_initContentWriterVectorSettings=e,window.aipkit_cw_toggleVectorSettingsContainer=a,window.aipkit_cw_toggleProviderSpecificFields=i,window.aipkit_cw_populateEmbeddingModelSelect=n})();(function(){"use strict";function d(a,i,n,e,t,o,s){typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(a,i):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(n):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleMaxTokensSlider=="function"?window.aipkit_handleMaxTokensSlider(e):console.error("Content Writer UI: handleMaxTokensSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(o):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(s,o):console.error("Content Writer UI: handleClearButton function not found.")}window.aipkit_initContentWriterUI=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_content_writer_generate_btn"),i=document.getElementById("aipkit_content_writer_stop_btn");a&&(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(a,!1,"Generate"):(a.disabled=!1,a.textContent="Generate"),a.style.display="inline-flex"),i&&(i.style.display="none")}window.aipkit_resetContentWriterButtons=d})();(function(){"use strict";function d(a){a.current&&(a.current.close(),a.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let i=document.getElementById("aipkit_content_writer_output_display"),n=document.querySelector(".aipkit_content_writer_output_actions"),e=document.getElementById("aipkit_content_writer_copy_btn"),t=document.getElementById("aipkit_content_writer_clear_btn");i&&i.textContent.trim()!==""&&!i.classList.contains("aipkit_content_writer_output_error")?(n&&(n.style.display="block"),e&&(e.disabled=!1),t&&(t.disabled=!1),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(n&&(n.style.display="none"),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=d})();(function(){"use strict";async function d(n){let e=n.target,t=e.closest(".aipkit_form-group");if(!t)return;let o=t.querySelector(".aipkit_csv_analysis_results"),s=t.querySelector(".aipkit_csv_data_holder"),r=document.getElementById("aipkit_content_writer_nonce"),c=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,l=r?r.value:c;if(!o||!s||!l){console.error("CSV Handler: Missing status div, data holder, or nonce field."),o&&(o.textContent="Error: A required UI component or security token is missing.",o.className="aipkit_form-help aipkit_settings_message-error");return}let p=e.files[0];if(!p){o.textContent="Please select a CSV file first.",o.className="aipkit_form-help aipkit_settings_message-error";return}if(!p.name.toLowerCase().endsWith(".csv")){o.textContent="Invalid file type. Please upload a .csv file.",o.className="aipkit_form-help aipkit_settings_message-error";return}o.textContent="Parsing CSV...",o.className="aipkit_form-help aipkit_settings_message-info";let _=new FormData;_.append("file",p),_.append("_ajax_nonce",l),_.append("action","aipkit_content_writer_parse_csv");try{let f=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:_,credentials:"same-origin"});if(!f.ok)throw new Error(`Server returned status ${f.status}`);let u=await f.json();if(!u.success)throw new Error(u.data?.message||"Unknown server error.");let m=u.data;m.tasks_found>0?(s.value=m.formatted_data,o.textContent=`Success! Found ${m.tasks_found} tasks in the CSV file. Ready.`,o.className="aipkit_form-help aipkit_settings_message-success"):(s.value="",o.textContent="No valid tasks found in the CSV file.",o.className="aipkit_form-help aipkit_settings_message-error")}catch(f){s.value="",o.textContent=`Error: ${f.message||"Failed to parse CSV file."}`,o.className="aipkit_form-help aipkit_settings_message-error",console.error("CSV Parse Error:",f)}}function a(){let n=document.getElementById("aipkit_cw_csv_file_input");n&&n.dataset.listenerAttached!=="true"&&(n.addEventListener("change",d),n.dataset.listenerAttached="true")}function i(){let n=document.getElementById("aipkit_task_cw_csv_file_input");n&&n.dataset.listenerAttached!=="true"&&(n.addEventListener("change",d),n.dataset.listenerAttached="true")}window.aipkit_initCsvUploadHandler=a,window.aipkit_initTaskCsvUploadHandler=i})();(function(){"use strict";function d(a,i){let n=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!n||!n.value)throw new Error("Security token missing for stream. Please reload.");let e=new URL(window.aipkit_dashboard.ajaxurl);e.searchParams.append("action","aipkit_frontend_chat_stream"),e.searchParams.append("cache_key",a),e.searchParams.append("_ajax_nonce",n.value),i.current&&i.current.close();try{let t=new EventSource(e.toString());return t.userStopped=!1,t}catch(t){throw console.error("EventSource Connection Setup: EventSource creation error:",t),new Error("Could not connect to stream. "+t.message)}}window.aipkit_stream_setupEventSourceConnection=d})();(function(){"use strict";function d(a,i,n,e){if(a.data)try{let t=JSON.parse(a.data);if(t.delta){if(i.fullContent+=t.delta,e)n.innerHTML=e.render(i.fullContent);else{let s=n.textContent||"";n.textContent=s+t.delta}let o=n.parentElement;if(o){let s=n.lastElementChild;s?s.scrollIntoView({behavior:"auto",block:"end"}):o.scrollTop=o.scrollHeight}}}catch(t){console.error("Stream Message Handler: Error parsing event data.",t)}}window.aipkit_stream_handleMessage=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};async function a(i,n,e,t,o,s){if(n.isDone)return;n.isDone=!0,t&&(e.innerHTML=t.render(n.fullContent)),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let r=document.getElementById("aipkit_content_writer_form"),c=r?r.elements.generate_meta_description:null,l=r?r.elements.generate_focus_keyword:null,p=r?r.elements.generate_excerpt:null,_=r?r.elements.generate_tags:null,f=document.getElementById("aipkit_content_writer_nonce")?.value,u=r.elements.ai_provider?.value,m=r.elements.ai_model?.value,g=r.elements.content_max_tokens?.value,k=r.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",w=document.getElementById("aipkit_cw_generated_title_display"),h=w?w.textContent:r.elements.content_title?.value.split("|")[0].trim()||"Untitled",b=r.elements.content_keywords?.value.trim()||"",y="",S=document.getElementById("aipkit_content_writer_title");if(S){let T=S.value.split("|")||[];T.length>1&&(y=T[1].trim())}let I=y||b,x=I;if(l?.checked&&!I&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let T={generated_content:n.fullContent,final_title:h,provider:u,model:m,prompt_mode:k,custom_keyword_prompt:r.elements.custom_keyword_prompt.value,content_max_tokens:g,_ajax_nonce:f},P=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",T);if(P&&P.focus_keyword){x=P.focus_keyword;let C=document.getElementById("aipkit_cw_generated_focus_keyword"),v=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");C&&v&&(C.value=x,v.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",T.message||"Failed")}}else if(I){let T=document.getElementById("aipkit_cw_generated_focus_keyword"),P=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");T&&P&&(T.value=I.split(",")[0].trim(),P.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let q=r?r.elements.generate_images_enabled:null,$=r?r.elements.generate_featured_image:null;if((q?.checked||$?.checked)&&n.fullContent.trim()!==""){let T=q?.checked,P=$?.checked,C=T?parseInt(r.elements.image_count?.value,10)||1:0,v=C+(P?1:0),E="Generating images...";v>1?E=`Generating ${v} images...`:v===1&&P&&!T?E="Generating featured image...":v===1&&(E="Generating 1 image..."),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",E);let L={original_topic:S?S.value.split("|")[0].trim():h,final_title:h,keywords:x,image_provider:r.elements.image_provider?.value,image_model:r.elements.image_model?.value,image_prompt:r.elements.image_prompt?.value,image_alignment:r.elements.image_alignment?.value,image_size:r.elements.image_size?.value,featured_image_prompt:r.elements.featured_image_prompt?.value,pexels_orientation:r.elements.pexels_orientation?.value,pexels_size:r.elements.pexels_size?.value,pexels_color:r.elements.pexels_color?.value,pixabay_orientation:r.elements.pixabay_orientation?.value,pixabay_image_type:r.elements.pixabay_image_type?.value,pixabay_category:r.elements.pixabay_category?.value,_ajax_nonce:f,generate_images_enabled:T?"1":"0",image_count:C,generate_featured_image:P?"1":"0",image_placement:r.elements.image_placement?.value,image_placement_param_x:r.elements.image_placement_param_x?.value};try{let A=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",L);if(A?.image_data){let F=document.getElementById("aipkit_cw_image_data_holder");F&&(F.value=JSON.stringify(A.image_data)),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success")}else throw new Error("Image generation failed or returned no data.")}catch(A){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",A.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(p?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let T={generated_content:n.fullContent,final_title:h,keywords:x,provider:u,model:m,prompt_mode:k,custom_excerpt_prompt:r.elements.custom_excerpt_prompt.value,content_max_tokens:g,_ajax_nonce:f},P=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",T);if(P&&P.excerpt){let C=document.getElementById("aipkit_cw_generated_excerpt"),v=document.getElementById("aipkit_cw_excerpt_output_wrapper");C&&v&&(C.value=P.excerpt,v.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",T.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(_?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let T={generated_content:n.fullContent,final_title:h,keywords:x,provider:u,model:m,prompt_mode:k,custom_tags_prompt:r.elements.custom_tags_prompt.value,content_max_tokens:g,_ajax_nonce:f},P=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",T);if(P&&P.tags){let C=document.getElementById("aipkit_cw_generated_tags"),v=document.getElementById("aipkit_cw_tags_output_wrapper");C&&v&&(C.value=P.tags,v.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",T.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(c?.checked&&n.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let T={generated_content:n.fullContent,final_title:h,keywords:x,provider:u,model:m,prompt_mode:k,custom_meta_prompt:r.elements.custom_meta_prompt.value,content_max_tokens:g,_ajax_nonce:f},P=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",T);if(P&&P.meta_description){let C=document.getElementById("aipkit_cw_generated_meta_desc"),v=document.getElementById("aipkit_cw_meta_desc_output_wrapper");C&&v&&(C.value=P.meta_description,v.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",T.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(s)}window.aipkit_stream_handleDone=a})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};function a(i,n,e,t,o){if(n.isDone)return;if(o.current&&o.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(o);return}let s="Error during streaming.";if(i.data)try{s=JSON.parse(i.data).error||s}catch{}console.error("Stream Error Handler: Error event received:",i),e&&(e.textContent="",e.className="aipkit_form-help"),t&&t.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",s),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(o)}window.aipkit_stream_handleError=a})();(function(){"use strict";let d={current:null};function a(i,n){let e=document.getElementById("aipkit_content_writer_output_display"),t=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_content_writer_form_status");if(!e||!t||!o){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let s=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let c of s)if(typeof window[c]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${c}`),o&&(o.textContent="",o.className="aipkit_form-help"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let r={fullContent:"",isDone:!1};t.innerHTML="",e.classList.remove("aipkit_content_writer_output_error"),o&&(o.textContent="",o.className="aipkit_form-help"),window.aipkit_updateCwGenerationStatus("content","generating");try{n.current=window.aipkit_stream_setupEventSourceConnection(i,n);let c=window.aipkit_getMarkdownRenderer();n.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},n.current.onmessage=function(l){window.aipkit_stream_handleMessage(l,r,t,c)},n.current.addEventListener("done",function(l){window.aipkit_stream_handleDone(l,r,t,c,o,n)}),n.current.addEventListener("error",function(l){window.aipkit_stream_handleError(l,r,o,e,n)})}catch(c){console.error("EventSource Orchestrator: Error during setup:",c),o&&(o.textContent="",o.className="aipkit_form-help"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=a,window.aipkit_contentWriterEventSourceInstanceRef=d})();(function(){"use strict";function d(a){a&&a.current&&a.current.close()}window.aipkit_stopContentWriterEventSource=d})();(function(){"use strict";async function d(a){let i=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),t=document.getElementById("aipkit_content_writer_form_status"),o=document.getElementById("aipkit_cw_generated_content_area"),s=document.getElementById("aipkit_content_writer_copy_btn"),r=document.getElementById("aipkit_content_writer_clear_btn"),c=document.querySelector(".aipkit_content_writer_progress_bar_container"),l=document.querySelector(".aipkit_content_writer_output_actions");if(!i||!n||!e||!t||!o||!s||!r||!l){console.error("Handle SSE: Missing UI elements.");return}let p=new FormData(i),_=Object.fromEntries(p.entries());if(!_.content_title){t.textContent="",t.className="aipkit_form-help";return}let f=document.getElementById("aipkit_content_writer_nonce");if(f&&f.value)_._ajax_nonce=f.value;else{t.textContent="",t.className="aipkit_form-help";return}if(window.aipkit_setLoadingStateOpenAI(n,!0,"Generate","Initializing..."),n.style.display="none",e.style.display="inline-flex",c&&(c.style.display="none"),l.style.display="none",o){let u=o.querySelector(".aipkit_cw_output_placeholder");u&&(u.style.display="none"),o.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'}s.disabled=!0,r.disabled=!0,typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),t.textContent="",t.className="aipkit_form-help";try{_.content_title=document.getElementById("aipkit_content_writer_title").value;let u=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",_);if(!u.cache_key)throw new Error(u.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=u.cache_key,typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(u.cache_key,a);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(u){console.error("Content Writer Init Stream Error:",u),t.textContent="",t.className="aipkit_form-help",window.aipkit_setLoadingStateOpenAI(n,!1,"Generate"),n.style.display="inline-flex",e.style.display="none",o&&(o.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};async function a(){let i=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),t=document.getElementById("aipkit_content_writer_form_status"),o=document.getElementById("aipkit_cw_generated_content_area"),s=document.getElementById("aipkit_content_writer_copy_btn"),r=document.getElementById("aipkit_content_writer_clear_btn"),c=document.querySelector(".aipkit_content_writer_progress_bar_container"),l=c?c.querySelector(".aipkit_content_writer_progress_bar"):null,p=document.querySelector(".aipkit_content_writer_output_actions"),_=document.getElementById("aipkit_cw_status_display_container");if(!i||!n||!e||!t||!o||!s||!r){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),t.textContent="",t.className="aipkit_form-help";return}let f=new FormData(i),u=Object.fromEntries(f.entries());if(!u.content_title){t.textContent="",t.className="aipkit_form-help",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let m=document.getElementById("aipkit_content_writer_nonce");if(m&&m.value)u._ajax_nonce=m.value;else{t.textContent="",t.className="aipkit_form-help",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}_&&(_.style.display="block");let g=document.getElementById("aipkit_cw_generate_meta_desc"),k=document.getElementById("aipkit_cw_generate_focus_keyword"),w=document.getElementById("aipkit_cw_generate_excerpt"),h=document.getElementById("aipkit_cw_generate_tags");if(typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",w?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",h?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",g?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",k?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(n,!0,"Generate","Generating..."),e.style.display="none",p&&(p.style.display="none"),o){let b=o.querySelector(".aipkit_cw_output_placeholder");b&&(b.style.display="none"),o.innerHTML=""}s.disabled=!0,r.disabled=!0,typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),t.textContent="Generating content, please wait...",t.className="aipkit_form-help aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),c&&l&&(c.style.display="block",l.style.width="0%",l.classList.add("aipkit_indeterminate"));try{let b=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",u);if(b.content){let y=window.aipkit_getMarkdownRenderer();if(o&&(y?o.innerHTML=y.render(b.content):o.textContent=b.content),p&&(p.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),s.disabled=!1,r.disabled=!1,typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),b.content&&w?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let S={generated_content:b.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||u.content_title,provider:u.ai_provider,model:u.ai_model,prompt_mode:u.prompt_mode,custom_excerpt_prompt:u.custom_excerpt_prompt,_ajax_nonce:u._ajax_nonce},I=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",S);if(I&&I.excerpt){let x=document.getElementById("aipkit_cw_generated_excerpt"),q=document.getElementById("aipkit_cw_excerpt_output_wrapper");x&&q&&(x.value=I.excerpt,q.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",S.message||"Not returned")}}if(b.content&&h?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let S={generated_content:b.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||u.content_title,provider:u.ai_provider,model:u.ai_model,prompt_mode:u.prompt_mode,custom_tags_prompt:u.custom_tags_prompt,_ajax_nonce:u._ajax_nonce},I=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",S);if(I&&I.tags){let x=document.getElementById("aipkit_cw_generated_tags"),q=document.getElementById("aipkit_cw_tags_output_wrapper");x&&q&&(x.value=I.tags,q.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",S.message||"Not returned")}}if(b.meta_description){let S=document.getElementById("aipkit_cw_generated_meta_desc"),I=document.getElementById("aipkit_cw_meta_desc_output_wrapper");S&&I&&(S.value=b.meta_description,I.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else g?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(b.focus_keyword){let S=document.getElementById("aipkit_cw_generated_focus_keyword"),I=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");S&&I&&(S.value=b.focus_keyword,I.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else k?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(b.message||"No content received.")}catch(b){console.error("Content Writer AJAX Error:",b),t.textContent="",t.className="aipkit_form-help",o&&(o.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",b.message),w?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),h?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),g?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),k?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),p&&(p.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(n,!1,"Generate"),c&&(c.style.display="none"),l&&l.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=a})();(function(){"use strict";function d(a){if(!a||!a.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let i=document.getElementById("aipkit_content_writer_form_status");a.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(a):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=d})();(function(){"use strict";function d(a,i,n,e){a&&(a.dataset.listenerAttached||(a.addEventListener("click",async()=>{if(a.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):alert("Upgrade URL not found. Please visit our website.");return}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let t=document.getElementById("aipkit_content_writer_form_status"),o=document.getElementById("aipkit_cw_status_display_container"),s=document.getElementById("aipkit_cw_generated_title_display"),r=document.getElementById("aipkit_content_writer_title");if((a.dataset.action||"generate_single")==="create_task"){o&&(o.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(i,a,t):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),t&&(t.textContent="",t.className="aipkit_form-help"));return}let l=document.getElementById("aipkit_cw_single_output_wrapper");l&&(l.style.display="block"),o&&(o.style.display="block");let p=document.getElementById("aipkit_content_writer_stream_mode"),f=i.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),n.style.display="flex";let u={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[k,w]of Object.entries(u)){let h=document.getElementById(w);h&&!h.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(k,"skipped")}let m=document.getElementById("aipkit_cw_generate_images_enabled"),g=document.getElementById("aipkit_cw_generate_featured_image");if(m&&g&&!m.checked&&!g.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),f){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),s&&(s.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!0,"Generate","Generating Title...");let k=new FormData(i),w=Object.fromEntries(k.entries()),h=document.getElementById("aipkit_content_writer_nonce");w._ajax_nonce=h?h.value:"";let b=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",w);if(b&&b.new_title)s&&(s.textContent=b.new_title,s.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success");else throw new Error(b.message||"Failed to generate new title.")}catch(k){console.error("Title Generation Error:",k),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",k.message),t&&(t.textContent="",t.className="aipkit_form-help"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),s&&r&&(s.textContent=r.value.split("|")[0].trim(),s.style.display="block");!p||p.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(e):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),a.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=d})();(function(){"use strict";function d(a,i){a&&(a.dataset.listenerAttached||(a.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(i):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),a.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=d})();(function(){"use strict";function d(a,i){if(a===i)return!0;if(a==null||typeof a!="object"||i==null||typeof i!="object")return!1;let n=Object.keys(a),e=Object.keys(i);if(n.length!==e.length)return!1;for(let t of n)if(!e.includes(t)||!d(a[t],i[t]))return!1;return!0}window.aipkit_deepEqual=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_content_writer_provider"),i=document.getElementById("aipkit_content_writer_temperature"),n=document.getElementById("aipkit_content_writer_post_author"),e=n?n.value:window.aipkit_dashboard?.currentUserId||"1",o=(a&&a.options.length>0?a.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),s=a?a.value.toLowerCase():o,r="",c=window.aipkit_dashboard?.models?.[s];switch(s){case"openai":r="gpt-4.1-mini";break;case"google":r="gemini-2.5-flash";break;case"openrouter":r="anthropic/claude-3.7-sonnet";break;case"azure":case"deepseek":Array.isArray(c)&&c.length>0?r=c[0].id||"":r="";break;default:r=""}let l=i&&i.defaultValue||"1.0",_=(window.aipkit_dashboard?.aiParams||{}).max_completion_tokens||"4000",f=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:s,ai_model:r,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:l,content_max_tokens:_,post_type:"post",post_author:e,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:f.title,custom_content_prompt:f.content,generate_meta_description:"1",custom_meta_prompt:f.meta,generate_focus_keyword:"1",custom_keyword_prompt:f.keyword,generate_excerpt:"1",custom_excerpt_prompt:f.excerpt,generate_tags:"1",custom_tags_prompt:f.tags,cw_generation_mode:"single",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"gpt-image-1",image_prompt:f.image||"A high-quality, relevant image for an article about: {topic}",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_featured_image:"0",featured_image_prompt:f.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=d})();(function(){"use strict";function d(a){let i={};if(!a)return i;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_max_tokens","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","rss_include_keywords","rss_exclude_keywords"].forEach(k=>{a.elements[k]&&(i[k]=a.elements[k].value)});let e=a.elements.generate_meta_description;e?i.generate_meta_description=e.checked?"1":"0":i.generate_meta_description="0";let t=a.elements.generate_focus_keyword;t?i.generate_focus_keyword=t.checked?"1":"0":i.generate_focus_keyword="0";let o=a.elements.generate_excerpt;o?i.generate_excerpt=o.checked?"1":"0":i.generate_excerpt="0";let s=a.elements.generate_tags;s?i.generate_tags=s.checked?"1":"0":i.generate_tags="0";let r=a.elements.generate_toc;r?i.generate_toc=r.checked?"1":"0":i.generate_toc="0";let c=a.elements.generate_seo_slug;c?i.generate_seo_slug=c.checked?"1":"0":i.generate_seo_slug="0";let l=a.elements.generate_images_enabled;l?i.generate_images_enabled=l.checked?"1":"0":i.generate_images_enabled="0";let p=a.elements.generate_featured_image;p?i.generate_featured_image=p.checked?"1":"0":i.generate_featured_image="0";let _=a.elements.enable_vector_store;_?i.enable_vector_store=_.checked?"1":"0":i.enable_vector_store="0";let f=a.elements["openai_vector_store_ids[]"];f?i.openai_vector_store_ids=Array.from(f.selectedOptions).map(k=>k.value):i.openai_vector_store_ids=[];let u=a.querySelector("#aipkit_cw_prompt_mode_hidden_input");u?i.prompt_mode=u.value:i.prompt_mode="custom";let m=a.querySelector("#aipkit_cw_generation_mode");i.cw_generation_mode=m?m.value:"single";let g=a.elements["post_categories[]"];return g?i.post_categories=Array.from(g.selectedOptions).map(k=>k.value):i.post_categories=[],i}window.aipkit_getContentWriterFormConfig=d})();(function(){"use strict";function d(a){if(!a||!a.value)return!1;let i=a.value,n=window.aipkit_cw_template_state.currentTemplates.find(e=>String(e.id)===String(i));return n&&String(n.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_content_writer_post_status"),i=document.getElementById("aipkit_cw_schedule_options_wrapper"),n=document.getElementById("aipkit_cw_smart_schedule_fields"),e=document.querySelector(".aipkit_schedule_from_input_help"),t=document.querySelector(".aipkit_schedule_from_input_option");if(!a||!i)return;let o=a.value==="publish";i.style.display=o?"block":"none";let s=document.querySelector(".aipkit_cw_tab.aipkit_active"),r=s?s.dataset.mode:"single";if(t){let p=r==="rss";t.style.display=p?"none":"inline-flex";let _=t.querySelector('input[name="schedule_mode"]');if(p&&_&&_.checked){let f=document.querySelector('input[name="schedule_mode"][value="immediate"]');f&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(p=>{p.dataset.listenerAttached||(p.addEventListener("change",function(){n&&(n.style.display=this.value==="smart"?"block":"none"),e&&(e.style.display=this.value==="from_input"?"block":"none")}),p.dataset.listenerAttached="true")});let l=document.querySelector('input[name="schedule_mode"]:checked');l&&n&&(n.style.display=l.value==="smart"?"block":"none"),l&&e&&(e.style.display=l.value==="from_input"?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_cw_single_output_wrapper"),e=document.getElementById("aipkit_cw_generated_title_display"),t=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),s=document.querySelector(".aipkit_content_writer_output_actions");n&&(n.style.display="none"),e&&(e.style.display="none",e.textContent=""),t&&(t.innerHTML=`
            <div class="aipkit_cw_output_placeholder">
                <span class="dashicons dashicons-edit-large"></span>
                <span>Your article will appear here...</span>
            </div>`),o&&(o.style.display="none"),s&&(s.style.display="none")}function i(n,e=!1){let t=document.getElementById("aipkit_cw_template_status");window.aipkit_cw_template_state.currentTemplateId=n,n?sessionStorage.setItem("aipkit_cw_last_template_id",n):sessionStorage.removeItem("aipkit_cw_last_template_id");let o=window.aipkit_cw_template_state.currentTemplates.find(b=>String(b.id)===String(n)),s;if(o)s=JSON.parse(JSON.stringify(o.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),t&&!e&&(t.textContent="Error: Cannot load default template.",t.className="aipkit_form-help aipkit_settings_message-error");return}s=window.aipkit_getDefaultContentWriterTemplateConfig()}window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(s)),window.aipkit_cw_template_state.currentTemplateModified=!1,a();let r=document.getElementById("aipkit_content_writer_form");if(!r){console.error("Apply Template: Content writer form not found.");return}s.ai_model&&r.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=s.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,s.image_model&&r.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=s.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,["ai_provider","content_title","content_keywords","ai_temperature","content_max_tokens","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","rss_include_keywords","rss_exclude_keywords"].forEach(b=>{let y=r.elements[b];if(y){let S=s[b]===null||typeof s[b]>"u"?"":s[b];if(b==="gsheets_credentials"&&typeof S=="object"&&S!==null)y.value=JSON.stringify(S,null,2);else if((b==="ai_temperature"||b==="content_max_tokens"||b==="vector_store_top_k")&&y.type==="range"){y.value=S||(b==="ai_temperature"?"1.0":b==="vector_store_top_k"?"3":"4000");let I=document.getElementById(y.id+"_value");I&&(I.textContent=y.value)}else y.type==="checkbox"?y.checked=S==="1":y.value=S;b==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields()}});let l=r.elements.gsheets_credentials;if(l){let b=s.gsheets_credentials,y=l.closest(".aipkit_gsheets_section_container");l.value=typeof b=="object"&&b!==null?JSON.stringify(b,null,2):b||"",l.value?(l.dataset.filename="credentials.json",y&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(y),100)):(delete l.dataset.filename,y&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(y,"clear"))}let p={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",enable_vector_store:"0"};for(let[b,y]of Object.entries(p)){let S=r.elements[b];S&&(S.checked=(s[b]||y)==="1")}let _=document.getElementById("aipkit_cw_prompt_mode_hidden_input");_&&(_.value=s.prompt_mode||"custom");let f=r.querySelector("#aipkit_cw_generation_mode"),u=s.cw_generation_mode||"single";f&&(f.value=u,typeof window.aipkit_initContentWriterTaskModeHandler=="function"&&f.dispatchEvent(new Event("change",{bubbles:!0})));let m=r.elements["post_categories[]"];if(m){let b=Array.isArray(s.post_categories)?s.post_categories.map(y=>String(y)):[];Array.from(m.options).forEach(y=>{y.selected=b.includes(y.value)})}let g=r.elements["openai_vector_store_ids[]"];if(g){let b=Array.isArray(s.openai_vector_store_ids)?s.openai_vector_store_ids.map(String):[];Array.from(g.options).forEach(y=>{y.selected=b.includes(y.value)})}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts();let k=r.elements.enable_vector_store;k&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(k.closest(".aipkit_accordion-content"));let w=r.elements.vector_store_provider;w&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(w.value=s.vector_store_provider||"openai",w.dispatchEvent(new Event("change",{bubbles:!0})));let h=r.elements.ai_provider;if(h){let b=h.value,y=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),S=(s.ai_provider||y).toLowerCase();if(b!==S)h.value=S,h.dispatchEvent(new Event("change",{bubbles:!0}));else{let I=r.elements.ai_model;I&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(h,I):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}}if(!e&&t&&(o&&n?(t.textContent=`Template "${d(o.template_name)}" applied.`,t.className="aipkit_form-help aipkit_settings_message-success"):n||(t.textContent="Form reset to defaults.",t.className="aipkit_form-help aipkit_settings_message-info"),setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_form-help")},3e3)),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(n),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let b=document.getElementById("aipkit_content_writer_container");b&&window.aipkit_cw_toggleReasoningEffort(b)}}window.aipkit_applyContentWriterTemplate=i})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};async function a(i){if(!i){console.error("Fetch & Populate Templates: Select element is missing.");return}let n=document.getElementById("aipkit_cw_template_status"),e=document.getElementById("aipkit_content_writer_template_nonce_field");i.innerHTML=`<option value="">${d("Loading templates...")}</option>`,i.disabled=!0,n&&(n.textContent="",n.className="aipkit_form-help");try{let t=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:e?e.value:""});window.aipkit_cw_template_state.currentTemplates=t.templates||[],i.innerHTML="";let o=new Option(d("-- Select Template --"),"");i.appendChild(o);let s=window.aipkit_cw_template_state.currentTemplates||[],r=window.aipkit_dashboard?.currentUserId?.toString(),c=null,l=[],p={};if(s.forEach(u=>{if(String(u.is_default)==="1"&&u.user_id.toString()===r&&(c=u.id),u.user_id.toString()===r)l.push(u);else{let m=u.display_name||`User ID: ${u.user_id}`;p[m]||(p[m]=[]),p[m].push(u)}}),l.sort((u,m)=>u.is_default==="1"?-1:m.is_default==="1"?1:u.template_name.localeCompare(m.template_name)),l.length>0){let u=document.createElement("optgroup");u.label=d("My Templates"),l.forEach(m=>{u.appendChild(new Option(d(m.template_name),m.id))}),i.appendChild(u)}Object.keys(p).sort().forEach(u=>{let m=document.createElement("optgroup");m.label=d(u),p[u].forEach(g=>{m.appendChild(new Option(d(g.template_name),g.id))}),i.appendChild(m)}),i.disabled=!1;let f=sessionStorage.getItem("aipkit_cw_last_template_id");f&&i.querySelector(`option[value="${CSS.escape(f)}"]`)?(i.value=f,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(f,!0)):c?(i.value=c,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(c,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0)}catch(t){console.error("Error fetching templates:",t),i.innerHTML=`<option value="">${d("Error loading templates")}</option>`,n&&(n.textContent=`Error: ${t.message||"Failed to load templates."}`,n.className="aipkit_form-help aipkit_settings_message-error")}}window.aipkit_fetchAndPopulateTemplates=a})();(function(){"use strict";async function d(a,i,n){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let e=document.getElementById("aipkit_cw_template_status"),t=document.getElementById("aipkit_content_writer_template_nonce_field");e&&(e.textContent="Saving template...",e.className="aipkit_form-help aipkit_settings_message-info");try{let o=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:a,template_name:i,config:JSON.stringify(n),_ajax_nonce:t?t.value:""});e&&(e.textContent=o.message||"Template saved successfully.",e.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{e&&(e.textContent="",e.className="aipkit_form-help")},3e3)),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(o.template_config||n)),window.aipkit_cw_template_state.currentTemplateModified=!1;let s=document.getElementById("aipkit_cw_template_select");typeof window.aipkit_fetchAndPopulateTemplates=="function"&&s&&(await window.aipkit_fetchAndPopulateTemplates(s),o.template_id&&(s.value=o.template_id,window.aipkit_cw_template_state.currentTemplateId=o.template_id,sessionStorage.setItem("aipkit_cw_last_template_id",window.aipkit_cw_template_state.currentTemplateId))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}catch(o){console.error("Error saving template:",o),e&&(e.textContent=`Error: ${o.message||"Failed to save template."}`,e.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=d})();(function(){"use strict";function d(a){let i=document.getElementById("aipkit_cw_rename_template_btn"),n=document.getElementById("aipkit_cw_delete_template_btn"),e=document.getElementById("aipkit_cw_update_template_btn"),t=window.aipkit_dashboard||{},o=t.isAdmin||!1,s=t.currentUserId?String(t.currentUserId):"0",r=window.aipkit_cw_template_state.currentTemplates.find(_=>String(_.id)===String(a));if(!r){i&&(i.disabled=!0),n&&(n.disabled=!0),e&&(e.disabled=!0);return}let c=String(r.user_id)===s,l=c||o,p=c||o;if(i&&(i.disabled=!l),n&&(n.disabled=!p),e){let _=l&&window.aipkit_cw_template_state.currentTemplateModified;e.disabled=!_}}window.aipkit_updateTemplateActionButtonsState=d})();(function(){"use strict";function d(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let a=document.getElementById("aipkit_content_writer_form");if(!a)return;let i=window.aipkit_getContentWriterFormConfig(a),n=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(i,n),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=d})();(function(){"use strict";function d(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),alert("An error occurred. Please refresh the page.");return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};function a(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),n=i.value,e=i.options[i.selectedIndex],t=e?e.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),alert("An error occurred. Please refresh the page.");return}if(!n||n===""||window.aipkit_isDefaultTemplateSelected(e)){alert("Cannot rename the default template or no template is selected.");return}window.aipkit_showTemplateNameForm("rename",t)}window.aipkit_handleRenameContentWriterTemplate=a})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(i){return i};function a(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),n=i.value,e=i.options[i.selectedIndex],t=e?e.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),alert("Cannot delete: core function missing.");return}if(!n||n===""||window.aipkit_isDefaultTemplateSelected(e)){alert("Cannot delete the default template or no template is selected.");return}window.aipkit_showTemplateDeleteConfirm(t)}window.aipkit_handleDeleteContentWriterTemplate=a})();(function(){"use strict";function d(i,n=""){let e=document.querySelector(".aipkit_cw_template_select_group"),t=document.getElementById("aipkit_cw_template_inline_form"),o=document.getElementById("aipkit_cw_template_name_input");!e||!t||!o||(e.style.display="none",t.style.display="flex",t.dataset.mode=i,o.value=n,o.focus())}function a(){let i=document.querySelector(".aipkit_cw_template_select_group"),n=document.getElementById("aipkit_cw_template_inline_form"),e=document.getElementById("aipkit_cw_template_name_input");!i||!n||!e||(i.style.display="block",n.style.display="none",e.value="",delete n.dataset.mode)}window.aipkit_showTemplateNameForm=d,window.aipkit_hideTemplateNameForm=a})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function a(n){let e=document.querySelector(".aipkit_cw_template_select_group"),t=document.getElementById("aipkit_cw_template_inline_form"),o=document.getElementById("aipkit_cw_template_inline_delete_confirm"),s=document.getElementById("aipkit_cw_template_delete_confirm_text");!e||!t||!o||!s||(e.style.display="none",t.style.display="none",o.style.display="flex",s.innerHTML=`Delete "<strong>${d(n)}</strong>"?`)}function i(){let n=document.querySelector(".aipkit_cw_template_select_group"),e=document.getElementById("aipkit_cw_template_inline_delete_confirm");!n||!e||(n.style.display="block",e.style.display="none")}window.aipkit_showTemplateDeleteConfirm=a,window.aipkit_hideTemplateDeleteConfirm=i})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_cw_template_save_inline_btn"),i=document.getElementById("aipkit_cw_template_cancel_inline_btn"),n=document.getElementById("aipkit_cw_template_inline_form"),e=document.getElementById("aipkit_cw_template_name_input");if(!a||!i||!n||!e){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}i.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),a.addEventListener("click",async()=>{let t=n.dataset.mode,o=e.value.trim();if(!o){alert("Please enter a template name.");return}let s=document.getElementById("aipkit_content_writer_form"),r=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let c=window.aipkit_getContentWriterFormConfig(s);if(t==="new")await window.aipkit_saveContentWriterTemplate(0,o,c);else if(t==="rename"){let l=r.value;l&&await window.aipkit_saveContentWriterTemplate(parseInt(l),o,c)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_cw_template_confirm_delete_btn"),i=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!a||!i){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}i.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),a.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let n=document.getElementById("aipkit_cw_template_select"),e=n.value,t=document.getElementById("aipkit_cw_template_status"),o=document.getElementById("aipkit_content_writer_template_nonce_field");window.aipkit_cw_template_state.isSavingOrDeleting=!0,t&&(t.textContent="Deleting...",t.className="aipkit_form-help aipkit_settings_message-info");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:e,_ajax_nonce:o?o.value:""}),t&&(t.textContent="Template deleted.",t.className="aipkit_form-help aipkit_settings_message-success",setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_form-help")},3e3)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(n)}catch(s){console.error("Error deleting template:",s),t&&(t.textContent=`Error: ${s.message||"Failed to delete template."}`,t.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_cw_template_select");if(!a){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(a):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?a.addEventListener("change",i=>window.aipkit_applyContentWriterTemplate(i.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_cw_save_as_template_btn");if(!a){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_cw_update_template_btn"),i=document.getElementById("aipkit_cw_template_select"),n=document.getElementById("aipkit_content_writer_form");if(!a||!i||!n){console.warn("bindUpdateTemplateBtn: Required elements (button, select, form) not found.");return}typeof window.aipkit_saveContentWriterTemplate=="function"&&typeof window.aipkit_getContentWriterFormConfig=="function"?a.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting||!window.aipkit_cw_template_state.currentTemplateId)return;let e=i.options[i.selectedIndex],t=e?e.text:"Untitled Template",o=window.aipkit_getContentWriterFormConfig(n);await window.aipkit_saveContentWriterTemplate(parseInt(window.aipkit_cw_template_state.currentTemplateId),t,o)}):console.error("bindUpdateTemplateBtn: Missing saveContentWriterTemplate or getContentWriterFormConfig function.")}window.aipkit_bindUpdateTemplateBtn=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_cw_rename_template_btn");if(!a){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_cw_delete_template_btn");if(!a){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=d})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_content_writer_post_status");if(!a){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(a.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=d})();(function(){"use strict";function d(){let a=document.querySelector(".aipkit_content_writer_inputs");if(!a){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(a.addEventListener("input",window.aipkit_checkFormForModifications),a.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=d})();(function(){"use strict";function d(){let a=["aipkit_initTemplateSelect","aipkit_bindSaveAsTemplateBtn","aipkit_bindUpdateTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let n of a)if(typeof window[n]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${n}`);return}window.aipkit_initTemplateSelect(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindUpdateTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let i=document.getElementById("aipkit_cw_template_select");i&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(i.value):i&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_cw_save_as_post_btn");if(!n){console.warn("Save as Post Handler: Button not found.");return}n.addEventListener("click",i)}async function i(){let n=document.getElementById("aipkit_content_writer_form"),e=document.getElementById("aipkit_cw_save_as_post_btn"),t=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_save_post_status");if(!n||!e||!t||!o||!s){console.error("Save as Post: Missing required UI elements.");return}let r=t.innerHTML;if(t.textContent.trim()===""||t.textContent.trim()==="Your article will appear here..."){s&&(s.textContent="Nothing to save. Please generate content first.",s.className="aipkit_form-help aipkit_settings_message-error");return}let c=document.getElementById("aipkit_cw_generated_title_display"),l={post_title:c?c.textContent:"Untitled AI Post",post_content:r,generated_excerpt:n.elements.generated_excerpt?.value||"",generated_tags:n.elements.generated_tags?.value||"",meta_description:n.elements.meta_description?n.elements.meta_description.value:"",focus_keyword:n.elements.focus_keyword?n.elements.focus_keyword.value:"",post_type:n.elements.post_type?n.elements.post_type.value:"post",post_author:n.elements.post_author?n.elements.post_author.value:1,post_status:n.elements.post_status?n.elements.post_status.value:"draft",post_schedule_date:n.elements.post_schedule_date?n.elements.post_schedule_date.value:"",post_schedule_time:n.elements.post_schedule_time?n.elements.post_schedule_time.value:"",post_categories:n.elements["post_categories[]"]?Array.from(n.elements["post_categories[]"].selectedOptions).map(p=>p.value):[],generate_toc:n.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:n.elements.image_alignment?n.elements.image_alignment.value:"none",image_size:n.elements.image_size?n.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};s&&(s.textContent="Saving post...",s.className="aipkit_form-help aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(e,!0,"Save","Saving...");try{let p=await window.aipkit_apiRequest("aipkit_content_writer_save_post",l);s&&(s.textContent=p.message||"Post saved successfully!",s.className="aipkit_form-help aipkit_settings_message-success",p.edit_link&&(s.innerHTML+=` <a href="${d(p.edit_link)}" target="_blank">Edit Post</a>`))}catch(p){console.error("Error saving post:",p),s&&(s.textContent=`Error: ${p.message||"Failed to save post."}`,s.className="aipkit_form-help aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Save as Post"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_form-help")},5e3)}}window.aipkit_initSaveAsPostButton=a})();(function(){"use strict";function d(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let i=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),t=document.getElementById("aipkit_content_writer_copy_btn"),o=document.getElementById("aipkit_content_writer_clear_btn"),s=document.getElementById("aipkit_content_writer_provider"),r=document.getElementById("aipkit_content_writer_model"),c=document.getElementById("aipkit_content_writer_temperature"),l=document.getElementById("aipkit_content_writer_max_tokens"),p=document.getElementById("aipkit_cw_save_as_post_btn"),_=document.querySelector(".aipkit_cw_generation_status_indicators");if(!i||!n||!e||!t||!o||!s||!r||!c||!l||!p||!_){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(a):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_initAiSettingsToggle=="function"?window.aipkit_initAiSettingsToggle():console.error("Content Writer Main: aipkit_initAiSettingsToggle function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(s.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(a)}),r.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(a)}),window.aipkit_cw_toggleReasoningEffort(a)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(s,r,c,l,n,t,o):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let f=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;f&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():f&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),f&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():f&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(n,i,_,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(e,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){p&&(p.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){p&&(p.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=d})();(function(){"use strict";let d=!1,a="aipkit_image_gen_preview_theme",i=["dark","light"];function n(){let p=document.getElementById("aipkit_image_generator_container");if(!p){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(p.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(f){console.error("AIPKit Image Generator: Error calling public UI initializer:",f);let u=document.getElementById("aipkit_public_image_results");u&&(u.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let f=document.getElementById("aipkit_public_image_results");f&&(f.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}c(p),s(p),e()}function e(){let p=document.getElementById("image-settings-content");if(!p)return;typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),p.querySelectorAll(".aipkit_accordion-group").forEach(m=>{let g="data-accordion-listener-added";m.hasAttribute(g)||(m.addEventListener("click",function(k){let w=k.target.closest(".aipkit_accordion-header");if(!w)return;let h=w.nextElementSibling;!h||!h.classList.contains("aipkit_accordion-content")||(m.querySelectorAll(".aipkit_accordion-content").forEach(b=>{b!==h&&b.classList.contains("aipkit_active")&&(b.classList.remove("aipkit_active"),b.previousElementSibling?.classList.remove("aipkit_active"))}),w.classList.toggle("aipkit_active"),h.classList.toggle("aipkit_active"))}),m.setAttribute(g,"true"))});let f="data-token-listener-attached";p.hasAttribute(f)||(p.addEventListener("change",function(m){m.target.closest(".aipkit_token_limit_mode_select")&&t(p)}),p.setAttribute(f,"true"),t(p));let u=p.querySelector("#aipkit_save_image_settings_btn");u&&!u.hasAttribute("data-listener-added")&&(u.addEventListener("click",o),u.setAttribute("data-listener-added","true"))}function t(p){if(!p)return;let _=p.querySelector(".aipkit_token_limit_mode_select"),f=p.querySelector(".aipkit_token_general_user_limit_field"),u=p.querySelector(".aipkit_token_role_limits_container");if(!_||!f||!u){document.querySelector('.aipkit_accordion[data-section="token-management"]');return}let m=_.value;f.style.display=m==="general"?"block":"none",u.style.display=m==="role_based"?"block":"none"}function o(p){p.preventDefault();let _=p.currentTarget,f=document.querySelector("#image-settings-content form"),u=document.getElementById("aipkit_image_settings_save_status"),m=_.querySelector(".aipkit_spinner");if(!f||!u||d)return;d=!0,_.disabled=!0,m&&(m.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Saving..."),u.textContent="",u.className="aipkit_form-help";let g=new FormData(f),k=f.querySelector('input[name="_ajax_nonce"]');if(!k||!k.value){typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(u,"error","Security check failed (Nonce missing). Please reload."),d=!1,_.disabled=!1,m&&(m.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Save Image Settings");return}window.aipkit_apiRequest("aipkit_save_image_settings",Object.fromEntries(g.entries())).then(w=>{typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(u,"success",w.message||"Settings saved!")}).catch(w=>{typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(u,"error","Save failed: "+w.message)}).finally(()=>{d=!1,_.disabled=!1,m&&(m.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,"Save Image Settings")})}function s(p){let _=p.querySelector("#aipkit_theme_switcher_toggle_btn"),f=p.querySelector("#generator-content .aipkit_image_generator_admin_preview_wrapper");if(!_||!f){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",p);return}let u=i.indexOf(localStorage.getItem(a)||"dark");u===-1&&(u=i.indexOf("dark")),r(i[u],f,_),_.hasAttribute("data-listener-attached")||(_.addEventListener("click",function(){u=(u+1)%i.length;let m=i[u];r(m,f,_),localStorage.setItem(a,m)}),_.setAttribute("data-listener-attached","true"))}function r(p,_,f){let u=_.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");u&&(i.forEach(k=>u.classList.remove(`aipkit-theme-${k}`)),u.classList.add(`aipkit-theme-${p}`));let m=p.charAt(0).toUpperCase()+p.slice(1),g="Toggle Preview Theme";f.title=`${g} (Current: ${m})`}function c(p){let _=p.querySelector("#aipkit_image_generator_shortcode_snippet"),f=p.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),u=p.querySelector("#aipkit_image_generator_shortcode_configurator"),m=p.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!_||!f||!u||m.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",p);return}f.hasAttribute("data-listener-attached")||(f.addEventListener("click",()=>{let g=u.style.display==="none"||!u.style.display;u.style.display=g?"block":"none",f.classList.toggle("aipkit_active",g),f.setAttribute("aria-expanded",g.toString())}),m.forEach(g=>g.addEventListener("change",()=>l(p))),_.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(_.textContent,_):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),l(p),f.setAttribute("data-listener-attached","true"))}function l(p){let _=p.querySelector("#aipkit_image_generator_shortcode_snippet"),f=p.querySelector("#aipkit_image_generator_shortcode_configurator");if(!_||!f)return;let u=f.querySelector('input[name="cfg_show_provider"]').checked,m=f.querySelector('input[name="cfg_show_model"]').checked,g=f.querySelector('input[name="cfg_show_history"]').checked,k=f.querySelector('input[name="cfg_theme"]:checked'),w=k?k.value:"dark",h="[aipkit_image_generator";u||(h+=' show_provider="false"'),m||(h+=' show_model="false"'),g&&(h+=' history="true"'),w!=="dark"&&(h+=` theme="${w}"`),h+="]",_.textContent=h}window.aipkit_initImageGenerator=n})();(function(){"use strict";function d(a,i,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof i=="function"&&i(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_title,o=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof i=="function"&&i(new Error("Configuration missing (nonce)."),null,n);return}let s={_ajax_nonce:t,post_id:a};window.aipkit_apiRequest("aipkit_generate_title_suggestions",s).then(r=>{if(!r?.suggestions||r.suggestions.length===0)throw new Error(o.no_suggestions_title||"No title suggestions generated.");typeof i=="function"&&i(null,r.suggestions,n)}).catch(r=>{console.error("AIPKit Post Enhancer Fetcher (Title):",r),typeof i=="function"&&i(r,null,n)})}window.aipkit_fetchTitleSuggestions=d})();(function(){"use strict";let d=null;function a(){d&&(d.classList.remove("aipkit-active"),d.addEventListener("transitionend",()=>{d?.parentNode&&d.parentNode.removeChild(d),d=null},{once:!0}),setTimeout(()=>{d?.parentNode&&d.parentNode.removeChild(d),d=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function i(t,o,s){d&&a();let r=window.aipkit_escapeHtml||function(k){return k},c=window.aipkit_escapeAttribute||r,l=s?.default_ai_provider||"N/A",p=s?.default_ai_model||"N/A",_=s?.default_ai_params||{},f=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(o.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${r(l)}</strong>`).replace("%2$s",`<strong>${r(p)}</strong>`).replace("%3$s",r(f));d=document.createElement("div"),d.className="aipkit-modal-overlay",d.addEventListener("click",k=>{k.target===d&&a()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=t,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${r(o.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${c(o.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${r(o.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,d.appendChild(g),document.body.appendChild(d),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{d.classList.add("aipkit-active")}),d}function n(t,o){if(!d)return;let s=d.querySelector(".aipkit-modal-body");if(!s)return;let r=window.aipkit_escapeHtml||function(p){return p},c=window.aipkit_escapeAttribute||r;s.innerHTML=`
            <p>${r(o.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(p=>`<li data-new-title="${c(p)}">${r(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let l=s.querySelector(".aipkit-suggestions-list");l&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(l):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,o){if(!d)return;let s=d.querySelector(".aipkit-modal-body");if(!s)return;let r=window.aipkit_escapeHtml||function(c){return c};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${r(o.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${r(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=i,window.aipkit_updateModalWithSuggestions=n,window.aipkit_updateModalWithError=e,window.aipkit_closePostTitleModal=a})();(function(){"use strict";let d=!1;function a(){d=!1}function i(t){if(d)return;d=!0;let o=t.currentTarget,s=o.closest(".aipkit-modal-content"),r=s?.dataset.postId,c=o.dataset.newTitle,l=s?.querySelector(".aipkit-modal-status"),p=s?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!r||!c||!l||!p){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),l&&(l.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),d=!1;return}p.forEach(f=>f.classList.add("aipkit-disabled")),l.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_title||"Updating Title..."}`,l.style.color="",n(r,c,l,p,_)}function n(t,o,s,r,c){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',r.forEach(_=>_.classList.remove("aipkit-disabled")),d=!1;return}let l=window.aipkit_post_enhancer?.nonce_update_title;if(!l){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',r.forEach(_=>_.classList.remove("aipkit-disabled")),d=!1;return}let p={_ajax_nonce:l,post_id:t,new_value:o};window.aipkit_apiRequest("aipkit_update_post_title",p).then(_=>{let f=document.querySelector(`#post-${t} .row-title`);f?f.textContent=o:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${t}.`);let u=document.getElementById(`post-${t}`);if(u){let m=u.querySelector(`#inline_${t}`);if(m){let g=m.querySelector(".post_title");g?g.textContent=o:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${t}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${t}.`)}window.aipkit_closePostTitleModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Title):",_),s.innerHTML=`<span class="error">${_.message||c.error_updating_title||"Error updating title."}</span>`,r.forEach(f=>f.classList.remove("aipkit-disabled"))}).finally(()=>{d=!1})}function e(t){t&&t.addEventListener("click",function(o){let s=o.target.closest("li[data-new-title]");s&&i({currentTarget:s})})}window.aipkit_attachSuggestionClickListener=e,window.aipkit_resetTitleUpdateFlag=a})();(function(){"use strict";function d(a,i,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof i=="function"&&i(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_excerpt,o=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof i=="function"&&i(new Error("Configuration missing (nonce)."),null,n);return}let s={_ajax_nonce:t,post_id:a};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",s).then(r=>{if(!r?.suggestions||r.suggestions.length===0)throw new Error(o.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof i=="function"&&i(null,r.suggestions,n)}).catch(r=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",r),typeof i=="function"&&i(r,null,n)})}window.aipkit_fetchExcerptSuggestions=d})();(function(){"use strict";let d=null;function a(){d&&(d.classList.remove("aipkit-active"),d.addEventListener("transitionend",()=>{d?.parentNode&&d.parentNode.removeChild(d),d=null},{once:!0}),setTimeout(()=>{d?.parentNode&&d.parentNode.removeChild(d),d=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function i(t,o,s){d&&a();let r=window.aipkit_escapeHtml||function(k){return k},c=window.aipkit_escapeAttribute||r,l=s?.default_ai_provider||"N/A",p=s?.default_ai_model||"N/A",_=s?.default_ai_params||{},f=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(o.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${r(l)}</strong>`).replace("%2$s",`<strong>${r(p)}</strong>`).replace("%3$s",r(f));d=document.createElement("div"),d.className="aipkit-modal-overlay",d.addEventListener("click",k=>{k.target===d&&a()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=t,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${r(o.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${c(o.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${r(o.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,d.appendChild(g),document.body.appendChild(d),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{d.classList.add("aipkit-active")}),d}function n(t,o){if(!d)return;let s=d.querySelector(".aipkit-modal-body");if(!s)return;let r=window.aipkit_escapeHtml||function(p){return p},c=window.aipkit_escapeAttribute||r;s.innerHTML=`
            <p>${r(o.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(p=>`<li data-new-excerpt="${c(p)}">${r(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let l=s.querySelector(".aipkit-suggestions-list");l&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(l):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,o){if(!d)return;let s=d.querySelector(".aipkit-modal-body");if(!s)return;let r=window.aipkit_escapeHtml||function(c){return c};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${r(o.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${r(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=i,window.aipkit_updateModalWithExcerptSuggestions=n,window.aipkit_updateModalWithErrorExcerpt=e,window.aipkit_closePostExcerptModal=a})();(function(){"use strict";let d=!1;function a(){d=!1}function i(t){if(d)return;d=!0;let o=t.currentTarget,s=o.closest(".aipkit-modal-content"),r=s?.dataset.postId,c=o.dataset.newExcerpt,l=s?.querySelector(".aipkit-modal-status"),p=s?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!r||c===void 0||!l||!p){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:r,newExcerpt:c,statusDiv:l,listItems:p}),l&&(l.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),d=!1;return}p.forEach(f=>f.classList.add("aipkit-disabled")),l.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_excerpt||"Updating Excerpt..."}`,l.style.color="",n(r,c,l,p,_)}function n(t,o,s,r,c){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',r.forEach(_=>_.classList.remove("aipkit-disabled")),d=!1;return}let l=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!l){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',r.forEach(_=>_.classList.remove("aipkit-disabled")),d=!1;return}let p={_ajax_nonce:l,post_id:t,new_value:o};window.aipkit_apiRequest("aipkit_update_post_excerpt",p).then(_=>{window.aipkit_closePostExcerptModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",_),s.innerHTML=`<span class="error">${_.message||c.error_updating_excerpt||"Error updating excerpt."}</span>`,r.forEach(f=>f.classList.remove("aipkit-disabled"))}).finally(()=>{d=!1})}function e(t){t&&t.addEventListener("click",function(o){let s=o.target.closest("li[data-new-excerpt]");s&&i({currentTarget:s})})}window.aipkit_attachExcerptSuggestionClickListener=e,window.aipkit_resetExcerptUpdateFlag=a})();(function(){"use strict";function d(a,i,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof i=="function"&&i(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_meta,o=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof i=="function"&&i(new Error("Configuration missing (nonce)."),null,n);return}let s={_ajax_nonce:t,post_id:a};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",s).then(r=>{if(!r?.suggestions||r.suggestions.length===0)throw new Error(o.no_suggestions_meta||"No meta description suggestions generated.");typeof i=="function"&&i(null,r.suggestions,n)}).catch(r=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",r),typeof i=="function"&&i(r,null,n)})}window.aipkit_fetchMetaSuggestions=d})();(function(){"use strict";let d=null;function a(){d&&(d.classList.remove("aipkit-active"),d.addEventListener("transitionend",()=>{d?.parentNode&&d.parentNode.removeChild(d),d=null},{once:!0}),setTimeout(()=>{d?.parentNode&&d.parentNode.removeChild(d),d=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function i(t,o,s){d&&a();let r=window.aipkit_escapeHtml||function(k){return k},c=window.aipkit_escapeAttribute||r,l=s?.default_ai_provider||"N/A",p=s?.default_ai_model||"N/A",_=s?.default_ai_params||{},f=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(o.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${r(l)}</strong>`).replace("%2$s",`<strong>${r(p)}</strong>`).replace("%3$s",r(f));d=document.createElement("div"),d.className="aipkit-modal-overlay",d.addEventListener("click",k=>{k.target===d&&a()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=t,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${r(o.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${c(o.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${r(o.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,d.appendChild(g),document.body.appendChild(d),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{d.classList.add("aipkit-active")}),d}function n(t,o){if(!d)return;let s=d.querySelector(".aipkit-modal-body");if(!s)return;let r=window.aipkit_escapeHtml||function(p){return p},c=window.aipkit_escapeAttribute||r;s.innerHTML=`
            <p>${r(o.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(p=>`<li data-new-meta="${c(p)}">${r(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let l=s.querySelector(".aipkit-suggestions-list");l&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(l):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,o){if(!d)return;let s=d.querySelector(".aipkit-modal-body");if(!s)return;let r=window.aipkit_escapeHtml||function(c){return c};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${r(o.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${r(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=i,window.aipkit_updateModalWithMetaSuggestions=n,window.aipkit_updateModalWithErrorMeta=e,window.aipkit_closePostMetaModal=a})();(function(){"use strict";let d=!1;function a(){d=!1}function i(t){if(d)return;d=!0;let o=t.currentTarget,s=o.closest(".aipkit-modal-content"),r=s?.dataset.postId,c=o.dataset.newMeta,l=s?.querySelector(".aipkit-modal-status"),p=s?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!r||c===void 0||!l||!p){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:r,newMetaDesc:c,statusDiv:l,listItems:p}),l&&(l.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),d=!1;return}p.forEach(f=>f.classList.add("aipkit-disabled")),l.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_meta||"Updating Meta Desc..."}`,l.style.color="",n(r,c,l,p,_)}function n(t,o,s,r,c){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',r.forEach(_=>_.classList.remove("aipkit-disabled")),d=!1;return}let l=window.aipkit_post_enhancer?.nonce_update_meta;if(!l){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',r.forEach(_=>_.classList.remove("aipkit-disabled")),d=!1;return}let p={_ajax_nonce:l,post_id:t,new_value:o};window.aipkit_apiRequest("aipkit_update_post_meta_desc",p).then(_=>{try{let m=`${`#post-${t}`} .column-wpseo-metadesc`,g=document.querySelector(m);g&&(g.textContent=window.aipkit_escapeHtml(o),g.style.transition="background-color 0.1s ease-out",g.style.backgroundColor="#f0f7ff",setTimeout(()=>{g.style.backgroundColor=""},300))}catch(f){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",f)}window.aipkit_closePostMetaModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Meta):",_),s.innerHTML=`<span class="error">${_.message||c.error_updating_meta||"Error updating meta description."}</span>`,r.forEach(f=>f.classList.remove("aipkit-disabled"))}).finally(()=>{d=!1})}function e(t){t&&t.addEventListener("click",function(o){let s=o.target.closest("li[data-new-meta]");s&&i({currentTarget:s})})}window.aipkit_attachMetaSuggestionClickListener=e,window.aipkit_resetMetaUpdateFlag=a})();(function(){"use strict";function d(a,i,n){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof i=="function"&&i(new Error("API function missing."),null,n);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_tags,o=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof i=="function"&&i(new Error("Configuration missing (nonce)."),null,n);return}let s={_ajax_nonce:t,post_id:a};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",s).then(r=>{if(!r?.suggestions||r.suggestions.length===0)throw new Error(o.no_suggestions_tags||"No tag suggestions generated.");typeof i=="function"&&i(null,r.suggestions,n)}).catch(r=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",r),typeof i=="function"&&i(r,null,n)})}window.aipkit_fetchTagsSuggestions=d})();(function(){"use strict";let d=null;function a(){d&&(d.classList.remove("aipkit-active"),d.addEventListener("transitionend",()=>{d?.parentNode&&d.parentNode.removeChild(d),d=null},{once:!0}),setTimeout(()=>{d?.parentNode&&d.parentNode.removeChild(d),d=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function i(t,o,s){d&&a();let r=window.aipkit_escapeHtml||(k=>k),c=window.aipkit_escapeAttribute||r,l=s?.default_ai_provider||"N/A",p=s?.default_ai_model||"N/A",_=s?.default_ai_params||{},f=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",m=(o.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${r(l)}</strong>`).replace("%2$s",`<strong>${r(p)}</strong>`).replace("%3$s",r(f));d=document.createElement("div"),d.className="aipkit-modal-overlay",d.addEventListener("click",k=>{k.target===d&&a()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=t,g.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${r(o.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${c(o.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${r(o.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${m}</p>
            </div>
        </div>
    `,d.appendChild(g),document.body.appendChild(d),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>d.classList.add("aipkit-active")),d}function n(t,o){if(!d)return;let s=d.querySelector(".aipkit-modal-body");if(!s)return;let r=window.aipkit_escapeHtml||(p=>p),c=window.aipkit_escapeAttribute||r;s.innerHTML=`
        <p>${r(o.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${t.map(p=>`<li data-new-tags="${c(p)}">${r(p)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let l=s.querySelector(".aipkit-suggestions-list");l&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(l):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function e(t,o){if(!d)return;let s=d.querySelector(".aipkit-modal-body");if(!s)return;let r=window.aipkit_escapeHtml||(c=>c);s.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${r(o.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${r(t)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=i,window.aipkit_updateModalWithTagsSuggestions=n,window.aipkit_updateModalWithErrorTags=e,window.aipkit_closePostTagsModal=a})();(function(){"use strict";let d=!1;function a(){d=!1}function i(t){if(d)return;d=!0;let o=t.currentTarget,s=o.closest(".aipkit-modal-content"),r=s?.dataset.postId,c=o.dataset.newTags,l=s?.querySelector(".aipkit-modal-status"),p=s?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!r||c===void 0||!l||!p){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:r,newTags:c,statusDiv:l,listItems:p}),l&&(l.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),d=!1;return}p.forEach(f=>f.classList.add("aipkit-disabled")),l.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_tags||"Updating Tags..."}`,l.style.color="",n(r,c,l,p,_)}function n(t,o,s,r,c){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',r.forEach(_=>_.classList.remove("aipkit-disabled")),d=!1;return}let l=window.aipkit_post_enhancer?.nonce_update_tags;if(!l){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',r.forEach(_=>_.classList.remove("aipkit-disabled")),d=!1;return}let p={_ajax_nonce:l,post_id:t,new_value:o};window.aipkit_apiRequest("aipkit_update_post_tags",p).then(_=>{let f=document.getElementById(`post-${t}`);if(f){let u=f.querySelector(".column-tags");u&&(u.textContent=o.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Tags):",_),s.innerHTML=`<span class="error">${_.message||c.error_updating_tags||"Error updating tags."}</span>`,r.forEach(f=>f.classList.remove("aipkit-disabled"))}).finally(()=>{d=!1})}function e(t){t&&t.addEventListener("click",function(o){let s=o.target.closest("li[data-new-tags]");s&&i({currentTarget:s})})}window.aipkit_attachTagsSuggestionClickListener=e,window.aipkit_resetTagsUpdateFlag=a})();(function(){"use strict";function d(a,i,n){let t=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorTags(a.message||t.error_loading_tags,t):i?window.aipkit_updateModalWithTagsSuggestions(i,t):window.aipkit_updateModalWithErrorTags(t.error_loading_tags||"Unknown error occurred.",t)}window.aipkit_handleTagsSuggestionsResult=d})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function d(r,c=60){return r.length<=c?r:r.substring(0,c-3)+"..."}function a(r,c="info"){let l=document.getElementById("aipkit-enhancer-bulk-status-log");if(l){let p=document.createElement("div");p.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${c}`,p.textContent=r,l.appendChild(p),l.scrollTop=l.scrollHeight}}function i(){let r=document.getElementById("aipkit-enhancer-bulk-progress-bar"),c=document.getElementById("aipkit-enhancer-progress-text"),l=document.getElementById("aipkit-enhancer-progress-stats");if(r&&window.aipkit_enhancer_bulkState.total>0){let p=window.aipkit_enhancer_bulkState.completed,_=window.aipkit_enhancer_bulkState.failed,f=window.aipkit_enhancer_bulkState.total,u=p+_,m=Math.round(u/f*100);r.style.width=`${m}%`,c&&(u===f?c.textContent="Update complete!":c.textContent=`Processing ${u+1} of ${f}...`),l&&(_>0?l.innerHTML=`${m}% \u2022 <span style="color: #28a745;">${p} successful</span> \u2022 <span style="color: #dc3545;">${_} failed</span>`:l.textContent=`${m}%`)}}function n(r){let c=document.getElementById("aipkit-enhancer-bulk-status-log");if(!c)return;let p=(window.aipkit_enhancer_postTitles||{})[r]||`Post #${r}`;p=d(p,60);let _=document.createElement("div");_.className="aipkit_enhancer_post_steps",_.id=`aipkit_enhancer_post_${r}_steps`;let f=document.createElement("div");f.className="aipkit_enhancer_post_header",f.innerHTML=`<strong>${p}</strong>`;let u=document.createElement("div");u.className="aipkit_enhancer_steps_container",u.id=`aipkit_enhancer_steps_${r}`,_.appendChild(f),_.appendChild(u),c.appendChild(_),c.scrollTop=c.scrollHeight;let m=[],g=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(k=>{g[k]&&g[k].prompt&&m.push({field:k,display_name:k.charAt(0).toUpperCase()+k.slice(1).replace("_"," ")})}),g.generate_seo_slug==="1"&&m.push({field:"slug",display_name:"URL"}),m.forEach(k=>{let w=document.createElement("div");w.className="aipkit_enhancer_step aipkit_enhancer_step--pending",w.id=`aipkit_enhancer_step_${r}_${k.field}`,w.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${k.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,u.appendChild(w)})}function e(r,c,l,p=""){let _=document.getElementById(`aipkit_enhancer_step_${r}_${c}`);if(!_)return;_.className=`aipkit_enhancer_step aipkit_enhancer_step--${l}`;let f="\u23F3",u="Pending";switch(l){case"processing":f="\u{1F504}",u="Processing...";break;case"completed":f="\u2705",u="Completed";break;case"error":f="\u274C",u="Failed";break;case"pending":f="\u23F3",u="Pending";break}_.querySelector(".aipkit_enhancer_step_icon").textContent=f,_.querySelector(".aipkit_enhancer_step_status").textContent=u,p&&(_.title=p);let m=document.getElementById("aipkit-enhancer-bulk-status-log");m&&(m.scrollTop=m.scrollHeight)}function t(r,c,l){let p=document.getElementById(`aipkit_enhancer_steps_${r}`);if(!p||l.length===0)return;let _=c.length+l.length,f=document.createElement("div");f.className="aipkit_enhancer_completion_message",c.length===0?f.innerHTML=`<strong style="color: #dc3545;">\u274C All ${_} enhancement steps failed!</strong>`:f.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${c.length} of ${_} steps. ${l.length} failed.</strong>`,p.appendChild(f);let u=document.getElementById("aipkit-enhancer-bulk-status-log");u&&(u.scrollTop=u.scrollHeight)}function o(r,c){let l=document.getElementById(`aipkit_enhancer_steps_${r}`);if(!l)return;c.forEach(u=>{let m=document.getElementById(`aipkit_enhancer_step_${r}_${u.field}`);if(m){m.className=`aipkit_enhancer_step aipkit_enhancer_step--${u.status}`;let g="\u23F3";switch(u.status){case"completed":g="\u2705";break;case"error":g="\u274C";break;case"processing":g="\u{1F504}";break;case"pending":g="\u23F3";break}m.querySelector(".aipkit_enhancer_step_icon").textContent=g,m.querySelector(".aipkit_enhancer_step_status").textContent=u.status.charAt(0).toUpperCase()+u.status.slice(1),u.message&&(m.title=u.message)}});let p=c.filter(u=>u.status==="completed").length,_=c.length;if(p!==_){let u=document.createElement("div");u.className="aipkit_enhancer_completion_message";let m=c.filter(g=>g.status==="error").length;u.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${p} of ${_} steps. ${m} failed.</strong>`,l.appendChild(u)}let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}function s(r,c){let l=document.getElementById(`aipkit_enhancer_steps_${r}`);if(!l)return;l.querySelectorAll(".aipkit_enhancer_step").forEach(u=>{u.classList.contains("aipkit_enhancer_step--completed")||(u.className="aipkit_enhancer_step aipkit_enhancer_step--error",u.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",u.querySelector(".aipkit_enhancer_step_status").textContent="Failed",u.title=c)});let _=document.createElement("div");_.className="aipkit_enhancer_completion_message",_.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${c}</strong>`,l.appendChild(_);let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}window.aipkit_enhancer_logToModal=a,window.aipkit_enhancer_updateProgressBar=i,window.aipkit_enhancer_initStepProgress=n,window.aipkit_enhancer_updateFieldStatus=e,window.aipkit_enhancer_showPostCompletion=t,window.aipkit_enhancer_displayStepResults=o,window.aipkit_enhancer_showStepError=s,window.aipkit_enhancer_truncateTitle=d})();(function(){"use strict";function d(i="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let n=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!n)return;i==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let e=n.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");e&&(e.textContent="Start"),n.querySelector("#aipkit_bulk_enhancer_start_btn").disabled=!1,n.querySelector("#aipkit_bulk_enhancer_stop_btn").style.display="none",n.querySelector("#aipkit_bulk_enhancer_cancel_btn").style.display="inline-flex",n.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").style.display="inline-flex"}function a(){let i=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!i)return;window.aipkit_enhancer_bulkState.isRunning&&d("user"),i.querySelector("#aipkit-enhancer-bulk-config").style.display="block",i.querySelector("#aipkit-enhancer-bulk-progress").style.display="none",i.querySelector("#aipkit_bulk_enhancer_start_btn").disabled=!1,i.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text").textContent="Start",i.querySelector("#aipkit_bulk_enhancer_stop_btn").style.display="none",i.querySelector("#aipkit_bulk_enhancer_cancel_btn").style.display="inline-flex",i.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").style.display="none";let n=i.querySelector("#aipkit-enhancer-bulk-status-log");n&&(n.innerHTML="");let e=i.querySelector("#aipkit-enhancer-bulk-progress-bar");e&&(e.style.width="0%");let t=i.querySelector("#aipkit-enhancer-progress-text");t&&(t.textContent="Processing posts...");let o=i.querySelector("#aipkit-enhancer-progress-stats");o&&(o.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=d,window.aipkit_enhancer_returnToSettings=a})();(function(){"use strict";function d(i){let n=i.querySelector("#aipkit_bulk_ai_provider"),e=i.querySelector("#aipkit_bulk_ai_model"),t=i.querySelector(".aipkit_enhancer_reasoning_effort_field");if(!n||!e||!t){t&&(t.style.display="none");return}let o=n.value,r=(e.value||"").toLowerCase(),c=r.startsWith("o1")||r.startsWith("o3")||r.startsWith("o4"),l=r.includes("gpt-5");o==="openai"&&(c||l)?t.style.display="block":t.style.display="none"}function a(i,n){let e=i.value.toLowerCase(),o=(window.aipkit_dashboard?.models||{})[e]||[],s=window.aipkit_escapeHtml||(c=>c);if(n.innerHTML="",e==="openai"&&typeof o=="object"&&!Array.isArray(o)?Object.keys(o).forEach(c=>{let l=document.createElement("optgroup");l.label=s(c),Array.isArray(o[c])&&o[c].forEach(p=>{p&&p.id&&l.appendChild(new Option(s(p.name||p.id),p.id))}),n.appendChild(l)}):Array.isArray(o)&&o.forEach(c=>{c&&c.id&&n.appendChild(new Option(s(c.name||c.id),c.id))}),n.options.length===0)n.appendChild(new Option(s(`No models for ${i.value}`),"")),n.disabled=!0;else{n.disabled=!1;let c;switch(e){case"openai":c="gpt-4o-mini";break;case"google":c="gemini-1.5-flash-latest";break;case"openrouter":c="anthropic/claude-3.5-sonnet";break;default:c=null;break}c&&n.querySelector(`option[value="${CSS.escape(c)}"]`)?n.value=c:n.selectedIndex=0}let r=i.closest(".aipkit-enhancer-bulk-modal-overlay");r&&d(r)}window.aipkit_enhancer_populateBulkModels=a,window.aipkit_enhancer_toggleReasoningEffort=d})();(function(){"use strict";async function d(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let n=window.aipkit_enhancer_bulkState.queue.shift();await a(n),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(d,200)}async function a(n){try{typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(n);let e=window.aipkit_post_enhancer?.nonce_generate_title;if(!e)throw new Error("Security nonce not found.");let t=window.aipkit_enhancer_bulkState.enhancementsConfig,o=["keyword","title","excerpt","content","meta","tags"],s=[];o.forEach(l=>{t[l]&&t[l].prompt&&s.push(l)});let r=[],c=[];for(let l of s){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,l,"processing");let p={_ajax_nonce:e,post_id:n,field:l,enhancements:JSON.stringify({[l]:t[l],ai_provider:t.ai_provider,ai_model:t.ai_model,temperature:t.temperature,max_tokens:t.max_tokens,reasoning_effort:t.reasoning_effort,enable_vector_store:t.enable_vector_store,vector_store_provider:t.vector_store_provider,vector_store_top_k:t.vector_store_top_k,openai_vector_store_ids:t.openai_vector_store_ids,pinecone_index_name:t.pinecone_index_name,qdrant_collection_name:t.qdrant_collection_name,vector_embedding_provider:t.vector_embedding_provider,vector_embedding_model:t.vector_embedding_model})},_=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",p,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,l,"completed",_.message),r.push(l)}catch(p){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,l,"error",p.message||"Processing failed"),c.push(l),console.error(`Failed to process field ${l} for post ${n}:`,p)}}if(t.generate_seo_slug==="1"&&r.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,"slug","processing");let l={_ajax_nonce:e,post_id:n,action_type:"update_slug"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",l,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(n,r,c),r.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let p=(window.aipkit_enhancer_postTitles||{})[n]||`Post #${n}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(p=window.aipkit_enhancer_truncateTitle(p,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${p}". No fields were processed successfully.`,"error")}}catch(e){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(n,e.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let o=(window.aipkit_enhancer_postTitles||{})[n]||`Post #${n}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(o=window.aipkit_enhancer_truncateTitle(o,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${o}": ${e.message||"Unknown error"}`,"error")}}}function i(n){let e=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!e)return;let t={},o=e.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(o.length===0){alert("Please select at least one field to enhance.");return}o.forEach(u=>{let m=u.value,g=e.querySelector(`#aipkit_bulk_prompt_${m}`);g&&(t[m]={prompt:g.value})});let s=e.querySelector("#aipkit_bulk_ai_provider").value,r=e.querySelector("#aipkit_bulk_ai_model").value,c=e.querySelector("#aipkit_bulk_ai_temperature").value,l=e.querySelector("#aipkit_bulk_content_max_tokens").value,p=e.querySelector("#aipkit_bulk_reasoning_effort").value;if(!s||!r){alert("Please select an AI Provider and Model.");return}t.ai_provider=s,t.ai_model=r,t.temperature=c,t.max_tokens=l,t.reasoning_effort=p;let _=e.querySelector("#aipkit_bulk_generate_seo_slug");_&&(t.generate_seo_slug=_.checked?"1":"0");let f=e.querySelector('input[name="enable_vector_store"]');if(f&&f.checked){if(t.enable_vector_store="1",t.vector_store_provider=e.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",t.vector_store_top_k=e.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,t.vector_store_provider==="openai"){let u=e.querySelector("#aipkit_bulk_openai_vector_store_ids");u&&(t.openai_vector_store_ids=Array.from(u.selectedOptions).map(m=>m.value))}else t.vector_store_provider==="pinecone"?t.pinecone_index_name=e.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":t.vector_store_provider==="qdrant"&&(t.qdrant_collection_name=e.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(t.vector_store_provider==="pinecone"||t.vector_store_provider==="qdrant")&&(t.vector_embedding_provider=e.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",t.vector_embedding_model=e.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else t.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...n],isRunning:!0,completed:0,failed:0,total:n.length,enhancementsConfig:t},e.querySelector("#aipkit-enhancer-bulk-config").style.display="none",e.querySelector("#aipkit-enhancer-bulk-progress").style.display="block",e.querySelector("#aipkit_bulk_enhancer_start_btn").disabled=!0,e.querySelector("#aipkit_bulk_enhancer_stop_btn").style.display="inline-flex",e.querySelector("#aipkit_bulk_enhancer_cancel_btn").style.display="none",e.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").style.display="none",typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),d()}window.aipkit_enhancer_startBulkProcess=i})();(function(){"use strict";let d={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,modalElement:null},a="aipkit_bulk_enhancer_selected_template",i=window.aipkit_escapeHtml||function(u){return u};function n(u){try{u&&String(u)!==""?localStorage.setItem(a,String(u)):localStorage.removeItem(a)}catch(m){console.warn("Failed to save template to localStorage:",m)}}function e(){try{return localStorage.getItem(a)}catch(u){return console.warn("Failed to load template from localStorage:",u),null}}function t(){let u=d.modalElement;if(!u)return{};let m={};["title","excerpt","content","meta","keyword","tags"].forEach(w=>{let h=u.querySelector(`#aipkit_bulk_enhance_${w}`),b=u.querySelector(`#aipkit_bulk_prompt_${w}`);h&&b&&(m[w]={enabled:h.checked?"1":"0",prompt:b.value})}),m.ai_provider=u.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",m.ai_model=u.querySelector("#aipkit_bulk_ai_model")?.value||"",m.ai_temperature=u.querySelector("#aipkit_bulk_ai_temperature")?.value,m.content_max_tokens=u.querySelector("#aipkit_bulk_content_max_tokens")?.value,m.reasoning_effort=u.querySelector("#aipkit_bulk_reasoning_effort")?.value||"low",m.generate_seo_slug=u.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let k=u.querySelector('input[name="enable_vector_store"]');if(k&&k.checked){if(m.enable_vector_store="1",m.vector_store_provider=u.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",m.vector_store_top_k=u.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",m.vector_store_provider==="openai"){let w=u.querySelector("#aipkit_bulk_openai_vector_store_ids");w&&(m.openai_vector_store_ids=Array.from(w.selectedOptions).map(h=>h.value))}else m.vector_store_provider==="pinecone"?m.pinecone_index_name=u.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":m.vector_store_provider==="qdrant"&&(m.qdrant_collection_name=u.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(m.vector_store_provider==="pinecone"||m.vector_store_provider==="qdrant")&&(m.vector_embedding_provider=u.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",m.vector_embedding_model=u.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else m.enable_vector_store="0";return m}function o(u){d.currentTemplateId=u,n(u);let m=d.templates.find(M=>String(M.id)===String(u)),g=m?JSON.parse(JSON.stringify(m.config)):{};d.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(g));let k=d.modalElement;if(!k)return;let w=k.querySelector("#aipkit_bulk_ai_provider"),h=k.querySelector("#aipkit_bulk_ai_model"),b=k.querySelector("#aipkit_bulk_ai_temperature"),y=k.querySelector("#aipkit_bulk_ai_temperature_value"),S=k.querySelector("#aipkit_bulk_content_max_tokens"),I=k.querySelector("#aipkit_bulk_content_max_tokens_value"),x=k.querySelector("#aipkit_bulk_reasoning_effort");w&&(w.value=g.ai_provider||"openai"),h&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(window.aipkit_enhancer_populateBulkModels(w,h),g.ai_model&&setTimeout(()=>{h.querySelector(`option[value="${CSS.escape(g.ai_model)}"]`)&&(h.value=g.ai_model,h.dispatchEvent(new Event("change")))},150)),b&&(b.value=g.ai_temperature||"1.0"),y&&(y.textContent=g.ai_temperature||"1.0"),S&&(S.value=g.content_max_tokens||"4000"),I&&(I.textContent=g.content_max_tokens||"4000"),x&&(x.value=g.reasoning_effort||"low"),["title","excerpt","content","meta","keyword","tags"].forEach(M=>{let T=k.querySelector(`#aipkit_bulk_enhance_${M}`),P=k.querySelector(`#aipkit_bulk_prompt_${M}`);if(T&&P){let C=g[M]?.enabled==="1";T.checked!==C&&(T.checked=C,T.dispatchEvent(new Event("change"))),P.value=g[M]?.prompt||P.defaultValue}});let q=k.querySelector("#aipkit_bulk_generate_seo_slug");q&&(q.checked=g.generate_seo_slug==="1");let $=k.querySelector('input[name="enable_vector_store"]');if($&&($.checked=g.enable_vector_store==="1",$.dispatchEvent(new Event("change"))),g.enable_vector_store==="1"){let M=k.querySelector("#aipkit_bulk_vector_store_provider");M&&(M.value=g.vector_store_provider||"openai",M.dispatchEvent(new Event("change",{bubbles:!0})));let T=k.querySelector("#aipkit_bulk_vector_store_top_k");T&&(T.value=g.vector_store_top_k||"3"),setTimeout(()=>{if(g.vector_store_provider==="openai"){let P=k.querySelector("#aipkit_bulk_openai_vector_store_ids");P&&Array.isArray(g.openai_vector_store_ids)&&Array.from(P.options).forEach(C=>{C.selected=g.openai_vector_store_ids.includes(C.value)})}else if(g.vector_store_provider==="pinecone"){let P=k.querySelector("#aipkit_bulk_pinecone_index_name");P&&(P.value=g.pinecone_index_name||"")}else if(g.vector_store_provider==="qdrant"){let P=k.querySelector("#aipkit_bulk_qdrant_collection_name");P&&(P.value=g.qdrant_collection_name||"")}if(g.vector_store_provider==="pinecone"||g.vector_store_provider==="qdrant"){let P=k.querySelector("#aipkit_bulk_vector_embedding_provider"),C=k.querySelector("#aipkit_bulk_vector_embedding_model");P&&(P.value=g.vector_embedding_provider||"openai",P.dispatchEvent(new Event("change"))),C&&g.vector_embedding_model&&setTimeout(()=>{C.value=g.vector_embedding_model},150)}},100)}d.currentTemplateModified=!1,r()}function s(){let u=t();d.currentTemplateModified=!window.aipkit_deepEqual(u,d.initialConfigForSelectedTemplate),r()}function r(){let u=d.modalElement;if(!u)return;let m=u.querySelector("#aipkit_enhancer_template_select").value,g=m&&String(m)!=="";u.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!g,u.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!g,u.querySelector("#aipkit_enhancer_update_template_btn").disabled=!g||!d.currentTemplateModified}function c(u,m="info"){let g=d.modalElement?.querySelector("#aipkit_enhancer_template_status");g&&(g.textContent=u,g.className=`aipkit_form-help aipkit_settings_message-${m}`,setTimeout(()=>{g.textContent="",g.className="aipkit_form-help"},4e3))}async function l(){let u=d.modalElement.querySelector("#aipkit_enhancer_template_select");u.innerHTML='<option value="">Loading...</option>',u.disabled=!0;try{let m=window.aipkit_post_enhancer?.nonce_manage_templates;if(!m)throw new Error("Security nonce for templates not found.");let g=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:m});d.templates=g.templates||[],u.innerHTML='<option value="">-- Select Template --</option>',d.templates.forEach(w=>{u.appendChild(new Option(i(w.template_name),w.id))}),u.disabled=!1;let k=e();k&&(d.templates.some(h=>String(h.id)===String(k))?(u.value=k,o(k)):n(null))}catch(m){c("Error loading templates: "+m.message,"error")}}async function p(u,m){if(!d.isSavingOrDeleting){d.isSavingOrDeleting=!0,c("Saving template...","info");try{let g=t(),k=window.aipkit_post_enhancer?.nonce_manage_templates;if(!k)throw new Error("Security nonce for templates not found.");let w=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:u,template_name:m,config:JSON.stringify(g),template_type:"enhancer",_ajax_nonce:k});c(w.message,"success"),await l(),d.modalElement.querySelector("#aipkit_enhancer_template_select").value=w.template_id,d.currentTemplateId=w.template_id,n(w.template_id),d.currentTemplateModified=!1,r()}catch(g){c("Error saving: "+g.message,"error")}finally{d.isSavingOrDeleting=!1}}}async function _(){let u=d.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!u||d.isSavingOrDeleting)&&confirm("Are you sure you want to delete this enhancer template?")){d.isSavingOrDeleting=!0,c("Deleting...","info");try{let m=window.aipkit_post_enhancer?.nonce_manage_templates;if(!m)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:u,_ajax_nonce:m}),c("Template deleted.","success"),await l(),d.currentTemplateId=null;let g=e();g&&String(g)===String(u)&&n(null),r()}catch(m){c("Error deleting: "+m.message,"error")}finally{d.isSavingOrDeleting=!1}}}function f(u){d.modalElement=u;let m=u.querySelector("#aipkit_enhancer_template_select");m.addEventListener("change",g=>o(g.target.value)),u.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{let g=prompt("Enter a name for the new template:");g&&p(0,g)}),u.querySelector("#aipkit_enhancer_update_template_btn").addEventListener("click",()=>{let g=m.options[m.selectedIndex];d.currentTemplateId&&g&&p(d.currentTemplateId,g.text)}),u.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let g=m.options[m.selectedIndex];if(d.currentTemplateId&&g){let k=prompt("Enter new name:",g.text);k&&p(d.currentTemplateId,k)}}),u.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",_),l(),u.addEventListener("input",s),u.addEventListener("change",s)}window.aipkit_enhancer_initTemplateControls=f})();(function(){"use strict";function d(a){let{postCount:i,providerOptions:n,defaultPrompts:e,postType:t}=a,o="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}.";t==="product"&&(o+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),o=o.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let s="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}.";return t==="product"&&(s+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),s=s.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div class="aipkit-modal-content aipkit-enhancer-bulk-modal-content" style="min-height: auto;min-width:700px;">
          <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">Content Assistant</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="Close">\xD7</button>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <p>You have selected <strong>${i}</strong> items to enhance.</p>
              
              <div class="aipkit_accordion-group">
                <!-- Accordion 1: Template -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header aipkit_active">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Template
                    </div>
                    <div class="aipkit_accordion-content aipkit_active">
                        <div class="aipkit_cw_template_controls">
                          <div class="aipkit_form-group aipkit_cw_template_select_group">
                              <label class="aipkit_form-label" for="aipkit_enhancer_template_select">Template</label>
                              <div class="aipkit_cw_template_inline_controls">
                                  <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_form-input" style="max-width: inherit;">
                                      <option value="">-- Select Template --</option>
                                  </select>
                                  <div class="aipkit_cw_template_action_buttons">
                                      <button type="button" id="aipkit_enhancer_update_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_icon_btn" title="Update Current Template" disabled>
                                          <span class="dashicons dashicons-saved"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Create New Template">
                                          <span class="dashicons dashicons-plus"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Rename Selected Template" disabled>
                                          <span class="dashicons dashicons-edit"></span>
                                      </button>
                                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_icon_btn" title="Delete Selected Template" disabled>
                                          <span class="dashicons dashicons-trash"></span>
                                      </button>
                                  </div>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                              <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                              <div class="aipkit_cw_template_inline_form_actions">
                                  <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                                  <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                              <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                              <div class="aipkit_cw_template_inline_form_actions">
                                  <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                                  <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                              </div>
                          </div>
                          <div id="aipkit_enhancer_template_status" class="aipkit_form-help"></div>
                      </div>
                    </div>
                </div>

                <!-- Accordion 2: AI Settings -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> AI
                    </div>
                    <div class="aipkit_accordion-content">
                       <div class="aipkit_form-row">
                            <div class="aipkit_form-group aipkit_form-col">
                                <label class="aipkit_form-label" for="aipkit_bulk_ai_provider">Provider</label>
                                <select id="aipkit_bulk_ai_provider" class="aipkit_form-input">${n}</select>
                            </div>
                            <div class="aipkit_form-group aipkit_form-col">
                                 <label class="aipkit_form-label" for="aipkit_bulk_ai_model">Model</label>
                                 <div class="aipkit_input-with-button">
                                     <select id="aipkit_bulk_ai_model" class="aipkit_form-input"><option value="">-- Select Provider --</option></select>
                                     <button type="button" id="aipkit_bulk_enhancer_ai_settings_toggle" class="aipkit_btn aipkit_btn-secondary aipkit_icon_btn" title="Toggle Advanced AI Parameters">
                                        <span class="dashicons dashicons-admin-generic"></span>
                                     </button>
                                 </div>
                            </div>
                       </div>
                       <div id="aipkit_bulk_enhancer_ai_parameters_row" style="display: none;">
                            <div class="aipkit_form-row">
                                <div class="aipkit_form-group aipkit_form-col">
                                    <label class="aipkit_form-label" for="aipkit_bulk_ai_temperature">Temperature</label>
                                    <div class="aipkit_slider_wrapper">
                                        <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_form-input aipkit_range_slider" min="0" max="2" step="0.1" value="1.0">
                                        <span id="aipkit_bulk_ai_temperature_value" class="aipkit_slider_value">1.0</span>
                                    </div>
                                </div>
                                <div class="aipkit_form-group aipkit_form-col">
                                    <label class="aipkit_form-label" for="aipkit_bulk_content_max_tokens">Max Tokens</label>
                                    <div class="aipkit_slider_wrapper">
                                        <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_form-input aipkit_range_slider" min="100" max="128000" step="100" value="4000">
                                        <span id="aipkit_bulk_content_max_tokens_value" class="aipkit_slider_value">4000</span>
                                    </div>
                                </div>
                                <div class="aipkit_form-group aipkit_form-col aipkit_enhancer_reasoning_effort_field" style="display: none;">
                                    <label class="aipkit_form-label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                                    <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_form-input">
                                        <option value="minimal">Minimal</option>
                                        <option value="low" selected>Low (Default)</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>
                       </div>
                    </div>
                </div>

                <!-- Accordion 3: Context -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Context
                    </div>
                    <div class="aipkit_accordion-content">
                      <div class="aipkit_form-group">
                          <label class="aipkit_form-label aipkit_checkbox-label">
                              <input type="checkbox" name="enable_vector_store" value="1">
                              Use Context
                          </label>
                          <p class="aipkit_form-help" style="margin-left: 23px; margin-top: -5px;">Allow the AI to use your knowledge base for more accurate enhancements.</p>
                      </div>
                      <div class="aipkit_cw_vector_store_settings_container" style="display:none; margin-top: 15px; padding-left: 23px;">
                          
                          <div class="aipkit_form-row">
                              <div class="aipkit_form-group aipkit_form-col">
                                  <label class="aipkit_form-label" for="aipkit_bulk_vector_store_provider">Vector Provider</label>
                                  <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_form-input">
                                      <option value="openai" selected>OpenAI</option>
                                      <option value="pinecone">Pinecone</option>
                                      <option value="qdrant">Qdrant</option>
                                  </select>
                              </div>
                              <div class="aipkit_form-col">
                                  <div class="aipkit_form-group aipkit_cw_vector_openai_field">
                                      <label class="aipkit_form-label" for="aipkit_bulk_openai_vector_store_ids">Stores</label>
                                      <select id="aipkit_bulk_openai_vector_store_ids" name="openai_vector_store_ids[]" class="aipkit_form-input" multiple size="3" style="height: auto;"></select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_cw_vector_pinecone_field" style="display:none;">
                                      <label class="aipkit_form-label" for="aipkit_bulk_pinecone_index_name">Index</label>
                                      <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_form-input"></select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_cw_vector_qdrant_field" style="display:none;">
                                      <label class="aipkit_form-label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                                      <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_form-input"></select>
                                  </div>
                              </div>
                              <div class="aipkit_form-group aipkit_form-col">
                                  <label class="aipkit_form-label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                                  <input type="number" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_form-input" value="3" min="1" max="20" step="1">
                              </div>
                          </div>

                          <div class="aipkit_cw_vector_embedding_config_row" style="display: none;">
                              <div class="aipkit_form-row">
                                  <div class="aipkit_form-group aipkit_form-col">
                                      <label class="aipkit_form-label" for="aipkit_bulk_vector_embedding_provider">Embedding Provider</label>
                                      <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_form-input">
                                          <option value="openai" selected>OpenAI</option>
                                          <option value="google">Google</option>
                                      </select>
                                  </div>
                                  <div class="aipkit_form-group aipkit_form-col">
                                      <label class="aipkit_form-label" for="aipkit_bulk_vector_embedding_model">Embedding Model</label>
                                      <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_form-input"></select>
                                  </div>
                              </div>
                          </div>
                      </div>
                    </div>
                </div>
                
                <!-- NEW: SEO Accordion -->
                 <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> SEO
                    </div>
                    <div class="aipkit_accordion-content">
                        <div class="aipkit_form-group">
                            <label class="aipkit_form-label aipkit_checkbox-label">
                                <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1">
                                Optimize URL
                            </label>
                            <p class="aipkit_form-help" style="margin-left: 23px; margin-top: -5px;">Generate a new, SEO-friendly post slug based on the focus keyword or title.</p>
                        </div>
                    </div>
                </div>

                <!-- Accordion 4: Fields & Prompts -->
                <div class="aipkit_accordion">
                    <div class="aipkit_accordion-header">
                        <span class="dashicons dashicons-arrow-right-alt2"></span> Prompts
                    </div>
                    <div class="aipkit_accordion-content">
                      <div class="aipkit_form-group">
                          <label class="aipkit_form-label">Fields to Enhance</label>
                          <div class="aipkit_checkbox-group">
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_title">
                                  <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title"> Title
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_excerpt">
                                  <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt"> Excerpt
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_content">
                                  <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content"> Content
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_tags">
                                  <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags"> Tags
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_meta">
                                  <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta"> Meta Description
                              </label>
                              <label class="aipkit_checkbox-label" for="aipkit_bulk_enhance_keyword">
                                  <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword"> Focus Keyword
                              </label>
                          </div>
                      </div>
                      <div class="aipkit_tabs aipkit_enhancer_prompt_tabs">
                        <div class="aipkit_tab" data-tab="prompt-title" style="display: none;">Title</div>
                        <div class="aipkit_tab" data-tab="prompt-excerpt" style="display: none;">Excerpt</div>
                        <div class="aipkit_tab" data-tab="prompt-content" style="display: none;">Content</div>
                        <div class="aipkit_tab" data-tab="prompt-tags" style="display: none;">Tags</div>
                        <div class="aipkit_tab" data-tab="prompt-meta" style="display: none;">Meta</div>
                        <div class="aipkit_tab" data-tab="prompt-keyword" style="display: none;">Keyword</div>
                      </div>
                      <div class="aipkit_tab_content_container">
                        <div class="aipkit_tab-content" data-pane="prompt-title">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_title" class="aipkit_form-input" rows="6">${e.title}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-excerpt">
                             <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_form-input" rows="6">${e.excerpt}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-content">
                             <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_content" class="aipkit_form-input" rows="6">${e.content}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-tags">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_tags" class="aipkit_form-input" rows="6">${e.tags}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-meta">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_meta" class="aipkit_form-input" rows="6">${e.meta}</textarea>
                                <p class="aipkit_form-help">${s}</p>
                            </div>
                        </div>
                        <div class="aipkit_tab-content" data-pane="prompt-keyword">
                            <div class="aipkit_form-group">
                                <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_form-input" rows="6">${e.keyword}</textarea>
                                <p class="aipkit_form-help">${o}</p>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>

            <!-- Progress Display -->
            <div id="aipkit-enhancer-bulk-progress" style="display: none;">
                <div class="aipkit_enhancer_progress_header">
                    <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                    <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
                </div>
                <div class="aipkit_progress_bar_container">
                    <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled" style="width: 0%;"></div>
                </div>
                <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <button type="button" id="aipkit_bulk_enhancer_cancel_btn" class="aipkit_btn aipkit_btn-secondary">Close</button>
            <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-secondary" style="display:none;">
                <span class="dashicons dashicons-arrow-left-alt2" style="margin-right: 5px;"></span>Back to Settings
            </button>
            <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" style="display:none;">Stop</button>
            <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-primary">
                <span class="aipkit_btn-text">Start</span>
                <span class="aipkit_spinner" style="display:none;"></span>
            </button>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=d})();(function(){"use strict";function d(a,i){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let n={};a.forEach(l=>{let p=document.querySelector(`tr#post-${l}`);if(p){let _=p.querySelector(".row-title")||p.querySelector("strong a")||p.querySelector(".title a")||p.querySelector("a.row-title")||p.querySelector(".column-title strong a")||p.querySelector(".column-title .row-title");_&&(n[l]=_.textContent.trim())}n[l]||(n[l]=`Post #${l}`)}),window.aipkit_enhancer_postTitles=n;let e=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},t=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],o={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",deepseek:"DeepSeek"},s=t.map(l=>`<option value="${l.toLowerCase()}">${o[l.toLowerCase()]||l.toUpperCase()}</option>`).join(""),r=window.aipkit_enhancer_getBulkModalHtml({postCount:a.length,providerOptions:s,defaultPrompts:e,postType:i});document.body.insertAdjacentHTML("beforeend",r);let c=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(c,a):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available."),requestAnimationFrame(()=>{c.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||(o=>o);function a(o,s){let r=window.aipkit_post_enhancer||{},c,l,p,_,f;o==="openai"?(c=s.querySelector("#aipkit_bulk_openai_vector_store_ids"),l=r.openai_vector_stores||[],p="id",_="name",f="No OpenAI stores found."):o==="pinecone"?(c=s.querySelector("#aipkit_bulk_pinecone_index_name"),l=r.pinecone_indexes||[],p="name",_="name",f="No Pinecone indexes found."):o==="qdrant"&&(c=s.querySelector("#aipkit_bulk_qdrant_collection_name"),l=r.qdrant_collections||[],p="name",_="name",f="No Qdrant collections found."),c&&(c.innerHTML="",l.length>0?c.multiple?l.forEach(u=>{c.add(new Option(d(u[_]),u[p]))}):(c.add(new Option("-- Select --","")),l.forEach(u=>{c.add(new Option(d(u[_]),u[p]))})):(c.add(new Option(f,"")),c.disabled=!0))}function i(o,s){let r=s.querySelector("#aipkit_bulk_vector_embedding_model");if(!r)return;let c=window.aipkit_post_enhancer||{},l=o==="google"?c.googleEmbeddingModels||[]:c.openaiEmbeddingModels||[];r.innerHTML="",l.length>0?(r.add(new Option("-- Select Model --","")),l.forEach(p=>{r.add(new Option(d(p.name||p.id),p.id))}),r.disabled=!1):(r.add(new Option("No models found","")),r.disabled=!0)}function n(o){let s=o.querySelector("#aipkit_bulk_vector_store_provider").value,r=o.querySelector(".aipkit_cw_vector_openai_field"),c=o.querySelector(".aipkit_cw_vector_pinecone_field"),l=o.querySelector(".aipkit_cw_vector_qdrant_field"),p=o.querySelector(".aipkit_cw_vector_embedding_config_row");r&&(r.style.display="none"),c&&(c.style.display="none"),l&&(l.style.display="none"),p&&(p.style.display="none"),s==="openai"?(r&&(r.style.display="block"),a("openai",o)):s==="pinecone"?(c&&(c.style.display="block"),p&&(p.style.display="block"),a("pinecone",o),i("openai",o)):s==="qdrant"&&(l&&(l.style.display="block"),p&&(p.style.display="block"),a("qdrant",o),i("openai",o))}function e(o){let s=o.querySelector('input[name="enable_vector_store"]'),r=o.querySelector(".aipkit_cw_vector_store_settings_container"),c=o.querySelector("#aipkit_bulk_vector_store_provider"),l=o.querySelector("#aipkit_bulk_vector_embedding_provider");!s||!r||!c||(s.addEventListener("change",()=>{r.style.display=s.checked?"block":"none"}),c.addEventListener("change",()=>n(o)),l&&l.addEventListener("change",p=>i(p.target.value,o)),r.style.display=s.checked?"block":"none",n(o))}function t(o,s){if(!o)return;function r(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),o&&(o.classList.remove("aipkit-active"),o.addEventListener("transitionend",()=>o.remove(),{once:!0}),setTimeout(()=>o?.remove(),500))}o.querySelector(".aipkit-modal-close-btn").addEventListener("click",r),o.querySelector("#aipkit_bulk_enhancer_cancel_btn").addEventListener("click",r);let c=o.querySelector(".aipkit-modal-body");c&&c.addEventListener("click",y=>{let S=y.target.closest(".aipkit_accordion-header");if(!S)return;y.preventDefault();let I=S.closest(".aipkit_accordion");if(!I)return;let x=S.nextElementSibling;if(!x||!x.classList.contains("aipkit_accordion-content"))return;let q=I.closest(".aipkit_accordion-group");if(q&&!S.classList.contains("aipkit_active")){let $=q.querySelector(".aipkit_accordion-header.aipkit_active");if($){$.classList.remove("aipkit_active");let M=$.nextElementSibling;M&&M.classList.remove("aipkit_active")}}S.classList.toggle("aipkit_active"),x.classList.toggle("aipkit_active")});let l=o.querySelector("#aipkit_bulk_ai_provider"),p=o.querySelector("#aipkit_bulk_ai_model"),_=o.querySelector("#aipkit_bulk_ai_temperature"),f=o.querySelector("#aipkit_bulk_ai_temperature_value"),u=o.querySelector("#aipkit_bulk_content_max_tokens"),m=o.querySelector("#aipkit_bulk_content_max_tokens_value"),g=o.querySelector("#aipkit_bulk_enhancer_ai_settings_toggle"),k=o.querySelector("#aipkit_bulk_enhancer_ai_parameters_row");g&&k&&g.addEventListener("click",()=>{let y=k.style.display==="none";k.style.display=y?"block":"none",g.classList.toggle("aipkit_active",y)}),l&&p&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(l.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(l,p)),window.aipkit_enhancer_populateBulkModels(l,p)),p&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&p.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(o)),_&&f&&_.addEventListener("input",()=>f.textContent=_.value),u&&m&&u.addEventListener("input",()=>m.textContent=u.value),typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(o);let w=o.querySelector(".aipkit_enhancer_prompt_tabs"),h=o.querySelector(".aipkit_tab_content_container"),b=o.querySelectorAll('input[name="bulk_enhance_fields"]');w&&h&&w.addEventListener("click",y=>{let S=y.target.closest(".aipkit_tab");if(!S||S.classList.contains("aipkit_active"))return;let I=S.dataset.tab;w.querySelectorAll(".aipkit_tab").forEach(q=>q.classList.remove("aipkit_active")),h.querySelectorAll(".aipkit_tab-content").forEach(q=>q.classList.remove("aipkit_active")),S.classList.add("aipkit_active");let x=h.querySelector(`[data-pane="${I}"]`);x&&x.classList.add("aipkit_active")}),b.forEach(y=>{let S=y.value,I=w?.querySelector(`[data-tab="prompt-${S}"]`);I&&(I.style.display=y.checked?"flex":"none"),y.addEventListener("change",()=>{I&&(I.style.display=y.checked?"flex":"none");let x=w.querySelector(".aipkit_tab.aipkit_active");if(x&&x.style.display==="none"){let q=w.querySelector('.aipkit_tab:not([style*="display: none"])');if(q)q.click();else{let $=h.querySelector(".aipkit_tab-content.aipkit_active");$&&$.classList.remove("aipkit_active")}}else if(!w.querySelector('.aipkit_tab.aipkit_active:not([style*="display: none"])')){let q=w.querySelector('.aipkit_tab:not([style*="display: none"])');q&&q.click()}})}),o.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(s)}),o.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),o.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),e(o)}window.aipkit_enhancer_attachBulkModalListeners=t})();(function(){"use strict"})();(function(){"use strict";function d(a,i,n){let t=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithError(a.message||t.error_loading_title,t):i?window.aipkit_updateModalWithSuggestions(i,t):window.aipkit_updateModalWithError(t.error_loading_title||"Unknown error occurred.",t)}window.aipkit_handleTitleSuggestionsResult=d})();(function(){"use strict";function d(a,i,n){let t=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorExcerpt(a.message||t.error_loading_excerpt,t):i?window.aipkit_updateModalWithExcerptSuggestions(i,t):window.aipkit_updateModalWithErrorExcerpt(t.error_loading_excerpt||"Unknown error occurred.",t)}window.aipkit_handleExcerptSuggestionsResult=d})();(function(){"use strict";function d(a,i,n){let t=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorMeta(a.message||t.error_loading_meta,t):i?window.aipkit_updateModalWithMetaSuggestions(i,t):window.aipkit_updateModalWithErrorMeta(t.error_loading_meta||"Unknown error occurred.",t)}window.aipkit_handleMetaSuggestionsResult=d})();(function(){"use strict";function d(){}function a(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=a})();(function(){"use strict";function d(i){let n=i.target.closest(".aipkit_enhancer_item"),e=i.target.closest("#aipkit_bulk_enhance_btn");if(n){if(n.classList.contains("aipkit_enhancer_placeholder")){i.target.tagName==="A"&&i.preventDefault();return}i.preventDefault();let t=n.getAttribute("data-post-id"),o=n.getAttribute("data-action-type");if(!t||!o)return;let s=window.aipkit_post_enhancer||{},r=s.text||{};switch(o){case"title":window.aipkit_showLoadingModal(t,r,s),window.aipkit_fetchTitleSuggestions(t,window.aipkit_handleTitleSuggestionsResult,n);break;case"excerpt":window.aipkit_showLoadingExcerptModal(t,r,s),window.aipkit_fetchExcerptSuggestions(t,window.aipkit_handleExcerptSuggestionsResult,n);break;case"meta":window.aipkit_showLoadingMetaModal(t,r,s),window.aipkit_fetchMetaSuggestions(t,window.aipkit_handleMetaSuggestionsResult,n);break;case"tags":window.aipkit_showLoadingTagsModal(t,r,s),window.aipkit_fetchTagsSuggestions(t,window.aipkit_handleTagsSuggestionsResult,n);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${o}'.`);break}}else if(e){i.preventDefault();let t=document.querySelectorAll('input[name="post[]"]:checked');if(t.length===0){alert("Please select at least one post.");return}let o=Array.from(t).map(r=>r.value),s=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(o,s):alert("Error: Bulk processing feature is not available.")}}function a(){let i=document;if(!i)return;let n="data-post-enhancer-listener";document.body.getAttribute(n)||(i.addEventListener("click",d),document.body.setAttribute(n,"true"))}window.aipkit_initEnhancerEventListeners=a})();(function(){"use strict";function d(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(i=>typeof window[i]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d):d(),window.aipkit_initPostEnhancer=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_vpp_embedding_provider_select");if(!n){console.error("VPP Embedding Util: Embedding provider select not found.");return}i(n.value)}function i(n){let e=document.getElementById("aipkit_vpp_embedding_model_select");if(!e){console.error("VPP Embedding Util: Embedding model select not found.");return}let t=window.aipkit_vpp_config||{},o=t.text||{};e.innerHTML=`<option value="">${d(o.select_model||"-- Select Model --")}</option>`;let s=[];n==="openai"&&t.openaiEmbeddingModels?s=t.openaiEmbeddingModels:n==="google"&&t.googleEmbeddingModels&&(s=t.googleEmbeddingModels),s.length>0?(s.forEach(r=>{r&&r.id&&e.appendChild(new Option(d(r.name||r.id),r.id))}),e.disabled=!1,e.options.length>1&&(e.selectedIndex=1)):(e.appendChild(new Option(d(`(No ${n} models - Sync in AI Settings)`),"")),e.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=a,window.aipkit_vpp_populateEmbeddingModelSelect=i})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_vpp_openai_vector_store_id"),e=document.getElementById("aipkit_vpp_openai_store_status"),t=window.aipkit_vpp_config||{},o=t.text||{},s=t.openai_vector_stores||[];if(!n||!e){console.error("VPP OpenAI Provider: Store select or status div not found.");return}n.innerHTML="",e.textContent="",s.length>0?(n.appendChild(new Option(`-- ${d(o.select_store||"Select Existing Store")} --`,"")),s.forEach(r=>{let c="(Files: N/A)";r.file_counts&&typeof r.file_counts.total=="number"?c=`(${r.file_counts.total} ${r.file_counts.total===1?"File":"Files"})`:r.file_counts&&(c="(Files: ?)");let l=`${d(r.name||r.id)} ${c}`,p=new Option(l,r.id);n.appendChild(p)})):n.appendChild(new Option(d(o.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),n.disabled=s.length===0}async function i(n,e,t,o){let s=window.aipkit_vpp_config||{},r=s.text||{},c=n.length,l=0,p=0,_=0,f=[];try{let u=s.nonce_index_posts;if(!u)throw new Error("Nonce for indexing posts is missing in config.");for(let g of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}l++;let k=document.querySelector(`#post-${g}`),w=k?k.querySelector(".title .row-title"):null,h=w?w.textContent.trim():`Post #${g}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let y=l/c*100,S=(r.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",l).replace("%2$d",c)+` "${d(h)}"`;window.aipkit_vpp_updateProgress(y,S)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let b={_ajax_nonce:u,post_ids:[g],post_type:o,target_store_id:e,new_store_name_openai:t||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",b),p++}catch(y){_++,f.push({id:g,title:h,error:y.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${g}:`,y)}}let m=`Indexing complete. ${p} successful, ${_} failed.`;window.aipkit_isIndexingStopped&&l<c?m=`Indexing stopped. ${p} successful, ${_} failed.`:_>0&&(m+=" See browser console for details on failed posts.",console.error("Failed Posts:",f)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,_>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${p}/${c}`)}catch(u){console.error("VPP OpenAI Provider: Indexing setup error:",u),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,r.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(u.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),_>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=a,window.aipkit_vpp_startIndexingOpenAI=i})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_vpp_pinecone_target_index_select"),e=document.getElementById("aipkit_vpp_pinecone_index_status"),t=window.aipkit_vpp_config||{},o=t.text||{},s=t.pinecone_indexes||[];if(!n||!e){console.error("VPP Pinecone Provider: Index select or status div not found.");return}n.innerHTML="",e.textContent="",s.length>0?(n.appendChild(new Option(`-- ${d(o.select_pinecone_index||"Select Pinecone Index")} --`,"")),s.forEach(r=>{let c=r.name||r.id;if(c){let l=`${d(c)} (${r.dimension||"?"})`;n.appendChild(new Option(l,c))}})):n.appendChild(new Option(d(o.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),n.disabled=s.length===0}async function i(n,e,t,o,s){let r=window.aipkit_vpp_config||{},c=r.text||{},l=n.length,p=0,_=0,f=0,u=[];try{let m=r.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let k of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}p++;let w=document.querySelector(`#post-${k}`),h=w?w.querySelector(".title .row-title"):null,b=h?h.textContent.trim():`Post #${k}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let S=p/l*100,I=(c.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",p).replace("%2$d",l)+` "${d(b)}"`;window.aipkit_vpp_updateProgress(S,I)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let y={_ajax_nonce:m,post_ids:[k],post_type:s,target_index_id:e,provider:"pinecone",embedding_provider:t,embedding_model:o};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",y),_++}catch(S){f++,u.push({id:k,title:b,error:S.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${k}:`,S)}}let g=`Indexing complete. ${_} successful, ${f} failed.`;window.aipkit_isIndexingStopped&&p<l?g=`Indexing stopped. ${_} successful, ${f} failed.`:f>0&&(g+=" See browser console for details on failed posts.",console.error("Failed Posts:",u)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,f>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${_}/${l}`)}catch(m){console.error("VPP Pinecone Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,c.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),f>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=a,window.aipkit_vpp_startIndexingPinecone=i})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(n){return n};function a(){let n=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),e=document.getElementById("aipkit_vpp_qdrant_collection_status"),t=window.aipkit_vpp_config||{},o=t.text||{},s=t.qdrant_collections||[];if(!n||!e){console.error("VPP Qdrant Provider: Collection select or status div not found.");return}n.innerHTML="",e.textContent="",s.length>0?(n.appendChild(new Option(`-- ${d(o.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),s.forEach(r=>{let c=r.name||r.id;c&&n.appendChild(new Option(d(c),c))})):n.appendChild(new Option(d(o.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),n.disabled=s.length===0}async function i(n,e,t,o,s){let r=window.aipkit_vpp_config||{},c=r.text||{},l=n.length,p=0,_=0,f=0,u=[];try{let m=r.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let k of n){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}p++;let w=document.querySelector(`#post-${k}`),h=w?w.querySelector(".title .row-title"):null,b=h?h.textContent.trim():`Post #${k}`;if(typeof window.aipkit_vpp_updateProgress=="function"){let S=p/l*100,I=(c.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",p).replace("%2$d",l)+` "${d(b)}"`;window.aipkit_vpp_updateProgress(S,I)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let y={_ajax_nonce:m,post_ids:[k],post_type:s,target_collection_name:e,provider:"qdrant",embedding_provider:t,embedding_model:o};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",y),_++}catch(S){f++,u.push({id:k,title:b,error:S.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${k}:`,S)}}let g=`Indexing complete. ${_} successful, ${f} failed.`;window.aipkit_isIndexingStopped&&p<l?g=`Indexing stopped. ${_} successful, ${f} failed.`:f>0&&(g+=" See browser console for details on failed posts.",console.error("Failed Posts:",u)),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,f>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${_}/${l}`)}catch(m){console.error("VPP Qdrant Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,c.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),f>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=a,window.aipkit_vpp_startIndexingQdrant=i})();(function(){"use strict";let d="aipkit_vpp_modal",a=[],i="",n=!1;function e(_,f){if(document.getElementById(d)){console.warn("VPP Modal UI: Modal already exists.");return}a=_,i=f,n=!1;let u=window.aipkit_vpp_config||{},m=u.text||{},g=window.aipkit_escapeHtml||function(x){return x},k=window.aipkit_escapeAttribute||g,w="",h=_.length;h===1?w=(m.items_selected_singular||"You have selected %d item to index.").replace("%d",h):w=(m.items_selected_plural||"You have selected %d items to index.").replace("%d",h);let b=document.createElement("div");b.id=d,b.className="aipkit-modal-overlay aipkit-active";let y=document.createElement("div");y.className="aipkit-modal-content aipkit_vpp_modal_content",y.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${g(m.modal_title||"Index")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${k(m.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <p>${g(w)}</p>

                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="aipkit_vpp_vector_store_provider">${g(m.provider_label||"Provider")}</label>
                    <select id="aipkit_vpp_vector_store_provider" class="aipkit_form-input">
                        <option value="openai" selected>OpenAI</option>
                        <option value="pinecone">Pinecone</option>
                        <option value="qdrant">Qdrant</option>
                    </select>
                </div>

                <div id="aipkit_vpp_openai_options" style="display: block;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_openai_vector_store_id">${g(m.select_store||"Select OpenAI Store")}</label>
                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_form-input">
                            <option value="">${g(m.loading_stores||"Loading stores...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_openai_store_status"></div>
                    </div>
                </div>

                <div id="aipkit_vpp_pinecone_options" style="display: none;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_pinecone_target_index_select">${g(m.select_pinecone_index||"Select Pinecone Index")}</label>
                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_form-input">
                            <option value="">${g(m.loading_indexes||"Loading indexes...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_pinecone_index_status"></div>
                    </div>
                </div>
                
                <div id="aipkit_vpp_qdrant_options" style="display: none;">
                    <div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="aipkit_vpp_qdrant_target_collection_select">${g(m.select_qdrant_collection||"Select Qdrant Collection")}</label>
                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_form-input">
                            <option value="">${g(m.loading_indexes||"Loading collections...")}</option>
                        </select>
                        <div class="aipkit_form-help" id="aipkit_vpp_qdrant_collection_status"></div>
                    </div>
                </div>

                <div id="aipkit_vpp_embedding_config_options" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #eee;">
                     <div class="aipkit_form-row" style="gap: 10px;">
                        <div class="aipkit_form-group aipkit_form-col">
                            <label class="aipkit_form-label" for="aipkit_vpp_embedding_provider_select">${g(m.embedding_provider_label||"Embedding Provider")}</label>
                            <select id="aipkit_vpp_embedding_provider_select" class="aipkit_form-input">
                                <option value="openai" selected>OpenAI</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="aipkit_form-group aipkit_form-col">
                            <label class="aipkit_form-label" for="aipkit_vpp_embedding_model_select">${g(m.embedding_model_label||"Embedding Model")}</label>
                            <select id="aipkit_vpp_embedding_model_select" class="aipkit_form-input">
                                <option value="">${g(m.select_model||"-- Select Model --")}</option>
                            </select>
                        </div>
                    </div>
                     <div class="aipkit_form-help">${g(u.text.ensure_api_key_for_embedding||"Ensure API key is set for the selected embedding provider in AI Settings.")}</div>
                </div>

                <div id="aipkit_vpp_progress_area" style="margin-top: 15px; display: none;">
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <p id="aipkit_vpp_progress_text" class="aipkit_form-help" style="text-align: center; margin-top: 5px;"></p>
                </div>
                <div id="aipkit_vpp_status_message" class="aipkit_form-help" style="margin-top: 10px; min-height: 1.5em;"></div>
            </div>
            <div class="aipkit-modal-footer" style="display: flex; justify-content: flex-end; align-items: center; gap: 8px; padding: 10px 15px; border-top: 1px solid var(--aipkit_container-border);">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_vpp_modal_close_btn">${g(m.close||"Close")}</button>
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${g(m.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" style="display:none;"></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" style="display:none;">
                     <span class="aipkit_btn-text">${g(m.stop||"Stop")}</span>
                </button>
            </div>
        `,b.appendChild(y),document.body.appendChild(b),y.addEventListener("click",x=>{let q=x.target;q.closest(".aipkit-modal-close-btn")||q.closest(".aipkit_vpp_modal_close_btn")?o():q.closest("#aipkit_vpp_start_indexing_btn")?p():q.closest("#aipkit_vpp_stop_indexing_btn")&&t()}),b.addEventListener("click",x=>{x.target===b&&o()});let S=document.getElementById("aipkit_vpp_vector_store_provider");S&&(S.addEventListener("change",l),l({target:S}));let I=document.getElementById("aipkit_vpp_embedding_provider_select");I&&typeof window.aipkit_vpp_populateEmbeddingModelSelect=="function"&&I.addEventListener("change",()=>window.aipkit_vpp_populateEmbeddingModelSelect(I.value))}function t(){window.aipkit_isIndexingStopped=!0;let _=document.getElementById("aipkit_vpp_stop_indexing_btn"),f=window.aipkit_vpp_config?.text||{};if(_){_.disabled=!0;let u=_.querySelector(".aipkit_btn-text");u&&(u.textContent=f.stopping||"Stopping...")}}function o(){window.aipkit_isIndexingStopped=!0;let _=document.getElementById(d);_&&(_.classList.remove("aipkit-active"),setTimeout(()=>{_.parentNode&&_.parentNode.removeChild(_)},300))}function s(_,f){let u=document.querySelector(`#${d} .aipkit_vpp_progress_bar`),m=document.getElementById("aipkit_vpp_progress_text");u&&(u.style.width=`${Math.max(0,Math.min(100,_))}%`),m&&(m.textContent=f)}function r(_,f="info"){let u=document.getElementById("aipkit_vpp_status_message");u&&(u.textContent=_,u.className=`aipkit_form-help aipkit_message-${f}`)}function c(){n=!1;let _=document.getElementById("aipkit_vpp_start_indexing_btn"),f=document.getElementById("aipkit_vpp_stop_indexing_btn"),u=document.querySelectorAll(`#${d} .aipkit-modal-close-btn, #${d} .aipkit_vpp_modal_close_btn`),m=window.aipkit_vpp_config?.text||{};if(_){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(_,m.start_indexing||"Start Indexing"),_.disabled=!1,_.style.display="inline-flex";let g=_.querySelector(".aipkit_spinner");g&&(g.style.display="none")}if(f){f.style.display="none",f.disabled=!1;let g=f.querySelector(".aipkit_btn-text");g&&(g.textContent=m.stop||"Stop")}u.forEach(g=>g.disabled=!1)}function l(_){let f=_.target.value,u=document.getElementById("aipkit_vpp_openai_options"),m=document.getElementById("aipkit_vpp_pinecone_options"),g=document.getElementById("aipkit_vpp_qdrant_options"),k=document.getElementById("aipkit_vpp_embedding_config_options");u&&(u.style.display="none"),m&&(m.style.display="none"),g&&(g.style.display="none"),k&&(k.style.display="none"),f==="openai"?(u&&(u.style.display="block"),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):f==="pinecone"?(m&&(m.style.display="block"),k&&(k.style.display="block"),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):f==="qdrant"&&(g&&(g.style.display="block"),k&&(k.style.display="block"),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function p(){if(n)return;window.aipkit_isIndexingStopped=!1;let _=document.getElementById("aipkit_vpp_vector_store_provider").value,f=window.aipkit_vpp_config?.text||{},u="",m={post_ids:a,post_type:i,provider:_};if(_==="openai"){if(u=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!u){r(f.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}m.target_store_id=u}else if(_==="pinecone"){if(u=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!u){r(f.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}if(m.target_index_id=u,m.embedding_provider=document.getElementById("aipkit_vpp_embedding_provider_select").value,m.embedding_model=document.getElementById("aipkit_vpp_embedding_model_select").value,!m.embedding_provider||!m.embedding_model){r(f.error_no_embedding_config||"Please select embedding provider and model for Pinecone.","error");return}}else if(_==="qdrant"){if(u=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!u){r(f.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}if(m.target_collection_name=u,m.embedding_provider=document.getElementById("aipkit_vpp_embedding_provider_select").value,m.embedding_model=document.getElementById("aipkit_vpp_embedding_model_select").value,!m.embedding_provider||!m.embedding_model){r(f.error_no_embedding_config||"Please select embedding provider and model for Qdrant.","error");return}}else{r(`Provider ${_} not yet supported for indexing.`,"error");return}n=!0;let g=document.getElementById("aipkit_vpp_start_indexing_btn"),k=document.getElementById("aipkit_vpp_stop_indexing_btn"),w=document.querySelectorAll(`#${d} .aipkit-modal-close-btn, #${d} .aipkit_vpp_modal_close_btn`);if(g&&(g.style.display="none"),k){k.style.display="inline-flex",k.disabled=!1;let h=k.querySelector(".aipkit_btn-text");h&&(h.textContent=f.stop||"Stop")}document.getElementById("aipkit_vpp_progress_area").style.display="block",s(0,f.status_preparing||"Preparing..."),_==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(a,u,null,i):_==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(a,u,m.embedding_provider,m.embedding_model,i):_==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(a,u,m.embedding_provider,m.embedding_model,i)}window.aipkit_vpp_showModal=e,window.aipkit_vpp_closeModal=o,window.aipkit_vpp_updateProgress=s,window.aipkit_vpp_updateStatus=r,window.aipkit_vpp_resetModalAfterProcessing=c})();(function(){"use strict";let d="aipkit_add_to_vector_store_btn";function a(){let n=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(n.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let e=Array.from(n).map(t=>t.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(e,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function i(){let n=document.getElementById(d);n&&n.addEventListener("click",a)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",i):i()})();(function(){"use strict";function d(n,e,t="Processing..."){let o=document.querySelector(`#aipkit_migration_row_${n}`);if(!o)return;let s=o.querySelector(".aipkit_spinner"),r=o.querySelector(".aipkit_status-tag"),c=o.querySelectorAll("button");e?(r&&(r.textContent=t,r.className="aipkit_status-tag"),s&&(s.style.display="inline-block"),c.forEach(l=>l.disabled=!0)):s&&(s.style.display="none")}function a(n,e,t){let o=document.querySelector(`#aipkit_migration_row_${n}`);if(!o)return;let s=o.querySelector(".aipkit_spinner"),r=o.querySelector(".aipkit_status-tag"),c=o.querySelectorAll("button");s&&(s.style.display="none"),r&&(r.textContent=e,r.className=`aipkit_status-tag ${t}`),c.forEach(l=>l.disabled=!0)}function i(n,e="info"){let t=document.getElementById("aipkit_migration_messages_area");if(!t)return;let o=e==="success"?"notice-success":e==="error"?"notice-error":"notice-info";t.innerHTML=`<div class="notice ${o} is-dismissible" style="margin: 0 0 15px 0;"><p>${n}</p></div>`}window.aipkitMigrationUI={setCategoryLoadingState:d,updateCategoryStatus:a,showGlobalMessage:i}})();(function(){"use strict";async function d(n){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest("aipkit_analyze_old_data",{_ajax_nonce:n})}async function a(n,e,t){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest(e,{_ajax_nonce:t,category:n})}async function i(n,e,t){if(typeof window.aipkit_apiRequest!="function")throw new Error("AIPKit API request function is not available.");return window.aipkit_apiRequest(e,{_ajax_nonce:t,category:n})}window.aipkitMigrationAjax={executeAnalysisStep:d,executeMigrationStep:a,executeDeleteStep:i}})();(function(){"use strict";function d(){let a=window.aipkitMigrationToolData;if(!a||!a.steps){console.error("AIPKit Migration Tool: Localized data or steps not found.");return}let i=window.aipkitMigrationUI,n=window.aipkitMigrationAjax;if(!i||!n){console.error("AIPKit Migration Tool: UI or AJAX helper modules not found.");return}let e=document.getElementById("aipkit_analyze_data_btn");e&&e.addEventListener("click",async()=>{let r=e.querySelector(".aipkit_btn-text"),c=e.querySelector(".aipkit_spinner");e.disabled=!0,r&&(r.textContent=a.text.analyzing),c&&(c.style.display="inline-block");try{await n.executeAnalysisStep(a.nonce),i.showGlobalMessage("Analysis complete. Reloading page...","success"),setTimeout(()=>window.location.reload(),1500)}catch(l){i.showGlobalMessage(`Analysis failed: ${l.message}`,"error"),e.disabled=!1,r&&(r.textContent="Analyze Legacy Data"),c&&(c.style.display="none")}});let t=document.getElementById("aipkit_analyze_again_btn");t&&t.addEventListener("click",async()=>{let r=t.querySelector(".aipkit_btn-text"),c=t.querySelector(".aipkit_spinner");t.disabled=!0,r&&(r.textContent=a.text.analyzing),c&&(c.style.display="inline-block");try{await n.executeAnalysisStep(a.nonce),i.showGlobalMessage("Re-analysis complete. Reloading page...","success"),setTimeout(()=>window.location.reload(),1500)}catch(l){i.showGlobalMessage(`Analysis failed: ${l.message}`,"error"),t.disabled=!1,r&&(r.textContent=a.text.analyzeAgain||"Analyze Again"),c&&(c.style.display="none")}});let o=document.getElementById("aipkit_migrate_start_fresh_btn");o&&o.addEventListener("click",()=>{if(confirm(a.text.confirmStartFresh)){if(typeof window.aipkit_apiRequest!="function")return;window.aipkit_apiRequest("aipkit_handle_migration_choice",{_ajax_nonce:a.nonce,choice:"start_fresh"}).then(()=>{i.showGlobalMessage("Choice saved. Reloading...","success"),setTimeout(()=>window.location.reload(),1500)}).catch(r=>i.showGlobalMessage(`Error: ${r.message}`,"error"))}});let s=document.getElementById("aipkit_migration_dashboard_tbody");s&&s.addEventListener("click",async r=>{let c=r.target.closest(".aipkit_migrate_category_btn"),l=r.target.closest(".aipkit_delete_category_btn");if(!c&&!l)return;let p=c?c.dataset.category:l.dataset.category,_=a.steps[p];if(!_){console.error("Could not find step info for category:",p);return}if(l){if(!confirm(a.text.confirmDeleteData))return;i.setCategoryLoadingState(p,!0,a.text.deleting);try{let f=await n.executeDeleteStep(p,_.delete_action,a.nonce);i.updateCategoryStatus(p,a.text.statusDeleted,"aipkit_status-success"),i.showGlobalMessage(f.message,"success")}catch(f){i.showGlobalMessage(`Error deleting ${_.label}: ${f.message}`,"error"),i.updateCategoryStatus(p,a.text.statusFailed,"aipkit_status-warning")}}else if(c){i.setCategoryLoadingState(p,!0,a.text.migrating);try{let f=await n.executeMigrationStep(p,_.action,a.nonce);i.updateCategoryStatus(p,a.text.statusMigrated,"aipkit_status-success"),i.showGlobalMessage(f.message,"success")}catch(f){i.showGlobalMessage(`Error migrating ${_.label}: ${f.message}`,"error"),i.updateCategoryStatus(p,a.text.statusFailed,"aipkit_status-warning")}}})}window.aipkit_initMigrationTool=d})();})();
