(()=>{(function(){"use strict";function k(r,i){if(!r)return;let s=r.querySelector(".aipkit_btn-text");if(s){s.textContent=i;return}let n=r.querySelector(".aipkit_spinner"),c=Array.from(r.childNodes).find(l=>l.nodeType===Node.TEXT_NODE);c?c.textContent=i+(n?" ":""):r.insertBefore(document.createTextNode(i+(n?" ":"")),r.firstChild),n&&r.appendChild(n)}function a(r,i,s,n=4e3){if(!r)return;let c=r.dataset.baseClass||"aipkit_form-help";r.dataset.baseClass||(r.dataset.baseClass=c),r.messageTimeoutId&&(clearTimeout(r.messageTimeoutId),r.messageTimeoutId=null),r.textContent=s,r.className=c,r.classList.add(`aipkit_form-help-${i}`),r.style.opacity="1",r.style.display="block",r.messageTimeoutId=setTimeout(()=>{r.style.opacity="0",setTimeout(()=>{r.textContent===s&&(r.textContent="",r.className=c,r.style.display="",r.messageTimeoutId=null)},300)},n)}window.aipkit_setButtonText=k,window.aipkit_showTemporaryMessage=a})();(function(){"use strict";function k(r){return r===null||typeof r>"u"?"":String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function a(r){return k(r)}window.aipkit_escapeHtml=k,window.aipkit_escapeAttribute=a})();(function(){"use strict";function k(r){let i=document.createElement("div");if(i.textContent="Copied!",Object.assign(i.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:1000005,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)",pointerEvents:"none"}),document.body.appendChild(i),r){let{top:s,left:n,width:c}=r.getBoundingClientRect(),l=s+window.scrollY+2,o=n+window.scrollX+c+5;i.style.top=`${l}px`,i.style.left=`${o}px`;let e=i.getBoundingClientRect(),t=8,p=window.innerWidth-t;if(e.right>p){let d=n+window.scrollX-e.width-5,u=Math.max(window.scrollX+t,d);i.style.left=`${u}px`}}else i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateY(0)"}),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateY(-5px)",i.addEventListener("transitionend",()=>i.remove(),{once:!0}),setTimeout(()=>{i.parentNode&&i.remove()},500)},1e3)}async function a(r,i){if(r)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(r),k(i);return}throw new Error("Clipboard API not available")}catch(s){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",s);try{let n=document.createElement("textarea");n.value=r,n.style.position="fixed",n.style.top="-9999px",n.style.left="-9999px",n.style.opacity="0",n.setAttribute("readonly",""),document.body.appendChild(n),n.select(),n.setSelectionRange(0,99999);let c=document.execCommand("copy");if(document.body.removeChild(n),c)k(i);else throw new Error('document.execCommand("copy") failed.')}catch(n){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",n),window.prompt("Please copy the shortcode manually:",r)}}}window.aipkit_copyShortcode=a})();(function(){"use strict";function k(s){let n=Number(s);if(!n||isNaN(n))return"";try{let c=new Date(n*1e3);if(isNaN(c.getTime()))return"";let l=String(c.getHours()).padStart(2,"0"),o=String(c.getMinutes()).padStart(2,"0"),e=String(c.getSeconds()).padStart(2,"0");return`${l}:${o}:${e}`}catch(c){return console.error("Error formatting timestamp:",s,c),""}}function a(s){if(!s)return"";try{let n=new Date(s.replace(" ","T")+"Z");if(isNaN(n.getTime()))return"";let c=new Date,l=(n.getTime()-c.getTime())/1e3;if(l<0)return"In the past";if(l<60)return"in less than a minute";if(l<3600){let p=Math.round(l/60);return`in ${p} minute${p!==1?"s":""}`}let o=new Date(c.getFullYear(),c.getMonth(),c.getDate()),e=new Date(c.getFullYear(),c.getMonth(),c.getDate()+1),t=new Date(n.getFullYear(),n.getMonth(),n.getDate());return t.getTime()===o.getTime()?`Today at ${n.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:t.getTime()===e.getTime()?`Tomorrow at ${n.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${n.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(n){return console.error("Error formatting relative time:",s,n),s}}function r(s){if(!s)return"N/A";try{let n=new Date(s.replace(" ","T")+"Z");return isNaN(n.getTime())?"Invalid Date":n.toLocaleString()}catch(n){return console.error("Error formatting UTC date string:",s,n),s}}function i(s){if(!s)return"N/A";try{let n=new Date(s.replace(" ","T")+"Z");if(isNaN(n.getTime()))return"Invalid Date";let c=Math.floor((Date.now()-n.getTime())/1e3);if(Number.isNaN(c)||c<0)return n.toLocaleString();if(c<60)return"Just now";let l=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],o=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let e of l)if(c>=e.seconds){let t=Math.floor(c/e.seconds);return o?o.format(-t,e.unit):`${t} ${e.unit}${t!==1?"s":""} ago`}return n.toLocaleString()}catch(n){return console.error("Error formatting relative date string:",s,n),s}}window.aipkit_formatTimestamp=k,window.aipkit_formatFriendlyFutureDate=a,window.aipkit_formatUtcDateTime=r,window.aipkit_formatRelativeDateTime=i})();(function(){"use strict";function k(a){return!a||typeof a!="string"?"":a.charAt(0).toUpperCase()+a.slice(1)}window.aipkit_ucfirst=k,window.ucfirst=k})();(function(){"use strict";function k(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let a=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&a.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=a,a}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=k})();(function(){"use strict";function k(a,r="",i="",s={}){if(!a)return"N/A";let n=a.toLowerCase();if(n.includes("text content submitted for indexing"))return"Text";if(n.includes("file content submitted for indexing")||n.includes("file content embedded and upserted")||n.includes("original filename:"))return"File Upload";if(n.includes("wordpress post content submitted for indexing"))return"Site Content";if(i==="openai")return"N/A";if(i==="pinecone"&&n.includes("vectors upserted")){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("pinecone_file_")||r.includes("file_"))return"File Upload"}if(i==="qdrant"){if(n.includes("points upserted to qdrant"))return s.post_id||n.includes("post id:")?"Site Content":"Text";if(n.includes("wordpress post content submitted for indexing"))return"Site Content"}if(r&&i==="pinecone"){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("file_")||r.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=k})();(function(){"use strict";async function k(i){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",i)}async function a(i,s){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));i.set("action",s);try{let l=i.get("provider")||"openai",o=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null,e=o?i.get(o):null;if(e&&typeof e.size=="number"){let t=["text/plain","text/csv","application/json","text/json","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/csv","text/comma-separated-values"],p=Array.isArray(window.aipkit_uploadLimits?.allowed_mime_types)&&window.aipkit_uploadLimits.allowed_mime_types.length?window.aipkit_uploadLimits.allowed_mime_types:t,d=Number(window.aipkit_effectiveUploadLimitBytes||0);(!Number.isFinite(d)||d<=0)&&(d=10*1024*1024),l==="openai"&&(d=Math.min(d,10*1024*1024));let u=[];if(e.size>d&&u.push(`File is too large (${r(e.size)}). Max allowed is ${r(d)}.`),e.type&&!p.map(f=>f.toLowerCase()).includes(String(e.type).toLowerCase())&&u.push(`Unsupported file type (${e.type}). Allowed: ${p.join(", ")}.`),u.length){let f=new Error(u.join(" "));throw f.code="client_validation_failed",f}}}catch(l){throw console.warn("[AIPKit] Client-side file validation failed",l),l}let n;try{let l=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null;if(l)try{let o=i.get(l);o&&console.debug("[AIPKit] File upload request",{action:s,fileField:l,name:o.name,size_bytes:o.size,type:o.type})}catch{}n=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:i,credentials:"same-origin"})}catch(l){throw console.error("[AIPKit] Network error during file upload",{action:s,error:l}),l}let c;try{c=await n.json()}catch(l){console.error("[AIPKit] Failed to parse JSON response for file upload",{action:s,status:n?.status,parseErr:l});let o=new Error(`Unexpected server response (status ${n?.status||"n/a"})`);throw o.status=n?.status,o}if(!n.ok||!c.success){let l=c?.data||{},o=new Error(l.message||`HTTP error! status: ${n.status}`);throw o.code=l.code,o.status=n.status,o.details=l.details||void 0,o.serverResponse=c,console.error("[AIPKit] File upload failed",{action:s,status:n.status,server:c}),o}return c.data}function r(i){if(!Number.isFinite(i))return`${i}`;let s=["B","KB","MB","GB"],n=0,c=i;for(;c>=1024&&n<s.length-1;)c/=1024,n++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:o=>o.toFixed(1)}).format(c)} ${s[n]}`}window.aipkit_api_upsertOpenAIText=k,window.aipkit_api_upsertFile=a})();(function(){"use strict";function k(a){let r=document.querySelector(a);if(!r)return;r.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(s=>{let n=s.id+"_value",c=null,l=s.closest(".aipkit_slider_wrapper");if(l&&(c=l.querySelector(".aipkit_slider_value")),!c)try{c=r.querySelector(`#${CSS.escape(n)}`)}catch{c=r.querySelector("#"+n)}if(c){let o=s.getAttribute("data-suffix")||(s.id.includes("confidence_threshold")?"%":"");c.textContent=s.value+o,s.hasAttribute("data-range-listener-attached")||(s.addEventListener("input",function(){c.textContent=this.value+o}),s.setAttribute("data-range-listener-attached","true"))}})}window.aipkit_attachRangeValueHandlers=k})();(function(){"use strict";function k(a){let r=document.querySelector(a);if(!r)return;let i="data-apikey-toggle-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(s){let n=s.target.closest(".aipkit_api-key-toggle");if(!n)return;let c=n.closest(".aipkit_api-key-wrapper");if(!c)return;let l=c.querySelector(".aipkit_form-input"),o=n.querySelector(".dashicons");!l||!o||(l.type==="password"?(l.type="text",o.classList.remove("dashicons-visibility"),o.classList.add("dashicons-hidden")):(l.type="password",o.classList.remove("dashicons-hidden"),o.classList.add("dashicons-visibility")))}),r.setAttribute(i,"true"))}window.aipkit_initApiKeyToggles=k})();(function(){"use strict";function k(a,r,i="Submit",s="Processing..."){if(!a)return;let n=a.querySelector(".aipkit_btn-text")||a.querySelector(".aipkit_btn_text"),c=a.querySelector(".aipkit_spinner"),l=a.querySelector(".dashicons");if(r){if(a.disabled=!0,!a.dataset.originalText)if(n)a.dataset.originalText=n.textContent;else{let e="";a.childNodes.forEach(t=>{t.nodeType===Node.TEXT_NODE&&(e+=t.textContent.trim())}),a.dataset.originalText=e.trim()}l&&(l.dataset.originalDisplay||(l.dataset.originalDisplay=l.style.display||"inline-block"),l.style.display="none");let o=i===""?"":a.dataset.loadingText||s;n?(a.dataset.originalText||(a.dataset.originalText=n.textContent),n.textContent=o):(!l||l.style.display==="none")&&o&&(Array.from(a.childNodes).forEach(e=>{e.nodeType===Node.TEXT_NODE&&e.remove()}),o&&a.insertBefore(document.createTextNode(o),a.firstChild)),c&&(c.style.display="inline-block")}else{a.disabled=!1;let o=i===""?"":a.dataset.originalText||i;l&&l.dataset.originalDisplay&&(l.style.display=l.dataset.originalDisplay,delete l.dataset.originalDisplay),n?n.textContent=o:i!==""&&(Array.from(a.childNodes).forEach(e=>{e.nodeType===Node.TEXT_NODE&&e.remove()}),o&&(l?l.insertAdjacentText("afterend"," "+o):a.insertBefore(document.createTextNode(o),a.firstChild))),c&&(c.style.display="none"),delete a.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=k})();(function(){"use strict";function k(a,r="info",i="aipkit_knowledge_base_global_status"){let s=document.getElementById(i);if(!s)return;s.messageTimeoutId&&clearTimeout(s.messageTimeoutId),s.messageTimeoutId=null;let n=a?String(a).trim():"";if(n===""){s.textContent="",s.className="aipkit_form-help",s.style.display="none",s.style.opacity="0",s.classList.remove("aipkit-active");return}let c=s.classList.contains("aipkit_settings_message-error"),l=r;c&&r!=="error"&&(l="error"),s.className="aipkit_form-help",l==="success"?s.classList.add("aipkit_settings_message-success"):l==="error"?s.classList.add("aipkit_settings_message-error"):s.classList.add("aipkit_settings_message-info"),l==="error"&&s.textContent||c&&r!=="error"&&s.textContent?s.textContent=s.textContent+`
`+n:s.textContent=n,s.style.display="block",s.style.opacity="1",s.classList.add("aipkit-active"),l!=="error"&&(s.messageTimeoutId=setTimeout(()=>{s.style.opacity="0",setTimeout(()=>{s.textContent.includes(n)&&(s.textContent="",s.className="aipkit_form-help",s.style.display="none",s.classList.remove("aipkit-active"))},300)},5e3))}window.aipkit_showOpenAIVectorStatus=k})();(function(){"use strict";async function k(s,n,c,l){let o=document.getElementById("aipkit_nonce"),e=o&&o.value||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||void 0;return await window.aipkit_apiRequest("aipkit_get_chunk_logs_by_batch",{_ajax_nonce:e,provider:s,store_id:n,batch_id:c,page:l,per_page:10})}function a({snippetText:s="",fileId:n="",provider:c="",batchId:l="",storeId:o=""}={}){let e=window.aipkit_escapeHtml||function(_){return _},t=document.createElement("div");t.className="aipkit-snippet-modal-overlay";let p=document.createElement("div");p.className="aipkit-snippet-modal-content";let d=c?`${c} Indexed Snippet`:"Indexed Snippet",u=n?` (${e(n)})`:"",f=!!l&&!!o&&!!c;p.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${d}${u}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        ${f?`
          <div class="aipkit-chunks-list"></div>
          <div class="aipkit-chunks-pagination" style="margin-top:10px; display:flex; justify-content: space-between; align-items:center;">
            <button class="button button-secondary aipkit-chunks-prev">Prev</button>
            <span class="aipkit-chunks-page-info"></span>
            <button class="button button-secondary aipkit-chunks-next">Next</button>
          </div>
        `:`
          <pre class="aipkit-snippet-modal-content-text">${e(s)}</pre>
        `}
      </div>
    `,t.appendChild(p),document.body.appendChild(t);function m(){t.classList.remove("active"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)}p.querySelector(".aipkit-snippet-modal-close").addEventListener("click",m),t.addEventListener("click",_=>{_.target===t&&m()});function g(_){_.key==="Escape"&&(m(),document.removeEventListener("keydown",g))}if(document.addEventListener("keydown",g),requestAnimationFrame(()=>{t.classList.add("active")}),f){let _=p.querySelector(".aipkit-chunks-list"),h=p.querySelector(".aipkit-chunks-page-info"),y=p.querySelector(".aipkit-chunks-prev"),E=p.querySelector(".aipkit-chunks-next"),x=1,w=1,S=v=>{if(!v||!v.length){_.innerHTML="<p>No chunks found.</p>";return}_.innerHTML=v.map(A=>{let C=A.indexed_content||"",b=A.file_id||"";return`<div class="aipkit-chunk-item" style="margin-bottom:12px;">
            <div class="aipkit-chunk-title" style="font-weight:600; margin-bottom:6px;">${e(b)}</div>
            <pre class="aipkit-chunk-text">${e(C)}</pre>
          </div>`}).join("")};async function T(v){_.innerHTML='<p><span class="aipkit_spinner" style="display:inline-block;"></span> Loading...</p>';try{let A=await k(c,o,l,v);S(A.chunks||[]),x=A.pagination?.current_page||v,w=A.pagination?.total_pages||1,h.textContent=`Page ${x} / ${w}`,y.disabled=x<=1,E.disabled=x>=w}catch(A){_.innerHTML=`<p class="aipkit_text-danger">${A&&A.message||"Failed to load chunks."}</p>`}}y.addEventListener("click",()=>{x>1&&T(x-1)}),E.addEventListener("click",()=>{x<w&&T(x+1)}),T(1)}}function r(s,n,c=""){return a({snippetText:s,fileId:n,provider:c})}function i(s,n=""){s&&s.querySelectorAll(".aipkit_view_snippet_icon").forEach(c=>{let l=c.cloneNode(!0);c.parentNode.replaceChild(l,c),l.addEventListener("click",o=>{o.preventDefault();let e=l.dataset.snippet,t=l.dataset.fileId,p=l.dataset.batchId||"",d=l.dataset.storeId||"";a({snippetText:e,fileId:t,provider:n,batchId:p,storeId:d})})})}window.aipkit_showSnippetModal=r,window.aipkit_showSnippetModalEnhanced=a,window.aipkit_attachSnippetModalListeners=i})();(function(){"use strict";function k(a,r,i){if(!a||!r||typeof i!="function"){r&&(r.innerHTML="");return}r.innerHTML="";let{total_logs:s,total_pages:n,current_page:c}=a,l=parseInt(c,10);if(!s||s<=0||!n||n<=1)return;let o=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,e=wp.i18n&&wp.i18n._n?wp.i18n._n:(m,g,_)=>_>1?g:m,t=document.createElement("span");t.className="aipkit_pagination-count",t.textContent=`${s.toLocaleString()} ${e("item","items",s)}`,r.appendChild(t);let p=document.createElement("span");p.className="aipkit_pagination-links";let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",d.innerHTML="&laquo; "+o("Previous","gpt3-ai-content-generator"),d.disabled=l<=1,d.disabled||d.addEventListener("click",m=>{m.preventDefault(),i(l-1)}),p.appendChild(d);let u=document.createElement("span");u.className="aipkit_pagination-current",u.textContent=`${o("Page","gpt3-ai-content-generator")} ${l} ${o("of","gpt3-ai-content-generator")} ${n}`,p.appendChild(u);let f=document.createElement("button");f.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",f.innerHTML=o("Next","gpt3-ai-content-generator")+" &raquo;",f.disabled=l>=n,f.disabled||f.addEventListener("click",m=>{m.preventDefault(),i(l+1)}),p.appendChild(f),r.appendChild(p)}window.aipkit_renderLogsPagination=k})();(function(){"use strict";function k(a){let r=document.querySelector(a);if(!r)return;let i="data-restore-icon-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(s){let n=s.target.closest(".aipkit_restore-default-icon");if(!n)return;let c=n.getAttribute("data-target-input"),l=n.getAttribute("data-default-value");if(!c||l===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",n);return}let o=document.getElementById(c);if(o){if(o.value!==l){o.value=l;let t=new Event("change",{bubbles:!0,cancelable:!0}),p=new Event("blur",{bubbles:!0,cancelable:!0});if(o.dispatchEvent(t),o.dispatchEvent(p),o.type==="range"){let d=document.getElementById(`${c}_value`);d&&(d.textContent=l)}}}else console.warn(`AIPKit Restore Default: Target input element #${c} not found.`)}),r.setAttribute(i,"true"))}window.aipkit_initRestoreDefaultIcons=k})();(function(){"use strict";function k(s){!s||!s.parentNode||s.classList.contains("aipkit_message_fadeout")||(s.classList.add("aipkit_message_fadeout"),s.addEventListener("animationend",()=>{s.parentNode&&s.parentNode.removeChild(s)},{once:!0}),setTimeout(()=>{s&&s.parentNode&&s.parentNode.removeChild(s)},500))}function a(s,n,c){let l=document.getElementById(s);if(!l){console.error(`AIPKit Message Handler: Container #${s} not found.`);return}l.querySelectorAll(".aipkit_settings_message").forEach(m=>{m.dataset.timerId&&clearTimeout(parseInt(m.dataset.timerId,10)),m.remove()});let e=l.querySelector(".aipkit_saving-indicator");e&&e.remove();let t=document.createElement("div");t.className=`aipkit_settings_message aipkit_settings_message-${n}`;let p=n==="success"?"dashicons-yes-alt":n==="error"?"dashicons-warning":"dashicons-info-alt",d=document.createElement("span");d.className=`dashicons ${p}`,d.style.marginRight="5px",t.appendChild(d),t.appendChild(document.createTextNode(` ${c}`));let u=document.createElement("span");u.className="dashicons dashicons-dismiss aipkit_settings_message-close",u.setAttribute("aria-label","Dismiss message"),u.title="Dismiss message",t.appendChild(u),l.appendChild(t);let f=setTimeout(()=>{k(t)},5e3);t.dataset.timerId=f}function r(s){let n=document.getElementById(s);if(!n){console.error(`AIPKit Message Handler: Container #${s} not found for close button init.`);return}let c=`data-close-listener-${s}`;n.getAttribute(c)!=="true"&&(n.addEventListener("click",function(l){let o=l.target.closest(".aipkit_settings_message-close");if(o){let e=o.closest(".aipkit_settings_message");e&&(e.dataset.timerId&&clearTimeout(parseInt(e.dataset.timerId,10)),k(e))}}),n.setAttribute(c,"true"))}function i(s){let n=document.getElementById(s);if(n){let c=n.querySelector(".aipkit_saving-indicator");c&&c.remove(),n.querySelectorAll(".aipkit_settings_message").forEach(o=>{o.dataset.timerId&&clearTimeout(parseInt(o.dataset.timerId,10)),o.remove()})}else console.warn(`AIPKit Message Handler: Container #${s} not found for clearing messages.`)}window.aipkit_showMessage=a,window.aipkit_initMessageCloseButtons=r,window.aipkit_clearStatusMessages=i})();(function(){"use strict";function k(i,s){let n=document.getElementById(i);if(!n){console.error(`AIPKit Saving Indicator: Container #${i} not found.`);return}let c=n.querySelector(".aipkit_saving-indicator");if(s)if(!c)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(i):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),c=document.createElement("span"),c.className="aipkit_saving-indicator",c.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',n.appendChild(c),requestAnimationFrame(()=>{let l=n.querySelector(".aipkit_saving-indicator");l&&l.classList.add("aipkit_active")});else{c.style.display="inline-flex",c.classList.add("aipkit_active");let l=c.querySelector(".aipkit_spinner");l&&(l.style.display="inline-block")}else c&&(c.classList.remove("aipkit_active"),setTimeout(()=>{c&&c.parentNode&&c.remove()},200))}function a(i){r(i);let s=document.createElement("span");s.className="aipkit-title-spinner aipkit_spinner",s.style.display="inline-block",i.parentNode.insertBefore(s,i.nextSibling)}function r(i){let s=i.parentNode.querySelector(".aipkit-title-spinner");s&&s.remove()}window.aipkit_showSavingIndicator=k,window.aipkit_showLinkSpinner=a,window.aipkit_hideLinkSpinner=r})();(function(){"use strict";function k(i){let s=i.textContent;i.textContent="Copied!",i.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{i&&i.classList.contains("aipkit-placeholder--copied")&&(i.textContent=s,i.classList.remove("aipkit-placeholder--copied"))},1500)}function a(i){let s=i.target;if(!s.matches(".aipkit-placeholder"))return;i.preventDefault(),i.stopPropagation();let n=s.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(n).then(()=>{k(s)}).catch(c=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",c)})}function r(){let i=document.body;if(i){let s="data-placeholder-copy-listener-attached";i.getAttribute(s)||(i.addEventListener("click",a),i.setAttribute(s,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",r)})();(function(){"use strict";let k="select[data-aipkit-provider-notice-target]",a="a[data-aipkit-load-module]";function r(){let g=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return g&&typeof g=="object"?g:{}}function i(g){window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=g}function s(g){return g?String(g).trim().toLowerCase():""}function n(g,_){return!g||!_||!Object.prototype.hasOwnProperty.call(_,g)?null:!!_[g]}function c(g,_){if(!g)return"";let h=_?g.getAttribute(`data-message-${_}`):"";return h||g.getAttribute("data-message-default")||""}function l(g){g&&g.classList.add("aipkit_provider_notice--hidden")}function o(g){g&&g.classList.remove("aipkit_provider_notice--hidden")}function e(g,_){if(!g)return;let h=g.getAttribute("data-aipkit-provider-notice-target");if(!h)return;let y=document.getElementById(h);if(!y)return;if(g.getAttribute("data-aipkit-provider-notice-defer")==="1"&&g.dataset.aipkitProviderNoticeArmed!=="true"){l(y);return}let x=s(g.value);if(!x){l(y);return}let w=n(x,_);if(w===null){l(y);return}if(w){l(y);return}let S=y.querySelector(".aipkit_provider_notice_message");S&&(S.textContent=c(y,x)),o(y)}function t(g){return g?g.offsetParent!==null?!0:g.getClientRects().length>0:!1}function p(g){let _=r(),h=g||document,y=Array.from(h.querySelectorAll(k)),E=new Map;y.forEach(x=>{let w=x.getAttribute("data-aipkit-provider-notice-target");w&&(E.has(w)||E.set(w,[]),E.get(w).push(x))}),E.forEach(x=>{let w=x.find(t)||x[0];w&&e(w,_)})}function d(){let g={...r()},_=!1,h=W=>{let U=document.getElementById(W);if(U)return _=!0,String(U.value||"").trim()},y=h("aipkit_openai_api_key");y!==void 0&&(g.openai=y!=="");let E=h("aipkit_openrouter_api_key");E!==void 0&&(g.openrouter=E!=="");let x=h("aipkit_google_api_key");x!==void 0&&(g.google=x!=="");let w=h("aipkit_azure_api_key"),S=h("aipkit_azure_endpoint");(w!==void 0||S!==void 0)&&(g.azure=(w||"")!==""&&(S||"")!=="");let T=h("aipkit_claude_api_key");T!==void 0&&(g.claude=T!=="");let v=h("aipkit_deepseek_api_key");v!==void 0&&(g.deepseek=v!=="");let A=h("aipkit_ollama_base_url");A!==void 0&&(g.ollama=A!=="");let C=h("aipkit_replicate_api_key"),b=h("aipkit_task_cw_replicate_api_key");(C!==void 0||b!==void 0)&&(g.replicate=(C||"")!==""||(b||"")!=="");let L=h("aipkit_pinecone_api_key");L!==void 0&&(g.pinecone=L!=="");let B=h("aipkit_qdrant_api_key"),$=h("aipkit_qdrant_url");return(B!==void 0||$!==void 0)&&(g.qdrant=(B||"")!==""&&($||"")!==""),_?(i(g),!0):!1}function u(){["aipkit_openai_api_key","aipkit_openrouter_api_key","aipkit_google_api_key","aipkit_azure_api_key","aipkit_azure_endpoint","aipkit_claude_api_key","aipkit_deepseek_api_key","aipkit_ollama_base_url","aipkit_replicate_api_key","aipkit_task_cw_replicate_api_key","aipkit_pinecone_api_key","aipkit_qdrant_api_key","aipkit_qdrant_url"].forEach(_=>{let h=document.getElementById(_);if(!h||h.dataset.aipkitProviderStatusBound==="true")return;let y=()=>{d()&&p(document)};h.addEventListener("input",y),h.addEventListener("change",y),h.dataset.aipkitProviderStatusBound="true"})}function f(g){(g||document).querySelectorAll(a).forEach(y=>{y.dataset.aipkitProviderNoticeLinkBound!=="true"&&(y.addEventListener("click",E=>{let x=y.getAttribute("data-aipkit-load-module");!x||typeof window.aipkit_loadModule!="function"||(E.preventDefault(),window.aipkit_loadModule(x))}),y.dataset.aipkitProviderNoticeLinkBound="true")})}function m(g){let _=g||document;_.querySelectorAll(k).forEach(y=>{y.dataset.aipkitProviderNoticeBound!=="true"&&(y.addEventListener("change",()=>{y.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(y.dataset.aipkitProviderNoticeArmed="true"),e(y,r())}),y.dataset.aipkitProviderNoticeBound="true")}),d(),p(_),u(),f(_)}window.aipkit_initProviderKeyNotices=m,document.addEventListener("DOMContentLoaded",function(){m(document)})})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelectorAll("[data-aipkit-popover-target]");if(!r.length)return;let i=null,s=null,n=!1,c=p=>p?a.querySelector(`#${p}`):null,l=(p,d)=>{if(!p||!d)return;let u=p.getBoundingClientRect(),f=d.getBoundingClientRect(),m=f.width||400,g=f.height||0,_=window.innerWidth,h=window.innerHeight,y=12;if(p.dataset.aipkitPopoverPlacement==="bottom"){let w=u.left;w+m>_-y&&(w=u.right-m),w=Math.max(y,Math.min(w,_-m-y));let S=u.bottom+8;S+g>h-y&&(S=u.top-g-8),S=Math.max(y,Math.min(S,h-g-y)),d.style.left=`${Math.round(w)}px`,d.style.top=`${Math.round(S)}px`;return}if(p.dataset.aipkitPopoverPlacement==="left"){let w=u.left-m-10;w<y&&(w=u.right+10),w=Math.max(y,Math.min(w,_-m-y));let S=u.top;S+g>h-y&&(S=h-g-y),S=Math.max(y,S),d.style.left=`${Math.round(w)}px`,d.style.top=`${Math.round(S)}px`;return}let E=u.right+10;E+m>_-y&&(E=u.right-m-10),E=Math.max(y,Math.min(E,_-m-y));let x=u.top;x+g>h-y&&(x=h-g-y),x=Math.max(y,x),d.style.left=`${Math.round(E)}px`,d.style.top=`${Math.round(x)}px`},o=()=>{!s||!i||n||(n=!0,window.requestAnimationFrame(()=>{let p=i.querySelector(".aipkit_model_settings_popover_panel");l(s,p),n=!1}))},e=()=>{if(!i)return;let p=i.id;i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),s&&s.setAttribute("aria-expanded","false"),typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),p==="aipkit_cw_template_picker_popover"&&typeof window.aipkit_resetTemplateActionsPanel=="function"&&window.aipkit_resetTemplateActionsPanel(),i=null,s=null},t=p=>{if(!p)return;let d=p.getAttribute("data-aipkit-popover-target"),u=c(d);if(!u)return;i&&i!==u&&e(),i=u,s=p,u.classList.add("aipkit-active"),u.setAttribute("aria-hidden","false"),p.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${d}`);let f=u.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{l(p,f)})};r.forEach(p=>{p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",d=>{if(d.preventDefault(),!(p.dataset.aipkitPopoverKeepOpen==="true")&&i&&s===p&&i.classList.contains("aipkit-active")){e();return}t(p)}),p.dataset.popoverListenerAttached="true")}),a.querySelectorAll(".aipkit_model_settings_popover").forEach(p=>{p.dataset.overlayListenerAttached!=="true"&&(p.addEventListener("click",u=>{u.target===p&&e()}),p.dataset.overlayListenerAttached="true");let d=p.querySelector(".aipkit_model_settings_popover_close");d&&d.dataset.popoverListenerAttached!=="true"&&(d.addEventListener("click",u=>{u.preventDefault(),e()}),d.dataset.popoverListenerAttached="true"),p.querySelectorAll("[data-aipkit-popover-close]").forEach(u=>{u.dataset.popoverListenerAttached!=="true"&&(u.addEventListener("click",f=>{f.preventDefault(),e()}),u.dataset.popoverListenerAttached="true")})}),a.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",p=>{p.key==="Escape"&&i&&e()}),a.dataset.escapeListenerAttached="true"),a.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",o),window.addEventListener("scroll",o,!0),a.dataset.repositionListenersAttached="true")}window.aipkit_initContentWriterPopovers=k})();(function(){"use strict";let k=s=>{if(!s)return null;let n=s.querySelector("#aipkit_enhancer_editor_integration"),c=s.querySelector("#aipkit_enhancer_list_button"),l=s.querySelector('input[name="enhancer_insert_position_default"]:checked');return!n||!c||!l?null:{enhancer_editor_integration:n.checked?"1":"0",enhancer_list_button:c.checked?"1":"0",enhancer_insert_position_default:l.value||"replace"}},a=s=>s?JSON.stringify(s):"",r=async s=>{if(!s||typeof window.aipkit_apiRequest!="function")return;let n=k(s);if(!n)return;let c=s.dataset.assistantAutosaveBaseline||"",l=a(n);if(!l||l===c||s.dataset.assistantAutosaveBusy==="true")return;let o=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,e=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,t=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;s.dataset.assistantAutosaveBusy="true",o&&o("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",n),s.dataset.assistantAutosaveBaseline=l,e&&e("Updated")}catch(p){t&&t(`Error: ${p.message||"Failed to save."}`),console.error("Content Writer Assistant Settings Save Error:",p)}finally{s.dataset.assistantAutosaveBusy="false"}};function i(s){let n=s||document.getElementById("aipkit_content_writer_container"),c=document.getElementById("aipkit_cw_builder_sheet");if(!n||!c)return;let l=c.querySelector(".aipkit_builder_sheet_title"),o=c.querySelector(".aipkit_builder_sheet_description"),e=c.querySelectorAll(".aipkit_builder_sheet_section"),t=c.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'),p=c.querySelector(".aipkit_builder_sheet_close"),d=f=>{if(!f)return;let m=f.getAttribute("data-sheet-title")||"Sheet",g=f.getAttribute("data-sheet-description")||"",_=f.getAttribute("data-sheet-content")||"placeholder";l&&(l.textContent=m),o&&(o.textContent=g);let h=!1;if(e.forEach(y=>{y.dataset.sheet===_?(y.hidden=!1,h=!0):y.hidden=!0}),!h&&t&&(t.hidden=!1),c.classList.add("aipkit-active"),c.setAttribute("aria-hidden","false"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_cw_builder_sheet"),_==="assistant"&&(typeof window.aipkit_initMessageCloseButtons=="function"&&window.aipkit_initMessageCloseButtons("aipkit_content_writer_messages"),typeof window.aipkit_initEnhancerActionsUI=="function"&&window.aipkit_initEnhancerActionsUI(),!c.dataset.assistantAutosaveBound)){let y=k(c);c.dataset.assistantAutosaveBaseline=a(y),c.addEventListener("change",E=>{let x=E.target;!x||!x.matches("#aipkit_enhancer_editor_integration")&&!x.matches("#aipkit_enhancer_list_button")&&!x.matches('input[name="enhancer_insert_position_default"]')||r(c)}),c.dataset.assistantAutosaveBound="true"}p&&p.focus()},u=()=>{c.classList.remove("aipkit-active"),c.setAttribute("aria-hidden","true")};n.dataset.assistantSheetBound||(n.addEventListener("click",f=>{let m=f.target.closest(".aipkit_builder_sheet_trigger");m&&(f.preventDefault(),d(m))}),n.dataset.assistantSheetBound="true"),p&&p.dataset.assistantSheetBound!=="true"&&(p.addEventListener("click",u),p.dataset.assistantSheetBound="true"),c.dataset.assistantSheetBound||(c.addEventListener("click",f=>{f.target===c&&u()}),document.addEventListener("keydown",f=>{f.key==="Escape"&&c.classList.contains("aipkit-active")&&u()}),c.dataset.assistantSheetBound="true")}window.aipkit_initContentWriterAssistantSheet=i})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],a=e=>{let t=k.findIndex(p=>p.key===e);return t===-1?1:t},r=(e,t)=>{let p=Number(e);if(!p||Number.isNaN(p))return"medium";let d="medium",u=1/0;return Object.keys(t).forEach(f=>{let m=Math.abs(p-t[f]);m<u&&(u=m,d=f)}),d},i=(e,t)=>{if(!e)return;let p=e.querySelector(".aipkit_ai_behavior_value"),d=e.querySelector(".aipkit_ai_behavior_hint"),u=e.querySelector(".aipkit_ai_length_slider"),f=k[a(t)];p&&(p.textContent=f.label),d&&(d.textContent=`Approx. ${f.words} words`),u&&(u.value=String(a(t)+1))},s=e=>{let t=e.querySelector(".aipkit_ai_temperature_control");if(!t)return;let p=t.querySelector(".aipkit_ai_temperature_slider"),d=t.querySelector(".aipkit_ai_behavior_value");if(!p||!d||p.dataset.enhancedListenerAttached==="true")return;let u=()=>{d.textContent=p.value};p.addEventListener("input",u),u(),p.dataset.enhancedListenerAttached="true"},n=e=>{let t=e.querySelectorAll(".aipkit_ai_reasoning_input"),p=e.querySelector("[data-aipkit-reasoning-select]");if(!t.length||!p||p.dataset.reasoningSyncAttached==="true")return;let d=f=>f==="minimal"?"low":f,u=f=>{let m=d(f);e.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>_.classList.remove("aipkit_ai_reasoning_option--selected"));let g=e.querySelector(`.aipkit_ai_reasoning_input[value="${m}"]`);if(g){g.checked=!0;let _=g.closest(".aipkit_ai_reasoning_option");_&&_.classList.add("aipkit_ai_reasoning_option--selected")}};t.forEach(f=>{f.dataset.reasoningListenerAttached!=="true"&&(f.addEventListener("change",()=>{f.checked&&(p.value=d(f.value),p.dispatchEvent(new Event("change",{bubbles:!0})),u(f.value))}),f.dataset.reasoningListenerAttached="true")}),p.addEventListener("change",()=>{u(p.value||"medium")}),u(p.value||"medium"),p.dataset.reasoningSyncAttached="true"},c=e=>{let t=e.querySelector(".aipkit_ai_length_control");if(!t)return;let p=t.querySelector(".aipkit_ai_length_slider"),d=t.querySelector("[data-aipkit-length-input]");if(!p||!d||p.dataset.lengthListenerAttached==="true")return;let u=t.dataset.aipkitLengthMode||"content_length",f={short:Number(t.dataset.aipkitLengthShort||2e3),medium:Number(t.dataset.aipkitLengthMedium||4e3),long:Number(t.dataset.aipkitLengthLong||6e3)},m=(_,h)=>{let y=k.some(E=>E.key===_)?_:"medium";if(i(t,y),u==="content_length")d.value!==y&&(d.value=y);else{let E=f[y]||f.medium;Number(d.value)!==E&&(d.value=String(E))}h&&d.dispatchEvent(new Event("change",{bubbles:!0}))},g=()=>{if(u==="content_length"){m(d.value||"medium",!1);return}let _=r(d.value,f);m(_,!1)};p.addEventListener("input",()=>{let _=Math.max(1,Math.min(3,Number(p.value||2)))-1,h=k[_]?.key||"medium";m(h,!0)}),d.addEventListener("change",g),g(),p.dataset.lengthListenerAttached="true"},l=e=>{!e||e.dataset.aiSettingsInit==="true"||(s(e),c(e),n(e),e.dataset.aiSettingsInit="true")};function o(e){let t=e||document.getElementById("aipkit_autogpt_container");t&&t.querySelectorAll(".aipkit_ai_settings_redesigned").forEach(l)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>o()):o(),window.aipkit_initAutogptAiSettingsRedesigned=o})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function k(a,r={},i={}){return new Promise((s,n)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return n(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let c=new FormData;c.append("action",a),!Object.prototype.hasOwnProperty.call(r,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&c.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&(Array.isArray(r[e])?r[e].forEach(t=>{c.append(e+"[]",t)}):c.append(e,r[e]));let l=new AbortController,o=setTimeout(()=>{l.abort()},i.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:c,credentials:"same-origin",signal:l.signal}).then(e=>(clearTimeout(o),e.json())).then(e=>{if(e.success)a==="aipkit_save_ai_settings"&&typeof window.aipkit_invalidateModuleCache=="function"&&["chatbot","sources","content-writer","autogpt","ai-forms","image-generator"].forEach(t=>{window.aipkit_invalidateModuleCache(t)}),s(e.data);else{let t=e.data||{},p=t.message||"Unknown error",d=new Error(p);t.debug_error&&(d.debug=t.debug_error),d.data=t,t.code&&(d.code=t.code),t.details&&(d.details=t.details),n(d)}}).catch(e=>{clearTimeout(o),e.name==="AbortError"?n(new Error("Request timeout")):n(e)})})}window.aipkit_apiRequest=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_modulesMenu");if(a){let i=a.querySelector(".aipkit_dropdown-panel"),s=a.querySelector(".aipkit_menu-trigger");s&&s.addEventListener("click",function(n){n.stopPropagation(),a.classList.toggle("aipkit_show-menu")}),i&&i.addEventListener("click",function(n){n.stopPropagation()})}document.addEventListener("click",function(i){a&&a.classList.contains("aipkit_show-menu")&&(a.contains(i.target)||a.classList.remove("aipkit_show-menu"))});let r=document.getElementById("aipkit_modulesMenuMobile");if(r){r.addEventListener("click",function(s){s.stopPropagation(),r.classList.toggle("aipkit_show-menu")});let i=r.querySelector(".aipkit_dropdown-menu");i&&i.addEventListener("click",function(s){s.stopPropagation()})}}window.aipkit_initSettingsMenus=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_upgradeBtn"),s=document.getElementById("aipkit_upgradeModal");!i||!s||(i.addEventListener("click",function(n){n.preventDefault(),a(s)}),s.querySelectorAll("[data-close-modal]").forEach(function(n){n.addEventListener("click",function(c){c.preventDefault(),r(s)})}),document.addEventListener("keydown",function(n){n.key==="Escape"&&s.classList.contains("aipkit_active")&&r(s)}),s.querySelector(".aipkit_modal").addEventListener("click",function(n){n.stopPropagation()}))}function a(i){i.classList.add("aipkit_active"),document.body.classList.add("aipkit_upgrade_modal_open");let s=i.querySelector('button, a, [tabindex]:not([tabindex="-1"])');s&&setTimeout(()=>s.focus(),100)}function r(i){i.classList.remove("aipkit_active"),document.body.classList.remove("aipkit_upgrade_modal_open")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initUpgradeModal=k})();(function(){"use strict";let i=new Map,s=new Map,n=new Map,c=!1,l={settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",stats:"aipkit_initStats","image-generator":"aipkit_initImageGenerator",sources:"aipkit_initSources","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"},o=".aipkit_chatbot_builder_left",e=(y,E={})=>{let x=Object.keys(E||{}).sort();if(!x.length)return`${y}::default`;let w={};return x.forEach(S=>{w[S]=E[S]}),`${y}::${JSON.stringify(w)}`},t=y=>n.get(y)||0,p=y=>{let E=t(y)+1;return n.set(y,E),E},d=y=>{if(!i.has(y))return null;let E=i.get(y);return!E||typeof E.html!="string"||Date.now()-(E.timestamp||0)>3e5?(i.delete(y),null):E},u=(y,E,x="",w=null)=>{!y||typeof E!="string"||x&&w!==null&&w!==t(x)||i.set(y,{html:E,timestamp:Date.now()})},f=y=>{if(c||typeof window.aipkit_apiRequest!="function")return;c=!0;let E=Array.from(document.querySelectorAll(".aipkit_module-link")).filter(S=>S&&S.offsetParent!==null).map(S=>String(S.getAttribute("data-module")||"").trim()).filter(S=>S&&S!==y);if(!E.length)return;let x=typeof window.requestIdleCallback=="function"?window.requestIdleCallback.bind(window):S=>setTimeout(S,400),w=(S=0)=>{if(S>=E.length)return;let T=E[S],v={module:T};if(T==="chatbot"){try{let B=localStorage.getItem("aipkit_last_selected_chatbot");B&&(v.force_active_bot_id=B)}catch{}try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(v.layout="next")}catch{}}let A={...v};delete A.module;let C=e(T,A),b=t(T);if(d(C)||s.has(C)){x(()=>w(S+1));return}let L=window.aipkit_apiRequest("aipkit_dashboard_load_module",v).then(B=>{B&&typeof B.html=="string"&&u(C,B.html,T,b)}).catch(()=>{}).finally(()=>{s.delete(C),x(()=>w(S+1))});s.set(C,L)};x(()=>w(0))},m=y=>{y&&(y.style.removeProperty("--aipkit-loader-left"),y.style.removeProperty("--aipkit-loader-top"))},g=(y,E)=>{if(m(y),!y||E!=="chatbot")return;let x=y.querySelector(o);if(!x)return;let w=y.getBoundingClientRect(),S=x.getBoundingClientRect();if(w.width<=0||w.height<=0||S.width<=0||S.height<=0)return;let T=S.left-w.left+S.width/2,v=S.top-w.top+S.height/2,A=Math.max(24,Math.min(w.width-24,T)),C=Math.max(24,Math.min(w.height-24,v));y.style.setProperty("--aipkit-loader-left",`${Math.round(A)}px`),y.style.setProperty("--aipkit-loader-top",`${Math.round(C)}px`)};async function _(y,E,x){let w={};typeof E=="function"?x=E:typeof E=="object"&&E!==null&&(w={...E});let S=w.aipkit_silent===!0;Object.prototype.hasOwnProperty.call(w,"aipkit_silent")&&delete w.aipkit_silent;let T=w.aipkit_force_refresh===!0;if(Object.prototype.hasOwnProperty.call(w,"aipkit_force_refresh")&&delete w.aipkit_force_refresh,y==="chatbot"&&!w.force_active_bot_id&&!w.force_active_tab)try{let O=localStorage.getItem("aipkit_last_selected_chatbot");O&&(w.force_active_bot_id=O)}catch(O){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",O)}if(y==="chatbot"&&!w.layout)try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(w.layout="next")}catch(O){console.warn("AIPKit Loader: Failed to read chatbot layout flag from URL:",O)}document.querySelectorAll(".aipkit_module-link").forEach(O=>O.classList.remove("aipkit_active"));let A=document.querySelector(`.aipkit_module-link[data-module="${y}"]`);A&&A.classList.add("aipkit_active");let C=document.getElementById("aipkit_module-container");if(!C)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof x=="function"&&x(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));let b=C.innerHTML.trim()!=="",L=S||b,B=null,$=0,W=()=>{let O=C.offsetHeight||0,N=Math.round(window.innerHeight*.55),ie=Math.max(O,N,280);C.style.minHeight=`${ie}px`},U=()=>{C.style.minHeight=""},D=()=>{requestAnimationFrame(()=>{C.classList.remove("aipkit_module-container--show-feedback"),C.classList.remove("aipkit_module-container--silent-loading"),U(),m(C)})},H=()=>{if(!L)return;if(B&&(clearTimeout(B),B=null),!$){D();return}let N=220-(Date.now()-$);N>0?setTimeout(D,N):D()};if(L&&(g(C,y),C.classList.add("aipkit_module-container--silent-loading"),W(),B=setTimeout(()=>{B=null,$=Date.now(),C.classList.add("aipkit_module-container--show-feedback")},120)),!L){let O=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",y):`Loading ${y}...`;C.innerHTML=`
                <div class="aipkit_container aipkit_loading-placeholder">
                    <div class="aipkit_container-body">
                        <p style="text-align: center; padding: 30px;">
                            <span class="aipkit_spinner"
                                style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                            </span>
                            ${O}
                        </p>
                    </div>
                </div>
            `}if(typeof window.aipkit_apiRequest!="function"){let O="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${y}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(C,y,O),typeof x=="function"&&x(new Error(O)),H(),Promise.reject(new Error(O))}let Q={module:y,...w},F=e(y,w),P=t(y),R=O=>{if(!O||typeof O.html!="string")throw new Error('Missing or invalid "html" in response data');C.innerHTML=O.html,y==="chatbot"&&O.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=O.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let N=l[y];if(N&&typeof window[N]=="function")try{window[N]()}catch(ie){let J=`Error initializing ${y} module scripts.`;throw new Error(`${J} (Details: ${ie.message})`)}typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(C)};try{let O=T?null:d(F);if(O)return R({html:O.html}),typeof x=="function"&&x(),H(),f(y),Promise.resolve();let N=await window.aipkit_apiRequest("aipkit_dashboard_load_module",Q);return R(N),N&&typeof N.html=="string"&&u(F,N.html,y,P),typeof x=="function"&&x(),H(),f(y),Promise.resolve()}catch(O){return O&&O.debug?console.error(`AIPKit Loader: Module loading error for '${y}':`,O.message,`
Server debug:`,O.debug):console.error(`AIPKit Loader: Module loading error for '${y}':`,O),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(C,y,O.message),typeof x=="function"&&x(O),H(),Promise.reject(O)}}let h=y=>{if(!y)return;p(y);let E=`${y}::`;for(let x of Array.from(i.keys()))x.startsWith(E)&&i.delete(x)};window.aipkit_loadModule=_,window.aipkit_invalidateModuleCache=h})();(function(){"use strict";function k(a,r,i){if(!a)return;let s=window.aipkit_dashboard?.text||{},n=s.errorLoadingModuleTitle||"Error Loading Module",c=s.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",l=s.errorDetails||"Details:",o=c.replace("%s",r);a.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${n}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${o}</p>
                    <p><strong>${l}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${i||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_modulesMenu");if(!a)return;let r=a.querySelector(".aipkit_dropdown-panel");r&&(r.addEventListener("change",function(i){let s=i.target;if(s.matches&&s.matches(".aipkit_module-toggle")){let n=r.querySelectorAll(".aipkit_module-toggle");n.forEach(u=>u.disabled=!0),n.forEach(u=>u.disabled=!0);let c=s.getAttribute("data-module"),l=s.getAttribute("data-option-key"),o=s.getAttribute("data-icon"),e=s.getAttribute("data-label"),t=s.checked,p=document.querySelector(`.aipkit_module-link[data-module="${c}"]`);t?p?p.style.display="":console.log(`Module Toggle: Enabling '${c}'. Nav link will appear on refresh if needed.`):p&&(p.style.display="none");let d={moduleKey:l,enabled:t?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),s.checked=!t,p&&(p.style.display=t?"none":""),n.forEach(u=>u.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",d).then(()=>{console.log(`Module Toggle: '${c}' status updated successfully.`)}).catch(u=>{console.error("Error updating module setting:",u.message),alert(`Error updating module setting: ${u.message}`),s.checked=!t,p&&(p.style.display=t?"none":"")}).finally(()=>{n.forEach(u=>u.disabled=!1)})}}),r.addEventListener("click",function(i){let s=i.target.closest(".aipkit_module-item");if(s){let n=s.querySelector(".aipkit_toggle-switch");if(n&&!n.contains(i.target)){let c=s.querySelector(".aipkit_module-toggle");if(c&&!c.disabled){c.checked=!c.checked;let l=new Event("change",{bubbles:!0});c.dispatchEvent(l)}}}}))}window.aipkit_initModuleToggles=k})();(function(){"use strict";function k(){document.querySelectorAll(".aipkit_tabs").forEach(i=>{if(i.dataset.tabGroupListenerAttached==="true")return;let s=i.querySelectorAll(".aipkit_tab"),n=i.nextElementSibling;if(!n||!n.classList.contains("aipkit_tab_content_container")){let c=i.closest(".aipkit_container-body, .aipkit_container"),l=c?c.querySelector(".aipkit_tab_content_container"):null;if(!l)return;let o=l.querySelectorAll(".aipkit_tab-content");a(i,s,o)}else{let c=n.querySelectorAll(".aipkit_tab-content");a(i,s,c)}})}function a(r,i,s){i.forEach(n=>{n.addEventListener("click",function(){i.forEach(o=>o.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),s.forEach(o=>o.classList.remove("aipkit_active"));let c=this.getAttribute("data-tab"),l=Array.from(s).find(o=>o.id===c+"-content");l&&(l.classList.add("aipkit_active"),l.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),r.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=k})();document.addEventListener("DOMContentLoaded",function(){typeof window.aipkit_initSettingsMenus=="function"?window.aipkit_initSettingsMenus():console.error("AIPKit Main: aipkit_initSettingsMenus function not found."),typeof window.aipkit_initModuleToggles=="function"?window.aipkit_initModuleToggles():console.error("AIPKit Main: aipkit_initModuleToggles function not found.");let r=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(r)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let i=["settings","chatbot","content-writer","ai-forms","image-generator","sources"],s=Array.from(document.querySelectorAll(".aipkit_module-link")),n=null;for(let c=0;c<i.length;c++){let l=i[c];if(s.find(e=>e.getAttribute("data-module")===l&&e.offsetParent!==null)){n=l;break}}if(!n){let c=s.find(l=>l.offsetParent!==null);c&&(n=c.getAttribute("data-module"))}if(n)window.aipkit_loadModule(n);else if(s.find(l=>l.getAttribute("data-module")==="settings"))window.aipkit_loadModule("settings");else{let l=document.getElementById("aipkit_module-container");l&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(l,"initial","No modules enabled or accessible. Please activate modules via the top-right menu or check permissions."):l&&(l.innerHTML='<p style="text-align:center; padding: 30px;">No modules enabled. Activate modules via the top-right menu.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!r){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let i=document.getElementById("aipkit_module-container");i&&(i.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector("#aipkit_sources_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let s=r.querySelector(".aipkit_model_settings_popover_title"),n=r.querySelector(".aipkit_model_settings_popover_back"),c=a.querySelector("#aipkit_sources_settings_trigger"),l={root:r.dataset.titleRoot||"Settings",general:r.dataset.titleGeneral||"General","provider-credentials":r.dataset.titleProviderCredentials||"Provider credentials","document-chunking":r.dataset.titleDocumentChunking||"Document chunking"},o=null,e=t=>{let p=t||"root",d=r.querySelector(`[data-aipkit-settings-panel="${p}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!d)return;let u=d.dataset.aipkitSettingsPanel||"root";u!==o&&(i.forEach(f=>{f.hidden=f!==d}),s&&(s.textContent=l[u]||l.root),n&&(n.hidden=u==="root"),o=u,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",t=>{let p=t.target.closest("[data-aipkit-panel-target]");if(!p)return;t.preventDefault();let d=p.dataset.aipkitPanelTarget;e(d)}),n&&n.addEventListener("click",t=>{t.preventDefault(),e("root")}),c&&c.addEventListener("click",()=>{e("root")}),e("root"),r.dataset.panelsBound="true"}window.aipkitSources_initSettingsPopoverPanels=k})();(function(){"use strict";let k=window.wp&&window.wp.i18n?window.wp.i18n:null,a=k&&typeof k.__=="function"?k.__:F=>F,r=k&&typeof k.sprintf=="function"?k.sprintf:(F,...P)=>F.replace(/%s/g,()=>P.shift()),i=k&&typeof k._n=="function"?k._n:(F,P,R)=>R===1?F:P,s=typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml:F=>String(F??""),n=60,c={openai:{singular:a("Vector store","gpt3-ai-content-generator"),plural:a("Vector stores","gpt3-ai-content-generator"),loading:a("Loading vector stores...","gpt3-ai-content-generator"),empty:a("No vector stores found.","gpt3-ai-content-generator")},pinecone:{singular:a("Index","gpt3-ai-content-generator"),plural:a("Indexes","gpt3-ai-content-generator"),loading:a("Loading indexes...","gpt3-ai-content-generator"),empty:a("No indexes found.","gpt3-ai-content-generator")},qdrant:{singular:a("Collection","gpt3-ai-content-generator"),plural:a("Collections","gpt3-ai-content-generator"),loading:a("Loading collections...","gpt3-ai-content-generator"),empty:a("No collections found.","gpt3-ai-content-generator")},default:{singular:a("Index","gpt3-ai-content-generator"),plural:a("Indexes","gpt3-ai-content-generator"),loading:a("Loading indexes...","gpt3-ai-content-generator"),empty:a("No indexes found.","gpt3-ai-content-generator")}},l={openai:{key:"openai",typeLabel:a("Vector stores","gpt3-ai-content-generator"),emptyLabel:a("No vector stores found.","gpt3-ai-content-generator"),loadingLabel:a("Loading vector stores...","gpt3-ai-content-generator"),listAction:"aipkit_list_vector_stores_openai",listKey:"stores",createAction:"aipkit_create_vector_store_openai",createKey:"store",nameLabel:a("Store name","gpt3-ai-content-generator"),namePlaceholder:a("e.g. Product FAQ","gpt3-ai-content-generator"),countSingular:a("store","gpt3-ai-content-generator"),countPlural:a("stores","gpt3-ai-content-generator"),needsDimension:!1},pinecone:{key:"pinecone",typeLabel:a("Indexes","gpt3-ai-content-generator"),emptyLabel:a("No indexes found.","gpt3-ai-content-generator"),loadingLabel:a("Loading indexes...","gpt3-ai-content-generator"),listAction:"aipkit_list_indexes_pinecone",listKey:"indexes",createAction:"aipkit_create_index_pinecone",createKey:"index",nameLabel:a("Index name","gpt3-ai-content-generator"),namePlaceholder:a("e.g. site-content","gpt3-ai-content-generator"),countSingular:a("index","gpt3-ai-content-generator"),countPlural:a("indexes","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536},qdrant:{key:"qdrant",typeLabel:a("Collections","gpt3-ai-content-generator"),emptyLabel:a("No collections found.","gpt3-ai-content-generator"),loadingLabel:a("Loading collections...","gpt3-ai-content-generator"),listAction:"aipkit_list_collections_qdrant",listKey:"collections",createAction:"aipkit_create_collection_qdrant",createKey:"collection",nameLabel:a("Collection name","gpt3-ai-content-generator"),namePlaceholder:a("e.g. docs","gpt3-ai-content-generator"),countSingular:a("collection","gpt3-ai-content-generator"),countPlural:a("collections","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536}},o={openai:"aipkit_vector_store_nonce_openai",pinecone:"aipkit_vector_store_pinecone_nonce_management",qdrant:"aipkit_vector_store_qdrant_nonce_management"},e={openai:{action:"aipkit_delete_vector_store_openai",param:"store_id",label:a("vector store","gpt3-ai-content-generator")},pinecone:{action:"aipkit_delete_index_pinecone",param:"index_name",label:a("index","gpt3-ai-content-generator")},qdrant:{action:"aipkit_delete_collection_qdrant",param:"collection_name",label:a("collection","gpt3-ai-content-generator")}},t="aipkit_sources_filters_v1";function p(){try{let F=window.localStorage.getItem(t);if(!F)return{};let P=JSON.parse(F);return P&&typeof P=="object"?P:{}}catch{return{}}}function d(F){try{window.localStorage.setItem(t,JSON.stringify(F))}catch{}}function u(F){if(!F)return[];try{let P=JSON.parse(F);return Array.isArray(P)?P:[]}catch{return[]}}function f(F,P){return F?F.length>P?`${F.slice(0,P)}...`:F:""}function m(F){return String(F||"").trim().toLowerCase()}function g(F){return l[m(F)]||null}function _(F){return e[m(F)]||null}function h(F){let P=m(F);return c[P]||c.default}function y(){let F=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return F&&typeof F=="object"?F:{}}function E(F){let P=m(F),R=y();return Object.prototype.hasOwnProperty.call(R,P)?!!R[P]:null}function x(F){let P=E(F);return P===!0?{label:a("Connected","gpt3-ai-content-generator"),className:"aipkit_status-success"}:P===!1?{label:a("Needs setup","gpt3-ai-content-generator"),className:"aipkit_status-warning"}:{label:a("Unknown","gpt3-ai-content-generator"),className:"aipkit_status-info"}}function w(F,P){return!P||typeof P!="object"?"":F==="openai"?P.id||P.vector_store_id||"":F==="pinecone"?P.name||P.id||"":F==="qdrant"?P.name||P.id||P.collection_name||"":P.id||P.name||""}function S(F,P){let R=w(F,P);return!P||typeof P!="object"?R||"\u2014":P.name||P.vector_store_name||R||"\u2014"}function T(F){let P=m(F);return P==="openai"?"openaiVectorStores":P==="pinecone"?"pineconeIndexes":P==="qdrant"?"qdrantCollections":""}function v(F,P){let R=T(F);if(!R)return;(!window.aipkit_chat_config||typeof window.aipkit_chat_config!="object")&&(window.aipkit_chat_config={});let O=Array.isArray(P)?P:[];window.aipkit_chat_config[R]=O,typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),window.dispatchEvent(new CustomEvent("aipkit:vector-store-list-updated",{detail:{provider:m(F),stores:O}}))}function A(F){let P=String(F?.message||"").toLowerCase(),R=m(F?.provider||""),O=String(F?.file_id||""),N=!!F?.post_id;if(P.includes("file content submitted for indexing")||P.includes("file content embedded and upserted")||P.includes("original filename:")||P.includes("file uploaded"))return{key:"file",label:a("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if((R==="pinecone"||R==="qdrant")&&O&&(O.includes("pinecone_file_")||O.includes("file_"))&&!O.startsWith("wp_post_")&&!O.startsWith("text_"))return{key:"file",label:a("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if(P.includes("text content submitted for indexing"))return{key:"text",label:a("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(R==="qdrant"&&P.includes("points upserted to qdrant"))return N||P.includes("post id:")?{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"}:{key:"text",label:a("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(R==="pinecone"&&P.includes("vectors upserted")){if(O.startsWith("wp_post_"))return{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(O.startsWith("text_"))return{key:"text",label:a("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(O.includes("pinecone_file_")||O.includes("file_"))return{key:"file",label:a("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"}}if(P.includes("wordpress post content submitted for indexing"))return{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(N)return{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(R==="pinecone"&&O){if(O.startsWith("wp_post_"))return{key:"site",label:a("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(O.startsWith("text_"))return{key:"text",label:a("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"}}return{key:"na",label:a("N/A","gpt3-ai-content-generator"),className:""}}function C(F){let P=F||"";return P==="indexed"||P==="skipped_already_indexed"||P==="success"?{label:a("Trained","gpt3-ai-content-generator"),className:"aipkit_status-success"}:P==="failed"?{label:P.replace(/_/g," "),className:"aipkit_status-warning"}:P?{label:P.replace(/_/g," "),className:"aipkit_status-info"}:{label:"\u2014",className:"aipkit_status-info"}}function b(F){return F.post_title?String(F.post_title):F.post_id?`${a("Post","gpt3-ai-content-generator")} #${F.post_id}`:F.indexed_content?String(F.indexed_content):F.message?String(F.message):F.file_id?String(F.file_id):F.vector_store_name?String(F.vector_store_name):"\u2014"}function L(F){let P=m(F);return P?{openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"}[P]||String(F):"\u2014"}function B(F){let P=m(F);return P&&["openai","pinecone","qdrant"].includes(P)?`aipkit_settings_select_picker_icon--${P}`:""}function $(F){return F.vector_store_name?String(F.vector_store_name):F.vector_store_id?String(F.vector_store_id):"\u2014"}function W(F,P,R){if(!F)return;let O=F.classList.contains("aipkit_training_status");if(F.textContent=P||"",O){F.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),P&&F.classList.add("is-visible"),R&&F.classList.add(`is-${R}`);return}F.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),R==="success"?F.classList.add("aipkit_form-help-success"):R==="error"&&F.classList.add("aipkit_form-help-error")}function U(F,P,R){F&&(F.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${s(R)}</td></tr>`,P&&(P.innerHTML=""))}function D(F,P){if(!F)return;if(!Array.isArray(P)||!P.length){U(F,null,a("No sources found.","gpt3-ai-content-generator"));return}let R=P.map(O=>{let N=A(O),ie=C(O.status),J=O.status==="processing"||O.status==="queued",we=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(O.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(O.timestamp):O.timestamp||"\u2014",$e=L(O.provider),Ke=B(O.provider),Ue=Ke?`<span class="aipkit_settings_select_picker_icon ${s(Ke)}" aria-hidden="true"></span>`:"",it=$(O),_t=f(it,40),mt=$e?`${$e} \xB7 ${it}`:it,Ot=String(b(O)||"\u2014"),Nt=f(Ot,n),qe=O.indexed_content||"",qt=[];return N.key==="site"&&O.post_id&&O.vector_store_id&&O.file_id&&qt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
              data-provider="${s(O.provider||"")}"
              data-store-id="${s(O.vector_store_id||"")}"
              data-vector-id="${s(O.file_id||"")}"
              data-log-id="${s(O.id||"")}"
              data-post-id="${s(O.post_id||"")}"
              data-embedding-provider="${s(O.embedding_provider||"")}"
              data-embedding-model="${s(O.embedding_model||"")}"
              ${J?'disabled aria-disabled="true"':""}
            >${s(a(J?"Training...":"Retrain","gpt3-ai-content-generator"))}</button>`),N.key==="text"&&qe&&O.vector_store_id&&O.file_id&&qt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
              data-provider="${s(O.provider||"")}"
              data-store-id="${s(O.vector_store_id||"")}"
              data-vector-id="${s(O.file_id||"")}"
              data-log-id="${s(O.id||"")}"
              data-embedding-provider="${s(O.embedding_provider||"")}"
              data-embedding-model="${s(O.embedding_model||"")}"
              data-content="${s(encodeURIComponent(qe))}"
              ${J?'disabled aria-disabled="true"':""}
            >${s(a(J?"Training...":"Edit","gpt3-ai-content-generator"))}</button>`),qe&&qt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_view"
              data-snippet="${s(qe)}"
              ${J?'disabled aria-disabled="true"':""}
            >${s(a("View","gpt3-ai-content-generator"))}</button>`),O.file_id&&qt.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
              data-provider="${s(O.provider||"")}"
              data-store-id="${s(O.vector_store_id||"")}"
              data-vector-id="${s(O.file_id||"")}"
              data-log-id="${s(O.id||"")}"
              ${J?'disabled aria-disabled="true"':""}
            >${s(a("Delete","gpt3-ai-content-generator"))}</button>`),`<tr data-log-id="${s(O.id||"")}">
          <td>${s(we)}</td>
          <td title="${s(mt)}">
            <span class="aipkit_popover_option_label_group">
              ${Ue}
              <span>${s(_t)}</span>
            </span>
          </td>
          <td><span class="aipkit_content-type-tag ${s(N.className)}">${s(N.label)}</span></td>
          <td title="${s(Ot)}">${s(Nt)}</td>
          <td><span class="aipkit_status-tag ${s(ie.className)}">${s(ie.label)}</span></td>
          <td class="aipkit_actions_cell">
            <div class="aipkit-table-actions-group">${qt.join("")}</div>
          </td>
        </tr>`}).join("");F.innerHTML=R}function H(F,P,R){if(!P)return;P.innerHTML="";let O=Number(F?.total_logs||0),N=Number(F?.total_pages||0),ie=Number(F?.current_page||1);if(!O)return;let J=document.createElement("span");if(J.className="aipkit_pagination-count",J.textContent=`${O.toLocaleString()} ${i("source","sources",O,"gpt3-ai-content-generator")}`,P.appendChild(J),N<=1)return;let we=document.createElement("span");we.className="aipkit_pagination-links";let $e=document.createElement("button");$e.type="button",$e.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",$e.textContent=a("Prev","gpt3-ai-content-generator"),$e.disabled=ie<=1,$e.addEventListener("click",()=>R(ie-1));let Ke=document.createElement("span");Ke.className="aipkit_pagination-current",Ke.textContent=`${ie}/${N}`;let Ue=document.createElement("button");Ue.type="button",Ue.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",Ue.textContent=a("Next","gpt3-ai-content-generator"),Ue.disabled=ie>=N,Ue.addEventListener("click",()=>R(ie+1)),we.appendChild($e),we.appendChild(Ke),we.appendChild(Ue),P.appendChild(we)}function Q(){let F=document.getElementById("aipkit_sources_module_container");if(!F)return;let P=document.getElementById("aipkit_sources_table_body"),R=document.getElementById("aipkit_sources_pagination"),O=document.getElementById("aipkit_sources_status"),N=document.getElementById("aipkit_sources_provider_filter"),ie=document.getElementById("aipkit_sources_index_filter"),J=document.getElementById("aipkit_sources_status_filter"),we=document.getElementById("aipkit_sources_type_filter"),$e=document.getElementById("aipkit_sources_search_input"),Ke=document.getElementById("aipkit_sources_provider_popover_body"),Ue=document.getElementById("aipkit_sources_settings_trigger"),it=document.getElementById("aipkit_sources_settings_popover"),_t=document.getElementById("aipkit_sources_indexing_manage"),mt=F.querySelector('[data-aipkit-settings-action="indexing-controls"]'),Ot=_t||mt,Nt=document.getElementById("aipkit_sources_settings_save"),qe=document.getElementById("aipkit_sources_settings_sheet"),qt=qe?qe.querySelector(".aipkit_builder_sheet_close"):null,Wt=document.getElementById("aipkit_save_indexing_settings_btn"),ui=document.getElementById("aipkit_indexing_settings_messages"),ae=document.getElementById("aipkit_sources_settings_sheet_messages"),Ce=document.getElementById("aipkit_sources_semantic_manage"),Ae=F.querySelector('[data-aipkit-settings-action="semantic-search"]'),Oe=Ce||Ae,Fe=document.getElementById("aipkit_sources_semantic_sheet"),We=Fe?Fe.querySelector(".aipkit_builder_sheet_close"):null,je=document.getElementById("aipkit_sources_semantic_vector_provider"),Qe=document.getElementById("aipkit_sources_semantic_target_id"),xt=document.getElementById("aipkit_sources_semantic_target_label"),bi=document.getElementById("aipkit_sources_semantic_embedding_model"),gt=document.getElementById("aipkit_sources_semantic_embedding_provider"),It=document.getElementById("aipkit_sources_semantic_num_results"),ze=document.getElementById("aipkit_sources_semantic_no_results_text"),Ye=document.getElementById("aipkit_sources_semantic_shortcode_copy"),Ze=document.getElementById("aipkit_sources_semantic_demo_form"),ei=document.getElementById("aipkit_sources_semantic_demo_input"),ci=document.getElementById("aipkit_sources_semantic_demo_results"),Jt=document.getElementById("aipkit_sources_semantic_demo_submit"),Gt=document.getElementById("aipkit_sources_index_empty_action"),Di=document.getElementById("aipkit_sources_index_create_trigger"),bt=document.getElementById("aipkit_sources_editor_modal"),di=bt?bt.querySelector(".aipkit_sources_editor_textarea"):null,Ht=bt?bt.querySelector(".aipkit_sources_editor_close"):null,Wi=bt?bt.querySelector(".aipkit_sources_editor_cancel"):null,Sn=bt?bt.querySelector(".aipkit_sources_editor_save"):null,Ki=document.getElementById("aipkit_sources_view_modal"),ln=Ki?Ki.querySelector(".aipkit_sources_view_textarea"):null,Vn=Ki?Ki.querySelector(".aipkit_sources_view_close"):null,_e=Ki?Ki.querySelector(".aipkit_sources_view_close_btn"):null,be=document.getElementById("aipkit_sources_delete_modal"),Te=be?be.querySelector(".aipkit_sources_delete_close"):null,At=be?be.querySelector(".aipkit_sources_delete_cancel"):null,et=be?be.querySelector(".aipkit_sources_delete_confirm"):null;if(!P||typeof window.aipkit_apiRequest!="function")return;let Lt=p(),fi=Lt.indexByProvider&&typeof Lt.indexByProvider=="object"?{...Lt.indexByProvider}:{},Vt=Lt.embeddingByProvider&&typeof Lt.embeddingByProvider=="object"?{...Lt.embeddingByProvider}:{};N&&typeof Lt.provider=="string"&&Array.from(N.options).some(ee=>ee.value===Lt.provider)&&(N.value=Lt.provider),J&&typeof Lt.status=="string"&&Array.from(J.options).some(ee=>ee.value===Lt.status)&&(J.value=Lt.status),we&&typeof Lt.type=="string"&&Array.from(we.options).some(ee=>ee.value===Lt.type)&&(we.value=Lt.type),typeof window.aipkit_initChatSelectPickers=="function"&&window.aipkit_initChatSelectPickers();let hi=null,mi=null,Bi=null,gi=null,ti=null,ji=null,Pe={page:1,perPage:10,provider:N?N.value:"",status:J?J.value:"",type:we?we.value:"",search:$e?$e.value.trim():"",indexByProvider:fi,embeddingByProvider:Vt,openIndexCreateOnOpen:!1},pi={activeProvider:"",stores:{},syncTokens:{}},Hi={nonce:F.dataset.settingsNonce||"",isPro:F.dataset.settingsIsPro==="1"||F.dataset.settingsIsPro==="true"},En={initialized:!1,accordionsBound:!1,saveBound:!1,autosaveBound:!1,originalSettings:{}},Do=null,Ao=!1,Wo=!1,gn={nonce:F.dataset.semanticSearchNonce||"",pineconeIndexes:u(F.dataset.semanticPineconeIndexes),qdrantCollections:u(F.dataset.semanticQdrantCollections)},uo={initialized:!1,autosaveBound:!1,dirty:!1},Ca=null,Ho=!1,ta=!1,Vo={pinecone_api_key:F.dataset.pineconeApiKey||"",qdrant_api_key:F.dataset.qdrantApiKey||"",qdrant_url:F.dataset.qdrantUrl||""},ia=null,Mn=()=>{hi&&window.clearTimeout(hi),hi=window.setTimeout(()=>{W(O,"","")},3e3)},xr=()=>{gi&&window.clearTimeout(gi),gi=window.setTimeout(()=>{W(ui,"","")},3e3)},xa=()=>!ie||ie.disabled?"":ie.value||"",Uo=()=>!ie||!ie.id?null:document.getElementById(`${ie.id}_picker_btn`),Go=j=>{if(!ie)return;let ee=!j;ie.hidden=ee;let ce=Uo();ce&&(ce.hidden=ee)},na=(j,ee={})=>{if(!ie)return;ie.disabled=j;let ce=Uo();ce&&(ee.disableTrigger!==!1?(ce.disabled=j,j?ce.setAttribute("aria-disabled","true"):ce.removeAttribute("aria-disabled")):(ce.disabled=!1,ce.removeAttribute("aria-disabled")))},_o=(j,ee)=>{if(!Gt||!Di)return;Gt.hidden=!j;let ce=Uo();if(ce&&(j?ce.hidden=!0:(!ie||!ie.hidden)&&(ce.hidden=!1)),!j)return;let re=m(ee),me=h(re);Di.textContent=r(a("Create new %s","gpt3-ai-content-generator"),me.singular.toLowerCase());let Ie=E(re),Ee=!!re&&Ie!==!1;Di.disabled=!Ee,Ee?(Di.removeAttribute("aria-disabled"),Di.removeAttribute("title")):(Di.setAttribute("aria-disabled","true"),Di.setAttribute("title",a("Add credentials to create.","gpt3-ai-content-generator")))},oa=j=>{let ee=Uo();if(!ee||!j)return;let ce=j.getBoundingClientRect(),re={hidden:ee.hidden,style:ee.getAttribute("style")||""};ee.hidden=!1,ee.style.position="fixed",ee.style.left=`${Math.round(ce.left)}px`,ee.style.top=`${Math.round(ce.top)}px`,ee.style.width=`${Math.round(ce.width)}px`,ee.style.height=`${Math.round(ce.height)}px`,ee.style.opacity="0",ee.style.pointerEvents="none",ee.click();let me=()=>{ee.setAttribute("style",re.style),re.hidden&&(ee.hidden=!0)};window.requestAnimationFrame(()=>{window.requestAnimationFrame(me)})},aa=()=>!ie||!ie.id?null:document.getElementById(`${ie.id}_picker_popover`),An=()=>{let j=aa();if(!j)return null;j.classList.add("aipkit_sources_index_picker_popover");let ee=j.querySelector(".aipkit_model_settings_popover_body");if(!ee)return null;let ce=ee.querySelector(".aipkit_sources_index_picker_actions");return ce||(ce=document.createElement("div"),ce.className="aipkit_sources_index_picker_actions",ce.innerHTML=`
          <div class="aipkit_sources_index_action_list">
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_sources_index_new_btn">
              <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
              ${Yt(a("New","gpt3-ai-content-generator"))}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_delete_btn" disabled aria-disabled="true">
              <span class="dashicons dashicons-trash" aria-hidden="true"></span>
              ${Yt(a("Delete","gpt3-ai-content-generator"))}
            </button>
          </div>
          <div class="aipkit_sources_index_inline_form" style="display: none;">
            <div class="aipkit_popover_options_list">
              <div class="aipkit_popover_option_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label aipkit_sources_index_create_label" for="aipkit_sources_index_name_input">
                    ${Yt(a("Create","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="text"
                      id="aipkit_sources_index_name_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--vector-wide aipkit_popover_option_input--framed"
                      placeholder=""
                      data-aipkit-provider-name-input
                    >
                  </div>
                </div>
              </div>
              <div class="aipkit_popover_option_row aipkit_sources_index_dimension_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label" for="aipkit_sources_index_dimension_input">
                    ${Yt(a("Dimension","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="number"
                      id="aipkit_sources_index_dimension_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--compact aipkit_popover_option_input--framed"
                      min="1"
                      placeholder="${Yt(a("e.g. 1536","gpt3-ai-content-generator"))}"
                      data-aipkit-provider-dimension-input
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="aipkit_sources_index_inline_actions">
              <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_create">
                ${Yt(a("Cancel","gpt3-ai-content-generator"))}
              </button>
              <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_sources_index_create_btn">
                ${Yt(a("Create","gpt3-ai-content-generator"))}
              </button>
            </div>
          </div>
          <div class="aipkit_inline_confirm aipkit_sources_index_inline_confirm" style="display: none;">
            <div class="aipkit_inline_confirm_content">
              <p class="aipkit_builder_help_text aipkit_sources_index_delete_confirm_text"></p>
              <div class="aipkit_inline_confirm_actions">
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_confirm_delete">
                  ${Yt(a("Confirm","gpt3-ai-content-generator"))}
                </button>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_delete">
                  ${Yt(a("Cancel","gpt3-ai-content-generator"))}
                </button>
              </div>
            </div>
          </div>
          <p class="aipkit_form-help aipkit_sources_index_status" aria-live="polite" style="display: none;"></p>
        `,ee.appendChild(ce)),ce},fo=()=>{let j=An();return j?{footer:j,actionList:j.querySelector(".aipkit_sources_index_action_list"),newButton:j.querySelector(".aipkit_sources_index_new_btn"),deleteButton:j.querySelector(".aipkit_sources_index_delete_btn"),inlineForm:j.querySelector(".aipkit_sources_index_inline_form"),createButton:j.querySelector(".aipkit_sources_index_create_btn"),cancelCreate:j.querySelector(".aipkit_sources_index_cancel_create"),nameInput:j.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:j.querySelector("[data-aipkit-provider-dimension-input]"),dimensionRow:j.querySelector(".aipkit_sources_index_dimension_row"),createLabel:j.querySelector(".aipkit_sources_index_create_label"),deleteConfirm:j.querySelector(".aipkit_sources_index_inline_confirm"),deleteConfirmText:j.querySelector(".aipkit_sources_index_delete_confirm_text"),confirmDelete:j.querySelector(".aipkit_sources_index_confirm_delete"),cancelDelete:j.querySelector(".aipkit_sources_index_cancel_delete"),statusEl:j.querySelector(".aipkit_sources_index_status")}:null},Lo=(j,ee)=>{let ce=fo(),re=O||(ce?ce.statusEl:null);re&&(W(re,j,ee),ce&&re===ce.statusEl&&(re.style.display=j?"block":"none"))},qo=()=>{Bi&&window.clearTimeout(Bi),Bi=window.setTimeout(()=>{Lo("","")},3e3)},Rn=()=>{let j=fo();j&&(j.inlineForm&&(j.inlineForm.style.display="none"),j.deleteConfirm&&(j.deleteConfirm.style.display="none"),j.actionList&&(j.actionList.style.display=""),j.nameInput&&(j.nameInput.value=""),j.dimensionInput&&(j.dimensionInput.value=""),Lo("",""))},Bn=j=>{let ee=fo();if(!ee)return;let ce=m(j),re=ce?E(ce):null,me=!!ce&&re!==!1,Ie=me&&!!(ie&&ie.value);ee.nameInput&&(ee.nameInput.disabled=!me),ee.dimensionInput&&(ee.dimensionInput.disabled=!me),ee.newButton&&(ee.newButton.disabled=!me,me?ee.newButton.removeAttribute("aria-disabled"):ee.newButton.setAttribute("aria-disabled","true")),ee.createButton&&(ee.createButton.disabled=!me,me?ee.createButton.removeAttribute("aria-disabled"):ee.createButton.setAttribute("aria-disabled","true")),ee.deleteButton&&(ee.deleteButton.disabled=!Ie,Ie?ee.deleteButton.removeAttribute("aria-disabled"):ee.deleteButton.setAttribute("aria-disabled","true"))},Aa=j=>{let ee=fo();if(!ee||!ee.dimensionInput)return;let ce=m(j),re=g(ce);if(!re||!re.needsDimension)return;let me=re.defaultDimension||1536;ee.dimensionInput.value||(ee.dimensionInput.value=String(me))},Fn=j=>{let ee=fo();if(!ee)return;let ce=m(j),re=g(ce),me=h(ce),Ie=re?re.namePlaceholder:"",Ee=re?re.nameLabel:me.singular;ee.createLabel&&(ee.createLabel.textContent=me.singular),ee.nameInput&&(ee.nameInput.placeholder=Ie,ee.nameInput.setAttribute("aria-label",Ee)),ee.dimensionRow&&(ee.dimensionRow.style.display=re&&re.needsDimension?"":"none"),Bn(ce)},zn=()=>{let j=fo();if(!j||j.footer.dataset.indexActionsBound==="true")return;j.newButton&&j.newButton.addEventListener("click",()=>{Rn(),j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display=""),Aa(N?N.value:""),j.nameInput&&(j.nameInput.focus(),j.nameInput.select())}),j.cancelCreate&&j.cancelCreate.addEventListener("click",()=>{Rn()}),j.deleteButton&&j.deleteButton.addEventListener("click",()=>{let ce=m(N?N.value:""),re=ie?ie.value:"";if(!ce||!re){let Ne=h(ce);Lo(r(a("Select a %s to delete.","gpt3-ai-content-generator"),Ne.singular.toLowerCase()),"error"),qo();return}let me=ie&&ie.selectedOptions?ie.selectedOptions[0]:null,Ie=me?me.textContent:re,Ee=_(ce),Re=Ee?Ee.label:h(ce).singular.toLowerCase();j.deleteConfirmText&&(j.deleteConfirmText.textContent=r(a('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Re,Ie)),j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display="none"),j.deleteConfirm&&(j.deleteConfirm.style.display="")}),j.cancelDelete&&j.cancelDelete.addEventListener("click",()=>{Rn()}),j.createButton&&j.createButton.addEventListener("click",async()=>{let ce=m(N?N.value:"");if(!ce)return;let re=await Mo(ce,j.createButton,{root:j.inlineForm,statusUpdater:Lo,clearStatusSoon:qo});Bn(ce),re&&re.success&&Rn()}),j.confirmDelete&&j.confirmDelete.addEventListener("click",async()=>{let ce=m(N?N.value:""),re=ie?ie.value:"";if(!ce||!re)return;let me=ie&&ie.selectedOptions?ie.selectedOptions[0]:null,Ie=me?me.textContent:re,Ee=await Po(ce,re,Ie,j.confirmDelete,{skipConfirm:!0,statusUpdater:Lo,clearStatusSoon:qo,defaultLabel:a("Confirm","gpt3-ai-content-generator")});Un(),Ee&&(Rn(),yn(1))}),j.footer.dataset.indexActionsBound="true";let ee=Uo();ee&&ee.dataset.indexActionsBound!=="true"&&(ee.addEventListener("click",()=>{Rn(),Fn(Pe.provider||""),Pe.openIndexCreateOnOpen&&(Pe.openIndexCreateOnOpen=!1,j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display=""),Aa(Pe.provider||""),j.nameInput&&(j.nameInput.focus(),j.nameInput.select()))}),ee.dataset.indexActionsBound="true")},Qn=(j,ee,ce={})=>{if(!ie)return;let re=m(j),me=re&&Pe.indexByProvider[re]||"",Ie=h(re),Ee=!!re;Go(Ee),ie.dataset.aipkitPickerTitle=Ie.singular;let Re=document.getElementById(`${ie.id}_picker_title`);Re&&(Re.textContent=Ie.singular);let Ne=document.getElementById(`${ie.id}_picker_search`);if(Ne){let ft=Ie.singular?`Search ${Ie.singular.toLowerCase()}...`:a("Search...","gpt3-ai-content-generator");Ne.setAttribute("placeholder",ft)}if(ie.innerHTML="",!Ee){let ft=document.createElement("option");ft.value="",ft.textContent=Ie.plural,ie.appendChild(ft),ie.value="",na(!0),_o(!1,re),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(re);return}if(ce.loading){let ft=document.createElement("option");ft.value="",ft.textContent=Ie.loading,ft.disabled=!0,ie.appendChild(ft),ie.value="",na(!0,{disableTrigger:!1}),_o(!1,re),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(re);return}let Me=Array.isArray(ee)?ee:[];if(!Me.length){let ft=document.createElement("option");ft.value="",ft.textContent=ce.emptyLabel||Ie.empty,ft.disabled=!0,ie.appendChild(ft),ie.value="",na(!0,{disableTrigger:!1}),_o(!0,re),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(re);return}let dt=document.createElement("option");dt.value="",dt.textContent=r(a("All %s","gpt3-ai-content-generator"),Ie.plural.toLowerCase()),ie.appendChild(dt),Me.forEach(ft=>{let Xi=w(re,ft),Li=S(re,ft);if(!Xi)return;let Tt=document.createElement("option");Tt.value=Xi,Tt.textContent=Li||Xi,ie.appendChild(Tt)});let Rt=Pe.indexByProvider[re]||"",ii=Rt?Me.some(ft=>w(re,ft)===Rt):!1;Rt&&!ii&&(Pe.indexByProvider[re]=""),ie.value=ii?Rt:"",na(!1),_o(!1,re),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),re&&me!==Pe.indexByProvider[re]&&d({provider:Pe.provider,status:Pe.status,type:Pe.type,indexByProvider:Pe.indexByProvider,embeddingByProvider:Pe.embeddingByProvider}),zn(),Fn(re)},mo=()=>ui||O||(Ke?Ke.querySelector("#aipkit_sources_provider_panel_status"):null),an=(j,ee)=>{let ce=mo();W(ce,j,ee)},kn=()=>{mi&&window.clearTimeout(mi),mi=window.setTimeout(()=>{an("","")},3e3)},La=()=>{Ki&&(Ki.classList.remove("aipkit-active"),Ki.setAttribute("aria-hidden","true"),ln&&(ln.value=""))},Cn=j=>{!Ki||!ln||(ln.value=j||"",ln.scrollTop=0,Ki.classList.add("aipkit-active"),Ki.setAttribute("aria-hidden","false"),ln.focus())},Jn=()=>{bt&&(bt.classList.remove("aipkit-active"),bt.setAttribute("aria-hidden","true"),bt.dataset.provider="",bt.dataset.storeId="",bt.dataset.vectorId="",bt.dataset.logId="",bt.dataset.embeddingProvider="",bt.dataset.embeddingModel="",di&&(di.value=""))},er=j=>{!bt||!di||(bt.dataset.provider=j.dataset.provider||"",bt.dataset.storeId=j.dataset.storeId||"",bt.dataset.vectorId=j.dataset.vectorId||"",bt.dataset.logId=j.dataset.logId||"",bt.dataset.embeddingProvider=j.dataset.embeddingProvider||"",bt.dataset.embeddingModel=j.dataset.embeddingModel||"",di.value=j.dataset.content?decodeURIComponent(j.dataset.content):"",bt.classList.add("aipkit-active"),bt.setAttribute("aria-hidden","false"),setTimeout(()=>di.focus(),0))},go=()=>{be&&(be.classList.remove("aipkit-active"),be.setAttribute("aria-hidden","true"),be.dataset.provider="",be.dataset.storeId="",be.dataset.vectorId="",be.dataset.logId="")},Io=j=>{be&&(be.dataset.provider=j.provider||"",be.dataset.storeId=j.storeId||"",be.dataset.vectorId=j.vectorId||"",be.dataset.logId=j.logId||"",be.classList.add("aipkit-active"),be.setAttribute("aria-hidden","false"),et&&(et.disabled=!1))},Ii=j=>{let ee=document.getElementById(j);return ee?ee.value:""},hn=j=>{let ee=o[m(j)];return ee?Ii(ee):""},dn=()=>{let j={...y()};return j.pinecone=!!Vo.pinecone_api_key,j.qdrant=!!(Vo.qdrant_api_key&&Vo.qdrant_url),window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=j,j};dn();let To=j=>j.startsWith("pinecone_")?"pinecone":j.startsWith("qdrant_")?"qdrant":"",tr=async()=>{if(!Ke)return;let j=Ke.querySelectorAll("[data-aipkit-provider-config]");if(!j.length)return;let ee={},ce=!1,re=new Set;if(j.forEach(me=>{let Ie=me.dataset.aipkitProviderConfig;if(!Ie)return;let Ee=me.value.trim();if(ee[Ie]=Ee,Vo[Ie]!==Ee){ce=!0;let Re=To(Ie);Re&&re.add(Re)}}),!!ce){an(a("Saving...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",ee),Object.keys(ee).forEach(me=>{Vo[me]=ee[me]}),dn(),Un(),re.forEach(me=>{E(me)!==!1&&(pi.activeProvider===me?pn(me,{silent:!0}):pi.stores[me]=null)}),an(a("Saved","gpt3-ai-content-generator"),"success"),kn()}catch(me){let Ie=me&&me.message?me.message:a("Save failed.","gpt3-ai-content-generator");an(`${a("Error:","gpt3-ai-content-generator")} ${Ie}`,"error"),kn()}}},ra=()=>{ia&&window.clearTimeout(ia),ia=window.setTimeout(()=>{tr()},600)},Yn=(j=Ke)=>j?{nameInput:j.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:j.querySelector("[data-aipkit-provider-dimension-input]"),deleteButton:j.querySelector("[data-aipkit-provider-delete-selected]")}:{},Un=()=>{let j=m(N?N.value:Ke?.dataset.provider||""),ee=ie?ie.value:"",ce=!!j&&!!ee&&E(j)===!0,{deleteButton:re}=Yn();re&&(re.disabled=!ce,ce?re.removeAttribute("aria-disabled"):re.setAttribute("aria-disabled","true")),Bn(j)},$n=(j,ee,ce={})=>{let re=m(j),me=m(N?N.value:"");if(!re){Qn("",[]),Un();return}re===me&&(Qn(re,ee,{loading:ce.loading===!0,emptyLabel:ce.emptyLabel}),Un())},Xn=(j,ee,ce,re)=>{j&&(ee?(j.disabled=!0,j.setAttribute("aria-disabled","true"),j.textContent=re):(j.disabled=!1,j.removeAttribute("aria-disabled"),j.textContent=ce))},pn=async(j,ee={})=>{let ce=g(j);if(!ce)return;let re=m(j),me=ee.silent===!0;if(E(re)===!1){an(a("Add provider credentials to load stores.","gpt3-ai-content-generator"),"error"),kn();return}let Ee=hn(re);if(!Ee){an(a("Provider nonce missing.","gpt3-ai-content-generator"),"error"),kn();return}let Re=`${re}-${Date.now()}`;pi.syncTokens[re]=Re,$n(re,pi.stores[re],{loading:!0}),me||an(a("Syncing stores...","gpt3-ai-content-generator"),"");let Ne={_ajax_nonce:Ee};re==="openai"&&(Ne.limit=100,Ne.order="desc");let Me=ee.triggerButton||(Ke&&Ke.dataset.provider===re?Ke.querySelector(".aipkit_sources_provider_sync"):null);Xn(Me,!0,a("Sync","gpt3-ai-content-generator"),a("Syncing...","gpt3-ai-content-generator"));try{let dt=await window.aipkit_apiRequest(ce.listAction,Ne);if(pi.syncTokens[re]!==Re)return;let Rt=Array.isArray(dt[ce.listKey])?dt[ce.listKey]:[];pi.stores[re]=Rt,v(re,Rt),re==="pinecone"?gn.pineconeIndexes=Rt:re==="qdrant"&&(gn.qdrantCollections=Rt),je&&m(je.value)===re&&ko(re,{preserveValue:!0}),pi.activeProvider===re&&$n(re,Rt),me||(an(dt.message||a("Stores synced.","gpt3-ai-content-generator"),"success"),kn())}catch(dt){if(pi.syncTokens[re]!==Re)return;let Rt=dt&&dt.message?dt.message:a("Sync failed.","gpt3-ai-content-generator");an(`${a("Error:","gpt3-ai-content-generator")} ${Rt}`,"error"),kn(),$n(re,pi.stores[re])}finally{Xn(Me,!1,a("Sync","gpt3-ai-content-generator"),a("Syncing...","gpt3-ai-content-generator"))}},Po=async(j,ee,ce,re,me={})=>{let Ie=_(j);if(!Ie)return!1;let Ee=m(j),Re=typeof me.statusUpdater=="function"?me.statusUpdater:an,Ne=typeof me.clearStatusSoon=="function"?me.clearStatusSoon:kn,Me=me.defaultLabel||(re?re.textContent.trim():"")||a("Delete","gpt3-ai-content-generator"),dt=me.loadingLabel||a("Deleting...","gpt3-ai-content-generator"),Rt=!1;if(!ee)return Re(a("Missing store identifier.","gpt3-ai-content-generator"),"error"),Ne(),!1;let ii=ce||ee,ft=r(a('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Ie.label,ii);if(me.skipConfirm!==!0&&!window.confirm(ft))return!1;let Xi=hn(Ee);if(!Xi)return Re(a("Provider nonce missing.","gpt3-ai-content-generator"),"error"),Ne(),!1;Xn(re,!0,Me,dt),Re(a("Deleting...","gpt3-ai-content-generator"),"");let Li={_ajax_nonce:Xi};Li[Ie.param]=ee;try{let Tt=await window.aipkit_apiRequest(Ie.action,Li),ki=(Array.isArray(pi.stores[Ee])?pi.stores[Ee]:[]).filter(Ti=>w(Ee,Ti)!==ee);pi.stores[Ee]=ki,v(Ee,ki),Ee==="pinecone"?gn.pineconeIndexes=ki:Ee==="qdrant"&&(gn.qdrantCollections=ki),je&&m(je.value)===Ee&&ko(Ee,{preserveValue:!0}),pi.activeProvider===Ee&&$n(Ee,ki),Re(Tt.message||a("Deleted.","gpt3-ai-content-generator"),"success"),Ne(),Rt=!0}catch(Tt){let _i=Tt&&Tt.message?Tt.message:a("Delete failed.","gpt3-ai-content-generator");Re(`${a("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Ne()}finally{Xn(re,!1,Me,dt)}return Rt},Mo=async(j,ee,ce={})=>{let re=g(j);if(!re)return{success:!1,createdId:""};let me=m(j),Ie=typeof ce.statusUpdater=="function"?ce.statusUpdater:an,Ee=typeof ce.clearStatusSoon=="function"?ce.clearStatusSoon:kn,Re=!1,Ne="";if(E(me)===!1)return Ie(a("Add provider credentials to create stores.","gpt3-ai-content-generator"),"error"),Ee(),{success:!1,createdId:""};let dt=hn(me);if(!dt)return Ie(a("Provider nonce missing.","gpt3-ai-content-generator"),"error"),Ee(),{success:!1,createdId:""};let{nameInput:Rt,dimensionInput:ii}=Yn(ce.root||Ke),ft=Rt?Rt.value.trim():"";if(!ft)return Ie(a("Name is required.","gpt3-ai-content-generator"),"error"),Ee(),{success:!1,createdId:""};let Xi=0;if(re.needsDimension&&(Xi=ii?parseInt(ii.value,10):0,!Xi||Number.isNaN(Xi)))return Ie(a("Dimension is required.","gpt3-ai-content-generator"),"error"),Ee(),{success:!1,createdId:""};Xn(ee,!0,a("Create","gpt3-ai-content-generator"),a("Creating...","gpt3-ai-content-generator")),Ie(a("Creating...","gpt3-ai-content-generator"),"");let Li={_ajax_nonce:dt,name:ft};re.needsDimension&&(Li.dimension=Xi),me==="openai"&&(Li.source_type="sources_module_create");try{let Tt=await window.aipkit_apiRequest(re.createAction,Li),_i=Tt[re.createKey];if(_i){let ki=Array.isArray(pi.stores[me])?pi.stores[me].slice():[];Ne=w(me,_i),Ne&&ki.some(Ti=>w(me,Ti)===Ne)||ki.unshift(_i),pi.stores[me]=ki,v(me,pi.stores[me]),me==="pinecone"?gn.pineconeIndexes=pi.stores[me]:me==="qdrant"&&(gn.qdrantCollections=pi.stores[me]),je&&m(je.value)===me&&ko(me,{preserveValue:!0}),pi.activeProvider===me&&$n(me,pi.stores[me])}else await pn(me);Rt&&(Rt.value=""),ii&&(ii.value=""),Ie(Tt.message||a("Store created.","gpt3-ai-content-generator"),"success"),Ee(),Re=!0}catch(Tt){let _i=Tt&&Tt.message?Tt.message:a("Create failed.","gpt3-ai-content-generator");Ie(`${a("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Ee()}finally{Xn(ee,!1,a("Create","gpt3-ai-content-generator"),a("Creating...","gpt3-ai-content-generator"))}return{success:Re,createdId:Ne}},Dn=j=>{let ee=m(j);if(pi.activeProvider=ee,Rn(),!ee)Qn("",[]);else{let ce=pi.stores[ee];if(Array.isArray(ce))$n(ee,ce);else if(E(ee))$n(ee,[],{loading:!0}),pn(ee,{silent:!0});else{let re=h(ee);$n(ee,[],{emptyLabel:r(a("Add credentials to load %s.","gpt3-ai-content-generator"),re.plural.toLowerCase())})}}Un()},sa=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():`text_${Date.now()}`,Bo=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now(),Fo=j=>typeof CSS<"u"&&CSS.escape?CSS.escape(String(j)):String(j).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),ir=async(j,ee,ce,re,me)=>{let Ie=j.toLowerCase();if(Ie==="openai"){let Ne=Ii("aipkit_vector_store_nonce_openai");if(!Ne)throw new Error(a("OpenAI nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:Ne,target_store_id:ee,text_content:ce,source_type:"text_entry_global_form"});return}if(!re||!me)throw new Error(a("Select an embedding model.","gpt3-ai-content-generator"));let Ee=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ce,embedding_provider:re,embedding_model:me}),Re=Ee.embeddings&&Ee.embeddings.length?Ee.embeddings[0]:null;if(!Re)throw new Error(a("Failed to generate embedding.","gpt3-ai-content-generator"));if(Ie==="pinecone"){let Ne=Ii("aipkit_vector_store_pinecone_nonce_management");if(!Ne)throw new Error(a("Pinecone nonce missing.","gpt3-ai-content-generator"));let Me=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:Ne,vectors:JSON.stringify([{id:Me,values:Re,metadata:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:ce,vector_id:Me}}]),embedding_provider:re,embedding_model:me,original_text_content:ce,index_name:ee});return}if(Ie==="qdrant"){let Ne=Ii("aipkit_vector_store_qdrant_nonce_management");if(!Ne)throw new Error(a("Qdrant nonce missing.","gpt3-ai-content-generator"));let Me=Bo(),dt={_ajax_nonce:Ne,vectors:JSON.stringify([{id:Me,vector:Re,payload:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:ce,vector_id:Me}}]),embedding_provider:re,embedding_model:me,original_text_content:ce,collection_name:ee,source_context:"sources_module_edit"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",dt);return}throw new Error(a("Unsupported provider for edit.","gpt3-ai-content-generator"))},Yt=window.aipkit_escapeHtml||(j=>j==null?"":String(j)),nr=(j,ee)=>{let ce=document.createElement("div");ce.className="aipkit_indexing_settings_section";let re=document.createElement("h5");re.textContent=a("Basic Labels","gpt3-ai-content-generator"),ce.appendChild(re);let me=document.createElement("table");me.className="wp-list-table widefat striped",me.innerHTML=`
        <thead>
          <tr>
            <th>${Yt(a("Label Type","gpt3-ai-content-generator"))}</th>
            <th>${Yt(a("Custom Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Ie=me.querySelector("tbody"),Ee=["source_url","title","excerpt","content"],Re=[a("Source URL","gpt3-ai-content-generator"),a("Title","gpt3-ai-content-generator"),a("Excerpt","gpt3-ai-content-generator"),a("Content","gpt3-ai-content-generator")];return Ee.forEach((Ne,Me)=>{let dt=ee&&ee[Ne]?ee[Ne]:Re[Me],Rt=En.originalSettings?.[j]?.basic_labels?.[Ne]||dt,ii=document.createElement("tr");ii.innerHTML=`
          <td><code>${Yt(Re[Me])}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Yt(j)}][basic_labels][${Yt(Ne)}]"
              value="${Yt(Rt)}"
              placeholder="${Yt(dt)}"
              ${Hi.isPro?"":"disabled"}
            >
          </td>
        `,Ie.appendChild(ii)}),ce.appendChild(me),ce},qa=(j,ee,ce,re)=>{let me=document.createElement("div");if(me.className="aipkit_indexing_settings_section",!re||Object.keys(re).length===0)return me.innerHTML=`<p><em>${Yt(r(a("No %s found for this content type.","gpt3-ai-content-generator"),j.toLowerCase()))}</em></p>`,me;let Ie=document.createElement("h5");Ie.textContent=j,me.appendChild(Ie);let Ee=document.createElement("table");Ee.className="wp-list-table widefat striped",Ee.innerHTML=`
        <thead>
          <tr>
            <th class="check-column">
              <input type="checkbox" class="aipkit-indexing-select-all" ${Hi.isPro?"":"disabled"} />
            </th>
            <th>${Yt(a("Field / Taxonomy","gpt3-ai-content-generator"))}</th>
            <th>${Yt(a("Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Re=Ee.querySelector("tbody");Object.keys(re).forEach(Me=>{let dt=re[Me],Rt=En.originalSettings?.[ee]?.[ce]?.[Me]||{},ii=typeof Rt.enabled=="boolean"?Rt.enabled:!0,ft=Rt.label||"",Xi=document.createElement("tr");Xi.innerHTML=`
          <th scope="row" class="check-column">
            <input
              type="checkbox"
              name="settings[${Yt(ee)}][${Yt(ce)}][${Yt(Me)}][enabled]"
              value="1"
              ${ii?"checked":""}
              ${Hi.isPro?"":"disabled"}
            >
          </th>
          <td><code>${Yt(Me)}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Yt(ee)}][${Yt(ce)}][${Yt(Me)}][label]"
              value="${Yt(ft)}"
              placeholder="${Yt(dt)}"
              ${Hi.isPro?"":"disabled"}
            >
          </td>
        `,Re.appendChild(Xi)});let Ne=Ee.querySelector(".aipkit-indexing-select-all");return Ne&&Ne.addEventListener("change",Me=>{Re.querySelectorAll('input[type="checkbox"]').forEach(dt=>{dt.checked=Me.target.checked})}),me.appendChild(Ee),me},Ia=(j,ee,ce)=>{let re=document.createElement("div");re.className="aipkit_accordion";let me=document.createElement("div");me.className="aipkit_accordion-header",me.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${Yt(ee)}`;let Ie=document.createElement("div");return Ie.className="aipkit_accordion-content",Ie.appendChild(nr(j,ce.basic_labels||{})),Ie.appendChild(qa(a("Custom Fields","gpt3-ai-content-generator"),j,"fields",ce.fields||{})),Ie.appendChild(qa(a("Taxonomies","gpt3-ai-content-generator"),j,"taxonomies",ce.taxonomies||{})),j==="product"&&ce.woo_attributes&&Ie.appendChild(qa(a("Product Data","gpt3-ai-content-generator"),j,"woo_attributes",ce.woo_attributes)),re.appendChild(me),re.appendChild(Ie),re},Ta=async()=>{let j=document.getElementById("aipkit_indexing_settings_form_container");if(j){if(j.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${Yt(a("Loading content types...","gpt3-ai-content-generator"))}</p>`,!Hi.nonce){j.innerHTML=`<p class="aipkit_text-danger">${Yt(a("Error: Security token is missing. Cannot load settings.","gpt3-ai-content-generator"))}</p>`;return}try{let ee=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:Hi.nonce}),ce={},re={};if(ee&&typeof ee.success<"u"){if(!ee.success)throw new Error(ee.data||"Failed to load content types.");ce=ee.data?.cpt_data||{},re=ee.data?.saved_settings||{}}else ee&&(ce=ee.cpt_data||{},re=ee.saved_settings||{});if(En.originalSettings=re||{},j.innerHTML="",!Object.keys(ce).length){j.innerHTML=`<p class="aipkit_text-center">${Yt(a("No content types found. Please add content and try again.","gpt3-ai-content-generator"))}</p>`;return}let me=document.createElement("div");me.className="aipkit_accordion-group",Object.keys(ce).forEach(Ee=>{let Re=ce[Ee];me.appendChild(Ia(Ee,Re.label||Ee,Re))}),j.appendChild(me);let Ie=document.getElementById("aipkit_indexing_settings_form");Ie&&!En.accordionsBound&&(Ie.addEventListener("click",Ee=>{let Re=Ee.target.closest(".aipkit_accordion-header");Re&&(Re.classList.toggle("aipkit_active"),Re.nextElementSibling&&Re.nextElementSibling.classList.toggle("aipkit_active"))}),En.accordionsBound=!0)}catch(ee){j.innerHTML=`<p class="aipkit_text-danger">${Yt(ee&&ee.message?ee.message:a("Failed to load content types.","gpt3-ai-content-generator"))}</p>`}}},or=()=>{let j=document.getElementById("aipkit_indexing_settings_form_container");if(!j)return{};let ee={},ce=document.getElementById("aipkit_hide_user_uploads_checkbox");ee.hide_user_uploads=ce?ce.checked:!0;let re=document.getElementById("aipkit_show_index_button_checkbox");ee.show_index_button=re?re.checked:!0;let me=document.getElementById("aipkit_chunk_avg_chars_per_token"),Ie=document.getElementById("aipkit_chunk_max_tokens_per_chunk"),Ee=document.getElementById("aipkit_chunk_overlap_tokens");if(me&&Ie&&Ee){let Re=parseInt(me.value,10),Ne=parseInt(Ie.value,10),Me=parseInt(Ee.value,10);Number.isNaN(Re)||(ee.chunk_avg_chars_per_token=Re),Number.isNaN(Ne)||(ee.chunk_max_tokens_per_chunk=Ne),Number.isNaN(Me)||(ee.chunk_overlap_tokens=Me)}return j.querySelectorAll('input[type="checkbox"]').forEach(Re=>{let Ne=Re.name.match(/[^[\]']+/g);if(Ne&&Ne.length===5&&Ne[4]==="enabled"){let[,Me,dt,Rt]=Ne;ee[Me]||(ee[Me]={}),ee[Me][dt]||(ee[Me][dt]={}),ee[Me][dt][Rt]||(ee[Me][dt][Rt]={}),ee[Me][dt][Rt].enabled=Re.checked}}),j.querySelectorAll('input[type="text"]').forEach(Re=>{let Ne=Re.name.match(/[^[\]']+/g);if(Ne&&Ne.length===5&&Ne[4]==="label"){let[,Me,dt,Rt]=Ne;ee[Me]||(ee[Me]={}),ee[Me][dt]||(ee[Me][dt]={}),ee[Me][dt][Rt]||(ee[Me][dt][Rt]={}),ee[Me][dt][Rt].label=Re.value.trim()}else if(Ne&&Ne.length===4&&Ne[2]==="basic_labels"){let[,Me,,dt]=Ne;ee[Me]||(ee[Me]={}),ee[Me].basic_labels||(ee[Me].basic_labels={}),ee[Me].basic_labels[dt]=Re.value.trim()}}),ee},ca=(j,ee)=>{if(!j)return;j.dataset.label||(j.dataset.label=j.textContent.trim());let ce=j.dataset.label||a("Save","gpt3-ai-content-generator"),re=j.querySelector(".aipkit_spinner"),me=j.querySelector(".aipkit_btn-text"),Ie=ee?a("Saving...","gpt3-ai-content-generator"):ce;me?me.textContent=Ie:j.textContent=Ie,re&&(re.style.display=ee?"inline-block":"none"),j.disabled=ee},Pa=(j,ee)=>{if(!ui)return;W(ui,ee,{success:"success",error:"error",info:"loading"}[j]||""),(j==="success"||j==="error")&&xr()},la=async(j={})=>{let{button:ee=null,mode:ce="manual"}=j;if(!Hi.nonce)return;ee&&ca(ee,!0),ce==="auto"&&Pa("info",a("Auto-saving...","gpt3-ai-content-generator"));let re=or();try{let me=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:Hi.nonce,settings:JSON.stringify(re)});En.originalSettings=re;let Ie=me.message||a("Settings saved!","gpt3-ai-content-generator");Pa("success",ce==="auto"?a("Saved","gpt3-ai-content-generator"):Ie)}catch(me){let Ie=me&&me.message?me.message:a("Failed to save settings.","gpt3-ai-content-generator");Pa("error",Ie)}finally{ee&&ca(ee,!1)}},ar=j=>{let ee=document.getElementById("aipkit_upgradeBtn");if(ee){ee.click();return}let ce=j&&j.dataset?j.dataset.upgradeUrl:"";ce&&window.open(ce,"_blank","noopener")},Ar=j=>{j.preventDefault();let ee=j.currentTarget;if(ee&&ee.dataset&&ee.dataset.upgradeOnly==="1"){ar(ee);return}la({button:j.currentTarget,mode:"manual"})},Ma=async()=>{if(Ao){Wo=!0;return}Ao=!0,await la({mode:"auto"}),Ao=!1,Wo&&(Wo=!1,Ma())},Ba=()=>{Hi.nonce&&(Do&&window.clearTimeout(Do),Do=window.setTimeout(()=>{Ma()},600))},Fa=()=>{if(En.autosaveBound)return;[{element:document.getElementById("aipkit_hide_user_uploads_checkbox"),events:["change"]},{element:document.getElementById("aipkit_show_index_button_checkbox"),events:["change"]},{element:document.getElementById("aipkit_chunk_avg_chars_per_token"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_max_tokens_per_chunk"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_overlap_tokens"),events:["input","change"]}].forEach(({element:ee,events:ce})=>{ee&&(ce.forEach(re=>{ee.addEventListener(re,Ba)}),ee.addEventListener("blur",Ba))}),En.autosaveBound=!0},oo=()=>{if(En.initialized)return!0;let j=document.getElementById("indexing-settings-tab-content");return j?j.dataset.initialized==="true"?(En.initialized=!0,!0):(Ta(),En.saveBound||(Wt&&Wt.addEventListener("click",Ar),En.saveBound=!0),Fa(),j.dataset.initialized="true",En.initialized=!0,!0):!1},rr=()=>{it&&(it.classList.remove("aipkit-active"),it.setAttribute("aria-hidden","true"),Ue&&Ue.setAttribute("aria-expanded","false"))},Ko=()=>{qe&&(qe.classList.add("aipkit-active"),qe.setAttribute("aria-hidden","false"),qt&&qt.focus())},da=()=>{qe&&(qe.classList.remove("aipkit-active"),qe.setAttribute("aria-hidden","true"))},sr=()=>ui||O,Ji=(j,ee)=>{let ce=sr();W(ce,j,ee)},On=()=>{ti&&window.clearTimeout(ti),ti=window.setTimeout(()=>{Ji("","")},3e3)},pa=j=>{if(!xt)return;let ee=h(j);xt.textContent=ee.singular},ko=(j,ee={})=>{if(!Qe)return;let ce=m(j),me=ee.preserveValue===!0?Qe.value:"";Qe.innerHTML=`<option value="">${Yt(a("-- Select --","gpt3-ai-content-generator"))}</option>`;let Ie=[];if(ce==="pinecone"?Ie=gn.pineconeIndexes:ce==="qdrant"&&(Ie=gn.qdrantCollections),Array.isArray(Ie)&&Ie.forEach(Ee=>{let Re=Ee?.name||Ee?.id||(typeof Ee=="string"?Ee:"");if(!Re)return;let Ne=document.createElement("option");Ne.value=Re,Ne.textContent=Re,Qe.appendChild(Ne)}),me&&Qe.querySelector(`option[value="${Fo(me)}"]`))Qe.value=me;else if(me){let Ee=document.createElement("option");Ee.value=me,Ee.textContent=`${me} (${a("Manual","gpt3-ai-content-generator")})`,Qe.appendChild(Ee),Qe.value=me}},ua=()=>{if(!gt||!bi)return;let j=bi.options[bi.selectedIndex];j&&j.dataset.provider&&(gt.value=j.dataset.provider)},wo=()=>({semantic_search_vector_provider:je?je.value:"",semantic_search_target_id:Qe?Qe.value:"",semantic_search_embedding_provider:gt?gt.value:"",semantic_search_embedding_model:bi?bi.value:"",semantic_search_num_results:It?It.value:"",semantic_search_no_results_text:ze?ze.value:""}),Zn=async(j={})=>{let ee=j.mode||"auto";ua();let ce=wo();if(ce.semantic_search_vector_provider){ee==="auto"&&Ji(a("Saving...","gpt3-ai-content-generator"),"loading");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",ce),uo.dirty=!1,Ji(a(ee==="auto"?"Saved":"Settings saved!","gpt3-ai-content-generator"),"success"),On()}catch(re){let me=re&&re.message?re.message:a("Failed to save settings.","gpt3-ai-content-generator");Ji(`${a("Error:","gpt3-ai-content-generator")} ${me}`,"error"),On()}}},$a=async()=>{if(Ho){ta=!0;return}Ho=!0,await Zn({mode:"auto"}),Ho=!1,ta&&(ta=!1,$a())},eo=()=>{Ca&&window.clearTimeout(Ca),uo.dirty=!0,Ca=window.setTimeout(()=>{$a()},600)},li=()=>{if(uo.autosaveBound)return;let j=(ee,ce=["change"])=>{ee&&ce.forEach(re=>ee.addEventListener(re,eo))};j(je),j(Qe),j(bi),j(It,["input","change"]),j(ze,["input","change"]),uo.autosaveBound=!0},ho=()=>uo.initialized||!je||!Qe||!bi?!1:(pa(je.value),ko(je.value,{preserveValue:!0}),ua(),li(),uo.initialized=!0,!0),cr=()=>{Fe&&(ho(),Fe.classList.add("aipkit-active"),Fe.setAttribute("aria-hidden","false"),We&&We.focus())},_a=()=>{Fe&&(Fe.classList.remove("aipkit-active"),Fe.setAttribute("aria-hidden","true"))},Oa=j=>{if(!Jt)return;let ee=Jt.querySelector(".aipkit_spinner");ee&&(ee.style.display=j?"inline-block":"none"),Jt.disabled=j,Jt.setAttribute("aria-disabled",j?"true":"false")},Si=(j,ee="")=>{ci&&(ci.className="aipkit_sources_semantic_results aipkit_form-help",ee&&ci.classList.add(`aipkit_form-help-${ee}`),ci.textContent=j)},lr=async j=>{if(!ci)return;let ee=wo();if(!ee.semantic_search_vector_provider||!ee.semantic_search_target_id||!ee.semantic_search_embedding_model){Si(a("Complete semantic search settings before running a demo.","gpt3-ai-content-generator"));return}if(!gn.nonce){Si(a("Security token missing. Please reload.","gpt3-ai-content-generator"),"error");return}(uo.dirty||Ho)&&await Zn({mode:"auto"}),Oa(!0),ci.innerHTML='<div class="aipkit-search-loading"><span class="aipkit_spinner"></span></div>';try{let ce=await window.aipkit_apiRequest("aipkit_perform_semantic_search",{nonce:gn.nonce,query:j});ci.className="aipkit_sources_semantic_results",ci.innerHTML=ce.html||`<p>${Yt(ee.semantic_search_no_results_text||a("No results found.","gpt3-ai-content-generator"))}</p>`}catch(ce){let re=ce&&ce.message?ce.message:a("An error occurred while searching.","gpt3-ai-content-generator");Si(`${a("Error:","gpt3-ai-content-generator")} ${re}`,"error")}finally{Oa(!1)}},yn=async(j=1)=>{Pe.page=j,W(O,"",""),P.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${Yt(a("Loading sources...","gpt3-ai-content-generator"))}</td></tr>`,R&&(R.innerHTML="");try{let ee=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:Pe.page,per_page:Pe.perPage,provider:Pe.provider,status:Pe.status,type:Pe.type,search:Pe.search,store_id:xa()});D(P,ee.logs||[]),H(ee.pagination||{},R,yn)}catch(ee){let ce=ee&&ee.message?ee.message:a("Error loading sources.","gpt3-ai-content-generator");U(P,R,ce),W(O,ce,"error")}},rn=(()=>{let j=document.getElementById("aipkit_sources_training_toggle"),ee=document.getElementById("aipkit_sources_training_card");if(!j||!ee)return null;let ce=ee.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),re=ee.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),me=ee.querySelector(".aipkit_training_text_input"),Ie=ee.querySelector("#aipkit_training_qa_question"),Ee=ee.querySelector("#aipkit_training_qa_answer"),Re=ee.querySelector("#aipkit_training_files_input"),Ne=ee.querySelector(".aipkit_training_files_button"),Me=ee.querySelector(".aipkit_builder_dropzone"),dt=ee.querySelector("#aipkit_training_file_list"),Rt=ee.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),ii=ee.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),ft=ee.querySelector(".aipkit_training_stop_btn"),Xi=ee.querySelector(".aipkit_training_action_row"),Li=ee.querySelector("#aipkit_training_status")||O,Tt=document.getElementById("aipkit_sources_embedding_row"),_i=document.getElementById("aipkit_sources_embedding_model"),ki=ee.querySelector("#aipkit_vs_wp_content_mode"),Ti=ee.querySelector("#aipkit_vs_wp_content_status"),Pt=ee.querySelector("#aipkit_vs_wp_content_status_specific"),Tn=ee.querySelector("#aipkit_vs_wp_content_list_area"),Ut=ee.querySelector("#aipkit_vs_wp_content_pagination"),Na=ee.querySelector("#aipkit_vs_wp_content_messages_area"),Ra=ee.querySelector("#aipkit_vs_global_target_select"),un=ee.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Ei=ee.querySelector("#aipkit_wp_content_bulk_panel"),Da=ee.querySelector("#aipkit_wp_content_specific_panel"),pr=ee.querySelector("#aipkit_wp_content_bulk_hint"),_n=ee.querySelector("#aipkit_wp_content_specific_types_panel"),Ve=ee.querySelector("#aipkit_wp_content_status_wrap_bulk"),Wa=ee.querySelector("#aipkit_wp_content_status_wrap_specific"),Vi=new Map,zi={page:1,selectedIds:new Set},en=null,ao=null,$o=!1,Ui=(le,xe)=>{Li&&(Li.textContent=le||"",Li.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),le&&Li.classList.add("is-visible"),xe&&Li.classList.add(`is-${xe}`))},vn=(le=2500)=>{en&&window.clearTimeout(en),en=window.setTimeout(()=>{Ui("","")},le)},sn=(le,xe="")=>{if(!Na)return;W(Na,le||"",xe==="error"?"error":xe==="success"?"success":"")},cn=(le=2500)=>{ao&&window.clearTimeout(ao),ao=window.setTimeout(()=>{sn("","")},le)},to=()=>{let le=m(N?N.value:""),xe=ie&&!ie.disabled&&ie.value||"";return!le||!xe?null:{providerKey:le,storeId:xe}},Ha=()=>{let le=m(N?N.value:"");if(!le||le==="all")return Ui(a("Select a provider first.","gpt3-ai-content-generator"),"error"),vn(),!1;let xe=to();if(!xe||!xe.storeId){let ye=h(le);return Ui(r(a("Select a %s first.","gpt3-ai-content-generator"),ye.singular),"error"),vn(),!1}return!0},ma=le=>{if(!Number.isFinite(le))return"";let xe=["B","KB","MB","GB"],ye=le,He=0;for(;ye>=1024&&He<xe.length-1;)ye/=1024,He+=1;let nt=He===0?0:1;return`${ye.toFixed(nt)} ${xe[He]}`},Ln=()=>{Me&&(Me.style.display=Vi.size>0&&$o?"none":"")},Fi=(le=1500)=>{dt&&window.setTimeout(()=>{Vi.clear(),dt.innerHTML="",Ln()},le)},vo=le=>{if(!dt||!le)return null;let xe=`${le.name}_${le.size}_${le.lastModified}`;if(Vi.has(xe))return Vi.get(xe);let ye=document.createElement("div");ye.className="aipkit_training_file_row",ye.dataset.fileKey=xe;let He=document.createElement("div");He.className="aipkit_training_file_meta";let nt=document.createElement("span");nt.className="aipkit_training_file_name",nt.textContent=le.name;let yt=document.createElement("span");yt.className="aipkit_training_file_size",yt.textContent=ma(le.size);let rt=document.createElement("span");return rt.className="aipkit_training_file_status",rt.textContent=a("Queued","gpt3-ai-content-generator"),He.appendChild(nt),He.appendChild(yt),ye.appendChild(He),ye.appendChild(rt),dt.appendChild(ye),Vi.set(xe,ye),ye},Pi=(le,xe,ye)=>{let He=vo(le);if(!He)return;let nt=He.querySelector(".aipkit_training_file_status");nt&&(nt.textContent=xe||"",nt.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),ye&&nt.classList.add(`is-${ye}`))},Zi=async(le,xe,ye)=>{if(!le||!le.name||typeof window.aipkit_apiRequest!="function")return!1;let He=m(xe);if(!He)return!1;let nt=String(le.name||"").trim();if(!nt)return!1;let yt=Et=>String(Et||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),rt=yt(nt),Dt=nt.replace(/\.[^/.]+$/,""),kt=[nt,rt,Dt&&Dt!==nt?Dt:""].filter(Boolean),Bt=async(Et,fn)=>{let ni=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:1,per_page:fn,provider:He,store_id:ye||"",type:"file",search:Et||""});return Array.isArray(ni.logs)?ni.logs:[]},ct=(Et,fn)=>{if(!Et.length)return null;let ni=fn.map(yt).filter(Boolean);return Et.find(oi=>{let nn=yt(oi.message),Gi=yt(oi.post_title),Eo=yt(oi.file_id);return ni.some(Pn=>nn&&nn.includes(Pn)||Gi&&Gi.includes(Pn)||Eo&&Eo.includes(Pn))})||null};try{for(let ni of kt){let oi=await Bt(ni,10),nn=ct(oi,[ni,rt]);if(nn){let Gi=String(nn.status||"").toLowerCase();if(Gi==="indexed"||Gi==="skipped_already_indexed"||Gi==="success")return Pi(le,a("Trained","gpt3-ai-content-generator"),"success"),!0;if(Gi==="failed")return Pi(le,a("Failed","gpt3-ai-content-generator"),"error"),!0;if(Gi==="processing"||Gi==="queued")return Pi(le,a("Processing","gpt3-ai-content-generator"),"loading"),!0}}let Et=await Bt("",20),fn=ct(Et,kt);if(fn){let ni=String(fn.status||"").toLowerCase();if(ni==="indexed"||ni==="skipped_already_indexed"||ni==="success")return Pi(le,a("Trained","gpt3-ai-content-generator"),"success"),!0;if(ni==="failed")return Pi(le,a("Failed","gpt3-ai-content-generator"),"error"),!0;if(ni==="processing"||ni==="queued")return Pi(le,a("Processing","gpt3-ai-content-generator"),"loading"),!0}}catch{}return!1},ro=(le,xe,ye,He=0)=>{if(!le||!xe||!ye)return;if(He>=30){Zi(ye,"openai",le).then(rt=>{rt||Pi(ye,a("Queued","gpt3-ai-content-generator"),"warning")});return}let yt=Ii("aipkit_vector_store_nonce_openai");if(!yt||typeof window.aipkit_apiRequest!="function"){Zi(ye,"openai",le);return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:le,batch_id:xe,_ajax_nonce:yt}).then(rt=>{let Dt=(rt.status||"").toLowerCase();if(Dt==="completed"){Pi(ye,a("Trained","gpt3-ai-content-generator"),"success"),yn(1);return}if(Dt==="failed"||Dt==="cancelled"){Pi(ye,a("Failed","gpt3-ai-content-generator"),"error");return}Pi(ye,a("Processing","gpt3-ai-content-generator"),"loading"),setTimeout(()=>{ro(le,xe,ye,He+1)},2500)}).catch(()=>{setTimeout(()=>{ro(le,xe,ye,He+1)},3e3)})},ur=le=>le?Array.isArray(le)?le.flatMap(xe=>{if(Array.isArray(xe))return xe;if(xe&&typeof xe=="object"){if(Array.isArray(xe.models))return xe.models;if(Array.isArray(xe.items))return xe.items;if(xe.id)return[xe]}return[]}):typeof le=="object"?Object.values(le).flatMap(xe=>Array.isArray(xe)?xe:[]):[]:[],jo=le=>{let xe=window.aipkit_dashboard?.embeddingModels||{};return ur(xe[le]||[])},ga=(le,xe)=>{if(!xe)return null;let He=jo(le).find(rt=>rt&&rt.id===xe),nt=He?.dimensions||He?.dimension||He?.output_dimensionality||He?.outputDimensionality||He?.output_dimension,yt=nt?Number(nt):NaN;if(Number.isFinite(yt)&&yt>0)return yt;if(He&&typeof He.name=="string"){let rt=He.name.match(/\((\d{3,5})\)/);if(rt)return Number(rt[1])}return le==="google"?768:1536},tn=le=>{if(!_i)return;let xe=m(le),ye=xe&&Pe.embeddingByProvider?Pe.embeddingByProvider[xe]:"";if(!ye)return;let He=Fo(ye);_i.querySelector(`option[value="${He}"]`)&&(_i.value=ye)},Gn=()=>{if(!_i)return;let le=_i.value||"",xe=["openai","google","openrouter","azure"],ye={openai:a("OpenAI","gpt3-ai-content-generator"),google:a("Google","gpt3-ai-content-generator"),openrouter:a("OpenRouter","gpt3-ai-content-generator"),azure:a("Azure","gpt3-ai-content-generator")};_i.innerHTML="";let He=document.createElement("option");He.value="",He.textContent=a("Select embedding model","gpt3-ai-content-generator"),_i.appendChild(He);let nt=!1;if(xe.forEach(rt=>{let Dt=jo(rt);if(!Dt.length)return;let kt=document.createElement("optgroup");kt.label=ye[rt]||rt,Dt.forEach(Bt=>{let ct=Bt.id||"";if(!ct)return;let Et=document.createElement("option");Et.value=`${rt}::${ct}`,Et.textContent=Bt.name||ct,Et.dataset.provider=rt,Et.dataset.model=ct,kt.appendChild(Et)}),kt.children.length&&(_i.appendChild(kt),nt=!0)}),!nt){_i.innerHTML="";let rt=document.createElement("option");rt.value="",rt.textContent=a("No embedding models found.","gpt3-ai-content-generator"),_i.appendChild(rt),_i.disabled=!0;return}if(_i.disabled=!1,le){let rt=Fo(le);if(_i.querySelector(`option[value="${rt}"]`)){_i.value=le;return}}let yt=_i.querySelector("optgroup option");yt&&(_i.value=yt.value)},Nn=()=>{if(!_i)return null;let le=_i.options[_i.selectedIndex],xe=le&&le.dataset.provider||"",ye=le&&le.dataset.model||"";if(!xe||!ye){let He=_i.value||"";if(He&&He.includes("::")){let[nt,yt]=He.split("::");xe=nt||"",ye=yt||""}}return!xe||!ye?null:{provider:xe,model:ye,dimension:ga(xe,ye)}},Va=le=>{!ft||!ii||(le?(ft.hidden=!1,ft.disabled=!1,ii.disabled=!0):(ft.hidden=!0,ft.disabled=!1,ii.disabled=!1))},$i=()=>{let le=to(),xe=m(N?N.value:le?.providerKey||"");if(Rt.forEach(ye=>{ye.disabled=!1,ye.removeAttribute("aria-disabled")}),Tt){let ye=xe==="pinecone"||xe==="qdrant";Tt.hidden=!ye,ye&&tn(xe)}if(Ra){let ye=le?le.storeId:"";Ra.innerHTML=ye?`<option value="${Yt(ye)}">${Yt(ye)}</option>`:'<option value=""></option>',Ra.value=ye}},ot=le=>{if(!ce||!le)return;ce.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(ye=>{let He=ye.dataset.aipkitTab===le;ye.classList.toggle("is-active",He),ye.setAttribute("aria-selected",He?"true":"false")}),re.forEach(ye=>{let He=ye.dataset.aipkitPanel===le;ye.classList.toggle("is-active",He),ye.hidden=!He}),ii&&(ii.style.display=le==="files"?"none":""),Xi&&Xi.classList.toggle("aipkit_builder_action_row--end",le==="files")},Oi=()=>{let le=ce?ce.querySelector(".aipkit_builder_tab.is-active"):null;return le?le.dataset.aipkitTab:""},Oo=()=>ki&&ki.value||"bulk",Ua=le=>{let xe=le==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",ye=document.getElementById(xe);return ye?Array.from(ye.selectedOptions).map(He=>He.value).filter(Boolean):[]},Ga=le=>{let xe=le==="specific"?Pt:Ti;return xe&&xe.value||"publish"},bo=()=>Tn?Array.from(Tn.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(le=>le.value):[],ka=(le,xe,ye)=>{if(!xe)return;xe.innerHTML="";let He=Number(le?.total_posts||0),nt=Number(le?.total_pages||0),yt=Number(le?.current_page||1);if(!He)return;let rt=document.createElement("span");if(rt.className="aipkit_pagination-count",rt.textContent=`${He.toLocaleString()} ${i("item","items",He,"gpt3-ai-content-generator")}`,xe.appendChild(rt),nt<=1)return;let Dt=document.createElement("span");Dt.className="aipkit_pagination-links";let kt=document.createElement("button");kt.type="button",kt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",kt.textContent=a("Prev","gpt3-ai-content-generator"),kt.disabled=yt<=1,kt.addEventListener("click",()=>ye(yt-1));let Bt=document.createElement("span");Bt.className="aipkit_pagination-current",Bt.textContent=`${yt}/${nt}`;let ct=document.createElement("button");ct.type="button",ct.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",ct.textContent=a("Next","gpt3-ai-content-generator"),ct.disabled=yt>=nt,ct.addEventListener("click",()=>ye(yt+1)),Dt.appendChild(kt),Dt.appendChild(Bt),Dt.appendChild(ct),xe.appendChild(Dt)},_r=(le,xe)=>{if(!Tn)return;if(Tn.innerHTML="",!Array.isArray(le)||!le.length){Tn.innerHTML=`<p class="aipkit_builder_help_text">${Yt(a("No posts found for selection.","gpt3-ai-content-generator"))}</p>`,Ut&&(Ut.innerHTML="");return}let ye=document.createElement("ul"),He=document.createElement("div");He.className="aipkit_wp_content_select_all_wrapper";let nt=document.createElement("label");nt.className="aipkit_training_site_option";let yt=document.createElement("input");yt.type="checkbox",yt.checked=le.every(rt=>zi.selectedIds.has(String(rt.id))),nt.appendChild(yt),nt.appendChild(document.createTextNode(a("Select all","gpt3-ai-content-generator"))),He.appendChild(nt),Tn.appendChild(He),Tn.appendChild(ye),le.forEach(rt=>{let Dt=document.createElement("li");Dt.className="aipkit_wp_content_list_item";let kt=document.createElement("input");kt.type="checkbox",kt.name="wp_content_to_index[]",kt.value=String(rt.id),kt.checked=zi.selectedIds.has(String(rt.id)),kt.addEventListener("change",()=>{kt.checked?zi.selectedIds.add(String(rt.id)):zi.selectedIds.delete(String(rt.id)),yt.checked=le.every(fn=>zi.selectedIds.has(String(fn.id)))});let Bt=document.createElement("a");Bt.className="aipkit_wp_content_title",Bt.href=rt.edit_link||"#",Bt.target="_blank",Bt.rel="noopener noreferrer",Bt.textContent=rt.title||a("Untitled","gpt3-ai-content-generator");let ct=document.createElement("span");ct.className="aipkit_wp_content_type",ct.textContent=rt.type_label||"";let Et=document.createElement("span");Et.className="aipkit_wp_content_indexed_status",Et.textContent=rt.is_already_indexed?a("Indexed","gpt3-ai-content-generator"):"",Dt.appendChild(kt),Dt.appendChild(Bt),Dt.appendChild(ct),Dt.appendChild(Et),ye.appendChild(Dt)}),yt.addEventListener("change",()=>{yt.checked?le.forEach(rt=>zi.selectedIds.add(String(rt.id))):le.forEach(rt=>zi.selectedIds.delete(String(rt.id))),Tn.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(rt=>{rt.checked=yt.checked})}),ka(xe,Ut,so)},so=async le=>{if(!Tn)return;let xe=to(),ye=Oo(),He=Ua(ye);if(!He.length){Tn.innerHTML="",Ut&&(Ut.innerHTML=""),sn(a("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let nt=Ii("aipkit_wp_content_fetch_nonce");if(!nt){sn(a("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let yt=Ga(ye);try{sn(a("Loading content...","gpt3-ai-content-generator"),"");let rt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:nt,post_types:He,post_status:yt,target_store_id:xe?xe.storeId:"",paged:le});zi.page=le,_r(rt.posts||[],rt.pagination||{}),sn("","")}catch(rt){sn(rt&&rt.message?rt.message:a("Failed to load content.","gpt3-ai-content-generator"),"error")}},zo=le=>{ki&&(ki.value=le),Ei&&(Ei.hidden=le!=="bulk"),_n&&(_n.hidden=le!=="specific"),Da&&(Da.hidden=le!=="specific"),Ve&&(Ve.hidden=le!=="bulk"),Wa&&(Wa.hidden=le!=="specific"),pr&&(pr.hidden=le!=="bulk"),le==="specific"&&so(1)},Ka=()=>{ee.querySelectorAll(".aipkit_training_site_dropdown").forEach(xe=>{let ye=xe.querySelector(".aipkit_training_site_dropdown_btn"),He=xe.querySelector(".aipkit_training_site_dropdown_label"),nt=xe.querySelector(".aipkit_training_site_dropdown_panel"),rt=xe.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Dt=document.getElementById(rt);if(!ye||!nt||!Dt)return;let kt=()=>{let ct=nt.querySelectorAll('input[type="checkbox"]:checked'),Et=xe.dataset.placeholder||a("Select types","gpt3-ai-content-generator"),fn=xe.dataset.selectedLabel||a("selected","gpt3-ai-content-generator");He&&(ct.length?He.textContent=`${ct.length} ${fn}`:He.textContent=Et)},Bt=()=>{let ct=Array.from(nt.querySelectorAll('input[type="checkbox"]:checked')).map(Et=>Et.value);Array.from(Dt.options).forEach(Et=>{Et.selected=ct.includes(Et.value)})};ye.addEventListener("click",()=>{let ct=ye.getAttribute("aria-expanded")==="true";ye.setAttribute("aria-expanded",ct?"false":"true"),nt.hidden=ct}),nt.addEventListener("change",()=>{Bt(),kt(),Oo()==="specific"&&so(1)}),document.addEventListener("click",ct=>{xe.contains(ct.target)||(ye.setAttribute("aria-expanded","false"),nt.hidden=!0)}),Bt(),kt()})},ja=async(le,xe,ye)=>{let He=Ii("aipkit_wp_content_fetch_nonce");if(!He)throw new Error("WP content fetch nonce missing.");let nt=[],yt=1,rt=1;do{let Dt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:He,post_types:le,post_status:xe,target_store_id:ye||"",paged:yt});(Array.isArray(Dt?.posts)?Dt.posts:[]).forEach(ct=>{nt.push({id:String(ct.id),title:ct.title||r(a("Post %s","gpt3-ai-content-generator"),ct.id)})});let Bt=parseInt(Dt?.pagination?.total_pages||1,10);rt=Number.isNaN(Bt)?1:Bt,yt+=1}while(yt<=rt);return nt},za=()=>Tn?Array.from(Tn.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(le=>{let xe=le.closest(".aipkit_wp_content_list_item"),ye=xe?xe.querySelector(".aipkit_wp_content_title"):null;return{id:String(le.value||""),title:ye&&ye.textContent.trim()||r(a("Post %s","gpt3-ai-content-generator"),le.value)}}):[],No=(le,xe,ye,He)=>{let nt=r(a("Post %s","gpt3-ai-content-generator"),le),yt=He&&He.get(String(le))||nt;return r(a("Training: %s (%d/%d)","gpt3-ai-content-generator"),yt,xe+1,ye)},Ro=async(le,xe)=>{if(!window.aipkit_dashboard?.ajaxurl)throw new Error(a("AJAX configuration is missing.","gpt3-ai-content-generator"));le.set("action",xe);let ye=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:le,credentials:"same-origin"}),He=await ye.json();if(!ye.ok||!He.success){let nt=He?.data?.message||a("Upload failed.","gpt3-ai-content-generator");throw new Error(nt)}return He.data},wa=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`text_${Date.now()}`,ha=()=>{let le=Nn();return le||(Ui(a("Select an embedding model.","gpt3-ai-content-generator"),"warning"),vn(),null)},fr=async(le,xe)=>{if(!window.aipkit_dashboard?.nonce)throw new Error(a("Embedding nonce missing.","gpt3-ai-content-generator"));let ye=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:le,embedding_provider:xe.provider,embedding_model:xe.model,_ajax_nonce:window.aipkit_dashboard.nonce}),He=ye.embeddings&&ye.embeddings.length?ye.embeddings[0]:null;if(!He)throw new Error(a("Failed to generate embedding.","gpt3-ai-content-generator"));return He},So=async({content:le,indexName:xe,embedding:ye,metadata:He})=>{let nt=Ii("aipkit_vector_store_pinecone_nonce_management");if(!nt)throw new Error(a("Pinecone nonce missing.","gpt3-ai-content-generator"));let yt=await fr(le,ye);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:nt,vectors:JSON.stringify([{id:He.vector_id,values:yt,metadata:He}]),embedding_provider:ye.provider,embedding_model:ye.model,original_text_content:le,index_name:xe})},mr=async({content:le,collectionName:xe,embedding:ye,metadata:He,sourceContext:nt})=>{let yt=Ii("aipkit_vector_store_qdrant_nonce_management");if(!yt)throw new Error(a("Qdrant nonce missing.","gpt3-ai-content-generator"));let rt=await fr(le,ye),Dt={_ajax_nonce:yt,vectors:JSON.stringify([{id:He.vector_id,vector:rt,payload:He}]),embedding_provider:ye.provider,embedding_model:ye.model,original_text_content:le,collection_name:xe,source_context:nt||"sources_module"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Dt)},io=async()=>{if($o)return;let le=to();if(!le){Ui(a("Select a provider and index first.","gpt3-ai-content-generator"),"warning"),vn();return}let xe=Oi(),ye="",He=[],nt=null,yt="text_entry_global_form",rt="file_upload_global_form";if(xe==="text"){if(ye=me?me.value.trim():"",!ye){Ui(a("Add text to train.","gpt3-ai-content-generator"),"warning"),vn();return}}else if(xe==="qa"){let kt=Ie?Ie.value.trim():"",Bt=Ee?Ee.value.trim():"";if(!kt||!Bt){Ui(a("Add a question and answer to train.","gpt3-ai-content-generator"),"warning"),vn();return}ye=`Q: ${kt}
A: ${Bt}`}else if(xe==="files"){if(He=Re?Array.from(Re.files||[]):[],!He.length){Re&&Re.click(),Ui(a("Choose files to upload.","gpt3-ai-content-generator"),"warning"),vn();return}}else if(xe==="website"){let kt=Oo(),Bt=Ga(kt),ct=Ua(kt),Et=bo();if(kt==="specific"&&!Et.length){Ui(a("Select content to train.","gpt3-ai-content-generator"),"warning"),vn();return}if(kt==="bulk"&&!ct.length){Ui(a("Select at least one post type.","gpt3-ai-content-generator"),"warning"),vn();return}nt={mode:kt,statusValue:Bt,postTypes:ct,selectedPostIds:Et}}else{Ui(a("Select a training tab to continue.","gpt3-ai-content-generator"),"warning"),vn();return}let Dt=null;if(!((le.providerKey==="pinecone"||le.providerKey==="qdrant")&&(Dt=ha(),!Dt))){$o=!0,Va(!0),Rt.forEach(kt=>{kt.disabled=!0}),Ui(a("Preparing training...","gpt3-ai-content-generator"),"loading");try{if(xe==="files"){Ln();for(let kt=0;kt<He.length;kt+=1){let Bt=He[kt];Ui(r(a("Uploading %1$d of %2$d...","gpt3-ai-content-generator"),kt+1,He.length),"loading"),Pi(Bt,a("Uploading","gpt3-ai-content-generator"),"loading");try{let ct=new FormData;if(le.providerKey==="openai"){let Et=Ii("aipkit_vector_store_nonce_openai");if(!Et)throw new Error(a("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));ct.append("aipkit_vs_global_file_to_submit",Bt),ct.append("target_store_id",le.storeId),ct.append("source_type",rt),ct.append("_ajax_nonce",Et);let fn=await Ro(ct,"aipkit_upload_and_add_file_to_store_direct_openai");Pi(Bt,a("Processing","gpt3-ai-content-generator"),"loading");let ni=fn?.batch?.id;Zi(Bt,le.providerKey,le.storeId).then(oi=>{if(!oi){if(ni){ro(le.storeId,ni,Bt);return}Pi(Bt,a("Queued","gpt3-ai-content-generator"),"warning")}})}else if(le.providerKey==="pinecone"){let Et=Ii("aipkit_vector_store_pinecone_nonce_management");if(!Et)throw new Error(a("Pinecone nonce missing.","gpt3-ai-content-generator"));ct.append("file_to_upload",Bt),ct.append("index_name",le.storeId),ct.append("embedding_provider",Dt.provider),ct.append("embedding_model",Dt.model),ct.append("_ajax_nonce",Et),await Ro(ct,"aipkit_upload_file_and_upsert_to_pinecone"),Pi(Bt,a("Trained","gpt3-ai-content-generator"),"success")}else if(le.providerKey==="qdrant"){let Et=Ii("aipkit_vector_store_qdrant_nonce_management");if(!Et)throw new Error(a("Qdrant nonce missing.","gpt3-ai-content-generator"));ct.append("file_to_upload",Bt),ct.append("target_store_id",le.storeId),ct.append("embedding_provider",Dt.provider),ct.append("embedding_model",Dt.model),ct.append("source_context","sources_module_file_upload"),ct.append("_ajax_nonce",Et),await Ro(ct,"aipkit_upload_file_and_upsert_to_qdrant"),Pi(Bt,a("Trained","gpt3-ai-content-generator"),"success")}}catch(ct){throw Pi(Bt,a("Failed","gpt3-ai-content-generator"),"error"),ct}}Re&&(Re.value=""),Ln(),Ui(a("Saved","gpt3-ai-content-generator"),"success"),sn(a("Saved","gpt3-ai-content-generator"),"success"),cn(),vn(),Fi(),yn(1);return}if(xe==="website"&&nt){let{mode:kt,statusValue:Bt,postTypes:ct}=nt,Et=[],fn=new Map;if(kt==="bulk"){Ui(a("Preparing website content...","gpt3-ai-content-generator"),"loading");let ni=await ja(ct,Bt,le.storeId);if(Et=ni.map(oi=>oi.id),fn=new Map(ni.map(oi=>[String(oi.id),oi.title])),!Et.length){sn(a("No posts found for selection.","gpt3-ai-content-generator"),"error"),Ui(a("Nothing to train.","gpt3-ai-content-generator"),"warning"),vn();return}}if(kt!=="bulk"){let ni=za();Et=ni.map(oi=>oi.id),fn=new Map(ni.map(oi=>[String(oi.id),oi.title]))}if(Ui(a("Training...","gpt3-ai-content-generator"),"loading"),sn(r(a("Training %d item(s)...","gpt3-ai-content-generator"),Et.length),""),le.providerKey==="openai"){let ni=Ii("aipkit_wp_content_index_nonce");if(!ni)throw new Error(a("WP content index nonce missing.","gpt3-ai-content-generator"));for(let oi=0;oi<Et.length;oi+=1){let nn=Et[oi];sn(No(nn,oi,Et.length,fn),""),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{_ajax_nonce:ni,post_ids:[nn],target_store_id:le.storeId,provider:"openai"})}}else if(le.providerKey==="pinecone")for(let ni=0;ni<Et.length;ni+=1){let oi=Et[ni];sn(No(oi,ni,Et.length,fn),"");let nn=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Ii("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[oi]}),Gi=nn.posts_content&&nn.posts_content[oi]?nn.posts_content[oi]:null;if(!Gi||!Gi.content)continue;let Eo=Bo(),Pn={source:"wordpress_post",created_at:new Date().toISOString(),post_id:oi,title:Gi.title||"",url:Gi.edit_link||"",vector_id:Eo};Pn.vector_id=Eo,await So({content:Gi.content,indexName:le.storeId,embedding:Dt,metadata:Pn})}else if(le.providerKey==="qdrant")for(let ni=0;ni<Et.length;ni+=1){let oi=Et[ni];sn(No(oi,ni,Et.length,fn),"");let nn=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Ii("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[oi]}),Gi=nn.posts_content&&nn.posts_content[oi]?nn.posts_content[oi]:null;if(!Gi||!Gi.content)continue;let Eo=wa(),Pn={source:"wordpress_post",created_at:new Date().toISOString(),post_id:oi,title:Gi.title||"",url:Gi.edit_link||"",vector_id:Eo};await mr({content:Gi.content,collectionName:le.storeId,embedding:Dt,metadata:Pn,sourceContext:"sources_module_website"})}Ui(a("Saved","gpt3-ai-content-generator"),"success"),vn(),yn(1);return}if(le.providerKey==="openai"){let kt=Ii("aipkit_vector_store_nonce_openai");if(!kt)throw new Error(a("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:kt,target_store_id:le.storeId,text_content:ye,source_type:yt})}else if(le.providerKey==="pinecone"){let kt=Bo(),Bt={source:yt,created_at:new Date().toISOString(),original_content:ye,vector_id:kt};await So({content:ye,indexName:le.storeId,embedding:Dt,metadata:Bt})}else if(le.providerKey==="qdrant"){let kt=Bo(),Bt={source:yt,created_at:new Date().toISOString(),original_content:ye,vector_id:kt};await mr({content:ye,collectionName:le.storeId,embedding:Dt,metadata:Bt,sourceContext:"sources_module_training"})}xe==="text"&&me&&(me.value=""),xe==="qa"&&(Ie&&(Ie.value=""),Ee&&(Ee.value="")),Ui(a("Saved","gpt3-ai-content-generator"),"success"),vn(),yn(1)}catch(kt){Ui(r(a("Error: %s","gpt3-ai-content-generator"),kt?.message||a("Training failed.","gpt3-ai-content-generator")),"error")}finally{$o=!1,Va(!1),$i(),Ln()}}};if(j.addEventListener("click",()=>{let le=ee.hidden;ee.hidden=!le,j.setAttribute("aria-expanded",le?"true":"false"),le&&($i(),Gn(),tn(N?N.value:""))}),ce){let le=ce.querySelector(".aipkit_builder_tab.is-active");le&&ot(le.dataset.aipkitTab),ce.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(xe=>{xe.addEventListener("click",()=>{ot(xe.dataset.aipkitTab)})})}return Ne&&Re&&Ne.addEventListener("click",()=>{Ha()&&Re.click()}),Re&&Re.addEventListener("change",()=>{if(!Ha()){Re.value="";return}let le=Array.from(Re.files||[]);le.length&&(le.forEach(xe=>{vo(xe),Pi(xe,a("Queued","gpt3-ai-content-generator"))}),Ln(),io())}),Rt.forEach(le=>{le.addEventListener("click",io)}),ft&&ft.addEventListener("click",()=>{$o&&(ft.disabled=!0,Ui(a("Stopping...","gpt3-ai-content-generator"),"warning"))}),_i&&_i.addEventListener("change",()=>{let le=m(N?N.value:"");le&&(Pe.embeddingByProvider[le]=_i.value||"",d({provider:Pe.provider,status:Pe.status,type:Pe.type,indexByProvider:Pe.indexByProvider,embeddingByProvider:Pe.embeddingByProvider}))}),un.length&&un.forEach(le=>{le.addEventListener("change",()=>{le.checked&&zo(le.value)})}),Ti&&Ti.addEventListener("change",()=>{Oo()==="specific"&&so(1)}),Pt&&Pt.addEventListener("change",()=>{Oo()==="specific"&&so(1)}),Ka(),$i(),Gn(),tn(N?N.value:""),zo(Oo()),{updateTargetState:$i}})();N&&N.addEventListener("change",()=>{Pe.provider=N.value,Dn(Pe.provider),rn?.updateTargetState?.(),d({provider:Pe.provider,status:Pe.status,type:Pe.type,indexByProvider:Pe.indexByProvider,embeddingByProvider:Pe.embeddingByProvider}),yn(1)}),Di&&Di.addEventListener("click",()=>{m(N?N.value:"")&&(Pe.openIndexCreateOnOpen=!0,oa(Di))}),J&&J.addEventListener("change",()=>{Pe.status=J.value,d({provider:Pe.provider,status:Pe.status,type:Pe.type,indexByProvider:Pe.indexByProvider,embeddingByProvider:Pe.embeddingByProvider}),yn(1)}),we&&we.addEventListener("change",()=>{Pe.type=we.value,d({provider:Pe.provider,status:Pe.status,type:Pe.type,indexByProvider:Pe.indexByProvider,embeddingByProvider:Pe.embeddingByProvider}),yn(1)});let fa=()=>{if(!$e)return;let j=$e.value.trim();j!==Pe.search&&(Pe.search=j,yn(1))},dr=()=>{$e&&(ji&&window.clearTimeout(ji),ji=window.setTimeout(()=>{fa()},300))};if($e&&($e.addEventListener("input",dr),$e.addEventListener("search",fa),$e.addEventListener("keydown",j=>{j.key==="Enter"&&(j.preventDefault(),ji&&window.clearTimeout(ji),fa())})),ie&&ie.addEventListener("change",()=>{let j=m(N?N.value:"");j&&(Pe.indexByProvider[j]=ie.value||"",d({provider:Pe.provider,status:Pe.status,type:Pe.type,indexByProvider:Pe.indexByProvider,embeddingByProvider:Pe.embeddingByProvider}),Un(),rn?.updateTargetState?.(),yn(1))}),Ke&&Ke.dataset.configListenersAttached!=="true"){let j=ee=>{ee.target.closest("[data-aipkit-provider-config]")&&ra()};Ke.addEventListener("input",j),Ke.addEventListener("change",j),Ke.dataset.configListenersAttached="true"}Ht&&Ht.addEventListener("click",Jn),Wi&&Wi.addEventListener("click",Jn),bt&&!bt.dataset.bound&&(document.addEventListener("keydown",j=>{j.key==="Escape"&&bt.classList.contains("aipkit-active")&&Jn()}),bt.dataset.bound="1"),Vn&&Vn.addEventListener("click",La),_e&&_e.addEventListener("click",La),Te&&Te.addEventListener("click",go),At&&At.addEventListener("click",go),et&&et.addEventListener("click",async()=>{if(!be)return;let j=be.dataset.provider||"",ee=be.dataset.storeId||"",ce=be.dataset.vectorId||"",re=be.dataset.logId||"";if(!j||!ee||!ce||!re){W(O,a("Missing source details.","gpt3-ai-content-generator"),"error"),Mn(),go();return}go();let me=null,Ie=[];if(P){let Ee=Fo(re);if(me=P.querySelector(`tr[data-log-id="${Ee}"]`),me){Ie=Array.from(me.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")),Ie.forEach(Ne=>{Ne.disabled=!0,Ne.setAttribute("aria-disabled","true")});let Re=me.querySelector(".aipkit_sources_action_delete");Re&&(Re.textContent=a("Deleting...","gpt3-ai-content-generator"))}}et&&(et.disabled=!0),W(O,a("Deleting...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:j,store_id:ee,vector_id:ce,log_id:re}),W(O,a("Deleted","gpt3-ai-content-generator"),"success"),Mn(),yn(Pe.page||1)}catch(Ee){let Re=Ee&&Ee.message?Ee.message:a("Failed to delete source.","gpt3-ai-content-generator");W(O,`${a("Error:","gpt3-ai-content-generator")} ${Re}`,"error"),Mn(),Ie.forEach(Me=>{Me.disabled=!1,Me.removeAttribute("aria-disabled")});let Ne=me?me.querySelector(".aipkit_sources_action_delete"):null;Ne&&(Ne.textContent=a("Delete","gpt3-ai-content-generator"))}finally{et&&(et.disabled=!1)}}),Sn&&Sn.addEventListener("click",async()=>{if(!bt||!di)return;let j=di.value.trim();if(!j){W(O,a("Text cannot be empty.","gpt3-ai-content-generator"),"error"),Mn();return}let ee=bt.dataset.provider||"",ce=bt.dataset.storeId||"",re=bt.dataset.vectorId||"",me=bt.dataset.logId||"",Ie=bt.dataset.embeddingProvider||"",Ee=bt.dataset.embeddingModel||"";if(!ee||!ce||!re||!me){W(O,a("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}Jn();let Re=[];if(P&&me){let Ne=Fo(me),Me=P.querySelector(`tr[data-log-id="${Ne}"]`);Re=Me?Array.from(Me.querySelectorAll(".aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[],Re.forEach(dt=>{dt.disabled=!0,dt.setAttribute("aria-disabled","true"),dt.classList.contains("aipkit_sources_action_edit")&&(dt.textContent=a("Training...","gpt3-ai-content-generator"))})}W(O,a("Training...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:ee,store_id:ce,vector_id:re,log_id:me}),await ir(ee,ce,j,Ie,Ee),W(O,a("Trained","gpt3-ai-content-generator"),"success"),Mn(),yn(Pe.page||1)}catch(Ne){let Me=Ne&&Ne.message?Ne.message:a("Failed to save source.","gpt3-ai-content-generator");W(O,`${a("Error:","gpt3-ai-content-generator")} ${Me}`,"error"),Mn(),Re.forEach(dt=>{dt.disabled=!1,dt.removeAttribute("aria-disabled"),dt.classList.contains("aipkit_sources_action_edit")&&(dt.textContent=a("Edit","gpt3-ai-content-generator"))})}}),F.addEventListener("click",async j=>{let ee=j.target.closest(".aipkit_sources_provider_create");if(ee){let Re=ee.dataset.provider||"";Re&&Mo(Re,ee);return}let ce=j.target.closest(".aipkit_sources_provider_delete_selected");if(ce){let Re=m(N?N.value:ce.dataset.provider||""),Ne=ie?ie.value:"";if(!Re||!Ne){let Rt=h(Re);an(r(a("Select a %s to delete.","gpt3-ai-content-generator"),Rt.singular.toLowerCase()),"error"),kn();return}let Me=ie&&ie.selectedOptions?ie.selectedOptions[0]:null,dt=Me?Me.textContent:Ne;Po(Re,Ne,dt,ce);return}let re=j.target.closest(".aipkit_sources_action_edit");if(re){er(re);return}let me=j.target.closest(".aipkit_sources_action_view");if(me){let Re=me.dataset.snippet||"";if(!Re){W(O,a("No preview available for this source.","gpt3-ai-content-generator"),"error"),Mn();return}Cn(Re);return}let Ie=j.target.closest(".aipkit_sources_action_delete");if(Ie){let Re=Ie.dataset.provider||"",Ne=Ie.dataset.storeId||"",Me=Ie.dataset.vectorId||"",dt=Ie.dataset.logId||"";if(!Re||!Ne||!Me||!dt){W(O,a("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}Io({provider:Re,storeId:Ne,vectorId:Me,logId:dt});return}let Ee=j.target.closest(".aipkit_sources_action_retrain");if(Ee){let Re=Ee.dataset.provider||"",Ne=Ee.dataset.storeId||"",Me=Ee.dataset.vectorId||"",dt=Ee.dataset.logId||"",Rt=Ee.dataset.postId||"",ii=Ee.dataset.embeddingProvider||"",ft=Ee.dataset.embeddingModel||"";if(!Re||!Ne||!Me||!dt||!Rt){W(O,a("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}let Xi=Ee.closest("tr"),Li=Xi?Array.from(Xi.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[];Li.forEach(Tt=>{Tt.disabled=!0,Tt.setAttribute("aria-disabled","true")}),Ee.textContent=a("Training...","gpt3-ai-content-generator"),W(O,a("Retraining...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:Re,store_id:Ne,vector_id:Me,log_id:dt,post_id:Rt,embedding_provider:ii,embedding_model:ft}),W(O,a("Retrained","gpt3-ai-content-generator"),"success"),Mn(),yn(Pe.page||1)}catch(Tt){let _i=Tt&&Tt.message?Tt.message:a("Failed to retrain source.","gpt3-ai-content-generator");W(O,`${a("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Mn(),Li.forEach(ki=>{ki.disabled=!1,ki.removeAttribute("aria-disabled")}),Ee.textContent=a("Retrain","gpt3-ai-content-generator")}}}),Ue&&Ue.addEventListener("click",()=>{oo()}),Ot&&Ot.addEventListener("click",j=>{j.preventDefault(),oo(),rr(),Ko()}),Oe&&Oe.addEventListener("click",j=>{j.preventDefault(),rr(),cr()}),qt&&qt.addEventListener("click",j=>{j.preventDefault(),da()}),qe&&qe.addEventListener("click",j=>{j.target===qe&&da()}),We&&We.addEventListener("click",j=>{j.preventDefault(),_a()}),Fe&&Fe.addEventListener("click",j=>{j.target===Fe&&_a()}),document.addEventListener("keydown",j=>{j.key==="Escape"&&qe&&qe.classList.contains("aipkit-active")&&da(),j.key==="Escape"&&Fe&&Fe.classList.contains("aipkit-active")&&_a()}),je&&je.addEventListener("change",()=>{let j=je.value;pa(j),ko(j),Qe&&(Qe.value=""),eo()}),Qe&&Qe.addEventListener("change",eo),bi&&bi.addEventListener("change",()=>{ua(),eo()}),It&&(It.addEventListener("input",eo),It.addEventListener("change",eo)),ze&&(ze.addEventListener("input",eo),ze.addEventListener("change",eo)),Ye&&Ye.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode("[aipkit_semantic_search]",Ye)}),Ze&&Ze.addEventListener("submit",j=>{if(j.preventDefault(),!ei)return;let ee=ei.value.trim();ee&&lr(ee)}),ui&&ae&&(ae.innerHTML=""),Dn(N?N.value:""),typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(F),typeof window.aipkitSources_initSettingsPopoverPanels=="function"&&window.aipkitSources_initSettingsPopoverPanels(F),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_sources_module_container"),yn(1)}window.aipkit_initSources=Q})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector("#aipkit_stats_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let s=r.querySelector(".aipkit_model_settings_popover_title"),n=r.querySelector(".aipkit_model_settings_popover_back"),c=a.querySelector("#aipkit_stats_settings_trigger"),l={root:r.dataset.titleRoot||"Log Settings","log-retention":r.dataset.titleLogRetention||"Log retention"},o=null,e=t=>{let p=t||"root",d=r.querySelector(`[data-aipkit-settings-panel="${p}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!d)return;let u=d.dataset.aipkitSettingsPanel||"root";u!==o&&(i.forEach(f=>{f.hidden=f!==d}),s&&(s.textContent=l[u]||l.root),n&&(n.hidden=u==="root"),o=u,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",t=>{let p=t.target.closest("[data-aipkit-panel-target]");if(!p)return;t.preventDefault();let d=p.dataset.aipkitPanelTarget;e(d)}),n&&n.addEventListener("click",t=>{t.preventDefault(),e("root")}),c&&c.addEventListener("click",()=>{e("root")}),e("root"),r.dataset.panelsBound="true"}window.aipkitStats_initSettingsPopoverPanels=k})();(function(){"use strict";let r="aipkit_stats_overview_open",i=e=>typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml(e):(e==null?"":String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),s=e=>{let t=Number(e||0);return Number.isNaN(t)?"0":t.toLocaleString()},n=e=>{let t=Number(e);if(!t)return"";let p=new Date(t*1e3);return Number.isNaN(p.getTime())?"":p.toLocaleString()},c=e=>{let t=Number(e);if(!t)return"";let p=Date.now()/1e3,d=Math.floor(p-t);if(Number.isNaN(d)||d<0)return n(t);if(d<60)return"Just now";let u=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],f=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let m of u)if(d>=m.seconds){let g=Math.floor(d/m.seconds);return f?f.format(-g,m.unit):`${g} ${m.unit}${g!==1?"s":""} ago`}return n(t)},l=e=>{if(typeof e=="string")return e;if(e==null)return"";try{return JSON.stringify(e,null,2)}catch{return String(e)}};function o(){let e=document.getElementById("aipkit_stats_container");if(!e)return;typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(e),typeof window.aipkitStats_initSettingsPopoverPanels=="function"&&window.aipkitStats_initSettingsPopoverPanels(e);let t={days:parseInt(e.dataset.defaultDays||30,10)||30,perPage:20,page:1,search:"",botId:"",module:"",selectedLogId:null},p=wp.i18n&&wp.i18n.__?wp.i18n.__:ae=>ae,d={page:1,search:"",botTitles:{}},u=null,f=null,m=null,g=!1,_={status:e.querySelector("#aipkit_stats_status"),overviewPanel:e.querySelector("#aipkit_stats_overview_panel"),overviewToggle:e.querySelector("#aipkit_stats_overview_toggle"),overviewPeriod:e.querySelector("#aipkit_stats_period_label"),totalConversations:e.querySelector("#aipkit_stats_total_conversations"),totalMessages:e.querySelector("#aipkit_stats_total_messages"),uniqueUsers:e.querySelector("#aipkit_stats_unique_users"),avgTokens:e.querySelector("#aipkit_stats_avg_tokens"),daysFilter:e.querySelector("#aipkit_stats_days_filter"),botFilter:e.querySelector("#aipkit_stats_bot_filter"),moduleFilter:e.querySelector("#aipkit_stats_module_filter"),searchInput:e.querySelector("#aipkit_stats_search_input"),exportBtn:e.querySelector("#aipkit_stats_export_btn"),deleteAllBtn:e.querySelector("#aipkit_stats_delete_all_btn"),tableMenu:e.querySelector("#aipkit_stats_table_menu"),tableMenuTrigger:e.querySelector("#aipkit_stats_table_menu_trigger"),tableBody:e.querySelector("#aipkit_stats_table_body"),pagination:e.querySelector("#aipkit_stats_pagination"),detailPanel:e.querySelector("#aipkit_stats_detail_panel"),conversationChart:e.querySelector("#aipkit_stats_conversation_chart"),moduleChart:e.querySelector("#aipkit_stats_module_chart"),settingsToggle:document.getElementById("aipkit_stats_auto_delete_toggle"),retentionSelect:document.getElementById("aipkit_stats_retention_days"),retentionRow:e.querySelector("[data-aipkit-stats-retention-row]"),cronRow:e.querySelector("[data-aipkit-stats-cron-row]"),cronStatus:document.getElementById("aipkit_stats_cron_status"),cronText:document.getElementById("aipkit_stats_cron_text"),cronLastRun:document.getElementById("aipkit_stats_cron_last_run"),settingsPopover:document.getElementById("aipkit_stats_settings_popover"),settingsTrigger:document.getElementById("aipkit_stats_settings_trigger"),settingsUsersNav:e.querySelector('[data-aipkit-settings-action="users"]'),userSheet:document.getElementById("aipkit_stats_user_sheet"),userSheetClose:document.getElementById("aipkit_stats_user_sheet_close"),userSearchInput:document.getElementById("aipkit_stats_user_search"),userTableBody:document.getElementById("aipkit_stats_user_table_body"),userTableFoot:document.querySelector("#aipkit_stats_user_sheet tfoot"),userPagination:document.getElementById("aipkit_stats_user_pagination"),userNoResults:document.getElementById("aipkit_stats_user_no_results"),shortcodeSnippet:document.getElementById("aipkit_stats_shortcode_snippet"),shortcodeToggle:document.getElementById("aipkit_stats_shortcode_toggle"),shortcodeConfig:document.getElementById("aipkit_stats_shortcode_config"),shortcodeOptions:e.querySelectorAll(".aipkit_stats_shortcode_option")},h=(()=>{try{let ae=e.dataset.moduleLabels||"{}";return JSON.parse(ae)}catch{return{}}})(),y=e.dataset.isPro==="1",E=e.dataset.userCreditsNonce||"",x=(ae,Ce="")=>{if(!_.status)return;let Ae=_.status,Oe=Ae.classList.contains("aipkit_training_status");if(Ae.textContent=ae||"",Ae.classList.remove("aipkit_status_error","aipkit_status_success","aipkit_status_warning","aipkit_status_loading"),Oe){Ae.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ae&&Ae.classList.add("is-visible"),Ce&&Ae.classList.add(`is-${Ce}`);return}Ae.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),Ce==="success"?Ae.classList.add("aipkit_form-help-success"):Ce==="error"&&Ae.classList.add("aipkit_form-help-error")},w=()=>{try{return localStorage.getItem(r)==="1"}catch{return!1}},S=ae=>{_.retentionRow&&(_.retentionRow.hidden=!ae),_.cronRow&&(_.cronRow.hidden=!ae),_.retentionSelect&&(_.retentionSelect.disabled=!ae||!y)},T=ae=>{!ae||!_.cronStatus||(ae.state&&_.cronStatus.setAttribute("data-state",ae.state),_.cronText&&ae.status_text&&(_.cronText.textContent=ae.status_text),_.cronLastRun&&ae.last_run_label&&(_.cronLastRun.textContent=ae.last_run_label))},v=ae=>{_.tableBody&&(_.tableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${i(ae)}</td>
                </tr>
            `)},A=ae=>{_.userTableBody&&(_.userTableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${i(ae)}</td>
                </tr>
            `,_.userNoResults&&(_.userNoResults.hidden=!0))},C=ae=>{if(!ae)return p("N/A","gpt3-ai-content-generator");let Ce=new Date(ae*1e3);return Number.isNaN(Ce.getTime())?p("N/A","gpt3-ai-content-generator"):Ce.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},b=(ae,Ce)=>{let Ae=Array.isArray(ae)?ae:[],Oe='<ul class="aipkit_stats_usage_list">';return Ae.length?(Ae.forEach((Fe,We)=>{let je=We>=2;Oe+=`<li class="${je?"aipkit_stats_usage_extra":""}"${je?" hidden":""}>${Fe}</li>`}),Oe+="</ul>",{html:Oe,hasToggle:Ae.length>2}):(Oe+=`<li>${i(Ce)}</li>`,Oe+="</ul>",{html:Oe,hasToggle:!1})},L=(ae,Ce)=>{if(!_.userTableBody)return;if(_.userTableBody.innerHTML="",!Array.isArray(ae)||ae.length===0){_.userNoResults&&(_.userNoResults.hidden=!1);return}_.userNoResults&&(_.userNoResults.hidden=!0);let Ae=Ce||{};ae.forEach(Oe=>{let Fe=document.createElement("tr");Fe.dataset.userId=Oe.id;let We=document.createElement("td");We.textContent=`${Oe.display_name} (${Oe.email})`,Fe.appendChild(We);let je=document.createElement("td"),Qe=document.createElement("input");Qe.type="number",Qe.className="aipkit_form-input aipkit_stats_credits_balance_input",Qe.value=Oe.token_balance||0,Qe.dataset.userId=Oe.id,Qe.dataset.originalValue=Oe.token_balance||0,Qe.setAttribute("min","0"),Qe.setAttribute("step","1"),Qe.title=p("Press Enter or blur to save changes","gpt3-ai-content-generator"),je.appendChild(Qe);let xt=document.createElement("span");xt.className="aipkit_stats_credits_balance_status",je.appendChild(xt),Fe.appendChild(je);let bi=document.createElement("td");bi.textContent=s(Oe.total_used_all_bots||0),Fe.appendChild(bi);let gt=document.createElement("td"),It=[],ze=Oe.tokens_used||{},Ye=Oe.image_usage||{used:0};Ye.used>0&&It.push(`<strong>${i(p("Image Generator","gpt3-ai-content-generator"))}:</strong> ${s(Ye.used)}`),Object.keys(ze||{}).sort((Ht,Wi)=>Number(Ht)-Number(Wi)).forEach(Ht=>{let Wi=ze[Ht]||0;if(Wi<=0)return;let Sn=Ae[Ht]||`Bot #${Ht}`;It.push(`<strong>${i(Sn)}:</strong> ${s(Wi)}`)});let Ze=b(It,"-");gt.innerHTML=Ze.html+(Ze.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${i(p("Show more","gpt3-ai-content-generator"))}...</button>`:""),Fe.appendChild(gt);let ei=document.createElement("td"),ci=[],Jt=Oe.last_reset||{};Ye.used>0&&ci.push(`<strong>${i(p("Image Generator","gpt3-ai-content-generator"))}:</strong> ${i(C(Ye.last_reset))}`);let Gt=new Set([...Object.keys(ze||{}),...Object.keys(Jt||{})]);Array.from(Gt).sort((Ht,Wi)=>Number(Ht)-Number(Wi)).forEach(Ht=>{if((ze||{})[Ht]<=0)return;let Wi=Ae[Ht]||`Bot #${Ht}`;ci.push(`<strong>${i(Wi)}:</strong> ${i(C(Jt[Ht]||0))}`)});let Di=It.length>0?p("N/A","gpt3-ai-content-generator"):"-",bt=b(ci,Di);ei.innerHTML=bt.html+(bt.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${i(p("Show more","gpt3-ai-content-generator"))}...</button>`:""),Fe.appendChild(ei);let di=document.createElement("td");if(di.className="aipkit_stats_user_actions_cell",Oe.purchase_history&&Oe.purchase_history.length){let Ht=document.createElement("button");Ht.type="button",Ht.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_stats_purchase_history_btn",Ht.title=p("View purchase history","gpt3-ai-content-generator"),Ht.innerHTML='<span class="dashicons dashicons-cart" aria-hidden="true"></span>',Ht.dataset.userName=Oe.display_name,Ht.dataset.history=JSON.stringify(Oe.purchase_history),di.appendChild(Ht)}else di.textContent="-";Fe.appendChild(di),_.userTableBody.appendChild(Fe)})},B=ae=>{if(!_.userPagination||!_.userTableFoot)return;_.userPagination.innerHTML="";let Ce=Number(ae?.total_users||0),Ae=Number(ae?.total_pages||0),Oe=Number(ae?.current_page||1);if(!Ce){_.userTableFoot.hidden=!0;return}let Fe=document.createElement("span");if(Fe.className="aipkit_pagination-count",Fe.textContent=`${Ce.toLocaleString()} ${p("users","gpt3-ai-content-generator")}`,_.userPagination.appendChild(Fe),Ae<=1){_.userTableFoot.hidden=!0;return}let We=document.createElement("span");We.className="aipkit_pagination-links";let je=document.createElement("button");je.type="button",je.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",je.textContent=`\xAB ${p("Previous","gpt3-ai-content-generator")}`,je.disabled=Oe<=1,je.addEventListener("click",()=>$(Oe-1,d.search));let Qe=document.createElement("span");Qe.className="aipkit_pagination-current",Qe.textContent=`${p("Page","gpt3-ai-content-generator")} ${Oe} ${p("of","gpt3-ai-content-generator")} ${Ae}`;let xt=document.createElement("button");xt.type="button",xt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",xt.textContent=`${p("Next","gpt3-ai-content-generator")} \xBB`,xt.disabled=Oe>=Ae,xt.addEventListener("click",()=>$(Oe+1,d.search)),We.appendChild(je),We.appendChild(Qe),We.appendChild(xt),_.userPagination.appendChild(We),_.userTableFoot.hidden=!1},$=async(ae=1,Ce="")=>{if(!(!_.userTableBody||typeof window.aipkit_apiRequest!="function")){A(p("Loading user credits...","gpt3-ai-content-generator")),d.page=ae,d.search=Ce;try{let Ae=await window.aipkit_apiRequest("aipkit_get_user_credits_data",{page:ae,search:Ce});d.botTitles=Ae.bot_titles||{},L(Ae.users_data||[],d.botTitles),B(Ae.pagination||{})}catch(Ae){_.userTableBody&&(_.userTableBody.innerHTML=`
                        <tr>
                            <td colspan="6" class="aipkit_stats_table_placeholder aipkit_text-danger">${i(Ae.message||p("Error loading user credits.","gpt3-ai-content-generator"))}</td>
                        </tr>
                    `),_.userNoResults&&(_.userNoResults.hidden=!0),_.userTableFoot&&(_.userTableFoot.hidden=!0)}}},W=()=>{_.settingsPopover&&(_.settingsPopover.classList.remove("aipkit-active"),_.settingsPopover.setAttribute("aria-hidden","true"),_.settingsTrigger&&_.settingsTrigger.setAttribute("aria-expanded","false"))},U=()=>{_.userSheet&&(_.userSheet.classList.add("aipkit-active"),_.userSheet.setAttribute("aria-hidden","false"),$(d.page,d.search),_.userSearchInput&&_.userSearchInput.focus())},D=()=>{_.userSheet&&(_.userSheet.classList.remove("aipkit-active"),_.userSheet.setAttribute("aria-hidden","true"))},H=()=>{if(!_.shortcodeSnippet||!_.shortcodeOptions)return;let ae=!0,Ce=!0,Ae=!0;_.shortcodeOptions.forEach(We=>{We.name==="cfg_show_chatbot"&&(ae=We.checked),We.name==="cfg_show_aiforms"&&(Ce=We.checked),We.name==="cfg_show_imagegenerator"&&(Ae=We.checked)});let Oe=[];ae||Oe.push('chatbot="false"'),Ce||Oe.push('aiforms="false"'),Ae||Oe.push('imagegenerator="false"');let Fe="[aipkit_token_usage";Oe.length&&(Fe+=` ${Oe.join(" ")}`),Fe+="]",_.shortcodeSnippet.textContent=Fe},Q=(ae,Ce)=>{let Ae=Array.isArray(ae)?ae:[],Oe=document.createElement("div");Oe.className="aipkit-modal-overlay aipkit-active";let Fe=()=>Ae.length?Ae.map(je=>{let Qe=je?.date?.date?new Date(je.date.date):null,xt=Qe&&!Number.isNaN(Qe.getTime())?Qe.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"",bi=(je.products||[]).map(gt=>`
                                <div class="aipkit_stats_purchase_product">
                                    <span class="aipkit_stats_purchase_product_name">${i(gt.name)}</span>
                                    <span class="aipkit_stats_purchase_product_meta">
                                        ${gt.quantity>1?`${Number(gt.quantity)}x `:""}
                                        ${s(gt.tokens_per_item)} ${i(p("tokens","gpt3-ai-content-generator"))}
                                    </span>
                                </div>
                            `).join("");return`
                            <div class="aipkit_stats_purchase_item">
                                <div class="aipkit_stats_purchase_header">
                                    <div class="aipkit_stats_purchase_date">${i(xt)}</div>
                                    <div class="aipkit_stats_purchase_summary">
                                        <span class="aipkit_stats_purchase_tokens">+${s(je.tokens_granted)}</span>
                                        <span class="aipkit_stats_purchase_amount">${i(je.total_amount)} ${i(je.currency)}</span>
                                    </div>
                                </div>
                                <div class="aipkit_stats_purchase_order">${i(p("Order #","gpt3-ai-content-generator"))}${i(je.order_id)}</div>
                                ${bi?`<div class="aipkit_stats_purchase_products">${bi}</div>`:""}
                            </div>
                        `}).join(""):`<p>${i(p("No purchase history found for this user.","gpt3-ai-content-generator"))}</p>`;Oe.innerHTML=`
                <div class="aipkit-modal-content aipkit_stats_purchase_modal">
                    <div class="aipkit-modal-header">
                        <h3 class="aipkit-modal-title">${i(p("Purchase History for","gpt3-ai-content-generator"))} ${i(Ce||"")}</h3>
                        <button class="aipkit-modal-close-btn" type="button" aria-label="${i(p("Close","gpt3-ai-content-generator"))}">&times;</button>
                    </div>
                    <div class="aipkit-modal-body">
                        <div class="aipkit_stats_purchase_history_list">${Fe()}</div>
                    </div>
                </div>
            `;let We=()=>{Oe.classList.remove("aipkit-active"),window.setTimeout(()=>{Oe.parentNode&&Oe.parentNode.removeChild(Oe)},200)};Oe.addEventListener("click",je=>{je.target===Oe&&We()}),Oe.querySelector(".aipkit-modal-close-btn")?.addEventListener("click",We),document.body.appendChild(Oe)},F=ae=>{if(!ae)return;let Ce=ae.dataset.userId,Ae=ae.parentElement?ae.parentElement.querySelector(".aipkit_stats_credits_balance_status"):null,Oe=ae.dataset.originalValue||ae.defaultValue,Fe=ae.value;if(String(Fe)!==String(Oe)){if(!E){Ae&&(Ae.textContent="ERR");return}Ae&&(Ae.innerHTML='<span class="aipkit_spinner"></span>'),clearTimeout(m),m=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",{_ajax_nonce:E,user_id:Ce,balance:Fe}).then(We=>{Ae&&(Ae.textContent="OK"),ae.dataset.originalValue=We.new_balance,window.setTimeout(()=>{Ae&&(Ae.textContent="")},1500)}).catch(()=>{Ae&&(Ae.textContent="ERR"),ae.value=Oe,window.setTimeout(()=>{Ae&&(Ae.textContent="")},2500)})},400)}},P=ae=>{if(!_.conversationChart)return;_.conversationChart.innerHTML="";let Ce=Object.entries(ae||{});if(!Ce.length){_.conversationChart.innerHTML=`<div class="aipkit_stats_table_placeholder">${i("No data available.")}</div>`;return}let Ae=Math.max(...Ce.map(([,It])=>Number(It)||0),1),Oe=document.createElement("div");Oe.className="aipkit_stats_chart_wrapper";let Fe=document.createElement("div");Fe.className="aipkit_stats_y_axis";let We=4;for(let It=We;It>=0;It--){let ze=document.createElement("span");ze.className="aipkit_stats_y_label";let Ye=Math.round(Ae/We*It);ze.textContent=Ye>=1e3?`${(Ye/1e3).toFixed(1)}k`:Ye,Fe.appendChild(ze)}Oe.appendChild(Fe);let je=document.createElement("div");je.className="aipkit_stats_bars_container";for(let It=0;It<We;It++){let ze=document.createElement("div");ze.className="aipkit_stats_grid_line",ze.style.bottom=`${(It+1)/We*100}%`,je.appendChild(ze)}let Qe=document.createElement("div");Qe.className="aipkit_stats_bars_wrapper",Ce.forEach(([It,ze])=>{let Ye=document.createElement("div");Ye.className="aipkit_stats_bar_group";let Ze=document.createElement("div"),ei=Math.max(2,Math.round(Number(ze)/Ae*100));Ze.className="aipkit_stats_bar",Ze.style.height=`${ei}%`,Ze.title=`${It}: ${ze}`,Ye.appendChild(Ze),Qe.appendChild(Ye)}),je.appendChild(Qe),Oe.appendChild(je);let xt=document.createElement("div");xt.className="aipkit_stats_x_axis";let bi=Math.min(Ce.length,7),gt=Math.max(1,Math.floor(Ce.length/bi));Ce.forEach(([It],ze)=>{let Ye=document.createElement("span");if(Ye.className="aipkit_stats_x_label",ze%gt===0||ze===Ce.length-1){let Ze=It.split("-");Ye.textContent=Ze.length>=3?`${Ze[1]}/${Ze[2]}`:It}xt.appendChild(Ye)}),Oe.appendChild(xt),_.conversationChart.appendChild(Oe)},R=ae=>{if(_.moduleChart){if(typeof window.aipkit_renderTokenUsageChart!="function"){_.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${i("Chart renderer unavailable.")}</p>`;return}if(!ae||Object.keys(ae).length===0){_.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${i("No data available.")}</p>`;return}window.aipkit_renderTokenUsageChart(_.moduleChart,ae)}},O=ae=>ae?h[ae]?h[ae]:ae.replace(/[_-]/g," ").replace(/\b\w/g,Ce=>Ce.toUpperCase()):h.chatbot||"Chatbot",N=ae=>{if(!_.tableBody)return;if(!Array.isArray(ae)||!ae.length){v("No logs found.");return}let Ce=ae.map(Ae=>{let Oe=Ae.last_message_content?String(Ae.last_message_content):"",Fe=c(Ae.last_message_ts),We=n(Ae.last_message_ts),je=s(Ae.total_conversation_tokens||0),Qe=Number(Ae.id);return`
                    <tr class="aipkit_stats_row${t.selectedLogId===Qe?" aipkit_stats_row_active":""}" data-log-id="${i(Ae.id)}">
                        <td title="${i(We)}">${i(Fe)}</td>
                        <td>${i(Ae.user_display_name||"\u2014")}</td>
                        <td>${i(Ae.bot_name||O(Ae.module))}</td>
                        <td>${i(s(Ae.message_count||0))}</td>
                        <td>${i(je)}</td>
                        <td><span class="aipkit_stats_preview">${i(Oe)}</span></td>
                    </tr>
                `});_.tableBody.innerHTML=Ce.join("")},ie=()=>({days:t.days,bot_id:t.botId,module:t.module,search:t.search}),J=(ae,Ce)=>{let Ae=new Blob([ae],{type:"text/csv;charset=utf-8;"}),Oe=URL.createObjectURL(Ae),Fe=document.createElement("a");Fe.href=Oe,Fe.download=Ce||"aipkit-logs.csv",document.body.appendChild(Fe),Fe.click(),Fe.remove(),URL.revokeObjectURL(Oe)},we=async ae=>{if(!(!ae||!window.confirm("Delete this conversation?"))){x("Deleting conversation...");try{let Ae=await window.aipkit_apiRequest("aipkit_stats_delete_log",{log_id:ae});x(Ae.message||"Conversation deleted."),t.selectedLogId===Number(ae)&&(t.selectedLogId=null,_t(null)),Nt(),window.setTimeout(()=>x(""),2e3)}catch(Ae){x(Ae.message||"Failed to delete conversation.","error")}}},$e=async()=>{if(window.confirm("Delete all logs that match the current filters?")){x("Deleting logs...");try{let Ce=await window.aipkit_apiRequest("aipkit_stats_delete_logs",ie());x(Ce.message||"Logs deleted."),t.selectedLogId=null,_t(null),Nt(),window.setTimeout(()=>x(""),2500)}catch(Ce){x(Ce.message||"Failed to delete logs.","error")}}},Ke=async()=>{x("Preparing export...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_export_logs",ie());if(!ae||!ae.csv)throw new Error("Export failed.");J(ae.csv,ae.filename),x(ae.message||"Export ready."),window.setTimeout(()=>x(""),2e3)}catch(ae){x(ae.message||"Failed to export logs.","error")}},Ue=ae=>{if(!_.tableMenu||!_.tableMenuTrigger)return;let Ce=ae??_.tableMenu.hidden;_.tableMenu.hidden=!Ce,_.tableMenuTrigger.setAttribute("aria-expanded",Ce?"true":"false")},it=ae=>{if(_.pagination){if(typeof window.aipkit_renderLogsPagination=="function"){window.aipkit_renderLogsPagination(ae,_.pagination,Ce=>{t.page=Ce,Nt()});return}_.pagination.innerHTML=""}},_t=ae=>{if(!_.detailPanel)return;if(!ae){_.detailPanel.innerHTML=`
                    <div class="aipkit_stats_detail_empty">
                        <div>
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.4; margin-bottom: 12px;">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <div>${i("Select a conversation to view details.")}</div>
                        </div>
                    </div>
                `;return}let Ce=Ye=>{let Ze=(Ye||"").toLowerCase();return Ze==="assistant"||Ze==="model"||Ze==="bot"?"bot":Ze==="user"?"user":Ze||"unknown"},Ae=(Ye,Ze)=>{for(let ei=Ze+1;ei<Ye.length;ei+=1)if(Ce(Ye[ei]?.role)==="bot")return Ye[ei];return null},Oe=Ye=>Ye>=85?"is-excellent":Ye>=70?"is-good":Ye>=50?"is-fair":"is-poor",Fe=`
                <div class="aipkit_stats_detail_header">
                    <div class="aipkit_stats_detail_title">${i(ae.user_display_name||"User")}</div>
                    <div class="aipkit_stats_detail_meta">
                        ${i(ae.bot_name||O(ae.module))}
                        &middot; ${i(n(ae.last_message_ts))}
                        &middot; ${i(s(ae.message_count||0))} ${i("messages")}
                        ${ae.ip_address?`&middot; ${i(`IP ${ae.ip_address}`)}`:""}
                    </div>
                </div>
            `,We=Array.isArray(ae.messages)?ae.messages:[],je=String(ae.module||"").toLowerCase().replace(/[\s-]+/g,"_"),Qe=(()=>{if(typeof window.markdownit!="function")return null;let Ye=window.markdownit({html:!1,linkify:!0,typographer:!0});return window.hljs&&typeof window.markdownitHighlight=="function"&&Ye.use(window.markdownitHighlight,{hljs:window.hljs}),Ye})(),xt=Ye=>{let Ze=String(Ye||"").trim().toLowerCase();return Ze?Ze.startsWith("generate ")||Ze.startsWith("content writer request"):!1},bi=Ye=>{if(!Ye||typeof Ye!="object")return null;let Ze=Ye.payload_sent;if(!Ze||typeof Ze!="object")return null;let ei=Array.isArray(Ze.messages)?Ze.messages:Array.isArray(Ze.input)?Ze.input:null;if(!Array.isArray(ei))return null;let ci=ei.find(Jt=>Jt&&Jt.role==="user"&&typeof Jt.content=="string"&&Jt.content.trim());return ci?ci.content.trim():null},gt=(Ye,Ze)=>{if(!Ye||typeof Ye!="object")return null;let ei={"generate excerpt":"custom_excerpt_prompt","generate tags":"custom_tags_prompt","generate meta description":"custom_meta_prompt","generate focus keyword":"custom_keyword_prompt","generate image prompt":"image_prompt","generate featured image":"featured_image_prompt","generate title":"custom_title_prompt"},ci=String(Ze||"").trim().toLowerCase(),Jt=ei[ci];if(!Jt||typeof Ye[Jt]!="string")return null;let Gt=Ye[Jt].trim();return Gt||null},It=Ye=>{if(!Ye||typeof Ye!="object")return null;for(let Ze in Ye){if(!Object.prototype.hasOwnProperty.call(Ye,Ze)||!/_prompt$/i.test(Ze))continue;let ei=Ye[Ze];if(typeof ei=="string"&&ei.trim())return ei.trim()}return null};if(je==="content_writer"&&Array.isArray(We)&&We.length)for(let Ye=0;Ye<We.length;Ye+=1){let Ze=We[Ye];if(!Ze||Ze.role!=="user"||typeof Ze.content!="string")continue;let ei=Ze.content.trim();if(!ei||!xt(ei))continue;let ci=null,Jt=We[Ye+1]?.request_payload;Jt&&(ci=bi(Jt)),!ci&&Ze.request_payload&&(ci=bi(Ze.request_payload)),!ci&&Ze.request_payload&&(ci=gt(Ze.request_payload,ei)),!ci&&Ze.request_payload&&(ci=It(Ze.request_payload)),ci&&(Ze.original_content=Ze.content,Ze.content=ci)}let ze=We.map((Ye,Ze)=>{let ei=Ce(Ye.role),ci=n(Ye.timestamp),Jt=l(Ye.content),Gt=ei==="user"?"User":ei==="bot"?"Assistant":ei,bt=String(Ye.message_id||`msg_${Ze}`).replace(/[^a-zA-Z0-9_-]/g,"")||`msg_${Ze}`,di=[],Ht="",Wi="",Sn="";if(ei==="user"){let At=Ae(We,Ze),et=At?.provider||"",Lt=At?.model||"",fi=At?.usage?.total_tokens??At?.usage?.totalTokenCount??null;et&&di.push(et),Lt&&di.push(Lt),typeof fi=="number"&&fi>0&&di.push(`${s(fi)} tokens`);let Vt=At?.request_payload||null;if(di.length||Vt)if(Vt){let hi=`aipkit_stats_payload_${bt}`,mi=di.length?di.join(" / "):"Request payload";Ht=`
                                <button type="button" class="aipkit_stats_meta_toggle" data-aipkit-stats-toggle="${hi}" aria-expanded="false">
                                    <span>${i(mi)}</span>
                                    <span class="aipkit_stats_meta_chevron" aria-hidden="true"></span>
                                </button>
                            `,Sn+=`
                                <div class="aipkit_stats_expandable" id="${hi}" hidden>
                                    <div class="aipkit_stats_expandable_header">${i("Request Payload")}</div>
                                    <div class="aipkit_stats_expandable_body">
                                        <pre class="aipkit_stats_payload">${i(JSON.stringify(Vt,null,2))}</pre>
                                    </div>
                                </div>
                            `}else di.length&&(Ht=`<div class="aipkit_stats_meta_info">${i(di.join(" / "))}</div>`)}if(ei==="bot"){let At=Array.isArray(Ye.vector_search_scores)?Ye.vector_search_scores:[];if(At.length>0){let et=At.reduce((mi,Bi)=>{let gi=Number(mi?.score??0);return Number(Bi?.score??0)>gi?Bi:mi},At[0]),Lt=et?.score!==void 0?Math.round(Number(et.score)*100):0,fi=Oe(Lt),Vt=`aipkit_stats_scores_${bt}`;Wi=`
                            <button type="button" class="aipkit_stats_score_badge ${fi}" data-aipkit-stats-toggle="${Vt}" aria-expanded="false">
                                ${i(`Score ${Lt}%`)}
                            </button>
                        `;let hi=At.map(mi=>{let Bi=mi?.provider||"Unknown",gi="";if(Bi==="OpenAI")gi=mi.store_name||mi.store_id?` \xB7 ${mi.store_name||mi.store_id}`:"";else if(Bi==="Pinecone"){let pi=mi.namespace?` \xB7 ${mi.namespace}`:"";gi=mi.index_name?` \xB7 ${mi.index_name}${pi}`:pi}else Bi==="Qdrant"&&(gi=mi.collection_name?` \xB7 ${mi.collection_name}`:"");let ti=mi?.score!==void 0?Math.round(Number(mi.score)*100):null,ji=ti!==null?Oe(ti):"is-poor",Pe=mi?.content_preview||"";return`
                                <div class="aipkit_stats_score_item">
                                    <div class="aipkit_stats_score_title">${i(Bi)}${i(gi)}</div>
                                    <div class="aipkit_stats_score_value ${ji}">
                                        ${i(ti!==null?`${ti}%`:"\u2014")}
                                    </div>
                                    <div class="aipkit_stats_score_preview">${i(Pe)}</div>
                                </div>
                            `}).join("");Sn+=`
                            <div class="aipkit_stats_expandable" id="${Vt}" hidden>
                                <div class="aipkit_stats_expandable_header">${i("Vector Search Results")}</div>
                                <div class="aipkit_stats_expandable_body aipkit_stats_scores_list">
                                    ${hi}
                                </div>
                            </div>
                        `}}let Ki=!!Ht,ln=!!Wi,_e=Ki||ln?`
                    <div class="aipkit_stats_meta_bar${Ki&&!ln||!Ki&&ln?" aipkit_stats_meta_bar--compact":""}">
                        ${Ki?Ht:""}
                        <div class="aipkit_stats_meta_actions">
                            ${Wi||""}
                        </div>
                    </div>
                `:"",be=!!(Qe&&typeof Jt=="string"),Te=be?Qe.render(Jt):i(Jt);return`
                    <div class="aipkit_stats_message aipkit_stats_message--${i(ei)}" style="animation-delay: ${Ze*.05}s">
                        <div class="aipkit_stats_message_meta">${i(Gt)}${ci?` \xB7 ${i(ci)}`:""}</div>
                        <div class="aipkit_stats_message_body${be?" aipkit_stats_message_body--markdown":""}">${Te}</div>
                        ${_e}
                        ${Sn}
                    </div>
                `}).join("");_.detailPanel.innerHTML=`
                ${Fe}
                <div class="aipkit_stats_detail_messages">
                    ${ze||`<div class="aipkit_stats_table_placeholder">${i("No messages found.")}</div>`}
                    <div class="aipkit_stats_detail_footer">
                        <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_stats_detail_delete" data-log-id="${i(ae.id)}">
                            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                            ${i("Delete")}
                        </button>
                    </div>
                </div>
            `},mt=async()=>{x("Loading stats...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_overview",{days:t.days});_.totalConversations.textContent=s(ae.summary?.total_conversations||0),_.totalMessages.textContent=s(ae.summary?.total_messages||0),_.uniqueUsers.textContent=s(ae.summary?.unique_users||0),_.avgTokens.textContent=s(ae.summary?.avg_tokens||0),_.overviewPeriod&&(_.overviewPeriod.textContent=ae.summary?.period_label||""),P(ae.charts?.daily_conversations||{}),R(ae.charts?.daily_tokens||{}),x("")}catch(ae){x(ae.message||"Failed to load stats.","error")}},Ot=(ae,Ce=!0)=>{if(_.overviewPanel){if(_.overviewPanel.hidden=!ae,_.overviewToggle&&(_.overviewToggle.setAttribute("aria-expanded",ae?"true":"false"),_.overviewToggle.classList.toggle("is-active",ae)),Ce)try{localStorage.setItem(r,ae?"1":"0")}catch{}ae&&mt()}},Nt=async()=>{v("Loading logs...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_logs",{days:t.days,page:t.page,per_page:t.perPage,bot_id:t.botId,module:t.module,search:t.search}),Ce=Array.isArray(ae.logs)?ae.logs:[];!t.selectedLogId&&!g&&Ce.length&&(t.selectedLogId=Number(Ce[0].id),g=!0),N(Ce),it(ae.pagination||{}),t.selectedLogId&&g&&qe(t.selectedLogId)}catch(ae){v(ae.message||"Failed to load logs.")}},qe=async ae=>{if(!ae){_t(null);return}_.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${i("Loading conversation...")}</div>`;try{let Ce=await window.aipkit_apiRequest("aipkit_stats_get_log_detail",{log_id:ae});_t(Ce)}catch(Ce){_.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${i(Ce.message||"Failed to load conversation.")}</div>`}},qt=ae=>{t.search=ae.trim(),t.page=1,u&&clearTimeout(u),u=window.setTimeout(()=>{Nt()},300)},Wt=async()=>{if(_.cronStatus)try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_log_cron_status",{});T(ae)}catch{}},ui=async()=>{if(!_.settingsToggle||!_.retentionSelect)return;let ae=_.settingsToggle.checked?"1":"0",Ce=parseInt(_.retentionSelect.value,10)||90;x("Saving settings...","loading");try{let Ae=await window.aipkit_apiRequest("aipkit_stats_save_settings",{enable_pruning:ae,retention_period_days:Ce});S(_.settingsToggle.checked),x(Ae.message||"Settings saved.","success"),Wt(),window.setTimeout(()=>x(""),2e3)}catch(Ae){x(Ae.message||"Failed to save settings.","error")}};if(_.daysFilter&&(_.daysFilter.value=String(t.days),_.daysFilter.addEventListener("change",()=>{t.days=parseInt(_.daysFilter.value,10)||30,t.page=1,_.overviewPanel&&!_.overviewPanel.hidden&&mt(),Nt()})),_.botFilter&&_.botFilter.addEventListener("change",()=>{t.botId=_.botFilter.value,t.page=1,Nt()}),_.moduleFilter&&_.moduleFilter.addEventListener("change",()=>{t.module=_.moduleFilter.value,t.page=1,Nt()}),_.searchInput&&_.searchInput.addEventListener("input",ae=>{qt(ae.target.value||"")}),_.overviewToggle&&_.overviewPanel&&_.overviewToggle.addEventListener("click",()=>{let ae=!_.overviewPanel.hidden;Ot(!ae)}),_.tableBody&&_.tableBody.addEventListener("click",ae=>{let Ce=ae.target.closest("tr[data-log-id]");if(!Ce)return;let Ae=Ce.getAttribute("data-log-id");Ae&&(t.selectedLogId=Number(Ae),_.tableBody.querySelectorAll("tr").forEach(Oe=>{Oe.classList.toggle("aipkit_stats_row_active",Oe===Ce)}),qe(Ae))}),_.detailPanel&&_.detailPanel.addEventListener("click",ae=>{let Ce=ae.target.closest(".aipkit_stats_detail_delete");if(!Ce){let Ae=ae.target.closest("[data-aipkit-stats-toggle]");if(!Ae)return;let Oe=Ae.getAttribute("data-aipkit-stats-toggle");if(!Oe)return;let Fe=document.getElementById(Oe);if(!Fe)return;let We=Ae.getAttribute("aria-expanded")==="true";Fe.hidden=We,Ae.setAttribute("aria-expanded",We?"false":"true"),Ae.classList.toggle("is-expanded",!We);return}we(Ce.getAttribute("data-log-id"))}),_.tableMenuTrigger&&_.tableMenu&&_.tableMenuTrigger.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),Ue(_.tableMenu.hidden)}),document.addEventListener("click",ae=>{!_.tableMenu||_.tableMenu.hidden||ae.target.closest("#aipkit_stats_table_menu")||ae.target.closest("#aipkit_stats_table_menu_trigger")||Ue(!1)}),document.addEventListener("keydown",ae=>{ae.key!=="Escape"||!_.tableMenu||_.tableMenu.hidden||Ue(!1)}),_.deleteAllBtn&&_.deleteAllBtn.addEventListener("click",()=>{Ue(!1),$e()}),_.exportBtn&&_.exportBtn.addEventListener("click",()=>{Ue(!1),Ke()}),_.settingsToggle&&_.settingsToggle.addEventListener("change",()=>{if(!y){_.settingsToggle.checked=!1,x("Upgrade to Pro to enable auto-delete.","error");return}S(_.settingsToggle.checked),ui()}),_.retentionSelect&&_.retentionSelect.addEventListener("change",()=>{y&&ui()}),_.shortcodeToggle&&_.shortcodeConfig&&_.shortcodeToggle.addEventListener("click",ae=>{ae.preventDefault();let Ce=!_.shortcodeConfig.hidden;_.shortcodeConfig.hidden=Ce,_.shortcodeToggle.setAttribute("aria-expanded",Ce?"false":"true"),_.shortcodeToggle.classList.toggle("is-active",!Ce)}),_.shortcodeOptions&&_.shortcodeOptions.length&&(_.shortcodeOptions.forEach(ae=>{ae.addEventListener("change",H)}),H()),_.shortcodeSnippet&&_.shortcodeSnippet.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(_.shortcodeSnippet.textContent,_.shortcodeSnippet)}),_.settingsUsersNav&&_.settingsUsersNav.addEventListener("click",ae=>{ae.preventDefault(),W(),U()}),_.userSheetClose&&_.userSheetClose.addEventListener("click",ae=>{ae.preventDefault(),D()}),_.userSheet&&_.userSheet.addEventListener("click",ae=>{ae.target===_.userSheet&&D()}),_.userSearchInput&&(_.userSearchInput.addEventListener("input",()=>{clearTimeout(f);let ae=_.userSearchInput.value.trim();f=window.setTimeout(()=>{$(1,ae)},350)}),_.userSearchInput.addEventListener("keydown",ae=>{if(ae.key==="Enter"){ae.preventDefault(),clearTimeout(f);let Ce=_.userSearchInput.value.trim();$(1,Ce),_.userSearchClear&&(_.userSearchClear.hidden=Ce.length===0)}})),_.userSearchClear&&_.userSearchClear.addEventListener("click",()=>{_.userSearchInput&&(_.userSearchInput.value=""),_.userSearchClear.hidden=!0,$(1,"")}),_.userTableBody){let ae="data-user-credits-listeners";_.userTableBody.getAttribute(ae)||(_.userTableBody.addEventListener("change",Ce=>{Ce.target.matches(".aipkit_stats_credits_balance_input")&&F(Ce.target)}),_.userTableBody.addEventListener("keypress",Ce=>{Ce.key==="Enter"&&Ce.target.matches(".aipkit_stats_credits_balance_input")&&(Ce.preventDefault(),Ce.target.blur())}),_.userTableBody.addEventListener("click",Ce=>{let Ae=Ce.target.closest(".aipkit_stats_usage_toggle");if(Ae){Ce.preventDefault();let Fe=Ae.closest("td");if(Fe){let We=Fe.querySelectorAll(".aipkit_stats_usage_extra");if(We.length){let je=We[0].hidden;We.forEach(Qe=>{Qe.hidden=!je}),Ae.textContent=je?p("Show less","gpt3-ai-content-generator"):`${p("Show more","gpt3-ai-content-generator")}...`}}return}let Oe=Ce.target.closest(".aipkit_stats_purchase_history_btn");if(Oe){Ce.preventDefault();let Fe=Oe.dataset.history?JSON.parse(Oe.dataset.history):[];Q(Fe,Oe.dataset.userName||"")}}),_.userTableBody.setAttribute(ae,"true"))}document.addEventListener("keydown",ae=>{ae.key==="Escape"&&_.userSheet&&_.userSheet.classList.contains("aipkit-active")&&D()}),Ot(w(),!1),Nt(),S(!!_.settingsToggle?.checked)}window.aipkit_initStats=o})();(function(){"use strict";function k(){let a={},r=document.getElementById("aipkit_settings_container");return r&&r.querySelectorAll("input[name], select[name], textarea[name]").forEach(s=>{s.type==="checkbox"?a[s.name]=s.checked?"1":"0":s.type==="radio"?s.checked&&(a[s.name]=s.value):a[s.name]=s.value}),a}window.aipkit_getCurrentFormData=k})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function k(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let a=window.aipkit_getCurrentFormData(),r=window.aipkit_lastSavedData||{};if(JSON.stringify(a)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let i="aipkit_settings_messages";window.aipkit_showSavingIndicator(i,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",a),window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"success","Settings saved!"),window.aipkit_lastSavedData=a,typeof window.aipkit_queueProviderAutoSync=="function"&&window.aipkit_queueProviderAutoSync(r,a)}catch(s){window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"error","Save failed: "+s.message),console.error("AIPKit Auto-Save Error:",s)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let i="data-autosave-listener-attached";r.getAttribute(i)||(r.addEventListener("change",function(s){let n=s.target;n.matches(".aipkit_autosave_trigger")&&n.id!=="aipkit_provider"&&(n.tagName.toLowerCase()==="select"||n.type==="checkbox"||n.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),r.addEventListener("blur",function(s){let n=s.target;if(n.matches(".aipkit_autosave_trigger")&&n.id!=="aipkit_provider"){let c=n.tagName.toLowerCase();(c==="input"||c==="textarea")&&n.type!=="range"&&n.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),r.setAttribute(i,"true"))}function a(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=k,window.aipkit_updateLastSavedData=a})();(function(){"use strict";function k(r){try{return new Date(r+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return r}}function a(r){return typeof r!="number"?r:r.toLocaleString()}window.aipkit_formatChartDate=k,window.aipkit_formatChartNumber=a})();(function(){"use strict";let k=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],a="#B0BEC5",r={};function i(n){r={};let c=0;n.forEach(l=>{if(l==="Other")r[l]=a;else{let o;do o=k[c%k.length],c++;while(o===a&&k.length>1);r[l]=o}})}function s(n){return r[n]||"#cccccc"}window.aipkit_assignModuleColors=i,window.aipkit_getModuleColor=s})();(function(){"use strict";function k(s,n){if(!n||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let c=s.target,l=c.getAttribute("data-date"),o=c.getAttribute("data-module"),e=parseInt(c.getAttribute("data-value"),10),t=parseInt(c.getAttribute("data-daily-total"),10),p=window.aipkit_getModuleColor(o),d=o?a(o.replace(/[-_]/g," ")):"Unknown";n.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(l)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${p}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${d}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(e)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(t)} tokens)</span>
        `,n.classList.add("aipkit_active"),r(s,n)}function a(s){return s?s.charAt(0).toUpperCase()+s.slice(1):""}function r(s,n){if(!n)return;let c=n.parentElement;if(!c)return;let l=c.getBoundingClientRect(),o=s.clientX-l.left,e=s.clientY-l.top,t=n.offsetWidth,p=n.offsetHeight,d=o+15,u=e-p-10;d+t>l.width-5&&(d=o-t-15),d<5&&(d=5),u<5&&(u=e+15),u+p>l.height-5&&(u=l.height-p-5),n.style.left=`${d}px`,n.style.top=`${u}px`,n.style.transform="translate(0, 0)"}function i(s){s&&s.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=k,window.aipkit_moveChartTooltip=r,window.aipkit_hideChartTooltip=i})();(function(){"use strict";let k="http://www.w3.org/2000/svg";function a(i,s){if(i.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),i.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let n=Object.keys(s);if(n.length===0){i.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let c=new Set;n.forEach(C=>{Object.keys(s[C]).forEach(b=>c.add(b))});let l=Array.from(c);l.sort((C,b)=>{if(C==="Other")return 1;if(b==="Other")return-1;let L=B=>B?r(B.replace(/[-_]/g," ")):"Unknown";return L(C).localeCompare(L(b))}),window.aipkit_assignModuleColors(l);let o=1;n.forEach(C=>{let b=Object.values(s[C]).reduce((L,B)=>L+B,0);b>o&&(o=b)}),o=o*1.05;let e=n.length,t=250,p=l.length>0?Math.max(40,Math.ceil(l.length/3)*20):0,d={top:20,right:20,bottom:30+p,left:50},u=i.clientWidth-d.left-d.right,f=t-d.top-d.bottom,m=Math.max(1,u/e*.8),g=Math.max(0,u/e*.2),_=document.createElementNS(k,"svg");_.setAttribute("viewBox",`0 0 ${i.clientWidth} ${t}`),_.setAttribute("preserveAspectRatio","xMidYMid meet"),_.setAttribute("class","aipkit_token_usage_chart_svg"),_.setAttribute("aria-label","Token usage per module per day chart");let h=document.createElementNS(k,"g");h.setAttribute("transform",`translate(${d.left}, ${d.top})`),_.appendChild(h);let y=document.createElement("div");y.className="aipkit_chart_tooltip",i.style.position="relative",i.appendChild(y);let E=document.createElementNS(k,"g");E.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),h.appendChild(E);let x=document.createElementNS(k,"line");x.setAttribute("x1",0),x.setAttribute("y1",0),x.setAttribute("x2",0),x.setAttribute("y2",f),E.appendChild(x);let w=5;for(let C=0;C<w;C++){let b=Math.round(o*(C/(w-1))),L=f-f*(C/(w-1)),B=document.createElementNS(k,"text");B.setAttribute("x",-5),B.setAttribute("y",L+3),B.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),B.textContent=window.aipkit_formatChartNumber(b),E.appendChild(B);let $=document.createElementNS(k,"line");$.setAttribute("x1",0),$.setAttribute("y1",L),$.setAttribute("x2",u),$.setAttribute("y2",L),$.setAttribute("class","aipkit_chart_grid_line"),h.insertBefore($,h.firstChild)}let S=document.createElementNS(k,"g");S.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),S.setAttribute("transform",`translate(0, ${f})`),h.appendChild(S);let T=document.createElementNS(k,"line");T.setAttribute("x1",0),T.setAttribute("y1",0),T.setAttribute("x2",u),T.setAttribute("y2",0),S.appendChild(T);let v=Math.max(1,Math.ceil(e/(u/60)));n.forEach((C,b)=>{if(b%v===0||b===e-1){let L=b*(m+g)+m/2+g/2,B=document.createElementNS(k,"text");B.setAttribute("x",L),B.setAttribute("y",d.bottom-p-10),B.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),B.textContent=window.aipkit_formatChartDate(C),S.appendChild(B)}});let A=document.createElementNS(k,"g");if(h.appendChild(A),n.forEach((C,b)=>{let L=s[C],B=f,$=0;l.filter(D=>L[D]>0).forEach(D=>{let H=L[D]||0;$+=H;let Q=H/o*f;B-=Q;let F=b*(m+g)+g/2,P=document.createElementNS(k,"rect");P.setAttribute("x",F),P.setAttribute("y",B),P.setAttribute("width",m),P.setAttribute("height",Math.max(.1,Q)),P.setAttribute("class","aipkit_chart_bar"),P.setAttribute("fill",window.aipkit_getModuleColor(D)),P.setAttribute("data-date",C),P.setAttribute("data-module",D),P.setAttribute("data-value",H),P.setAttribute("data-daily-total",0),P.addEventListener("mouseenter",R=>window.aipkit_showStackedTooltip(R,y)),P.addEventListener("mousemove",R=>window.aipkit_moveChartTooltip(R,y)),P.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(y)),A.appendChild(P)}),A.querySelectorAll(`rect[data-date="${C}"]`).forEach(D=>D.setAttribute("data-daily-total",$))}),l.length>0){let C=document.createElementNS(k,"g");C.setAttribute("class","aipkit_chart_legend"),C.setAttribute("transform",`translate(0, ${f+d.bottom-p+5})`),h.appendChild(C);let b=0,L=0,B=20,$=u,W=35;l.forEach(U=>{let D=r(U.replace(/[-_]/g," ")),Q=D.length*7+25+W;b>0&&b+Q>$&&(b=0,L+=B);let F=document.createElementNS(k,"g");F.setAttribute("transform",`translate(${b}, ${L})`);let P=document.createElementNS(k,"rect");P.setAttribute("width",10),P.setAttribute("height",10),P.setAttribute("y",-5),P.setAttribute("fill",window.aipkit_getModuleColor(U)),F.appendChild(P);let R=document.createElementNS(k,"text");R.setAttribute("x",15),R.setAttribute("y",0),R.setAttribute("class","aipkit_chart_legend_label"),R.textContent=D,F.appendChild(R),C.appendChild(F),b+=Q})}i.appendChild(_)}function r(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}window.aipkit_renderTokenUsageChart=a})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_token_usage_chart_container");if(!r){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let i=r.querySelector(".aipkit_chart_loading_placeholder"),s=r.querySelector(".aipkit_chart_error_placeholder"),n=r.querySelector(".aipkit_chart_nodata_placeholder");s&&(s.style.display="none"),n&&(n.style.display="none"),i&&(i.style.display="flex");let c=[3,7,14,30,90],l=parseInt(a,10);if(!l||isNaN(l)){try{let e=localStorage.getItem("aipkit_stats_period_days"),t=parseInt(e,10);e&&!isNaN(t)&&c.includes(t)&&(l=t)}catch{}let o=document.getElementById("aipkit_stats_period_select");if(o){let e=parseInt(o.value,10);(!l||isNaN(l))&&(l=!isNaN(e)&&c.includes(e)?e:3),c.includes(l)&&String(o.value)!==String(l)&&(o.value=String(l))}else r.dataset.defaultDays?l=parseInt(r.dataset.defaultDays,10)||3:l=3}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:l}).then(o=>{if(i&&(i.style.display="none"),o&&o.daily_token_data){let e=o.daily_token_data;if(e&&typeof e=="object"&&Object.values(e).some(p=>p&&typeof p=="object"&&Object.values(p).some(d=>Number(d)>0)))window.aipkit_renderTokenUsageChart(r,e);else{let p=o.notice||window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.",d=o.manage_logs_url,u=s||n;if(u){u.textContent="";let f=document.createTextNode(p+" ");if(u.appendChild(f),d){let m=document.createElement("a");m.href=d,m.target="_blank",m.rel="noopener noreferrer",m.textContent=window.aipkit_dashboard?.text?.manageLogs||"View stats",u.appendChild(m)}u.style.display="flex"}else{let f=document.createElement("div");f.className="aipkit_chart_error_placeholder",f.textContent=p,r.innerHTML="",r.appendChild(f)}}}else throw new Error("Invalid data received for chart.")}).catch(o=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",o),i&&(i.style.display="none"),s)s.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${o.message})`,s.style.display="flex";else{let e=document.createElement("div");e.className="aipkit_chart_error_placeholder",e.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${o.message})`,r.innerHTML="",r.appendChild(e)}})}window.aipkit_loadTokenUsageChart=k,document.addEventListener("change",function(a){let r=a.target;if(r&&r.id==="aipkit_stats_period_select"){let i=parseInt(r.value,10)||7;typeof window.aipkit_loadTokenUsageChart=="function"&&window.aipkit_loadTokenUsageChart(i);try{[3,7,14,30,90].includes(i)&&localStorage.setItem("aipkit_stats_period_days",String(i))}catch{}}})})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function a(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openai=r);let i=document.getElementById("aipkit_openai_model"),s=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openai_model"]');if(!i&&s.length===0){console.warn("OpenAI Sync: No OpenAI model selects found (#aipkit_openai_model or chat selects).");return}let n=window.aipkit_dashboard?.recommendedModels?.openai||[],c=Array.isArray(n)?n:[],l=g=>{if(!g)return[];let _=k("Recommended","gpt3-ai-content-generator"),h=Array.from(g.querySelectorAll("optgroup")).find(y=>y.label===_||y.label==="Recommended");return h?Array.from(h.querySelectorAll("option")).map(y=>({id:y.value,name:y.textContent.trim()||y.value})).filter(y=>y.id):[]};if(c.length===0){let g=i||s[0];c=l(g)}let o=new Set(c.map(g=>g?.id).filter(Boolean)),e=r&&typeof r=="object"?r:{},t=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],p=Object.keys(e),d=t.filter(g=>p.includes(g)).concat(p.filter(g=>!t.includes(g)).sort()),u=g=>{let _=g.value;g.innerHTML="";let h=!1,y=!1;if(c.length>0){let E=document.createElement("optgroup");E.label=k("Recommended","gpt3-ai-content-generator"),c.forEach(x=>{if(!x||typeof x!="object"||!x.id)return;let w=new Option(x.name||x.id,x.id);x.id===_&&(w.selected=!0,h=!0),E.appendChild(w)}),E.children.length>0&&(g.appendChild(E),y=!0)}if(d.forEach(E=>{let x=Array.isArray(e[E])?e[E].slice():[];if(x.length===0)return;x.sort((S,T)=>(S.name||S.id||"").localeCompare(T.name||T.id||""));let w=document.createElement("optgroup");w.label=E,x.forEach(S=>{let T=S?.id||"";if(!T||o.has(T))return;let v=new Option(S.name||T,T);T===_&&(v.selected=!0,h=!0),w.appendChild(v)}),w.children.length>0&&(g.appendChild(w),y=!0)}),!y){g.appendChild(new Option("No models found.",""));return}if(!h&&_&&!g.querySelector(`option[value="${CSS.escape(_)}"]`)){let E=new Option(_+" (manual)",_,!1,!0);g.insertBefore(E,g.firstChild),g.value=_,h=!0}if(g.options.length>0&&g.selectedIndex===-1){let E=-1;for(let x=0;x<g.options.length;x++)if(!g.options[x].disabled&&g.options[x].value){E=x;break}g.selectedIndex=E!==-1?E:0}};i&&u(i),s.forEach(u);let f=document.getElementById("aipkit_content_writer_provider"),m=document.getElementById("aipkit_content_writer_model");f&&m&&f.value==="openai"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(f,m)}window.aipkit_updateOpenAIModels=a})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function a(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openrouter=Array.isArray(r)?r:[]);let i=document.getElementById("aipkit_openrouter_model"),s=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openrouter_model"]');if(!i&&s.length===0){console.warn("OpenRouter Sync: No OpenRouter model selects found (#aipkit_openrouter_model or chat selects).");return}let n=window.aipkit_dashboard?.recommendedModels?.openrouter||[],c=Array.isArray(n)?n:[],l=t=>{if(!t)return[];let p=k("Recommended","gpt3-ai-content-generator"),d=Array.from(t.querySelectorAll("optgroup")).find(u=>u.label===p||u.label==="Recommended");return d?Array.from(d.querySelectorAll("option")).map(u=>({id:u.value,name:u.textContent.trim()||u.value})).filter(u=>u.id):[]};if(c.length===0){let t=i||s[0];c=l(t)}let o=new Set(c.map(t=>t?.id).filter(Boolean)),e=t=>{let p=t.value;t.innerHTML="";let d=!1,u=!1;if(c.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),c.forEach(_=>{if(_&&typeof _=="object"&&_.id){let h=new Option(_.name||_.id,_.id);_.id===p&&(h.selected=!0,d=!0),g.appendChild(h)}}),g.children.length>0&&(t.appendChild(g),u=!0)}if(!r||!r.length){u||t.appendChild(new Option("No models found.",""));return}let f={};if(r.forEach(g=>{if(!g||!g.id||o.has(g.id))return;let _=g.id.split("/"),h=(_.length>1?_[0]:"other").toLowerCase();f[h]||(f[h]=[]),f[h].push(g)}),Object.keys(f).sort().forEach(g=>{let _=document.createElement("optgroup");_.label=g.charAt(0).toUpperCase()+g.slice(1),f[g].sort((h,y)=>(h.name||"").localeCompare(y.name||"")),f[g].forEach(h=>{let y=new Option(h.name||h.id,h.id);h.id===p&&(y.selected=!0,d=!0),_.appendChild(y)}),_.children.length>0&&(t.appendChild(_),u=!0)}),!d&&p&&!t.querySelector(`option[value="${CSS.escape(p)}"]`)){let g=new Option(p+" (manual)",p,!1,!0);t.insertBefore(g,t.firstChild)}if(!d&&t.options.length>0&&t.selectedIndex===-1){let g=-1;for(let _=0;_<t.options.length;_++)if(!t.options[_].disabled&&t.options[_].value){g=_;break}t.selectedIndex=g!==-1?g:0}};i&&e(i),s.forEach(e)}window.aipkit_updateOpenRouterModels=a})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function a(r){let i=document.getElementById("aipkit_google_model"),s=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_google_model"]');if(!i&&s.length===0){console.warn("Google Sync: No Google model selects found (#aipkit_google_model or chat selects).");return}let n=window.aipkit_dashboard?.recommendedModels?.google||[],c=Array.isArray(n)?n:[],l=p=>{if(!p)return[];let d=k("Recommended","gpt3-ai-content-generator"),u=Array.from(p.querySelectorAll("optgroup")).find(f=>f.label===d||f.label==="Recommended");return u?Array.from(u.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(c.length===0){let p=i||s[0];c=l(p)}let o=new Set(c.map(p=>p?.id).filter(Boolean)),e=Array.isArray(r)?r.slice():[];e.sort((p,d)=>(p.name||p.id||"").localeCompare(d.name||d.id||""));let t=p=>{let d=p.value;p.innerHTML="";let u=!1,f=!1,m=c.length>0?document.createElement("optgroup"):null;if(m&&(m.label=k("All models","gpt3-ai-content-generator")),c.length>0){let g=document.createElement("optgroup");g.label=k("Recommended","gpt3-ai-content-generator"),c.forEach(_=>{if(_&&typeof _=="object"&&_.id){let h=new Option(_.name||_.id,_.id);(_.id===d||`models/${_.id}`===d)&&(h.selected=!0,u=!0),g.appendChild(h)}}),g.children.length>0&&(p.appendChild(g),f=!0)}if(!e.length){f||p.appendChild(new Option("No models found.",""));return}if(e.forEach(g=>{let _=g.id||"",h=g.name||_;if(!_||o.has(_))return;let y=new Option(h,_);(_===d||`models/${_}`===d)&&(y.selected=!0,u=!0),m?m.appendChild(y):(p.appendChild(y),f=!0)}),m&&m.children.length>0&&(p.appendChild(m),f=!0),!u&&d){let g=d.startsWith("models/")?d.substring(7):d;if(!p.querySelector(`option[value="${CSS.escape(g)}"]`)){let _=g,h=new Option(_+" (manual)",d,!1,!0);p.insertBefore(h,p.firstChild),p.value=d}}if(p.options.length>0&&p.selectedIndex===-1){let g=-1;for(let _=0;_<p.options.length;_++)if(!p.options[_].disabled&&p.options[_].value){g=_;break}p.selectedIndex=g!==-1?g:0}};i&&t(i),s.forEach(t)}window.aipkit_updateGoogleModels=a})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_azure_deployment"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_azure_deployment"]');if(!r&&i.length===0){console.warn("Azure Sync: No Azure deployment selects found (#aipkit_azure_deployment or chat selects).");return}let s=n=>{let c=n.value;n.innerHTML="";let l=a&&typeof a=="object"&&!Array.isArray(a)&&(a["Chat Models"]||a["Embedding Models"]||a["Image Models"]);if(!a||Array.isArray(a)&&!a.length||l&&Object.keys(a).length===0){if(r.appendChild(new Option("No deployments found.","")),c){let e=new Option(c+" (manual)",c,!1,!0);r.appendChild(e),r.value=c}return}let o=!1;if(l)Object.keys(a).forEach(e=>{let t=a[e];if(t&&Array.isArray(t)&&t.length>0){let p=document.createElement("optgroup");p.label=e,t.sort((d,u)=>(d.id||"").localeCompare(u.id||"")),t.forEach(d=>{let u=d.id||"",f=d.name||u;if(!u)return;let m=u+(f&&f!==u?` (model: ${f})`:""),g=new Option(m,u);u===c&&(g.selected=!0,o=!0),p.appendChild(g)}),n.appendChild(p)}});else{let e=Array.isArray(a)?a:[];e.sort((t,p)=>(t.id||"").localeCompare(p.id||"")),e.forEach(t=>{let p=t.id||"",d=t.name||p;if(!p)return;let u=p+(d&&d!==p?` (model: ${d})`:""),f=new Option(u,p);p===c&&(f.selected=!0,o=!0),n.appendChild(f)})}if(!o&&n.value&&!n.querySelector(`option[value="${CSS.escape(n.value)}"]`)){let e=new Option(n.value+" (not in synced list)",n.value,!1,!0);n.appendChild(e),o=!0}if(!o&&n.options.length>0&&n.selectedIndex===-1){let e=-1;for(let t=0;t<n.options.length;t++)if(!n.options[t].disabled&&n.options[t].value){e=t;break}n.selectedIndex=e!==-1?e:0}};r&&s(r),i.forEach(s)}window.aipkit_updateAzureDeployments=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function a(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.claude=Array.isArray(r)?r:[]);let i=document.getElementById("aipkit_claude_model"),s=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_claude_model"]');if(!i&&s.length===0){console.warn("Claude Sync: No Claude model selects found (#aipkit_claude_model or chat selects).");return}let n=window.aipkit_dashboard?.recommendedModels?.claude||[],c=Array.isArray(n)?n:[],l=u=>{if(!u)return[];let f=k("Recommended","gpt3-ai-content-generator"),m=Array.from(u.querySelectorAll("optgroup")).find(g=>g.label===f||g.label==="Recommended");return m?Array.from(m.querySelectorAll("option")).map(g=>({id:g.value,name:g.textContent.trim()||g.value})).filter(g=>g.id):[]};if(c.length===0){let u=i||s[0];c=l(u)}let o=new Set(c.map(u=>u?.id).filter(Boolean)),e=Array.isArray(r)?r.slice():[];e.sort((u,f)=>(u.name||u.id||"").localeCompare(f.name||f.id||""));let t=u=>{let f=u.value;u.innerHTML="";let m=!1,g=!1,_=c.length>0?document.createElement("optgroup"):null;if(_&&(_.label=k("All models","gpt3-ai-content-generator")),c.length>0){let h=document.createElement("optgroup");h.label=k("Recommended","gpt3-ai-content-generator"),c.forEach(y=>{if(!y||typeof y!="object"||!y.id)return;let E=new Option(y.name||y.id,y.id);y.id===f&&(E.selected=!0,m=!0),h.appendChild(E)}),h.children.length>0&&(u.appendChild(h),g=!0)}if(e.forEach(h=>{let y=h?.id||"",E=h?.name||y;if(!y||o.has(y))return;let x=new Option(E,y);y===f&&(x.selected=!0,m=!0),_?_.appendChild(x):(u.appendChild(x),g=!0)}),_&&_.children.length>0&&(u.appendChild(_),g=!0),!g){u.appendChild(new Option("No models found.",""));return}if(!m&&f&&!u.querySelector(`option[value="${CSS.escape(f)}"]`)){let h=new Option(f+" (manual)",f,!1,!0);u.insertBefore(h,u.firstChild),u.value=f}if(u.options.length>0&&u.selectedIndex===-1){let h=-1;for(let y=0;y<u.options.length;y++)if(!u.options[y].disabled&&u.options[y].value){h=y;break}u.selectedIndex=h!==-1?h:0}};i&&t(i),s.forEach(t);let p=document.getElementById("aipkit_content_writer_provider"),d=document.getElementById("aipkit_content_writer_model");p&&d&&p.value==="claude"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(p,d)}window.aipkit_updateClaudeModels=a})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_deepseek_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_deepseek_model"]');if(!r&&i.length===0){console.warn("DeepSeek Sync: No DeepSeek model selects found (#aipkit_deepseek_model or chat selects).");return}let s=n=>{let c=n.value;if(n.innerHTML="",!a||!a.length){r.appendChild(new Option("No models found.",""));return}let l=!1;if(a.sort((o,e)=>(o.name||o.id||"").localeCompare(e.name||e.id||"")),a.forEach(o=>{let e=o.id||"",t=o.name||e;if(!e)return;let p=new Option(t,e);e===c&&(p.selected=!0,l=!0),n.appendChild(p)}),!l&&n.value&&!n.querySelector(`option[value="${CSS.escape(n.value)}"]`)){let o=new Option(n.value+" (manual)",n.value,!1,!0);n.insertBefore(o,n.firstChild)}!l&&n.options.length>0&&n.selectedIndex===-1&&(n.selectedIndex=0)};r&&s(r),i.forEach(s)}window.aipkit_updateDeepSeekModels=k})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_ollama_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_ollama_model"]');if(!r&&i.length===0){console.warn("Ollama Sync: No Ollama model selects found (#aipkit_ollama_model or chat selects).");return}let s=n=>{let c=n.value;if(n.innerHTML="",!a||!a.length){r.appendChild(new Option("No models found.",""));return}a.sort((o,e)=>(o.name||o.id||"").localeCompare(e.name||e.id||""));let l=!1;if(a.forEach(o=>{let e=o.id||"",t=o.name||e;if(!e)return;let p=new Option(t,e);e===c&&(p.selected=!0,l=!0),n.appendChild(p)}),!l&&n.value&&!n.querySelector(`option[value="${CSS.escape(n.value)}"]`)){let o=new Option(n.value+" (manual)",n.value,!1,!0);n.insertBefore(o,n.firstChild)}n.options.length>0&&n.selectedIndex===-1&&(n.selectedIndex=0)};r&&s(r),i.forEach(s)}window.aipkit_updateOllamaModels=k})();(function(){"use strict";function k(i,s){let n=Array.isArray(s)?s:[],c=JSON.stringify(n),o=`[id^="${i==="models"?"aipkit_elevenlabs_models_json_":"aipkit_elevenlabs_voices_json_"}"]`;document.querySelectorAll(o).forEach(e=>{i==="models"?e.dataset.models=c:e.dataset.voices=c})}function a(i,s="aipkit_elevenlabs_voice_id"){let n=Array.isArray(i)?i:[];k("voices",n);let c=document.getElementById(s);if(!c){console.warn(`ElevenLabs Sync (Voices): Select element #${s} not found.`);return}if(typeof s=="string"&&s.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){window.aipkit_chatTts_updateElevenLabsVoiceSelect(s,n,c.value||"");return}let l=c.value;if(c.innerHTML="",c.appendChild(new Option("-- Select a Voice (Optional) --","")),!n.length){l&&l!==""&&(c.appendChild(new Option(l+" (manual/not synced)",l,!1,!0)),c.value=l);return}let o=!1;if(n.sort((e,t)=>(e.name||e.id||"").localeCompare(t.name||t.id||"")),n.forEach(e=>{let t=e.id||"",p=e.name||t;if(!t)return;let d=new Option(p,t);t===l&&(d.selected=!0,o=!0),c.appendChild(d)}),!o&&l&&l!==""&&!c.querySelector(`option[value="${CSS.escape(l)}"]`)){let e=new Option(l+" (manual/not synced)",l,!1,!0);c.appendChild(e),c.value=l}}function r(i,s="aipkit_elevenlabs_tts_model_id"){let n=Array.isArray(i)?i:[];k("models",n);let c=document.getElementById(s);if(!c){console.warn(`ElevenLabs Sync (Models): Select element #${s} not found.`);return}if(typeof s=="string"&&s.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){window.aipkit_chatTts_updateElevenLabsModelsSelect(s,n,c.value||"");return}let l=c.value;if(c.innerHTML="",c.appendChild(new Option("-- Select a Model (Optional) --","")),!n.length){l&&l!==""&&(c.appendChild(new Option(l+" (manual/not synced)",l,!1,!0)),c.value=l);return}let o=!1;if(n.sort((e,t)=>(e.name||e.id||"").localeCompare(t.name||t.id||"")),n.forEach(e=>{let t=e.id||"",p=e.name||t;if(!t)return;let d=new Option(p,t);t===l&&(d.selected=!0,o=!0),c.appendChild(d)}),!o&&l&&l!==""&&!c.querySelector(`option[value="${CSS.escape(l)}"]`)){let e=new Option(l+" (manual/not synced)",l,!1,!0);c.appendChild(e),c.value=l}}window.aipkit_updateElevenLabsVoices=a,window.aipkit_updateElevenLabsModelsSelect=r})();(function(){"use strict";function k(a,r="aipkit_pinecone_default_index"){let i=document.getElementById(r);if(!i){console.warn(`Pinecone Sync: Select element #${r} not found.`);return}let s=i.value;if(i.innerHTML="",i.appendChild(new Option("-- Select Default Index --","")),!a||!a.length){i.appendChild(new Option("(No indexes found - Sync again)","")),s&&s!==""&&(i.appendChild(new Option(s+" (manual)",s,!1,!0)),i.value=s);return}let n=!1;if(a.sort((c,l)=>(c.name||c.id||"").localeCompare(l.name||l.id||"")),a.forEach(c=>{let l=c.name||c.id||(typeof c=="string"?c:"");if(!l)return;let o=new Option(l,l);l===s&&(o.selected=!0,n=!0),i.appendChild(o)}),!n&&s&&s!==""&&!i.querySelector(`option[value="${CSS.escape(s)}"]`)){let c=new Option(s+" (manual)",s,!1,!0);i.appendChild(c),i.value=s}}window.aipkit_updatePineconeIndexes=k})();(function(){"use strict";function k(a,r="aipkit_qdrant_default_collection"){let i=document.getElementById(r);if(!i){console.warn(`Qdrant Sync: Select element #${r} not found.`);return}let s=i.multiple,n=s?Array.from(i.selectedOptions).map(l=>l.value).filter(Boolean):[i.value];if(i.innerHTML="",s||i.appendChild(new Option("-- Select Collection (Optional) --","")),!a||!a.length){i.appendChild(new Option("(No collections found - Sync again)","")),n.length&&(n.forEach(l=>{l&&i.appendChild(new Option(l+" (manual)",l,!1,!0))}),!s&&n[0]&&(i.value=n[0]));return}let c=new Set;if(a.sort((l,o)=>(l.name||l.id||"").localeCompare(o.name||o.id||"")),a.forEach(l=>{let o=l.name||l.id||"";if(!o)return;let e=n.includes(o),t=new Option(o,o,!1,e);e&&c.add(o),i.appendChild(t)}),n.forEach(l=>{if(l&&!c.has(l)&&!i.querySelector(`option[value="${CSS.escape(l)}"]`)){let o=new Option(l+" (manual)",l,!1,!0);i.appendChild(o)}}),!s&&n[0]&&!i.value&&(i.value=n[0]),typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let l=i.closest(".aipkit_popover_options_list")||i.closest(".aipkit_popover_option_main")||document;window.aipkit_populateQdrantCollectionsMultiSelect(l)}}window.aipkit_updateQdrantCollections=k})();(function(){"use strict";function k(a,r=""){let i=r||"aipkit_replicate_model",s=document.getElementById(i);if(window.aipkit_dashboard&&window.aipkit_dashboard.imageGeneratorModels&&(window.aipkit_dashboard.imageGeneratorModels.replicate=a),window.aipkit_image_generator_config_public&&(window.aipkit_image_generator_config_public.replicate_models=a),!s){r&&console.warn(`Replicate Sync: Select element #${i} not found.`);return}let n=s.value;if(s.innerHTML="",!a||!a.length){s.appendChild(new Option("(No models found - Sync again)","")),n&&n!==""&&(s.appendChild(new Option(n+" (manual/not synced)",n,!1,!0)),s.value=n);return}let c=!1;if(a.sort((l,o)=>(l.name||l.id||"").localeCompare(o.name||o.id||"")),a.forEach(l=>{let o=l.id||"",e=l.name||o;if(!o)return;let t=new Option(e,o);o===n&&(t.selected=!0,c=!0),s.appendChild(t)}),!c&&n&&n!==""&&!s.querySelector(`option[value="${CSS.escape(n)}"]`)){let l=new Option(n+" (manual)",n,!1,!0);s.insertBefore(l,s.firstChild),s.value=n}if(!s.value&&s.options.length>0){let l=-1;for(let o=0;o<s.options.length;o++)if(!s.options[o].disabled&&s.options[o].value){l=o;break}s.selectedIndex=l!==-1?l:0}}window.aipkit_updateReplicateModels=k})();(function(){"use strict";function k(f,m,g={}){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function")return console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing."),null;let _=g&&typeof g=="object"?g:{},h=!!_.silent,y=_.showErrors!==!1,E=!!f,x=(H,Q="")=>{let F=Array.isArray(H)?H:[],P=document.getElementById("aipkit_google_tts_voices_json_main");P&&(P.dataset.voices=JSON.stringify(F));let R=Q||document.querySelector('select[name="tts_google_voice_id"]')?.id||"";if(R&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let O=document.getElementById(R);window.aipkit_updateGoogleVoiceSelect(R,F,O&&O.value||"")}},w=H=>{let Q=Array.isArray(H)?H:[];window.aipkit_chat_config=window.aipkit_chat_config||{},window.aipkit_chat_config.openaiVectorStores=Q,typeof window.aipkit_invalidateModuleCache=="function"&&["chatbot","sources","content-writer","autogpt","ai-forms"].forEach(F=>{window.aipkit_invalidateModuleCache(F)}),typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("aipkit:vector-store-list-updated",{detail:{provider:"openai",stores:Q}}))},S={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,GoogleTtsVoices:x,OpenAIVectorStores:w,Azure:window.aipkit_updateAzureDeployments,Claude:window.aipkit_updateClaudeModels,DeepSeek:window.aipkit_updateDeepSeekModels,Ollama:window.aipkit_updateOllamaModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof S[m]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${m}.`),alert(`AIPKit Error: Cannot update UI for ${m}.`);return}let T="aipkit_settings_messages",v=E?!!f.closest(".aipkit_popover_options_list"):!1;!h&&!v&&document.getElementById(T)&&(window.aipkit_clearStatusMessages(T),window.aipkit_showSavingIndicator(T,!1));let A=E?f.querySelector(".aipkit_btn-text"):null,C=E?f.getAttribute("data-target-select"):_.targetSelectId||"",b=null,L=H=>!H||!(H instanceof Element)?null:H.querySelector(".aipkit_builder_card--shortcode .aipkit_model_sync_status")||H.querySelector(".aipkit_builder_card_status .aipkit_model_sync_status");if(v){let Q=f.closest(".aipkit_popover_flyout_body")?.closest(".aipkit-modal-content")?.querySelector(".aipkit_popover_flyout_header")||f.closest(".aipkit_popover_context_flyout")?.querySelector(".aipkit_popover_flyout_header")||f.closest(".aipkit_popover_flyout_header");if(Q&&(b=Q.querySelector(".aipkit_popover_status_inline")),!b){let F=f.closest(".aipkit_model_settings_popover");F&&(b=F.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline.aipkit_model_sync_status"))}if(!b){let F=f.closest(".aipkit_popover_option_row");F&&(b=F.querySelector(".aipkit_popover_status_inline"))}if(!b){let F=f.closest(".aipkit_model_settings_panel");F&&(b=F.querySelector(".aipkit_popover_status_inline.aipkit_model_sync_status"))}}else{let H=E?f.closest(".aipkit_chatbot_model_field"):null,Q=E?f.closest(".aipkit_chatbot_builder"):null;if(!Q&&C){let F=document.getElementById(C);Q=F?F.closest(".aipkit_chatbot_builder"):null}Q||(Q=document.querySelector('.aipkit_chatbot_builder[data-aipkit-chatbot-layout="next"]')),Q&&Q.getAttribute("data-aipkit-chatbot-layout")==="next"&&(b=L(Q)),b||(b=H?H.querySelector(".aipkit_model_sync_status"):null)}if(!b){let H=document.querySelector('.aipkit_chatbot_builder[data-aipkit-chatbot-layout="next"]');H&&(b=L(H))}if(!b&&m){let H=document.querySelector(`.aipkit_chatbot_model_field[data-provider="${m}"]`);H&&(b=H.querySelector(".aipkit_model_sync_status"))}let B=(H,Q,F)=>{if(!b)return;let P=b.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_save_status_container");P&&H&&(P.textContent="",P.className="aipkit_save_status_container"),b.textContent=H||"",b.classList.remove("success","error","loading"),Q&&b.classList.add(Q),F?b.setAttribute("title",F):b.removeAttribute("title"),b.classList.contains("aipkit_popover_status_inline")&&(b.style.display=H?"inline-block":"none")};B("Syncing\u2026","loading");let $=A?A.textContent:m.includes("ElevenLabs")||m.includes("Pinecone")||m.includes("Qdrant")||m.includes("VectorStores")||m.includes("Replicate")?"Sync Items":"Sync Models";A&&(A.textContent="");let W=null;return E&&(W=f.querySelector(".aipkit_spinner"),W||(W=document.createElement("span"),W.className="aipkit_spinner",f.appendChild(W)),W.style.display="inline-block",f.classList.add("aipkit_loading"),f.disabled=!0),(m==="GoogleTtsVoices"?window.aipkit_apiRequest("aipkit_sync_google_tts_voices"):window.aipkit_apiRequest("aipkit_sync_models",{provider:m})).then(H=>{m==="OpenRouter"&&Array.isArray(H?.embedding_models)&&(window.aipkit_dashboard=window.aipkit_dashboard||{},window.aipkit_dashboard.embeddingModels=window.aipkit_dashboard.embeddingModels||{},window.aipkit_dashboard.embeddingModels.openrouter=H.embedding_models);let Q=m==="GoogleTtsVoices"?H.voices:m==="OpenAIVectorStores"?H.stores:H.models;_.skipUpdate||(C?S[m](Q,C):S[m](Q)),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers(),(m==="PineconeIndexes"||m==="QdrantCollections")&&typeof window.aipkit_refreshTrainingSourcesCount=="function"&&window.aipkit_refreshTrainingSourcesCount(),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():h||console.warn("Model Sync Init: Cannot update autosave baseline.");let F="models";m==="ElevenLabs"||m==="GoogleTtsVoices"?F="voices":m==="ElevenLabsModels"?F="synthesis models":m==="PineconeIndexes"?F="indexes":m==="QdrantCollections"?F="collections":m==="OpenAIVectorStores"&&(F="vector stores"),!h&&!v&&document.getElementById(T)&&window.aipkit_showMessage(T,"success",`${m.replace(/Indexes|Collections|Models/,"")} ${F} synced!`),B("Saved","success"),b&&setTimeout(()=>B("",null),2500)}).catch(H=>{let Q=H?.message||"Sync failed.";if(y&&!v&&document.getElementById(T)&&window.aipkit_showMessage(T,"error",`Sync failed: ${Q}`),console.error(`AIPKit Sync Error (${m}):`,H),B(Q,"error",Q),b&&setTimeout(()=>B("",null),5e3),_.propagateError)throw H}).finally(()=>{if(E){f.disabled=!1,f.classList.remove("aipkit_loading");let H=f.querySelector(".aipkit_spinner");H&&(H.style.display="none"),A&&(A.textContent=$)}})}function a(f){if(!f)return;let m="data-sync-listener-attached";f.getAttribute(m)||(f.addEventListener("click",function(g){let _=g.target.closest(".aipkit_sync_btn");if(!_||_.disabled)return;g.preventDefault();let h=_.getAttribute("data-provider")||"";if(!h){let y=_.closest(".aipkit_chatbot_model_field");y&&y.getAttribute("data-provider")&&(h=y.getAttribute("data-provider"))}h?k(_,h):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",_)}),f.setAttribute(m,"true"))}function r(){a(document.getElementById("aipkit_module-container")),a(document.getElementById("aipkit_chatbot_main_tab_content_container"))}let i=[],s=!1;function n(f,m){if(!f||typeof f!="object")return"";let g=f[m];return g==null?"":String(g).trim()}function c(f,m,g){return g.some(_=>n(f,_)!==n(m,_))}function l(f){return n(f,"azure_api_key")!==""&&n(f,"azure_endpoint")!==""}function o(f,m){return[{provider:"OpenAI",keys:["openai_api_key"],ready:_=>n(_,"openai_api_key")!==""},{provider:"OpenAIVectorStores",keys:["openai_api_key"],ready:_=>n(_,"openai_api_key")!==""},{provider:"OpenRouter",keys:["openrouter_api_key"],ready:_=>n(_,"openrouter_api_key")!==""},{provider:"Google",keys:["google_api_key"],ready:_=>n(_,"google_api_key")!==""},{provider:"GoogleTtsVoices",keys:["google_api_key"],ready:_=>n(_,"google_api_key")!==""},{provider:"Azure",keys:["azure_api_key","azure_endpoint"],ready:_=>l(_)},{provider:"Claude",keys:["claude_api_key"],ready:_=>n(_,"claude_api_key")!==""},{provider:"DeepSeek",keys:["deepseek_api_key"],ready:_=>n(_,"deepseek_api_key")!==""},{provider:"ElevenLabs",keys:["elevenlabs_api_key"],ready:_=>n(_,"elevenlabs_api_key")!==""},{provider:"ElevenLabsModels",keys:["elevenlabs_api_key"],ready:_=>n(_,"elevenlabs_api_key")!==""},{provider:"Replicate",keys:["replicate_api_key"],ready:_=>n(_,"replicate_api_key")!==""},{provider:"PineconeIndexes",keys:["pinecone_api_key"],ready:_=>n(_,"pinecone_api_key")!==""},{provider:"QdrantCollections",keys:["qdrant_url","qdrant_api_key"],ready:_=>n(_,"qdrant_url")!==""&&n(_,"qdrant_api_key")!==""}].filter(_=>c(f,m,_.keys)&&_.ready(m)).map(_=>_.provider)}function e(f){return f?document.querySelector(`.aipkit_sync_btn[data-provider="${f}"]`):null}let t=null;function p(){if(s)return;let f=i.shift();if(!f)return;s=!0;let{provider:m,options:g,resolve:_,reject:h}=f,y=e(m),E=k(y,m,g);t={provider:m,promise:E},E&&typeof E.finally=="function"?E.then(x=>{typeof _=="function"&&_(x)}).catch(x=>{typeof h=="function"&&h(x)}).finally(()=>{t=null,s=!1,p()}):(t=null,typeof _=="function"&&_(null),s=!1,p())}function d(f,m={}){if(!f)return null;if(t&&t.provider===f&&t.promise)return t.promise;if(i.some(E=>E.provider===f)){let E=i.find(x=>x.provider===f);return E&&E.promise?E.promise:null}let _,h,y=new Promise((E,x)=>{_=E,h=x});return i.push({provider:f,options:m,resolve:_,reject:h,promise:y}),p(),y}function u(f,m){if(!f||!m)return;o(f,m).forEach(_=>d(_,{silent:!0}))}window.aipkit_initSyncButtons=r,window.aipkit_syncModels=k,window.aipkit_queueProviderSync=d,window.aipkit_queueProviderAutoSync=u})();(function(){"use strict";let k=window.wp?.i18n?.__||function(w){return w},a="#aipkit_settings_container .aipkit_settings-form-row--provider-model select.aipkit_form-input",r=null,i=null,s=!1,n=w=>{if(!w)return"";let S=w.getAttribute("data-aipkit-picker-title");if(S)return S;let T=w.id&&document.querySelector(`label[for="${w.id}"]`)||w.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return T?T.textContent.trim():""},c=w=>{if(!w)return"";let S=w.selectedOptions&&w.selectedOptions.length?w.selectedOptions[0]:w.querySelector("option[selected]");if(S)return S.textContent.trim();let T=w.querySelector("option");return T?T.textContent.trim():""},l=w=>w&&w.id==="aipkit_provider",o=w=>String(w||"").trim().toLowerCase(),e=(w,S)=>{if(!w)return;let T="aipkit_settings_select_picker_icon--";w.classList.forEach(A=>{A.startsWith(T)&&w.classList.remove(A)});let v=o(S);v&&w.classList.add(`${T}${v}`)},t=w=>({buttonId:`${w}_picker_btn`,labelId:`${w}_picker_label`,popoverId:`${w}_picker_popover`,titleId:`${w}_picker_title`,searchId:`${w}_picker_search`,listId:`${w}_picker_list`}),p=w=>{if(!w||!w.id)return null;let S=t(w.id),T=document.getElementById("aipkit_settings_container");if(!T)return null;let v=document.getElementById(S.buttonId),A=l(w)||!!w.closest(".aipkit_settings-form-col--model-select");if(!v){v=document.createElement("button"),v.type="button",v.id=S.buttonId,v.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",v.setAttribute("data-aipkit-popover-target",S.popoverId),v.setAttribute("aria-controls",S.popoverId),v.setAttribute("aria-expanded","false");let b=document.createElement("span");if(b.className="aipkit_settings_select_picker_label",b.id=S.labelId,b.textContent=c(w)||k("Select","gpt3-ai-content-generator"),l(w)){let B=document.createElement("span");B.className="aipkit_settings_select_picker_icon",B.setAttribute("aria-hidden","true"),e(B,w.value),v.classList.add("aipkit_settings_select_picker_btn--provider"),v.appendChild(B)}let L=document.createElement("span");L.className="dashicons dashicons-arrow-down-alt2",L.setAttribute("aria-hidden","true"),v.appendChild(b),v.appendChild(L),w.insertAdjacentElement("beforebegin",v)}if(l(w)){let b=v.querySelector(".aipkit_settings_select_picker_icon")||(()=>{let L=document.createElement("span");return L.className="aipkit_settings_select_picker_icon",L.setAttribute("aria-hidden","true"),v.classList.add("aipkit_settings_select_picker_btn--provider"),v.insertBefore(L,v.firstChild),L})();e(b,w.value)}A&&(v.dataset.aipkitPopoverPlacement="bottom"),w.classList.contains("screen-reader-text")||w.classList.add("screen-reader-text");let C=document.getElementById(S.popoverId);if(!C){let b=l(w);C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",b&&C.classList.add("aipkit_settings_select_picker_popover--provider","aipkit_settings_select_picker_popover--provider-anchor"),C.id=S.popoverId,C.setAttribute("aria-hidden","true");let L=document.createElement("div");L.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",b&&L.classList.add("aipkit_settings_select_picker_popover_panel--provider-anchor"),L.setAttribute("role","dialog"),L.setAttribute("aria-labelledby",S.titleId);let B=document.createElement("div");B.className="aipkit_model_settings_popover_header";let $=document.createElement("span");$.className="aipkit_model_settings_popover_title",$.id=S.titleId,$.textContent=n(w)||k("Select","gpt3-ai-content-generator");let W=document.createElement("button");W.type="button",W.className="aipkit_model_settings_popover_close",W.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),W.innerHTML='<span class="dashicons dashicons-no-alt"></span>',B.appendChild($),B.appendChild(W);let U=document.createElement("div");U.className="aipkit_model_settings_popover_body";let D=document.createElement("div");D.className="aipkit_settings_select_picker_search";let H=document.createElement("input");H.type="search",H.id=S.searchId,H.className="aipkit_form-input";let Q=n(w),F=Q?`Search ${Q.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");H.setAttribute("placeholder",F),D.appendChild(H);let P=document.createElement("div");P.className="aipkit_settings_select_picker_list",P.id=S.listId,P.setAttribute("role","listbox"),U.appendChild(D),U.appendChild(P),L.appendChild(B),L.appendChild(U),C.appendChild(L),(b&&w.closest(".aipkit_settings-form-col--provider-select")||T).appendChild(C),b&&(D.hidden=!0)}return{ids:S,button:v,popover:C,label:document.getElementById(S.labelId),search:document.getElementById(S.searchId),list:document.getElementById(S.listId)}},d=w=>{let S=[];return w&&Array.from(w.children).forEach(v=>{if(v.tagName==="OPTGROUP"){let A=Array.from(v.children).filter(C=>C.tagName==="OPTION").map(C=>({value:C.value,label:C.textContent.trim(),disabled:C.disabled,selected:C.selected}));S.push({groupLabel:v.label||"",options:A})}else v.tagName==="OPTION"&&S.push({groupLabel:"",options:[{value:v.value,label:v.textContent.trim(),disabled:v.disabled,selected:v.selected}]})}),S},u=(w,S,T="")=>{if(!w||!S)return;let v=T.trim().toLowerCase();S.innerHTML="";let A=d(w),C=!1;if(A.forEach(b=>{let L=b.options.filter(B=>v?B.label.toLowerCase().includes(v):!0);if(L.length){if(b.groupLabel){let B=document.createElement("div");B.className="aipkit_settings_select_picker_group_label",B.textContent=b.groupLabel,S.appendChild(B)}L.forEach(B=>{let $=document.createElement("button");$.type="button",$.className="aipkit_settings_select_picker_item",$.setAttribute("role","option"),$.dataset.value=B.value,$.dataset.label=B.label,B.disabled&&($.classList.add("is-disabled"),$.setAttribute("aria-disabled","true")),w.value===B.value?($.classList.add("is-active"),$.setAttribute("aria-selected","true")):$.setAttribute("aria-selected","false");let W=document.createElement("span");W.className="aipkit_settings_select_picker_text",W.textContent=B.label;let U=document.createElement("span");if(U.className="dashicons dashicons-yes aipkit_settings_select_picker_check",l(w)){$.classList.add("aipkit_settings_select_picker_item--provider");let D=document.createElement("span");D.className="aipkit_settings_select_picker_icon",D.setAttribute("aria-hidden","true"),e(D,B.value),$.appendChild(D)}$.appendChild(W),$.appendChild(U),S.appendChild($),C=!0})}}),!C){let b=document.createElement("div");b.className="aipkit_settings_select_picker_empty",b.textContent=k(v?"No matches found.":"No options available.","gpt3-ai-content-generator"),S.appendChild(b)}},f=(w,S)=>{if(!w||!S)return;let T=c(w);if(S.textContent=T||k("Select","gpt3-ai-content-generator"),l(w)){let v=S.closest("button"),A=v?v.querySelector(".aipkit_settings_select_picker_icon"):null;e(A,w.value)}},m=(w,S)=>{if(!w||!S)return;if(S.closest(".aipkit_settings_select_picker_popover")?.classList.contains("aipkit_settings_select_picker_popover--provider-anchor")){S.style.left="",S.style.top="";return}let T=w.getBoundingClientRect(),v=S.getBoundingClientRect(),A=v.width||320,C=v.height||0,b=window.innerWidth,L=window.innerHeight,B=12;if(w.dataset.aipkitPopoverPlacement==="bottom"){let U=T.left;U+A>b-B&&(U=T.right-A),U=Math.max(B,Math.min(U,b-A-B));let D=T.bottom+8;D+C>L-B&&(D=T.top-C-8),D=Math.max(B,Math.min(D,L-C-B)),S.style.left=`${Math.round(U)}px`,S.style.top=`${Math.round(D)}px`;return}let $=T.right+10;$+A>b-B&&($=T.left-A-10),$=Math.max(B,Math.min($,b-A-B));let W=T.top;W+C>L-B&&(W=L-C-B),W=Math.max(B,W),S.style.left=`${Math.round($)}px`,S.style.top=`${Math.round(W)}px`},g=()=>{!r||!i||s||(s=!0,window.requestAnimationFrame(()=>{let w=r.querySelector(".aipkit_model_settings_popover_panel");m(i,w),s=!1}))},_=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},h=(w,S,T)=>{if(!w||!S)return;r&&r!==S&&_(),r=S,i=w,S.classList.add("aipkit-active"),S.setAttribute("aria-hidden","false"),w.setAttribute("aria-expanded","true");let v=S.querySelector(".aipkit_settings_select_picker_search input"),A=S.querySelector(".aipkit_settings_select_picker_list");A&&u(T,A,v?v.value:""),v&&v.offsetParent!==null&&(v.focus(),v.select());let C=S.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{m(w,C)})},y=(w,S)=>{if(!w||!S)return;let{button:T,popover:v,list:A,search:C}=S;if(T&&T.dataset.pickerListenerAttached!=="true"&&(T.addEventListener("click",b=>{if(b.preventDefault(),r===v){_();return}h(T,v,w)}),T.dataset.pickerListenerAttached="true"),v&&v.dataset.overlayListenerAttached!=="true"){v.addEventListener("click",L=>{L.target===v&&_()});let b=v.querySelector(".aipkit_model_settings_popover_close");b&&b.addEventListener("click",L=>{L.preventDefault(),_()}),v.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",b=>{let L=b.target.closest(".aipkit_settings_select_picker_item");if(!L||L.classList.contains("is-disabled"))return;let B=L.dataset.value??"";w.value=B,w.dispatchEvent(new Event("change",{bubbles:!0})),f(w,S.label),u(w,A,C?C.value:""),_()}),A.dataset.pickerListenerAttached="true"),C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("input",()=>{u(w,A,C.value)}),C.dataset.pickerListenerAttached="true"),w&&w.dataset.pickerListenerAttached!=="true"&&(w.addEventListener("change",()=>{f(w,S.label),u(w,A,C?C.value:"")}),w.dataset.pickerListenerAttached="true"),w&&w.dataset.pickerObserverAttached!=="true"){let b=!1;new MutationObserver(()=>{b||(b=!0,window.requestAnimationFrame(()=>{f(w,S.label),u(w,A,C?C.value:""),b=!1}))}).observe(w,{childList:!0,subtree:!0}),w.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitSettingsPickerEscapeBound||(document.addEventListener("keydown",b=>{b.key==="Escape"&&r&&_()}),document.body.dataset.aipkitSettingsPickerEscapeBound="true"),document.body.dataset.aipkitSettingsPickerOutsideBound||(document.addEventListener("mousedown",b=>{if(!r||!r.classList.contains("aipkit_settings_select_picker_popover--provider-anchor"))return;let L=b.target;r.contains(L)||i&&i.contains(L)||_()}),document.body.dataset.aipkitSettingsPickerOutsideBound="true"),document.body.dataset.aipkitSettingsPickerRepositionBound||(window.addEventListener("resize",g),window.addEventListener("scroll",g,!0),document.body.dataset.aipkitSettingsPickerRepositionBound="true")};function E(){let w=document.getElementById("aipkit_settings_container");if(!w)return;let S=w.querySelectorAll(a);S.length&&S.forEach(T=>{if(!T.id||T.dataset.aipkitPickerInit==="true")return;let v=p(T);v&&(f(T,v.label),u(T,v.list,v.search?v.search.value:""),y(T,v),T.dataset.aipkitPickerInit="true")})}function x(){let w=document.getElementById("aipkit_settings_container");if(!w)return;w.querySelectorAll(a).forEach(T=>{if(!T.id)return;let v=p(T);v&&(f(T,v.label),u(T,v.list,v.search?v.search.value:""),y(T,v),T.dataset.aipkitPickerInit="true")})}window.aipkit_initSettingsSelectPickers=E,window.aipkit_refreshSettingsSelectPickers=x})();(function(){"use strict";let k=!1,a=window.aipkit_escapeHtml||(g=>g||""),r={},i={},s=120,n="aipkit_content_writer_messages";function c(g,_){if(!g||typeof g!="string")return"";if(g.length<=_)return g;let h=g.substring(0,_-1);return h.substring(0,h.lastIndexOf(" ")).trim()+"\u2026"}function l(g){let _={"":i.use_default_position||"Default",default:i.use_default_position||"Default",replace:i.replace_selection||"Replace",after:i.insert_after||"After",before:i.insert_before||"Before"};return _[g]||_[""]}function o(g){let _=document.createElement("div");_.className="aipkit_assistant_action_card",_.dataset.actionId=g.id,_.dataset.label=g.label,_.dataset.prompt=g.prompt,_.dataset.insertPosition=g.insert_position||"";let h=a(g.prompt),y=c(h,s),E=h.length>s;return _.innerHTML=`
      <div class="aipkit_assistant_action_drag" draggable="true" title="Drag to reorder">
        <span class="dashicons dashicons-move" aria-hidden="true"></span>
      </div>
      <div class="aipkit_assistant_action_content">
        <div class="aipkit_assistant_action_label">${a(g.label)}</div>
        <div class="aipkit_assistant_action_prompt ${E?"":"aipkit_assistant_action_prompt--full"}">${E?y:h}</div>
        ${E?'<button type="button" class="aipkit-enhancer-prompt-toggle" style="background:none;border:none;padding:0;color:#2271b1;font-size:11px;cursor:pointer;text-decoration:underline;">Show more</button>':""}
      </div>
      <div class="aipkit_assistant_action_controls">
        <button type="button" class="aipkit_assistant_action_btn_small aipkit-enhancer-edit-action-btn" aria-label="${a(i.edit_action||"Edit")}">
          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
        </button>
        <button type="button" class="aipkit_assistant_action_btn_small aipkit_assistant_action_btn_small--danger aipkit-enhancer-delete-action-btn" aria-label="${a(i.delete_action||"Delete")}">
          <span class="dashicons dashicons-trash" aria-hidden="true"></span>
        </button>
      </div>
    `,_}function e(g,_=!1){let h=(g.insert_position||"").trim();return`
      <div class="aipkit_assistant_action_edit_form">
        <div class="aipkit_assistant_action_edit_row">
          <div>
            <label class="aipkit_assistant_action_edit_label">${a(i.action_label||"Label")}</label>
            <input type="text" class="aipkit-edit-label" value="${a(g.label)}" placeholder="${a(i.action_label||"Action name")}" maxlength="50">
          </div>
          <div>
            <label class="aipkit_assistant_action_edit_label">${a(i.insert_position||"Position")}</label>
            <select class="aipkit-edit-position">
              <option value="" ${h===""?"selected":""}>${a(i.use_default_position||"Use default")}</option>
              <option value="replace" ${h==="replace"?"selected":""}>${a(i.replace_selection||"Replace selection")}</option>
              <option value="after" ${h==="after"?"selected":""}>${a(i.insert_after||"Insert after")}</option>
              <option value="before" ${h==="before"?"selected":""}>${a(i.insert_before||"Insert before")}</option>
            </select>
          </div>
        </div>
        <div>
          <label class="aipkit_assistant_action_edit_label">${a(i.action_prompt||"Prompt")}</label>
          <textarea class="aipkit-edit-prompt" rows="3" placeholder="${a("Enter prompt. Use %s for selected text.")}">${a(g.prompt)}</textarea>
        </div>
        <div class="aipkit_assistant_action_edit_actions">
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--secondary aipkit-enhancer-cancel-action-btn">
            ${a(i.cancel||"Cancel")}
          </button>
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--primary aipkit-enhancer-save-action-btn">
            ${a(i.save||"Save")}
          </button>
        </div>
      </div>
    `}function t(g){let _={id:g.dataset.actionId,label:g.dataset.label,prompt:g.dataset.prompt,insert_position:g.dataset.insertPosition||""};g.classList.add("aipkit_assistant_action_card--editing"),g.innerHTML=e(_);let h=g.querySelector(".aipkit-edit-prompt");h&&(h.value=_.prompt);let y=g.querySelector(".aipkit-edit-label");y&&(y.focus(),y.select())}function p(g,_){g.dataset.actionId=_.id,g.dataset.label=_.label,g.dataset.prompt=_.prompt,g.dataset.insertPosition=_.insert_position||"",g.classList.remove("aipkit_assistant_action_card--editing");let h=o(_);g.innerHTML=h.innerHTML}function d(g){if(g.querySelectorAll(".aipkit_assistant_action_card").length>=10){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"error",i.max_actions_reached||"Maximum of 10 actions reached.");return}if(g.querySelector('[data-action-id^="new-"]'))return;let h=document.createElement("div");h.className="aipkit_assistant_action_card aipkit_assistant_action_card--editing",h.dataset.actionId=`new-${Date.now()}`,h.dataset.label="",h.dataset.prompt="",h.dataset.insertPosition="",h.innerHTML=e({id:h.dataset.actionId,label:"",prompt:"",insert_position:""},!0),g.prepend(h);let y=h.querySelector(".aipkit-edit-label");y&&y.focus()}async function u(g){if(k)return;let _=g.querySelector(".aipkit-edit-label"),h=g.querySelector(".aipkit-edit-prompt"),y=g.querySelector(".aipkit-edit-position");if(!_||!h)return;g.querySelectorAll(".aipkit_form-help-error").forEach(A=>A.remove()),_.style.borderColor="",h.style.borderColor="";let E=_.value.trim(),x=h.value.trim(),w=y?y.value:"",S=g.dataset.actionId,T=!1;if(!E){_.style.borderColor="#dc2626";let A=document.createElement("div");A.className="aipkit_form-help aipkit_form-help-error",A.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",A.textContent=i.label_required||"Label is required",_.parentNode.appendChild(A),T=!0}if(!x){h.style.borderColor="#dc2626";let A=document.createElement("div");A.className="aipkit_form-help aipkit_form-help-error",A.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",A.textContent=i.prompt_required||"Prompt is required",h.parentNode.appendChild(A),T=!0}if(T)return;k=!0;let v=g.querySelector(".aipkit-enhancer-save-action-btn");v&&(v.textContent=i.saving_action||"Saving...",v.disabled=!0);try{let A=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:S,label:E,prompt:x,insert_position:w,_ajax_nonce:r.nonce_manage_actions});p(g,A.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"success",i.action_saved||"Action saved successfully")}catch(A){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"error",`${i.error||"Error"}: ${A.message}`),v&&(v.textContent=i.save||"Save",v.disabled=!1)}finally{k=!1}}async function f(g){let _=g.querySelector("#aipkit_enhancer_actions_list");_.innerHTML=`
      <div class="aipkit_assistant_loading" style="text-align:center;padding:24px;color:#64748b;">
        <span class="dashicons dashicons-update" style="animation:spin 1s linear infinite;"></span>
        <span style="margin-left:8px;">${a(i.loading_actions||"Loading actions...")}</span>
      </div>
    `;try{let h=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions});_.innerHTML="";let y=h.actions||[];y.length===0?_.innerHTML=`
          <div class="aipkit_assistant_empty_state">
            <div class="aipkit_assistant_empty_state_icon">
              <span class="dashicons dashicons-edit-large" aria-hidden="true"></span>
            </div>
            <div class="aipkit_assistant_empty_state_text">
              ${a(i.no_actions||'No actions yet. Click "Add Action" to create one.')}
            </div>
          </div>
        `:y.forEach(E=>{_.appendChild(o(E))})}catch(h){_.innerHTML="",typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"error",h.message||i.loading_failed||"Failed to load actions.")}}function m(){let g=document.getElementById("aipkit_enhancer_actions_container");if(!g)return;let _=g.closest(".aipkit_assistant_settings_redesigned")||g;if(_.dataset.listenerAttached==="true")return;_.dataset.listenerAttached="true",g.dataset.listenerAttached="true";let h=g.closest(".aipkit_assistant_settings_redesigned")||_;r=window.aipkit_post_enhancer||{},i=r.text||{};let y=g.querySelector("#aipkit_enhancer_actions_list");if(!y)return;let E=h.querySelectorAll(".aipkit_assistant_position_option"),x=()=>{E.forEach(v=>{let A=v.querySelector("input[type=radio]");v.classList.toggle("aipkit_assistant_position_option--active",!!(A&&A.checked))})};x(),E.forEach(v=>{let A=v.querySelector("input[type=radio]");A&&A.addEventListener("change",x)});let w=null,S=null,T=async()=>{if(k)return;let v=Array.from(y.querySelectorAll(".aipkit_assistant_action_card")).map(L=>L.dataset.actionId).filter(L=>L&&!L.startsWith("new-"));if(!v.length)return;let A=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,C=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,b=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;k=!0,A&&A(i.saving_order||"Saving order...");try{await window.aipkit_apiRequest("aipkit_reorder_enhancer_actions",{order:v,_ajax_nonce:r.nonce_manage_actions}),C&&C(i.order_saved||"Order saved.")}catch(L){b?b(`${i.error||"Error"}: ${L.message}`):typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"error",`${i.error||"Error"}: ${L.message}`)}finally{k=!1}};y.addEventListener("dragstart",v=>{let A=v.target.closest(".aipkit_assistant_action_drag");if(!A)return;let C=A.closest(".aipkit_assistant_action_card");if(!C||C.classList.contains("aipkit_assistant_action_card--editing")){v.preventDefault();return}w=C,C.classList.add("aipkit_dragging");try{v.dataTransfer.effectAllowed="move",v.dataTransfer.setData("text/plain",C.dataset.actionId||"")}catch{}}),y.addEventListener("dragend",async()=>{w&&w.classList.remove("aipkit_dragging"),w=null,S=null,await T()}),y.addEventListener("dragover",v=>{if(!w)return;let A=v.target.closest(".aipkit_assistant_action_card");if(!A||A===w)return;v.preventDefault();let C=A.getBoundingClientRect(),L=v.clientY<C.top+C.height/2?A:A.nextSibling;(S!==A||w.nextSibling!==L)&&(y.insertBefore(w,L),S=A)}),y.addEventListener("drop",async v=>{w&&(v.preventDefault(),await T())}),_.addEventListener("click",async v=>{let A=v.target.closest(".aipkit-enhancer-add-new-btn"),C=v.target.closest(".aipkit-enhancer-reset-actions-btn"),b=v.target.closest(".aipkit-enhancer-edit-action-btn"),L=v.target.closest(".aipkit-enhancer-delete-action-btn"),B=v.target.closest(".aipkit-enhancer-save-action-btn"),$=v.target.closest(".aipkit-enhancer-cancel-action-btn"),W=v.target.closest(".aipkit-enhancer-prompt-toggle");if(A)d(y);else if(C){if(!confirm(i.confirm_reset_actions||"Reset all actions to defaults? This cannot be undone."))return;try{await window.aipkit_apiRequest("aipkit_reset_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions}),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"success",i.actions_reset||"Actions reset to defaults."),f(g)}catch(U){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"error",`${i.error||"Error"}: ${U.message}`)}}else if(W){let U=W.closest(".aipkit_assistant_action_card"),D=U.querySelector(".aipkit_assistant_action_prompt"),H=U.dataset.prompt;W.textContent.toLowerCase().includes("more")?(D.textContent=a(H),D.classList.add("aipkit_assistant_action_prompt--full"),W.textContent="Show less"):(D.textContent=c(a(H),s),D.classList.remove("aipkit_assistant_action_prompt--full"),W.textContent="Show more")}else if(b)t(b.closest(".aipkit_assistant_action_card"));else if(B)await u(B.closest(".aipkit_assistant_action_card"));else if($){let U=$.closest(".aipkit_assistant_action_card");U.dataset.actionId.startsWith("new-")?U.remove():p(U,{id:U.dataset.actionId,label:U.dataset.label,prompt:U.dataset.prompt,insert_position:U.dataset.insertPosition})}else if(L){if(k)return;let U=L.closest(".aipkit_assistant_action_card"),D=U.dataset.actionId;if(!confirm(i.confirm_delete_action||"Delete this action? This cannot be undone."))return;k=!0,L.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:D,_ajax_nonce:r.nonce_manage_actions}),U.style.transition="opacity 0.2s, transform 0.2s",U.style.opacity="0",U.style.transform="translateX(-10px)",setTimeout(()=>U.remove(),200),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"success",i.action_deleted||"Action deleted.")}catch(H){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(n,"error",`${i.error||"Error"}: ${H.message}`),L.disabled=!1}finally{k=!1}}}),_.addEventListener("keydown",v=>{if(v.key==="Enter"&&v.target.matches("input[type=text]")){v.preventDefault();let A=v.target.closest(".aipkit_assistant_action_card--editing");A&&u(A)}}),window.aipkit_enhancer_reload_actions=()=>f(g),f(g)}window.aipkit_initEnhancerActionsUI=m})();(function(){"use strict";let k=[],a=[];function r(n){let c=document.getElementById("aipkit_semantic_search_target_id");if(!c)return;let l=c.value;c.innerHTML='<option value="">-- Select --</option>';let o=[];n==="pinecone"?o=k:n==="qdrant"&&(o=a),Array.isArray(o)&&o.forEach(e=>{let t=e.name||e.id||(typeof e=="string"?e:null);if(t){let p=document.createElement("option");p.value=t,p.textContent=t,c.appendChild(p)}}),c.querySelector(`option[value="${CSS.escape(l)}"]`)&&(c.value=l)}function i(n){let c=document.getElementById("aipkit_semantic_search_embedding_provider");if(!c||!n)return;let l=n.options[n.selectedIndex];l&&l.dataset.provider&&(c.value=l.dataset.provider)}function s(){let n=document.getElementById("aipkit_settings_container");if(!n)return;let c="data-semantic-search-listener-attached";if(n.getAttribute(c))return;let l=document.getElementById("aipkit_semantic_search_vector_provider"),o=document.getElementById("aipkit_pinecone_indexes_json_main"),e=document.getElementById("aipkit_qdrant_collections_json_main"),t=document.getElementById("aipkit_semantic_search_embedding_model");if(l){if(o&&o.dataset.indexes)try{k=JSON.parse(o.dataset.indexes)||[]}catch(p){console.error("Error parsing Pinecone indexes JSON:",p)}if(e&&e.dataset.collections)try{a=JSON.parse(e.dataset.collections)||[]}catch(p){console.error("Error parsing Qdrant collections JSON:",p)}l&&(l.addEventListener("change",p=>{if(r(p.target.value),typeof window.aipkit_handleAutoSave=="function"){let d=document.getElementById("aipkit_semantic_search_target_id");d&&(d.value=""),window.aipkit_handleAutoSave()}}),r(l.value)),t&&(t.addEventListener("change",p=>{i(p.target)}),i(t)),n.setAttribute(c,"true")}}window.aipkit_initSemanticSearchUI=s})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let i=r.querySelector("#aipkit_provider");if(!i)return;let s=i.value,n=s.toLowerCase(),c=r.querySelectorAll(".aipkit_api_key_field"),l=r.querySelectorAll(".aipkit_model_field"),o=r.querySelectorAll(".aipkit_advanced_settings_provider"),e=r.querySelector("#aipkit_safety_settings_accordion"),t=r.querySelector(".aipkit_openai_store_field"),p=r.querySelectorAll(".aipkit_param_not_openai");c.forEach(m=>m.style.display="none"),l.forEach(m=>m.style.display="none"),o.forEach(m=>m.style.display="none"),e&&(e.style.display="none"),t&&(t.style.display="none"),r.querySelectorAll(`.aipkit_api_key_field[data-provider="${s}"]`).forEach(m=>m.style.display="block"),r.querySelectorAll(`.aipkit_model_field[data-provider="${s}"]`).forEach(m=>m.style.display="block");let f=r.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${s}"]`);f&&(f.style.display="block"),s==="Google"?e&&(e.style.display="block"):s==="OpenAI"&&t&&(t.style.display="block"),s==="OpenAI"||s==="Google"?p.forEach(m=>m.style.display="none"):p.forEach(m=>m.style.display="block"),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function a(){let r=document.getElementById("aipkit_provider");if(r){let i="data-provider-listener-attached";if(r.getAttribute(i)==="true")return;r.addEventListener("change",function(){k(),typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found.")}),r.setAttribute(i,"true"),k()}}window.aipkit_toggleProviderFields=k,window.aipkit_initProviderSelectListener=a})();(function(){"use strict";function k(o){let e=o?o.dataset:{};return{notSet:e.textNotSet||"Not set",notSelected:e.textNotSelected||"Not selected",statusSet:e.textSet||"Set",statusMissing:e.textMissing||"Missing",statusIncomplete:e.textIncomplete||"Incomplete",labelApiKey:e.labelApiKey||"API Key",labelApiKeyEndpoint:e.labelApiKeyEndpoint||"API Key & Endpoint",labelBaseUrl:e.labelBaseUrl||"Base URL"}}function a(o,e){let t=o.querySelector(e);return t?String(t.value||"").trim():""}function r(o,e){return e?o.querySelector(`.aipkit_model_field[data-provider="${e}"] select`):null}function i(o,e){if(!o)return e.notSelected;let t=String(o.value||"").trim();if(!t)return e.notSelected;let p=o.selectedOptions&&o.selectedOptions[0]?o.selectedOptions[0]:null;return(p?String(p.textContent||"").trim():t)||e.notSelected}function s(){let o=document.getElementById("aipkit_settings_container");if(!o)return;let e=o.querySelector("#aipkit_settings_summary_card");if(!e)return;let t=k(e),p=o.querySelector("#aipkit_provider"),d=p?p.value:"",u=p&&p.selectedOptions&&p.selectedOptions[0]?String(p.selectedOptions[0].textContent||"").trim():"",f=e.querySelector('[data-aipkit-summary="provider"]');f&&(f.textContent=u||t.notSet);let m=e.querySelector('[data-aipkit-summary="model"]');if(m){let x=r(o,d);m.textContent=i(x,t)}let g=e.querySelector('[data-aipkit-summary-label="connection"]'),_=e.querySelector('[data-aipkit-summary="connection-status"]'),h=t.labelApiKey,y=t.statusMissing,E="aipkit_status-warning";if(d==="Azure"){h=t.labelApiKeyEndpoint;let x=a(o,"#aipkit_azure_api_key"),w=a(o,"#aipkit_azure_endpoint");x&&w?(y=t.statusSet,E="aipkit_status-success"):y=t.statusIncomplete}else if(d==="Ollama")h=t.labelBaseUrl,a(o,"#aipkit_ollama_base_url")&&(y=t.statusSet,E="aipkit_status-success");else if(d){let w={OpenAI:"#aipkit_openai_api_key",OpenRouter:"#aipkit_openrouter_api_key",Google:"#aipkit_google_api_key",Claude:"#aipkit_claude_api_key",DeepSeek:"#aipkit_deepseek_api_key"}[d];w&&a(o,w)&&(y=t.statusSet,E="aipkit_status-success")}g&&(g.textContent=h),_&&(_.textContent=y,_.classList.remove("aipkit_status-success","aipkit_status-warning","aipkit_status-info"),_.classList.add(E))}function n(){let o=document.getElementById("aipkit_settings_container");if(!o||!o.querySelector("#aipkit_settings_summary_card"))return;let t="data-summary-listener-attached";if(o.getAttribute(t)!=="true"){let p="#aipkit_provider, .aipkit_model_field select, .aipkit_api_key_field input",d=u=>{u.target.matches(p)&&s()};o.addEventListener("change",d),o.addEventListener("input",d),o.setAttribute(t,"true")}s()}function c(){let o=document.getElementById("aipkit_settings_container");if(!o)return;let e=o.querySelector("#aipkit_settings_advanced_popover");if(!e)return;let t=o.querySelectorAll(".aipkit_settings_advanced_btn");if(!t.length)return;let p=e.querySelector(".aipkit_model_settings_popover_panel"),d=e.querySelector(".aipkit_model_settings_popover_close"),u=null,f=!1,m=E=>{if(!p||!E)return;let x=E.getBoundingClientRect(),w=p.getBoundingClientRect(),S=w.width||400,T=w.height||0,v=window.innerWidth,A=window.innerHeight,C=12,b=x.right+10;b+S>v-C&&(b=x.left-S-10),b=Math.max(C,Math.min(b,v-S-C));let L=x.top;L+T>A-C&&(L=A-T-C),L=Math.max(C,L),p.style.left=`${Math.round(b)}px`,p.style.top=`${Math.round(L)}px`},g=()=>{!u||!e.classList.contains("aipkit-active")||f||(f=!0,window.requestAnimationFrame(()=>{m(u),f=!1}))},_=E=>{E&&(u=E,e.classList.add("aipkit-active"),e.setAttribute("aria-hidden","false"),t.forEach(x=>{x.setAttribute("aria-expanded",x===E?"true":"false")}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_advanced_popover"),window.requestAnimationFrame(()=>{m(E)}))},h=()=>{e.classList.remove("aipkit-active"),e.setAttribute("aria-hidden","true"),t.forEach(E=>{E.setAttribute("aria-expanded","false")}),u=null},y=E=>{E&&E.preventDefault();let x=E?E.currentTarget:null;if(e.classList.contains("aipkit-active")&&u===x){h();return}_(x)};t.forEach(E=>{E.dataset.popoverListenerAttached!=="true"&&(E.addEventListener("click",y),E.dataset.popoverListenerAttached="true")}),d&&d.dataset.popoverListenerAttached!=="true"&&(d.addEventListener("click",h),d.dataset.popoverListenerAttached="true"),e.dataset.overlayListenerAttached!=="true"&&(e.addEventListener("click",E=>{E.target===e&&h()}),e.dataset.overlayListenerAttached="true"),e.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",E=>{E.key==="Escape"&&e.classList.contains("aipkit-active")&&h()}),e.dataset.escapeListenerAttached="true"),e.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",g),window.addEventListener("scroll",g,!0),e.dataset.repositionListenersAttached="true")}function l(){typeof window.aipkit_initMessageCloseButtons=="function"?window.aipkit_initMessageCloseButtons("aipkit_settings_messages"):console.error("Settings Init: aipkit_initMessageCloseButtons not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),typeof window.aipkit_initSettingsSelectPickers=="function"?window.aipkit_initSettingsSelectPickers():console.error("Settings Init: aipkit_initSettingsSelectPickers not found."),c(),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(e=>{e.dataset.accordionListenerAttached!=="true"&&(e.addEventListener("click",function(){let t=this.nextElementSibling;if(t){this.classList.toggle("aipkit_active"),t.classList.toggle("aipkit_active");let p=this.closest(".aipkit_accordion");p?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(p.style.display="block")}}),e.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found."),typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found."),n()}window.aipkit_initSettings=l,window.aipkit_updateSettingsSummary=s,window.aipkit_initSettingsSummary=n})();(function(){"use strict";let k=!1;function a(){let r=document.getElementById("aipkit_role_manager_container");if(!r){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let i=r.querySelector("#aipkit_save_roles_btn"),s=r.querySelector("#aipkit_role_manager_form"),n=r.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),n&&(n.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let c=window.aipkit_role_manager_config,l=c.text||{};if(!i||!s||!n){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let o="data-role-save-listener";i.getAttribute(o)||(i.addEventListener("click",function(e){if(e.preventDefault(),k)return;k=!0;let t=i.querySelector(".aipkit_btn-text"),p=i.querySelector(".aipkit_spinner");i.disabled=!0,p&&(p.style.display="inline-block"),t&&(t.textContent=l.saving||"Saving..."),n.innerHTML="",n.className="aipkit_settings_messages";let d=new FormData(s);d.append("action","aipkit_save_role_permissions"),fetch(c.ajaxurl,{method:"POST",body:d,credentials:"same-origin"}).then(u=>u.ok?u.json():u.json().then(f=>{throw new Error(f.data.message||`HTTP error! status: ${u.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${u.status}`)})).then(u=>{if(!u.success){let f=u.data&&u.data.message?u.data.message:"An unknown error occurred.";throw new Error(f)}return u.data}).then(u=>{let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-success",f.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${u.message||l.success||"Permissions saved!"}`,n.appendChild(f),setTimeout(()=>{f.remove()},4e3)}).catch(u=>{console.error("AIPKit Role Manager Save Error:",u);let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-error",f.innerHTML=`<span class="dashicons dashicons-warning"></span> ${u.message||l.fail||"Failed to save permissions."}`,n.appendChild(f),setTimeout(()=>{f.remove()},6e3)}).finally(()=>{k=!1,i.disabled=!1,p&&(p.style.display="none"),t&&(t.textContent=l.saveButton||"Save Permissions")})}),i.setAttribute(o,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&a()}),window.aipkit_initRoleManager=a})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}a.addEventListener("change",function(i){let s=i.target,n=s.closest(".aipkit_chatbot-settings-area");if(!n)return;if(s.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(n),window.aipkit_toggleOpenAISpecificSettingsVisibility(n),window.aipkit_toggleGoogleSpecificSettingsVisibility(n),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(n);return}if(s.matches('select[name$="_model"]')||s.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(n);return}let c=s.closest(".aipkit_stt_provider_select");if(c){let f=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f?window.aipkit_toggleSttModelFields(f):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",c);return}let l=s.closest(".aipkit_vector_store_toggle_switch");if(l){let f=l.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");if(f){window.aipkit_toggleVectorStoreSettingsVisibility(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="vector_store"]');m&&(m.disabled=!l.checked,m.title=l.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let o=s.closest(".aipkit_vector_store_provider_select");if(o){let f=o.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&(window.aipkit_toggleVectorStoreProviderFields(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f));return}let e=s.closest(".aipkit_vector_embedding_provider_select");if(e){let f=e.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_populateVectorEmbeddingModelSelect(f);return}let t=s.closest(".aipkit_openai_web_search_enable_toggle");if(t){let f=t.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleOpenAIWebSearchSubSettings(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');m&&(m.disabled=!t.checked)}return}let p=s.closest(".aipkit_openai_web_search_loc_type_select");if(p){let f=p.closest(".aipkit_chatbot-settings-area");f&&window.aipkit_toggleOpenAIWebSearchLocationDetails(f);return}let d=s.closest(".aipkit_google_search_grounding_enable_toggle");if(d){let f=d.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleGoogleSearchGroundingSubSettings(f);let m=f.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');m&&(m.disabled=!d.checked)}return}let u=s.closest(".aipkit_google_grounding_mode_select");if(u){let f=u.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_toggleGoogleGroundingDynamicThreshold(f);return}}),a.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{i.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(i),window.aipkit_toggleOpenAISpecificSettingsVisibility(i),window.aipkit_toggleGoogleSpecificSettingsVisibility(i)),i.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(i),i.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(i),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(i));let s=i.querySelector(".aipkit_openai_web_search_enable_toggle"),n=i.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');n&&s&&(n.disabled=!s.checked,n.title=s.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure");let c=i.querySelector(".aipkit_google_search_grounding_enable_toggle"),l=i.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');l&&c&&(l.disabled=!c.checked,l.title=c.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")})}window.aipkit_initProviderSelectToggles=k})();(function(){"use strict";function k(a){if(!a){console.warn("AIPKit Chat Fields: No settings area provided to toggle model fields.");return}let r=a.querySelector(".aipkit_chatbot_provider_select");if(!r){console.warn("AIPKit Chat Fields: Provider select not found in the given settings area.");return}let i=r.value,s=["OpenAI","Google","Claude","OpenRouter","Azure","Ollama","DeepSeek"];a.querySelectorAll(".aipkit_chatbot_model_field").forEach(l=>{l.style.display="none";let o=l.querySelector(".aipkit_cb_web_search_toggle");o&&(o.style.display="none");let e=l.querySelector(".aipkit_cb_stateful_conv_toggle");e&&(e.style.display="none");let t=l.querySelector(".aipkit_cb_image_upload_toggle");t&&(t.style.display="none");let p=l.querySelector(".aipkit_cb_voice_input_toggle");p&&(p.style.display="none")});let c=a.querySelector(`.aipkit_chatbot_model_field[data-provider="${i}"]`);if(c){c.style.display="block",a.querySelectorAll(".aipkit_feature_toggle_item").forEach(d=>{let u=(d.dataset.providers||"").trim();if(!u||u==="*"){d.style.display="";return}let f=u.split(/\s+/);d.style.display=f.includes(i)?"":"none"}),typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(a),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(a);let o=c.querySelector(".aipkit_cb_web_search_toggle");o&&(o.dataset.provider||"").split(" ").includes(i)&&(o.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(a));let e=c.querySelector(".aipkit_cb_stateful_conv_toggle");e&&i==="OpenAI"&&(e.style.display="inline-flex");let t=c.querySelector(".aipkit_cb_image_upload_toggle");t&&(i==="OpenAI"||i==="Claude"?(t.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(a)):t.style.display="none");let p=c.querySelector(".aipkit_cb_voice_input_toggle");p&&(p.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(a)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(a)}}window.aipkit_toggleChatbotModelFields=k})();(function(){"use strict";function k(a){a&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(a)}window.aipkit_toggleOpenAISpecificSettingsVisibility=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=r?.value==="OpenAI",s=a.querySelector(".aipkit_openai_web_search_enable_toggle");s||(s=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),s||(s=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let n=a.querySelector(".aipkit_openai_web_search_conditional_settings");if(!s||!n)return;let c=s.tagName==="SELECT"?s.value==="1":s.checked;if(n.style.display=i&&c?"block":"none",i&&c)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(a);else{let l=a.querySelector(".aipkit_openai_web_search_location_details");l&&(l.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector(".aipkit_openai_web_search_enable_toggle");r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let i=a.querySelector(".aipkit_openai_web_search_loc_type_select"),s=a.querySelector(".aipkit_openai_web_search_location_details");if(!i||!s){s&&(s.style.display="none");return}let n=r?r.tagName==="SELECT"?r.value==="1":r.checked:!1,c=(i.value||"")==="approximate";s.style.display=n&&c?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=k})();(function(){"use strict";function k(a){a&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(a)}window.aipkit_toggleGoogleSpecificSettingsVisibility=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=r?.value==="Google",s=a.querySelector(".aipkit_google_search_grounding_enable_toggle");s||(s=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),s||(s=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let n=a.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!s||!n)return;let c=s.tagName==="SELECT"?s.value==="1":s.checked,l=i&&c;n.style.display=l?"block":"none",l?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(a):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(a,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=k})();(function(){"use strict";function k(a,r=null){if(!a)return;let i=a.querySelector(".aipkit_google_grounding_mode_select"),s=a.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),n=a.querySelector(".aipkit_google_search_grounding_enable_toggle");n||(n=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),n||(n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let c=a.querySelector(".aipkit_google_search_grounding_conditional_settings"),l=c&&c.style.display==="none";if(!i||!s||!n){s&&(s.style.display="none");return}if(l){s.style.display="none";return}let o=r!==null?r:(n.tagName==="SELECT"?n.value==="1":n.checked)&&i.value==="MODE_DYNAMIC";s.style.display=o?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector(".aipkit_stt_provider_select");if(!r)return;let i=r.value;a.querySelectorAll(".aipkit_stt_model_field").forEach(n=>{n.style.display=n.getAttribute("data-stt-provider")===i?"block":"none"})}window.aipkit_toggleSttModelFields=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector(".aipkit_vector_store_toggle_switch");r||(r=a.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let i=a.querySelector(".aipkit_vector_store_settings_conditional_row"),s=a.querySelector(".aipkit_context_grid"),n=a.querySelector(".aipkit_context_layout"),c=a.querySelector(".aipkit_vector_store_advanced_field"),l=a.querySelector(".aipkit_vector_store_top_k_field"),o=a.querySelector(".aipkit_vector_store_confidence_field");if(!r||!i)return;let e=r.tagName==="SELECT"?r.value==="1":r.checked;if(i.style.display=e?"block":"none",c){if(c.style.display=e?"block":"none",!e){let t=c.querySelector(".aipkit_vector_store_advanced_disclosure");t&&(t.open=!1)}l&&(l.style.display=""),o&&(o.style.display="")}else l&&(l.style.display=e?"block":"none"),o&&(o.style.display=e?"block":"none");e?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(a):(a.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_pinecone_key_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_qdrant_url_field, .aipkit_vector_store_qdrant_key_field, .aipkit_vector_store_embedding_config_row").forEach(t=>t.style.display="none"),s&&s.setAttribute("data-vector-provider",""),n&&n.setAttribute("data-vector-provider",""))}window.aipkit_toggleVectorStoreSettingsVisibility=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector(".aipkit_vector_store_provider_select"),i=a.querySelector(".aipkit_vector_store_toggle_switch");if(i||(i=a.querySelector(".aipkit_vector_store_enable_select")),i||(i=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select")),!r||!i)return;let s=a.closest(".aipkit_chatbot_builder")||document.querySelector(".aipkit_chatbot_builder"),n=a.querySelector(".aipkit_chatbot_provider_select")||(s?s.querySelector(".aipkit_chatbot_provider_select"):null),l=(n?String(n.value||"").trim():"").toLowerCase()==="claude",o=Array.from(r.options||[]).find(T=>T&&T.value==="claude_files");if(o){let T=!!o.disabled;if(o.disabled=!l,T!==o.disabled&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),o.disabled&&r.value==="claude_files"){let v=Array.from(r.options||[]).find(A=>A&&A.value&&!A.disabled&&A.value!=="claude_files");if(v&&r.value!==v.value){r.value=v.value,r.dispatchEvent(new Event("change",{bubbles:!0}));return}}}let e=r.value,t=i.tagName==="SELECT"?i.value==="1":i.checked,p=a.querySelector(".aipkit_context_grid"),d=a.querySelector(".aipkit_context_layout"),u=a.querySelector(".aipkit_vector_store_openai_field"),f=a.querySelector(".aipkit_vector_store_pinecone_field"),m=a.querySelector(".aipkit_vector_store_pinecone_key_field"),g=a.querySelector(".aipkit_vector_store_qdrant_field"),_=a.querySelector(".aipkit_vector_store_qdrant_url_field"),h=a.querySelector(".aipkit_vector_store_qdrant_key_field"),y=a.querySelector(".aipkit_vector_store_embedding_config_row"),E=a.querySelector(".aipkit_vector_store_advanced_field"),x=a.querySelector(".aipkit_vector_store_top_k_field"),w=a.querySelector(".aipkit_vector_store_confidence_field"),S=["openai","pinecone","qdrant"].includes(e);if(u&&(u.style.display=t&&e==="openai"?"block":"none"),f&&(f.style.display=t&&e==="pinecone"?"block":"none"),m&&(m.style.display=t&&e==="pinecone"?"block":"none"),g&&(g.style.display=t&&e==="qdrant"?"block":"none"),_&&(_.style.display=t&&e==="qdrant"?"block":"none"),h&&(h.style.display=t&&e==="qdrant"?"block":"none"),y&&(y.style.display=t&&(e==="pinecone"||e==="qdrant")?"block":"none"),E){if(E.style.display=t&&S?"block":"none",!t||!S){let T=E.querySelector(".aipkit_vector_store_advanced_disclosure");T&&(T.open=!1)}x&&(x.style.display=""),w&&(w.style.display="")}else x&&(x.style.display=t&&S?"block":"none"),w&&(w.style.display=t&&S?"block":"none");p&&p.setAttribute("data-vector-provider",t?e:""),d&&d.setAttribute("data-vector-provider",t?e:""),t&&e==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(a):t&&(e==="pinecone"||e==="qdrant")&&(e==="pinecone"&&typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(a),e==="qdrant"&&typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"&&window.aipkit_populateQdrantCollectionsMultiSelect(a),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(a),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(a))}window.aipkit_toggleVectorStoreProviderFields=k})();(function(){"use strict";let k=!1,a=window.wp&&window.wp.i18n?window.wp.i18n:null,r=a&&typeof a.__=="function"?a.__:c=>c;function i(c){let l=c.querySelector('select[name="openai_vector_store_ids[]"]'),o=window.aipkit_escapeHtml||function(T){return T};if(!l)return;let e=c.querySelector("[data-aipkit-vector-stores-dropdown]"),t=e?e.querySelector(".aipkit_popover_multiselect_btn"):null,p=e?e.querySelector(".aipkit_popover_multiselect_label"):null,d=e?e.querySelector(".aipkit_popover_multiselect_panel"):null,u=e?e.querySelector(".aipkit_popover_multiselect_options"):null,f=e?.dataset.placeholder||"Select stores",m=e?.dataset.selectedLabel||"selected",g=window.aipkit_chat_config?.openaiVectorStores||[],_=s(l),h=Array.from(l.options).filter(T=>T.selected).map(T=>T.value),y=_&&_.length?_:h;if(l.innerHTML="",g.length>0){let T=1;g.forEach(v=>{if(v&&v.id){let A="(Files: N/A)";v.file_counts&&typeof v.file_counts.total=="number"?A=`(${v.file_counts.total} ${v.file_counts.total===1?"File":"Files"})`:v.file_counts&&(A="(Files: ?)");let C=v.name||`Untitled store ${T}`,b=`${o(C)} ${A}`,L=document.createElement("option");L.value=v.id,L.textContent=b,y.includes(v.id)&&(L.selected=!0),l.appendChild(L),T+=1}})}if(g.length>0){let T=1;y.forEach(v=>{if(!g.some(C=>C.id===v)&&!l.querySelector(`option[value="${CSS.escape(v)}"]`)){let C=document.createElement("option");C.value=v,C.textContent=`Manual store ${T} (not synced)`,C.selected=!0,l.appendChild(C),T+=1}})}l.options.length===0&&(l.innerHTML='<option value="" disabled>-- No vector stores found --</option>');let E=()=>{if(!p)return;let T=Array.from(l.options).filter(A=>A.selected&&A.value);if(!T.length){p.textContent=f;return}let v=T.map(A=>A.textContent.trim()).filter(Boolean);if(v.length<=2){p.textContent=v.join(", ");return}p.textContent=`${v.length} ${m}`},x=()=>{if(!u)return;let T=Array.from(u.querySelectorAll('input[type="checkbox"]:checked'));if(T.length>2){let A=T[T.length-1];A&&(A.checked=!1)}let v=Array.from(u.querySelectorAll('input[type="checkbox"]:checked')).map(A=>A.value);Array.from(l.options).forEach(A=>{A.selected=v.includes(A.value)}),l.dispatchEvent(new Event("change",{bubbles:!0})),E()},w=()=>{if(!u)return;u.innerHTML="";let T=Array.from(l.options),v=T.filter(A=>A.value);if(!v.length){let A=document.createElement("div");A.className="aipkit_popover_multiselect_empty",A.textContent=T[0]?.textContent||"-- No Stores Found --",u.appendChild(A),E();return}v.forEach(A=>{let C=document.createElement("label");C.className="aipkit_popover_multiselect_item";let b=document.createElement("input");b.type="checkbox",b.value=A.value,b.checked=A.selected,b.disabled=A.disabled;let L=document.createElement("span");L.className="aipkit_popover_multiselect_text",L.textContent=A.textContent,C.appendChild(b),C.appendChild(L),u.appendChild(C)}),E()},S=T=>{!e||!t||(e.classList.toggle("is-open",T),t.setAttribute("aria-expanded",T?"true":"false"),d&&(d.hidden=!T))};e&&t&&!e.dataset.listenerAttached&&(t.addEventListener("click",T=>{T.preventDefault(),S(!e.classList.contains("is-open"))}),document.addEventListener("click",T=>{e.classList.contains("is-open")&&(e.contains(T.target)||S(!1))}),t.addEventListener("keydown",T=>{T.key==="Escape"&&S(!1)}),e.dataset.listenerAttached="true"),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",x),u.dataset.listenerAttached="true"),w(),n(c,{selectElement:l,dropdown:e,dropdownPanel:d,dropdownOptions:u,setOpenState:S,placeholder:f})}function s(c){if(!c||!c.dataset.aipkitPendingVectorSelection)return[];let l=[];try{let o=JSON.parse(c.dataset.aipkitPendingVectorSelection);Array.isArray(o)&&(l=o.map(e=>String(e||"").trim()).filter(Boolean).slice(-2))}catch{l=[]}return delete c.dataset.aipkitPendingVectorSelection,l}function n(c,l){let{selectElement:o,dropdown:e,dropdownPanel:t,dropdownOptions:p,setOpenState:d,placeholder:u}=l||{};if(!e||!t||!p||!o)return;let f=t.querySelector(".aipkit_vector_store_dropdown_actions");f||(f=document.createElement("div"),f.className="aipkit_vector_store_dropdown_actions",f.innerHTML=`
        <div class="aipkit_vector_store_dropdown_action_list">
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_vector_store_dropdown_new_btn">
            <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
            ${r("New Store","gpt3-ai-content-generator")}
          </button>
        </div>
        <div class="aipkit_vector_store_dropdown_inline_form" style="display:none;">
          <input
            type="text"
            class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--framed aipkit_vector_store_dropdown_name_input"
            placeholder="${r("e.g. Product FAQ","gpt3-ai-content-generator")}"
          />
          <div class="aipkit_vector_store_dropdown_inline_actions">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_vector_store_dropdown_cancel_btn">
              ${r("Cancel","gpt3-ai-content-generator")}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_vector_store_dropdown_create_btn">
              ${r("Create","gpt3-ai-content-generator")}
            </button>
          </div>
        </div>
        <p class="aipkit_form-help aipkit_vector_store_dropdown_status" style="display:none;" aria-live="polite"></p>
      `,t.insertBefore(f,p));let m=f.querySelector(".aipkit_vector_store_dropdown_action_list"),g=f.querySelector(".aipkit_vector_store_dropdown_inline_form"),_=f.querySelector(".aipkit_vector_store_dropdown_create_btn"),h=f.querySelector(".aipkit_vector_store_dropdown_cancel_btn"),y=f.querySelector(".aipkit_vector_store_dropdown_new_btn"),E=f.querySelector(".aipkit_vector_store_dropdown_name_input"),x=f.querySelector(".aipkit_vector_store_dropdown_status"),w=()=>{f&&typeof f._aipkitVectorStoreStatusTimer=="number"&&f._aipkitVectorStoreStatusTimer&&(window.clearTimeout(f._aipkitVectorStoreStatusTimer),f._aipkitVectorStoreStatusTimer=0)},S=(L=3200)=>{w(),f&&(f._aipkitVectorStoreStatusTimer=window.setTimeout(()=>{T("")},L))},T=(L,B="",$=0)=>{w(),x&&(x.textContent=L||"",x.style.display=L?"block":"none",x.classList.remove("aipkit_color_notice_success","aipkit_color_notice_error","aipkit_color_notice_info"),B==="success"?x.classList.add("aipkit_color_notice_success"):B==="error"?x.classList.add("aipkit_color_notice_error"):B==="info"&&x.classList.add("aipkit_color_notice_info"),L&&Number($)>0&&S(Number($)))},v=()=>{E&&(E.value=""),m&&(m.style.display=""),g&&(g.style.display="none"),T("")},A=()=>{m&&(m.style.display="none"),g&&(g.style.display="block"),T(""),E&&(E.focus(),E.select())},C=async()=>{if(!_||!E)return;let L=String(E.value||"").trim();if(!L){T(r("Store name is required.","gpt3-ai-content-generator"),"error",3e3);return}if(typeof window.aipkit_apiRequest!="function"){T(r("API request helper is unavailable.","gpt3-ai-content-generator"),"error",3e3);return}let B=document.getElementById("aipkit_vector_store_nonce_openai"),$=B?String(B.value||"").trim():"";if(!$){T(r("OpenAI nonce is missing.","gpt3-ai-content-generator"),"error",3e3);return}let W=_.textContent;_.disabled=!0,_.textContent=r("Creating...","gpt3-ai-content-generator"),h&&(h.disabled=!0),T("");try{let U=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:$,name:L,source_type:"chatbot_training_text"}),D=U?.store||U;if(!D||!D.id)throw new Error(r("OpenAI vector store creation failed.","gpt3-ai-content-generator"));window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]);let H=window.aipkit_chat_config.openaiVectorStores;H.some(R=>R&&R.id===D.id)||H.unshift(D);let P=Array.from(o.options).filter(R=>R.selected&&R.value).map(R=>R.value).filter(R=>R&&R!==D.id).slice(-1);P.push(D.id),o.dataset.aipkitPendingVectorSelection=JSON.stringify(P),i(c),d(!0),T(U?.message||r("Vector store created.","gpt3-ai-content-generator"),"success",2800)}catch(U){let D=U&&U.message?U.message:r("Create failed.","gpt3-ai-content-generator");T(`${r("Error:","gpt3-ai-content-generator")} ${D}`,"error",3200)}finally{_.disabled=!1,_.textContent=W,h&&(h.disabled=!1)}},b=typeof window.aipkit_apiRequest=="function";y&&(y.disabled=!b,b?y.removeAttribute("title"):y.setAttribute("title",r("Creation is unavailable right now.","gpt3-ai-content-generator"))),f.dataset.listenerAttached||(y&&y.addEventListener("click",()=>{A()}),h&&h.addEventListener("click",()=>{v()}),_&&_.addEventListener("click",C),E&&E.addEventListener("keydown",L=>{if(L.key==="Enter"){L.preventDefault(),C();return}L.key==="Escape"&&(L.preventDefault(),v())}),f.dataset.listenerAttached="true"),p.children.length?(y&&(y.textContent=r("New Store","gpt3-ai-content-generator")),(!g||g.style.display==="none")&&T("")):(T(r("No stores found. Create your first one.","gpt3-ai-content-generator"),"info"),y&&(y.textContent=r("Create Store","gpt3-ai-content-generator"))),!o.value&&u&&e&&!e.classList.contains("is-open")&&d(!1)}window.aipkit_populateOpenAIVectorStoresMultiSelect=i,k||(window.addEventListener("aipkit:vector-store-list-updated",c=>{if(String(c?.detail?.provider||"").toLowerCase()!=="openai")return;Array.from(document.querySelectorAll('select[name="openai_vector_store_ids[]"]')).forEach(e=>{let t=e.closest(".aipkit_settings_accordion_body")||e.closest(".aipkit_chatbot_builder")||e.parentElement;t&&i(t)})}),k=!0)})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector('select[name="qdrant_collection_names[]"]');if(!r)return;let i=a.querySelector("[data-aipkit-qdrant-collections-dropdown]"),s=i?i.querySelector(".aipkit_popover_multiselect_btn"):null,n=i?i.querySelector(".aipkit_popover_multiselect_label"):null,c=i?i.querySelector(".aipkit_popover_multiselect_panel"):null,l=i?i.querySelector(".aipkit_popover_multiselect_options"):null;if(!i||!l)return;let o=i.dataset.placeholder||"Select collections",e=i.dataset.selectedLabel||"selected",t=()=>{if(!n)return;let f=Array.from(r.options).filter(g=>g.selected&&g.value);if(!f.length){n.textContent=o;return}let m=f.map(g=>g.textContent.trim()).filter(Boolean);if(m.length<=2){n.textContent=m.join(", ");return}n.textContent=`${m.length} ${e}`},p=()=>{let f=Array.from(l.querySelectorAll('input[type="checkbox"]:checked')).map(m=>m.value);Array.from(r.options).forEach(m=>{m.selected=f.includes(m.value)}),r.dispatchEvent(new Event("change",{bubbles:!0})),t()},d=()=>{l.innerHTML="";let f=Array.from(r.options),m=f.filter(g=>g.value);if(!m.length){let g=document.createElement("div");g.className="aipkit_popover_multiselect_empty",g.textContent=f[0]?.textContent||"-- No Collections Found --",l.appendChild(g),t();return}m.forEach(g=>{let _=document.createElement("label");_.className="aipkit_popover_multiselect_item";let h=document.createElement("input");h.type="checkbox",h.value=g.value,h.checked=g.selected,h.disabled=g.disabled;let y=document.createElement("span");y.className="aipkit_popover_multiselect_text",y.textContent=g.textContent,_.appendChild(h),_.appendChild(y),l.appendChild(_)}),t()},u=f=>{!i||!s||(i.classList.toggle("is-open",f),s.setAttribute("aria-expanded",f?"true":"false"),c&&(c.hidden=!f))};i&&s&&!i.dataset.listenerAttached&&(s.addEventListener("click",f=>{f.preventDefault(),u(!i.classList.contains("is-open"))}),document.addEventListener("click",f=>{i.classList.contains("is-open")&&(i.contains(f.target)||u(!1))}),s.addEventListener("keydown",f=>{f.key==="Escape"&&u(!1)}),i.dataset.listenerAttached="true"),l&&!l.dataset.listenerAttached&&(l.addEventListener("change",p),l.dataset.listenerAttached="true"),d()}window.aipkit_populateQdrantCollectionsMultiSelect=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector('select[name="pinecone_index_name"]');if(!r)return;let i=a.querySelector("[data-aipkit-pinecone-index-dropdown]"),s=i?i.querySelector(".aipkit_popover_multiselect_btn"):null,n=i?i.querySelector(".aipkit_popover_multiselect_label"):null,c=i?i.querySelector(".aipkit_popover_multiselect_panel"):null,l=i?i.querySelector(".aipkit_popover_multiselect_options"):null,o=window.aipkit_escapeHtml||function(x){return x},e=window.aipkit_chat_config?.pineconeIndexes||[],t=String(r.value||"").trim(),p=i&&i.dataset&&i.dataset.placeholder||"Select index",d=[],u=new Set;Array.isArray(e)&&e.forEach(x=>{let w=String(x?.name||x?.id||"").trim();if(!w||u.has(w))return;u.add(w);let S=String(x?.name||w),T=x?.total_vector_count,A=T!=null&&T!=="Error"&&T!=="No Host"?` (Vectors: ${Number(T).toLocaleString()})`:T==="Error"||T==="No Host"?" (Stats Err)":" (Vectors: ?)";d.push({value:w,label:o(`${S}${A}`),disabled:!1})}),t&&!u.has(t)&&(d.push({value:t,label:o(`${t} (Manual/Not Synced)`),disabled:!1}),u.add(t)),d.length||d.push({value:"",label:"-- No Indexes Found (Sync in AI Settings) --",disabled:!0}),r.innerHTML="";let f=new Option(p,"");f.selected=!t,r.appendChild(f);let m=!1;d.forEach(x=>{let w=new Option(x.label,x.value);x.disabled&&(w.disabled=!0),!x.disabled&&x.value&&x.value===t&&(w.selected=!0,m=!0),r.appendChild(w)}),t&&!m&&(r.value="");let g=()=>{if(!n)return;let x=r.selectedOptions&&r.selectedOptions.length?r.selectedOptions[0]:null,w=x&&x.textContent?x.textContent.trim():"";n.textContent=w||p},_=()=>{if(!l)return;l.innerHTML="";let x=Array.from(r.options).filter(S=>!S.disabled&&S.value);if(!x.length){let S=document.createElement("div");S.className="aipkit_popover_multiselect_empty",S.textContent=r.options[0]?.textContent||"-- No Indexes Found (Sync in AI Settings) --",l.appendChild(S),g();return}let w=i.dataset.pineconeRadioName||`aipkit_pinecone_index_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;i.dataset.pineconeRadioName=w,x.forEach(S=>{let T=document.createElement("label");T.className="aipkit_popover_multiselect_item aipkit_vector_store_pinecone_item";let v=document.createElement("span");v.className="aipkit_vector_store_pinecone_item_label";let A=document.createElement("input");A.type="radio",A.name=w,A.className="aipkit_vector_store_pinecone_radio",A.value=S.value,A.checked=S.selected;let C=document.createElement("span");C.className="aipkit_popover_multiselect_text",C.textContent=S.textContent,v.appendChild(A),v.appendChild(C),T.appendChild(v),l.appendChild(T)}),g()},h=()=>{if(!l)return;let x=l.querySelector(".aipkit_vector_store_pinecone_radio:checked");if(!x)return;let w=x.value||"";(r.value||"")!==w?(r.value=w,r.dispatchEvent(new Event("change",{bubbles:!0}))):g()},y=()=>{if(!l){g();return}let x=r.value||"";l.querySelectorAll(".aipkit_vector_store_pinecone_radio").forEach(w=>{w.checked=w.value===x}),g()},E=x=>{!i||!s||(i.classList.toggle("is-open",x),s.setAttribute("aria-expanded",x?"true":"false"),c&&(c.hidden=!x))};i&&s&&!i.dataset.listenerAttached&&(s.addEventListener("click",x=>{x.preventDefault(),E(!i.classList.contains("is-open"))}),document.addEventListener("click",x=>{i.classList.contains("is-open")&&(i.contains(x.target)||E(!1))}),document.addEventListener("keydown",x=>{x.key==="Escape"&&E(!1)}),i.dataset.listenerAttached="true"),l&&!l.dataset.listenerAttached&&(l.addEventListener("change",x=>{x.target&&x.target.matches(".aipkit_vector_store_pinecone_radio")&&(h(),E(!1))}),l.dataset.listenerAttached="true"),r.dataset.pineconeDropdownBound!=="1"&&(r.addEventListener("change",y),r.dataset.pineconeDropdownBound="1"),_(),y()}window.aipkit_populatePineconeIndexSelect=k})();(function(){"use strict";function k(a){let r=a.querySelector('select[name="vector_embedding_provider"]');r&&(r.value===""&&(r.value="openai"),r.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=k})();(function(){"use strict";function k(a){let r=a.querySelector('select[name="vector_embedding_provider"]'),i=a.querySelector('select[name="vector_embedding_model"]'),s=window.aipkit_escapeHtml||function(o){return o};if(!r||!i)return;let n=r.value,c=i.value;i.innerHTML="",i.appendChild(new Option(s("-- Select Model --"),""));let l=[];if(n==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?l=window.aipkit_chat_config.openaiEmbeddingModels:n==="google"&&window.aipkit_chat_config?.googleEmbeddingModels?l=window.aipkit_chat_config.googleEmbeddingModels:n==="openrouter"&&window.aipkit_chat_config?.openrouterEmbeddingModels?l=window.aipkit_chat_config.openrouterEmbeddingModels:n==="azure"&&window.aipkit_chat_config?.azureEmbeddingModels&&(l=window.aipkit_chat_config.azureEmbeddingModels),l.length>0&&l.forEach(o=>{if(o&&o.id){let e=new Option(s(o.name||o.id),o.id);o.id===c&&(e.selected=!0),i.appendChild(e)}}),c&&!i.querySelector(`option[value="${CSS.escape(c)}"]`)){let o=new Option(s(c)+" (Manual/Not Synced)",c,!1,!0);i.appendChild(o),i.value=c}i.options.length<=1&&(i.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector(".aipkit_vector_store_toggle_switch");r||(r=a.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let i=a.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),s=a.querySelector(".aipkit_vector_store_provider_select"),n=a.querySelector(".aipkit_chatbot_provider_select"),c=a.querySelector(".aipkit_file_upload_field_group");if(!r||!i||!c)return;let l=r.tagName==="SELECT"?r.value==="1":r.checked,o=i.dataset.isProPlan==="true",e=s?s.value:"",t=n?n.value:"",p=e==="claude_files",d=t==="Claude";if(s){let g=Array.from(s.options||[]).find(_=>_&&_.value==="claude_files");g&&(g.disabled=!d)}if(p&&!d&&s){let g=Array.from(s.options||[]).find(h=>h&&h.value&&h.value!=="claude_files"),_=g?g.value:"openai";if(s.value!==_){s.value=_,s.dispatchEvent(new Event("change",{bubbles:!0}));return}}let f=o&&l&&(!p||d),m="";o?p&&!d?m='Claude Files requires the chatbot "Provider" to be set to Claude.':l||(m='File upload requires "Enable Vector Store" to be active for this bot.'):m="File upload is a paid feature. Please upgrade.",f?(i.disabled=!1,c.classList.remove("aipkit_dimmed_row"),c.style&&(c.style.opacity=""),c.removeAttribute("title")):(i.checked&&(i.checked=!1,i.dispatchEvent(new Event("change",{bubbles:!0}))),i.disabled=!0,c.classList.add("aipkit_dimmed_row"),c.style&&c.style.opacity&&(c.style.opacity=""),c.setAttribute("title",m))}window.aipkit_toggleFileUploadAvailability=k})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelector('select[name="theme"]'),s=r.querySelector('input[name="theme"]:checked'),n=()=>i?i.value:s?s.value:"",c=r.querySelector(".aipkit_custom_theme_config_btn, .aipkit_open_custom_theme_modal_btn"),l=n()==="custom";c&&(c.style.display=l?"inline-flex":"none")}function a(){let r=document.querySelector(".aipkit_chatbot_module_container")||document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Theme Toggle: Module container not found.");return}r.dataset.themeSettingsListenerAttached||(r.addEventListener("click",function(i){i.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(i):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),r.addEventListener("change",function(i){let s=i.target;if(s.matches&&s.matches('select[name="theme"]')||s.matches&&s.matches('input[name="theme"]')){let n=s.closest('.aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]')||s.closest(".aipkit_chatbot-settings-area")||r;if(n){k(n);let c=n.querySelector(".aipkit_open_custom_theme_modal_btn");if(c&&s.value==="custom"&&typeof window.aipkit_openChatbotSettingsModalById=="function"){let l=c.getAttribute("data-modal-target");l&&window.aipkit_openChatbotSettingsModalById(l)}}}}),r.dataset.themeSettingsListenerAttached="true"),document.documentElement.dataset.aipkitResetListenerAttached||(document.addEventListener("click",function(i){i.target.closest(".aipkit_chatbot_settings_modal .aipkit_reset_custom_theme_btn")&&typeof window.aipkit_handleResetCustomTheme=="function"&&window.aipkit_handleResetCustomTheme(i)}),document.documentElement.dataset.aipkitResetListenerAttached="true"),r.querySelectorAll('.aipkit_chatbot-settings-area, .aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]').forEach(i=>{k(i)})}window.aipkit_initChatThemeSettingsToggle=a})();(function(){"use strict";function k(a){let r=a.target.closest(".aipkit_reset_custom_theme_btn");if(!r)return;let i=r.dataset.botId,s=document.getElementById("aipkit_chatbot_main_tab_content_container"),n=document.getElementById(`aipkit_bot_${i}_custom_theme_settings_container`)||(s?s.querySelector(`#aipkit_bot_${i}_custom_theme_settings_container`):null),c=document.getElementById(`aipkit_reset_theme_status_${i}`)||(s?s.querySelector(`#aipkit_reset_theme_status_${i}`):null);if(!n||!c){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",i);return}let l=n.dataset.defaults;if(!l){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"error","Error: Defaults not found.",2e3);return}try{let o=JSON.parse(l);n.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(t=>{let d=t.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(d&&d[1]){let u=d[1];if(Object.prototype.hasOwnProperty.call(o,u)){t.type==="checkbox"?t.checked=String(o[u])==="1":t.value=o[u]!==null?String(o[u]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});t.dispatchEvent(f)}else if(Object.prototype.hasOwnProperty.call(o,u+"_placeholder")){t.type==="checkbox"?t.checked=String(o[u+"_placeholder"])==="1":t.value=o[u+"_placeholder"]!==null?String(o[u+"_placeholder"]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});t.dispatchEvent(f)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"success","\u2714 Reverted.",2e3)}catch(o){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",o),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=k})();(function(){"use strict";function k(f){let m=new Event("input",{bubbles:!0,cancelable:!0}),g=new Event("change",{bubbles:!0,cancelable:!0});f.dispatchEvent(m),f.dispatchEvent(g)}function a(){document.documentElement.dataset.aipkitApplyingThemePreset="1"}function r(){window.setTimeout(()=>{delete document.documentElement.dataset.aipkitApplyingThemePreset},0)}function i(f,m,g){let _=f.querySelector(`input[name="custom_theme_settings[${m}]"], select[name="custom_theme_settings[${m}]"]`);if(_){if(_.type==="checkbox"){let h=g==="1";_.checked!==h&&(_.checked=h,k(_));return}_.value!==g&&(_.value=g,k(_))}}function s(f){let m=f.closest(".aipkit_chatbot_settings_form");if(!m)return;let g=f.dataset.presetKey||"",_=m.querySelector('select[name="theme"]');if(_&&!_.disabled){let y=-1,E=Array.from(_.options||[]);g&&(y=E.findIndex(x=>(x.value||"")==="custom"&&x.dataset&&x.dataset.presetKey===g)),y<0&&(y=E.findIndex(x=>(x.value||"")==="custom"&&!(x.dataset&&x.dataset.presetKey))),y>=0&&_.selectedIndex!==y&&(_.selectedIndex=y,k(_));return}let h=m.querySelector('input[name="theme"][value="custom"]');h&&!h.checked&&(h.checked=!0,k(h))}function n(f,m){if(!f)return;let g=f.querySelector('input[name="theme_preset_key"]');g&&!g.disabled&&(g.value=m||"")}function c(f){return f?document.getElementById(`aipkit_bot_${f}_custom_theme_settings_container`):null}function l(f){let m=f.closest(".aipkit_custom_theme_settings_container");if(m)return m;let g=f.dataset.botId||f.closest("[data-bot-id]")?.dataset.botId;return c(g)}function o(f){let m=f.closest(".aipkit_chatbot_settings_form");if(!m)return null;let g=m.querySelector(".aipkit_custom_theme_settings_container");if(g)return g;let _=m.dataset.botId||m.closest("[data-bot-id]")?.dataset.botId;return c(_)}function e(f){let m=f.closest(".aipkit_custom_theme_presets");m&&m.querySelectorAll(".aipkit_custom_theme_preset").forEach(g=>{let _=g===f;g.classList.toggle("is-selected",_),g.setAttribute("aria-pressed",_?"true":"false")})}function t(f){let m=f.dataset.primary,g=f.dataset.secondary,_=f.dataset.presetKey||"";if(!m||!g)return;let h=l(f);if(!h)return;let y=f.closest(".aipkit_chatbot_settings_form");a(),s(f),n(y,_),i(h,"primary_color",m),i(h,"secondary_color",g),i(h,"auto_text_contrast","1"),r(),e(f)}function p(f){if(!f||f.disabled)return;let m=f.selectedOptions&&f.selectedOptions.length?f.selectedOptions[0]:null;if(!m||!m.dataset)return;let g=m.dataset.presetKey||"",_=m.dataset.primary||"",h=m.dataset.secondary||"";if(!g||!_||!h){let x=f.closest(".aipkit_chatbot_settings_form");n(x,"");return}let y=o(f);if(!y)return;let E=f.closest(".aipkit_chatbot_settings_form");a(),n(E,g),i(y,"primary_color",_),i(y,"secondary_color",h),i(y,"auto_text_contrast","1"),r()}function d(f){if(!f||!f.closest||document.documentElement.dataset.aipkitApplyingThemePreset==="1")return;let m=f.closest(".aipkit_chatbot_settings_form");m&&n(m,"")}function u(){document.documentElement.dataset.aipkitCustomThemePresetsBound||(document.addEventListener("click",f=>{let m=f.target.closest(".aipkit_custom_theme_preset");m&&(f.preventDefault(),t(m))}),document.addEventListener("change",f=>{let m=f.target;!m||!m.matches||!m.matches('select[name="theme"]')||p(m)}),document.addEventListener("change",f=>{let m=f.target;!m||!m.matches||!m.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')||d(m)}),document.documentElement.dataset.aipkitCustomThemePresetsBound="1")}window.aipkit_initCustomThemePresets=u})();(function(){"use strict";let k=".aipkit_builder_theme_row_content",a=".aipkit_builder_theme_row",r=".aipkit_theme_scroll_btn",i=".aipkit_theme_scroll_btn--prev",s=".aipkit_theme_scroll_btn--next";function n(d){let u=d.closest(a);return u?{row:u,prev:u.querySelector(i),next:u.querySelector(s)}:null}function c(d){return Math.max(180,Math.round(d.clientWidth*.75))}function l(d){let u=n(d);if(!u||!u.prev||!u.next)return;let f=Math.max(0,d.scrollWidth-d.clientWidth),m=d.scrollLeft<=1,g=d.scrollLeft>=f-1;u.prev.disabled=f===0||m,u.next.disabled=f===0||g}function o(d){let u=d.target.closest(r);if(!u||u.disabled)return;let f=u.closest(a),m=f?f.querySelector(k):null;if(!m)return;let g=u.classList.contains("aipkit_theme_scroll_btn--next")?1:-1;m.scrollBy({left:g*c(m),behavior:"smooth"})}function e(d){let u=d.target;!(u instanceof HTMLElement)||!u.matches(k)||l(u)}function t(){document.querySelectorAll(k).forEach(d=>{l(d)})}function p(d){let u=document.documentElement;u.dataset.aipkitThemeRowScrollBound||(document.addEventListener("click",o),document.addEventListener("scroll",e,!0),window.addEventListener("resize",t),u.dataset.aipkitThemeRowScrollBound="1"),d&&t()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>p(!0)):p(!0),window.aipkit_initThemeRowScroll=function(){p(!0)}})();(function(){"use strict";function k(n){if(!n)return;let c=n.querySelector(".aipkit_chatbot_provider_select");c||(c=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let l=n.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');l||(l=document.querySelector('#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_model_field[data-provider="OpenAI"] select'));let o=n.querySelector(".aipkit_reasoning_effort_field"),e=o?o.querySelector(".aipkit_reasoning_effort_slider"):null,t=o?o.querySelector('input[name="reasoning_effort"]'):null,p=o?o.querySelector(".aipkit_reasoning_effort_label"):null,d=null;if(o?d=o.closest('section[data-section="reasoning"], .aipkit_reasoning_section'):d=n.querySelector(".aipkit_reasoning_section"),!o)return;let u=o.querySelector('select[name="reasoning_effort"]'),f=()=>{o.classList.add("aipkit_hidden"),d&&d.classList.add("aipkit_hidden"),u&&(u.disabled=!0),o.style.opacity="",o.removeAttribute("title")},m=()=>{o.classList.remove("aipkit_hidden"),d&&d.classList.remove("aipkit_hidden"),u&&(u.disabled=!1),o.style.opacity="",o.removeAttribute("title")};if(!c||!l){f();return}let g=(c.value||"").toLowerCase(),h=(l.value||"").toLowerCase(),y=h.startsWith("o1")||h.startsWith("o3")||h.startsWith("o4"),E=h.includes("gpt-5");g==="openai"&&(y||E)?(m(),a(e,t,p,h)):f()}function a(n,c,l,o){if(!n||!c)return;let e=r(o),t=e.allowed,p=t.map(f=>f==="medium"?"med":f);n.dataset.reasoningValues=JSON.stringify(t),n.dataset.reasoningLabels=JSON.stringify(p),n.max=String(Math.max(0,t.length-1));let d=c.value||"";d==="minimal"&&(d="low"),t.includes(d)||(d=e.defaultValue),t.includes(d)||(d=t[0]||""),d&&(c.value=d);let u=Math.max(0,t.indexOf(d));n.value=String(u),l&&(l.textContent=p[u]||p[0]||""),n.dispatchEvent(new Event("input",{bubbles:!0}))}function r(n){return s(n)?{allowed:["high"],defaultValue:"high"}:n.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(n)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(n){let c=n.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let l=n.match(/gpt-(\d+)/);return l?Number.parseInt(l[1],10)>=6:!1}function s(n){return/gpt-5(\.\d+)?-pro/.test(n)}window.aipkit_toggleReasoningEffort=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(S){return S},a="#aipkit_chatbot_builder_bot_select, #aipkit_sources_provider_filter, #aipkit_sources_index_filter, .aipkit_vector_store_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_model_field select",r=null,i=null,s=!1,n=S=>!!(S&&(S.classList.contains("aipkit_chatbot_provider_select")||S.classList.contains("aipkit_vector_store_provider_select")||S.id==="aipkit_sources_provider_filter")),c=S=>!!(S&&S.id==="aipkit_chatbot_builder_bot_select"),l=S=>{let T=String(S||"").trim().toLowerCase();return T==="claude_files"?"claude":T},o=(S,T)=>{if(!S)return;let v="aipkit_settings_select_picker_icon--";S.classList.forEach(C=>{C.startsWith(v)&&S.classList.remove(C)}),S.classList.remove("is-hidden");let A=l(T);if(!A){S.classList.add("is-hidden");return}S.classList.add(`${v}${A}`)},e=S=>{if(!S)return"";let T=S.getAttribute("data-aipkit-picker-title");if(T)return T;let v=S.id&&document.querySelector(`label[for="${S.id}"]`)||S.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return v?v.textContent.trim():""},t=S=>{if(!S)return"";let T=S.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:S.querySelector("option[selected]");if(T)return T.textContent.trim();let v=S.querySelector("option");return v?v.textContent.trim():""},p=S=>({buttonId:`${S}_picker_btn`,labelId:`${S}_picker_label`,popoverId:`${S}_picker_popover`,titleId:`${S}_picker_title`,searchId:`${S}_picker_search`,listId:`${S}_picker_list`}),d=S=>{if(!S||!S.id)return null;let T=p(S.id),v=S.closest(".aipkit_chatbot_builder");if(!v)return null;let A=document.getElementById(T.buttonId);if(!A){if(A=document.createElement("button"),A.type="button",A.id=T.buttonId,A.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",A.setAttribute("data-aipkit-popover-target",T.popoverId),A.setAttribute("aria-controls",T.popoverId),A.setAttribute("aria-expanded","false"),A.dataset.aipkitPopoverPlacement="bottom",n(S)){A.classList.add("aipkit_settings_select_picker_btn--provider");let B=document.createElement("span");B.className="aipkit_settings_select_picker_icon",B.setAttribute("aria-hidden","true"),o(B,S.value),A.appendChild(B)}let b=document.createElement("span");b.className="aipkit_settings_select_picker_label",b.id=T.labelId,b.textContent=t(S)||k("Select","gpt3-ai-content-generator");let L=document.createElement("span");L.className="dashicons dashicons-arrow-down-alt2",L.setAttribute("aria-hidden","true"),A.appendChild(b),A.appendChild(L),S.insertAdjacentElement("beforebegin",A)}S.classList.contains("screen-reader-text")||S.classList.add("screen-reader-text");let C=document.getElementById(T.popoverId);if(!C){C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",n(S)&&C.classList.add("aipkit_settings_select_picker_popover--provider"),C.id=T.popoverId,C.setAttribute("aria-hidden","true");let b=document.createElement("div");b.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",b.setAttribute("role","dialog"),b.setAttribute("aria-labelledby",T.titleId);let L=document.createElement("div");L.className="aipkit_model_settings_popover_header";let B=document.createElement("span");B.className="aipkit_model_settings_popover_title",B.id=T.titleId,B.textContent=e(S)||k("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',L.appendChild(B),L.appendChild($);let W=document.createElement("div");W.className="aipkit_model_settings_popover_body";let U=document.createElement("div");U.className="aipkit_settings_select_picker_search";let D=document.createElement("input");D.type="search",D.id=T.searchId,D.className="aipkit_form-input";let H=e(S),Q=H?`Search ${H.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");D.setAttribute("placeholder",Q),U.appendChild(D);let F=document.createElement("div");F.className="aipkit_settings_select_picker_list",F.id=T.listId,F.setAttribute("role","listbox"),W.appendChild(U),W.appendChild(F),b.appendChild(L),b.appendChild(W),C.appendChild(b),v.appendChild(C),(n(S)||c(S))&&(U.style.display="none")}return{ids:T,button:A,popover:C,label:document.getElementById(T.labelId),search:document.getElementById(T.searchId),list:document.getElementById(T.listId)}},u=S=>{let T=[];return S&&Array.from(S.children).forEach(A=>{if(A.tagName==="OPTGROUP"){let C=Array.from(A.children).filter(b=>b.tagName==="OPTION").map(b=>({value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}));T.push({groupLabel:A.label||"",options:C})}else A.tagName==="OPTION"&&T.push({groupLabel:"",options:[{value:A.value,label:A.textContent.trim(),disabled:A.disabled,selected:A.selected}]})}),T},f=(S,T,v="")=>{if(!S||!T)return;let A=v.trim().toLowerCase();if(T.innerHTML="",c(S)){let L=Array.from(S.options).map(H=>({value:H.value,label:H.textContent.trim(),disabled:H.disabled,selected:H.selected})),B=H=>H.disabled&&H.value===""&&/^-+$/.test(H.label.replace(/\s+/g,"")),$=L.filter(H=>H.value==="__new__"),W=L.filter(H=>H.value!=="__new__"&&!B(H)),U=A?W.filter(H=>H.label.toLowerCase().includes(A)):W,D=H=>{let Q=document.createElement("button");Q.type="button",Q.className="aipkit_settings_select_picker_item",Q.setAttribute("role","option"),Q.dataset.value=H.value,Q.dataset.label=H.label,H.disabled&&(Q.classList.add("is-disabled"),Q.setAttribute("aria-disabled","true")),S.value===H.value?(Q.classList.add("is-active"),Q.setAttribute("aria-selected","true")):Q.setAttribute("aria-selected","false");let F=document.createElement("span");F.className="aipkit_settings_select_picker_text",F.textContent=H.label;let P=document.createElement("span");P.className="dashicons dashicons-yes aipkit_settings_select_picker_check",Q.appendChild(F),Q.appendChild(P),T.appendChild(Q)};if($.forEach(D),U.forEach(D),!$.length&&!U.length){let H=document.createElement("div");H.className="aipkit_settings_select_picker_empty",H.textContent=k(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),T.appendChild(H)}return}let C=u(S),b=!1;if(C.forEach(L=>{let B=L.options.filter($=>A?$.label.toLowerCase().includes(A):!0);if(B.length){if(L.groupLabel){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=L.groupLabel,T.appendChild($)}B.forEach($=>{let W=document.createElement("button");if(W.type="button",W.className="aipkit_settings_select_picker_item",W.setAttribute("role","option"),W.dataset.value=$.value,W.dataset.label=$.label,$.disabled&&(W.classList.add("is-disabled"),W.setAttribute("aria-disabled","true")),S.value===$.value?(W.classList.add("is-active"),W.setAttribute("aria-selected","true")):W.setAttribute("aria-selected","false"),n(S)){W.classList.add("aipkit_settings_select_picker_item--provider");let H=document.createElement("span");H.className="aipkit_settings_select_picker_icon",H.setAttribute("aria-hidden","true"),o(H,$.value),W.appendChild(H)}let U=document.createElement("span");U.className="aipkit_settings_select_picker_text",U.textContent=$.label;let D=document.createElement("span");D.className="dashicons dashicons-yes aipkit_settings_select_picker_check",W.appendChild(U),W.appendChild(D),T.appendChild(W),b=!0})}}),!b){let L=document.createElement("div");L.className="aipkit_settings_select_picker_empty",L.textContent=k(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),T.appendChild(L)}},m=(S,T)=>{if(!S||!T)return;let v=t(S);if(T.textContent=v||k("Select","gpt3-ai-content-generator"),n(S)){let A=T.closest("button"),C=A?A.querySelector(".aipkit_settings_select_picker_icon"):null;o(C,S.value)}},g=(S,T)=>{if(!S||!T)return;let v=S.getBoundingClientRect(),A=T.getBoundingClientRect(),C=A.width||320,b=A.height||0,L=window.innerWidth,B=window.innerHeight,$=12,W=v.left;W+C>L-$&&(W=v.right-C),W=Math.max($,Math.min(W,L-C-$));let U=v.bottom+8;U+b>B-$&&(U=v.top-b-8),U=Math.max($,Math.min(U,B-b-$)),T.style.left=`${Math.round(W)}px`,T.style.top=`${Math.round(U)}px`},_=()=>{!r||!i||s||(s=!0,window.requestAnimationFrame(()=>{let S=r.querySelector(".aipkit_model_settings_popover_panel");g(i,S),s=!1}))},h=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},y=(S,T,v)=>{if(!S||!T)return;r&&r!==T&&h(),r=T,i=S,T.classList.add("aipkit-active"),T.setAttribute("aria-hidden","false"),S.setAttribute("aria-expanded","true");let A=T.querySelector(".aipkit_settings_select_picker_search input"),C=T.querySelector(".aipkit_settings_select_picker_list");C&&f(v,C,A?A.value:""),A&&A.offsetParent!==null&&(A.focus(),A.select());let b=T.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{g(S,b)})},E=(S,T)=>{if(!S||!T)return;let{button:v,popover:A,list:C,search:b}=T;if(v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("click",L=>{if(L.preventDefault(),r===A){h();return}y(v,A,S)}),v.dataset.pickerListenerAttached="true"),A&&A.dataset.overlayListenerAttached!=="true"){A.addEventListener("click",B=>{B.target===A&&h()});let L=A.querySelector(".aipkit_model_settings_popover_close");L&&L.addEventListener("click",B=>{B.preventDefault(),h()}),A.dataset.overlayListenerAttached="true"}if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",L=>{let B=L.target.closest(".aipkit_settings_select_picker_item");if(!B||B.classList.contains("is-disabled"))return;let $=B.dataset.value??"";S.value=$,S.dispatchEvent(new Event("change",{bubbles:!0})),m(S,T.label),f(S,C,b?b.value:""),h()}),C.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("input",()=>{f(S,C,b.value)}),b.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("change",()=>{m(S,T.label),f(S,C,b?b.value:""),r===A&&h()}),S.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerObserverAttached!=="true"){let L=!1;new MutationObserver(()=>{L||(L=!0,window.requestAnimationFrame(()=>{m(S,T.label),f(S,C,b?b.value:""),L=!1}))}).observe(S,{childList:!0,subtree:!0}),S.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitChatPickerEscapeBound||(document.addEventListener("keydown",L=>{L.key==="Escape"&&r&&h()}),document.body.dataset.aipkitChatPickerEscapeBound="true"),document.body.dataset.aipkitChatPickerRepositionBound||(window.addEventListener("resize",_),window.addEventListener("scroll",_,!0),document.body.dataset.aipkitChatPickerRepositionBound="true")};function x(){let S=document.querySelector(".aipkit_chatbot_builder");if(!S)return;let T=S.querySelectorAll(a);T.length&&T.forEach(v=>{if(!v.id||v.dataset.aipkitPickerInit==="true")return;let A=d(v);A&&(m(v,A.label),f(v,A.list,A.search?A.search.value:""),E(v,A),v.dataset.aipkitPickerInit="true")})}function w(){let S=document.querySelector(".aipkit_chatbot_builder");if(!S)return;S.querySelectorAll(a).forEach(v=>{if(!v.id)return;let A=d(v);A&&(m(v,A.label),f(v,A.list,A.search?A.search.value:""),E(v,A),v.dataset.aipkitPickerInit="true")})}window.aipkit_initChatSelectPickers=x,window.aipkit_refreshChatSelectPickers=w})();(function(){"use strict";let k={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"};function a(i){let s=k[i];if(!s)return!0;let n=window.aipkit_dashboard?.providerStatus?.[s];return typeof n>"u"?!0:!!n}function r(i,s={}){return i?typeof window.aipkit_queueProviderSync!="function"?(console.warn("AIPKit Chatbot Sync: aipkit_queueProviderSync is not available."),!1):a(i)?(window.aipkit_queueProviderSync(i,s),!0):!1:!1}window.aipkit_requestChatbotModelSync=r})();(function(){"use strict";function k(r,i,s){let n=document.getElementById(r);if(!n)return;if(n.innerHTML="",!i||i.length===0){n.appendChild(new Option("(No voices found - Sync again)",""));return}n.appendChild(new Option("-- Select Voice --",""));let c={};i.forEach(o=>{let e=o.languageCodes[0]||"und";c[e]||(c[e]=[]),c[e].push(o)}),Object.keys(c).sort().forEach(o=>{let e=document.createElement("optgroup");try{let t=new Intl.DisplayNames(["en"],{type:"language"}).of(o.split("-")[0]);e.label=`${t} (${o})`}catch{e.label=o}c[o].sort((t,p)=>t.name.localeCompare(p.name)),c[o].forEach(t=>{let p=new Option(t.name,t.id);t.id===s&&(p.selected=!0),e.appendChild(p)}),n.appendChild(e)}),s&&!n.value&&(Array.from(n.options).some(e=>e.value===s)?n.value=s:console.warn(`AIPKit TTS: Saved Google voice ID "${s}" not found in synced list for ${r}.`))}function a(r){let i=r.getAttribute("data-target-select"),s=r.querySelector(".aipkit_spinner"),n=r.closest(".aipkit_popover_audio_flyout"),c=n?n.querySelector(".aipkit_tts_sync_status"):null;if(!c){let t=r.closest(".aipkit_popover_option_row");c=t?t.querySelector(".aipkit_tts_sync_status"):null}if(!c){let t=r.closest(".aipkit_form-group");c=t?t.querySelector(".aipkit_form-help"):null}if(!i){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(c||console.error("AIPKit TTS Sync (Google): Could not find message container for button:",r),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}let l=c&&c.classList.contains("aipkit_popover_status_inline"),o=(t,p)=>{!c||!l||(c.textContent=t||"",c.classList.remove("success","error","loading"),p&&c.classList.add(p),c.style.display=t?"inline-block":"none")};if(r.disabled=!0,r.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),c){let t=c.dataset.baseClass||c.className||"aipkit_form-help";c.dataset.baseClass||(c.dataset.baseClass=t),c.textContent="",c.className=t,c.style.display=t.includes("aipkit_popover_status_inline")?"none":""}l&&o("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(t=>{if(t&&t.voices){let p=document.getElementById(i),d=p?p.value:"";k(i,t.voices,d);let u=document.getElementById("aipkit_google_tts_voices_json_main");u&&(u.dataset.voices=JSON.stringify(t.voices)),c&&(l?o(t.message||"Sync successful!","success"):window.aipkit_showTemporaryMessage(c,"success",t.message||"Sync successful!"))}else throw new Error("Invalid response received from voice sync.")}).catch(t=>{console.error("AIPKit TTS Sync Error (Google):",t),c&&(l?o(`Sync failed: ${t.message||"Unknown error"}`,"error"):window.aipkit_showTemporaryMessage(c,"error",`Sync failed: ${t.message||"Unknown error"}`))}).finally(()=>{r.disabled=!1,r.classList.remove("aipkit_loading"),s&&(s.style.display="none")})}window.aipkit_updateGoogleVoiceSelect=k,window.aipkit_handleSyncGoogleVoices=a})();(function(){"use strict";function k(r,i,s){let n=document.getElementById(r);if(!n){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${r} not found.`);return}if(n.innerHTML="",!i||i.length===0){if(n.appendChild(new Option("(No voices found - Sync voices to load)","")),s){let l=new Option(s+" (manual/not synced)",s,!1,!0);n.appendChild(l),n.value=s}return}n.appendChild(new Option("-- Select Voice --","")),i.sort((l,o)=>(l.name||l.id||"").localeCompare(o.name||o.id||""));let c=!1;if(i.forEach(l=>{let o=new Option(l.name,l.id);l.id===s&&(o.selected=!0,c=!0),n.appendChild(o)}),s&&!c){let l=!1;for(let o=0;o<n.options.length;o++)if(n.options[o].value===s){l=!0,n.value=s;break}if(!l){let o=new Option(s+" (manual/not synced)",s,!1,!0);n.appendChild(o),n.value=s,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${s}" not found in synced list for #${r}, added as manual.`)}}else!s&&n.options.length>0&&(n.value="")}function a(r,i,s){let n=document.getElementById(r);if(!n){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${r} not found.`);return}if(n.innerHTML="",!i||i.length===0){if(n.appendChild(new Option("(No models found - Sync models to load)","")),s){let l=new Option(s+" (manual/not synced)",s,!1,!0);n.appendChild(l),n.value=s}return}n.appendChild(new Option("-- Select Model --","")),i.sort((l,o)=>(l.name||l.id||"").localeCompare(o.name||o.id||""));let c=!1;if(i.forEach(l=>{let o=l.id||"",e=l.name||o;if(!o)return;let t=new Option(e,o);o===s&&(t.selected=!0,c=!0),n.appendChild(t)}),s&&!c){let l=!1;for(let o=0;o<n.options.length;o++)if(n.options[o].value===s){l=!0,n.value=s;break}if(!l){let o=new Option(s+" (manual/not synced)",s,!1,!0);n.appendChild(o),n.value=s,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${s}" not found in synced list for #${r}, added as manual.`)}}else!s&&n.options.length>0&&(n.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=k,window.aipkit_chatTts_updateElevenLabsModelsSelect=a})();(function(){"use strict";function k(i,s){let n=i.querySelector(".aipkit_tts_conditional_settings"),c=i.querySelector(".aipkit_tts_auto_play_container");n&&(n.style.display=s?"block":"none"),c&&(c.style.display=s?"block":"none")}function a(i){let s=i.querySelector(".aipkit_tts_provider_select");if(!s)return;let n=s.value;i.querySelectorAll(".aipkit_tts_provider_settings").forEach(l=>{if(l.getAttribute("data-provider")===n){if(l.style.display="block",n==="OpenAI"){let o=l.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');o&&(o.style.display="block")}}else l.style.display="none"})}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit TTS Settings: Main content container not found.");return}let s=typeof window.aipkit_updateGoogleVoiceSelect=="function",n=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",c=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",l=typeof window.aipkit_handleSyncGoogleVoices=="function";s||console.error("AIPKit TTS Settings: Google voice update function missing."),n||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),c||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),l||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),i.addEventListener("change",function(e){let t=e.target.closest(".aipkit_tts_toggle_switch"),p=e.target.closest(".aipkit_tts_provider_select");if(t){let d=t.closest(".aipkit_accordion-content");d&&(k(d,t.checked),t.checked&&a(d))}else if(p){let d=p.closest(".aipkit_accordion-content");d&&a(d)}}),i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_sync_tts_voices_btn");t&&t.getAttribute("data-provider")==="Google"&&l&&window.aipkit_handleSyncGoogleVoices(t)}),i.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(e=>{let t=e.querySelector(".aipkit_tts_toggle_switch");t&&(k(e,t.checked),t.checked&&a(e));let p=e.querySelector('select[name="tts_google_voice_id"]');p&&!s&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync voices to load)</option>');let d=e.querySelector('select[name="tts_elevenlabs_voice_id"]');if(d&&n){let m="";if(d&&d.id){let h=d.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);h&&h[1]&&(m=h[1])}let g=m?document.getElementById(`aipkit_elevenlabs_voices_json_${m}`):null,_=g?g.dataset.voices:null;try{let h=_?JSON.parse(_):[],y=d.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(d.id,h,y)}catch(h){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",h),d.options.length<=1&&(d.innerHTML='<option value="">(Sync voices to load)</option>')}}else d&&d.options.length<=1&&(d.innerHTML='<option value="">(Sync voices to load)</option>');let u=e.querySelector('select[name="tts_elevenlabs_model_id"]');if(u&&c){let m="";if(u&&u.id){let h=u.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);h&&h[1]&&(m=h[1])}let g=m?document.getElementById(`aipkit_elevenlabs_models_json_${m}`):null,_=g?g.dataset.models:null;try{let h=_?JSON.parse(_):[],y=u.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(u.id,h,y)}catch(h){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",h),u.options.length<=1&&(u.innerHTML='<option value="">(Sync models to load)</option>')}}else u&&u.options.length<=1&&(u.innerHTML='<option value="">(Sync models to load)</option>');let f=e.querySelector('select[name="tts_openai_model_id"]');f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync models to load)</option>')})}window.aipkit_initTtsSettingsUI=r})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}a.addEventListener("submit",function(r){let i=r.target.closest(".aipkit_chatbot_settings_form");if(!i)return;r.preventDefault();let s=i.getAttribute("data-bot-id"),n=i.querySelector(".aipkit_save_bot_settings_btn");n||(n=document.getElementById("aipkit_chatbot_header_save_btn"));let c=document.getElementById("aipkit_chatbot_global_save_status_container"),l=i.querySelector(`#aipkit_action_feedback_${s}`);if(!s||!n||!c){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",i),c||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}l&&(l.innerHTML=""),c.textContent="",c.className="aipkit_save_status_container",n.disabled=!0,n.classList.add("aipkit_loading");let o=n.querySelector(".aipkit_spinner");o||(o=document.createElement("span"),o.className="aipkit_spinner",n.appendChild(o)),o.style.display="inline-block";let e=new FormData(i),t={};for(let[d,u]of e.entries())if(d.endsWith("[]")){let f=d.slice(0,-2);t[f]=e.getAll(d)}else t.hasOwnProperty(d)||(t[d]=u);t.bot_id=s,function(){let u=document.getElementById(`aipkit_bot_${s}_custom_theme_settings_container`);if(!u)return;u.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["], textarea[name^="custom_theme_settings["]').forEach(m=>{let g=m.getAttribute("name");if(!g)return;let _=!0;(m.type==="checkbox"||m.type==="radio")&&(_=m.checked),_?t[g]=m.value:m.type==="checkbox"&&(t[g]="0")})}(),function(){let u=document.getElementById(`aipkit_bot_${s}_ai_params_modal`);if(!u)return;let f=u.querySelector(".aipkit_modal_body")||u;["temperature","max_completion_tokens","reasoning_effort"].forEach(g=>{let _=f.querySelector(`[name="${g}"]`);_&&(t[g]=_.value)})}(),function(){let u=document.getElementById(`aipkit_bot_${s}_web_settings_modal`);if(!u)return;let f=u.querySelector(".aipkit_modal_body")||u,m=g=>f.querySelector(`[name="${g}"]`);["openai_web_search_context_size","openai_web_search_loc_type","openai_web_search_loc_country","openai_web_search_loc_city","openai_web_search_loc_region","openai_web_search_loc_timezone"].forEach(g=>{let _=m(g);_&&(t[g]=_.value)}),["google_grounding_mode","google_grounding_dynamic_threshold"].forEach(g=>{let _=m(g);_&&(t[g]=_.value)}),["claude_web_search_max_uses","claude_web_search_loc_type","claude_web_search_loc_country","claude_web_search_loc_city","claude_web_search_loc_region","claude_web_search_loc_timezone","claude_web_search_allowed_domains","claude_web_search_blocked_domains","claude_web_search_cache_ttl"].forEach(g=>{let _=m(g);_&&(t[g]=_.value)})}(),function(){let u=document.getElementById(`aipkit_bot_${s}_vector_store_modal`);if(!u)return;let f=x=>u.querySelector(x),m=u.querySelector(".aipkit_modal_body")||u,g=m.querySelector('input[name="enable_vector_store"]');g&&(t.enable_vector_store=g.checked?"1":"0");let _=f('select[name="vector_store_provider"]');if(_&&(t.vector_store_provider=_.value),t.vector_store_provider==="openai"){let x=f('select[name="openai_vector_store_ids[]"]');x?t.openai_vector_store_ids=Array.from(x.selectedOptions).map(w=>w.value):t.openai_vector_store_ids=[]}else delete t.openai_vector_store_ids;if(t.vector_store_provider==="pinecone"){let x=f('select[name="pinecone_index_name"]');x&&(t.pinecone_index_name=x.value)}else delete t.pinecone_index_name;if(t.vector_store_provider==="qdrant"){let x=f('select[name="qdrant_collection_names[]"]');if(x){let w=Array.from(x.selectedOptions).map(S=>S.value);t.qdrant_collection_names=w,t.qdrant_collection_name=w[0]||""}else t.qdrant_collection_names=[],t.qdrant_collection_name=""}else delete t.qdrant_collection_names,delete t.qdrant_collection_name;if(t.vector_store_provider==="pinecone"||t.vector_store_provider==="qdrant"){let x=f('select[name="vector_embedding_provider"]'),w=f('select[name="vector_embedding_model"]');x&&(t.vector_embedding_provider=x.value),w&&(t.vector_embedding_model=w.value)}else delete t.vector_embedding_provider,delete t.vector_embedding_model;let h=f('input[name="vector_store_top_k"]');h&&(t.vector_store_top_k=h.value);let y=f('input[name="vector_store_confidence_threshold"]');y&&(t.vector_store_confidence_threshold=y.value);let E=m.querySelector('input[name="content_aware_enabled"]');E&&(t.content_aware_enabled=E.checked?"1":"0")}(),function(){let u=document.getElementById(`aipkit_bot_${s}_conversations_modal`);if(!u)return;let f=u.querySelector(".aipkit_modal_body")||u,m=f.querySelector('input[name="stream_enabled"]');m&&(t.stream_enabled=m.checked?"1":"0");let g=f.querySelector('input[name="openai_conversation_state_enabled"]');g&&(t.openai_conversation_state_enabled=g.checked?"1":"0");let _=f.querySelector('input[name="max_messages"]');_&&(t.max_messages=_.value);let h=f.querySelector('select[name="reasoning_effort"]');h&&(t.reasoning_effort=h.value)}(),function(){let u=document.getElementById(`aipkit_bot_${s}_images_modal`);if(!u)return;let f=u.querySelector(".aipkit_modal_body")||u,m=f.querySelector('select[name="chat_image_model_id"]'),g=f.querySelector('input[name="image_triggers"]');m&&(t.chat_image_model_id=m.value),g&&(t.image_triggers=g.value);let _=f.querySelector('input[name="enable_image_upload"]');_&&(t.enable_image_upload=_.checked?"1":"0")}(),function(){let u=document.getElementById(`aipkit_bot_${s}_audio_settings_modal`);if(!u)return;let f=u.querySelector(".aipkit_modal_body")||u,m=h=>f.querySelector(`[name="${h}"]`);function g(h){let y=m(h);y&&(t[h]=y.checked?"1":"0")}function _(h){let y=m(h);y&&(t[h]=y.value)}g("enable_voice_input"),_("stt_provider"),_("stt_openai_model_id"),g("tts_enabled"),_("tts_provider"),_("tts_google_voice_id"),_("tts_openai_voice_id"),_("tts_openai_model_id"),_("tts_elevenlabs_voice_id"),_("tts_elevenlabs_model_id"),g("tts_auto_play"),g("enable_realtime_voice"),g("direct_voice_mode"),g("input_audio_noise_reduction"),_("realtime_model"),_("realtime_voice"),_("turn_detection"),_("input_audio_format"),_("output_audio_format"),_("speed")}(),function(){let u=document.getElementById(`aipkit_bot_${s}_token_mgmt_modal`);if(!u)return;let f=u.querySelector(".aipkit_modal_body")||u,m=f.querySelector('input[name="token_guest_limit"]'),g=f.querySelector('input[name="token_user_limit"]'),_=f.querySelector('select[name="token_limit_mode"]'),h=f.querySelector('select[name="token_reset_period"]'),y=f.querySelector('input[name="token_limit_message"]');m&&(t.token_guest_limit=m.value),g&&(t.token_user_limit=g.value),_&&(t.token_limit_mode=_.value),h&&(t.token_reset_period=h.value),y&&(t.token_limit_message=y.value),f.querySelectorAll('input[name^="token_role_limits["]').forEach(x=>{let w=x.getAttribute("name");w&&(t[w]=x.value)})}(),function(){let u=document.getElementById("aipkit_starters_flyout");if(!u)return;let f=u.querySelector('textarea[name="conversation_starters"]');f&&(t.conversation_starters=f.value)}(),function(){let u=document.getElementById(`aipkit_bot_${s}_popup_settings_modal`);if(!u)return;let f=u.querySelector(".aipkit_modal_body")||u;function m(N){return f.querySelector(`[name="${N}"]`)}function g(N){return f.querySelector(`[name="${N}"]:checked`)}function _(N,ie){typeof ie<"u"&&ie!==null&&(t[N]=ie)}let h=m("popup_position");h&&_("popup_position",h.value);let y=m("popup_delay");y&&_("popup_delay",y.value);let E=m("site_wide_enabled");E&&_("site_wide_enabled",E.checked?"1":"0");let x=m("popup_icon_style");if(x)_("popup_icon_style",x.value);else{let N=g("popup_icon_style");N&&_("popup_icon_style",N.value)}let w=m("popup_icon_size");w&&_("popup_icon_size",w.value);let S=m("popup_icon_type");if(S)_("popup_icon_type",S.value);else{let N=g("popup_icon_type");N&&_("popup_icon_type",N.value)}let T=g("popup_icon_default");T&&_("popup_icon_default",T.value);let v=m("popup_icon_custom_url");v&&_("popup_icon_custom_url",v.value);let A=m("header_avatar_type");if(A)_("header_avatar_type",A.value);else{let N=g("header_avatar_type");N&&_("header_avatar_type",N.value)}let C=g("header_avatar_default");C&&_("header_avatar_default",C.value);let b=m("header_avatar_url");b&&_("header_avatar_url",b.value);let L=m("header_online_text");L&&_("header_online_text",L.value);let B=m("popup_label_enabled");B&&_("popup_label_enabled",B.checked?"1":"0");let $=m("popup_label_text");$&&_("popup_label_text",$.value);let W=m("popup_label_mode");W&&_("popup_label_mode",W.value);let U=m("popup_label_size");U&&_("popup_label_size",U.value);let D=m("popup_label_delay_seconds");D&&_("popup_label_delay_seconds",D.value);let H=m("popup_label_auto_hide_seconds");H&&_("popup_label_auto_hide_seconds",H.value);let Q=m("popup_label_dismissible");Q&&_("popup_label_dismissible",Q.checked?"1":"0");let F=m("popup_label_show_on_desktop");F&&_("popup_label_show_on_desktop",F.checked?"1":"0");let P=m("popup_label_show_on_mobile");P&&_("popup_label_show_on_mobile",P.checked?"1":"0");let R=m("popup_label_frequency");R&&_("popup_label_frequency",R.value);let O=m("popup_label_version");O&&_("popup_label_version",O.value)}();let p=t.provider;if(p==="OpenAI")t.model=t.openai_model;else if(p==="OpenRouter")t.model=t.openrouter_model;else if(p==="Google")t.model=t.google_model;else if(p==="Azure")t.model=t.azure_deployment;else if(p==="Claude")t.model=t.claude_model;else if(p==="DeepSeek")t.model=t.deepseek_model;else if(p==="Ollama"){let d=i.querySelector('select[name="ollama_model"]'),u=typeof t.ollama_model<"u"?t.ollama_model:d?d.value:"";t.model=u||""}else t.model="";delete t.openai_model,delete t.openrouter_model,delete t.google_model,delete t.azure_deployment,delete t.claude_model,delete t.deepseek_model,delete t.ollama_model,function(){let u=document.getElementById(`aipkit_bot_${s}_vector_store_modal`),f=g=>u?u.querySelector(g):null,m=g=>i.querySelector(g);if(t.vector_store_provider==="openai"){let g=f('select[name="openai_vector_store_ids[]"]')||m('select[name="openai_vector_store_ids[]"]');g?t.openai_vector_store_ids=Array.from(g.selectedOptions).map(_=>_.value):t.openai_vector_store_ids=[]}else t.hasOwnProperty("openai_vector_store_ids")&&delete t.openai_vector_store_ids;if(t.vector_store_provider==="pinecone"||t.vector_store_provider==="qdrant"){if(t.vector_store_provider==="qdrant"){let h=f('select[name="qdrant_collection_names[]"]')||m('select[name="qdrant_collection_names[]"]');if(h){let y=Array.from(h.selectedOptions).map(E=>E.value);t.qdrant_collection_names=y,t.qdrant_collection_name=y[0]||""}else t.qdrant_collection_names=[],t.qdrant_collection_name=""}else if(t.vector_store_provider==="pinecone"){let h=f('select[name="pinecone_index_name"]')||m('select[name="pinecone_index_name"]');h&&(t.pinecone_index_name=h.value)}let g=f('select[name="vector_embedding_provider"]')||m('select[name="vector_embedding_provider"]');g&&(t.vector_embedding_provider=g.value);let _=f('select[name="vector_embedding_model"]')||m('select[name="vector_embedding_model"]');_&&(t.vector_embedding_model=_.value)}else delete t.pinecone_index_name,delete t.qdrant_collection_name,delete t.qdrant_collection_names,delete t.vector_embedding_provider,delete t.vector_embedding_model}(),aipkit_apiRequest("aipkit_save_chatbot_settings",t).then(d=>{c.textContent=d.message||"Settings Saved!",c.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(s)}).catch(d=>{c.textContent="Error: "+d.message,c.classList.add("error")}).finally(()=>{n.disabled=!1,n.classList.remove("aipkit_loading");let d=n.querySelector(".aipkit_spinner");if(d&&(d.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(n,"Save");else{let u=Array.from(n.childNodes).find(f=>f.nodeType===Node.TEXT_NODE);u?u.textContent="Save":n.insertBefore(document.createTextNode("Save"),n.firstChild),d&&n.appendChild(d)}setTimeout(()=>{c&&(c.textContent="",c.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Deleter: Main content container not found."),i&&i.querySelectorAll(".aipkit_delete_bot_btn").forEach(n=>{n.getAttribute("data-is-default")==="1"&&(n.disabled=!0)}),i&&i.addEventListener("click",function(n){let c=n.target.closest(".aipkit_delete_bot_btn");if(!c||c.disabled)return;let l=c.getAttribute("data-bot-id"),o=c.getAttribute("data-bot-name"),e=c.closest(".aipkit_chatbot_settings_form"),p=document.getElementById("aipkit_header_action_feedback")||(e?e.querySelector(`#aipkit_action_feedback_${l}`):null),d=document.getElementById("aipkit_chatbot_global_save_status_container");if(!l||!p){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",c);return}let u=`aipkit_delete_confirmation_${l}`,f=p.querySelector(`#${u}`);f||(f=document.createElement("div"),f.id=u,f.className="aipkit_confirmation_message aipkit_delete_confirmation",f.style.display="none",p.insertBefore(f,p.firstChild));let m=`aipkit_action_status_${l}`,g=p.querySelector(`#${m}`);if(g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",p.appendChild(g)),f.style.display!=="none"&&f.innerHTML!=="")return;d&&(d.textContent="",d.className="aipkit_save_status_container");let _=p.querySelector(".aipkit_reset_confirmation");_&&(_.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let h=f.querySelector(".aipkit_delete_confirm_btn"),y=f.querySelector(".aipkit_delete_cancel_btn"),E=()=>{f.innerHTML="",f.style.display="none",a(c,l,g,d)},x=()=>{f.innerHTML="",f.style.display="none"};h.addEventListener("click",E,{once:!0}),y.addEventListener("click",x,{once:!0})});let s=document.querySelector(".aipkit_chatbot_module_container");s&&s.addEventListener("click",function(n){let c=n.target.closest(".aipkit_header_delete_btn");if(!c)return;let l=c.closest(".aipkit_tab_dropdown_menu");l&&(l.style.display="none");let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),e=o?.dataset?.botId,t=o?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",d=document.getElementById("aipkit_header_action_feedback")||(o?o.querySelector(`#aipkit_action_feedback_${e}`):null),u=document.getElementById("aipkit_chatbot_global_save_status_container");if(!e||!d)return;if(t){d.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{d.innerHTML=""},3e3);return}let f=`aipkit_delete_confirmation_${e}`,m=d.querySelector(`#${f}`);m||(m=document.createElement("div"),m.id=f,m.className="aipkit_confirmation_message aipkit_delete_confirmation",m.style.display="none",d.insertBefore(m,d.firstChild));let g=`aipkit_action_status_${e}`,_=d.querySelector(`#${g}`);_||(_=document.createElement("div"),_.id=g,_.className="aipkit_action_status_message",d.appendChild(_)),u&&(u.textContent="",u.className="aipkit_save_status_container");let h=d.querySelector(".aipkit_reset_confirmation");h&&(h.style.display="none"),_.textContent="",_.className="aipkit_action_status_message",m.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
          </div>`,m.style.display="block";let y=m.querySelector(".aipkit_delete_confirm_btn"),E=m.querySelector(".aipkit_delete_cancel_btn");y?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none",a(c,e,_,u)},{once:!0}),E?.addEventListener("click",()=>{m.innerHTML="",m.style.display="none"},{once:!0})})}function a(i,s,n,c){let l=i.querySelector(".aipkit_spinner"),o=document.getElementById("aipkit_chatbot_main_selector_container");c&&(c.textContent="",c.className="aipkit_save_status_container"),n.textContent="",n.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),l&&(l.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Deleting..."):i.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:s}).then(e=>{n.textContent=e.message||"Chatbot deleted successfully.",n.classList.add("success");let t=!1;if(o){let d=o.querySelector(`.aipkit_tab_button[data-bot-id="${s}"]`),u=o.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${s}"]`);if(d)t=d.classList.contains("aipkit_active"),d.remove();else if(u){t=u.classList.contains("aipkit_active"),u.remove();let f=o.querySelector(".aipkit_tab_dropdown_menu");if(f&&f.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let g=f.closest(".aipkit_tab_dropdown_container");g&&g.remove()}}}let p=document.getElementById(`chatbot-${s}-content`);if(p&&p.remove(),setTimeout(()=>{let d=document.getElementById(`aipkit_action_status_${s}`);d&&(d.textContent="",d.className="aipkit_action_status_message")},4e3),t){let d=o?.querySelector(".aipkit_tab_button_default");if(d)d.click();else{let u=o?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(u)u.click();else{let f=o?.querySelector(".aipkit_tab_dropdown_item");if(f)f.click();else{let m=o?.querySelector(".aipkit_create-new-button");if(m)m.click();else{let g=document.getElementById("aipkit_admin_chat_preview_container");g&&(g.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(e=>{n.textContent="Error: "+(e.message||"Failed to delete chatbot."),n.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),l&&(l.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Delete"),setTimeout(()=>{n&&(n.textContent="",n.className="aipkit_action_status_message")},5e3)})}function r(i){if(!i)return"";let s=document.createElement("div");return s.textContent=i,s.innerHTML}window.aipkit_initDeleteBot=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Resetter: Main content container not found."),i&&i.addEventListener("click",function(n){let c=n.target.closest(".aipkit_reset_bot_btn");if(!c||c.disabled)return;let l=c.getAttribute("data-bot-id"),o=c.getAttribute("data-bot-name"),e=c.closest(".aipkit_chatbot_settings_form"),p=document.getElementById("aipkit_header_action_feedback")||(e?e.querySelector(`#aipkit_action_feedback_${l}`):null),d=document.getElementById("aipkit_chatbot_global_save_status_container");if(!l||!p){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",c);return}let u=`aipkit_reset_confirmation_${l}`,f=p.querySelector(`#${u}`);f||(f=document.createElement("div"),f.id=u,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",p.insertBefore(f,p.firstChild));let m=`aipkit_action_status_${l}`,g=p.querySelector(`#${m}`);if(g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",p.appendChild(g)),f.style.display!=="none"&&f.innerHTML!=="")return;d&&(d.textContent="",d.className="aipkit_save_status_container");let _=p.querySelector(".aipkit_delete_confirmation");_&&(_.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let h=f.querySelector(".aipkit_reset_confirm_btn"),y=f.querySelector(".aipkit_reset_cancel_btn"),E=()=>{f.innerHTML="",f.style.display="none",a(c,l,g,d)},x=()=>{f.innerHTML="",f.style.display="none"};h.addEventListener("click",E,{once:!0}),y.addEventListener("click",x,{once:!0})});let s=document.querySelector(".aipkit_chatbot_module_container");s&&s.addEventListener("click",function(n){let c=n.target.closest(".aipkit_header_reset_btn");if(!c)return;let l=c.closest(".aipkit_tab_dropdown_menu");l&&(l.style.display="none");let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),e=o?.dataset?.botId,p=document.getElementById("aipkit_header_action_feedback")||(o?o.querySelector(`#aipkit_action_feedback_${e}`):null),d=document.getElementById("aipkit_chatbot_global_save_status_container");if(!e||!p)return;let u=`aipkit_reset_confirmation_${e}`,f=p.querySelector(`#${u}`);f||(f=document.createElement("div"),f.id=u,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",p.insertBefore(f,p.firstChild));let m=`aipkit_action_status_${e}`,g=p.querySelector(`#${m}`);g||(g=document.createElement("div"),g.id=m,g.className="aipkit_action_status_message",p.appendChild(g)),d&&(d.textContent="",d.className="aipkit_save_status_container");let _=p.querySelector(".aipkit_delete_confirmation");_&&(_.style.display="none"),g.textContent="",g.className="aipkit_action_status_message",f.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Reset</button>
          </div>`,f.style.display="block";let h=f.querySelector(".aipkit_reset_confirm_btn"),y=f.querySelector(".aipkit_reset_cancel_btn");h?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none",a(c,e,g,d)},{once:!0}),y?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none"},{once:!0})})}function a(i,s,n,c){let l=i.querySelector(".aipkit_spinner");c&&(c.textContent="",c.className="aipkit_save_status_container"),n.textContent="",n.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),l&&(l.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Resetting..."):i.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:s}).then(o=>{n.textContent=o.message||"Chatbot reset successfully!",n.classList.add("success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),aipkit_loadModule("chatbot",{force_active_bot_id:s,aipkit_force_refresh:!0},function(e){e&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",e),n.textContent="Reset OK, but UI refresh failed. Reload page.",n.classList.add("error"))}),setTimeout(()=>{let e=document.getElementById(`aipkit_action_status_${s}`);e&&(e.textContent="",e.className="aipkit_action_status_message")},4e3)}).catch(o=>{n.textContent="Error: "+(o.message||"Failed to reset chatbot."),n.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),l&&(l.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Reset"),setTimeout(()=>{n&&(n.textContent="",n.className="aipkit_action_status_message")},5e3)})}function r(i){if(!i)return"";let s=document.createElement("div");return s.textContent=i,s.innerHTML}window.aipkit_initResetBot=k})();(function(){"use strict";function r(n,c=5,l=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(n)}catch(o){console.error("AIPKit Chat Preview: Error during chat initialization.",o),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else c>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${l}ms... (${c} retries left)`),setTimeout(()=>{r(n,c-1,l)},l)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),n.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function i(){let n=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),c=document.getElementById("aipkit_admin_chat_preview_container"),l=document.querySelector(".aipkit_chatbot-preview-column"),o=window.aipkit_dashboard?.text||{};if(!c||!l){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(c.innerHTML="",l.classList.remove("aipkit_loading"),n){let e=n.getAttribute("data-tab-type"),t=n.getAttribute("data-bot-id");e==="bot"&&t?s(t):e==="create"?c.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:e==="settings"?c.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:c.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?c.innerHTML=`<p class="aipkit_preview_placeholder">${o.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:c.innerHTML=`<p class="aipkit_preview_placeholder">${o.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function s(n){let c=document.getElementById("aipkit_admin_chat_preview_container"),l=document.querySelector(".aipkit_chatbot-preview-column"),o=parseInt(n,10);if(!c||!l){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}if(!Number.isFinite(o)||o<=0){let f=window.aipkit_dashboard?.text||{};c.innerHTML=`<p class="aipkit_preview_placeholder">${f.previewPlaceholderSelect||"Select a chatbot to see the preview."}</p>`,l.classList.remove("aipkit_loading");return}let e=null,t=0,p=()=>{t=Date.now(),l.classList.add("aipkit_loading")},d=()=>{if(e&&(clearTimeout(e),e=null),!t){l.classList.remove("aipkit_loading");return}let m=240-(Date.now()-t);m>0?setTimeout(()=>{l.classList.remove("aipkit_loading")},m):l.classList.remove("aipkit_loading")};e=setTimeout(p,160),c.innerHTML="";let u=new URL(window.aipkit_dashboard.ajaxurl);u.searchParams.append("action","aipkit_get_chatbot_shortcode"),u.searchParams.append("bot_id",String(o)),u.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(u).then(f=>f.json()).then(f=>{if(f.success&&f.data&&f.data.html){c.innerHTML=f.data.html;let m=c.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");if(m){c.classList.toggle("aipkit-preview-inline",m.classList.contains("aipkit_chat_container")),c.classList.toggle("aipkit-preview-popup",m.classList.contains("aipkit_popup_wrapper"));let _=window.getComputedStyle(m).getPropertyValue("--aipkit-chat-container-border-radius").trim();_&&_!=="initial"&&_!=="inherit"&&_!=="unset"?c.style.setProperty("--aipkit-chat-container-border-radius",_):c.style.removeProperty("--aipkit-chat-container-border-radius"),r(m)}else console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${n} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,f.data.html),c.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>'}else{let m=f.data&&f.data.message?f.data.message:"Invalid response received for shortcode preview.";throw new Error(m)}}).catch(f=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${n}:`,f),c.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${f.message}</p>`}).finally(()=>{d()})}window.aipkit_loadInitialChatPreview=i,window.aipkit_refreshChatPreview=s})();(function(){"use strict";function k(){let c=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!c)return;let l=function(e){return e?e.tagName==="SELECT"?e.value==="1":!!e.checked:!1},o=function(e){let t=e.target.closest(".aipkit_popup_toggle_switch");if(t){let _=t.closest(".aipkit_chatbot-settings-area");if(_){a(_,t.checked),i(_,t);let h=_.querySelector(".aipkit_popup_config_btn_placeholder");h&&(h.disabled=!t.checked,h.title=t.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let p=e.target.closest('input[name="popup_icon_default"]');if(p){let _=p.closest(".aipkit_chatbot-settings-area");if(_){let h=p.value==="__custom__"?"custom":"default";r(_,h)}return}let d=e.target.closest('select[name="popup_icon_type"]');if(d){let _=d.closest(".aipkit_chatbot-settings-area");_&&r(_,d.value);return}let u=e.target.closest('input[name="popup_icon_type"]');if(u){let _=u.closest(".aipkit_chatbot-settings-area");_&&r(_,u.value);return}let f=e.target.closest(".aipkit_popup_hint_toggle_switch");if(f){let _=f.closest(".aipkit_chatbot-settings-area");_&&n(_,f.checked);return}let m=e.target.closest(".aipkit_starters_toggle_switch");if(m){let _=m.closest(".aipkit_chatbot-settings-area");if(_){let h=_.querySelector(".aipkit_starters_config_btn");if(h){let y=l(m);h.disabled=!y,h.title=y?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}}return}let g=e.target.closest(".aipkit_voice_input_toggle_switch");if(g){let _=g.closest(".aipkit_chatbot-settings-area");_&&s(_,g.checked);return}};c.addEventListener("change",o),c.querySelectorAll(".aipkit_chatbot-settings-area").forEach(e=>{let t=e.querySelector(".aipkit_popup_toggle_switch");if(t){a(e,t.checked),i(e,t);let g=e.querySelector(".aipkit_popup_config_btn_placeholder");g&&(g.disabled=!t.checked,g.title=t.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}let p=e.querySelector('input[name="popup_icon_default"]:checked');if(p){let g=p.value==="__custom__"?"custom":"default";r(e,g)}else{let g=e.querySelector('select[name="popup_icon_type"]');if(g)r(e,g.value);else{let _=e.querySelector('input[name="popup_icon_type"]:checked');_?r(e,_.value):r(e,"default")}}let d=e.querySelector(".aipkit_voice_input_toggle_switch");d&&s(e,d.checked);let u=e.querySelector(".aipkit_popup_hint_toggle_switch");u&&n(e,u.checked);let f=e.querySelector(".aipkit_starters_toggle_switch"),m=e.querySelector(".aipkit_starters_config_btn");if(m){let g=l(f);m.disabled=!g,m.title=g?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}})}function a(c,l){let o=c.querySelector(".aipkit_popup_settings_accordion");if(o&&(o.style.display=l?"block":"none",!l)){let t=o.querySelector(".aipkit_accordion-header"),p=o.querySelector(".aipkit_accordion-content");t&&t.classList.remove("aipkit_active"),p&&p.classList.remove("aipkit_active")}let e=c.querySelector(".aipkit_popup_icon_options_container");e&&(e.style.display=l?"block":"none")}function r(c,l){let o=c.querySelector(".aipkit_popup_icon_default_selector_container"),e=c.querySelector(".aipkit_popup_icon_custom_input_container"),t=!!c.querySelector(".aipkit_popup_icon_default_selector .aipkit_option_card--custom-url");o&&(o.style.display=t||l==="default"?"block":"none"),e&&(e.style.display=l==="custom"?"block":"none")}function i(c,l){let o=l.checked,e=l.getAttribute("data-sidebar-target"),t=c.querySelector("#"+e);if(!t)return;let p=t.querySelector(".aipkit_sidebar_toggle_switch"),d=t.querySelector("label");if(!p||!d)return;let u=t.getAttribute("data-tooltip-disabled")||"";o?(p.getAttribute("data-original-state")===null&&p.setAttribute("data-original-state",p.checked?"checked":"unchecked"),p.checked=!1,p.disabled=!0,t.setAttribute("title",u),t.classList.add("aipkit-disabled-tooltip"),d.style.opacity="0.6"):(p.disabled=!1,t.removeAttribute("title"),t.classList.remove("aipkit-disabled-tooltip"),d.style.opacity="1",p.getAttribute("data-original-state")==="checked"&&(p.checked=!0),p.removeAttribute("data-original-state"))}function s(c,l){let o=c.querySelector(".aipkit_stt_provider_conditional_row");o&&(o.style.display=l?"block":"none")}function n(c,l){let o=c.querySelector(".aipkit_popup_hint_conditional_row");o&&(o.style.display=l?"block":"none");let e=c.querySelectorAll(".aipkit_popup_hint_extra");e&&e.length&&e.forEach(t=>{t.style.display=l?"":"none"})}window.aipkit_initAppearanceToggles=k,window.aipkit_togglePopupDependentSettingsVisibility=a,window.aipkit_toggleSidebarCheckboxState=i,window.aipkit_togglePopupIconValueInputs=r,window.aipkit_toggleSttSettingsVisibility=s,window.aipkit_togglePopupHintSettingsVisibility=n})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!a)return;let r=function(i){return i?i.tagName==="SELECT"?i.value==="1":!!i.checked:!1};a.addEventListener("change",function(i){let s=i.target.closest(".aipkit_starters_toggle_switch");if(!s)return;let n=s.closest(".aipkit_chatbot-settings-area");if(!n)return;let c=n.querySelector(".aipkit_starters_conditional_row");c&&(c.style.display=r(s)?"block":"none")}),a.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{let s=i.querySelector(".aipkit_starters_toggle_switch"),n=i.querySelector(".aipkit_starters_conditional_row");s&&n&&(n.style.display=r(s)?"block":"none")})}window.aipkit_initConversationStartersToggle=k})();(function(){"use strict";let k="aipkit_last_selected_chatbot",a="aipkit_chatbotAccordionState",r="aipkit_last_open_chatbot_accordion",i=()=>{try{let e=localStorage.getItem(r);return typeof e=="string"?e:""}catch{return""}},s=()=>{if(window[a]&&typeof window[a]=="object"){let e=window[a].openSectionKey;if(typeof e=="string")return e}return i()},n=(e="")=>{let t=String(e||"").trim();(!window[a]||typeof window[a]!="object")&&(window[a]={}),window[a].openSectionKey=t;try{t?localStorage.setItem(r,t):localStorage.removeItem(r)}catch{}},c=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now();function l(e){let t=document.getElementById("aipkit_admin_chat_preview_container");if(!t)return;t.classList.remove("aipkit-preview-inline","aipkit-preview-popup");let p=document.createElement("p");p.className="aipkit_preview_placeholder",p.textContent=e,t.innerHTML="",t.appendChild(p)}function o(){let e=document.querySelector(".aipkit_chatbot_builder");if(!e||e.dataset.aipkitContext==="sources")return;document.documentElement.classList.add("aipkit-chatbot-builder-page");let t=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:q=>q,p=window.wp&&window.wp.i18n&&window.wp.i18n._n?window.wp.i18n._n:(q,I,M)=>M===1?q:I,d=window.wp&&window.wp.i18n&&window.wp.i18n.sprintf?window.wp.i18n.sprintf:(q,...I)=>{if(!q||!I.length)return q;let M=0;return String(q).replace(/%\d*\$?[sd]/g,()=>{let G=M<I.length?I[M]:"";return M+=1,String(G)})},u={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0},f=e.getAttribute("data-aipkit-chatbot-layout")||"next",m=e.dataset.openaiApiKeySet==="true",g=e.dataset.pineconeApiKeySet==="true",_=e.dataset.qdrantApiKeySet==="true",h=e.dataset.qdrantUrlSet==="true",y=e.dataset.googleApiKeySet==="true",E=e.dataset.azureApiKeySet==="true",x=e.dataset.claudeApiKeySet==="true",w=e.querySelector("#aipkit_chatbot_builder_bot_select"),S=e.getAttribute("data-active-bot-id")||w&&w.value||"",T=String(S||""),v=new Map,A=new Map,C=null,b=!1;if(S)try{localStorage.setItem(k,S)}catch{}let L=e.querySelector(".aipkit_builder_new_bot_btn"),B=e.querySelector("[data-aipkit-bot-tabs]"),$=e.querySelector(".aipkit_builder_bot_overflow"),W=e.querySelector(".aipkit_builder_bot_overflow_trigger"),U=e.querySelector(".aipkit_builder_bot_overflow_menu"),D=10,H=null,Q=null,F=document.getElementById("aipkit_builder_sheet"),P=F?F.querySelector(".aipkit_builder_sheet_panel"):null,R=document.getElementById("aipkit_model_settings_popover"),O=document.getElementById("aipkit_settings_accordion"),N=O||(R?R.querySelector(".aipkit_model_settings_popover_panel"):null),ie=R&&R.getAttribute("data-aipkit-mode")==="disabled",J=R?R.querySelector(".aipkit_model_settings_popover_close"):null,we=R?R.querySelector(".aipkit_model_settings_popover_title"):null,$e=R?R.querySelector(".aipkit_model_settings_popover_back"):null,Ke=R?R.querySelector(".aipkit_model_settings_popover_footer"):null,Ue=null,it="root",_t=F?F.querySelector(".aipkit_builder_sheet_title"):null,mt=F?F.querySelector(".aipkit_builder_sheet_description"):null,Ot=F?F.querySelector(".aipkit_builder_sheet_body"):null,Nt=F?F.querySelectorAll(".aipkit_builder_sheet_section"):[],qe=F?F.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'):null,qt=F?F.querySelector(".aipkit_builder_sheet_close"):null,Wt=e.querySelector(".aipkit_bot_name_input"),ui=e.querySelector("[data-aipkit-chatbot-summary]"),ae=e.querySelector("[data-aipkit-interface-summary]"),Ce=e.querySelector("[data-aipkit-context-summary]"),Ae=e.querySelector("[data-aipkit-behavior-summary]"),Oe=e.querySelector("[data-aipkit-tools-summary]"),Fe=e.querySelector("[data-aipkit-safety-summary]"),We=e.querySelector("[data-aipkit-limits-summary]"),je=e.querySelector("[data-aipkit-rules-summary]"),Qe=e.querySelector("[data-aipkit-popup-summary]"),xt=e.querySelector('textarea[name="instructions"]'),bi=e.querySelector(".aipkit_builder_instructions_expand"),gt=document.getElementById("aipkit_builder_instructions_modal"),It=gt?gt.querySelector(".aipkit_builder_instructions_close"):null,ze=gt?gt.querySelector(".aipkit_builder_instructions_modal_textarea"):null,Ye=gt?gt.querySelector(".aipkit_builder_instructions_count"):null,Ze=()=>{let q=e.querySelector(".aipkit_chatbot_provider_select");return q?q.value:""},ei=q=>{if(!q)return"";let I=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${q}"]`);if(!I)return"";let M=I.querySelector("select");return M&&M.value||""},ci=q=>{let I=String(q||"").toLowerCase();return I.indexOf("gpt-5")!==-1||I.indexOf("o1")!==-1||I.indexOf("o3")!==-1||I.indexOf("o4")!==-1},Jt=()=>{let q=Ze();return q!=="OpenAI"?!1:ci(ei(q))},Gt=q=>{if(!q)return"";let I=q.selectedOptions&&q.selectedOptions.length?q.selectedOptions[0]:q.options&&q.selectedIndex>=0&&q.selectedIndex<q.options.length?q.options[q.selectedIndex]:null;return I&&I.textContent?I.textContent.trim():""},Di=q=>!q||!q.selectedOptions?[]:Array.from(q.selectedOptions).map(I=>I&&I.textContent?I.textContent.trim():"").filter(Boolean),bt=q=>String(q||"").replace(/\s+\([^)]*\)\s*$/,"").trim(),di=()=>{let q=e.querySelector(".aipkit_vector_embedding_select"),I=Gt(q);if(!I){let M=e.querySelector('[name="vector_embedding_model"]');I=M?String(M.value||""):""}return bt(I)},Ht=()=>{if(!ui)return;let q=ui.dataset.defaultSummary||"Select engine and model",I=e.querySelector(".aipkit_chatbot_provider_select"),M=I&&I.value||"",G=Gt(I),z="";if(M){let K=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${M}"]`);if(K){let V=K.querySelector("select");z=Gt(V)}}let X=[];G&&X.push(G),z&&X.push(z);let te=X.length?X.join(" | "):q;ui.textContent=te,ui.setAttribute("title",te)},Wi=()=>{if(!Qe)return;let q=Qe.dataset.defaultSummary||"Popup settings",I=e.querySelector('select[name="popup_position"]'),M=e.querySelector('select[name="aipkit_deploy_popup_scope"]'),G=[],z=Gt(I),X=Gt(M);z&&G.push(z),X&&G.push(X);let te=G.length?G.join(" | "):q;Qe.textContent=te,Qe.setAttribute("title",te)},Sn=()=>{let q=e.querySelector('.aipkit_custom_theme_presets .aipkit_custom_theme_preset.is-selected, .aipkit_custom_theme_presets .aipkit_custom_theme_preset[aria-pressed="true"]');if(!q)return"";let I=q.querySelector(".aipkit_custom_theme_preset_label");return I&&I.textContent?I.textContent.trim():""},Ki=()=>{let q=e.querySelector('select[name="theme"]');if(q&&!q.disabled){if((q.value||"")==="custom"){let M=Sn();if(M)return M}return Gt(q)}let I=e.querySelector('input[name="theme"]:checked');if(I&&!I.disabled){if((I.value||"")==="custom"){let X=Sn();if(X)return X}let M=I.closest(".aipkit_theme_choice_card"),G=M?M.querySelector(".aipkit_theme_choice_label"):null,z=G&&G.textContent?G.textContent.trim():"";if(z)return z}return""},ln=()=>{if(!ae)return;let q=ae.dataset.defaultSummary||"Select theme",M=Ki()||q;ae.textContent=M,ae.setAttribute("title",M)},Vn=()=>{if(!Ce)return;let q=Ce.dataset.defaultSummary||"",I=[],M=e.querySelector(".aipkit_vector_store_enable_select");if(M&&M.checked){let X=e.querySelector(".aipkit_vector_store_provider_select"),te=X&&X.value||"",K=Gt(X),V=[];if(te==="openai")V=Di(e.querySelector('select[name="openai_vector_store_ids[]"]'));else if(te==="pinecone"){let ne=Gt(e.querySelector('select[name="pinecone_index_name"]'));ne&&(V=[ne])}else te==="qdrant"&&(V=Di(e.querySelector('select[name="qdrant_collection_names[]"]')));let Y=Array.from(new Set(V.map(ne=>bt(ne)).filter(Boolean)));if(K){let ne=Y.length?`${K}: ${Y.join(", ")}`:K;I.push(ne)}else Y.length&&I.push(Y.join(", "));if(te==="pinecone"||te==="qdrant"){let ne=di();ne&&I.push(ne)}}let G=e.querySelector(".aipkit_content_aware_enable_select");G&&G.checked&&I.push(t("Page context","gpt3-ai-content-generator"));let z=I.length?I.join(" | "):q;Ce.textContent=z,Ce.setAttribute("title",z)},_e=q=>{let I=String(q||"").toLowerCase(),M={none:t("None","gpt3-ai-content-generator"),low:t("Low","gpt3-ai-content-generator"),medium:t("Medium","gpt3-ai-content-generator"),high:t("High","gpt3-ai-content-generator"),xhigh:t("Very high","gpt3-ai-content-generator")};return M[I]||M.none},be=()=>{if(!Ae)return;let q=Ae.dataset.defaultSummary||t("Response length and memory","gpt3-ai-content-generator"),I=e.querySelector('[name="max_completion_tokens"]'),M=e.querySelector('[name="max_messages"]'),G=e.querySelector('[name="reasoning_effort"]'),z=Jt(),X=I?String(I.value||"").trim():"",te=M?String(M.value||"").trim():"",K=z?_e(G?G.value:""):"",Y=X!==""||te!==""?z?d(t("Response length: %1$s | Memory: %2$s | Reasoning: %3$s","gpt3-ai-content-generator"),X||"-",te||"-",K):d(t("Response length: %1$s | Memory: %2$s","gpt3-ai-content-generator"),X||"-",te||"-"):q;Ae.textContent=Y,Ae.setAttribute("title",Y)},Te=()=>{let q=String(Ze()||"").toLowerCase(),M={openai:".aipkit_openai_web_search_enable_toggle",google:".aipkit_google_search_grounding_enable_toggle",claude:".aipkit_claude_web_search_enable_toggle",openrouter:".aipkit_openrouter_web_search_enable_toggle"}[q]||"";return M?e.querySelector(M):null},At=()=>{if(!Oe)return;let q=Oe.dataset.defaultSummary||"",I=[],M=ut=>ut?ut.tagName==="SELECT"?ut.value==="1":!!ut.checked:!1,G=e.querySelector(".aipkit_file_upload_toggle_select");M(G)&&I.push(t("File Upload","gpt3-ai-content-generator"));let z=String(Ze()||""),X=z==="OpenAI"||z==="Claude"||z==="OpenRouter",te=e.querySelector(".aipkit_image_analysis_checkbox");X&&M(te)&&I.push(t("Image Analysis","gpt3-ai-content-generator"));let K=e.querySelector(".aipkit_tools_image_generation_toggle");M(K)&&I.push(t("Image generation","gpt3-ai-content-generator"));let V=Te();M(V)&&I.push(t("Web Search","gpt3-ai-content-generator"));let Y=e.querySelector(".aipkit_voice_input_toggle_switch");M(Y)&&I.push(t("Speech to Text","gpt3-ai-content-generator"));let ne=e.querySelector(".aipkit_tts_toggle_switch");M(ne)&&I.push(t("Text to Speech","gpt3-ai-content-generator"));let de=e.querySelector(".aipkit_enable_realtime_voice_toggle");M(de)&&I.push(t("Realtime Voice","gpt3-ai-content-generator"));let ke=I.length,De=ke>3?d(t("Enabled: %d","gpt3-ai-content-generator"),ke):ke>0?d(t("Enabled: %s","gpt3-ai-content-generator"),I.join(", ")):q;Oe.textContent=De,Oe.setAttribute("title",De)},et=()=>{if(!Fe)return;let q=Fe.dataset.defaultSummary||"",I=[],M=V=>V?V.tagName==="SELECT"?V.value==="1":!!V.checked:!1,G=e.querySelector('[name="enable_ip_anonymization"]');M(G)&&I.push(t("IP anonymization","gpt3-ai-content-generator"));let z=e.querySelector('[name="enable_consent_compliance"]');M(z)&&I.push(t("Consent notice","gpt3-ai-content-generator"));let X=e.querySelector('[name="openai_moderation_enabled"]'),te=String(Ze()||"").toLowerCase();M(X)&&te==="openai"&&I.push(t("Moderation","gpt3-ai-content-generator"));let K=I.length?`${t("Enabled","gpt3-ai-content-generator")}: ${I.join(", ")}`:q;Fe.textContent=K,Fe.setAttribute("title",K)},Lt=q=>{let I=String(q||"").toLowerCase(),M={never:t("never","gpt3-ai-content-generator"),daily:t("1 day","gpt3-ai-content-generator"),weekly:t("1 week","gpt3-ai-content-generator"),monthly:t("1 month","gpt3-ai-content-generator")};return M[I]||M.monthly},fi=q=>String(q??"").trim()||t("Unlimited","gpt3-ai-content-generator"),Vt=()=>{if(!We)return;let q=We.dataset.defaultSummary||"",I=e.querySelector('[name="token_limit_mode"]'),M=I?String(I.value||""):"",G=q;if(M==="role_based"){let z=e.querySelector('[name="token_reset_period"]'),X=Lt(z?z.value:"");G=d(t("Enabled: role based limit reset period: %s.","gpt3-ai-content-generator"),X)}else if(M==="general"||M===""){let z=e.querySelector('[name="token_guest_limit"]'),X=e.querySelector('[name="token_user_limit"]');G=d(t("Guests: %1$s Users: %2$s","gpt3-ai-content-generator"),fi(z?z.value:""),fi(X?X.value:""))}We.textContent=G,We.setAttribute("title",G)},hi=q=>{if(!q)return 0;if(Array.isArray(q))return q.length;if(typeof q=="string"){let I=q.trim();if(!I)return 0;try{return hi(JSON.parse(I))}catch{return 0}}if(typeof q=="object"){if(Array.isArray(q.triggers))return q.triggers.length;if(Array.isArray(q.rules))return q.rules.length}return 0},mi=(q,I,M)=>{let G=p(I,M,q,"gpt3-ai-content-generator");return/%\d*\$?[ds]/.test(G)?G.replace(/%\d*\$?[ds]/,String(q)):`${q} ${G}`},Bi=()=>{if(!je)return;let q=je.dataset.defaultSummary||"",I=e.querySelector('textarea[name="triggers_json"]'),M=I?hi(I.value):0,G=I&&M>0?mi(M,"%d rule","%d rules"):q;je.textContent=G,je.setAttribute("title",G)};ui&&!e.dataset.chatbotSummaryBound&&(e.addEventListener("change",q=>{let I=q.target;I&&(I.matches(".aipkit_chatbot_provider_select")||I.closest(".aipkit_chatbot_model_field select"))&&Ht()}),e.dataset.chatbotSummaryBound="1"),ae&&!e.dataset.interfaceSummaryBound&&(e.addEventListener("change",q=>{let I=q.target;I&&(I.matches('input[name="theme"]')||I.matches('select[name="theme"]'))&&ln()}),e.addEventListener("click",q=>{q.target.closest(".aipkit_custom_theme_preset")&&window.setTimeout(()=>{ln()},0)}),e.dataset.interfaceSummaryBound="1"),Qe&&!e.dataset.popupSummaryBound&&(e.addEventListener("change",q=>{let I=q.target;I&&(I.matches('select[name="popup_position"]')||I.matches('select[name="aipkit_deploy_popup_scope"]'))&&Wi()}),e.dataset.popupSummaryBound="1"),Ce&&!e.dataset.contextSummaryBound&&(e.addEventListener("change",q=>{let I=q.target;I&&(I.matches(".aipkit_vector_store_enable_select")||I.matches(".aipkit_vector_store_provider_select")||I.matches('select[name="openai_vector_store_ids[]"]')||I.matches('select[name="pinecone_index_name"]')||I.matches('select[name="qdrant_collection_names[]"]')||I.matches(".aipkit_vector_embedding_select")||I.matches('[name="vector_embedding_provider"]')||I.matches('[name="vector_embedding_model"]')||I.matches(".aipkit_content_aware_enable_select")||I.matches('[name="content_aware_enabled"]'))&&Vn()}),e.dataset.contextSummaryBound="1"),Ae&&!e.dataset.behaviorSummaryBound&&(e.addEventListener("change",q=>{let I=q.target;I&&(I.matches(".aipkit_chatbot_provider_select")||I.closest(".aipkit_chatbot_model_field select")||I.matches('[name="max_completion_tokens"]')||I.matches('[name="max_messages"]')||I.matches('[name="reasoning_effort"]'))&&be()}),e.addEventListener("input",q=>{let I=q.target;I&&(I.matches('[name="max_completion_tokens"]')||I.matches('[name="max_messages"]'))&&be()}),e.dataset.behaviorSummaryBound="1"),Oe&&!e.dataset.toolsSummaryBound&&(e.addEventListener("change",q=>{let I=q.target;I&&(I.matches(".aipkit_file_upload_toggle_select")||I.matches(".aipkit_image_analysis_checkbox")||I.matches(".aipkit_tools_image_generation_toggle")||I.matches(".aipkit_openai_web_search_enable_toggle")||I.matches(".aipkit_google_search_grounding_enable_toggle")||I.matches(".aipkit_claude_web_search_enable_toggle")||I.matches(".aipkit_openrouter_web_search_enable_toggle")||I.matches(".aipkit_voice_input_toggle_switch")||I.matches(".aipkit_tts_toggle_switch")||I.matches(".aipkit_enable_realtime_voice_toggle")||I.matches(".aipkit_chatbot_provider_select"))&&At()}),e.dataset.toolsSummaryBound="1"),Fe&&!e.dataset.safetySummaryBound&&(e.addEventListener("change",q=>{let I=q.target;I&&(I.matches('[name="enable_ip_anonymization"]')||I.matches('[name="enable_consent_compliance"]')||I.matches('[name="openai_moderation_enabled"]')||I.matches(".aipkit_chatbot_provider_select"))&&et()}),e.dataset.safetySummaryBound="1"),We&&!e.dataset.limitsSummaryBound&&(e.addEventListener("change",q=>{let I=q.target;I&&(I.matches('[name="token_limit_mode"]')||I.matches('[name="token_guest_limit"]')||I.matches('[name="token_user_limit"]')||I.matches('[name="token_reset_period"]'))&&Vt()}),e.addEventListener("input",q=>{let I=q.target;I&&(I.matches('[name="token_guest_limit"]')||I.matches('[name="token_user_limit"]'))&&Vt()}),e.dataset.limitsSummaryBound="1"),je&&!e.dataset.rulesSummaryBound&&(e.addEventListener("input",q=>{let I=q.target;I&&(I.matches('textarea[name="triggers_json"]')||I.closest(".aipkit_trigger_builder_container"))&&window.setTimeout(()=>{Bi()},0)}),e.addEventListener("change",q=>{let I=q.target;I&&(I.matches('textarea[name="triggers_json"]')||I.closest(".aipkit_trigger_builder_container"))&&window.setTimeout(()=>{Bi()},0)}),e.addEventListener("click",q=>{q.target.closest(".aipkit_trigger_builder_container")&&window.setTimeout(()=>{Bi()},0)}),e.dataset.rulesSummaryBound="1"),Ht(),ln(),Wi(),Vn(),be(),At(),et(),Vt(),Bi();let gi=()=>{W&&W.setAttribute("aria-expanded","false"),U&&(U.hidden=!0)},ti=(q="")=>{if(!U)return;let I=String(q||"").trim().toLowerCase(),M=Array.from(U.querySelectorAll(".aipkit_builder_bot_overflow_item")),G=0;M.forEach(X=>{let te=String(X.dataset.botLabel||"").toLowerCase(),K=I===""||te.includes(I);X.hidden=!K,K&&(G+=1)});let z=U.querySelector(".aipkit_builder_bot_overflow_empty");z&&(z.hidden=G>0)},ji=()=>{if(!U||!w)return;let q=String(w.value||"");U.innerHTML="";let I=Array.from(w.options||[]).filter(G=>G&&G.value&&G.value!=="__new__"&&!G.disabled),M=I.length>=D;if(M){let G=document.createElement("div");G.className="aipkit_builder_bot_overflow_search",G.setAttribute("role","none");let z=document.createElement("input");z.type="search",z.className="aipkit_builder_bot_overflow_search_input",z.autocomplete="off",z.setAttribute("placeholder",t("Search chatbots...","gpt3-ai-content-generator")),z.setAttribute("aria-label",t("Search chatbots","gpt3-ai-content-generator")),G.appendChild(z),U.appendChild(G)}if(I.forEach(G=>{let z=String(G.value||""),X=(G.textContent||"").trim(),te=z===q,K=document.createElement("button");K.type="button",K.className="aipkit_builder_bot_overflow_item",te&&K.classList.add("is-active"),K.dataset.botId=z,K.dataset.botLabel=X.toLowerCase(),K.setAttribute("role","menuitemradio"),K.setAttribute("aria-checked",te?"true":"false"),K.textContent=X,U.appendChild(K)}),M){let G=document.createElement("div");G.className="aipkit_builder_bot_overflow_empty",G.textContent=t("No matching chatbots.","gpt3-ai-content-generator"),G.hidden=!0,U.appendChild(G),ti("")}},Pe=()=>{if(!B)return;Array.from(B.querySelectorAll(".aipkit_builder_bot_tab_label")).forEach(I=>{let M=I.closest(".aipkit_builder_bot_tab");if(!M||M.hidden){I.classList.remove("aipkit_is_truncated");return}let G=Math.ceil(I.scrollWidth)>I.clientWidth+1;I.classList.toggle("aipkit_is_truncated",G)})},pi=()=>{if(!B)return;let q=Array.from(B.querySelectorAll(".aipkit_builder_bot_tab"));if(!q.length){W&&(W.hidden=!0),$&&($.hidden=!0),gi(),ji();return}q.forEach(st=>{st.hidden=!1});let I=st=>{if(!st)return 0;let ge=st.columnGap&&st.columnGap!=="normal"?st.columnGap:st.gap,pe=parseFloat(ge||"0");return Number.isFinite(pe)?pe:0},M=st=>{if(!st)return 0;let ge=window.getComputedStyle(st),pe=parseFloat(ge.width||"0"),Ge=parseFloat(ge.marginLeft||"0"),fe=parseFloat(ge.marginRight||"0"),tt=st.getBoundingClientRect().width||st.offsetWidth||pe,wt=Number.isFinite(tt)?tt:0,ai=Number.isFinite(Ge)?Ge:0,Zt=Number.isFinite(fe)?fe:0;return Math.ceil(wt+ai+Zt)},G=window.getComputedStyle(B),z=I(G),X=B.closest(".aipkit_builder_bot_tabs_shell"),te=X?window.getComputedStyle(X):null,K=I(te),V=B.closest(".aipkit_builder_bot_tabs_row"),Y=V?V.getBoundingClientRect():B.getBoundingClientRect(),ne=Math.max(0,Math.floor(Y.width)),de=M(L),ke=M(W),De=de>0?de+K:0,ut=st=>{let ge=st.getBoundingClientRect();return Math.ceil(ge.width||st.offsetWidth||0)},Ct=q.findIndex(st=>st.classList.contains("is-active")),Ft=st=>{let ge=0,pe=[];if(q.forEach((Ge,fe)=>{let he=ut(Ge);if(he<=0)return;let tt=pe.length===0?he:ge+z+he;tt<=st+.5&&(pe.push(fe),ge=tt)}),Ct!==-1&&!pe.includes(Ct)){let Ge=[],fe=0;for(let he=Ct;he>=0;he--){let tt=ut(q[he]);if(tt<=0)continue;let wt=Ge.length===0?tt:fe+z+tt;if(wt>st+.5)break;Ge.unshift(he),fe=wt}pe=Ge.length>0?Ge:[Ct]}return pe},qi=Math.max(0,ne-De),pt=Ft(qi);if(pt.length<q.length&&ke>0){let st=ke+K,ge=Math.max(0,ne-De-st);pt=Ft(ge)}let Xt=new Set(pt),vt=0;q.forEach((st,ge)=>{let pe=Xt.has(ge);st.hidden=!pe,pe||(vt+=1)}),Pe();let Kt=vt>0;W&&(W.hidden=!Kt),$&&($.hidden=!Kt),Kt||gi(),ji()},Hi=(q="")=>{if(!B||!w)return;let I=String(q||w.value||"");Array.from(B.querySelectorAll(".aipkit_builder_bot_tab")).forEach(z=>{let X=String(z.dataset.botId||""),te=I!==""&&X===I;z.classList.toggle("is-active",te),z.setAttribute("aria-selected",te?"true":"false"),z.setAttribute("tabindex",te?"0":"-1");let K=Array.from(w.options||[]).find(V=>String(V.value||"")===X);if(K){let V=(K.textContent||"").trim(),Y=z.querySelector(".aipkit_builder_bot_tab_label");Y?Y.textContent=V:z.textContent=V}}),pi();let G=B.querySelector(".aipkit_builder_bot_tab.is-active:not([hidden])");G&&typeof G.scrollIntoView=="function"&&G.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})},En=q=>typeof window<"u"&&window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(q)):String(q).replace(/([ #;?%&,.+*~\\':"!^$\[\]()=>|/@])/g,"\\$1"),Do=q=>Array.isArray(q)?q.map(I=>String(I??"")):q==null||q===""?[]:[String(q)],Ao=q=>{if(Array.isArray(q))return q.some(M=>Ao(M));if(q===!0||q===1)return!0;let I=String(q??"").trim().toLowerCase();return I==="1"||I==="true"||I==="yes"||I==="on"},Wo=(q,I)=>{if(!q)return;let M=(q.tagName||"").toUpperCase(),G=(q.type||"").toLowerCase();if(G==="checkbox"){if(Array.isArray(I)){let z=I.map(X=>String(X??""));q.checked=z.includes(String(q.value||"1"));return}q.checked=Ao(I);return}if(G==="radio"){q.checked=String(q.value||"")===String(I??"");return}if(M==="SELECT"&&q.multiple){let z=Do(I);Array.from(q.options||[]).forEach(X=>{X.selected=z.includes(String(X.value||""))});return}q.value=I==null?"":String(I)},gn=(q,I,M)=>{if(!q||!I)return!1;let G=`[name="${En(I)}"]`,z=Array.from(q.querySelectorAll(G));return z.length?(z.forEach(X=>Wo(X,M)),!0):!1},uo=(q,I)=>{let M=String(q||"").trim(),G=String(I||"").trim();if(!M||!G||M===G)return;let z=["aipkit_bot_","aipkit_theme_choice_","aipkit_image_model_choice_","aipkit_embed_code_","aipkit_embed_allowed_domains_","aipkit_reset_confirmation_","aipkit_delete_confirmation_","aipkit_elevenlabs_voices_json_","aipkit_elevenlabs_models_json_"],X=V=>{if(!V||typeof V!="string")return V;let Y=V;return z.forEach(ne=>{let de=`${ne}${M}`,ke=`${ne}${G}`;Y.includes(de)&&(Y=Y.split(de).join(ke))}),Y},te=["id","for","aria-controls","aria-labelledby","data-target"];[e,F,R,gt,document.getElementById("aipkit_builder_embed_modal")].filter(Boolean).forEach(V=>{[V,...Array.from(V.querySelectorAll("[id],[for],[aria-controls],[aria-labelledby],[data-target]"))].forEach(ne=>{te.forEach(de=>{if(!ne.hasAttribute(de))return;let ke=ne.getAttribute(de),De=X(ke);De!==ke&&ne.setAttribute(de,De)})})})},Ca=q=>{if(!q||typeof q!="object")return null;let I=String(q.bot_id||"").trim();return I?{bot_id:I,bot_name:String(q.bot_name||""),is_default:!!q.is_default,settings:q.settings&&typeof q.settings=="object"?{...q.settings}:{},deploy_mode:String(q.deploy_mode||"inline"),shortcode:String(q.shortcode||""),embed_code:String(q.embed_code||""),embed_allowed_domains:String(q.embed_allowed_domains||""),conversation_starters_text:String(q.conversation_starters_text||""),triggers_json:String(q.triggers_json||"[]")}:null},Ho=q=>{let I=Ca(q);return I?(v.set(I.bot_id,I),I):null},ta=(q="")=>{let I=String(q||"").trim();if(I&&v.has(I))return Promise.resolve(v.get(I));let M=I||"__all__";if(A.has(M))return A.get(M);if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Chatbot state API unavailable."));let G=I?{bot_id:I}:{},z=window.aipkit_apiRequest("aipkit_get_chatbot_switch_state",G).then(X=>(X&&X.bot&&Ho(X.bot),X&&X.bots&&typeof X.bots=="object"&&Object.keys(X.bots).forEach(te=>{Ho(X.bots[te])}),I?v.get(I)||null:X)).finally(()=>{A.delete(M)});return A.set(M,z),z},Vo=()=>C||(w&&Array.from(w.options||[]).filter(I=>I.value&&I.value!=="__new__"&&!I.disabled).length>1?(C=ta().catch(()=>{}).finally(()=>{C=null}),C):Promise.resolve()),ia=(q,I)=>{let M=String(q||"").trim();if(!M||!I)return!1;let G=e.querySelector("form.aipkit_chatbot_settings_form");if(!G)return!1;let z=String(T||G.dataset.botId||M).trim();z&&z!==M&&uo(z,M),T=M,e.setAttribute("data-active-bot-id",M),G.dataset.botId=M,w&&String(w.value||"")!==M&&(w.value=M),Hi(M);let X=I.settings&&typeof I.settings=="object"?I.settings:{};Object.entries(X).forEach(([ne,de])=>{if(!ne)return;if(ne==="token_role_limits"&&de&&typeof de=="object"){Object.entries(de).forEach(([De,ut])=>{gn(e,`token_role_limits[${De}]`,ut)});return}!gn(e,ne,de)&&Array.isArray(de)&&!ne.endsWith("[]")&&gn(e,`${ne}[]`,de)}),Wt&&(Wt.value=I.bot_name||""),gn(e,"conversation_starters",I.conversation_starters_text),gn(e,"triggers_json",I.triggers_json),gn(e,"embed_allowed_domains",I.embed_allowed_domains);let te=e.querySelector("[data-aipkit-top-mode-select]");te&&I.deploy_mode&&(te.value=I.deploy_mode),I.shortcode&&e.querySelectorAll(".aipkit_builder_shortcode_pill").forEach(de=>{de.setAttribute("data-shortcode",I.shortcode);let ke=de.querySelector(".aipkit_shortcode_text");ke?ke.textContent=I.shortcode:de.textContent=I.shortcode});let K=document.getElementById(`aipkit_embed_code_${M}`);K&&typeof I.embed_code=="string"&&(K.value=I.embed_code);let V=e.querySelector(".aipkit_active_bot_name_display");V&&(V.textContent=I.bot_name||"");let Y=e.querySelector('.aipkit_popover_footer_btn[data-action="delete"]');if(Y){let ne=!!I.is_default;Y.disabled=ne,Y.setAttribute("aria-disabled",ne?"true":"false"),Y.setAttribute("title",t(ne?"Default bot cannot be deleted.":"Delete chatbot","gpt3-ai-content-generator"))}io(),Yo(),Pn(),Qa(),oi(),Ia(),Gi(),qr(),Br(),Fa(),nn(),Ja(O),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),Ht(),ln(),Wi(),Vn(),be(),At(),et(),Vt(),Bi();try{localStorage.setItem(k,M)}catch{}if(typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(M),F&&F.classList.contains("aipkit-active")&&typeof window.aipkit_initTriggerBuilderUI=="function"){let ne=F.querySelector('.aipkit_builder_sheet_section[data-sheet="triggers"]');ne&&!ne.hidden&&window.aipkit_initTriggerBuilderUI(M)}return!0},Mn=async q=>{let I=String(q||"").trim();if(!I||I==="__new__"||b)return!1;if(v.has(I)){if(w&&String(w.value||"")!==I)return!1;b=!0;try{return ia(I,v.get(I))}finally{b=!1}}let M=await ta(I);if(!M||w&&String(w.value||"")!==I)return!1;b=!0;try{return ia(I,M)}finally{b=!1}},xr=q=>{if(!q)return u;let I=window.aipkit_dashboard&&window.aipkit_dashboard.models&&Array.isArray(window.aipkit_dashboard.models.openrouter)?window.aipkit_dashboard.models.openrouter:[],M=String(q).trim().toLowerCase();if(!M)return u;let G=I.find(z=>(z&&z.id?String(z.id):"").trim().toLowerCase()===M);return!G||!G.capabilities||typeof G.capabilities!="object"?u:{...u,...G.capabilities}},xa=q=>{if(!q||Ze()!=="OpenRouter")return!0;let M=ei("OpenRouter");return!!xr(M)[q]},Uo=(q,I,M,G)=>{if(!q||!I)return;q.classList.toggle("aipkit_popover_option_row--disabled",M),q.setAttribute("aria-disabled",M?"true":"false"),I.disabled=!!M;let z=q.querySelector(".aipkit_popover_option_label");z&&(z.dataset.defaultTooltip||(z.dataset.defaultTooltip=z.getAttribute("data-tooltip")||""),z.setAttribute("data-tooltip",M&&G||z.dataset.defaultTooltip))},Go=e.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),na=e.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),_o=e.querySelector(".aipkit_training_text_input"),oa=e.querySelector("#aipkit_training_qa_question"),aa=e.querySelector("#aipkit_training_qa_answer"),An=e.querySelector("#aipkit_training_files_input"),fo=e.querySelector(".aipkit_training_files_button"),Lo=e.querySelector(".aipkit_builder_dropzone"),qo=e.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),Rn=e.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),Bn=e.querySelector(".aipkit_training_stop_btn"),Aa=e.querySelector("#aipkit_sources_training_card .aipkit_builder_action_row"),Fn=e.querySelector("#aipkit_training_status"),zn=e.querySelector("#aipkit_training_file_list"),Qn=new Map,mo=null,an={page:1,selectedIds:new Set},kn=e.querySelector(".aipkit_training_sources_btn"),La=e.querySelector("#aipkit_sources_training_card"),Cn=e.querySelector("[data-aipkit-context-source-dropdown]"),Jn=Cn?Cn.querySelector(".aipkit_popover_multiselect_btn"):null,er=Cn?Cn.querySelector(".aipkit_popover_multiselect_label"):null,go=Cn?Cn.querySelector(".aipkit_popover_multiselect_panel"):null,Io=Cn?Array.from(Cn.querySelectorAll(".aipkit_context_source_option")):[],Ii=e.querySelector(".aipkit_vector_store_enable_select"),hn=e.querySelector(".aipkit_content_aware_enable_select"),dn=e.querySelector("[data-aipkit-tools-enabled-dropdown]"),To=dn?dn.querySelector(".aipkit_popover_multiselect_btn"):null,tr=dn?dn.querySelector(".aipkit_popover_multiselect_label"):null,ra=dn?dn.querySelector(".aipkit_popover_multiselect_panel"):null,Yn=dn?Array.from(dn.querySelectorAll(".aipkit_tools_enabled_option")):[],Un=e.querySelector("#aipkit_vs_wp_content_messages_area"),$n=e.querySelector("#aipkit_vs_wp_content_mode"),Xn=e.querySelector("#aipkit_vs_load_wp_content_btn"),pn=e.querySelector("#aipkit_vs_global_target_select"),Po=e.querySelector("#aipkit_vs_wp_content_status"),Mo=e.querySelector("#aipkit_vs_wp_content_status_specific"),Dn=e.querySelector("#aipkit_vs_wp_content_list_area"),sa=e.querySelector("#aipkit_vs_wp_content_pagination"),Bo=e.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Fo=e.querySelector("#aipkit_wp_content_bulk_panel"),ir=e.querySelector("#aipkit_wp_content_specific_panel"),Yt=e.querySelector("#aipkit_wp_content_bulk_hint"),nr=e.querySelector("#aipkit_wp_content_specific_types_panel"),qa=()=>{let q=N&&N.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return q?q.tagName==="SELECT"?q.value==="1":!!q.checked:!1},Ia=()=>{if(!La)return;let q=qa();La.hidden=!q};Ia();let Ta=(q,I,M,G=2)=>{let z=q.filter(te=>te&&te.checked);if(!z.length)return I?.dataset.placeholder||M;if(z.length>G)return`${z.length} selected`;let X=z.map(te=>{let K=te.closest("label")?.querySelector(".aipkit_popover_multiselect_text");return K?K.textContent.trim():""}).filter(Boolean);return X.length?X.join(", "):`${z.length} selected`},or=()=>{er&&(er.textContent=Ta(Io,Cn,"Select data source",2))},ca=()=>{if(!Io.length)return;let q=!!(Ii&&(Ii.tagName==="SELECT"&&Ii.value==="1"||Ii.checked)),I=!!(hn&&(hn.tagName==="SELECT"&&hn.value==="1"||hn.checked));Io.forEach(M=>{M&&(M.value==="vector"?M.checked=q:M.value==="page_context"&&(M.checked=I))}),or()},Pa=()=>{let q=Io.find(M=>M.value==="vector"),I=Io.find(M=>M.value==="page_context");if(Ii&&q){let M=!!q.checked,G=Ii.tagName==="SELECT"?Ii.value==="1":!!Ii.checked;M!==G&&(Ii.tagName==="SELECT"?Ii.value=M?"1":"0":Ii.checked=M,Ii.dispatchEvent(new Event("change",{bubbles:!0})))}if(hn&&I){let M=!!I.checked,G=hn.tagName==="SELECT"?hn.value==="1":!!hn.checked;M!==G&&(hn.tagName==="SELECT"?hn.value=M?"1":"0":hn.checked=M,hn.dispatchEvent(new Event("change",{bubbles:!0})))}or()},la=()=>{!Jn||!go||(Jn.setAttribute("aria-expanded","false"),go.hidden=!0,Cn.classList.remove("is-open"))};Cn&&Jn&&go&&!Cn.dataset.bound&&(Jn.addEventListener("click",q=>{if(q.preventDefault(),Jn.getAttribute("aria-expanded")==="true"){la();return}Jn.setAttribute("aria-expanded","true"),go.hidden=!1,Cn.classList.add("is-open")}),Io.forEach(q=>{q.addEventListener("change",()=>{Pa()})}),document.addEventListener("click",q=>{Cn.contains(q.target)||la()}),document.addEventListener("keydown",q=>{q.key==="Escape"&&la()}),Ii&&Ii.addEventListener("change",ca),hn&&hn.addEventListener("change",ca),ca(),Cn.dataset.bound="1");let ar=q=>q?q.tagName==="SELECT"?q.value==="1":!!q.checked:!1,Ar=(q,I)=>{if(!q||q.disabled)return;let M=!!I;ar(q)!==M&&(q.tagName==="SELECT"?q.value=M?"1":"0":q.checked=M,q.dispatchEvent(new Event("change",{bubbles:!0})))},Ma=q=>{switch(q){case"file_upload":return e.querySelector(".aipkit_file_upload_toggle_select");case"web_search":return Te();case"image_analysis":return e.querySelector(".aipkit_image_analysis_checkbox");case"image_generation":return e.querySelector(".aipkit_tools_image_generation_toggle");case"speech_to_text":return e.querySelector(".aipkit_voice_input_toggle_switch");case"text_to_speech":return e.querySelector(".aipkit_tts_toggle_switch");case"realtime_voice":return e.querySelector(".aipkit_enable_realtime_voice_toggle");default:return null}},Ba=()=>{tr&&(tr.textContent=Ta(Yn,dn,"Select tools",2))},Fa=()=>{if(!Yn.length)return;let q={};Yn.forEach(I=>{let M=I.dataset.toolKey||I.value;q[M]=!!I.checked}),e.querySelectorAll("[data-aipkit-tool-key]").forEach(I=>{let M=I.dataset.aipkitToolKey||"";if(!M)return;let G=q[M]!==!1;I.classList.toggle("aipkit_tools_feature_row--is-hidden",!G)})},oo=()=>{Yn.length&&(Yn.forEach(q=>{if(!q)return;let I=q.dataset.toolKey||q.value,M=Ma(I);M&&(q.checked=ar(M));let z=q.dataset.staticDisabled==="1"||!M||M.disabled;q.disabled=z;let X=q.closest(".aipkit_tools_enabled_item");X&&X.classList.toggle("is-disabled",z)}),Ba(),Fa())},rr=()=>{Yn.length&&(Yn.forEach(q=>{if(!q||q.disabled)return;let I=q.dataset.toolKey||q.value,M=Ma(I);M&&Ar(M,q.checked)}),Ba(),Fa())},Ko=()=>{!To||!ra||(To.setAttribute("aria-expanded","false"),ra.hidden=!0,dn.classList.remove("is-open"),Kn())};if(dn&&To&&ra&&!dn.dataset.bound){To.addEventListener("click",I=>{if(I.preventDefault(),To.getAttribute("aria-expanded")==="true"){Ko();return}To.setAttribute("aria-expanded","true"),ra.hidden=!1,dn.classList.add("is-open"),Kn()}),Yn.forEach(I=>{I.addEventListener("change",()=>{rr()})}),document.addEventListener("click",I=>{dn.contains(I.target)||Ko()}),document.addEventListener("keydown",I=>{I.key==="Escape"&&Ko()}),[".aipkit_file_upload_toggle_select",".aipkit_openai_web_search_enable_toggle",".aipkit_google_search_grounding_enable_toggle",".aipkit_claude_web_search_enable_toggle",".aipkit_openrouter_web_search_enable_toggle",".aipkit_image_analysis_checkbox",".aipkit_tools_image_generation_toggle",".aipkit_voice_input_toggle_switch",".aipkit_tts_toggle_switch",".aipkit_enable_realtime_voice_toggle"].forEach(I=>{e.querySelectorAll(I).forEach(M=>{M.addEventListener("change",oo)})});let q=e.querySelector(".aipkit_chatbot_provider_select");q&&q.addEventListener("change",()=>{window.requestAnimationFrame(oo)}),oo(),dn.dataset.bound="1"}let da=e.querySelector("#aipkit_wp_content_status_wrap_bulk"),sr=e.querySelector("#aipkit_wp_content_status_wrap_specific"),Ji=F?F.querySelector('.aipkit_builder_sheet_section[data-sheet="sources"]'):null,On=Ji?Ji.querySelector("#aipkit_sources_table_body"):null,pa=Ji?Ji.querySelector(".aipkit_sources_search_input"):null,ko=Ji?Ji.querySelector(".aipkit_sources_filter_select"):null,ua=Ji?Ji.querySelector(".aipkit_sources_refresh_btn"):null,wo=Ji?Ji.querySelector("#aipkit_sources_pagination"):null,Zn=Ji?Ji.querySelector("#aipkit_sources_status"):null,$a=Ji?Ji.querySelector("#aipkit_sources_provider_label"):null,eo=Ji?Ji.querySelector("#aipkit_sources_store_label"):null,li=document.getElementById("aipkit_sources_editor_modal"),ho=li?li.querySelector(".aipkit_sources_editor_textarea"):null,cr=li?li.querySelector(".aipkit_sources_editor_close"):null,_a=li?li.querySelector(".aipkit_sources_editor_cancel"):null,Oa=li?li.querySelector(".aipkit_sources_editor_save"):null,Si=document.getElementById("aipkit_sources_delete_modal"),lr=Si?Si.querySelector(".aipkit_sources_delete_close"):null,yn=Si?Si.querySelector(".aipkit_sources_delete_cancel"):null,yo=Si?Si.querySelector(".aipkit_sources_delete_confirm"):null,rn=document.getElementById("aipkit_builder_embed_modal"),fa=rn?rn.querySelector(".aipkit_builder_embed_close"):null,dr=rn?rn.querySelector(".aipkit_builder_embed_done"):null,j=document.getElementById("aipkit_image_settings_flyout"),ee=j?j.querySelector(".aipkit_popover_flyout_close"):null,ce=null,re=document.getElementById("aipkit_parameters_flyout"),me=re?re.querySelector(".aipkit_popover_flyout_close"):null,Ie=null,Ee=document.getElementById("aipkit_popup_hint_flyout"),Re=Ee?Ee.querySelector(".aipkit_popover_flyout_close"):null,Ne=null,Me=document.getElementById("aipkit_security_privacy_flyout"),dt=Me?Me.querySelector(".aipkit_popover_flyout_close"):null,Rt=N?N.querySelector('[data-aipkit-settings-panel="safety"]'):null,ii=null,ft=document.getElementById("aipkit_starters_flyout"),Xi=ft?ft.querySelector(".aipkit_popover_flyout_close"):null,Li=null,Tt=document.getElementById("aipkit_custom_theme_flyout"),_i=Tt?Tt.querySelector(".aipkit_popover_flyout_close"):null,ki=null,Ti=null,Pt=document.getElementById("aipkit_builder_web_settings_modal"),Tn=Pt?Pt.querySelector(".aipkit_builder_web_settings_close"):null,Ut=document.getElementById("aipkit_builder_context_settings_modal"),Na=Ut?Ut.querySelector(".aipkit_builder_context_settings_close"):null,Ra=N?N.querySelector('[data-aipkit-settings-panel="context"]'):null,un=null,Ei=document.getElementById("aipkit_builder_token_limits_modal"),Da=Ei?Ei.querySelector(".aipkit_builder_token_limits_close"):null,pr=N?N.querySelector('[data-aipkit-settings-panel="limits"]'):null,_n=null,Ve=document.getElementById("aipkit_builder_audio_settings_modal"),Wa=Ve?Ve.querySelector(".aipkit_builder_audio_settings_close"):null,Vi=null,zi=e.querySelector("#aipkit_builder_popup_settings_panel"),en=e.querySelector("[data-aipkit-popup-launcher-dropdown]"),ao=en?en.querySelector(".aipkit_popover_multiselect_btn"):null,$o=en?en.querySelector(".aipkit_popover_multiselect_label"):null,Ui=en?en.querySelector(".aipkit_popover_multiselect_panel"):null,vn=en?Array.from(en.querySelectorAll(".aipkit_popup_launcher_radio")):[],sn={};["popup_position","popup_icon_style","popup_icon_size"].forEach(q=>{let I=e.querySelector(`select[name="${q}"]`);I&&(sn[q]=I)});let cn=e.querySelector("[data-aipkit-theme-dropdown]"),to=cn?cn.querySelector(".aipkit_popover_multiselect_btn"):null,Ha=cn?cn.querySelector(".aipkit_popover_multiselect_label"):null,ma=cn?cn.querySelector(".aipkit_popover_multiselect_panel"):null,Ln=cn?Array.from(cn.querySelectorAll(".aipkit_interface_theme_radio")):[],Fi=e.querySelector('select[name="theme"]'),vo=e.querySelector('input[name="theme_preset_key"]'),Pi=e.querySelector(".aipkit_theme_config_btn"),Zi=e.querySelector("[data-aipkit-image-model-dropdown]"),ro=Zi?Zi.querySelector(".aipkit_popover_multiselect_btn"):null,ur=Zi?Zi.querySelector(".aipkit_popover_multiselect_label"):null,jo=Zi?Zi.querySelector(".aipkit_popover_multiselect_panel"):null,ga=Zi?Array.from(Zi.querySelectorAll(".aipkit_tools_image_model_radio")):[],tn=e.querySelector('select[name="chat_image_model_id"]'),Gn=e.querySelector("[data-aipkit-replicate-key-trigger]"),Nn=e.querySelector("[data-aipkit-replicate-key-popover]"),Va=Nn?Nn.querySelector("[data-aipkit-replicate-key-close]"):null,$i=document.getElementById("aipkit_chatbot_global_save_status_container"),ot=(q,I)=>{if(!$i)return;let M=typeof q=="string"?q:"",G=typeof I=="string"?I.trim():"",z=!G&&/saving|syncing|deleting|duplicating|resetting|loading|refreshing/i.test(M),X=$i.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_model_sync_status");X&&M&&(X.textContent="",X.classList.remove("success","error","loading")),$i.textContent=M,$i.className="aipkit_save_status_container",G?$i.classList.add(G):z&&$i.classList.add("loading")},Oi=()=>{$i&&setTimeout(()=>{$i.textContent="",$i.className="aipkit_save_status_container"},2500)},Oo=()=>{let q=j&&j.querySelector('input[name="replicate_api_key"]')||N&&N.querySelector('input[name="replicate_api_key"]')||F?.querySelector('input[name="replicate_api_key"]');return q?String(q.value||"").trim():""},Ua=q=>{if(!(q!==void 0?String(q||"").trim():Oo())||typeof window.aipkit_queueProviderSync!="function")return null;ot("Syncing models...","loading");let M=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return M&&typeof M.then=="function"&&M.then(()=>{ot("Models synced!","success"),Oi()}).catch(G=>{ot(`Error: ${G?.message||"Sync failed."}`,"error"),Oi()}),M},Ga=e.dataset.modelSettingsTitle||"Settings",bo=q=>{if(!N||!q)return;let I=q.getBoundingClientRect(),M=N.getBoundingClientRect(),G=M.width||420,z=M.height||0,X=window.innerWidth,te=window.innerHeight,K=12,V=I.right+10;V+G>X-K&&(V=I.left-G-10),V=Math.max(K,Math.min(V,X-G-K));let Y=I.top;Y+z>te-K&&(Y=te-z-K),Y=Math.max(K,Y),N.style.left=`${Math.round(V)}px`,N.style.top=`${Math.round(Y)}px`,re&&re.classList.contains("is-open")&&Ie&&_r(Ie),j&&j.classList.contains("is-open")&&ce&&so(ce),Pt&&Pt.classList.contains("is-open")&&Ti&&No(Ti),Ut&&Ut.classList.contains("is-open")&&un&&Ro(un),Ei&&Ei.classList.contains("is-open")&&_n&&wa(_n),Ve&&Ve.classList.contains("is-open")&&Vi&&ha(Vi)},ka=q=>{if(!R)return;let I=Array.from(R.querySelectorAll("[data-aipkit-settings-panel]"));if(!I.length)return;let M=q||"root",G=R.querySelector(`[data-aipkit-settings-panel="${M}"]`)||R.querySelector('[data-aipkit-settings-panel="root"]');if(!G)return;let z=G.dataset.aipkitSettingsPanel||"root";if(z!==it&&((()=>{re&&(re.classList.remove("is-open"),re.setAttribute("aria-hidden","true")),Ie&&(Ie.setAttribute("aria-expanded","false"),Ie=null),j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true")),ce&&(ce.setAttribute("aria-expanded","false"),ce=null),Me&&(Me.classList.remove("is-open"),Me.setAttribute("aria-hidden","true")),ii&&(ii.setAttribute("aria-expanded","false"),ii=null),ba(),Ko(),Pt&&(Pt.classList.remove("is-open"),Pt.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),Ut&&(Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true")),un&&(un.setAttribute("aria-expanded","false"),un=null),Ei&&(Ei.classList.remove("is-open"),Ei.setAttribute("aria-hidden","true")),_n&&(_n.setAttribute("aria-expanded","false"),_n=null),Ve&&(Ve.classList.remove("is-open"),Ve.setAttribute("aria-hidden","true")),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null),ft&&(ft.classList.remove("is-open"),ft.setAttribute("aria-hidden","true")),Li&&(Li.setAttribute("aria-expanded","false"),Li=null),Tt&&(Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true")),ki&&(ki.setAttribute("aria-expanded","false"),ki=null)})(),it=z),I.forEach(te=>{te.hidden=te!==G}),we){let te={root:R.dataset.titleRoot||"Settings",appearance:R.dataset.titleAppearance||"Appearance",behavior:R.dataset.titleBehavior||"Behavior",context:R.dataset.titleContext||"Context",tools:R.dataset.titleTools||"Tools",safety:R.dataset.titleSafety||"Safety",limits:R.dataset.titleLimits||"Limits"};we.textContent=te[z]||te.root}$e&&($e.hidden=z==="root"),Ke&&(Ke.hidden=z!=="root"),z==="behavior"&&Ja(G),z==="limits"&&Gi(),R.classList.contains("aipkit-active")&&Ue&&window.requestAnimationFrame(()=>{bo(Ue)})},_r=q=>{if(!re||!q)return;let I=q.getBoundingClientRect(),M=N?N.getBoundingClientRect():null,G=M&&M.width>0&&M.height>0,z=re.getBoundingClientRect(),X=z.width||320,te=z.height||260,K=window.innerWidth,V=window.innerHeight,Y=12,ne=(M?M.right:I.right)+8;ne+X>K-Y&&(ne=(M?M.left:I.left)-X-8),ne=Math.max(Y,Math.min(ne,K-X-Y));let de=M?M.top:I.top-8;de+te>V-Y&&(de=V-te-Y),de<Y&&(de=Y),re.style.left=`${Math.round(ne)}px`,re.style.top=`${Math.round(de)}px`},so=q=>{if(!j||!q)return;let I=q.getBoundingClientRect(),M=N?N.getBoundingClientRect():null,G=j.getBoundingClientRect(),z=G.width||340,X=G.height||220,te=window.innerWidth,K=window.innerHeight,V=12,Y=(M?M.right:I.right)+8;Y+z>te-V&&(Y=(M?M.left:I.left)-z-8),Y=Math.max(V,Math.min(Y,te-z-V));let ne=M?M.top:I.top-8;ne+X>K-V&&(ne=K-X-V),ne<V&&(ne=V),j.style.left=`${Math.round(Y)}px`,j.style.top=`${Math.round(ne)}px`},zo=q=>{if(!Ee||!q)return;let I=q.getBoundingClientRect(),M=q.closest(".aipkit_builder_card--settings, .aipkit_settings_accordion"),G=M?M.getBoundingClientRect():I,z=q.closest(".aipkit_popover_multiselect_panel"),X=z?z.getBoundingClientRect():null,te=X&&X.width>0&&X.height>0?X:I,K=Ee.getBoundingClientRect(),V=K.width||320,Y=K.height||240,ne=window.innerWidth,de=window.innerHeight,ke=12,De=8,ut=Math.max(G.right,te.right),Ct=Math.min(G.left,te.left),Ft=ut+De,qi=Ct-V-De,pt=ne-ke-Ft,yi=qi-ke,Xt;pt>=V||pt>=yi?Xt=Ft:Xt=qi,Xt=Math.max(ke,Math.min(Xt,ne-V-ke));let vt=de-te.bottom+De;vt<ke&&(vt=ke),de-vt-Y<ke&&(vt=Math.max(ke,de-Y-ke)),Ee.style.left=`${Math.round(Xt)}px`,Ee.style.top="auto",Ee.style.bottom=`${Math.round(vt)}px`},Ka=q=>{if(!ft||!q)return;let I=q.getBoundingClientRect(),M=q.closest(".aipkit_builder_card--settings, .aipkit_settings_accordion"),G=M?M.getBoundingClientRect():I,z=q.closest(".aipkit_interface_cell--controls, .aipkit_interface_feature_row"),X=z?z.getBoundingClientRect():I,te=ft.getBoundingClientRect(),K=te.width||400,V=te.height||240,Y=window.innerWidth,ne=window.innerHeight,de=12,ke=8,De=G.right+ke,ut=G.left-K-ke,Ct=Y-de-De,Ft=ut-de,qi;Ct>=K||Ct>=Ft?qi=De:qi=ut,qi=Math.max(de,Math.min(qi,Y-K-de));let pt=ne-X.bottom;pt<de&&(pt=de),ne-pt-V<de&&(pt=Math.max(de,ne-V-de)),ft.style.left=`${Math.round(qi)}px`,ft.style.top="auto",ft.style.bottom=`${Math.round(pt)}px`},ja=q=>{if(!Me||!q)return;let I=q.getBoundingClientRect(),M=N?N.getBoundingClientRect():null,G=M&&M.width>0&&M.height>0,X=Me.getBoundingClientRect().width||400,te=window.innerWidth,K=window.innerHeight,V=12,Y=(G?M.right:I.right)+8;Y+X>te-V&&(Y=(G?M.left:I.left)-X-8),Y=Math.max(V,Math.min(Y,te-X-V));let ne=G?K-M.bottom:K-I.bottom,de=Math.max(V,ne);Me.style.left=`${Math.round(Y)}px`,Me.style.top="auto",Me.style.bottom=`${Math.round(de)}px`},za=q=>{if(!Tt||!q)return;let I=q.getBoundingClientRect();if(I.width===0&&I.height===0&&e){let ke=e.querySelector(".aipkit_theme_config_btn")||e.querySelector("[data-aipkit-theme-dropdown] .aipkit_popover_multiselect_btn")||e.querySelector('select[name="theme"]')||e.querySelector('.aipkit_theme_choice_card input[name="theme"][value="custom"]')?.closest(".aipkit_theme_choice_card");if(ke){let De=ke.getBoundingClientRect();(De.width>0||De.height>0)&&(I=De)}}let M=N?N.getBoundingClientRect():null,G=M&&M.width>0&&M.height>0,z=Tt.getBoundingClientRect(),X=z.width||400,te=z.height||260,K=window.innerWidth,V=window.innerHeight,Y=12,ne=(G?M.right:I.right)+8;ne+X>K-Y&&(ne=(G?M.left:I.left)-X-8),ne=Math.max(Y,Math.min(ne,K-X-Y));let de=G?M.top:I.top-8;de+te>V-Y&&(de=V-te-Y),de<Y&&(de=Y),Tt.style.left=`${Math.round(ne)}px`,Tt.style.top=`${Math.round(de)}px`},No=q=>{if(!Pt||!q)return;let I=N?N.getBoundingClientRect():null,M=I&&I.width>0&&I.height>0,G=q.getBoundingClientRect(),z=Pt.querySelector(".aipkit-modal-content"),X=z?z.getBoundingClientRect():null,te=X?X.width:520,K=X?X.height:420,V=window.innerWidth,Y=window.innerHeight,ne=12,de=(M?I.right:G.right)+10;de+te>V-ne&&(de=(M?I.left:G.left)-te-10),de=Math.max(ne,Math.min(de,V-te-ne));let ke=G.top-8;ke+K>Y-ne&&(ke=Y-K-ne),ke<ne&&(ke=ne),Pt.style.left=`${Math.round(de)}px`,Pt.style.top=`${Math.round(ke)}px`,Pt.style.bottom="auto"},Ro=q=>{if(!Ut||!q)return;let I=N?N.getBoundingClientRect():null,M=q.getBoundingClientRect(),G=Ut.querySelector(".aipkit-modal-content"),z=G?G.getBoundingClientRect():null,X=z?z.width:560,te=window.innerWidth,K=12,V=(I?I.right:M.right)+8;V+X>te-K&&(V=(I?I.left:M.left)-X-8),V=Math.max(K,Math.min(V,te-X-K));let Y=I?I.top:K;Ut.style.left=`${Math.round(V)}px`,Ut.style.top=`${Math.round(Y)}px`},wa=q=>{if(!Ei||!q)return;let I=N?N.getBoundingClientRect():null,M=q.getBoundingClientRect(),G=Ei.querySelector(".aipkit-modal-content"),z=G?G.getBoundingClientRect():null,X=z?z.width:620,te=z?z.height:400,K=window.innerWidth,V=12,Y=(I?I.right:M.right)+8;Y+X>K-V&&(Y=(I?I.left:M.left)-X-8),Y=Math.max(V,Math.min(Y,K-X-V));let ne=I?I.bottom-te:M.top-12;ne<V&&(ne=V),Ei.style.left=`${Math.round(Y)}px`,Ei.style.top=`${Math.round(ne)}px`},ha=q=>{if(!Ve||!q)return;let I=N?N.getBoundingClientRect():null,M=I&&I.width>0&&I.height>0,G=q.getBoundingClientRect(),z=Ve.querySelector(".aipkit-modal-content"),X=z?z.getBoundingClientRect():null,te=X?X.width:520,K=X?X.height:460,V=window.innerWidth,Y=12,ne=(M?I.right:G.right)+10;ne+te>V-Y&&(ne=(M?I.left:G.left)-te-10),ne=Math.max(Y,Math.min(ne,V-te-Y));let de=window.innerHeight,ke=G.top-8;ke+K>de-Y&&(ke=de-K-Y),ke<Y&&(ke=Y),Ve.style.left=`${Math.round(ne)}px`,Ve.style.top=`${Math.round(ke)}px`,Ve.style.bottom="auto"},fr=q=>{ie||!R||!N||!q||(F&&F.classList.contains("aipkit-active")&&(F.classList.remove("aipkit-active"),F.setAttribute("aria-hidden","true")),ka("root"),Ue=q,R.classList.add("aipkit-active"),R.setAttribute("aria-hidden","false"),q.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_model_settings_popover"),Ja(N),io(),Yo(),nn(),window.requestAnimationFrame(()=>{bo(q)}))},So=()=>{R&&(ka("root"),Pt&&(Pt.classList.remove("is-open"),Pt.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),Ut&&(Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true")),un&&(un.setAttribute("aria-expanded","false"),un=null),Ei&&(Ei.classList.remove("is-open"),Ei.setAttribute("aria-hidden","true")),_n&&(_n.setAttribute("aria-expanded","false"),_n=null),Ve&&(Ve.classList.remove("is-open"),Ve.setAttribute("aria-hidden","true")),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null),re&&(re.classList.remove("is-open"),re.setAttribute("aria-hidden","true")),Ie&&(Ie.setAttribute("aria-expanded","false"),Ie=null),j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true")),ce&&(ce.setAttribute("aria-expanded","false"),ce=null),Me&&(Me.classList.remove("is-open"),Me.setAttribute("aria-hidden","true")),ii&&(ii.setAttribute("aria-expanded","false"),ii=null),va(),ba(),Ko(),R.classList.remove("aipkit-active"),R.setAttribute("aria-hidden","true"),Ue&&Ue.setAttribute("aria-expanded","false"),Ue=null)},mr=()=>{if(!N)return;let q=e.querySelector(".aipkit_chatbot_provider_select"),I=q?q.value:"",M=xa("web_search_plugin"),G=te=>te?te.tagName==="SELECT"?te.value==="1":te.type==="checkbox"?te.checked:te.value==="1":!1,z={OpenAI:{row:N.querySelector(".aipkit_web_search_toggle_openai"),toggle:N.querySelector(".aipkit_openai_web_search_enable_toggle"),button:N.querySelector('.aipkit_web_search_config_btn[data-web-provider="openai"]')},Google:{row:N.querySelector(".aipkit_web_search_toggle_google"),toggle:N.querySelector(".aipkit_google_search_grounding_enable_toggle"),button:N.querySelector('.aipkit_web_search_config_btn[data-web-provider="google"]')},Claude:{row:N.querySelector(".aipkit_web_search_toggle_claude"),toggle:N.querySelector(".aipkit_claude_web_search_enable_toggle"),button:N.querySelector('.aipkit_web_search_config_btn[data-web-provider="claude"]')},OpenRouter:{row:N.querySelector(".aipkit_web_search_toggle_openrouter"),toggle:N.querySelector(".aipkit_openrouter_web_search_enable_toggle"),button:N.querySelector('.aipkit_web_search_config_btn[data-web-provider="openrouter"]')}};Object.entries(z).forEach(([te,K])=>{if(K.row&&(K.row.style.display=I===te?"":"none"),K.button){let Y=te==="OpenRouter"?M:!0;K.button.style.display=Y&&G(K.toggle)?"":"none"}}),Pt&&Ti&&Pt.classList.contains("is-open")&&(Ti.offsetParent!==null&&Ti.style.display!=="none"&&!Ti.hidden||(Pt.classList.remove("is-open"),Pt.setAttribute("aria-hidden","true"),Ti.setAttribute("aria-expanded","false"),Ti=null));let X=z.OpenRouter;if(X.row&&X.toggle){let te=I==="OpenRouter"&&!M;te&&G(X.toggle)&&(X.toggle.tagName==="SELECT"?X.toggle.value="0":X.toggle.type==="checkbox"?X.toggle.checked=!1:X.toggle.value="0",X.toggle.dispatchEvent(new Event("change",{bubbles:!0}))),Uo(X.row,X.toggle,te,t("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"))}oo()},io=()=>{let q=K=>K?K.tagName==="SELECT"?K.value==="1":K.type==="checkbox"?K.checked:K.value==="1":!1,I=K=>{if(!K)return;let V=N&&N.querySelector(".aipkit_claude_web_search_enable_toggle")||K.querySelector(".aipkit_claude_web_search_enable_toggle"),Y=q(V),ne=K.querySelector(".aipkit_claude_web_search_conditional_settings");ne&&(ne.style.display=Y?"":"none");let de=K.querySelector(".aipkit_claude_web_search_loc_type_select"),ke=K.querySelector(".aipkit_claude_web_search_location_details");ke&&(ke.style.display=Y&&de&&de.value==="approximate"?"":"none")},M=(K,V)=>{if(!K)return;let Y=N&&N.querySelector(".aipkit_openrouter_web_search_enable_toggle")||K.querySelector(".aipkit_openrouter_web_search_enable_toggle"),ne=V&&q(Y);!V&&Y&&q(Y)&&(Y.tagName==="SELECT"?Y.value="0":Y.type==="checkbox"?Y.checked=!1:Y.value="0",Y.dispatchEvent(new Event("change",{bubbles:!0})));let de=K.querySelector(".aipkit_openrouter_web_search_conditional_settings");de&&(de.style.display=ne?"":"none")},G=e.querySelector(".aipkit_chatbot_provider_select"),z=G?G.value:"",X=xa("web_search_plugin"),te=Pt||F;if(te){let K=te.querySelector(".aipkit_web_modal_section_openai"),V=te.querySelector(".aipkit_web_modal_section_google"),Y=te.querySelector(".aipkit_web_modal_section_claude"),ne=te.querySelector(".aipkit_web_modal_section_openrouter");K&&(K.style.display=z==="OpenAI"?"":"none"),V&&(V.style.display=z==="Google"?"":"none"),Y&&(Y.style.display=z==="Claude"?"":"none"),ne&&(ne.style.display=z==="OpenRouter"&&X?"":"none"),typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(te),typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(te),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(te),typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(te),I(te),M(te,X)}mr()},le=()=>{let q=N&&N.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return q?q.tagName==="SELECT"?q.value==="1"?"1":"0":q.checked?"1":"0":"0"},xe=()=>{if(!N)return"0";let q=N.querySelector(".aipkit_file_upload_toggle_select");return!q||q.disabled?"0":q.tagName==="SELECT"?q.value==="1"?"1":"0":q.checked?"1":"0"},ye=()=>Ra||Ut,He=()=>pr||Ei,nt=()=>{let q=ye();return q?{providerSelect:q.querySelector('[name="vector_store_provider"]'),openaiStoresSelect:q.querySelector('select[name="openai_vector_store_ids[]"]'),pineconeIndexSelect:q.querySelector('[name="pinecone_index_name"]'),qdrantCollectionsSelect:q.querySelector('select[name="qdrant_collection_names[]"]'),pineconeKeyInput:q.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:q.querySelector('[name="qdrant_url"]'),qdrantKeyInput:q.querySelector('[name="qdrant_api_key"]')}:{}},yt=q=>q?Array.from(q.options).filter(I=>!I.disabled&&I.value):[],rt=q=>q?(q.selectedOptions?Array.from(q.selectedOptions):[]).some(M=>!M.disabled&&M.value):!1,Dt=q=>{if(!q)return!1;let I=q.options[q.selectedIndex];if(I&&!I.disabled&&I.value)return!0;let M=yt(q)[0];return M?(q.value=M.value,q.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},kt=q=>{if(!q)return!1;if(rt(q))return!0;let I=yt(q)[0];return I?(I.selected=!0,q.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},Bt=q=>{if(!N)return;let I=N.querySelector(".aipkit_vector_store_popover_row .aipkit_popover_warning");if(I){if(!q){I.classList.remove("is-visible"),I.setAttribute("aria-hidden","true"),I.setAttribute("data-tooltip",""),I.removeAttribute("aria-label");return}I.classList.add("is-visible"),I.setAttribute("aria-hidden","false"),I.setAttribute("data-tooltip",q),I.setAttribute("aria-label",q)}},ct=()=>{if(xe()!=="1"){Bt("");return}let{providerSelect:q,openaiStoresSelect:I,pineconeIndexSelect:M,qdrantCollectionsSelect:G,pineconeKeyInput:z,qdrantUrlInput:X,qdrantKeyInput:te}=nt(),K=q?q.value:"",V=e.querySelector(".aipkit_chatbot_provider_select"),Y=V?V.value:"",ne=!!(z&&z.value.trim()),de=!!(X&&X.value.trim()),ke=!!(te&&te.value.trim()),De=rt(I),ut=rt(M),Ct=rt(G),Ft="";K?K==="openai"?m?De||(Ft="No OpenAI vector stores found. Create a vector store."):Ft="Add your OpenAI API key to enable OpenAI vector stores.":K==="pinecone"?ne?ut||(Ft="No Pinecone indexes found. Create an index."):Ft="Add your Pinecone API key to enable Pinecone.":K==="qdrant"?!de&&!ke?Ft="Add your Qdrant URL and API key to enable Qdrant.":de?ke?Ct||(Ft="No Qdrant collections found. Create a collection."):Ft="Add your Qdrant API key to enable Qdrant.":Ft="Add your Qdrant URL to enable Qdrant.":K==="claude_files"?Y!=="Claude"?Ft="Claude Files requires the chatbot provider to be Claude.":x||(Ft="Add your Claude API key to enable Claude Files."):Ft="Select and configure a vector provider to use file uploads.":Ft="Select and configure a vector provider to use file uploads.",Bt(Ft)},Et=()=>{let q=ye();if(!N||!q)return;let I=N.querySelector(".aipkit_vector_store_enable_select");I&&!I.checked&&(I.checked=!0,I.dispatchEvent(new Event("change",{bubbles:!0})));let{providerSelect:M,openaiStoresSelect:G,pineconeIndexSelect:z,qdrantCollectionsSelect:X,pineconeKeyInput:te,qdrantUrlInput:K,qdrantKeyInput:V}=nt(),Y=!!(te&&te.value.trim()),ne=!!(K&&K.value.trim()),de=!!(V&&V.value.trim()),ke="";m?ke="openai":Y?ke="pinecone":(de||ne)&&(ke="qdrant"),M&&ke&&M.value!==ke&&(M.value=ke,M.dispatchEvent(new Event("change",{bubbles:!0}))),ke==="openai"?kt(G):ke==="pinecone"?Dt(z):ke==="qdrant"&&kt(X),ct()},fn=()=>{let q=ye();if(!q)return!1;let I=q.querySelector('[name="vector_store_provider"]');if(!I)return!1;let M=e.querySelector(".aipkit_chatbot_provider_select"),z=(M?M.value:"")==="Claude",X=Array.from(I.options||[]).find(V=>V&&V.value==="claude_files");if(!X)return!1;let te=!z,K=!1;if(X.disabled!==te&&(X.disabled=te,K=!0),te&&I.value==="claude_files"){let V=Array.from(I.options||[]).find(ne=>ne&&ne.value&&!ne.disabled&&ne.value!=="claude_files"),Y=V?V.value:"openai";if(I.value!==Y)return I.value=Y,I.dispatchEvent(new Event("change",{bubbles:!0})),!0}return K&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),!1},ni=()=>{if(!N)return;let q=N.querySelector(".aipkit_file_upload_toggle_select");if(!q)return;let I=q.closest(".aipkit_popover_option_row"),M=I?I.querySelector(".aipkit_popover_option_label"):null,G=q.dataset.isProPlan==="true",z=G,X=q.dataset.tooltipDefault||"",te=ye(),K=te?te.querySelector('[name="vector_store_provider"]'):null,V=K?K.value:"",Y=e.querySelector(".aipkit_chatbot_provider_select"),ne=Y?Y.value:"";if(fn())return;G?V==="claude_files"&&ne!=="Claude"&&(X="Claude Files requires the chatbot provider to be Claude.",z=!1):(X=q.dataset.tooltipUpgrade||X,z=!1),I&&I.classList.toggle("aipkit_popover_option_row--disabled",!z),q.disabled=!z,M&&M.setAttribute("data-tooltip",X);let de=q.tagName==="SELECT"?q.value==="1":q.checked;!z&&de&&(q.tagName==="SELECT"?q.value="0":q.checked=!1,q.dispatchEvent(new Event("change",{bubbles:!0}))),oo()},oi=()=>{let q=ye();q&&(typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(q),typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(q))},nn=()=>{if(!N)return;let q=le()==="1",I=N.querySelector(".aipkit_file_upload_toggle_select");!q&&I&&!I.disabled&&(I.tagName==="SELECT"?I.value==="1":I.checked)&&(I.tagName==="SELECT"?I.value="0":I.checked=!1,I.dispatchEvent(new Event("change",{bubbles:!0}))),oi(),ni(),ct(),Ia()},Gi=()=>{let q=He();if(!q)return;let I=q.querySelector(".aipkit_token_limit_mode_select"),M=q.querySelector(".aipkit_limits_primary_grid"),G=q.querySelector(".aipkit_token_general_user_limit_field"),z=q.querySelector(".aipkit_token_role_limits_container");if(!I||!G||!z)return;let X=I.value;M&&M.classList.toggle("aipkit_limits_primary_grid--role-based",X==="role_based"),G.style.display=X==="general"?"block":"none",z.style.display=X==="role_based"?"block":"none"},Eo=()=>{if(!Ve)return;let q=(Ve.dataset.activeAudioFeature||"").trim(),I=Ve.querySelectorAll(".aipkit_audio_feature_group");I.length&&I.forEach(M=>{if(!q){M.style.display="";return}M.style.display=M.classList.contains(`aipkit_audio_feature_group--${q}`)?"":"none"})},Pn=()=>{if(!Ve)return;let q=pt=>pt?pt.tagName==="SELECT"?pt.value==="1":pt.type==="checkbox"?pt.checked:pt.value==="1":!1,I=pt=>q(e.querySelector(pt)),M=(pt,yi)=>{e.querySelectorAll(`.aipkit_audio_settings_config_btn[data-audio-feature="${pt}"]`).forEach(Xt=>{Xt.style.display=yi?"":"none"})},G=I(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch"),z=I(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch"),X=I(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle"),te=Ve.querySelector(".aipkit_stt_provider_conditional_row"),K=Ve.querySelector(".aipkit_stt_provider_row"),V=K&&K.dataset.sttControlsHidden==="1";if(K&&(K.style.display=G&&!V?"block":"none"),te&&(te.style.display=G&&!V?"flex":"none"),G&&V&&K){let pt=K.dataset.sttDefaultProvider,yi=K.dataset.sttDefaultModel,Xt=Ve.querySelector(".aipkit_stt_provider_select"),vt=Ve.querySelector('[name="stt_openai_model_id"]'),Kt=(st,ge,pe)=>{if(!st||!ge)return;if(!Array.from(st.options).some(fe=>fe.value===ge)){let fe=new Option(pe||ge,ge,!0,!0);st.add(fe)}st.value=ge};Kt(Xt,pt),Kt(vt,yi,"whisper-1")}M("stt",G&&!V),typeof window.aipkit_toggleSttModelFields=="function"&&window.aipkit_toggleSttModelFields(Ve);let Y=Ve.querySelector(".aipkit_tts_conditional_settings"),ne=Ve.querySelector(".aipkit_tts_provider_row"),de=Ve.querySelector(".aipkit_tts_auto_play_container");ne&&(ne.style.display=z?"block":"none"),Y&&(Y.style.display=z?"flex":"none"),de&&(de.style.display=z?"block":"none");let ke=Ve.querySelector(".aipkit_tts_provider_select");if(ke){let pt=ke.value;Ve.querySelectorAll(".aipkit_tts_field").forEach(ge=>{let pe=ge.getAttribute("data-provider");ge.style.display=z&&pe===pt?"block":"none"});let yi=Ve.querySelector(".aipkit_tts_google_voice_inline"),Xt=Ve.querySelector(".aipkit_tts_openai_voice_inline"),vt=Ve.querySelector(".aipkit_tts_openai_model_inline"),Kt=Ve.querySelector(".aipkit_tts_elevenlabs_voice_inline"),st=Ve.querySelector(".aipkit_tts_elevenlabs_model_inline");yi&&(yi.style.display=z&&pt==="Google"?"block":"none"),Xt&&(Xt.style.display=z&&pt==="OpenAI"?"block":"none"),vt&&(vt.style.display=z&&pt==="OpenAI"?"block":"none"),Kt&&(Kt.style.display=z&&pt==="ElevenLabs"?"block":"none"),st&&(st.style.display=z&&pt==="ElevenLabs"?"block":"none")}else if(z===!1){Ve.querySelectorAll(".aipkit_tts_field").forEach(st=>{st.style.display="none"});let pt=Ve.querySelector(".aipkit_tts_google_voice_inline");pt&&(pt.style.display="none");let yi=Ve.querySelector(".aipkit_tts_openai_voice_inline");yi&&(yi.style.display="none");let Xt=Ve.querySelector(".aipkit_tts_openai_model_inline");Xt&&(Xt.style.display="none");let vt=Ve.querySelector(".aipkit_tts_elevenlabs_voice_inline");vt&&(vt.style.display="none");let Kt=Ve.querySelector(".aipkit_tts_elevenlabs_model_inline");Kt&&(Kt.style.display="none")}M("tts",z);let De=Ve.querySelector(".aipkit_realtime_voice_settings_container"),ut=Ve.querySelector(".aipkit_realtime_voice_inline_controls"),Ct=Ve.querySelector(".aipkit_realtime_voice_inline_row"),qi=De&&De.getAttribute("data-force-visible")==="1"?!0:X;if(De&&(De.style.display=qi?"block":"none"),Ct&&(Ct.style.display=qi?"block":"none"),ut&&(ut.style.display=qi?"flex":"none"),Ve.querySelectorAll(".aipkit_rt_dependent").forEach(pt=>{pt.style.display=qi?"":"none"}),M("realtime",X),Ve.classList.contains("is-open")){let pt=String(Ve.dataset.activeAudioFeature||"").trim().toLowerCase();if(pt&&!(pt==="stt"&&G||pt==="tts"&&z||pt==="realtime"&&X)){Ve.classList.remove("is-open"),Ve.setAttribute("aria-hidden","true"),delete Ve.dataset.activeAudioFeature,Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null);let Xt=Ve.querySelector("#aipkit_builder_audio_settings_title");Xt&&Xt.dataset.defaultTitle&&(Xt.textContent=Xt.dataset.defaultTitle)}}oo(),Eo()};function Kn(){if(!O)return;let q=en&&en.classList.contains("is-open")||cn&&cn.classList.contains("is-open")||dn&&dn.classList.contains("is-open")||Zi&&Zi.classList.contains("is-open")||Nn&&Nn.classList.contains("is-open")||!!e.querySelector("[data-aipkit-interface-controls-dropdown].is-open");O.classList.toggle("aipkit_settings_accordion--allow-overflow",q)}let ya=()=>{!ao||!Ui||(ao.setAttribute("aria-expanded","false"),Ui.hidden=!0,en.classList.remove("is-open"),Kn())},Qo=()=>{!to||!ma||!cn||(to.setAttribute("aria-expanded","false"),ma.hidden=!0,cn.classList.remove("is-open"),Kn())},va=()=>{!ro||!jo||!Zi||(ro.setAttribute("aria-expanded","false"),jo.hidden=!0,Zi.classList.remove("is-open"),Kn())},ba=()=>{!Gn||!Nn||(Gn.setAttribute("aria-expanded","false"),Nn.hidden=!0,Nn.classList.remove("is-open"),Kn())},Br=()=>{if(!Pi||!Fi||!Ln.length)return;let q=Ln.find(M=>{let G=M.getAttribute("data-theme-value")||M.value||"",z=M.getAttribute("data-preset-key")||"";return G==="custom"&&z===""}),I=!!(q&&!q.disabled);Pi.hidden=!I,Pi.disabled=!I,Pi.setAttribute("aria-disabled",I?"false":"true"),!I&&ki===Pi&&Jo()},Lr=()=>{if(!Ha||!Fi)return;let q=Fi.selectedOptions&&Fi.selectedOptions.length?Fi.selectedOptions[0]:null,I=q&&q.textContent?q.textContent.trim():"",M=(Fi.value||"")==="custom"?Sn():"";Ha.textContent=M||I||cn.dataset.placeholder||"Select theme",Br()},Fr=q=>{!vo||vo.disabled||(vo.value=q||"")},$r=(q,I)=>{if((q||"")!=="custom"){Fr("");return}Fr(I||"")},Yr=()=>{if($r("custom",""),e.querySelectorAll(".aipkit_custom_theme_preset").forEach(q=>{q.classList.remove("is-selected"),q.setAttribute("aria-pressed","false")}),Fi&&!Fi.disabled&&Fi.value==="custom"){let q=Array.from(Fi.options||[]).findIndex(I=>(I.value||"")==="custom"&&!(I.dataset&&I.dataset.presetKey));q>=0&&Fi.selectedIndex!==q&&(Fi.selectedIndex=q)}if(Ln.length){let q=Ln.find(I=>{let M=I.getAttribute("data-theme-value")||I.value||"",G=I.getAttribute("data-preset-key")||"";return M==="custom"&&G===""});q&&(q.checked=!0)}Lr()},gr=()=>{if(!Fi||!Ln.length){Lr();return}let q=Fi.selectedOptions&&Fi.selectedOptions.length?Fi.selectedOptions[0]:null,I=Fi.value||"",M=q&&q.dataset&&q.dataset.presetKey?q.dataset.presetKey:"",G=!1;if(Ln.forEach(K=>{let V=K.getAttribute("data-theme-value")||K.value||"",Y=K.getAttribute("data-preset-key")||"",ne=V===I&&Y===M;K.checked=ne,ne&&(G=!0)}),!G&&I){let K=Ln.find(V=>(V.getAttribute("data-theme-value")||V.value||"")===I);K&&(K.checked=!0)}let z=Ln.find(K=>K.checked),X=z?z.getAttribute("data-theme-value")||z.value||"":I,te=z?z.getAttribute("data-preset-key")||"":M;$r(X,te),Lr()},Or=q=>{if(!q||!Fi)return;let I=q.getAttribute("data-theme-value")||q.value||"",M=q.getAttribute("data-preset-key")||"";if(!I)return;let G=-1,z=Array.from(Fi.options||[]);if(z.forEach((te,K)=>{if(G!==-1||(te.value||"")!==I)return;(te.dataset&&te.dataset.presetKey?te.dataset.presetKey:"")===M&&(G=K)}),G===-1&&(G=z.findIndex(te=>(te.value||"")===I)),G<0||!z[G])return;let X=Fi.selectedIndex!==G;Fi.selectedIndex=G,X?Fi.dispatchEvent(new Event("change",{bubbles:!0})):gr()},Nr=()=>{if(!ur||!tn)return;let q=tn.selectedOptions&&tn.selectedOptions.length?tn.selectedOptions[0]:null,I=q&&q.textContent?q.textContent.trim():"";ur.textContent=I||Zi.dataset.placeholder||"Select model"},kr=()=>{if(!tn||!ga.length){Nr();return}let q=tn.value||"",I=!1;if(ga.forEach(M=>{let G=M.value===q;M.checked=G,G&&(I=!0)}),!I&&q){let M=ga.find(G=>G.value===q);M&&(M.checked=!0)}Nr()},Xr=q=>{if(!q||!tn)return;let I=q.value||"";if(!I)return;let G=Array.from(tn.options||[]).findIndex(X=>(X.value||"")===I);if(G<0){let X=new Option(I,I,!0,!0);tn.add(X),G=tn.options.length-1}let z=tn.selectedIndex!==G;tn.selectedIndex=G,z?tn.dispatchEvent(new Event("change",{bubbles:!0})):kr()},wr=()=>{if(!$o)return;let q=[],I=Gt(sn.popup_position),M=Gt(sn.popup_icon_style),G=Gt(sn.popup_icon_size);I&&q.push(I),M&&q.push(M),G&&q.push(G),$o.textContent=q.length>0?q.join(" \u2022 "):en.dataset.placeholder||"Position, style, size"},hr=()=>{if(!vn.length){wr();return}vn.forEach(q=>{let I=q.getAttribute("data-target-name");!I||!sn[I]||(q.checked=sn[I].value===q.value)}),wr()},Zr=q=>{if(!q)return;let I=q.getAttribute("data-target-name");if(!I)return;let M=sn[I];if(!(!M||M.disabled)){if(M.value===q.value){wr();return}M.value=q.value,M.dispatchEvent(new Event("change",{bubbles:!0})),wr()}},Qa=()=>{if(!zi)return;let q=ut=>{let Ct=zi.querySelector(ut);if(!Ct)return;let Ft=(Ct.getAttribute("data-default-url")||"").trim();if(!Ft)return;let qi=(Ct.value||"").trim(),pt=qi.toLowerCase();(!qi||(pt==="spark"||pt==="chat-bubble"||pt==="openai"||pt==="plus"||pt==="question-mark"))&&(Ct.value=Ft)},I=zi.querySelector('input[name="popup_icon_default"]:checked'),M=I&&I.value==="__custom__"?"custom":"default",G=zi.querySelector(".aipkit_popup_icon_custom_input_container");G&&(M==="custom"?(G.removeAttribute("hidden"),q('[name="popup_icon_custom_url"]')):G.setAttribute("hidden",""));let z=zi.querySelector('[name="popup_icon_type"]');z&&z.value!==M&&(z.value=M);let X=zi.querySelector('input[name="header_avatar_default"]:checked'),te=X&&X.value==="__custom__"?"custom":"default",K=zi.querySelector(".aipkit_header_avatar_custom_input_container");K&&(te==="custom"?(K.removeAttribute("hidden"),q('[name="header_avatar_url"]')):K.setAttribute("hidden",""));let V=zi.querySelector('[name="header_avatar_type"]');V&&V.value!==te&&(V.value=te);let Y=zi.querySelector('select[name="popup_icon_style"]');if(Y){let ut=zi.querySelectorAll('input[name="popup_icon_style"]');ut.length&&ut.forEach(Ct=>{Ct.checked=Ct.value===Y.value})}let ne=e.querySelector(".aipkit_popup_hint_toggle_switch"),de=ne?ne.checked:!1;e.querySelectorAll(".aipkit_popup_hint_config_btn").forEach(ut=>{ut.hidden=!de,de||ut.setAttribute("aria-expanded","false")}),!de&&Ee&&Ee.classList.contains("is-open")&&yr();let De=Ee||zi;if(De){De.querySelectorAll(".aipkit_popup_hint_extra").forEach(Ct=>{de?Ct.removeAttribute("hidden"):Ct.setAttribute("hidden","")});let ut=De.querySelector(".aipkit_popup_hint_conditional_row");ut&&(de?ut.removeAttribute("hidden"):ut.setAttribute("hidden",""))}hr()},yr=()=>{Ee&&(Ee.classList.remove("is-open"),Ee.setAttribute("aria-hidden","true"),Ne&&(Ne.setAttribute("aria-expanded","false"),Ne=null))},Rr=()=>{Me&&(Me.classList.remove("is-open"),Me.setAttribute("aria-hidden","true"),ii&&(ii.setAttribute("aria-expanded","false"),ii=null))},Dr=()=>{let q=Rt||Me;if(!q)return;let I=q.querySelector('[name="enable_consent_compliance"]'),M=I?I.tagName==="SELECT"?I.value==="1":I.checked:!1;q.querySelectorAll(".aipkit_consent_field_row").forEach(G=>{M?G.removeAttribute("hidden"):G.setAttribute("hidden","")}),R&&R.classList.contains("aipkit-active")&&Ue&&requestAnimationFrame(()=>{bo(Ue)})},Wr=()=>{let q=Rt||Me;if(!q)return;let I=q.querySelector('[name="openai_moderation_enabled"]'),M=I?I.tagName==="SELECT"?I.value==="1":I.checked:!1;q.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(G=>{M?G.removeAttribute("hidden"):G.setAttribute("hidden","")}),R&&R.classList.contains("aipkit-active")&&Ue&&requestAnimationFrame(()=>{bo(Ue)})},qr=()=>{let q=Rt||Me;if(!q)return;let I=e.querySelector(".aipkit_chatbot_provider_select"),G=(I?I.value:"")==="OpenAI";if(q.querySelectorAll(".aipkit_openai_moderation_row").forEach(X=>{X.style.display=G?"":"none"}),G){Wr();return}q.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(X=>{X.setAttribute("hidden","")})},Ir=()=>{ft&&(ft.classList.remove("is-open"),ft.setAttribute("aria-hidden","true"),Li&&(Li.setAttribute("aria-expanded","false"),Li=null))},Jo=()=>{Tt&&(Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true"),ki&&(ki.setAttribute("aria-expanded","false"),ki=null))},Hr=q=>{if(!Tt||!q)return;Tt.classList.contains("is-open")||(Tt.classList.add("is-open"),Tt.setAttribute("aria-hidden","false")),ki&&ki!==q&&ki.setAttribute("aria-expanded","false"),q.setAttribute&&q.setAttribute("aria-expanded","true"),ki=q,window.requestAnimationFrame(()=>{za(q)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_custom_theme_flyout")},Ja=q=>{if(!q)return;let I=q.querySelector(".aipkit_reasoning_effort_slider"),M=q.querySelector(".aipkit_reasoning_effort_label"),G=q.querySelector('input[name="reasoning_effort"]');if(!I||!M||!G)return;let z=()=>{let X=[],te=[];try{I.dataset.reasoningValues&&(X=JSON.parse(I.dataset.reasoningValues)),I.dataset.reasoningLabels&&(te=JSON.parse(I.dataset.reasoningLabels))}catch{X=[],te=[]}(!Array.isArray(X)||X.length===0)&&(X=["none","low","medium","high","xhigh"]),(!Array.isArray(te)||te.length===0)&&(te=X.slice());let K=parseInt(I.value,10),V=Number.isNaN(K)?0:Math.min(X.length-1,Math.max(0,K)),Y=X[V]||X[0],ne=te[V]||Y;G.value=Y,M.textContent=ne};z(),I.dataset.reasoningBound||(I.addEventListener("input",z),I.addEventListener("change",z),I.dataset.reasoningBound="1")},Yo=()=>{if(!N)return;let q=()=>{let De=N.querySelector(".aipkit_behavior_compact_row");if(!De)return;if(window.innerWidth<=960){De.style.gridTemplateColumns="";return}let ut=Array.from(De.querySelectorAll(".aipkit_behavior_compact_cell")).filter(Ft=>!Ft||Ft.hidden?!1:window.getComputedStyle(Ft).display!=="none"),Ct=Math.max(1,ut.length);De.style.gridTemplateColumns=`repeat(${Ct}, minmax(0, 1fr))`},I=e.querySelector(".aipkit_chatbot_provider_select"),M=I?I.value:"",G=M==="OpenAI",z=Jt(),X=xa("image_input"),te=M==="OpenAI"||M==="Claude"||M==="OpenRouter"&&X,K=N.querySelector(".aipkit_stateful_convo_checkbox"),V=N.querySelector(".aipkit_stateful_convo_group");K&&(K.disabled=!G),V&&(V.style.display=G?"":"none",V.removeAttribute("title"));let Y=N&&N.querySelector(".aipkit_reasoning_effort_field")||re&&re.querySelector(".aipkit_reasoning_effort_field");Y&&(Y.style.display=z?"":"none"),be();let ne=N&&N.querySelector(".aipkit_image_analysis_popover_row")||j&&j.querySelector(".aipkit_image_analysis_popover_row");if(ne&&(ne.style.display=te?"":"none"),M==="OpenRouter"&&!X){let De=j&&j.querySelector(".aipkit_image_analysis_select")||N&&N.querySelector(".aipkit_image_analysis_select")||F.querySelector(".aipkit_image_analysis_select"),ut=j&&j.querySelector(".aipkit_image_analysis_checkbox")||N&&N.querySelector(".aipkit_image_analysis_checkbox")||F.querySelector(".aipkit_image_analysis_checkbox");De&&De.value!=="0"?(De.value="0",De.dispatchEvent(new Event("change",{bubbles:!0}))):ut&&ut.checked&&(ut.checked=!1,ut.dispatchEvent(new Event("change",{bubbles:!0})))}oo(),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(re||N),q(),window.requestAnimationFrame(q);let de=N.querySelector(".aipkit_model_settings_panel:not([hidden])"),ke=de?de.querySelector(".aipkit_popover_options_list"):N.querySelector(".aipkit_popover_options_list");if(ke){let De=ke.querySelectorAll(".aipkit_popover_option_row");De.forEach(Ct=>Ct.classList.remove("aipkit_last_visible_row"));let ut=null;De.forEach(Ct=>{Ct.style.display!=="none"&&(ut=Ct)}),ut&&ut.classList.add("aipkit_last_visible_row")}R&&R.classList.contains("aipkit-active")&&Ue&&bo(Ue),e.dataset.behaviorCompactLayoutBound||(window.addEventListener("resize",q),e.dataset.behaviorCompactLayoutBound="1")};if(e.dataset.shortcodeCopyBound||(e.addEventListener("click",q=>{let I=q.target.closest(".aipkit_shortcode_pill");if(!I)return;let M=I.dataset.shortcode||I.querySelector(".aipkit_shortcode_text")?.textContent||"";M&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(M,I)}),e.dataset.shortcodeCopyBound="1"),e.dataset.embedCopyBound||(e.addEventListener("click",q=>{let I=q.target.closest(".aipkit_copy_embed_code_btn");if(!I)return;let M=I.dataset.target;if(!M)return;let G=document.getElementById(M);if(!G)return;let z=G.value||G.textContent||"";z&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(z,I)}),e.dataset.embedCopyBound="1"),O&&!e.dataset.accordionBound){let q=Array.from(O.querySelectorAll(".aipkit_accordion_section")),I=z=>{if(!z)return;let X=z.querySelector(".aipkit_accordion_header"),te=z.querySelector(".aipkit_accordion_body");!X||!te||(X.setAttribute("aria-expanded","false"),te.hidden=!0)},M=(z,X)=>{if(!z)return;let te=z.querySelector(".aipkit_accordion_header"),K=z.querySelector(".aipkit_accordion_body");if(!(!te||!K)&&(te.setAttribute("aria-expanded","true"),K.hidden=!1,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),X==="rules"&&typeof window.aipkit_initTriggerBuilderUI=="function")){let V=w&&w.value||e.getAttribute("data-active-bot-id");V&&V!=="__new__"&&window.aipkit_initTriggerBuilderUI(V)}};q.forEach(z=>{let X=z.querySelector(".aipkit_accordion_header"),te=z.querySelector(".aipkit_accordion_body");if(!X||!te)return;let K=z.getAttribute("data-aipkit-accordion")||"";X.setAttribute("aria-expanded","false"),te.hidden=!0,!(K==="rules"&&X.classList.contains("aipkit_builder_sheet_trigger"))&&X.addEventListener("click",()=>{if(X.getAttribute("aria-expanded")==="true"){I(z),n("");return}q.forEach(Y=>{Y!==z&&I(Y)}),M(z,K),n(K)})});let G=s();if(G&&G!=="rules"){let z=q.find(X=>(X.getAttribute("data-aipkit-accordion")||"")===G);z&&!z.hidden?M(z,G):n("")}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),Ja(O),io(),Yo(),nn(),e.dataset.accordionBound="1"}if(R&&!ie&&e.querySelectorAll(".aipkit_cb_ai_settings_toggle").forEach(I=>{I.classList.add("aipkit_model_settings_popover_trigger"),I.setAttribute("aria-haspopup","dialog"),I.setAttribute("aria-expanded","false"),I.setAttribute("aria-controls","aipkit_model_settings_popover"),I.setAttribute("aria-label",Ga),I.setAttribute("title",Ga)}),B&&w&&!e.dataset.botTabsBound&&(B.addEventListener("click",q=>{let I=q.target.closest(".aipkit_builder_bot_tab");if(!I)return;gi();let M=String(I.dataset.botId||"");if(!M||M===String(w.value||"")){Hi(w.value||"");return}w.value=M,w.dispatchEvent(new Event("change",{bubbles:!0}))}),W&&U&&(W.addEventListener("click",q=>{if(q.preventDefault(),W.hidden)return;if(W.getAttribute("aria-expanded")==="true"){gi();return}ji(),U.hidden=!1,W.setAttribute("aria-expanded","true");let M=U.querySelector(".aipkit_builder_bot_overflow_search_input");M&&typeof M.focus=="function"&&window.requestAnimationFrame(()=>{M.focus(),typeof M.select=="function"&&M.select()})}),U.addEventListener("click",q=>{let I=q.target.closest(".aipkit_builder_bot_overflow_item");if(!I)return;let M=String(I.dataset.botId||"");if(!M){gi();return}M!==String(w.value||"")?(w.value=M,w.dispatchEvent(new Event("change",{bubbles:!0}))):Hi(M),gi()}),U.addEventListener("input",q=>{let I=q.target.closest(".aipkit_builder_bot_overflow_search_input");I&&ti(I.value||"")}),document.addEventListener("click",q=>{!U||U.hidden||!$||q.target.closest(".aipkit_builder_bot_overflow")||gi()}),document.addEventListener("keydown",q=>{q.key==="Escape"&&gi()})),typeof ResizeObserver=="function"?(Q=new ResizeObserver(()=>{pi()}),Q.observe(B)):window.addEventListener("resize",pi),e.dataset.botTabsBound="1"),w){let q=w.value||"";Hi(q),w.addEventListener("change",async()=>{let I=w.value;if(!I){Hi(q);return}if(I==="__new__"){typeof H=="function"&&H();let G=q||e.getAttribute("data-active-bot-id")||"";if(G)w.value=G;else{let z=Array.from(w.options).find(X=>X.value&&X.value!=="__new__"&&!X.disabled);z&&(w.value=z.value,q=z.value)}Hi(w.value||q);return}q=I,Hi(I);try{localStorage.setItem(k,I)}catch(G){console.warn("AIPKit Chat Builder: Failed to store selected chatbot:",G)}let M=!1;try{M=await Mn(I)}catch{M=!1}!M&&typeof window.aipkit_loadModule=="function"&&(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),window.aipkit_loadModule("chatbot",{force_active_bot_id:I,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}))}),Vo()}if((L||w)&&!e.dataset.newBotActionBound){let q=!1;H=()=>{if(q||typeof window.aipkit_apiRequest!="function")return;let I=t("New Chatbot","gpt3-ai-content-generator");q=!0,L&&(L.disabled=!0),ot(t("Creating chatbot...","gpt3-ai-content-generator"),""),window.aipkit_apiRequest("aipkit_create_chatbot",{bot_name:I}).then(M=>{let G=M&&M.bot_id?String(M.bot_id):"";if(!G)throw new Error(t("Chatbot created but no bot ID was returned.","gpt3-ai-content-generator"));try{localStorage.setItem(k,G)}catch{}ot(M.message||t("Chatbot created successfully.","gpt3-ai-content-generator"),"success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:G,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(G),Oi()}).catch(M=>{ot(`Error: ${M.message||t("Failed to create chatbot.","gpt3-ai-content-generator")}`,"error"),Oi()}).finally(()=>{q=!1,L&&(L.disabled=!1)})},L&&L.addEventListener("click",H),e.dataset.newBotActionBound="1"}if(F&&!e.dataset.sheetBound){let q=M=>{if(!F)return;R&&R.classList.contains("aipkit-active")&&So();let G=M.dataset.sheetTitle||"Sheet",z=M.dataset.sheetDescription||"Settings will appear here.",X=M.dataset.sheetContent||"placeholder";if(_t&&(_t.textContent=G),mt&&(mt.textContent=z),Nt.length){let te=!1;Nt.forEach(K=>{let V=K.dataset.sheet===X;K.hidden=!V,V&&(te=!0)}),!te&&qe&&(qe.hidden=!1)}if(Wn&&(Wn.textContent="",Wn.classList.remove("success","error","loading"),Wn.style.display="none"),F.classList.add("aipkit-active"),F.setAttribute("aria-hidden","false"),qt&&qt.focus(),X==="sources"&&typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(),X==="triggers"&&typeof window.aipkit_initTriggerBuilderUI=="function"){let te=w&&w.value||e.getAttribute("data-active-bot-id");te&&te!=="__new__"&&window.aipkit_initTriggerBuilderUI(te)}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_sheet"),io(),Pn(),Yo(),Qa()},I=()=>{F.classList.remove("aipkit-active"),F.setAttribute("aria-hidden","true")};e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_builder_sheet_trigger");G&&(M.preventDefault(),G.closest('[data-aipkit-accordion="rules"]')&&n(""),q(G))}),qt&&qt.addEventListener("click",I),F.addEventListener("click",M=>{M.target===F&&I()}),document.addEventListener("keydown",M=>{M.key==="Escape"&&F.classList.contains("aipkit-active")&&I()}),e.dataset.sheetBound="1"}if(N&&!e.dataset.modelPopoverBound){R&&(e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_model_settings_popover_trigger");if(G){if(M.preventDefault(),M.stopPropagation(),R.classList.contains("aipkit-active")&&Ue===G){So();return}fr(G)}}),e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_style_settings_trigger");if(!G)return;M.preventDefault(),M.stopPropagation();let z=G.dataset.aipkitPanelTarget||"appearance";ka(z)})),e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_popover_params_config_btn");if(!G||(M.preventDefault(),!re))return;let z=!re.classList.contains("is-open");re.classList.toggle("is-open",z),re.setAttribute("aria-hidden",z?"false":"true"),Ie&&Ie!==G&&Ie.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",z?"true":"false"),Ie=z?G:null,z&&(window.requestAnimationFrame(()=>{_r(G)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_parameters_flyout"),Ja(re),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(re))}),e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_image_settings_config_btn");if(!G||(M.preventDefault(),!j))return;let z=!j.classList.contains("is-open");j.classList.toggle("is-open",z),j.setAttribute("aria-hidden",z?"false":"true"),ce&&ce!==G&&ce.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",z?"true":"false"),ce=z?G:null,z&&(window.requestAnimationFrame(()=>{so(G)}),Ua())}),e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_popup_hint_config_btn");if(!G||(M.preventDefault(),!Ee))return;let z=!Ee.classList.contains("is-open");Ee.classList.toggle("is-open",z),Ee.setAttribute("aria-hidden",z?"false":"true"),Ne&&Ne!==G&&Ne.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",z?"true":"false"),Ne=z?G:null,z&&window.requestAnimationFrame(()=>{zo(G)})}),e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_starters_config_btn");if(!G||(M.preventDefault(),!ft))return;let z=!ft.classList.contains("is-open");ft.classList.toggle("is-open",z),ft.setAttribute("aria-hidden",z?"false":"true"),Li&&Li!==G&&Li.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",z?"true":"false"),Li=z?G:null,z&&window.requestAnimationFrame(()=>{Ka(G)})}),e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_security_privacy_config_btn");if(!G||(M.preventDefault(),!Me))return;let z=!Me.classList.contains("is-open");Me.classList.toggle("is-open",z),Me.setAttribute("aria-hidden",z?"false":"true"),ii&&ii!==G&&ii.setAttribute("aria-expanded","false"),G.setAttribute("aria-expanded",z?"true":"false"),ii=z?G:null,z&&(window.requestAnimationFrame(()=>{ja(G)}),Dr(),qr())});let q=()=>{j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true"),ce&&(ce.setAttribute("aria-expanded","false"),ce=null))};ee&&ee.addEventListener("click",M=>{M.preventDefault(),q()}),Re&&Re.addEventListener("click",M=>{M.preventDefault(),yr()}),dt&&dt.addEventListener("click",M=>{M.preventDefault(),Rr()}),Xi&&Xi.addEventListener("click",M=>{M.preventDefault(),Ir()}),_i&&_i.addEventListener("click",M=>{M.preventDefault(),Jo()}),document.addEventListener("click",M=>{!j||!j.classList.contains("is-open")||M.target.closest(".aipkit_image_settings_config_btn")||M.target.closest("#aipkit_image_settings_flyout")||q()}),document.addEventListener("click",M=>{!Ee||!Ee.classList.contains("is-open")||M.target.closest(".aipkit_popup_hint_config_btn")||M.target.closest("#aipkit_popup_hint_flyout")||yr()}),document.addEventListener("click",M=>{!Me||!Me.classList.contains("is-open")||M.target.closest(".aipkit_security_privacy_config_btn")||M.target.closest("#aipkit_security_privacy_flyout")||Rr()}),document.addEventListener("click",M=>{!ft||!ft.classList.contains("is-open")||M.target.closest(".aipkit_starters_config_btn")||M.target.closest("#aipkit_starters_flyout")||Ir()}),document.addEventListener("click",M=>{!Tt||!Tt.classList.contains("is-open")||M.target.closest(".aipkit_theme_config_btn")||M.target.closest("[data-aipkit-theme-dropdown]")||M.target.closest('select[name="theme"]')||M.target.closest(".aipkit_builder_theme_select")||M.target.closest(".aipkit_theme_choice_group")||M.target.closest("#aipkit_custom_theme_flyout")||Jo()});let I=()=>{re&&(re.classList.remove("is-open"),re.setAttribute("aria-hidden","true"),Ie&&(Ie.setAttribute("aria-expanded","false"),Ie=null))};if(me&&me.addEventListener("click",M=>{M.preventDefault(),I()}),document.addEventListener("click",M=>{!re||!re.classList.contains("is-open")||M.target.closest(".aipkit_popover_params_config_btn")||M.target.closest("#aipkit_parameters_flyout")||I()}),J&&J.addEventListener("click",So),$e&&$e.addEventListener("click",()=>{ka("root")}),R&&R.addEventListener("click",M=>{M.target===R&&So()}),document.addEventListener("keydown",M=>{M.key==="Escape"&&R&&R.classList.contains("aipkit-active")&&So()}),N&&!N.dataset.footerActionsBound){let M=e.getAttribute("data-default-bot-id")||"",G=!1,z=K=>{N.querySelectorAll(".aipkit_popover_footer_btn").forEach(Y=>{Y.disabled=!!K})},X=()=>{let K=Array.from(w&&w.options||[]).map(Y=>String(Y&&Y.value||"").trim()).filter(Y=>Y&&Y!=="__new__"),V=[w?String(w.value||"").trim():"",String(e.getAttribute("data-active-bot-id")||"").trim(),String((e.querySelector("form.aipkit_chatbot_settings_form")||{}).dataset?.botId||"").trim(),String((e.querySelector(".aipkit_builder_bot_tab.is-active[data-bot-id]")||{}).dataset?.botId||"").trim()];for(let Y of V)if(!(!Y||Y==="__new__")&&/^\d+$/.test(Y)&&(!K.length||K.includes(Y)))return Y;return K[0]||""},te=K=>{let V=String(K||""),Y=Array.from(w&&w.options||[]).map(de=>String(de&&de.value||"")).filter(de=>de&&de!=="__new__");if(!Y.length)return"";let ne=Y.indexOf(V);if(ne===-1)return M&&String(M)!==V?String(M):Y[0]||"";for(let de=ne-1;de>=0;de-=1){let ke=Y[de];if(ke&&ke!==V)return ke}for(let de=ne+1;de<Y.length;de+=1){let ke=Y[de];if(ke&&ke!==V)return ke}return M&&String(M)!==V?String(M):""};N.addEventListener("click",K=>{let V=K.target.closest(".aipkit_popover_footer_btn");if(!V||(K.preventDefault(),G))return;let Y=V.getAttribute("data-action"),ne=X();if(!Y||!ne||typeof window.aipkit_apiRequest!="function"){Y&&typeof window.aipkit_apiRequest=="function"&&(ot(t("Error: Invalid chatbot selected.","gpt3-ai-content-generator"),"error"),Oi());return}if(Y==="delete"){if(V.disabled||ne===M)return;let de=te(ne);G=!0,z(!0),ot("Deleting...",""),window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:ne}).then(ke=>{ot(ke.message||"Deleted","success");try{de?localStorage.setItem(k,de):localStorage.removeItem(k)}catch{}if(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"){let De=String(de||M||""),ut={layout:f,aipkit_silent:!0,aipkit_force_refresh:!0};De&&De!==String(ne)?ut.force_active_bot_id=De:ut.force_active_tab="create",window.aipkit_loadModule("chatbot",ut)}else if(typeof window.aipkit_refreshChatPreview=="function"){let De=String(de||M||"");window.aipkit_refreshChatPreview(De||ne)}Oi()}).catch(ke=>{ot(`Error: ${ke.message||"Failed to delete."}`,"error"),Oi()}).finally(()=>{G=!1,z(!1)});return}if(Y==="duplicate"){G=!0,z(!0),ot("Duplicating...",""),window.aipkit_apiRequest("aipkit_duplicate_chatbot",{bot_id:ne}).then(de=>{let ke=String(de&&de.bot_id||"");if(ot(de.message||"Duplicated","success"),ke)try{localStorage.setItem(k,ke)}catch{}typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:ke||ne,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ke||ne),Oi()}).catch(de=>{ot(`Error: ${de.message||"Failed to duplicate."}`,"error"),Oi()}).finally(()=>{G=!1,z(!1)});return}Y==="reset"&&(G=!0,z(!0),ot("Resetting...",""),window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:ne}).then(de=>{ot(de.message||"Saved","success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:ne,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ne),Oi()}).catch(de=>{ot(`Error: ${de.message||"Failed to reset."}`,"error"),Oi()}).finally(()=>{G=!1,z(!1)}))}),N.dataset.footerActionsBound="1"}window.addEventListener("resize",()=>{R&&R.classList.contains("aipkit-active")&&Ue&&bo(Ue),Pt&&Pt.classList.contains("is-open")&&Ti&&No(Ti),Ut&&Ut.classList.contains("is-open")&&un&&Ro(un),Ei&&Ei.classList.contains("is-open")&&_n&&wa(_n),Ve&&Ve.classList.contains("is-open")&&Vi&&ha(Vi),j&&j.classList.contains("is-open")&&ce&&so(ce),Ee&&Ee.classList.contains("is-open")&&Ne&&zo(Ne),Me&&Me.classList.contains("is-open")&&ii&&ja(ii),ft&&ft.classList.contains("is-open")&&Li&&Ka(Li),Tt&&Tt.classList.contains("is-open")&&ki&&za(ki)}),window.addEventListener("scroll",()=>{R&&R.classList.contains("aipkit-active")&&Ue&&bo(Ue),Pt&&Pt.classList.contains("is-open")&&Ti&&No(Ti),Ut&&Ut.classList.contains("is-open")&&un&&Ro(un),Ei&&Ei.classList.contains("is-open")&&_n&&wa(_n),Ve&&Ve.classList.contains("is-open")&&Vi&&ha(Vi),j&&j.classList.contains("is-open")&&ce&&so(ce),Ee&&Ee.classList.contains("is-open")&&Ne&&zo(Ne),Me&&Me.classList.contains("is-open")&&ii&&ja(ii),ft&&ft.classList.contains("is-open")&&Li&&Ka(Li),Tt&&Tt.classList.contains("is-open")&&ki&&za(ki)},!0),e.dataset.modelPopoverBound="1"}if(xt&&$i&&!xt.dataset.autosaveBound){let q=xt.value,I=!1,M=null,G=V=>{Ye&&(Ye.textContent=`${V.length.toLocaleString()} characters`)},z=V=>{ze&&(ze.value=V,G(V))},X=V=>{let Y=w&&w.value||e.getAttribute("data-active-bot-id");Y&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_instructions",{bot_id:Y,instructions:V}).then(ne=>{q=V,xt.dataset.dirty="0",ot(ne.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Y),Oi()}).catch(ne=>{ot(`Error: ${ne.message||"Failed to save."}`,"error"),xt.dataset.dirty="1"}).finally(()=>{if(I=!1,M!==null&&M!==q){let ne=M;M=null,X(ne)}else M=null}))},te=()=>{!gt||!ze||(z(xt.value),gt.classList.add("aipkit-active"),gt.setAttribute("aria-hidden","false"),setTimeout(()=>ze.focus(),0))},K=V=>{if(!gt||(gt.classList.remove("aipkit-active"),gt.setAttribute("aria-hidden","true"),!V||!ze))return;let Y=ze.value;if(Y!==xt.value&&(xt.value=Y,xt.dataset.dirty="1"),xt.dataset.dirty==="1"){if(I){M=xt.value;return}X(xt.value)}};ze&&!ze.dataset.bound&&(ze.addEventListener("input",()=>{G(ze.value),xt.dataset.dirty="1"}),ze.dataset.bound="1"),gt&&!gt.dataset.bound&&(bi&&bi.addEventListener("click",te),It&&It.addEventListener("click",()=>{K(!0)}),document.addEventListener("keydown",V=>{V.key==="Escape"&&gt.classList.contains("aipkit-active")&&K(!0)}),gt.dataset.bound="1"),xt.addEventListener("input",()=>{xt.dataset.dirty="1"}),xt.addEventListener("blur",()=>{let V=xt.value;if(xt.dataset.dirty==="1"){if(V===q){xt.dataset.dirty="0";return}if(I){M=V;return}X(V)}}),xt.dataset.autosaveBound="1"}if(Go){let q=Go.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]"),I=G=>{G&&(q.forEach(z=>{let X=z.dataset.aipkitTab===G;z.classList.toggle("is-active",X),z.setAttribute("aria-selected",X?"true":"false")}),na.forEach(z=>{let X=z.dataset.aipkitPanel===G;z.classList.toggle("is-active",X),z.hidden=!X}),Rn&&(Rn.style.display=G==="files"?"none":""),Aa&&Aa.classList.toggle("aipkit_builder_action_row--end",G==="files"))},M=Go.querySelector(".aipkit_builder_tab.is-active");M&&I(M.dataset.aipkitTab),q.forEach(G=>{G.addEventListener("click",()=>{I(G.dataset.aipkitTab)})})}let co=e.querySelector('textarea[name="triggers_json"]'),Ya=e.querySelector(".aipkit_trigger_builder_container"),Wn=e.querySelector(".aipkit_triggers_status");if((co||Ya)&&$i&&!e.dataset.triggersAutosaveBound){let q=co?co.value:"[]",I=!1,M=null,G=null,z=()=>{let de=w&&w.value||e.getAttribute("data-active-bot-id");if(!de)return null;let ke="";if(typeof window.aipkit_getTriggerBuilderState=="function"){let De=window.aipkit_getTriggerBuilderState(de);De&&Array.isArray(De.triggers)&&(typeof window.aipkit_updateTriggersJsonForSave=="function"&&window.aipkit_updateTriggersJsonForSave(de,De.triggers),ke=co?co.value:JSON.stringify(De.triggers,null,2))}return!ke&&co&&(ke=co.value),ke||(ke="[]"),{botId:de,triggersJson:ke}},X=(de,ke)=>{Wn&&(Wn.textContent=de||"",Wn.classList.remove("success","error","loading"),ke&&Wn.classList.add(ke),Wn.style.display=de?"inline-block":"none")},te=()=>{Wn&&setTimeout(()=>{Wn.textContent="",Wn.classList.remove("success","error","loading"),Wn.style.display="none"},2500)},K=(de,ke)=>{ke&&(I=!0,ot("Auto-saving...",""),X("Saving...","loading"),window.aipkit_apiRequest("aipkit_update_chatbot_triggers",{bot_id:ke,triggers_json:de}).then(De=>{q=de,ot(De.message||"Saved","success"),X("Saved","success"),Oi(),te()}).catch(De=>{ot(`Error: ${De.message||"Failed to save."}`,"error"),X("Error","error"),te()}).finally(()=>{if(I=!1,M!==null&&M!==q){let De=M;M=null;let ut=z();ut&&K(De,ut.botId)}else M=null}))},V=de=>{if(de===q)return;if(I){M=de;return}let ke=z();ke&&K(de,ke.botId)},Y=()=>{G&&clearTimeout(G),G=setTimeout(()=>{let de=z();de&&V(de.triggersJson)},900)};typeof window.aipkit_requestTriggerAutosave!="function"&&(window.aipkit_requestTriggerAutosave=Y);let ne=de=>{de.target&&de.target.closest(".aipkit_trigger_builder_container")&&Y()};Ya&&(Ya.addEventListener("input",ne),Ya.addEventListener("change",ne),Ya.addEventListener("click",ne)),co&&(co.addEventListener("input",Y),co.addEventListener("blur",Y)),e.dataset.triggersAutosaveBound="1"}if(Pt&&!Pt.dataset.bound){let q=Pt.querySelector("#aipkit_builder_web_settings_title"),I=q?q.textContent.trim():t("Web search","gpt3-ai-content-generator"),M={openai:t("Web options (OpenAI)","gpt3-ai-content-generator"),google:t("Web options (Google)","gpt3-ai-content-generator"),claude:t("Web options (Claude)","gpt3-ai-content-generator"),openrouter:t("Web options (OpenRouter)","gpt3-ai-content-generator")},G=(te="")=>{if(!q)return;let K=String(te||"").trim().toLowerCase();q.textContent=M[K]||I},z=te=>{if(!Pt||!te)return;let K=String(te.dataset.webProvider||"").trim().toLowerCase();Pt.dataset.activeWebProvider=K,G(K),Pt.classList.add("is-open"),Pt.setAttribute("aria-hidden","false"),te.setAttribute("aria-expanded","true"),Ti=te,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_web_settings_modal"),io(),window.requestAnimationFrame(()=>{No(te)})},X=()=>{Pt.classList.remove("is-open"),Pt.setAttribute("aria-hidden","true"),delete Pt.dataset.activeWebProvider,G(""),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null)};e.addEventListener("click",te=>{let K=te.target.closest(".aipkit_web_search_config_btn");if(K){if(te.preventDefault(),Pt.classList.contains("is-open")&&Ti===K){X();return}z(K)}}),Tn&&Tn.addEventListener("click",X),document.addEventListener("click",te=>{Pt.classList.contains("is-open")&&(te.target.closest(".aipkit_web_search_config_btn")||te.target.closest("#aipkit_builder_web_settings_modal")||X())}),document.addEventListener("keydown",te=>{te.key==="Escape"&&Pt.classList.contains("is-open")&&X()}),Pt.dataset.bound="1"}if(Ut&&!Ut.dataset.bound){let q=M=>{!Ut||!M||(Ut.classList.add("is-open"),Ut.setAttribute("aria-hidden","false"),M.setAttribute("aria-expanded","true"),un=M,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_context_settings_modal"),oi(),window.requestAnimationFrame(()=>{Ro(M)}))},I=()=>{Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true"),un&&(un.setAttribute("aria-expanded","false"),un=null)};e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_vector_store_config_btn");if(G){if(M.preventDefault(),Ut.classList.contains("is-open")&&un===G){I();return}q(G)}}),Na&&Na.addEventListener("click",I),document.addEventListener("click",M=>{Ut.classList.contains("is-open")&&(M.target.closest(".aipkit_vector_store_config_btn")||M.target.closest("#aipkit_builder_context_settings_modal")||I())}),document.addEventListener("keydown",M=>{M.key==="Escape"&&Ut.classList.contains("is-open")&&I()}),Ut.dataset.bound="1"}if(Ei&&!Ei.dataset.bound){let q=M=>{!Ei||!M||(Ei.classList.add("is-open"),Ei.setAttribute("aria-hidden","false"),M.setAttribute("aria-expanded","true"),_n=M,Gi(),window.requestAnimationFrame(()=>{wa(M)}))},I=()=>{Ei.classList.remove("is-open"),Ei.setAttribute("aria-hidden","true"),_n&&(_n.setAttribute("aria-expanded","false"),_n=null)};e.addEventListener("click",M=>{let G=M.target.closest(".aipkit_limit_usage_config_btn");if(G){if(M.preventDefault(),Ei.classList.contains("is-open")&&_n===G){I();return}q(G)}}),Da&&Da.addEventListener("click",I),document.addEventListener("click",M=>{Ei.classList.contains("is-open")&&(M.target.closest(".aipkit_limit_usage_config_btn")||M.target.closest("#aipkit_builder_token_limits_modal")||I())}),document.addEventListener("keydown",M=>{M.key==="Escape"&&Ei.classList.contains("is-open")&&I()}),Ei.dataset.bound="1"}if(Ve&&!Ve.dataset.bound){let q=Ve.querySelector("#aipkit_builder_audio_settings_title"),I=q?q.textContent.trim():t("Audio","gpt3-ai-content-generator");q&&!q.dataset.defaultTitle&&(q.dataset.defaultTitle=I);let M={stt:t("Speech to Text options","gpt3-ai-content-generator"),tts:t("Text to Speech options","gpt3-ai-content-generator"),realtime:t("Realtime voice options","gpt3-ai-content-generator")},G=(te="")=>{if(!q)return;let K=String(te||"").trim().toLowerCase();q.textContent=M[K]||I},z=te=>{if(!Ve||!te)return;let K=String(te.dataset.audioFeature||"").trim().toLowerCase();Ve.dataset.activeAudioFeature=K,G(K),Ve.classList.add("is-open"),Ve.setAttribute("aria-hidden","false"),te.setAttribute("aria-expanded","true"),Vi=te,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_audio_settings_modal"),Pn(),typeof window.aipkit_syncAudioTtsOnOpen=="function"&&window.aipkit_syncAudioTtsOnOpen().catch(()=>{}),window.requestAnimationFrame(()=>{ha(te)})},X=()=>{Ve.classList.remove("is-open"),Ve.setAttribute("aria-hidden","true"),delete Ve.dataset.activeAudioFeature,G(""),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null)};e.addEventListener("click",te=>{let K=te.target.closest(".aipkit_audio_settings_config_btn");if(K){if(te.preventDefault(),Ve.classList.contains("is-open")&&Vi===K){X();return}z(K)}}),Wa&&Wa.addEventListener("click",X),document.addEventListener("click",te=>{Ve.classList.contains("is-open")&&(te.target.closest(".aipkit_audio_settings_config_btn")||te.target.closest("#aipkit_builder_audio_settings_modal")||X())}),document.addEventListener("keydown",te=>{te.key==="Escape"&&Ve.classList.contains("is-open")&&X()}),Ve.dataset.bound="1"}if(Wt&&$i&&!Wt.dataset.autosaveBound){let q=Wt.value.trim(),I=!1,M=null,G=X=>{if(!w)return;let te=w.options[w.selectedIndex];te&&(te.text=X),Hi(w.value||"")},z=X=>{let te=w&&w.value||e.getAttribute("data-active-bot-id");te&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:te,new_name:X}).then(K=>{let V=(K.new_name||X).trim();q=V,Wt.value=V,G(V),ot("Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(te),Oi()}).catch(K=>{ot(`Error: ${K.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,M!==null&&M!==q){let K=M;M=null,z(K)}else M=null}))};Wt.addEventListener("keydown",X=>{X.key==="Enter"&&(X.preventDefault(),Wt.blur())}),Wt.addEventListener("blur",()=>{let X=Wt.value.trim();if(!X){Wt.value=q,ot("Name cannot be empty.","error");return}if(X!==q){if(I){M=X;return}z(X)}}),Wt.dataset.autosaveBound="1"}if($i&&!e.dataset.modelAutosaveBound){let q=e.querySelector(".aipkit_chatbot_provider_select");if(q){let I=!1,M=null,G=V=>{if(!V)return"";let Y=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${V}"]`);if(!Y)return"";let ne=Y.querySelector("select");return ne?ne.value:""},z=q.value||"",X=G(z),te=(V,Y)=>{let ne=w&&w.value||e.getAttribute("data-active-bot-id");ne&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_model_settings",{bot_id:ne,provider:V,model:Y}).then(de=>{if(z=V,X=Y,ot(de.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ne),Oi(),typeof window.aipkit_requestChatbotModelSync=="function"){let ke=q?q.value||"":V,De=G(ke);ke===V&&De===Y&&window.aipkit_requestChatbotModelSync(V,{silent:!0})}}).catch(de=>{ot(`Error: ${de.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,M){let{provider:de,model:ke}=M;M=null,(de!==z||ke!==X)&&te(de,ke)}}))},K=(V,Y)=>{if(!(V===z&&Y===X)){if(I){M={provider:V,model:Y};return}te(V,Y)}};e.addEventListener("change",V=>{let Y=V.target;if(!Y)return;if(Y.matches(".aipkit_chatbot_provider_select")){let de=Y.value||"",ke=G(de);K(de,ke),R&&R.classList.contains("aipkit-active")&&So(),io(),Yo(),qr(),ni(),ct();return}let ne=Y.closest(".aipkit_chatbot_model_field select");if(ne){let de=q.value||"",ke=ne.value||"";K(de,ke),io(),Yo()}})}e.dataset.modelAutosaveBound="1"}if($i&&!e.dataset.deployWizardBound){let q=e.querySelector("[data-aipkit-top-mode-select]"),I=e.querySelector('textarea[name="embed_allowed_domains"]'),M=e.querySelector("[data-aipkit-appearance-popup-select]"),G=e.querySelector('select[name="aipkit_deploy_popup_scope"]'),z=Array.from(e.querySelectorAll("[data-aipkit-popup-options]")),X=Array.from(e.querySelectorAll(".aipkit_interface_popup_scope_row")),te=e.querySelector("[data-aipkit-popup-launcher-cell]"),K=te?te.closest(".aipkit_interface_theme_top_row--primary"):null;if(q||M||G||z.length){let V=pe=>pe==="popup"||pe==="external"?pe:"inline",Y=()=>M?M.value==="1"?"popup":"inline":z.some(pe=>!pe.hidden)?"popup":"inline",ne=()=>q?V(q.value):Y(),de=()=>G&&G.value==="sitewide"?"sitewide":"page",ke=pe=>{let Ge=e.querySelector(".aipkit_sidebar_toggle_group");if(!Ge)return;let fe=Ge.querySelector(".aipkit_sidebar_toggle_switch"),he=Ge.querySelector(".aipkit_interface_toggle_label");if(!fe)return;let tt=Ge.getAttribute("data-tooltip-disabled")||"";if(pe){if(fe.getAttribute("data-original-state")===null){let wt=fe.tagName==="SELECT"?fe.value==="1"?"checked":"unchecked":fe.checked?"checked":"unchecked";fe.setAttribute("data-original-state",wt)}fe.tagName==="SELECT"?fe.value="0":fe.checked=!1,fe.disabled=!0,Ge.setAttribute("title",tt),fe.setAttribute("title",tt),he&&he.setAttribute("title",tt),Ge.classList.add("aipkit-disabled-tooltip"),he&&(he.style.opacity="0.6")}else fe.disabled=!1,Ge.removeAttribute("title"),fe.removeAttribute("title"),he&&he.removeAttribute("title"),Ge.classList.remove("aipkit-disabled-tooltip"),he&&(he.style.opacity="1"),fe.getAttribute("data-original-state")==="checked"&&(fe.tagName==="SELECT"?fe.value="1":fe.checked=!0),fe.removeAttribute("data-original-state")},De=pe=>{let Ge=R||F;if(!Ge)return;let fe=Ge.querySelectorAll('[data-popup-only="header-identity"]');fe.length&&fe.forEach(he=>{he.hidden=!pe})},ut=pe=>{let Ge=e.querySelector(".aipkit_popup_status_text_group");if(!Ge)return;let fe=Ge.querySelector('input[name="header_online_text"]');if(!fe)return;let he=Ge.querySelector(".aipkit_popover_option_label"),tt=Ge.getAttribute("data-tooltip-disabled")||"";if(pe){fe.disabled=!1,Ge.removeAttribute("title"),fe.removeAttribute("title"),he&&he.removeAttribute("title"),Ge.classList.remove("aipkit-disabled-tooltip");return}fe.disabled=!0,tt&&(Ge.setAttribute("title",tt),fe.setAttribute("title",tt),he&&he.setAttribute("title",tt)),Ge.classList.add("aipkit-disabled-tooltip")},Ct=pe=>{te&&(te.hidden=!pe,te.setAttribute("aria-hidden",pe?"false":"true"),K&&K.classList.toggle("aipkit_interface_theme_top_row--no-launcher",!pe),pe||ya())},Ft=()=>{let pe=ne(),Ge=pe==="popup";M&&pe!=="external"&&(M.value=pe==="popup"?"1":"0"),z.forEach(fe=>{if(fe.hidden=!Ge,!Ge){let he=fe.querySelector(".aipkit_accordion_header"),tt=fe.querySelector(".aipkit_accordion_body");he&&tt&&(he.setAttribute("aria-expanded","false"),tt.hidden=!0),(fe.getAttribute("data-aipkit-accordion")||"")==="popup"&&s()==="popup"&&n("")}}),X.forEach(fe=>{fe.hidden=!Ge}),G&&(G.disabled=!Ge),ke(Ge),De(Ge),ut(Ge),Ct(Ge),Ee&&Ee.classList.contains("is-open")&&(Ge&&Ne?window.requestAnimationFrame(()=>{zo(Ne)}):yr())},qi=()=>{if(!rn)return;rn.classList.add("aipkit-active"),rn.setAttribute("aria-hidden","false");let pe=rn.querySelector('textarea[name="embed_allowed_domains"]')||rn.querySelector(".aipkit_copy_embed_code_btn");pe&&typeof pe.focus=="function"&&window.setTimeout(()=>pe.focus(),0)},pt=()=>{rn&&(rn.classList.remove("aipkit-active"),rn.setAttribute("aria-hidden","true"))},yi=null,Xt=!1,vt=null,Kt=()=>{let pe=ne(),Ge=Y(),he=(pe==="external"?Ge:pe)==="popup"?"1":"0",tt=he==="1"&&de()==="sitewide"?"1":"0",wt={popup_enabled:he,site_wide_enabled:tt};return I&&(wt.embed_allowed_domains=I.value||""),wt};yi=Kt();let st=pe=>{let Ge=w&&w.value||e.getAttribute("data-active-bot-id");if(!Ge||!pe)return;Xt=!0,ot("Auto-saving...","");let fe={bot_id:Ge,popup_enabled:pe.popup_enabled,site_wide_enabled:pe.site_wide_enabled};Object.prototype.hasOwnProperty.call(pe,"embed_allowed_domains")&&(fe.embed_allowed_domains=pe.embed_allowed_domains),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",fe).then(he=>{yi=pe,ot(he.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Ge),Oi()}).catch(he=>{ot(`Error: ${he.message||"Failed to save."}`,"error")}).finally(()=>{if(Xt=!1,vt){let he=vt;vt=null,(!yi||JSON.stringify(he)!==JSON.stringify(yi))&&st(he)}})},ge=pe=>{if(pe&&!(yi&&JSON.stringify(pe)===JSON.stringify(yi))){if(Xt){vt=pe;return}st(pe)}};if(q&&q.addEventListener("change",()=>{q.value=V(q.value),M&&q.value!=="external"&&(M.value=q.value==="popup"?"1":"0"),q.value==="external"?qi():pt(),Ft(),ge(Kt())}),M&&M.addEventListener("change",()=>{M.value=M.value==="1"?"1":"0",q&&q.value!=="external"&&(q.value=M.value==="1"?"popup":"inline"),Ft(),ge(Kt())}),G&&G.addEventListener("change",()=>{G.value=G.value==="sitewide"?"sitewide":"page",Ft(),ge(Kt())}),I){let pe=null,Ge=()=>{pe&&clearTimeout(pe),pe=setTimeout(()=>{ge(Kt())},350)};I.addEventListener("input",Ge),I.addEventListener("change",()=>{pe&&(clearTimeout(pe),pe=null),ge(Kt())}),I.addEventListener("blur",()=>{pe&&(clearTimeout(pe),pe=null),ge(Kt())})}rn&&rn.dataset.bound!=="1"&&(fa&&fa.addEventListener("click",pt),dr&&dr.addEventListener("click",pt),rn.addEventListener("click",pe=>{pe.target===rn&&pt()}),document.addEventListener("keydown",pe=>{pe.key==="Escape"&&rn.classList.contains("aipkit-active")&&pt()}),rn.dataset.bound="1"),Ft(),e.dataset.deployWizardBound="1"}}if(N&&$i&&!e.dataset.aiParamsAutosaveBound){let q=!1,I=null,M=()=>{let Y=De=>re&&re.querySelector(De)||N.querySelector(De),ne=Y('[name="temperature"]'),de=Y('[name="max_completion_tokens"]'),ke=Y('[name="max_messages"]');return{temperature:ne?ne.value:"",maxTokens:de?de.value:"",maxMessages:ke?ke.value:""}},{temperature:G,maxTokens:z,maxMessages:X}=M(),te=(Y,ne,de)=>{let ke=w&&w.value||e.getAttribute("data-active-bot-id");!ke||Y===""||ne===""||de===""||(q=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_ai_parameters",{bot_id:ke,temperature:Y,max_completion_tokens:ne,max_messages:de}).then(De=>{G=Y,z=ne,X=de,ot(De.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ke),Oi()}).catch(De=>{ot(`Error: ${De.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I){let{temperature:De,maxTokens:ut,maxMessages:Ct}=I;I=null,(De!==G||ut!==z||Ct!==X)&&te(De,ut,Ct)}}))},K=(Y,ne,de)=>{if(!(Y===G&&ne===z&&de===X)){if(q){I={temperature:Y,maxTokens:ne,maxMessages:de};return}te(Y,ne,de)}},V=Y=>{let ne=Y.target;if(ne&&(ne.matches('[name="temperature"]')||ne.matches('[name="max_completion_tokens"]')||ne.matches('[name="max_messages"]'))){let{temperature:de,maxTokens:ke,maxMessages:De}=M();K(de,ke,De)}};N.addEventListener("change",V),re&&re.addEventListener("change",V),e.dataset.aiParamsAutosaveBound="1"}if((Pt||N)&&$i&&!e.dataset.webSettingsAutosaveBound){let q=!1,I=null,M=()=>{let K=Y=>{let ne=Pt?Pt.querySelector(Y):null;return ne?ne.value:""},V=Y=>{let ne=N&&N.querySelector(Y)||e&&e.querySelector(Y)||Pt&&Pt.querySelector(Y);return ne?ne.tagName==="SELECT"?ne.value==="1"?"1":"0":ne.checked?"1":"0":"0"};return{openai_web_search_enabled:V(".aipkit_openai_web_search_enable_toggle"),openai_web_search_context_size:K('[name="openai_web_search_context_size"]'),openai_web_search_loc_type:K('[name="openai_web_search_loc_type"]'),openai_web_search_loc_country:K('[name="openai_web_search_loc_country"]'),openai_web_search_loc_city:K('[name="openai_web_search_loc_city"]'),openai_web_search_loc_region:K('[name="openai_web_search_loc_region"]'),openai_web_search_loc_timezone:K('[name="openai_web_search_loc_timezone"]'),claude_web_search_enabled:V(".aipkit_claude_web_search_enable_toggle"),claude_web_search_max_uses:K('[name="claude_web_search_max_uses"]'),claude_web_search_loc_type:K('[name="claude_web_search_loc_type"]'),claude_web_search_loc_country:K('[name="claude_web_search_loc_country"]'),claude_web_search_loc_city:K('[name="claude_web_search_loc_city"]'),claude_web_search_loc_region:K('[name="claude_web_search_loc_region"]'),claude_web_search_loc_timezone:K('[name="claude_web_search_loc_timezone"]'),claude_web_search_allowed_domains:K('[name="claude_web_search_allowed_domains"]'),claude_web_search_blocked_domains:K('[name="claude_web_search_blocked_domains"]'),claude_web_search_cache_ttl:K('[name="claude_web_search_cache_ttl"]'),openrouter_web_search_enabled:V(".aipkit_openrouter_web_search_enable_toggle"),openrouter_web_search_engine:K('[name="openrouter_web_search_engine"]'),openrouter_web_search_max_results:K('[name="openrouter_web_search_max_results"]'),openrouter_web_search_search_prompt:K('[name="openrouter_web_search_search_prompt"]'),google_search_grounding_enabled:V(".aipkit_google_search_grounding_enable_toggle"),web_toggle_default_on:V(".aipkit_web_toggle_default_on"),google_grounding_mode:K('[name="google_grounding_mode"]'),google_grounding_dynamic_threshold:K('[name="google_grounding_dynamic_threshold"]')}},G=M(),z=K=>{let V=w&&w.value||e.getAttribute("data-active-bot-id");V&&(q=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_web_settings",{bot_id:V,...K}).then(Y=>{G=K,ot(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I){let Y=I;I=null,JSON.stringify(Y)!==JSON.stringify(G)&&z(Y)}}))},X=K=>{if(JSON.stringify(K)!==JSON.stringify(G)){if(q){I=K;return}z(K)}},te=K=>{let V=K.target;V&&(V.matches(".aipkit_openai_web_search_enable_toggle")||V.matches(".aipkit_openai_web_search_loc_type_select")||V.matches('[name="openai_web_search_context_size"]')||V.matches('[name="openai_web_search_loc_country"]')||V.matches('[name="openai_web_search_loc_city"]')||V.matches('[name="openai_web_search_loc_region"]')||V.matches('[name="openai_web_search_loc_timezone"]')||V.matches(".aipkit_claude_web_search_enable_toggle")||V.matches(".aipkit_claude_web_search_loc_type_select")||V.matches('[name="claude_web_search_max_uses"]')||V.matches('[name="claude_web_search_loc_country"]')||V.matches('[name="claude_web_search_loc_city"]')||V.matches('[name="claude_web_search_loc_region"]')||V.matches('[name="claude_web_search_loc_timezone"]')||V.matches('[name="claude_web_search_allowed_domains"]')||V.matches('[name="claude_web_search_blocked_domains"]')||V.matches('[name="claude_web_search_cache_ttl"]')||V.matches(".aipkit_openrouter_web_search_enable_toggle")||V.matches('[name="openrouter_web_search_engine"]')||V.matches('[name="openrouter_web_search_max_results"]')||V.matches('[name="openrouter_web_search_search_prompt"]')||V.matches(".aipkit_google_search_grounding_enable_toggle")||V.matches(".aipkit_web_toggle_default_on")||V.matches(".aipkit_google_grounding_mode_select")||V.matches('[name="google_grounding_dynamic_threshold"]'))&&(io(),X(M()))};N&&N.addEventListener("change",te),Pt&&(!N||!N.contains(Pt))&&Pt.addEventListener("change",te),e.dataset.webSettingsAutosaveBound="1"}if((Ut||N)&&$i&&!e.dataset.contextSettingsAutosaveBound){let q=!1,I=null,M=()=>{let Z=ue=>{let ve=ye(),Le=ve?ve.querySelector(ue):null;return Le?Le.value:""},oe=ue=>{let ve=N&&N.querySelector(ue)||e&&e.querySelector(ue)||Ut&&Ut.querySelector(ue);return ve?ve.tagName==="SELECT"?ve.value==="1"?"1":"0":ve.checked?"1":"0":"0"},se=ue=>{let ve=ye(),Le=ve?ve.querySelector(ue):null;return Le?Array.from(Le.selectedOptions).map(Se=>Se.value).filter(Boolean):[]};return{enable_vector_store:oe(".aipkit_vector_store_enable_select"),vector_store_provider:Z('[name="vector_store_provider"]'),openai_vector_store_ids:se('select[name="openai_vector_store_ids[]"]'),pinecone_index_name:Z('[name="pinecone_index_name"]'),qdrant_collection_names:se('select[name="qdrant_collection_names[]"]'),vector_embedding_provider:Z('[name="vector_embedding_provider"]'),vector_embedding_model:Z('[name="vector_embedding_model"]'),vector_store_top_k:Z('[name="vector_store_top_k"]'),vector_store_confidence_threshold:Z('[name="vector_store_confidence_threshold"]'),content_aware_enabled:oe(".aipkit_content_aware_enable_select")}},G=M(),z=N&&N.closest(".aipkit_model_settings_popover")?.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline")||Ut&&Ut.querySelector(".aipkit_popover_flyout_header .aipkit_popover_status_inline")||Ut&&Ut.querySelector(".aipkit_popover_status_inline")||N&&N.querySelector(".aipkit_popover_status_inline")||null,X=(Z,oe)=>{z&&(z.textContent=Z||"",z.classList.remove("success","error","loading"),oe&&z.classList.add(oe),z.style.display=Z?"inline-block":"none")},te=()=>{z&&setTimeout(()=>{z.textContent="",z.classList.remove("success","error","loading"),z.style.display="none"},2500)},K=!1,V=null,Y={},ne=ye();ne&&ne.querySelectorAll('[name="pinecone_api_key"], [name="qdrant_url"], [name="qdrant_api_key"]').forEach(Z=>{Y[Z.name]=Z.value});let de=()=>{let{pineconeKeyInput:Z,qdrantUrlInput:oe,qdrantKeyInput:se}=nt(),ue=!!(Z&&Z.value.trim()||g),ve=!!(oe&&oe.value.trim()||h),Le=!!(se&&se.value.trim()||_);return{pinecone:ue,qdrant:ve&&Le}},ke=0,De=(Z,oe)=>Z?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(Z,{silent:!0,showErrors:!1,targetSelectId:oe,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,Z,{silent:!0,showErrors:!1,targetSelectId:oe,propagateError:!0}):null:null,ut=(Z,oe)=>{let se=++ke;X("Syncing...","loading");let ue=De(Z,oe);if(ue&&typeof ue.then=="function"){ue.then(()=>{ke===se&&(X("Synced","success"),te())}).catch(ve=>{ke===se&&X(`Error: ${ve.message||"Sync failed."}`,"error")});return}te()},Ct=Z=>{let oe=de();if(Z==="pinecone"&&oe.pinecone){let{pineconeIndexSelect:se}=nt();ut("PineconeIndexes",se?se.id:"")}else if(Z==="qdrant"&&oe.qdrant){let{qdrantCollectionsSelect:se}=nt();ut("QdrantCollections",se?se.id:"")}},Ft=Z=>{!Z||!Object.keys(Z).length||(K=!0,X("Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",Z).then(oe=>{Object.keys(Z).forEach(se=>{Y[se]=Z[se]}),Object.prototype.hasOwnProperty.call(Z,"pinecone_api_key")&&Ct("pinecone"),(Object.prototype.hasOwnProperty.call(Z,"qdrant_url")||Object.prototype.hasOwnProperty.call(Z,"qdrant_api_key"))&&Ct("qdrant"),X(oe.message||"Saved","success"),te()}).catch(oe=>{X(`Error: ${oe.message||"Failed to save."}`,"error")}).finally(()=>{if(K=!1,V){let oe=V;V=null,Ft(oe)}}))},qi=Z=>{if(!Z)return;let oe=Object.keys(Z).reduce((se,ue)=>(Z[ue]!==Y[ue]&&(se[ue]=Z[ue]),se),{});if(Object.keys(oe).length){if(K){V={...V||{},...oe};return}Ft(oe)}},pt=Z=>{let oe=w&&w.value||e.getAttribute("data-active-bot-id");oe&&(q=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_context_settings",{bot_id:oe,...Z}).then(se=>{G=Z,ot(se.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(oe),Oi()}).catch(se=>{ot(`Error: ${se.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I){let se=I;I=null,JSON.stringify(se)!==JSON.stringify(G)&&pt(se)}}))},yi=Z=>{if(JSON.stringify(Z)!==JSON.stringify(G)){if(q){I=Z;return}pt(Z)}},Xt=Z=>{let oe=Z.target;if(oe){if(oe.matches('[name="pinecone_api_key"]')||oe.matches('[name="qdrant_url"]')||oe.matches('[name="qdrant_api_key"]')){let se=oe.value||"";qi({[oe.name]:se}),ct(),qn(M());return}if(oe.matches(".aipkit_vector_store_enable_select")||oe.matches(".aipkit_vector_store_provider_select")||oe.matches('select[name="openai_vector_store_ids[]"]')||oe.matches('select[name="qdrant_collection_names[]"]')||oe.matches('[name="pinecone_index_name"]')||oe.matches(".aipkit_vector_embedding_select")||oe.matches('[name="vector_embedding_provider"]')||oe.matches('[name="vector_embedding_model"]')||oe.matches('[name="vector_store_top_k"]')||oe.matches('[name="vector_store_confidence_threshold"]')||oe.matches('[name="content_aware_enabled"]')){if(oe.matches(".aipkit_vector_embedding_select")&&rs(oe),oe.matches(".aipkit_vector_store_enable_select")&&(nn(),Ct(M().vector_store_provider)),oe.matches(".aipkit_vector_store_provider_select")&&(oi(),Ct(oe.value||""),ni(),ct()),oe.matches('[name="vector_embedding_provider"]')){let ue=ye();ue&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(ue),Pr(ue)}if(oe.matches('[name="vector_embedding_model"]')){let ue=ye();Pr(ue)}let se=M();yi(se),ct(),qn(se),ge(se),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(1)}}};N&&N.addEventListener("change",Xt),Ut&&Ut.addEventListener("change",Xt);let vt=(Z,oe)=>{Fn&&(Fn.textContent=Z||"",Fn.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),Z&&Fn.classList.add("is-visible"),oe&&Fn.classList.add(`is-${oe}`))},Kt=(Z=2500)=>{Fn&&setTimeout(()=>{Fn.textContent="",Fn.classList.remove("is-visible","is-success","is-error","is-warning","is-loading")},Z)},st=(Z,oe="info")=>{if(Un){if(typeof window.aipkit_showOpenAIVectorStatus=="function"){window.aipkit_showOpenAIVectorStatus(Z||"",oe,Un.id);return}Un.textContent=Z||""}},ge=(Z=null)=>{if(!pn)return;let oe=Z||M();if(!oe||oe.enable_vector_store!=="1"){pn.innerHTML='<option value=""></option>',pn.value="";return}let se="";oe.vector_store_provider==="openai"?se=(Array.isArray(oe.openai_vector_store_ids)?oe.openai_vector_store_ids.filter(Boolean):[])[0]||"":oe.vector_store_provider==="pinecone"?se=oe.pinecone_index_name||"":oe.vector_store_provider==="qdrant"&&(se=(Array.isArray(oe.qdrant_collection_names)?oe.qdrant_collection_names.filter(Boolean):[])[0]||""),pn.innerHTML=se?`<option value="${se}">${se}</option>`:'<option value=""></option>',pn.value=se,pn.dispatchEvent(new Event("change"))},pe=()=>$n&&$n.value||"bulk",Ge=Z=>{let oe=Z==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",se=document.getElementById(oe);return se?Array.from(se.selectedOptions).map(ue=>ue.value).filter(Boolean):[]},fe=Z=>{let oe=Z==="specific"?Mo:Po;return oe&&oe.value||"publish"},he=()=>{let Z=document.getElementById("aipkit_vs_wp_content_list_area");return Z?Array.from(Z.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(oe=>oe.value):[]},tt=(Z,oe,se)=>{if(!oe)return;oe.innerHTML="";let ue=Number(Z?.total_posts||0),ve=Number(Z?.total_pages||0),Le=Number(Z?.current_page||1);if(!ue)return;let Se=document.createElement("span");if(Se.className="aipkit_pagination-count",Se.textContent=`${ue.toLocaleString()} ${p("item","items",ue,"gpt3-ai-content-generator")}`,oe.appendChild(Se),ve<=1)return;let Je=document.createElement("span");Je.className="aipkit_pagination-links";let lt=document.createElement("button");lt.type="button",lt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",lt.textContent=t("Prev","gpt3-ai-content-generator"),lt.disabled=Le<=1,lt.addEventListener("click",()=>se(Le-1));let wi=document.createElement("span");wi.className="aipkit_pagination-current",wi.textContent=`${Le}/${ve}`;let $t=document.createElement("button");$t.type="button",$t.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",$t.textContent=t("Next","gpt3-ai-content-generator"),$t.disabled=Le>=ve,$t.addEventListener("click",()=>se(Le+1)),Je.appendChild(lt),Je.appendChild(wi),Je.appendChild($t),oe.appendChild(Je)},wt=(Z,oe)=>{if(!Dn)return;if(Dn.innerHTML="",!Array.isArray(Z)||!Z.length){let Se=document.createElement("p");Se.className="aipkit_builder_help_text",Se.textContent=t("No posts found for selection.","gpt3-ai-content-generator"),Dn.appendChild(Se),sa&&(sa.innerHTML="");return}let se=document.createElement("ul"),ue=document.createElement("div");ue.className="aipkit_wp_content_select_all_wrapper";let ve=document.createElement("label");ve.className="aipkit_training_site_option";let Le=document.createElement("input");Le.type="checkbox",Le.checked=Z.every(Se=>an.selectedIds.has(String(Se.id))),ve.appendChild(Le),ve.appendChild(document.createTextNode(t("Select all","gpt3-ai-content-generator"))),ue.appendChild(ve),Dn.appendChild(ue),Dn.appendChild(se),Z.forEach(Se=>{let Je=document.createElement("li");Je.className="aipkit_wp_content_list_item";let lt=document.createElement("input");lt.type="checkbox",lt.name="wp_content_to_index[]",lt.value=String(Se.id),lt.checked=an.selectedIds.has(String(Se.id)),lt.addEventListener("change",()=>{lt.checked?an.selectedIds.add(String(Se.id)):an.selectedIds.delete(String(Se.id)),Le.checked=Z.every(wn=>an.selectedIds.has(String(wn.id)))});let wi=document.createElement("a");wi.className="aipkit_wp_content_title",wi.href=Se.edit_link||"#",wi.target="_blank",wi.rel="noopener noreferrer",wi.textContent=Se.title||t("Untitled","gpt3-ai-content-generator");let $t=document.createElement("span");$t.className="aipkit_wp_content_type",$t.textContent=Se.type_label||"";let vi=document.createElement("span");vi.className="aipkit_wp_content_indexed_status",vi.textContent=Se.is_already_indexed?t("Indexed","gpt3-ai-content-generator"):"",Je.appendChild(lt),Je.appendChild(wi),Je.appendChild($t),Je.appendChild(vi),se.appendChild(Je)}),Le.addEventListener("change",()=>{Le.checked?Z.forEach(Se=>an.selectedIds.add(String(Se.id))):Z.forEach(Se=>an.selectedIds.delete(String(Se.id))),Dn.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(Se=>{Se.checked=Le.checked})}),tt(oe,sa,ai)},ai=async Z=>{if(!Dn)return;let oe=pe(),se=Ge(oe);if(!se.length){Dn.innerHTML="",sa&&(sa.innerHTML=""),st(t("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let ue=Ri("aipkit_wp_content_fetch_nonce");if(!ue){st(t("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let ve=fe(oe),Le=pn&&pn.value||"";try{st(t("Loading content...","gpt3-ai-content-generator"),"");let Se=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ue,post_types:se,post_status:ve,target_store_id:Le,paged:Z});an.page=Z,wt(Se.posts||[],Se.pagination||{}),st("","")}catch(Se){st(Se&&Se.message?Se.message:t("Failed to load content.","gpt3-ai-content-generator"),"error")}},Zt=Z=>{$n&&($n.value=Z),Fo&&(Fo.hidden=Z!=="bulk"),nr&&(nr.hidden=Z!=="specific"),ir&&(ir.hidden=Z!=="specific"),da&&(da.hidden=Z!=="bulk"),sr&&(sr.hidden=Z!=="specific"),Yt&&(Yt.hidden=Z!=="bulk"),Z==="specific"&&ai(1)},ri=()=>{e.querySelectorAll(".aipkit_training_site_dropdown").forEach(oe=>{let se=oe.querySelector(".aipkit_training_site_dropdown_btn"),ue=oe.querySelector(".aipkit_training_site_dropdown_label"),ve=oe.querySelector(".aipkit_training_site_dropdown_panel"),Se=oe.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Je=document.getElementById(Se);if(!se||!ve||!Je)return;let lt=()=>{let $t=ve.querySelectorAll('input[type="checkbox"]:checked'),vi=oe.dataset.placeholder||t("Select types","gpt3-ai-content-generator"),wn=oe.dataset.selectedLabel||t("selected","gpt3-ai-content-generator");ue&&($t.length?ue.textContent=`${$t.length} ${wn}`:ue.textContent=vi)},wi=()=>{let $t=Array.from(ve.querySelectorAll('input[type="checkbox"]:checked')).map(vi=>vi.value);Array.from(Je.options).forEach(vi=>{vi.selected=$t.includes(vi.value)})};se.addEventListener("click",()=>{let $t=se.getAttribute("aria-expanded")==="true";se.setAttribute("aria-expanded",$t?"false":"true"),ve.hidden=$t}),ve.addEventListener("change",()=>{wi(),lt(),pe()==="specific"&&ai(1)}),document.addEventListener("click",$t=>{oe.contains($t.target)||(se.setAttribute("aria-expanded","false"),ve.hidden=!0)}),wi(),lt()})},Qt=async(Z,oe,se)=>{let ue=Ri("aipkit_wp_content_fetch_nonce");if(!ue||!Z.length)return{total:0};let ve=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ue,post_types:Z,post_status:oe,target_store_id:se||"",paged:1}),Le=parseInt(ve?.pagination?.total_posts||0,10);return{total:Number.isNaN(Le)?0:Le,totalPages:parseInt(ve?.pagination?.total_pages||1,10)}},Mi=async(Z,oe,se)=>{let ue=Ri("aipkit_wp_content_fetch_nonce");if(!ue)throw new Error("WP content fetch nonce missing.");let ve=[],Le=1,Se=1;do{let Je=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ue,post_types:Z,post_status:oe,target_store_id:se||"",paged:Le}),lt=Array.isArray(Je?.posts)?Je.posts:[];lt.length&&(window.aipkit_wpContentTitleMap=window.aipkit_wpContentTitleMap||{},lt.forEach($t=>{$t&&$t.id&&(window.aipkit_wpContentTitleMap[String($t.id)]=$t.title||window.aipkit_wpContentTitleMap[String($t.id)]||"")})),ve.push(...lt.map($t=>String($t.id)));let wi=parseInt(Je?.pagination?.total_pages||1,10);Se=Number.isNaN(wi)?1:wi,st(`Preparing... collected ${ve.length} item(s).`,"info"),Le+=1}while(Le<=Se);return ve},Ci=(Z,oe)=>Z<=200||oe!=="publish"?Promise.resolve(!1):new Promise(se=>{let ue=document.getElementById("aipkit_background_indexing_confirm"),ve=document.getElementById("aipkit_background_indexing_message"),Le=document.getElementById("aipkit_background_indexing_yes"),Se=document.getElementById("aipkit_background_indexing_no"),Je=document.getElementById("aipkit_wp_content_bulk_hint");if(!ue||!ve||!Le||!Se){se(window.confirm(`You're about to index ${Z} items. Run in the background?`));return}ve.textContent=`You're about to index ${Z} items. Run in the background?`,Je&&(Je.hidden=!0),ue.hidden=!1;let lt=()=>{ue.hidden=!0,Je&&(Je.hidden=!1),Le.removeEventListener("click",wi),Se.removeEventListener("click",$t)},wi=()=>{lt(),se(!0)},$t=()=>{lt(),se(!1)};Le.addEventListener("click",wi),Se.addEventListener("click",$t)}),Yi=async({botId:Z,postTypes:oe,provider:se,targetStoreId:ue,embeddingProvider:ve,embeddingModel:Le})=>{let Se=window.aipkit_chat_config?.automationsNonce||"";if(!Se)throw new Error("Automations nonce missing.");let Je=`Chatbot ${Z} website indexing`,lt={_ajax_nonce:Se,task_id:0,task_name:Je,task_type:"content_indexing",task_status:"active",task_frequency:"one-time",index_existing_now_flag:"1",only_new_updated_flag:"0",post_types:oe,target_store_provider:se,target_store_id:ue};return(se==="pinecone"||se==="qdrant")&&(lt.embedding_provider=ve||"",lt.embedding_model=Le||""),window.aipkit_apiRequest("aipkit_save_automated_task",lt)};if($n&&!e.dataset.trainingWebsiteBound){if(typeof window.aipkit_initWpContentModeToggle=="function"&&window.aipkit_initWpContentModeToggle(),Xn&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&!Xn.dataset.listenerAttached&&(Xn.addEventListener("click",()=>{window.aipkit_fetchWordPressContentForTraining(1)}),Xn.dataset.listenerAttached="true"),typeof window.aipkit_updatePostTypeCounts=="function"&&(window.aipkit_updatePostTypeCounts(),Po&&!Po.dataset.listenerAttached&&(Po.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),Po.dataset.listenerAttached="true"),pn&&!pn.dataset.listenerAttached&&(pn.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),pn.dataset.listenerAttached="true")),ge(M()),ri(),Bo.length){Bo.forEach(oe=>{oe.dataset.listenerAttached||(oe.addEventListener("change",()=>{Zt(oe.value)}),oe.dataset.listenerAttached="true")});let Z=Array.from(Bo).find(oe=>oe.checked);Zt(Z?Z.value:pe())}else Zt(pe());Mo&&!Mo.dataset.listenerAttached&&(Mo.addEventListener("change",()=>{pe()==="specific"&&ai(1)}),Mo.dataset.listenerAttached="true"),pn&&!pn.dataset.websiteListenerAttached&&(pn.addEventListener("change",()=>{pe()==="specific"&&ai(1)}),pn.dataset.websiteListenerAttached="true"),e.dataset.trainingWebsiteBound="1"}let Co=Z=>`${Z.name}::${Z.size}::${Z.lastModified}`,lo=Z=>{if(!Number.isFinite(Z)||Z<=0)return"0 KB";let oe=["B","KB","MB","GB"],se=Z,ue=0;for(;se>=1024&&ue<oe.length-1;)se/=1024,ue+=1;let ve=ue===0?0:1;return`${se.toFixed(ve)} ${oe[ue]}`},jn=()=>zn&&zn.dataset.upgradeUrl||"",Hn=()=>{if(!Lo)return;let Z=Qn.size>0;Lo.style.display=Z?"none":""},Xa=(Z=1500)=>{zn&&(mo&&window.clearTimeout(mo),mo=window.setTimeout(()=>{Qn.clear(),zn.innerHTML="",An&&(An.value=""),Hn(),mo=null},Z))},br=()=>Qn.size?Array.from(Qn.values()).every(Z=>{let oe=Z.querySelector(".aipkit_training_file_status");return oe?oe.classList.contains("is-success")||oe.classList.contains("is-error"):!1}):!1,Sr=()=>{mo&&!br()&&(window.clearTimeout(mo),mo=null),br()&&Xa(),Hn()},Sa=Z=>{if(!zn)return null;let oe=Co(Z);if(Qn.has(oe))return Qn.get(oe);let se=document.createElement("div");se.className="aipkit_training_file_row",se.dataset.fileKey=oe;let ue=document.createElement("div");ue.className="aipkit_training_file_meta";let ve=document.createElement("span");ve.className="aipkit_training_file_name",ve.textContent=Z.name;let Le=document.createElement("span");Le.className="aipkit_training_file_size",Le.textContent=lo(Z.size);let Se=document.createElement("span");return Se.className="aipkit_training_file_status",Se.textContent="Queued",ue.appendChild(ve),ue.appendChild(Le),se.appendChild(ue),se.appendChild(Se),zn.appendChild(se),Qn.set(oe,se),se},on=(Z,oe,se)=>{let ue=Sa(Z);if(!ue)return;let ve=ue.querySelector(".aipkit_training_file_status");if(ve){if(ve.textContent="",ve.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),se&&ve.classList.add(`is-${se}`),oe==="Upgrade"&&jn()){ve.classList.add("is-upgrade");let Le=document.createElement("a");Le.className="aipkit_training_file_upgrade",Le.href=jn(),Le.textContent=oe,ve.appendChild(Le)}else ve.textContent=oe;Sr()}},Xo=async(Z,oe=null)=>{if(!Z||!Z.name||typeof window.aipkit_apiRequest!="function")return!1;let se=w&&w.value||e.getAttribute("data-active-bot-id");if(!se)return!1;let ue=oe||M();if(!ue||ue.enable_vector_store!=="1")return!1;let ve=String(Z.name||"").trim();if(!ve)return!1;let Le=vi=>String(vi||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),Se=Le(ve),Je=ve.replace(/\.[^/.]+$/,""),lt=[ve,Se,Je&&Je!==ve?Je:""].filter(Boolean),wi=async(vi,wn)=>{let mn=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",{bot_id:se,page:1,per_page:wn,search:vi||"",enable_vector_store:ue.enable_vector_store,vector_store_provider:ue.vector_store_provider,openai_vector_store_ids:ue.openai_vector_store_ids||[],pinecone_index_name:ue.pinecone_index_name,qdrant_collection_names:ue.qdrant_collection_names||[]});return Array.isArray(mn.logs)?mn.logs:[]},$t=(vi,wn)=>{if(!vi.length)return null;let mn=wn.map(Le).filter(Boolean);return vi.find(In=>{let xo=Le(In.message),Ni=Le(In.post_title),Xe=Le(In.file_id);return mn.some(ht=>xo&&xo.includes(ht)||Ni&&Ni.includes(ht)||Xe&&Xe.includes(ht))})||null};try{for(let mn of lt){let In=await wi(mn,10),xo=$t(In,[mn,Se]);if(xo){let Ni=String(xo.status||"").toLowerCase();if(Ni==="indexed"||Ni==="skipped_already_indexed")return on(Z,"Trained","success"),!0;if(Ni==="failed")return on(Z,"Failed","error"),!0;if(Ni==="processing"||Ni==="queued")return on(Z,"Processing","loading"),!0}}let vi=await wi("",20),wn=$t(vi,lt);if(wn){let mn=String(wn.status||"").toLowerCase();if(mn==="indexed"||mn==="skipped_already_indexed")return on(Z,"Trained","success"),!0;if(mn==="failed")return on(Z,"Failed","error"),!0;if(mn==="processing"||mn==="queued")return on(Z,"Processing","loading"),!0}}catch{}return!1},Zo=(Z,oe,se,ue=0)=>{if(!Z||!oe||!se)return;if(ue>=30){Xo(se,M()).then(Se=>{Se||on(se,"Queued","warning")});return}let Le=Ri("aipkit_vector_store_nonce_openai");if(!Le||typeof window.aipkit_apiRequest!="function"){Xo(se,M());return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:Z,batch_id:oe,_ajax_nonce:Le}).then(Se=>{let Je=(Se.status||"").toLowerCase();if(Je==="completed"){on(se,"Trained","success"),qn(M()),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}if(Je==="failed"||Je==="cancelled"){on(se,"Failed","error");return}on(se,"Processing","loading"),setTimeout(()=>{Zo(Z,oe,se,ue+1)},2500)}).catch(()=>{setTimeout(()=>{Zo(Z,oe,se,ue+1)},3e3)})},po=Z=>{if(!kn)return;let oe=kn.dataset.baseLabel||kn.querySelector(".aipkit_training_sources_label")?.textContent.trim()||kn.textContent.replace(/\(\d+\)/,"").trim(),se=Number.isFinite(Z)?Z:0,ue=kn.querySelector(".aipkit_training_sources_count");ue?(ue.textContent=String(se),kn.setAttribute("aria-label",`${oe} (${se})`)):kn.textContent=`${oe} (${se})`},qn=async(Z=null)=>{if(!kn||typeof window.aipkit_apiRequest!="function")return;if(Z&&Z.enable_vector_store!=="1"){po(0);return}let oe=Z?Z.vector_store_provider:"";if(oe==="openai"&&!(Array.isArray(Z.openai_vector_store_ids)?Z.openai_vector_store_ids:[]).length){po(0);return}if(oe==="pinecone"&&!Z.pinecone_index_name){po(0);return}if(oe==="qdrant"&&!(Array.isArray(Z.qdrant_collection_names)?Z.qdrant_collection_names:[]).length){po(0);return}let se=w&&w.value||e.getAttribute("data-active-bot-id");if(!se){po(0);return}try{let ue={bot_id:se};Z&&(ue.enable_vector_store=Z.enable_vector_store,ue.vector_store_provider=Z.vector_store_provider,ue.openai_vector_store_ids=Z.openai_vector_store_ids||[],ue.pinecone_index_name=Z.pinecone_index_name,ue.qdrant_collection_names=Z.qdrant_collection_names||[]);let ve=await window.aipkit_apiRequest("aipkit_get_chatbot_training_source_count",ue),Le=Number(ve.count||0);po(Number.isNaN(Le)?0:Le)}catch{}};window.aipkit_refreshTrainingSourcesCount=()=>{qn(M())};let Za=()=>{if(!kn||e.dataset.trainingAutoSync)return;let Z=()=>{document.visibilityState==="visible"&&qn(M())},oe=window.setInterval(Z,6e4);e.dataset.trainingAutoSync="1",e.dataset.trainingAutoSyncInterval=String(oe),document.addEventListener("visibilitychange",Z)},Ri=Z=>{let oe=document.getElementById(Z);return oe?oe.value:""},Ea=Z=>{let oe=String(Z),se=window.aipkit_wpContentTitleMap||{};if(se&&se[oe])return se[oe];if(Dn){let ue=Dn.querySelector(`input[name="wp_content_to_index[]"][value="${oe}"]`);if(ue){let ve=ue.closest(".aipkit_wp_content_list_item"),Le=ve?ve.querySelector(".aipkit_wp_content_title"):null,Se=Le?Le.textContent.trim():"";if(Se)return Se}}return`${t("Post","gpt3-ai-content-generator")} ${oe}`},Tr=(Z,oe,se)=>{let ue=Ea(Z);return`${t("Training","gpt3-ai-content-generator")}: ${ue} (${oe+1}/${se})`},Gr=async Z=>{let oe=Ri("aipkit_wp_content_fetch_nonce");if(!oe)throw new Error("WP content fetch nonce missing.");let se=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:oe,get_content_for_ids:[String(Z)]});return(se&&se.posts_content?se.posts_content:{})[String(Z)]||null},Kr=async(Z,oe,se)=>{if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let ue=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Z,embedding_provider:oe,embedding_model:se,_ajax_nonce:window.aipkit_dashboard.nonce}),ve=ue.embeddings&&ue.embeddings.length?ue.embeddings[0]:null;if(!ve)throw new Error("Failed to generate embedding.");return ve},ts=async(Z,oe)=>{let se=Array.isArray(Z)?Z:[];if(se.length)for(let ue=0;ue<se.length;ue+=1){if(window.aipkit_isIndexingStopped){st(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let ve=se[ue];st(Tr(ve,ue,se.length),"info"),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{...oe,post_ids:[ve]})}},is=async(Z,oe)=>{let se=Array.isArray(Z)?Z:[];if(se.length)for(let ue=0;ue<se.length;ue+=1){if(window.aipkit_isIndexingStopped){st(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let ve=se[ue]||{},Le=ve.postId||ve.id;if(!Le)continue;st(Tr(Le,ue,se.length),"info");let Se=await Gr(Le);if(!Se||!Se.content)continue;let Je=ve.metadata&&ve.metadata.vector_id||`wp_post_${Le}`,lt={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Le,title:Se.title||"",url:Se.edit_link||"",vector_id:Je},wi=await Kr(Se.content,oe.embedding_provider,oe.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:oe._ajax_nonce,vectors:JSON.stringify([{id:Je,values:wi,metadata:lt}]),embedding_provider:oe.embedding_provider,embedding_model:oe.embedding_model,original_text_content:Se.content,index_name:oe.index_name})}},ns=async(Z,oe)=>{let se=Array.isArray(Z)?Z:[];if(se.length)for(let ue=0;ue<se.length;ue+=1){if(window.aipkit_isIndexingStopped){st(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let ve=se[ue]||{},Le=ve.postId||ve.id;if(!Le)continue;st(Tr(Le,ue,se.length),"info");let Se=await Gr(Le);if(!Se||!Se.content)continue;let Je=c(),lt={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Le,title:Se.title||"",url:Se.edit_link||"",vector_id:Je},wi=await Kr(Se.content,oe.embedding_provider,oe.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",{_ajax_nonce:oe._ajax_nonce,vectors:JSON.stringify([{id:Je,vector:wi,payload:lt}]),embedding_provider:oe.embedding_provider,embedding_model:oe.embedding_model,original_text_content:Se.content,collection_name:oe.collection_name,source_context:"chatbot_settings_website"})}};typeof window.aipkit_indexOpenAIBatch!="function"&&(window.aipkit_indexOpenAIBatch=ts),typeof window.aipkit_indexPineconeBatch!="function"&&(window.aipkit_indexPineconeBatch=is),typeof window.aipkit_indexQdrantBatch!="function"&&(window.aipkit_indexQdrantBatch=ns);let Er=Z=>Z?Array.isArray(Z)?Z.flatMap(oe=>{if(Array.isArray(oe))return oe;if(oe&&typeof oe=="object"){if(Array.isArray(oe.models))return oe.models;if(Array.isArray(oe.items))return oe.items;if(oe.id)return[oe]}return[]}):typeof Z=="object"?Object.values(Z).flatMap(oe=>Array.isArray(oe)?oe:[]):[]:[],jr=Z=>{let oe=window.aipkit_chat_config||{};return Z==="openai"?Er(oe.openaiEmbeddingModels):Z==="google"?Er(oe.googleEmbeddingModels):Z==="openrouter"?Er(oe.openrouterEmbeddingModels):Z==="azure"?Er(oe.azureEmbeddingModels):[]},os=(Z,oe)=>!Z||!oe?"":`${Z}::${oe}`,as=Z=>{let oe=(Z||"").split("::"),se=oe.shift()||"",ue=oe.join("::")||"";return{provider:se,model:ue}},Pr=Z=>{if(!Z)return;let oe=Z.querySelector(".aipkit_vector_embedding_select");if(!oe)return;let se=Z.querySelector('[name="vector_embedding_provider"]'),ue=Z.querySelector('[name="vector_embedding_model"]'),ve=se?se.value:"",Le=ue?ue.value:"",Se=os(ve,Le);if(!Se||oe.value===Se)return;let Je=typeof CSS<"u"&&CSS.escape?CSS.escape(Se):Se.replace(/"/g,'\\"');oe.querySelector(`option[value="${Je}"]`)&&(oe.value=Se)},rs=Z=>{let oe=ye();if(!oe||!Z)return;let se=oe.querySelector('[name="vector_embedding_provider"]'),ue=oe.querySelector('[name="vector_embedding_model"]'),ve=Z.selectedOptions[0],Le=as(Z.value||""),Se=Le.provider||ve&&ve.dataset.provider||"",Je=Le.model||"";se&&(se.value=Se),ue&&(ue.value=Je),se&&ue&&Se&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&(ue.value=Je,window.aipkit_populateVectorEmbeddingModelSelect(oe),Je&&(ue.value=Je))},zr=(Z,oe)=>{if(!oe)return null;let ue=jr(Z).find(Se=>Se&&Se.id===oe),ve=ue?.dimensions||ue?.dimension||ue?.output_dimensionality||ue?.outputDimensionality||ue?.output_dimension,Le=ve?Number(ve):NaN;if(Number.isFinite(Le)&&Le>0)return Le;if(ue&&typeof ue.name=="string"){let Se=ue.name.match(/\((\d{3,5})\)/);if(Se)return Number(Se[1])}return Z==="google"?768:1536},Mr=()=>{let{pineconeKeyInput:Z,qdrantUrlInput:oe,qdrantKeyInput:se}=nt(),ue=!!(Z&&Z.value.trim()||g),ve=!!(oe&&oe.value.trim()||h),Le=!!(se&&se.value.trim()||_);return{openai:m,pinecone:ue,qdrant:ve&&Le}},ss=()=>{let Z=Mr();return Z.openai?"openai":Z.pinecone?"pinecone":Z.qdrant?"qdrant":""},cs=()=>m?"openai":y?"google":E?"azure":"",Qr=()=>{let Z=ye();if(!Z)return{provider:"",model:""};let oe=Z.querySelector('[name="vector_embedding_provider"]'),se=Z.querySelector('[name="vector_embedding_model"]'),ue=oe?oe.value:"";ue||(ue=cs(),oe&&ue&&(oe.value=ue,typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(Z)));let ve=se?se.value:"";if(!ve&&ue){let Le=jr(ue);ve=Le.length?Le[0].id:"",se&&ve&&(se.value=ve)}return Pr(Z),{provider:ue,model:ve}},Cr=Z=>{if(!Z)return"";let se=(Z.selectedOptions?Array.from(Z.selectedOptions):[]).find(ue=>ue&&ue.value);return se?se.value:""},Jr=(Z,oe)=>{!Z||!oe||Array.from(Z.options).forEach(se=>{se.selected=se.value===oe})},ls=async Z=>{let{openaiStoresSelect:oe}=nt(),se=Cr(oe);if(!se&&oe&&(kt(oe),se=Cr(oe)),!se){let ue=Ri("aipkit_vector_store_nonce_openai");if(!ue)throw new Error("OpenAI vector store nonce missing.");let ve=`Chatbot ${Z} ${Date.now()}`,Le=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:ue,name:ve,source_type:"chatbot_training_text"}),Se=Le.store||Le;if(!Se||!Se.id)throw new Error("OpenAI vector store creation failed.");if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]),window.aipkit_chat_config.openaiVectorStores.some(lt=>lt&&lt.id===Se.id)||window.aipkit_chat_config.openaiVectorStores.push(Se),typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"){let lt=ye();lt&&window.aipkit_populateOpenAIVectorStoresMultiSelect(lt)}oe&&Jr(oe,Se.id),se=Se.id}return se},ds=async(Z,oe)=>{let{pineconeIndexSelect:se}=nt(),ue=se?se.value:"";if(!ue&&se&&(Dt(se),ue=se.value),!ue){let ve=Ri("aipkit_vector_store_pinecone_nonce_management");if(!ve)throw new Error("Pinecone nonce missing.");let Le=`chatbot-${Z}-${Date.now()}`,Se=await window.aipkit_apiRequest("aipkit_create_index_pinecone",{_ajax_nonce:ve,name:Le,dimension:oe,metric:"cosine"}),Je=Se.index||Se,lt=Je?.name||Le;if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.pineconeIndexes)||(window.aipkit_chat_config.pineconeIndexes=[]),window.aipkit_chat_config.pineconeIndexes.some($t=>$t&&$t.name===lt||$t===lt)||window.aipkit_chat_config.pineconeIndexes.push(Je||lt),typeof window.aipkit_populatePineconeIndexSelect=="function"){let $t=ye();$t&&window.aipkit_populatePineconeIndexSelect($t)}se&&(se.value=lt),ue=lt}return ue},ps=async(Z,oe)=>{let{qdrantCollectionsSelect:se}=nt(),ue=Cr(se);if(!ue&&se&&(kt(se),ue=Cr(se)),!ue){let ve=Ri("aipkit_vector_store_qdrant_nonce_management");if(!ve)throw new Error("Qdrant nonce missing.");let Le=`chatbot-${Z}-${Date.now()}`;if(await window.aipkit_apiRequest("aipkit_create_collection_qdrant",{_ajax_nonce:ve,name:Le,dimension:oe,metric:"Cosine"}),window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.qdrantCollections)||(window.aipkit_chat_config.qdrantCollections=[]),window.aipkit_chat_config.qdrantCollections.some(Je=>Je&&Je.name===Le||Je===Le||Je?.id===Le)||window.aipkit_chat_config.qdrantCollections.push({name:Le}),se){if(!Array.from(se.options).some(lt=>lt.value===Le)){let lt=document.createElement("option");lt.value=Le,lt.textContent=Le,se.appendChild(lt)}Jr(se,Le)}if(typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let Je=ye();Je&&window.aipkit_populateQdrantCollectionsMultiSelect(Je)}ue=Le}return ue};if(qo.length&&!e.dataset.trainingTextBound){let Z=!1,oe=Se=>{!Bn||!Rn||(Se?(Bn.hidden=!1,Bn.disabled=!1,Rn.disabled=!0):(Bn.hidden=!0,Bn.disabled=!1,Rn.disabled=!1))},se=()=>{let Se=Go?Go.querySelector(".aipkit_builder_tab.is-active"):null;return Se?Se.dataset.aipkitTab:""},ue=()=>{let Se=N?N.querySelector(".aipkit_file_upload_toggle_select"):null;return Se?Se.dataset.isProPlan==="true":window.aipkit_chat_config?.isProPlan===!0||window.aipkit_dashboard?.isProPlan===!0};fo&&An&&fo.addEventListener("click",()=>{An.click()});let ve=async()=>{if(Z)return;let Se=se(),Je="",lt="chatbot_training_text",wi=[],$t=null;if(Se==="text"){if(Je=_o?_o.value.trim():"",!Je){vt("Add text to train.","warning"),Kt();return}}else if(Se==="qa"){let Xe=oa?oa.value.trim():"",ht=aa?aa.value.trim():"";if(!Xe||!ht){vt("Add a question and answer to train.","warning"),Kt();return}Je=`Q: ${Xe}
A: ${ht}`,lt="chatbot_training_qa"}else if(Se==="files"){if(!ue()){vt("Upgrade to use file uploads.","warning");return}if(wi=An?Array.from(An.files||[]):[],!wi.length){An&&An.click(),vt("Choose files to upload.","warning"),Kt();return}lt="chatbot_training_file"}else if(Se==="website"){let Xe=pe(),ht=fe(Xe),Mt=Ge(Xe),Be=he();if(Xe==="specific"){if(!Be.length){vt("Select content to train.","warning"),Kt();return}}else if(!Mt.length){vt("Select at least one post type.","warning"),Kt();return}$t={mode:Xe,statusValue:ht,postTypes:Mt,selectedPostIds:Be}}else{vt("Select a training tab to continue.","warning"),Kt();return}let vi=w&&w.value||e.getAttribute("data-active-bot-id");if(!vi){vt("Select a chatbot before training.","error"),Kt();return}let wn=nt(),mn=wn?wn.providerSelect:null,In=mn?mn.value:"";if(In==="claude_files"){vt("Claude Files is available for frontend chat upload only. Use OpenAI, Pinecone, or Qdrant for training.","warning"),Kt();return}let xo=["openai","pinecone","qdrant"],Ni="";if(In&&xo.includes(In)?Ni=In:Ni=ss(),!Ni){vt("Add an OpenAI, Pinecone, or Qdrant key to train.","error");return}Z=!0,oe(!0),qo.forEach(Xe=>{Xe.disabled=!0}),vt("Preparing training...","loading");try{let Xe=N&&N.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");Xe&&(Xe.tagName==="SELECT"?Xe.value="1":Xe.checked=!0),mn&&(mn.value=Ni),nn(),oi();let ht="",Mt="",Be="",jt="",xi="";if(Ni==="openai"){if(!m)throw new Error("OpenAI API key missing.");Be=await ls(vi)}else if(Ni==="pinecone"){if(!Mr().pinecone)throw new Error("Pinecone API key missing.");let St=Qr();if(ht=St.provider,Mt=St.model,!ht||!Mt)throw new Error("Select an embedding provider and model.");let at=zr(ht,Mt);jt=await ds(vi,at)}else if(Ni==="qdrant"){if(!Mr().qdrant)throw new Error("Qdrant URL and API key are required.");let St=Qr();if(ht=St.provider,Mt=St.model,!ht||!Mt)throw new Error("Select an embedding provider and model.");let at=zr(ht,Mt);xi=await ps(vi,at)}if(yi(M()),ct(),ge(M()),Se==="files"){Hn();for(let si=0;si<wi.length;si+=1){let St=wi[si];vt(`Uploading ${si+1} of ${wi.length}...`,"loading"),on(St,"Uploading","loading");try{let at=new FormData;if(Ni==="openai"){let zt=Ri("aipkit_vector_store_nonce_openai");if(!zt)throw new Error("OpenAI vector store nonce missing.");at.append("aipkit_vs_global_file_to_submit",St),at.append("target_store_id",Be),at.append("source_type",lt),at.append("_ajax_nonce",zt);let Ai=await window.aipkit_api_upsertFile(at,"aipkit_upload_and_add_file_to_store_direct_openai");on(St,"Processing","loading");let Qi=Ai?.batch?.id;Xo(St,M()).then(xn=>{if(!xn){if(Qi){Zo(Be,Qi,St);return}on(St,"Queued","warning")}})}else if(Ni==="pinecone"){let zt=Ri("aipkit_vector_store_pinecone_nonce_management");if(!zt)throw new Error("Pinecone nonce missing.");at.append("file_to_upload",St),at.append("index_name",jt),at.append("embedding_provider",ht),at.append("embedding_model",Mt),at.append("_ajax_nonce",zt),await window.aipkit_api_upsertFile(at,"aipkit_upload_file_and_upsert_to_pinecone"),on(St,"Trained","success")}else if(Ni==="qdrant"){let zt=Ri("aipkit_vector_store_qdrant_nonce_management");if(!zt)throw new Error("Qdrant nonce missing.");at.append("file_to_upload",St),at.append("target_store_id",xi),at.append("embedding_provider",ht),at.append("embedding_model",Mt),at.append("source_context","chatbot_settings_file_upload"),at.append("_ajax_nonce",zt),await window.aipkit_api_upsertFile(at,"aipkit_upload_file_and_upsert_to_qdrant"),on(St,"Trained","success")}}catch(at){throw on(St,"Failed","error"),at}}An&&(An.value=""),Hn(),vt("Saved","success"),Kt(),qn(),Z=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}else if(Se==="website"&&$t){let{mode:si,statusValue:St,postTypes:at,selectedPostIds:zt}=$t,Ai=zt,Qi=Ai.length;if(si==="bulk"){if(vt("Preparing website content...","loading"),Qi=(await Qt(at,St,Be)).total,!Qi){st("No posts found for selection.","error"),vt("Nothing to train.","warning"),Kt();return}if(await Ci(Qi,St)){await Yi({botId:vi,postTypes:at,provider:Ni,targetStoreId:Ni==="openai"?Be:Ni==="pinecone"?jt:xi,embeddingProvider:ht,embeddingModel:Mt}),st("Queued in the background. You can monitor it in the Automate module. You can close this page.","success"),vt("Queued","success"),Kt(),qn(M()),Z=!1,oe(!1);return}if(Qi>200&&St!=="publish"&&st("Background indexing supports published content only.","info"),Ai=await Mi(at,St,Be),!Ai.length){st("No posts found for selection.","error"),vt("Nothing to train.","warning"),Kt();return}}vt("Training...","loading"),st(`Training ${Qi||Ai.length} item(s)...`,"info"),window.aipkit_isIndexingStopped=!1;let xn=Un?Un.id:"aipkit_training_wp_status";if(Ni==="openai"){let bn=Ri("aipkit_wp_content_index_nonce");if(!bn)throw new Error("WP content index nonce missing.");await window.aipkit_indexOpenAIBatch(Ai,{_ajax_nonce:bn,target_store_id:Be,provider:"openai",source_type:"wordpress_content"},xn)}else if(Ni==="pinecone"){let bn=Ri("aipkit_vector_store_pinecone_nonce_management");if(!bn)throw new Error("Pinecone nonce missing.");let no=Ai.map(ea=>({id:`wp_post_${ea}`,postId:ea,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${ea}`}}));await window.aipkit_indexPineconeBatch(no,{_ajax_nonce:bn,index_name:jt,embedding_provider:ht,embedding_model:Mt,source_type:"wordpress_content"},xn)}else if(Ni==="qdrant"){let bn=Ri("aipkit_vector_store_qdrant_nonce_management");if(!bn)throw new Error("Qdrant nonce missing.");let no=Ai.map(ea=>({id:typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`wp_post_${ea}`,postId:ea,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${ea}`}}));await window.aipkit_indexQdrantBatch(no,{_ajax_nonce:bn,collection_name:xi,embedding_provider:ht,embedding_model:Mt,source_type:"wordpress_content"},xn)}vt("Saved","success"),Kt(),qn(M()),Z=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}else{if(vt("Training...","loading"),Ni==="openai"){let si=Ri("aipkit_vector_store_nonce_openai");if(!si)throw new Error("OpenAI vector store nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:si,target_store_id:Be,text_content:Je,source_type:lt})}else if(Ni==="pinecone"){let si=Ri("aipkit_vector_store_pinecone_nonce_management");if(!si)throw new Error("Pinecone nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let St=`text_${Date.now()}`,at={source:lt,created_at:new Date().toISOString(),original_content:Je,vector_id:St},zt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Je,embedding_provider:ht,embedding_model:Mt,_ajax_nonce:window.aipkit_dashboard.nonce}),Ai=zt.embeddings&&zt.embeddings.length?zt.embeddings[0]:null;if(!Ai)throw new Error("Failed to generate embedding.");await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:si,vectors:JSON.stringify([{id:St,values:Ai,metadata:at}]),embedding_provider:ht,embedding_model:Mt,original_text_content:Je,index_name:jt})}else if(Ni==="qdrant"){let si=Ri("aipkit_vector_store_qdrant_nonce_management");if(!si)throw new Error("Qdrant nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let St=c(),at={source:lt,created_at:new Date().toISOString(),original_content:Je,vector_id:St},zt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Je,embedding_provider:ht,embedding_model:Mt,_ajax_nonce:window.aipkit_dashboard.nonce}),Ai=zt.embeddings&&zt.embeddings.length?zt.embeddings[0]:null;if(!Ai)throw new Error("Failed to generate embedding.");let Qi={_ajax_nonce:si,vectors:JSON.stringify([{id:St,vector:Ai,payload:at}]),embedding_provider:ht,embedding_model:Mt,original_text_content:Je,collection_name:xi,source_context:"chatbot_settings_training"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Qi)}Se==="text"&&_o&&(_o.value=""),Se==="qa"&&(oa&&(oa.value=""),aa&&(aa.value="")),vt("Saved","success"),Kt(),qn(),Z=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}}catch(Xe){vt(`Error: ${Xe.message||"Training failed."}`,"error")}finally{Z=!1,oe(!1),qo.forEach(Xe=>{Xe.disabled=!1}),Hn()}},Le=()=>{if(!An)return;let Se=Array.from(An.files||[]);if(Se.length){if(Se.forEach(Je=>{Sa(Je),on(Je,"Queued")}),Hn(),!ue()){vt("Upgrade to use file uploads.","warning"),Se.forEach(Je=>{on(Je,"Upgrade","warning")});return}ve()}};An&&An.addEventListener("change",Le),qo.forEach(Se=>{Se.addEventListener("click",ve)}),Bn&&!Bn.dataset.listenerAttached&&(Bn.addEventListener("click",()=>{Z&&(window.aipkit_isIndexingStopped=!0,Bn.disabled=!0,vt("Stopping...","warning"))}),Bn.dataset.listenerAttached="true"),qn(),Za(),e.dataset.trainingTextBound="1"}if(Ji&&!e.dataset.sourcesSheetBound){let Z=window.aipkit_escapeHtml||function(Xe){return Xe},oe={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant",claude_files:"Claude Files"},se={page:1,search:"",status:""},ue=null,ve=(Xe,ht)=>{Zn&&(Zn.textContent=Xe||"",Zn.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),ht==="success"&&Zn.classList.add("aipkit_form-help-success"),ht==="error"&&Zn.classList.add("aipkit_form-help-error"))},Le=()=>{Zn&&setTimeout(()=>{Zn.textContent="",Zn.classList.remove("aipkit_form-help-success","aipkit_form-help-error")},2500)},Se=(Xe,ht)=>{$a&&($a.textContent=Xe||"\u2014"),eo&&(eo.textContent=ht||"\u2014")},Je=()=>{let Xe=M(),ht=Xe.vector_store_provider||"",Mt=oe[ht]||"",Be=[],jt="",xi=ye(),si=xi?xi.querySelector('select[name="openai_vector_store_ids[]"]'):null;if(ht==="openai"){if(Be=Array.isArray(Xe.openai_vector_store_ids)?Xe.openai_vector_store_ids.filter(Boolean):[],si){let St=Array.from(si.selectedOptions).map(at=>at.textContent.trim()).filter(Boolean);St.length&&(jt=St.join(", "))}jt||(jt=Be.join(", "))}else ht==="pinecone"?Xe.pinecone_index_name&&(Be=[Xe.pinecone_index_name],jt=Xe.pinecone_index_name):ht==="qdrant"&&(Be=Array.isArray(Xe.qdrant_collection_names)?Xe.qdrant_collection_names.filter(Boolean):[],jt=Be.join(", "));return{contextSettings:Xe,providerKey:ht,providerLabel:Mt,storeIds:Be,storeLabel:jt}},lt=Xe=>{On&&(On.innerHTML=`<tr><td colspan="5" class="aipkit_text-center">${Z(Xe)}</td></tr>`,wo&&(wo.innerHTML=""))},wi=(Xe,ht)=>{if(!On)return;if(!Xe.length){lt("No sources found.");return}let Mt=Xe.map(Be=>{let jt=(Be.provider||ht||"").toLowerCase(),xi=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(Be.message||"",Be.file_id||"",jt,Be):"N/A",si=xi==="Text"?"aipkit_type-text":xi==="File Upload"?"aipkit_type-file":xi==="Site Content"?"aipkit_type-site":"aipkit_type-na",St=Be.status==="indexed"||Be.status==="skipped_already_indexed"||Be.status==="success"?"aipkit_status-success":Be.status==="failed"?"aipkit_status-warning":"aipkit_status-info",at="\u2014";Be.status&&(at=Be.status==="indexed"||Be.status==="skipped_already_indexed"||Be.status==="success"?"Trained":Be.status.replace(/_/g," "));let zt=Be.status==="processing"||Be.status==="queued",Ai=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(Be.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(Be.timestamp):Be.timestamp||"\u2014",Qi=Be.indexed_content||"",xn=Be.post_title||(Be.post_id?`Post #${Be.post_id}`:"")||Qi||Be.message||Be.file_id||"\u2014",bn=xn.length>60?`${xn.substring(0,60)}...`:xn,no=[];return xi==="Site Content"&&Be.post_id&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
                    data-provider="${Z(Be.provider||ht)}"
                    data-store-id="${Z(Be.vector_store_id||"")}"
                    data-vector-id="${Z(Be.file_id||"")}"
                    data-log-id="${Z(Be.id||"")}"
                    data-post-id="${Z(Be.post_id||"")}"
                    data-embedding-provider="${Z(Be.embedding_provider||"")}"
                    data-embedding-model="${Z(Be.embedding_model||"")}"
                    ${zt?'disabled aria-disabled="true"':""}
                  >${zt?"Training...":"Retrain"}</button>`),xi==="Text"&&Qi&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
                    data-provider="${Z(Be.provider||ht)}"
                    data-store-id="${Z(Be.vector_store_id||"")}"
                    data-vector-id="${Z(Be.file_id||"")}"
                    data-log-id="${Z(Be.id||"")}"
                    data-embedding-provider="${Z(Be.embedding_provider||"")}"
                    data-embedding-model="${Z(Be.embedding_model||"")}"
                    data-content="${encodeURIComponent(Qi)}"
                    ${zt?'disabled aria-disabled="true"':""}
                  >${zt?"Training...":"Edit"}</button>`),Qi&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_view_snippet_icon"
                    data-file-id="${Z(Be.id||"")}"
                    data-snippet="${Z(Qi)}"
                    ${Be.batch_id?`data-batch-id="${Z(Be.batch_id)}" data-store-id="${Z(Be.vector_store_id||"")}"`:""}
                    ${zt?'disabled aria-disabled="true"':""}
                  >View</button>`),Be.file_id&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
                    data-provider="${Z(Be.provider||ht)}"
                    data-store-id="${Z(Be.vector_store_id||"")}"
                    data-vector-id="${Z(Be.file_id||"")}"
                    data-log-id="${Z(Be.id||"")}"
                    ${zt?'disabled aria-disabled="true"':""}
                  >Delete</button>`),`<tr data-log-id="${Z(Be.id||"")}">
                <td style="white-space: nowrap;">${Z(Ai)}</td>
                <td><span class="aipkit_content-type-tag ${si}">${Z(xi)}</span></td>
                <td title="${Z(xn)}">${Z(bn)}</td>
                <td style="white-space: nowrap;"><span class="aipkit_status-tag ${St}">${Z(at)}</span></td>
                <td class="aipkit_actions_cell">
                  <div class="aipkit-table-actions-group">${no.join("")}</div>
                </td>
              </tr>`}).join("");On.innerHTML=Mt,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(On,ht)},$t=async(Xe=1)=>{if(!On||typeof window.aipkit_apiRequest!="function")return;let ht=w&&w.value||e.getAttribute("data-active-bot-id");if(!ht){lt("Select a chatbot to view sources.");return}let{contextSettings:Mt,providerKey:Be,providerLabel:jt,storeIds:xi,storeLabel:si}=Je();if(Se(jt,si),Mt.enable_vector_store!=="1"){lt("Enable a knowledge base to view sources.");return}if(!Be||!xi.length){lt("Select a knowledge base store to view sources.");return}On.innerHTML='<tr><td colspan="5" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading sources...</td></tr>',wo&&(wo.innerHTML="");try{let St={bot_id:ht,page:Xe,search:se.search,status:se.status,enable_vector_store:Mt.enable_vector_store,vector_store_provider:Mt.vector_store_provider,openai_vector_store_ids:Mt.openai_vector_store_ids||[],pinecone_index_name:Mt.pinecone_index_name,qdrant_collection_names:Mt.qdrant_collection_names||[]},at=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",St);se.page=Xe,wi(at.logs||[],jt),typeof window.aipkit_renderLogsPagination=="function"&&at.pagination&&wo&&window.aipkit_renderLogsPagination(at.pagination,wo,zt=>$t(zt))}catch(St){lt(`Error loading sources: ${Z(St.message||"Unknown error")}`)}},vi=(Xe=1)=>{!F||!F.classList.contains("aipkit-active")||Ji.hidden||$t(Xe)};window.aipkit_refreshSourcesSheet=vi;let wn=()=>{li&&(li.classList.remove("aipkit-active"),li.setAttribute("aria-hidden","true"),li.dataset.provider="",li.dataset.storeId="",li.dataset.vectorId="",li.dataset.logId="",li.dataset.embeddingProvider="",li.dataset.embeddingModel="",ho&&(ho.value=""))},mn=Xe=>{!li||!ho||(li.dataset.provider=Xe.dataset.provider||"",li.dataset.storeId=Xe.dataset.storeId||"",li.dataset.vectorId=Xe.dataset.vectorId||"",li.dataset.logId=Xe.dataset.logId||"",li.dataset.embeddingProvider=Xe.dataset.embeddingProvider||"",li.dataset.embeddingModel=Xe.dataset.embeddingModel||"",ho.value=Xe.dataset.content?decodeURIComponent(Xe.dataset.content):"",li.classList.add("aipkit-active"),li.setAttribute("aria-hidden","false"),setTimeout(()=>ho.focus(),0))},In=()=>{Si&&(Si.classList.remove("aipkit-active"),Si.setAttribute("aria-hidden","true"),Si.dataset.provider="",Si.dataset.storeId="",Si.dataset.vectorId="",Si.dataset.logId="")},xo=Xe=>{Si&&(Si.dataset.provider=Xe.providerLabel||"",Si.dataset.storeId=Xe.storeId||"",Si.dataset.vectorId=Xe.vectorId||"",Si.dataset.logId=Xe.logId||"",Si.classList.add("aipkit-active"),Si.setAttribute("aria-hidden","false"),yo&&(yo.disabled=!1))},Ni=async(Xe,ht,Mt,Be,jt)=>{let xi=Xe.toLowerCase();if(xi==="openai"){let at=Ri("aipkit_vector_store_nonce_openai");if(!at)throw new Error("OpenAI nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:at,target_store_id:ht,text_content:Mt,source_type:"chatbot_training_text"});return}if(!Be||!jt){let at=M();Be=Be||at.vector_embedding_provider,jt=jt||at.vector_embedding_model}if(!Be||!jt)throw new Error("Select an embedding provider and model.");let si=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Mt,embedding_provider:Be,embedding_model:jt}),St=si.embeddings&&si.embeddings.length?si.embeddings[0]:null;if(!St)throw new Error("Failed to generate embedding.");if(xi==="pinecone"){let at=Ri("aipkit_vector_store_pinecone_nonce_management");if(!at)throw new Error("Pinecone nonce missing.");let zt=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:at,vectors:JSON.stringify([{id:zt,values:St,metadata:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:Mt,vector_id:zt}}]),embedding_provider:Be,embedding_model:jt,original_text_content:Mt,index_name:ht});return}if(xi==="qdrant"){let at=Ri("aipkit_vector_store_qdrant_nonce_management");if(!at)throw new Error("Qdrant nonce missing.");let zt=c(),Ai={_ajax_nonce:at,vectors:JSON.stringify([{id:zt,vector:St,payload:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:Mt,vector_id:zt}}]),embedding_provider:Be,embedding_model:jt,original_text_content:Mt,collection_name:ht,source_context:"chatbot_settings_sources_sheet"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Ai)}};pa&&pa.addEventListener("input",()=>{ue&&window.clearTimeout(ue),ue=window.setTimeout(()=>{se.search=pa.value.trim(),vi(1)},300)}),ko&&ko.addEventListener("change",()=>{se.status=ko.value,vi(1)}),ua&&ua.addEventListener("click",()=>{vi(se.page||1)}),cr&&cr.addEventListener("click",wn),_a&&_a.addEventListener("click",wn),li&&!li.dataset.bound&&(document.addEventListener("keydown",Xe=>{Xe.key==="Escape"&&li.classList.contains("aipkit-active")&&wn()}),li.dataset.bound="1"),Oa&&Oa.addEventListener("click",async()=>{if(!li||!ho)return;let Xe=ho.value.trim();if(!Xe){ve("Text cannot be empty.","error"),Le();return}let ht=li.dataset.provider||"",Mt=li.dataset.storeId||"",Be=li.dataset.vectorId||"",jt=li.dataset.logId||"",xi=li.dataset.embeddingProvider||"",si=li.dataset.embeddingModel||"";if(!ht||!Mt||!Be||!jt){ve("Missing source details.","error"),Le();return}if(wn(),On&&jt){let St=typeof CSS<"u"&&CSS.escape?CSS.escape(String(jt)):String(jt).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),at=On.querySelector(`tr[data-log-id="${St}"]`),zt=at?at.querySelector(".aipkit_sources_action_edit"):null,Ai=at?at.querySelector(".aipkit_view_snippet_icon"):null,Qi=at?at.querySelector(".aipkit_sources_action_delete"):null;zt&&(zt.disabled=!0,zt.setAttribute("aria-disabled","true"),zt.textContent="Training..."),Ai&&(Ai.disabled=!0,Ai.setAttribute("aria-disabled","true")),Qi&&(Qi.disabled=!0,Qi.setAttribute("aria-disabled","true"))}ve("Training...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:ht,store_id:Mt,vector_id:Be,log_id:jt}),await Ni(ht,Mt,Xe,xi,si),ve("Trained","success"),Le(),wn(),vi(se.page||1),qn(M())}catch(St){ve(`Error: ${St.message||"Failed to save."}`,"error")}}),lr&&lr.addEventListener("click",In),yn&&yn.addEventListener("click",In),yo&&yo.addEventListener("click",async()=>{if(!Si)return;let Xe=Si.dataset.provider||"",ht=Si.dataset.storeId||"",Mt=Si.dataset.vectorId||"",Be=Si.dataset.logId||"";if(!Xe||!ht||!Mt||!Be){ve("Missing source details.","error"),Le(),In();return}In();let jt=null,xi=null,si=null,St=null,at=null;if(On&&Be){let zt=typeof CSS<"u"&&CSS.escape?CSS.escape(String(Be)):String(Be).replace(/[^a-zA-Z0-9_-]/g,"\\$&");jt=On.querySelector(`tr[data-log-id="${zt}"]`),jt&&(xi=jt.querySelector(".aipkit_sources_action_edit"),si=jt.querySelector(".aipkit_sources_action_retrain"),St=jt.querySelector(".aipkit_view_snippet_icon"),at=jt.querySelector(".aipkit_sources_action_delete"),[xi,si,St,at].forEach(Ai=>{Ai&&(Ai.disabled=!0,Ai.setAttribute("aria-disabled","true"))}),at&&(at.textContent="Deleting..."))}yo&&(yo.disabled=!0),ve("Deleting...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:Xe,store_id:ht,vector_id:Mt,log_id:Be}),ve("Deleted","success"),Le(),vi(se.page||1),qn(M())}catch(zt){ve(`Error: ${zt.message||"Failed to delete."}`,"error"),[xi,si,St,at].forEach(Ai=>{Ai&&(Ai.disabled=!1,Ai.removeAttribute("aria-disabled"))}),at&&(at.textContent="Delete")}finally{yo&&(yo.disabled=!1)}}),Si&&!Si.dataset.bound&&(document.addEventListener("keydown",Xe=>{Xe.key==="Escape"&&Si.classList.contains("aipkit-active")&&In()}),Si.dataset.bound="1"),Ji.addEventListener("click",async Xe=>{let ht=Xe.target.closest(".aipkit_sources_action_edit");if(ht){mn(ht);return}let Mt=Xe.target.closest(".aipkit_sources_action_delete");if(Mt){let jt=Mt.dataset.provider||"",xi=Mt.dataset.storeId||"",si=Mt.dataset.vectorId||"",St=Mt.dataset.logId||"";if(!jt||!xi||!si||!St){ve("Missing source details.","error"),Le();return}xo({providerLabel:jt,storeId:xi,vectorId:si,logId:St});return}let Be=Xe.target.closest(".aipkit_sources_action_retrain");if(Be){let jt=Be.dataset.provider||"",xi=Be.dataset.storeId||"",si=Be.dataset.vectorId||"",St=Be.dataset.logId||"",at=Be.dataset.postId||"",zt=Be.dataset.embeddingProvider||"",Ai=Be.dataset.embeddingModel||"";if(!jt||!xi||!si||!St||!at){ve("Missing source details.","error"),Le();return}Be.disabled=!0,Be.setAttribute("aria-disabled","true"),Be.textContent="Training...";let Qi=Be.closest("tr"),xn=Qi?Qi.querySelector(".aipkit_view_snippet_icon"):null,bn=Qi?Qi.querySelector(".aipkit_sources_action_delete"):null;xn&&(xn.disabled=!0,xn.setAttribute("aria-disabled","true")),bn&&(bn.disabled=!0,bn.setAttribute("aria-disabled","true")),ve("Retraining...","");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:jt,store_id:xi,vector_id:si,log_id:St,post_id:at,embedding_provider:zt,embedding_model:Ai}),ve("Retrained","success"),Le(),vi(se.page||1),qn(M())}catch(no){ve(`Error: ${no.message||"Failed to retrain."}`,"error"),Be.disabled=!1,Be.removeAttribute("aria-disabled"),Be.textContent="Retrain",xn&&(xn.disabled=!1,xn.removeAttribute("aria-disabled")),bn&&(bn.disabled=!1,bn.removeAttribute("aria-disabled"))}}}),e.dataset.sourcesSheetBound="1"}e.dataset.contextSettingsAutosaveBound="1"}let vr=He();if(vr&&$i&&!e.dataset.tokenLimitsAutosaveBound){let q=!1,I=null,M=()=>{let K=vr.querySelectorAll('input[name^="token_role_limits["]'),V={};return K.forEach(Y=>{let ne=Y.getAttribute("name");ne&&(V[ne]=Y.value)}),V},G=()=>{let K=V=>{let Y=vr.querySelector(V);return Y?Y.value:""};return{token_guest_limit:K('[name="token_guest_limit"]'),token_user_limit:K('[name="token_user_limit"]'),token_limit_mode:K('[name="token_limit_mode"]'),token_reset_period:K('[name="token_reset_period"]'),token_limit_message:K('[name="token_limit_message"]'),role_limits:M()}},z=G(),X=K=>{let V=w&&w.value||e.getAttribute("data-active-bot-id");if(!V)return;q=!0,ot("Auto-saving...","");let Y={bot_id:V,token_guest_limit:K.token_guest_limit,token_user_limit:K.token_user_limit,token_limit_mode:K.token_limit_mode,token_reset_period:K.token_reset_period,token_limit_message:K.token_limit_message};Object.entries(K.role_limits).forEach(([ne,de])=>{Y[ne]=de}),window.aipkit_apiRequest("aipkit_update_chatbot_token_limits",Y).then(ne=>{z=K,ot(ne.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(ne=>{ot(`Error: ${ne.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I){let ne=I;I=null,JSON.stringify(ne)!==JSON.stringify(z)&&X(ne)}})},te=K=>{if(JSON.stringify(K)!==JSON.stringify(z)){if(q){I=K;return}X(K)}};vr.addEventListener("change",K=>{let V=K.target;if(V){if(V.matches(".aipkit_token_limit_mode_select")){Gi(),te(G());return}(V.matches('[name="token_guest_limit"]')||V.matches('[name="token_user_limit"]')||V.matches('[name="token_reset_period"]')||V.matches('[name="token_limit_message"]')||V.matches('input[name^="token_role_limits["]'))&&te(G())}}),e.dataset.tokenLimitsAutosaveBound="1"}let Vr=(O?O.querySelector('[data-aipkit-settings-panel="appearance"]'):null)||(R?R.querySelector('[data-aipkit-settings-panel="appearance"]'):null);if(Vr&&$i&&!e.dataset.styleSettingsAutosaveBound){let q=Vr;if(q){let I=!1,M=null,G=()=>{let ge=q.querySelector('[name="enable_conversation_starters"]'),pe=q.querySelector(".aipkit_starters_config_btn");if(!ge||!pe)return;let Ge=!ge.disabled&&(ge.tagName==="SELECT"?ge.value==="1":!!ge.checked);pe.hidden=!Ge,pe.disabled=!Ge,pe.setAttribute("aria-disabled",Ge?"false":"true"),Ge||(pe.setAttribute("aria-expanded","false"),Ir())},z=q.querySelector("[data-aipkit-interface-controls-dropdown]"),X=z?z.querySelector(".aipkit_popover_multiselect_btn"):null,te=z?z.querySelector(".aipkit_popover_multiselect_label"):null,K=z?z.querySelector(".aipkit_popover_multiselect_panel"):null,V=z?Array.from(z.querySelectorAll(".aipkit_interface_control_option")):[],Y={};Array.from(q.querySelectorAll(".aipkit_interface_control_hidden_select")).forEach(ge=>{let pe=ge.getAttribute("name");pe&&(Y[pe]=ge)});let ne=q.querySelector(".aipkit_interface_control_option--sidebar"),de=ne?ne.closest(".aipkit_interface_control_item--sidebar"):null,ke=e.querySelector("[data-aipkit-top-mode-select]"),De=ge=>ge?ge.tagName==="SELECT"?ge.value==="1":!!ge.checked:!1,ut=(ge,pe)=>{if(!ge||ge.disabled)return;let Ge=!!pe;De(ge)!==Ge&&(ge.tagName==="SELECT"?ge.value=Ge?"1":"0":ge.checked=Ge,ge.dispatchEvent(new Event("change",{bubbles:!0})))},Ct=()=>{te&&(te.textContent=Ta(V,z,"Select controls",2))},Ft=()=>{V.forEach(ge=>{if(!ge)return;let pe=Y[ge.value];pe&&(ge.checked=De(pe))}),Ct()},qi=()=>{V.forEach(ge=>{if(!ge||ge.disabled)return;let pe=Y[ge.value];pe&&ut(pe,ge.checked)}),Ct()},pt=()=>{if(!ne||!de)return;let ge=Y.enable_conversation_sidebar,pe=ge?ge.disabled:ke?ke.value==="popup"||ke.value==="external":!1,Ge=de.getAttribute("data-tooltip-disabled")||"";pe?(ne.disabled=!0,de.classList.add("is-disabled"),Ge&&de.setAttribute("title",Ge)):(ne.disabled=!1,de.classList.remove("is-disabled"),de.removeAttribute("title"))},yi=()=>{!X||!K||(X.setAttribute("aria-expanded","false"),K.hidden=!0,z.classList.remove("is-open"),Kn())};z&&X&&K&&!z.dataset.bound&&(X.addEventListener("click",ge=>{if(ge.preventDefault(),X.getAttribute("aria-expanded")==="true"){yi();return}X.setAttribute("aria-expanded","true"),K.hidden=!1,z.classList.add("is-open"),Kn()}),V.forEach(ge=>{ge.addEventListener("change",()=>{qi()})}),document.addEventListener("click",ge=>{z.contains(ge.target)||yi()}),document.addEventListener("keydown",ge=>{ge.key==="Escape"&&yi()}),Object.values(Y).forEach(ge=>{ge.addEventListener("change",()=>{pt(),Ft()})}),ke&&ke.dataset.interfaceControlsBound!=="1"&&(ke.addEventListener("change",()=>{window.requestAnimationFrame(()=>{pt(),Ft()})}),ke.dataset.interfaceControlsBound="1"),pt(),Ft(),z.dataset.bound="1"),cn&&to&&ma&&Fi&&!cn.dataset.bound&&(to.addEventListener("click",ge=>{if(ge.preventDefault(),to.getAttribute("aria-expanded")==="true"){Qo();return}to.setAttribute("aria-expanded","true"),ma.hidden=!1,cn.classList.add("is-open"),Kn(),gr()}),Ln.forEach(ge=>{ge.addEventListener("change",()=>{ge.checked&&(Or(ge),Qo())})}),document.addEventListener("click",ge=>{cn&&!cn.contains(ge.target)&&Qo()}),document.addEventListener("keydown",ge=>{ge.key==="Escape"&&Qo()}),cn.dataset.bound="1"),Fi&&Fi.dataset.themeDropdownBound!=="1"&&(Fi.addEventListener("change",()=>{gr()}),Fi.dataset.themeDropdownBound="1"),Pi&&Pi.dataset.bound!=="1"&&(Pi.addEventListener("click",ge=>{if(ge.preventDefault(),Pi.hidden||Pi.disabled)return;let pe=Ln.find(he=>{let tt=he.getAttribute("data-theme-value")||he.value||"",wt=he.getAttribute("data-preset-key")||"";return tt==="custom"&&wt===""});if(pe&&!pe.disabled&&(pe.checked||(pe.checked=!0,Or(pe))),Qo(),Tt&&Tt.classList.contains("is-open")&&ki===Pi){Jo();return}Hr(Pi)}),Pi.dataset.bound="1"),gr();let Xt=()=>{let ge={},pe=Ci=>{let Yi=q.querySelector(Ci);return!Yi||Yi.disabled?null:Yi.value||""},Ge=Ci=>!Ci||Ci.disabled?null:Ci.tagName==="SELECT"?Ci.value==="1"?"1":"0":Ci.checked?"1":"0",fe=q.querySelector('select[name="theme"]');if(fe&&!fe.disabled)ge.theme=fe.value||"light";else{let Ci=q.querySelector('input[name="theme"]:checked');if(Ci&&!Ci.disabled)ge.theme=Ci.value||"light";else{let Yi=e.querySelector('input[name="theme"]:checked, select[name="theme"]');Yi&&!Yi.disabled&&(ge.theme=Yi.value||"light")}}let he="";if((ge.theme||"")==="custom"&&(vo&&!vo.disabled&&(he=vo.value||""),!he&&fe&&!fe.disabled)){let Ci=fe.selectedOptions&&fe.selectedOptions.length?fe.selectedOptions[0]:null;he=Ci&&Ci.dataset&&Ci.dataset.presetKey?Ci.dataset.presetKey:""}ge.theme_preset_key=he;let tt=pe('input[name="greeting"]');tt!==null&&(ge.greeting=tt);let wt=pe('input[name="subgreeting"]');wt!==null&&(ge.subgreeting=wt);let ai=pe('input[name="input_placeholder"]');ai!==null&&(ge.input_placeholder=ai);let Zt=pe('input[name="footer_text"]');Zt!==null&&(ge.footer_text=Zt);let ri=pe('input[name="custom_typing_text"]');ri!==null&&(ge.custom_typing_text=ri);let Qt=Ci=>{let Yi=q.querySelector(`[name="${Ci}"]`);if(!(!Yi||Yi.disabled)){if(Yi.tagName==="SELECT"){ge[Ci]=Yi.value==="1"?"1":"0";return}ge[Ci]=Yi.checked?"1":"0"}};Qt("enable_download"),Qt("enable_copy_button"),Qt("enable_fullscreen"),Qt("enable_feedback"),Qt("enable_conversation_sidebar"),Qt("enable_conversation_starters");let Mi=w&&w.value||e.getAttribute("data-active-bot-id");if(Mi){let Ci=document.getElementById(`aipkit_bot_${Mi}_enable_consent_compliance`),Yi=Ge(Ci);Yi!==null&&(ge.enable_consent_compliance=Yi);let Co=document.getElementById(`aipkit_bot_${Mi}_enable_ip_anonymization`),lo=Ge(Co);lo!==null&&(ge.enable_ip_anonymization=lo);let jn=document.getElementById(`aipkit_bot_${Mi}_consent_title`);jn&&!jn.disabled&&(ge.consent_title=jn.value||"");let Hn=document.getElementById(`aipkit_bot_${Mi}_consent_message`);Hn&&!Hn.disabled&&(ge.consent_message=Hn.value||"");let Xa=document.getElementById(`aipkit_bot_${Mi}_consent_button`);Xa&&!Xa.disabled&&(ge.consent_button=Xa.value||"");let br=document.getElementById(`aipkit_bot_${Mi}_openai_moderation_enabled`),Sr=Ge(br);Sr!==null&&(ge.openai_moderation_enabled=Sr);let Sa=document.getElementById(`aipkit_bot_${Mi}_openai_moderation_message`);Sa&&!Sa.disabled&&(ge.openai_moderation_message=Sa.value||"");let on=document.getElementById(`aipkit_bot_${Mi}_banned_words`);on&&!on.disabled&&(ge.banned_words=on.value||"");let Xo=document.getElementById(`aipkit_bot_${Mi}_banned_words_message`);Xo&&!Xo.disabled&&(ge.banned_words_message=Xo.value||"");let Zo=document.getElementById(`aipkit_bot_${Mi}_banned_ips`);Zo&&!Zo.disabled&&(ge.banned_ips=Zo.value||"");let po=document.getElementById(`aipkit_bot_${Mi}_banned_ips_message`);po&&!po.disabled&&(ge.banned_ips_message=po.value||"");let qn=document.getElementById(`aipkit_bot_${Mi}_custom_theme_settings_container`);qn&&qn.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(Ri=>{let Ea=Ri.getAttribute("name");Ea&&(Ri.type==="checkbox"?ge[Ea]=Ri.checked?"1":"0":Ri.type==="radio"?Ri.checked&&(ge[Ea]=Ri.value):ge[Ea]=Ri.value)});let Za=document.getElementById(`aipkit_bot_${Mi}_conversation_starters`);Za&&!Za.disabled&&(ge.conversation_starters=Za.value||"")}return ge},vt=Xt(),Kt=ge=>{let pe=w&&w.value||e.getAttribute("data-active-bot-id");pe&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_style_settings",{bot_id:pe,...ge}).then(Ge=>{vt=ge,ot(Ge.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(pe),Oi()}).catch(Ge=>{ot(`Error: ${Ge.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,M){let Ge=M;M=null,JSON.stringify(Ge)!==JSON.stringify(vt)&&Kt(Ge)}}))},st=ge=>{if(JSON.stringify(ge)!==JSON.stringify(vt)){if(I){M=ge;return}Kt(ge)}};q.addEventListener("change",ge=>{let pe=ge.target;if(pe&&((pe.matches('input[name="enable_conversation_starters"]')||pe.matches('select[name="enable_conversation_starters"]'))&&G(),pe.matches('input[name="greeting"]')||pe.matches('input[name="subgreeting"]')||pe.matches('input[name="input_placeholder"]')||pe.matches('input[name="footer_text"]')||pe.matches('input[name="custom_typing_text"]')||pe.matches('input[name="enable_download"]')||pe.matches('input[name="enable_copy_button"]')||pe.matches('input[name="enable_fullscreen"]')||pe.matches('input[name="enable_feedback"]')||pe.matches('input[name="enable_conversation_sidebar"]')||pe.matches('input[name="enable_conversation_starters"]')||pe.matches('select[name="enable_download"]')||pe.matches('select[name="enable_copy_button"]')||pe.matches('select[name="enable_fullscreen"]')||pe.matches('select[name="enable_feedback"]')||pe.matches('select[name="enable_conversation_sidebar"]')||pe.matches('select[name="enable_conversation_starters"]')||pe.matches('select[name="theme"]')||pe.matches('input[name="theme"]'))){if((pe.matches('select[name="theme"]')||pe.matches('input[name="theme"]'))&&typeof Jo=="function")if(pe.value!=="custom")Jo();else{let fe=pe.matches&&pe.matches('select[name="theme"]')&&pe.selectedOptions&&pe.selectedOptions.length?pe.selectedOptions[0]:null;if(!!(fe&&fe.dataset&&fe.dataset.presetKey))Jo();else{let tt=q.querySelector(".aipkit_theme_config_btn:not([hidden])")||q.querySelector("[data-aipkit-theme-dropdown] .aipkit_popover_multiselect_btn")||pe.closest(".aipkit_theme_choice_card")||pe;Hr(tt)}}st(Xt())}}),G(),e.addEventListener("change",ge=>{let pe=ge.target;!pe||!pe.matches||!pe.matches('select[name="theme"]')&&!pe.matches('input[name="theme"]')||q.contains(pe)||st(Xt())}),e.dataset.customThemeAutosaveBound||(document.addEventListener("change",ge=>{let pe=ge.target;pe&&pe.matches&&pe.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')&&(!(document.documentElement.dataset.aipkitApplyingThemePreset==="1")&&(Fi?.value||"")==="custom"&&Yr(),st(Xt()))}),e.dataset.customThemeAutosaveBound="1"),q.addEventListener("blur",ge=>{let pe=ge.target;pe&&(pe.matches('input[name="greeting"]')||pe.matches('input[name="subgreeting"]')||pe.matches('input[name="input_placeholder"]')||pe.matches('input[name="footer_text"]')||pe.matches('input[name="custom_typing_text"]'))&&st(Xt())},!0),document.addEventListener("change",ge=>{let pe=ge.target;pe&&pe.matches('textarea[name="conversation_starters"], [name="enable_consent_compliance"], [name="enable_ip_anonymization"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], [name="openai_moderation_enabled"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&(pe.matches('[name="enable_consent_compliance"]')&&Dr(),pe.matches('[name="openai_moderation_enabled"]')&&Wr(),st(Xt()))}),document.addEventListener("blur",ge=>{let pe=ge.target;pe&&pe.matches('textarea[name="conversation_starters"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&st(Xt())},!0),e.dataset.styleSettingsAutosaveBound="1"}}if(F&&$i&&!e.dataset.imageSettingsAutosaveBound){let q=!1,I=null;Zi&&ro&&jo&&tn&&!Zi.dataset.bound&&(ro.addEventListener("click",K=>{if(K.preventDefault(),ro.getAttribute("aria-expanded")==="true"){va();return}Qo(),ya(),ro.setAttribute("aria-expanded","true"),jo.hidden=!1,Zi.classList.add("is-open"),Kn(),kr()}),ga.forEach(K=>{K.addEventListener("change",()=>{K.checked&&(Xr(K),va())})}),document.addEventListener("click",K=>{Zi&&!Zi.contains(K.target)&&va()}),document.addEventListener("keydown",K=>{K.key==="Escape"&&va()}),Zi.dataset.bound="1"),tn&&tn.dataset.imageModelDropdownBound!=="1"&&(tn.addEventListener("change",()=>{kr()}),tn.dataset.imageModelDropdownBound="1"),kr(),Gn&&Nn&&!Gn.dataset.bound&&(Gn.addEventListener("click",K=>{if(K.preventDefault(),Gn.getAttribute("aria-expanded")==="true"){ba();return}Qo(),ya(),va(),Gn.setAttribute("aria-expanded","true"),Nn.hidden=!1,Nn.classList.add("is-open"),Kn()}),Va&&Va.addEventListener("click",K=>{K.preventDefault(),ba()}),document.addEventListener("click",K=>{Nn.classList.contains("is-open")&&(Gn.contains(K.target)||Nn.contains(K.target)||ba())}),document.addEventListener("keydown",K=>{K.key==="Escape"&&ba()}),Gn.dataset.bound="1");let M=()=>{let K=j&&j.querySelector('select[name="chat_image_model_id"]')||N&&N.querySelector('select[name="chat_image_model_id"]')||F.querySelector('select[name="chat_image_model_id"]'),V=j&&j.querySelector('input[name="image_triggers"]')||j&&j.querySelector('textarea[name="image_triggers"]')||N&&N.querySelector('input[name="image_triggers"]')||N&&N.querySelector('textarea[name="image_triggers"]')||F.querySelector('input[name="image_triggers"]')||F.querySelector('textarea[name="image_triggers"]');if(!K||!V)return null;let Y=j&&j.querySelector(".aipkit_image_analysis_select")||N&&N.querySelector(".aipkit_image_analysis_select")||F.querySelector(".aipkit_image_analysis_select"),ne=j&&j.querySelector(".aipkit_image_analysis_checkbox")||N&&N.querySelector(".aipkit_image_analysis_checkbox")||F.querySelector(".aipkit_image_analysis_checkbox"),de=Y&&Y.value!==""?Y.value:ne&&ne.checked?"1":"0";return{chat_image_model_id:K.value||"",image_triggers:V.value||"",enable_image_upload:de}},G=M()||{},z=K=>{let V=w&&w.value||e.getAttribute("data-active-bot-id");V&&(q=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_image_settings",{bot_id:V,...K}).then(Y=>{G=K,ot(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I){let Y=I;I=null,JSON.stringify(Y)!==JSON.stringify(G)&&z(Y)}}))},X=K=>{if(K&&JSON.stringify(K)!==JSON.stringify(G)){if(q){I=K;return}z(K)}},te=K=>{let V=K.target;V&&(V.matches('select[name="chat_image_model_id"]')||V.matches('input[name="image_triggers"]')||V.matches('textarea[name="image_triggers"]')||V.matches(".aipkit_image_analysis_checkbox")||V.matches(".aipkit_image_analysis_select"))&&X(M())};F.addEventListener("change",te),N&&N.addEventListener("change",te),j&&j.addEventListener("change",te),e.dataset.imageSettingsAutosaveBound="1"}if(F&&$i&&!e.dataset.replicateKeyAutosaveBound){let I=j&&j.querySelector('input[name="replicate_api_key"]')||N&&N.querySelector('input[name="replicate_api_key"]')||F.querySelector('input[name="replicate_api_key"]');if(I){let M=!1,G=null,z=I.value||"",X=V=>{M=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:V}).then(Y=>{z=V,ot(Y.message||"Saved","success"),Oi(),Ua(V)}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(M=!1,G!==null){let Y=G;G=null,Y!==z&&X(Y)}})},te=V=>{if(V!==z){if(M){G=V;return}X(V)}},K=V=>{let Y=V.target;!Y||!Y.matches('input[name="replicate_api_key"]')||te(Y.value||"")};F.addEventListener("change",K),F.addEventListener("blur",K,!0),N&&(N.addEventListener("change",K),N.addEventListener("blur",K,!0)),j&&(j.addEventListener("change",K),j.addEventListener("blur",K,!0)),e.dataset.replicateKeyAutosaveBound="1"}}if(Ve&&$i&&!e.dataset.audioSettingsAutosaveBound){let q=!1,I=null,M=()=>{let fe=Qt=>{let Mi=Ve.querySelector(Qt);return Mi?Mi.value:null},he=Qt=>Qt?Qt.tagName==="SELECT"?Qt.value:Qt.type==="checkbox"?Qt.checked?"1":"0":Qt.value?Qt.value:"0":null,tt=Qt=>he(e.querySelector(Qt)),wt={},ai=tt(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch");if(ai!==null){wt.enable_voice_input=ai;let Qt=fe('[name="stt_provider"]');Qt!==null&&(wt.stt_provider=Qt);let Mi=fe('[name="stt_openai_model_id"]');Mi!==null&&(wt.stt_openai_model_id=Mi)}let Zt=tt(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch");if(Zt!==null){wt.tts_enabled=Zt;let Qt=he('[name="tts_auto_play"]');Qt!==null&&(wt.tts_auto_play=Qt);let Mi=fe('[name="tts_provider"]');Mi!==null&&(wt.tts_provider=Mi);let Ci=fe('[name="tts_google_voice_id"]');Ci!==null&&(wt.tts_google_voice_id=Ci);let Yi=fe('[name="tts_openai_voice_id"]');Yi!==null&&(wt.tts_openai_voice_id=Yi);let Co=fe('[name="tts_openai_model_id"]');Co!==null&&(wt.tts_openai_model_id=Co);let lo=fe('[name="tts_elevenlabs_voice_id"]');lo!==null&&(wt.tts_elevenlabs_voice_id=lo);let jn=fe('[name="tts_elevenlabs_model_id"]');jn!==null&&(wt.tts_elevenlabs_model_id=jn)}let ri=tt(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle");if(ri!==null){wt.enable_realtime_voice=ri;let Qt=he('[name="direct_voice_mode"]');Qt!==null&&(wt.direct_voice_mode=Qt);let Mi=he('[name="input_audio_noise_reduction"]');Mi!==null&&(wt.input_audio_noise_reduction=Mi);let Ci=fe('[name="realtime_model"]');Ci!==null&&(wt.realtime_model=Ci);let Yi=fe('[name="realtime_voice"]');Yi!==null&&(wt.realtime_voice=Yi);let Co=fe('[name="turn_detection"]');Co!==null&&(wt.turn_detection=Co);let lo=fe('[name="input_audio_format"]');lo!==null&&(wt.input_audio_format=lo);let jn=fe('[name="output_audio_format"]');jn!==null&&(wt.output_audio_format=jn);let Hn=fe('[name="speed"]');Hn!==null&&(wt.speed=Hn)}return wt},G=M(),X=(()=>{let fe=Ve.querySelector('[name="elevenlabs_api_key"]');return fe?fe.value:""})(),te=!1,K=null,V=!1,Y=Ve.querySelector(".aipkit_tts_sync_status"),ne=(fe,he,tt)=>{Y&&(Y.textContent=fe||"",Y.classList.remove("success","error","loading"),he&&Y.classList.add(he),tt?Y.setAttribute("title",tt):Y.removeAttribute("title"),Y.style.display=fe?"inline-block":"none")},de=(fe=2500)=>{Y&&setTimeout(()=>{ne("")},fe)},ke=()=>{let fe=Ve.querySelector('[name="tts_provider"]');return fe?fe.value:""},De=()=>{let fe=Ve.querySelector(".aipkit_tts_toggle_switch");return fe?fe.tagName==="SELECT"?fe.value==="1":!!fe.checked:!1},ut=()=>{let fe=Ve.querySelector('select[name="tts_google_voice_id"]');return!fe||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_updateGoogleVoiceSelect!="function"||V?Promise.resolve():(V=!0,ne("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(he=>{if(!he||!he.voices)throw new Error("Invalid response received from voice sync.");let tt=fe.value||"";window.aipkit_updateGoogleVoiceSelect(fe.id,he.voices,tt);let wt=document.getElementById("aipkit_google_tts_voices_json_main");wt&&(wt.dataset.voices=JSON.stringify(he.voices)),ne(he.message||"Synced","success"),de()}).catch(he=>{let tt=he?.message||"Sync failed.";throw ne(tt,"error",tt),de(5e3),he}).finally(()=>{V=!1}))},Ct=()=>{let fe=st();if(!fe||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect!="function"||typeof window.aipkit_chatTts_updateElevenLabsModelsSelect!="function")return Promise.resolve();let he=Ve.querySelector('select[name="tts_elevenlabs_voice_id"]'),tt=Ve.querySelector('select[name="tts_elevenlabs_model_id"]');if(!he&&!tt||V)return Promise.resolve();V=!0,ne("Syncing...","loading");let wt=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabs"}).then(Zt=>{let ri=Zt?.models||[];he&&window.aipkit_chatTts_updateElevenLabsVoiceSelect(he.id,ri,he.value||"");let Qt=document.getElementById(`aipkit_elevenlabs_voices_json_${fe}`);Qt&&(Qt.dataset.voices=JSON.stringify(ri))}),ai=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabsModels"}).then(Zt=>{let ri=Zt?.models||[];tt&&window.aipkit_chatTts_updateElevenLabsModelsSelect(tt.id,ri,tt.value||"");let Qt=document.getElementById(`aipkit_elevenlabs_models_json_${fe}`);Qt&&(Qt.dataset.models=JSON.stringify(ri))});return Promise.allSettled([wt,ai]).then(Zt=>{let ri=Zt.find(Qt=>Qt.status==="rejected");if(ri){let Qt=ri.reason?.message||"Sync failed.";throw ne(Qt,"error",Qt),de(5e3),ri.reason}return ne("Synced","success"),de(),Zt}).finally(()=>{V=!1})},Ft=fe=>{try{let he=fe?JSON.parse(fe):[];return Array.isArray(he)&&he.length>0}catch{return!1}},qi=fe=>fe?!!(fe.options&&fe.options.length>1):!1,pt=()=>{let fe=Ve.querySelector('select[name="tts_google_voice_id"]'),he=document.getElementById("aipkit_google_tts_voices_json_main");return!Ft(he?.dataset?.voices)||!qi(fe)},yi=()=>{let fe=st();if(!fe)return!1;let he=Ve.querySelector('select[name="tts_elevenlabs_voice_id"]'),tt=Ve.querySelector('select[name="tts_elevenlabs_model_id"]'),wt=document.getElementById(`aipkit_elevenlabs_voices_json_${fe}`),ai=document.getElementById(`aipkit_elevenlabs_models_json_${fe}`),Zt=Ft(wt?.dataset?.voices),ri=Ft(ai?.dataset?.models);return!Zt||!ri||!qi(he)||!qi(tt)},Xt=()=>{if(!De())return Promise.resolve();let fe=ke();return fe==="Google"?pt()?ut():Promise.resolve():fe==="ElevenLabs"&&yi()?Ct():Promise.resolve()};window.aipkit_syncAudioTtsOnOpen=Xt;let vt=fe=>{fe!=null&&(te=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{elevenlabs_api_key:fe}).then(he=>{X=fe,ot(he.message||"Saved","success"),Oi(),ke()==="ElevenLabs"&&De()&&Ct().catch(()=>{})}).catch(he=>{ot(`Error: ${he.message||"Failed to save."}`,"error")}).finally(()=>{if(te=!1,K!==null){let he=K;K=null,he!==X&&vt(he)}}))},Kt=fe=>{if(fe!=null&&fe!==X){if(te){K=fe;return}vt(fe)}},st=()=>w&&w.value||e.getAttribute("data-active-bot-id"),ge=()=>{let fe=st();Ve.querySelectorAll(".aipkit_audio_format_combo_select").forEach(Zt=>{let ri=Zt.closest(".aipkit_popover_option_row"),Qt=ri?.querySelector('[name="input_audio_format"]'),Mi=ri?.querySelector('[name="output_audio_format"]'),Ci=Zt.querySelector('option[value="current"]');!Qt||!Mi||!Ci||(Ci.textContent=`In: ${Qt.value} / Out: ${Mi.value}`,Zt.value="current")});let tt=Ve.querySelector('select[name="tts_google_voice_id"]');if(tt&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let Zt=document.getElementById("aipkit_google_tts_voices_json_main");try{let ri=Zt?.dataset?.voices?JSON.parse(Zt.dataset.voices):[];window.aipkit_updateGoogleVoiceSelect(tt.id,ri,tt.value||"")}catch(ri){console.warn("AIPKit Builder: Failed to parse Google TTS voices data.",ri)}}let wt=Ve.querySelector('select[name="tts_elevenlabs_voice_id"]');if(fe&&wt&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){let Zt=document.getElementById(`aipkit_elevenlabs_voices_json_${fe}`);try{let ri=Zt?.dataset?.voices?JSON.parse(Zt.dataset.voices):[];window.aipkit_chatTts_updateElevenLabsVoiceSelect(wt.id,ri,wt.value||"")}catch(ri){console.warn("AIPKit Builder: Failed to parse ElevenLabs voices data.",ri)}}let ai=Ve.querySelector('select[name="tts_elevenlabs_model_id"]');if(fe&&ai&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){let Zt=document.getElementById(`aipkit_elevenlabs_models_json_${fe}`);try{let ri=Zt?.dataset?.models?JSON.parse(Zt.dataset.models):[];window.aipkit_chatTts_updateElevenLabsModelsSelect(ai.id,ri,ai.value||"")}catch(ri){console.warn("AIPKit Builder: Failed to parse ElevenLabs models data.",ri)}}},pe=fe=>{let he=st();he&&(q=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_audio_settings",{bot_id:he,...fe}).then(tt=>{G=fe,ot(tt.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(he),Oi()}).catch(tt=>{ot(`Error: ${tt.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I){let tt=I;I=null,JSON.stringify(tt)!==JSON.stringify(G)&&pe(tt)}}))},Ge=fe=>{if(!(!fe||Object.keys(fe).length===0)&&JSON.stringify(fe)!==JSON.stringify(G)){if(q){I=fe;return}pe(fe)}};e.addEventListener("change",fe=>{let he=fe.target;!he||!(he.matches(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch")||he.matches(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch")||he.matches(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle"))||(Pn(),Ge(M()))}),Ve.addEventListener("change",fe=>{let he=fe.target;if(he){if(he.matches(".aipkit_audio_format_combo_select")){let tt=he.closest(".aipkit_popover_option_row"),wt=tt?.querySelector('[name="input_audio_format"]'),ai=tt?.querySelector('[name="output_audio_format"]'),Zt=he.querySelector('option[value="current"]'),ri=he.value||"";if(!wt||!ai||!Zt||!ri)return;ri.startsWith("in:")?wt.value=ri.replace("in:",""):ri.startsWith("out:")&&(ai.value=ri.replace("out:","")),Zt.textContent=`In: ${wt.value} / Out: ${ai.value}`,he.value="current",wt.dispatchEvent(new Event("change",{bubbles:!0})),ai.dispatchEvent(new Event("change",{bubbles:!0}));return}if(he.matches('[name="elevenlabs_api_key"]')){Kt(he.value);return}if((he.matches(".aipkit_voice_input_toggle_switch")||he.matches(".aipkit_stt_provider_select")||he.matches('[name="stt_openai_model_id"]')||he.matches(".aipkit_tts_toggle_switch")||he.matches('[name="tts_auto_play"]')||he.matches(".aipkit_tts_provider_select")||he.matches('[name="tts_google_voice_id"]')||he.matches('[name="tts_openai_voice_id"]')||he.matches('[name="tts_openai_model_id"]')||he.matches('[name="tts_elevenlabs_voice_id"]')||he.matches('[name="tts_elevenlabs_model_id"]')||he.matches(".aipkit_enable_realtime_voice_toggle")||he.matches('[name="direct_voice_mode"]')||he.matches('[name="input_audio_noise_reduction"]')||he.matches('[name="realtime_model"]')||he.matches('[name="realtime_voice"]')||he.matches('[name="turn_detection"]')||he.matches('[name="input_audio_format"]')||he.matches('[name="output_audio_format"]')||he.matches('[name="speed"]'))&&(Pn(),Ge(M()),he.matches(".aipkit_tts_provider_select")&&De())){let tt=ke();tt==="Google"?ut().catch(()=>{}):tt==="ElevenLabs"&&Ct().catch(()=>{})}}}),Pn(),ge(),e.dataset.audioSettingsAutosaveBound="1"}if(zi&&$i&&!e.dataset.popupSettingsAutosaveBound){let q=!1,I=null;en&&ao&&Ui&&!en.dataset.bound&&(ao.addEventListener("click",K=>{if(K.preventDefault(),ao.getAttribute("aria-expanded")==="true"){ya();return}ao.setAttribute("aria-expanded","true"),Ui.hidden=!1,en.classList.add("is-open"),Kn(),hr()}),vn.forEach(K=>{K.addEventListener("change",()=>{K.checked&&Zr(K)})}),Object.values(sn).forEach(K=>{K.addEventListener("change",()=>{hr()})}),document.addEventListener("click",K=>{en&&!en.contains(K.target)&&ya()}),document.addEventListener("keydown",K=>{K.key==="Escape"&&ya()}),hr(),en.dataset.bound="1");let M=()=>{let K=ai=>zi&&zi.querySelector(ai)||Ee&&Ee.querySelector(ai)||e.querySelector(ai),V=ai=>{let Zt=K(ai);return Zt?Zt.value:null},Y=ai=>{let Zt=K(ai);return Zt?Zt.checked?"1":"0":null},ne={},de=V('[name="popup_position"]');de!==null&&(ne.popup_position=de);let ke=V('[name="popup_delay"]');ke!==null&&(ne.popup_delay=ke);let De=V('[name="popup_icon_style"]');De!==null&&(ne.popup_icon_style=De);let ut=V('[name="popup_icon_size"]');ut!==null&&(ne.popup_icon_size=ut);let Ct=V('[name="popup_icon_default"]:checked');if(Ct!==null)Ct==="__custom__"?ne.popup_icon_type="custom":(ne.popup_icon_type="default",ne.popup_icon_default=Ct);else{let ai=V('[name="popup_icon_type"]');ai!==null&&(ne.popup_icon_type=ai)}let Ft=V('[name="popup_icon_custom_url"]');Ft!==null&&(ne.popup_icon_custom_url=Ft);let qi=V('[name="header_avatar_default"]:checked');if(qi!==null)qi==="__custom__"?ne.header_avatar_type="custom":(ne.header_avatar_type="default",ne.header_avatar_default=qi);else{let ai=V('[name="header_avatar_type"]');ai!==null&&(ne.header_avatar_type=ai)}let pt=V('[name="header_avatar_url"]');pt!==null&&(ne.header_avatar_url=pt);let yi=V('[name="header_online_text"]');yi!==null&&(ne.header_online_text=yi);let Xt=Y('[name="popup_label_enabled"]');Xt!==null&&(ne.popup_label_enabled=Xt);let vt=V('[name="popup_label_text"]');vt!==null&&(ne.popup_label_text=vt);let Kt=V('[name="popup_label_mode"]');Kt!==null&&(ne.popup_label_mode=Kt);let st=V('[name="popup_label_size"]');st!==null&&(ne.popup_label_size=st);let ge=V('[name="popup_label_delay_seconds"]');ge!==null&&(ne.popup_label_delay_seconds=ge);let pe=V('[name="popup_label_auto_hide_seconds"]');pe!==null&&(ne.popup_label_auto_hide_seconds=pe);let Ge=Y('[name="popup_label_dismissible"]');Ge!==null&&(ne.popup_label_dismissible=Ge);let fe=Y('[name="popup_label_show_on_desktop"]');fe!==null&&(ne.popup_label_show_on_desktop=fe);let he=Y('[name="popup_label_show_on_mobile"]');he!==null&&(ne.popup_label_show_on_mobile=he);let tt=V('[name="popup_label_frequency"]');tt!==null&&(ne.popup_label_frequency=tt);let wt=V('[name="popup_label_version"]');return wt!==null&&(ne.popup_label_version=wt),ne},G=M(),z=()=>w&&w.value||e.getAttribute("data-active-bot-id"),X=K=>{let V=z();V&&(q=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_popup_settings",{bot_id:V,...K}).then(Y=>{G=K,ot(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I){let Y=I;I=null,JSON.stringify(Y)!==JSON.stringify(G)&&X(Y)}}))},te=K=>{if(!(!K||Object.keys(K).length===0)&&JSON.stringify(K)!==JSON.stringify(G)){if(q){I=K;return}X(K)}};zi.addEventListener("change",K=>{let V=K.target;V&&((V.matches('[name="popup_icon_default"]')||V.matches('select[name="popup_icon_style"]')||V.matches('[name="header_avatar_default"]')||V.matches(".aipkit_popup_hint_toggle_switch"))&&Qa(),(V.matches('[name="popup_position"]')||V.matches('[name="popup_delay"]')||V.matches('[name="popup_icon_style"]')||V.matches('[name="popup_icon_size"]')||V.matches('[name="popup_icon_default"]')||V.matches('[name="popup_icon_custom_url"]')||V.matches('[name="header_avatar_default"]')||V.matches('[name="header_avatar_url"]')||V.matches('[name="header_online_text"]')||V.matches('[name="popup_label_enabled"]')||V.matches('[name="popup_label_text"]')||V.matches('[name="popup_label_mode"]')||V.matches('[name="popup_label_size"]')||V.matches('[name="popup_label_delay_seconds"]')||V.matches('[name="popup_label_auto_hide_seconds"]')||V.matches('[name="popup_label_dismissible"]')||V.matches('[name="popup_label_show_on_desktop"]')||V.matches('[name="popup_label_show_on_mobile"]')||V.matches('[name="popup_label_frequency"]')||V.matches('[name="popup_label_version"]'))&&te(M()))}),e.addEventListener("change",K=>{let V=K.target;!V||!V.matches||!(V.matches('[name="header_online_text"]')||V.matches('[name="popup_delay"]')||V.matches('[name="popup_label_enabled"]')||V.matches(".aipkit_popup_hint_toggle_switch")||V.matches('select[name="popup_position"]')||V.matches('select[name="popup_icon_style"]')||V.matches('select[name="popup_icon_size"]'))||((V.matches('[name="popup_label_enabled"]')||V.matches(".aipkit_popup_hint_toggle_switch"))&&Qa(),!zi.contains(V)&&te(M()))}),Ee&&Ee.addEventListener("change",K=>{let V=K.target;V&&(V.matches('[name="popup_label_text"]')||V.matches('[name="popup_label_mode"]')||V.matches('[name="popup_label_size"]')||V.matches('[name="popup_label_delay_seconds"]')||V.matches('[name="popup_label_auto_hide_seconds"]')||V.matches('[name="popup_label_dismissible"]')||V.matches('[name="popup_label_show_on_desktop"]')||V.matches('[name="popup_label_show_on_mobile"]')||V.matches('[name="popup_label_frequency"]')||V.matches('[name="popup_label_version"]'))&&te(M())}),Qa(),e.dataset.popupSettingsAutosaveBound="1"}if(N&&$i&&!e.dataset.conversationSettingsAutosaveBound){let q=!1,I=null,M=()=>{let K=Y=>{let ne=N&&N.querySelector(Y)||re&&re.querySelector(Y);return ne?ne.value:""},V=Y=>{let ne=N.querySelector(Y);return ne?ne.tagName==="SELECT"?ne.value==="1"?"1":"0":ne.checked?"1":"0":"0"};return{stream_enabled:V(".aipkit_stream_enable_toggle"),openai_conversation_state_enabled:V(".aipkit_stateful_convo_checkbox"),reasoning_effort:K('[name="reasoning_effort"]')}},G=M(),z=K=>{let V=w&&w.value||e.getAttribute("data-active-bot-id");V&&(q=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_conversation_settings",{bot_id:V,...K}).then(Y=>{G=K,ot(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I){let Y=I;I=null,JSON.stringify(Y)!==JSON.stringify(G)&&z(Y)}}))},X=K=>{if(JSON.stringify(K)!==JSON.stringify(G)){if(q){I=K;return}z(K)}},te=K=>{let V=K.target;V&&(V.matches(".aipkit_stream_enable_toggle")||V.matches(".aipkit_stateful_convo_checkbox")||V.matches(".aipkit_reasoning_effort_slider")||V.matches('[name="reasoning_effort"]'))&&(Yo(),X(M()))};N.addEventListener("change",te),re&&re.addEventListener("change",te),e.dataset.conversationSettingsAutosaveBound="1"}if(N&&$i&&!e.dataset.fileUploadAutosaveBound){let q=!1,I=null,M=()=>{let te=N.querySelector('[name="enable_file_upload"]');return!te||te.disabled?"":te.tagName==="SELECT"?te.value==="1"?"1":"0":te.checked?"1":"0"},G=M(),z=te=>{let K=w&&w.value||e.getAttribute("data-active-bot-id");!K||te===""||(q=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_file_upload_settings",{bot_id:K,enable_file_upload:te}).then(V=>{G=te,ot(V.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(K),Oi()}).catch(V=>{ot(`Error: ${V.message||"Failed to save."}`,"error")}).finally(()=>{if(q=!1,I!==null&&I!==G){let V=I;I=null,z(V)}else I=null}))},X=te=>{if(!(te===""||te===G)){if(q){I=te;return}z(te)}};N.addEventListener("change",te=>{let K=te.target;K&&K.matches('[name="enable_file_upload"]')&&(X(M()),xe()==="1"?Et():ct())}),e.dataset.fileUploadAutosaveBound="1"}let Ur=w&&w.value||e.getAttribute("data-active-bot-id");if(Ur&&typeof window.aipkit_refreshChatPreview=="function"){window.aipkit_refreshChatPreview(Ur);return}let es=window.aipkit_dashboard?.text?.previewPlaceholderSelect||"Select a bot to see the preview.";l(es)}window.aipkit_initChatbotBuilder=o})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelector(".aipkit_token_limit_mode_select"),s=r.querySelector(".aipkit_token_general_user_limit_field"),n=r.querySelector(".aipkit_token_role_limits_container");if(!i||!s||!n){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let c=i.value;s.style.display=c==="general"?"block":"none",n.style.display=c==="role_based"?"block":"none"}function a(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Token Management JS: Main content container not found.");return}r.addEventListener("change",function(s){let n=s.target.closest(".aipkit_token_limit_mode_select");if(!n)return;let c=n.closest(".aipkit_accordion-content");c?k(c):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",n)}),r.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(s=>{let n=s.querySelector(".aipkit_accordion-content");n&&k(n)})}window.aipkit_initTokenManagementUI=a})();(function(){"use strict";function k(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let r=document.querySelector(".aipkit_chatbot_module_container");r&&(r.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js."),typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatSelectPickers=="function"?window.aipkit_initChatSelectPickers():console.error("AIPKit Chat Admin Main: aipkit_initChatSelectPickers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Chat Admin Main: aipkit_initSyncButtons function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles(".aipkit_chatbot_module_container"):console.error("AIPKit Chat Admin Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCustomThemePresets=="function"?window.aipkit_initCustomThemePresets():console.error("AIPKit Chat Admin Main: aipkit_initCustomThemePresets function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initChatbotBuilder=="function"&&window.aipkit_initChatbotBuilder(),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found.");let a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(a){let r=a.dataset.botId,i=document.getElementById(`aipkit_trigger_builder_${r}`);r&&i&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(r):r&&i&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${r}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy(),function(){let i=document.querySelector(".aipkit_chatbot_module_container");i&&i.addEventListener("click",function(s){if(s.target.closest(".aipkit_header_reset_btn, .aipkit_header_delete_btn, .aipkit_actions_dropdown_container .aipkit_tab_dropdown_trigger"))return;if(s.target.closest("#aipkit_chatbot_header_save_btn")){let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");o&&(typeof o.requestSubmit=="function"?o.requestSubmit():o.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})));return}if(s.target.closest(".aipkit_header_reset_btn")){let o=i.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");o&&(o.style.display="none");let t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form")?.dataset.botId,p=i.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",d=i.querySelector("#aipkit_header_action_feedback");if(!t||!d)return;d.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_reset_confirmation" id="aipkit_reset_confirmation_${t}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_inline">Confirm</button>
              </div>
            </div>`,d.querySelector(".aipkit_reset_cancel_inline")?.addEventListener("click",()=>{d.innerHTML=""},{once:!0}),d.querySelector(".aipkit_reset_confirm_inline")?.addEventListener("click",()=>{d.innerHTML='<span class="aipkit_action_status_message">Resetting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:t}).then(u=>{d.innerHTML=`<span class="aipkit_action_status_message success">${u.message||"Chatbot reset successfully!"}</span>`,typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:t,aipkit_silent:!0,aipkit_force_refresh:!0}),setTimeout(()=>{d.innerHTML=""},3e3)}).catch(u=>{d.innerHTML=`<span class="aipkit_action_status_message error">Error: ${u.message||"Failed to reset chatbot."}</span>`,setTimeout(()=>{d.innerHTML=""},4e3)})},{once:!0});return}if(s.target.closest(".aipkit_header_delete_btn")){let o=i.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");o&&(o.style.display="none");let e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),t=e?.dataset.botId,p=e?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",d=i.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",u=i.querySelector("#aipkit_header_action_feedback");if(!t||!u)return;if(p){u.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{u.innerHTML=""},3e3);return}u.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_delete_confirmation" id="aipkit_delete_confirmation_${t}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_inline">Confirm</button>
              </div>
            </div>`,u.querySelector(".aipkit_delete_cancel_inline")?.addEventListener("click",()=>{u.innerHTML=""},{once:!0}),u.querySelector(".aipkit_delete_confirm_inline")?.addEventListener("click",()=>{u.innerHTML='<span class="aipkit_action_status_message">Deleting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:t}).then(f=>{u.innerHTML=`<span class="aipkit_action_status_message success">${f.message||"Chatbot deleted successfully."}</span>`;let m=null,g=document.getElementById("aipkit_chatbot_main_selector_container");if(g){let _=Array.from(g.querySelectorAll(".aipkit_tab_dropdown_item[data-bot-id]")),h=_.filter(E=>{let x=E.getAttribute("data-bot-id");return x&&x!==String(t)}),y=_.findIndex(E=>E.getAttribute("data-bot-id")===String(t));if(y>0){let E=_[y-1],x=E?E.getAttribute("data-bot-id"):null;x&&x!==String(t)&&(m=x)}!m&&h.length>0&&(m=h[0].getAttribute("data-bot-id"))}if(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"){let _=m?{force_active_bot_id:m}:{};_.aipkit_silent=!0,_.aipkit_force_refresh=!0,window.aipkit_loadModule("chatbot",_)}setTimeout(()=>{u.innerHTML=""},3e3)}).catch(f=>{u.innerHTML=`<span class="aipkit_action_status_message error">Error: ${f.message||"Failed to delete chatbot."}</span>`,setTimeout(()=>{u.innerHTML=""},4e3)})},{once:!0});return}})}()}window.aipkit_initChatbot=k})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"modified",sortDirection:"desc",isLoading:!1}})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_ai_forms_container"),s=window.aipkit_escapeHtml||(o=>o),n=wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o,c=wp.i18n&&wp.i18n._n?wp.i18n._n:null,l=wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:null;r&&(r.innerHTML="",!(!a||a.length===0)&&a.forEach(o=>{let e=window.aipkit_dashboard?.isProPlan??!1,t=window.aipkit_dashboard?.upgradeUrl||"#",p="",d="";if(e)p=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label">${n("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="pdf_download" value="true">
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`;else{let b=n("This is a Pro feature. Please upgrade.","gpt3-ai-content-generator");p=`
              <div class="aipkit_popover_option_row aipkit_popover_option_row--disabled">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label" data-tooltip="${s(b)}">${n("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch" disabled>
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`,d=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main aipkit_popover_option_main--stacked">
                      <p class="aipkit_form-help">${n("Save as PDF is available on the Pro plan.","gpt3-ai-content-generator")}</p>
                      <a class="aipkit_btn aipkit_btn-primary" href="${s(t)}" target="_blank" rel="noopener noreferrer">
                        ${n("Upgrade to Pro","gpt3-ai-content-generator")}
                      </a>
                  </div>
              </div>`}let u=r.insertRow(),f=u.insertCell();f.classList.add("aipkit_ai_form_title_cell");let m=s(o.title||n("Untitled","gpt3-ai-content-generator")),g=o.updated_at||o.updatedAt||o.updated||"",_="",h="";g&&(typeof window.aipkit_formatRelativeDateTime=="function"?_=window.aipkit_formatRelativeDateTime(g):typeof window.aipkit_formatUtcDateTime=="function"?_=window.aipkit_formatUtcDateTime(g):_=g,typeof window.aipkit_formatUtcDateTime=="function"&&(h=window.aipkit_formatUtcDateTime(g)));let y=o.submissions_count??o.submission_count??o.submissionsCount??0,E=Number.isFinite(Number(y))?Number(y):0,x=[];if(_){let b=l?l(n("Updated %s","gpt3-ai-content-generator"),_):`${n("Updated","gpt3-ai-content-generator")} ${_}`,L=h?` title="${s(h)}"`:"";x.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_updated"${L}>${s(b)}</span>`)}if(E>0){let b=`${E} ${n(E===1?"submission":"submissions","gpt3-ai-content-generator")}`;c&&l&&(b=l(c("%s submission","%s submissions",E,"gpt3-ai-content-generator"),E)),x.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_count">${s(b)}</span>`)}let w=x.length?`
          <span class="aipkit_ai_form_meta">
            ${x.join('<span class="aipkit_ai_form_meta_sep" aria-hidden="true">&middot;</span>')}
          </span>
        `:"";f.innerHTML=`
        <span class="aipkit_ai_form_title_text" title="${m}">${m}</span>
        ${w}
      `;let S=u.insertCell();S.classList.add("aipkit_ai_form_model_cell");let T=o.model||n("Default","gpt3-ai-content-generator");S.textContent=T,S.title=T;let v=u.insertCell();v.classList.add("aipkit_shortcode_cell","aipkit_ai_form_shortcode_cell");let A=`aipkit_ai_form_theme_${o.id}`;v.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${o.id}" readonly value="${s(o.shortcode)}" data-aipkit-shortcode-display="${o.id}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${o.id}" title="${n("Shortcode settings","gpt3-ai-content-generator")}" aria-label="${n("Shortcode settings","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-shortcode" aria-hidden="true"></span>
              <span class="screen-reader-text">${n("Shortcode settings","gpt3-ai-content-generator")}</span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator aipkit_model_settings_popover_panel" id="aif-configurator-${o.id}" style="display: none;" role="dialog" aria-modal="false" aria-labelledby="aif-shortcode-title-${o.id}">
            <div class="aipkit_model_settings_popover_header">
                <span class="aipkit_model_settings_popover_title" id="aif-shortcode-title-${o.id}">
                  ${n("Shortcode Settings","gpt3-ai-content-generator")}
                </span>
                <button
                    type="button"
                    class="aipkit_model_settings_popover_close aipkit_aiform_shortcode_close"
                    aria-label="${n("Close","gpt3-ai-content-generator")}"
                >
                    <span class="dashicons dashicons-no-alt"></span>
                </button>
            </div>
            <div class="aipkit_model_settings_popover_body">
                <div class="aipkit_popover_options_list">
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${n("Show Provider Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="show_provider" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${n("Show Model Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="show_model" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${n("Copy Button","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="copy_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${n("Save as Post","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="save_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    ${p}
                    ${d}
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <label class="aipkit_popover_option_label" for="${A}">
                              ${n("Theme","gpt3-ai-content-generator")}
                            </label>
                            <div class="aipkit_popover_option_actions">
                                <select id="${A}" class="aipkit_popover_option_select aipkit-aiform-config-input" data-form-id="${o.id}" data-attr-name="theme">
                                    <option value="light">${n("Light (default)","gpt3-ai-content-generator")}</option>
                                    <option value="dark">${n("Dark","gpt3-ai-content-generator")}</option>
                                    <option value="custom">${n("Custom","gpt3-ai-content-generator")}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${n("Shortcode","gpt3-ai-content-generator")}</span>
                            <div class="aipkit_popover_option_actions">
                                <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" readonly value="${s(o.shortcode)}" data-aipkit-shortcode-display="${o.id}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="aipkit_popover_flyout_footer">
                <span class="aipkit_popover_flyout_footer_text">
                    ${n("Need help?","gpt3-ai-content-generator")}
                </span>
                <a
                    class="aipkit_popover_flyout_footer_link"
                    href="https://docs.aipower.org/docs/category/ai-forms"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    ${n("Documentation","gpt3-ai-content-generator")}
                </a>
            </div>
        </div>
      `,i&&typeof window.aipkitForms_applyStoredShortcodeConfig=="function"&&window.aipkitForms_applyStoredShortcodeConfig(o.id,i);let C=u.insertCell();C.classList.add("aipkit_form_actions_cell"),C.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_edit_ai_form_btn" data-form-id="${o.id}" title="${n("Edit","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            ${n("Edit","gpt3-ai-content-generator")}
          </button>
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_preview_ai_form_btn" data-form-id="${o.id}" data-form-title="${s(o.title||"")}" title="${n("Preview","gpt3-ai-content-generator")}" aria-label="${n("Preview","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-visibility" aria-hidden="true"></span>
            <span class="screen-reader-text">${n("Preview","gpt3-ai-content-generator")}</span>
          </button>
          <div class="aipkit_actions_menu">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_actions_menu_toggle" title="${n("More actions","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-ellipsis"></span>
            </button>
            <div class="aipkit_actions_dropdown_menu">
              <button type="button" class="aipkit_dropdown-item-btn aipkit_duplicate_ai_form_btn" data-form-id="${o.id}" title="${n("Duplicate","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-page"></span>
                <span>${n("Duplicate","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_export_ai_form_btn" data-form-id="${o.id}" title="${n("Export","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-download"></span>
                <span>${n("Export","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_dropdown-item--danger aipkit_delete_ai_form_btn" data-form-id="${o.id}" data-form-title="${s(o.title)}" title="${n("Delete","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-trash"></span>
                <span>${n("Delete","gpt3-ai-content-generator")}</span>
              </button>
            </div>
          </div>
        </div>
      `}))}window.aipkitForms_renderTable=k})();(function(){"use strict";function k(a){let r=window.aipkitAIFormsListState,i=document.getElementById("aipkit_ai_forms_pagination"),s=document.getElementById("aipkit_ai_forms_count_summary");if(!i||!a||!r)return;let n=wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,c=wp.i18n&&wp.i18n._n?wp.i18n._n:(t,p,d)=>d===1?t:p;i.innerHTML="";let{total_forms:l,total_pages:o}=a,e=r.currentPage;if(s){let t=c("form","forms",l,"gpt3-ai-content-generator");s.textContent=`${l.toLocaleString()} ${t}`}if(!(l<=0)&&o>1){let t=document.createElement("span");t.className="aipkit_pagination-links";let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",p.innerHTML=`\xAB ${n("Previous","gpt3-ai-content-generator")}`,p.disabled=e<=1,t.appendChild(p);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`${n("Page","gpt3-ai-content-generator")} ${e} ${n("of","gpt3-ai-content-generator")} ${o}`,t.appendChild(d);let u=document.createElement("button");u.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",u.innerHTML=`${n("Next","gpt3-ai-content-generator")} \xBB`,u.disabled=e>=o,t.appendChild(u),i.appendChild(t)}}window.aipkitForms_renderPagination=k})();(function(){"use strict";function k(){let a=window.aipkitAIFormsListState;if(!a||a.isLoading)return;a.isLoading=!0;let r=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_no_ai_forms_message"),s=document.getElementById("aipkit_ai_forms_pagination");r&&(r.innerHTML='<tr><td colspan="4" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),i&&(i.style.display="none"),s&&(s.innerHTML="");let c={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:a.currentPage,search:a.searchQuery,sort_by:a.sortColumn,sort_order:a.sortDirection};window.aipkit_apiRequest("aipkit_list_ai_forms",c).then(l=>{if(typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(l.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(l.pagination||{}),i&&(!l.forms||l.forms.length===0)){i.style.display="block";let o=!!a.searchQuery&&a.searchQuery.trim().length>0;i.textContent=o?"No forms found matching your search.":"No AI Forms have been created yet."}}).catch(l=>{r&&(r.innerHTML=`<tr><td colspan="4" style="color:red;text-align:center;">Error loading forms: ${l.message}</td></tr>`)}).finally(()=>{a.isLoading=!1})}window.aipkitForms_fetchForms=k})();(function(){"use strict";let k;function a(){let r=document.getElementById("aipkit_ai_forms_list_container");if(!r||r.dataset.listListenersAttached)return;r.dataset.listListenersAttached="true";let i=window.aipkitAIFormsListState;if(!i){console.error("AI Forms Events: List state object is not available.");return}r.addEventListener("click",function(n){let c=n.target,l=c.closest(".aipkit-sortable-col");if(l){let o=l.dataset.sortKey;i.sortColumn===o?i.sortDirection=i.sortDirection==="asc"?"desc":"asc":(i.sortColumn=o,i.sortDirection="asc"),i.currentPage=1,r.querySelectorAll(".aipkit-sortable-col").forEach(e=>e.removeAttribute("data-sort-direction")),l.setAttribute("data-sort-direction",i.sortDirection),window.aipkitForms_fetchForms();return}if(c.matches(".aipkit_pagination_prev")){i.currentPage>1&&(i.currentPage--,window.aipkitForms_fetchForms());return}if(c.matches(".aipkit_pagination_next")){i.currentPage++,window.aipkitForms_fetchForms();return}});let s=r.querySelector("#aipkit_ai_forms_search_input");s&&s.addEventListener("input",function(){clearTimeout(k),k=setTimeout(()=>{i.searchQuery=this.value,i.currentPage=1,window.aipkitForms_fetchForms()},400)})}window.aipkitForms_attachListEventListeners=a})();(function(){"use strict";function k(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=k})();(function(){"use strict";function k(a){let r=window.aipkitAIFormsState;if(!a){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=a.querySelector("#aipkit_ai_form_elements_palette"),s=a.querySelector("#aipkit_ai_form_designer_area"),n=a.querySelector("#aipkit_form_designer_placeholder");if(!i||!s){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&s.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(l=>{l.dataset.dragStartListenerAttached!=="true"&&(l.addEventListener("dragstart",o=>{r.draggedElementType=o.target.dataset.elementType,o.dataTransfer.setData("text/plain",r.draggedElementType),o.dataTransfer.effectAllowed="copy",o.target.classList.add("aipkit-dragging"),r.draggedElement=null}),l.addEventListener("dragend",o=>{o.target.classList.remove("aipkit-dragging"),r.draggedElementType=null}),l.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",s.dataset.dragListenersAttached!=="true"&&(s.addEventListener("dragstart",l=>{l.target.classList.contains("aipkit_dropped_element")&&(r.draggedElement=l.target,l.dataTransfer.setData("text/element-id",l.target.id),l.dataTransfer.effectAllowed="move",setTimeout(()=>{r.draggedElement&&(r.draggedElement.style.opacity="0.5")},0),r.draggedElementType=null)}),s.addEventListener("dragend",l=>{r.draggedElement&&(r.draggedElement.style.opacity="1",r.draggedElement=null)}),s.addEventListener("dragover",l=>{l.preventDefault();let o=l.target.closest(".aipkit_dropped_element");s.classList.add("aipkit-drag-over"),r.draggedElement&&o&&r.draggedElement!==o?l.dataTransfer.dropEffect="move":l.dataTransfer.dropEffect="copy"}),s.addEventListener("dragleave",l=>{s.contains(l.relatedTarget)||s.classList.remove("aipkit-drag-over")}),s.addEventListener("drop",l=>{l.preventDefault(),s.classList.remove("aipkit-drag-over");let o=l.dataTransfer.getData("text/element-id");if(r.draggedElement&&o===r.draggedElement.id){let e=l.target.closest(".aipkit_dropped_element"),t=null;if(e&&e!==r.draggedElement){let p=e.getBoundingClientRect();t=l.clientY>p.top+p.height/2?e.nextSibling:e}s.insertBefore(r.draggedElement,t),r.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){if(n&&n.style.display!=="none"&&(n.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let e=window.aipkitForms_createNewFormElementData(r.draggedElementType);r.formStructure.push(e),window.aipkitForms_renderDroppedElement(s,e,null)}r.draggedElementType=null,r.draggedElement=null}),s.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=k})();(function(){"use strict";function k(){let a=window.aipkitAIFormsState,r=document.getElementById("aipkit_ai_form_designer_area");if(!r)return;let i=[];r.querySelectorAll(".aipkit_layout_row").forEach(n=>{let c=n.id,l=a.formStructure.find(t=>t.internalId===c);if(!l)return;let o={internalId:c,type:"layout-row",columns:[]};n.querySelectorAll(".aipkit_layout_column").forEach(t=>{let p=t.id,d=l.columns.find(m=>m.internalId===p);if(!d)return;let u={internalId:p,width:d.width,elements:[]};t.querySelectorAll(".aipkit_dropped_element").forEach(m=>{let g=m.id,_=null;a.formStructure.forEach(h=>{h.columns.forEach(y=>{let E=y.elements.find(x=>x.internalId===g);E&&(_=E)})}),_&&u.elements.push(_)}),o.columns.push(u)}),i.push(o)}),a.formStructure=i}window.aipkitForms_updateFormStructureOrder=k})();(function(){"use strict";function k(r){let i=window.aipkitAIFormsState;i.droppedElementCounter++;let s=`field_${r.replace(/-/g,"_")}_${i.droppedElementCounter}`;switch(r){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:r,label:`New ${r.replace(/-/g," ").replace(/\b\w/g,l=>l.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:s,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let n,c;return r==="select"?(n="New Dropdown",c="select"):r==="radio-button"?(n="New Radio Buttons",c="radio"):(n="New Checkbox Group",c="checkbox"),{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:r,label:n,fieldId:`${c}_${i.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${i.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function a(r){let i=Date.now(),s=[];switch(r){case"1-col":s=[{internalId:`col-${i}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":s=[{internalId:`col-${i}-1`,width:"50%",elements:[]},{internalId:`col-${i}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":s=[{internalId:`col-${i}-1`,width:"33.33%",elements:[]},{internalId:`col-${i}-2`,width:"33.33%",elements:[]},{internalId:`col-${i}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":s=[{internalId:`col-${i}-1`,width:"30%",elements:[]},{internalId:`col-${i}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":s=[{internalId:`col-${i}-1`,width:"70%",elements:[]},{internalId:`col-${i}-2`,width:"30%",elements:[]}];break;default:s=[{internalId:`col-${i}-1`,width:"100%",elements:[]}]}return{internalId:`row-${i}`,type:"layout-row",columns:s}}window.aipkitForms_createNewFormElementData=k,window.aipkitForms_createNewLayoutData=a})();(function(){"use strict";function k(a,r,i=null){let s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u,n=window.aipkit_escapeHtml||function(u){return u},c=document.createElement("div");c.className="aipkit_dropped_element",c.id=r.internalId,c.dataset.elementType=r.type;let l=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${s("Drag to reorder","gpt3-ai-content-generator")}"></span>`,o="",e=`${r.internalId}-field`,t="";switch(r.helpText&&(t=`<p class="aipkit_dropped_element_help_text">${n(r.helpText)}</p>`),r.type){case"text-input":o=`<label class="aipkit_dropped_element_label" for="${e}">${n(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${e}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${n(r.placeholder)}" readonly>
                    ${t}`;break;case"textarea":o=`<label class="aipkit_dropped_element_label" for="${e}">${n(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${e}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${n(r.placeholder)}" readonly></textarea>
                    ${t}`;break;case"select":let u="";r.options&&r.options.length>0?r.options.forEach(g=>{u+=`<option value="${n(g.value)}">${n(g.text)}</option>`}):u=`<option>${s("No options configured","gpt3-ai-content-generator")}</option>`,o=`<label class="aipkit_dropped_element_label" for="${e}">${n(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${e}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${u}</select>
                    ${t}`;break;case"radio-button":let f="";r.options&&r.options.length>0?r.options.forEach((g,_)=>{let h=`${e}-${_}`;f+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${h}" class="aipkit_dropped_element_field" name="preview-${r.internalId}" disabled>
                                    <label for="${h}">${n(g.text)}</label>
                                </div>`}):f=`<p class="aipkit-no-options-note">${s("No options configured","gpt3-ai-content-generator")}</p>`,o=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${n(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${f}
                    </fieldset>
                    ${t}`;break;case"checkbox":let m="";r.options&&r.options.length>0?r.options.forEach((g,_)=>{let h=`${e}-${_}`;m+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${h}" class="aipkit_dropped_element_field" name="preview-${r.internalId}-${_}" disabled>
                                    <label for="${h}">${n(g.text)}</label>
                                </div>`}):m=`<p class="aipkit-no-options-note">${s("No options configured","gpt3-ai-content-generator")}</p>`,o=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${n(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${m}
                    </fieldset>
                    ${t}`;break;case"file-upload":o=`<label class="aipkit_dropped_element_label" for="${e}">${n(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${e}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${t}`;break;default:o=`<p>${n(r.label)}</p>${t}`}let p=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${s("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,d=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${s("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;c.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${o}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${l}
            ${p}
            ${d}
        </div>
    `,i?a.insertBefore(c,i):a.appendChild(c)}window.aipkitForms_renderFieldInColumn=k,window.aipkitForms_renderDroppedElement=k})();(function(){"use strict";function k(a,r){let i=window.aipkitAIFormsState,s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l;if(!r){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let n=r.querySelector("#aipkit_ai_form_designer_area");if(!n){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let c=n.querySelector(`#${CSS.escape(a)}`);if(c&&(c.remove(),i.formStructure.forEach(l=>{l.columns.forEach(o=>{o.elements=o.elements.filter(e=>e.internalId!==a)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r),i.selectedDesignerElementId===a&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(r):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),n.querySelectorAll(".aipkit_dropped_element").length===0&&n.querySelectorAll(".aipkit_layout_row").length===0)){let l=n.querySelector("#aipkit_form_designer_placeholder");l||(l=document.createElement("div"),l.className="aipkit_form_designer_placeholder",l.id="aipkit_form_designer_placeholder",l.innerHTML=`<span class="dashicons dashicons-layout"></span>${s("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,n.appendChild(l)),l.style.display="flex"}}window.aipkitForms_deleteDroppedElement=k})();(function(){"use strict";function k(){let a=window.aipkitAIFormsState,r=wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,i=document.getElementById("aipkit_form_editor_container");if(!i)return;let s=i.querySelector("#aipkit_ai_form_prompt_template"),n=i.querySelector("#aipkit_prompt_validation_results");if(!s||!n)return;let c=s.value,l=[],o=[],e=new Set;a.formStructure.forEach(m=>{m.columns.forEach(g=>{g.elements.forEach(_=>{_.fieldId&&e.add(_.fieldId)})})});let t=/{[a-zA-Z0-9_]+}/g,p=(c.match(t)||[]).map(m=>m.slice(1,-1)),d=new Set(p);p.forEach(m=>{e.has(m)||l.push(`Variable <code>{${m}}</code> is used in the prompt but not defined as a form field.`)}),e.forEach(m=>{d.has(m)||o.push(`Field <code>{${m}}</code> is defined but not used in the prompt.`)});let u=c;if(p.forEach(m=>{let g=new RegExp(`\\{${m}\\}`,"g");u=u.replace(g,"")}),/[{}]/.test(u)&&l.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),n.className="aipkit_form-help",n.innerHTML="",l.length>0){n.classList.add("aipkit-validation-error");let m=`<strong>${r("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;l.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>",n.innerHTML=m}else{n.classList.add("aipkit-validation-success");let m=`<strong>${r("Validation Passed!","gpt3-ai-content-generator")}</strong> (${p.length} of ${e.size} fields used).`;o.length>0&&(m+=`<br><strong>${r("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,o.forEach(g=>{m+=`<li>${g}</li>`}),m+="</ul>"),n.innerHTML=m}n.style.display="block",n.dismissTimer&&clearTimeout(n.dismissTimer);let f=l.length>0?8e3:5e3;n.dismissTimer=setTimeout(()=>{n.style.display="none",n.innerHTML=""},f)}window.aipkitForms_validatePrompt=k})();(function(){"use strict";function k(a,r){let i=window.aipkitAIFormsState,s=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u,c=window.aipkit_escapeHtml||function(u){return u};if(!r){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}r.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(u=>u.classList.remove("aipkit-element-selected"));let l=r.querySelector(`#${CSS.escape(a)}`);l&&l.classList.add("aipkit-element-selected"),i.selectedDesignerElementId=a;let o=null;for(let u of i.formStructure){for(let f of u.columns){let m=f.elements.find(g=>g.internalId===a);if(m){o=m;break}}if(o)break}if(!o){console.error(`showSettingsPanel: Could not find element data for ID ${a} in state.`,i.formStructure);return}let e=r.querySelector("#aipkit_ai_form_elements_palette"),t=r.querySelector("#aipkit_ai_form_element_settings_panel"),p=t?t.querySelector("#aipkit_settings_panel_fields"):null,d=t?t.querySelector("#aipkit_settings_panel_element_type"):null;if(!e||!t||!p||!d){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(d.textContent=`(${o.type.replace(/-/g," ").replace(/\b\w/g,u=>u.toUpperCase())})`,p.innerHTML="",p.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${o.internalId}">${n(s.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="label" value="${c(o.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${o.internalId}">${n(s.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="fieldId" value="${c(o.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${n("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${n(s.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(o.type==="text-input"||o.type==="textarea")&&(p.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${o.internalId}">${n(s.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${o.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="placeholder" value="${c(o.placeholder||"")}">
                </div>`),p.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${o.internalId}">
                    <input type="checkbox" id="setting-required-${o.internalId}" class="aipkit-setting-field" data-setting="required" ${o.required?"checked":""}>
                    ${n(s.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${o.internalId}">${n("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${o.internalId}" class="aipkit_form-input aipkit_builder_textarea aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${c(n("This text will appear under the field.","gpt3-ai-content-generator"))}">${c(o.helpText||"")}</textarea>
            </div>
        `,o.type==="select"||o.type==="radio-button"||o.type==="checkbox"){let u=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${n(s.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(o.options||[]).forEach((f,m)=>{u+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-value" data-option-index="${m}" value="${c(f.value)}" placeholder="${n(s.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-text" data-option-index="${m}" value="${c(f.text)}" placeholder="${n(s.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${n(s.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),u+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${n(s.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,p.innerHTML+=u}e.style.display="none",t.style.display="block"}window.aipkitForms_showSettingsPanel=k})();(function(){"use strict";function k(a){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!a){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let s=a.querySelector("#aipkit_ai_form_element_settings_panel");if(!s){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let n=s.querySelector("#aipkit_select_options_container");if(!n){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let c=n.querySelectorAll(".aipkit_select_option_row").length,l=document.createElement("div");l.className="aipkit_select_option_row",l.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${c}" placeholder="${i(r.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${c}" placeholder="${i(r.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${i(r.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,n.appendChild(l)}window.aipkitForms_addSelectOptionRow=k})();(function(){"use strict";function k(a){let r=window.aipkitAIFormsState;if(!a){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}a.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(n=>n.classList.remove("aipkit-element-selected")),r.selectedDesignerElementId=null;let i=a.querySelector("#aipkit_ai_form_elements_palette"),s=a.querySelector("#aipkit_ai_form_element_settings_panel");i&&(i.style.display="block"),s&&(s.style.display="none")}window.aipkitForms_hideSettingsPanel=k})();(function(){"use strict";function k(a,r){let i=window.aipkitAIFormsState,s=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f;if(!r){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let c=null;for(let f of i.formStructure){for(let m of f.columns){let g=m.elements.find(_=>_.internalId===a);if(g){c=g;break}}if(c)break}if(!c){console.error(`updateElementFromSettingsPanel: Element data for ID ${a} not found.`);return}let l=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!l){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let o=l.querySelector('input[data-setting="label"]');o&&(c.label=o.value);let e=l.querySelector('input[data-setting="fieldId"]');if(e){let f=e.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!f){let g=c.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");g||(g=c.type.replace(/-/g,"_")),f=`${g}_${a.split("-").pop()}`}let m=!0;e:for(let g of i.formStructure)for(let _ of g.columns)if(_.elements.some(h=>h.internalId!==a&&h.fieldId===f)){m=!1;break e}m&&f.length>0?(c.fieldId=f,e.value=f,e.classList.remove("aipkit_input_error")):f.length>0&&e.classList.add("aipkit_input_error")}let t=l.querySelector('input[data-setting="required"]');t&&(c.required=t.checked);let p=l.querySelector('textarea[data-setting="helpText"]');if(p&&(c.helpText=p.value),c.type==="text-input"||c.type==="textarea"){let f=l.querySelector('input[data-setting="placeholder"]');f&&(c.placeholder=f.value)}(c.type==="select"||c.type==="radio-button"||c.type==="checkbox")&&(c.options=[],l.querySelectorAll(".aipkit_select_option_row").forEach(m=>{let g=m.querySelector('input[data-setting="option-value"]'),_=m.querySelector('input[data-setting="option-text"]');g&&_&&g.value.trim()!==""?c.options.push({value:g.value,text:_.value}):g&&_&&g.value.trim()===""&&_.value.trim()!==""&&c.options.push({value:_.value,text:_.value})}));let d=r.querySelector("#aipkit_ai_form_designer_area"),u=d?d.querySelector(`#${CSS.escape(a)}`):null;if(u&&d){let f=u.parentElement,m=d.scrollTop,g=u.classList.contains("aipkit-element-selected"),_=u.nextElementSibling;if(u.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(f,c,_):console.error("AI Forms updateElement: renderFieldInColumn function missing."),g){let h=d.querySelector(`#${CSS.escape(a)}`);h&&h.classList.add("aipkit-element-selected")}d.scrollTop=m}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r)}window.aipkitForms_updateElementFromSettingsPanel=k})();(function(){"use strict";function k(s){let n=window.aipkitAIFormsState;if(!s)return;let c=s.querySelector("#aipkit_prompt_snippets_container");if(!c)return;c.innerHTML="";let l=new Set;if(n.formStructure.forEach(o=>{o.columns.forEach(e=>{e.elements.forEach(t=>{t.fieldId&&l.add(t.fieldId)})})}),l.size>0){let o=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e;l.forEach(e=>{let t=document.createElement("button");t.type="button",t.className="aipkit_prompt_snippet",t.dataset.fieldId=e,t.title=o("Click to copy","gpt3-ai-content-generator"),t.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${e}}`,c.appendChild(t)})}}function a(s){if(!s)return;let n=s.querySelector("#aipkit_form_editor_container");if(!n){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let c=n.querySelector("#aipkit_prompt_snippets_container");if(!c){console.warn("AI Forms: Prompt snippets container not found for init.");return}c.dataset.listenerAttached!=="true"&&(c.addEventListener("click",function(l){let o=l.target.closest(".aipkit_prompt_snippet");if(!o)return;let e=o.dataset.fieldId;e&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${e}}`,o)}),c.dataset.listenerAttached="true")}function r(s,n){if(!s)return;let c=s.querySelector("#aipkit_ai_form_ai_provider");c&&(c.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(n?c.dataset.aipkitProviderNoticeArmed="true":delete c.dataset.aipkitProviderNoticeArmed),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(s))}function i(s=null,n){let c=window.aipkitAIFormsState,l=window.aipkit_ai_forms_config||{text:{}},o=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:m=>m,e=window.aipkit_escapeHtml||function(m){return m};if(!n){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}c.currentFormId=s,c.droppedElementCounter=0,c.formStructure=[],c.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(n):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let t=n.querySelector("#aipkit_form_editor_container"),p=n.querySelector("#aipkit_ai_forms_list_container"),d=n.querySelector("#aipkit_ai_forms_editor_actions"),u=n.querySelector("#aipkit_create_new_ai_form_btn"),f=n.querySelector("#aipkit_ai_forms_settings_trigger");p.style.display="none",t.style.display="block",d&&(d.style.display="flex"),u&&(u.style.display="none"),f&&(f.style.display="none"),requestAnimationFrame(()=>{let m=()=>{typeof window.aipkitForms_refreshSelectPickers=="function"&&window.aipkitForms_refreshSelectPickers(n)},g=n.querySelector("#aipkit_ai_form_title"),_=t.querySelector("#aipkit_ai_form_prompt_template"),h=t.querySelector("#aipkit_ai_form_id"),y=t.querySelector("#aipkit_ai_form_designer_area"),E=t.querySelector("#aipkit_ai_form_ai_provider"),x=t.querySelector("#aipkit_ai_form_ai_model"),w=t.querySelector("#aipkit_ai_form_temperature"),S=t.querySelector("#aipkit_ai_form_temperature_value"),T=t.querySelector("#aipkit_ai_form_max_tokens"),v=t.querySelector("#aipkit_ai_form_max_tokens_value"),A=t.querySelector("#aipkit_ai_form_top_p"),C=t.querySelector("#aipkit_ai_form_top_p_value"),b=t.querySelector("#aipkit_ai_form_frequency_penalty"),L=t.querySelector("#aipkit_ai_form_frequency_penalty_value"),B=t.querySelector("#aipkit_ai_form_presence_penalty"),$=t.querySelector("#aipkit_ai_form_presence_penalty_value"),W=n.querySelector("#aipkit_preview_ai_form_btn"),U=()=>{let J=document.createElement("div");return J.className="aipkit_form_designer_placeholder",J.id="aipkit_form_designer_placeholder",J.innerHTML=`<span class="dashicons dashicons-layout"></span>${o("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,J};if(!t||!p||!g||!_||!h||!y||!E||!x||!w||!T||!W||!S||!v||!A||!C||!b||!L||!B||!$){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:n.innerHTML.substring(0,500)});return}let D=n.querySelector("#aipkit_ai_forms_header_title_default"),H=n.querySelector("#aipkit_ai_forms_header_title_editor"),Q=n.querySelector("#aipkit_ai_forms_title_display"),F=n.querySelector("#aipkit_ai_forms_title_text"),P=o("New Form","gpt3-ai-content-generator"),R=()=>{if(!F||!Q||!g)return;let we=g.value.trim()||P;F.textContent=we,Q.setAttribute("title",we)},O=()=>{!Q||!g||(Q.style.display="none",g.style.display="inline-block",g.focus(),g.select())},N=()=>{!Q||!g||(g.style.display="none",Q.style.display="inline-flex",R())};D&&(D.style.display="none"),H&&(H.style.display="flex"),H&&H.dataset.inlineTitleBound!=="true"&&Q&&g&&(Q.addEventListener("click",O),g.addEventListener("blur",N),g.addEventListener("keydown",J=>{J.key==="Enter"&&(J.preventDefault(),g.blur())}),g.addEventListener("input",R),H.dataset.inlineTitleBound="true"),g.value="",_.value="",h.value="",y.innerHTML="",y.appendChild(U()),N(),k(n);let ie={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Engine",model_label:"Model"};if(t.querySelectorAll('input[name^="labels["]').forEach(J=>{let we=J.name.match(/labels\[(.+)\]/),$e=we?we[1]:null;$e&&ie[$e]!==void 0?J.value=ie[$e]:J.value=""}),!s){if(E.value="OpenAI",w&&S){let J=window.aipkit_dashboard?.ai_params?.temperature||1;w.value=J,S.textContent=J}if(T&&v){let J=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;T.value=J,v.textContent=J}if(A&&C){let J=window.aipkit_dashboard?.ai_params?.top_p||1;A.value=J,C.textContent=J}if(b&&L){let J=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;b.value=J,L.textContent=J}if(B&&$){let J=window.aipkit_dashboard?.ai_params?.presence_penalty||0;B.value=J,$.textContent=J}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(t)),typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(E.value,t),m(),r(t,!0)}s?(W.disabled=!1,h.value=s,y.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${o("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:s,_ajax_nonce:l.nonce_manage_forms}).then(J=>{if(J.form){g.value=J.form.title||"",N(),_.value=J.form.prompt_template||"",E.value=J.form.ai_provider||"OpenAI",w&&S&&(w.value=J.form.temperature,S.textContent=J.form.temperature),T&&v&&(T.value=J.form.max_tokens,v.textContent=J.form.max_tokens),A&&C&&(A.value=J.form.top_p,C.textContent=J.form.top_p),b&&L&&(b.value=J.form.frequency_penalty,L.textContent=J.form.frequency_penalty),B&&$&&(B.value=J.form.presence_penalty,$.textContent=J.form.presence_penalty);let we=J.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(Jt=>{let Gt=t.querySelector(`input[name="labels[${Jt}]"]`);Gt&&(Gt.value=we[Jt]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(E.value,J.form.ai_model);let Ke=t.querySelector("#aipkit_ai_form_reasoning_effort");Ke&&(Ke.value=J.form.reasoning_effort||""),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(t);let Ue=t.querySelector('input[name="enable_vector_store"]'),it=Ue?Ue.closest('[data-aipkit-settings-panel="context"]'):null;if(it){let Jt=it.querySelector('select[name="vector_store_provider"]'),Gt=it.querySelector('select[name="openai_vector_store_ids[]"]'),Di=it.querySelector('select[name="pinecone_index_name"]'),bt=it.querySelector('select[name="qdrant_collection_name"]'),di=it.querySelector(".aipkit_vector_embedding_select"),Ht=it.querySelector('select[name="vector_embedding_provider"]'),Wi=it.querySelector('select[name="vector_embedding_model"]'),Sn=it.querySelector('input[name="vector_store_top_k"]'),Ki=it.querySelector("#aipkit_ai_form_vector_store_top_k_value"),ln=it.querySelector('input[name="vector_store_confidence_threshold"]'),Vn=it.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");if(Ue.checked=J.form.enable_vector_store==="1",Jt&&(Jt.value=J.form.vector_store_provider||"openai"),Di&&(Di.value=J.form.pinecone_index_name||""),Di&&J.form.pinecone_index_name&&!Array.from(Di.options).some(_e=>_e.value===J.form.pinecone_index_name)){let _e=new Option(`${J.form.pinecone_index_name} (Manual)`,J.form.pinecone_index_name,!1,!0);Di.appendChild(_e),Di.value=J.form.pinecone_index_name}if(bt){let _e=Array.isArray(J.form.qdrant_collection_names)?J.form.qdrant_collection_names[0]:J.form.qdrant_collection_name||"";if(_e&&!Array.from(bt.options).some(be=>be.value===_e)){let be=new Option(`${_e} (Manual)`,_e,!1,!0);bt.appendChild(be)}_e&&(bt.value=_e)}if(Ht&&(Ht.value=J.form.vector_embedding_provider||"openai"),Sn&&Ki){let _e=J.form.vector_store_top_k||3;Sn.value=_e,Ki.textContent=_e}if(ln&&Vn){let _e=J.form.vector_store_confidence_threshold||20;ln.value=_e,Vn.textContent=_e+"%"}if(Gt&&J.form.openai_vector_store_ids&&Array.isArray(J.form.openai_vector_store_ids)){let _e=new Set(Array.from(Gt.options).map(be=>be.value));J.form.openai_vector_store_ids.forEach((be,Te)=>{if(be&&!_e.has(be)){let At=new Option(`Manual store ${Te+1}`,be,!1,!0);Gt.appendChild(At),_e.add(be)}}),Array.from(Gt.options).forEach(be=>{be.selected=J.form.openai_vector_store_ids.includes(be.value)})}typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(it),Wi&&(Wi.value=J.form.vector_embedding_model||""),typeof window.aipkitForms_syncEmbeddingSelectFromInputs=="function"&&window.aipkitForms_syncEmbeddingSelectFromInputs(it,di),Ue.dispatchEvent(new Event("change",{bubbles:!0}))}let _t=t.querySelector('input[name="openai_web_search_enabled"]'),mt=t.querySelector('input[name="claude_web_search_enabled"]'),Ot=t.querySelector('input[name="openrouter_web_search_enabled"]'),Nt=t.querySelector('input[name="google_search_grounding_enabled"]');_t&&(_t.checked=J.form.openai_web_search_enabled==="1"),mt&&(mt.checked=J.form.claude_web_search_enabled==="1"),Ot&&(Ot.checked=J.form.openrouter_web_search_enabled==="1"),Nt&&(Nt.checked=J.form.google_search_grounding_enabled==="1");let qe=t.querySelector('select[name="openai_web_search_context_size"]'),qt=t.querySelector('select[name="openai_web_search_loc_type"]'),Wt=t.querySelector('input[name="openai_web_search_loc_country"]'),ui=t.querySelector('input[name="openai_web_search_loc_city"]'),ae=t.querySelector('input[name="openai_web_search_loc_region"]'),Ce=t.querySelector('input[name="openai_web_search_loc_timezone"]');qe&&(qe.value=J.form.openai_web_search_context_size||"medium"),qt&&(qt.value=J.form.openai_web_search_loc_type||"none"),Wt&&(Wt.value=J.form.openai_web_search_loc_country||""),ui&&(ui.value=J.form.openai_web_search_loc_city||""),ae&&(ae.value=J.form.openai_web_search_loc_region||""),Ce&&(Ce.value=J.form.openai_web_search_loc_timezone||"");let Ae=t.querySelector('input[name="claude_web_search_max_uses"]'),Oe=t.querySelector('select[name="claude_web_search_loc_type"]'),Fe=t.querySelector('input[name="claude_web_search_loc_country"]'),We=t.querySelector('input[name="claude_web_search_loc_city"]'),je=t.querySelector('input[name="claude_web_search_loc_region"]'),Qe=t.querySelector('input[name="claude_web_search_loc_timezone"]'),xt=t.querySelector('input[name="claude_web_search_allowed_domains"]'),bi=t.querySelector('input[name="claude_web_search_blocked_domains"]'),gt=t.querySelector('select[name="claude_web_search_cache_ttl"]');Ae&&(Ae.value=J.form.claude_web_search_max_uses||"5"),Oe&&(Oe.value=J.form.claude_web_search_loc_type||"none"),Fe&&(Fe.value=J.form.claude_web_search_loc_country||""),We&&(We.value=J.form.claude_web_search_loc_city||""),je&&(je.value=J.form.claude_web_search_loc_region||""),Qe&&(Qe.value=J.form.claude_web_search_loc_timezone||""),xt&&(xt.value=J.form.claude_web_search_allowed_domains||""),bi&&(bi.value=J.form.claude_web_search_blocked_domains||""),gt&&(gt.value=J.form.claude_web_search_cache_ttl||"none");let It=t.querySelector('select[name="openrouter_web_search_engine"]'),ze=t.querySelector('input[name="openrouter_web_search_max_results"]'),Ye=t.querySelector('input[name="openrouter_web_search_search_prompt"]');It&&(It.value=J.form.openrouter_web_search_engine||"auto"),ze&&(ze.value=J.form.openrouter_web_search_max_results||"5"),Ye&&(Ye.value=J.form.openrouter_web_search_search_prompt||"");let Ze=t.querySelector('select[name="google_grounding_mode"]'),ei=t.querySelector('input[name="google_grounding_dynamic_threshold"]'),ci=t.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(Ze&&(Ze.value=J.form.google_grounding_mode||"DEFAULT_MODE"),ei){let Jt=J.form.google_grounding_dynamic_threshold||.3;ei.value=Jt,ci&&(ci.textContent=Jt)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(E.value,t),_t&&_t.dispatchEvent(new Event("change",{bubbles:!0})),mt&&mt.dispatchEvent(new Event("change",{bubbles:!0})),Ot&&Ot.dispatchEvent(new Event("change",{bubbles:!0})),Nt&&Nt.dispatchEvent(new Event("change",{bubbles:!0})),J.form.structure&&Array.isArray(J.form.structure))if(c.formStructure=J.form.structure,y.innerHTML="",c.formStructure.length===0)y.appendChild(U());else{c.formStructure.forEach(Gt=>{window.aipkitForms_renderLayoutRow(y,Gt,null,n)});let Jt=0;c.formStructure.forEach(Gt=>{Gt.columns.forEach(Di=>{Di.elements.forEach(bt=>{let di=bt.internalId.split("-"),Ht=parseInt(di[di.length-1],10)||0;Ht>Jt&&(Jt=Ht)})})}),c.droppedElementCounter=Jt}else y.innerHTML="",y.appendChild(U());m(),r(t,!0),k(n)}else throw new Error(J.message||o("Could not load form data.","gpt3-ai-content-generator"))}).catch(J=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(n,"error",J.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(n):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):(W.disabled=!0,N())})}window.aipkitForms_showFormEditor=i,window.aipkitForms_updatePromptSnippets=k,window.aipkitForms_initPromptSnippets=a})();(function(){"use strict";function k(a){let r=window.aipkitAIFormsState,i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:u=>u;if(!a){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}r.currentFormId=null,r.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(a):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let s=a.querySelector("#aipkit_form_editor_container"),n=a.querySelector("#aipkit_ai_forms_list_container"),c=a.querySelector("#aipkit_ai_forms_editor_actions"),l=a.querySelector("#aipkit_create_new_ai_form_btn"),o=a.querySelector("#aipkit_ai_forms_settings_trigger"),e=a.querySelector("#aipkit_ai_forms_header_title_default"),t=a.querySelector("#aipkit_ai_forms_header_title_editor");if(s&&(s.style.display="none"),n&&(n.style.display="block"),c&&(c.style.display="none"),l&&(l.style.display=""),o&&(o.style.display=""),e&&(e.style.display=""),t&&(t.style.display="none"),typeof window.aipkitForms_closePreviewSheet=="function"&&window.aipkitForms_closePreviewSheet(a),s){let u=s.querySelector("#aipkit_ai_form_ai_provider");u&&delete u.dataset.aipkitProviderNoticeArmed}let p=document.getElementById("aipkit_provider_notice_ai_forms");if(p&&p.classList.add("aipkit_provider_notice--hidden"),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(a),s){let u=s.querySelector("#aipkit_ai_form_preview_container");u&&(u.style.display="none",u.innerHTML="");let f=a.querySelector("#aipkit_preview_ai_form_btn");if(f&&f.classList.contains("aipkit-preview-active")){f.classList.remove("aipkit-preview-active");let m=f.querySelector(".aipkit_btn-text");m&&(m.textContent=i("Preview","gpt3-ai-content-generator"))}}let d=a.querySelector("#aipkit_ai_forms_messages");d&&(d.innerHTML="")}window.aipkitForms_hideFormEditor=k})();(function(){"use strict";function k(a,r){let i=window.aipkitAIFormsState,s=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:gt=>gt,c={value:null},l=()=>r.querySelector("#aipkit_ai_forms_status"),o=(gt,It)=>{let ze=l();if(!ze)return;let Ye=ze.classList.contains("aipkit_training_status");if(ze.textContent=gt||"",Ye){ze.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),gt&&ze.classList.add("is-visible"),It&&ze.classList.add(`is-${It}`);return}ze.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),It==="success"?ze.classList.add("aipkit_form-help-success"):It==="error"&&ze.classList.add("aipkit_form-help-error")},e=(gt=2500)=>{c.value&&window.clearTimeout(c.value),c.value=window.setTimeout(()=>{o("","")},gt)};if(!r){console.error("AI Forms saveForm: formsContainerElement not provided.");return}let t=r.querySelector("#aipkit_form_editor_container");if(!t){console.error("AI Forms saveForm: editorContainer not found in provided formsContainerElement.");return}let p=r.querySelector("#aipkit_ai_form_title"),d=t.querySelector("#aipkit_ai_form_prompt_template"),u=t.querySelector("#aipkit_ai_form_id"),f=t.querySelector("#aipkit_ai_form_ai_provider"),m=t.querySelector("#aipkit_ai_form_ai_model"),g=t.querySelector("#aipkit_ai_form_temperature"),_=t.querySelector("#aipkit_ai_form_max_tokens"),h=t.querySelector("#aipkit_ai_form_top_p"),y=t.querySelector("#aipkit_ai_form_frequency_penalty"),E=t.querySelector("#aipkit_ai_form_presence_penalty"),x=t.querySelector("#aipkit_ai_form_reasoning_effort"),w=t.querySelector('input[name="enable_vector_store"]'),S=t.querySelector('select[name="vector_store_provider"]'),T=t.querySelector('select[name="openai_vector_store_ids[]"]'),v=t.querySelector('select[name="pinecone_index_name"]'),A=t.querySelector('select[name="qdrant_collection_name"]'),C=t.querySelector('select[name="vector_embedding_provider"]'),b=t.querySelector('select[name="vector_embedding_model"]'),L=t.querySelector('input[name="vector_store_top_k"]'),B=t.querySelector('input[name="vector_store_confidence_threshold"]'),$=t.querySelector('input[name="openai_web_search_enabled"]'),W=t.querySelector('input[name="claude_web_search_enabled"]'),U=t.querySelector('input[name="openrouter_web_search_enabled"]'),D=t.querySelector('input[name="google_search_grounding_enabled"]'),H=t.querySelector('select[name="openai_web_search_context_size"]'),Q=t.querySelector('select[name="openai_web_search_loc_type"]'),F=t.querySelector('input[name="openai_web_search_loc_country"]'),P=t.querySelector('input[name="openai_web_search_loc_city"]'),R=t.querySelector('input[name="openai_web_search_loc_region"]'),O=t.querySelector('input[name="openai_web_search_loc_timezone"]'),N=t.querySelector('input[name="claude_web_search_max_uses"]'),ie=t.querySelector('select[name="claude_web_search_loc_type"]'),J=t.querySelector('input[name="claude_web_search_loc_country"]'),we=t.querySelector('input[name="claude_web_search_loc_city"]'),$e=t.querySelector('input[name="claude_web_search_loc_region"]'),Ke=t.querySelector('input[name="claude_web_search_loc_timezone"]'),Ue=t.querySelector('input[name="claude_web_search_allowed_domains"]'),it=t.querySelector('input[name="claude_web_search_blocked_domains"]'),_t=t.querySelector('select[name="claude_web_search_cache_ttl"]'),mt=t.querySelector('select[name="openrouter_web_search_engine"]'),Ot=t.querySelector('input[name="openrouter_web_search_max_results"]'),Nt=t.querySelector('input[name="openrouter_web_search_search_prompt"]'),qe=t.querySelector('select[name="google_grounding_mode"]'),qt=t.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!p||!d||!u||!f||!m||!g||!_||!h||!y||!E){console.error("AI Forms saveForm: One or more critical form editor inputs not found in editorContainer.");return}let Wt=p.value.trim(),ui=d.value.trim(),ae=u.value;if(Wt||(Wt=n("New Form","gpt3-ai-content-generator"),p.value=Wt,p.dispatchEvent(new Event("input",{bubbles:!0}))),!ui){alert(n(s.text.promptTemplateRequired||"Prompt template is required.","gpt3-ai-content-generator"));return}let Ce=new Set,Ae=!0;e:for(let gt of i.formStructure)for(let It of gt.columns)for(let ze of It.elements){if(!ze.fieldId||!/^[a-zA-Z0-9_]+$/.test(ze.fieldId)){alert(n(`Invalid Field Variable Name: "${ze.fieldId||""}" for element "${ze.label}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(ze.internalId,r);let Ye=t.querySelector(`#setting-field-id-${ze.internalId}`);Ye&&Ye.focus(),Ae=!1;break e}if(Ce.has(ze.fieldId)){alert(n(`Duplicate Field Variable Name: "${ze.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(ze.internalId,r);let Ye=t.querySelector(`#setting-field-id-${ze.internalId}`);Ye&&Ye.focus(),Ae=!1;break e}Ce.add(ze.fieldId)}if(!Ae)return;let Oe=T?Array.from(T.selectedOptions).map(gt=>gt.value):[],Fe=t.querySelectorAll('input[name^="labels["]'),We={};Fe.forEach(gt=>{let It=gt.name.match(/\[(.*?)\]/);if(It&&It[1]){let ze=It[1];We[ze]=gt.value}});let je=JSON.stringify(We),Qe={_ajax_nonce:s.nonce_manage_forms,form_id:ae||null,title:Wt,prompt_template:ui,form_structure:JSON.stringify(i.formStructure),ai_provider:f.value,ai_model:m.value,temperature:g.value,max_tokens:_.value,top_p:h.value,frequency_penalty:y.value,presence_penalty:E.value,reasoning_effort:x?.value,enable_vector_store:w?.checked?"1":"0",vector_store_provider:S?.value,openai_vector_store_ids:Oe,pinecone_index_name:v?.value||"",qdrant_collection_name:A?.value||"",vector_embedding_provider:C?.value,vector_embedding_model:b?.value||"",vector_store_top_k:L?.value||3,vector_store_confidence_threshold:B?.value||20,openai_web_search_enabled:$?.checked?"1":"0",claude_web_search_enabled:W?.checked?"1":"0",openrouter_web_search_enabled:U?.checked?"1":"0",google_search_grounding_enabled:D?.checked?"1":"0",openai_web_search_context_size:H?.value||"medium",openai_web_search_loc_type:Q?.value||"none",openai_web_search_loc_country:F?.value||"",openai_web_search_loc_city:P?.value||"",openai_web_search_loc_region:R?.value||"",openai_web_search_loc_timezone:O?.value||"",claude_web_search_max_uses:N?.value||"5",claude_web_search_loc_type:ie?.value||"none",claude_web_search_loc_country:J?.value||"",claude_web_search_loc_city:we?.value||"",claude_web_search_loc_region:$e?.value||"",claude_web_search_loc_timezone:Ke?.value||"",claude_web_search_allowed_domains:Ue?.value||"",claude_web_search_blocked_domains:it?.value||"",claude_web_search_cache_ttl:_t?.value||"none",openrouter_web_search_engine:mt?.value||"auto",openrouter_web_search_max_results:Ot?.value||"5",openrouter_web_search_search_prompt:Nt?.value||"",google_grounding_mode:qe?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:qt?.value||"0.30",labels:je},xt=a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent:a.textContent,bi=a.querySelector(".aipkit_spinner");a.disabled=!0,bi&&(bi.style.display="inline-block"),a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent=n(s.text.savingForm||"Saving...","gpt3-ai-content-generator"):a.firstChild.textContent=n(s.text.savingForm||"Saving...","gpt3-ai-content-generator")+" ",o(n("Saving...","gpt3-ai-content-generator"),"loading"),window.aipkit_apiRequest("aipkit_save_ai_form",Qe).then(gt=>{if(!ae&&gt.form_id){u&&(u.value=gt.form_id),i.currentFormId=gt.form_id;let It=r.querySelector("#aipkit_preview_ai_form_btn");It&&(It.disabled=!1)}o(gt.message||n(s.text.formSaved||"Form saved!","gpt3-ai-content-generator"),"success"),e(),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(gt=>{o(gt.message||n(s.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator"),"error"),e(4e3)}).finally(()=>{a.disabled=!1,bi&&(bi.style.display="none"),a.querySelector(".aipkit_btn-text")?a.querySelector(".aipkit_btn-text").textContent=xt:a.firstChild.textContent=xt})}window.aipkitForms_saveForm=k})();(function(){"use strict";function k(a,r,i){let s=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!i){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let c={_ajax_nonce:s.nonce_manage_forms,form_id:a},l=r.textContent;r.disabled=!0,r.textContent=n(s.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",c).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",o.message||n(s.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",o.message||n(s.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let e=i.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${a}"]`);e&&(e.disabled=!1,e.textContent=l)})}window.aipkitForms_deleteForm=k})();(function(){"use strict";function k(a,r){let i=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!r){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let n={_ajax_nonce:i.nonce_manage_forms},c=a.querySelector(".aipkit_btn-text")?.textContent||s("Delete All Forms","gpt3-ai-content-generator"),l=a.querySelector(".aipkit_spinner");a.disabled=!0,a.querySelector(".aipkit_btn-text")&&(a.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${s(i.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",n).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"success",o.message||s(i.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"error",o.message||s(i.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{a.querySelector(".aipkit_btn-text")&&(a.querySelector(".aipkit_btn-text").textContent=c),l&&(l.style.display="none"),a.disabled=!1})}window.aipkitForms_deleteAllForms=k})();(function(){"use strict";function k(a,r,i){let s=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:o=>o;if(!i){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let c={_ajax_nonce:s.nonce_manage_forms,form_id:a},l=r.textContent;r.disabled=!0,r.textContent=n(s.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",c).then(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",o.message||n("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(o=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",o.message||n(s.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let o=i.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${a}"]`);o&&(o.disabled=!1,o.textContent=l)})}window.aipkitForms_duplicateForm=k})();(function(){"use strict";async function k(a){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n,s=a.textContent;a.disabled=!0,a.textContent=i("Exporting...","gpt3-ai-content-generator");try{let n=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:r.nonce_manage_forms});if(n.forms&&Array.isArray(n.forms)&&n.forms.length>0){let c=n.forms.map(u=>(delete u.id,delete u.status,u)),o=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,e=JSON.stringify(c,null,2),t=new Blob([e],{type:"application/json"}),p=URL.createObjectURL(t),d=document.createElement("a");d.href=p,d.download=o,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(p)}else throw new Error(i("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(n){alert(i("Error exporting forms: ","gpt3-ai-content-generator")+n.message)}finally{a.disabled=!1,a.textContent=s}}window.aipkitForms_exportAllForms=k})();(function(){"use strict";async function k(a,r){let i=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c,n=r.textContent;r.disabled=!0,r.textContent=s("Exporting...","gpt3-ai-content-generator");try{let c=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:a,_ajax_nonce:i.nonce_manage_forms});if(c.form){let l=c.form,o=l.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),e=`aipkit-form-${a}-${o}.json`;delete l.id,delete l.status;let t=JSON.stringify(l,null,2),p=new Blob([t],{type:"application/json"}),d=URL.createObjectURL(p),u=document.createElement("a");u.href=d,u.download=e,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d)}else throw new Error(s("Form data not found in response.","gpt3-ai-content-generator"))}catch(c){alert(s("Error exporting form: ","gpt3-ai-content-generator")+c.message)}finally{r.disabled=!1,r.textContent=n}}window.aipkitForms_exportForm=k})();(function(){"use strict";let k=document.getElementById("aipkit_ai_forms_import_messages"),a;function r(n,c){if(!k)return;let l=window.aipkit_escapeHtml||(o=>o);k.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${n}">${l(c)}</div>`,a&&clearTimeout(a),a=setTimeout(()=>{k.innerHTML=""},8e3)}function i(){k&&(k.innerHTML=""),a&&clearTimeout(a)}async function s(n){let c=window.aipkit_ai_forms_config||{text:{}},l=window.wp?.i18n?.__||(p=>p),o=n.files;if(!o.length)return;let e=o[0];i(),r("info",l("Reading file...","gpt3-ai-content-generator"));let t=new FileReader;t.onload=async function(p){try{let d=p.target.result,u=JSON.parse(d);if(typeof u=="object"&&u!==null&&!Array.isArray(u)&&(u=[u]),!Array.isArray(u))throw new Error(l("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(u.length===0){r("warning",l("File contains no forms to import.","gpt3-ai-content-generator"));return}r("info",l("Importing...","gpt3-ai-content-generator"));let f=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:c.nonce_manage_forms,forms_json:JSON.stringify(u)});r(f.failed_count>0?"warning":"success",f.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(d){r("error",l("Error processing import file: ","gpt3-ai-content-generator")+d.message)}},t.onerror=function(){r("error",l("Error reading the selected file.","gpt3-ai-content-generator"))},t.readAsText(e)}window.aipkitForms_importForms=s})();(function(){"use strict";let k="aipkit_ai_forms_status",a=!1,r=null,i=null,s=null;function n(){return document.getElementById(k)}function c(h,y){let E=n();if(!E)return;let x=E.classList.contains("aipkit_training_status");if(E.textContent=h||"",x){E.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),h&&E.classList.add("is-visible"),y&&E.classList.add(`is-${y}`);return}E.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),y==="success"?E.classList.add("aipkit_form-help-success"):y==="error"&&E.classList.add("aipkit_form-help-error")}function l(h=2500){s&&window.clearTimeout(s),s=window.setTimeout(()=>{c("","")},h)}function o(){return document.getElementById("aipkit_ai_forms_settings_form")}function e(){let h=o();if(!h)return console.error("AI Forms Save Settings: Settings form not found."),null;let y=new FormData(h),E={};return y.forEach((x,w)=>{E[w]=x}),E}function t(h){if(!h)return"";let y={};return Object.keys(h).sort().forEach(E=>{y[E]=h[E]}),JSON.stringify(y)}function p(h){i=t(h)}function d(h){return t(h)!==i}async function u(h,y){let E=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:S=>S;if(typeof window.aipkit_apiRequest!="function"){console.error("AI Forms Save Settings: aipkit_apiRequest not found.");return}c(E("Saving...","gpt3-ai-content-generator"),"loading");let x="",w=null;y&&(x=y.querySelector(".aipkit_btn-text")?.textContent||E("Save AI Forms Settings","gpt3-ai-content-generator"),w=y.querySelector(".aipkit_spinner"),y.disabled=!0,w&&(w.style.display="inline-block"),y.querySelector(".aipkit_btn-text")&&(y.querySelector(".aipkit_btn-text").textContent=E("Saving...","gpt3-ai-content-generator")));try{let S=await window.aipkit_apiRequest("aipkit_save_ai_forms_settings",h);return c(S.message||E("Settings saved!","gpt3-ai-content-generator"),"success"),l(),p(h),S}catch(S){throw c(S.message||E("Failed to save settings.","gpt3-ai-content-generator"),"error"),l(4e3),console.error("AI Forms Save Settings Error:",S),S}finally{y&&(y.disabled=!1,w&&(w.style.display="none"),y.querySelector(".aipkit_btn-text")&&(y.querySelector(".aipkit_btn-text").textContent=x))}}function f(h,y){if(h){if(a){r=h;return}a=!0,u(h,y).catch(()=>{}).finally(()=>{if(a=!1,r){let E=r;r=null,d(E)&&f(E,null)}})}}function m(h){let y=e();f(y,h)}function g(){let h=e();!h||!d(h)||f(h,null)}function _(){let h=e();h&&p(h)}window.aipkitForms_saveAiFormsSettings=m,window.aipkitForms_handleSettingsAutosave=g,window.aipkitForms_updateSettingsAutosaveBaseline=_})();(function(){"use strict";function k(a,r,i){let s=window.aipkit_escapeHtml||function(c){return c};if(!a){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let n=a.querySelector("#aipkit_ai_forms_messages");n?(n.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${r}">${s(i)}</div>`,setTimeout(()=>{n.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=k})();(function(){"use strict";function k(r){if(!r){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let i=r.querySelector(".aipkit_token_limit_mode_select"),s=r.querySelector(".aipkit_token_general_user_limit_field"),n=r.querySelector(".aipkit_token_role_limits_container");if(!i||!s||!n){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let c=i.value;s.hidden=c!=="general",n.hidden=c!=="role_based"}function a(r){if(!r){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let i="data-token-listener-attached";r.getAttribute(i)!=="true"&&(r.addEventListener("change",function(s){s.target.closest(".aipkit_token_limit_mode_select")&&k(r)}),k(r),r.setAttribute(i,"true"))}window.aipkit_initAIFormsTokenManagementUI=a})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_ai_forms_container");return a||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=k})();(function(){"use strict";function k(a){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;a.dataset.clickListenerAttached!=="true"&&(a.addEventListener("click",function(s){let n=s.target,c=o=>n.closest(o),l=a.querySelector("#aipkit_form_editor_container");if(n.matches("#aipkit_create_new_ai_form_btn")||c("#aipkit_create_new_ai_form_btn"))s.preventDefault(),typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,a);else if(c(".aipkit_actions_menu_toggle")){s.preventDefault(),s.stopPropagation();let o=n.closest(".aipkit_actions_menu");if(!o)return;let e=o.querySelector(".aipkit_actions_dropdown_menu");if(!e)return;let t=e.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(p=>{p!==e&&(p.style.display="none")}),e.style.display=t?"none":"block",!t){let p=d=>{o.contains(d.target)||(e.style.display="none")};document.addEventListener("click",p,{once:!0,capture:!0})}}else if(c("#aipkit_import_ai_forms_btn")){s.preventDefault();let o=a.querySelector("#aipkit_ai_forms_import_file_input");o&&o.click()}else if(n.matches(".aipkit_edit_ai_form_btn")||c(".aipkit_edit_ai_form_btn")){s.preventDefault();let e=c(".aipkit_edit_ai_form_btn").dataset.formId;typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(e,a)}else if(c(".aipkit_preview_ai_form_btn")){s.preventDefault();let o=c(".aipkit_preview_ai_form_btn"),e=o.dataset.formId,t=o.dataset.formTitle||"";typeof window.aipkitForms_openPreviewSheet=="function"&&window.aipkitForms_openPreviewSheet(e,t,a)}else if(n.matches(".aipkit_duplicate_ai_form_btn")||c(".aipkit_duplicate_ai_form_btn")){s.preventDefault();let o=c(".aipkit_duplicate_ai_form_btn"),e=o.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(e,o,a)}else if(n.matches("#aipkit_export_all_ai_forms_btn")||c("#aipkit_export_all_ai_forms_btn")){s.preventDefault();let o=c("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(o)}else if(n.matches(".aipkit_export_ai_form_btn")||c(".aipkit_export_ai_form_btn")){s.preventDefault();let o=c(".aipkit_export_ai_form_btn"),e=o.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(e,o)}else if(n.matches(".aipkit_delete_ai_form_btn")||c(".aipkit_delete_ai_form_btn")){s.preventDefault();let o=c(".aipkit_delete_ai_form_btn"),e=o.dataset.formId,t=o.dataset.formTitle||`Form ID ${e}`,d=`${i(r.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${t}`,u=()=>{typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(e,o,a)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(d,{title:i("Confirm","gpt3-ai-content-generator"),confirmText:i("Delete","gpt3-ai-content-generator"),cancelText:i("Cancel","gpt3-ai-content-generator"),onConfirm:u});return}confirm(d)&&u()}else if(n.matches("#aipkit_delete_all_ai_forms_btn")||c("#aipkit_delete_all_ai_forms_btn")){s.preventDefault();let o=c("#aipkit_delete_all_ai_forms_btn"),e=i(r.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"),t=()=>{typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(o,a)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(e,{title:i("Confirm","gpt3-ai-content-generator"),confirmText:i("Delete","gpt3-ai-content-generator"),cancelText:i("Cancel","gpt3-ai-content-generator"),onConfirm:t});return}confirm(e)&&t()}else if(n.matches(".aipkit_form_shortcode_input"))s.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(n.value,n);else if(c(".aipkit_aiform_settings_toggle")){s.preventDefault();let o=c(".aipkit_aiform_settings_toggle"),e=o.dataset.formId,t=a.querySelector(`#aif-configurator-${e}`);if(!t)return;let p=t.closest("tr"),d=()=>{let m=o.getBoundingClientRect(),g=t.getBoundingClientRect(),_=g.width||400,h=g.height||0,y=window.innerWidth,E=window.innerHeight,x=12,w=m.left;w+_>y-x&&(w=m.right-_),w=Math.max(x,Math.min(w,y-_-x));let S=m.bottom+8;S+h>E-x&&(S=m.top-h-8),S=Math.max(x,Math.min(S,E-h-x)),t.style.left=`${Math.round(w)}px`,t.style.top=`${Math.round(S)}px`};a.querySelectorAll(".aipkit_shortcode_configurator").forEach(m=>{m!==t&&(m.style.display="none");let g=m.closest("tr");g&&g.classList.remove("aipkit_shortcode_row_open")});let f=t.style.display==="flex";if(t.style.display=f?"none":"flex",p&&p.classList.toggle("aipkit_shortcode_row_open",!f),!f){d();let m=g=>{!t.contains(g.target)&&!o.contains(g.target)&&(t.style.display="none",p&&p.classList.remove("aipkit_shortcode_row_open"),document.removeEventListener("click",m,!0))};setTimeout(()=>{document.addEventListener("click",m,{capture:!0,once:!0})},0)}}else if(c(".aipkit_aiform_shortcode_close")){s.preventDefault();let e=c(".aipkit_aiform_shortcode_close").closest(".aipkit_shortcode_configurator");if(e){e.style.display="none";let t=e.closest("tr");t&&t.classList.remove("aipkit_shortcode_row_open")}}else if(n.matches("#aipkit_validate_prompt_btn")||c("#aipkit_validate_prompt_btn"))s.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(n.matches("#aipkit_save_ai_form_btn")||c("#aipkit_save_ai_form_btn")){s.preventDefault();let o=c("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(o,a)}else if(n.matches("#aipkit_cancel_edit_ai_form_btn")||c("#aipkit_cancel_edit_ai_form_btn"))s.preventDefault(),typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(a);else if(n.matches("#aipkit_preview_ai_form_btn")||c("#aipkit_preview_ai_form_btn")){s.preventDefault();let o=l.querySelector("#aipkit_ai_form_id").value;if(!o){alert(i("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}let e=a.querySelector("#aipkit_ai_form_title"),t=e?e.value:"";typeof window.aipkitForms_openPreviewSheet=="function"?window.aipkitForms_openPreviewSheet(o,t,a):console.error("AI Forms Preview: Preview sheet helper not available.")}else if(c(".aipkit_dropped_element_settings_btn")){s.preventDefault();let o=c(".aipkit_dropped_element");o&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(o.id,a)}else if(c(".aipkit_dropped_element_delete_btn")){s.preventDefault();let o=c(".aipkit_dropped_element");o&&confirm(i(r.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(o.id,a)}else if(c(".aipkit_layout_row_delete_btn")){if(s.preventDefault(),confirm(i("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let o=c(".aipkit_layout_row");o&&(Array.from(o.querySelectorAll(".aipkit_dropped_element")).map(t=>t.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(a),o.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(a))}}else if(c("#aipkit_settings_panel_close_btn"))s.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(a);else if(c(".aipkit_remove_option_btn")){s.preventDefault();let o=c(".aipkit_select_option_row");o&&(o.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,a))}else c("#aipkit_add_select_option_btn")&&(s.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(a))}),a.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=k})();(function(){"use strict";let k="aipkit_ai_forms_shortcode_config_v1_";function a(c){if(!c||!window.localStorage)return null;try{let l=window.localStorage.getItem(`${k}${c}`);if(!l)return null;let o=JSON.parse(l);return o&&typeof o=="object"?o:null}catch{return null}}function r(c,l){if(!(!c||!window.localStorage))try{window.localStorage.setItem(`${k}${c}`,JSON.stringify(l))}catch{}}function i(c,l){if(!c)return;let o=l.querySelector(`#aif-configurator-${c}`),e=l.querySelector(`#aif-shortcode-input-${c}`);if(!o||!e)return;let t=o.querySelectorAll(".aipkit-aiform-config-input"),p=[],d={};t.forEach(m=>{let g=m.dataset.attrName;g&&(m.type==="checkbox"?(d[g]=!!m.checked,m.checked&&p.push(`${g}="true"`)):m.type==="select-one"&&(d[g]=m.value,m.value&&m.value!=="light"&&p.push(`${g}="${m.value}"`)))});let u=`[aipkit_ai_form id=${c}`;p.length>0&&(u+=" "+p.join(" ")),u+="]",e.value=u,l.querySelectorAll(`[data-aipkit-shortcode-display="${c}"]`).forEach(m=>{m&&"value"in m&&(m.value=u)}),r(c,d)}function s(c,l){if(!c||!l)return;let o=a(c);if(!o)return;let e=l.querySelector(`#aif-configurator-${c}`);if(!e)return;e.querySelectorAll(".aipkit-aiform-config-input").forEach(p=>{let d=p.dataset.attrName;d&&(p.type==="checkbox"?Object.prototype.hasOwnProperty.call(o,d)&&(p.checked=!!o[d]):p.type==="select-one"&&typeof o[d]=="string"&&(p.value=o[d]))}),i(c,l)}function n(c){c.dataset.changeListenerAttached!=="true"&&(c.addEventListener("change",function(l){let o=l.target;if(o.matches(".aipkit-aiform-config-input")){let e=o.dataset.formId;i(e,c)}else o.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(o),o.value="")}),c.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=n,window.aipkitForms_applyStoredShortcodeConfig=s})();(function(){"use strict";function k(a){let r=window.aipkitAIFormsState,i=a.querySelector("#aipkit_ai_form_element_settings_panel");if(!i){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(i.dataset.inputListenerAttached==="true")return;let s=()=>{r.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(r.selectedDesignerElementId,a)};i.addEventListener("input",n=>{n.target.matches(".aipkit-setting-field")&&s()}),i.addEventListener("change",n=>{n.target.matches('.aipkit-setting-field[type="checkbox"]')&&s()}),i.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=k})();(function(){"use strict";function k(a){let r=window.aipkitAIFormsState;if(!a){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=a.querySelector("#aipkit_ai_form_elements_palette"),s=a.querySelector("#aipkit_ai_form_designer_area");if(!i||!s){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&s.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(c=>{c.dataset.dragStartListenerAttached!=="true"&&(c.addEventListener("dragstart",l=>{l.target.classList.add("aipkit-dragging"),r.draggedElement=null,l.target.dataset.layoutType?(r.draggedLayoutType=l.target.dataset.layoutType,r.draggedElementType=null,l.dataTransfer.setData("text/plain",r.draggedLayoutType),l.dataTransfer.effectAllowed="copy"):(r.draggedElementType=l.target.dataset.elementType,r.draggedLayoutType=null,l.dataTransfer.setData("text/plain",r.draggedElementType),l.dataTransfer.effectAllowed="copy")}),c.addEventListener("dragend",l=>{l.target.classList.remove("aipkit-dragging"),r.draggedElementType=null,r.draggedLayoutType=null}),c.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",s.dataset.dragListenersAttached!=="true"&&(s.addEventListener("dragstart",c=>{let l=c.target.closest(".aipkit_layout_row"),o=c.target.closest(".aipkit_dropped_element");if(l&&c.target.classList.contains("aipkit_layout_row_drag_handle"))r.draggedElement=l,c.dataTransfer.setData("text/row-id",l.id),c.dataTransfer.effectAllowed="move";else if(o&&c.target.classList.contains("aipkit_dropped_element_drag_handle"))r.draggedElement=o,c.dataTransfer.setData("text/element-id",o.id),c.dataTransfer.effectAllowed="move";else return;r.draggedElementType=null,r.draggedLayoutType=null,setTimeout(()=>{r.draggedElement&&r.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),s.addEventListener("dragend",c=>{r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null)}),s.addEventListener("dragover",c=>{c.preventDefault(),s.classList.add("aipkit-drag-over"),r.draggedElement?c.dataTransfer.dropEffect="move":c.dataTransfer.dropEffect="copy"}),s.addEventListener("dragleave",c=>{s.contains(c.relatedTarget)||s.classList.remove("aipkit-drag-over")}),s.addEventListener("drop",c=>{c.preventDefault(),c.stopPropagation(),s.classList.remove("aipkit-drag-over");let l=s.querySelector("#aipkit_form_designer_placeholder");if(r.draggedLayoutType){l&&(l.style.display="none");let o=window.aipkitForms_createNewLayoutData(r.draggedLayoutType);r.formStructure.push(o),window.aipkitForms_renderLayoutRow(s,o,null,a),r.draggedLayoutType=null}else if(r.draggedElement&&r.draggedElement.classList.contains("aipkit_layout_row")){let o=c.target.closest(".aipkit_layout_row");if(o&&o!==r.draggedElement){let e=o.getBoundingClientRect(),p=c.clientY>e.top+e.height/2?o.nextSibling:o;s.insertBefore(r.draggedElement,p)}window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){l&&(l.style.display="none");let o=window.aipkitForms_createNewLayoutData("1-col"),e=window.aipkitForms_createNewFormElementData(r.draggedElementType);o.columns[0].elements.push(e),r.formStructure.push(o),window.aipkitForms_renderLayoutRow(s,o,null,a),r.draggedElementType=null}r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(a)}),s.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=k})();(function(){"use strict";function k(a){let r=a.querySelector("#aipkit_ai_forms_settings_form");r&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(r):console.error("AI Forms Init: Could not initialize token management UI for settings popover.")}window.aipkitForms_initializeTokenUI=k})();(function(){"use strict";function k(a){let r=(a||document).querySelector("#aipkit_ai_forms_settings_form");if(!r)return;let i="data-aipkit-aiforms-autosave-attached";if(r.getAttribute(i)==="true")return;let s=()=>{typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};r.addEventListener("change",n=>{let c=n.target;if(!c||!c.matches(".aipkit_autosave_trigger"))return;(c.tagName.toLowerCase()==="select"||c.type==="checkbox"||c.type==="range")&&s()}),r.addEventListener("blur",n=>{let c=n.target;if(!c||!c.matches(".aipkit_autosave_trigger"))return;let l=c.tagName.toLowerCase();(l==="input"||l==="textarea")&&c.type!=="range"&&c.type!=="checkbox"&&s()},!0),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),r.setAttribute(i,"true")}window.aipkitForms_initSettingsAutosave=k})();(function(){"use strict";function k(a){if(!a)return;let r="data-accordion-listener-attached";a.getAttribute(r)!=="true"&&(a.addEventListener("click",function(i){let s=i.target.closest(".aipkit_accordion-header");if(!s||!s.closest(".aipkit_ai_forms_container"))return;i.preventDefault();let n=s.closest(".aipkit_accordion-group"),c=s.dataset.aipkitContextAccordion==="1";if(n&&!s.classList.contains("aipkit_active")){let o=n.querySelector(".aipkit_accordion-header.aipkit_active");if(o){o.classList.remove("aipkit_active");let e=o.nextElementSibling;e&&e.classList.remove("aipkit_active")}}let l=s.nextElementSibling;l&&(s.classList.toggle("aipkit_active"),l.classList.toggle("aipkit_active"),c&&l.classList.contains("aipkit_active")&&typeof window.aipkitForms_refreshOpenaiStores=="function"&&window.aipkitForms_refreshOpenaiStores(l))}),a.setAttribute(r,"true"))}window.aipkitForms_initializeAccordions=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(d){return d},a={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0};function r(d){if(!d)return a;let u=Array.isArray(window.aipkit_dashboard?.models?.openrouter)?window.aipkit_dashboard.models.openrouter:[],f=String(d).trim().toLowerCase(),m=u.find(g=>(g?.id?String(g.id).trim().toLowerCase():"")===f);return!m||typeof m.capabilities!="object"?a:{...a,...m.capabilities}}function i(d,u,f){return d!=="OpenRouter"||!f?!0:!!r(u)[f]}function s(d,u,f,m){if(!d||!u)return;d.classList.toggle("aipkit_popover_option_row--disabled",f),d.setAttribute("aria-disabled",f?"true":"false"),u.disabled=!!f;let g=d.querySelector(".aipkit_popover_option_label");g&&(g.dataset.defaultTooltip||(g.dataset.defaultTooltip=g.getAttribute("data-tooltip")||""),g.setAttribute("data-tooltip",f&&m||g.dataset.defaultTooltip))}function n(d,u=""){let f=document.getElementById("aipkit_ai_form_ai_model"),m=window.aipkit_dashboard?.models||{};if(!f||!m)return;let g=d.toLowerCase(),_=m[g];(typeof _>"u"||_===null)&&(_=g==="openai"?{}:[]),f.innerHTML="",f.disabled=!1;let h=window.aipkit_dashboard?.recommendedModels?.[g]||[],y=Array.isArray(h)?h:[],E=new Set(y.map(w=>w?.id).filter(Boolean));if(!_||Array.isArray(_)&&_.length===0||!Array.isArray(_)&&Object.keys(_).length===0){let w=new Option("No models found. Sync in main settings.","");f.appendChild(w),f.disabled=!0;return}let x=!1;if(Array.isArray(_)){if(y.length>0){let S=document.createElement("optgroup");S.label=k("Recommended","gpt3-ai-content-generator"),y.forEach(T=>{if(T&&T.id){let v=new Option(T.name||T.id,T.id);T.id===u&&(v.selected=!0,x=!0),S.appendChild(v)}}),S.children.length>0&&f.appendChild(S)}let w=y.length>0?document.createElement("optgroup"):null;w&&(w.label=k("All models","gpt3-ai-content-generator")),_.forEach(S=>{if(S&&S.id&&E.has(S.id))return;let T=new Option(S.name,S.id);S.id===u&&(T.selected=!0,x=!0),w?w.appendChild(T):f.appendChild(T)}),w&&w.children.length>0&&f.appendChild(w)}else{if(y.length>0){let w=document.createElement("optgroup");w.label=k("Recommended","gpt3-ai-content-generator"),y.forEach(S=>{if(S&&S.id){let T=new Option(S.name||S.id,S.id);S.id===u&&(T.selected=!0,x=!0),w.appendChild(T)}}),w.children.length>0&&f.appendChild(w)}Object.keys(_).forEach(w=>{let S=document.createElement("optgroup");S.label=w,_[w].forEach(T=>{if(T&&T.id&&E.has(T.id))return;let v=new Option(T.name,T.id);T.id===u&&(v.selected=!0,x=!0),S.appendChild(v)}),S.children.length>0&&f.appendChild(S)})}if(!x&&u){let w=new Option(`${u} (Manual/Not Synced)`,u,!1,!0);f.insertBefore(w,f.firstChild),w.selected=!0}f.selectedIndex===-1&&f.options.length>0&&(f.options[0].selected=!0),f.options.length||(f.disabled=!0)}function c(d,u){let f=u||document,m=f.querySelector("#aipkit_ai_form_ai_model"),g=m&&m.value||"",_=i(d,g,"web_search_plugin"),h=f.querySelector('input[name="openai_web_search_enabled"]'),y=f.querySelector('input[name="claude_web_search_enabled"]'),E=f.querySelector('input[name="openrouter_web_search_enabled"]'),x=f.querySelector('input[name="google_search_grounding_enabled"]'),w=f.querySelector(".aipkit_ai_form_web_search_row--openai"),S=f.querySelector(".aipkit_ai_form_web_search_row--claude"),T=f.querySelector(".aipkit_ai_form_web_search_row--openrouter"),v=f.querySelector(".aipkit_ai_form_web_search_row--google"),A=f.querySelector(".aipkit_ai_form_openai_web_search_settings"),C=f.querySelector(".aipkit_ai_form_claude_web_search_settings"),b=f.querySelector(".aipkit_ai_form_openrouter_web_search_settings"),L=f.querySelector(".aipkit_ai_form_google_search_grounding_settings"),B=f.querySelector(".aipkit_ai_form_openai_web_search_location_details"),$=f.querySelector(".aipkit_ai_form_claude_web_search_location_details"),W=f.querySelector(".aipkit_ai_form_web_search_empty_state"),U=d==="OpenAI";w&&(w.style.display=U?"block":"none"),!U&&h&&(h.checked=!1);let D=U&&h&&h.checked;A&&(A.style.display=D?"block":"none"),!D&&B?B.style.display="none":D&&typeof window.aipkitForms_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkitForms_toggleOpenAIWebSearchLocationDetails(f);let H=d==="Claude";S&&(S.style.display=H?"block":"none"),!H&&y&&(y.checked=!1);let Q=H&&y&&y.checked;C&&(C.style.display=Q?"block":"none"),!Q&&$?$.style.display="none":Q&&typeof window.aipkitForms_toggleClaudeWebSearchLocationDetails=="function"&&window.aipkitForms_toggleClaudeWebSearchLocationDetails(f);let F=d==="OpenRouter";T&&(T.style.display=F?"block":"none"),!F&&E&&(E.checked=!1);let P=F&&!_;E&&P&&(E.checked=!1),s(T,E,P,k("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"));let R=F&&_&&E&&E.checked;b&&(b.style.display=R?"block":"none");let O=d==="Google";v&&(v.style.display=O?"block":"none"),!O&&x&&(x.checked=!1);let N=O&&x&&x.checked;L&&(L.style.display=N?"block":"none"),N&&typeof window.aipkitForms_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkitForms_toggleGoogleGroundingDynamicThreshold(f),W&&(W.style.display=!U&&!H&&!F&&!O?"block":"none")}function l(d){let u=d.querySelector("#aipkit_ai_form_ai_provider"),f=d.querySelector("#aipkit_ai_form_ai_model"),m=d.querySelector(".aipkit_ai_form_reasoning_effort_field"),g=d.querySelector("#aipkit_ai_form_reasoning_effort");if(!u||!f||!m||!g){m&&(m.style.display="none");return}let _=u.value,y=(f.value||"").toLowerCase(),E=y.startsWith("o1")||y.startsWith("o3")||y.startsWith("o4"),x=y.includes("gpt-5");if(!(_==="OpenAI"&&(E||x))){m.style.display="none";return}m.style.display="block";let w=o(y),S=new Set(w.allowed),T=g.value||"";T==="minimal"&&(T="low"),Array.from(g.options).forEach(v=>{let A=S.has(v.value);v.hidden=!A,v.disabled=!A}),S.has(T)||(T=w.defaultValue),S.has(T)||(T=w.allowed[0]||""),T&&(g.value=T)}function o(d){return t(d)?{allowed:["high"],defaultValue:"high"}:d.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:e(d)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function e(d){let u=d.match(/gpt-5\.(\d+)/);if(u)return Number.parseInt(u[1],10)>=2;let f=d.match(/gpt-(\d+)/);return f?Number.parseInt(f[1],10)>=6:!1}function t(d){return/gpt-5(\.\d+)?-pro/.test(d)}function p(d){let u=d.querySelector("#aipkit_ai_form_ai_provider"),f=d.querySelector("#aipkit_ai_form_ai_model");!u||!f||(u.dataset.modelListenerAttached!=="true"&&(u.addEventListener("change",function(){n(this.value),c(this.value,d),l(d)}),u.dataset.modelListenerAttached="true"),f.dataset.reasoningListenerAttached!=="true"&&(f.addEventListener("change",function(){l(d),c(u.value,d)}),f.dataset.reasoningListenerAttached="true"),n(u.value),c(u.value,d),l(d))}window.aipkitForms_initAiConfig=p,window.aipkitForms_populateAiModels=n,window.aipkitForms_updateWebSearchVisibility=c,window.aipkitForms_toggleReasoningEffort=l})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(D){return D},a={loaded:!1,loading:!1},r={saving:!1,queued:null,last:{pinecone_api_key:"",qdrant_url:"",qdrant_api_key:""}},i=()=>{let D=window.wp&&window.wp.i18n?window.wp.i18n:null;return{__:D&&typeof D.__=="function"?D.__:Q=>Q}},s=()=>{let D=window.aipkit_ai_forms_config||{},H=D.vectorStores?D.vectorStores.openai:[];return Array.isArray(H)?H:[]},n=D=>{window.aipkit_ai_forms_config||(window.aipkit_ai_forms_config={}),window.aipkit_ai_forms_config.vectorStores||(window.aipkit_ai_forms_config.vectorStores={}),window.aipkit_ai_forms_config.vectorStores.openai=D},c=D=>D?D.querySelector('select[name="openai_vector_store_ids[]"]'):null,l=D=>D?Array.from(D.options).some(H=>H.value&&!H.disabled):!1,o=(D,H)=>{let Q=D.id||D.vector_store_id||"",P=D.name||D.vector_store_name||""||`Untitled store ${H}`,R=D.file_counts?D.file_counts.total:null,O=" (Files: N/A)";return typeof R=="number"&&(O=` (${R} ${R===1?"File":"Files"})`),{id:Q,label:`${P}${O}`}},e=(D,H,Q={})=>{if(!D)return;let{__:F}=i(),R=Q.preserveSelection===!0?new Set(Array.from(D.selectedOptions||[]).map(ie=>ie.value)):new Set;D.innerHTML="";let O=Array.isArray(H)?H:[],N=1;if(O.forEach(ie=>{if(!ie||typeof ie!="object")return;let{id:J,label:we}=o(ie,N);if(!J)return;let $e=new Option(k(we),J);R.has(J)&&($e.selected=!0),D.appendChild($e),N+=1}),!D.options.length){let ie=new Option(F("No stores found.","gpt3-ai-content-generator"),"");ie.disabled=!0,D.appendChild(ie)}},t=D=>{D&&typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(D)},p=async(D,H={})=>{let Q=c(D);if(!Q)return;let{__:F}=i(),P=H.force===!0,R=s();if(R.length&&(!P||!a.loaded)){e(Q,R,{preserveSelection:!0}),t(D),a.loaded=!0;return}if(!P&&a.loaded&&l(Q)||a.loading)return;let O=document.getElementById("aipkit_vector_store_nonce_openai"),N=O?O.value:"";if(!N||typeof window.aipkit_apiRequest!="function")return;a.loading=!0,Q.innerHTML="";let ie=new Option(F("Loading vector stores...","gpt3-ai-content-generator"),"");ie.disabled=!0,Q.appendChild(ie);try{let J=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:N,limit:100,order:"desc"}),we=Array.isArray(J.stores)?J.stores:[];n(we),e(Q,we,{preserveSelection:!0}),t(D),a.loaded=!0}catch(J){let we=J&&J.message?J.message:F("Unable to load stores.","gpt3-ai-content-generator");Q.innerHTML="";let $e=new Option(we,"");$e.disabled=!0,Q.appendChild($e)}finally{a.loading=!1}},d=D=>{D&&p(D,{force:!0})},u=D=>{if(!D)return null;let H=D.closest(".aipkit_model_settings_popover");return H?H.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline"):null},f=(D,H,Q)=>{let F=u(D);F&&(F.textContent=H||"",F.classList.remove("success","error","loading"),Q&&F.classList.add(Q),F.style.display=H?"inline-block":"none")},m=(D,H=2500)=>{window.setTimeout(()=>{f(D,"","")},H)},g=D=>D?{pineconeKeyInput:D.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:D.querySelector('[name="qdrant_url"]'),qdrantKeyInput:D.querySelector('[name="qdrant_api_key"]')}:{},_=D=>{let H=D?.closest("#aipkit_ai_forms_container"),Q=H?H.dataset:{},{pineconeKeyInput:F,qdrantUrlInput:P,qdrantKeyInput:R}=g(D),O=F?.value.trim(),N=P?.value.trim(),ie=R?.value.trim(),J=!!(O||Q?.pineconeApiKeySet==="true"),we=!!(N||Q?.qdrantUrlSet==="true")&&!!(ie||Q?.qdrantApiKeySet==="true");return{pinecone:J,qdrant:we}},h=(D,H)=>D?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(D,{silent:!0,showErrors:!1,targetSelectId:H,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,D,{silent:!0,showErrors:!1,targetSelectId:H,propagateError:!0}):null:null,y=(D,H,Q)=>{if(!H)return;f(D,"Syncing...","loading");let F=h(H,Q);if(F&&typeof F.then=="function"){F.then(()=>{f(D,"Synced","success"),m(D)}).catch(P=>{f(D,`Error: ${P?.message||"Sync failed."}`,"error")});return}m(D)},E=(D,H)=>{if(!D||!H)return;if(H==="openai"){p(D);return}let Q=_(D);H==="pinecone"&&Q.pinecone?y(D,"PineconeIndexes","aipkit_ai_form_pinecone_index_name"):H==="qdrant"&&Q.qdrant&&y(D,"QdrantCollections","aipkit_ai_form_qdrant_collection_name")},x=(D,H)=>{!H||!Object.keys(H).length||typeof window.aipkit_apiRequest=="function"&&(r.saving=!0,f(D,"Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",H).then(Q=>{Object.keys(H).forEach(P=>{r.last[P]=H[P]});let F=D.closest("#aipkit_ai_forms_container");F&&(Object.prototype.hasOwnProperty.call(H,"pinecone_api_key")&&(F.dataset.pineconeApiKeySet=H.pinecone_api_key?"true":"false"),Object.prototype.hasOwnProperty.call(H,"qdrant_url")&&(F.dataset.qdrantUrlSet=H.qdrant_url?"true":"false"),Object.prototype.hasOwnProperty.call(H,"qdrant_api_key")&&(F.dataset.qdrantApiKeySet=H.qdrant_api_key?"true":"false")),Object.prototype.hasOwnProperty.call(H,"pinecone_api_key")&&E(D,"pinecone"),(Object.prototype.hasOwnProperty.call(H,"qdrant_url")||Object.prototype.hasOwnProperty.call(H,"qdrant_api_key"))&&E(D,"qdrant"),f(D,Q.message||"Saved","success"),m(D)}).catch(Q=>{f(D,`Error: ${Q?.message||"Failed to save."}`,"error")}).finally(()=>{if(r.saving=!1,r.queued){let Q=r.queued;r.queued=null,x(D,Q)}}))},w=(D,H)=>{if(!H)return;let Q=Object.keys(H).reduce((F,P)=>(H[P]!==r.last[P]&&(F[P]=H[P]),F),{});if(Object.keys(Q).length){if(r.saving){r.queued={...r.queued||{},...Q};return}x(D,Q)}},S=D=>{if(!D)return;let H=D.querySelector(".aipkit_vector_store_enable_select"),Q=D.querySelector(".aipkit_vector_store_settings_conditional_row"),F=D.querySelector(".aipkit_vector_store_provider_select"),P=D.querySelector(".aipkit_vector_store_openai_field"),R=D.querySelector(".aipkit_vector_store_pinecone_field"),O=D.querySelector(".aipkit_vector_store_pinecone_key_field"),N=D.querySelector(".aipkit_vector_store_qdrant_field"),ie=D.querySelector(".aipkit_vector_store_qdrant_url_field"),J=D.querySelector(".aipkit_vector_store_qdrant_key_field"),we=D.querySelector(".aipkit_vector_store_embedding_config_row");if(!H||!Q||!F)return;let $e=H.tagName==="SELECT"?H.value==="1":H.checked;if(Q.style.display=$e?"block":"none",!$e){[P,R,O,N,ie,J,we].forEach(Ue=>{Ue&&(Ue.style.display="none")});return}let Ke=F.value||"openai";P&&(P.style.display=Ke==="openai"?"block":"none"),R&&(R.style.display=Ke==="pinecone"?"block":"none"),O&&(O.style.display=Ke==="pinecone"?"block":"none"),N&&(N.style.display=Ke==="qdrant"?"block":"none"),ie&&(ie.style.display=Ke==="qdrant"?"block":"none"),J&&(J.style.display=Ke==="qdrant"?"block":"none"),we&&(we.style.display=Ke==="pinecone"||Ke==="qdrant"?"block":"none"),Ke==="openai"&&(p(D),t(D))},T=D=>{let H=(D||"").split("::"),Q=H.shift()||"",F=H.join("::")||"";return{provider:Q,model:F}},v=(D,H)=>!D||!H?"":`${D}::${H}`,A=(D,H,Q)=>{if(!D||!H||!Q)return;let F=v(H,Q);if(!F)return;let P=typeof CSS<"u"&&CSS.escape?CSS.escape(F):F.replace(/"/g,'\\"');if(D.querySelector(`option[value="${P}"]`))return;let R=document.createElement("option");R.value=F,R.dataset.provider=H,R.textContent=`${Q} (Manual)`,D.appendChild(R)},C=(D,H)=>{if(!D)return;let Q=H||D.querySelector(".aipkit_vector_embedding_select");if(!Q)return;let F=D.querySelector('select[name="vector_embedding_provider"]'),P=D.querySelector('select[name="vector_embedding_model"]'),R=F?F.value:"",O=P?P.value:"",N=v(R,O);if(N){A(Q,R,O),Q.value=N;return}Q.value=""},b=(D,H)=>{if(!H||!D)return;let Q=H.querySelector('select[name="vector_embedding_provider"]'),F=H.querySelector('select[name="vector_embedding_model"]'),{provider:P,model:R}=T(D.value);Q&&(Q.value=P),Q&&F&&typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(H),F&&(F.value=R)};function L(D){let H=D.querySelector(".aipkit_vector_embedding_provider_select"),Q=D.querySelector(".aipkit_vector_embedding_model_select"),P=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!H||!Q||!P)return;let O=H.value.toLowerCase(),N=P[O]||[];Q.innerHTML="",Q.appendChild(new Option(`-- Select ${H.options[H.selectedIndex]?.text||""} Model --`,"")),N&&Array.isArray(N)&&N.length>0?(N.forEach(ie=>{Q.appendChild(new Option(k(ie.name),ie.id))}),Q.disabled=!1):(Q.appendChild(new Option("(No models found - Sync in Settings)","")),Q.disabled=!0)}function B(D){let H=D||document,Q=H.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),F=H.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!Q||!F)return;let P=Q.value==="approximate";F.style.display=P?"block":"none"}function $(D){let H=D||document,Q=H.querySelector(".aipkit_ai_form_claude_web_search_loc_type_select"),F=H.querySelector(".aipkit_ai_form_claude_web_search_location_details");if(!Q||!F)return;let P=Q.value==="approximate";F.style.display=P?"block":"none"}function W(D){let H=D||document,Q=H.querySelector(".aipkit_ai_form_google_grounding_mode_select"),F=H.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!Q||!F)return;let P=Q.value==="MODE_DYNAMIC";F.style.display=P?"block":"none"}function U(D){let H=D.querySelector("#aipkit_form_editor_container");if(!H)return;let Q=H.querySelector("#aipkit_ai_form_settings_popover");if(!Q)return;let F=Q.querySelector('[data-aipkit-settings-panel="context"]'),P=Q.querySelector('[data-aipkit-settings-panel="tools"]');if(!F)return;let R=H.querySelector("#aipkit_ai_form_ai_provider"),O=g(F);r.last={pinecone_api_key:O.pineconeKeyInput?.value||"",qdrant_url:O.qdrantUrlInput?.value||"",qdrant_api_key:O.qdrantKeyInput?.value||""};let N="data-vector-config-listener-attached";if(F.getAttribute(N)!=="true"&&(F.addEventListener("change",ie=>{let J=ie.target;if(J){if(J.matches('[name="pinecone_api_key"]')||J.matches('[name="qdrant_url"]')||J.matches('[name="qdrant_api_key"]')){w(F,{[J.name]:J.value||""});return}if(J.matches(".aipkit_vector_store_enable_select")||J.matches(".aipkit_vector_store_provider_select")){S(F);let we=F.querySelector(".aipkit_vector_store_provider_select"),$e=we?we.value:"";E(F,$e);return}if(J.matches(".aipkit_vector_embedding_select")){b(J,F);return}if(J.matches(".aipkit_vector_embedding_provider_select")||J.matches(".aipkit_vector_embedding_model_select")){typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(F),C(F);return}J.matches('select[name="openai_vector_store_ids[]"]')&&t(F)}}),F.addEventListener("input",ie=>{let J=ie.target;if(J){if(J.matches("#aipkit_ai_form_vector_store_top_k")){let we=F.querySelector("#aipkit_ai_form_vector_store_top_k_value");we&&(we.textContent=J.value)}else if(J.matches("#aipkit_ai_form_vector_store_confidence_threshold")){let we=F.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");we&&(we.textContent=J.value+"%")}}}),F.setAttribute(N,"true")),P){let ie="data-tools-config-listener-attached";P.getAttribute(ie)!=="true"&&(P.addEventListener("change",J=>{let we=J.target;if(we.matches(".aipkit_ai_form_openai_web_search_toggle")||we.matches(".aipkit_ai_form_claude_web_search_toggle")||we.matches(".aipkit_ai_form_openrouter_web_search_toggle")||we.matches(".aipkit_ai_form_google_search_grounding_toggle")){if(typeof window.aipkitForms_updateWebSearchVisibility=="function"){let $e=R?R.value:"";window.aipkitForms_updateWebSearchVisibility($e,H)}}else we.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?B(P):we.matches(".aipkit_ai_form_claude_web_search_loc_type_select")?$(P):we.matches(".aipkit_ai_form_google_grounding_mode_select")&&W(P)}),P.addEventListener("input",J=>{let we=J.target;if(we.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let $e=P.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");$e&&($e.textContent=parseFloat(we.value).toFixed(2))}}),P.setAttribute(ie,"true"))}typeof window.aipkitForms_updateWebSearchVisibility=="function"&&R&&window.aipkitForms_updateWebSearchVisibility(R.value,H),S(F),L(F),C(F),t(F)}window.aipkitForms_initVectorConfig=U,window.aipkitForms_populateVectorEmbeddingModels=L,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=B,window.aipkitForms_toggleClaudeWebSearchLocationDetails=$,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=W,window.aipkitForms_refreshOpenaiStores=d,window.aipkitForms_syncEmbeddingSelectFromInputs=C})();(function(){"use strict";function k(r,i,s,n){let c=window.aipkitAIFormsState,l=document.createElement("div");l.className="aipkit_layout_row",l.id=i.internalId;let o=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,e=document.createElement("div");e.className="aipkit_layout_row_columns_container",i.columns.forEach(t=>{let p=document.createElement("div");p.className="aipkit_layout_column",p.id=t.internalId,p.style.flexBasis=t.width,a(p,n),t.elements.forEach(d=>{window.aipkitForms_renderFieldInColumn(p,d)}),e.appendChild(p)}),l.innerHTML=o,l.appendChild(e),s?r.insertBefore(l,s):r.appendChild(l)}function a(r,i){let s=window.aipkitAIFormsState;r.addEventListener("dragover",n=>{n.preventDefault(),n.stopPropagation(),r.classList.add("aipkit-drag-over"),(s.draggedElement||s.draggedElementType)&&(n.dataTransfer.dropEffect=s.draggedElement?"move":"copy")}),r.addEventListener("dragleave",n=>{n.preventDefault(),n.stopPropagation(),r.classList.remove("aipkit-drag-over")}),r.addEventListener("drop",n=>{if(n.preventDefault(),r.classList.remove("aipkit-drag-over"),s.draggedElementType||s.draggedElement&&s.draggedElement.classList.contains("aipkit_dropped_element")){n.stopPropagation();let c=r.id;if(s.draggedElementType){let l=window.aipkitForms_createNewFormElementData(s.draggedElementType);s.formStructure.forEach(o=>{let e=o.columns.find(t=>t.internalId===c);e&&e.elements.push(l)}),window.aipkitForms_renderFieldInColumn(r,l,null,i)}else s.draggedElement&&(r.appendChild(s.draggedElement),window.aipkitForms_updateFormStructureOrder());s.draggedElementType=null,s.draggedElement&&(s.draggedElement.classList.remove("aipkit-row-dragging-source"),s.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector("#aipkit_ai_form_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let s=r.querySelector(".aipkit_model_settings_popover_title"),n=r.querySelector(".aipkit_model_settings_popover_back"),c=a.querySelector("#aipkit_ai_form_settings_trigger"),l={root:r.dataset.titleRoot||"Settings",parameters:r.dataset.titleParameters||"Parameters",context:r.dataset.titleContext||"Context",tools:r.dataset.titleTools||"Tools"},o=null,e=t=>{let p=t||"root",d=r.querySelector(`[data-aipkit-settings-panel="${p}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!d)return;let u=d.dataset.aipkitSettingsPanel||"root";u!==o&&(i.forEach(f=>{f.hidden=f!==d}),s&&(s.textContent=l[u]||l.root),n&&(n.hidden=u==="root"),o=u,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",t=>{let p=t.target.closest("[data-aipkit-panel-target]");if(!p)return;t.preventDefault();let d=p.dataset.aipkitPanelTarget;e(d)}),n&&n.addEventListener("click",t=>{t.preventDefault(),e("root")}),c&&c.addEventListener("click",()=>{e("root")}),e("root"),r.dataset.panelsBound="true"}window.aipkitForms_initEditorSettingsPopover=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector("#aipkit_form_editor_container");if(!r)return;let i=r.querySelector("#aipkit_ai_form_prompt_template"),s=r.querySelector(".aipkit_ai_form_prompt_expand"),n=document.getElementById("aipkit_ai_form_prompt_modal");if(!i||!s||!n)return;let c=n.querySelector(".aipkit_ai_form_prompt_modal_textarea"),l=n.querySelector(".aipkit_ai_form_prompt_count"),o=n.querySelector(".aipkit_ai_form_prompt_modal_close");if(n.dataset.bound==="1")return;let e=u=>{l&&(l.textContent=`${u.length.toLocaleString()} characters`)},t=u=>{c&&(c.value=u,e(u))},p=()=>{c&&(t(i.value||""),n.classList.add("aipkit-active"),n.setAttribute("aria-hidden","false"),setTimeout(()=>c.focus(),0))},d=u=>{if(n.classList.remove("aipkit-active"),n.setAttribute("aria-hidden","true"),!u||!c)return;let f=c.value;f!==i.value&&(i.value=f,i.dispatchEvent(new Event("input",{bubbles:!0})))};s.addEventListener("click",u=>{u.preventDefault(),p()}),o&&o.addEventListener("click",()=>{d(!0)}),document.addEventListener("keydown",u=>{u.key==="Escape"&&n.classList.contains("aipkit-active")&&d(!0)}),c&&c.dataset.bound!=="1"&&(c.addEventListener("input",()=>{e(c.value)}),c.dataset.bound="1"),n.dataset.bound="1"}window.aipkitForms_initPromptModal=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.querySelector("#aipkit_ai_forms_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let s=r.querySelector(".aipkit_model_settings_popover_title"),n=r.querySelector(".aipkit_model_settings_popover_back"),c=r.querySelector(".aipkit_model_settings_popover_footer"),l=a.querySelector("#aipkit_ai_forms_settings_trigger"),o={root:r.dataset.titleRoot||"Settings",limits:r.dataset.titleLimits||"Limits","custom-css":r.dataset.titleCustomCss||"Custom CSS","provider-filtering":r.dataset.titleProviderFiltering||"Provider Filtering"},e=null,t=p=>{let d=p||"root",u=r.querySelector(`[data-aipkit-settings-panel="${d}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!u)return;let f=u.dataset.aipkitSettingsPanel||"root";f!==e&&(i.forEach(m=>{m.hidden=m!==u}),s&&(s.textContent=o[f]||o.root),n&&(n.hidden=f==="root"),c&&(c.hidden=f==="root"),f==="limits"&&typeof window.aipkitForms_initializeTokenUI=="function"&&window.aipkitForms_initializeTokenUI(a),e=f,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",p=>{let d=p.target.closest("[data-aipkit-panel-target]");if(!d)return;p.preventDefault();let u=d.dataset.aipkitPanelTarget;t(u)}),n&&n.addEventListener("click",p=>{p.preventDefault(),t("root")}),l&&l.addEventListener("click",()=>{t("root")}),t("root"),r.dataset.panelsBound="true"}window.aipkitForms_initSettingsPopoverPanels=k})();(function(){"use strict";let k=[{key:"openai",label:"OpenAI"},{key:"google",label:"Google"},{key:"claude",label:"Claude"},{key:"openrouter",label:"OpenRouter"},{key:"azure",label:"Azure",keepWhenEmpty:!0,emptyMessage:"No Azure deployments found. Sync Azure models in main settings first."},{key:"ollama",label:"Ollama",requiresPro:!0},{key:"deepseek",label:"DeepSeek"}],a=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l,r=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(l,o)=>l.replace("%d",o),i=l=>{if(!l)return null;if(typeof l=="string")return{id:l,name:l};if(typeof l=="object"){let o=l.id||l.name||"";return o?{id:o,name:l.name||l.id||o}:null}return null},s=l=>{if(!l)return null;if(Array.isArray(l))return l.map(i).filter(Boolean);if(typeof l=="object"){let o={};return Object.keys(l).forEach(e=>{let p=(Array.isArray(l[e])?l[e]:[]).map(i).filter(Boolean);p.length&&(o[e]=p)}),o}return null},n=l=>l?Array.isArray(l)?l.length>0:Object.keys(l).length>0:!1;function c(l){let o=l||document,e=o.querySelector("#aipkit_ai_forms_models_selector");if(!e||e.dataset.enhanced==="true")return;let t=o.querySelector("#aipkit_aiforms_frontend_models"),p=o.querySelector("#aipkit_aiforms_frontend_providers");if(!t||!p)return;let d=a(),u=r(),m=(e.dataset.initialValue||t.value||"").split(",").map(v=>v.trim()).filter(Boolean),g=new Set(m),_=window.aipkit_dashboard||{},h=_.models||{},y=!!_.isProPlan,E=k.filter(v=>!v.requiresPro||y).map(v=>({...v,models:s(h[v.key])})).filter(v=>v.keepWhenEmpty||n(v.models));e.innerHTML="",e.classList.add("aipkit_models_selector--ready");let x=document.createElement("input");x.type="search",x.placeholder=d("Filter models...","gpt3-ai-content-generator"),x.className="aipkit_models_selector-search",e.appendChild(x);let w=document.createElement("div");w.className="aipkit_models_selector-summary",e.appendChild(w);let S=document.createElement("div");S.className="aipkit_models_selector-providers",e.appendChild(S);let T=v=>{let A=Array.from(e.querySelectorAll('.aipkit_models_selector-item input[type="checkbox"]:checked')),C=A.map(B=>B.value.trim()).filter(Boolean),b=new Set;A.forEach(B=>{B.dataset.providerName&&b.add(B.dataset.providerName)});let L=C.length?E.map(B=>B.label).filter(B=>b.has(B)).join(", "):"";t.value=C.join(", "),p.value=L,C.length===0?w.textContent=d("Showing all models (none selected)","gpt3-ai-content-generator"):C.length===1?w.textContent=d("1 model selected","gpt3-ai-content-generator"):w.textContent=u(d("%d models selected","gpt3-ai-content-generator"),C.length),v&&typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};E.forEach(v=>{let A=document.createElement("div");A.className="aipkit_models_selector-provider",A.dataset.provider=v.key;let C=document.createElement("div");C.className="aipkit_models_selector-provider-header",C.innerHTML=`<strong>${v.label}</strong>`;let b=document.createElement("div");b.className="aipkit_models_selector-provider-actions";let L=document.createElement("button");L.type="button",L.className="aipkit_btn aipkit_btn-xs",L.textContent=d("All","gpt3-ai-content-generator");let B=document.createElement("button");B.type="button",B.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",B.textContent=d("None","gpt3-ai-content-generator"),b.appendChild(L),b.appendChild(B),C.appendChild(b),A.appendChild(C);let $=document.createElement("div");$.className="aipkit_models_selector-models";let W=U=>{if(!U||!U.id)return;let D=document.createElement("label");D.className="aipkit_models_selector-item",D.title=U.id;let H=document.createElement("input");H.type="checkbox",H.value=U.id,H.checked=g.has(U.id),H.dataset.providerName=v.label,H.addEventListener("change",()=>T(!0));let Q=document.createElement("span");Q.textContent=U.name||U.id,D.appendChild(H),D.appendChild(Q),$.appendChild(D)};if(Array.isArray(v.models)?v.models.forEach(U=>W(U)):v.models&&typeof v.models=="object"&&Object.keys(v.models).forEach(U=>{let D=v.models[U]||[];if(!D.length)return;let H=document.createElement("div");H.className="aipkit_models_selector-subgroup",H.textContent=U.charAt(0).toUpperCase()+U.slice(1),$.appendChild(H),D.forEach(Q=>W(Q))}),!n(v.models)){let U=document.createElement("div");U.className="aipkit_models_selector-empty",U.textContent=d(v.emptyMessage||"No models found.","gpt3-ai-content-generator"),$.appendChild(U)}L.addEventListener("click",()=>{$.querySelectorAll('input[type="checkbox"]').forEach(U=>{U.checked=!0}),T(!0)}),B.addEventListener("click",()=>{$.querySelectorAll('input[type="checkbox"]').forEach(U=>{U.checked=!1}),T(!0)}),A.appendChild($),S.appendChild(A)}),x.addEventListener("input",()=>{let v=x.value.toLowerCase();S.querySelectorAll(".aipkit_models_selector-provider").forEach(A=>{let C=!1;A.querySelectorAll(".aipkit_models_selector-item").forEach(b=>{let B=b.textContent.toLowerCase().includes(v);b.style.display=B?"":"none",B&&(C=!0)}),A.style.display=C||v===""?"":"none"})}),T(!1),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),e.dataset.enhanced="true"}window.aipkitForms_initAllowedModelsSelector=c})();(function(){"use strict";let k=window.wp?.i18n?.__||function(S){return S},a="#aipkit_ai_forms_container #aipkit_ai_form_ai_provider, #aipkit_ai_forms_container #aipkit_ai_form_ai_model, #aipkit_ai_forms_container #aipkit_ai_form_vector_store_provider",r=null,i=null,s=!1,n=S=>!!(S&&(S.id==="aipkit_ai_form_ai_provider"||S.id==="aipkit_ai_form_vector_store_provider")),c=S=>!!(S&&n(S)),l=(S,T)=>{if(!S)return!1;let v=o(T);return v?["openai","openrouter","google","azure","claude","deepseek","ollama","pinecone","qdrant"].includes(v):!1},o=S=>String(S||"").trim().toLowerCase(),e=(S,T,v)=>{if(!S)return;let A="aipkit_settings_select_picker_icon--";S.classList.forEach(L=>{L.startsWith(A)&&S.classList.remove(L)});let C=o(v),b=l(T,C);S.hidden=!b,b&&S.classList.add(`${A}${C}`)},t=S=>{if(!S)return"";let T=S.getAttribute("data-aipkit-picker-title");if(T)return T;let v=S.id&&document.querySelector(`label[for="${S.id}"]`)||S.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return v?v.textContent.trim():""},p=S=>{if(!S)return"";let T=S.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:S.querySelector("option[selected]");if(T)return T.textContent.trim();let v=S.querySelector("option");return v?v.textContent.trim():""},d=S=>({buttonId:`${S}_picker_btn`,labelId:`${S}_picker_label`,popoverId:`${S}_picker_popover`,titleId:`${S}_picker_title`,searchId:`${S}_picker_search`,listId:`${S}_picker_list`}),u=(S,T)=>{if(!S||!S.id||!T)return null;let v=d(S.id),A=document.getElementById(v.buttonId);if(!A){if(A=document.createElement("button"),A.type="button",A.id=v.buttonId,A.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",A.setAttribute("data-aipkit-popover-target",v.popoverId),A.setAttribute("aria-controls",v.popoverId),A.setAttribute("aria-expanded","false"),A.dataset.aipkitPopoverPlacement="bottom",n(S)){A.classList.add("aipkit_settings_select_picker_btn--provider");let B=document.createElement("span");B.className="aipkit_settings_select_picker_icon",B.setAttribute("aria-hidden","true"),e(B,S,S.value),A.appendChild(B)}let b=document.createElement("span");b.className="aipkit_settings_select_picker_label",b.id=v.labelId,b.textContent=p(S)||k("Select","gpt3-ai-content-generator");let L=document.createElement("span");L.className="dashicons dashicons-arrow-down-alt2",L.setAttribute("aria-hidden","true"),A.appendChild(b),A.appendChild(L),S.insertAdjacentElement("beforebegin",A)}S.classList.contains("screen-reader-text")||S.classList.add("screen-reader-text");let C=document.getElementById(v.popoverId);if(!C){C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",C.id=v.popoverId,C.setAttribute("aria-hidden","true"),n(S)&&C.classList.add("aipkit_settings_select_picker_popover--provider");let b=document.createElement("div");b.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",b.setAttribute("role","dialog"),b.setAttribute("aria-labelledby",v.titleId);let L=document.createElement("div");L.className="aipkit_model_settings_popover_header";let B=document.createElement("span");B.className="aipkit_model_settings_popover_title",B.id=v.titleId,B.textContent=t(S)||k("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',L.appendChild(B),L.appendChild($);let W=document.createElement("div");W.className="aipkit_model_settings_popover_body";let U=document.createElement("div");U.className="aipkit_settings_select_picker_search";let D=document.createElement("input");D.type="search",D.id=v.searchId,D.className="aipkit_form-input";let H=t(S),Q=H?`Search ${H.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");D.setAttribute("placeholder",Q),U.appendChild(D);let F=document.createElement("div");F.className="aipkit_settings_select_picker_list",F.id=v.listId,F.setAttribute("role","listbox"),W.appendChild(U),W.appendChild(F),b.appendChild(L),b.appendChild(W),C.appendChild(b),T.appendChild(C),c(S)&&(U.style.display="none")}return{ids:v,button:A,popover:C,label:document.getElementById(v.labelId),search:document.getElementById(v.searchId),list:document.getElementById(v.listId)}},f=S=>{let T=[];return S&&Array.from(S.children).forEach(A=>{if(A.tagName==="OPTGROUP"){let C=Array.from(A.children).filter(b=>b.tagName==="OPTION").map(b=>({value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}));T.push({label:A.label,options:C})}else A.tagName==="OPTION"&&T.push({label:"",options:[{value:A.value,label:A.textContent.trim(),disabled:A.disabled,selected:A.selected}]})}),T},m=(S,T,v="")=>{if(!S||!T)return;T.innerHTML="";let A=f(S),C=v.trim().toLowerCase(),b=!1;if(A.forEach(L=>{let B=L.options.filter($=>C?$.label.toLowerCase().includes(C):!0);if(B.length){if(L.label){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=L.label,T.appendChild($)}B.forEach($=>{let W=document.createElement("button");if(W.type="button",W.className="aipkit_settings_select_picker_item",$.disabled&&W.classList.add("is-disabled"),$.selected&&W.classList.add("is-active"),W.dataset.value=$.value,n(S)&&l(S,$.value)){let H=document.createElement("span");H.className="aipkit_settings_select_picker_icon",H.setAttribute("aria-hidden","true"),e(H,S,$.value),W.appendChild(H)}let U=document.createElement("span");U.className="aipkit_settings_select_picker_text",U.textContent=$.label||$.value;let D=document.createElement("span");D.className="dashicons dashicons-yes aipkit_settings_select_picker_check",D.setAttribute("aria-hidden","true"),W.appendChild(U),W.appendChild(D),T.appendChild(W),b=!0})}}),!b){let L=document.createElement("div");L.className="aipkit_settings_select_picker_empty",L.textContent=k(C?"No matches found.":"No options available.","gpt3-ai-content-generator"),T.appendChild(L)}},g=(S,T)=>{if(!S||!T)return;let v=p(S);if(T.textContent=v||k("Select","gpt3-ai-content-generator"),n(S)){let A=T.closest("button"),C=A?A.querySelector(".aipkit_settings_select_picker_icon"):null;e(C,S,S.value)}},_=(S,T)=>{if(!S||!T)return;let v=S.getBoundingClientRect(),A=T.getBoundingClientRect(),C=A.width||320,b=A.height||0,L=window.innerWidth,B=window.innerHeight,$=12;if(S.dataset.aipkitPopoverPlacement==="bottom"){let D=v.left;D+C>L-$&&(D=v.right-C),D=Math.max($,Math.min(D,L-C-$));let H=v.bottom+8;H+b>B-$&&(H=v.top-b-8),H=Math.max($,Math.min(H,B-b-$)),T.style.left=`${Math.round(D)}px`,T.style.top=`${Math.round(H)}px`;return}let W=v.right+10;W+C>L-$&&(W=v.left-C-10),W=Math.max($,Math.min(W,L-C-$));let U=v.top;U+b>B-$&&(U=B-b-$),U=Math.max($,U),T.style.left=`${Math.round(W)}px`,T.style.top=`${Math.round(U)}px`},h=()=>{!r||!i||s||(s=!0,window.requestAnimationFrame(()=>{let S=r.querySelector(".aipkit_model_settings_popover_panel");_(i,S),s=!1}))},y=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},E=(S,T,v)=>{if(!S||!T)return;r&&r!==T&&y(),r=T,i=S,T.classList.add("aipkit-active"),T.setAttribute("aria-hidden","false"),S.setAttribute("aria-expanded","true");let A=T.querySelector(".aipkit_settings_select_picker_search input"),C=T.querySelector(".aipkit_settings_select_picker_list");C&&m(v,C,A?A.value:""),A&&A.offsetParent!==null&&(A.focus(),A.select());let b=T.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{_(S,b)})},x=(S,T)=>{if(!S||!T)return;let{button:v,popover:A,list:C,search:b}=T;if(v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("click",L=>{if(L.preventDefault(),r===A){y();return}E(v,A,S)}),v.dataset.pickerListenerAttached="true"),A&&A.dataset.overlayListenerAttached!=="true"){A.addEventListener("click",B=>{B.target===A&&y()});let L=A.querySelector(".aipkit_model_settings_popover_close");L&&L.addEventListener("click",B=>{B.preventDefault(),y()}),A.dataset.overlayListenerAttached="true"}if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",L=>{let B=L.target.closest(".aipkit_settings_select_picker_item");if(!B||B.classList.contains("is-disabled"))return;let $=B.dataset.value??"";S.value=$,S.dispatchEvent(new Event("change",{bubbles:!0})),g(S,T.label),m(S,C,b?b.value:""),y()}),C.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("input",()=>{m(S,C,b.value)}),b.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("change",()=>{g(S,T.label),m(S,C,b?b.value:"")}),S.dataset.pickerListenerAttached="true"),S&&S.dataset.pickerObserverAttached!=="true"){let L=!1;new MutationObserver(()=>{L||(L=!0,window.requestAnimationFrame(()=>{g(S,T.label),m(S,C,b?b.value:""),L=!1}))}).observe(S,{childList:!0,subtree:!0}),S.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitAiFormsPickerEscapeBound||(document.addEventListener("keydown",L=>{L.key==="Escape"&&r&&y()}),document.body.dataset.aipkitAiFormsPickerEscapeBound="true"),document.body.dataset.aipkitAiFormsPickerRepositionBound||(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),document.body.dataset.aipkitAiFormsPickerRepositionBound="true")};function w(S){let T=S||document.getElementById("aipkit_ai_forms_container");if(!T)return;let v=T.querySelectorAll(a);v.length&&v.forEach(A=>{if(!A.id||A.dataset.aipkitPickerInit==="true")return;let C=u(A,T);C&&(g(A,C.label),m(A,C.list,C.search?C.search.value:""),x(A,C),A.dataset.aipkitPickerInit="true")})}window.aipkitForms_initSelectPickers=w,window.aipkitForms_refreshSelectPickers=function(S){let T=S||document.getElementById("aipkit_ai_forms_container");if(!T)return;let v=T.querySelectorAll(a);v.length&&v.forEach(A=>{if(!A.id)return;let C=u(A,T);C&&(g(A,C.label),m(A,C.list,C.search?C.search.value:""),x(A,C),A.dataset.aipkitPickerInit="true")})}})();(function(){"use strict";let k={css:new Set,js:new Set},a=()=>{let p=typeof wp<"u"&&wp.i18n?wp.i18n:null;return{__:p&&typeof p.__=="function"?p.__:d=>d}},r=window.aipkit_escapeHtml||(p=>p),i=p=>{if(!p||k.css.has(p))return;if(document.querySelector(`link[href="${p}"]`)){k.css.add(p);return}let d=document.createElement("link");d.rel="stylesheet",d.href=p,document.head.appendChild(d),k.css.add(p)},s=p=>!p||k.js.has(p)?Promise.resolve():new Promise((d,u)=>{if(document.querySelector(`script[src="${p}"]`)){k.js.add(p),d();return}let f=document.createElement("script");f.src=p,f.async=!0,f.onload=()=>{k.js.add(p),d()},f.onerror=()=>u(new Error(`Failed to load script: ${p}`)),document.body.appendChild(f)}),n=(p,d,u="info")=>{if(!p)return;let f=u==="error"?"aipkit_ai_forms_preview_message aipkit_ai_forms_preview_message--error":"aipkit_ai_forms_preview_message",m=u==="error"?"":'<span class="aipkit_spinner" aria-hidden="true"></span>';p.innerHTML=`
      <div class="${f}">
        ${m}
        <span>${r(d)}</span>
      </div>
    `},c=(p,d,u={})=>{let{__:f}=a(),m=window.aipkit_ai_forms_config||{},g=u.loadingText||f("Loading preview...","gpt3-ai-content-generator");return d?p?typeof window.aipkit_apiRequest!="function"?(n(d,f("Preview loader is unavailable.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("API request helper missing."))):(n(d,g),window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:p,_ajax_nonce:m.nonce_manage_forms}).then(_=>(_.config&&(window.aipkit_ai_forms_public_config=_.config),_.models&&(window.aipkit_ai_forms_models=_.models),_.assets&&_.assets.css&&Object.values(_.assets.css).forEach(i),d.innerHTML=_.html||"",_.assets&&_.assets.js?Promise.all(Object.values(_.assets.js).map(s)):null)).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(_=>{let h=_&&_.message?_.message:"Unknown error.";throw n(d,`${f("Preview failed:","gpt3-ai-content-generator")} ${h}`,"error"),_})):(n(d,f("Missing form ID for preview.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("Form ID missing."))):Promise.reject(new Error("Preview container not found."))},l=p=>{let d=p||document.getElementById("aipkit_ai_forms_container");if(!d)return null;let u=d.querySelector("#aipkit_ai_forms_preview_sheet");return u?{container:d,overlay:u,panel:u.querySelector(".aipkit_builder_sheet_panel"),closeButton:u.querySelector("#aipkit_ai_forms_preview_sheet_close"),title:u.querySelector("#aipkit_ai_forms_preview_sheet_title"),description:u.querySelector("#aipkit_ai_forms_preview_sheet_description"),previewFrame:u.querySelector("#aipkit_ai_forms_preview_frame")}:null},o=(p,d,u)=>{let{__:f}=a(),m=l(u);if(!m)return;let g=d&&String(d).trim()||f("Untitled","gpt3-ai-content-generator");m.title&&(m.title.textContent=f("Preview","gpt3-ai-content-generator")),m.description&&(m.description.textContent="",m.description.removeAttribute("title"),m.description.setAttribute("hidden","true")),m.overlay.classList.add("aipkit-active"),m.overlay.setAttribute("aria-hidden","false"),m.previewFrame&&c(p,m.previewFrame).catch(()=>{}),m.closeButton&&m.closeButton.focus()},e=p=>{let d=l(p);d&&(d.overlay.classList.remove("aipkit-active"),d.overlay.setAttribute("aria-hidden","true"),d.previewFrame&&(d.previewFrame.innerHTML=""))},t=p=>{let d=l(p);!d||d.overlay.dataset.previewSheetInitialized==="true"||(d.closeButton&&d.closeButton.addEventListener("click",u=>{u.preventDefault(),e(d.container)}),d.overlay.addEventListener("click",u=>{u.target===d.overlay&&e(d.container)}),document.addEventListener("keydown",u=>{u.key==="Escape"&&d.overlay.classList.contains("aipkit-active")&&e(d.container)}),d.overlay.dataset.previewSheetInitialized="true")};window.aipkitForms_loadFormPreview=c,window.aipkitForms_openPreviewSheet=o,window.aipkitForms_closePreviewSheet=e,window.aipkitForms_initPreviewSheet=t})();(function(){"use strict";function k(){let a=window.aipkitForms_validateContainer();if(!a)return;let r=()=>{typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(a):console.error("AI Forms Init: aipkit_initContentWriterPopovers function not found.")};if(a.dataset.aipkitInitialized==="true"){r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"&&window.aipkitForms_initSettingsPopoverPanels(a),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(a),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(a),typeof window.aipkitForms_initSettingsAutosave=="function"&&window.aipkitForms_initSettingsAutosave(a),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(a),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(a),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(a),window.aipkitForms_initializeDragAndDrop(a),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(a),window.aipkitForms_initializeTokenUI(a);return}r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"?window.aipkitForms_initSettingsPopoverPanels(a):console.error("AI Forms Init: aipkitForms_initSettingsPopoverPanels function not found."),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(a),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(a),typeof window.aipkitForms_initSettingsAutosave=="function"?window.aipkitForms_initSettingsAutosave(a):console.error("AI Forms Init: aipkitForms_initSettingsAutosave function not found."),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(a),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(a),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(a),window.aipkitForms_attachClickEventListeners(a),window.aipkitForms_attachChangeEventListeners(a),window.aipkitForms_attachSettingsPanelListeners(a),window.aipkitForms_initializeAccordions(a),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(a):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(a),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(a),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(a):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(a):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),a.dataset.aipkitInitialized="true"}window.aipkit_initAiForms=k})();(function(){"use strict";let k="",a={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",status:"task_config_status",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",status:"task_config_status",prompts:"task_config_ai",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",status:"task_config_status",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",status:"task_config_status",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function r(){let c=document.getElementById("aipkit_automated_task_form"),l=document.getElementById("aipkit_provider_notice_autogpt");if(!c||!l)return;c.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"][data-aipkit-provider-notice-defer="1"]').forEach(d=>{delete d.dataset.aipkitProviderNoticeArmed});let e=Array.from(c.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"]')),t=d=>d&&(d.offsetParent!==null||d.getClientRects().length>0),p=e.filter(t);if(!p.length){l.classList.add("aipkit_provider_notice--hidden");return}p.forEach(d=>{d.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(d.dataset.aipkitProviderNoticeArmed="true")}),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(c)}function i(c){if(!c)return null;let l="content_writing";return c==="content_indexing"?l="content_indexing":c==="community_reply_comments"?l="community_reply_comments":c==="enhance_existing_content"&&(l="enhance_existing_content"),window.aipkit_wizardConfig[l]||null}function s(c){let l=document.querySelector(".aipkit_wizard_content_container"),o=document.getElementById("aipkit_save_task_btn");if(!l)return;let e=i(c);if(!e){l.querySelectorAll(".aipkit_wizard_content_step").forEach(p=>{p.style.display="none",p.classList.remove("aipkit_active")}),o&&(o.style.display="none"),r();return}let t=new Set(Object.values(e.contentMap));l.querySelectorAll(".aipkit_wizard_content_step").forEach(p=>{let d=p.dataset.contentId||"";t.has(d)?(p.style.display="block",p.classList.add("aipkit_active")):(p.style.display="none",p.classList.remove("aipkit_active"))}),o&&(o.style.display="inline-flex"),r()}function n(c){k=c,s(c)}window.aipkit_renderWizard=n,window.aipkit_initWizardNavigation=()=>{},window.aipkit_resetWizard=()=>{k="",s("")},window.aipkit_wizardConfig=a})();(function(){"use strict";function k(a){let r=window.aipkit_automated_tasks_config||{},i=r.text||{},s=window.aipkit_escapeHtml||function(o){return o},n=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!n)return Promise.resolve();n.innerHTML=`<option value="">${s(i.loading_stores||"Loading...")}</option>`,n.disabled=!0;let c=[],l=i.select_target_store||"-- Select Target Store --";return a==="openai"&&r.openai_vector_stores?c=r.openai_vector_stores:a==="pinecone"&&r.pinecone_indexes?(c=r.pinecone_indexes,l=i.select_target_index||"-- Select Target Index --"):a==="qdrant"&&r.qdrant_collections&&(c=r.qdrant_collections,l=i.select_target_collection||"-- Select Target Collection --"),n.innerHTML=`<option value="">${s(l)}</option>`,c&&Array.isArray(c)&&c.length>0?(c.forEach(o=>{let e=o.id||o.name,t=o.name||o.id,p=s(t);a==="openai"&&o.file_counts?.total!==void 0?p+=` (Files: ${o.file_counts.total})`:a==="pinecone"&&o.dimension!==void 0&&(p+=` (Dim: ${o.dimension})`),n.appendChild(new Option(p,e))}),n.disabled=!1):(n.appendChild(new Option(s(i.no_targets_found_configure||`No ${a} targets found. Configure in AI Training.`),"")),n.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=k})();(function(){"use strict";function k(){let a=window.aipkit_automated_tasks_config||{},r=a.text||{},i=window.aipkit_escapeHtml||function(d){return d},s=document.getElementById("aipkit_task_content_indexing_embedding_model"),n=window.aipkit_automated_tasks_form_state||{},c=n.pendingEmbeddingModelSelection;if(!s)return Promise.resolve();s.innerHTML=`<option value="">${i(r.select_embedding_model||"-- Select Model --")}</option>`;let l=a.openai_embedding_models||[],o=a.google_embedding_models||[],e=a.openrouter_embedding_models||[],t=a.azure_embedding_models||[],p=(d,u,f)=>{let m=document.createElement("optgroup");return m.label=i(d),u&&u.length>0&&u.forEach(g=>{let _=`${f}:${g.id}`;m.appendChild(new Option(i(g.name||g.id),_))}),m};if(s.appendChild(p("OpenAI",l,"openai")),s.appendChild(p("Google",o,"google")),s.appendChild(p("OpenRouter",e,"openrouter")),s.appendChild(p("Azure",t,"azure")),s.disabled=l.length===0&&o.length===0&&e.length===0&&t.length===0,s.disabled&&(s.innerHTML=`<option value="">${i(r.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),c&&s.querySelector(`option[value="${CSS.escape(c)}"]`))s.value=c,n.pendingEmbeddingModelSelection=null;else if(s.options.length>1){let d=s.querySelector("optgroup");d&&d.options.length>0&&(s.value=d.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=k})();(function(){"use strict";function k(a){let r=a.target.value,i=document.getElementById("aipkit_task_content_indexing_embedding_model_group"),s=document.getElementById("aipkit_task_content_indexing_embedding_model_divider");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(r):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),i){let n=r==="pinecone"||r==="qdrant";i.style.display=n?"block":"none",s&&(s.style.display=n?"flex":"none"),n&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_autogpt_container");if(!a)return;let r=a.querySelector("#aipkit_task_content_indexing_target_store_provider");if(r){if(r.dataset.listenerAttached==="true")return;typeof window.aipkit_handleTargetStoreProviderChange=="function"?(r.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:r}),r.dataset.listenerAttached="true"):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found.")}}window.aipkit_initContentIndexingTaskFormUI=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},a=window.wp?.i18n?.__||function(i){return i};function r(i,s){let n=i.value,c=n?n.toLowerCase():"",l=window.aipkit_dashboard?.models,o=window.aipkit_automated_tasks_form_state||{};if(!s)return;if(!l){s.innerHTML=`<option value="">${k("Error: Model data object not found")}</option>`,s.disabled=!0;return}let e=l[c];(typeof e>"u"||e===null)&&(console.warn(`AutoGPT Model Populator: No model data for provider '${c}'.`),e=c==="openai"?{}:[]);let t=o.pendingModelSelection||s.value;s.innerHTML="";let p=window.aipkit_dashboard?.recommendedModels?.[c]||[],d=Array.isArray(p)?p:[],u=new Set(d.map(f=>f?.id).filter(Boolean));if(c==="openai"&&typeof e=="object"&&!Array.isArray(e)){if(d.length>0){let f=document.createElement("optgroup");f.label=k(a("Recommended","gpt3-ai-content-generator")),d.forEach(m=>{m&&typeof m=="object"&&m.id&&f.appendChild(new Option(k(m.name||m.id),m.id))}),f.children.length>0&&s.appendChild(f)}Object.keys(e).forEach(f=>{let m=document.createElement("optgroup");m.label=k(f),Array.isArray(e[f])&&e[f].forEach(g=>{if(g&&g.id){if(u.has(g.id))return;m.appendChild(new Option(k(g.name||g.id),g.id))}}),s.appendChild(m)})}else if(Array.isArray(e)){if(d.length>0){let m=document.createElement("optgroup");m.label=k(a("Recommended","gpt3-ai-content-generator")),d.forEach(g=>{g&&typeof g=="object"&&g.id&&m.appendChild(new Option(k(g.name||g.id),g.id))}),m.children.length>0&&s.appendChild(m)}let f=d.length>0?document.createElement("optgroup"):null;f&&(f.label=k(a("All models","gpt3-ai-content-generator"))),e.forEach(m=>{if(m&&m.id){if(u.has(m.id))return;let g=new Option(k(m.name||m.id),m.id);f?f.appendChild(g):s.appendChild(g)}}),f&&f.children.length>0&&s.appendChild(f)}else console.warn(`AutoGPT Model Populator: Unexpected format for provider '${c}'.`),s.appendChild(new Option(k(`No models for ${n} (Format Error)`),""));if(s.options.length===0)s.appendChild(new Option(k(`No models for ${n}`),"")),s.disabled=!0;else{s.disabled=!1;let f=!1;if(t&&s.querySelector(`option[value="${CSS.escape(t)}"]`)&&(s.value=t,f=!0),!f&&s.options.length>0){let m=s.querySelector('option:not([value=""])');m&&(s.value=m.value)}}o&&(o.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort(),s&&s.dispatchEvent(new Event("change",{bubbles:!0}))}window.aipkit_task_cw_populateModels=r})();(function(){"use strict";function k(a){if(!a)return;let r=a.closest(".aipkit_slider_wrapper"),i=null;if(r&&(i=r.querySelector(".aipkit_slider_value")),!i){let s=a.closest(".aipkit_ai_temperature_control");s&&(i=s.querySelector(".aipkit_ai_behavior_value"))}i&&(i.textContent=a.value,a.dataset.listenerAttached||(a.addEventListener("input",()=>i.textContent=a.value),a.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=k})();(function(){"use strict";function k(a){if(!a)return;let r=a.closest(".aipkit_slider_wrapper"),i=r?r.querySelector(".aipkit_slider_value"):null;i&&(i.textContent=a.value,a.dataset.listenerAttached||(a.addEventListener("input",()=>i.textContent=a.value),a.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=k})();(function(){"use strict";function k(a){let r=a.target,i=r.closest(".aipkit_post_settings_redesigned")||r.closest(".aipkit_wizard_content_step")||document,s=i.querySelector("#aipkit_task_cw_schedule_options_wrapper"),n=i.querySelector("#aipkit_task_cw_smart_schedule_fields"),c=i.querySelector(".aipkit_task_schedule_from_input_option"),l=c?c.querySelector(".aipkit_post_schedule_radio_text"):null,o=c?c.querySelector(".aipkit_popover_warning[data-tooltip]"):null;if(!s)return;let e=r.value==="publish";s.style.display=e?"block":"none";let t=document.getElementById("aipkit_automated_task_type"),p=new Set(["content_writing_bulk","content_writing_csv","content_writing_gsheets"]),d=`Accepted formats: YYYY-MM-DD HH:MM[:SS], YYYY/MM/DD HH:MM, MM/DD/YYYY HH:MM, DD/MM/YYYY HH:MM, or ISO 8601.

Times use the site timezone unless an offset/Z is provided.`,u={content_writing_bulk:{label:"Use Dates from List",tooltip:`Use when your list includes a publish date on each line.

`+d},content_writing_csv:{label:"Use Dates from CSV",tooltip:`Use when your CSV includes a publish date column.

`+d},content_writing_gsheets:{label:"Use Dates from Sheets",tooltip:`Use when your Google Sheets includes a publish date column.

`+d}},f={label:"Use Dates from Input",tooltip:`Use when your input includes a publish date.

`+d},m=()=>{if(!t)return;let y=u[t.value]||f;l&&(l.textContent=y.label),o&&o.setAttribute("data-tooltip",y.tooltip)},g=t&&p.has(t.value);if(c&&(m(),c.style.display=g?"inline-flex":"none",!g)){let y=c.querySelector('input[name="schedule_mode"][value="from_input"]');if(y&&y.checked){let E=i.querySelector('input[name="schedule_mode"][value="immediate"]');E&&(E.checked=!0,E.dispatchEvent(new Event("change",{bubbles:!0})))}}t&&!t.dataset.fromInputCopyListener&&(t.addEventListener("change",()=>{m()}),t.dataset.fromInputCopyListener="true"),i.querySelectorAll('input[name="schedule_mode"]').forEach(y=>{y.dataset.listenerAttached||(y.addEventListener("change",function(){let E=t&&p.has(t.value);n&&(n.style.display=this.value==="smart"?"block":"none")}),y.dataset.listenerAttached="true")});let h=i.querySelector('input[name="schedule_mode"]:checked');h&&n&&(n.style.display=h.value==="smart"?"block":"none")}window.aipkit_toggleTaskCwScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||(e=>e);function a(e){if(!e)return;let t=e.querySelector(".aipkit_task_cw_vector_store_toggle"),p=e.querySelectorAll(".aipkit_task_cw_vector_store_settings_container");if(!t||!p.length)return;let d=t.checked;p.forEach(u=>{u.style.display=d?"block":"none"}),d&&r(e)}function r(e){if(!e)return;let t=e.querySelector(".aipkit_task_cw_vector_store_provider_select");if(!t)return;let p=t.value,d=e.querySelector(".aipkit_task_cw_vector_openai_field"),u=e.querySelector(".aipkit_task_cw_vector_pinecone_field"),f=e.querySelector(".aipkit_task_cw_vector_qdrant_field"),m=e.querySelector(".aipkit_task_cw_vector_embedding_config_row"),g=(_,h)=>{_&&(_.style.display=h?"block":"none")};if(g(d,p==="openai"),g(u,p==="pinecone"),g(f,p==="qdrant"),m){let _=p==="pinecone"||p==="qdrant";m.style.display=_?"block":"none",_&&i(e)}}function i(e){let t=e.querySelector("#aipkit_task_cw_vector_embedding_model");if(!t)return;let p=e.querySelector("#aipkit_task_cw_vector_embedding_provider"),d=p?p.value:"openai",u=window.aipkit_automated_tasks_config||{},f=window.aipkit_automated_tasks_form_state||{},m=[];if(d==="google"?m=u.google_embedding_models||[]:d==="openrouter"?m=u.openrouter_embedding_models||[]:d==="azure"?m=u.azure_embedding_models||[]:m=u.openai_embedding_models||[],t.innerHTML="",m.length>0){t.add(new Option("-- Select Model --","")),m.forEach(_=>{t.add(new Option(k(_.name||_.id),_.id))}),t.disabled=!1;let g=f.pendingEmbeddingModelSelection;g&&Array.from(t.options).find(h=>h.value===g)&&(t.value=g,f.pendingEmbeddingModelSelection=null)}else t.add(new Option("No models found","")),t.disabled=!0}function s(e){if(!e)return;let t=e.getAttribute("aria-expanded")==="true",p=e.getAttribute("aria-controls"),d=document.getElementById(p);d&&(e.setAttribute("aria-expanded",(!t).toString()),d.setAttribute("aria-hidden",t?"true":"false"))}function n(e){if(!e)return;let t=document.getElementById(e.id+"_value");t&&(t.textContent=e.value)}function c(e){e&&(e.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(t=>{t.querySelector(".aipkit_task_cw_vector_store_toggle")&&(a(t),t.querySelectorAll(".aipkit_vector_slider").forEach(p=>{n(p)}))}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(e))}function l(){let e=document.getElementById("aipkit_autogpt_container");!e||e.dataset.kbListenerAttached==="true"||(e.addEventListener("change",t=>{let p=t.target;if(p.matches(".aipkit_task_cw_vector_store_toggle")){let d=p.closest(".aipkit_vector_settings_redesigned");a(d)}else if(p.matches(".aipkit_task_cw_vector_store_provider_select")){let d=p.closest(".aipkit_vector_settings_redesigned");r(d)}else if(p.matches(".aipkit_task_cw_vector_embedding_provider_select")){let d=p.closest(".aipkit_vector_settings_redesigned");i(d)}}),e.addEventListener("input",t=>{let p=t.target;p.matches(".aipkit_vector_slider")&&n(p)}),e.addEventListener("click",t=>{let p=t.target.closest(".aipkit_vector_settings_chunk_header--collapsible");if(!p)return;let d=p.closest(".aipkit_vector_settings_redesigned");!d||!d.querySelector(".aipkit_task_cw_vector_store_toggle")||(t.preventDefault(),s(p))}),c(e),e.dataset.kbListenerAttached="true")}function o(){let e=document.getElementById("aipkit_autogpt_container");e&&(l(),e.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(t=>{t.querySelector(".aipkit_task_cw_vector_store_toggle")&&(a(t),r(t),i(t))}))}window.aipkit_initCwKnowledgeBaseUI=l,window.aipkit_cw_task_populateEmbeddingModelSelect=i,window.aipkit_updateCwKnowledgeBaseUI=o})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_automated_task_form");if(!i){console.warn("Content Writing UI Init: Could not find main form element.");return}let s=i.querySelector("#aipkit_task_cw_ai_provider"),n=i.querySelector("#aipkit_task_cw_ai_model");s&&n&&typeof window.aipkit_task_cw_populateModels=="function"&&(s.dataset.cwProviderListenerAttached||(s.addEventListener("change",()=>window.aipkit_task_cw_populateModels(s,n)),s.dataset.cwProviderListenerAttached="true"),n.dataset.cwModelListenerAttached||(n.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),n.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(s,n),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let c=i.querySelector("#aipkit_task_cw_ai_temperature");c&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(c);let l=i.querySelector("#aipkit_task_cw_post_status");l&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(l.dataset.cwStatusListenerAttached||(l.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),l.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:l})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect(i),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initTaskRssInputHandler=="function"?window.aipkit_initTaskRssInputHandler():typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let e=i.querySelector(".aipkit_task_cw_image_enable_toggle");e&&(e.dataset.cwImgListenerAttached||(e.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),e.dataset.cwImgListenerAttached="true"));let t=i.querySelector("#aipkit_task_cw_image_provider");t&&(t.dataset.cwImgListenerAttached||(t.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),t.dataset.cwImgListenerAttached="true"));let p=i.querySelector("#aipkit_task_cw_generate_featured_image");p&&(p.dataset.cwImgListenerAttached||(p.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),p.dataset.cwImgListenerAttached="true"));let d=i.querySelector(".aipkit_task_cw_image_placement_select");d&&(d.dataset.cwImgListenerAttached||(d.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),d.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100));let u=i.querySelector(".aipkit_image_settings_redesigned");u&&u.dataset.imageChunkListenerAttached!=="true"&&(u.addEventListener("click",E=>{let x=E.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!x)return;E.preventDefault();let w=x.getAttribute("aria-expanded")==="true",S=x.getAttribute("aria-controls");if(!S)return;let T=document.getElementById(S);x.setAttribute("aria-expanded",(!w).toString()),T&&T.setAttribute("aria-hidden",w?"true":"false")}),u.dataset.imageChunkListenerAttached="true");let f=async E=>{if(!E||!E.name)return;let x=E.value.trim(),w=E.dataset.apiKeyBaseline||"";if(x===w||E.dataset.apiKeySaving==="true"||typeof window.aipkit_apiRequest!="function")return;let S=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,T=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,v=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;E.dataset.apiKeySaving="true",E.dataset.apiKeyBaseline=x,S&&S("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[E.name]:x}),T&&T("Updated")}catch(A){E.dataset.apiKeyBaseline=w,v&&v(`Error: ${A.message||"Failed to save."}`)}finally{E.dataset.apiKeySaving="false"}};i.querySelectorAll(".aipkit_task_cw_stock_api_key, #aipkit_task_cw_replicate_api_key").forEach(E=>{if(E.dataset.apiKeyListenerAttached==="true")return;E.dataset.apiKeyBaseline=E.value.trim();let x=()=>{f(E)};E.addEventListener("change",x),E.addEventListener("blur",x),E.dataset.apiKeyListenerAttached="true"}),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let g=i.querySelector("#aipkit_task_cw_ai_settings_toggle"),_=i.querySelector("#aipkit_task_cw_ai_parameters_row");g&&_&&(g.dataset.cwAiSettingsListenerAttached||(g.addEventListener("click",()=>{let E=_.style.display==="none"||_.style.display==="";_.style.display=E?"block":"none",g.classList.toggle("aipkit_active",E),g.setAttribute("aria-expanded",E)}),g.dataset.cwAiSettingsListenerAttached="true"));let h=i.querySelector("#aipkit_task_config_ai");h&&(h.dataset.cwPromptListenerAttached||(h.addEventListener("click",E=>{let x=E.target.closest(".aipkit_textarea_toggle");if(!x)return;let w=x.dataset.target,S=document.getElementById(w),T=x.querySelector(".dashicons");if(!S||!T)return;S.classList.toggle("aipkit_collapsed")?(T.classList.remove("dashicons-minus"),T.classList.add("dashicons-plus-alt2"),x.title="Expand"):(T.classList.remove("dashicons-plus-alt2"),T.classList.add("dashicons-minus"),x.title="Collapse")}),h.dataset.cwPromptListenerAttached="true"));let y=i.querySelector("#aipkit_task_config_seo");y&&(y.dataset.cwSeoPromptListenerAttached||(y.addEventListener("click",E=>{let x=E.target.closest(".aipkit_textarea_toggle");if(!x)return;let w=x.dataset.target,S=document.getElementById(w),T=x.querySelector(".dashicons");if(!S||!T)return;S.classList.toggle("aipkit_collapsed")?(T.classList.remove("dashicons-minus"),T.classList.add("dashicons-plus-alt2"),x.title="Expand"):(T.classList.remove("dashicons-plus-alt2"),T.classList.add("dashicons-minus"),x.title="Collapse")}),y.dataset.cwSeoPromptListenerAttached="true"))}function a(){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let s=window.aipkit_debug||!1,n=i.querySelector(".aipkit_task_cw_image_enable_toggle"),c=i.querySelector("#aipkit_task_cw_generate_featured_image"),l=i.querySelector(".aipkit_task_cw_image_settings_container"),o=i.querySelector("#aipkit_task_cw_image_provider");if(!n||!c||!l||!o)return;let e=n.checked,t=c.checked,p=e||t,d=o.value,u=d==="pexels"||d==="pixabay";if(l.style.display=p?"block":"none",p){let f=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],m=i.querySelector(".aipkit_task_cw_image_placement_select"),g=i.querySelector(".aipkit_task_cw_image_placement_x_field"),_=i.querySelector("#aipkit_task_cw_pexels_options"),h=i.querySelector("#aipkit_task_cw_pixabay_options"),y=i.querySelector("#aipkit_task_cw_replicate_options"),E=i.querySelector(".aipkit_task_cw_image_display_chunk"),x=i.querySelector("#aipkit_task_cw_image_model_group"),w=i.querySelector("#aipkit_task_cw_image_model_divider");if(f.forEach(S=>{let T=i.querySelector(S);if(T){let v=T.closest(".aipkit_form-group");v&&(v.style.display=e?"block":"none")}}),E&&(E.style.display=e?"":"none"),m&&g){let S=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(m.value);g.style.display=e&&S?"block":"none"}_&&(_.style.display=p&&u&&d==="pexels"?"block":"none"),h&&(h.style.display=p&&u&&d==="pixabay"?"block":"none"),y&&(y.style.display=p&&d==="replicate"?"block":"none"),x&&(x.style.display=p&&!u?"":"none"),w&&(w.style.display=p&&!u?"":"none"),p&&!u&&typeof r=="function"&&r(d)}}function r(i){let s=document.getElementById("aipkit_task_cw_image_model");if(!s)return;let n=s.value,l=window.aipkit_dashboard?.imageGeneratorModels?.[i.toLowerCase()]||[],o=window.aipkit_escapeHtml||function(t){return t},e=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||s.value;if(s.innerHTML="",l.length>0?(l.forEach(t=>{s.appendChild(new Option(o(t.name),t.id))}),s.querySelector(`option[value="${CSS.escape(e)}"]`)&&(s.value=e)):s.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null),typeof window.aipkit_updateAutogptAiSummaries=="function"&&s.value!==n){let t=document.getElementById("aipkit_autogpt_container");window.aipkit_updateAutogptAiSummaries(t)}}window.aipkit_initContentWritingTaskFormUI=k,window.aipkit_updateTaskImageSettingsUI=a,window.aipkit_populateTaskImageModels=r})();(function(){"use strict";function k(){let a=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!a)return;let r=a.querySelector("#aipkit_task_cc_ai_provider"),i=a.querySelector("#aipkit_task_cc_ai_model");r&&i&&typeof window.aipkit_task_cw_populateModels=="function"&&(r.dataset.ccProviderListenerAttached||(r.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(r,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),r.dataset.ccProviderListenerAttached="true"),i.dataset.ccModelListenerAttached||(i.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),i.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(r,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let s=a.querySelector("#aipkit_task_cc_ai_temperature");s&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(s);let n=a.querySelector("#aipkit_task_cc_content_max_tokens");n&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(n);let c=a.querySelector("#aipkit_task_cc_ai_settings_toggle"),l=a.querySelector("#aipkit_task_cc_ai_parameters_row");c&&l&&(c.dataset.ccAiSettingsListenerAttached||(c.addEventListener("click",()=>{let o=l.style.display==="none"||l.style.display==="";l.style.display=o?"block":"none",c.classList.toggle("aipkit_active",o),c.setAttribute("aria-expanded",o)}),c.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=k})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelectorAll("[data-aipkit-popover-target]");if(!i.length)return;let s=null,n=null,c=!1,l=d=>d?r.querySelector(`#${d}`):null,o=(d,u)=>{if(!d||!u)return;let f=d.getBoundingClientRect(),m=u.getBoundingClientRect(),g=m.width||400,_=m.height||0,h=window.innerWidth,y=window.innerHeight,E=12;if(d.dataset.aipkitPopoverPlacement==="bottom"){let S=f.left;S+g>h-E&&(S=f.right-g),S=Math.max(E,Math.min(S,h-g-E));let T=f.bottom+8;T+_>y-E&&(T=f.top-_-8),T=Math.max(E,Math.min(T,y-_-E)),u.style.left=`${Math.round(S)}px`,u.style.top=`${Math.round(T)}px`;return}if(d.dataset.aipkitPopoverPlacement==="left"){let S=f.left-g-10;S<E&&(S=f.right+10),S=Math.max(E,Math.min(S,h-g-E));let T=f.top;T+_>y-E&&(T=y-_-E),T=Math.max(E,T),u.style.left=`${Math.round(S)}px`,u.style.top=`${Math.round(T)}px`;return}let x=f.right+10;x+g>h-E&&(x=f.right-g-10),x=Math.max(E,Math.min(x,h-g-E));let w=f.top;w+_>y-E&&(w=y-_-E),w=Math.max(E,w),u.style.left=`${Math.round(x)}px`,u.style.top=`${Math.round(w)}px`},e=()=>{!n||!s||c||(c=!0,window.requestAnimationFrame(()=>{let d=s.querySelector(".aipkit_model_settings_popover_panel");o(n,d),c=!1}))},t=()=>{s&&(s.classList.remove("aipkit-active"),s.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-expanded","false"),s=null,n=null)},p=d=>{if(!d)return;let u=d.getAttribute("data-aipkit-popover-target"),f=l(u);if(!f)return;s&&s!==f&&t(),s=f,n=d,f.classList.add("aipkit-active"),f.setAttribute("aria-hidden","false"),d.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${u}`),typeof window.aipkit_initAutogptPromptFlyouts=="function"&&window.aipkit_initAutogptPromptFlyouts(r);let m=f.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{o(d,m)})};i.forEach(d=>{d.dataset.popoverListenerAttached!=="true"&&(d.addEventListener("click",u=>{if(u.preventDefault(),!(d.dataset.aipkitPopoverKeepOpen==="true")&&s&&n===d&&s.classList.contains("aipkit-active")){t();return}p(d)}),d.dataset.popoverListenerAttached="true")}),r.querySelectorAll(".aipkit_model_settings_popover").forEach(d=>{d.dataset.overlayListenerAttached!=="true"&&(d.addEventListener("click",f=>{f.target===d&&t()}),d.dataset.overlayListenerAttached="true");let u=d.querySelector(".aipkit_model_settings_popover_close");u&&u.dataset.popoverListenerAttached!=="true"&&(u.addEventListener("click",f=>{f.preventDefault(),t()}),u.dataset.popoverListenerAttached="true"),d.querySelectorAll("[data-aipkit-popover-close]").forEach(f=>{f.dataset.popoverListenerAttached!=="true"&&(f.addEventListener("click",m=>{m.preventDefault(),t()}),f.dataset.popoverListenerAttached="true")})}),r.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",d=>{d.key==="Escape"&&s&&t()}),r.dataset.escapeListenerAttached="true"),r.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),r.dataset.repositionListenersAttached="true")}function a(){let r=document.getElementById("aipkit_autogpt_container");r&&k(r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a(),window.aipkit_initAutogptPopovers=k})();(function(){"use strict";let k=o=>{if(!o)return"";let e=o.options?o.options[o.selectedIndex]:null;return e?e.textContent.trim():""},a=o=>o?Array.from(o.selectedOptions||[]).map(e=>e.textContent.trim()).filter(Boolean):[],r=(o,e)=>{let t=o.filter(Boolean);return t.length?t.join(", "):e||""},i=(o,e)=>{if(!o)return;o.textContent=e,o.title=e;let t=o.dataset.aipkitPlaceholder||"",p="active";t&&e===t&&(p="placeholder"),o.dataset.aipkitSummaryState=p},s=(o,e)=>{if(!o)return;let t=e||document,p=o.dataset.aipkitAutogptSummary||"",d=o.dataset.aipkitAutogptProvider||"",u=o.dataset.aipkitAutogptModel||"",f=u?t.querySelector(u):null,m=k(f),g=o.dataset.aipkitPlaceholder||"Select";if(p==="images"){let _=o.dataset.aipkitDisabledLabel||g,h=o.dataset.aipkitAutogptToggle||"",y=o.dataset.aipkitAutogptFeaturedToggle||"",E=h?t.querySelector(h):null,x=y?t.querySelector(y):null;if(!(E&&E.checked||x&&x.checked)){i(o,_);return}let S=d?t.querySelector(d):null,T=S?S.value:"",v=k(S);if(["pexels","pixabay"].includes(T)){i(o,v||g);return}i(o,m||v||g);return}if(p==="vector"){let _=o.dataset.aipkitDisabledLabel||g,h=o.dataset.aipkitAutogptToggle||"",y=h?t.querySelector(h):null;if(!(y?y.checked:!0)){i(o,_);return}let x=d?t.querySelector(d):null,w=x?x.value:"",S=k(x),T=o.dataset.aipkitAutogptStore||"",v=o.dataset.aipkitAutogptOpenaiStore||"",A=o.dataset.aipkitAutogptPineconeStore||"",C=o.dataset.aipkitAutogptQdrantStore||"",b="";if(w==="openai"&&v){let L=t.querySelector(v);b=a(L).join(", ")}else w==="pinecone"&&A?b=k(t.querySelector(A)):w==="qdrant"&&C?b=k(t.querySelector(C)):T&&(b=k(t.querySelector(T)));i(o,r([b,S],g));return}i(o,m||g)},n=(o,e)=>{if(!o||o.dataset.aipkitAutogptSummaryBound==="true")return;let t=e||document,p=o.dataset.aipkitAutogptProvider||"",d=o.dataset.aipkitAutogptModel||"",u=o.dataset.aipkitAutogptToggle||"",f=o.dataset.aipkitAutogptFeaturedToggle||"",m=[o.dataset.aipkitAutogptStore||"",o.dataset.aipkitAutogptOpenaiStore||"",o.dataset.aipkitAutogptPineconeStore||"",o.dataset.aipkitAutogptQdrantStore||""].filter(Boolean),g=p?t.querySelector(p):null,_=d?t.querySelector(d):null,h=u?t.querySelector(u):null,y=f?t.querySelector(f):null,E=()=>s(o,t);g&&g.addEventListener("change",E),_&&_.addEventListener("change",E),h&&h.addEventListener("change",E),y&&y.addEventListener("change",E),m.forEach(x=>{let w=t.querySelector(x);w&&w.addEventListener("change",E)}),o.dataset.aipkitAutogptSummaryBound="true",s(o,t)};function c(o){let e=o||document.getElementById("aipkit_autogpt_container");if(!e)return;e.querySelectorAll("[data-aipkit-autogpt-summary]").forEach(p=>{n(p,e),s(p,e)})}function l(){let o=document.getElementById("aipkit_autogpt_container");o&&c(o)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),window.aipkit_updateAutogptAiSummaries=c})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"]},a={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},r=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),i=()=>{let t=document.getElementById("aipkit_automated_task_type"),p=t?t.value:"";return p==="content_writing"?"bulk":p&&p.startsWith("content_writing_")&&p.replace("content_writing_","")||"bulk"},s=(t,p)=>{let d=k[t]||[],u=a[p]||[],f=[...d,...u];return f.filter((m,g)=>f.indexOf(m)===g)},n=(t,p)=>{if(!t)return;let d=t.dataset.label||"Variables:",u=t.dataset.copyTitle||"Click to copy";t.innerHTML=`${r(d)} `,p.forEach((f,m)=>{let g=document.createElement("code");g.className="aipkit-placeholder",g.title=u,g.textContent=f,t.appendChild(g),m<p.length-1&&t.appendChild(document.createTextNode(" "))})},c=t=>{let p=t||document.getElementById("aipkit_autogpt_container");if(!p)return;let d=i(),u=p.querySelectorAll(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");u.length&&u.forEach(f=>{let m=f.dataset.promptType||"",g=s(m,d);g.length&&n(f,g)})};function l(t){let p=t.querySelectorAll(".aipkit_cw_prompt_library_select");p.length&&p.forEach(d=>{d.dataset.promptLibraryAttached!=="true"&&(d.addEventListener("change",()=>{let u=d.getAttribute("data-aipkit-prompt-target");if(!u||!d.value)return;let f=t.querySelector(`#${u}`);f&&(f.value=d.value,f.dispatchEvent(new Event("input",{bubbles:!0})))}),d.dataset.promptLibraryAttached="true")})}function o(t){if(!t)return;let p=t.querySelectorAll("[data-aipkit-flyout-target]");if(!p.length)return;let d=null,u=null,f=!1,m=E=>E?t.querySelector(`#${E}`):null,g=(E,x,w)=>{if(!E||!x||!d)return;let S=E.getBoundingClientRect(),T=w?w.getBoundingClientRect():S,v=x.getBoundingClientRect(),A=v.width||580,C=v.height||420,b=window.innerWidth,L=window.innerHeight,B=12,$=T.left-A-10;$<B&&($=T.right+10),$=Math.max(B,Math.min($,b-A-B));let W=T.top;W+C>L-B&&(W=L-C-B),W=Math.max(B,W),d.style.left=`${Math.round($)}px`,d.style.top=`${Math.round(W)}px`},_=()=>{!d||!u||f||(f=!0,window.requestAnimationFrame(()=>{let E=d.querySelector(".aipkit_cw_prompt_panel"),x=u.closest(".aipkit_model_settings_popover_panel");g(u,E,x),f=!1}))},h=()=>{d&&(d.classList.remove("is-open"),d.setAttribute("aria-hidden","true"),u&&u.setAttribute("aria-expanded","false"),d=null,u=null)},y=E=>{let x=E.getAttribute("data-aipkit-flyout-target"),w=m(x);w&&(d&&d!==w&&h(),d=w,u=E,w.classList.add("is-open"),w.setAttribute("aria-hidden","false"),E.setAttribute("aria-expanded","true"),c(w),window.requestAnimationFrame(()=>{let S=w.querySelector(".aipkit_cw_prompt_panel"),T=E.closest(".aipkit_model_settings_popover_panel");g(E,S,T)}))};p.forEach(E=>{E.dataset.promptFlyoutListenerAttached!=="true"&&(E.addEventListener("click",x=>{if(x.preventDefault(),d&&u===E&&d.classList.contains("is-open")){h();return}y(E)}),E.dataset.promptFlyoutListenerAttached="true")}),t.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(E=>{E.dataset.overlayListenerAttached!=="true"&&(E.addEventListener("click",x=>{x.target===E&&h()}),E.dataset.overlayListenerAttached="true")}),t.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",E=>{E.key==="Escape"&&d&&h()}),t.dataset.promptFlyoutEscapeAttached="true"),t.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",E=>{if(!d)return;let x=E.target;x.closest(".aipkit_cw_prompt_flyout")||x.closest("[data-aipkit-flyout-target]")||h()}),t.dataset.promptFlyoutClickAttached="true"),t.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",_),window.addEventListener("scroll",_,!0),t.dataset.promptFlyoutRepositionAttached="true")}function e(t){let p=t||document.getElementById("aipkit_autogpt_container");p&&(l(p),o(p),c(p))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>e()):e(),window.aipkit_initAutogptPromptFlyouts=e,window.aipkit_updateAutogptPromptPlaceholders=()=>{c()}})();(function(){"use strict";function k(){let n=document.querySelector("#aipkit_task_cw_ai_provider"),c=document.querySelector("#aipkit_task_cw_ai_model"),l=document.querySelector(".aipkit_task_cw_reasoning_effort_field"),o=l?l.closest(".aipkit_ai_settings_redesigned"):null;if(!n||!c||!l){l&&(l.style.display="none");return}let e=(n.value||"").toLowerCase(),p=(c.value||"").toLowerCase(),d=p.startsWith("o1")||p.startsWith("o3")||p.startsWith("o4"),u=p.includes("gpt-5");e==="openai"&&(d||u)?(l.style.display="block",o&&a(o,p)):l.style.display="none"}function a(n,c){let l=n.querySelector("[data-aipkit-reasoning-select]"),o=n.querySelectorAll(".aipkit_ai_reasoning_option");if(!l||!o.length)return;let e=r(c),t=new Set(e.allowed);o.forEach(f=>{let m=f.querySelector(".aipkit_ai_reasoning_input");if(!m)return;let g=m.value==="minimal"?"low":m.value,_=t.has(g);f.style.display=_?"":"none",_||(m.checked=!1)});let p=l.value||"";p==="minimal"&&(p="low"),t.has(p)||(p=e.defaultValue),t.has(p)||(p=e.allowed[0]||"");let d=l.value;p&&(l.value=p);let u=n.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(u){u.checked=!0,n.querySelectorAll(".aipkit_ai_reasoning_option").forEach(m=>m.classList.remove("aipkit_ai_reasoning_option--selected"));let f=u.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}d!==l.value&&l.dispatchEvent(new Event("change",{bubbles:!0}))}function r(n){return s(n)?{allowed:["high"],defaultValue:"high"}:n.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(n)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(n){let c=n.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let l=n.match(/gpt-(\d+)/);return l?Number.parseInt(l[1],10)>=6:!1}function s(n){return/gpt-5(\.\d+)?-pro/.test(n)}window.aipkit_autogpt_cw_toggleReasoningEffort=k})();(function(){"use strict";function k(){let n=document.querySelector("#aipkit_task_cc_ai_provider"),c=document.querySelector("#aipkit_task_cc_ai_model"),l=document.querySelector(".aipkit_task_cc_reasoning_effort_field"),o=l?l.closest(".aipkit_ai_settings_redesigned"):null;if(!n||!c||!l){l&&(l.style.display="none");return}let e=(n.value||"").toLowerCase(),p=(c.value||"").toLowerCase(),d=p.startsWith("o1")||p.startsWith("o3")||p.startsWith("o4"),u=p.includes("gpt-5");e==="openai"&&(d||u)?(l.style.display="block",o&&a(o,p)):l.style.display="none"}function a(n,c){let l=n.querySelector("[data-aipkit-reasoning-select]"),o=n.querySelectorAll(".aipkit_ai_reasoning_option");if(!l||!o.length)return;let e=r(c),t=new Set(e.allowed);o.forEach(f=>{let m=f.querySelector(".aipkit_ai_reasoning_input");if(!m)return;let g=m.value==="minimal"?"low":m.value,_=t.has(g);f.style.display=_?"":"none",_||(m.checked=!1)});let p=l.value||"";p==="minimal"&&(p="low"),t.has(p)||(p=e.defaultValue),t.has(p)||(p=e.allowed[0]||"");let d=l.value;p&&(l.value=p);let u=n.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(u){u.checked=!0,n.querySelectorAll(".aipkit_ai_reasoning_option").forEach(m=>m.classList.remove("aipkit_ai_reasoning_option--selected"));let f=u.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}d!==l.value&&l.dispatchEvent(new Event("change",{bubbles:!0}))}function r(n){return s(n)?{allowed:["high"],defaultValue:"high"}:n.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(n)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(n){let c=n.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let l=n.match(/gpt-(\d+)/);return l?Number.parseInt(l[1],10)>=6:!1}function s(n){return/gpt-5(\.\d+)?-pro/.test(n)}window.aipkit_autogpt_cc_toggleReasoningEffort=k})();(function(){"use strict";function k(a,r){let i=document.getElementById("aipkit_save_task_btn"),s=i?i.querySelector(".aipkit_btn-text"):null,n=a.elements.task_id,c=a.elements.task_name,l=a.elements.task_type,o=a.elements.task_status,e=document.getElementById("aipkit_cancel_edit_task_btn"),p=(window.aipkit_automated_tasks_config||{}).text||{},d=document.getElementById("aipkit_autogpt_header_title_default"),u=document.getElementById("aipkit_autogpt_header_title_editor"),f=document.getElementById("aipkit_autogpt_title_display"),m=document.getElementById("aipkit_autogpt_title_text"),g=document.getElementById("aipkit_autogpt_task_title_input"),_=m&&m.dataset.defaultLabel||g&&g.placeholder||"New Task",h=()=>{let w=(g?g.value.trim():"")||_;m&&(m.textContent=w),f&&f.setAttribute("title",w),c&&(c.value=w)},y=()=>{!f||!g||(f.style.display="none",g.style.display="inline-block",g.focus(),g.select())},E=()=>{!f||!g||(g.style.display="none",f.style.display="inline-flex",h())};d&&(d.style.display="none"),u&&(u.style.display="flex"),u&&u.dataset.inlineTitleBound!=="true"&&f&&g&&(f.addEventListener("click",y),g.addEventListener("blur",E),g.addEventListener("keydown",x=>{x.key==="Enter"&&(x.preventDefault(),g.blur())}),g.addEventListener("input",h),u.dataset.inlineTitleBound="true"),r?(s&&(s.textContent=p.save_task_button||"Save Task"),n&&(n.value=r.id||""),g&&(g.value=r.task_name||_),h(),l&&(l.value=r.task_type||"content_indexing"),o&&(o.value=r.status||"active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),e&&(e.style.display="inline-flex")):(s&&(s.textContent=p.save_task_button||"Save Task"),n&&(n.value=""),g&&(g.value=_),h(),l&&(l.value="content_indexing"),o&&(o.value="active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),e&&(e.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function a(r){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let s=i.elements["post_types[]"];s&&(Array.from(s.options).forEach(c=>c.selected=!1),(r.post_types||[]).forEach(c=>{let l=s.querySelector(`option[value="${k(c)}"]`);l&&(l.selected=!0)}));let n=i.elements.target_store_provider;n&&(n.value=r.target_store_provider||"openai",n.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(r.target_store_provider||"openai").then(()=>{let c=i.elements.target_store_id;c&&(c.value=r.target_store_id||"")}),i.elements.index_existing_now_flag&&(i.elements.index_existing_now_flag.checked=r.index_existing_now_flag==="1"),i.elements.only_new_updated_flag&&(i.elements.only_new_updated_flag.checked=r.only_new_updated_flag==="1"),(r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&r.embedding_provider&&r.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${r.embedding_provider}:${r.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),i.elements.task_frequency&&(i.elements.task_frequency.value=r.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function a(r){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let s=r.cw_generation_mode||"bulk";if(s==="bulk"||s==="single"||s==="task"){let x=i.elements.content_title_bulk;x&&(x.value=r.content_title||"")}else if(s==="csv"){let x=i.elements.content_title;x&&(x.value=r.content_title||"")}else if(s==="rss"){i.elements.rss_feeds&&(i.elements.rss_feeds.value=r.rss_feeds||""),i.elements.rss_include_keywords&&(i.elements.rss_include_keywords.value=r.rss_include_keywords||""),i.elements.rss_exclude_keywords&&(i.elements.rss_exclude_keywords.value=r.rss_exclude_keywords||"");let x=i.elements.rss_feeds;x&&(typeof window.aipkit_initTaskRssInputHandler=="function"&&window.aipkit_initTaskRssInputHandler(),x.dispatchEvent(new Event("input",{bubbles:!0})))}else if(s==="url")i.elements.url_list&&(i.elements.url_list.value=r.url_list||"");else if(s==="gsheets"){let x=i.elements.gsheets_credentials;if(x){let w=r.gsheets_credentials,S=x.closest(".aipkit_gsheets_section_container");typeof w=="object"&&w!==null?x.value=JSON.stringify(w,null,2):x.value=w||"",x.value?(x.dataset.filename="credentials.json",S&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(S),100)):(delete x.dataset.filename,S&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(S,"clear"))}i.elements.gsheets_sheet_id&&(i.elements.gsheets_sheet_id.value=r.gsheets_sheet_id||"")}i.elements.custom_title_prompt&&(i.elements.custom_title_prompt.value=r.custom_title_prompt||""),i.elements.custom_content_prompt&&(i.elements.custom_content_prompt.value=r.custom_content_prompt||"");let n=document.getElementById("aipkit_task_cw_ai_provider"),c=document.getElementById("aipkit_task_cw_ai_model");n&&(n.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",r.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&c&&window.aipkit_task_cw_populateModels(n,c));let l=document.getElementById("aipkit_task_cw_ai_temperature");if(l){l.value=r.ai_temperature||"1.0";let x=document.getElementById("aipkit_task_cw_ai_temperature_value");x&&(x.textContent=l.value)}let o=document.getElementById("aipkit_task_cw_content_length");o&&(o.value=r.content_length||"medium",o.dispatchEvent(new Event("change",{bubbles:!0})));let e=i.elements.reasoning_effort;if(e){let x=r.reasoning_effort||"";x&&(e.value=x==="minimal"?"low":x,e.dispatchEvent(new Event("change",{bubbles:!0})))}c&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>c.dispatchEvent(new Event("change",{bubbles:!0})),100),i.elements.generate_meta_description&&(i.elements.generate_meta_description.checked=r.generate_meta_description==="1"),i.elements.custom_meta_prompt&&(i.elements.custom_meta_prompt.value=r.custom_meta_prompt||""),i.elements.generate_focus_keyword&&(i.elements.generate_focus_keyword.checked=r.generate_focus_keyword==="1"),i.elements.custom_keyword_prompt&&(i.elements.custom_keyword_prompt.value=r.custom_keyword_prompt||""),i.elements.generate_excerpt&&(i.elements.generate_excerpt.checked=r.generate_excerpt==="1"),i.elements.custom_excerpt_prompt&&(i.elements.custom_excerpt_prompt.value=r.custom_excerpt_prompt||""),i.elements.generate_tags&&(i.elements.generate_tags.checked=r.generate_tags==="1"),i.elements.custom_tags_prompt&&(i.elements.custom_tags_prompt.value=r.custom_tags_prompt||""),i.elements.generate_toc&&(i.elements.generate_toc.checked=r.generate_toc==="1"),i.elements.generate_seo_slug&&(i.elements.generate_seo_slug.checked=r.generate_seo_slug==="1"),i.elements.post_type&&(i.elements.post_type.value=r.post_type||"post");let t=i.elements.post_author;t&&(t.value=r.post_author||window.aipkit_dashboard?.currentUserId||"1");let p=document.getElementById("aipkit_task_cw_post_status");p&&(p.value=r.post_status||"draft");let d=r.schedule_mode||"immediate",u=i.querySelector(`input[name="schedule_mode"][value="${d}"]`);u&&(u.checked=!0),i.elements.smart_schedule_start_datetime&&(i.elements.smart_schedule_start_datetime.value=r.smart_schedule_start_datetime||""),i.elements.smart_schedule_interval_value&&(i.elements.smart_schedule_interval_value.value=r.smart_schedule_interval_value||"1"),i.elements.smart_schedule_interval_unit&&(i.elements.smart_schedule_interval_unit.value=r.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:p});let f=document.getElementById("aipkit_task_cw_post_categories");f&&f.options&&(Array.from(f.options).forEach(w=>w.selected=!1),(Array.isArray(r.post_categories)?r.post_categories.map(String):[]).forEach(w=>{let S=f.querySelector(`option[value="${k(w)}"]`);S&&(S.selected=!0)}),f.dispatchEvent(new Event("change",{bubbles:!0}))),i.elements.generate_images_enabled&&(i.elements.generate_images_enabled.checked=r.generate_images_enabled==="1"),i.elements.image_provider&&(i.elements.image_provider.value=(r.image_provider||"openai").toLowerCase()),i.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=r.image_model),i.elements.image_prompt&&(i.elements.image_prompt.value=r.image_prompt||""),i.elements.image_count&&(i.elements.image_count.value=r.image_count||"1"),i.elements.image_placement&&(i.elements.image_placement.value=r.image_placement||"after_first_h2"),i.elements.image_placement_param_x&&(i.elements.image_placement_param_x.value=r.image_placement_param_x||"2"),i.elements.image_size&&(i.elements.image_size.value=r.image_size||"large"),i.elements.image_alignment&&(i.elements.image_alignment.value=r.image_alignment||"none"),i.elements.generate_featured_image&&(i.elements.generate_featured_image.checked=r.generate_featured_image==="1"),i.elements.featured_image_prompt&&(i.elements.featured_image_prompt.value=r.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let m=i.querySelector('input[name="enable_vector_store"]');m&&(m.checked=r.enable_vector_store==="1",m.dispatchEvent(new Event("change",{bubbles:!0})));let g=i.querySelector("#aipkit_task_cw_vector_store_provider");g&&(g.value=r.vector_store_provider||"openai",g.dispatchEvent(new Event("change",{bubbles:!0})));let _=i.querySelector("#aipkit_task_cw_vector_store_top_k");if(_){_.value=r.vector_store_top_k||"3";let x=i.querySelector("#aipkit_task_cw_vector_store_top_k_value");x&&(x.textContent=_.value)}let h=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(h&&h.options){let x=Array.isArray(r.openai_vector_store_ids)?r.openai_vector_store_ids.map(String):[];Array.from(h.options).forEach(w=>{w.selected=x.includes(w.value)}),h.dispatchEvent(new Event("change",{bubbles:!0}))}let y=document.getElementById("aipkit_task_cw_pinecone_index_name");y&&(y.value=r.pinecone_index_name||"");let E=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(E&&(E.value=r.qdrant_collection_name||""),r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant"){let x=document.getElementById("aipkit_task_cw_vector_embedding_provider");x&&(x.value=r.vector_embedding_provider||"openai",x.dispatchEvent(new Event("change",{bubbles:!0})))}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),r.vector_store_provider&&(r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant")&&r.vector_embedding_model&&setTimeout(()=>{window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=r.vector_embedding_model);let x=i.querySelector("#aipkit_autogpt_cw_vector_settings_popover")||i;x&&typeof window.aipkit_cw_task_populateEmbeddingModelSelect=="function"&&window.aipkit_cw_task_populateEmbeddingModelSelect(x)},150),i.elements.task_frequency&&(i.elements.task_frequency.value=r.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=a})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_automated_task_form");if(!r)return;let i=document.getElementById("aipkit_task_cc_ai_provider"),s=document.getElementById("aipkit_task_cc_ai_model");i&&s&&(i.value=a.ai_provider?a.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&a.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=a.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(i,s));let n=document.getElementById("aipkit_task_cc_ai_temperature");if(n){n.value=a.ai_temperature||1;let f=document.getElementById(n.id+"_value");f&&(f.textContent=n.value)}let c=document.getElementById("aipkit_task_cc_content_max_tokens");if(c){c.value=a.content_max_tokens||4e3;let f=document.getElementById(c.id+"_value");f&&(f.textContent=c.value),c.dispatchEvent(new Event("change",{bubbles:!0}))}let l=r.elements.cc_reasoning_effort;if(l){let f=a.reasoning_effort||"";f&&(l.value=f==="minimal"?"low":f,l.dispatchEvent(new Event("change",{bubbles:!0})))}s&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>s.dispatchEvent(new Event("change",{bubbles:!0})),100);let o=document.getElementById("aipkit_task_cc_custom_content_prompt");o&&(o.value=a.custom_content_prompt||"");let e=document.getElementById("aipkit_task_comment_reply_include_keywords");e&&(e.value=a.include_keywords||"");let t=document.getElementById("aipkit_task_comment_reply_exclude_keywords");t&&(t.value=a.exclude_keywords||"");let p=r.elements["post_types_for_comments[]"];p&&(Array.from(p.options).forEach(f=>f.selected=!1),(a.post_types_for_comments||[]).forEach(f=>{let m=p.querySelector(`option[value="${f}"]`);m&&(m.selected=!0)}));let d=r.elements.reply_action;d&&(d.value=a.reply_action||"approve");let u=r.elements.no_reply_to_replies;u&&(u.checked=a.no_reply_to_replies==="1"),r.elements.task_frequency&&(r.elements.task_frequency.value=a.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_automated_tasks_config||{},i=window.aipkit_dashboard||{},s=r.default_cw_prompts||{};if(!a)return;a.elements.custom_title_prompt&&(a.elements.custom_title_prompt.value=s.title||""),a.elements.custom_content_prompt&&(a.elements.custom_content_prompt.value=s.content||""),a.elements.custom_meta_prompt&&(a.elements.custom_meta_prompt.value=s.meta||""),a.elements.custom_keyword_prompt&&(a.elements.custom_keyword_prompt.value=s.keyword||""),a.elements.image_prompt&&(a.elements.image_prompt.value=s.image||""),a.elements.featured_image_prompt&&(a.elements.featured_image_prompt.value=s.featured_image||"");let n=document.getElementById("aipkit_task_cw_ai_provider"),c=document.getElementById("aipkit_task_cw_ai_model");if(n&&c){let o=(i.main_provider||"openai").toLowerCase();if(n.value=o,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(n,c);let e="",t=i?.models?.[o];switch(o){case"openai":e="gpt-4.1-mini";break;case"google":e="gemini-1.5-flash-latest";break;case"openrouter":e="moonshotai/kimi-k2.5";break;case"claude":e="claude-opus-4-6",Array.isArray(t)&&t.length>0&&(t.some(d=>d&&d.id==="claude-opus-4-6")||(e=t[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(t)&&t.length>0&&(e=t[0].id||"");break}c.querySelector(`option[value="${CSS.escape(e)}"]`)?c.value=e:console.warn(`Default model ${e} not found for provider ${o}.`)}}let l=document.getElementById("aipkit_task_cw_content_length");l&&(l.value="medium",l.dispatchEvent(new Event("change",{bubbles:!0}))),a.elements.generate_images_enabled&&(a.elements.generate_images_enabled.checked=!1),a.elements.image_provider&&(a.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{a.elements.image_model&&(a.elements.image_model.value="gpt-image-1")},0)),a.elements.image_count&&(a.elements.image_count.value="1"),a.elements.image_placement&&(a.elements.image_placement.value="after_first_h2"),a.elements.generate_featured_image&&(a.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_dashboard||{};if(!a)return;let i=document.getElementById("aipkit_task_cc_custom_content_prompt");i&&(i.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let s=document.getElementById("aipkit_task_cc_ai_provider"),n=document.getElementById("aipkit_task_cc_ai_model");if(s&&n){let l=(r.main_provider||"openai").toLowerCase();if(s.value=l,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(s,n);let o="",e=(r.models||{})[l]||{};switch(l){case"openai":o="gpt-4o-mini";break;case"google":o="gemini-1.5-flash-latest";break;case"openrouter":o="moonshotai/kimi-k2.5";break;case"claude":o="claude-opus-4-6",Array.isArray(e)&&e.length>0&&(e.some(p=>p&&p.id==="claude-opus-4-6")||(o=e[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(e)&&e.length>0&&(o=e[0].id||"");break}n.querySelector(`option[value="${CSS.escape(o)}"]`)&&(n.value=o)}}let c=document.getElementById("aipkit_task_cc_content_max_tokens");c&&(c.value="4000",c.dispatchEvent(new Event("change",{bubbles:!0})))}window.aipkit_form_setCommentReplyDefaults=k})();(function(){"use strict";function k(a,r,i,s=null){let n=document.getElementById("aipkit_automated_task_form"),c=document.getElementById("aipkit_automated_task_queue_wrapper");if(!n){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),n.reset(),n.elements.task_id&&(n.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),s){let p=((window.aipkit_automated_tasks_config||{}).task_types||{})[s.task_type];if(p){let d=n.elements.task_category;if(d){d.value=p.category;let u=new Event("change",{bubbles:!0});d.dispatchEvent(u)}}}else{let t=n.elements.task_category,p=n.elements.task_type;t&&p&&(t.value="content_creation",t.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{p.value="content_writing_bulk",p.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(n,s):console.error("Show Task Form: aipkit_form_populateCommonFields function is missing.");let l=n.elements.task_type;if(l&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:l}),s){let t=JSON.parse(s.task_config||"{}");s.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(t):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):s.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(t):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):s.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(t):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):s.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(t):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}a&&(a.style.display="block"),r&&(r.style.display="none"),c&&(c.style.display="none"),i&&(i.style.display="none");let o=document.getElementById("aipkit_autogpt_editor_actions");o&&(o.style.display="flex");let e=document.getElementById("aipkit_autogpt_cron_info");e&&(e.style.display="none"),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers()}window.aipkit_form_showAutomatedTaskForm=k})();(function(){"use strict";function k(a,r,i){let s=document.getElementById("aipkit_automated_task_queue_wrapper");a&&(a.style.display="none"),r&&(r.style.display="block"),s&&(s.style.display="block"),i&&(i.style.display="inline-flex");let n=document.getElementById("aipkit_autogpt_editor_actions");n&&(n.style.display="none");let c=document.getElementById("aipkit_autogpt_cron_info");c&&(c.style.display="inline-flex");let l=document.getElementById("aipkit_automated_task_form"),o=document.getElementById("aipkit_automated_task_id"),e=document.getElementById("aipkit_automated_task_category"),t=document.getElementById("aipkit_autogpt_header_title_default"),p=document.getElementById("aipkit_autogpt_header_title_editor"),d=document.getElementById("aipkit_autogpt_title_display"),u=document.getElementById("aipkit_autogpt_task_title_input");l&&l.reset(),o&&(o.value=""),t&&(t.style.display="block"),p&&(p.style.display="none"),d&&(d.style.display="inline-flex"),u&&(u.style.display="none"),e&&(e.value="",e.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=k})();(function(){"use strict";let k=()=>{typeof window.aipkit_updateAutogptPromptPlaceholders=="function"&&window.aipkit_updateAutogptPromptPlaceholders()};function a(n,c,l,o){if(!n||!c)return;n.innerHTML="";let e={content_writing_bulk:{icon:"dashicons-edit"},content_writing_csv:{icon:"dashicons-media-spreadsheet"},content_writing_rss:{icon:"dashicons-rss"},content_writing_url:{icon:"dashicons-admin-links"},content_writing_gsheets:{icon:"dashicons-analytics"}};l.forEach(([t,p])=>{let d=document.createElement("label");d.className="aipkit_cw_mode_card aipkit_autogpt_task_type_card",d.classList.toggle("is-active",t===o);let u=document.createElement("input");u.type="radio",u.name="aipkit_task_type_radio",u.value=t,u.checked=t===o,u.disabled=!!p.disabled,u.className="aipkit_task_type_input",u.addEventListener("change",()=>{u.checked&&(c.value=t,c.dispatchEvent(new Event("change",{bubbles:!0})),n.querySelectorAll(".aipkit_cw_mode_card").forEach(h=>h.classList.remove("is-active")),d.classList.add("is-active"))});let f=e[t]||{},m=document.createElement("span");m.className="aipkit_cw_mode_icon",m.innerHTML=`<span class="dashicons ${f.icon||"dashicons-admin-generic"}"></span>`;let g=document.createElement("span");g.className="aipkit_cw_mode_text";let _=document.createElement("span");_.className="aipkit_cw_mode_title",_.textContent=p.label,g.appendChild(_),p.disabled&&(d.classList.add("is-disabled"),d.setAttribute("aria-disabled","true")),d.appendChild(u),d.appendChild(m),d.appendChild(g),n.appendChild(d)})}function r(n,c){n&&n.querySelectorAll('input[name="aipkit_task_type_radio"]').forEach(l=>{let o=l.value===c;l.checked=o;let e=l.closest(".aipkit_cw_mode_card");e&&e.classList.toggle("is-active",o)})}function i(n){let c=n.target.value,l=document.querySelector(".aipkit_autogpt_form_right"),o=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;if(l){let y=!o&&c==="content_enhancement";l.style.display=y?"none":""}let e=document.getElementById("aipkit_automated_task_type"),t=document.getElementById("aipkit_automated_task_type_group"),p=document.getElementById("aipkit_automated_task_type_radios"),d=(window.aipkit_automated_tasks_config||{}).task_types||{},u=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),f=u.lastTaskTypeByCategory||{};u.lastTaskTypeByCategory=f;let m=window.aipkit_escapeHtml||function(y){return y};e.innerHTML="",e.disabled=!0,t&&(t.style.display="none"),p&&(p.innerHTML="");let g=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(g&&g.querySelectorAll(".aipkit_task_config_section").forEach(y=>{y.id==="aipkit_task_cw_input_modes_wrapper"&&y.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(E=>{E.style.display="none"}),y.style.display="none"}),!c){e.appendChild(new Option(m("-- Select a category first --"),"")),e.dispatchEvent(new Event("change",{bubbles:!0}));return}let _=Object.entries(d).filter(([y,E])=>E.category===c);if(_.length===0)e.appendChild(new Option(m("-- No tasks in this category --"),""));else if(_.length===1){let[y,E]=_[0],x=new Option(m(E.label),y);E.disabled&&(x.disabled=!0),e.appendChild(x),e.value=y,e.disabled=!0,t&&(t.style.display="none")}else e.appendChild(new Option(m("-- Select a Task Type --"),"")),_.forEach(([y,E])=>{let x=new Option(m(E.label),y);E.disabled&&(x.disabled=!0),e.appendChild(x)}),e.disabled=!1;if(_.length>1){let y=f[c];!y&&c==="content_creation"&&(y="content_writing_bulk"),!y&&_.length>0&&e.options.length&&(y=_[0][0]),y&&(e.value=y)}let h=!!p&&_.length>1&&c==="content_creation";t&&(t.style.display=h?"":"none"),p&&(h?a(p,e,_,e.value):p.innerHTML=""),e.dispatchEvent(new Event("change",{bubbles:!0}))}function s(n){let c=n.target.value,l=document.getElementById("aipkit_automated_task_type_radios");r(l,c);let o=document.getElementById("aipkit_automated_task_id"),e=!o||!o.value,t=document.getElementById("aipkit_wizard_next_btn"),p=t?t.querySelector(".aipkit_btn-text"):null,d=document.getElementById("aipkit_save_task_btn"),u=d?d.querySelector(".aipkit_btn-text"):null,f=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,g=((window.aipkit_automated_tasks_config||{}).task_types||{})[c],_=g&&g.pro===!0,h=(window.aipkit_automated_tasks_config||{}).text||{};if(g){let C=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),b=C.lastTaskTypeByCategory||{};b[g.category]=c,C.lastTaskTypeByCategory=b}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(c):console.error("Task Type Change: aipkit_renderWizard function is missing.");let y=document.querySelector(".aipkit_task_schedule_frequency"),E=document.getElementById("aipkit_automated_task_frequency");if(y&&E){let C=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={});c==="content_writing_bulk"||c==="content_writing_csv"?(!C.lastVisibleFrequency&&E.value&&(C.lastVisibleFrequency=E.value),E.value="one-time",y.style.display="none"):(y.style.display="",C.lastVisibleFrequency&&E.value==="one-time"&&(E.value=C.lastVisibleFrequency),C.lastVisibleFrequency=E.value)}let x=document.querySelectorAll("[data-aipkit-task-publishing]");if(x.length){let C=c&&c.startsWith("content_writing");x.forEach(b=>{b.style.display=C?"":"none"})}_&&!f?(p&&t&&(t.dataset.action="next",p.textContent=h.wizard_next_button||"Next",t.style.display="none"),u&&d&&(d.dataset.action="save",u.textContent=h.save_task_button||"Save Task",d.style.display="none")):(p&&t&&(t.dataset.action="next",p.textContent=h.wizard_next_button||"Next",t.style.display=""),u&&d&&(d.dataset.action="save",u.textContent=h.save_task_button||"Save Task",d.style.display=""));let w=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!w){console.error("Task Type Change: Could not find setup pane.");return}let S=w.querySelector("#aipkit_task_ci_source_wrapper"),T=w.querySelector("#aipkit_task_cw_input_modes_wrapper"),v=w.querySelector("#aipkit_task_cc_source_wrapper"),A=w.querySelector("#aipkit_task_ce_content_selection_wrapper");if(S&&(S.style.display="none"),T&&(T.style.display="none"),v&&(v.style.display="none"),A&&(A.style.display="none"),!!c){if(c==="content_indexing")S&&(S.style.display="block");else if(c.startsWith("content_writing")){if(k(),T){T.style.display="block";let C=c.replace("content_writing_",""),b=C==="content_writing"?"bulk":C,L=document.getElementById("aipkit_task_cw_generation_mode");L&&(L.value=b),T.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(B=>{B.id===`aipkit_task_cw_input_mode_${b}`?B.style.display="block":B.style.display="none"})}}else if(c==="community_reply_comments")v&&(v.style.display="block");else if(c==="enhance_existing_content"){A&&(A.style.display="block");let C=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),b=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(C&&b){let L=C.querySelector("#aipkit_task_ce_post_types");if(L&&!L.dataset.placeholderListenerAttached){let B=()=>{let W=Array.from(L.selectedOptions).map(D=>D.value).includes("product");b.querySelectorAll(".aipkit-product-placeholders").forEach(D=>{D.style.display=W?"inline":"none"})};L.addEventListener("change",B),L.dataset.placeholderListenerAttached="true",B()}}}e&&(c.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():c==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():c==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),c==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():c.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():c==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():c==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=i,window.aipkit_form_handleTaskTypeChange=s})();(function(){"use strict";function k(a,r="info"){let i=document.getElementById("aipkit_automated_task_form_status");if(!i)return;let s=i.classList.contains("aipkit_training_status");if(!a){i.textContent="",s?i.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):i.className="aipkit_form-help";return}if(i.textContent=a,s){let n=r==="info"?"loading":r;i.classList.remove("is-success","is-error","is-warning","is-loading"),i.classList.add("is-visible"),n&&i.classList.add(`is-${n}`)}else i.className=`aipkit_form-help aipkit_settings_message-${r}`;setTimeout(()=>{i.textContent===a&&(i.textContent="",s?i.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):i.className="aipkit_form-help")},5e3)}window.aipkit_form_showAutomatedTaskFormStatus=k})();(function(){"use strict";function k(a){let r=new FormData(a),i=Object.fromEntries(r.entries());return i.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:r,data:i}}window.aipkit_save_task_extractBaseData=k})();(function(){"use strict";function k(a,r){if(a.task_type==="content_indexing"){if(a.post_types=r.getAll("post_types[]"),a.target_store_provider=r.get("target_store_provider")||"openai",a.target_store_id=r.get("target_store_id")||"",a.target_store_provider==="pinecone"||a.target_store_provider==="qdrant"){let s=r.get("embedding_model")||"";if(s&&s.includes(":")){let[n,c]=s.split(":",2);a.embedding_provider=n,a.embedding_model=c}else a.embedding_provider="",a.embedding_model=s}else delete a.embedding_provider,delete a.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(s=>delete a[s])}else delete a.post_types,delete a["post_types[]"],delete a.target_store_provider,delete a.target_store_id,delete a.index_existing_now_flag,delete a.only_new_updated_flag,delete a.embedding_model,delete a.embedding_provider;return a}window.aipkit_save_task_handleContentIndexing=k})();(function(){"use strict";function k(a,r){return a.task_type.startsWith("content_writing")?(a.post_categories=r.getAll("post_categories[]"),a.openai_vector_store_ids=r.getAll("openai_vector_store_ids[]"),delete a["post_categories[]"],delete a["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(s=>delete a[s]),delete a.replicate_api_key,delete a.pexels_api_key,delete a.pixabay_api_key):(delete a.content_title,delete a.content_title_bulk,delete a.content_keywords,delete a.content_length,delete a.ai_temperature,delete a.post_type,delete a.post_author,delete a.post_status,delete a["post_categories[]"],delete a.post_categories,delete a.prompt_mode,delete a.custom_title_prompt,delete a.custom_content_prompt,delete a.generate_meta_description,delete a.custom_meta_prompt,delete a.generate_focus_keyword,delete a.custom_keyword_prompt,delete a.cw_generation_mode,delete a.rss_feeds,delete a.gsheets_sheet_id,delete a.gsheets_credentials,delete a.url_list,delete a.generate_toc,delete a.generate_images_enabled,delete a.image_provider,delete a.image_model,delete a.image_prompt,delete a.image_count,delete a.image_placement,delete a.image_placement_param_x,delete a.image_alignment,delete a.image_size,delete a.generate_featured_image,delete a.featured_image_prompt,delete a.pexels_orientation,delete a.pexels_size,delete a.pexels_color,delete a.pexels_api_key,delete a.pixabay_orientation,delete a.pixabay_image_type,delete a.pixabay_category,delete a.pixabay_api_key,delete a.replicate_api_key,delete a.enable_vector_store,delete a.vector_store_provider,delete a["openai_vector_store_ids[]"],delete a.openai_vector_store_ids,delete a.pinecone_index_name,delete a.qdrant_collection_name,delete a.vector_embedding_provider,delete a.vector_embedding_model,delete a.vector_store_top_k,delete a.rss_include_keywords,delete a.rss_exclude_keywords),a}window.aipkit_save_task_handleContentWriting=k})();(function(){"use strict";function k(a){let i=(window.aipkit_automated_tasks_config||{}).text||{};if(!a.task_name)return i.task_name_required||"Task name is required.";if(!a.task_category)return i.task_category_required||"Task category is required.";if(!a.task_type)return i.task_type_required||"Task type is required.";if(a.task_type==="content_indexing"){if(!a.target_store_id)return i.target_store_required||"A target vector store/index must be selected.";if(!a.post_types||a.post_types.length===0)return i.content_type_required||"Please select content types for indexing.";if(a.target_store_provider==="pinecone"||a.target_store_provider==="qdrant"){if(!a.embedding_provider)return i.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!a.embedding_model)return i.embedding_model_required||"Embedding model is required for this vector provider."}}if(a.task_type.startsWith("content_writing")){let s=a.cw_generation_mode||"bulk";if(s==="bulk"){if(!a.content_title_bulk?.trim())return i.content_title_required_cw_task||"At least one topic is required for Bulk mode."}else if(s==="csv"){if(!a.content_title?.trim())return i.csv_required_cw_task||"Please upload a CSV file."}else{if(s==="rss"&&!a.rss_feeds?.trim())return i.rss_required_cw_task||"Please add at least one RSS feed.";if(s==="url"&&!a.url_list?.trim())return i.url_required_cw_task||"Please add at least one URL.";if(s==="gsheets"){if(!a.gsheets_sheet_id?.trim())return i.gsheets_id_required_cw_task||"Please add a Google Sheet ID.";if(!a.gsheets_credentials?.trim())return i.gsheets_credentials_required_cw_task||"Please add Google Sheets credentials."}else if(s==="single"&&!a.content_title?.trim())return i.content_title_required_cw_task||"Please add a topic."}if(!a.custom_content_prompt?.trim())return"The Content Prompt cannot be empty.";if(!a.ai_provider||!a.ai_model)return i.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}if(a.task_type==="enhance_existing_content"){if(!a.post_types||a.post_types.length===0)return"Please select at least one post type to update.";if(a.update_title!=="1"&&a.update_excerpt!=="1"&&a.update_content!=="1"&&a.update_meta!=="1")return"Please select at least one field to update (Title, Excerpt, Content, or Meta Description)."}return!0}window.aipkit_save_task_validateData=k})();(function(){"use strict";async function k(a){let r=window.aipkit_automated_tasks_config||{},i={...a,_ajax_nonce:r.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",i)}window.aipkit_save_task_submitRequest=k})();(function(){"use strict";function k(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=k})();(function(){"use strict";async function k(a){if(a.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let r=a.target,i=document.getElementById("aipkit_save_task_btn");if(i&&i.dataset.action==="upgrade"){let c=window.aipkit_dashboard?.upgradeUrl;c?window.open(c,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let s=(window.aipkit_automated_tasks_config||{}).text||{},n=s.save_task_button||"Save Task";try{let{formData:c,data:l}=window.aipkit_save_task_extractBaseData(r),o;l.task_type==="content_indexing"?o=window.aipkit_save_task_handleContentIndexing(l,c):l.task_type.startsWith("content_writing")?o=window.aipkit_save_task_handleContentWriting(l,c):l.task_type==="enhance_existing_content"?o=window.aipkit_save_task_handleContentEnhancement(l,c):o=l;let e=window.aipkit_save_task_validateData(o);if(e!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(e,"error"),new Error("Validation failed: "+e);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,n,s.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(s.saving_task||"Saving task...","info");let t=await window.aipkit_save_task_submitRequest(o);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(t.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(c){console.error("Save Task Error:",c),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&c.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${c.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,n)}}window.aipkit_form_handleSaveTask=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_automated_task_form"),r=document.getElementById("aipkit_autogpt_task_status_toggle"),i=document.getElementById("aipkit_autogpt_task_status_input"),s=document.getElementById("aipkit_autogpt_task_status_label"),n=document.getElementById("aipkit_autogpt_task_status_card"),c=document.getElementById("aipkit_automated_task_category"),l=document.querySelector("[data-aipkit-autogpt-category-selector]"),o=l?Array.from(l.querySelectorAll(".aipkit_cw_mode_card")):[],e=document.getElementById("aipkit_automated_task_type"),t=document.getElementById("aipkit_cancel_edit_task_btn"),p=document.getElementById("aipkit_automated_task_form_wrapper"),d=document.getElementById("aipkit_automated_task_list_wrapper"),u=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),a&&typeof window.aipkit_form_handleSaveTask=="function"?a.addEventListener("submit",window.aipkit_form_handleSaveTask):a&&console.error("Automated Task Form Init: handleSaveTask function not found."),c&&typeof window.aipkit_form_handleCategoryChange=="function"?c.addEventListener("change",window.aipkit_form_handleCategoryChange):c&&console.error("Automated Task Form Init: handleCategoryChange function not found.");let f=g=>{o.length&&o.forEach(_=>{let h=_.dataset.category===g;_.classList.toggle("is-active",h),_.setAttribute("aria-pressed",h?"true":"false")})};c&&o.length&&(o.forEach(g=>{g.addEventListener("click",()=>{let _=g.dataset.category||"";!_||_===c.value||(c.value=_,c.dispatchEvent(new Event("change",{bubbles:!0})))})}),c.addEventListener("change",()=>{f(c.value)}),f(c.value||"")),e&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(e.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:e})):e&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),t&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?t.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(p,d,u)}):t&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI();let m=()=>{if(!r||!i||!s)return;let g=(i.value||"active")==="active";r.checked=g,s.textContent=g?"Active":"Paused",n&&(n.dataset.status=g?"active":"paused")};window.aipkit_syncTaskStatusToggle=m,r&&i&&s&&(r.dataset.statusListenerAttached||(r.addEventListener("change",()=>{i.value=r.checked?"active":"paused",m()}),r.dataset.statusListenerAttached="true"),m())}window.aipkit_form_initAutomatedTaskForm=k})();(function(){"use strict";let k=!1,a=null,r=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return k},set isSubmitting(s){k=s},get pendingModelSelection(){return a},set pendingModelSelection(s){a=s},get pendingEmbeddingModelSelection(){return r},set pendingEmbeddingModelSelection(s){r=s}};function i(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=i})();(function(){"use strict";function k(a,r){a&&(a.classList.toggle("aipkit_loading",!!r),a.disabled=!!r)}window.aipkit_setAutogptActionButtonLoading=k})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_config||{},s=i.text||{},n=window.aipkit_escapeHtml||function(t){return t},c=window.aipkit_ucfirst||function(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""},l=i.frequencies||{},o=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(t=>{t.removeAttribute("data-sort-direction"),o&&t.dataset.sortBy===o.sortBy&&t.setAttribute("data-sort-direction",o.sortOrder.toLowerCase())}),!r){console.warn("Render Tasks Table: Table body not found.");return}if(r.innerHTML="",!a||a.length===0){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${s.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}a.forEach(t=>{let p=JSON.parse(t.task_config||"{}"),d=r.insertRow(),u=d.insertCell();u.textContent=n(t.task_name);let f=d.insertCell(),g=(i.task_types?.[t.task_type]||{}).label||c(t.task_type.replace(/_/g," "));f.innerHTML=`<span class="aipkit_task_type_badge" data-type="${n(t.task_type)}">${n(g)}</span>`;let _=p.indexing_frequency||p.task_frequency||"N/A",h=l[_]||c(_.replace(/_/g," "));d.insertCell().textContent=n(h);let y=d.insertCell();y.innerHTML=`<span class="aipkit_job_status_${n(t.status)}">${n(c(t.status))}</span>`;let E=d.insertCell(),x=t.last_run_time?new Date(t.last_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):s.never_run||"Never",w=t.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(t.next_run_time):t.next_run_time?new Date(t.next_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):s.not_scheduled||"Not Scheduled";E.innerHTML=`
        <div class="aipkit_task_timing">
          <div class="aipkit_task_timing_last">
            <span class="aipkit_task_timing_label">${s.last_label||"Last"}</span>
            <span class="aipkit_task_timing_value${t.last_run_time?"":" aipkit_never"}">${n(x)}</span>
          </div>
          <div class="aipkit_task_timing_next">
            <span class="aipkit_task_timing_label">${s.next_label||"Next"}</span>
            <span class="aipkit_task_timing_value">${n(w)}</span>
          </div>
        </div>
      `;let S=d.insertCell();S.className="aipkit_actions_cell",S.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="edit" data-task-id="${t.id}" title="${s.edit_button||"Edit"}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${s.edit_button||"Edit"}</span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="${t.status==="active"?"pause":"resume"}" data-task-id="${t.id}" title="${t.status==="active"?s.pause_button||"Pause":s.resume_button||"Resume"}">
            <span class="dashicons ${t.status==="active"?"dashicons-controls-pause":"dashicons-controls-play"}" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${t.status==="active"?s.pause_button||"Pause":s.resume_button||"Resume"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="run_now" data-task-id="${t.id}" ${t.status!=="active"?"disabled":""} title="${t.status!=="active"?s.task_not_active_run_title||"Task must be active to run":s.run_now_button||"Run Now"}">
            <span class="dashicons dashicons-controls-skipforward" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${s.run_now_button||"Run"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete" data-task-id="${t.id}" title="${s.delete_button||"Delete"}">
            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
          </button>
        </div>
      `})}window.aipkit_list_renderTasksTable=k})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_automated_task_list_pagination"),s=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render List Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:n,total_pages:c,current_page:l}=a||{};if(!c||c<=1){n>0&&(r.innerHTML=`<span class="aipkit_pagination-count">${Number(n).toLocaleString()} ${Number(n)===1?s.task_singular||"task":s.task_plural||"tasks"}</span>`);return}let o=document.createElement("span");o.className="aipkit_pagination-count",o.textContent=`${Number(n).toLocaleString()} ${Number(n)===1?s.task_singular||"task":s.task_plural||"tasks"}`,r.appendChild(o);let e=document.createElement("span");e.className="aipkit_pagination-links";let t=document.createElement("button");t.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",t.innerHTML=`\xAB ${s.previous_button||"Previous"}`,t.disabled=Number(l)<=1,t.disabled||(t.dataset.page=Number(l)-1),e.appendChild(t);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${s.page_label||"Page"} ${Number(l)} ${s.of_label||"of"} ${Number(c)}`,e.appendChild(p);let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",d.innerHTML=`${s.next_button||"Next"} \xBB`,d.disabled=Number(l)>=Number(c),d.disabled||(d.dataset.page=Number(l)+1),e.appendChild(d),r.appendChild(e)}window.aipkit_list_renderListPagination=k})();(function(){"use strict";async function k(a=1){let r=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_list_state,s=window.aipkit_automated_tasks_config||{},n=s.text||{};if(!r){console.warn("Fetch Tasks: Table body not found.");return}r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${n.loading_tasks||"Loading tasks..."}</td></tr>`,i&&(i.page=a);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let c={page:a,search:i?i.search:"",orderby:i?i.sortBy:"created_at",order:i?i.sortOrder:"DESC",_ajax_nonce:s.nonce_manage_tasks},l=await window.aipkit_apiRequest("aipkit_get_automated_tasks",c);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=l.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(l.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(l.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(c){console.error("Fetch Tasks Error:",c),r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${n.error_loading_tasks||"Error loading tasks:"} ${c.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=k})();(function(){"use strict";function k(a){if(!a){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),a):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=k})();(function(){"use strict";async function k(a,r){let i=window.aipkit_automated_tasks_config||{},s=i.text||{},n=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!0,s.delete_button||"Delete",s.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:r,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(s.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(l){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${s.error_deleting_task||"Error deleting task:"} ${l.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(a,!1,s.delete_button||"Delete")}},c=s.confirm_delete_task||"Are you sure you want to delete this task?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(c,{title:s.confirm_title||"Confirm",confirmText:s.delete_button||"Delete",cancelText:s.cancel_button||"Cancel",onConfirm:()=>{n()}});return}confirm(c)&&await n()}window.aipkit_handleDeleteTaskAction=k})();(function(){"use strict";async function k(a,r,i){let s=window.aipkit_automated_tasks_config||{},n=s.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(a,!0):(a.classList.add("aipkit_loading"),a.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:r,status:i,_ajax_nonce:s.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${n.task_status_updated||"Task status updated to"} ${i}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${n.error_updating_status||"Error updating task status:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(a,!1):(a.classList.remove("aipkit_loading"),a.disabled=!1)}}window.aipkit_handleToggleTaskStatusAction=k})();(function(){"use strict";async function k(a,r){let i=window.aipkit_automated_tasks_config||{},s=i.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(a,!0):(a.classList.add("aipkit_loading"),a.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:r,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(s.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(n){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${s.error_initiating_run||"Error initiating task run:"} ${n.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(a,!1):(a.classList.remove("aipkit_loading"),a.disabled=!1)}}window.aipkit_handleRunNowTaskAction=k})();(function(){"use strict";async function k(a){let r=a.target.closest("button[data-action]");if(!r)return;let i=r.dataset.action,s=r.dataset.taskId;if(!s)return;let c=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(l=>l.id.toString()===s.toString());switch(i){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(c);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(r,s);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let l=i==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(r,s,l)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(r,s);break;default:console.warn(`Unknown task action: ${i}`);break}}window.aipkit_list_handleTaskActionClick=k})();(function(){"use strict";function k(a){let r=a.target.closest("button[data-page]");if(r&&!r.disabled){let i=parseInt(r.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(i):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=k})();(function(){"use strict";function k(a,r="info"){if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(a,r);return}let i=document.getElementById("aipkit_automated_task_form_status");i&&(i.textContent=a,i.className=`aipkit_form-help aipkit_settings_message-${r}`,setTimeout(()=>{i.textContent===a&&(i.textContent="",i.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_automated_task_list_wrapper"),r=document.getElementById("aipkit_automated_tasks_tbody"),i=document.getElementById("aipkit_add_new_task_btn"),s=document.getElementById("aipkit_automated_task_form_wrapper"),n=document.getElementById("aipkit_automated_task_list_pagination"),c=document.getElementById("aipkit_task_list_search_input"),l=a?a.querySelector(".aipkit_data-table"):null;if(i&&s&&a&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&i.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(s,a,i)}),r&&typeof window.aipkit_list_handleTaskActionClick=="function"&&r.addEventListener("click",window.aipkit_list_handleTaskActionClick),n&&typeof window.aipkit_list_handleListPaginationClick=="function"&&n.addEventListener("click",window.aipkit_list_handleListPaginationClick),c){let o;c.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(()=>{let e=window.aipkit_automated_tasks_list_state;e&&(e.search=c.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}l&&l.addEventListener("click",o=>{let e=o.target.closest("th.aipkit-sortable-col");if(!e)return;let t=e.dataset.sortBy,p=window.aipkit_automated_tasks_list_state;if(!p)return;let d="DESC";p.sortBy===t&&(d=p.sortOrder==="DESC"?"ASC":"DESC"),p.sortBy=t,p.sortOrder=d,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=k})();(function(){"use strict";let k=[],a=1,r="",i="created_at",s="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...k]},set tasks(c){k=Array.isArray(c)?c:[]},get page(){return a},set page(c){a=c},get search(){return r},set search(c){r=c},get sortBy(){return i},set sortBy(c){i=c},get sortOrder(){return s},set sortOrder(c){s=c}};function n(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=n})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_automated_task_queue_tbody"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),s=window.aipkit_automated_tasks_config||{},n=s.text||{},c=window.aipkit_escapeHtml||function(p){return p},l=window.aipkit_ucfirst||function(p){return p?p.charAt(0).toUpperCase()+p.slice(1):""},o=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(p=>{p.removeAttribute("data-sort-direction"),o&&p.dataset.sortBy===o.sortBy&&p.setAttribute("data-sort-direction",o.sortOrder.toLowerCase())}),!r){console.warn("Render Queue Table: Table body not found.");return}r.innerHTML="";let t=Array.isArray(a)&&a.length>0;if(i&&(i.disabled=!t,i.setAttribute("aria-disabled",t?"false":"true"),t?i.title=n.delete_filtered_title||"Delete filtered items":i.title=n.queue_empty_delete||"No queue items available to delete."),!t){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${n.queue_empty||"Task queue is currently empty."}</td></tr>`;return}a.forEach(p=>{let d=r.insertRow(),u=d.insertCell(),f=document.createElement("textarea");f.innerHTML=p.target_title||`${n.target_id_prefix||"ID:"} ${p.target_identifier}`;let m=f.value,g=p.task_type.startsWith("content_writing"),_=p.task_type==="enhance_existing_content",h=null;g&&p.status==="completed"&&p.generated_post_id?h=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${p.generated_post_id}&action=edit`:_&&!isNaN(parseInt(p.target_identifier,10))&&(h=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${p.target_identifier}&action=edit`),h?u.innerHTML=`<a href="${h}" target="_blank" title="${c(n.edit_generated_post_title||"View post")}">${c(m)}</a>`:u.textContent=m,d.insertCell().textContent=c(p.task_name||`${n.task_id_prefix||"Task"} ${p.task_id}`);let y=d.insertCell(),E=s.task_types&&s.task_types[p.task_type]?s.task_types[p.task_type].label:l(p.task_type.replace(/_/g," "));y.innerHTML=`<span class="aipkit_task_type_badge" data-type="${c(p.task_type)}">${c(E)}</span>`;let x=d.insertCell(),w=`<span class="aipkit_job_status_${c(p.status)}">${c(l(p.status))}`;p.status==="failed"&&p.attempts>1&&(w+=` <small>(${p.attempts}x)</small>`),w+="</span>",p.status==="failed"&&p.error_message&&(w+=`<span class="aipkit_queue_error_message" title="${c(p.error_message)}">${c(p.error_message)}</span>`),x.innerHTML=w;let S=d.insertCell();if(p.added_at){let A=new Date(p.added_at.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),C=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(p.added_at):A,b=`<div class="aipkit_queue_time_entry aipkit_queue_time_added" title="${c(A)}">${c(C)}</div>`;if(p.scheduled_gmt_time){let L=new Date(p.scheduled_gmt_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(p.scheduled_gmt_time):L;b+=`<div class="aipkit_queue_time_entry aipkit_queue_time_scheduled" title="${c(L)}">${c(n.scheduled_for_label||"\u2192")} ${c(B)}</div>`}S.innerHTML=b}else S.textContent=n.not_applicable||"\u2014";let T=d.insertCell();T.className="aipkit_actions_cell";let v='<div class="aipkit-table-actions-group">';p.status==="failed"&&(v+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="retry_queue_item" data-item-id="${p.id}" title="${n.retry_button||"Retry"}"><span class="dashicons dashicons-controls-repeat" aria-hidden="true"></span><span class="aipkit_btn_label">${n.retry_button||"Retry"}</span></button>`),v+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete_queue_item" data-item-id="${p.id}" title="${n.delete_button||"Delete"}"><span class="dashicons dashicons-trash" aria-hidden="true"></span></button>`,v+="</div>",T.innerHTML=v})}window.aipkit_queue_renderQueueTable=k})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_automated_task_queue_pagination"),s=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render Queue Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:n,total_pages:c,current_page:l}=a||{};if(!n||n<=0)return;let o=document.createElement("span");if(o.className="aipkit_pagination-count",o.textContent=`${Number(n).toLocaleString()} ${Number(n)===1?s.item_singular||"item":s.item_plural||"items"}`,r.appendChild(o),c>1){let e=document.createElement("span");e.className="aipkit_pagination-links";let t=document.createElement("button");t.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",t.innerHTML=`\xAB ${s.previous_button||"Previous"}`,t.disabled=Number(l)<=1,t.disabled||(t.dataset.page=Number(l)-1),e.appendChild(t);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${s.page_label||"Page"} ${Number(l)} ${s.of_label||"of"} ${Number(c)}`,e.appendChild(p);let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",d.innerHTML=`${s.next_button||"Next"} \xBB`,d.disabled=Number(l)>=Number(c),d.disabled||(d.dataset.page=Number(l)+1),e.appendChild(d),r.appendChild(e)}}window.aipkit_queue_renderQueuePagination=k})();(function(){"use strict";async function k(a=1){let r=window.aipkit_automated_tasks_queue_state;r?r.page=a:console.warn("Fetch/Render Queue: Queue state object not available.");let i=document.getElementById("aipkit_automated_task_queue_tbody"),s=window.aipkit_automated_tasks_config||{},n=s.text||{};if(!i){console.warn("Fetch/Render Queue: Table body not found.");return}i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${n.loading_queue||"Loading queue items..."}</td></tr>`;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let c={page:a,search:r?r.search:"",status_filter:r?r.status:"all",orderby:r?r.sortBy:"q.added_at",order:r?r.sortOrder:"DESC",_ajax_nonce:s.nonce_manage_tasks},l=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",c);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(l.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(l.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(c){console.error("Fetch/Render Queue Error:",c),i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${n.error_loading_queue||"Error loading queue:"} ${c.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=k})();(function(){"use strict";async function k(a){let r=a.target.closest("button[data-action]");if(!r)return;let i=r.dataset.action,s=r.dataset.itemId;if(!s)return;let n=window.aipkit_automated_tasks_config||{},c=n.text||{},l=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1,o=(e,t)=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(e,t);return}typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e,t)};if(i==="delete_queue_item"){let e=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,c.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:s,_ajax_nonce:n.nonce_manage_tasks}),o(c.queue_item_deleted||"Queue item deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(l)}catch(p){o(`${c.error_deleting_queue_item||"Error deleting item:"} ${p.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,c.delete_button||"Delete")}},t=c.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(t,{title:c.confirm_title||"Confirm",confirmText:c.delete_button||"Delete",cancelText:c.cancel_button||"Cancel",onConfirm:()=>{e()}});return}if(!confirm(t))return;await e()}else if(i==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,c.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:s,_ajax_nonce:n.nonce_manage_tasks}),o(c.item_marked_retry||"Item marked for retry. Queue processing will pick it up.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(l)}catch(e){o(`${c.error_retrying_item||"Error retrying item:"} ${e.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,c.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=k})();(function(){"use strict";async function k(){let a=document.getElementById("aipkit_delete_queue_by_status_btn"),r=document.getElementById("aipkit_task_queue_status_filter");if(!a||!r){console.error("Delete by status button or filter dropdown not found.");return}let i=r.value,s=r.options[r.selectedIndex].text.toLowerCase(),n=window.aipkit_automated_tasks_config||{},c=n.text||{},l=i==="all"?c.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(c.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",s),o=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(a,!0,c.delete_button||"Delete",c.deleting_task||"Deleting..."):a.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let e=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:i,_ajax_nonce:n.nonce_manage_tasks});typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(e.message||"Queue items deleted.","success"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.message||"Queue items deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(e){let t=`${c.errorDeletingAllItems||"Error deleting items:"} ${e.message||"Unknown error"}`;typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(t,"error"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(t,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(a,!1,c.delete_button||"Delete"):a.disabled=!1}};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(l,{title:c.confirm_title||"Confirm",confirmText:c.delete_button||"Delete",cancelText:c.cancel_button||"Cancel",onConfirm:()=>{o()}});return}confirm(l)&&await o()}window.aipkit_handleDeleteQueueByStatus=k})();(function(){"use strict";function k(a){let r=a.target.closest("button[data-page]");if(r&&!r.disabled){let i=parseInt(r.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(i):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_automated_task_queue_tbody"),r=document.getElementById("aipkit_refresh_task_queue_btn"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),s=document.getElementById("aipkit_automated_task_queue_pagination"),n=document.getElementById("aipkit_task_queue_search_input"),c=document.getElementById("aipkit_task_queue_status_filter"),l=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(r&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&r.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),i&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&i.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),n){let o;n.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(()=>{let e=window.aipkit_automated_tasks_queue_state;e&&(e.search=n.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}c&&c.addEventListener("change",()=>{let o=window.aipkit_automated_tasks_queue_state;o&&(o.status=c.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),l&&l.addEventListener("click",o=>{let e=o.target.closest("th.aipkit-sortable-col");if(!e)return;let t=e.dataset.sortBy,p=window.aipkit_automated_tasks_queue_state;if(!p)return;let d="DESC";p.sortBy===t&&(d=p.sortOrder==="DESC"?"ASC":"DESC"),p.sortBy=t,p.sortOrder=d,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),a&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&a.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),s&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&s.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=k})();(function(){"use strict";let k=1,a="",r="all",i="q.added_at",s="DESC";window.aipkit_automated_tasks_queue_state={get page(){return k},set page(c){k=c},get search(){return a},set search(c){a=c},get status(){return r},set status(c){r=c},get sortBy(){return i},set sortBy(c){i=c},get sortOrder(){return s},set sortOrder(c){s=c}};function n(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=n})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_autogpt_container");if(a&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():a&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),(()=>{if(!a)return;let i=a.querySelector("#aipkit_autogpt_cron_status [data-aipkit-cron-timestamp]");if(!i)return;let s=i.dataset.aipkitCronTimestamp,n=s?parseInt(s,10):0;if(!n||Number.isNaN(n))return;let c=new Date(n*1e3),l=c.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});i.textContent=l,i.title=c.toLocaleString()})(),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(i){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",i)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.");if(typeof window.aipkit_initAutogptPopovers=="function")try{window.aipkit_initAutogptPopovers(a)}catch(i){console.error("AIPKit AutoGPT: Error initializing settings popovers:",i)}if(typeof window.aipkit_updateAutogptAiSummaries=="function")try{window.aipkit_updateAutogptAiSummaries(a)}catch(i){console.error("AIPKit AutoGPT: Error updating AI summaries:",i)}if(typeof window.aipkit_initAutogptAiSettingsRedesigned=="function")try{window.aipkit_initAutogptAiSettingsRedesigned(a)}catch(i){console.error("AIPKit AutoGPT: Error initializing AI settings UI:",i)}if(typeof window.aipkit_initAutogptPromptFlyouts=="function")try{window.aipkit_initAutogptPromptFlyouts(a)}catch(i){console.error("AIPKit AutoGPT: Error initializing prompt flyouts:",i)}typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_autogpt_container"):console.warn("AIPKit AutoGPT: aipkit_initApiKeyToggles not found.")}window.aipkit_initAutogpt=k})();(function(){"use strict";let k=null;function a(l,o="",e=0){let t=document.getElementById("aipkit_content_writer_form_status");if(!t)return;k&&(clearTimeout(k),k=null);let p="aipkit_cw_status_badge",d=(u="")=>{t.className=u?`${p} ${u}`:p};switch(d(),l){case"progress":t.textContent=o,d("aipkit_settings_message-info");break;case"info":t.textContent=o,d("aipkit_settings_message-info");break;case"success":t.textContent=o,d("aipkit_settings_message-success");break;case"error":t.textContent=o,d("aipkit_settings_message-error");break;case"clear":default:t.textContent="",d();return}e&&(k=setTimeout(()=>{t.textContent===o&&r()},e))}function r(){a("clear")}function i(l){a("progress",l)}function s(l,o=3e3){a("info",l,o)}function n(l){a("success",l,3e3)}function c(l){a("error",l)}window.aipkit_updateGeneralStatus=a,window.aipkit_clearGeneralStatus=r,window.aipkit_showProgress=i,window.aipkit_showInfo=s,window.aipkit_showSuccess=n,window.aipkit_showError=c})();(function(){"use strict";window.aipkit_cw_isAutosaving=!1,window.aipkit_cw_lastSavedData=null;function k(){let s=window.aipkit_cw_template_state,n=s?.currentTemplateId;if(!n)return null;let c="";if(Array.isArray(s?.currentTemplates)){let o=s.currentTemplates.find(e=>String(e.id)===String(n));o?.template_name&&(c=o.template_name)}if(!c){let o=document.getElementById("aipkit_cw_template_select");o?.selectedOptions?.length&&(c=o.selectedOptions[0].textContent.trim())}let l=parseInt(n,10);return!c||Number.isNaN(l)?null:{id:l,name:c}}function a(){if(typeof window.aipkit_getContentWriterFormConfig!="function")return null;let s=document.getElementById("aipkit_content_writer_form");return s?window.aipkit_getContentWriterFormConfig(s):null}async function r(){if(window.aipkit_cw_autosave_suspended||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getContentWriterFormConfig!="function"||window.aipkit_cw_isAutosaving)return;let s=window.aipkit_cw_template_state;if(s?.isSavingOrDeleting)return;let n=a();if(!n)return;let c=window.aipkit_cw_lastSavedData||{};if(JSON.stringify(n)===JSON.stringify(c))return;let l=k();if(!l)return;let o=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,e=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,t=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_isAutosaving=!0,o&&o("Saving...");try{let p=document.getElementById("aipkit_content_writer_template_nonce_field");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:l.id,template_name:l.name,template_type:"content_writer",config:JSON.stringify(n),_ajax_nonce:p?p.value:""}),window.aipkit_cw_lastSavedData=n,s&&(s.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(n)),s.currentTemplateModified=!1),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(String(l.id)),e&&e("Updated")}catch(p){t&&t(`Error: ${p.message||"Failed to save."}`),console.error("Content Writer Auto-Save Error:",p)}finally{window.aipkit_cw_isAutosaving=!1}}function i(){let s=a();s&&(window.aipkit_cw_lastSavedData=s)}window.aipkit_handleContentWriterAutoSave=r,window.aipkit_updateContentWriterAutosaveBaseline=i})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_content_writer_form");if(!a)return;let r="data-aipkit-cw-autosave-attached";a.getAttribute(r)||(a.addEventListener("change",i=>{let s=i.target;if(!s||!s.matches(".aipkit_autosave_trigger"))return;(s.tagName.toLowerCase()==="select"||s.type==="checkbox"||s.type==="range")&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()}),a.addEventListener("blur",i=>{let s=i.target;if(!s||!s.matches(".aipkit_autosave_trigger"))return;let n=s.tagName.toLowerCase();(n==="input"||n==="textarea")&&s.type!=="range"&&s.type!=="checkbox"&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()},!0),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline(),a.setAttribute(r,"true"))}window.aipkit_initContentWriterAutosave=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.warn("Content Writer Accordions: Main container not found.");return}a.dataset.accordionListenerAttached!=="true"&&(a.addEventListener("click",function(r){let i=r.target.closest(".aipkit_accordion-header");if(!i)return;let s=i.closest(".aipkit_accordion");if(!s)return;let n=i.nextElementSibling;if(!n||!n.classList.contains("aipkit_accordion-content"))return;let c=s.closest(".aipkit_accordion-group");if(c&&!i.classList.contains("aipkit_active")){let l=c.querySelector(".aipkit_accordion-header.aipkit_active");if(l){l.classList.remove("aipkit_active");let o=l.nextElementSibling;o&&o.classList.remove("aipkit_active")}}i.classList.toggle("aipkit_active"),n.classList.toggle("aipkit_active")}),a.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(l){return l},a=null,r={title:"Title",content:"Content",image:"Image",meta:"Meta",keyword:"Keyword",tags:"Tags",excerpt:"Excerpt"},i=null;function s(l,o=""){if(a||(a=document.getElementById("aipkit_content_writer_form_status")),!a)return;i&&(clearTimeout(i),i=null),a.textContent=l;let e="aipkit_cw_status_badge";a.className=o?`${e} ${o}`:e}function n(l,o,e=""){let t=r[l]||"Step",p=e?k(e):"";switch(o){case"pending":break;case"generating":s(p||`Generating ${t}...`,"aipkit_settings_message-info");break;case"success":s(`${t} complete`,"aipkit_settings_message-success"),i=setTimeout(()=>{s("")},1400);break;case"error":s(`Error ${t}${p?": "+p:""}`,"aipkit_settings_message-error");break;case"skipped":p&&(s(`${t} skipped: ${p}`,"aipkit_settings_message-info"),i=setTimeout(()=>{s("")},1400));break}let d=document.getElementById(`aipkit_cw_status_${l}_generation`),u=d?d.querySelector(".aipkit_cw_status_icon"):null,f=d?d.querySelector(".status-text"):null;if(!(!d||!u||!f))switch(d.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),d.classList.add(`status-${o}`),o){case"pending":{f.textContent="Pending";let m="dashicons-text-page";l==="content"&&(m="dashicons-admin-post"),l==="image"&&(m="dashicons-format-image"),l==="excerpt"&&(m="dashicons-editor-quote"),l==="tags"&&(m="dashicons-tag"),l==="meta"&&(m="dashicons-search"),l==="keyword"&&(m="dashicons-flag"),u.className=`dashicons ${m} aipkit_cw_status_icon`;break}case"generating":f.textContent=p||"Generating...",u.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":f.textContent="Complete",u.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":f.textContent=`Error ${p?": "+p:""}`,u.className="dashicons dashicons-warning aipkit_cw_status_icon";break;case"skipped":f.textContent="Skipped",u.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function c(){s(""),["title","content","image","meta","keyword","excerpt","tags"].forEach(l=>{n(l,"pending")})}window.aipkit_updateCwGenerationStatus=n,window.aipkit_resetAllGenerationStatuses=c})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_content_writer_form_status");a&&(a.textContent="",a.className="aipkit_cw_status_badge"),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending"))}window.aipkit_resetGenerationStatusIndicators=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(p){return p},a=window.aipkit_escapeHtml||function(p){return p},r=(p,d)=>(p?.elements?.[d]?.value||"").trim(),i=p=>String(p||"").split(/\r?\n/).map(d=>d.trim()).filter(Boolean),s=p=>p.map(d=>d.split("|")[0].trim()).filter(Boolean),n=p=>{try{let d=new URL(p);return d.protocol==="http:"||d.protocol==="https:"}catch{return!1}},c=p=>{let d=p?.querySelector(".aipkit_gsheets_indicator");return d?d.classList.contains("aipkit_gsheets_indicator--success"):!0};function l(p,d){p&&(p.textContent=d||k("Please review your input.","gpt3-ai-content-generator"),p.id==="aipkit_cw_action_validation"?p.className="aipkit_cw_action_validation":p.className="aipkit_cw_status_badge aipkit_settings_message-error")}function o(p){p&&(p.textContent="",p.id==="aipkit_cw_action_validation"?p.className="aipkit_cw_action_validation":p.className="aipkit_cw_status_badge")}function e(p,d){let u=d||document.getElementById("aipkit_cw_mode_select")?.value||"task";if(u==="single"&&(u="task"),u==="task")return s(i(r(p,"content_title_bulk"))).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one topic.","gpt3-ai-content-generator")};if(u==="csv"){let f=document.getElementById("aipkit_cw_csv_data_holder");return(f?f.value.trim():"")?{isValid:!0}:{isValid:!1,message:k("Please upload and parse a CSV file first.","gpt3-ai-content-generator")}}if(u==="rss")return i(r(p,"rss_feeds")).filter(n).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid RSS feed URL.","gpt3-ai-content-generator")};if(u==="url")return i(r(p,"url_list")).filter(n).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid website URL.","gpt3-ai-content-generator")};if(u==="gsheets"){let f=r(p,"gsheets_sheet_id"),m=r(p,"gsheets_credentials");return!f||!m?{isValid:!1,message:k("Please provide a Google Sheet ID and credentials.","gpt3-ai-content-generator")}:c(p)?{isValid:!0}:{isValid:!1,message:k("Verify access before generating.","gpt3-ai-content-generator")}}return{isValid:!0}}async function t(p,d,u){let f=new FormData(p),m=Object.fromEntries(f.entries()),g=p.elements["openai_vector_store_ids[]"];m.openai_vector_store_ids=g?Array.from(g.selectedOptions).map(T=>T.value):[],delete m["openai_vector_store_ids[]"];let _=window.aipkit_dashboard?.text||{},h=document.getElementById("aipkit_cw_mode_select"),y=h?h.value:"task";y==="single"&&(y="task"),m.cw_generation_mode=y;let E=document.getElementById("aipkit_cw_action_validation"),x=e(p,y);if(!x.isValid){let T=u||E;l(T,x.message),T!==E&&o(E);return}if(o(u),o(E),y==="csv"){let T=document.getElementById("aipkit_cw_csv_data_holder");m.content_title=T?T.value:""}else y==="url"?(m.url_list=p.elements.url_list?.value||"",m.content_title=m.url_list):y==="task"&&(m.content_title=p.elements.content_title_bulk?p.elements.content_title_bulk.value:"");delete m.content_title_bulk,delete m.content_title_csv;let w=document.getElementById("aipkit_cw_template_select"),S="";if(w&&w.selectedIndex>0){let T=w.options[w.selectedIndex];T&&(S=T.text)}if(S&&S.trim()!=="")m.task_name=S.trim();else{let T=(m.content_title||m.rss_feeds||m.gsheets_sheet_id||m.url_list||"").split(`
`)[0].trim();m.task_name=T||"Automated Content Writing Task"}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(d,!0,"Create Task","Creating Task..."):(d.disabled=!0,d.textContent="Creating Task..."),u&&(u.textContent="Creating automated task...",u.className="aipkit_cw_status_badge aipkit_settings_message-info");try{let T=document.getElementById("aipkit_content_writer_nonce");if(m._ajax_nonce=T?T.value:"",!m._ajax_nonce)throw new Error("Security token missing for task creation.");let v=await window.aipkit_apiRequest("aipkit_content_writer_create_task",m);u&&(u.textContent="",u.className="aipkit_cw_status_badge"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("autogpt"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("autogpt",{aipkit_force_refresh:!0})}catch(T){console.error("Content Writer Create Task Error:",T),u&&(u.textContent=`Error creating task: ${a(T.message||"Unknown error")}`,u.className="aipkit_cw_status_badge aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(d,!1,"Create Task"):(d.disabled=!1,d.textContent="Create Task")}}window.aipkit_createContentWriterTask=t,window.aipkit_validateContentWriterInputs=e,window.aipkit_showContentWriterValidationError=l,window.aipkit_clearContentWriterValidationMessage=o})();(function(){"use strict";let k=()=>{let u=document.getElementById("aipkit_cw_mode_select"),f=u?u.value:"task";return f==="single"?"task":f},a=()=>{let u=k();return u==="task"||u==="csv"},r=u=>{!u?.frequencySelect||!u.frequencySelect.querySelector('option[value="one-time"]')||u.frequencySelect.value!=="one-time"&&(u.frequencySelect.value="one-time",u.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})))},i=()=>{let u=document.getElementById("aipkit_content_writer_container");if(!u)return null;let f=u.querySelector(".aipkit_cw_generate_split");if(!f)return null;let m=f.querySelector("#aipkit_content_writer_generate_btn"),g=f.querySelector(".aipkit_cw_generate_toggle"),_=f.querySelector(".aipkit_cw_generate_menu"),h=_?_.querySelector('[data-menu-panel="actions"]'):null,y=_?_.querySelector('[data-menu-panel="intervals"]'):null,E=h?Array.from(h.querySelectorAll("[data-action]")):[],x=y?Array.from(y.querySelectorAll("[data-interval]")):[],w=y?y.querySelector("[data-menu-back]"):null,S=u.querySelector("#aipkit_cw_task_frequency");return{container:u,split:f,generateBtn:m,toggleBtn:g,menu:_,menuActions:h,menuIntervals:y,actionItems:E,intervalItems:x,backBtn:w,frequencySelect:S}},s=u=>{!u?.menu||!u?.toggleBtn||(u.menu.hidden=!0,u.toggleBtn.setAttribute("aria-expanded","false"))},n=u=>{if(!u?.menu||!u?.split)return;let f=u.menu,m=u.split.getBoundingClientRect(),g=window.innerWidth,_=12;f.style.position="fixed",f.style.right="auto",f.style.bottom="auto",f.style.zIndex="100000",f.style.visibility="hidden";let h=f.getBoundingClientRect(),y=m.right-h.width;y=Math.max(_,Math.min(y,g-h.width-_));let E=m.bottom+6;f.style.left=`${Math.round(y)}px`,f.style.top=`${Math.round(E)}px`,f.style.visibility="visible"},c=u=>{!u?.menu||!u?.toggleBtn||(u.menu.hidden=!1,n(u),u.toggleBtn.setAttribute("aria-expanded","true"))},l=(u,f)=>{if(!u?.menuActions||!u?.menuIntervals)return;let m=f==="intervals";u.menuActions.hidden=m,u.menuIntervals.hidden=!m},o=(u,f)=>{u&&(u.split.dataset.aipkitCwAction=f||"generate",u.actionItems.forEach(m=>{let g=m.dataset.action===f;m.classList.toggle("is-active",g),m.setAttribute("aria-checked",g?"true":"false")}))},e=u=>{if(!u?.frequencySelect)return;let f=u.frequencySelect.value||u.frequencySelect.options[0]?.value||"";u.intervalItems.forEach(m=>{let g=m.dataset.interval===f;m.classList.toggle("is-active",g),m.setAttribute("aria-checked",g?"true":"false")})},t=(u,f)=>{u?.frequencySelect&&(u.frequencySelect.value=f,u.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})),e(u),s(u),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState())},p=u=>{let f=i();if(!f)return;let m=u||"generate",g=m==="create_task"&&a();if(g&&r(f),o(f,m),typeof window.aipkit_updateContentWriterActionState=="function"&&(f.menu&&m==="create_task"&&!g&&(f.menu.dataset.keepOpen="true"),window.aipkit_updateContentWriterActionState()),m==="create_task"&&f.menuIntervals&&!g){l(f,"intervals"),e(f),c(f);return}l(f,"actions"),s(f),g&&m==="create_task"&&f.generateBtn&&setTimeout(()=>{f.generateBtn.click()},0)},d=()=>{let u=i();u&&u.split.dataset.listenerAttached!=="true"&&(u.split.dataset.aipkitCwAction||(u.split.dataset.aipkitCwAction="generate"),o(u,u.split.dataset.aipkitCwAction),e(u),u.toggleBtn&&u.toggleBtn.addEventListener("click",f=>{if(f.preventDefault(),u.toggleBtn.disabled)return;(u.split.dataset.aipkitCwAction||"generate")==="create_task"&&!a()?(l(u,"intervals"),e(u)):l(u,"actions"),u.menu&&u.menu.hidden?c(u):s(u)}),u.actionItems.forEach(f=>{f.addEventListener("click",m=>{m.preventDefault(),!f.disabled&&p(f.dataset.action||"generate")})}),u.intervalItems.forEach(f=>{f.addEventListener("click",m=>{m.preventDefault(),!f.disabled&&t(u,f.dataset.interval||"")})}),u.backBtn&&u.backBtn.addEventListener("click",f=>{f.preventDefault(),l(u,"actions"),c(u)}),document.addEventListener("click",f=>{let m=f.target;!u.menu||u.menu.hidden||u.split.contains(m)||s(u)}),document.addEventListener("keydown",f=>{f.key==="Escape"&&(!u.menu||u.menu.hidden||s(u))}),u.split.dataset.listenerAttached="true")};window.aipkit_initContentWriterGenerateMenu=d,window.aipkit_setCwGenerateAction=p,window.aipkit_getCwGenerateAction=()=>i()?.split?.dataset.aipkitCwAction||"generate"})();(function(){"use strict";let k=window.wp?.i18n?.__||function(P){return P},a=100,r=[{key:"write",label:k("Writing","gpt3-ai-content-generator"),steps:["title","content"],isEnabled:()=>!0},{key:"optimize",label:k("Optimizing","gpt3-ai-content-generator"),steps:["meta","focus","excerpt","tags"],isEnabled:P=>P.generateMeta||P.generateFocus||P.generateExcerpt||P.generateTags},{key:"publish",label:k("Publishing","gpt3-ai-content-generator"),steps:["image","featured","save"],isEnabled:()=>!0}],i={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Running","gpt3-ai-content-generator"),done:k("Done","gpt3-ai-content-generator"),skipped:k("Skipped","gpt3-ai-content-generator"),error:k("Error","gpt3-ai-content-generator")},s=[{key:"title",label:k("Title","gpt3-ai-content-generator"),isEnabled:P=>!!P.customTitlePrompt},{key:"content",label:k("Content","gpt3-ai-content-generator"),isEnabled:()=>!0},{key:"meta",label:k("Meta","gpt3-ai-content-generator"),isEnabled:P=>P.generateMeta},{key:"focus",label:k("Focus","gpt3-ai-content-generator"),isEnabled:P=>P.generateFocus},{key:"excerpt",label:k("Excerpt","gpt3-ai-content-generator"),isEnabled:P=>P.generateExcerpt},{key:"tags",label:k("Tags","gpt3-ai-content-generator"),isEnabled:P=>P.generateTags},{key:"image",label:k("Image","gpt3-ai-content-generator"),isEnabled:P=>P.generateImages},{key:"featured",label:k("Featured","gpt3-ai-content-generator"),isEnabled:P=>P.generateFeatured},{key:"save",label:k("Save","gpt3-ai-content-generator"),isEnabled:()=>!0}],n={active:!1,stopRequested:!1,items:[],rows:[],totals:{processed:0,completed:0,failed:0}},c=(P,R)=>({customTitlePrompt:String(P.custom_title_prompt||"").trim(),generateMeta:P.generate_meta_description==="1",generateFocus:P.generate_focus_keyword==="1",generateExcerpt:P.generate_excerpt==="1",generateTags:P.generate_tags==="1",generateImages:R.generate_images_enabled==="1",generateFeatured:R.generate_featured_image==="1"}),l=P=>{let R={};return s.forEach(O=>{R[O.key]=O.isEnabled(P)?"waiting":"skipped"}),R},o=(P,R)=>{let O=document.createElement("span");O.className=`aipkit_cw_batch_step aipkit_cw_batch_step--${R}`,O.dataset.step=P.key,O.dataset.status=R;let N=document.createElement("span");N.className="aipkit_cw_batch_step_label",N.textContent=P.label;let ie=document.createElement("span");return ie.className="aipkit_cw_batch_step_status",ie.textContent=i[R]||R,O.appendChild(N),O.appendChild(ie),{wrapper:O,status:ie}},e=(P,R,O)=>{E(P,R,O)},t=P=>{P?.phases&&Object.keys(P.phases).forEach(R=>{let O=P.phases[R],N=O.dataset.status;N==="done"||N==="skipped"||(O.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",O.dataset.status="error")})},p=()=>{let P=document.getElementById("aipkit_content_writer_container");if(!P)return null;let R=P.querySelector("#aipkit_cw_batch_queue"),O=R?R.querySelector(".aipkit_cw_batch_list"):null,N=R?R.querySelector(".aipkit_cw_batch_count"):null,ie=R?R.querySelector(".aipkit_cw_batch_progress"):null,J=R?R.querySelector(".aipkit_cw_batch_progress_bar"):null,we=P.querySelector("#aipkit_content_writer_form_status"),$e=P.querySelector("#aipkit_content_writer_generate_btn"),Ke=P.querySelector(".aipkit_cw_generate_toggle"),Ue=P.querySelector(".aipkit_cw_generate_menu"),it=Ue?Array.from(Ue.querySelectorAll(".aipkit_cw_generate_menu_item")):[],_t=P.querySelector("#aipkit_content_writer_stop_btn");return{container:P,queue:R,list:O,count:N,progress:ie,progressBar:J,status:we,generateBtn:$e,generateToggle:Ke,generateMenu:Ue,generateMenuItems:it,stopBtn:_t}},d=()=>{n.totals.processed=0,n.totals.completed=0,n.totals.failed=0},u=()=>{let P=p();if(!P||!P.count||!P.progressBar||!P.progress)return;let R=n.items.length,O=n.totals.completed;P.count.textContent=`${O}/${R}`;let N=R>0?Math.round(O/R*100):0;P.progressBar.style.width=`${N}%`,P.progress.setAttribute("aria-valuenow",String(N))},f=(P,R)=>{let O=p();!O||!O.status||(O.status.textContent=P||"",O.status.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),R&&O.status.classList.add(`aipkit_settings_message-${R}`))},m=()=>{let P=p();!P||!P.list||(P.list.innerHTML="",n.rows=[],n.items=[],d(),u())},g=()=>{let P=p();P?.queue&&(P.queue.hidden=!1)},_=()=>{let P=p();P?.queue&&(P.queue.hidden=!0)},h=(P,R)=>{let O=document.createElement("div");O.className="aipkit_cw_batch_row";let N=document.createElement("div");N.className="aipkit_cw_batch_row_content";let ie=document.createElement("span");ie.className="aipkit_cw_batch_topic",ie.textContent=P.topic||"";let J=document.createElement("div");J.className="aipkit_cw_batch_phases";let we={},$e=l(R),Ke={};r.forEach(Ot=>{let Nt=Ot.steps.some(qt=>{let Wt=s.find(ui=>ui.key===qt);return Wt&&Wt.isEnabled(R)});if(!Ot.isEnabled(R)&&!Nt)return;let qe=document.createElement("span");qe.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--waiting",qe.dataset.phase=Ot.key,qe.dataset.status="waiting",qe.setAttribute("title",Ot.label),qe.setAttribute("aria-label",Ot.label),J.appendChild(qe),we[Ot.key]=qe,Ot.steps.forEach(qt=>{Ke[qt]={wrapper:qe,phaseKey:Ot.key,status:{textContent:""}}})});let Ue=document.createElement("span");Ue.className="aipkit_cw_batch_status aipkit_cw_batch_status--waiting",Ue.textContent=k("Waiting","gpt3-ai-content-generator");let it=document.createElement("span");it.className="aipkit_cw_batch_error",it.hidden=!0;let _t=document.createElement("a");_t.className="aipkit_cw_batch_view",_t.textContent=k("View","gpt3-ai-content-generator"),_t.target="_blank",_t.rel="noopener noreferrer",_t.hidden=!0;let mt=document.createElement("span");return mt.className="aipkit_cw_batch_summary_text",N.appendChild(ie),N.appendChild(J),N.appendChild(Ue),N.appendChild(it),N.appendChild(_t),O.appendChild(N),{row:O,topic:ie,summary:mt,status:Ue,error:it,view:_t,phases:we,steps:Ke}},y=P=>{let R=s.find(O=>O.key===P);return R?R.label:P},E=(P,R,O)=>{if(!P?.phases)return;let N=r.find(J=>J.steps.includes(R));if(!N)return;let ie=P.phases[N.key];ie&&(O==="running"?(ie.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--running",ie.dataset.status="running",P.status&&(P.status.textContent=`${N.label} \xB7 ${y(R)}`)):O==="done"?(ie.dataset.status==="running"||R===N.steps[N.steps.length-1])&&(ie.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",ie.dataset.status="done"):O==="error"&&(ie.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",ie.dataset.status="error"))},x=(P,R)=>{let O=p();!O||!O.list||(O.list.innerHTML="",n.rows=P.map(N=>{let ie=h(N,R);return O.list.appendChild(ie.row),ie}))},w=(P,R,O={})=>{if(!P)return;P.row.classList.toggle("is-active",R==="running"),P.status.className=`aipkit_cw_batch_status aipkit_cw_batch_status--${R}`;let N={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Generating","gpt3-ai-content-generator"),success:k("Done","gpt3-ai-content-generator"),error:k("Failed","gpt3-ai-content-generator"),stopped:k("Stopped","gpt3-ai-content-generator")};if(P.status.textContent=N[R]||R,P.error&&(P.error.hidden=!0,P.error.textContent="",P.error.removeAttribute("title")),R==="success"&&P.phases&&Object.keys(P.phases).forEach(ie=>{let J=P.phases[ie];J.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",J.dataset.status="done"}),O.summary!==void 0&&(P.summary.textContent=O.summary||""),O.viewLink?(P.view.href=O.viewLink,P.view.hidden=!1):R!=="success"&&(P.view.hidden=!0),R==="error"&&P.error){let ie=T(O.summary);ie&&(P.error.textContent=ie,P.error.title=S(O.summary),P.error.hidden=!1)}},S=P=>String(P||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),T=P=>{let R=S(P);return R?R.length>140?`${R.slice(0,137)}\u2026`:R:""},v=(P,R)=>{let O=S(R||P);return O?O.length>140?`${O.slice(0,140)}\u2026`:O:""},A=P=>{let R=new FormData(P),O=Object.fromEntries(R.entries()),N=P.elements["openai_vector_store_ids[]"];O.openai_vector_store_ids=N?Array.from(N.selectedOptions).map(J=>J.value):[],delete O["openai_vector_store_ids[]"];let ie=document.getElementById("aipkit_content_writer_nonce");return ie&&ie.value&&(O._ajax_nonce=ie.value),O},C=P=>{let R=P.elements["post_categories[]"],O=R?Array.from(R.selectedOptions).map(ie=>ie.value):[],N=P.querySelector('input[name="schedule_mode"]:checked')?.value||"immediate";return{ai_provider:P.elements.ai_provider?.value||"",ai_model:P.elements.ai_model?.value||"",ai_temperature:P.elements.ai_temperature?.value||"",reasoning_effort:P.elements.reasoning_effort?.value||"",cw_generation_mode:P.elements.cw_generation_mode?.value||"",post_type:P.elements.post_type?.value||"post",post_author:P.elements.post_author?.value||"",post_status:P.elements.post_status?.value||"draft",post_schedule_date:P.elements.post_schedule_date?.value||"",post_schedule_time:P.elements.post_schedule_time?.value||"",schedule_mode:N,smart_schedule_start_datetime:P.elements.smart_schedule_start_datetime?.value||"",smart_schedule_interval_value:P.elements.smart_schedule_interval_value?.value||"",smart_schedule_interval_unit:P.elements.smart_schedule_interval_unit?.value||"",post_categories:O,generate_toc:P.elements.generate_toc?.checked?"1":"0",generate_seo_slug:P.elements.generate_seo_slug?.checked?"1":"0",generate_images_enabled:P.elements.generate_images_enabled?.checked?"1":"0",generate_featured_image:P.elements.generate_featured_image?.checked?"1":"0",image_provider:P.elements.image_provider?.value||"",image_model:P.elements.image_model?.value||"",image_prompt:P.elements.image_prompt?.value||"",featured_image_prompt:P.elements.featured_image_prompt?.value||"",image_count:P.elements.image_count?.value||"1",image_placement:P.elements.image_placement?.value||"after_first_h2",image_placement_param_x:P.elements.image_placement_param_x?.value||"",image_alignment:P.elements.image_alignment?.value||"none",image_size:P.elements.image_size?.value||"large",pexels_orientation:P.elements.pexels_orientation?.value||"",pexels_size:P.elements.pexels_size?.value||"",pexels_color:P.elements.pexels_color?.value||"",pixabay_orientation:P.elements.pixabay_orientation?.value||"",pixabay_image_type:P.elements.pixabay_image_type?.value||"",pixabay_category:P.elements.pixabay_category?.value||"",generate_image_title:P.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:P.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:P.elements.generate_image_caption?.checked?"1":"0",generate_image_description:P.elements.generate_image_description?.checked?"1":"0",image_title_prompt:P.elements.image_title_prompt?.value||"",image_alt_text_prompt:P.elements.image_alt_text_prompt?.value||"",image_caption_prompt:P.elements.image_caption_prompt?.value||"",image_description_prompt:P.elements.image_description_prompt?.value||""}},b=(P,R)=>{let O=R.content_title||R.topic||"",N=R.inline_keywords||R.keywords||"",ie=N?`${O} | ${N}`:O,J={...P,content_title:ie};return R.rss_description&&(J.rss_description=R.rss_description),R.source_url&&(J.source_url=R.source_url),R.url_content_context&&(J.url_content_context=R.url_content_context),{data:J,topic:O,keywords:N}},L=(P,R,O,N,ie,J,we)=>({original_topic:R,final_title:O,post_title:O,keywords:N,excerpt:ie||"",image_provider:P.image_provider,image_model:P.image_model,image_prompt:P.image_prompt,image_alignment:P.image_alignment,image_size:P.image_size,featured_image_prompt:P.featured_image_prompt,pexels_orientation:P.pexels_orientation,pexels_size:P.pexels_size,pexels_color:P.pexels_color,pixabay_orientation:P.pixabay_orientation,pixabay_image_type:P.pixabay_image_type,pixabay_category:P.pixabay_category,generate_image_title:P.generate_image_title,generate_image_alt_text:P.generate_image_alt_text,generate_image_caption:P.generate_image_caption,generate_image_description:P.generate_image_description,image_title_prompt:P.image_title_prompt,image_alt_text_prompt:P.image_alt_text_prompt,image_caption_prompt:P.image_caption_prompt,image_description_prompt:P.image_description_prompt,ai_provider:P.ai_provider,ai_model:P.ai_model,ai_temperature:P.ai_temperature,reasoning_effort:P.reasoning_effort,cw_generation_mode:P.cw_generation_mode,_ajax_nonce:J,generate_images_enabled:P.generate_images_enabled,image_count:P.image_count,generate_featured_image:P.generate_featured_image,image_placement:P.image_placement,image_placement_param_x:P.image_placement_param_x,conversation_uuid:we}),B=(P,R,O,N,ie,J,we)=>{let $e=window.aipkit_getMarkdownRenderer?window.aipkit_getMarkdownRenderer():null,Ke=$e?$e.render(N):N,Ue=Array.isArray(R.post_categories)&&R.post_categories.length?R.post_categories:P.post_categories;return{post_title:O,post_content:Ke,generated_excerpt:ie.excerpt||"",generated_tags:ie.tags||"",meta_description:ie.meta_description||"",focus_keyword:ie.focus_keyword||"",post_type:R.post_type||P.post_type,post_author:R.post_author||P.post_author,post_status:P.post_status,post_schedule_date:R.post_schedule_date||P.post_schedule_date,post_schedule_time:R.post_schedule_time||P.post_schedule_time,post_categories:Ue,generate_toc:P.generate_toc,generate_seo_slug:P.generate_seo_slug,image_data:J?JSON.stringify(J):"",image_alignment:P.image_alignment,image_size:P.image_size,_ajax_nonce:we}},$=async(P,R,O,N,ie)=>{let J=P.item_config||{},{data:we,topic:$e,keywords:Ke}=b(R,J),Ue=$e,it=we.conversation_uuid||void 0;if(!!String(we.custom_title_prompt||"").trim()){e(N,"title","running");let ui=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",{...we,conversation_uuid:it});if(!ui?.new_title)throw new Error(k("Title generation failed","gpt3-ai-content-generator"));Ue=ui.new_title,it=ui.conversation_uuid||it,e(N,"title","done")}else e(N,"title","skipped");e(N,"content","running");let Ot=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",{...we,conversation_uuid:it});if(!Ot?.content)throw new Error(k("Content generation failed","gpt3-ai-content-generator"));e(N,"content","done"),it=Ot.conversation_uuid||it||void 0,e(N,"meta",ie.generateMeta?"done":"skipped"),e(N,"focus",ie.generateFocus?"done":"skipped"),e(N,"excerpt",ie.generateExcerpt?"done":"skipped"),e(N,"tags",ie.generateTags?"done":"skipped");let Nt=null;if(O.generate_images_enabled==="1"||O.generate_featured_image==="1"){ie.generateImages&&e(N,"image","running"),ie.generateFeatured&&e(N,"featured","running");let ui=Ot.focus_keyword||Ke||R.content_keywords||"",ae=L(O,$e,Ue,ui,Ot.excerpt||"",R._ajax_nonce,it),Ce=O.generate_images_enabled==="1",Ae=O.generate_featured_image==="1",Oe=Ce&&Ae,Fe=async(We={})=>{let je=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...ae,...We});if(!je?.image_data)throw new Error(k("Image generation failed","gpt3-ai-content-generator"));return je.image_data};if(Oe){let We=null,je=Qe=>{We||(We={...Qe,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(Ce){let Qe=await Fe({generate_featured_image:"0"});je(Qe),Array.isArray(Qe.in_content_images)&&We.in_content_images.push(...Qe.in_content_images),ie.generateImages&&e(N,"image","done")}if(Ae){let Qe=await Fe({generate_images_enabled:"0",image_count:0});je(Qe),Qe.featured_image_id&&(We.featured_image_id=Qe.featured_image_id),Qe.featured_image_url&&(We.featured_image_url=Qe.featured_image_url),ie.generateFeatured&&e(N,"featured","done")}Nt=We}else Nt=await Fe(),ie.generateImages&&e(N,"image","done"),ie.generateFeatured&&e(N,"featured","done")}else e(N,"image","skipped"),e(N,"featured","skipped");e(N,"save","running");let qt=B(O,J,Ue,Ot.content,Ot,Nt,R._ajax_nonce),Wt=await window.aipkit_apiRequest("aipkit_content_writer_save_post",qt);return e(N,"save","done"),{summary:v(Ot.content,Ot.excerpt),viewLink:Wt.view_link||Wt.edit_link}},W=()=>{let P=p();n.active=!1,n.stopRequested=!1,P?.generateBtn&&(typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():P.generateBtn.disabled=!1,P.generateBtn.removeAttribute("aria-disabled")),P?.generateToggle&&(P.generateToggle.disabled=!1,P.generateToggle.removeAttribute("aria-disabled")),P?.generateMenuItems?.length&&P.generateMenuItems.forEach(R=>{R.disabled=!1,R.removeAttribute("aria-disabled")}),P?.stopBtn&&(P.stopBtn.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()},U=()=>{n.active&&(n.stopRequested=!0,f(k("Stopping...","gpt3-ai-content-generator"),"info"))},D=P=>{n.items.slice(P).forEach((R,O)=>{let N=n.rows[P+O];w(N,"stopped")})},H=async()=>{for(let O=0;O<n.items.length;O+=1){if(n.stopRequested){D(O);break}let N=n.rows[O];w(N,"running");try{let ie=await $(n.items[O],n.baseData,n.postConfig,N,n.stepContext);w(N,"success",ie),n.totals.completed+=1}catch(ie){t(N),w(N,"error",{summary:ie?.message||k("Failed","gpt3-ai-content-generator")}),n.totals.failed+=1}n.totals.processed+=1,u()}let P=n.items.length,R=n.totals.completed;n.stopRequested?f(k("Generation stopped.","gpt3-ai-content-generator"),"error"):f(`${R}/${P} ${k("completed","gpt3-ai-content-generator")}`,"success"),W()},Q=async(P,R)=>{if(!P||!R)return;if(!window.aipkit_apiRequest){console.error("Batch generation: aipkit_apiRequest not available.");return}let O=p();if(!O?.generateBtn)return;if(n.active){f(k("Generation already in progress.","gpt3-ai-content-generator"),"info");return}let N=A(P),ie=C(P),J=c(N,ie);try{n.active=!0,n.stopRequested=!1,d(),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(O.generateBtn,!0,k("Generate","gpt3-ai-content-generator"),k("Preparing\u2026","gpt3-ai-content-generator")):O.generateBtn.disabled=!0,O.queue&&(O.queue.dataset.cwMode=R),f(k("Preparing items\u2026","gpt3-ai-content-generator"),"info");let we=await window.aipkit_apiRequest("aipkit_content_writer_prepare_batch",{...N,cw_generation_mode:R}),$e=Array.isArray(we.items)?we.items:[];if(!$e.length){f(k("No items found to generate.","gpt3-ai-content-generator"),"error"),W();return}m(),n.items=$e.slice(0,a),n.baseData=N,n.postConfig=ie,n.stepContext=J,x(n.items,J),g(),u(),f(k("Generating content\u2026","gpt3-ai-content-generator"),"info"),await H()}catch(we){f(we?.message||k("Batch generation failed.","gpt3-ai-content-generator"),"error"),W()}},F=()=>{n.active=!1,n.stopRequested=!1,m(),_()};window.aipkit_cw_handleBatchGeneration=Q,window.aipkit_cw_resetBatchQueue=F,window.aipkit_cw_requestBatchStop=U,window.aipkit_cw_isBatchActive=()=>n.active===!0})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},a=window.wp?.i18n?.__||function(i){return i};function r(i,s){let n=i.value,c=n?n.toLowerCase():"",l=window.aipkit_dashboard?.models;if(!s){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!l){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),s.innerHTML='<option value="">'+k("Error: Model data object not found")+"</option>",s.disabled=!0;return}let o=l[c];(typeof o>"u"||o===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${c}'. Defaulting to empty.`),o=c==="openai"?{}:[]),s.innerHTML="";let e=window.aipkit_dashboard?.recommendedModels?.[c]||[],t=Array.isArray(e)?e:[],p=new Set(t.map(d=>d?.id).filter(Boolean));if(c==="openai"&&typeof o=="object"&&!Array.isArray(o)){if(t.length>0){let d=document.createElement("optgroup");d.label=k(a("Recommended","gpt3-ai-content-generator")),t.forEach(u=>{if(u&&typeof u=="object"&&u.id){let f=new Option(k(u.name||u.id),u.id);d.appendChild(f)}}),d.children.length>0&&s.appendChild(d)}Object.keys(o).forEach(d=>{let u=document.createElement("optgroup");u.label=k(d);let f=o[d];Array.isArray(f)?f.forEach(m=>{if(!(m&&typeof m=="object"&&m.id&&p.has(m.id)))if(m&&typeof m=="object"&&m.id){let g=new Option(k(m.name||m.id),m.id);u.appendChild(g)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${d}':`,m)}):console.warn(`Content Writer Model Populator: Items for group '${d}' under '${c}' is not an array.`),u.children.length>0&&s.appendChild(u)})}else if(Array.isArray(o)){if(t.length>0){let u=document.createElement("optgroup");u.label=k(a("Recommended","gpt3-ai-content-generator")),t.forEach(f=>{if(f&&typeof f=="object"&&f.id){let m=new Option(k(f.name||f.id),f.id);u.appendChild(m)}}),u.children.length>0&&s.appendChild(u)}let d=t.length>0?document.createElement("optgroup"):null;d&&(d.label=k(a("All models","gpt3-ai-content-generator"))),o.forEach(u=>{if(!(u&&typeof u=="object"&&u.id&&p.has(u.id)))if(u&&typeof u=="object"&&u.id){let f=new Option(k(u.name||u.id),u.id);d?d.appendChild(f):s.appendChild(f)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${c}':`,u)}),d&&d.children.length>0&&s.appendChild(d)}else console.warn(`Content Writer Model Populator: Data for provider '${c}' is not in expected format. Actual type: ${typeof o}`),s.appendChild(new Option(k(`No models for ${n} (Format Error)`),""));if(!s.options||typeof s.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),s.appendChild(new Option(k("Error loading models"),"")),s.disabled=!0;else if(s.options.length===0)s.appendChild(new Option(k(`No models for ${n} (Sync in settings)`),"")),s.disabled=!0;else{s.disabled=!1;let d=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let u=window.aipkit_cw_template_state.pendingModelSelection;s.querySelector(`option[value="${CSS.escape(u)}"]`)?d=u:console.warn(`Content Writer Model Populator: Pending model '${u}' not found in new list for provider '${n}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(d===null){let u=s.querySelector("optgroup");u&&u.options&&u.options.length>0&&u.options[0].value?d=u.options[0].value:s.options&&s.options.length>0&&s.options[0].value?d=s.options[0].value:d=""}s.value=d}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let d=document.getElementById("aipkit_content_writer_container");d&&window.aipkit_cw_toggleReasoningEffort(d)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}window.aipkit_populateModelsForContentWriter=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(p){return p},a=p=>p&&p!=="single"?p:"task",r=p=>typeof p=="string"&&p.startsWith("existing"),i=p=>p==="existing"?"existing-content":p,s={"existing-images":{title:{label:"Image Title",desc:"Optimize attachment title"},content:{label:"Description",desc:"Update image description"},excerpt:{label:"Caption",desc:"Short image caption"},keyword:{label:"Alt Text",desc:"Describe the image for accessibility"}},"existing-products":{title:{label:"Product Title",desc:"Generate product headline"},content:{label:"Product Description",desc:"Generate main product description"},meta:{label:"Meta Description",desc:"SEO meta for product pages"},keyword:{label:"Focus Keyword",desc:"Primary keyword for product SEO"},excerpt:{label:"Short Description",desc:"Short summary of the product"},tags:{label:"Tags",desc:"Auto-generate product tags"}}},n=p=>{let d=document.getElementById("aipkit_content_writer_container");if(!d)return;let u=d.querySelectorAll(".aipkit_prompt_toggle_card[data-prompt-key]");if(!u.length)return;let f=s[p]||null;u.forEach(m=>{let g=m.dataset.promptKey,_=m.querySelector(".aipkit_prompt_toggle_label"),h=m.querySelector(".aipkit_prompt_toggle_desc");if(!_||!h)return;m.dataset.defaultLabel||(m.dataset.defaultLabel=_.textContent||""),m.dataset.defaultDesc||(m.dataset.defaultDesc=h.textContent||"");let y=f&&g?f[g]:null;y?(_.textContent=y.label,h.textContent=y.desc):(_.textContent=m.dataset.defaultLabel,h.textContent=m.dataset.defaultDesc)})},c=p=>{let d=document.querySelectorAll(".aipkit_cw_prompt_flyout");if(!d.length)return;let u=p==="existing-images",f=p==="existing-products";d.forEach(m=>{let g=m.querySelector(".aipkit_cw_prompt_panel"),_=m.querySelector(".aipkit_cw_prompt_editor_title");if(!g||!_)return;if(!m.dataset.defaultTitle){let y=_.textContent||g.getAttribute("aria-label")||"";m.dataset.defaultTitle=y}let h=m.dataset.defaultTitle||"";u&&m.dataset.existingImagesTitle?h=m.dataset.existingImagesTitle:f&&m.dataset.existingProductsTitle&&(h=m.dataset.existingProductsTitle),h&&(_.textContent=h,g.setAttribute("aria-label",h))})};function l(p){if(!document.getElementById("aipkit_content_writer_form"))return;let u=a(p),f=i(u),m=document.getElementById("aipkit_cw_single_output_wrapper");m&&f!=="task"&&(m.style.display="none");let g=document.getElementById("aipkit_cw_output_card");if(g){let y=m&&m.style.display!=="none";g.style.display=f==="task"&&y?"block":"none"}let _=document.getElementById("aipkit_cw_content_prompt_placeholders");if(_){let y="Use placeholders: {topic}, {keywords}",E=r(f);f==="rss"?y+=", {description}, {source_url}":f==="url"&&(y+=", {url_content}"),y+=".";let x=y.replace(/(\{[a-zA-Z0-9_]+\})/g,w=>`<code class="aipkit-placeholder" title="Click to copy">${k(w)}</code>`);_.innerHTML=x,_.hidden=E}typeof window.aipkit_setContentWriterPromptMode=="function"&&window.aipkit_setContentWriterPromptMode(f),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState(f);let h=document.getElementById("aipkit_cw_batch_queue");if(h){let y=h.querySelector(".aipkit_cw_batch_list"),E=y?y.children.length>0:!1,x=typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive();h.hidden=!(x||E)}typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),f.startsWith("existing")&&typeof window.aipkit_fetchContentWriterExistingPosts=="function"&&window.aipkit_fetchContentWriterExistingPosts(1)}function o(p){let d=document.getElementById("aipkit_content_writer_form");if(!d)return;let u=document.getElementById("aipkit_content_writer_generate_btn"),f=u?u.querySelector(".aipkit_btn-text"):null,m=u?u.querySelector(".aipkit_cw_task_suffix"):null,g=document.querySelector(".aipkit_cw_post_summary_trigger"),_=document.querySelector(".aipkit_cw_generate_split"),h=_?_.querySelector(".aipkit_cw_generate_toggle"):null,y=_?_.querySelector(".aipkit_cw_generate_menu"):null,E=d.querySelector("#aipkit_cw_task_frequency"),x=y?Array.from(y.querySelectorAll(".aipkit_cw_generate_menu_item[data-action]")):[],w=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,S=new Set(["task","csv","rss","gsheets","url"]),T=new Set(["rss","gsheets","url"]),v=a(p||document.getElementById("aipkit_cw_mode_select")?.value||"task");v=i(v);let A=r(v),C=v==="existing-images",b=v==="existing-products",L=v==="existing-content",B=S.has(v),$=T.has(v),W=B&&(!$||w),U=v==="task"||v==="csv";d.classList.toggle("aipkit_cw_mode_existing",A),d.classList.toggle("aipkit_cw_mode_existing_images",C),d.classList.toggle("aipkit_cw_mode_existing_products",b),d.classList.toggle("aipkit_cw_mode_existing_content",L),d.querySelectorAll(".aipkit_model_settings_popover.aipkit-active").forEach(O=>{O.classList.remove("aipkit-active"),O.setAttribute("aria-hidden","true")}),d.querySelectorAll(".aipkit_cw_popover_trigger[aria-expanded='true']").forEach(O=>O.setAttribute("aria-expanded","false")),d.querySelectorAll("[data-aipkit-cw-mode-only]").forEach(O=>{let ie=O.dataset.aipkitCwModeOnly===v;O.hidden=!ie,O.setAttribute("aria-hidden",ie?"false":"true"),!ie&&O.classList.contains("aipkit_model_settings_popover")&&(O.classList.remove("aipkit-active"),O.setAttribute("aria-hidden","true")),!ie&&O.classList.contains("aipkit_cw_popover_trigger")&&O.setAttribute("aria-expanded","false")}),n(v),c(v),typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),(()=>{if(!r)return;let O=window.aipkit_cw_template_state;if(!O)return;let ie=(Array.isArray(O.currentTemplates)?O.currentTemplates.find(J=>String(J.id)===String(O.currentTemplateId||"")):null)?.config||O.initialConfigForSelectedTemplate;!ie||typeof ie!="object"||["generate_title","generate_content"].forEach(J=>{if(!Object.prototype.hasOwnProperty.call(ie,J))return;let we=d.elements[J];if(!we)return;let $e=ie[J];we.checked=$e==="1"||$e===1||$e===!0})})(),E&&U&&Array.from(E.options).some(N=>N.value==="one-time")&&E.value!=="one-time"&&(E.value="one-time");let H=!1;if(v==="rss"){let O=document.getElementById("aipkit_cw_rss_items_count");H=O&&parseInt(O.value,10)>0}let Q=_?.dataset?.aipkitCwAction||"generate";if(A?Q=!w&&b?"upgrade":"update":(B||(Q="generate"),!W&&$&&(Q="upgrade")),!A&&v==="rss"&&W?H?Q==="fetch_feeds"&&(Q="generate"):Q="fetch_feeds":Q==="fetch_feeds"&&(Q="generate"),!A&&Q==="create_task"&&!W&&(Q="generate"),!A&&W&&Q!=="generate"&&Q!=="create_task"&&Q!=="fetch_feeds"&&(Q="generate"),_&&(_.dataset.aipkitCwAction=Q),x.forEach(O=>{let N=O.dataset.action||"generate",ie=!B||$&&!w||A;N==="create_task"&&(O.hidden=ie);let J=N===Q;O.classList.toggle("is-active",J),O.setAttribute("aria-checked",J?"true":"false")}),h){let O=W&&!A&&!(v==="rss"&&!H);h.style.display=O?"":"none",h.disabled=!O}y&&(y.dataset.keepOpen==="true"||(y.hidden=!0),y.dataset.keepOpen="false"),_&&_.classList.toggle("is-single",!W||v==="rss"&&!H);let P={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",fetch_feeds:"Fetch Feeds",update:"Update"}[Q]||"Generate";if(f?f.textContent=P:u&&(typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(u,P):u.textContent=P),u&&(u.dataset.action=Q,A||(u.removeAttribute("aria-disabled"),u.dataset.aipkitExistingDisabled&&(u.disabled=!1,delete u.dataset.aipkitExistingDisabled))),m)if(Q==="create_task"&&E&&!U){let O=E.options[E.selectedIndex],N=O?O.text:"";N?(m.textContent=` / ${N}`,m.hidden=!1):(m.textContent="",m.hidden=!0)}else m.textContent="",m.hidden=!0;if(g&&(g.hidden=A,g.setAttribute("aria-hidden",A?"true":"false"),A&&g.setAttribute("aria-expanded","false")),typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0);return}u?.dataset?.aipkitStopMode==="true"&&typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),typeof window.aipkit_cw_resetBatchQueue=="function"&&(Q!=="generate"||!B)&&window.aipkit_cw_resetBatchQueue()}let e={task:{label:"Manual Entry",icon:"dashicons-edit"},csv:{label:"Import CSV",icon:"dashicons-media-spreadsheet"},rss:{label:"RSS Feed",icon:"dashicons-rss"},url:{label:"Website URL",icon:"dashicons-admin-links"},gsheets:{label:"Google Sheets",icon:"dashicons-analytics"},existing:{label:"Update Content",icon:"dashicons-update"},"existing-content":{label:"Update Content",icon:"dashicons-update"},"existing-images":{label:"Optimize Images",icon:"dashicons-format-image"},"existing-products":{label:"Optimize Products",icon:"dashicons-cart"}};function t(p){if(!p){console.error("Content Writer Mode: Scope element not provided for initialization.");return}let d=p.querySelector("#aipkit_cw_mode_select"),u=Array.from(p.querySelectorAll(".aipkit_cw_mode_card")),f=Array.from(p.querySelectorAll(".aipkit_cw_bulk_source_tab")),m=Array.from(p.querySelectorAll("[data-aipkit-bulk-source-panel]")),g=p.querySelector(".aipkit_cw_tab_content_container"),_=p.querySelector("[data-aipkit-source-selector]"),h=_?.querySelector("[data-aipkit-source-trigger]"),y=_?.querySelector(".aipkit_cw_source_menu"),E=y?Array.from(y.querySelectorAll(".aipkit_cw_source_option")):[],x=h?.querySelector("[data-source-label]"),w=h?.querySelector("[data-source-icon]");if(!d||!g){console.warn("Content Writer Mode: Mode selector or content container not found within the provided scope.");return}let S=L=>{u.length&&u.forEach(B=>{let $=B.dataset.mode===L;B.classList.toggle("is-active",$),B.setAttribute("aria-pressed",$?"true":"false")})},T=L=>{!f.length||!m.length||(f.forEach(B=>{let $=B.dataset.source===L;B.classList.toggle("is-active",$),B.setAttribute("aria-pressed",$?"true":"false")}),m.forEach(B=>{let $=B.dataset.aipkitBulkSourcePanel===L;B.classList.toggle("is-hidden",!$),B.hidden=!$,B.setAttribute("aria-hidden",$?"false":"true")}))},v=L=>{if(!E.length)return;let B=i(L),$=r(B);E.forEach(U=>{let D=U.dataset.source===B;U.classList.toggle("is-active",D),U.setAttribute("aria-selected",D?"true":"false")});let W=e[B]||e.task;if(x&&(x.dataset.defaultLabel||(x.dataset.defaultLabel=x.textContent||""),x.textContent=$?W.label:x.dataset.defaultLabel),w){let U=w.querySelector(".dashicons");if(U&&!w.dataset.defaultIcon){let D=U.className.split(" ").find(H=>H!=="dashicons");w.dataset.defaultIcon=D||"dashicons-plus-alt2"}if(U){let D=$?W.icon:w.dataset.defaultIcon||"dashicons-plus-alt2";U.className="dashicons "+D}w.dataset.sourceIcon=$?B:"more"}h&&h.classList.toggle("is-active",$)},A=(L=!1)=>{if(!y||!h)return;let B=h.getAttribute("aria-expanded")==="true",$=L||B;h.setAttribute("aria-expanded",$?"false":"true"),y.hidden=$},C=L=>{let B=a(L),$=i(B),W=$.startsWith("existing")?"existing":$;d.value!==B&&(d.value=B),g.querySelectorAll(".aipkit_cw_tab_content").forEach(U=>{U.classList.toggle("aipkit_active",U.dataset.pane===W)}),S($),T(B==="csv"?"csv":"task"),v($),l($)};d.addEventListener("change",function(L){C(L.target.value)}),h&&h.addEventListener("click",L=>{L.stopPropagation(),A()}),E.length&&E.forEach(L=>{L.addEventListener("click",()=>{let B=L.dataset.source||"task";d.value!==B&&(d.value=B,d.dispatchEvent(new Event("change",{bubbles:!0}))),A(!0)})}),document.addEventListener("click",L=>{_&&!_.contains(L.target)&&A(!0)}),document.addEventListener("keydown",L=>{L.key==="Escape"&&y&&!y.hidden&&(A(!0),h?.focus())}),u.length&&u.forEach(L=>{L.dataset.listenerAttached||(L.addEventListener("click",()=>{let B=L.dataset.mode||"task";d.value!==B&&(d.value=B,d.dispatchEvent(new Event("change",{bubbles:!0})))}),L.dataset.listenerAttached="true")}),f.length&&f.forEach(L=>{L.dataset.listenerAttached||(L.addEventListener("click",()=>{let $=(L.dataset.source||"task")==="csv"?"csv":"task";d.value!==$&&(d.value=$,d.dispatchEvent(new Event("change",{bubbles:!0})))}),L.dataset.listenerAttached="true")});let b=d.value||"task";C(b==="single"?"task":b)}window.aipkit_initContentWriterTabs=t,window.aipkit_updateContentWriterActionState=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(g){return String(g||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},a=["keyword","title","excerpt","content","meta","tags"],r={keyword:"Focus keyword",title:"Title",excerpt:"Excerpt",content:"Content",meta:"Meta description",tags:"Tags",slug:"URL"},s={"existing-content":{fieldOrder:a,fieldLabels:r,postTypeOverride:"",allowMeta:!0,allowTags:!0,allowSlug:!0},"existing-images":{fieldOrder:["keyword","title","excerpt","content"],fieldLabels:{keyword:"Alt text",title:"Image title",excerpt:"Caption",content:"Description"},postTypeOverride:"attachment",allowMeta:!1,allowTags:!1,allowSlug:!1,useImageMetadataPrompts:!0},"existing-products":{fieldOrder:a,fieldLabels:r,postTypeOverride:"product",allowMeta:!0,allowTags:!0,allowSlug:!0}},n=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}"],c=["{price}","{regular_price}","{sale_price}","{sku}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{product_categories}"],l={title:["{original_title}"],content:["{original_content}","{short_description}"],meta:["{original_title}","{short_description}","{original_content}"],keyword:["{original_title}","{original_content}"],excerpt:["{short_description}","{original_content}","{original_excerpt}"],tags:["{original_content}","{attributes}","{product_categories}"]},o=["{file_name}","{original_title}","{original_alt}","{original_caption}","{original_description}"],e=["Generate product titles, descriptions, and SEO fields.","Use product data like price, SKU, and attributes.","Bulk optimize selected products."],t={short:2e3,medium:4e3,long:6e3},p=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,d=window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.aipkit_dashboard.upgradeUrl:"",u=2400;function f(g=1){if(typeof window.aipkit_cw_existing_handleFetch=="function"){window.aipkit_cw_existing_handleFetch(g);return}window.aipkit_cw_existing_pendingFetch=g}function m(g){if(!g)return;let _=g.querySelector("[data-aipkit-existing-panel]");if(!_||_.dataset.init==="true")return;let h=_.querySelector("#aipkit_cw_existing_post_type"),y=_.querySelector("#aipkit_cw_existing_post_status"),E=_.querySelector("#aipkit_cw_existing_media_filter"),x=_.querySelector("#aipkit_cw_existing_search"),w=_.querySelector("#aipkit_cw_existing_refresh"),S=_.querySelector("#aipkit_cw_existing_select_all"),T=_.querySelector("#aipkit_cw_existing_posts_body"),v=_.querySelector("#aipkit_cw_existing_page_status"),A=_.querySelector("#aipkit_cw_existing_page_prev"),C=_.querySelector("#aipkit_cw_existing_page_next"),b=_.querySelector("#aipkit_cw_existing_selected_count"),L=document.getElementById("aipkit_content_writer_generate_btn")||_.querySelector("#aipkit_cw_existing_open_assistant"),B=document.getElementById("aipkit_cw_mode_select");if(!T)return;let $=document.getElementById("aipkit_content_writer_nonce"),W=10,U=1,D=1,H=null,Q=!1,F=!1,P=!1,R=[],O=new Set,N=new Map,ie=h?h.value:"",J=!1,we=L?L.querySelector(".aipkit_btn-text"):null,$e=L&&L.dataset.action||"generate",Ke=_e=>_e?_e==="existing"?"existing-content":_e.indexOf("existing-")===0?_e:"":"",Ue=()=>Ke(B?B.value:""),it=()=>s[Ue()]||s["existing-content"],_t=()=>!!Ue(),mt=document.getElementById("aipkit_content_writer_form_status"),Ot="",Nt=null,qe=()=>{Nt&&(clearTimeout(Nt),Nt=null)},qt=(_e,be)=>{mt&&(qe(),mt.textContent=_e||"",mt.className="aipkit_cw_status_badge",be==="info"?mt.classList.add("aipkit_settings_message-info"):be==="error"?mt.classList.add("aipkit_settings_message-error"):be==="success"&&mt.classList.add("aipkit_settings_message-success"),_e?mt.dataset.cwUpdateStatus="1":delete mt.dataset.cwUpdateStatus)},Wt=()=>{F&&(P=!0,qt("Stopping...","info"))},ui=()=>{mt&&(qe(),Nt=setTimeout(()=>{mt.dataset.cwUpdateStatus==="1"&&qt("","")},4e3))},ae=_e=>{if(!mt){Ot="";return}if(!_e){mt.dataset.cwProNotice==="1"&&(!Ot||mt.textContent.startsWith(Ot))&&(mt.textContent="",mt.className="aipkit_cw_status_badge"),delete mt.dataset.cwProNotice,Ot="";return}let be=d?` <a class="aipkit_popover_upgrade_link" href="${k(d)}" target="_blank" rel="noopener noreferrer">Upgrade</a>`:"";Ot=_e,mt.dataset.cwProNotice="1",mt.className="aipkit_cw_status_badge aipkit_settings_message-info",mt.innerHTML=`${k(_e)}${be}`};if(h&&!p){let _e=h.querySelector('option[value="product"]');_e&&!_e.dataset.proLabel&&(_e.dataset.proLabel=_e.textContent||"Products")}let Ce=_e=>{J=!!_e,L&&(L.dataset.action=J?"upgrade":$e,we&&_t()&&(we.textContent=J?"Upgrade":"Update"))},Ae=_e=>{let be=[],Te=[];return _e.forEach(At=>{let et=R.find(Lt=>Number(Lt.id)===At);et&&et.type==="product"?be.push(At):Te.push(At)}),{productIds:be,otherIds:Te}},Oe=()=>{if(!_t()||Ue()!=="existing-content"){Ce(!1),ae("");return}if(p){Ce(!1),ae("");return}let _e=Array.from(O),{productIds:be,otherIds:Te}=Ae(_e);if(h&&h.value==="product"){Ce(!0);return}if(be.length&&!Te.length){Ce(!0);return}if(be.length&&Te.length){Ce(!1);return}Ce(!1),ae("")},Fe=_e=>{T&&(T.innerHTML=`
        <tr class="aipkit_cw_existing_empty">
          <td colspan="7">${k(_e)}</td>
        </tr>
      `,We())},We=()=>{let _e=O.size;if(Oe(),b&&(b.textContent=`${_e} selected`),L&&_t()){let be=J?F:_e===0||F;L.disabled=be,L.setAttribute("aria-disabled",be?"true":"false"),be?L.dataset.aipkitExistingDisabled="true":delete L.dataset.aipkitExistingDisabled}if(S){let be=R.length>0&&R.every(Te=>O.has(Te.id));S.checked=be}},je=()=>{v&&(v.textContent=`Page ${U} of ${D}`),A&&(A.disabled=U<=1),C&&(C.disabled=U>=D)},Qe=(_e,be)=>{if(R=Array.isArray(_e)?_e:[],U=be?.page||1,D=be?.total_pages||1,!R.length){Fe("No posts found."),je(),We();return}let Te=Ue()==="existing-images",At=R.map(et=>{let Lt=Number(et.id),fi=k(et.title||"(Untitled)"),Vt=k(et.edit_link||"#"),hi=k(et.type_label||""),mi=k(et.status_label||""),Bi=Te?k(et.alt_text||""):"",gi=Te?k(et.caption||""):"",ti=Te?k(et.description||""):"",ji=Te?k(et.thumb_url||""):"",Pe=O.has(Lt)?"checked":"",pi=k(et.type||"post"),Hi=fi?` title="${fi}"`:"",En=Bi?` title="${Bi}"`:"",Do=gi?` title="${gi}"`:"",Ao=ti?` title="${ti}"`:"",Wo=ji?`<span class="aipkit_cw_existing_thumb"><img src="${ji}" alt="" loading="lazy"></span>`:'<span class="aipkit_cw_existing_thumb aipkit_cw_existing_thumb--empty" aria-hidden="true"></span>',gn=Te?`
                <div class="aipkit_cw_existing_title_stack">
                  ${Wo}
                  <div class="aipkit_cw_existing_title_meta">
                    <a class="row-title aipkit_cw_existing_truncate" href="${Vt}" target="_blank" rel="noopener noreferrer"${Hi}>${fi}</a>
                    <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                  </div>
                </div>
              `:`
                <div class="aipkit_cw_existing_title_inline">
                  <a class="row-title aipkit_cw_existing_truncate" href="${Vt}" target="_blank" rel="noopener noreferrer"${Hi}>${fi}</a>
                  <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                </div>
              `;return`
            <tr id="post-${Lt}" data-post-type="${pi}">
              <td class="aipkit_cw_existing_col_check">
                <input type="checkbox" class="aipkit_cw_existing_row_checkbox" value="${Lt}" ${Pe}>
              </td>
              <td class="aipkit_cw_existing_title">
                ${gn}
              </td>
              <td class="aipkit_cw_existing_col_type">${hi}</td>
              <td class="aipkit_cw_existing_col_status">${mi}</td>
              <td class="aipkit_cw_existing_col_alt"><span class="aipkit_cw_existing_truncate"${En}>${Bi}</span></td>
              <td class="aipkit_cw_existing_col_caption"><span class="aipkit_cw_existing_truncate"${Do}>${gi}</span></td>
              <td class="aipkit_cw_existing_col_description"><span class="aipkit_cw_existing_truncate"${Ao}>${ti}</span></td>
            </tr>
          `}).join("");T.innerHTML=At,je(),We()},xt=_e=>{let be=String(_e||"").trim();return be||"(Untitled)"},bi=(_e,be)=>{let Te=_.querySelector(`#post-${_e}`);if(!Te)return;let At=Te.querySelector(".row-title");if(!At)return;let et=xt(be);At.textContent=et,At.setAttribute("title",et);let Lt=R.find(fi=>Number(fi.id)===_e);Lt&&(Lt.title=et)},gt=(_e,be,Te)=>{let At=_.querySelector(`#post-${_e}`);if(!At)return;let et="",Lt="";if(be==="keyword")et=".aipkit_cw_existing_col_alt .aipkit_cw_existing_truncate",Lt="alt_text";else if(be==="excerpt")et=".aipkit_cw_existing_col_caption .aipkit_cw_existing_truncate",Lt="caption";else if(be==="content")et=".aipkit_cw_existing_col_description .aipkit_cw_existing_truncate",Lt="description";else return;let fi=At.querySelector(et);if(!fi)return;let Vt=String(Te||"").trim();fi.textContent=Vt,Vt?fi.setAttribute("title",Vt):fi.removeAttribute("title");let hi=R.find(mi=>Number(mi.id)===_e);hi&&Lt&&(hi[Lt]=Vt)},It=_e=>{let be=N.get(_e);be&&(clearTimeout(be),N.delete(_e))},ze=(_e,be,Te)=>{let At=_.querySelector(`#post-${_e}`);if(!At)return;let et=At.querySelector(".aipkit_cw_existing_status");if(et){if(It(_e),et.classList.remove("is-visible","is-error","is-success","is-processing","is-queued"),!Te){et.textContent="";return}et.textContent=Te,et.classList.add("is-visible"),be==="error"&&et.classList.add("is-error"),be==="success"&&et.classList.add("is-success"),be==="processing"&&et.classList.add("is-processing"),be==="queued"&&et.classList.add("is-queued")}},Ye=_e=>ze(_e,"",""),Ze=_e=>{It(_e);let be=setTimeout(()=>Ye(_e),u);N.set(_e,be)},ei=_e=>{if(F=_e,L&&_t()){let be=L.dataset&&L.dataset.aipkitStopMode==="true",Te=J?_e:O.size===0||_e&&!be;L.disabled=Te,L.setAttribute("aria-disabled",Te?"true":"false"),Te?L.dataset.aipkitExistingDisabled="true":delete L.dataset.aipkitExistingDisabled}if(w&&(w.disabled=_e),h){let be=it();h.disabled=_e||!!be.postTypeOverride}y&&(y.disabled=_e),x&&(x.disabled=_e),A&&(A.disabled=_e||U<=1),C&&(C.disabled=_e||U>=D),S&&(S.disabled=_e),T.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(be=>{be.disabled=_e})},ci=()=>{let _e=it();h&&(_e.postTypeOverride?(h.value=_e.postTypeOverride,h.disabled=!0):(h.disabled=!1,h.value=ie||"")),y&&_e.postTypeOverride==="attachment"&&(y.value="")},Jt=_e=>{!L||!_t()||L.dataset&&L.dataset.aipkitStopMode==="true"||(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(L,_e,"Update","Updating..."):L.disabled=_e)},Gt=(_e,be)=>{let Te=`${be}_update`,At=_e&&_e[Te]||_e&&_e[be]||"";return String(At||"").trim()},Di=_e=>{let be=document.getElementById("aipkit_content_writer_form");if(!be||typeof window.aipkit_getContentWriterFormConfig!="function")return{error:"Content Writer form is not ready yet."};let Te=window.aipkit_getContentWriterFormConfig(be),At=!!_e.useImageMetadataPrompts;if(!p&&_e.postTypeOverride==="product")return{error:"Optimize Products is a Pro feature. Upgrade to continue."};let et=Pe=>At?Pe==="title"?Te.generate_image_title==="1":Pe==="keyword"?Te.generate_image_alt_text==="1":Pe==="excerpt"?Te.generate_image_caption==="1":Pe==="content"?Te.generate_image_description==="1":!1:Pe==="meta"&&!_e.allowMeta||Pe==="tags"&&!_e.allowTags?!1:Pe==="title"?Te.generate_title!=="0":Pe==="content"?Te.generate_content!=="0":Pe==="meta"?Te.generate_meta_description==="1":Pe==="keyword"?Te.generate_focus_keyword==="1":Pe==="excerpt"?Te.generate_excerpt==="1":Pe==="tags"?Te.generate_tags==="1":!1,Lt=At?{title:et("title")?Gt(Te,"image_title_prompt"):"",content:et("content")?Gt(Te,"image_description_prompt"):"",meta:"",keyword:et("keyword")?Gt(Te,"image_alt_text_prompt"):"",excerpt:et("excerpt")?Gt(Te,"image_caption_prompt"):"",tags:""}:{title:et("title")?Gt(Te,"custom_title_prompt"):"",content:et("content")?Gt(Te,"custom_content_prompt"):"",meta:et("meta")?Gt(Te,"custom_meta_prompt"):"",keyword:et("keyword")?Gt(Te,"custom_keyword_prompt"):"",excerpt:et("excerpt")?Gt(Te,"custom_excerpt_prompt"):"",tags:et("tags")?Gt(Te,"custom_tags_prompt"):""},fi=[],Vt=Pe=>_e.fieldLabels?.[Pe]||r[Pe]||Pe;if(et("title")&&!Lt.title&&fi.push(`${Vt("title")} prompt is required.`),et("content")&&!Lt.content&&fi.push(`${Vt("content")} prompt is required.`),et("meta")&&!Lt.meta&&fi.push(`${Vt("meta")} prompt is required.`),et("keyword")&&!Lt.keyword&&fi.push(`${Vt("keyword")} prompt is required.`),et("excerpt")&&!Lt.excerpt&&fi.push(`${Vt("excerpt")} prompt is required.`),et("tags")&&!Lt.tags&&fi.push(`${Vt("tags")} prompt is required.`),fi.length)return{error:fi.join(" ")};let hi=[],mi=(Pe,pi)=>pi.some(Hi=>Pe.includes(Hi)),Bi=Pe=>At?o:_e.postTypeOverride==="product"&&l[Pe]||n;if(_e.fieldOrder.forEach(Pe=>{let pi=Lt[Pe];if(!pi)return;let Hi=Bi(Pe);mi(pi,Hi)||hi.push(`${Vt(Pe)} prompt: add one of ${Hi.join(", ")}.`)}),hi.length)return{error:`${At?"Image optimization":_e.postTypeOverride==="product"?"Product update":"Update"} works best when prompts include source placeholders.

${hi.join(`
`)}`};let gi=String(Te.content_length||"medium"),ti=t[gi]||t.medium,ji={ai_provider:Te.ai_provider||"openai",ai_model:Te.ai_model||"",temperature:parseFloat(Te.ai_temperature||"1"),max_tokens:ti,reasoning_effort:Te.reasoning_effort||"",generate_seo_slug:_e.allowSlug&&Te.generate_seo_slug||"0",enable_vector_store:Te.enable_vector_store||"0",vector_store_provider:Te.vector_store_provider||"openai",vector_store_top_k:Te.vector_store_top_k||"3",openai_vector_store_ids:Te.openai_vector_store_ids||[],pinecone_index_name:Te.pinecone_index_name||"",qdrant_collection_name:Te.qdrant_collection_name||"",vector_embedding_provider:Te.vector_embedding_provider||"",vector_embedding_model:Te.vector_embedding_model||""};return{prompts:Lt,baseConfig:ji}},bt=(_e,be,Te)=>({[_e]:{prompt:be},ai_provider:Te.ai_provider,ai_model:Te.ai_model,temperature:Te.temperature,max_tokens:Te.max_tokens,reasoning_effort:Te.reasoning_effort,enable_vector_store:Te.enable_vector_store,vector_store_provider:Te.vector_store_provider,vector_store_top_k:Te.vector_store_top_k,openai_vector_store_ids:Te.openai_vector_store_ids,pinecone_index_name:Te.pinecone_index_name,qdrant_collection_name:Te.qdrant_collection_name,vector_embedding_provider:Te.vector_embedding_provider,vector_embedding_model:Te.vector_embedding_model}),di=async(_e=1)=>{if(!Q){if(typeof window.aipkit_apiRequest!="function"){console.error("Content Writer Existing: aipkit_apiRequest not found.");return}Q=!0,Fe("Loading posts...");try{let Te=it().postTypeOverride||(h?h.value:""),At=await window.aipkit_apiRequest("aipkit_content_writer_fetch_existing_posts",{_ajax_nonce:$?$.value:"",post_type:Te,post_status:y?y.value:"",media_filter:E?E.value:"",search:x?x.value.trim():"",paged:_e,per_page:W});Qe(At.posts||[],At.pagination||{})}catch(be){console.error("Content Writer Existing: fetch failed",be),Fe("Unable to load posts. Please try again.")}finally{Q=!1}}},Ht=()=>{O.clear(),We()};T.addEventListener("change",_e=>{let be=_e.target;if(!be||!be.classList.contains("aipkit_cw_existing_row_checkbox"))return;let Te=Number(be.value||0);Te&&(be.checked?O.add(Te):O.delete(Te),We())}),S&&S.addEventListener("change",()=>{let _e=S.checked;R.forEach(Te=>{_e?O.add(Number(Te.id)):O.delete(Number(Te.id))}),T.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Te=>{Te.checked=_e}),We()}),A&&A.addEventListener("click",()=>{U>1&&di(U-1)}),C&&C.addEventListener("click",()=>{U<D&&di(U+1)}),w&&w.addEventListener("click",()=>{Ht(),di(1)}),h&&h.addEventListener("change",()=>{it().postTypeOverride||(ie=h.value),Ht(),di(1)}),y&&y.addEventListener("change",()=>{Ht(),di(1)}),E&&E.addEventListener("change",()=>{Ht(),di(1)}),x&&x.addEventListener("input",()=>{H&&clearTimeout(H),H=setTimeout(()=>{Ht(),di(1)},300)});let Wi=_e=>{typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(_e,{title:"Update existing"}):alert(_e)},Sn=()=>{let _e="Bulk image optimization is available on Pro. Select one image or upgrade.";if(typeof window.aipkit_showAlertModal=="function"){let be=[];d&&be.push({label:"Upgrade to Pro",href:d,className:"aipkit_btn aipkit_btn-primary"}),be.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(_e,{title:"Optimize Images",actions:be})}else alert(_e)},Ki=()=>{let _e="Optimize Products is a Pro feature.";if(typeof window.aipkit_showAlertModal=="function"){let be=[];d&&be.push({label:"Upgrade to Pro",href:d,className:"aipkit_btn aipkit_btn-primary"}),be.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(_e,{title:"Optimize Products",bullets:e,actions:be})}else alert(_e)},ln=async(_e,be,Te,At,et)=>{let Lt=`cw-existing-${_e}-${Date.now()}`,fi=!1;if(P)return ze(_e,"","Stopped"),Ze(_e),{success:!1,stopped:!0};for(let Vt of et.fieldOrder){let hi=be[Vt];if(!hi)continue;if(P)return ze(_e,"","Stopped"),Ze(_e),{success:!1,stopped:!0};ze(_e,"processing",`Updating ${et.fieldLabels[Vt]||Vt}...`);let mi=bt(Vt,hi,Te),Bi={_ajax_nonce:At,post_id:_e,field:Vt,enhancements:JSON.stringify(mi),conversation_uuid:Lt};try{let gi=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",Bi,{timeout:18e4});gi&&Object.prototype.hasOwnProperty.call(gi,"updated_value")&&(Vt==="title"?bi(_e,gi.updated_value):gt(_e,Vt,gi.updated_value)),fi=!0}catch(gi){let ti=gi&&gi.message||"Update failed. Please try again.";return ze(_e,"error",ti),{success:!1}}}if(P)return ze(_e,"","Stopped"),Ze(_e),{success:!1,stopped:!0};if(Te.generate_seo_slug==="1"&&fi){ze(_e,"processing","Updating URL...");try{await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",{_ajax_nonce:At,post_id:_e,action_type:"update_slug"},{timeout:3e4})}catch{return ze(_e,"error","URL update failed."),{success:!1}}}return fi?(ze(_e,"success","Updated"),Ze(_e),{success:!0}):(ze(_e,"error","No prompts selected."),{success:!1})},Vn=async()=>{if(F||!_t())return;let _e=Array.from(O);if(!_e.length)return;if(!p&&Ue()==="existing-content"){let{productIds:ti,otherIds:ji}=Ae(_e);if(ti.length&&!ji.length){Ki(),We();return}ti.length&&ji.length&&(ti.forEach(Pe=>{ze(Pe,"error","Skipped (Pro)"),Ze(Pe)}),_e=ji)}if(!_e.length){We();return}if(!p&&Ue()==="existing-images"&&_e.length>1){Sn();return}if(typeof window.aipkit_apiRequest!="function"){Wi("Update service is not available yet.");return}let be=window.aipkit_post_enhancer?.nonce_generate_title;if(!be){Wi("Update permission is missing. Please reload the page.");return}let Te=it(),{prompts:At,baseConfig:et,error:Lt}=Di(Te);if(Lt){!p&&Te.postTypeOverride==="product"?Ki():Wi(Lt);return}if(!Te.fieldOrder.some(ti=>!!At[ti])){Wi("No prompts selected for update.");return}P=!1,_e.forEach(ti=>{ze(ti,"queued","Queued")});let Vt=0,hi=0,mi=_e.length,Bi=null,gi=()=>{let ti=[];return ti.push(`Updating ${mi} item${mi===1?"":"s"}...`),Vt&&ti.push(`${Vt} done`),hi&&ti.push(`${hi} error${hi===1?"":"s"}`),ti.join(" ")};qt(gi(),"info"),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):Jt(!0),ei(!0);for(let ti=0;ti<_e.length;ti+=1){let ji=_e[ti];if(P){Bi=ti;break}let Pe=await ln(ji,At,et,be,Te);if(Pe&&Pe.stopped){P=!0,Bi=ti+1;break}Pe&&Pe.success?Vt+=1:hi+=1,qt(gi(),"info")}if(ei(!1),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():Jt(!1),P){(Bi!==null?_e.slice(Bi):[]).forEach(Pe=>{ze(Pe,"","Stopped"),Ze(Pe)});let ji=[`Update stopped: ${Vt} done`];hi&&ji.push(`${hi} error${hi===1?"":"s"}`),qt(ji.join(", ")+".","info")}else hi?qt(`Update complete: ${Vt} done, ${hi} error${hi===1?"":"s"}.`,"error"):qt(`Update complete: ${Vt} done.`,"success");ui(),We()};_.dataset.init="true",window.aipkit_cw_existing_handleFetch=di,window.aipkit_runContentWriterExistingUpdate=Vn,window.aipkit_cw_isExistingUpdateActive=()=>F,window.aipkit_cw_requestExistingUpdateStop=Wt,B&&!B.dataset.aipkitExistingListener&&(B.addEventListener("change",()=>{E&&(E.value=""),ci(),Ht()},!0),B.dataset.aipkitExistingListener="true"),ci(),window.aipkit_cw_existing_pendingFetch&&(di(window.aipkit_cw_existing_pendingFetch),window.aipkit_cw_existing_pendingFetch=null)}window.aipkit_initContentWriterExistingContent=m,window.aipkit_fetchContentWriterExistingPosts=f})();(function(){"use strict";let k=[{key:"custom_title_prompt",textareaId:"aipkit_cw_custom_title_prompt",updateInputId:"aipkit_cw_custom_title_prompt_update"},{key:"custom_content_prompt",textareaId:"aipkit_cw_custom_content_prompt",updateInputId:"aipkit_cw_custom_content_prompt_update"},{key:"custom_meta_prompt",textareaId:"aipkit_cw_custom_meta_prompt",updateInputId:"aipkit_cw_custom_meta_prompt_update"},{key:"custom_keyword_prompt",textareaId:"aipkit_cw_custom_keyword_prompt",updateInputId:"aipkit_cw_custom_keyword_prompt_update"},{key:"custom_excerpt_prompt",textareaId:"aipkit_cw_custom_excerpt_prompt",updateInputId:"aipkit_cw_custom_excerpt_prompt_update"},{key:"custom_tags_prompt",textareaId:"aipkit_cw_custom_tags_prompt",updateInputId:"aipkit_cw_custom_tags_prompt_update"},{key:"image_prompt",textareaId:"aipkit_cw_image_prompt",updateInputId:"aipkit_cw_image_prompt_update"},{key:"featured_image_prompt",textareaId:"aipkit_cw_featured_image_prompt",updateInputId:"aipkit_cw_featured_image_prompt_update"},{key:"image_title_prompt",textareaId:"aipkit_cw_image_title_prompt",updateInputId:"aipkit_cw_image_title_prompt_update"},{key:"image_alt_text_prompt",textareaId:"aipkit_cw_image_alt_text_prompt",updateInputId:"aipkit_cw_image_alt_text_prompt_update"},{key:"image_caption_prompt",textareaId:"aipkit_cw_image_caption_prompt",updateInputId:"aipkit_cw_image_caption_prompt_update"},{key:"image_description_prompt",textareaId:"aipkit_cw_image_description_prompt",updateInputId:"aipkit_cw_image_description_prompt_update"}],a={create:{},update:{}},r={},i=[],s="create",n=!1,c=g=>g&&g!=="single"?g:"task",l=()=>{let g=document.getElementById("aipkit_cw_mode_select");return c(g?.value||"task")},o=g=>g&&g.indexOf("existing")===0?"update":"create",e=(g,_,h)=>{if(h)return String(g||"");let y=String(g||"").trim()?g:_||"";return String(y||"")},t=()=>{if(n)return;let g=s==="update";i.forEach(({key:_,textarea:h,updateInput:y})=>{if(!h)return;let E=h.value||"";if(!g){a.create[_]=E;return}r[_]&&(a.update[_]=E,y&&(y.value=E))})},p=()=>{n=!0;let g=s==="update";i.forEach(({key:_,textarea:h,updateInput:y})=>{if(!h)return;let E=a.create[_]||"",x=a.update[_]||"",w=!!r[_],S=g?e(x,E,w):E;h.value=S||"",g&&y&&(y.value=w?x:"")}),n=!1},d=g=>{let _=o(c(g));_!==s&&(t(),s=_,p())},u=g=>{!g||g.dataset.aipkitPromptModeInit==="true"||(i=k.map(_=>{let h=g.querySelector(`#${_.textareaId}`)||document.getElementById(_.textareaId),y=g.querySelector(`#${_.updateInputId}`)||document.getElementById(_.updateInputId);return{..._,textarea:h,updateInput:y}}),i.some(_=>_.textarea)&&(i.forEach(_=>{let h=_.textarea&&_.textarea.value||"";a.create[_.key]=h;let y=_.updateInput&&_.updateInput.value||"";a.update[_.key]=y,r[_.key]=!!y,_.textarea&&!_.textarea.dataset.aipkitPromptModeListener&&(_.textarea.addEventListener("input",()=>{if(n)return;let E=_.textarea.value||"";s==="update"?(a.update[_.key]=E,r[_.key]=!0,_.updateInput&&(_.updateInput.value=E)):a.create[_.key]=E}),_.textarea.dataset.aipkitPromptModeListener="true")}),g.dataset.aipkitPromptModeInit="true",d(l())))},f=g=>{if(!g||typeof g!="object")return;let _=h=>Object.prototype.hasOwnProperty.call(g,h);i.forEach(h=>{let y=h.key,E=`${y}_update`;if(_(y)&&(a.create[y]=g[y]||""),_(E)){let x=g[E]||"";a.update[y]=x,r[y]=!!x,h.updateInput&&(h.updateInput.value=r[y]?x:"")}}),p()},m=()=>({create:{...a.create},update:{...a.update}});window.aipkit_initContentWriterPromptModeManager=u,window.aipkit_setContentWriterPromptMode=d,window.aipkit_applyContentWriterPromptSets=f,window.aipkit_getContentWriterPromptSets=m})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"],image_title:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_alt_text:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_caption:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_description:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"]},a=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}","{price}","{regular_price}","{sale_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{total_sales}","{product_categories}"],r={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},i={existing:{title:["{original_title}","{original_content}","{original_focus_keyword}"],content:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],meta:["{original_title}","{original_content}","{original_focus_keyword}","{original_tags}","{categories}"],keyword:["{original_title}","{original_content}"],excerpt:["{original_title}","{original_content}","{original_excerpt}"],tags:["{original_title}","{original_content}","{original_tags}","{categories}"],image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],featured_image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"]},"existing-images":{title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],content:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],excerpt:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],keyword:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_alt_text:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_caption:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_description:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],featured_image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"]},"existing-products":{title:a,content:a,meta:a,keyword:a,excerpt:a,tags:a}},s={aipkit_cw_image_title_prompt:"image_title",aipkit_cw_image_alt_text_prompt:"image_alt_text",aipkit_cw_image_caption_prompt:"image_caption",aipkit_cw_image_description_prompt:"image_description"},n=d=>String(d??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),c=()=>{let u=document.getElementById("aipkit_cw_mode_select")?.value||"task";return u==="single"&&(u="task"),u},l=(d,u)=>{let f=window.aipkit_content_writer_config?.default_prompts||{};if(u==="existing-images"){let m=`${d}_update`;if(f[m])return f[m]}return f[d]||""},o=(d,u)=>{let f=i[u]||(u.indexOf("existing")===0?i.existing:null);if(f&&f[d])return f[d];let m=k[d]||[],g=r[u]||[],_=[...m,...g];return _.filter((h,y)=>_.indexOf(h)===y)},e=(d,u)=>{if(!d)return;let f=d.dataset.label||"Variables:",m=d.dataset.copyTitle||"Click to copy";d.innerHTML=`${n(f)} `,u.forEach((g,_)=>{let h=document.createElement("code");h.className="aipkit-placeholder",h.title=m,h.textContent=g,d.appendChild(h),_<u.length-1&&d.appendChild(document.createTextNode(" "))})},t=d=>{let u=d?.querySelector(".aipkit_cw_prompt_editor_placeholders");if(!u)return;let f=u.dataset.promptType||"",m=c(),g=o(f,m);e(u,g)};function p(d){if(!d)return;let u=d.querySelectorAll("[data-aipkit-flyout-target]");if(!u.length)return;let f=d.querySelectorAll(".aipkit_cw_prompt_library_select"),m=v=>{f.length&&f.forEach(A=>{let C=A.getAttribute("data-aipkit-prompt-target"),b=s[C];if(!b)return;let L=A.options?A.options[0]:null;if(!L)return;if(Array.from(A.options).forEach(($,W)=>{let U=$.dataset.aipkitMode||"both",D=!0;W!==0&&(v==="existing-images"?D=U!=="create":D=U!=="update"),$.hidden=!D}),A.dataset.aipkitDefaultCreate||(A.dataset.aipkitDefaultCreate=L.value||""),v==="existing-images"){let $=l(b,v);$&&(A.dataset.aipkitDefaultUpdate=$,L.value=$)}else L.value=A.dataset.aipkitDefaultCreate||L.value||"";A.selectedOptions.length&&A.selectedOptions[0].hidden&&(A.selectedIndex=0)})},g=null,_=null,h=!1,y=v=>v?d.querySelector(`#${v}`):null,E=(v,A,C)=>{if(!v||!A)return;let b=v.getBoundingClientRect(),L=C?C.getBoundingClientRect():b,B=A.getBoundingClientRect(),$=B.width||440,W=B.height||0,U=window.innerWidth,D=window.innerHeight,H=12,Q=L.left-$-10;Q<H&&(Q=L.right+10),Q=Math.max(H,Math.min(Q,U-$-H));let F=L.top;F+W>D-H&&(F=D-W-H),F=Math.max(H,F),g.style.left=`${Math.round(Q)}px`,g.style.top=`${Math.round(F)}px`},x=()=>{!_||!g||h||(h=!0,window.requestAnimationFrame(()=>{let v=g.querySelector(".aipkit_cw_prompt_panel"),A=_.closest(".aipkit_model_settings_popover_panel");E(_,v,A),h=!1}))},w=()=>{g&&(g.classList.remove("is-open"),g.setAttribute("aria-hidden","true"),_&&_.setAttribute("aria-expanded","false"),g=null,_=null)},S=v=>{let A=v.getAttribute("data-aipkit-flyout-target"),C=y(A);if(!C)return;g&&g!==C&&w(),g=C,_=v,C.classList.add("is-open"),C.setAttribute("aria-hidden","false"),v.setAttribute("aria-expanded","true"),t(C);let b=C.querySelector(".aipkit_cw_prompt_panel"),L=v.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{E(v,b,L)})};u.forEach(v=>{v.dataset.flyoutListenerAttached!=="true"&&(v.addEventListener("click",A=>{if(A.preventDefault(),g&&_===v&&g.classList.contains("is-open")){w();return}S(v)}),v.dataset.flyoutListenerAttached="true")});let T=c();if(m(T),f.forEach(v=>{let A=v.getAttribute("data-aipkit-prompt-target"),C=A?d.querySelector(`#${A}`):null;C&&typeof C.value=="string"&&C.value.trim()===""&&v.value&&(C.value=v.value),v.dataset.promptLibraryAttached!=="true"&&(v.addEventListener("change",()=>{let b=v.value;if(!b)return;let L=v.getAttribute("data-aipkit-prompt-target"),B=L?d.querySelector(`#${L}`):null;if(!B)return;B.value=b,B.dispatchEvent(new Event("input",{bubbles:!0})),typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave();let $=v.options?v.options[0]:null;$&&$.value===""&&(v.value="",v.selectedIndex=0)}),v.dataset.promptLibraryAttached="true")}),d.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(v=>{v.dataset.overlayListenerAttached!=="true"&&(v.addEventListener("click",C=>{C.target===v&&w()}),v.dataset.overlayListenerAttached="true");let A=v.querySelector(".aipkit_popover_flyout_close");A&&A.dataset.flyoutListenerAttached!=="true"&&(A.addEventListener("click",C=>{C.preventDefault(),w()}),A.dataset.flyoutListenerAttached="true")}),d.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",v=>{v.key==="Escape"&&g&&w()}),d.dataset.promptFlyoutEscapeAttached="true"),d.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",v=>{if(!g)return;let A=v.target;A.closest(".aipkit_cw_prompt_flyout")||A.closest("[data-aipkit-flyout-target]")||w()}),d.dataset.promptFlyoutClickAttached="true"),d.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",x),window.addEventListener("scroll",x,!0),d.dataset.promptFlyoutRepositionAttached="true"),d.dataset.promptFlyoutModeAttached!=="true"){let v=document.getElementById("aipkit_cw_mode_select");v&&v.addEventListener("change",()=>{m(c()),g&&t(g)}),d.dataset.promptFlyoutModeAttached="true"}window.aipkit_closeContentWriterPromptFlyout=w}window.aipkit_initContentWriterPromptFlyouts=p})();(function(){"use strict";let r=c=>String(c||"").replace(/\|/g," ").replace(/\r?\n/g," ").trim(),i=c=>{let l=String(c||"").trim();if(!l)return{value:"",raw:""};let o=l.match(/^(\d{4}-\d{2}-\d{2})(?:[T\s])(\d{2}:\d{2})(?::\d{2})?$/);return o?{value:`${o[1]}T${o[2]}`,raw:""}:{value:"",raw:l}},s=c=>c?c.replace("T"," ").trim():"";function n(c){let l=c||document.getElementById("aipkit_content_writer_container");if(!l)return;let o=l.querySelector("[data-aipkit-bulk-editor]");if(!o||o.dataset.bulkEditorAttached==="true")return;let e=o.querySelector("[data-aipkit-bulk-rows]"),t=o.querySelector("#aipkit_cw_bulk_row_template"),p=o.querySelector("#aipkit_cw_bulk_topics"),d=o.querySelector(".aipkit_cw_bulk_add_row"),u=o.querySelector(".aipkit_cw_bulk_toggle_raw"),f=o.querySelector("#aipkit_cw_bulk_raw"),m=o.querySelector(".aipkit_cw_bulk_grid"),g=o.querySelector(".aipkit_cw_bulk_toggle_details");if(!e||!t||!p)return;let _=!1,h,y=($,W)=>$?$.querySelector(`[data-bulk-field="${W}"]`):null,E=()=>{Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")).forEach((W,U)=>{let D=W.querySelector(".aipkit_cw_bulk_row_number");D&&(D.textContent=U+1)})},x=$=>{let W=r(y($,"topic")?.value||""),U=r(y($,"keywords")?.value||""),D=r(y($,"category")?.value||""),H=r(y($,"author")?.value||""),Q=r(y($,"type")?.value||""),F=y($,"schedule")?.value||"";return F?(F=s(F),$.dataset.rawSchedule=""):$.dataset.rawSchedule&&(F=$.dataset.rawSchedule),{topic:W,keywords:U,category:D,author:H,type:Q,schedule:F}},w=($,W)=>{if(!$||!W)return;let U=(H,Q)=>{let F=y($,H);F&&(F.value=Q||"")};U("topic",W.topic||""),U("keywords",W.keywords||""),U("category",W.category||""),U("author",W.author||""),U("type",W.type||"");let D=y($,"schedule");if(D){let H=i(W.schedule||"");D.value=H.value,$.dataset.rawSchedule=H.raw||""}},S=()=>{let $=Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")),W=[];return $.forEach(U=>{let{topic:D,keywords:H,category:Q,author:F,type:P,schedule:R}=x(U);if(!D)return;let O=[D,H,Q,F,P,R],N=-1;O.forEach((ie,J)=>{ie&&(N=J)}),N!==-1&&W.push(O.slice(0,N+1).join(" | "))}),W.join(`
`)},T=()=>{p&&(_=!0,p.value=S(),p.dispatchEvent(new Event("change",{bubbles:!0})),_=!1)},v=$=>{o.classList.toggle("is-details-open",$),g&&g.setAttribute("aria-expanded",$?"true":"false")},A=$=>{if(f){if(o.classList.toggle("is-raw-open",$),f.hidden=!$,u){u.setAttribute("aria-expanded",$?"true":"false");let W=$?u.dataset.labelGrid:u.dataset.labelRaw;if(W){let U=u.querySelector(".aipkit_cw_toggle_label");U?U.textContent=W:u.textContent=W}}m&&(m.hidden=$),d&&(d.hidden=$,d.disabled=$),g&&(g.hidden=$,$&&g.setAttribute("aria-expanded","false"))}},C=$=>{let U=document.importNode(t.content,!0).querySelector("[data-aipkit-bulk-row]");return U?(w(U,$||{}),U):null},b=()=>{let $=e.querySelectorAll("[data-aipkit-bulk-row]");if($.length>=1)return;let W=1-$.length;for(let U=0;U<W;U++){let D=C();D&&e.appendChild(D)}},L=()=>{let $=Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")),W=$[$.length-1];if(!W)return;let U=x(W);if(Object.values(U).some(H=>H)&&$.length<100){let H=C();H&&(e.appendChild(H),E())}},B=()=>{let W=(p.value||"").split(/\r?\n/).filter(D=>D.trim()!=="");e.innerHTML="";let U=[];if(W.slice(0,100).forEach(D=>{let H=D.split("|").map(P=>P.trim()),Q={topic:H[0]||"",keywords:H[1]||"",category:H[2]||"",author:H[3]||"",type:H[4]||"",schedule:H[5]||""},F=C(Q);F&&U.push(F)}),!U.length){b(),E(),T();return}U.forEach(D=>e.appendChild(D)),b(),E()};p.value.trim()?B():(b(),E(),T()),A(!f.hidden),g&&!g.dataset.listenerAttached&&(g.addEventListener("click",$=>{$.preventDefault();let W=o.classList.contains("is-details-open");v(!W)}),g.dataset.listenerAttached="true",v(!1)),e.addEventListener("input",$=>{let W=$.target;!W||!W.closest("[data-aipkit-bulk-row]")||(T(),L())}),e.addEventListener("change",$=>{let W=$.target;!W||!W.closest("[data-aipkit-bulk-row]")||(T(),L())}),e.addEventListener("click",$=>{let W=$.target.closest(".aipkit_cw_bulk_remove_row");if(!W)return;let U=W.closest("[data-aipkit-bulk-row]");if(!U)return;e.querySelectorAll("[data-aipkit-bulk-row]").length<=1?U.querySelectorAll("input, select").forEach(H=>{H.value=""}):U.remove(),T(),E(),L()}),d&&d.addEventListener("click",$=>{if($.preventDefault(),e.querySelectorAll("[data-aipkit-bulk-row]").length>=100)return;let U=C();U&&e.appendChild(U),E()}),u&&f&&u.addEventListener("click",$=>{$.preventDefault();let W=!f.hidden;A(!W)}),p.addEventListener("input",()=>{_||(clearTimeout(h),h=setTimeout(()=>{B()},250))}),o.dataset.bulkEditorAttached="true"}window.aipkit_initContentWriterBulkEditor=n})();(function(){"use strict";let k=null,a=0;function r(){if(!k)return;let n=k;k=null,n.classList.remove("aipkit-active"),n.__aipkitAlertKeydown&&(document.removeEventListener("keydown",n.__aipkitAlertKeydown),n.__aipkitAlertKeydown=null);let c=()=>{n.parentNode&&n.parentNode.removeChild(n)};n.addEventListener("transitionend",c,{once:!0}),window.setTimeout(c,250)}function i(n,c={}){let l=c.title||"Notice",o=c.okText||"OK",e=c.okClass||"aipkit_btn-primary",t=Array.isArray(c.actions)?c.actions:null,p=Array.isArray(c.bullets)?c.bullets:null;k&&r();let d=document.createElement("div");d.className="aipkit-modal-overlay",d.addEventListener("click",S=>{S.target===d&&r()});let u=`aipkit_cw_alert_${Date.now()}_${a++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${u}_title`);let m=document.createElement("div");m.className="aipkit-modal-header";let g=document.createElement("h3");g.className="aipkit-modal-title",g.id=`${u}_title`,g.textContent=l;let _=document.createElement("button");_.type="button",_.className="aipkit-modal-close-btn",_.setAttribute("aria-label","Close"),_.textContent="\xD7",m.appendChild(g),m.appendChild(_);let h=document.createElement("div");h.className="aipkit-modal-body";let y=document.createElement("p");if(y.className="aipkit_cw_alert_modal_message",y.textContent=n||"",p&&p.length){let S=document.createElement("ul");S.className="aipkit_cw_alert_modal_list",p.forEach(T=>{let v=document.createElement("li");v.textContent=T,S.appendChild(v)}),h.appendChild(y),h.appendChild(S)}else h.appendChild(y);let E=document.createElement("div");E.className="aipkit_cw_alert_modal_actions";let x=null;if(t&&t.length)t.forEach((S,T)=>{let v=!!(S&&S.href),A=S?.label||(T===0?o:"Close"),C=S?.className||(T===0?"aipkit_btn aipkit_btn-primary":"aipkit_btn aipkit_btn-secondary"),b=document.createElement(v?"a":"button");b.className=C,b.textContent=A,v?(b.href=S.href,b.target=S.target||"_blank",b.rel=S.rel||"noopener noreferrer"):b.type="button";let L=()=>{typeof S?.onClick=="function"&&S.onClick(),S?.closeOnClick!==!1&&r()};b.addEventListener("click",L),E.appendChild(b),x||(x=b)});else{let S=document.createElement("button");S.type="button",S.className=`aipkit_btn ${e}`,S.textContent=o,S.addEventListener("click",r),E.appendChild(S),x=S}h.appendChild(E),f.appendChild(m),f.appendChild(h),d.appendChild(f),document.body.appendChild(d);let w=S=>{S.key==="Escape"&&r()};d.__aipkitAlertKeydown=w,document.addEventListener("keydown",w),_.addEventListener("click",r),window.requestAnimationFrame(()=>{d.classList.add("aipkit-active"),x&&x.focus()}),k=d}function s(n,c={}){let l=c.title||"Confirm",o=c.confirmText||"Confirm",e=c.cancelText||"Cancel",t=typeof c.onConfirm=="function"?c.onConfirm:null,p=typeof c.onCancel=="function"?c.onCancel:null;k&&r();let d=document.createElement("div");d.className="aipkit-modal-overlay",d.addEventListener("click",T=>{T.target===d&&(r(),p&&p())});let u=`aipkit_cw_confirm_${Date.now()}_${a++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${u}_title`);let m=document.createElement("div");m.className="aipkit-modal-header";let g=document.createElement("h3");g.className="aipkit-modal-title",g.id=`${u}_title`,g.textContent=l;let _=document.createElement("button");_.type="button",_.className="aipkit-modal-close-btn",_.setAttribute("aria-label","Close"),_.textContent="\xD7",m.appendChild(g),m.appendChild(_);let h=document.createElement("div");h.className="aipkit-modal-body";let y=document.createElement("p");y.className="aipkit_cw_alert_modal_message",y.textContent=n||"";let E=document.createElement("div");E.className="aipkit_cw_alert_modal_actions";let x=document.createElement("button");x.type="button",x.className="aipkit_btn aipkit_btn-secondary",x.textContent=e;let w=document.createElement("button");w.type="button",w.className="aipkit_btn aipkit_btn-primary",w.textContent=o,E.appendChild(x),E.appendChild(w),h.appendChild(y),h.appendChild(E),f.appendChild(m),f.appendChild(h),d.appendChild(f),document.body.appendChild(d);let S=T=>{T.key==="Escape"&&(r(),p&&p())};d.__aipkitAlertKeydown=S,document.addEventListener("keydown",S),_.addEventListener("click",()=>{r(),p&&p()}),x.addEventListener("click",()=>{r(),p&&p()}),w.addEventListener("click",()=>{r(),t&&t()}),window.requestAnimationFrame(()=>{d.classList.add("aipkit-active"),w.focus()}),k=d}window.aipkit_showAlertModal=i,window.aipkit_showConfirmModal=s,window.aipkit_closeAlertModal=r})();(function(){"use strict";function k(a,r){if(!a||!r||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(a.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(a,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(a,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary();else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let i=window.aipkit_escapeHtml||function(s){return s};r.innerHTML='<option value="">'+i("Models unavailable (Data Object Missing)")+"</option>",r.disabled=!0}}window.aipkit_handleProviderModelDropdowns=k})();(function(){"use strict";function k(a){if(!a){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let r=document.getElementById("aipkit_content_writer_temperature_value");r?a.dataset.listenerAttached||(a.addEventListener("input",()=>r.textContent=a.value),a.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=k})();(function(){"use strict";function k(a){if(!a){console.warn("Copy Button Handler: Button element not provided.");return}a.dataset.listenerAttached||(a.addEventListener("click",()=>{let r=document.getElementById("aipkit_cw_generated_title_display"),i=document.getElementById("aipkit_cw_generated_content_area"),s="";r&&r.style.display!=="none"&&(s+=r.textContent+`

`),i&&(s+=i.innerText),s.trim()&&navigator.clipboard.writeText(s.trim()).then(()=>{let n=a.querySelector(".dashicons");if(n){let c=n.className;n.className="dashicons dashicons-yes",setTimeout(()=>{n.className=c},1500)}}).catch(n=>console.error("Failed to copy: ",n))}),a.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_single_output_wrapper"),i=document.getElementById("aipkit_cw_output_card"),s=document.getElementById("aipkit_content_writer_output_display"),n=document.getElementById("aipkit_cw_generated_content_area"),c=document.querySelector(".aipkit_content_writer_output_actions"),l=document.getElementById("aipkit_cw_status_display_container"),o=document.getElementById("aipkit_cw_generated_title_display"),e=document.getElementById("aipkit_cw_meta_chunk"),t=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),p=document.getElementById("aipkit_cw_generated_meta_desc"),d=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),u=document.getElementById("aipkit_cw_generated_focus_keyword"),f=document.getElementById("aipkit_cw_excerpt_output_wrapper"),m=document.getElementById("aipkit_cw_generated_excerpt"),g=document.getElementById("aipkit_cw_tags_output_wrapper"),_=document.getElementById("aipkit_cw_generated_tags"),h=document.getElementById("aipkit_cw_image_data_holder"),y=document.getElementById("aipkit_content_writer_copy_btn"),E=document.getElementById("aipkit_content_writer_clear_btn");if(r&&(r.style.display="none"),i&&(i.style.display="none"),s&&n){n.classList.remove("is-streaming");let x=n.closest(".aipkit_cw_output_chunk--primary");x&&x.classList.remove("has-overflow"),n.innerHTML="",s.scrollTop=0,c&&(c.style.display="none"),y&&(y.disabled=!0),E&&(E.disabled=!0),typeof window.aipkit_resetContentWriterRawHtml=="function"&&window.aipkit_resetContentWriterRawHtml(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction();let w=document.getElementById("aipkit_content_writer_form_status");w&&(w.textContent=""),l&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():l&&(l.style.display="none"),o&&(o.style.display="none",o.textContent=""),e&&(e.style.display="none"),t&&(t.style.display="none"),p&&(p.value=""),d&&(d.style.display="none"),u&&(u.value=""),f&&(f.style.display="none"),m&&(m.value=""),g&&(g.style.display="none"),_&&(_.value=""),h&&(h.value=""),typeof window.aipkit_updateMetaCountBadge=="function"&&window.aipkit_updateMetaCountBadge(),typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_resetContentWriterPreviewCounter=="function"&&window.aipkit_resetContentWriterPreviewCounter()}}function a(r,i){if(!r){console.warn("Clear Button Handler: Button element not provided.");return}r.dataset.listenerAttached||(r.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),r.dataset.listenerAttached="true")}window.aipkit_handleClearButton=a,window.aipkit_clearContentWriterOutput=k})();(function(){"use strict";function k(){return document.getElementById("aipkit_cw_expand_preview_btn")}function a(e){return e?e.closest(".aipkit_cw_output_chunk--primary"):document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_chunk--primary")}function r(e,t,p){return e?t==="restore"?e.dataset.labelRestore||p:e.dataset.labelExpand||p:p}function i(e,t){if(!e)return;let p=e.querySelector(".aipkit_cw_expand_label"),d=e.querySelector(".dashicons"),u=t?r(e,"restore","Restore preview"):r(e,"expand","Expand preview");p&&(p.textContent=u),e.setAttribute("title",u),e.setAttribute("aria-pressed",t?"true":"false"),d&&(d.classList.toggle("dashicons-fullscreen-alt",!t),d.classList.toggle("dashicons-fullscreen-exit-alt",t))}function s(e){let t=document.getElementById("aipkit_content_writer_output_display");!t||!e||(t.scrollHeight>t.clientHeight?e.classList.add("has-overflow"):e.classList.remove("has-overflow"))}function n(e){let t=k(),p=a(t);!t||!p||(e?p.classList.add("is-expanded"):p.classList.remove("is-expanded"),i(t,e),requestAnimationFrame(()=>s(p)))}function c(e){let t=k();t&&(t.disabled=!e,t.setAttribute("aria-disabled",e?"false":"true"),e||n(!1))}function l(){n(!1)}function o(){document.body?.dataset?.aipkitPreviewToggleAttached!=="true"&&(document.addEventListener("click",e=>{let t=e.target.closest("#aipkit_cw_expand_preview_btn");if(!t||t.disabled)return;let p=a(t);if(!p)return;let d=p.classList.contains("is-expanded");n(!d)}),document.body&&(document.body.dataset.aipkitPreviewToggleAttached="true"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o(),window.aipkit_resetContentWriterPreviewSize=l,window.aipkit_setContentWriterPreviewExpandEnabled=c})();(function(){"use strict";let k=_=>!_||typeof _!="object"?"":_.media_library_url||_.url||_.src||_.image_url||_.preview_url||"",a=_=>_==null?"":String(_).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=()=>{if(typeof window.aipkit_getContentWriterRawHtml=="function")return window.aipkit_getContentWriterRawHtml()||"";let _=document.getElementById("aipkit_cw_generated_content_area");return _?_.innerHTML:""},i=()=>{let _=document.getElementById("aipkit_cw_generated_content_area");if(!_)return;let h=r();h&&(_.innerHTML=h)},s=()=>({preview:document.getElementById("aipkit_cw_image_preview"),featuredWrap:document.getElementById("aipkit_cw_featured_image"),featuredImg:document.getElementById("aipkit_cw_featured_image_img"),inlineToggle:document.getElementById("aipkit_cw_inline_images_toggle"),inlineCount:document.getElementById("aipkit_cw_inline_images_count"),inlineGrid:document.getElementById("aipkit_cw_inline_images_grid")}),n=(_,h,y="")=>{_&&(_.hidden=!h,h?_.style.display=y||"":_.style.display="none")},c=_=>{_&&(_.innerHTML="",n(_,!1,"grid"))},l=()=>{let _=s();_.preview&&(_.featuredImg&&_.featuredImg.removeAttribute("src"),n(_.featuredWrap,!1,"flex"),_.inlineToggle&&(_.inlineToggle.setAttribute("aria-expanded","false"),_.inlineToggle.classList.remove("is-open")),_.inlineCount&&(_.inlineCount.textContent="0"),c(_.inlineGrid),n(_.inlineToggle,!1,"inline-flex"),n(_.preview,!1,"flex"),i())},o=_=>{!_.inlineToggle||!_.inlineGrid||_.inlineToggle.dataset.listenerAttached!=="true"&&(_.inlineToggle.addEventListener("click",()=>{let h=_.inlineToggle.getAttribute("aria-expanded")==="true";_.inlineToggle.setAttribute("aria-expanded",h?"false":"true"),_.inlineToggle.classList.toggle("is-open",!h),n(_.inlineGrid,!h,"grid")}),_.inlineToggle.dataset.listenerAttached="true")},e=(_,h)=>{if(!_.inlineToggle||!_.inlineGrid||!h.length)return!1;c(_.inlineGrid);let y=document.createDocumentFragment();return h.forEach((E,x)=>{let w=document.createElement("div");w.className="aipkit_cw_inline_image";let S=document.createElement("img");S.src=E,S.alt=`Generated image ${x+1}`,S.loading="lazy",S.decoding="async",w.appendChild(S),y.appendChild(w)}),_.inlineGrid.appendChild(y),n(_.inlineGrid,!1,"grid"),n(_.inlineToggle,!0,"inline-flex"),_.inlineToggle.setAttribute("aria-expanded","false"),_.inlineToggle.classList.remove("is-open"),_.inlineCount&&(_.inlineCount.textContent=String(h.length)),o(_),!0},t=(_,h,y)=>{let E=k(_);if(!E)return"";let x=_.alt||_.revised_prompt||_.caption||"Image",w=[];return["left","right","center","none"].includes(h)&&w.push(`align${h}`),w.push(`size-${y||"large"}`),`<img class="${a(w.join(" "))}" src="${a(E)}" alt="${a(x)}" loading="lazy" decoding="async" />`},p=(_,h)=>h.length?`${_}

${h.join(`

`)}`:_,d=(_,h,y)=>{if(!h.length)return _;let E=h.shift(),x=_.toLowerCase(),w=`</${y}>`,S=x.indexOf(w);return S!==-1?_=_.slice(0,S+w.length)+`

${E}

`+_.slice(S+w.length):_+=`

${E}`,p(_,h)},u=(_,h,y,E)=>{if(!h.length)return _;if(!E||E<=0)return p(_,h);let x=_.split(new RegExp(`(</${y}>)`,"ig")),w="",S=0,T=0;for(let v=0;v<x.length;v+=1)w+=x[v],v%2===1&&(S+=1,S%E===0&&T<h.length&&(w+=`

${h[T]}

`,T+=1));for(;T<h.length;)w+=`

${h[T]}`,T+=1;return w},f=_=>{let h=document.getElementById("aipkit_cw_generated_content_area");if(!h)return;let y=Array.isArray(_?.in_content_images)?_.in_content_images:[];if(!y.length){i();return}let E=r();if(E||(E=h.innerHTML),!E)return;let x=document.getElementById("aipkit_content_writer_form"),w=_?.placement_settings?.placement||x?.elements.image_placement?.value||"after_first_h2",S=_?.placement_settings?.param_x||x?.elements.image_placement_param_x?.value||2,T=parseInt(S,10)||2,v=x?.elements.image_alignment?.value||"none",A=x?.elements.image_size?.value||"large",C=y.map(L=>t(L,v,A)).filter(Boolean);if(!C.length){i();return}let b=E;switch(w){case"after_first_h2":b=d(b,C,"h2");break;case"after_first_h3":b=d(b,C,"h3");break;case"after_every_x_h2":b=u(b,C,"h2",T);break;case"after_every_x_h3":b=u(b,C,"h3",T);break;case"after_every_x_p":b=u(b,C,"p",T);break;case"at_end":default:b=p(b,C);break}h.innerHTML=b,typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()},m=(_,h)=>!_.featuredWrap||!_.featuredImg||!h?!1:(_.featuredImg.src=h,n(_.featuredWrap,!0,"flex"),!0),g=_=>{let h=s();if(!h.preview)return;l();let y=_;if(typeof _=="string")try{y=JSON.parse(_)}catch{return}if(!y||typeof y!="object")return;let x=(Array.isArray(y.in_content_images)?y.in_content_images:[]).map(k).filter(Boolean),w=y.featured_image_url||k(y.featured_image)||k(y.featured_image_data),S=m(h,w),T=e(h,x);f(y),(S||T)&&n(h.preview,!0,"flex")};window.aipkit_renderContentWriterImagePreview=g,window.aipkit_clearContentWriterImagePreview=l})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let i=r.elements.generate_meta_description,s=r.elements.generate_focus_keyword,n=r.elements.generate_excerpt,c=r.elements.generate_tags,l=r.querySelector(".aipkit_cw_prompt_row--meta"),o=r.querySelector(".aipkit_cw_prompt_row--keyword"),e=r.querySelector(".aipkit_cw_prompt_row--excerpt"),t=r.querySelector(".aipkit_cw_prompt_row--tags"),p=!!(i&&i.checked),d=!!(s&&s.checked),u=!!(n&&n.checked),f=!!(c&&c.checked),m=(_,h)=>{if(!_)return;_.classList.toggle("aipkit_popover_option_row--disabled",!h);let y=_.querySelector(".aipkit_cw_prompt_trigger");y&&(y.disabled=!h,y.setAttribute("aria-disabled",h?"false":"true"))};m(l,p),m(o,d),m(e,u),m(t,f);let g=r.querySelector(".aipkit_cw_prompt_flyout.is-open");if(g){let _=[];p||_.push("aipkit_cw_meta_prompt_flyout"),d||_.push("aipkit_cw_keyword_prompt_flyout"),u||_.push("aipkit_cw_excerpt_prompt_flyout"),f||_.push("aipkit_cw_tags_prompt_flyout"),_.includes(g.id)&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout()}}function a(){let r=document.getElementById("aipkit_content_writer_form");if(!r||r.dataset.optionToggleListenerAttached)return;let i=r.elements.generate_meta_description,s=r.elements.generate_focus_keyword,n=r.elements.generate_excerpt,c=r.elements.generate_tags;i&&i.addEventListener("change",k),s&&s.addEventListener("change",k),n&&n.addEventListener("change",k),c&&c.addEventListener("change",k),r.dataset.optionToggleListenerAttached="true",k()}window.aipkit_cw_toggleCustomOptionPrompts=k,window.aipkit_cw_initOptionPromptToggles=a})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.warn("Prompt Toggle Handler: Content writer container not found.");return}a.querySelectorAll(".aipkit_textarea_toggle").forEach(s=>{let n=s.dataset.target;if(!n)return;let c=`aipkit-cw-prompt-${n}-state`,l=localStorage.getItem(c),o=document.getElementById(n),e=s.querySelector(".dashicons");o&&e&&(l==="expanded"?(o.classList.remove("aipkit_collapsed"),e.classList.remove("dashicons-plus-alt2"),e.classList.add("dashicons-minus"),s.title="Collapse"):(o.classList.add("aipkit_collapsed"),e.classList.remove("dashicons-minus"),e.classList.add("dashicons-plus-alt2"),s.title="Expand"))});let i="data-prompt-toggle-listener-attached";a.getAttribute(i)||(a.addEventListener("click",function(s){let n=s.target.closest(".aipkit_textarea_toggle");if(!n)return;let c=n.dataset.target,l=document.getElementById(c),o=n.querySelector(".dashicons");if(!l||!o){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",n);return}let e=l.classList.toggle("aipkit_collapsed");e?(o.classList.remove("dashicons-minus"),o.classList.add("dashicons-plus-alt2"),n.title="Expand"):(o.classList.remove("dashicons-plus-alt2"),o.classList.add("dashicons-minus"),n.title="Collapse");let t=`aipkit-cw-prompt-${c}-state`;localStorage.setItem(t,e?"collapsed":"expanded")}),a.setAttribute(i,"true"))}window.aipkit_initPromptToggles=k})();(function(){"use strict";let k="";function a(d){k=typeof d=="string"?d:""}function r(){return k||""}function i(){k=""}function s(){let d=document.getElementById("aipkit_cw_meta_chunk");if(!d)return;let u=!1;d.querySelectorAll(".aipkit_cw_meta_field").forEach(m=>{window.getComputedStyle(m).display!=="none"&&(u=!0)}),d.style.display=u?"block":"none"}function n(){let d=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");d&&(d.style.display="flex")}function c(){let d=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");d&&(d.style.display="none")}function l(){let d=document.getElementById("aipkit_cw_article_counter"),u=document.getElementById("aipkit_cw_generated_content_area");if(!d||!u)return;if(u.querySelector(".aipkit_spinner")){d.textContent="",d.hidden=!0;return}let m=(u.textContent||"").trim(),g=m?m.split(/\s+/).length:0;if(!g){d.textContent="",d.hidden=!0;return}let _=g===1?"word":"words";d.textContent=`${g} ${_}`,d.hidden=!1}function o(){let d=document.getElementById("aipkit_cw_generated_content_area");if(!d)return;let u=!1,f=()=>{u||(u=!0,window.requestAnimationFrame(()=>{u=!1,l()}))};new MutationObserver(()=>{f()}).observe(d,{childList:!0,subtree:!0,characterData:!0}),f()}function e(){let d=document.getElementById("aipkit_cw_generated_meta_desc"),u=document.querySelector("#aipkit_content_writer_container .aipkit_cw_meta_char_count");if(!d||!u)return;function f(){let m=d.value.length,g=m>=120&&m<=160;u.textContent=`${m}/160`,u.style.color=g?"#16a34a":m>160?"#dc2626":"#94a3b8"}d.addEventListener("input",f),f()}function t(){if(!document.getElementById("aipkit_cw_meta_chunk"))return;let u=new MutationObserver(function(m){m.forEach(function(g){g.type==="attributes"&&g.attributeName==="style"&&s()})});["aipkit_cw_excerpt_output_wrapper","aipkit_cw_tags_output_wrapper","aipkit_cw_focus_keyword_output_wrapper","aipkit_cw_meta_desc_output_wrapper"].forEach(m=>{let g=document.getElementById(m);g&&u.observe(g,{attributes:!0,attributeFilter:["style"]})})}function p(){e(),t(),o()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p(),window.aipkit_updateMetaChunkVisibility=s,window.aipkit_showPrimaryAction=n,window.aipkit_hidePrimaryAction=c,window.aipkit_updateContentWriterPreviewCounter=l,window.aipkit_setContentWriterRawHtml=a,window.aipkit_getContentWriterRawHtml=r,window.aipkit_resetContentWriterRawHtml=i,window.aipkit_resetContentWriterPreviewCounter=function(){let d=document.getElementById("aipkit_cw_article_counter");d&&(d.textContent="",d.hidden=!0)}})();(function(){"use strict";function k(n){if(!n)return;let c=n.querySelector("#aipkit_content_writer_provider"),l=n.querySelector("#aipkit_content_writer_model"),o=n.querySelector(".aipkit_cw_reasoning_effort_field"),e=n.querySelector("#aipkit_content_writer_reasoning_effort");if(!c||!l||!o||!e){o&&(o.style.display="none");return}let t=(c.value||"").toLowerCase(),d=(l.value||"").toLowerCase(),u=d.startsWith("o1")||d.startsWith("o3")||d.startsWith("o4"),f=d.includes("gpt-5");t==="openai"&&(u||f)?(o.classList.contains("aipkit_popover_option_row")||o.classList.contains("aipkit_ai_behavior_control")?o.style.display="flex":o.style.display="block",a(n,d)):o.style.display="none"}function a(n,c){let l=n.querySelector("#aipkit_content_writer_reasoning_effort"),o=n.querySelectorAll(".aipkit_ai_reasoning_option");if(!l||!o.length)return;let e=r(c),t=new Set(e.allowed);o.forEach(m=>{let g=m.querySelector(".aipkit_ai_reasoning_input");if(!g)return;let _=g.value==="minimal"?"low":g.value,h=t.has(_);m.style.display=h?"":"none",h||(g.checked=!1)});let p=l.value||"";p==="minimal"&&(p="low");let d=n.querySelector(".aipkit_ai_reasoning_input:checked");!t.has(p)&&d&&(p=d.value),t.has(p)||(p=e.defaultValue),t.has(p)||(p=e.allowed[0]||"");let u=l.value;p&&(l.value=p);let f=n.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(f){f.checked=!0,n.querySelectorAll(".aipkit_ai_reasoning_option").forEach(g=>g.classList.remove("aipkit_ai_reasoning_option--selected"));let m=f.closest(".aipkit_ai_reasoning_option");m&&m.classList.add("aipkit_ai_reasoning_option--selected")}u!==l.value&&l.dispatchEvent(new Event("change",{bubbles:!0}))}function r(n){return s(n)?{allowed:["high"],defaultValue:"high"}:n.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(n)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(n){let c=n.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let l=n.match(/gpt-(\d+)/);return l?Number.parseInt(l[1],10)>=6:!1}function s(n){return/gpt-5(\.\d+)?-pro/.test(n)}window.aipkit_cw_toggleReasoningEffort=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(g){return g},a=["pexels_api_key","pixabay_api_key"],r={},i={},s="",n=!1,c=!1,l="";function o(g){a.forEach(_=>{let h=g.querySelector(`.aipkit_cw_stock_api_key[name="${CSS.escape(_)}"]`);r[_]=h?h.value.trim():"",i[_]=!1})}function e(g){let _=g.querySelector("#aipkit_cw_replicate_api_key");s=_?_.value.trim():"",n=!1}async function t(g){if(!g||!g.name)return;let _=g.name;if(!a.includes(_))return;let h=g.value.trim(),y=r[_]||"";if(h===y||i[_]||typeof window.aipkit_apiRequest!="function")return;let E=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,x=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,w=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;i[_]=!0,r[_]=h,E&&E("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[_]:h}),x&&x("Updated")}catch(S){r[_]=y,w&&w(`Error: ${S.message||"Failed to save."}`),console.error("Content Writer Stock Image Key Save Error:",S)}finally{i[_]=!1}}async function p(g){if(!g)return;let _=g.value.trim(),h=s||"";if(_===h||n||typeof window.aipkit_apiRequest!="function")return;let y=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,E=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,x=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;n=!0,s=_,y&&y("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:_}),E&&E("Updated"),d(_,!0)}catch(w){s=h,x&&x(`Error: ${w.message||"Failed to save."}`),console.error("Content Writer Replicate Key Save Error:",w)}finally{n=!1}}function d(g,_=!1){let h=(g||"").trim();if(!h||c||!_&&h===l||typeof window.aipkit_queueProviderSync!="function")return;let y=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,E=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,x=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;c=!0,y&&y("Syncing models..."),window.aipkit_queueProviderSync("Replicate",{silent:!0,targetSelectId:"aipkit_cw_image_model",propagateError:!0}).then(()=>{l=h,E&&E("Models synced!")}).catch(w=>{x&&x(`Error: ${w.message||"Sync failed."}`),console.error("Content Writer Replicate Sync Error:",w)}).finally(()=>{c=!1})}function u(g){let _=document.getElementById("aipkit_cw_image_model");if(!_)return;let h=window.aipkit_dashboard?.imageGeneratorModels;if(!h){console.error("Image models data not found in aipkit_dashboard object."),_.innerHTML='<option value="">Error: Models not loaded</option>';return}let y=h[g.toLowerCase()]||[],E=window.aipkit_cw_template_state?.pendingImageModelSelection,x=_.value,w=E||x;_.innerHTML="",y.length>0?(y.forEach(S=>{_.appendChild(new Option(S.name,S.id))}),_.querySelector(`option[value="${CSS.escape(w)}"]`)?_.value=w:_.options.length>0&&(_.selectedIndex=0)):_.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function f(){let g=document.getElementById("aipkit_content_writer_container");if(!g)return;let _=g.querySelector(".aipkit_cw_image_enable_toggle"),h=g.querySelector("#aipkit_cw_generate_featured_image"),y=g.querySelector("#aipkit_cw_image_placement"),E=g.querySelector("#aipkit_cw_image_provider"),x=document.getElementById("aipkit_content_writer_form"),w=x?x.classList.contains("aipkit_cw_mode_existing_images"):!1,S=g.querySelectorAll(".aipkit_cw_image_settings_container"),T=g.querySelector(".aipkit_cw_prompt_row--image"),v=g.querySelector(".aipkit_cw_prompt_row--featured"),A=g.querySelector(".aipkit_cw_image_metadata_chunk"),C=Array.from(g.querySelectorAll(".aipkit_cw_image_metadata_subtoggle")).map(J=>{let we=J.closest(".aipkit_image_toggle_card");return{toggle:J,button:we?we.querySelector(".aipkit_cw_image_metadata_prompt_btn"):null}});if(!_||!h)return;let b=J=>J?J.closest(".aipkit_popover_option_row")||J.closest(".aipkit_form-group"):null,L=(J,we)=>{J&&(we?J.style.display=J.classList.contains("aipkit_popover_option_row")?"flex":"block":J.style.display="none")},B=_.checked,$=h.checked,W=B||$||w,U=E?E.value:"",D=U==="pexels"||U==="pixabay";S.forEach(J=>{J.style.display=W?"block":"none"});let H=B&&!D,Q=$&&!D,F=(J,we)=>{if(!J)return;J.style.display="",J.classList.toggle("aipkit_popover_option_row--disabled",!we);let $e=J.querySelector(".aipkit_cw_prompt_trigger");$e&&($e.disabled=!we,$e.setAttribute("aria-disabled",we?"false":"true"))};F(T,H),F(v,Q);let P=w||W;if(A&&(A.style.display=P?"block":"none"),A){let J=A.querySelector(".aipkit_image_settings_chunk_header--collapsible"),we=A.querySelector(".aipkit_image_settings_chunk_body--collapsible");if(J&&we){let $e=w;J.setAttribute("aria-expanded",$e?"true":"false"),we.setAttribute("aria-hidden",$e?"false":"true")}}C.length>0&&C.forEach(({toggle:J,button:we})=>{let $e=P&&J.checked;we&&(we.disabled=!$e,we.setAttribute("aria-disabled",$e?"false":"true"))});let R=g.querySelector(".aipkit_cw_prompt_flyout.is-open"),O=R?g.querySelector(`.aipkit_cw_image_metadata_prompt_btn[data-aipkit-flyout-target="${CSS.escape(R.id)}"]`):null,N=O?O.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_cw_image_metadata_subtoggle"):null,ie=N&&P?N.checked:!1;if(R&&(R.id==="aipkit_cw_image_prompt_flyout"&&!H||R.id==="aipkit_cw_featured_image_prompt_flyout"&&!Q||N&&!ie&&["aipkit_cw_image_title_prompt_flyout","aipkit_cw_image_alt_text_prompt_flyout","aipkit_cw_image_caption_prompt_flyout","aipkit_cw_image_description_prompt_flyout"].includes(R.id))&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),W){let J=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],we=g.querySelector("#aipkit_cw_replicate_options"),$e=g.querySelector("#aipkit_cw_pexels_options"),Ke=g.querySelector("#aipkit_cw_pixabay_options"),Ue=g.querySelector("#aipkit_cw_image_model_group");if(J.forEach(_t=>{let mt=g.querySelector(_t),Ot=b(mt);L(Ot,B)}),y){let _t=g.querySelector(".aipkit_cw_image_placement_x_field");if(_t){let mt=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(y.value);L(_t,B&&mt)}}we&&(we.style.display=U==="replicate"?"block":"none"),$e&&($e.style.display=D&&U==="pexels"?"block":"none"),Ke&&(Ke.style.display=D&&U==="pixabay"?"block":"none"),Ue&&(Ue.style.display=D?"none":"");let it=g.querySelector("#aipkit_cw_image_model_wrapper");if(it&&(it.style.display=D?"none":""),!D&&U&&u(U),U==="replicate"){let _t=g.querySelector("#aipkit_cw_replicate_api_key");d(_t?_t.value:"",!1)}}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}function m(){let g=document.getElementById("aipkit_content_writer_container");g&&(g.dataset.imageHandlerAttached||(o(g),e(g),g.addEventListener("change",function(_){let h=_.target;if(h&&h.matches(".aipkit_cw_stock_api_key")){t(h);return}if(h&&h.matches(".aipkit_cw_replicate_api_key")){p(h);return}h.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider, .aipkit_cw_image_metadata_subtoggle")&&f()}),g.addEventListener("click",function(_){let h=_.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!h)return;let y=h.getAttribute("aria-expanded")==="true",E=h.getAttribute("aria-controls"),x=E?document.getElementById(E):null;h.setAttribute("aria-expanded",y?"false":"true"),x&&x.setAttribute("aria-hidden",y?"true":"false")}),f(),g.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=m,window.aipkit_updateImageSettingsUI=f})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(l){return l};function a(l){if(!l)return;let o=l.querySelector(".aipkit_cw_vector_store_toggle"),e=l.querySelectorAll(".aipkit_cw_vector_store_settings_container");if(o&&e.length>0){let t=o.checked;e.forEach(p=>{p.style.display=t?"block":"none"}),t&&r(l)}}function r(l){if(!l)return;let o=l.querySelector(".aipkit_cw_vector_store_provider_select");if(!o)return;let e=o.value,t=l.querySelector(".aipkit_cw_vector_openai_field"),p=l.querySelector(".aipkit_cw_vector_pinecone_field"),d=l.querySelector(".aipkit_cw_vector_qdrant_field"),u=l.querySelector(".aipkit_cw_vector_embedding_config_row"),f=(m,g)=>{m&&(m.style.display=g?"block":"none")};if(f(t,e==="openai"),f(p,e==="pinecone"),f(d,e==="qdrant"),u){let m=e==="pinecone"||e==="qdrant";if(u.style.display=m?"block":"none",m){let g=u.querySelector(".aipkit_cw_vector_embedding_provider_select");g&&i(g.value)}}}function i(l){let o=document.getElementById("aipkit_cw_vector_embedding_model");if(!o)return;let t=(window.aipkit_dashboard?.embeddingModels||{})[l.toLowerCase()]||[],p=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";o.innerHTML=`<option value="">${k("-- Select Model --")}</option>`,t.length>0?(t.forEach(d=>{if(d&&d.id){let u=new Option(k(d.name||d.id),d.id);d.id===p&&(u.selected=!0),o.appendChild(u)}}),o.disabled=!1):(o.disabled=!0,o.innerHTML=`<option value="">${k("-- No models found --")}</option>`)}function s(l){if(!l)return;let o=l.getAttribute("aria-expanded")==="true",e=l.getAttribute("aria-controls"),t=document.getElementById(e);t&&(l.setAttribute("aria-expanded",!o),t.setAttribute("aria-hidden",o))}function n(l){if(!l)return;let o=document.getElementById(l.id+"_value");if(!o)return;let e=l.value;l.id==="aipkit_cw_vector_store_confidence_threshold"&&(e=e+"%"),o.textContent=e}function c(){let l=document.getElementById("aipkit_content_writer_container");if(!l||l.dataset.vectorSettingsHandlerAttached)return;l.addEventListener("change",function(e){let t=e.target;if(t.matches(".aipkit_cw_vector_store_toggle")){let p=t.closest(".aipkit_vector_settings_redesigned")||t.closest(".aipkit_popover_options_list")||l;a(p)}else if(t.matches(".aipkit_cw_vector_store_provider_select")){let p=t.closest(".aipkit_vector_settings_redesigned")||t.closest(".aipkit_cw_vector_store_settings_container")||l;r(p)}else t.matches(".aipkit_cw_vector_embedding_provider_select")&&i(t.value);typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),l.addEventListener("input",function(e){let t=e.target;t.matches(".aipkit_vector_slider")&&n(t)}),l.addEventListener("click",function(e){let p=e.target.closest(".aipkit_vector_settings_chunk_header--collapsible");p&&(e.preventDefault(),s(p))}),l.querySelectorAll(".aipkit_vector_settings_redesigned, .aipkit_popover_options_list").forEach(e=>{e.querySelector(".aipkit_cw_vector_store_toggle")&&a(e)}),l.querySelectorAll(".aipkit_vector_slider").forEach(e=>{n(e)}),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),l.dataset.vectorSettingsHandlerAttached="true"}window.aipkit_initContentWriterVectorSettings=c,window.aipkit_cw_toggleVectorSettingsContainer=a,window.aipkit_cw_toggleProviderSpecificFields=r,window.aipkit_cw_populateEmbeddingModelSelect=i})();(function(){"use strict";function k(l){if(!l)return;let o=l.querySelector("#aipkit_content_writer_post_status"),e=l.querySelector(".aipkit_post_smart_schedule_container");if(!o)return;let t=o.value==="publish";e&&(e.style.display=t?"block":"none"),t&&a(l)}function a(l){if(!l)return;let o=l.querySelector('input[name="schedule_mode"]:checked'),e=l.querySelector(".aipkit_post_smart_schedule_fields");if(!e)return;let t=o&&o.value==="smart";e.style.display=t?"flex":"none"}function r(l){if(!l)return;let o=l.getAttribute("aria-expanded")==="true",e=l.getAttribute("aria-controls"),t=document.getElementById(e);t&&(l.setAttribute("aria-expanded",!o),t.setAttribute("aria-hidden",o))}function i(l){if(!l)return;let o=l.querySelector("#aipkit_content_writer_post_status");o&&(o.addEventListener("change",()=>{k(l)}),k(l)),l.querySelectorAll('input[name="schedule_mode"]').forEach(t=>{t.addEventListener("change",()=>{a(l)})}),a(l)}function s(){document.addEventListener("click",l=>{let o=l.target.closest(".aipkit_post_settings_chunk_header--collapsible");if(o){l.preventDefault(),r(o);return}}),document.addEventListener("keydown",l=>{if(l.key!=="Enter"&&l.key!==" ")return;let o=l.target.closest(".aipkit_post_settings_chunk_header--collapsible");o&&(l.preventDefault(),r(o))})}function n(l){let o=l.target;if(!o||!o.id||o.id!=="aipkit_cw_post_settings_popover")return;let e=o.querySelector(".aipkit_post_settings_redesigned");e&&!e.dataset.postSettingsInitialized&&(i(e),e.dataset.postSettingsInitialized="true")}function c(){s(),document.addEventListener("aipkit:popover:opened",n),document.querySelectorAll(".aipkit_post_settings_redesigned").forEach(e=>{e.dataset.postSettingsInitialized||(i(e),e.dataset.postSettingsInitialized="true")}),new MutationObserver(e=>{e.forEach(t=>{if(t.type==="attributes"&&t.attributeName==="aria-hidden"){let p=t.target.closest("#aipkit_cw_post_settings_popover");if(p&&t.target.getAttribute("aria-hidden")==="false"){let d=p.querySelector(".aipkit_post_settings_redesigned");d&&!d.dataset.postSettingsInitialized&&(i(d),d.dataset.postSettingsInitialized="true")}}})}).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["aria-hidden"]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.aipkit_initPostSettingsHandler=i})();(function(){"use strict";function k(a){let r=a||document.getElementById("aipkit_content_writer_container");if(!r)return;let i=r.querySelectorAll("[data-aipkit-vector-stores-dropdown]");i.length&&i.forEach(s=>{let n=s.closest(".aipkit_popover_option_main"),c=s.closest(".aipkit_cw_vector_openai_field"),l=n||c,o=l?l.querySelector(".aipkit_popover_multiselect_select"):null;if(!o)return;let e=s.querySelector(".aipkit_popover_multiselect_btn"),t=s.querySelector(".aipkit_popover_multiselect_label"),p=s.querySelector(".aipkit_popover_multiselect_panel"),d=s.querySelector(".aipkit_popover_multiselect_options"),u=s.dataset.placeholder||"Select stores",f=s.dataset.selectedLabel||"selected",m=()=>{if(!t)return;let E=Array.from(o.options).filter(w=>w.selected&&w.value);if(!E.length){t.textContent=u;return}let x=E.map(w=>w.textContent.trim()).filter(Boolean);if(x.length<=2){t.textContent=x.join(", ");return}t.textContent=`${x.length} ${f}`},g=()=>{if(!d)return;d.innerHTML="";let E=Array.from(o.options),x=E.filter(w=>w.value);if(!x.length){let w=document.createElement("div");w.className="aipkit_popover_multiselect_empty",w.textContent=E[0]?.textContent||"-- No Stores Found --",d.appendChild(w),m();return}x.forEach(w=>{let S=document.createElement("label");S.className="aipkit_popover_multiselect_item";let T=document.createElement("input");T.type="checkbox",T.value=w.value,T.checked=w.selected,T.disabled=w.disabled;let v=document.createElement("span");v.className="aipkit_popover_multiselect_text",v.textContent=w.textContent,S.appendChild(T),S.appendChild(v),d.appendChild(S)}),m()},_=()=>{if(!d){m();return}let E=new Set(Array.from(o.options).filter(x=>x.selected).map(x=>x.value));d.querySelectorAll('input[type="checkbox"]').forEach(x=>{x.checked=E.has(x.value)}),m()},h=E=>{if(!d)return;let x=Array.from(d.querySelectorAll('input[type="checkbox"]:checked'));if(x.length>2){let S=E&&E.target;if(S&&S.checked)S.checked=!1;else{let T=x[x.length-1];T&&(T.checked=!1)}}let w=Array.from(d.querySelectorAll('input[type="checkbox"]:checked')).map(S=>S.value);Array.from(o.options).forEach(S=>{S.selected=w.includes(S.value)}),o.dispatchEvent(new Event("change",{bubbles:!0})),m()},y=E=>{!s||!e||(s.classList.toggle("is-open",E),e.setAttribute("aria-expanded",E?"true":"false"),p&&(p.hidden=!E))};g(),_(),s.dataset.vectorStoreMultiselectAttached||(e&&(e.addEventListener("click",E=>{E.preventDefault(),y(!s.classList.contains("is-open"))}),e.addEventListener("keydown",E=>{E.key==="Escape"&&y(!1)})),document.addEventListener("click",E=>{s.classList.contains("is-open")&&(s.contains(E.target)||y(!1))}),d&&!d.dataset.listenerAttached&&(d.addEventListener("change",h),d.dataset.listenerAttached="true"),o.dataset.listenerAttached||(o.addEventListener("change",_),o.dataset.listenerAttached="true"),s.dataset.vectorStoreMultiselectAttached="true")})}window.aipkit_initContentWriterVectorStoreMultiSelect=k})();(function(){"use strict";function k(a){let r=a||document.getElementById("aipkit_content_writer_container");if(!r)return;let i=r.querySelectorAll("[data-aipkit-categories-dropdown]");i.length&&i.forEach(s=>{let n=s.closest(".aipkit_popover_option_main"),c=s.closest(".aipkit_post_taxonomy_row"),l=n||c,o=l?l.querySelector('select[name="post_categories[]"]'):null;if(!o)return;let e=s.querySelector(".aipkit_popover_multiselect_btn"),t=s.querySelector(".aipkit_popover_multiselect_label"),p=s.querySelector(".aipkit_popover_multiselect_panel"),d=s.querySelector(".aipkit_popover_multiselect_options"),u=s.dataset.placeholder||"Select categories",f=s.dataset.selectedLabel||"selected",m=()=>{if(!t)return;let E=Array.from(o.options).filter(w=>w.selected&&w.value);if(!E.length){t.textContent=u;return}let x=E.map(w=>w.textContent.trim()).filter(Boolean);if(x.length<=2){t.textContent=x.join(", ");return}t.textContent=`${x.length} ${f}`},g=()=>{if(!d)return;d.innerHTML="";let E=Array.from(o.options),x=E.filter(w=>w.value);if(!x.length){let w=document.createElement("div");w.className="aipkit_popover_multiselect_empty",w.textContent=E[0]?.textContent||"-- No Categories --",d.appendChild(w),m();return}x.forEach(w=>{let S=document.createElement("label");S.className="aipkit_popover_multiselect_item";let T=document.createElement("input");T.type="checkbox",T.value=w.value,T.checked=w.selected,T.disabled=w.disabled;let v=document.createElement("span");v.className="aipkit_popover_multiselect_text",v.textContent=w.textContent,S.appendChild(T),S.appendChild(v),d.appendChild(S)}),m()},_=()=>{if(!d){m();return}let E=new Set(Array.from(o.options).filter(x=>x.selected).map(x=>x.value));d.querySelectorAll('input[type="checkbox"]').forEach(x=>{x.checked=E.has(x.value)}),m()},h=()=>{if(!d)return;let E=Array.from(d.querySelectorAll('input[type="checkbox"]:checked')).map(x=>x.value);Array.from(o.options).forEach(x=>{x.selected=E.includes(x.value)}),o.dispatchEvent(new Event("change",{bubbles:!0})),m()},y=E=>{!s||!e||(s.classList.toggle("is-open",E),e.setAttribute("aria-expanded",E?"true":"false"),p&&(p.hidden=!E))};g(),_(),s.dataset.categoriesMultiselectAttached||(e&&(e.addEventListener("click",E=>{E.preventDefault(),y(!s.classList.contains("is-open"))}),e.addEventListener("keydown",E=>{E.key==="Escape"&&y(!1)})),document.addEventListener("click",E=>{s.classList.contains("is-open")&&(s.contains(E.target)||y(!1))}),d&&!d.dataset.listenerAttached&&(d.addEventListener("change",h),d.dataset.listenerAttached="true"),o.dataset.listenerAttached||(o.addEventListener("change",_),o.dataset.listenerAttached="true"),s.dataset.categoriesMultiselectAttached="true")})}window.aipkit_initContentWriterCategoriesMultiSelect=k})();(function(){"use strict";let k=" \xB7 ",a=e=>{if(!e)return"";let t=e.options?e.options[e.selectedIndex]:null;return t?t.textContent.trim():""},r=e=>!e||!e.options?[]:Array.from(e.options).filter(t=>t.selected&&t.value).map(t=>t.textContent.trim()).filter(Boolean),i=(e,t)=>{let p=e.filter(Boolean);return p.length?p.join(k):t},s=(e,t)=>{if(!e)return;e.textContent=t,e.title=t;let p=e.closest(".aipkit_cw_settings_summary_text");p&&(p.title=t);let d=e.dataset.aipkitPlaceholder,u=e.dataset.aipkitDisabledLabel,f="active";u&&t===u?f="disabled":d&&t===d&&(f="placeholder"),e.dataset.aipkitSummaryState=f},n=e=>String(e||"").trim().toLowerCase(),c=(e,t,p=null)=>{if(!e)return;let d="aipkit_settings_select_picker_icon--";e.classList.forEach(g=>{g.startsWith(d)&&e.classList.remove(g)});let u=n(t),f=!p||p.includes(u),m=!!(u&&f);e.hidden=!m,m&&e.classList.add(`${d}${u}`)},l=e=>{if(!e)return;let t=document.getElementById("aipkit_content_writer_form"),p=t?t.classList.contains("aipkit_cw_mode_existing_images"):!1,d=e.querySelector('[data-aipkit-cw-summary="ai"]');if(d){let g=d.dataset.aipkitPlaceholder||"Not set",_=a(e.querySelector("#aipkit_content_writer_provider")),h=a(e.querySelector("#aipkit_content_writer_model"));s(d,i([h],g));let y=e.querySelector("#aipkit_content_writer_provider")?.value,E=d.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon");c(E,y)}let u=e.querySelector('[data-aipkit-cw-summary="images"]');if(u){let g=u.dataset.aipkitPlaceholder||"Not set",_=u.dataset.aipkitDisabledLabel||"Disabled",h=["#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description"],y=e.querySelector("#aipkit_cw_generate_images_enabled"),E=e.querySelector("#aipkit_cw_generate_featured_image"),x=y&&y.checked||E&&E.checked,w=e.querySelector("#aipkit_cw_image_provider"),S=w?w.value:"",T=a(w),v=a(e.querySelector("#aipkit_cw_image_model")),A=u.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_settings_select_picker_icon"),C=["openai","google","azure","replicate"];if(c(A,S,C),p){c(A,"",C);let b=h.map(L=>{let B=e.querySelector(L);if(!B||!B.checked)return"";let $=B.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_image_toggle_label");return $?$.textContent.trim():""}).filter(Boolean);s(u,i(b,_||g))}else x?C.includes(S)?s(u,i([v],g)):["pexels","pixabay"].includes(S)?s(u,i([T],g)):s(u,i([T,v],g)):(c(A,"",C),s(u,_))}let f=e.querySelector('[data-aipkit-cw-summary="vector"]');if(f){let g=f.dataset.aipkitPlaceholder||"Not set",_=f.dataset.aipkitDisabledLabel||"Disabled",h=e.querySelector("#aipkit_cw_enable_vector_store"),y=f.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon"),E=["openai","pinecone","qdrant"];if(h&&!h.checked)c(y,"",E),s(f,_);else{let x=e.querySelector("#aipkit_cw_vector_store_provider"),w=x?x.value:"",S="";if(w==="openai"){let T=e.querySelector("#aipkit_cw_openai_vector_store_ids");S=r(T).join(", ")}else w==="pinecone"?S=a(e.querySelector("#aipkit_cw_pinecone_index_name")):w==="qdrant"&&(S=a(e.querySelector("#aipkit_cw_qdrant_collection_name")));c(y,w,E),s(f,i([S],g))}}let m=e.querySelector('[data-aipkit-cw-summary="post"]');if(m){let g=m.dataset.aipkitPlaceholder||"Not set",_=a(e.querySelector("#aipkit_content_writer_post_status"));s(m,i([_],g))}};function o(e){let t=e||document.getElementById("aipkit_content_writer_container");if(!t||t.dataset.cwSummaryAttached==="true")return;let p=["#aipkit_content_writer_provider","#aipkit_content_writer_model","#aipkit_cw_generate_images_enabled","#aipkit_cw_generate_featured_image","#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description","#aipkit_cw_image_provider","#aipkit_cw_image_model","#aipkit_cw_enable_vector_store","#aipkit_cw_vector_store_provider","#aipkit_cw_openai_vector_store_ids","#aipkit_cw_pinecone_index_name","#aipkit_cw_qdrant_collection_name","#aipkit_content_writer_categories","#aipkit_content_writer_post_author","#aipkit_content_writer_post_status"],d=u=>p.some(f=>u.matches(f));t.addEventListener("change",u=>{let f=u.target;!f||!d(f)||l(t)}),l(t),t.dataset.cwSummaryAttached="true"}window.aipkit_initContentWriterSettingsSummary=o,window.aipkit_updateContentWriterSettingsSummary=function(){let e=document.getElementById("aipkit_content_writer_container");l(e)}})();(function(){"use strict";let k=window.wp?.i18n?.__||function(b){return b},a="#aipkit_content_writer_provider, #aipkit_content_writer_model, #aipkit_cw_image_provider, #aipkit_cw_image_model, #aipkit_task_cw_image_provider, #aipkit_task_cw_image_model, #aipkit_cw_vector_store_provider, #aipkit_cw_vector_embedding_provider, #aipkit_task_cw_vector_store_provider, #aipkit_task_ce_vector_store_provider, #aipkit_task_cw_vector_embedding_provider, #aipkit_task_ce_vector_embedding_provider, #aipkit_task_content_indexing_target_store_provider, #aipkit_enhancer_insert_position_default, #aipkit_cw_pinecone_index_name, #aipkit_cw_qdrant_collection_name, #aipkit_cw_vector_embedding_model, #aipkit_task_cw_ai_provider, #aipkit_task_cw_ai_model, #aipkit_task_cc_ai_provider, #aipkit_task_cc_ai_model, #aipkit_task_ce_ai_provider, #aipkit_task_ce_ai_model",r=null,i=null,s=!1,n=new Set(["aipkit_content_writer_provider","aipkit_cw_image_provider","aipkit_cw_vector_store_provider","aipkit_cw_vector_embedding_provider","aipkit_task_cw_image_provider","aipkit_task_cw_vector_store_provider","aipkit_task_ce_vector_store_provider","aipkit_task_cw_vector_embedding_provider","aipkit_task_ce_vector_embedding_provider","aipkit_task_content_indexing_target_store_provider","aipkit_task_cw_ai_provider","aipkit_task_cc_ai_provider","aipkit_task_ce_ai_provider"]),c=b=>!!(b&&b.id&&n.has(b.id)),l=b=>!!(b&&b.dataset?.aipkitPickerIcons==="assistant-position"),o=b=>!!(b&&(c(b)||l(b)||b.id==="aipkit_cw_pinecone_index_name"||b.id==="aipkit_cw_qdrant_collection_name"||b.id==="aipkit_cw_vector_embedding_model")),e=(b,L)=>{if(!b)return!1;let B=t(L);return B?b.id==="aipkit_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(B):b.id==="aipkit_task_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(B):b.id==="aipkit_cw_vector_store_provider"?["openai","pinecone","qdrant"].includes(B):b.id==="aipkit_task_cw_vector_store_provider"||b.id==="aipkit_task_ce_vector_store_provider"||b.id==="aipkit_task_content_indexing_target_store_provider"?["openai","pinecone","qdrant"].includes(B):b.id==="aipkit_cw_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(B):b.id==="aipkit_task_cw_vector_embedding_provider"||b.id==="aipkit_task_ce_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(B):["openai","openrouter","claude","google","azure","deepseek","ollama"].includes(B):!1},t=b=>String(b||"").trim().toLowerCase(),p=(b,L,B)=>{if(!b)return;let $="aipkit_settings_select_picker_icon--";b.classList.forEach(D=>{D.startsWith($)&&b.classList.remove(D)});let W=t(B),U=e(L,W);b.hidden=!U,U&&b.classList.add(`${$}${W}`)},d=(b,L)=>{if(!b)return;let B="aipkit_settings_select_picker_icon--assistant-";b.classList.forEach(W=>{W.startsWith(B)&&b.classList.remove(W)});let $=String(L||"").trim().toLowerCase();b.hidden=!$,$&&b.classList.add(`${B}${$}`)},u=b=>b&&(b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]"))?.dataset?.icon||"",f=b=>{if(!b)return"";let L=b.getAttribute("data-aipkit-picker-title");if(L)return L;let B=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return B?B.textContent.trim():""},m=b=>{if(!b)return"";let L=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(L)return L.textContent.trim();let B=b.querySelector("option");return B?B.textContent.trim():""},g=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),_=b=>b?b.closest("#aipkit_cw_builder_sheet")||b.closest("#aipkit_content_writer_container")||b.closest("#aipkit_autogpt_container")||b.closest("#aipkit_ai_forms_container"):null,h=b=>{if(!b||!b.id)return null;let L=g(b.id),B=_(b);if(!B)return null;let $=document.getElementById(L.buttonId);if(!$){if($=document.createElement("button"),$.type="button",$.id=L.buttonId,$.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",$.setAttribute("data-aipkit-popover-target",L.popoverId),$.setAttribute("aria-controls",L.popoverId),$.setAttribute("aria-expanded","false"),$.dataset.aipkitPopoverPlacement="bottom",c(b)){$.classList.add("aipkit_settings_select_picker_btn--provider");let H=document.createElement("span");H.className="aipkit_settings_select_picker_icon",H.setAttribute("aria-hidden","true"),p(H,b,b.value),$.appendChild(H)}else if(l(b)){let H=document.createElement("span");H.className="aipkit_settings_select_picker_icon",H.setAttribute("aria-hidden","true"),d(H,u(b)),$.appendChild(H)}let U=document.createElement("span");U.className="aipkit_settings_select_picker_label",U.id=L.labelId,U.textContent=m(b)||k("Select","gpt3-ai-content-generator");let D=document.createElement("span");D.className="dashicons dashicons-arrow-down-alt2",D.setAttribute("aria-hidden","true"),$.appendChild(U),$.appendChild(D),b.insertAdjacentElement("beforebegin",$)}b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let W=document.getElementById(L.popoverId);if(!W){W=document.createElement("div"),W.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",W.id=L.popoverId,W.setAttribute("aria-hidden","true"),c(b)&&W.classList.add("aipkit_settings_select_picker_popover--provider");let U=document.createElement("div");U.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",U.setAttribute("role","dialog"),U.setAttribute("aria-labelledby",L.titleId);let D=document.createElement("div");D.className="aipkit_model_settings_popover_header";let H=document.createElement("span");H.className="aipkit_model_settings_popover_title",H.id=L.titleId,H.textContent=f(b)||k("Select","gpt3-ai-content-generator");let Q=document.createElement("button");Q.type="button",Q.className="aipkit_model_settings_popover_close",Q.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),Q.innerHTML='<span class="dashicons dashicons-no-alt"></span>',D.appendChild(H),D.appendChild(Q);let F=document.createElement("div");F.className="aipkit_model_settings_popover_body";let P=document.createElement("div");P.className="aipkit_settings_select_picker_search";let R=document.createElement("input");R.type="search",R.id=L.searchId,R.className="aipkit_form-input";let O=f(b),N=O?`Search ${O.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");R.setAttribute("placeholder",N),P.appendChild(R);let ie=document.createElement("div");ie.className="aipkit_settings_select_picker_list",ie.id=L.listId,ie.setAttribute("role","listbox"),F.appendChild(P),F.appendChild(ie),U.appendChild(D),U.appendChild(F),W.appendChild(U),B.appendChild(W),o(b)&&(P.style.display="none")}return{ids:L,button:$,popover:W,label:document.getElementById(L.labelId),search:document.getElementById(L.searchId),list:document.getElementById(L.listId)}},y=b=>{let L=[];return b&&Array.from(b.children).forEach($=>{if($.tagName==="OPTGROUP"){let W=Array.from($.children).filter(U=>U.tagName==="OPTION").map(U=>({value:U.value,label:U.textContent.trim(),disabled:U.disabled,selected:U.selected,icon:U.dataset?.icon||""}));L.push({label:$.label,options:W})}else $.tagName==="OPTION"&&L.push({label:"",options:[{value:$.value,label:$.textContent.trim(),disabled:$.disabled,selected:$.selected,icon:$.dataset?.icon||""}]})}),L},E=(b,L,B="")=>{if(!b||!L)return;L.innerHTML="";let $=y(b),W=B.trim().toLowerCase(),U=!1;if($.forEach(D=>{let H=D.options.filter(Q=>W?Q.label.toLowerCase().includes(W):!0);if(H.length){if(D.label){let Q=document.createElement("div");Q.className="aipkit_settings_select_picker_group_label",Q.textContent=D.label,L.appendChild(Q)}H.forEach(Q=>{let F=document.createElement("button");if(F.type="button",F.className="aipkit_settings_select_picker_item",Q.disabled&&F.classList.add("is-disabled"),Q.selected&&F.classList.add("is-active"),F.dataset.value=Q.value,c(b)&&e(b,Q.value)){let O=document.createElement("span");O.className="aipkit_settings_select_picker_icon",O.setAttribute("aria-hidden","true"),p(O,b,Q.value),F.appendChild(O)}else if(l(b)&&Q.icon){let O=document.createElement("span");O.className="aipkit_settings_select_picker_icon",O.setAttribute("aria-hidden","true"),d(O,Q.icon),F.appendChild(O)}let P=document.createElement("span");P.className="aipkit_settings_select_picker_text",P.textContent=Q.label||Q.value;let R=document.createElement("span");R.className="dashicons dashicons-yes aipkit_settings_select_picker_check",R.setAttribute("aria-hidden","true"),F.appendChild(P),F.appendChild(R),L.appendChild(F),U=!0})}}),!U){let D=document.createElement("div");D.className="aipkit_settings_select_picker_empty",D.textContent=k(W?"No matches found.":"No options available.","gpt3-ai-content-generator"),L.appendChild(D)}},x=(b,L)=>{if(!b||!L)return;let B=m(b);if(L.textContent=B||k("Select","gpt3-ai-content-generator"),c(b)){let $=L.closest("button"),W=$?$.querySelector(".aipkit_settings_select_picker_icon"):null;p(W,b,b.value)}else if(l(b)){let $=L.closest("button"),W=$?$.querySelector(".aipkit_settings_select_picker_icon"):null;d(W,u(b))}},w=(b,L)=>{if(!b||!L)return;let B=b.getBoundingClientRect(),$=L.getBoundingClientRect(),W=$.width||320,U=$.height||0,D=window.innerWidth,H=window.innerHeight,Q=12;if(b.dataset.aipkitPopoverPlacement==="bottom"){let R=B.left;R+W>D-Q&&(R=B.right-W),R=Math.max(Q,Math.min(R,D-W-Q));let O=B.bottom+8;O+U>H-Q&&(O=B.top-U-8),O=Math.max(Q,Math.min(O,H-U-Q)),L.style.left=`${Math.round(R)}px`,L.style.top=`${Math.round(O)}px`;return}let F=B.right+10;F+W>D-Q&&(F=B.left-W-10),F=Math.max(Q,Math.min(F,D-W-Q));let P=B.top;P+U>H-Q&&(P=H-U-Q),P=Math.max(Q,P),L.style.left=`${Math.round(F)}px`,L.style.top=`${Math.round(P)}px`},S=()=>{!r||!i||s||(s=!0,window.requestAnimationFrame(()=>{let b=r.querySelector(".aipkit_model_settings_popover_panel");w(i,b),s=!1}))},T=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},v=(b,L,B)=>{if(!b||!L)return;r&&r!==L&&T(),r=L,i=b,L.classList.add("aipkit-active"),L.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let $=L.querySelector(".aipkit_settings_select_picker_search input"),W=L.querySelector(".aipkit_settings_select_picker_list");W&&E(B,W,$?$.value:""),$&&$.offsetParent!==null&&($.focus(),$.select());let U=L.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{w(b,U)})},A=(b,L)=>{if(!b||!L)return;let{button:B,popover:$,list:W,search:U}=L;if(B&&B.dataset.pickerListenerAttached!=="true"&&(B.addEventListener("click",D=>{if(D.preventDefault(),r===$){T();return}v(B,$,b)}),B.dataset.pickerListenerAttached="true"),$&&$.dataset.overlayListenerAttached!=="true"){$.addEventListener("click",H=>{H.target===$&&T()});let D=$.querySelector(".aipkit_model_settings_popover_close");D&&D.addEventListener("click",H=>{H.preventDefault(),T()}),$.dataset.overlayListenerAttached="true"}if(W&&W.dataset.pickerListenerAttached!=="true"&&(W.addEventListener("click",D=>{let H=D.target.closest(".aipkit_settings_select_picker_item");if(!H||H.classList.contains("is-disabled"))return;let Q=H.dataset.value??"";b.value=Q,b.dispatchEvent(new Event("change",{bubbles:!0})),x(b,L.label),E(b,W,U?U.value:""),T()}),W.dataset.pickerListenerAttached="true"),U&&U.dataset.pickerListenerAttached!=="true"&&(U.addEventListener("input",()=>{E(b,W,U.value)}),U.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{x(b,L.label),E(b,W,U?U.value:"")}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let D=!1;new MutationObserver(()=>{D||(D=!0,window.requestAnimationFrame(()=>{x(b,L.label),E(b,W,U?U.value:""),D=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitContentWriterPickerEscapeBound||(document.addEventListener("keydown",D=>{D.key==="Escape"&&r&&T()}),document.body.dataset.aipkitContentWriterPickerEscapeBound="true"),document.body.dataset.aipkitContentWriterPickerRepositionBound||(window.addEventListener("resize",S),window.addEventListener("scroll",S,!0),document.body.dataset.aipkitContentWriterPickerRepositionBound="true")};function C(){let b=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);b.length&&b.forEach(L=>{let B=L.querySelectorAll(a);B.length&&B.forEach($=>{if(!$.id||$.dataset.aipkitPickerInit==="true")return;let W=h($);W&&(x($,W.label),E($,W.list,W.search?W.search.value:""),A($,W),$.dataset.aipkitPickerInit="true")})})}window.aipkit_initContentWriterSelectPickers=C,window.aipkit_refreshContentWriterSelectPickers=function(){let b=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);b.length&&b.forEach(L=>{let B=L.querySelectorAll(a);B.length&&B.forEach($=>{if(!$.id)return;let W=h($);W&&(x($,W.label),E($,W.list,W.search?W.search.value:""),A($,W),$.dataset.aipkitPickerInit="true")})})}})();(function(){"use strict";function k(l){l||(l=document.getElementById("aipkit_content_writer_container")),l&&(a(l),i(l),s(l))}function a(l){let o=l.querySelectorAll(".aipkit_ai_reasoning_input"),e=l.querySelector("#aipkit_content_writer_reasoning_effort");!o.length||!e||(o.forEach(t=>{t.addEventListener("change",function(){if(this.checked){e.value=this.value,l.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>{u.classList.remove("aipkit_ai_reasoning_option--selected")});let p=this.closest(".aipkit_ai_reasoning_option");p&&p.classList.add("aipkit_ai_reasoning_option--selected");let d=new Event("change",{bubbles:!0});e.dispatchEvent(d)}})}),r(l))}function r(l){let o=l.querySelector("#aipkit_content_writer_reasoning_effort");if(!o)return;let e=o.value||"medium";e==="minimal"&&(e="low");let t=l.querySelector(`.aipkit_ai_reasoning_input[value="${e}"]`);if(t&&!t.checked){t.checked=!0,l.querySelectorAll(".aipkit_ai_reasoning_option").forEach(d=>{d.classList.remove("aipkit_ai_reasoning_option--selected")});let p=t.closest(".aipkit_ai_reasoning_option");p&&p.classList.add("aipkit_ai_reasoning_option--selected")}}function i(l){let o=l.querySelector("#aipkit_content_writer_temperature"),e=l.querySelector("#aipkit_content_writer_temperature_value");!o||!e||o.dataset.enhancedListenerAttached!=="true"&&(o.addEventListener("input",function(){e.textContent=this.value}),o.dataset.enhancedListenerAttached="true")}function s(l){let o=l.querySelector("#aipkit_content_writer_content_length_slider"),e=l.querySelector("#aipkit_content_writer_content_length_value"),t=l.querySelector("#aipkit_content_writer_content_length_hint"),p=l.querySelector("#aipkit_content_writer_content_length");if(!o||!e||!t||!p||o.dataset.enhancedListenerAttached==="true")return;let d=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],u="medium",f=_=>{let h=d.findIndex(y=>y.key===_);return h===-1?d.findIndex(y=>y.key===u):h},m=_=>{let h=f(_),y=d[h];e.textContent=y.label,t.textContent=`Approx. ${y.words} words`,o.value=String(h+1)},g=(_,h=!1)=>{let y=d.some(E=>E.key===_)?_:u;p.value!==y&&(p.value=y),m(y),h&&p.dispatchEvent(new Event("change",{bubbles:!0}))};o.addEventListener("input",function(){let _=Math.max(1,Math.min(3,parseInt(this.value,10)))-1,h=d[_]?.key||u;g(h,!0)}),p.addEventListener("change",function(){g(this.value,!1)}),g(p.value||u,!1),o.dataset.enhancedListenerAttached="true"}function n(l,o){if(!l||!o)return;let e=l.querySelector("#aipkit_content_writer_reasoning_effort");e&&(e.value=o==="minimal"?"low":o);let t=l.querySelector(`.aipkit_ai_reasoning_input[value="${o==="minimal"?"low":o}"]`);if(t){t.checked=!0,l.querySelectorAll(".aipkit_ai_reasoning_option").forEach(d=>{d.classList.remove("aipkit_ai_reasoning_option--selected")});let p=t.closest(".aipkit_ai_reasoning_option");p&&p.classList.add("aipkit_ai_reasoning_option--selected")}}function c(l){if(!l)return"medium";let o=l.querySelector(".aipkit_ai_reasoning_input:checked");if(o)return o.value;let e=l.querySelector("#aipkit_content_writer_reasoning_effort");return e?e.value:"medium"}window.aipkit_initAiSettingsRedesigned=k,window.aipkit_setReasoningEffort=n,window.aipkit_getReasoningEffort=c})();(function(){"use strict";function k(a,r,i,s,n,c){if(typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(a,r):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(i):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(n):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(c,n):console.error("Content Writer UI: handleClearButton function not found."),typeof window.aipkit_initContentWriterSettingsSummary=="function"?window.aipkit_initContentWriterSettingsSummary():console.error("Content Writer UI: initContentWriterSettingsSummary function not found."),typeof window.aipkit_initContentWriterSelectPickers=="function"?window.aipkit_initContentWriterSelectPickers():console.error("Content Writer UI: initContentWriterSelectPickers function not found."),typeof window.aipkit_initAiSettingsRedesigned=="function"){let l=document.getElementById("aipkit_content_writer_container");window.aipkit_initAiSettingsRedesigned(l)}}window.aipkit_initContentWriterUI=k})();(function(){"use strict";let k={intervalId:null,startTime:null};function a(l){let o=Math.floor(l/1e3),e=Math.floor(o/60),t=o%60;return`${e}:${String(t).padStart(2,"0")}`}function r(l){if(!l)return null;let o=l.querySelector(".aipkit_cw_btn_timer");if(o)return o;o=document.createElement("span"),o.className="aipkit_cw_btn_timer",o.setAttribute("aria-hidden","true"),o.hidden=!0;let e=l.querySelector(".aipkit_btn-text");return e?l.insertBefore(o,e):l.insertBefore(o,l.firstChild),o}function i(l){if(!l||k.intervalId)return;let o=r(l);if(!o)return;k.startTime=Date.now();let e=()=>{let t=Date.now()-k.startTime;o.textContent=a(t),o.hidden=!1};e(),k.intervalId=window.setInterval(e,1e3)}function s(l){k.intervalId&&(clearInterval(k.intervalId),k.intervalId=null),k.startTime=null;let o=r(l);o&&(o.hidden=!0,o.textContent="")}function n(l){let o=document.getElementById("aipkit_content_writer_generate_btn");if(!o)return;let e=o.closest(".aipkit_cw_generate_split"),t=e?e.querySelector(".aipkit_cw_generate_toggle"):null,p=e?e.querySelector(".aipkit_cw_generate_menu"):null,d=p?Array.from(p.querySelectorAll(".aipkit_cw_generate_menu_item")):[],u=document.getElementById("aipkit_content_writer_stop_btn");if(l){if(o.dataset.aipkitStopMode="true",e&&e.classList.add("is-single"),i(o),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(o,"Stop");else{let f=o.querySelector(".aipkit_btn-text");f?f.textContent="Stop":o.textContent="Stop"}o.disabled=!1,o.removeAttribute("aria-disabled"),o.style.display="inline-flex",t&&(t.style.display="none",t.disabled=!0),p&&(p.hidden=!0),d.length&&d.forEach(f=>{f.disabled=!0,f.setAttribute("aria-disabled","true")}),u&&(u.style.display="none");return}o.dataset.aipkitStopMode&&delete o.dataset.aipkitStopMode,s(o),e&&e.classList.remove("is-single"),t&&(t.style.display="",t.disabled=!1,t.removeAttribute("aria-disabled")),d.length&&d.forEach(f=>{f.disabled=!1,f.removeAttribute("aria-disabled")}),u&&(u.style.display="none")}function c(){let l=document.getElementById("aipkit_content_writer_generate_btn"),o=document.getElementById("aipkit_content_writer_stop_btn"),e=l?.dataset?.action||"generate",p={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",update:"Update"}[e]||"Generate";l&&(s(l),l.dataset.aipkitStopMode&&delete l.dataset.aipkitStopMode,typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(l,!1,p):(l.disabled=!1,l.textContent=p),l.style.display="inline-flex"),o&&(o.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()}window.aipkit_setContentWriterStopMode=n,window.aipkit_resetContentWriterButtons=c})();(function(){"use strict";function k(a){a.current&&(a.current.close(),a.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let r=document.getElementById("aipkit_cw_generated_content_area"),i=document.getElementById("aipkit_content_writer_output_display"),s=document.querySelector(".aipkit_content_writer_output_actions"),n=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn");r&&(r.textContent.trim().length>0||!!r.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))&&(!i||!i.classList.contains("aipkit_content_writer_output_error"))?(s&&(s.style.display="flex"),n&&(n.disabled=!1),c&&(c.disabled=!1),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_showPrimaryAction=="function"&&window.aipkit_showPrimaryAction(),typeof window.aipkit_updateMetaChunkVisibility=="function"&&window.aipkit_updateMetaChunkVisibility(),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(s&&(s.style.display="none"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=k})();(function(){"use strict";function k(c,l,o,e){let t=c.querySelector("[data-csv-upload-zone]"),p=c.querySelector("[data-csv-status]"),d=c.querySelector("[data-csv-status-card]"),u=c.querySelector("[data-csv-status-icon]"),f=c.querySelector("[data-csv-file-name]"),m=c.querySelector("[data-csv-message]");if(!(!p||!d)){if(l==="idle"){t&&t.classList.remove("is-hidden"),p.hidden=!0;return}if(t&&t.classList.add("is-hidden"),p.hidden=!1,d.dataset.status=l,u){let g="dashicons-yes-alt";l==="loading"&&(g="dashicons-update"),l==="error"&&(g="dashicons-warning"),u.innerHTML=`<span class="dashicons ${g}" aria-hidden="true"></span>`;let _=u.querySelector(".dashicons");_&&l==="loading"&&(_.style.animation="aipkit_csv_spin 1s linear infinite")}f&&e?f.textContent=e:f&&(f.textContent=""),m&&(m.textContent=o||"")}}async function a(c){let l=c.target,o=l.closest(".aipkit_csv_import_container")||l.closest(".aipkit_form-group");if(!o)return;let e=o.querySelector("[data-csv-status]")!==null,t=o.querySelector(".aipkit_csv_analysis_results"),p=o.querySelector(".aipkit_csv_data_holder"),d=document.getElementById("aipkit_content_writer_nonce"),u=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,f=d?d.value:u;if(!p||!f){console.error("CSV Handler: Missing data holder or nonce field."),e?k(o,"error","Error: A required component is missing.",null):t&&(t.textContent="Error: A required UI component or security token is missing.",t.className="aipkit_form-help aipkit_settings_message-error");return}let m=l.files[0];if(!m){e?k(o,"idle",null,null):t&&(t.textContent="Please select a CSV file first.",t.className="aipkit_form-help aipkit_settings_message-error");return}if(!m.name.toLowerCase().endsWith(".csv")){e?k(o,"error","Invalid file type. Please upload a .csv file.",m.name):t&&(t.textContent="Invalid file type. Please upload a .csv file.",t.className="aipkit_form-help aipkit_settings_message-error");return}e?k(o,"loading","Parsing CSV...",m.name):t&&(t.textContent="Parsing CSV...",t.className="aipkit_form-help aipkit_settings_message-info");let g=new FormData;g.append("file",m),g.append("_ajax_nonce",f),g.append("action","aipkit_content_writer_parse_csv");try{let _=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:g,credentials:"same-origin"});if(!_.ok){let E=`Server returned status ${_.status}`;try{let x=await _.json();x&&x.data&&x.data.message&&(E=x.data.message)}catch{}throw new Error(E)}let h=await _.json();if(!h.success)throw new Error(h.data?.message||"Unknown server error.");let y=h.data;if(y.tasks_found>0){p.value=y.formatted_data;let x=l.id==="aipkit_task_cw_csv_file_input"||!!l.closest("#aipkit_autogpt_container")?`Found ${y.tasks_found} ${y.tasks_found===1?"topic":"topics"}. Ready to save the task.`:`Found ${y.tasks_found} ${y.tasks_found===1?"topic":"topics"}. Hit Generate to proceed.`;e?k(o,"success",x,m.name):t&&(t.textContent=`Success! Found ${y.tasks_found} topics in the CSV file. Ready.`,t.className="aipkit_form-help aipkit_settings_message-success")}else{p.value="";let E="No valid topics found in the CSV file.";e?k(o,"error",E,m.name):t&&(t.textContent=E,t.className="aipkit_form-help aipkit_settings_message-error")}}catch(_){p.value="";let h=_.message||"Failed to parse CSV file.";e?k(o,"error",h,m.name):t&&(t.textContent=`Error: ${h}`,t.className="aipkit_form-help aipkit_settings_message-error"),console.error("CSV Parse Error:",_)}}function r(c){let l=c.target.closest("[data-csv-clear]");if(!l)return;let o=l.closest(".aipkit_csv_import_container");if(!o)return;let e=o.querySelector("input[type='file']"),t=o.querySelector(".aipkit_csv_data_holder");e&&(e.value=""),t&&(t.value=""),k(o,"idle",null,null)}function i(c){if(!c||c.dataset.dragDropAttached==="true")return;let l=p=>{p.preventDefault(),p.stopPropagation()},o=()=>c.classList.add("is-dragover"),e=()=>c.classList.remove("is-dragover"),t=p=>{l(p),e();let u=p.dataTransfer.files;if(u.length>0){let f=c.querySelector("input[type='file']");if(f){let m=new DataTransfer;m.items.add(u[0]),f.files=m.files,f.dispatchEvent(new Event("change",{bubbles:!0}))}}};["dragenter","dragover","dragleave","drop"].forEach(p=>{c.addEventListener(p,l,!1)}),["dragenter","dragover"].forEach(p=>{c.addEventListener(p,o,!1)}),["dragleave","drop"].forEach(p=>{c.addEventListener(p,e,!1)}),c.addEventListener("drop",t,!1),c.dataset.dragDropAttached="true"}function s(){let c=document.getElementById("aipkit_cw_csv_file_input");if(!c||c.dataset.listenerAttached==="true")return;c.addEventListener("change",a),c.dataset.listenerAttached="true";let l=c.closest(".aipkit_csv_import_container");if(l){let o=l.querySelector(".aipkit_csv_dropzone");i(o);let e=l.querySelector("[data-csv-clear]");e&&e.dataset.listenerAttached!=="true"&&(e.addEventListener("click",r),e.dataset.listenerAttached="true")}}function n(){let c=document.getElementById("aipkit_task_cw_csv_file_input");if(!c||c.dataset.listenerAttached==="true")return;c.addEventListener("change",a),c.dataset.listenerAttached="true";let l=c.closest(".aipkit_csv_import_container");if(l){let o=l.querySelector(".aipkit_csv_dropzone");i(o);let e=l.querySelector("[data-csv-clear]");e&&e.dataset.listenerAttached!=="true"&&(e.addEventListener("click",r),e.dataset.listenerAttached="true")}}window.aipkit_initCsvUploadHandler=s,window.aipkit_initTaskCsvUploadHandler=n})();(function(){"use strict";function k(a,r){let i=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!i||!i.value)throw new Error("Security token missing for stream. Please reload.");let s=new URL(window.aipkit_dashboard.ajaxurl);s.searchParams.append("action","aipkit_frontend_chat_stream"),s.searchParams.append("cache_key",a),s.searchParams.append("_ajax_nonce",i.value),r.current&&r.current.close();try{let n=new EventSource(s.toString());return n.userStopped=!1,n}catch(n){throw console.error("EventSource Connection Setup: EventSource creation error:",n),new Error("Could not connect to stream. "+n.message)}}window.aipkit_stream_setupEventSourceConnection=k})();(function(){"use strict";function k(r){let i=r.parentElement,s=i?.closest(".aipkit_cw_output_chunk--primary");s&&(i.scrollHeight>i.clientHeight?s.classList.add("has-overflow"):s.classList.remove("has-overflow"))}function a(r,i,s,n){if(r.data)try{let c=JSON.parse(r.data);if(c.delta){if(i.fullContent+=c.delta,s.classList.contains("is-streaming")||s.classList.add("is-streaming"),!n&&typeof window.aipkit_getMarkdownRenderer=="function"&&(n=window.aipkit_getMarkdownRenderer()),n)s.innerHTML=n.render(i.fullContent);else{let o=s.textContent||"";s.textContent=o+c.delta}typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(s.innerHTML);let l=s.parentElement;l&&l.scrollTo({top:l.scrollHeight,behavior:"smooth"}),k(s),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()}}catch(c){console.error("Stream Message Handler: Error parsing event data.",c)}}window.aipkit_stream_handleMessage=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};async function a(r,i,s,n,c,l){if(i.isDone)return;i.isDone=!0,l&&l.current&&(l.current.close(),l.current=null),s.classList.contains("is-streaming")&&s.classList.remove("is-streaming"),!n&&typeof window.aipkit_getMarkdownRenderer=="function"&&(n=window.aipkit_getMarkdownRenderer()),n&&(s.innerHTML=n.render(i.fullContent)),typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(s.innerHTML),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let o=document.getElementById("aipkit_content_writer_form"),e=o?o.elements.generate_meta_description:null,t=o?o.elements.generate_focus_keyword:null,p=o?o.elements.generate_excerpt:null,d=o?o.elements.generate_tags:null,u=document.getElementById("aipkit_content_writer_nonce")?.value,f=o.elements.ai_provider?.value,m=o.elements.ai_model?.value,g=o.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",_=document.getElementById("aipkit_cw_generated_title_display"),h=_?_.textContent:o.elements.content_title?.value.split("|")[0].trim()||"Untitled",y=o.elements.content_keywords?.value.trim()||"",E="",x=document.getElementById("aipkit_content_writer_title");if(x){let C=x.value.split("|")||[];C.length>1&&(E=C[1].trim())}let w=E||y,S=w;if(t?.checked&&!w&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let C=o.elements.enable_vector_store,b=C&&C.checked?"1":"0",L=o.elements.vector_store_provider?.value,B=o.elements["openai_vector_store_ids[]"],$=B?Array.from(B.selectedOptions).map(P=>P.value):[],W=o.elements.pinecone_index_name?.value,U=o.elements.qdrant_collection_name?.value,D=o.elements.vector_store_top_k?.value,H=o.elements.vector_store_confidence_threshold?.value,Q={generated_content:i.fullContent,final_title:h,provider:f,model:m,prompt_mode:g,custom_keyword_prompt:o.elements.custom_keyword_prompt.value,enable_vector_store:b,vector_store_provider:L,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:U,vector_store_top_k:D,vector_store_confidence_threshold:H,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:u},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",Q);if(F&&F.focus_keyword){S=F.focus_keyword;let P=document.getElementById("aipkit_cw_generated_focus_keyword"),R=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");P&&R&&(P.value=S,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(C){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",C.message||"Failed")}}else if(w){let C=document.getElementById("aipkit_cw_generated_focus_keyword"),b=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");C&&b&&(C.value=w.split(",")[0].trim(),b.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let T=o?o.elements.generate_images_enabled:null,v=o?o.elements.generate_featured_image:null;if((T?.checked||v?.checked)&&i.fullContent.trim()!==""){let C=T?.checked,b=v?.checked,L=String(o.elements.image_provider?.value||"").toLowerCase(),B=String(o.elements.image_model?.value||"").toLowerCase(),$=L==="openai"&&B.startsWith("gpt-image-1"),W=C?parseInt(o.elements.image_count?.value,10)||1:0,U=document.getElementById("aipkit_cw_generated_excerpt"),D=W+(b?1:0),H=C&&b?W>1?`Generating ${W} content images and 1 featured image...`:"Generating 1 content image and 1 featured image...":b?"Generating featured image...":C?W>1?`Generating ${W} content images...`:"Generating content image...":D>1?`Generating ${D} images...`:D===1?"Generating 1 image...":"Generating images...",Q={original_topic:x?x.value.split("|")[0].trim():h,final_title:h,post_title:h,keywords:S,excerpt:U?U.value:"",ai_provider:o.elements.ai_provider?.value,ai_model:o.elements.ai_model?.value,ai_temperature:o.elements.ai_temperature?.value,reasoning_effort:o.elements.reasoning_effort?.value,image_provider:o.elements.image_provider?.value,image_model:o.elements.image_model?.value,image_prompt:o.elements.image_prompt?.value,image_alignment:o.elements.image_alignment?.value,image_size:o.elements.image_size?.value,featured_image_prompt:o.elements.featured_image_prompt?.value,generate_image_title:o.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:o.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:o.elements.generate_image_caption?.checked?"1":"0",generate_image_description:o.elements.generate_image_description?.checked?"1":"0",image_title_prompt:o.elements.image_title_prompt?.value,image_alt_text_prompt:o.elements.image_alt_text_prompt?.value,image_caption_prompt:o.elements.image_caption_prompt?.value,image_description_prompt:o.elements.image_description_prompt?.value,pexels_orientation:o.elements.pexels_orientation?.value,pexels_size:o.elements.pexels_size?.value,pexels_color:o.elements.pexels_color?.value,pixabay_orientation:o.elements.pixabay_orientation?.value,pixabay_image_type:o.elements.pixabay_image_type?.value,pixabay_category:o.elements.pixabay_category?.value,_ajax_nonce:u,generate_images_enabled:C?"1":"0",image_count:W,generate_featured_image:b?"1":"0",image_placement:o.elements.image_placement?.value,image_placement_param_x:o.elements.image_placement_param_x?.value,cw_generation_mode:o.elements.cw_generation_mode?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0},F=R=>{let O=document.getElementById("aipkit_cw_image_data_holder");O&&(O.value=JSON.stringify(R)),typeof window.aipkit_renderContentWriterImagePreview=="function"&&window.aipkit_renderContentWriterImagePreview(R)},P=async(R={},O="")=>{typeof window.aipkit_updateCwGenerationStatus=="function"&&O&&window.aipkit_updateCwGenerationStatus("image","generating",O);let N=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...Q,...R});if(!N?.image_data)throw new Error("Image generation failed or returned no data.");return N.image_data};try{let R=C&&b,O=$&&C&&W>1,N=null,ie=J=>{N||(N={...J,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(R){if(C&&W>0)if(O&&W>1)for(let J=0;J<W;J++){let we=await P({generate_featured_image:"0",image_count:1,image_start_index:J+1},`Generating content image ${J+1} of ${W}...`);ie(we),Array.isArray(we.in_content_images)&&N.in_content_images.push(...we.in_content_images),F(N)}else{let J=await P({generate_featured_image:"0"},W>1?`Generating ${W} content images...`:"Generating content image...");ie(J),N.in_content_images=J.in_content_images||[],F(N)}if(b){let J=await P({generate_images_enabled:"0",image_count:0},"Generating featured image...");ie(J),N.featured_image_id=J.featured_image_id||null,N.featured_image_url=J.featured_image_url||null}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",H),N=await P();if(N)F(N),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success");else throw new Error("Image generation failed or returned no data.")}catch(R){typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",R.message||"Failed")}}else typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(p?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let C=o.elements.enable_vector_store,b=C&&C.checked?"1":"0",L=o.elements.vector_store_provider?.value,B=o.elements["openai_vector_store_ids[]"],$=B?Array.from(B.selectedOptions).map(P=>P.value):[],W=o.elements.pinecone_index_name?.value,U=o.elements.qdrant_collection_name?.value,D=o.elements.vector_store_top_k?.value,H=o.elements.vector_store_confidence_threshold?.value,Q={generated_content:i.fullContent,final_title:h,keywords:S,provider:f,model:m,prompt_mode:g,custom_excerpt_prompt:o.elements.custom_excerpt_prompt.value,enable_vector_store:b,vector_store_provider:L,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:U,vector_store_top_k:D,vector_store_confidence_threshold:H,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:u},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",Q);if(F&&F.excerpt){let P=document.getElementById("aipkit_cw_generated_excerpt"),R=document.getElementById("aipkit_cw_excerpt_output_wrapper");P&&R&&(P.value=F.excerpt,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(C){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",C.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(d?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let C=o.elements.enable_vector_store,b=C&&C.checked?"1":"0",L=o.elements.vector_store_provider?.value,B=o.elements["openai_vector_store_ids[]"],$=B?Array.from(B.selectedOptions).map(P=>P.value):[],W=o.elements.pinecone_index_name?.value,U=o.elements.qdrant_collection_name?.value,D=o.elements.vector_store_top_k?.value,H=o.elements.vector_store_confidence_threshold?.value,Q={generated_content:i.fullContent,final_title:h,keywords:S,provider:f,model:m,prompt_mode:g,custom_tags_prompt:o.elements.custom_tags_prompt.value,enable_vector_store:b,vector_store_provider:L,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:U,vector_store_top_k:D,vector_store_confidence_threshold:H,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:u},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",Q);if(F&&F.tags){let P=document.getElementById("aipkit_cw_generated_tags"),R=document.getElementById("aipkit_cw_tags_output_wrapper");P&&R&&(P.value=F.tags,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(C){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",C.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(e?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let C=o.elements.enable_vector_store,b=C&&C.checked?"1":"0",L=o.elements.vector_store_provider?.value,B=o.elements["openai_vector_store_ids[]"],$=B?Array.from(B.selectedOptions).map(P=>P.value):[],W=o.elements.pinecone_index_name?.value,U=o.elements.qdrant_collection_name?.value,D=o.elements.vector_store_top_k?.value,H=o.elements.vector_store_confidence_threshold?.value,Q={generated_content:i.fullContent,final_title:h,keywords:S,provider:f,model:m,prompt_mode:g,custom_meta_prompt:o.elements.custom_meta_prompt.value,enable_vector_store:b,vector_store_provider:L,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:U,vector_store_top_k:D,vector_store_confidence_threshold:H,vector_embedding_provider:o.elements.vector_embedding_provider?.value,vector_embedding_model:o.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:u},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",Q);if(F&&F.meta_description){let P=document.getElementById("aipkit_cw_generated_meta_desc"),R=document.getElementById("aipkit_cw_meta_desc_output_wrapper");P&&R&&(P.value=F.meta_description,R.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(C){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",C.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(l)}window.aipkit_stream_handleDone=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function a(r,i,s,n,c){if(i.isDone)return;if(c.current&&c.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c);return}let l="Error during streaming.";if(r.data)try{l=JSON.parse(r.data).error||l}catch{}console.error("Stream Error Handler: Error event received:",r),s&&(s.textContent="",s.className="aipkit_cw_status_badge"),n&&n.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",l),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c)}window.aipkit_stream_handleError=a})();(function(){"use strict";let k={current:null};function a(r,i){let s=document.getElementById("aipkit_content_writer_output_display"),n=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_form_status");if(!s||!n||!c){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let l=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let e of l)if(typeof window[e]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${e}`),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let o={fullContent:"",isDone:!1};n.innerHTML="",s.classList.remove("aipkit_content_writer_output_error"),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),window.aipkit_updateCwGenerationStatus("content","generating");try{i.current=window.aipkit_stream_setupEventSourceConnection(r,i);let e=window.aipkit_getMarkdownRenderer();i.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},i.current.onmessage=function(t){window.aipkit_stream_handleMessage(t,o,n,e)},i.current.addEventListener("done",function(t){window.aipkit_stream_handleDone(t,o,n,e,c,i)}),i.current.addEventListener("error",function(t){window.aipkit_stream_handleError(t,o,c,s,i)})}catch(e){console.error("EventSource Orchestrator: Error during setup:",e),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=a,window.aipkit_contentWriterEventSourceInstanceRef=k})();(function(){"use strict";function k(a){a&&a.current&&a.current.close()}window.aipkit_stopContentWriterEventSource=k})();(function(){"use strict";async function k(a){let r=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),s=document.getElementById("aipkit_content_writer_form_status"),n=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_copy_btn"),l=document.getElementById("aipkit_content_writer_clear_btn"),o=document.querySelector(".aipkit_content_writer_progress_bar_container"),e=document.querySelector(".aipkit_content_writer_output_actions"),t=function(m){if(!m)return"Error";let g=m.message||"Error",_=m.details||m.data?.details,h=_?.provider,y=_?.model;return h||y?`${g} (${[h,y].filter(Boolean).join(" \xB7 ")})`:g};if(!r||!i||!s||!n||!c||!l||!e){console.error("Handle SSE: Missing UI elements.");return}let p=new FormData(r),d=Object.fromEntries(p.entries()),u=r.elements["openai_vector_store_ids[]"];if(d.openai_vector_store_ids=u?Array.from(u.selectedOptions).map(m=>m.value):[],delete d["openai_vector_store_ids[]"],!d.conversation_uuid){let m=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();m&&(d.conversation_uuid=m)}if(!d.content_title){s.textContent="",s.className="aipkit_cw_status_badge";return}let f=document.getElementById("aipkit_content_writer_nonce");if(f&&f.value)d._ajax_nonce=f.value;else{s.textContent="",s.className="aipkit_cw_status_badge";return}typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0),o&&(o.style.display="none"),e.style.display="none",n&&(n.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'),c.disabled=!0,l.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),s.textContent="",s.className="aipkit_cw_status_badge";try{d.content_title=document.getElementById("aipkit_content_writer_title").value;let m=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",d);if(!m.cache_key)throw new Error(m.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=m.cache_key,m.conversation_uuid){window.aipkit_current_conversation_uuid=m.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",m.conversation_uuid)}catch{}}if(typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(m.cache_key,a);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(m){console.error("Content Writer Init Stream Error:",m),s&&(s.textContent=t(m),s.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),window.aipkit_setLoadingStateOpenAI(i,!1,"Generate"),typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),n&&(n.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},a=function(i){if(!i)return"Error";let s=i.message||"Error",n=i.details||i.data?.details,c=n?.provider,l=n?.model;return c||l?`${s} (${[c,l].filter(Boolean).join(" \xB7 ")})`:s};async function r(){let i=document.getElementById("aipkit_content_writer_form"),s=document.getElementById("aipkit_content_writer_generate_btn"),n=document.getElementById("aipkit_content_writer_stop_btn"),c=document.getElementById("aipkit_content_writer_form_status"),l=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_content_writer_copy_btn"),e=document.getElementById("aipkit_content_writer_clear_btn"),t=document.querySelector(".aipkit_content_writer_progress_bar_container"),p=t?t.querySelector(".aipkit_content_writer_progress_bar"):null,d=document.querySelector(".aipkit_content_writer_output_actions"),u=document.getElementById("aipkit_cw_status_display_container");if(!i||!s||!n||!c||!l||!o||!e){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),c.textContent="",c.className="aipkit_cw_status_badge";return}let f=new FormData(i),m=Object.fromEntries(f.entries()),g=i.elements["openai_vector_store_ids[]"];if(m.openai_vector_store_ids=g?Array.from(g.selectedOptions).map(w=>w.value):[],delete m["openai_vector_store_ids[]"],!m.conversation_uuid){let w=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();w&&(m.conversation_uuid=w)}if(!m.content_title){c.textContent="",c.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let _=document.getElementById("aipkit_content_writer_nonce");if(_&&_.value)m._ajax_nonce=_.value;else{c.textContent="",c.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}u&&(u.style.display="block");let h=document.getElementById("aipkit_cw_generate_meta_desc"),y=document.getElementById("aipkit_cw_generate_focus_keyword"),E=document.getElementById("aipkit_cw_generate_excerpt"),x=document.getElementById("aipkit_cw_generate_tags");typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",E?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",x?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",h?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",y?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(s,!0,"Generate","Generating..."),n.style.display="none",d&&(d.style.display="none"),l&&(l.innerHTML=""),o.disabled=!0,e.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),c.textContent="Generating content, please wait...",c.className="aipkit_cw_status_badge aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),t&&p&&(t.style.display="block",p.style.width="0%",p.classList.add("aipkit_indeterminate"));try{let w=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",m);if(w.content){if(w.conversation_uuid){window.aipkit_current_conversation_uuid=w.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",w.conversation_uuid)}catch{}}let S=window.aipkit_getMarkdownRenderer();if(l&&(S?l.innerHTML=S.render(w.content):l.textContent=w.content,typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(l.innerHTML)),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),d&&(d.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),o.disabled=!1,e.disabled=!1,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),w.content&&E?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let T=i.elements.enable_vector_store,v=T&&T.checked?"1":"0",A=i.elements.vector_store_provider?.value,C=i.elements["openai_vector_store_ids[]"],b=C?Array.from(C.selectedOptions).map(H=>H.value):[],L=i.elements.pinecone_index_name?.value,B=i.elements.qdrant_collection_name?.value,$=i.elements.vector_store_top_k?.value,W=i.elements.vector_store_confidence_threshold?.value,U={generated_content:w.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_excerpt_prompt:m.custom_excerpt_prompt,enable_vector_store:v,vector_store_provider:A,openai_vector_store_ids:b,pinecone_index_name:L,qdrant_collection_name:B,vector_store_top_k:$,vector_store_confidence_threshold:W,vector_embedding_provider:i.elements.vector_embedding_provider?.value,vector_embedding_model:i.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},D=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",U);if(D&&D.excerpt){let H=document.getElementById("aipkit_cw_generated_excerpt"),Q=document.getElementById("aipkit_cw_excerpt_output_wrapper");H&&Q&&(H.value=D.excerpt,Q.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",T.message||"Not returned")}}if(w.content&&x?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let T=i.elements.enable_vector_store,v=T&&T.checked?"1":"0",A=i.elements.vector_store_provider?.value,C=i.elements["openai_vector_store_ids[]"],b=C?Array.from(C.selectedOptions).map(H=>H.value):[],L=i.elements.pinecone_index_name?.value,B=i.elements.qdrant_collection_name?.value,$=i.elements.vector_store_top_k?.value,W=i.elements.vector_store_confidence_threshold?.value,U={generated_content:w.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||m.content_title,provider:m.ai_provider,model:m.ai_model,prompt_mode:m.prompt_mode,custom_tags_prompt:m.custom_tags_prompt,enable_vector_store:v,vector_store_provider:A,openai_vector_store_ids:b,pinecone_index_name:L,qdrant_collection_name:B,vector_store_top_k:$,vector_store_confidence_threshold:W,vector_embedding_provider:i.elements.vector_embedding_provider?.value,vector_embedding_model:i.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:m._ajax_nonce},D=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",U);if(D&&D.tags){let H=document.getElementById("aipkit_cw_generated_tags"),Q=document.getElementById("aipkit_cw_tags_output_wrapper");H&&Q&&(H.value=D.tags,Q.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(T){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",T.message||"Not returned")}}if(w.meta_description){let T=document.getElementById("aipkit_cw_generated_meta_desc"),v=document.getElementById("aipkit_cw_meta_desc_output_wrapper");T&&v&&(T.value=w.meta_description,v.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else h?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(w.focus_keyword){let T=document.getElementById("aipkit_cw_generated_focus_keyword"),v=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");T&&v&&(T.value=w.focus_keyword,v.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else y?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(w.message||"No content received.")}catch(w){console.error("Content Writer AJAX Error:",w),c&&(c.textContent=a(w),c.className="aipkit_cw_status_badge aipkit_settings_message-error"),l&&(l.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",w.message),E?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),x?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),h?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),y?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),d&&(d.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(s,!1,"Generate"),t&&(t.style.display="none"),p&&p.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function a(r){let i=document.getElementById("aipkit_content_writer_generate_btn"),s=()=>{if(i){if(typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(i,k("Stopping...","gpt3-ai-content-generator"));else{let c=i.querySelector(".aipkit_btn-text");c?c.textContent=k("Stopping...","gpt3-ai-content-generator"):i.textContent=k("Stopping...","gpt3-ai-content-generator")}i.disabled=!0,i.setAttribute("aria-disabled","true")}};if(typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){s(),typeof window.aipkit_cw_requestBatchStop=="function"&&window.aipkit_cw_requestBatchStop();return}if(typeof window.aipkit_cw_isExistingUpdateActive=="function"&&window.aipkit_cw_isExistingUpdateActive()){s(),typeof window.aipkit_cw_requestExistingUpdateStop=="function"&&window.aipkit_cw_requestExistingUpdateStop();return}if(!r||!r.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let n=document.getElementById("aipkit_content_writer_form_status");n&&(n.textContent=k("Stopping...","gpt3-ai-content-generator"),n.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),n.classList.add("aipkit_settings_message-info")),s(),r.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(r):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=a})();(function(){"use strict";let k={rss:["{description}"],url:["{url_content}"]},a=new Set(["task","csv","gsheets"]),r="{topic}",i=p=>{if(!p)return"Error";let d=p.message||"Error",u=p.details||p.data?.details,f=u?.provider,m=u?.model;return f||m?`${d} (${[f,m].filter(Boolean).join(" \xB7 ")})`:d},s=(p,d)=>{let u=p.querySelector(d);return u?String(u.value||""):""},n=(p,d)=>d.filter(u=>!p.includes(u)),c=(p,d,u)=>{let f=[],m=p==="rss"?"RSS":"URL";return d.length&&f.push(`Title prompt: missing ${d.join(", ")}.`),u.length&&f.push(`Content prompt: missing ${u.join(", ")}.`),f.length?`${m} mode works best when your prompts include the source placeholders.

${f.join(`
`)}

Please update your prompts and try again.`:""},l=(p,d)=>{let u=k[d];if(!u)return{shouldWarn:!1,message:""};let f=s(p,"#aipkit_cw_custom_title_prompt").trim(),m=s(p,"#aipkit_cw_custom_content_prompt").trim(),g=f?n(f,u):[],_=m?n(m,u):u.slice(),h=c(d,g,_);return{shouldWarn:!!h,message:h}},o=(p,d)=>d.length?`${p} mode requires ${r} in your prompts.

${d.join(`
`)}

Please update your prompts and try again.`:"",e=(p,d)=>{if(!a.has(d))return{shouldWarn:!1,message:""};let f={task:"Manual entry",csv:"CSV",gsheets:"Google Sheets"}[d]||"This",m=[{selector:"#aipkit_cw_custom_title_prompt",label:"Title prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_content_prompt",label:"Content prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_meta_prompt",label:"Meta description prompt",enabled:()=>!!p.querySelector("#aipkit_cw_generate_meta_desc")?.checked},{selector:"#aipkit_cw_custom_keyword_prompt",label:"Focus keyword prompt",enabled:()=>!!p.querySelector("#aipkit_cw_generate_focus_keyword")?.checked},{selector:"#aipkit_cw_custom_excerpt_prompt",label:"Excerpt prompt",enabled:()=>!!p.querySelector("#aipkit_cw_generate_excerpt")?.checked},{selector:"#aipkit_cw_custom_tags_prompt",label:"Tags prompt",enabled:()=>!!p.querySelector("#aipkit_cw_generate_tags")?.checked}],g=[];m.forEach(h=>{if(!h.enabled())return;let y=s(p,h.selector).trim();(y?n(y,[r]):[r]).length&&g.push(`${h.label}: missing ${r}.`)});let _=o(f,g);return{shouldWarn:!!_,message:_}};function t(p,d,u,f){p&&(p.dataset.listenerAttached||(p.addEventListener("click",async()=>{if(p.dataset.aipkitStopMode==="true"){typeof window.aipkit_handleStopGeneration=="function"&&window.aipkit_handleStopGeneration(f);return}try{delete window.aipkit_current_conversation_uuid,sessionStorage.removeItem("aipkit_current_conversation_uuid")}catch{}typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview();let m=document.getElementById("aipkit_cw_image_data_holder");if(m&&(m.value=""),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),p.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Upgrade URL not found. Please visit our website.",{title:"Upgrade"}):alert("Upgrade URL not found. Please visit our website.");return}if(p.dataset.action==="fetch_feeds"){typeof window.aipkit_handleRssFetchFromGenerateButton=="function"?window.aipkit_handleRssFetchFromGenerateButton(p):console.error("Fetch Feeds: Handler function not found.");return}let g=document.getElementById("aipkit_content_writer_form_status"),_=document.getElementById("aipkit_cw_action_validation"),h=p.dataset.action||"generate",y=h==="generate_single"?"generate":h,E=document.getElementById("aipkit_cw_mode_select"),x=E?E.value:"task";if(x==="single"&&(x="task"),x==="existing"||x.indexOf("existing-")===0){if(typeof window.aipkit_runContentWriterExistingUpdate=="function")window.aipkit_runContentWriterExistingUpdate();else{let O="Update panel is not ready yet. Please refresh the page and try again.";typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(O,{title:"Update existing"}):alert(O)}return}let w=O=>String(O||"").split(/\r?\n/).map(N=>N.trim()).filter(Boolean),S=O=>{let N=String(O||"").split("|").map(ie=>ie.trim());return{topic:N[0]||"",keywords:N[1]||"",category:N[2]||"",authorLogin:N[3]||"",type:N[4]||"",schedule:N[5]||""}},T=()=>{let O=Array.from(d.querySelectorAll("[data-aipkit-bulk-row]"));for(let N of O){let ie=N.querySelector('[data-bulk-field="topic"]'),J=ie?ie.value.trim():"";if(!J)continue;let we=N.querySelector('[data-bulk-field="keywords"]')?.value.trim()||"",$e=N.querySelector('[data-bulk-field="category"]')?.value.trim()||"",Ke=N.querySelector('[data-bulk-field="author"]'),Ue=Ke?Ke.value.trim():"",it=Ke?.selectedOptions?.[0]?.dataset?.userId||"",_t=N.querySelector('[data-bulk-field="type"]')?.value.trim()||"",mt=N.querySelector('[data-bulk-field="schedule"]')?.value.trim()||"";return{topic:J,keywords:we,category:$e,authorLogin:Ue,authorId:it,type:_t,schedule:mt}}return null},v=O=>{if(!O||!O.topic)return;let N=document.getElementById("aipkit_content_writer_title"),ie=O.keywords?`${O.topic} | ${O.keywords}`:O.topic;N&&(N.value=ie,N.dispatchEvent(new Event("change",{bubbles:!0})));let J=d.elements.post_type;J&&O.type&&(J.value=O.type,J.dispatchEvent(new Event("change",{bubbles:!0})));let we=d.elements["post_categories[]"];we&&O.category&&(Array.from(we.options).forEach(Ke=>{Ke.selected=Ke.value===O.category}),we.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect());let $e=d.elements.post_author;if($e){let Ke=O.authorId||"";if(!Ke&&O.authorLogin){let Ue=Array.from($e.options).find(it=>it.dataset.login===O.authorLogin||it.value===O.authorLogin);Ue&&(Ke=Ue.value)}Ke&&($e.value=Ke,$e.dispatchEvent(new Event("change",{bubbles:!0})))}};if(y!=="upgrade"){let O=typeof window.aipkit_validateContentWriterInputs=="function"?window.aipkit_validateContentWriterInputs(d,x):{isValid:!0};if(!O.isValid){typeof window.aipkit_showContentWriterValidationError=="function"?window.aipkit_showContentWriterValidationError(g||_,O.message):g&&(g.textContent=O.message||"",g.className="aipkit_cw_status_badge aipkit_settings_message-error");return}}if(typeof window.aipkit_clearContentWriterValidationMessage=="function"?(window.aipkit_clearContentWriterValidationMessage(g),window.aipkit_clearContentWriterValidationMessage(_)):_&&(_.textContent=""),y==="generate"||y==="create_task"){let{shouldWarn:O,message:N}=l(d,x);if(O){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(N,{title:"Update prompts",okText:"Review prompts"}):alert(N);return}let ie=e(d,x);if(ie.shouldWarn){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(ie.message,{title:"Update prompts",okText:"Review prompts"}):alert(ie.message);return}}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let A=document.getElementById("aipkit_cw_status_display_container"),C=document.getElementById("aipkit_cw_generated_title_display"),b=document.getElementById("aipkit_content_writer_title");if(y==="create_task"){A&&(A.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(d,p,g):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),g&&(g.textContent="",g.className="aipkit_cw_status_badge"));return}let L=d.elements.content_title_bulk,B=w(L?L.value:""),$=y==="generate"&&x==="task"&&B.length===1;if($){let O=T()||S(B[0]);v(O),typeof window.aipkit_cw_resetBatchQueue=="function"&&window.aipkit_cw_resetBatchQueue()}if(y==="generate"&&!$){typeof window.aipkit_cw_handleBatchGeneration=="function"?window.aipkit_cw_handleBatchGeneration(d,x):console.error("Generate Button Listener: aipkit_cw_handleBatchGeneration function not found.");return}let W=document.getElementById("aipkit_cw_single_output_wrapper"),U=document.getElementById("aipkit_cw_output_card");W&&(W.style.display="block"),U&&(U.style.display="block"),A&&(A.style.display="block");let D=document.getElementById("aipkit_content_writer_stream_mode"),Q=d.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),u&&(u.style.display="flex");let F={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[O,N]of Object.entries(F)){let ie=document.getElementById(N);ie&&!ie.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(O,"skipped")}let P=document.getElementById("aipkit_cw_generate_images_enabled"),R=document.getElementById("aipkit_cw_generate_featured_image");if(P&&R&&!P.checked&&!R.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),Q){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),C&&(C.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(p,!0,"Generate","Generating...");let O=new FormData(d),N=Object.fromEntries(O.entries()),ie=d.elements["openai_vector_store_ids[]"];N.openai_vector_store_ids=ie?Array.from(ie.selectedOptions).map($e=>$e.value):[],delete N["openai_vector_store_ids[]"];let J=document.getElementById("aipkit_content_writer_nonce");N._ajax_nonce=J?J.value:"",window.aipkit_current_conversation_uuid&&(N.conversation_uuid=window.aipkit_current_conversation_uuid);let we=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",N);if(we&&we.new_title){if(we.conversation_uuid){window.aipkit_current_conversation_uuid=we.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",we.conversation_uuid)}catch{}}C&&(C.textContent=we.new_title,C.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success")}else throw new Error(we.message||"Failed to generate new title.")}catch(O){console.error("Title Generation Error:",O),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",O.message),g&&(g.textContent=i(O),g.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),C&&b&&(C.textContent=b.value.split("|")[0].trim(),C.style.display="block");!D||D.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(f):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),p.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=t})();(function(){"use strict";function k(a,r){a&&(a.dataset.listenerAttached||(a.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(r):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),a.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=k})();(function(){"use strict";function k(a,r){if(a===r)return!0;if(a==null||typeof a!="object"||r==null||typeof r!="object")return!1;let i=Object.keys(a),s=Object.keys(r);if(i.length!==s.length)return!1;for(let n of i)if(!s.includes(n)||!k(a[n],r[n]))return!1;return!0}window.aipkit_deepEqual=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_content_writer_provider"),r=document.getElementById("aipkit_content_writer_temperature"),i=document.getElementById("aipkit_content_writer_post_author"),s=i?i.value:window.aipkit_dashboard?.currentUserId||"1",c=(a&&a.options.length>0?a.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),l=a?a.value.toLowerCase():c,o="",e=window.aipkit_dashboard?.models?.[l];switch(l){case"openai":o="gpt-4.1-mini";break;case"google":o="gemini-2.5-flash";break;case"openrouter":o="moonshotai/kimi-k2.5";break;case"claude":o="claude-opus-4-6",Array.isArray(e)&&e.length>0&&(e.some(u=>u&&u.id==="claude-opus-4-6")||(o=e[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(e)&&e.length>0?o=e[0].id||"":o="";break;default:o=""}let t=r&&r.defaultValue||"1.0",p=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:l,ai_model:o,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:t,reasoning_effort:"medium",post_type:"post",post_author:s,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:p.title,custom_content_prompt:p.content,generate_title:"1",generate_content:"1",generate_meta_description:"1",custom_meta_prompt:p.meta,generate_focus_keyword:"1",custom_keyword_prompt:p.keyword,generate_excerpt:"1",custom_excerpt_prompt:p.excerpt,generate_tags:"1",custom_tags_prompt:p.tags,custom_title_prompt_update:"",custom_content_prompt_update:"",custom_meta_prompt_update:"",custom_keyword_prompt_update:"",custom_excerpt_prompt_update:"",custom_tags_prompt_update:"",cw_generation_mode:"task",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"dall-e-3",image_prompt:p.image||"A high-quality, relevant image for an article about: {topic}",image_prompt_update:"",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",image_title_prompt:p.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt:p.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt:p.image_caption||"Write a short image caption based on: {topic}",image_description_prompt:p.image_description||"Write a brief image description based on: {topic}",image_title_prompt_update:p.image_title_update||p.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt_update:p.image_alt_text_update||p.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt_update:p.image_caption_update||p.image_caption||"Write a short image caption based on: {topic}",image_description_prompt_update:p.image_description_update||p.image_description||"Write a brief image description based on: {topic}",generate_featured_image:"0",featured_image_prompt:p.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",featured_image_prompt_update:"",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",vector_store_confidence_threshold:"20",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=k})();(function(){"use strict";function k(a){let r={};if(!a)return r;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","custom_title_prompt_update","custom_content_prompt_update","custom_meta_prompt_update","custom_keyword_prompt_update","custom_excerpt_prompt_update","custom_tags_prompt_update","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_prompt_update","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","image_title_prompt_update","image_alt_text_prompt_update","image_caption_prompt_update","image_description_prompt_update","featured_image_prompt","featured_image_prompt_update","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(w=>{a.elements[w]&&(r[w]=a.elements[w].value)});let s=a.elements.generate_meta_description;s?r.generate_meta_description=s.checked?"1":"0":r.generate_meta_description="0";let n=a.elements.generate_focus_keyword;n?r.generate_focus_keyword=n.checked?"1":"0":r.generate_focus_keyword="0";let c=a.elements.generate_excerpt;c?r.generate_excerpt=c.checked?"1":"0":r.generate_excerpt="0";let l=a.elements.generate_tags;l?r.generate_tags=l.checked?"1":"0":r.generate_tags="0";let o=a.elements.generate_title;o?r.generate_title=o.checked?"1":"0":r.generate_title="1";let e=a.elements.generate_content;e?r.generate_content=e.checked?"1":"0":r.generate_content="1";let t=a.elements.generate_toc;t?r.generate_toc=t.checked?"1":"0":r.generate_toc="0";let p=a.elements.generate_seo_slug;p?r.generate_seo_slug=p.checked?"1":"0":r.generate_seo_slug="0";let d=a.elements.generate_images_enabled;d?r.generate_images_enabled=d.checked?"1":"0":r.generate_images_enabled="0";let u=a.elements.generate_featured_image;u?r.generate_featured_image=u.checked?"1":"0":r.generate_featured_image="0",["generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(w=>{let S=a.elements[w];S?r[w]=S.checked?"1":"0":r[w]="1"});let f=a.elements.enable_vector_store;f?r.enable_vector_store=f.checked?"1":"0":r.enable_vector_store="0";let m=a.elements["openai_vector_store_ids[]"];m?r.openai_vector_store_ids=Array.from(m.selectedOptions).map(w=>w.value):r.openai_vector_store_ids=[];let g=a.querySelector("#aipkit_cw_prompt_mode_hidden_input");g?r.prompt_mode=g.value:r.prompt_mode="custom";let _=a.querySelector("#aipkit_cw_mode_select"),h=_?_.value:"task";r.cw_generation_mode=h==="single"?"task":h;let y=a.elements["post_categories[]"];y?r.post_categories=Array.from(y.selectedOptions).map(w=>w.value):r.post_categories=[];let E=["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt"],x=typeof window.aipkit_getContentWriterPromptSets=="function"?window.aipkit_getContentWriterPromptSets():null;return x&&x.create&&E.forEach(w=>{Object.prototype.hasOwnProperty.call(x.create,w)&&(r[w]=x.create[w])}),x&&x.update&&E.forEach(w=>{let S=`${w}_update`;Object.prototype.hasOwnProperty.call(x.update,w)&&(r[S]=x.update[w])}),r}window.aipkit_getContentWriterFormConfig=k})();(function(){"use strict";function k(a){if(!a||!a.value)return!1;let r=a.value,i=window.aipkit_cw_template_state.currentTemplates.find(s=>String(s.id)===String(r));return i&&String(i.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_content_writer_post_status"),r=document.getElementById("aipkit_cw_schedule_options_wrapper"),i=document.getElementById("aipkit_cw_smart_schedule_fields"),s=document.querySelector(".aipkit_schedule_from_input_help"),n=document.querySelector(".aipkit_schedule_from_input_option");if(!a||!r)return;let c=a.value==="publish";r.style.display=c?"block":"none";let l=document.getElementById("aipkit_cw_mode_select"),o=l?l.value:"task",e=new Set(["task","csv","gsheets"]),t=e.has(o);if(n){n.style.display=t?"inline-flex":"none";let u=n.querySelector('input[name="schedule_mode"]');if(!t&&u&&u.checked){let f=document.querySelector('input[name="schedule_mode"][value="immediate"]');f&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(u=>{u.dataset.listenerAttached||(u.addEventListener("change",function(){let f=document.getElementById("aipkit_cw_mode_select"),m=f?f.value:"task",g=e.has(m);i&&(i.style.display=this.value==="smart"?"block":"none"),s&&(s.style.display=this.value==="from_input"&&g?"block":"none")}),u.dataset.listenerAttached="true")});let d=document.querySelector('input[name="schedule_mode"]:checked');d&&i&&(i.style.display=d.value==="smart"?"block":"none"),d&&s&&(s.style.display=d.value==="from_input"&&t?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(n){return n},a={image_title_prompt:"aipkit_cw_image_title_prompt",image_alt_text_prompt:"aipkit_cw_image_alt_text_prompt",image_caption_prompt:"aipkit_cw_image_caption_prompt",image_description_prompt:"aipkit_cw_image_description_prompt"};function r(n){if(!n)return"";let c=document.querySelector(`.aipkit_cw_prompt_library_select[data-aipkit-prompt-target="${CSS.escape(n)}"]`);if(!c)return"";let l=c.querySelector("option");return l?l.value:""}function i(){let n=document.getElementById("aipkit_cw_single_output_wrapper"),c=document.getElementById("aipkit_cw_generated_title_display"),l=document.getElementById("aipkit_cw_generated_content_area"),o=document.getElementById("aipkit_cw_meta_chunk"),e=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),t=document.querySelector(".aipkit_content_writer_output_actions");n&&(n.style.display="none"),c&&(c.style.display="none",c.textContent=""),l&&(l.innerHTML=""),o&&(o.style.display="none"),e&&(e.style.display="none"),t&&(t.style.display="none"),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction()}function s(n,c=!1){let l=window.aipkit_cw_autosave_suspended===!0;window.aipkit_cw_autosave_suspended=!0;try{let o=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,e=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.currentTemplateId=n,n?sessionStorage.setItem("aipkit_cw_last_template_id",n):sessionStorage.removeItem("aipkit_cw_last_template_id");let t=window.aipkit_cw_template_state.currentTemplates.find(f=>String(f.id)===String(n)),p;if(t)p=JSON.parse(JSON.stringify(t.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),e&&!c&&e("Error: Cannot load default template.");return}p=window.aipkit_getDefaultContentWriterTemplateConfig()}let d=p&&p.template_scope==="prompts_only";d||(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(p)),window.aipkit_cw_template_state.currentTemplateModified=!1),i();let u=document.getElementById("aipkit_content_writer_form");if(!u){console.error("Apply Template: Content writer form not found.");return}if(!d&&p.ai_model&&u.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=p.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,p.image_model&&u.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=p.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,d){let f=document.getElementById("aipkit_cw_prompt_mode_hidden_input");f&&(f.value=p.prompt_mode||"custom"),["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt"].forEach(w=>{let S=Object.prototype.hasOwnProperty.call(p,w),T=u.elements[w];if(!T)return;let v=p[w]===null||typeof p[w]>"u"?"":p[w],A=!!a[w],C=typeof v=="string"?v.trim()==="":v==="";if((!S||C)&&A){T.value=r(a[w]);return}S&&(T.value=v)}),["generate_images_enabled","generate_featured_image","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(w=>{if(!Object.prototype.hasOwnProperty.call(p,w))return;let S=u.elements[w];if(!S)return;let T=p[w];S.checked=T==="1"||T===1||T===!0}),["generate_title","generate_content","generate_meta_description","generate_focus_keyword","generate_excerpt","generate_tags"].forEach(w=>{if(!Object.prototype.hasOwnProperty.call(p,w))return;let S=u.elements[w];if(!S)return;let T=p[w];S.checked=T==="1"||T===1||T===!0});let h=u.elements.content_length;h&&Object.prototype.hasOwnProperty.call(p,"content_length")&&(h.value=p.content_length||"medium",h.dispatchEvent(new Event("change",{bubbles:!0})));let y=u.elements.image_provider;y&&Object.prototype.hasOwnProperty.call(p,"image_provider")&&(y.value=p.image_provider||"",y.dispatchEvent(new Event("change",{bubbles:!0}))),["image_count","image_size","image_alignment","image_placement"].forEach(w=>{if(!Object.prototype.hasOwnProperty.call(p,w))return;let S=u.elements[w];if(!S)return;let T=p[w]===null||typeof p[w]>"u"?"":p[w];S.type==="checkbox"?S.checked=T==="1"||T===1||T===!0:S.value=T});let x=u.elements.image_model;if(x&&Object.prototype.hasOwnProperty.call(p,"image_model")){let w=p.image_model||"";w&&x.querySelector(`option[value="${CSS.escape(w)}"]`)&&(x.value=w)}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI()}else{["ai_provider","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(A=>{let C=u.elements[A];if(C){let b=Object.prototype.hasOwnProperty.call(p,A),L=p[A]===null||typeof p[A]>"u"?"":p[A],B=!!a[A],$=typeof L=="string"?L.trim()==="":L==="";if((!b||$)&&B){C.value=r(a[A]);return}if(A==="gsheets_credentials"&&typeof L=="object"&&L!==null)C.value=JSON.stringify(L,null,2);else if((A==="ai_temperature"||A==="vector_store_top_k"||A==="vector_store_confidence_threshold")&&C.type==="range"){C.value=L||(A==="ai_temperature"?"1.0":A==="vector_store_top_k"?"3":A==="vector_store_confidence_threshold"?"20":"");let W=document.getElementById(C.id+"_value");W&&(W.textContent=A==="vector_store_confidence_threshold"?C.value+"%":C.value)}else C.type==="checkbox"?C.checked=L==="1":C.value=L;A==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),A==="content_length"&&C.dispatchEvent(new Event("change",{bubbles:!0}))}});let m=u.elements.gsheets_credentials;if(m){let A=p.gsheets_credentials,C=m.closest(".aipkit_gsheets_section_container");m.value=typeof A=="object"&&A!==null?JSON.stringify(A,null,2):A||"",m.value?(m.dataset.filename="credentials.json",C&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(C),100)):(delete m.dataset.filename,C&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(C,"clear"))}let g={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",enable_vector_store:"0"};for(let[A,C]of Object.entries(g)){let b=u.elements[A];if(b){let L=Object.prototype.hasOwnProperty.call(p,A)?p[A]:C;b.checked=L==="1"||L===1||L===!0}}let _=document.getElementById("aipkit_cw_prompt_mode_hidden_input");_&&(_.value=p.prompt_mode||"custom");let h=u.querySelector("#aipkit_cw_mode_select"),y=p.cw_generation_mode||"task",E=y==="single"?"task":y;h&&(h.value=E,h.dispatchEvent(new Event("change",{bubbles:!0})));let x=u.elements["post_categories[]"];if(x){let A=Array.isArray(p.post_categories)?p.post_categories.map(C=>String(C)):[];Array.from(x.options).forEach(C=>{C.selected=A.includes(C.value)}),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect()}let w=u.elements["openai_vector_store_ids[]"];if(w){let A=Array.isArray(p.openai_vector_store_ids)?p.openai_vector_store_ids.map(String):[];Array.from(w.options).forEach(C=>{C.selected=A.includes(C.value)}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect()}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI();let S=u.elements.enable_vector_store;S&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(S.closest(".aipkit_popover_options_list")||S.closest(".aipkit_cw_settings_popover_body")||document.getElementById("aipkit_content_writer_container"));let T=u.elements.vector_store_provider;T&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(T.value=p.vector_store_provider||"openai",T.dispatchEvent(new Event("change",{bubbles:!0})));let v=u.elements.ai_provider;if(v){let A=v.value,C=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),b=(p.ai_provider||C).toLowerCase();if(A!==b)v.value=b,v.dispatchEvent(new Event("change",{bubbles:!0}));else{let L=u.elements.ai_model;L&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(v,L):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}v.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(n?v.dataset.aipkitProviderNoticeArmed="true":delete v.dataset.aipkitProviderNoticeArmed,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(u))}}if(typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts(),typeof window.aipkit_applyContentWriterPromptSets=="function"&&window.aipkit_applyContentWriterPromptSets(p),d&&(typeof window.aipkit_getContentWriterFormConfig=="function"&&(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=window.aipkit_getContentWriterFormConfig(u)),window.aipkit_cw_template_state.currentTemplateModified=!1),!c&&o&&o("Updated"),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(n),typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(n),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let f=document.getElementById("aipkit_content_writer_container");f&&window.aipkit_cw_toggleReasoningEffort(f)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers(),typeof window.aipkit_refreshUrlCounter=="function"&&window.aipkit_refreshUrlCounter(),typeof window.aipkit_refreshRssCounter=="function"&&window.aipkit_refreshRssCounter()}finally{l||(window.aipkit_cw_autosave_suspended=!1),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline()}}window.aipkit_applyContentWriterTemplate=s})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};async function a(r){if(!r){console.error("Fetch & Populate Templates: Select element is missing.");return}let i=document.getElementById("aipkit_content_writer_template_nonce_field"),s=typeof window.aipkit_clearGeneralStatus=="function"?window.aipkit_clearGeneralStatus:null,n=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;r.innerHTML=`<option value="">${k("Loading templates...")}</option>`,r.disabled=!0,s&&s();try{let c=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:i?i.value:""});window.aipkit_cw_template_state.currentTemplates=c.templates||[],r.innerHTML="";let l=new Option(k("-- Select Template --"),"");r.appendChild(l);let o=window.aipkit_cw_template_state.currentTemplates||[],e=window.aipkit_dashboard?.currentUserId?.toString(),t=null,p=[],d=[],u={};o.forEach(_=>{if(String(_.is_default)==="1"&&_.user_id.toString()===e&&(t=_.id),_.user_id.toString()===e)String(_.is_starter)==="1"||_.is_starter===!0?p.push(_):d.push(_);else{let h=_.display_name||`User ID: ${_.user_id}`;u[h]||(u[h]=[]),u[h].push(_)}});let f=_=>{if(_&&_.starter_order!==void 0&&_.starter_order!==null&&_.starter_order!==""){let x=Number(_.starter_order);if(Number.isFinite(x))return x}let y=(_&&_.template_name?String(_.template_name):"").match(/(\d[\d,]*)/);if(!y)return null;let E=parseInt(y[1].replace(/,/g,""),10);return Number.isFinite(E)?E:null};if(d.sort((_,h)=>_.is_default==="1"?-1:h.is_default==="1"?1:_.template_name.localeCompare(h.template_name)),p.sort((_,h)=>{let y=f(_),E=f(h);return y!==null&&E!==null?y-E:y!==null?-1:E!==null?1:_.template_name.localeCompare(h.template_name)}),p.length>0){let _=document.createElement("optgroup");_.label=k("Starter Templates"),p.forEach(h=>{_.appendChild(new Option(k(h.template_name),h.id))}),r.appendChild(_)}if(d.length>0){let _=document.createElement("optgroup");_.label=k("My Templates"),d.forEach(h=>{_.appendChild(new Option(k(h.template_name),h.id))}),r.appendChild(_)}Object.keys(u).sort().forEach(_=>{let h=document.createElement("optgroup");h.label=k(_),u[_].forEach(y=>{h.appendChild(new Option(k(y.template_name),y.id))}),r.appendChild(h)}),r.disabled=!1;let g=sessionStorage.getItem("aipkit_cw_last_template_id");g&&r.querySelector(`option[value="${CSS.escape(g)}"]`)?(r.value=g,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(g,!0)):t?(r.value=t,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(t,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}catch(c){console.error("Error fetching templates:",c),r.innerHTML=`<option value="">${k("Error loading templates")}</option>`,n&&n(`Error: ${c.message||"Failed to load templates."}`),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}}window.aipkit_fetchAndPopulateTemplates=a})();(function(){"use strict";async function k(a,r,i){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let s=document.getElementById("aipkit_content_writer_template_nonce_field"),n=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,c=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,l=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;n&&n("Updating...");try{let o=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:a,template_name:r,config:JSON.stringify(i),_ajax_nonce:s?s.value:""});c&&c("Updated"),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(o.template_config||i)),window.aipkit_cw_template_state.currentTemplateModified=!1,typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline();let e=document.getElementById("aipkit_cw_template_select"),t=o.template_id?String(o.template_id):"";t&&(window.aipkit_cw_template_state.currentTemplateId=t,sessionStorage.setItem("aipkit_cw_last_template_id",t)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&e&&(await window.aipkit_fetchAndPopulateTemplates(e),t&&(e.value=t,typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(t))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(t||window.aipkit_cw_template_state.currentTemplateId)}catch(o){console.error("Error saving template:",o),l&&l(`Error: ${o.message||"Failed to save template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=k})();(function(){"use strict";function k(a){let r=document.getElementById("aipkit_cw_rename_template_btn"),i=document.getElementById("aipkit_cw_delete_template_btn"),s=window.aipkit_dashboard||{},n=s.isAdmin||!1,c=s.currentUserId?String(s.currentUserId):"0",l=window.aipkit_cw_template_state.currentTemplates.find(p=>String(p.id)===String(a));if(!l){r&&(r.disabled=!0),i&&(i.disabled=!0);return}let o=String(l.user_id)===c,e=o||n,t=o||n;r&&(r.disabled=!e),i&&(i.disabled=!t)}window.aipkit_updateTemplateActionButtonsState=k})();(function(){"use strict";function k(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let a=document.getElementById("aipkit_content_writer_form");if(!a)return;let r=window.aipkit_getContentWriterFormConfig(a),i=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(r,i),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=k})();(function(){"use strict";function k(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function a(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),i=r.value,s=r.options[r.selectedIndex],n=s?s.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(s)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot rename the default template or no template is selected.",{title:"Template"}):alert("Cannot rename the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("rename",n)}window.aipkit_handleRenameContentWriterTemplate=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function a(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),i=r.value,s=r.options[r.selectedIndex],n=s?s.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete: core function missing.",{title:"Template"}):alert("Cannot delete: core function missing."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(s)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete the default template or no template is selected.",{title:"Template"}):alert("Cannot delete the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateDeleteConfirm(n)}window.aipkit_handleDeleteContentWriterTemplate=a})();(function(){"use strict";let k=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,a=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,r=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;async function i(){if(!window.aipkit_cw_template_state||window.aipkit_cw_template_state.isSavingOrDeleting)return;let n=document.getElementById("aipkit_content_writer_template_nonce_field"),c=document.getElementById("aipkit_cw_template_select");window.aipkit_cw_template_state.isSavingOrDeleting=!0,k&&k("Resetting starter templates...");try{await window.aipkit_apiRequest("aipkit_reset_cw_starter_templates",{_ajax_nonce:n?n.value:""}),sessionStorage.removeItem("aipkit_cw_last_template_id"),c&&typeof window.aipkit_fetchAndPopulateTemplates=="function"&&await window.aipkit_fetchAndPopulateTemplates(c),a&&a("Starter templates reset."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover()}catch(l){console.error("Error resetting starter templates:",l),r&&r(`Error: ${l.message||"Failed to reset starter templates."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}function s(){let n="Reset starter templates to their original defaults?",c="Starter Templates";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(n,{title:c,confirmText:"Reset",cancelText:"Cancel",onConfirm:i});return}window.confirm(n)&&i()}window.aipkit_handleResetStarterTemplates=s})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(u){return u},a={short:"Quick reads, ideal for news or updates",medium:"Standard blog posts with good depth",long:"In-depth guides and pillar content"};function r(u){let f=u.toLowerCase();return f.includes("short")?a.short:f.includes("medium")?a.medium:f.includes("long")?a.long:/\b600\b/.test(f)?a.short:/\b1200\b/.test(f)?a.medium:/\b2000\b/.test(f)?a.long:""}function i(u,f){if(f){let m=u.template_name.toLowerCase();return m.includes("short")?"dashicons-text-page":m.includes("medium")?"dashicons-text":m.includes("long")?"dashicons-media-document":"dashicons-star-filled"}return u.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function s(){return{select:document.getElementById("aipkit_cw_template_select"),button:document.getElementById("aipkit_cw_template_picker_btn"),label:document.getElementById("aipkit_cw_template_picker_label"),list:document.getElementById("aipkit_cw_template_picker_list"),search:document.getElementById("aipkit_cw_template_picker_search"),searchClear:document.getElementById("aipkit_cw_template_picker_search_clear")}}function n(u,f){let m=[],g=[],_={};u.forEach(E=>{if(E.user_id.toString()===f)String(E.is_starter)==="1"||E.is_starter===!0?m.push(E):g.push(E);else{let x=E.display_name||`User ID: ${E.user_id}`;_[x]||(_[x]=[]),_[x].push(E)}});let h=E=>{if(E&&E.starter_order!==void 0&&E.starter_order!==null&&E.starter_order!==""){let T=Number(E.starter_order);if(Number.isFinite(T))return T}let w=(E&&E.template_name?String(E.template_name):"").match(/(\d[\d,]*)/);if(!w)return null;let S=parseInt(w[1].replace(/,/g,""),10);return Number.isFinite(S)?S:null};m.sort((E,x)=>{let w=h(E),S=h(x);return w!==null&&S!==null?w-S:w!==null?-1:S!==null?1:E.template_name.localeCompare(x.template_name)}),g.sort((E,x)=>E.is_default==="1"?-1:x.is_default==="1"?1:E.template_name.localeCompare(x.template_name));let y={};return Object.keys(_).sort().forEach(E=>{y[E]=_[E].sort((x,w)=>x.template_name.localeCompare(w.template_name))}),{starterTemplates:m,myTemplates:g,otherUsersTemplates:y}}function c(u){let{label:f,button:m}=s();if(!f||!m||!u)return;let g=u.options[u.selectedIndex],_=g?g.text:k("Select template");f.textContent=_||k("Select template")}function l(u,f){if(!u)return;let m=String(f||"");u.querySelectorAll(".aipkit_cw_template_list_item").forEach(g=>{let h=(g.dataset.templateId||"")===m;g.classList.toggle("is-active",h),g.setAttribute("aria-selected",h?"true":"false")})}function o(u,f=""){let{list:m}=s();if(!m||!u)return;let g=window.aipkit_cw_template_state?.currentTemplates||[],_=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!g.length){let v=u.disabled&&u.options.length&&u.options[0].text.toLowerCase().includes("loading"),A=document.createElement("div");A.className="aipkit_cw_template_picker_empty",A.textContent=k(v?"Loading templates...":"No templates found."),m.appendChild(A),c(u);return}let h=n(g,_),y=document.createDocumentFragment(),E=f.toLowerCase().trim(),x=(v,A)=>{let C=document.createElement("div");if(C.className="aipkit_cw_template_group_label",A){let L=document.createElement("span");L.className=`dashicons ${A}`,L.setAttribute("aria-hidden","true"),C.appendChild(L)}let b=document.createElement("span");return b.textContent=k(v),C.appendChild(b),C},w=(v,A)=>{let C=document.createElement("button");C.type="button",C.className="aipkit_cw_template_list_item",A&&C.classList.add("is-starter"),v.is_default==="1"&&C.classList.add("is-default"),C.dataset.templateId=String(v.id),C.dataset.templateLabel=v.template_name.toLowerCase(),C.setAttribute("role","option"),C.setAttribute("aria-selected","false");let b=i(v,A),L=document.createElement("span");L.className=`aipkit_cw_template_list_icon dashicons ${b}`,L.setAttribute("aria-hidden","true");let B=document.createElement("span");B.className="aipkit_cw_template_list_content";let $=document.createElement("span");if($.className="aipkit_cw_template_list_name",$.textContent=k(v.template_name),B.appendChild($),A){let U=r(v.template_name);if(U){let D=document.createElement("span");D.className="aipkit_cw_template_list_desc",D.textContent=k(U),B.appendChild(D)}}let W=document.createElement("span");return W.className="aipkit_cw_template_list_check dashicons dashicons-yes",W.setAttribute("aria-hidden","true"),C.appendChild(L),C.appendChild(B),C.appendChild(W),C},S=(v,A,C,b=!1)=>{let L=E?A.filter($=>$.template_name.toLowerCase().includes(E)):A;if(!L.length)return 0;let B=document.createElement("div");return B.className="aipkit_cw_template_group",b&&B.classList.add("is-starter-group"),B.appendChild(x(v,C)),L.forEach($=>{B.appendChild(w($,b))}),y.appendChild(B),L.length},T=0;if(T+=S("Starter Templates",h.starterTemplates,"dashicons-star-filled",!0),T+=S("My Templates",h.myTemplates,"dashicons-admin-users",!1),Object.keys(h.otherUsersTemplates).forEach(v=>{T+=S(v,h.otherUsersTemplates[v],"dashicons-groups",!1)}),T===0){let v=document.createElement("div");v.className="aipkit_cw_template_picker_empty",v.textContent=k(E?"No templates match your search.":"No templates found."),m.appendChild(v)}else m.appendChild(y);c(u),l(m,u.value)}function e(u){let{select:f}=s();f&&o(f,u)}function t(){let{search:u,searchClear:f}=s();if(!u)return;let m=null;u.addEventListener("input",_=>{let h=_.target.value;f&&(f.style.display=h?"flex":"none"),clearTimeout(m),m=setTimeout(()=>{e(h)},150)}),f&&f.addEventListener("click",()=>{u.value="",f.style.display="none",e(""),u.focus()});let g=document.getElementById("aipkit_cw_template_picker_popover");g&&new MutationObserver(h=>{h.forEach(y=>{y.attributeName==="aria-hidden"&&g.getAttribute("aria-hidden")==="true"&&u.value&&(u.value="",f&&(f.style.display="none"),e(""))})}).observe(g,{attributes:!0})}function p(){let{select:u,list:f,button:m}=s();!u||!f||(t(),f.dataset.listenerAttached||(f.addEventListener("click",g=>{let _=g.target.closest(".aipkit_cw_template_list_item");if(!_||!u)return;let h=_.dataset.templateId||"";u.value=h,u.dispatchEvent(new Event("change",{bubbles:!0})),l(f,h),m&&m.click()}),f.dataset.listenerAttached="true"),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",()=>{c(u),l(f,u.value)}),u.dataset.listenerAttached="true"),o(u))}function d(u){let{select:f,list:m}=s();f&&(u!==void 0&&(f.value=u),c(f),l(m,f.value))}window.aipkit_initTemplatePicker=p,window.aipkit_renderTemplatePicker=o,window.aipkit_updateTemplatePickerSelection=d})();(function(){"use strict";function k(){let s=document.getElementById("aipkit_cw_template_action_list"),n=document.getElementById("aipkit_cw_template_inline_form"),c=document.getElementById("aipkit_cw_template_inline_delete_confirm"),l=document.getElementById("aipkit_cw_template_name_input");s&&(s.style.display=""),n&&(n.style.display="none",delete n.dataset.mode),c&&(c.style.display="none"),l&&(l.value="")}function a(){k()}function r(s,n=""){let c=document.getElementById("aipkit_cw_template_inline_form"),l=document.getElementById("aipkit_cw_template_name_input"),o=document.getElementById("aipkit_cw_template_action_list");!c||!l||(o&&(o.style.display="none"),c.style.display="flex",c.dataset.mode=s,l.value=n,l.focus())}function i(){let s=document.getElementById("aipkit_cw_template_inline_form"),n=document.getElementById("aipkit_cw_template_name_input");!s||!n||a()}window.aipkit_showTemplateNameForm=r,window.aipkit_hideTemplateNameForm=i,window.aipkit_closeTemplateActionsPopover=a,window.aipkit_resetTemplateActionsPanel=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function a(i){let s=document.getElementById("aipkit_cw_template_inline_form"),n=document.getElementById("aipkit_cw_template_inline_delete_confirm"),c=document.getElementById("aipkit_cw_template_delete_confirm_text"),l=document.getElementById("aipkit_cw_template_action_list");!s||!n||!c||(s.style.display="none",l&&(l.style.display="none"),n.style.display="flex",c.innerHTML=`Delete "<strong>${k(i)}</strong>"?`)}function r(){let i=document.getElementById("aipkit_cw_template_inline_delete_confirm"),s=document.getElementById("aipkit_cw_template_action_list");i&&(i.style.display="none",s&&(s.style.display=""),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover())}window.aipkit_showTemplateDeleteConfirm=a,window.aipkit_hideTemplateDeleteConfirm=r})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_template_save_inline_btn"),r=document.getElementById("aipkit_cw_template_cancel_inline_btn"),i=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_name_input");if(!a||!r||!i||!s){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),a.addEventListener("click",async()=>{let n=i.dataset.mode,c=s.value.trim();if(!c){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}let l=document.getElementById("aipkit_content_writer_form"),o=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let e=window.aipkit_getContentWriterFormConfig(l);if(n==="new")await window.aipkit_saveContentWriterTemplate(0,c,e);else if(n==="rename"){let t=o.value;t&&await window.aipkit_saveContentWriterTemplate(parseInt(t),c,e)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_template_confirm_delete_btn"),r=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!a||!r){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),a.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),s=i.value,n=document.getElementById("aipkit_content_writer_template_nonce_field"),c=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,l=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,o=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.isSavingOrDeleting=!0,c&&c("Updating...");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:s,_ajax_nonce:n?n.value:""}),l&&l("Updated"),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(i)}catch(e){console.error("Error deleting template:",e),o&&o(`Error: ${e.message||"Failed to delete template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_template_select");if(!a){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(a):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?a.addEventListener("change",r=>window.aipkit_applyContentWriterTemplate(r.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_save_as_template_btn");if(!a){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_rename_template_btn");if(!a){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_delete_template_btn");if(!a){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?a.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_reset_starter_templates_btn");if(!a){console.warn("bindResetStarterTemplatesBtn: Button not found.");return}typeof window.aipkit_handleResetStarterTemplates=="function"?a.addEventListener("click",window.aipkit_handleResetStarterTemplates):console.error("bindResetStarterTemplatesBtn: handleResetStarterTemplates function missing.")}window.aipkit_bindResetStarterTemplatesBtn=k})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_content_writer_post_status");if(!a){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(a.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=k})();(function(){"use strict";function k(){let a=document.querySelector(".aipkit_content_writer_inputs");if(!a){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(a.addEventListener("input",window.aipkit_checkFormForModifications),a.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=k})();(function(){"use strict";function k(){let a=["aipkit_initTemplateSelect","aipkit_initTemplatePicker","aipkit_bindSaveAsTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindResetStarterTemplatesBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let i of a)if(typeof window[i]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${i}`);return}window.aipkit_initTemplateSelect(),window.aipkit_initTemplatePicker(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindResetStarterTemplatesBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let r=document.getElementById("aipkit_cw_template_select");r&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(r.value):r&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function a(){let i=document.getElementById("aipkit_cw_save_as_post_btn");if(!i){console.warn("Save as Post Handler: Button not found.");return}i.addEventListener("click",r)}async function r(){let i=document.getElementById("aipkit_content_writer_form"),s=document.getElementById("aipkit_cw_save_as_post_btn"),n=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_output_display"),l=document.getElementById("aipkit_cw_save_post_status");if(!i||!s||!n||!c||!l){console.error("Save as Post: Missing required UI elements.");return}let e=(typeof window.aipkit_getContentWriterRawHtml=="function"?window.aipkit_getContentWriterRawHtml():"")||n.innerHTML;if(!(n.textContent.trim().length>0||!!n.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))){l&&(l.textContent="Nothing to save. Please generate content first.",l.className="aipkit_cw_save_status aipkit_settings_message-error");return}let p=document.getElementById("aipkit_cw_generated_title_display"),d={post_title:p?p.textContent:"Untitled AI Post",post_content:e,generated_excerpt:i.elements.generated_excerpt?.value||"",generated_tags:i.elements.generated_tags?.value||"",meta_description:i.elements.meta_description?i.elements.meta_description.value:"",focus_keyword:i.elements.focus_keyword?i.elements.focus_keyword.value:"",post_type:i.elements.post_type?i.elements.post_type.value:"post",post_author:i.elements.post_author?i.elements.post_author.value:1,post_status:i.elements.post_status?i.elements.post_status.value:"draft",post_schedule_date:i.elements.post_schedule_date?i.elements.post_schedule_date.value:"",post_schedule_time:i.elements.post_schedule_time?i.elements.post_schedule_time.value:"",post_categories:i.elements["post_categories[]"]?Array.from(i.elements["post_categories[]"].selectedOptions).map(u=>u.value):[],generate_toc:i.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:i.elements.image_alignment?i.elements.image_alignment.value:"none",image_size:i.elements.image_size?i.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};l&&(l.textContent="Saving post...",l.className="aipkit_cw_save_status aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(s,!0,"Save","Saving...");try{let u=await window.aipkit_apiRequest("aipkit_content_writer_save_post",d);l&&(l.textContent=u.message||"Post saved successfully!",l.className="aipkit_cw_save_status aipkit_settings_message-success",u.edit_link&&(l.innerHTML+=` <a href="${k(u.edit_link)}" target="_blank">Edit Post</a>`))}catch(u){console.error("Error saving post:",u),l&&(l.textContent=`Error: ${u.message||"Failed to save post."}`,l.className="aipkit_cw_save_status aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(s,!1,"Save as Post"),setTimeout(()=>{l&&(l.textContent="",l.className="aipkit_cw_save_status")},5e3)}}window.aipkit_initSaveAsPostButton=a})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_content_writer_container");if(!a){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let r=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),s=document.getElementById("aipkit_content_writer_stop_btn"),n=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn"),l=document.getElementById("aipkit_content_writer_provider"),o=document.getElementById("aipkit_content_writer_model"),e=document.getElementById("aipkit_content_writer_temperature"),t=document.getElementById("aipkit_cw_save_as_post_btn"),p=document.querySelector(".aipkit_cw_generation_status_indicators");if(!r||!i||!s||!n||!c||!l||!o||!e||!t){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(a):console.error("Content Writer Main: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initContentWriterAssistantSheet=="function"&&window.aipkit_initContentWriterAssistantSheet(a),typeof window.aipkit_initContentWriterPromptFlyouts=="function"?window.aipkit_initContentWriterPromptFlyouts(a):console.error("Content Writer Main: aipkit_initContentWriterPromptFlyouts function not found."),typeof window.aipkit_initContentWriterPromptModeManager=="function"?window.aipkit_initContentWriterPromptModeManager(a):console.error("Content Writer Main: aipkit_initContentWriterPromptModeManager function not found."),typeof window.aipkit_initContentWriterBulkEditor=="function"?window.aipkit_initContentWriterBulkEditor(a):console.error("Content Writer Main: aipkit_initContentWriterBulkEditor function not found."),typeof window.aipkit_initContentWriterGenerateMenu=="function"?window.aipkit_initContentWriterGenerateMenu():console.error("Content Writer Main: aipkit_initContentWriterGenerateMenu function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_content_writer_container"),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(a):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_initContentWriterExistingContent=="function"?window.aipkit_initContentWriterExistingContent(a):console.error("Content Writer Main: aipkit_initContentWriterExistingContent function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(l.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(a)}),o.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(a)}),window.aipkit_cw_toggleReasoningEffort(a)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_content_writer_container"):console.error("Content Writer Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"?window.aipkit_initContentWriterVectorStoreMultiSelect(a):console.error("Content Writer Main: aipkit_initContentWriterVectorStoreMultiSelect function not found."),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"?window.aipkit_initContentWriterCategoriesMultiSelect(a):console.error("Content Writer Main: aipkit_initContentWriterCategoriesMultiSelect function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(l,o,e,i,n,c):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initContentWriterAutosave=="function"?window.aipkit_initContentWriterAutosave():console.error("Content Writer Main: aipkit_initContentWriterAutosave function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let d=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;d&&typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),d&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():d&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),d&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():d&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(i,r,p,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(s,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){t&&(t.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){t&&(t.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=k})();(function(){"use strict";let k=!1,a=null,r=null,i=null,s=!1,n=null,c="aipkit_image_generator_status",l="aipkit_image_gen_preview_theme",o=["dark","light"];function e(){let F=document.getElementById("aipkit_image_generator_container");if(!F){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(F.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(R){console.error("AIPKit Image Generator: Error calling public UI initializer:",R);let O=document.getElementById("aipkit_public_image_results");O&&(O.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let R=document.getElementById("aipkit_public_image_results");R&&(R.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}D(F),W(F),C(F),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_image_generator_container"):console.error("AIPKit Image Generator: aipkit_initApiKeyToggles function not found.")}function t(){return document.getElementById(c)}function p(F,P){let R=t();if(!R)return;let O=R.classList.contains("aipkit_training_status");if(R.textContent=F||"",O){R.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),F&&R.classList.add("is-visible"),P&&R.classList.add(`is-${P}`);return}R.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),P==="success"?R.classList.add("aipkit_form-help-success"):P==="error"&&R.classList.add("aipkit_form-help-error")}function d(F=2500){i&&window.clearTimeout(i),i=window.setTimeout(()=>{p("","")},F)}function u(F){window.aipkit_dashboard||(window.aipkit_dashboard={});let P=window.aipkit_dashboard.providerStatus||{};P.replicate=!!String(F||"").trim(),window.aipkit_dashboard.providerStatus=P,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(document)}function f(){return document.getElementById("aipkit_image_generator_settings_form")}function m(){let F=f();if(!F)return console.error("AIPKit Image Settings: Settings form not found."),null;let P=new FormData(F);if(P.has("frontend_models")){let O=F.querySelector("#aipkit_image_gen_frontend_models");O&&O.value===""&&P.set("frontend_models","")}else{let O=F.querySelector("#aipkit_image_gen_frontend_models");O&&P.append("frontend_models",O.value||"")}let R={};return P.forEach((O,N)=>{R[N]=O}),Object.prototype.hasOwnProperty.call(R,"replicate_api_key")&&delete R.replicate_api_key,R}function g(F){if(!F)return"";let P={};return Object.keys(F).sort().forEach(R=>{P[R]=F[R]}),JSON.stringify(P)}function _(F){r=g(F)}function h(F){return g(F)!==r}function y(F){if(!(F||"").trim()||typeof window.aipkit_queueProviderSync!="function")return null;let R=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:N=>N;p(R("Syncing models...","gpt3-ai-content-generator"),"loading");let O=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return O&&typeof O.then=="function"&&O.then(()=>{p(R("Models synced!","gpt3-ai-content-generator"),"success"),d()}).catch(N=>{p(N?.message||R("Sync failed.","gpt3-ai-content-generator"),"error"),d(4e3)}),O}async function E(F){let P=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:R=>R;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Settings: aipkit_apiRequest not found.");return}p(P("Saving...","gpt3-ai-content-generator"),"loading");try{let R=await window.aipkit_apiRequest("aipkit_save_image_settings",F);return p(R.message||P("Settings saved!","gpt3-ai-content-generator"),"success"),d(),_(F),R}catch(R){throw p(R.message||P("Failed to save settings.","gpt3-ai-content-generator"),"error"),d(4e3),console.error("AIPKit Image Settings Save Error:",R),R}}async function x(F){let P=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:R=>R;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Generator: aipkit_apiRequest not found.");return}p(P("Saving...","gpt3-ai-content-generator"),"loading");try{let R=await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:F});return u(F),p(R.message||P("Replicate key saved!","gpt3-ai-content-generator"),"success"),d(),y(F),R}catch(R){throw p(R.message||P("Failed to save Replicate key.","gpt3-ai-content-generator"),"error"),d(4e3),console.error("AIPKit Replicate Key Save Error:",R),R}}function w(F){if(F){if(k){a=F;return}k=!0,E(F).catch(()=>{}).finally(()=>{if(k=!1,a){let P=a;a=null,h(P)&&w(P)}})}}function S(){let F=m();!F||!h(F)||w(F)}function T(){let F=m();F&&_(F)}function v(F){if(!F)return;let P="data-aipkit-image-autosave-attached";if(F.hasAttribute(P))return;let R=()=>{S()};F.addEventListener("change",O=>{let N=O.target;!N||!N.matches(".aipkit_autosave_trigger")||R()}),F.addEventListener("blur",O=>{let N=O.target;!N||!N.matches(".aipkit_autosave_trigger")||R()},!0),F.setAttribute(P,"true"),T()}function A(F){let P=F.querySelector("#aipkit_replicate_api_key");if(!P)return;let R="data-replicate-autosave-attached";if(P.hasAttribute(R))return;n=P.value||"",u(n);let O=()=>{let N=P.value||"";N===n||s||(s=!0,x(N).then(()=>{n=N}).catch(()=>{}).finally(()=>{s=!1;let ie=m();ie&&_(ie)}))};P.addEventListener("change",O),P.addEventListener("blur",O),P.setAttribute(R,"true")}function C(F){let P=F.querySelector("#aipkit_image_generator_settings_popover");if(!P)return;typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(F):console.error("AIPKit Image Generator: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),b(P);let R="data-token-listener-attached";P.hasAttribute(R)||(P.addEventListener("change",function(O){O.target.closest(".aipkit_token_limit_mode_select")&&L(P)}),P.setAttribute(R,"true")),L(P);try{B(P)}catch(O){console.error("AIPKit Image Settings: Failed to init model selector",O)}v(P),A(P)}function b(F){let P=F.querySelector("#aipkit_image_generator_settings_panel");if(!P)return;let R=Array.from(P.querySelectorAll("[data-aipkit-settings-panel]"));if(!R.length||P.dataset.panelsBound==="true")return;let O=F.querySelector(".aipkit_model_settings_popover_title"),N=F.querySelector(".aipkit_model_settings_popover_back"),ie=document.getElementById("aipkit_image_generator_settings_trigger"),J={root:P.dataset.titleRoot||"Settings","token-management":P.dataset.titleTokenManagement||"Token Management",replicate:P.dataset.titleReplicate||"Replicate","ui-text":P.dataset.titleUiText||"UI Text","custom-css":P.dataset.titleCustomCss||"Custom CSS","provider-filtering":P.dataset.titleProviderFiltering||"Provider Filtering"},we=null,$e=Ke=>{let Ue=Ke||"root",it=P.querySelector(`[data-aipkit-settings-panel="${Ue}"]`)||P.querySelector('[data-aipkit-settings-panel="root"]');if(!it)return;let _t=it.dataset.aipkitSettingsPanel||"root";if(_t!==we){if(R.forEach(mt=>{mt.hidden=mt!==it}),O&&(O.textContent=J[_t]||J.root),N&&(N.hidden=_t==="root"),_t==="token-management"&&L(F),_t==="replicate"){let mt=F.querySelector("#aipkit_replicate_api_key");y(mt?mt.value:"")}we=_t,F.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))})}};P.addEventListener("click",Ke=>{let Ue=Ke.target.closest("[data-aipkit-panel-target]");Ue&&(Ke.preventDefault(),$e(Ue.dataset.aipkitPanelTarget))}),N&&N.addEventListener("click",Ke=>{Ke.preventDefault(),$e("root")}),ie&&ie.addEventListener("click",()=>{$e("root")}),$e("root"),P.dataset.panelsBound="true"}function L(F){if(!F)return;let P=F.querySelector(".aipkit_token_limit_mode_select"),R=F.querySelector(".aipkit_token_general_user_limit_field"),O=F.querySelector(".aipkit_token_role_limits_container");if(!P||!R||!O)return;let N=P.value;R&&(R.hidden=N!=="general"),O&&(O.hidden=N!=="role_based")}function B(F){let P=F.querySelector("#aipkit_image_gen_models_selector");if(!P||P.getAttribute("data-enhanced")==="true")return;let R=F.querySelector("#aipkit_image_gen_frontend_models"),O=P.dataset.initialValue||"",ie=!0&&O===""?[]:O.split(",").map(qe=>qe.trim()).filter(Boolean),J=new Set(ie),we=window.aipkit_image_generator_config_public||{},$e=qe=>{if(!qe||typeof qe!="object")return!1;let qt={image_output:!0,image_generation:!0};if(!qe.capabilities||typeof qe.capabilities!="object")return!0;let Wt={...qt,...qe.capabilities};return!!(Wt.image_output||Wt.image_generation)},Ke=we.azure_models||[];if((!Ke||Ke.length===0)&&window.aipkit_dashboard_providers)try{Array.isArray(window.aipkit_dashboard_providers.AzureImage)&&(Ke=window.aipkit_dashboard_providers.AzureImage.map(qe=>typeof qe=="string"?{id:qe,name:qe}:qe))}catch{}let Ue=[{key:"openai",label:"OpenAI",type:"flat",models:(we.openai_models||[]).map(qe=>({id:qe.id,name:qe.name}))},{key:"openrouter",label:"OpenRouter",type:"flat",models:(we.openrouter_image_models||[]).filter(qe=>$e(qe)).map(qe=>({id:qe.id||qe.name||qe,name:qe.name||qe.id||qe}))},{key:"azure",label:"Azure",type:"flat",models:Ke.map(qe=>qe.id?qe:{id:qe.id||qe.name||qe,name:qe.name||qe.id||qe})},{key:"google",label:"Google",type:"grouped",models:we.google_models||{}},{key:"replicate",label:"Replicate",type:"flat",models:(we.replicate_models||[]).map(qe=>qe.id?qe:{id:qe.id||qe.name||qe,name:qe.name||qe.id||qe})}].filter(qe=>qe.key==="azure"||qe.key==="openrouter"?!0:qe.models&&(Array.isArray(qe.models)?qe.models.length:Object.keys(qe.models).length));P.innerHTML="",P.classList.add("aipkit_models_selector--ready");let it=document.createElement("input");it.type="search",it.placeholder="Filter models...",it.className="aipkit_models_selector-search",P.appendChild(it);let _t=document.createElement("div");_t.className="aipkit_models_selector-summary",P.appendChild(_t);let mt=document.createElement("div");mt.className="aipkit_models_selector-providers",P.appendChild(mt),Ue.forEach(qe=>{let qt=document.createElement("div");qt.className="aipkit_models_selector-provider",qt.dataset.provider=qe.key;let Wt=document.createElement("div");Wt.className="aipkit_models_selector-provider-header",Wt.innerHTML=`<strong>${qe.label}</strong>`;let ui=document.createElement("div");ui.className="aipkit_models_selector-provider-actions";let ae=document.createElement("button");ae.type="button",ae.className="aipkit_btn aipkit_btn-xs",ae.textContent="All";let Ce=document.createElement("button");Ce.type="button",Ce.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",Ce.textContent="None",ui.appendChild(ae),ui.appendChild(Ce),Wt.appendChild(ui),qt.appendChild(Wt);let Ae=document.createElement("div");Ae.className="aipkit_models_selector-models";let Oe=Fe=>{if(!Fe||!Fe.id)return;let We=Fe.id,je=document.createElement("label");je.className="aipkit_models_selector-item",je.title=We;let Qe=document.createElement("input");Qe.type="checkbox",Qe.value=We,Qe.checked=J.has(We),Qe.dataset.modelId=We,Qe.addEventListener("change",()=>{Nt(!0)});let xt=document.createElement("span");xt.textContent=Fe.name||We,je.appendChild(Qe),je.appendChild(xt),Ae.appendChild(je)};if(qe.type==="grouped"?Object.keys(qe.models).forEach(Fe=>{let We=qe.models[Fe];if(!Array.isArray(We))return;let je=document.createElement("div");je.className="aipkit_models_selector-subgroup",je.textContent=Fe.charAt(0).toUpperCase()+Fe.slice(1),Ae.appendChild(je),We.forEach(Qe=>Oe(Qe))}):qe.models.forEach(Fe=>Oe(Fe)),qe.key==="azure"&&qe.models.length===0){let Fe=document.createElement("div");Fe.className="aipkit_models_selector-empty",Fe.textContent="No Azure image models found. Sync Azure Image models in the main Models settings first.",Ae.appendChild(Fe)}if(qe.key==="openrouter"&&qe.models.length===0){let Fe=document.createElement("div");Fe.className="aipkit_models_selector-empty",Fe.textContent="No image-capable OpenRouter models found. Sync OpenRouter models in the main Models settings first.",Ae.appendChild(Fe)}ae.addEventListener("click",()=>{Ae.querySelectorAll('input[type="checkbox"]').forEach(Fe=>{Fe.checked=!0}),Nt(!0)}),Ce.addEventListener("click",()=>{Ae.querySelectorAll('input[type="checkbox"]').forEach(Fe=>{Fe.checked=!1}),Nt(!0)}),qt.appendChild(Ae),mt.appendChild(qt)}),it.addEventListener("input",()=>{let qe=it.value.toLowerCase();mt.querySelectorAll(".aipkit_models_selector-item").forEach(qt=>{let Wt=qt.textContent.toLowerCase();qt.style.display=Wt.includes(qe)?"":"none"})}),P.setAttribute("data-enhanced","true"),Ot();function Ot(){let qe=Array.from(P.querySelectorAll(".aipkit_models_selector-item input:checked")).map(qt=>qt.value);qe.length===0?_t.textContent="Showing all models (none selected)":_t.textContent=`${qe.length} model${qe.length>1?"s":""} selected`}function Nt(qe=!1){let qt=Array.from(P.querySelectorAll(".aipkit_models_selector-item input:checked")).map(Wt=>Wt.value.trim()).filter(Boolean);R&&(R.value=qt.join(", ")),Ot(),qe&&S()}window.aipkit_syncAllowedModelsHiddenField=Nt}function $(F=!1){typeof window.aipkit_syncAllowedModelsHiddenField=="function"&&window.aipkit_syncAllowedModelsHiddenField(F)}function W(F){let P=F.querySelector("#aipkit_theme_switcher_toggle_btn"),R=F.querySelector(".aipkit_image_generator_admin_preview_wrapper");if(!P||!R){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",F);return}let O=o.indexOf(localStorage.getItem(l)||"dark");O===-1&&(O=o.indexOf("dark")),U(o[O],R,P),P.hasAttribute("data-listener-attached")||(P.addEventListener("click",function(){O=(O+1)%o.length;let N=o[O];U(N,R,P),localStorage.setItem(l,N)}),P.setAttribute("data-listener-attached","true"))}function U(F,P,R){let O=P.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");O&&(o.forEach(J=>O.classList.remove(`aipkit-theme-${J}`)),O.classList.add(`aipkit-theme-${F}`));let N=F.charAt(0).toUpperCase()+F.slice(1),ie="Toggle Preview Theme";R.title=`${ie} (Current: ${N})`}function D(F){let P=F.querySelector("#aipkit_image_generator_shortcode_snippet"),R=F.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),O=F.querySelector("#aipkit_image_generator_shortcode_configurator"),N=F.querySelector("#aipkit_image_generator_shortcode_configurator .aipkit_model_settings_popover_close"),ie=F.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!P||!R||!O||ie.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",F);return}R.hasAttribute("data-listener-attached")||(R.addEventListener("click",()=>{let J=O.style.display==="none"||!O.style.display;O.style.display=J?"flex":"none",R.classList.toggle("aipkit_active",J),R.setAttribute("aria-expanded",J.toString())}),N&&N.addEventListener("click",()=>{O.style.display="none",R.classList.remove("aipkit_active"),R.setAttribute("aria-expanded","false")}),H(O),ie.forEach(J=>J.addEventListener("change",()=>{J.name==="cfg_mode"&&H(O),Q(F)})),P.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(P.textContent,P):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),Q(F),R.setAttribute("data-listener-attached","true"))}function H(F){if(!F)return;let P=F.querySelector('select[name="cfg_mode"]');if(!P)return;let R=F.querySelector(".aipkit_image_shortcode_default_mode_row"),O=F.querySelector(".aipkit_image_shortcode_mode_switch_row"),N=F.querySelector('select[name="cfg_default_mode"]'),ie=F.querySelector('input[name="cfg_show_mode_switch"]'),J=P.value==="both";R&&(R.hidden=!J),O&&(O.hidden=!J),J||(N&&(N.value=P.value==="edit"?"edit":"generate"),ie&&(ie.checked=!0))}function Q(F){let P=F.querySelector("#aipkit_image_generator_shortcode_snippet"),R=F.querySelector("#aipkit_image_generator_shortcode_configurator");if(!P||!R)return;let O=R.querySelector('input[name="cfg_show_provider"]').checked,N=R.querySelector('input[name="cfg_show_model"]').checked,ie=R.querySelector('input[name="cfg_show_history"]').checked,J=R.querySelector('select[name="cfg_mode"]'),we=R.querySelector('select[name="cfg_default_mode"]'),$e=R.querySelector('input[name="cfg_show_mode_switch"]'),Ke=R.querySelector('select[name="cfg_theme"]'),Ue=R.querySelector('input[name="cfg_theme"]:checked'),it=Ke?Ke.value:Ue?Ue.value:"dark",_t=J?J.value:"generate",mt=we?we.value:"generate",Ot=$e?$e.checked:!0,Nt="[aipkit_image_generator";O||(Nt+=' show_provider="false"'),N||(Nt+=' show_model="false"'),ie&&(Nt+=' history="true"'),_t!=="generate"&&(Nt+=` mode="${_t}"`),_t==="both"&&mt!=="generate"&&(Nt+=` default_mode="${mt}"`),_t==="both"&&!Ot&&(Nt+=' show_mode_switch="false"'),it!=="dark"&&(Nt+=` theme="${it}"`),Nt+="]",P.textContent=Nt}window.aipkit_initImageGenerator=e})();(function(){"use strict";function k(a,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let s=window.aipkit_post_enhancer,n=s?.nonce_generate_title,c=s?.text||{};if(!n){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let l={_ajax_nonce:n,post_id:a};window.aipkit_apiRequest("aipkit_generate_title_suggestions",l).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(c.no_suggestions_title||"No title suggestions generated.");typeof r=="function"&&r(null,o.suggestions,i)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Title):",o),typeof r=="function"&&r(o,null,i)})}window.aipkit_fetchTitleSuggestions=k})();(function(){"use strict";let k=null;function a(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function r(n,c,l){k&&a();let o=window.aipkit_escapeHtml||function(_){return _},e=window.aipkit_escapeAttribute||o,t=l?.default_ai_provider||"N/A",p=l?.default_ai_model||"N/A",d=l?.default_ai_params||{},u=d.temperature!==void 0?parseFloat(d.temperature).toFixed(1):"N/A",m=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(t)}</strong>`).replace("%2$s",`<strong>${o(p)}</strong>`).replace("%3$s",o(u));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",_=>{_.target===k&&a()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=n,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(c.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(c.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(n,c){if(!k)return;let l=k.querySelector(".aipkit-modal-body");if(!l)return;let o=window.aipkit_escapeHtml||function(p){return p},e=window.aipkit_escapeAttribute||o;l.innerHTML=`
            <p>${o(c.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${n.map(p=>`<li data-new-title="${e(p)}">${o(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let t=l.querySelector(".aipkit-suggestions-list");t&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(t):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function s(n,c){if(!k)return;let l=k.querySelector(".aipkit-modal-body");if(!l)return;let o=window.aipkit_escapeHtml||function(e){return e};l.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(c.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${o(n)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=r,window.aipkit_updateModalWithSuggestions=i,window.aipkit_updateModalWithError=s,window.aipkit_closePostTitleModal=a})();(function(){"use strict";let k=!1;function a(){k=!1}function r(n){if(k)return;k=!0;let c=n.currentTarget,l=c.closest(".aipkit-modal-content"),o=l?.dataset.postId,e=c.dataset.newTitle,t=l?.querySelector(".aipkit-modal-status"),p=l?.querySelectorAll(".aipkit-suggestions-list li"),d=window.aipkit_post_enhancer?.text||{};if(!o||!e||!t||!p){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),t&&(t.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),k=!1;return}p.forEach(u=>u.classList.add("aipkit-disabled")),t.innerHTML=`<span class="aipkit_spinner"></span> ${d.updating_title||"Updating Title..."}`,t.style.color="",i(o,e,t,p,d)}function i(n,c,l,o,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),l.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(d=>d.classList.remove("aipkit-disabled")),k=!1;return}let t=window.aipkit_post_enhancer?.nonce_update_title;if(!t){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),l.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(d=>d.classList.remove("aipkit-disabled")),k=!1;return}let p={_ajax_nonce:t,post_id:n,new_value:c};window.aipkit_apiRequest("aipkit_update_post_title",p).then(d=>{let u=document.querySelector(`#post-${n} .row-title`);u?u.textContent=c:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${n}.`);let f=document.getElementById(`post-${n}`);if(f){let m=f.querySelector(`#inline_${n}`);if(m){let g=m.querySelector(".post_title");g?g.textContent=c:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${n}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${n}.`)}window.aipkit_closePostTitleModal()}).catch(d=>{console.error("AIPKit Post Enhancer Update Error (Title):",d),l.innerHTML=`<span class="error">${d.message||e.error_updating_title||"Error updating title."}</span>`,o.forEach(u=>u.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function s(n){n&&n.addEventListener("click",function(c){let l=c.target.closest("li[data-new-title]");l&&r({currentTarget:l})})}window.aipkit_attachSuggestionClickListener=s,window.aipkit_resetTitleUpdateFlag=a})();(function(){"use strict";function k(a,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let s=window.aipkit_post_enhancer,n=s?.nonce_generate_excerpt,c=s?.text||{};if(!n){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let l={_ajax_nonce:n,post_id:a};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",l).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(c.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof r=="function"&&r(null,o.suggestions,i)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",o),typeof r=="function"&&r(o,null,i)})}window.aipkit_fetchExcerptSuggestions=k})();(function(){"use strict";let k=null;function a(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function r(n,c,l){k&&a();let o=window.aipkit_escapeHtml||function(_){return _},e=window.aipkit_escapeAttribute||o,t=l?.default_ai_provider||"N/A",p=l?.default_ai_model||"N/A",d=l?.default_ai_params||{},u=d.temperature!==void 0?parseFloat(d.temperature).toFixed(1):"N/A",m=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(t)}</strong>`).replace("%2$s",`<strong>${o(p)}</strong>`).replace("%3$s",o(u));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",_=>{_.target===k&&a()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=n,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(c.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(c.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(n,c){if(!k)return;let l=k.querySelector(".aipkit-modal-body");if(!l)return;let o=window.aipkit_escapeHtml||function(p){return p},e=window.aipkit_escapeAttribute||o;l.innerHTML=`
            <p>${o(c.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${n.map(p=>`<li data-new-excerpt="${e(p)}">${o(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let t=l.querySelector(".aipkit-suggestions-list");t&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(t):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function s(n,c){if(!k)return;let l=k.querySelector(".aipkit-modal-body");if(!l)return;let o=window.aipkit_escapeHtml||function(e){return e};l.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(c.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${o(n)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=r,window.aipkit_updateModalWithExcerptSuggestions=i,window.aipkit_updateModalWithErrorExcerpt=s,window.aipkit_closePostExcerptModal=a})();(function(){"use strict";let k=!1;function a(){k=!1}function r(n){if(k)return;k=!0;let c=n.currentTarget,l=c.closest(".aipkit-modal-content"),o=l?.dataset.postId,e=c.dataset.newExcerpt,t=l?.querySelector(".aipkit-modal-status"),p=l?.querySelectorAll(".aipkit-suggestions-list li"),d=window.aipkit_post_enhancer?.text||{};if(!o||e===void 0||!t||!p){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:o,newExcerpt:e,statusDiv:t,listItems:p}),t&&(t.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),k=!1;return}p.forEach(u=>u.classList.add("aipkit-disabled")),t.innerHTML=`<span class="aipkit_spinner"></span> ${d.updating_excerpt||"Updating Excerpt..."}`,t.style.color="",i(o,e,t,p,d)}function i(n,c,l,o,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),l.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(d=>d.classList.remove("aipkit-disabled")),k=!1;return}let t=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!t){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),l.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(d=>d.classList.remove("aipkit-disabled")),k=!1;return}let p={_ajax_nonce:t,post_id:n,new_value:c};window.aipkit_apiRequest("aipkit_update_post_excerpt",p).then(d=>{window.aipkit_closePostExcerptModal()}).catch(d=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",d),l.innerHTML=`<span class="error">${d.message||e.error_updating_excerpt||"Error updating excerpt."}</span>`,o.forEach(u=>u.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function s(n){n&&n.addEventListener("click",function(c){let l=c.target.closest("li[data-new-excerpt]");l&&r({currentTarget:l})})}window.aipkit_attachExcerptSuggestionClickListener=s,window.aipkit_resetExcerptUpdateFlag=a})();(function(){"use strict";function k(a,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let s=window.aipkit_post_enhancer,n=s?.nonce_generate_meta,c=s?.text||{};if(!n){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let l={_ajax_nonce:n,post_id:a};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",l).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(c.no_suggestions_meta||"No meta description suggestions generated.");typeof r=="function"&&r(null,o.suggestions,i)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",o),typeof r=="function"&&r(o,null,i)})}window.aipkit_fetchMetaSuggestions=k})();(function(){"use strict";let k=null;function a(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function r(n,c,l){k&&a();let o=window.aipkit_escapeHtml||function(_){return _},e=window.aipkit_escapeAttribute||o,t=l?.default_ai_provider||"N/A",p=l?.default_ai_model||"N/A",d=l?.default_ai_params||{},u=d.temperature!==void 0?parseFloat(d.temperature).toFixed(1):"N/A",m=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(t)}</strong>`).replace("%2$s",`<strong>${o(p)}</strong>`).replace("%3$s",o(u));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",_=>{_.target===k&&a()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=n,g.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${o(c.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${o(c.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${m}</p>
                </div>
            </div>
        `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(n,c){if(!k)return;let l=k.querySelector(".aipkit-modal-body");if(!l)return;let o=window.aipkit_escapeHtml||function(p){return p},e=window.aipkit_escapeAttribute||o;l.innerHTML=`
            <p>${o(c.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${n.map(p=>`<li data-new-meta="${e(p)}">${o(p)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let t=l.querySelector(".aipkit-suggestions-list");t&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(t):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function s(n,c){if(!k)return;let l=k.querySelector(".aipkit-modal-body");if(!l)return;let o=window.aipkit_escapeHtml||function(e){return e};l.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${o(c.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${o(n)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=r,window.aipkit_updateModalWithMetaSuggestions=i,window.aipkit_updateModalWithErrorMeta=s,window.aipkit_closePostMetaModal=a})();(function(){"use strict";let k=!1;function a(){k=!1}function r(n){if(k)return;k=!0;let c=n.currentTarget,l=c.closest(".aipkit-modal-content"),o=l?.dataset.postId,e=c.dataset.newMeta,t=l?.querySelector(".aipkit-modal-status"),p=l?.querySelectorAll(".aipkit-suggestions-list li"),d=window.aipkit_post_enhancer?.text||{};if(!o||e===void 0||!t||!p){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:o,newMetaDesc:e,statusDiv:t,listItems:p}),t&&(t.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),k=!1;return}p.forEach(u=>u.classList.add("aipkit-disabled")),t.innerHTML=`<span class="aipkit_spinner"></span> ${d.updating_meta||"Updating Meta Desc..."}`,t.style.color="",i(o,e,t,p,d)}function i(n,c,l,o,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),l.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(d=>d.classList.remove("aipkit-disabled")),k=!1;return}let t=window.aipkit_post_enhancer?.nonce_update_meta;if(!t){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),l.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(d=>d.classList.remove("aipkit-disabled")),k=!1;return}let p={_ajax_nonce:t,post_id:n,new_value:c};window.aipkit_apiRequest("aipkit_update_post_meta_desc",p).then(d=>{try{let m=`${`#post-${n}`} .column-wpseo-metadesc`,g=document.querySelector(m);g&&(g.textContent=window.aipkit_escapeHtml(c),g.style.transition="background-color 0.1s ease-out",g.style.backgroundColor="#f0f7ff",setTimeout(()=>{g.style.backgroundColor=""},300))}catch(u){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",u)}window.aipkit_closePostMetaModal()}).catch(d=>{console.error("AIPKit Post Enhancer Update Error (Meta):",d),l.innerHTML=`<span class="error">${d.message||e.error_updating_meta||"Error updating meta description."}</span>`,o.forEach(u=>u.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function s(n){n&&n.addEventListener("click",function(c){let l=c.target.closest("li[data-new-meta]");l&&r({currentTarget:l})})}window.aipkit_attachMetaSuggestionClickListener=s,window.aipkit_resetMetaUpdateFlag=a})();(function(){"use strict";function k(a,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let s=window.aipkit_post_enhancer,n=s?.nonce_generate_tags,c=s?.text||{};if(!n){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let l={_ajax_nonce:n,post_id:a};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",l).then(o=>{if(!o?.suggestions||o.suggestions.length===0)throw new Error(c.no_suggestions_tags||"No tag suggestions generated.");typeof r=="function"&&r(null,o.suggestions,i)}).catch(o=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",o),typeof r=="function"&&r(o,null,i)})}window.aipkit_fetchTagsSuggestions=k})();(function(){"use strict";let k=null;function a(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function r(n,c,l){k&&a();let o=window.aipkit_escapeHtml||(_=>_),e=window.aipkit_escapeAttribute||o,t=l?.default_ai_provider||"N/A",p=l?.default_ai_model||"N/A",d=l?.default_ai_params||{},u=d.temperature!==void 0?parseFloat(d.temperature).toFixed(1):"N/A",m=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${o(t)}</strong>`).replace("%2$s",`<strong>${o(p)}</strong>`).replace("%3$s",o(u));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",_=>{_.target===k&&a()});let g=document.createElement("div");return g.className="aipkit-modal-content",g.dataset.postId=n,g.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${o(c.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${e(c.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${o(c.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${m}</p>
            </div>
        </div>
    `,k.appendChild(g),document.body.appendChild(k),g.querySelector(".aipkit-modal-close-btn").addEventListener("click",a),requestAnimationFrame(()=>k.classList.add("aipkit-active")),k}function i(n,c){if(!k)return;let l=k.querySelector(".aipkit-modal-body");if(!l)return;let o=window.aipkit_escapeHtml||(p=>p),e=window.aipkit_escapeAttribute||o;l.innerHTML=`
        <p>${o(c.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${n.map(p=>`<li data-new-tags="${e(p)}">${o(p)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let t=l.querySelector(".aipkit-suggestions-list");t&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(t):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function s(n,c){if(!k)return;let l=k.querySelector(".aipkit-modal-body");if(!l)return;let o=window.aipkit_escapeHtml||(e=>e);l.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${o(c.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${o(n)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=r,window.aipkit_updateModalWithTagsSuggestions=i,window.aipkit_updateModalWithErrorTags=s,window.aipkit_closePostTagsModal=a})();(function(){"use strict";let k=!1;function a(){k=!1}function r(n){if(k)return;k=!0;let c=n.currentTarget,l=c.closest(".aipkit-modal-content"),o=l?.dataset.postId,e=c.dataset.newTags,t=l?.querySelector(".aipkit-modal-status"),p=l?.querySelectorAll(".aipkit-suggestions-list li"),d=window.aipkit_post_enhancer?.text||{};if(!o||e===void 0||!t||!p){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:o,newTags:e,statusDiv:t,listItems:p}),t&&(t.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),k=!1;return}p.forEach(u=>u.classList.add("aipkit-disabled")),t.innerHTML=`<span class="aipkit_spinner"></span> ${d.updating_tags||"Updating Tags..."}`,t.style.color="",i(o,e,t,p,d)}function i(n,c,l,o,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),l.innerHTML='<span class="error">Error: Configuration missing.</span>',o.forEach(d=>d.classList.remove("aipkit-disabled")),k=!1;return}let t=window.aipkit_post_enhancer?.nonce_update_tags;if(!t){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),l.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',o.forEach(d=>d.classList.remove("aipkit-disabled")),k=!1;return}let p={_ajax_nonce:t,post_id:n,new_value:c};window.aipkit_apiRequest("aipkit_update_post_tags",p).then(d=>{let u=document.getElementById(`post-${n}`);if(u){let f=u.querySelector(".column-tags");f&&(f.textContent=c.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(d=>{console.error("AIPKit Post Enhancer Update Error (Tags):",d),l.innerHTML=`<span class="error">${d.message||e.error_updating_tags||"Error updating tags."}</span>`,o.forEach(u=>u.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function s(n){n&&n.addEventListener("click",function(c){let l=c.target.closest("li[data-new-tags]");l&&r({currentTarget:l})})}window.aipkit_attachTagsSuggestionClickListener=s,window.aipkit_resetTagsUpdateFlag=a})();(function(){"use strict";function k(a,r,i){let n=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorTags(a.message||n.error_loading_tags,n):r?window.aipkit_updateModalWithTagsSuggestions(r,n):window.aipkit_updateModalWithErrorTags(n.error_loading_tags||"Unknown error occurred.",n)}window.aipkit_handleTagsSuggestionsResult=k})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function k(o,e=60){return o.length<=e?o:o.substring(0,e-3)+"..."}function a(o,e="info"){let t=document.getElementById("aipkit-enhancer-bulk-status-log");if(t){let p=document.createElement("div");p.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${e}`,p.textContent=o,t.appendChild(p),t.scrollTop=t.scrollHeight}}function r(){let o=document.getElementById("aipkit-enhancer-bulk-progress-bar"),e=document.getElementById("aipkit-enhancer-progress-text"),t=document.getElementById("aipkit-enhancer-progress-stats");if(o&&window.aipkit_enhancer_bulkState.total>0){let p=window.aipkit_enhancer_bulkState.completed,d=window.aipkit_enhancer_bulkState.failed,u=window.aipkit_enhancer_bulkState.total,f=p+d,m=Math.round(f/u*100);o.style.width=`${m}%`,e&&(f===u?e.textContent="Update complete!":e.textContent=`Processing ${f+1} of ${u}...`),t&&(d>0?t.innerHTML=`${m}% \u2022 <span style="color: #28a745;">${p} successful</span> \u2022 <span style="color: #dc3545;">${d} failed</span>`:t.textContent=`${m}%`)}}function i(o){let e=document.getElementById("aipkit-enhancer-bulk-status-log");if(!e)return;let p=(window.aipkit_enhancer_postTitles||{})[o]||`Post #${o}`;p=k(p,60);let d=document.createElement("div");d.className="aipkit_enhancer_post_steps",d.id=`aipkit_enhancer_post_${o}_steps`;let u=document.createElement("div");u.className="aipkit_enhancer_post_header",u.innerHTML=`<strong>${p}</strong>`;let f=document.createElement("div");f.className="aipkit_enhancer_steps_container",f.id=`aipkit_enhancer_steps_${o}`,d.appendChild(u),d.appendChild(f),e.appendChild(d),e.scrollTop=e.scrollHeight;let m=[],g=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(_=>{g[_]&&g[_].prompt&&m.push({field:_,display_name:_.charAt(0).toUpperCase()+_.slice(1).replace("_"," ")})}),g.generate_seo_slug==="1"&&m.push({field:"slug",display_name:"URL"}),m.forEach(_=>{let h=document.createElement("div");h.className="aipkit_enhancer_step aipkit_enhancer_step--pending",h.id=`aipkit_enhancer_step_${o}_${_.field}`,h.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${_.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,f.appendChild(h)})}function s(o,e,t,p=""){let d=document.getElementById(`aipkit_enhancer_step_${o}_${e}`);if(!d)return;d.className=`aipkit_enhancer_step aipkit_enhancer_step--${t}`;let u="\u23F3",f="Pending";switch(t){case"processing":u="\u{1F504}",f="Processing...";break;case"completed":u="\u2705",f="Completed";break;case"error":u="\u274C",f="Failed";break;case"pending":u="\u23F3",f="Pending";break}d.querySelector(".aipkit_enhancer_step_icon").textContent=u,d.querySelector(".aipkit_enhancer_step_status").textContent=f,p&&(d.title=p);let m=document.getElementById("aipkit-enhancer-bulk-status-log");m&&(m.scrollTop=m.scrollHeight)}function n(o,e,t){let p=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!p||t.length===0)return;let d=e.length+t.length,u=document.createElement("div");u.className="aipkit_enhancer_completion_message",e.length===0?u.innerHTML=`<strong style="color: #dc3545;">\u274C All ${d} enhancement steps failed!</strong>`:u.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${e.length} of ${d} steps. ${t.length} failed.</strong>`,p.appendChild(u);let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}function c(o,e){let t=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!t)return;e.forEach(f=>{let m=document.getElementById(`aipkit_enhancer_step_${o}_${f.field}`);if(m){m.className=`aipkit_enhancer_step aipkit_enhancer_step--${f.status}`;let g="\u23F3";switch(f.status){case"completed":g="\u2705";break;case"error":g="\u274C";break;case"processing":g="\u{1F504}";break;case"pending":g="\u23F3";break}m.querySelector(".aipkit_enhancer_step_icon").textContent=g,m.querySelector(".aipkit_enhancer_step_status").textContent=f.status.charAt(0).toUpperCase()+f.status.slice(1),f.message&&(m.title=f.message)}});let p=e.filter(f=>f.status==="completed").length,d=e.length;if(p!==d){let f=document.createElement("div");f.className="aipkit_enhancer_completion_message";let m=e.filter(g=>g.status==="error").length;f.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${p} of ${d} steps. ${m} failed.</strong>`,t.appendChild(f)}let u=document.getElementById("aipkit-enhancer-bulk-status-log");u&&(u.scrollTop=u.scrollHeight)}function l(o,e){let t=document.getElementById(`aipkit_enhancer_steps_${o}`);if(!t)return;t.querySelectorAll(".aipkit_enhancer_step").forEach(f=>{f.classList.contains("aipkit_enhancer_step--completed")||(f.className="aipkit_enhancer_step aipkit_enhancer_step--error",f.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",f.querySelector(".aipkit_enhancer_step_status").textContent="Failed",f.title=e)});let d=document.createElement("div");d.className="aipkit_enhancer_completion_message",d.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${e}</strong>`,t.appendChild(d);let u=document.getElementById("aipkit-enhancer-bulk-status-log");u&&(u.scrollTop=u.scrollHeight)}window.aipkit_enhancer_logToModal=a,window.aipkit_enhancer_updateProgressBar=r,window.aipkit_enhancer_initStepProgress=i,window.aipkit_enhancer_updateFieldStatus=s,window.aipkit_enhancer_showPostCompletion=n,window.aipkit_enhancer_displayStepResults=c,window.aipkit_enhancer_showStepError=l,window.aipkit_enhancer_truncateTitle=k})();(function(){"use strict";function k(r="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let i=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!i)return;r==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let s=i.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");s&&(s.textContent="Start");let n=i.querySelector("#aipkit_bulk_enhancer_start_btn");n&&(n.disabled=!1,n.hidden=!0),i.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let c=i.querySelector("#aipkit_bulk_enhancer_cancel_btn");c&&(c.hidden=!1),i.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!1}function a(){let r=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!r)return;window.aipkit_enhancer_bulkState.isRunning&&k("user"),r.querySelector("#aipkit-enhancer-bulk-config").hidden=!1,r.querySelector("#aipkit-enhancer-bulk-progress").hidden=!0;let i=r.querySelector("#aipkit_bulk_enhancer_start_btn");i&&(i.disabled=!1,i.hidden=!1);let s=r.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");s&&(s.textContent="Start"),r.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let n=r.querySelector("#aipkit_bulk_enhancer_cancel_btn");n&&(n.hidden=!1),r.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0;let c=r.querySelector("#aipkit-enhancer-bulk-status-log");c&&(c.innerHTML="");let l=r.querySelector("#aipkit-enhancer-bulk-progress-bar");l&&(l.style.width="0%");let o=r.querySelector("#aipkit-enhancer-progress-text");o&&(o.textContent="Processing posts...");let e=r.querySelector("#aipkit-enhancer-progress-stats");e&&(e.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=k,window.aipkit_enhancer_returnToSettings=a})();(function(){"use strict";function k(c){let l=c.querySelector("#aipkit_bulk_ai_provider"),o=c.querySelector("#aipkit_bulk_ai_model"),e=c.querySelector(".aipkit_enhancer_reasoning_effort_field"),t=c.querySelector("#aipkit_bulk_reasoning_effort");if(!l||!o||!e||!t){e&&(e.style.display="none");return}let p=(l.value||"").toLowerCase(),u=(o.value||"").toLowerCase(),f=u.startsWith("o1")||u.startsWith("o3")||u.startsWith("o4"),m=u.includes("gpt-5");if(!(p==="openai"&&(f||m))){e.style.display="none";return}e.style.display="block",a(c,u)}function a(c,l){let o=c.querySelector("#aipkit_bulk_reasoning_effort");if(!o)return;let e=r(l),t=new Set(e.allowed),p=o.value||"";p==="minimal"&&(p="low"),Array.from(o.options).forEach(d=>{let u=t.has(d.value);d.hidden=!u,d.disabled=!u}),t.has(p)||(p=e.defaultValue),t.has(p)||(p=e.allowed[0]||""),p&&(o.value=p)}function r(c){return s(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(c){let l=c.match(/gpt-5\.(\d+)/);if(l)return Number.parseInt(l[1],10)>=2;let o=c.match(/gpt-(\d+)/);return o?Number.parseInt(o[1],10)>=6:!1}function s(c){return/gpt-5(\.\d+)?-pro/.test(c)}function n(c,l){let o=c.value.toLowerCase(),t=(window.aipkit_dashboard?.models||{})[o]||[],p=window.aipkit_escapeHtml||(_=>_),d=window.wp?.i18n?.__||(_=>_),u=window.aipkit_dashboard?.recommendedModels?.[o]||[],f=Array.isArray(u)?u:[],m=new Set(f.map(_=>_?.id).filter(Boolean));if(l.innerHTML="",f.length>0){let _=document.createElement("optgroup");_.label=p(d("Recommended","gpt3-ai-content-generator")),f.forEach(h=>{h&&h.id&&_.appendChild(new Option(p(h.name||h.id),h.id))}),_.children.length>0&&l.appendChild(_)}if(o==="openai"&&typeof t=="object"&&!Array.isArray(t))Object.keys(t).forEach(_=>{let h=document.createElement("optgroup");h.label=p(_),Array.isArray(t[_])&&t[_].forEach(y=>{y&&y.id&&m.has(y.id)||y&&y.id&&h.appendChild(new Option(p(y.name||y.id),y.id))}),h.children.length>0&&l.appendChild(h)});else if(Array.isArray(t)){let _=f.length?document.createElement("optgroup"):null;_&&(_.label=p(d("All models","gpt3-ai-content-generator"))),t.forEach(h=>{if(!(h&&h.id&&m.has(h.id))&&h&&h.id){let y=new Option(p(h.name||h.id),h.id);_?_.appendChild(y):l.appendChild(y)}}),_&&_.children.length>0&&l.appendChild(_)}if(l.options.length===0)l.appendChild(new Option(p(`No models for ${c.value}`),"")),l.disabled=!0;else{l.disabled=!1;let _;switch(o){case"openai":_="gpt-4o-mini";break;case"google":_="gemini-1.5-flash-latest";break;case"openrouter":_="moonshotai/kimi-k2.5";break;case"claude":_="claude-opus-4-6",Array.isArray(t)&&t.length>0&&(t.some(y=>y&&y.id==="claude-opus-4-6")||(_=t[0].id||null));break;case"azure":case"deepseek":case"ollama":Array.isArray(t)&&t.length>0?_=t[0].id||null:_=null;break;default:_=null;break}_&&l.querySelector(`option[value="${CSS.escape(_)}"]`)?l.value=_:l.selectedIndex=0}let g=c.closest(".aipkit-enhancer-bulk-modal-overlay");g&&k(g)}window.aipkit_enhancer_populateBulkModels=n,window.aipkit_enhancer_toggleReasoningEffort=k})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],a=n=>{let c=parseInt(n,10);if(Number.isFinite(c)){if(c>=1&&c<=k.length)return k[c-1];let l=k.find(o=>o.tokens===c);if(l)return l}return k[1]};async function r(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let n=window.aipkit_enhancer_bulkState.queue.shift();await i(n),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(r,200)}async function i(n){try{let c=`enhancer-bulk-${n}-${Date.now()}`;typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(n);let l=window.aipkit_post_enhancer?.nonce_generate_title;if(!l)throw new Error("Security nonce not found.");let o=window.aipkit_enhancer_bulkState.enhancementsConfig,e=["keyword","title","excerpt","content","meta","tags"],t=[];e.forEach(u=>{o[u]&&o[u].prompt&&t.push(u)});let p=[],d=[];for(let u of t){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,u,"processing");let f={_ajax_nonce:l,post_id:n,field:u,enhancer_source:"post_enhancer",enhancements:JSON.stringify({[u]:o[u],ai_provider:o.ai_provider,ai_model:o.ai_model,temperature:o.temperature,max_tokens:o.max_tokens,reasoning_effort:o.reasoning_effort,enable_vector_store:o.enable_vector_store,vector_store_provider:o.vector_store_provider,vector_store_top_k:o.vector_store_top_k,openai_vector_store_ids:o.openai_vector_store_ids,pinecone_index_name:o.pinecone_index_name,qdrant_collection_name:o.qdrant_collection_name,vector_embedding_provider:o.vector_embedding_provider,vector_embedding_model:o.vector_embedding_model}),conversation_uuid:c},m=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",f,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,u,"completed",m.message),p.push(u)}catch(f){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,u,"error",f.message||"Processing failed"),d.push(u),console.error(`Failed to process field ${u} for post ${n}:`,f)}}if(o.generate_seo_slug==="1"&&p.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,"slug","processing");let u={_ajax_nonce:l,post_id:n,action_type:"update_slug",enhancer_source:"post_enhancer"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",u,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(n,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(n,p,d),p.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let f=(window.aipkit_enhancer_postTitles||{})[n]||`Post #${n}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(f=window.aipkit_enhancer_truncateTitle(f,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${f}". No fields were processed successfully.`,"error")}}catch(c){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(n,c.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let o=(window.aipkit_enhancer_postTitles||{})[n]||`Post #${n}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(o=window.aipkit_enhancer_truncateTitle(o,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${o}": ${c.message||"Unknown error"}`,"error")}}}function s(n){let c=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!c)return;let l={},o=c.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(o.length===0){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select at least one field to update.","error");return}o.forEach(y=>{let E=y.value,x=c.querySelector(`#aipkit_bulk_prompt_${E}`);x&&(l[E]={prompt:x.value})});let e=c.querySelector("#aipkit_bulk_ai_provider").value,t=c.querySelector("#aipkit_bulk_ai_model").value,p=c.querySelector("#aipkit_bulk_ai_temperature").value,d=c.querySelector("#aipkit_bulk_content_max_tokens"),u=a(d?d.value:""),f=c.querySelector("#aipkit_bulk_reasoning_effort").value;if(!e||!t){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select an AI Provider and Model.","error");return}l.ai_provider=e,l.ai_model=t,l.temperature=p,l.max_tokens=u.tokens,l.reasoning_effort=f;let m=c.querySelector("#aipkit_bulk_generate_seo_slug");m&&(l.generate_seo_slug=m.checked?"1":"0");let g=c.querySelector('input[name="enable_vector_store"]');if(g&&g.checked){if(l.enable_vector_store="1",l.vector_store_provider=c.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",l.vector_store_top_k=c.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,l.vector_store_provider==="openai"){let y=c.querySelector("#aipkit_bulk_openai_vector_store_ids");y&&(l.openai_vector_store_ids=Array.from(y.selectedOptions).map(E=>E.value))}else l.vector_store_provider==="pinecone"?l.pinecone_index_name=c.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":l.vector_store_provider==="qdrant"&&(l.qdrant_collection_name=c.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(l.vector_store_provider==="pinecone"||l.vector_store_provider==="qdrant")&&(l.vector_embedding_provider=c.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",l.vector_embedding_model=c.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else l.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...n],isRunning:!0,completed:0,failed:0,total:n.length,enhancementsConfig:l},c.querySelector("#aipkit-enhancer-bulk-config").hidden=!0,c.querySelector("#aipkit-enhancer-bulk-progress").hidden=!1;let _=c.querySelector("#aipkit_bulk_enhancer_start_btn");_&&(_.disabled=!0,_.hidden=!0),c.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!1;let h=c.querySelector("#aipkit_bulk_enhancer_cancel_btn");h&&(h.hidden=!0),c.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0,typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),r()}window.aipkit_enhancer_startBulkProcess=s})();(function(){"use strict";let k={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,isAutosaving:!1,autosaveSuspended:!1,autosaveTimer:null,autosaveDelay:800,lastSavedConfig:null,headerStatusTimeout:null,modalElement:null},a="aipkit_bulk_enhancer_selected_template",r=window.aipkit_escapeHtml||function(C){return C},i=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],s=()=>String(window.aipkit_post_enhancer?.default_ai_provider||"").trim().toLowerCase(),n=C=>{let b=parseInt(C,10);if(Number.isFinite(b)){if(b>=1&&b<=i.length)return i[b-1];let L=i.find(B=>B.tokens===b);if(L)return L}return i[1]},c=C=>{let b=C?.content_max_tokens??C?.max_tokens??C?.max_completion_tokens??"",L=parseInt(b,10);if(Number.isFinite(L)){let U=L>=1&&L<=i.length,D=i.some(H=>H.tokens===L);return U||D?n(L):L<=i[0].tokens?i[0]:L<=i[1].tokens?i[1]:i[2]}let B=String(C?.content_length||"").trim().toLowerCase(),$=i.find(U=>U.key===B);if($)return $;let W=parseInt(window.aipkit_post_enhancer?.default_ai_params?.max_completion_tokens??window.aipkit_post_enhancer?.default_ai_params?.max_tokens??"",10);return Number.isFinite(W)?W<=i[0].tokens?i[0]:W<=i[1].tokens?i[1]:i[2]:i[1]};function l(C){try{C&&String(C)!==""?localStorage.setItem(a,String(C)):localStorage.removeItem(a)}catch(b){console.warn("Failed to save template to localStorage:",b)}}function o(){try{return localStorage.getItem(a)}catch(C){return console.warn("Failed to load template from localStorage:",C),null}}function e(){let C=k.modalElement;if(!C)return{};let b={};["title","excerpt","content","meta","keyword","tags"].forEach(U=>{let D=C.querySelector(`#aipkit_bulk_enhance_${U}`),H=C.querySelector(`#aipkit_bulk_prompt_${U}`);D&&H&&(b[U]={enabled:D.checked?"1":"0",prompt:H.value})}),b.ai_provider=C.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",b.ai_model=C.querySelector("#aipkit_bulk_ai_model")?.value||"",b.ai_temperature=C.querySelector("#aipkit_bulk_ai_temperature")?.value;let B=C.querySelector("#aipkit_bulk_content_max_tokens"),$=n(B?B.value:"");b.content_max_tokens=String($.tokens),b.reasoning_effort=C.querySelector("#aipkit_bulk_reasoning_effort")?.value||"",b.generate_seo_slug=C.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let W=C.querySelector('input[name="enable_vector_store"]');if(W&&W.checked){if(b.enable_vector_store="1",b.vector_store_provider=C.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",b.vector_store_top_k=C.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",b.vector_store_provider==="openai"){let U=C.querySelector("#aipkit_bulk_openai_vector_store_ids");U&&(b.openai_vector_store_ids=Array.from(U.selectedOptions).map(D=>D.value))}else b.vector_store_provider==="pinecone"?b.pinecone_index_name=C.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":b.vector_store_provider==="qdrant"&&(b.qdrant_collection_name=C.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(b.vector_store_provider==="pinecone"||b.vector_store_provider==="qdrant")&&(b.vector_embedding_provider=C.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",b.vector_embedding_model=C.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else b.enable_vector_store="0";return b}function t(C){k.autosaveSuspended=!0,k.currentTemplateId=C,l(C),window.aipkit_bulk_template_state&&(window.aipkit_bulk_template_state.currentTemplateId=C),typeof window.aipkit_updateBulkTemplatePickerSelection=="function"&&window.aipkit_updateBulkTemplatePickerSelection(C,k.modalElement);let b=k.templates.find(O=>String(O.id)===String(C)),L=b?JSON.parse(JSON.stringify(b.config)):{};if(!L.content_max_tokens&&L.content_length){let O=i.find(N=>N.key===String(L.content_length).toLowerCase());L.content_max_tokens=String(O?.tokens||i[1].tokens)}Object.prototype.hasOwnProperty.call(L,"content_length")&&delete L.content_length,k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(L));let B=k.modalElement;if(!B)return;let $=B.querySelector("#aipkit_bulk_ai_provider"),W=B.querySelector("#aipkit_bulk_ai_model"),U=B.querySelector("#aipkit_bulk_ai_temperature"),D=B.querySelector("#aipkit_bulk_ai_temperature_value"),H=B.querySelector("#aipkit_bulk_content_max_tokens"),Q=B.querySelector("#aipkit_bulk_content_max_tokens_value"),F=B.querySelector("#aipkit_bulk_reasoning_effort");if($){let O=s();$.value=L.ai_provider||O||"openai",$.dispatchEvent(new Event("change",{bubbles:!0}))}if(W&&L.ai_model&&setTimeout(()=>{W.querySelector(`option[value="${CSS.escape(L.ai_model)}"]`)&&(W.value=L.ai_model,W.dispatchEvent(new Event("change")))},150),U&&(U.value=L.ai_temperature||"1.0"),D&&(D.textContent=L.ai_temperature||"1.0"),H){let O=c(L),N=Math.max(0,i.findIndex(ie=>ie.key===O.key));H.value=String(N+1),Q&&(Q.textContent=`${O.words} words`)}F&&(F.value=L.reasoning_effort==="minimal"?"low":L.reasoning_effort||"",typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&window.aipkit_enhancer_toggleReasoningEffort(B)),["title","excerpt","content","meta","keyword","tags"].forEach(O=>{let N=B.querySelector(`#aipkit_bulk_enhance_${O}`),ie=B.querySelector(`#aipkit_bulk_prompt_${O}`);if(N&&ie){let J=L[O]?.enabled==="1";N.checked!==J&&(N.checked=J,N.dispatchEvent(new Event("change"))),ie.value=L[O]?.prompt||ie.defaultValue}});let P=B.querySelector("#aipkit_bulk_generate_seo_slug");if(P){let O=L.generate_seo_slug==="1";P.checked!==O&&(P.checked=O,P.dispatchEvent(new Event("change")))}let R=B.querySelector('input[name="enable_vector_store"]');if(R&&(R.checked=L.enable_vector_store==="1",R.dispatchEvent(new Event("change"))),L.enable_vector_store==="1"){let O=B.querySelector("#aipkit_bulk_vector_store_provider");O&&(O.value=L.vector_store_provider||"openai",O.dispatchEvent(new Event("change",{bubbles:!0})));let N=B.querySelector("#aipkit_bulk_vector_store_top_k");if(N){N.value=L.vector_store_top_k||"3";let ie=B.querySelector("#aipkit_bulk_vector_store_top_k_value");ie&&(ie.textContent=N.value)}setTimeout(()=>{if(L.vector_store_provider==="openai"){let ie=B.querySelector("#aipkit_bulk_openai_vector_store_ids");ie&&Array.isArray(L.openai_vector_store_ids)&&Array.from(ie.options).forEach(J=>{J.selected=L.openai_vector_store_ids.includes(J.value)})}else if(L.vector_store_provider==="pinecone"){let ie=B.querySelector("#aipkit_bulk_pinecone_index_name");ie&&(ie.value=L.pinecone_index_name||"",ie.dispatchEvent(new Event("change",{bubbles:!0})))}else if(L.vector_store_provider==="qdrant"){let ie=B.querySelector("#aipkit_bulk_qdrant_collection_name");ie&&(ie.value=L.qdrant_collection_name||"",ie.dispatchEvent(new Event("change",{bubbles:!0})))}if(L.vector_store_provider==="pinecone"||L.vector_store_provider==="qdrant"){let ie=B.querySelector("#aipkit_bulk_vector_embedding_provider"),J=B.querySelector("#aipkit_bulk_vector_embedding_model");ie&&(ie.value=L.vector_embedding_provider||"openai",ie.dispatchEvent(new Event("change"))),J&&L.vector_embedding_model&&setTimeout(()=>{J.value=L.vector_embedding_model,J.dispatchEvent(new Event("change",{bubbles:!0}))},150)}},100)}k.currentTemplateModified=!1,d(),window.clearTimeout(k.autosaveTimer),k.autosaveTimer=null,window.setTimeout(()=>{k.lastSavedConfig=e(),k.autosaveSuspended=!1},200)}function p(){let C=e();k.currentTemplateModified=!window.aipkit_deepEqual(C,k.initialConfigForSelectedTemplate),d(),w()}function d(){let C=k.modalElement;if(!C)return;let b=C.querySelector("#aipkit_enhancer_template_select").value,L=b&&String(b)!=="";C.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!L,C.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!L}function u(){let C=k.modalElement;if(!C)return;let b=C.querySelector("#aipkit_enhancer_template_action_list"),L=C.querySelector("#aipkit_enhancer_template_inline_form"),B=C.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),$=C.querySelector("#aipkit_enhancer_template_name_input");b&&(b.style.display=""),L&&(L.style.display="none",delete L.dataset.mode),B&&(B.style.display="none"),$&&($.value="")}function f(C,b=""){let L=k.modalElement;if(!L)return;let B=L.querySelector("#aipkit_enhancer_template_inline_form"),$=L.querySelector("#aipkit_enhancer_template_name_input"),W=L.querySelector("#aipkit_enhancer_template_action_list"),U=L.querySelector("#aipkit_enhancer_template_inline_delete_confirm");!B||!$||(W&&(W.style.display="none"),U&&(U.style.display="none"),B.style.display="flex",B.dataset.mode=C,$.value=b,$.focus())}function m(){u()}function g(C){let b=k.modalElement;if(!b)return;let L=b.querySelector("#aipkit_enhancer_template_inline_form"),B=b.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),$=b.querySelector("#aipkit_enhancer_template_delete_confirm_text"),W=b.querySelector("#aipkit_enhancer_template_action_list");!B||!$||(L&&(L.style.display="none"),W&&(W.style.display="none"),B.style.display="flex",$.innerHTML=`Delete "<strong>${r(C)}</strong>"?`)}function _(){u()}function h(C,b="info"){y(C,b)}function y(C,b="info"){let L=k.modalElement?.querySelector("#aipkit_bulk_autosave_status");if(L){if(k.headerStatusTimeout&&(clearTimeout(k.headerStatusTimeout),k.headerStatusTimeout=null),!C){L.textContent="",L.className="aipkit_cw_save_status aipkit_enhancer_modal_status";return}L.textContent=r(C),L.className=`aipkit_cw_save_status aipkit_enhancer_modal_status aipkit_settings_message-${b}`,b==="success"&&(k.headerStatusTimeout=setTimeout(()=>{L.textContent="",L.className="aipkit_cw_save_status aipkit_enhancer_modal_status"},2500))}}function E(){let C=k.currentTemplateId;if(!C)return null;let b="",L=k.templates.find($=>String($.id)===String(C));if(L?.template_name&&(b=L.template_name),!b){let $=k.modalElement?.querySelector("#aipkit_enhancer_template_select");$?.selectedOptions?.length&&(b=$.selectedOptions[0].textContent.trim())}let B=parseInt(C,10);return!b||Number.isNaN(B)?null:{id:B,name:b}}async function x(){if(k.autosaveSuspended||k.isSavingOrDeleting||k.isAutosaving)return;let C=e();if(!C||k.lastSavedConfig&&window.aipkit_deepEqual(C,k.lastSavedConfig))return;let b=E();if(b){k.isAutosaving=!0,y("Saving...","info");try{let L=window.aipkit_post_enhancer?.nonce_manage_templates;if(!L)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:b.id,template_name:b.name,config:JSON.stringify(C),template_type:"enhancer",_ajax_nonce:L}),k.lastSavedConfig=JSON.parse(JSON.stringify(C)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(C)),k.currentTemplateModified=!1,d(),y("Saved","success")}catch(L){y(`Error: ${L.message||"Failed to save."}`,"error"),console.error("Bulk Enhancer Auto-Save Error:",L)}finally{k.isAutosaving=!1}}}function w(){k.autosaveSuspended||k.isSavingOrDeleting||k.currentTemplateId&&(k.autosaveTimer&&clearTimeout(k.autosaveTimer),k.autosaveTimer=setTimeout(()=>{k.autosaveTimer=null,x()},k.autosaveDelay))}async function S(){let C=k.modalElement.querySelector("#aipkit_enhancer_template_select");C.innerHTML='<option value="">Loading...</option>',C.disabled=!0;try{let b=window.aipkit_post_enhancer?.nonce_manage_templates;if(!b)throw new Error("Security nonce for templates not found.");let L=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:b});k.templates=L.templates||[],C.innerHTML='<option value="">-- Select Template --</option>',k.templates.forEach($=>{C.appendChild(new Option(r($.template_name),$.id))}),C.disabled=!1;let B=o();B&&(k.templates.some(W=>String(W.id)===String(B))?(C.value=B,t(B)):l(null)),window.aipkit_bulk_template_state={templates:k.templates,currentTemplateId:k.currentTemplateId},typeof window.aipkit_renderBulkTemplatePicker=="function"&&window.aipkit_renderBulkTemplatePicker(k.modalElement)}catch(b){h("Error loading templates: "+b.message,"error")}}async function T(C,b){if(!k.isSavingOrDeleting){k.isSavingOrDeleting=!0,h("Saving template...","info");try{let L=e(),B=window.aipkit_post_enhancer?.nonce_manage_templates;if(!B)throw new Error("Security nonce for templates not found.");let $=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:C,template_name:b,config:JSON.stringify(L),template_type:"enhancer",_ajax_nonce:B});h($.message,"success"),await S(),k.modalElement.querySelector("#aipkit_enhancer_template_select").value=$.template_id,k.currentTemplateId=$.template_id,l($.template_id),k.currentTemplateModified=!1,k.lastSavedConfig=JSON.parse(JSON.stringify(L)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(L)),y("Saved","success"),d()}catch(L){h("Error saving: "+L.message,"error")}finally{k.isSavingOrDeleting=!1}}}async function v(){let C=k.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!C||k.isSavingOrDeleting)){k.isSavingOrDeleting=!0,h("Deleting...","info");try{let b=window.aipkit_post_enhancer?.nonce_manage_templates;if(!b)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:C,_ajax_nonce:b}),h("Template deleted.","success"),await S(),k.currentTemplateId=null;let L=o();L&&String(L)===String(C)&&l(null),k.lastSavedConfig=null,y("Template deleted","success"),d()}catch(b){h("Error deleting: "+b.message,"error")}finally{k.isSavingOrDeleting=!1}}}function A(C){k.modalElement=C;let b=C.querySelector("#aipkit_enhancer_template_select");b.addEventListener("change",Q=>{y(""),u(),t(Q.target.value)}),C.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{f("new")}),C.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let Q=b.options[b.selectedIndex];k.currentTemplateId&&Q&&f("rename",Q.text)}),C.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",()=>{let Q=b.options[b.selectedIndex];Q&&g(Q.text)});let L=C.querySelector("#aipkit_enhancer_template_inline_form"),B=C.querySelector("#aipkit_enhancer_template_save_inline_btn"),$=C.querySelector("#aipkit_enhancer_template_cancel_inline_btn"),W=C.querySelector("#aipkit_enhancer_template_name_input");B&&$&&L&&W&&($.addEventListener("click",m),B.addEventListener("click",async()=>{let Q=L.dataset.mode,F=W.value.trim();if(!F){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}if(Q==="new")await T(0,F);else if(Q==="rename"){let P=b.value;P&&await T(parseInt(P,10),F)}m()}));let U=C.querySelector("#aipkit_enhancer_template_confirm_delete_btn"),D=C.querySelector("#aipkit_enhancer_template_cancel_delete_btn");U&&D&&(D.addEventListener("click",_),U.addEventListener("click",async()=>{await v(),_()})),S(),typeof window.aipkit_initBulkTemplatePicker=="function"&&window.aipkit_initBulkTemplatePicker(C);let H=Q=>{Q.target?.id!=="aipkit_enhancer_template_select"&&p()};C.addEventListener("input",H),C.addEventListener("change",H)}window.aipkit_enhancer_initTemplateControls=A,window.aipkit_enhancer_setHeaderStatus=y})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(d){return d},a=d=>d||document.querySelector(".aipkit_enhancer_bulk_modal");function r(d){let u=a(d);return{root:u,select:u?.querySelector("#aipkit_enhancer_template_select")||null,button:u?.querySelector("#aipkit_enhancer_template_picker_btn")||null,label:u?.querySelector("#aipkit_enhancer_template_picker_label")||null,list:u?.querySelector("#aipkit_enhancer_template_picker_list")||null,search:u?.querySelector("#aipkit_enhancer_template_picker_search")||null,searchClear:u?.querySelector("#aipkit_enhancer_template_picker_search_clear")||null,popover:u?.querySelector("#aipkit_enhancer_template_picker_popover")||null}}function i(d,u){let f=[],m={};d.forEach(_=>{if(!(String(_.is_starter)==="1"||_.is_starter===!0))if(u&&_.user_id?.toString()===u)f.push(_);else{let y=_.display_name||`User ID: ${_.user_id}`;m[y]||(m[y]=[]),m[y].push(_)}}),f.sort((_,h)=>_.is_default==="1"?-1:h.is_default==="1"?1:_.template_name.localeCompare(h.template_name));let g={};return Object.keys(m).sort().forEach(_=>{g[_]=m[_].sort((h,y)=>h.template_name.localeCompare(y.template_name))}),{myTemplates:f,otherUsersTemplates:g}}function s(d){return d.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function n(d,u){let{label:f}=r(u);if(!f||!d)return;let m=d.options[d.selectedIndex],g=m?m.text:k("Select template");f.textContent=g||k("Select template")}function c(d,u){if(!d)return;let f=String(u||"");d.querySelectorAll(".aipkit_cw_template_list_item").forEach(m=>{let _=(m.dataset.templateId||"")===f;m.classList.toggle("is-active",_),m.setAttribute("aria-selected",_?"true":"false")})}function l(d,u=""){let{select:f,list:m}=r(d);if(!f||!m)return;let g=window.aipkit_bulk_template_state?.templates||[],_=window.aipkit_dashboard?.currentUserId?.toString();if(m.innerHTML="",!g.length){let v=f.disabled&&f.options.length&&f.options[0].text.toLowerCase().includes("loading"),A=document.createElement("div");A.className="aipkit_cw_template_picker_empty",A.textContent=k(v?"Loading templates...":"No templates found."),m.appendChild(A),n(f,d);return}let h=i(g,_),y=document.createDocumentFragment(),E=u.toLowerCase().trim(),x=(v,A)=>{let C=document.createElement("div");if(C.className="aipkit_cw_template_group_label",A){let L=document.createElement("span");L.className=`dashicons ${A}`,L.setAttribute("aria-hidden","true"),C.appendChild(L)}let b=document.createElement("span");return b.textContent=k(v),C.appendChild(b),C},w=v=>{let A=document.createElement("button");A.type="button",A.className="aipkit_cw_template_list_item",v.is_default==="1"&&A.classList.add("is-default"),A.dataset.templateId=String(v.id),A.dataset.templateLabel=v.template_name.toLowerCase(),A.setAttribute("role","option"),A.setAttribute("aria-selected","false");let C=s(v),b=document.createElement("span");b.className=`aipkit_cw_template_list_icon dashicons ${C}`,b.setAttribute("aria-hidden","true");let L=document.createElement("span");L.className="aipkit_cw_template_list_content";let B=document.createElement("span");B.className="aipkit_cw_template_list_name",B.textContent=k(v.template_name),L.appendChild(B);let $=document.createElement("span");return $.className="aipkit_cw_template_list_check dashicons dashicons-yes",$.setAttribute("aria-hidden","true"),A.appendChild(b),A.appendChild(L),A.appendChild($),A},S=(v,A,C)=>{let b=E?A.filter(B=>B.template_name.toLowerCase().includes(E)):A;if(!b.length)return 0;let L=document.createElement("div");return L.className="aipkit_cw_template_group",L.appendChild(x(v,C)),b.forEach(B=>{L.appendChild(w(B))}),y.appendChild(L),b.length},T=0;if(T+=S("My Templates",h.myTemplates,"dashicons-admin-users"),Object.keys(h.otherUsersTemplates).forEach(v=>{T+=S(v,h.otherUsersTemplates[v],"dashicons-groups")}),T===0){let v=document.createElement("div");v.className="aipkit_cw_template_picker_empty",v.textContent=k(E?"No templates match your search.":"No templates found."),m.appendChild(v)}else m.appendChild(y);n(f,d),c(m,f.value)}function o(d,u){l(d,u)}function e(d){let{search:u,searchClear:f,popover:m}=r(d);if(!u)return;let g=null;u.addEventListener("input",_=>{let h=_.target.value;f&&(f.style.display=h?"flex":"none"),clearTimeout(g),g=setTimeout(()=>{o(d,h)},150)}),f&&f.addEventListener("click",()=>{u.value="",f.style.display="none",o(d,""),u.focus()}),m&&new MutationObserver(h=>{h.forEach(y=>{y.attributeName==="aria-hidden"&&m.getAttribute("aria-hidden")==="true"&&u.value&&(u.value="",f&&(f.style.display="none"),o(d,""))})}).observe(m,{attributes:!0})}function t(d){let{select:u,list:f,button:m}=r(d);!u||!f||(e(d),f.dataset.listenerAttached||(f.addEventListener("click",g=>{let _=g.target.closest(".aipkit_cw_template_list_item");if(!_||!u)return;let h=_.dataset.templateId||"";u.value=h,u.dispatchEvent(new Event("change",{bubbles:!0})),c(f,h),m&&m.click()}),f.dataset.listenerAttached="true"),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",()=>{n(u,d),c(f,u.value)}),u.dataset.listenerAttached="true"),l(d))}function p(d,u){let{select:f,list:m}=r(u);f&&(d!==void 0&&(f.value=d),n(f,u),c(m,f.value))}window.aipkit_initBulkTemplatePicker=t,window.aipkit_renderBulkTemplatePicker=l,window.aipkit_updateBulkTemplatePickerSelection=p})();(function(){"use strict";function k(a){let{postCount:r,providerOptions:i,defaultPrompts:s,promptLibrary:n,postType:c}=a,l=y=>String(y??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=y=>l(y).replace(/"/g,"&quot;").replace(/'/g,"&#39;"),e=(y=[])=>y.map(E=>!E?.label||!E?.prompt?"":`<option value="${o(E.prompt)}">${l(E.label)}</option>`).join(""),t=n||{},p=`<option value="${o(s.title||"")}">Default</option>${e(t.title)}`,d=`<option value="${o(s.content||"")}">Default</option>${e(t.content)}`,u=`<option value="${o(s.meta||"")}">Default</option>${e(t.meta)}`,f=`<option value="${o(s.keyword||"")}">Default</option>${e(t.keyword)}`,m=`<option value="${o(s.excerpt||"")}">Default</option>${e(t.excerpt)}`,g=`<option value="${o(s.tags||"")}">Default</option>${e(t.tags)}`,_="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}, {original_tags}, {categories}.";c==="product"&&(_+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),_=_.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let h="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}, {original_tags}, {categories}.";return c==="product"&&(h+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),h=h.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div id="aipkit_enhancer_bulk_modal" class="aipkit-modal-content aipkit-enhancer-bulk-modal-content aipkit_enhancer_bulk_modal" data-post-type="${o(c)}">
          <div class="aipkit-modal-header aipkit_enhancer_modal_header">
            <div class="aipkit_enhancer_header_left">
              <span class="aipkit_enhancer_header_icon" aria-hidden="true">
                <span class="dashicons dashicons-edit-large"></span>
              </span>
              <div class="aipkit_enhancer_header_text">
                <h3 class="aipkit-modal-title">Content Assistant</h3>
                <span class="aipkit_enhancer_modal_subtitle">Bulk content update</span>
              </div>
            </div>
            <div class="aipkit_enhancer_header_center">
              <div
                id="aipkit_bulk_autosave_status"
                class="aipkit_cw_save_status aipkit_enhancer_modal_status"
                aria-live="polite"
              ></div>
            </div>
            <div class="aipkit_enhancer_header_right">
              <button type="button" class="aipkit-modal-close-btn aipkit_enhancer_close_btn" aria-label="Close">\xD7</button>
            </div>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <div class="aipkit_enhancer_section aipkit_enhancer_engine_card">
                <div class="aipkit_enhancer_engine_fields">
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Template</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <button
                          type="button"
                          id="aipkit_enhancer_template_picker_btn"
                          class="aipkit_popover_option_btn aipkit_settings_select_picker_btn"
                          data-aipkit-popover-target="aipkit_enhancer_template_picker_popover"
                          data-aipkit-popover-placement="bottom"
                          data-aipkit-bulk-popover="templates"
                          aria-controls="aipkit_enhancer_template_picker_popover"
                          aria-expanded="false"
                        >
                          <span class="aipkit_settings_select_picker_label" id="aipkit_enhancer_template_picker_label">Select template</span>
                          <span class="dashicons dashicons-arrow-down-alt2" aria-hidden="true"></span>
                        </button>
                        <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_enhancer_engine_select screen-reader-text">
                        <option value="">-- Select Template --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Provider</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_provider" class="aipkit_enhancer_engine_select">${i}</select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Model</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_model" class="aipkit_enhancer_engine_select">
                          <option value="">-- Select Provider --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field aipkit_enhancer_engine_field--action">
                    <button
                      type="button"
                      class="aipkit_enhancer_settings_btn"
                      data-aipkit-popover-target="aipkit_bulk_settings_popover"
                      data-aipkit-popover-placement="bottom"
                      data-aipkit-bulk-popover="settings"
                      aria-controls="aipkit_bulk_settings_popover"
                      aria-expanded="false"
                      title="Advanced settings"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="aipkit_enhancer_section aipkit_enhancer_prompt_section"
                id="aipkit_bulk_prompt_section"
              >
                <div class="aipkit_enhancer_section_header">
                  <h4>What to update</h4>
                </div>
                <div class="aipkit_prompts_redesigned">
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="title">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Title</span>
                        <span class="aipkit_prompt_toggle_desc">Post title</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_title_prompt_flyout"
                          aria-controls="aipkit_bulk_title_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="content">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Content</span>
                        <span class="aipkit_prompt_toggle_desc">Rewrite the main body</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_content_prompt_flyout"
                          aria-controls="aipkit_bulk_content_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="meta">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Meta Description</span>
                        <span class="aipkit_prompt_toggle_desc">SEO snippet for search</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_meta_prompt_flyout"
                          aria-controls="aipkit_bulk_meta_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="keyword">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Focus Keyword</span>
                        <span class="aipkit_prompt_toggle_desc">Primary SEO keyword</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_keyword_prompt_flyout"
                          aria-controls="aipkit_bulk_keyword_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="excerpt">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Excerpt</span>
                        <span class="aipkit_prompt_toggle_desc">Short summary text</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_excerpt_prompt_flyout"
                          aria-controls="aipkit_bulk_excerpt_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="tags">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Tags</span>
                        <span class="aipkit_prompt_toggle_desc">Suggested tags list</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_tags_prompt_flyout"
                          aria-controls="aipkit_bulk_tags_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="seo_slug">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Optimize URL</span>
                        <span class="aipkit_prompt_toggle_desc">Generate a new slug</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1" class="aipkit_toggle_switch">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_bulk_settings_popover" data-aipkit-bulk-popover="settings" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_model_settings_popover_panel--wide aipkit_model_settings_popover_panel--allow-overflow aipkit_cw_settings_popover_panel" role="dialog" aria-label="Settings">
                <div class="aipkit_model_settings_popover_header">
                  <span class="aipkit_model_settings_popover_title">Settings</span>
                  <button type="button" class="aipkit_model_settings_popover_close" aria-label="Close">
                    <span class="dashicons dashicons-no-alt"></span>
                  </button>
                </div>
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_enhancer_settings_popover">
                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <!-- Sliders Row (2 columns) -->
                        <div class="aipkit_enhancer_sliders_row">
                          <!-- Temperature Slider (Creativity) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_temperature_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_ai_temperature">Creativity</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_ai_temperature_value">1.0</span>
                            </div>
                            <div class="aipkit_enhancer_temperature_slider_wrapper">
                              <div class="aipkit_enhancer_temperature_labels">
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--low">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                  Focused
                                </span>
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--high">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                  Creative
                                </span>
                              </div>
                              <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_enhancer_temperature_slider" min="0" max="2" step="0.1" value="1.0">
                            </div>
                          </div>

                          <!-- Max Tokens Slider (Content Length) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_tokens_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_content_max_tokens">Content Length</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_content_max_tokens_value">1200-1600 words</span>
                            </div>
                            <div class="aipkit_enhancer_tokens_slider_wrapper">
                              <div class="aipkit_enhancer_tokens_labels">
                                <span class="aipkit_enhancer_tokens_label">Short</span>
                                <span class="aipkit_enhancer_tokens_label">Medium</span>
                                <span class="aipkit_enhancer_tokens_label">Long</span>
                              </div>
                              <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_enhancer_tokens_slider" min="1" max="3" step="1" value="2">
                            </div>
                          </div>
                        </div>

                        <div class="aipkit_popover_option_row aipkit_enhancer_reasoning_effort_field">
                          <div class="aipkit_popover_option_main">
                            <div class="aipkit_popover_option_text">
                              <label class="aipkit_popover_option_label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                              <span class="aipkit_popover_option_helper">Controls thinking effort for supported models.</span>
                            </div>
                            <div class="aipkit_popover_option_actions">
                              <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_popover_option_select">
                                <option value="none">None</option>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="xhigh">XHigh</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <div class="aipkit_enhancer_vector_settings">
                      <!-- Enable Toggle -->
                      <div class="aipkit_enhancer_vector_toggle_card">
                        <div class="aipkit_enhancer_vector_toggle_row">
                          <div class="aipkit_enhancer_vector_toggle_info">
                            <span class="aipkit_enhancer_vector_toggle_label">Knowledge Base</span>
                            <span class="aipkit_enhancer_vector_toggle_desc">Use your vector stores for RAG-enhanced content</span>
                          </div>
                          <div class="aipkit_enhancer_vector_toggle_controls">
                            <label class="aipkit_switch">
                              <input type="checkbox" name="enable_vector_store" value="1" class="aipkit_toggle_switch">
                              <span class="aipkit_switch_slider"></span>
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Source Selector (shown when enabled) -->
                      <div class="aipkit_cw_vector_store_settings_container aipkit_enhancer_vector_source_container" hidden>
                        <div class="aipkit_enhancer_vector_source_selector">
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_store_provider">Provider</label>
                            <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="pinecone">Pinecone</option>
                              <option value="qdrant">Qdrant</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <!-- OpenAI Stores (Multiselect) -->
                            <div class="aipkit_cw_vector_openai_field">
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_openai_vector_store_ids">Vector Store</label>
                              <div
                                class="aipkit_popover_multiselect aipkit_vector_multiselect aipkit_enhancer_vector_multiselect"
                                data-aipkit-vector-stores-dropdown
                                data-placeholder="Select stores"
                                data-selected-label="selected"
                              >
                                <button
                                  type="button"
                                  class="aipkit_popover_multiselect_btn aipkit_vector_multiselect_btn aipkit_enhancer_vector_multiselect_btn"
                                  aria-expanded="false"
                                  aria-controls="aipkit_bulk_openai_vector_store_panel"
                                >
                                  <span class="aipkit_popover_multiselect_label">Select stores</span>
                                </button>
                                <div
                                  id="aipkit_bulk_openai_vector_store_panel"
                                  class="aipkit_popover_multiselect_panel aipkit_enhancer_vector_multiselect_panel"
                                  role="menu"
                                  hidden
                                >
                                  <div class="aipkit_popover_multiselect_options"></div>
                                </div>
                              </div>
                              <select
                                id="aipkit_bulk_openai_vector_store_ids"
                                name="openai_vector_store_ids[]"
                                class="aipkit_popover_multiselect_select"
                                multiple
                                size="3"
                                hidden
                                aria-hidden="true"
                                tabindex="-1"
                              ></select>
                            </div>
                            
                            <!-- Pinecone Index -->
                            <div class="aipkit_cw_vector_pinecone_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_pinecone_index_name">Index</label>
                              <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                            
                            <!-- Qdrant Collection -->
                            <div class="aipkit_cw_vector_qdrant_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                              <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                          </div>
                        </div>

                        <!-- Embedding Config (for Pinecone/Qdrant) -->
                        <div class="aipkit_cw_vector_embedding_config_row aipkit_enhancer_vector_embedding_selector" hidden>
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_provider">Embedding</label>
                            <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="google">Google</option>
                              <option value="azure">Azure</option>
                              <option value="openrouter">OpenRouter</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_model">Model</label>
                            <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_enhancer_vector_settings_select"></select>
                          </div>
                        </div>

                        <!-- Results Limit Slider -->
                        <div class="aipkit_vector_slider_group">
                          <div class="aipkit_vector_slider_header">
                            <label class="aipkit_vector_settings_label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                            <span class="aipkit_vector_slider_value" id="aipkit_bulk_vector_store_top_k_value">3</span>
                          </div>
                          <div class="aipkit_vector_slider_wrapper">
                            <div class="aipkit_vector_slider_labels">
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--min">
                                <span class="dashicons dashicons-minus" aria-hidden="true"></span>
                                Fewer
                              </span>
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--max">
                                More
                                <span class="dashicons dashicons-plus" aria-hidden="true"></span>
                              </span>
                            </div>
                            <input type="range" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_vector_slider" value="3" min="1" max="20" step="1">
                          </div>
                          <p class="aipkit_vector_slider_hint">Number of matching chunks to retrieve</p>
                        </div>
                      </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_enhancer_template_picker_popover" data-aipkit-bulk-popover="templates" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_cw_settings_popover_panel aipkit_cw_template_picker_popover_panel" role="dialog" aria-label="Templates">
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_cw_template_picker_search_wrap">
                    <span class="dashicons dashicons-search aipkit_cw_template_picker_search_icon" aria-hidden="true"></span>
                    <input
                      type="text"
                      id="aipkit_enhancer_template_picker_search"
                      class="aipkit_cw_template_picker_search"
                      placeholder="Search templates..."
                      autocomplete="off"
                    >
                    <button
                      type="button"
                      id="aipkit_enhancer_template_picker_search_clear"
                      class="aipkit_cw_template_picker_search_clear"
                      aria-label="Clear search"
                      style="display: none;"
                    >
                      <span class="dashicons dashicons-no-alt" aria-hidden="true"></span>
                    </button>
                  </div>
                  <div class="aipkit_cw_template_picker_list" id="aipkit_enhancer_template_picker_list" role="listbox" aria-label="Template list">
                    <div class="aipkit_cw_template_picker_empty">
                      Loading templates...
                    </div>
                  </div>
                  <div class="aipkit_cw_template_picker_actions">
                    <div class="aipkit_cw_template_action_list" id="aipkit_enhancer_template_action_list">
                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">
                        <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
                        New
                      </button>
                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        Rename
                      </button>
                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                        Delete
                      </button>
                    </div>
                    <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                      <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                    <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                      <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_title_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Title Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Title Prompt</span>
                    <select id="aipkit_bulk_title_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_title" title="Load template">
                      ${p}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_title" class="aipkit_cw_prompt_editor_textarea" rows="8">${l(s.title||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="title" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_content_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Content Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Content Prompt</span>
                    <select id="aipkit_bulk_content_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_content" title="Load template">
                      ${d}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_content" class="aipkit_cw_prompt_editor_textarea" rows="10">${l(s.content||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="content" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_meta_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Meta Description Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Meta Description Prompt</span>
                    <select id="aipkit_bulk_meta_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_meta" title="Load template">
                      ${u}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_meta" class="aipkit_cw_prompt_editor_textarea" rows="8">${l(s.meta||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="meta" data-label="Placeholders:" data-copy-title="Click to copy">${h}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_keyword_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Focus Keyword Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Focus Keyword Prompt</span>
                    <select id="aipkit_bulk_keyword_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_keyword" title="Load template">
                      ${f}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_cw_prompt_editor_textarea" rows="8">${l(s.keyword||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="keyword" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_excerpt_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Excerpt Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Excerpt Prompt</span>
                    <select id="aipkit_bulk_excerpt_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_excerpt" title="Load template">
                      ${m}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_cw_prompt_editor_textarea" rows="8">${l(s.excerpt||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="excerpt" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_tags_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Tags Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Tags Prompt</span>
                    <select id="aipkit_bulk_tags_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_tags" title="Load template">
                      ${g}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_tags" class="aipkit_cw_prompt_editor_textarea" rows="8">${l(s.tags||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="tags" data-label="Placeholders:" data-copy-title="Click to copy">${_}</span>
                  </div>
                </div>
              </div>
            </div>

            <div id="aipkit-enhancer-bulk-progress" hidden>
              <div class="aipkit_enhancer_progress_header">
                <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
              </div>
              <div class="aipkit_progress_bar_container">
                <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled"></div>
              </div>
              <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <div class="aipkit_enhancer_footer_info">
              <div class="aipkit_enhancer_selection_badge">
                <span class="aipkit_enhancer_selection_count">${r}</span>
                <span class="aipkit_enhancer_selection_label">item${r===1?"":"s"} selected</span>
              </div>
            </div>
            <div class="aipkit_enhancer_footer_actions">
              <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-ghost" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span>Back</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                <span>Stop</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-success">
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                <span class="aipkit_btn-text">Start Processing</span>
                <span class="aipkit_spinner" hidden></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=k})();(function(){"use strict";function k(a,r){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let i={};a.forEach(f=>{let m=document.querySelector(`tr#post-${f}`);if(m){let g=m.querySelector(".row-title")||m.querySelector("strong a")||m.querySelector(".title a")||m.querySelector("a.row-title")||m.querySelector(".column-title strong a")||m.querySelector(".column-title .row-title");g&&(i[f]=g.textContent.trim())}i[f]||(i[f]=`Post #${f}`)}),window.aipkit_enhancer_postTitles=i;let s=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},n=window.aipkit_post_enhancer?.prompt_library||{},c=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],l=window.aipkit_post_enhancer?.default_ai_provider||"",o=String(l||"").trim().toLowerCase(),e={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",claude:"Claude",deepseek:"DeepSeek",ollama:"Ollama"},t=c.map(f=>{let m=f.toLowerCase();return`<option value="${m}" ${o&&m===o?"selected":""}>${e[m]||f.toUpperCase()}</option>`}).join(""),p=window.aipkit_enhancer_getBulkModalHtml({postCount:a.length,providerOptions:t,defaultPrompts:s,promptLibrary:n,postType:r});document.body.insertAdjacentHTML("beforeend",p);let d=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(d,a):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available.");let u=d.querySelector("#aipkit_bulk_ai_provider");u&&o&&Array.from(u.options).some(m=>m.value===o)&&(u.value=o,u.dispatchEvent(new Event("change",{bubbles:!0}))),requestAnimationFrame(()=>{d.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(v){return v},a=".aipkit_enhancer_bulk_modal",r=["#aipkit_bulk_ai_provider","#aipkit_bulk_ai_model","#aipkit_bulk_vector_store_provider","#aipkit_bulk_vector_embedding_provider","#aipkit_bulk_pinecone_index_name","#aipkit_bulk_qdrant_collection_name","#aipkit_bulk_vector_embedding_model"].join(", "),i=null,s=null,n=!1,c=new Set(["aipkit_bulk_ai_provider","aipkit_bulk_vector_store_provider","aipkit_bulk_vector_embedding_provider"]),l=v=>!!(v&&v.id&&c.has(v.id)),o=v=>String(v||"").trim().toLowerCase(),e=(v,A)=>{if(!v)return;let C="aipkit_settings_select_picker_icon--";v.classList.forEach(L=>{L.startsWith(C)&&v.classList.remove(L)}),v.classList.remove("is-hidden");let b=o(A);if(!b){v.classList.add("is-hidden");return}v.classList.add(`${C}${b}`)},t=v=>{if(!v)return"";let A=v.getAttribute("data-aipkit-picker-title");if(A)return A;let C=v.id&&document.querySelector(`label[for="${v.id}"]`)||v.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return C?C.textContent.trim():""},p=v=>{if(!v)return"";let A=v.selectedOptions&&v.selectedOptions.length?v.selectedOptions[0]:v.querySelector("option[selected]");if(A)return A.textContent.trim();let C=v.querySelector("option");return C?C.textContent.trim():""},d=v=>({buttonId:`${v}_picker_btn`,labelId:`${v}_picker_label`,popoverId:`${v}_picker_popover`,titleId:`${v}_picker_title`,searchId:`${v}_picker_search`,listId:`${v}_picker_list`}),u=(v,A)=>{if(!v||!v.id||!A)return null;let C=d(v.id),b=A.querySelector(`#${C.buttonId}`);if(!b){if(b=document.createElement("button"),b.type="button",b.id=C.buttonId,b.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",b.setAttribute("data-aipkit-popover-target",C.popoverId),b.setAttribute("aria-controls",C.popoverId),b.setAttribute("aria-expanded","false"),b.dataset.aipkitPopoverPlacement="bottom",l(v)){b.classList.add("aipkit_settings_select_picker_btn--provider");let W=document.createElement("span");W.className="aipkit_settings_select_picker_icon",W.setAttribute("aria-hidden","true"),e(W,v.value),b.appendChild(W)}let B=document.createElement("span");B.className="aipkit_settings_select_picker_label",B.id=C.labelId,B.textContent=p(v)||k("Select","gpt3-ai-content-generator");let $=document.createElement("span");$.className="dashicons dashicons-arrow-down-alt2",$.setAttribute("aria-hidden","true"),b.appendChild(B),b.appendChild($),v.insertAdjacentElement("beforebegin",b)}v.classList.contains("screen-reader-text")||v.classList.add("screen-reader-text");let L=A.querySelector(`#${C.popoverId}`);if(!L){L=document.createElement("div"),L.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",l(v)&&L.classList.add("aipkit_settings_select_picker_popover--provider"),L.id=C.popoverId,L.setAttribute("aria-hidden","true");let B=document.createElement("div");B.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",B.setAttribute("role","dialog"),B.setAttribute("aria-labelledby",C.titleId);let $=document.createElement("div");$.className="aipkit_model_settings_popover_header";let W=document.createElement("span");W.className="aipkit_model_settings_popover_title",W.id=C.titleId,W.textContent=t(v)||k("Select","gpt3-ai-content-generator");let U=document.createElement("button");U.type="button",U.className="aipkit_model_settings_popover_close",U.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),U.innerHTML='<span class="dashicons dashicons-no-alt"></span>',$.appendChild(W),$.appendChild(U);let D=document.createElement("div");D.className="aipkit_model_settings_popover_body";let H=document.createElement("div");H.className="aipkit_settings_select_picker_search";let Q=document.createElement("input");Q.type="search",Q.id=C.searchId,Q.className="aipkit_form-input";let F=t(v),P=F?`Search ${F.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");Q.setAttribute("placeholder",P),H.appendChild(Q);let R=document.createElement("div");R.className="aipkit_settings_select_picker_list",R.id=C.listId,R.setAttribute("role","listbox"),D.appendChild(H),D.appendChild(R),B.appendChild($),B.appendChild(D),L.appendChild(B),A.appendChild(L),l(v)&&(H.style.display="none")}return{ids:C,button:b,popover:L,label:A.querySelector(`#${C.labelId}`),search:A.querySelector(`#${C.searchId}`),list:A.querySelector(`#${C.listId}`)}},f=v=>{let A=[];return v&&Array.from(v.children).forEach(b=>{if(b.tagName==="OPTGROUP"){let L=Array.from(b.children).filter(B=>B.tagName==="OPTION").map(B=>({value:B.value,label:B.textContent.trim(),disabled:B.disabled,selected:B.selected}));A.push({groupLabel:b.label||"",options:L})}else b.tagName==="OPTION"&&A.push({groupLabel:"",options:[{value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}]})}),A},m=(v,A,C="")=>{if(!v||!A)return;let b=C.trim().toLowerCase();A.innerHTML="";let L=f(v),B=!1;if(L.forEach($=>{let W=$.options.filter(U=>b?U.label.toLowerCase().includes(b):!0);if(W.length){if($.groupLabel){let U=document.createElement("div");U.className="aipkit_settings_select_picker_group_label",U.textContent=$.groupLabel,A.appendChild(U)}W.forEach(U=>{let D=document.createElement("button");if(D.type="button",D.className="aipkit_settings_select_picker_item",D.setAttribute("role","option"),D.dataset.value=U.value,D.dataset.label=U.label,U.disabled&&(D.classList.add("is-disabled"),D.setAttribute("aria-disabled","true")),v.value===U.value?(D.classList.add("is-active"),D.setAttribute("aria-selected","true")):D.setAttribute("aria-selected","false"),l(v)){D.classList.add("aipkit_settings_select_picker_item--provider");let F=document.createElement("span");F.className="aipkit_settings_select_picker_icon",F.setAttribute("aria-hidden","true"),e(F,U.value),D.appendChild(F)}let H=document.createElement("span");H.className="aipkit_settings_select_picker_text",H.textContent=U.label;let Q=document.createElement("span");Q.className="dashicons dashicons-yes aipkit_settings_select_picker_check",D.appendChild(H),D.appendChild(Q),A.appendChild(D),B=!0})}}),!B){let $=document.createElement("div");$.className="aipkit_settings_select_picker_empty",$.textContent=k(b?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild($)}},g=(v,A)=>{if(!v||!A)return;let C=p(v);if(A.textContent=C||k("Select","gpt3-ai-content-generator"),l(v)){let b=A.closest("button"),L=b?b.querySelector(".aipkit_settings_select_picker_icon"):null;e(L,v.value)}},_=(v,A)=>{if(!v||!A)return;let C=v.getBoundingClientRect(),b=A.getBoundingClientRect(),L=b.width||320,B=b.height||0,$=window.innerWidth,W=window.innerHeight,U=12,D=C.left;D+L>$-U&&(D=C.right-L),D=Math.max(U,Math.min(D,$-L-U));let H=C.bottom+8;H+B>W-U&&(H=C.top-B-8),H=Math.max(U,Math.min(H,W-B-U)),A.style.left=`${Math.round(D)}px`,A.style.top=`${Math.round(H)}px`},h=()=>{!i||!s||n||(n=!0,window.requestAnimationFrame(()=>{let v=i.querySelector(".aipkit_model_settings_popover_panel");_(s,v),n=!1}))},y=()=>{i&&(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),s&&s.setAttribute("aria-expanded","false"),i=null,s=null)},E=(v,A,C)=>{if(!v||!A)return;i&&i!==A&&y(),i=A,s=v,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),v.setAttribute("aria-expanded","true");let b=A.querySelector(".aipkit_settings_select_picker_search input"),L=A.querySelector(".aipkit_settings_select_picker_list");L&&m(C,L,b?b.value:""),b&&b.offsetParent!==null&&(b.focus(),b.select());let B=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{_(v,B)})},x=(v,A)=>{if(!v||!A)return;let{button:C,popover:b,list:L,search:B}=A;if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",$=>{if($.preventDefault(),i===b){y();return}E(C,b,v)}),C.dataset.pickerListenerAttached="true"),b&&b.dataset.overlayListenerAttached!=="true"){b.addEventListener("click",W=>{W.target===b&&y()});let $=b.querySelector(".aipkit_model_settings_popover_close");$&&$.addEventListener("click",W=>{W.preventDefault(),y()}),b.dataset.overlayListenerAttached="true"}if(L&&L.dataset.pickerListenerAttached!=="true"&&(L.addEventListener("click",$=>{let W=$.target.closest(".aipkit_settings_select_picker_item");if(!W||W.classList.contains("is-disabled"))return;let U=W.dataset.value??"";v.value=U,v.dispatchEvent(new Event("change",{bubbles:!0})),g(v,A.label),m(v,L,B?B.value:""),y()}),L.dataset.pickerListenerAttached="true"),B&&B.dataset.pickerListenerAttached!=="true"&&(B.addEventListener("input",()=>{m(v,L,B.value)}),B.dataset.pickerListenerAttached="true"),v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("change",()=>{g(v,A.label),m(v,L,B?B.value:""),i===b&&y()}),v.dataset.pickerListenerAttached="true"),v&&v.dataset.pickerObserverAttached!=="true"){let $=!1;new MutationObserver(()=>{$||($=!0,window.requestAnimationFrame(()=>{g(v,A.label),m(v,L,B?B.value:""),$=!1}))}).observe(v,{childList:!0,subtree:!0}),v.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitBulkPickerEscapeBound||(document.addEventListener("keydown",$=>{$.key==="Escape"&&i&&y()}),document.body.dataset.aipkitBulkPickerEscapeBound="true"),document.body.dataset.aipkitBulkPickerRepositionBound||(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),document.body.dataset.aipkitBulkPickerRepositionBound="true")};function w(v){if(!v||v.dataset.aipkitBulkPickerInit==="true")return;let A=v.querySelectorAll(r);A.length&&(A.forEach(C=>{if(!C.id||C.dataset.aipkitPickerInit==="true")return;let b=u(C,v);b&&(g(C,b.label),m(C,b.list,b.search?b.search.value:""),x(C,b),C.dataset.aipkitPickerInit="true")}),v.dataset.aipkitBulkPickerInit="true")}function S(){document.querySelectorAll(a).forEach(w)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S(),new MutationObserver(S).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initBulkEnhancerSelectPickers=w})();(function(){"use strict";let k=window.aipkit_escapeHtml||(t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),a=["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],r=["{original_title}","{original_content}","{original_focus_keyword}","{original_meta_description}","{original_tags}","{categories}"],i=["{price}","{regular_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{purchase_note}","{product_categories}"],s=t=>t?.querySelector(".aipkit_enhancer_bulk_modal")?.dataset?.postType||"",n=(t,p)=>{let u=[...t==="meta"?r:a];return p==="product"&&u.push(...i),u.filter((f,m)=>u.indexOf(f)===m)},c=(t,p)=>{if(!t)return;let d=t.dataset.label||"Placeholders:",u=t.dataset.copyTitle||"Click to copy";t.innerHTML=`${k(d)} `,p.forEach((f,m)=>{let g=document.createElement("code");g.className="aipkit-placeholder",g.title=u,g.textContent=f,t.appendChild(g),m<p.length-1&&t.appendChild(document.createTextNode(" "))})},l=(t,p)=>{if(!t)return;let d=t.querySelector(".aipkit_bulk_prompt_placeholders");if(!d)return;let u=d.dataset.promptType||"",f=n(u,p);c(d,f)};function o(t){if(!t)return;let p=t.querySelectorAll("[data-aipkit-bulk-popover]");if(!p.length)return;let d=null,u=null,f=!1,m=E=>E?t.querySelector(`#${E}`):null,g=(E,x)=>{if(!E||!x)return;let w=E.getBoundingClientRect(),S=x.getBoundingClientRect(),T=S.width||400,v=S.height||0,A=window.innerWidth,C=window.innerHeight,b=12,L=w.left;L+T>A-b&&(L=w.right-T),L=Math.max(b,Math.min(L,A-T-b));let B=w.bottom+8;B+v>C-b&&(B=w.top-v-8),B=Math.max(b,Math.min(B,C-v-b)),x.style.left=`${Math.round(L)}px`,x.style.top=`${Math.round(B)}px`},_=()=>{!u||!d||f||(f=!0,window.requestAnimationFrame(()=>{let E=d.querySelector(".aipkit_model_settings_popover_panel");g(u,E),f=!1}))},h=()=>{d&&(d.classList.remove("aipkit-active"),d.setAttribute("aria-hidden","true"),u&&u.setAttribute("aria-expanded","false"),d?.dataset?.aipkitBulkPopover==="prompts"&&typeof window.aipkit_enhancer_closeBulkPromptFlyout=="function"&&window.aipkit_enhancer_closeBulkPromptFlyout(),d=null,u=null)},y=E=>{if(!E)return;let x=E.getAttribute("data-aipkit-popover-target"),w=m(x);if(!w)return;d&&d!==w&&h(),d=w,u=E,w.classList.add("aipkit-active"),w.setAttribute("aria-hidden","false"),E.setAttribute("aria-expanded","true");let S=w.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{g(E,S)})};p.forEach(E=>{E.dataset.popoverListenerAttached!=="true"&&(E.addEventListener("click",x=>{if(x.preventDefault(),d&&u===E){h();return}y(E)}),E.dataset.popoverListenerAttached="true")}),t.querySelectorAll(".aipkit_model_settings_popover[data-aipkit-bulk-popover]").forEach(E=>{E.dataset.overlayListenerAttached!=="true"&&(E.addEventListener("click",w=>{w.target===E&&h()}),E.dataset.overlayListenerAttached="true");let x=E.querySelector(".aipkit_model_settings_popover_close");x&&x.dataset.popoverListenerAttached!=="true"&&(x.addEventListener("click",w=>{w.preventDefault(),h()}),x.dataset.popoverListenerAttached="true")}),t.dataset.bulkPromptPopoverEscapeAttached!=="true"&&(document.addEventListener("keydown",E=>{E.key==="Escape"&&d&&h()}),t.dataset.bulkPromptPopoverEscapeAttached="true"),t.dataset.bulkPromptPopoverRepositionAttached!=="true"&&(window.addEventListener("resize",_),window.addEventListener("scroll",_,!0),t.dataset.bulkPromptPopoverRepositionAttached="true")}function e(t){if(!t)return;let p=t.querySelectorAll(".aipkit_prompt_edit_btn");if(!p.length)return;let d=s(t),u=null,f=null,m=!1,g=w=>w?t.querySelector(`#${w}`):null,_=(w,S,T)=>{if(!w||!S)return;let v=w.getBoundingClientRect(),A=S.getBoundingClientRect(),C=T?T.getBoundingClientRect():v,b=A.width||580,L=A.height||0,B=window.innerWidth,$=window.innerHeight,W=12,U=C.left-b-12;U<W&&(U=C.right+12),U=Math.max(W,Math.min(U,B-b-W));let D=C.top;D+L>$-W&&(D=$-L-W),D=Math.max(W,D),u.style.left=`${Math.round(U)}px`,u.style.top=`${Math.round(D)}px`},h=()=>{!f||!u||m||(m=!0,window.requestAnimationFrame(()=>{let w=u.querySelector(".aipkit_cw_prompt_panel"),S=f.closest(".aipkit_model_settings_popover_panel");_(f,w,S),m=!1}))},y=()=>{u&&(u.classList.remove("is-open"),u.setAttribute("aria-hidden","true"),f&&f.setAttribute("aria-expanded","false"),u=null,f=null)},E=w=>{let S=w.getAttribute("data-aipkit-flyout-target"),T=g(S);if(!T)return;u&&u!==T&&y(),u=T,f=w,T.classList.add("is-open"),T.setAttribute("aria-hidden","false"),w.setAttribute("aria-expanded","true"),l(T,d);let v=T.querySelector(".aipkit_cw_prompt_panel"),A=w.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{_(w,v,A)})};p.forEach(w=>{w.dataset.flyoutListenerAttached!=="true"&&(w.addEventListener("click",S=>{if(S.preventDefault(),u&&f===w){y();return}E(w)}),w.dataset.flyoutListenerAttached="true")}),t.querySelectorAll(".aipkit_cw_prompt_library_select").forEach(w=>{let S=w.getAttribute("data-aipkit-prompt-target"),T=S?t.querySelector(`#${S}`):null;T&&T.value.trim()===""&&w.value&&(T.value=w.value),w.dataset.promptLibraryAttached!=="true"&&(w.addEventListener("change",()=>{if(!w.value)return;let v=w.getAttribute("data-aipkit-prompt-target"),A=v?t.querySelector(`#${v}`):null;A&&(A.value=w.value,A.dispatchEvent(new Event("input",{bubbles:!0})))}),w.dataset.promptLibraryAttached="true")}),t.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(w=>{w.dataset.overlayListenerAttached!=="true"&&(w.addEventListener("click",S=>{S.target===w&&y()}),w.dataset.overlayListenerAttached="true")}),t.dataset.bulkPromptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",w=>{w.key==="Escape"&&u&&y()}),t.dataset.bulkPromptFlyoutEscapeAttached="true"),t.dataset.bulkPromptFlyoutClickAttached!=="true"&&(document.addEventListener("click",w=>{if(!u)return;let S=w.target;S.closest(".aipkit_cw_prompt_flyout")||S.closest("[data-aipkit-flyout-target]")||y()}),t.dataset.bulkPromptFlyoutClickAttached="true"),t.dataset.bulkPromptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),t.dataset.bulkPromptFlyoutRepositionAttached="true"),window.aipkit_enhancer_closeBulkPromptFlyout=y}window.aipkit_enhancer_initBulkPromptPopovers=o,window.aipkit_enhancer_initBulkPromptFlyouts=e})();(function(){"use strict";let k=window.aipkit_escapeHtml||(t=>t||""),a=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],r=t=>{let p=parseInt(t,10);if(Number.isFinite(p)){if(p>=1&&p<=a.length)return a[p-1];let d=a.find(u=>u.tokens===p);if(d)return d}return a[1]};function i(t,p){let d=window.aipkit_post_enhancer||{},u,f,m,g,_;t==="openai"?(u=p.querySelector("#aipkit_bulk_openai_vector_store_ids"),f=d.openai_vector_stores||[],m="id",g="name",_="No OpenAI stores found."):t==="pinecone"?(u=p.querySelector("#aipkit_bulk_pinecone_index_name"),f=d.pinecone_indexes||[],m="name",g="name",_="No Pinecone indexes found."):t==="qdrant"&&(u=p.querySelector("#aipkit_bulk_qdrant_collection_name"),f=d.qdrant_collections||[],m="name",g="name",_="No Qdrant collections found."),u&&(u.innerHTML="",f.length>0?u.multiple?f.forEach(h=>{u.add(new Option(k(h[g]),h[m]))}):(u.add(new Option("-- Select --","")),f.forEach(h=>{u.add(new Option(k(h[g]),h[m]))})):(u.add(new Option(_,"")),u.disabled=!0),t==="openai"&&s(p))}function s(t){let p=t.querySelector("[data-aipkit-vector-stores-dropdown]");if(!p)return;let d=p.closest(".aipkit_cw_vector_openai_field"),u=d?d.querySelector(".aipkit_popover_multiselect_select"):null;if(!u)return;let f=p.querySelector(".aipkit_popover_multiselect_btn"),m=p.querySelector(".aipkit_popover_multiselect_label"),g=p.querySelector(".aipkit_popover_multiselect_panel"),_=p.querySelector(".aipkit_popover_multiselect_options"),h=p.dataset.placeholder||"Select stores",y=p.dataset.selectedLabel||"selected",E=()=>{if(!m)return;let v=Array.from(u.options).filter(C=>C.selected&&C.value);if(!v.length){m.textContent=h;return}let A=v.map(C=>C.textContent.trim()).filter(Boolean);if(A.length<=2){m.textContent=A.join(", ");return}m.textContent=`${A.length} ${y}`},x=()=>{if(!_)return;_.innerHTML="";let v=Array.from(u.options),A=v.filter(C=>C.value);if(!A.length){let C=document.createElement("div");C.className="aipkit_popover_multiselect_empty",C.textContent=v[0]?.textContent||"-- No Stores Found --",_.appendChild(C),E();return}A.forEach(C=>{let b=document.createElement("label");b.className="aipkit_popover_multiselect_item";let L=document.createElement("input");L.type="checkbox",L.value=C.value,L.checked=C.selected,L.disabled=C.disabled;let B=document.createElement("span");B.className="aipkit_popover_multiselect_text",B.textContent=C.textContent,b.appendChild(L),b.appendChild(B),_.appendChild(b)}),E()},w=()=>{if(!_){E();return}let v=new Set(Array.from(u.options).filter(A=>A.selected).map(A=>A.value));_.querySelectorAll('input[type="checkbox"]').forEach(A=>{A.checked=v.has(A.value)}),E()},S=v=>{if(!_)return;let A=Array.from(_.querySelectorAll('input[type="checkbox"]:checked'));if(A.length>2){let b=v&&v.target;if(b&&b.checked)b.checked=!1;else{let L=A[A.length-1];L&&(L.checked=!1)}}let C=Array.from(_.querySelectorAll('input[type="checkbox"]:checked')).map(b=>b.value);Array.from(u.options).forEach(b=>{b.selected=C.includes(b.value)}),u.dispatchEvent(new Event("change",{bubbles:!0})),E()},T=v=>{!p||!f||(p.classList.toggle("is-open",v),f.setAttribute("aria-expanded",v?"true":"false"),g&&(g.hidden=!v))};x(),w(),p.dataset.vectorStoreMultiselectAttached||(f&&(f.addEventListener("click",v=>{v.preventDefault(),v.stopPropagation(),T(!p.classList.contains("is-open"))}),f.addEventListener("keydown",v=>{v.key==="Escape"&&T(!1)})),document.addEventListener("click",v=>{p.classList.contains("is-open")&&(p.contains(v.target)||T(!1))}),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",S),_.dataset.listenerAttached="true"),u.dataset.listenerAttached||(u.addEventListener("change",w),u.dataset.listenerAttached="true"),p.dataset.vectorStoreMultiselectAttached="true")}function n(t,p){let d=p.querySelector("#aipkit_bulk_vector_embedding_model");if(!d)return;let u=window.aipkit_post_enhancer||{},f=[];t==="google"?f=u.googleEmbeddingModels||[]:t==="openrouter"?f=u.openrouterEmbeddingModels||[]:t==="azure"?f=u.azureEmbeddingModels||[]:f=u.openaiEmbeddingModels||[],d.innerHTML="",f.length>0?(d.add(new Option("-- Select Model --","")),f.forEach(m=>{d.add(new Option(k(m.name||m.id),m.id))}),d.disabled=!1):(d.add(new Option("No models found","")),d.disabled=!0)}function c(t){let p=t.querySelector("#aipkit_bulk_vector_store_provider").value,d=t.querySelector(".aipkit_cw_vector_openai_field"),u=t.querySelector(".aipkit_cw_vector_pinecone_field"),f=t.querySelector(".aipkit_cw_vector_qdrant_field"),m=t.querySelector(".aipkit_cw_vector_embedding_config_row");d&&(d.hidden=!0),u&&(u.hidden=!0),f&&(f.hidden=!0),m&&(m.hidden=!0),p==="openai"?(d&&(d.hidden=!1),i("openai",t)):p==="pinecone"?(u&&(u.hidden=!1),m&&(m.hidden=!1),i("pinecone",t),n("openai",t)):p==="qdrant"&&(f&&(f.hidden=!1),m&&(m.hidden=!1),i("qdrant",t),n("openai",t))}function l(t){let p=t.querySelector('input[name="enable_vector_store"]'),d=t.querySelector(".aipkit_cw_vector_store_settings_container"),u=t.querySelector("#aipkit_bulk_vector_store_provider"),f=t.querySelector("#aipkit_bulk_vector_embedding_provider"),m=t.querySelector("#aipkit_bulk_vector_store_top_k"),g=t.querySelector("#aipkit_bulk_vector_store_top_k_value");if(!(!p||!d||!u)){if(p.addEventListener("change",()=>{d.hidden=!p.checked}),u.addEventListener("change",()=>c(t)),f&&f.addEventListener("change",_=>n(_.target.value,t)),m&&g){let _=()=>{g.textContent=m.value};m.addEventListener("input",_),_()}d.hidden=!p.checked,c(t)}}function o(t){let p=t.querySelectorAll(".aipkit_prompt_toggle_card, .aipkit_enhancer_prompt_card");p.length&&p.forEach(d=>{let u=d.querySelector('input[name="bulk_enhance_fields"], input[name="generate_seo_slug"]');if(!u)return;let f=()=>{d.classList.toggle("is-disabled",!u.checked)};f(),u.addEventListener("change",f),d.dataset.promptToggleAttached!=="true"&&(d.addEventListener("click",m=>{m.target.closest(".aipkit_prompt_edit_btn")||m.target.closest("a")||u.disabled||(m.target.closest(".aipkit_switch")&&m.preventDefault(),u.checked=!u.checked,u.dispatchEvent(new Event("change",{bubbles:!0})))}),d.dataset.promptToggleAttached="true")})}function e(t,p){if(!t)return;let d=t.querySelector("#aipkit-enhancer-bulk-config"),u=t.querySelector("#aipkit-enhancer-bulk-progress"),f=t.querySelector("#aipkit_bulk_enhancer_start_btn"),m=t.querySelector("#aipkit_bulk_enhancer_stop_btn"),g=t.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn");if(d&&(d.hidden=!1),u&&(u.hidden=!0),f){f.disabled=!1;let A=f.querySelector(".aipkit_btn-text");A&&(A.textContent="Start")}m&&(m.hidden=!0),g&&(g.hidden=!0);let _=t.querySelectorAll(".aipkit_enhancer_advanced_details");_.length&&_.forEach(A=>{if(A.dataset.toggleListenerAttached==="true")return;let C=A.querySelector("summary");C&&(C.addEventListener("click",b=>{b.preventDefault(),A.hasAttribute("open")?A.removeAttribute("open"):A.setAttribute("open","")}),A.dataset.toggleListenerAttached="true")});let h=t.querySelector(".aipkit_enhancer_settings_popover");h&&h.dataset.checkboxDelegateAttached!=="true"&&(h.addEventListener("click",A=>{let C=A.target?.closest?.(".aipkit_switch");if(C&&h.contains(C)){let B=C.querySelector('input[type="checkbox"]');if(!B||B.disabled)return;A.preventDefault(),B.checked=!B.checked,B.dispatchEvent(new Event("change",{bubbles:!0}));return}let b=A.target.closest(".aipkit_checkbox-label");if(!b||!h.contains(b))return;let L=b.querySelector('input[type="checkbox"]');!L||L.disabled||A.target!==L&&(A.preventDefault(),L.checked=!L.checked,L.dispatchEvent(new Event("change",{bubbles:!0})))}),h.dataset.checkboxDelegateAttached="true");function y(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),t&&(t.classList.remove("aipkit-active"),t.addEventListener("transitionend",()=>t.remove(),{once:!0}),setTimeout(()=>t?.remove(),500))}t.querySelector(".aipkit-modal-close-btn").addEventListener("click",y);let E=t.querySelector("#aipkit_bulk_ai_provider"),x=t.querySelector("#aipkit_bulk_ai_model"),w=t.querySelector("#aipkit_bulk_ai_temperature"),S=t.querySelector("#aipkit_bulk_ai_temperature_value"),T=t.querySelector("#aipkit_bulk_content_max_tokens"),v=t.querySelector("#aipkit_bulk_content_max_tokens_value");if(E&&x&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(E.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(E,x)),window.aipkit_enhancer_populateBulkModels(E,x)),x&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&x.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(t)),w&&S&&w.addEventListener("input",()=>S.textContent=w.value),T&&v){let A=()=>{let C=r(T.value);v.textContent=`${C.words} words`};T.addEventListener("input",A),A()}typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(t),o(t),typeof window.aipkit_enhancer_initBulkPromptPopovers=="function"&&window.aipkit_enhancer_initBulkPromptPopovers(t),typeof window.aipkit_enhancer_initBulkPromptFlyouts=="function"&&window.aipkit_enhancer_initBulkPromptFlyouts(t),t.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(p)}),t.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),t.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),l(t)}window.aipkit_enhancer_attachBulkModalListeners=e})();(function(){"use strict"})();(function(){"use strict";function k(a,r,i){let n=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithError(a.message||n.error_loading_title,n):r?window.aipkit_updateModalWithSuggestions(r,n):window.aipkit_updateModalWithError(n.error_loading_title||"Unknown error occurred.",n)}window.aipkit_handleTitleSuggestionsResult=k})();(function(){"use strict";function k(a,r,i){let n=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorExcerpt(a.message||n.error_loading_excerpt,n):r?window.aipkit_updateModalWithExcerptSuggestions(r,n):window.aipkit_updateModalWithErrorExcerpt(n.error_loading_excerpt||"Unknown error occurred.",n)}window.aipkit_handleExcerptSuggestionsResult=k})();(function(){"use strict";function k(a,r,i){let n=(window.aipkit_post_enhancer||{}).text||{};a?window.aipkit_updateModalWithErrorMeta(a.message||n.error_loading_meta,n):r?window.aipkit_updateModalWithMetaSuggestions(r,n):window.aipkit_updateModalWithErrorMeta(n.error_loading_meta||"Unknown error occurred.",n)}window.aipkit_handleMetaSuggestionsResult=k})();(function(){"use strict";function k(){}function a(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=a})();(function(){"use strict";function k(r){let i=r.target.closest(".aipkit_enhancer_item"),s=r.target.closest("#aipkit_bulk_enhance_btn");if(i){if(i.classList.contains("aipkit_enhancer_placeholder")){r.target.tagName==="A"&&r.preventDefault();return}r.preventDefault();let n=i.getAttribute("data-post-id"),c=i.getAttribute("data-action-type");if(!n||!c)return;let l=window.aipkit_post_enhancer||{},o=l.text||{};switch(c){case"title":window.aipkit_showLoadingModal(n,o,l),window.aipkit_fetchTitleSuggestions(n,window.aipkit_handleTitleSuggestionsResult,i);break;case"excerpt":window.aipkit_showLoadingExcerptModal(n,o,l),window.aipkit_fetchExcerptSuggestions(n,window.aipkit_handleExcerptSuggestionsResult,i);break;case"meta":window.aipkit_showLoadingMetaModal(n,o,l),window.aipkit_fetchMetaSuggestions(n,window.aipkit_handleMetaSuggestionsResult,i);break;case"tags":window.aipkit_showLoadingTagsModal(n,o,l),window.aipkit_fetchTagsSuggestions(n,window.aipkit_handleTagsSuggestionsResult,i);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${c}'.`);break}}else if(s){r.preventDefault();let n=document.querySelectorAll('input[name="post[]"]:checked');if(n.length===0){alert("Please select at least one post.");return}let c=Array.from(n).map(o=>o.value),l=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(c,l):alert("Error: Bulk processing feature is not available.")}}function a(){let r=document;if(!r)return;let i="data-post-enhancer-listener";document.body.getAttribute(i)||(r.addEventListener("click",k),document.body.setAttribute(i,"true"))}window.aipkit_initEnhancerEventListeners=a})();(function(){"use strict";function k(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(r=>typeof window[r]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),function(){let i=new WeakMap;function s(e){c(e),e.classList.add("aipkit-open")}function n(e){c(e);let t=setTimeout(()=>{e.classList.remove("aipkit-open")},180);i.set(e,t)}function c(e){let t=i.get(e);t&&(clearTimeout(t),i.delete(e))}function l(e){if(!e||e.dataset.aipkitHoverBound==="1")return;e.dataset.aipkitHoverBound="1",e.addEventListener("mouseenter",()=>s(e)),e.addEventListener("mouseleave",()=>n(e));let t=e.querySelector(".aipkit_enhancer_popover");t&&(t.addEventListener("mouseenter",()=>s(e)),t.addEventListener("mouseleave",()=>n(e)))}function o(){document.querySelectorAll(".aipkit_enhancer_action").forEach(l),new MutationObserver(p=>{for(let d of p)d.addedNodes&&d.addedNodes.length&&d.addedNodes.forEach(u=>{u.nodeType===1&&(u.matches&&u.matches(".aipkit_enhancer_action")&&l(u),u.querySelectorAll&&u.querySelectorAll(".aipkit_enhancer_action").forEach(l))})}).observe(document.body,{childList:!0,subtree:!0})}o()}()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initPostEnhancer=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function a(){r()}function r(){let i=document.getElementById("aipkit_vpp_embedding_model_select");if(!i){console.error("VPP Embedding Util: Embedding model select not found.");return}let s=window.aipkit_vpp_config||{},n=s.text||{};i.innerHTML=`<option value="">${k(n.select_model||"-- Select Model --")}</option>`;let c=[{key:"openai",label:"OpenAI",models:s.openaiEmbeddingModels||[]},{key:"google",label:"Google",models:s.googleEmbeddingModels||[]},{key:"openrouter",label:"OpenRouter",models:s.openrouterEmbeddingModels||[]},{key:"azure",label:"Azure",models:s.azureEmbeddingModels||[]}],l=!1;c.forEach(o=>{if(!o.models||o.models.length===0)return;l=!0;let e=document.createElement("optgroup");e.label=o.label,o.models.forEach(t=>{if(t&&t.id){let p=document.createElement("option");p.value=t.id,p.textContent=k(t.name||t.id),p.dataset.provider=o.key,e.appendChild(p)}}),e.children.length&&i.appendChild(e)}),l?(i.disabled=!1,i.options.length>1&&(i.selectedIndex=1)):(i.appendChild(new Option(k(n.no_embedding_models||"(No embedding models - Sync in AI Settings)"),"")),i.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=a,window.aipkit_vpp_populateEmbeddingModelSelect=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function a(){let i=document.getElementById("aipkit_vpp_openai_vector_store_id"),s=document.getElementById("aipkit_vpp_openai_store_status"),n=window.aipkit_vpp_config||{},c=n.text||{},l=n.openai_vector_stores||[];if(!i){console.error("VPP OpenAI Provider: Store select not found.");return}i.innerHTML="",s&&(s.textContent=""),l.length>0?(i.appendChild(new Option(`-- ${k(c.select_store||"Select Existing Store")} --`,"")),l.forEach(o=>{let e="(Files: N/A)";o.file_counts&&typeof o.file_counts.total=="number"?e=`(${o.file_counts.total} ${o.file_counts.total===1?"File":"Files"})`:o.file_counts&&(e="(Files: ?)");let t=`${k(o.name||o.id)} ${e}`,p=new Option(t,o.id);i.appendChild(p)})):i.appendChild(new Option(k(c.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),i.disabled=l.length===0}async function r(i,s,n,c){let l=window.aipkit_vpp_config||{},o=l.text||{},e=i.length,t=0,p=0,d=0,u=[];try{let f=l.nonce_index_posts;if(!f)throw new Error("Nonce for indexing posts is missing in config.");for(let g of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}t++;let _=document.querySelector(`#post-${g}`),h=_?_.querySelector(".title .row-title"):null,y=h?h.textContent.trim():`Post #${g}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(g,"processing","",y),typeof window.aipkit_vpp_updateProgress=="function"){let x=t/e*100,w=(o.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",t).replace("%2$d",e)+` "${k(y)}"`;window.aipkit_vpp_updateProgress(x,w)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let E={_ajax_nonce:f,post_ids:[g],post_type:c,target_store_id:s,new_store_name_openai:n||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",E),p++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(g,"success","",y)}catch(x){if(d++,u.push({id:g,title:y,error:x.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${g}:`,x),typeof window.aipkit_vpp_updateProgressItem=="function"){let w=x?.message||o.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(g,"error",w,y)}}}let m=`Indexing complete. ${p} successful, ${d} failed.`;window.aipkit_isIndexingStopped&&t<e?m=`Indexing stopped. ${p} successful, ${d} failed.`:d>0&&console.error("Failed Posts:",u),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,d>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${p}/${e}`)}catch(f){console.error("VPP OpenAI Provider: Indexing setup error:",f),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,o.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(f.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),d>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=a,window.aipkit_vpp_startIndexingOpenAI=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function a(){let i=document.getElementById("aipkit_vpp_pinecone_target_index_select"),s=document.getElementById("aipkit_vpp_pinecone_index_status"),n=window.aipkit_vpp_config||{},c=n.text||{},l=n.pinecone_indexes||[];if(!i){console.error("VPP Pinecone Provider: Index select not found.");return}i.innerHTML="",s&&(s.textContent=""),l.length>0?(i.appendChild(new Option(`-- ${k(c.select_pinecone_index||"Select Pinecone Index")} --`,"")),l.forEach(o=>{let e=o.name||o.id;if(e){let t=`${k(e)} (${o.dimension||"?"})`;i.appendChild(new Option(t,e))}})):i.appendChild(new Option(k(c.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),i.disabled=l.length===0}async function r(i,s,n,c,l){let o=window.aipkit_vpp_config||{},e=o.text||{},t=i.length,p=0,d=0,u=0,f=[];try{let m=o.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let _ of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}p++;let h=document.querySelector(`#post-${_}`),y=h?h.querySelector(".title .row-title"):null,E=y?y.textContent.trim():`Post #${_}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(_,"processing","",E),typeof window.aipkit_vpp_updateProgress=="function"){let w=p/t*100,S=(e.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",p).replace("%2$d",t)+` "${k(E)}"`;window.aipkit_vpp_updateProgress(w,S)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let x={_ajax_nonce:m,post_ids:[_],post_type:l,target_index_id:s,provider:"pinecone",embedding_provider:n,embedding_model:c};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",x),d++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(_,"success","",E)}catch(w){if(u++,f.push({id:_,title:E,error:w.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${_}:`,w),typeof window.aipkit_vpp_updateProgressItem=="function"){let S=w?.message||e.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(_,"error",S,E)}}}let g=`Indexing complete. ${d} successful, ${u} failed.`;window.aipkit_isIndexingStopped&&p<t?g=`Indexing stopped. ${d} successful, ${u} failed.`:u>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,u>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${d}/${t}`)}catch(m){console.error("VPP Pinecone Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,e.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),u>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=a,window.aipkit_vpp_startIndexingPinecone=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function a(){let i=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),s=document.getElementById("aipkit_vpp_qdrant_collection_status"),n=window.aipkit_vpp_config||{},c=n.text||{},l=n.qdrant_collections||[];if(!i){console.error("VPP Qdrant Provider: Collection select not found.");return}i.innerHTML="",s&&(s.textContent=""),l.length>0?(i.appendChild(new Option(`-- ${k(c.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),l.forEach(o=>{let e=o.name||o.id;e&&i.appendChild(new Option(k(e),e))})):i.appendChild(new Option(k(c.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),i.disabled=l.length===0}async function r(i,s,n,c,l){let o=window.aipkit_vpp_config||{},e=o.text||{},t=i.length,p=0,d=0,u=0,f=[];try{let m=o.nonce_index_posts;if(!m)throw new Error("Nonce for indexing posts is missing in config.");for(let _ of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}p++;let h=document.querySelector(`#post-${_}`),y=h?h.querySelector(".title .row-title"):null,E=y?y.textContent.trim():`Post #${_}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(_,"processing","",E),typeof window.aipkit_vpp_updateProgress=="function"){let w=p/t*100,S=(e.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",p).replace("%2$d",t)+` "${k(E)}"`;window.aipkit_vpp_updateProgress(w,S)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let x={_ajax_nonce:m,post_ids:[_],post_type:l,target_collection_name:s,provider:"qdrant",embedding_provider:n,embedding_model:c};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",x),d++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(_,"success","",E)}catch(w){if(u++,f.push({id:_,title:E,error:w.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${_}:`,w),typeof window.aipkit_vpp_updateProgressItem=="function"){let S=w?.message||e.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(_,"error",S,E)}}}let g=`Indexing complete. ${d} successful, ${u} failed.`;window.aipkit_isIndexingStopped&&p<t?g=`Indexing stopped. ${d} successful, ${u} failed.`:u>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,u>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${d}/${t}`)}catch(m){console.error("VPP Qdrant Provider: Indexing error:",m),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,e.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),u>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=a,window.aipkit_vpp_startIndexingQdrant=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(v){return v},a="#aipkit_vpp_modal",r=["#aipkit_vpp_vector_store_provider","#aipkit_vpp_openai_vector_store_id","#aipkit_vpp_pinecone_target_index_select","#aipkit_vpp_qdrant_target_collection_select","#aipkit_vpp_embedding_model_select"].join(", "),i=null,s=null,n=!1,c=new Set(["aipkit_vpp_vector_store_provider"]),l=v=>!!(v&&v.id&&c.has(v.id)),o=v=>String(v||"").trim().toLowerCase(),e=(v,A)=>{if(!v)return;let C="aipkit_settings_select_picker_icon--";v.classList.forEach(L=>{L.startsWith(C)&&v.classList.remove(L)}),v.classList.remove("is-hidden");let b=o(A);if(!b){v.classList.add("is-hidden");return}v.classList.add(`${C}${b}`)},t=v=>{if(!v)return"";let A=v.getAttribute("data-aipkit-picker-title");if(A)return A;let C=v.id&&document.querySelector(`label[for="${v.id}"]`)||v.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return C?C.textContent.trim():""},p=v=>{if(!v)return"";let A=v.selectedOptions&&v.selectedOptions.length?v.selectedOptions[0]:v.querySelector("option[selected]");if(A)return A.textContent.trim();let C=v.querySelector("option");return C?C.textContent.trim():""},d=v=>({buttonId:`${v}_picker_btn`,labelId:`${v}_picker_label`,popoverId:`${v}_picker_popover`,titleId:`${v}_picker_title`,searchId:`${v}_picker_search`,listId:`${v}_picker_list`}),u=(v,A)=>{if(!v||!v.id||!A)return null;let C=d(v.id),b=A.querySelector(`#${C.buttonId}`);if(!b){if(b=document.createElement("button"),b.type="button",b.id=C.buttonId,b.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",b.setAttribute("data-aipkit-popover-target",C.popoverId),b.setAttribute("aria-controls",C.popoverId),b.setAttribute("aria-expanded","false"),b.dataset.aipkitPopoverPlacement="bottom",l(v)){b.classList.add("aipkit_settings_select_picker_btn--provider");let W=document.createElement("span");W.className="aipkit_settings_select_picker_icon",W.setAttribute("aria-hidden","true"),e(W,v.value),b.appendChild(W)}let B=document.createElement("span");B.className="aipkit_settings_select_picker_label",B.id=C.labelId,B.textContent=p(v)||k("Select","gpt3-ai-content-generator");let $=document.createElement("span");$.className="dashicons dashicons-arrow-down-alt2",$.setAttribute("aria-hidden","true"),b.appendChild(B),b.appendChild($),v.insertAdjacentElement("beforebegin",b)}b.disabled=v.disabled,v.classList.contains("screen-reader-text")||v.classList.add("screen-reader-text");let L=A.querySelector(`#${C.popoverId}`);if(!L){L=document.createElement("div"),L.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",l(v)&&L.classList.add("aipkit_settings_select_picker_popover--provider"),L.id=C.popoverId,L.setAttribute("aria-hidden","true");let B=document.createElement("div");B.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",B.setAttribute("role","dialog"),B.setAttribute("aria-labelledby",C.titleId);let $=document.createElement("div");$.className="aipkit_model_settings_popover_header";let W=document.createElement("span");W.className="aipkit_model_settings_popover_title",W.id=C.titleId,W.textContent=t(v)||k("Select","gpt3-ai-content-generator");let U=document.createElement("button");U.type="button",U.className="aipkit_model_settings_popover_close",U.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),U.innerHTML='<span class="dashicons dashicons-no-alt"></span>',$.appendChild(W),$.appendChild(U);let D=document.createElement("div");D.className="aipkit_model_settings_popover_body";let H=document.createElement("div");H.className="aipkit_settings_select_picker_search";let Q=document.createElement("input");Q.type="search",Q.id=C.searchId,Q.className="aipkit_form-input";let F=t(v),P=F?`Search ${F.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");Q.setAttribute("placeholder",P),H.appendChild(Q);let R=document.createElement("div");R.className="aipkit_settings_select_picker_list",R.id=C.listId,R.setAttribute("role","listbox"),D.appendChild(H),D.appendChild(R),B.appendChild($),B.appendChild(D),L.appendChild(B),A.appendChild(L),(l(v)||v.dataset.aipkitPickerSearch==="false")&&(H.style.display="none")}return{ids:C,button:b,popover:L,label:A.querySelector(`#${C.labelId}`),search:A.querySelector(`#${C.searchId}`),list:A.querySelector(`#${C.listId}`)}},f=v=>{let A=[];return v&&Array.from(v.children).forEach(b=>{if(b.tagName==="OPTGROUP"){let L=Array.from(b.children).filter(B=>B.tagName==="OPTION").map(B=>({value:B.value,label:B.textContent.trim(),disabled:B.disabled,selected:B.selected}));A.push({groupLabel:b.label||"",options:L})}else b.tagName==="OPTION"&&A.push({groupLabel:"",options:[{value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}]})}),A},m=(v,A,C="")=>{if(!v||!A)return;let b=C.trim().toLowerCase();A.innerHTML="";let L=f(v),B=!1;if(L.forEach($=>{let W=$.options.filter(U=>b?U.label.toLowerCase().includes(b):!0);if(W.length){if($.groupLabel){let U=document.createElement("div");U.className="aipkit_settings_select_picker_group_label",U.textContent=$.groupLabel,A.appendChild(U)}W.forEach(U=>{let D=document.createElement("button");if(D.type="button",D.className="aipkit_settings_select_picker_item",D.setAttribute("role","option"),D.dataset.value=U.value,D.dataset.label=U.label,U.disabled&&(D.classList.add("is-disabled"),D.setAttribute("aria-disabled","true")),v.value===U.value?(D.classList.add("is-active"),D.setAttribute("aria-selected","true")):D.setAttribute("aria-selected","false"),l(v)){D.classList.add("aipkit_settings_select_picker_item--provider");let F=document.createElement("span");F.className="aipkit_settings_select_picker_icon",F.setAttribute("aria-hidden","true"),e(F,U.value),D.appendChild(F)}let H=document.createElement("span");H.className="aipkit_settings_select_picker_text",H.textContent=U.label;let Q=document.createElement("span");Q.className="dashicons dashicons-yes aipkit_settings_select_picker_check",D.appendChild(H),D.appendChild(Q),A.appendChild(D),B=!0})}}),!B){let $=document.createElement("div");$.className="aipkit_settings_select_picker_empty",$.textContent=k(b?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild($)}},g=(v,A,C)=>{if(!v||!A)return;let b=p(v);if(A.textContent=b||k("Select","gpt3-ai-content-generator"),C&&(C.disabled=v.disabled),l(v)){let L=C?C.querySelector(".aipkit_settings_select_picker_icon"):null;e(L,v.value)}},_=(v,A)=>{if(!v||!A)return;let C=v.getBoundingClientRect(),b=A.getBoundingClientRect(),L=b.width||320,B=b.height||0,$=window.innerWidth,W=window.innerHeight,U=12,D=C.left;D+L>$-U&&(D=C.right-L),D=Math.max(U,Math.min(D,$-L-U));let H=C.bottom+8;H+B>W-U&&(H=C.top-B-8),H=Math.max(U,Math.min(H,W-B-U)),A.style.left=`${Math.round(D)}px`,A.style.top=`${Math.round(H)}px`},h=()=>{!i||!s||n||(n=!0,window.requestAnimationFrame(()=>{let v=i.querySelector(".aipkit_model_settings_popover_panel");_(s,v),n=!1}))},y=()=>{i&&(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),s&&s.setAttribute("aria-expanded","false"),i=null,s=null)},E=(v,A,C)=>{if(!v||!A)return;i&&i!==A&&y(),i=A,s=v,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),v.setAttribute("aria-expanded","true");let b=A.querySelector(".aipkit_settings_select_picker_search input"),L=A.querySelector(".aipkit_settings_select_picker_list");L&&m(C,L,b?b.value:""),b&&b.offsetParent!==null&&(b.focus(),b.select());let B=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{_(v,B)})},x=(v,A)=>{if(!v||!A)return;let{button:C,popover:b,list:L,search:B,label:$}=A;if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",W=>{if(W.preventDefault(),!C.disabled){if(i===b){y();return}E(C,b,v)}}),C.dataset.pickerListenerAttached="true"),b&&b.dataset.overlayListenerAttached!=="true"){b.addEventListener("click",U=>{U.target===b&&y()});let W=b.querySelector(".aipkit_model_settings_popover_close");W&&W.addEventListener("click",U=>{U.preventDefault(),y()}),b.dataset.overlayListenerAttached="true"}if(L&&L.dataset.pickerListenerAttached!=="true"&&(L.addEventListener("click",W=>{let U=W.target.closest(".aipkit_settings_select_picker_item");if(!U||U.classList.contains("is-disabled"))return;let D=U.dataset.value??"";v.value=D,v.dispatchEvent(new Event("change",{bubbles:!0})),g(v,$,C),m(v,L,B?B.value:""),y()}),L.dataset.pickerListenerAttached="true"),B&&B.dataset.pickerListenerAttached!=="true"&&(B.addEventListener("input",()=>{m(v,L,B.value)}),B.dataset.pickerListenerAttached="true"),v&&v.dataset.pickerListenerAttached!=="true"&&(v.addEventListener("change",()=>{g(v,$,C),m(v,L,B?B.value:""),i===b&&y()}),v.dataset.pickerListenerAttached="true"),v&&v.dataset.pickerObserverAttached!=="true"){let W=!1;new MutationObserver(()=>{W||(W=!0,window.requestAnimationFrame(()=>{g(v,$,C),m(v,L,B?B.value:""),W=!1}))}).observe(v,{childList:!0,subtree:!0}),v.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitVppPickerEscapeBound||(document.addEventListener("keydown",W=>{W.key==="Escape"&&i&&y()}),document.body.dataset.aipkitVppPickerEscapeBound="true"),document.body.dataset.aipkitVppPickerRepositionBound||(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),document.body.dataset.aipkitVppPickerRepositionBound="true")};function w(v){if(!v||v.dataset.aipkitVppPickerInit==="true")return;let A=v.querySelectorAll(r);A.length&&(A.forEach(C=>{if(!C.id||C.dataset.aipkitPickerInit==="true")return;let b=u(C,v);b&&(g(C,b.label,b.button),m(C,b.list,b.search?b.search.value:""),x(C,b),C.dataset.aipkitPickerInit="true")}),v.dataset.aipkitVppPickerInit="true")}function S(){document.querySelectorAll(a).forEach(w)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S(),new MutationObserver(S).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initVppSelectPickers=w})();(function(){"use strict";let k="aipkit_vpp_modal",a=window.aipkit_escapeHtml||function(y){return y},r=window.aipkit_escapeAttribute||a,i=[],s="",n=!1,c=y=>{if(!y)return"Post";let E=window.aipkit_vpp_postTitles||{};if(E[y])return E[y];let x=document.querySelector(`#post-${y}`),w=x?x.querySelector(".title .row-title")||x.querySelector("strong a")||x.querySelector(".title a")||x.querySelector("a.row-title")||x.querySelector(".column-title strong a")||x.querySelector(".column-title .row-title"):null,S=w?w.textContent.trim():`Post #${y}`;return E[y]=S,window.aipkit_vpp_postTitles=E,S},l=y=>{let E=window.aipkit_vpp_config?.text||{};return{pending:E.status_pending||"Pending",processing:E.status_processing||"Processing",success:E.status_completed||"Completed",error:E.status_failed||"Failed",stopped:E.status_stopped||"Stopped"}[y]||y},o=(y,E)=>{let x=document.createElement("div");x.className="aipkit_vpp_progress_item aipkit_vpp_progress_item--pending",x.dataset.postId=y;let w=document.createElement("div");w.className="aipkit_vpp_progress_item_main";let S=document.createElement("div");S.className="aipkit_vpp_progress_item_title",S.textContent=E;let T=document.createElement("div");T.className="aipkit_vpp_progress_item_message",T.textContent="",T.style.display="none";let v=document.createElement("div");return v.className="aipkit_vpp_progress_item_status",v.textContent=l("pending"),w.appendChild(S),w.appendChild(T),x.appendChild(w),x.appendChild(v),x};function e(y,E){if(document.getElementById(k)){console.warn("VPP Modal UI: Modal already exists.");return}i=y,s=E,n=!1;let w=(window.aipkit_vpp_config||{}).text||{},S="",T=y.length;T===1?S=a(w.items_selected_singular||"You have selected %d item to index.").replace("%d",`<strong>${T}</strong>`):S=a(w.items_selected_plural||"You have selected %d items to index.").replace("%d",`<strong>${T}</strong>`);let v=document.createElement("div");v.id=k,v.className="aipkit-modal-overlay aipkit-active";let A=document.createElement("div");A.className="aipkit-modal-content aipkit_vpp_modal_content",A.innerHTML=`
            <div class="aipkit-modal-header aipkit_vpp_modal_header">
                <div class="aipkit_vpp_header_left">
                    <span class="aipkit_vpp_header_icon" aria-hidden="true">
                        <span class="dashicons dashicons-database"></span>
                    </span>
                    <div class="aipkit_vpp_header_text">
                        <h3 class="aipkit-modal-title">${a(w.modal_title||"Add Content to Vector Store")}</h3>
                        <span class="aipkit_vpp_header_subtitle">${a(w.modal_subtitle||"Index selected content for retrieval")}</span>
                    </div>
                </div>
                <button type="button" class="aipkit-modal-close-btn aipkit_vpp_close_btn" aria-label="${r(w.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body aipkit_vpp_modal_body">
                <div id="aipkit_vpp_status_message" class="aipkit_vpp_status_message" aria-live="polite"></div>

                <div class="aipkit_vpp_selection_card">
                    <span class="aipkit_vpp_selection_text">${S}</span>
                </div>

                <div class="aipkit_vpp_engine_card">
                    <div class="aipkit_enhancer_engine_card">
                        <div class="aipkit_enhancer_engine_fields">
                            <div class="aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_vector_store_provider">${a(w.provider_label||"Provider")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_vector_store_provider" class="aipkit_enhancer_engine_select">
                                            <option value="openai" selected>OpenAI</option>
                                            <option value="pinecone">Pinecone</option>
                                            <option value="qdrant">Qdrant</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_openai_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_openai_vector_store_id">${a(w.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_enhancer_engine_select">
                                            <option value="">${a(w.loading_stores||"Loading stores...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_pinecone_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_pinecone_target_index_select">${a(w.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${a(w.loading_indexes||"Loading indexes...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_qdrant_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_qdrant_target_collection_select">${a(w.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${a(w.loading_indexes||"Loading collections...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_embedding_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_embedding_model_select">${a(w.embedding_label||"Embedding")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_embedding_model_select" class="aipkit_enhancer_engine_select" data-aipkit-picker-search="false">
                                            <option value="">${a(w.select_model||"-- Select Model --")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="aipkit_vpp_progress_area" class="aipkit_vpp_section aipkit_vpp_section--progress" hidden>
                    <div class="aipkit_vpp_section_header">
                        <span class="aipkit_vpp_section_title">${a(w.section_progress_title||"Progress")}</span>
                    </div>
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <div id="aipkit_vpp_progress_text" class="aipkit_vpp_progress_text"></div>
                    <div id="aipkit_vpp_progress_log" class="aipkit_vpp_progress_log" role="list"></div>
                </div>
            </div>
            <div class="aipkit-modal-footer aipkit_vpp_modal_footer">
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${a(w.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" hidden></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                     <span class="aipkit_btn-text">${a(w.stop||"Stop")}</span>
                </button>
            </div>
        `,v.appendChild(A),document.body.appendChild(v),A.addEventListener("click",b=>{let L=b.target;L.closest(".aipkit-modal-close-btn")||L.closest(".aipkit_vpp_modal_close_btn")?p():L.closest("#aipkit_vpp_start_indexing_btn")?h():L.closest("#aipkit_vpp_stop_indexing_btn")&&t()}),v.addEventListener("click",b=>{b.target===v&&p()});let C=document.getElementById("aipkit_vpp_vector_store_provider");C&&(C.addEventListener("change",_),_({target:C}))}function t(){window.aipkit_isIndexingStopped=!0;let y=document.getElementById("aipkit_vpp_stop_indexing_btn"),E=window.aipkit_vpp_config?.text||{};if(y){y.disabled=!0;let x=y.querySelector(".aipkit_btn-text");x&&(x.textContent=E.stopping||"Stopping...")}}function p(){window.aipkit_isIndexingStopped=!0;let y=document.getElementById(k);y&&(y.classList.remove("aipkit-active"),setTimeout(()=>{y.parentNode&&y.parentNode.removeChild(y)},300))}function d(y,E){let x=document.querySelector(`#${k} .aipkit_vpp_progress_bar`),w=document.getElementById("aipkit_vpp_progress_text");x&&(x.style.width=`${Math.max(0,Math.min(100,y))}%`),w&&(w.textContent=E)}function u(y){let E=document.getElementById("aipkit_vpp_progress_log");if(!E)return;E.innerHTML="";let x=document.createDocumentFragment();(y||[]).forEach(w=>{let S=c(w);x.appendChild(o(w,S))}),E.appendChild(x),E.scrollTop=0}function f(y,E,x="",w=""){let S=document.getElementById("aipkit_vpp_progress_log");if(!S)return;let T=`.aipkit_vpp_progress_item[data-post-id="${y}"]`,v=S.querySelector(T);if(!v){let b=w||c(y);v=o(y,b),S.appendChild(v)}v.className=`aipkit_vpp_progress_item aipkit_vpp_progress_item--${E}`;let A=v.querySelector(".aipkit_vpp_progress_item_status"),C=v.querySelector(".aipkit_vpp_progress_item_message");A&&(A.textContent=l(E)),C&&(C.textContent=x||"",C.style.display=x?"":"none"),S.scrollTop=S.scrollHeight}function m(y,E="info"){let x=document.getElementById("aipkit_vpp_status_message");x&&(x.textContent=y,x.className=`aipkit_vpp_status_message aipkit_message-${E}`)}function g(){n=!1;let y=document.getElementById("aipkit_vpp_start_indexing_btn"),E=document.getElementById("aipkit_vpp_stop_indexing_btn"),x=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`),w=window.aipkit_vpp_config?.text||{};if(y){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(y,w.start_indexing||"Start Indexing"),y.disabled=!1,y.hidden=!1;let T=y.querySelector(".aipkit_spinner");T&&(T.hidden=!0)}if(E){E.hidden=!0,E.disabled=!1;let T=E.querySelector(".aipkit_btn-text");T&&(T.textContent=w.stop||"Stop")}x.forEach(T=>T.disabled=!1);let S=document.getElementById("aipkit_vpp_progress_area");S&&(S.hidden=!1)}function _(y){let E=y.target.value,x=document.getElementById("aipkit_vpp_openai_options"),w=document.getElementById("aipkit_vpp_pinecone_options"),S=document.getElementById("aipkit_vpp_qdrant_options"),T=document.getElementById("aipkit_vpp_embedding_options");x&&(x.hidden=!0),w&&(w.hidden=!0),S&&(S.hidden=!0),T&&(T.hidden=!0),E==="openai"?(x&&(x.hidden=!1),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):E==="pinecone"?(w&&(w.hidden=!1),T&&(T.hidden=!1),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):E==="qdrant"&&(S&&(S.hidden=!1),T&&(T.hidden=!1),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function h(){if(n)return;window.aipkit_isIndexingStopped=!1;let y=document.getElementById("aipkit_vpp_vector_store_provider").value,E=window.aipkit_vpp_config?.text||{},x="",w={post_ids:i,post_type:s,provider:y};if(y==="openai"){if(x=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!x){m(E.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}w.target_store_id=x}else if(y==="pinecone"){if(x=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!x){m(E.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}w.target_index_id=x;let C=document.getElementById("aipkit_vpp_embedding_model_select"),b=C?.selectedOptions&&C.selectedOptions.length?C.selectedOptions[0]:null;if(w.embedding_model=C?C.value:"",w.embedding_provider=b&&b.dataset.provider||"",!w.embedding_provider||!w.embedding_model){m(E.error_no_embedding_config||"Please select an embedding model for Pinecone.","error");return}}else if(y==="qdrant"){if(x=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!x){m(E.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}w.target_collection_name=x;let C=document.getElementById("aipkit_vpp_embedding_model_select"),b=C?.selectedOptions&&C.selectedOptions.length?C.selectedOptions[0]:null;if(w.embedding_model=C?C.value:"",w.embedding_provider=b&&b.dataset.provider||"",!w.embedding_provider||!w.embedding_model){m(E.error_no_embedding_config||"Please select an embedding model for Qdrant.","error");return}}else{m(`Provider ${y} not yet supported for indexing.`,"error");return}n=!0;let S=document.getElementById("aipkit_vpp_start_indexing_btn"),T=document.getElementById("aipkit_vpp_stop_indexing_btn"),v=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`);if(S&&(S.hidden=!0),T){T.hidden=!1,T.disabled=!1;let C=T.querySelector(".aipkit_btn-text");C&&(C.textContent=E.stop||"Stop")}let A=document.getElementById("aipkit_vpp_progress_area");A&&(A.hidden=!1),typeof window.aipkit_vpp_initProgressLog=="function"&&window.aipkit_vpp_initProgressLog(i),d(0,E.status_preparing||"Preparing..."),y==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(i,x,null,s):y==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(i,x,w.embedding_provider,w.embedding_model,s):y==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(i,x,w.embedding_provider,w.embedding_model,s)}window.aipkit_vpp_showModal=e,window.aipkit_vpp_closeModal=p,window.aipkit_vpp_updateProgress=d,window.aipkit_vpp_initProgressLog=u,window.aipkit_vpp_updateProgressItem=f,window.aipkit_vpp_updateStatus=m,window.aipkit_vpp_resetModalAfterProcessing=g})();(function(){"use strict";let k="aipkit_add_to_vector_store_btn";function r(){let n=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(n.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let c=Array.from(n).map(l=>l.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(c,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function i(){let n=document.getElementById(k);return n&&!n.dataset.vppBound?(n.addEventListener("click",r),n.dataset.vppBound="1",!0):!!(n&&n.dataset.vppBound)}function s(){if(i())return;let n=document.querySelector("#wpbody-content")||document.body,c=Date.now();if(!n)return;let l=new MutationObserver(()=>{(i()||Date.now()-c>15e3)&&l.disconnect()});l.observe(n,{childList:!0,subtree:!0});let o=setInterval(()=>{(i()||Date.now()-c>15e3)&&clearInterval(o)},300)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",s):s()})();})();
