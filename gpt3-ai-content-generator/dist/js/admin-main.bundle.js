(()=>{(function(){"use strict";function k(r,i){if(!r)return;let a=r.querySelector(".aipkit_btn-text");if(a){a.textContent=i;return}let s=r.querySelector(".aipkit_spinner"),l=Array.from(r.childNodes).find(c=>c.nodeType===Node.TEXT_NODE);l?l.textContent=i+(s?" ":""):r.insertBefore(document.createTextNode(i+(s?" ":"")),r.firstChild),s&&r.appendChild(s)}function o(r,i,a,s=4e3){if(!r)return;let l=r.dataset.baseClass||"aipkit_form-help";r.dataset.baseClass||(r.dataset.baseClass=l),r.messageTimeoutId&&(clearTimeout(r.messageTimeoutId),r.messageTimeoutId=null),r.textContent=a,r.className=l,r.classList.add(`aipkit_form-help-${i}`),r.style.opacity="1",r.style.display="block",r.messageTimeoutId=setTimeout(()=>{r.style.opacity="0",setTimeout(()=>{r.textContent===a&&(r.textContent="",r.className=l,r.style.display="",r.messageTimeoutId=null)},300)},s)}window.aipkit_setButtonText=k,window.aipkit_showTemporaryMessage=o})();(function(){"use strict";function k(r){return r===null||typeof r>"u"?"":String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function o(r){return k(r)}window.aipkit_escapeHtml=k,window.aipkit_escapeAttribute=o})();(function(){"use strict";function k(r){let i=document.createElement("div");if(i.textContent="Copied!",Object.assign(i.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:1000005,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)",pointerEvents:"none"}),document.body.appendChild(i),r){let{top:a,left:s,width:l}=r.getBoundingClientRect(),c=a+window.scrollY+2,n=s+window.scrollX+l+5;i.style.top=`${c}px`,i.style.left=`${n}px`;let e=i.getBoundingClientRect(),t=8,d=window.innerWidth-t;if(e.right>d){let _=s+window.scrollX-e.width-5,p=Math.max(window.scrollX+t,_);i.style.left=`${p}px`}}else i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateY(0)"}),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateY(-5px)",i.addEventListener("transitionend",()=>i.remove(),{once:!0}),setTimeout(()=>{i.parentNode&&i.remove()},500)},1e3)}async function o(r,i){if(r)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(r),k(i);return}throw new Error("Clipboard API not available")}catch(a){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",a);try{let s=document.createElement("textarea");s.value=r,s.style.position="fixed",s.style.top="-9999px",s.style.left="-9999px",s.style.opacity="0",s.setAttribute("readonly",""),document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999);let l=document.execCommand("copy");if(document.body.removeChild(s),l)k(i);else throw new Error('document.execCommand("copy") failed.')}catch(s){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",s),window.prompt("Please copy the shortcode manually:",r)}}}window.aipkit_copyShortcode=o})();(function(){"use strict";function k(a){let s=Number(a);if(!s||isNaN(s))return"";try{let l=new Date(s*1e3);if(isNaN(l.getTime()))return"";let c=String(l.getHours()).padStart(2,"0"),n=String(l.getMinutes()).padStart(2,"0"),e=String(l.getSeconds()).padStart(2,"0");return`${c}:${n}:${e}`}catch(l){return console.error("Error formatting timestamp:",a,l),""}}function o(a){if(!a)return"";try{let s=new Date(a.replace(" ","T")+"Z");if(isNaN(s.getTime()))return"";let l=new Date,c=(s.getTime()-l.getTime())/1e3;if(c<0)return"In the past";if(c<60)return"in less than a minute";if(c<3600){let d=Math.round(c/60);return`in ${d} minute${d!==1?"s":""}`}let n=new Date(l.getFullYear(),l.getMonth(),l.getDate()),e=new Date(l.getFullYear(),l.getMonth(),l.getDate()+1),t=new Date(s.getFullYear(),s.getMonth(),s.getDate());return t.getTime()===n.getTime()?`Today at ${s.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:t.getTime()===e.getTime()?`Tomorrow at ${s.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${s.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(s){return console.error("Error formatting relative time:",a,s),a}}function r(a){if(!a)return"N/A";try{let s=new Date(a.replace(" ","T")+"Z");return isNaN(s.getTime())?"Invalid Date":s.toLocaleString()}catch(s){return console.error("Error formatting UTC date string:",a,s),a}}function i(a){if(!a)return"N/A";try{let s=new Date(a.replace(" ","T")+"Z");if(isNaN(s.getTime()))return"Invalid Date";let l=Math.floor((Date.now()-s.getTime())/1e3);if(Number.isNaN(l)||l<0)return s.toLocaleString();if(l<60)return"Just now";let c=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],n=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let e of c)if(l>=e.seconds){let t=Math.floor(l/e.seconds);return n?n.format(-t,e.unit):`${t} ${e.unit}${t!==1?"s":""} ago`}return s.toLocaleString()}catch(s){return console.error("Error formatting relative date string:",a,s),a}}window.aipkit_formatTimestamp=k,window.aipkit_formatFriendlyFutureDate=o,window.aipkit_formatUtcDateTime=r,window.aipkit_formatRelativeDateTime=i})();(function(){"use strict";function k(o){return!o||typeof o!="string"?"":o.charAt(0).toUpperCase()+o.slice(1)}window.aipkit_ucfirst=k,window.ucfirst=k})();(function(){"use strict";function k(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let o=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&o.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=o,o}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=k})();(function(){"use strict";function k(o,r="",i="",a={}){if(!o)return"N/A";let s=o.toLowerCase();if(s.includes("text content submitted for indexing"))return"Text";if(s.includes("file content submitted for indexing")||s.includes("file content embedded and upserted")||s.includes("original filename:"))return"File Upload";if(s.includes("wordpress post content submitted for indexing"))return"Site Content";if(i==="openai")return"N/A";if(i==="pinecone"&&s.includes("vectors upserted")){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("pinecone_file_")||r.includes("file_"))return"File Upload"}if(i==="qdrant"){if(s.includes("points upserted to qdrant"))return a.post_id||s.includes("post id:")?"Site Content":"Text";if(s.includes("wordpress post content submitted for indexing"))return"Site Content"}if(r&&i==="pinecone"){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("file_")||r.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=k})();(function(){"use strict";async function k(i){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",i)}async function o(i,a){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));i.set("action",a);try{let c=i.get("provider")||"openai",n=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null,e=n?i.get(n):null;if(e&&typeof e.size=="number"){let t=["text/plain","text/csv","application/json","text/json","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/csv","text/comma-separated-values"],d=Array.isArray(window.aipkit_uploadLimits?.allowed_mime_types)&&window.aipkit_uploadLimits.allowed_mime_types.length?window.aipkit_uploadLimits.allowed_mime_types:t,_=Number(window.aipkit_effectiveUploadLimitBytes||0);(!Number.isFinite(_)||_<=0)&&(_=10*1024*1024),c==="openai"&&(_=Math.min(_,10*1024*1024));let p=[];if(e.size>_&&p.push(`File is too large (${r(e.size)}). Max allowed is ${r(_)}.`),e.type&&!d.map(f=>f.toLowerCase()).includes(String(e.type).toLowerCase())&&p.push(`Unsupported file type (${e.type}). Allowed: ${d.join(", ")}.`),p.length){let f=new Error(p.join(" "));throw f.code="client_validation_failed",f}}}catch(c){throw console.warn("[AIPKit] Client-side file validation failed",c),c}let s;try{let c=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null;if(c)try{let n=i.get(c);n&&console.debug("[AIPKit] File upload request",{action:a,fileField:c,name:n.name,size_bytes:n.size,type:n.type})}catch{}s=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:i,credentials:"same-origin"})}catch(c){throw console.error("[AIPKit] Network error during file upload",{action:a,error:c}),c}let l;try{l=await s.json()}catch(c){console.error("[AIPKit] Failed to parse JSON response for file upload",{action:a,status:s?.status,parseErr:c});let n=new Error(`Unexpected server response (status ${s?.status||"n/a"})`);throw n.status=s?.status,n}if(!s.ok||!l.success){let c=l?.data||{},n=new Error(c.message||`HTTP error! status: ${s.status}`);throw n.code=c.code,n.status=s.status,n.details=c.details||void 0,n.serverResponse=l,console.error("[AIPKit] File upload failed",{action:a,status:s.status,server:l}),n}return l.data}function r(i){if(!Number.isFinite(i))return`${i}`;let a=["B","KB","MB","GB"],s=0,l=i;for(;l>=1024&&s<a.length-1;)l/=1024,s++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:n=>n.toFixed(1)}).format(l)} ${a[s]}`}window.aipkit_api_upsertOpenAIText=k,window.aipkit_api_upsertFile=o})();(function(){"use strict";function k(o){let r=document.querySelector(o);if(!r)return;r.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(a=>{let s=a.id+"_value",l=null,c=a.closest(".aipkit_slider_wrapper");if(c&&(l=c.querySelector(".aipkit_slider_value")),!l)try{l=r.querySelector(`#${CSS.escape(s)}`)}catch{l=r.querySelector("#"+s)}if(l){let n=a.getAttribute("data-suffix")||(a.id.includes("confidence_threshold")?"%":"");l.textContent=a.value+n,a.hasAttribute("data-range-listener-attached")||(a.addEventListener("input",function(){l.textContent=this.value+n}),a.setAttribute("data-range-listener-attached","true"))}})}window.aipkit_attachRangeValueHandlers=k})();(function(){"use strict";function k(o){let r=document.querySelector(o);if(!r)return;let i="data-apikey-toggle-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(a){let s=a.target.closest(".aipkit_api-key-toggle");if(!s)return;let l=s.closest(".aipkit_api-key-wrapper");if(!l)return;let c=l.querySelector(".aipkit_form-input"),n=s.querySelector(".dashicons");!c||!n||(c.type==="password"?(c.type="text",n.classList.remove("dashicons-visibility"),n.classList.add("dashicons-hidden")):(c.type="password",n.classList.remove("dashicons-hidden"),n.classList.add("dashicons-visibility")))}),r.setAttribute(i,"true"))}window.aipkit_initApiKeyToggles=k})();(function(){"use strict";function k(o,r,i="Submit",a="Processing..."){if(!o)return;let s=o.querySelector(".aipkit_btn-text")||o.querySelector(".aipkit_btn_text"),l=o.querySelector(".aipkit_spinner"),c=o.querySelector(".dashicons");if(r){if(o.disabled=!0,!o.dataset.originalText)if(s)o.dataset.originalText=s.textContent;else{let e="";o.childNodes.forEach(t=>{t.nodeType===Node.TEXT_NODE&&(e+=t.textContent.trim())}),o.dataset.originalText=e.trim()}c&&(c.dataset.originalDisplay||(c.dataset.originalDisplay=c.style.display||"inline-block"),c.style.display="none");let n=i===""?"":o.dataset.loadingText||a;s?(o.dataset.originalText||(o.dataset.originalText=s.textContent),s.textContent=n):(!c||c.style.display==="none")&&n&&(Array.from(o.childNodes).forEach(e=>{e.nodeType===Node.TEXT_NODE&&e.remove()}),n&&o.insertBefore(document.createTextNode(n),o.firstChild)),l&&(l.style.display="inline-block")}else{o.disabled=!1;let n=i===""?"":o.dataset.originalText||i;c&&c.dataset.originalDisplay&&(c.style.display=c.dataset.originalDisplay,delete c.dataset.originalDisplay),s?s.textContent=n:i!==""&&(Array.from(o.childNodes).forEach(e=>{e.nodeType===Node.TEXT_NODE&&e.remove()}),n&&(c?c.insertAdjacentText("afterend"," "+n):o.insertBefore(document.createTextNode(n),o.firstChild))),l&&(l.style.display="none"),delete o.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=k})();(function(){"use strict";function k(o,r="info",i="aipkit_knowledge_base_global_status"){let a=document.getElementById(i);if(!a)return;a.messageTimeoutId&&clearTimeout(a.messageTimeoutId),a.messageTimeoutId=null;let s=o?String(o).trim():"";if(s===""){a.textContent="",a.className="aipkit_form-help",a.style.display="none",a.style.opacity="0",a.classList.remove("aipkit-active");return}let l=a.classList.contains("aipkit_settings_message-error"),c=r;l&&r!=="error"&&(c="error"),a.className="aipkit_form-help",c==="success"?a.classList.add("aipkit_settings_message-success"):c==="error"?a.classList.add("aipkit_settings_message-error"):a.classList.add("aipkit_settings_message-info"),c==="error"&&a.textContent||l&&r!=="error"&&a.textContent?a.textContent=a.textContent+`
`+s:a.textContent=s,a.style.display="block",a.style.opacity="1",a.classList.add("aipkit-active"),c!=="error"&&(a.messageTimeoutId=setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{a.textContent.includes(s)&&(a.textContent="",a.className="aipkit_form-help",a.style.display="none",a.classList.remove("aipkit-active"))},300)},5e3))}window.aipkit_showOpenAIVectorStatus=k})();(function(){"use strict";async function k(a,s,l,c){let n=document.getElementById("aipkit_nonce"),e=n&&n.value||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||void 0;return await window.aipkit_apiRequest("aipkit_get_chunk_logs_by_batch",{_ajax_nonce:e,provider:a,store_id:s,batch_id:l,page:c,per_page:10})}function o({snippetText:a="",fileId:s="",provider:l="",batchId:c="",storeId:n=""}={}){let e=window.aipkit_escapeHtml||function(u){return u},t=document.createElement("div");t.className="aipkit-snippet-modal-overlay";let d=document.createElement("div");d.className="aipkit-snippet-modal-content";let _=l?`${l} Indexed Snippet`:"Indexed Snippet",p=s?` (${e(s)})`:"",f=!!c&&!!n&&!!l;d.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${_}${p}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        ${f?`
          <div class="aipkit-chunks-list"></div>
          <div class="aipkit-chunks-pagination" style="margin-top:10px; display:flex; justify-content: space-between; align-items:center;">
            <button class="button button-secondary aipkit-chunks-prev">Prev</button>
            <span class="aipkit-chunks-page-info"></span>
            <button class="button button-secondary aipkit-chunks-next">Next</button>
          </div>
        `:`
          <pre class="aipkit-snippet-modal-content-text">${e(a)}</pre>
        `}
      </div>
    `,t.appendChild(d),document.body.appendChild(t);function g(){t.classList.remove("active"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)}d.querySelector(".aipkit-snippet-modal-close").addEventListener("click",g),t.addEventListener("click",u=>{u.target===t&&g()});function m(u){u.key==="Escape"&&(g(),document.removeEventListener("keydown",m))}if(document.addEventListener("keydown",m),requestAnimationFrame(()=>{t.classList.add("active")}),f){let u=d.querySelector(".aipkit-chunks-list"),w=d.querySelector(".aipkit-chunks-page-info"),h=d.querySelector(".aipkit-chunks-prev"),C=d.querySelector(".aipkit-chunks-next"),x=1,v=1,L=b=>{if(!b||!b.length){u.innerHTML="<p>No chunks found.</p>";return}u.innerHTML=b.map(y=>{let S=y.indexed_content||"",E=y.file_id||"";return`<div class="aipkit-chunk-item" style="margin-bottom:12px;">
            <div class="aipkit-chunk-title" style="font-weight:600; margin-bottom:6px;">${e(E)}</div>
            <pre class="aipkit-chunk-text">${e(S)}</pre>
          </div>`}).join("")};async function P(b){u.innerHTML='<p><span class="aipkit_spinner" style="display:inline-block;"></span> Loading...</p>';try{let y=await k(l,n,c,b);L(y.chunks||[]),x=y.pagination?.current_page||b,v=y.pagination?.total_pages||1,w.textContent=`Page ${x} / ${v}`,h.disabled=x<=1,C.disabled=x>=v}catch(y){u.innerHTML=`<p class="aipkit_text-danger">${y&&y.message||"Failed to load chunks."}</p>`}}h.addEventListener("click",()=>{x>1&&P(x-1)}),C.addEventListener("click",()=>{x<v&&P(x+1)}),P(1)}}function r(a,s,l=""){return o({snippetText:a,fileId:s,provider:l})}function i(a,s=""){a&&a.querySelectorAll(".aipkit_view_snippet_icon").forEach(l=>{let c=l.cloneNode(!0);l.parentNode.replaceChild(c,l),c.addEventListener("click",n=>{n.preventDefault();let e=c.dataset.snippet,t=c.dataset.fileId,d=c.dataset.batchId||"",_=c.dataset.storeId||"";o({snippetText:e,fileId:t,provider:s,batchId:d,storeId:_})})})}window.aipkit_showSnippetModal=r,window.aipkit_showSnippetModalEnhanced=o,window.aipkit_attachSnippetModalListeners=i})();(function(){"use strict";function k(o,r,i){if(!o||!r||typeof i!="function"){r&&(r.innerHTML="");return}r.innerHTML="";let{total_logs:a,total_pages:s,current_page:l}=o,c=parseInt(l,10);if(!a||a<=0||!s||s<=1)return;let n=wp.i18n&&wp.i18n.__?wp.i18n.__:g=>g,e=wp.i18n&&wp.i18n._n?wp.i18n._n:(g,m,u)=>u>1?m:g,t=document.createElement("span");t.className="aipkit_pagination-count",t.textContent=`${a.toLocaleString()} ${e("item","items",a)}`,r.appendChild(t);let d=document.createElement("span");d.className="aipkit_pagination-links";let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML="&laquo; "+n("Previous","gpt3-ai-content-generator"),_.disabled=c<=1,_.disabled||_.addEventListener("click",g=>{g.preventDefault(),i(c-1)}),d.appendChild(_);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${n("Page","gpt3-ai-content-generator")} ${c} ${n("of","gpt3-ai-content-generator")} ${s}`,d.appendChild(p);let f=document.createElement("button");f.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",f.innerHTML=n("Next","gpt3-ai-content-generator")+" &raquo;",f.disabled=c>=s,f.disabled||f.addEventListener("click",g=>{g.preventDefault(),i(c+1)}),d.appendChild(f),r.appendChild(d)}window.aipkit_renderLogsPagination=k})();(function(){"use strict";function k(o){let r=document.querySelector(o);if(!r)return;let i="data-restore-icon-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(a){let s=a.target.closest(".aipkit_restore-default-icon");if(!s)return;let l=s.getAttribute("data-target-input"),c=s.getAttribute("data-default-value");if(!l||c===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",s);return}let n=document.getElementById(l);if(n){if(n.value!==c){n.value=c;let t=new Event("change",{bubbles:!0,cancelable:!0}),d=new Event("blur",{bubbles:!0,cancelable:!0});if(n.dispatchEvent(t),n.dispatchEvent(d),n.type==="range"){let _=document.getElementById(`${l}_value`);_&&(_.textContent=c)}}}else console.warn(`AIPKit Restore Default: Target input element #${l} not found.`)}),r.setAttribute(i,"true"))}window.aipkit_initRestoreDefaultIcons=k})();(function(){"use strict";let k="aipkit_settings_global_messages",o=new Set(["aipkit_settings_messages","aipkit_settings_others_messages"]),r=new Set([k,"aipkit_settings_messages","aipkit_settings_others_messages"]);function i(n){return n?o.has(n)&&document.getElementById(k)?k:n:""}function a(n){!n||!n.parentNode||n.classList.contains("aipkit_message_fadeout")||(n.classList.add("aipkit_message_fadeout"),n.addEventListener("animationend",()=>{n.parentNode&&n.parentNode.removeChild(n)},{once:!0}),setTimeout(()=>{n&&n.parentNode&&n.parentNode.removeChild(n)},500))}function s(n,e,t){let d=i(n),_=document.getElementById(d);if(!_){console.error(`AIPKit Message Handler: Container #${d} not found.`);return}let p=r.has(d);_.querySelectorAll(".aipkit_settings_message").forEach(w=>{w.dataset.timerId&&clearTimeout(parseInt(w.dataset.timerId,10)),w.remove()});let g=_.querySelector(".aipkit_saving-indicator");g&&g.remove();let m=document.createElement("div");if(m.className=`aipkit_settings_message aipkit_settings_message-${e}`,p)m.textContent=t;else{let w=e==="success"?"dashicons-yes-alt":e==="error"?"dashicons-warning":"dashicons-info-alt",h=document.createElement("span");h.className=`dashicons ${w}`,h.style.marginRight="5px",m.appendChild(h),m.appendChild(document.createTextNode(` ${t}`));let C=document.createElement("span");C.className="dashicons dashicons-dismiss aipkit_settings_message-close",C.setAttribute("aria-label","Dismiss message"),C.title="Dismiss message",m.appendChild(C)}if(_.appendChild(m),p){if(e!=="error"){let w=setTimeout(()=>{m&&m.parentNode&&m.parentNode.removeChild(m)},3e3);m.dataset.timerId=w}return}let u=setTimeout(()=>{a(m)},5e3);m.dataset.timerId=u}function l(n){let e=i(n);if(r.has(e))return;let t=document.getElementById(e);if(!t){console.error(`AIPKit Message Handler: Container #${e} not found for close button init.`);return}let d=`data-close-listener-${e}`;t.getAttribute(d)!=="true"&&(t.addEventListener("click",function(_){let p=_.target.closest(".aipkit_settings_message-close");if(p){let f=p.closest(".aipkit_settings_message");f&&(f.dataset.timerId&&clearTimeout(parseInt(f.dataset.timerId,10)),a(f))}}),t.setAttribute(d,"true"))}function c(n){let e=i(n),t=document.getElementById(e);if(t){let d=t.querySelector(".aipkit_saving-indicator");d&&d.remove(),t.querySelectorAll(".aipkit_settings_message").forEach(p=>{p.dataset.timerId&&clearTimeout(parseInt(p.dataset.timerId,10)),p.remove()})}else console.warn(`AIPKit Message Handler: Container #${e} not found for clearing messages.`)}window.aipkit_showMessage=s,window.aipkit_initMessageCloseButtons=l,window.aipkit_clearStatusMessages=c})();(function(){"use strict";function k(i,a){let s=document.getElementById(i);if(!s){console.error(`AIPKit Saving Indicator: Container #${i} not found.`);return}let l=s.querySelector(".aipkit_saving-indicator");if(a)if(!l)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(i):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),l=document.createElement("span"),l.className="aipkit_saving-indicator",l.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',s.appendChild(l),requestAnimationFrame(()=>{let c=s.querySelector(".aipkit_saving-indicator");c&&c.classList.add("aipkit_active")});else{l.style.display="inline-flex",l.classList.add("aipkit_active");let c=l.querySelector(".aipkit_spinner");c&&(c.style.display="inline-block")}else l&&(l.classList.remove("aipkit_active"),setTimeout(()=>{l&&l.parentNode&&l.remove()},200))}function o(i){r(i);let a=document.createElement("span");a.className="aipkit-title-spinner aipkit_spinner",a.style.display="inline-block",i.parentNode.insertBefore(a,i.nextSibling)}function r(i){let a=i.parentNode.querySelector(".aipkit-title-spinner");a&&a.remove()}window.aipkit_showSavingIndicator=k,window.aipkit_showLinkSpinner=o,window.aipkit_hideLinkSpinner=r})();(function(){"use strict";function k(i){let a=i.textContent;i.textContent="Copied!",i.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{i&&i.classList.contains("aipkit-placeholder--copied")&&(i.textContent=a,i.classList.remove("aipkit-placeholder--copied"))},1500)}function o(i){let a=i.target;if(!a.matches(".aipkit-placeholder"))return;i.preventDefault(),i.stopPropagation();let s=a.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(s).then(()=>{k(a)}).catch(l=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",l)})}function r(){let i=document.body;if(i){let a="data-placeholder-copy-listener-attached";i.getAttribute(a)||(i.addEventListener("click",o),i.setAttribute(a,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",r)})();(function(){"use strict";let k="select[data-aipkit-provider-notice-target]",o="a[data-aipkit-load-module]";function r(){let m=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return m&&typeof m=="object"?m:{}}function i(m){window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=m}function a(m){return m?String(m).trim().toLowerCase():""}function s(m,u){return!m||!u||!Object.prototype.hasOwnProperty.call(u,m)?null:!!u[m]}function l(m,u){if(!m)return"";let w=u?m.getAttribute(`data-message-${u}`):"";return w||m.getAttribute("data-message-default")||""}function c(m){m&&m.classList.add("aipkit_provider_notice--hidden")}function n(m){m&&m.classList.remove("aipkit_provider_notice--hidden")}function e(m,u){if(!m)return;let w=m.getAttribute("data-aipkit-provider-notice-target");if(!w)return;let h=document.getElementById(w);if(!h)return;if(m.getAttribute("data-aipkit-provider-notice-defer")==="1"&&m.dataset.aipkitProviderNoticeArmed!=="true"){c(h);return}let x=a(m.value);if(!x){c(h);return}let v=s(x,u);if(v===null){c(h);return}if(v){c(h);return}let L=h.querySelector(".aipkit_provider_notice_message");L&&(L.textContent=l(h,x)),n(h)}function t(m){return m?m.offsetParent!==null?!0:m.getClientRects().length>0:!1}function d(m){let u=r(),w=m||document,h=Array.from(w.querySelectorAll(k)),C=new Map;h.forEach(x=>{let v=x.getAttribute("data-aipkit-provider-notice-target");v&&(C.has(v)||C.set(v,[]),C.get(v).push(x))}),C.forEach(x=>{let v=x.find(t)||x[0];v&&e(v,u)})}function _(){let m={...r()},u=!1,w=W=>{let H=document.getElementById(W);if(H)return u=!0,String(H.value||"").trim()},h=w("aipkit_openai_api_key");h!==void 0&&(m.openai=h!=="");let C=w("aipkit_openrouter_api_key");C!==void 0&&(m.openrouter=C!=="");let x=w("aipkit_google_api_key");x!==void 0&&(m.google=x!=="");let v=w("aipkit_azure_api_key"),L=w("aipkit_azure_endpoint");(v!==void 0||L!==void 0)&&(m.azure=(v||"")!==""&&(L||"")!=="");let P=w("aipkit_claude_api_key");P!==void 0&&(m.claude=P!=="");let b=w("aipkit_deepseek_api_key");b!==void 0&&(m.deepseek=b!=="");let y=w("aipkit_ollama_base_url");y!==void 0&&(m.ollama=y!=="");let S=w("aipkit_replicate_api_key"),E=w("aipkit_task_cw_replicate_api_key");(S!==void 0||E!==void 0)&&(m.replicate=(S||"")!==""||(E||"")!=="");let A=w("aipkit_pinecone_api_key");A!==void 0&&(m.pinecone=A!=="");let M=w("aipkit_qdrant_api_key"),$=w("aipkit_qdrant_url");return(M!==void 0||$!==void 0)&&(m.qdrant=(M||"")!==""&&($||"")!==""),u?(i(m),!0):!1}function p(){["aipkit_openai_api_key","aipkit_openrouter_api_key","aipkit_google_api_key","aipkit_azure_api_key","aipkit_azure_endpoint","aipkit_claude_api_key","aipkit_deepseek_api_key","aipkit_ollama_base_url","aipkit_replicate_api_key","aipkit_task_cw_replicate_api_key","aipkit_pinecone_api_key","aipkit_qdrant_api_key","aipkit_qdrant_url"].forEach(u=>{let w=document.getElementById(u);if(!w||w.dataset.aipkitProviderStatusBound==="true")return;let h=()=>{_()&&d(document)};w.addEventListener("input",h),w.addEventListener("change",h),w.dataset.aipkitProviderStatusBound="true"})}function f(m){(m||document).querySelectorAll(o).forEach(h=>{h.dataset.aipkitProviderNoticeLinkBound!=="true"&&(h.addEventListener("click",C=>{let x=h.getAttribute("data-aipkit-load-module");!x||typeof window.aipkit_loadModule!="function"||(C.preventDefault(),window.aipkit_loadModule(x))}),h.dataset.aipkitProviderNoticeLinkBound="true")})}function g(m){let u=m||document;u.querySelectorAll(k).forEach(h=>{h.dataset.aipkitProviderNoticeBound!=="true"&&(h.addEventListener("change",()=>{h.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(h.dataset.aipkitProviderNoticeArmed="true"),e(h,r())}),h.dataset.aipkitProviderNoticeBound="true")}),_(),d(u),p(),f(u)}window.aipkit_initProviderKeyNotices=g,document.addEventListener("DOMContentLoaded",function(){g(document)})})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelectorAll("[data-aipkit-popover-target]");if(!r.length)return;let i=null,a=null,s=!1,l=d=>d?o.querySelector(`#${d}`):null,c=(d,_)=>{if(!d||!_)return;let p=d.getBoundingClientRect(),f=_.getBoundingClientRect(),g=f.width||400,m=f.height||0,u=window.innerWidth,w=window.innerHeight,h=12;if(d.dataset.aipkitPopoverPlacement==="bottom"){let v=p.left;v+g>u-h&&(v=p.right-g),v=Math.max(h,Math.min(v,u-g-h));let L=p.bottom+8;L+m>w-h&&(L=p.top-m-8),L=Math.max(h,Math.min(L,w-m-h)),_.style.left=`${Math.round(v)}px`,_.style.top=`${Math.round(L)}px`;return}if(d.dataset.aipkitPopoverPlacement==="left"){let v=p.left-g-10;v<h&&(v=p.right+10),v=Math.max(h,Math.min(v,u-g-h));let L=p.top;L+m>w-h&&(L=w-m-h),L=Math.max(h,L),_.style.left=`${Math.round(v)}px`,_.style.top=`${Math.round(L)}px`;return}let C=p.right+10;C+g>u-h&&(C=p.right-g-10),C=Math.max(h,Math.min(C,u-g-h));let x=p.top;x+m>w-h&&(x=w-m-h),x=Math.max(h,x),_.style.left=`${Math.round(C)}px`,_.style.top=`${Math.round(x)}px`},n=()=>{!a||!i||s||(s=!0,window.requestAnimationFrame(()=>{let d=i.querySelector(".aipkit_model_settings_popover_panel");c(a,d),s=!1}))},e=()=>{if(!i)return;let d=i.id;i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),d==="aipkit_cw_template_picker_popover"&&typeof window.aipkit_resetTemplateActionsPanel=="function"&&window.aipkit_resetTemplateActionsPanel(),i=null,a=null},t=d=>{if(!d)return;let _=d.getAttribute("data-aipkit-popover-target"),p=l(_);if(!p)return;i&&i!==p&&e(),i=p,a=d,p.classList.add("aipkit-active"),p.setAttribute("aria-hidden","false"),d.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${_}`);let f=p.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{c(d,f)})};r.forEach(d=>{d.dataset.popoverListenerAttached!=="true"&&(d.addEventListener("click",_=>{if(_.preventDefault(),!(d.dataset.aipkitPopoverKeepOpen==="true")&&i&&a===d&&i.classList.contains("aipkit-active")){e();return}t(d)}),d.dataset.popoverListenerAttached="true")}),o.querySelectorAll(".aipkit_model_settings_popover").forEach(d=>{d.dataset.overlayListenerAttached!=="true"&&(d.addEventListener("click",p=>{p.target===d&&e()}),d.dataset.overlayListenerAttached="true");let _=d.querySelector(".aipkit_model_settings_popover_close");_&&_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",p=>{p.preventDefault(),e()}),_.dataset.popoverListenerAttached="true"),d.querySelectorAll("[data-aipkit-popover-close]").forEach(p=>{p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",f=>{f.preventDefault(),e()}),p.dataset.popoverListenerAttached="true")})}),o.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",d=>{d.key==="Escape"&&i&&e()}),o.dataset.escapeListenerAttached="true"),o.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",n),window.addEventListener("scroll",n,!0),o.dataset.repositionListenersAttached="true")}window.aipkit_initContentWriterPopovers=k})();(function(){"use strict";let k=a=>{if(!a)return null;let s=a.querySelector("#aipkit_enhancer_editor_integration"),l=a.querySelector("#aipkit_enhancer_list_button"),c=a.querySelector('input[name="enhancer_insert_position_default"]:checked');return!s||!l||!c?null:{enhancer_editor_integration:s.checked?"1":"0",enhancer_list_button:l.checked?"1":"0",enhancer_insert_position_default:c.value||"replace"}},o=a=>a?JSON.stringify(a):"",r=async a=>{if(!a||typeof window.aipkit_apiRequest!="function")return;let s=k(a);if(!s)return;let l=a.dataset.assistantAutosaveBaseline||"",c=o(s);if(!c||c===l||a.dataset.assistantAutosaveBusy==="true")return;let n=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,e=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,t=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;a.dataset.assistantAutosaveBusy="true",n&&n("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",s),a.dataset.assistantAutosaveBaseline=c,e&&e("Updated")}catch(d){t&&t(`Error: ${d.message||"Failed to save."}`),console.error("Content Writer Assistant Settings Save Error:",d)}finally{a.dataset.assistantAutosaveBusy="false"}};function i(a){let s=a||document.getElementById("aipkit_content_writer_container"),l=document.getElementById("aipkit_cw_builder_sheet");if(!s||!l)return;let c=l.querySelector(".aipkit_builder_sheet_title"),n=l.querySelector(".aipkit_builder_sheet_description"),e=l.querySelectorAll(".aipkit_builder_sheet_section"),t=l.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'),d=l.querySelector(".aipkit_builder_sheet_close"),_=f=>{if(!f)return;let g=f.getAttribute("data-sheet-title")||"Sheet",m=f.getAttribute("data-sheet-description")||"",u=f.getAttribute("data-sheet-content")||"placeholder";c&&(c.textContent=g),n&&(n.textContent=m);let w=!1;if(e.forEach(h=>{h.dataset.sheet===u?(h.hidden=!1,w=!0):h.hidden=!0}),!w&&t&&(t.hidden=!1),l.classList.add("aipkit-active"),l.setAttribute("aria-hidden","false"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_cw_builder_sheet"),u==="assistant"&&(typeof window.aipkit_initMessageCloseButtons=="function"&&window.aipkit_initMessageCloseButtons("aipkit_content_writer_messages"),typeof window.aipkit_initEnhancerActionsUI=="function"&&window.aipkit_initEnhancerActionsUI(),!l.dataset.assistantAutosaveBound)){let h=k(l);l.dataset.assistantAutosaveBaseline=o(h),l.addEventListener("change",C=>{let x=C.target;!x||!x.matches("#aipkit_enhancer_editor_integration")&&!x.matches("#aipkit_enhancer_list_button")&&!x.matches('input[name="enhancer_insert_position_default"]')||r(l)}),l.dataset.assistantAutosaveBound="true"}d&&d.focus()},p=()=>{l.classList.remove("aipkit-active"),l.setAttribute("aria-hidden","true")};s.dataset.assistantSheetBound||(s.addEventListener("click",f=>{let g=f.target.closest(".aipkit_builder_sheet_trigger");g&&(f.preventDefault(),_(g))}),s.dataset.assistantSheetBound="true"),d&&d.dataset.assistantSheetBound!=="true"&&(d.addEventListener("click",p),d.dataset.assistantSheetBound="true"),l.dataset.assistantSheetBound||(l.addEventListener("click",f=>{f.target===l&&p()}),document.addEventListener("keydown",f=>{f.key==="Escape"&&l.classList.contains("aipkit-active")&&p()}),l.dataset.assistantSheetBound="true")}window.aipkit_initContentWriterAssistantSheet=i})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],o=e=>{let t=k.findIndex(d=>d.key===e);return t===-1?1:t},r=(e,t)=>{let d=Number(e);if(!d||Number.isNaN(d))return"medium";let _="medium",p=1/0;return Object.keys(t).forEach(f=>{let g=Math.abs(d-t[f]);g<p&&(p=g,_=f)}),_},i=(e,t)=>{if(!e)return;let d=e.querySelector(".aipkit_ai_behavior_value"),_=e.querySelector(".aipkit_ai_behavior_hint"),p=e.querySelector(".aipkit_ai_length_slider"),f=k[o(t)];d&&(d.textContent=f.label),_&&(_.textContent=`Approx. ${f.words} words`),p&&(p.value=String(o(t)+1))},a=e=>{let t=e.querySelector(".aipkit_ai_temperature_control");if(!t)return;let d=t.querySelector(".aipkit_ai_temperature_slider"),_=t.querySelector(".aipkit_ai_behavior_value");if(!d||!_||d.dataset.enhancedListenerAttached==="true")return;let p=()=>{_.textContent=d.value};d.addEventListener("input",p),p(),d.dataset.enhancedListenerAttached="true"},s=e=>{let t=e.querySelectorAll(".aipkit_ai_reasoning_input"),d=e.querySelector("[data-aipkit-reasoning-select]");if(!t.length||!d||d.dataset.reasoningSyncAttached==="true")return;let _=f=>f==="minimal"?"low":f,p=f=>{let g=_(f);e.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>u.classList.remove("aipkit_ai_reasoning_option--selected"));let m=e.querySelector(`.aipkit_ai_reasoning_input[value="${g}"]`);if(m){m.checked=!0;let u=m.closest(".aipkit_ai_reasoning_option");u&&u.classList.add("aipkit_ai_reasoning_option--selected")}};t.forEach(f=>{f.dataset.reasoningListenerAttached!=="true"&&(f.addEventListener("change",()=>{f.checked&&(d.value=_(f.value),d.dispatchEvent(new Event("change",{bubbles:!0})),p(f.value))}),f.dataset.reasoningListenerAttached="true")}),d.addEventListener("change",()=>{p(d.value||"medium")}),p(d.value||"medium"),d.dataset.reasoningSyncAttached="true"},l=e=>{let t=e.querySelector(".aipkit_ai_length_control");if(!t)return;let d=t.querySelector(".aipkit_ai_length_slider"),_=t.querySelector("[data-aipkit-length-input]");if(!d||!_||d.dataset.lengthListenerAttached==="true")return;let p=t.dataset.aipkitLengthMode||"content_length",f={short:Number(t.dataset.aipkitLengthShort||2e3),medium:Number(t.dataset.aipkitLengthMedium||4e3),long:Number(t.dataset.aipkitLengthLong||6e3)},g=(u,w)=>{let h=k.some(C=>C.key===u)?u:"medium";if(i(t,h),p==="content_length")_.value!==h&&(_.value=h);else{let C=f[h]||f.medium;Number(_.value)!==C&&(_.value=String(C))}w&&_.dispatchEvent(new Event("change",{bubbles:!0}))},m=()=>{if(p==="content_length"){g(_.value||"medium",!1);return}let u=r(_.value,f);g(u,!1)};d.addEventListener("input",()=>{let u=Math.max(1,Math.min(3,Number(d.value||2)))-1,w=k[u]?.key||"medium";g(w,!0)}),_.addEventListener("change",m),m(),d.dataset.lengthListenerAttached="true"},c=e=>{!e||e.dataset.aiSettingsInit==="true"||(a(e),l(e),s(e),e.dataset.aiSettingsInit="true")};function n(e){let t=e||document.getElementById("aipkit_autogpt_container");t&&t.querySelectorAll(".aipkit_ai_settings_redesigned").forEach(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>n()):n(),window.aipkit_initAutogptAiSettingsRedesigned=n})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function k(r){if(typeof r!="string"||!r)return[];let i=new Set;return r==="aipkit_save_ai_settings"&&["settings","dashboard-home","chatbot","sources","content-writer","autogpt","ai-forms","image-generator"].forEach(a=>i.add(a)),(r==="aipkit_save_chatbot_settings"||/^aipkit_update_chatbot_/.test(r)||/^aipkit_(create|delete|duplicate|reset|rename)_chatbot$/.test(r))&&(i.add("chatbot"),i.add("dashboard-home")),/^aipkit_(save|duplicate|delete|delete_all)_ai_forms?$/.test(r)&&(i.add("ai-forms"),i.add("dashboard-home")),(/^aipkit_(save|delete)_automated_task$/.test(r)||/^aipkit_update_automated_task_/.test(r))&&(i.add("autogpt"),i.add("dashboard-home")),(/^aipkit_(save|delete)_cw_template$/.test(r)||r==="aipkit_reset_cw_starter_templates")&&(i.add("content-writer"),i.add("dashboard-home")),Array.from(i)}function o(r,i={},a={}){return new Promise((s,l)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return l(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let c=new FormData;c.append("action",r),!Object.prototype.hasOwnProperty.call(i,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&c.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(Array.isArray(i[t])?i[t].forEach(d=>{c.append(t+"[]",d)}):c.append(t,i[t]));let n=new AbortController,e=setTimeout(()=>{n.abort()},a.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:c,credentials:"same-origin",signal:n.signal}).then(t=>(clearTimeout(e),t.json())).then(t=>{if(t.success)typeof window.aipkit_invalidateModuleCache=="function"&&k(r).forEach(_=>{window.aipkit_invalidateModuleCache(_)}),s(t.data);else{let d=t.data||{},_=d.message||"Unknown error",p=new Error(_);d.debug_error&&(p.debug=d.debug_error),p.data=d,d.code&&(p.code=d.code),d.details&&(p.details=d.details),l(p)}}).catch(t=>{clearTimeout(e),t.name==="AbortError"?l(new Error("Request timeout")):l(t)})})}window.aipkit_apiRequest=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_modulesMenu");if(o){let i=o.querySelector(".aipkit_dropdown-panel"),a=o.querySelector(".aipkit_menu-trigger");a&&a.addEventListener("click",function(s){s.stopPropagation(),o.classList.toggle("aipkit_show-menu")}),i&&i.addEventListener("click",function(s){s.stopPropagation()})}document.addEventListener("click",function(i){o&&o.classList.contains("aipkit_show-menu")&&(o.contains(i.target)||o.classList.remove("aipkit_show-menu"))});let r=document.getElementById("aipkit_modulesMenuMobile");if(r){r.addEventListener("click",function(a){a.stopPropagation(),r.classList.toggle("aipkit_show-menu")});let i=r.querySelector(".aipkit_dropdown-menu");i&&i.addEventListener("click",function(a){a.stopPropagation()})}}window.aipkit_initSettingsMenus=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_upgradeBtn"),a=document.getElementById("aipkit_upgradeModal");!i||!a||(i.addEventListener("click",function(s){s.preventDefault(),o(a)}),a.querySelectorAll("[data-close-modal]").forEach(function(s){s.addEventListener("click",function(l){l.preventDefault(),r(a)})}),document.addEventListener("keydown",function(s){s.key==="Escape"&&a.classList.contains("aipkit_active")&&r(a)}),a.querySelector(".aipkit_modal").addEventListener("click",function(s){s.stopPropagation()}))}function o(i){i.classList.add("aipkit_active"),document.body.classList.add("aipkit_upgrade_modal_open");let a=i.querySelector('button, a, [tabindex]:not([tabindex="-1"])');a&&setTimeout(()=>a.focus(),100)}function r(i){i.classList.remove("aipkit_active"),document.body.classList.remove("aipkit_upgrade_modal_open")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initUpgradeModal=k})();(function(){"use strict";let i=new Map,a=new Map,s=new Map,l=!1,c={"dashboard-home":"aipkit_initDashboardHome",settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",stats:"aipkit_initStats","image-generator":"aipkit_initImageGenerator",sources:"aipkit_initSources","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"},n=".aipkit_chatbot_builder_left",e="aipkit_last_module",t=(v,L)=>{if(!v)return;let P=L==="settings";v.classList.toggle("aipkit_module-container--settings-active",P);let b=v.closest(".aipkit_wrap");b&&b.classList.toggle("aipkit_wrap--settings-active",P)},d=(v,L={})=>{let P=Object.keys(L||{}).sort();if(!P.length)return`${v}::default`;let b={};return P.forEach(y=>{b[y]=L[y]}),`${v}::${JSON.stringify(b)}`},_=v=>s.get(v)||0,p=v=>{let L=_(v)+1;return s.set(v,L),L},f=v=>{if(!i.has(v))return null;let L=i.get(v);return!L||typeof L.html!="string"||Date.now()-(L.timestamp||0)>3e5?(i.delete(v),null):L},g=(v,L,P="",b=null)=>{!v||typeof L!="string"||P&&b!==null&&b!==_(P)||i.set(v,{html:L,timestamp:Date.now()})},m=v=>{if(l||typeof window.aipkit_apiRequest!="function")return;l=!0;let L=Array.from(document.querySelectorAll(".aipkit_module-link")).filter(y=>y&&y.offsetParent!==null).map(y=>String(y.getAttribute("data-module")||"").trim()).filter(y=>y&&y!==v);if(!L.length)return;let P=typeof window.requestIdleCallback=="function"?window.requestIdleCallback.bind(window):y=>setTimeout(y,400),b=(y=0)=>{if(y>=L.length)return;let S=L[y],E={module:S};if(S==="chatbot"){try{let H=localStorage.getItem("aipkit_last_selected_chatbot");H&&(E.force_active_bot_id=H)}catch{}try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(E.layout="next")}catch{}}let A={...E};delete A.module;let M=d(S,A),$=_(S);if(f(M)||a.has(M)){P(()=>b(y+1));return}let W=window.aipkit_apiRequest("aipkit_dashboard_load_module",E).then(H=>{H&&typeof H.html=="string"&&g(M,H.html,S,$)}).catch(()=>{}).finally(()=>{a.delete(M),P(()=>b(y+1))});a.set(M,W)};P(()=>b(0))},u=v=>{v&&(v.style.removeProperty("--aipkit-loader-left"),v.style.removeProperty("--aipkit-loader-top"))},w=(v,L)=>{if(u(v),!v||L!=="chatbot")return;let P=v.querySelector(n);if(!P)return;let b=v.getBoundingClientRect(),y=P.getBoundingClientRect();if(b.width<=0||b.height<=0||y.width<=0||y.height<=0)return;let S=y.left-b.left+y.width/2,E=y.top-b.top+y.height/2,A=Math.max(24,Math.min(b.width-24,S)),M=Math.max(24,Math.min(b.height-24,E));v.style.setProperty("--aipkit-loader-left",`${Math.round(A)}px`),v.style.setProperty("--aipkit-loader-top",`${Math.round(M)}px`)},h=v=>{if(!(!v||v==="dashboard-home"||v==="settings"))try{localStorage.setItem(e,v)}catch{}};async function C(v,L,P){let b={};typeof L=="function"?P=L:typeof L=="object"&&L!==null&&(b={...L});let y=b.aipkit_silent===!0;Object.prototype.hasOwnProperty.call(b,"aipkit_silent")&&delete b.aipkit_silent;let S=b.aipkit_force_refresh===!0;if(Object.prototype.hasOwnProperty.call(b,"aipkit_force_refresh")&&delete b.aipkit_force_refresh,v==="chatbot"&&!b.force_active_bot_id&&!b.force_active_tab)try{let Q=localStorage.getItem("aipkit_last_selected_chatbot");Q&&(b.force_active_bot_id=Q)}catch(Q){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",Q)}if(v==="chatbot"&&!b.layout)try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(b.layout="next")}catch(Q){console.warn("AIPKit Loader: Failed to read chatbot layout flag from URL:",Q)}document.querySelectorAll(".aipkit_module-link").forEach(Q=>Q.classList.remove("aipkit_active"));let A=document.querySelector(`.aipkit_module-link[data-module="${v}"]`);A&&A.classList.add("aipkit_active");let M=document.getElementById("aipkit_module-container");if(!M)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof P=="function"&&P(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));t(M,v);let $=M.innerHTML.trim()!=="",W=y||$,H=null,N=0,G=()=>{let Q=M.offsetHeight||0,fe=Math.round(window.innerHeight*.55),Ae=Math.max(Q,fe,280);M.style.minHeight=`${Ae}px`},J=()=>{M.style.minHeight=""},F=()=>{requestAnimationFrame(()=>{M.classList.remove("aipkit_module-container--show-feedback"),M.classList.remove("aipkit_module-container--silent-loading"),J(),u(M)})},q=()=>{if(!W)return;if(H&&(clearTimeout(H),H=null),!N){F();return}let fe=220-(Date.now()-N);fe>0?setTimeout(F,fe):F()};if(W&&(w(M,v),M.classList.add("aipkit_module-container--silent-loading"),G(),H=setTimeout(()=>{H=null,N=Date.now(),M.classList.add("aipkit_module-container--show-feedback")},120)),!W){let Q=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",v):`Loading ${v}...`;M.innerHTML=`
                <div class="aipkit_container aipkit_loading-placeholder">
                    <div class="aipkit_container-body">
                        <p style="text-align: center; padding: 30px;">
                            <span class="aipkit_spinner"
                                style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                            </span>
                            ${Q}
                        </p>
                    </div>
                </div>
            `}if(typeof window.aipkit_apiRequest!="function"){let Q="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${v}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(M,v,Q),typeof P=="function"&&P(new Error(Q)),q(),Promise.reject(new Error(Q))}let O={module:v,...b},R=d(v,b),D=_(v),Z=Q=>{if(!Q||typeof Q.html!="string")throw new Error('Missing or invalid "html" in response data');M.innerHTML=Q.html,v==="chatbot"&&Q.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=Q.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let fe=c[v];if(fe&&typeof window[fe]=="function")try{window[fe]()}catch(Ae){let We=`Error initializing ${v} module scripts.`;throw new Error(`${We} (Details: ${Ae.message})`)}typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(M),h(v)};try{let Q=S?null:f(R);if(Q)return Z({html:Q.html}),typeof P=="function"&&P(),q(),m(v),Promise.resolve();let fe=await window.aipkit_apiRequest("aipkit_dashboard_load_module",O);return Z(fe),fe&&typeof fe.html=="string"&&g(R,fe.html,v,D),typeof P=="function"&&P(),q(),m(v),Promise.resolve()}catch(Q){return Q&&Q.debug?console.error(`AIPKit Loader: Module loading error for '${v}':`,Q.message,`
Server debug:`,Q.debug):console.error(`AIPKit Loader: Module loading error for '${v}':`,Q),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(M,v,Q.message),typeof P=="function"&&P(Q),q(),Promise.reject(Q)}}let x=v=>{if(!v)return;p(v);let L=`${v}::`;for(let P of Array.from(i.keys()))P.startsWith(L)&&i.delete(P)};window.aipkit_loadModule=C,window.aipkit_invalidateModuleCache=x})();(function(){"use strict";function k(o,r,i){if(!o)return;let a=window.aipkit_dashboard?.text||{},s=a.errorLoadingModuleTitle||"Error Loading Module",l=a.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",c=a.errorDetails||"Details:",n=l.replace("%s",r);o.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${s}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${n}</p>
                    <p><strong>${c}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${i||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_modulesMenu");if(!o)return;let r=o.querySelector(".aipkit_dropdown-panel");r&&(r.addEventListener("change",function(i){let a=i.target;if(a.matches&&a.matches(".aipkit_module-toggle")){let s=r.querySelectorAll(".aipkit_module-toggle");s.forEach(p=>p.disabled=!0),s.forEach(p=>p.disabled=!0);let l=a.getAttribute("data-module"),c=a.getAttribute("data-option-key"),n=a.getAttribute("data-icon"),e=a.getAttribute("data-label"),t=a.checked,d=document.querySelector(`.aipkit_module-link[data-module="${l}"]`);t?d?d.style.display="":console.log(`Module Toggle: Enabling '${l}'. Nav link will appear on refresh if needed.`):d&&(d.style.display="none");let _={moduleKey:c,enabled:t?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),a.checked=!t,d&&(d.style.display=t?"none":""),s.forEach(p=>p.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",_).then(()=>{console.log(`Module Toggle: '${l}' status updated successfully.`)}).catch(p=>{console.error("Error updating module setting:",p.message),alert(`Error updating module setting: ${p.message}`),a.checked=!t,d&&(d.style.display=t?"none":"")}).finally(()=>{s.forEach(p=>p.disabled=!1)})}}),r.addEventListener("click",function(i){let a=i.target.closest(".aipkit_module-item");if(a){let s=a.querySelector(".aipkit_toggle-switch");if(s&&!s.contains(i.target)){let l=a.querySelector(".aipkit_module-toggle");if(l&&!l.disabled){l.checked=!l.checked;let c=new Event("change",{bubbles:!0});l.dispatchEvent(c)}}}}))}window.aipkit_initModuleToggles=k})();(function(){"use strict";function k(){document.querySelectorAll(".aipkit_tabs").forEach(i=>{if(i.dataset.tabGroupListenerAttached==="true")return;let a=i.querySelectorAll(".aipkit_tab"),s=i.nextElementSibling;if(!s||!s.classList.contains("aipkit_tab_content_container")){let l=i.closest(".aipkit_container-body, .aipkit_container"),c=l?l.querySelector(".aipkit_tab_content_container"):null;if(!c)return;let n=c.querySelectorAll(".aipkit_tab-content");o(i,a,n)}else{let l=s.querySelectorAll(".aipkit_tab-content");o(i,a,l)}})}function o(r,i,a){i.forEach(s=>{s.addEventListener("click",function(){i.forEach(n=>n.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),a.forEach(n=>n.classList.remove("aipkit_active"));let l=this.getAttribute("data-tab"),c=Array.from(a).find(n=>n.id===l+"-content");c&&(c.classList.add("aipkit_active"),c.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),r.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=k})();(function(){"use strict";var k="aipkit_last_module";function o(u){return u?document.querySelector('.aipkit_module-tabs_list .aipkit_module-link[data-module="'+u+'"]'):null}function r(u,w){var h=o(u);if(h){if(w){h.hidden=!1,h.removeAttribute("aria-hidden"),h.removeAttribute("tabindex"),h.classList.remove("aipkit_module-tab--is-hidden");return}h.hidden=!0,h.setAttribute("aria-hidden","true"),h.setAttribute("tabindex","-1"),h.classList.add("aipkit_module-tab--is-hidden"),h.classList.remove("aipkit_active")}}function i(u){var w=o(u);return w?!w.hidden&&!w.classList.contains("aipkit_module-tab--is-hidden"):null}function a(u,w){if(!(w||!u||typeof window.aipkit_loadModule!="function")){var h=document.querySelector('.aipkit_module-link.aipkit_active[data-module="'+u+'"]');if(h){var C=o("dashboard-home");C&&!C.hidden&&window.aipkit_loadModule("dashboard-home")}}}function s(u,w,h,C){c(w,C),r(h,C),a(h,C),n(u)}function l(u){u.querySelectorAll(".aipkit_home_toggle_input").forEach(function(w){var h=w.getAttribute("data-module")||"",C=w.closest(".aipkit_home_module_row"),x=i(h);x===null&&(x=!!w.checked),w.checked!==x&&(w.checked=x),c(C,x)}),n(u)}function c(u,w){if(u){u.classList.toggle("is-disabled",!w);var h=u.getAttribute("data-module")||"",C=u.querySelector(".aipkit_home_module_main");C&&(w&&h?(C.setAttribute("data-aipkit-open-module",h),C.setAttribute("tabindex","0"),C.setAttribute("aria-disabled","false")):(C.removeAttribute("data-aipkit-open-module"),C.setAttribute("tabindex","-1"),C.setAttribute("aria-disabled","true")))}}function n(u){var w=u.querySelector("#aipkit_home_continue_btn");if(w){var h="";try{h=localStorage.getItem(k)||""}catch{h=""}if(!h){w.hidden=!0,w.removeAttribute("data-aipkit-open-module");return}var C=u.querySelector('.aipkit_home_module_row[data-module="'+h+'"]');if(!C||C.classList.contains("is-disabled")){w.hidden=!0,w.removeAttribute("data-aipkit-open-module");return}var x=C.getAttribute("data-module-label")||h,v=w.getAttribute("data-label-prefix")||"Continue:";w.textContent=v+" "+x,w.setAttribute("data-aipkit-open-module",h),w.hidden=!1}}function e(u){u.addEventListener("click",function(w){var h=w.target.closest("[data-aipkit-scroll-target]");if(!(!h||!u.contains(h))){var C=h.getAttribute("data-aipkit-scroll-target")||"";if(C){var x=u.querySelector(C);x&&(w.preventDefault(),x.scrollIntoView({behavior:"smooth",block:"start"}))}}})}function t(u){var w=u.querySelector(".aipkit_home_hero"),h=u.querySelector(".aipkit_home_panel--setup");if(!(!w||!h)){var C=window.matchMedia("(max-width: 1180px)").matches;if(C){w.style.minHeight="",w.style.height="";return}var x=Math.ceil(h.getBoundingClientRect().height);x>0&&(w.style.minHeight=x+"px",w.style.height=x+"px")}}function d(u){var w=u.querySelector(".aipkit_home_section--modules"),h=u.querySelector(".aipkit_home_panel--chart");if(!(!w||!h)){var C=window.matchMedia("(max-width: 1180px)").matches;if(C){w.style.minHeight="",w.style.height="";return}var x=Math.ceil(h.getBoundingClientRect().height);x>0&&(w.style.minHeight=x+"px",w.style.height=x+"px")}}function _(u){var w=function(){t(u),d(u)};typeof window.__aipkitHomeHeroHeightResizeHandler=="function"&&window.removeEventListener("resize",window.__aipkitHomeHeroHeightResizeHandler);var h=function(){window.requestAnimationFrame(w)};if(window.__aipkitHomeHeroHeightResizeHandler=h,window.addEventListener("resize",h,{passive:!0}),window.__aipkitHomeHeroHeightObserver&&typeof window.__aipkitHomeHeroHeightObserver.disconnect=="function"&&window.__aipkitHomeHeroHeightObserver.disconnect(),typeof window.ResizeObserver=="function"){var C=u.querySelector(".aipkit_home_panel--setup"),x=u.querySelector(".aipkit_home_panel--chart");if(C||x){var v=new ResizeObserver(function(){w()});C&&v.observe(C),x&&v.observe(x),window.__aipkitHomeHeroHeightObserver=v}}w()}function p(u){u.querySelectorAll(".aipkit_home_module_main").forEach(function(w){w.addEventListener("keydown",function(h){h.key!=="Enter"&&h.key!==" "||(h.preventDefault(),w.getAttribute("aria-disabled")!=="true"&&w.click())})})}function f(u){u.querySelectorAll(".aipkit_home_toggle_input").forEach(function(w){w.addEventListener("change",function(){var h=w.getAttribute("data-option-key"),C=w.getAttribute("data-module"),x=!!w.checked,v=w.closest(".aipkit_home_module_row"),L=v?!v.classList.contains("is-disabled"):!x;if(s(u,v,C,x),!h||typeof window.aipkit_apiRequest!="function"){w.checked=L,s(u,v,C,L);return}typeof window.aipkit_invalidateModuleCache=="function"&&(window.aipkit_invalidateModuleCache(C),window.aipkit_invalidateModuleCache("dashboard-home")),w.disabled=!0,window.aipkit_apiRequest("aipkit_update_module_setting",{moduleKey:h,enabled:x?"1":"0"}).catch(function(){w.checked=L,s(u,v,C,L),typeof window.aipkit_invalidateModuleCache=="function"&&(window.aipkit_invalidateModuleCache(C),window.aipkit_invalidateModuleCache("dashboard-home"))}).finally(function(){w.disabled=!1})})})}function g(){var u=document.getElementById("aipkit_token_usage_chart_container");if(!(!u||typeof window.aipkit_loadTokenUsageChart!="function")){var w=document.getElementById("aipkit_home_chart_period"),h=w&&parseInt(w.value,10)||7;window.aipkit_loadTokenUsageChart(h),w&&w.addEventListener("change",function(){var C=parseInt(w.value,10)||7;window.aipkit_loadTokenUsageChart(C)})}}function m(){var u=document.getElementById("aipkit_dashboard_home");u&&(e(u),_(u),p(u),l(u),f(u),g())}window.aipkit_initDashboardHome=m})();document.addEventListener("DOMContentLoaded",function(){(()=>{document.addEventListener("click",function(a){let s=a.target.closest("[data-aipkit-open-module], .aipkit_module-link[data-module]");if(!s)return;let l=s.getAttribute("data-aipkit-open-module")||s.getAttribute("data-module")||"";if(!(!l||typeof window.aipkit_loadModule!="function")){if(s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true"){a.preventDefault();return}a.preventDefault(),window.aipkit_loadModule(l)}})})(),typeof window.aipkit_initSettingsMenus=="function"&&window.aipkit_initSettingsMenus();let i=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(i)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let a=["dashboard-home","settings","chatbot","content-writer","ai-forms","image-generator","sources"],s=Array.from(document.querySelectorAll(".aipkit_module-link")),l=null;for(let c=0;c<a.length;c++){let n=a[c];if(s.find(t=>t.getAttribute("data-module")===n&&t.offsetParent!==null)){l=n;break}}if(!l){let c=s.find(n=>n.offsetParent!==null);c&&(l=c.getAttribute("data-module"))}if(l)window.aipkit_loadModule(l);else if(s.find(n=>n.getAttribute("data-module")==="dashboard-home"))window.aipkit_loadModule("dashboard-home");else{let n=document.getElementById("aipkit_module-container");n&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(n,"initial","No modules enabled or accessible. Please review module access and settings."):n&&(n.innerHTML='<p style="text-align:center; padding: 30px;">No modules are currently available.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!i){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let a=document.getElementById("aipkit_module-container");a&&(a.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_sources_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let a=r.querySelector(".aipkit_model_settings_popover_title"),s=r.querySelector(".aipkit_model_settings_popover_back"),l=o.querySelector("#aipkit_sources_settings_trigger"),c={root:r.dataset.titleRoot||"Settings",general:r.dataset.titleGeneral||"General","provider-credentials":r.dataset.titleProviderCredentials||"Provider credentials","document-chunking":r.dataset.titleDocumentChunking||"Document chunking"},n=null,e=t=>{let d=t||"root",_=r.querySelector(`[data-aipkit-settings-panel="${d}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!_)return;let p=_.dataset.aipkitSettingsPanel||"root";p!==n&&(i.forEach(f=>{f.hidden=f!==_}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),n=p,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",t=>{let d=t.target.closest("[data-aipkit-panel-target]");if(!d)return;t.preventDefault();let _=d.dataset.aipkitPanelTarget;e(_)}),s&&s.addEventListener("click",t=>{t.preventDefault(),e("root")}),l&&l.addEventListener("click",()=>{e("root")}),e("root"),r.dataset.panelsBound="true"}window.aipkitSources_initSettingsPopoverPanels=k})();(function(){"use strict";let k=window.wp&&window.wp.i18n?window.wp.i18n:null,o=k&&typeof k.__=="function"?k.__:F=>F,r=k&&typeof k.sprintf=="function"?k.sprintf:(F,...q)=>F.replace(/%s/g,()=>q.shift()),i=k&&typeof k._n=="function"?k._n:(F,q,O)=>O===1?F:q,a=typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml:F=>String(F??""),s=60,l={openai:{singular:o("Vector store","gpt3-ai-content-generator"),plural:o("Vector stores","gpt3-ai-content-generator"),loading:o("Loading vector stores...","gpt3-ai-content-generator"),empty:o("No vector stores found.","gpt3-ai-content-generator")},pinecone:{singular:o("Index","gpt3-ai-content-generator"),plural:o("Indexes","gpt3-ai-content-generator"),loading:o("Loading indexes...","gpt3-ai-content-generator"),empty:o("No indexes found.","gpt3-ai-content-generator")},qdrant:{singular:o("Collection","gpt3-ai-content-generator"),plural:o("Collections","gpt3-ai-content-generator"),loading:o("Loading collections...","gpt3-ai-content-generator"),empty:o("No collections found.","gpt3-ai-content-generator")},default:{singular:o("Index","gpt3-ai-content-generator"),plural:o("Indexes","gpt3-ai-content-generator"),loading:o("Loading indexes...","gpt3-ai-content-generator"),empty:o("No indexes found.","gpt3-ai-content-generator")}},c={openai:{key:"openai",typeLabel:o("Vector stores","gpt3-ai-content-generator"),emptyLabel:o("No vector stores found.","gpt3-ai-content-generator"),loadingLabel:o("Loading vector stores...","gpt3-ai-content-generator"),listAction:"aipkit_list_vector_stores_openai",listKey:"stores",createAction:"aipkit_create_vector_store_openai",createKey:"store",nameLabel:o("Store name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. Product FAQ","gpt3-ai-content-generator"),countSingular:o("store","gpt3-ai-content-generator"),countPlural:o("stores","gpt3-ai-content-generator"),needsDimension:!1},pinecone:{key:"pinecone",typeLabel:o("Indexes","gpt3-ai-content-generator"),emptyLabel:o("No indexes found.","gpt3-ai-content-generator"),loadingLabel:o("Loading indexes...","gpt3-ai-content-generator"),listAction:"aipkit_list_indexes_pinecone",listKey:"indexes",createAction:"aipkit_create_index_pinecone",createKey:"index",nameLabel:o("Index name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. site-content","gpt3-ai-content-generator"),countSingular:o("index","gpt3-ai-content-generator"),countPlural:o("indexes","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536},qdrant:{key:"qdrant",typeLabel:o("Collections","gpt3-ai-content-generator"),emptyLabel:o("No collections found.","gpt3-ai-content-generator"),loadingLabel:o("Loading collections...","gpt3-ai-content-generator"),listAction:"aipkit_list_collections_qdrant",listKey:"collections",createAction:"aipkit_create_collection_qdrant",createKey:"collection",nameLabel:o("Collection name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. docs","gpt3-ai-content-generator"),countSingular:o("collection","gpt3-ai-content-generator"),countPlural:o("collections","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536}},n={openai:"aipkit_vector_store_nonce_openai",pinecone:"aipkit_vector_store_pinecone_nonce_management",qdrant:"aipkit_vector_store_qdrant_nonce_management"},e={openai:{action:"aipkit_delete_vector_store_openai",param:"store_id",label:o("vector store","gpt3-ai-content-generator")},pinecone:{action:"aipkit_delete_index_pinecone",param:"index_name",label:o("index","gpt3-ai-content-generator")},qdrant:{action:"aipkit_delete_collection_qdrant",param:"collection_name",label:o("collection","gpt3-ai-content-generator")}},t="aipkit_sources_filters_v1";function d(){try{let F=window.localStorage.getItem(t);if(!F)return{};let q=JSON.parse(F);return q&&typeof q=="object"?q:{}}catch{return{}}}function _(F){try{window.localStorage.setItem(t,JSON.stringify(F))}catch{}}function p(F){if(!F)return[];try{let q=JSON.parse(F);return Array.isArray(q)?q:[]}catch{return[]}}function f(F,q){return F?F.length>q?`${F.slice(0,q)}...`:F:""}function g(F){return String(F||"").trim().toLowerCase()}function m(F){return c[g(F)]||null}function u(F){return e[g(F)]||null}function w(F){let q=g(F);return l[q]||l.default}function h(){let F=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return F&&typeof F=="object"?F:{}}function C(F){let q=g(F),O=h();return Object.prototype.hasOwnProperty.call(O,q)?!!O[q]:null}function x(F){let q=C(F);return q===!0?{label:o("Connected","gpt3-ai-content-generator"),className:"aipkit_status-success"}:q===!1?{label:o("Needs setup","gpt3-ai-content-generator"),className:"aipkit_status-warning"}:{label:o("Unknown","gpt3-ai-content-generator"),className:"aipkit_status-info"}}function v(F,q){return!q||typeof q!="object"?"":F==="openai"?q.id||q.vector_store_id||"":F==="pinecone"?q.name||q.id||"":F==="qdrant"?q.name||q.id||q.collection_name||"":q.id||q.name||""}function L(F,q){let O=v(F,q);return!q||typeof q!="object"?O||"\u2014":q.name||q.vector_store_name||O||"\u2014"}function P(F){let q=g(F);return q==="openai"?"openaiVectorStores":q==="pinecone"?"pineconeIndexes":q==="qdrant"?"qdrantCollections":""}function b(F,q){let O=P(F);if(!O)return;(!window.aipkit_chat_config||typeof window.aipkit_chat_config!="object")&&(window.aipkit_chat_config={});let R=Array.isArray(q)?q:[];window.aipkit_chat_config[O]=R,typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),window.dispatchEvent(new CustomEvent("aipkit:vector-store-list-updated",{detail:{provider:g(F),stores:R}}))}function y(F){let q=String(F?.message||"").toLowerCase(),O=g(F?.provider||""),R=String(F?.file_id||""),D=!!F?.post_id;if(q.includes("file content submitted for indexing")||q.includes("file content embedded and upserted")||q.includes("original filename:")||q.includes("file uploaded"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if((O==="pinecone"||O==="qdrant")&&R&&(R.includes("pinecone_file_")||R.includes("file_"))&&!R.startsWith("wp_post_")&&!R.startsWith("text_"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if(q.includes("text content submitted for indexing"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(O==="qdrant"&&q.includes("points upserted to qdrant"))return D||q.includes("post id:")?{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"}:{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(O==="pinecone"&&q.includes("vectors upserted")){if(R.startsWith("wp_post_"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(R.startsWith("text_"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(R.includes("pinecone_file_")||R.includes("file_"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"}}if(q.includes("wordpress post content submitted for indexing"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(D)return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(O==="pinecone"&&R){if(R.startsWith("wp_post_"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(R.startsWith("text_"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"}}return{key:"na",label:o("N/A","gpt3-ai-content-generator"),className:""}}function S(F){let q=F||"";return q==="indexed"||q==="skipped_already_indexed"||q==="success"?{label:o("Trained","gpt3-ai-content-generator"),className:"aipkit_status-success"}:q==="failed"?{label:q.replace(/_/g," "),className:"aipkit_status-warning"}:q?{label:q.replace(/_/g," "),className:"aipkit_status-info"}:{label:"\u2014",className:"aipkit_status-info"}}function E(F){return F.post_title?String(F.post_title):F.post_id?`${o("Post","gpt3-ai-content-generator")} #${F.post_id}`:F.indexed_content?String(F.indexed_content):F.message?String(F.message):F.file_id?String(F.file_id):F.vector_store_name?String(F.vector_store_name):"\u2014"}function A(F){let q=g(F);return q?{openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"}[q]||String(F):"\u2014"}function M(F){let q=g(F);return q&&["openai","pinecone","qdrant"].includes(q)?`aipkit_settings_select_picker_icon--${q}`:""}function $(F){return F.vector_store_name?String(F.vector_store_name):F.vector_store_id?String(F.vector_store_id):"\u2014"}function W(F,q,O){if(!F)return;let R=F.classList.contains("aipkit_training_status");if(F.textContent=q||"",R){F.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),q&&F.classList.add("is-visible"),O&&F.classList.add(`is-${O}`);return}F.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),O==="success"?F.classList.add("aipkit_form-help-success"):O==="error"&&F.classList.add("aipkit_form-help-error")}function H(F,q,O){F&&(F.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${a(O)}</td></tr>`,q&&(q.innerHTML=""))}function N(F,q){if(!F)return;if(!Array.isArray(q)||!q.length){H(F,null,o("No sources found.","gpt3-ai-content-generator"));return}let O=q.map(R=>{let D=y(R),Z=S(R.status),Q=R.status==="processing"||R.status==="queued",fe=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(R.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(R.timestamp):R.timestamp||"\u2014",Ae=A(R.provider),We=M(R.provider),Ge=We?`<span class="aipkit_settings_select_picker_icon ${a(We)}" aria-hidden="true"></span>`:"",it=$(R),_t=f(it,40),mt=Ae?`${Ae} \xB7 ${it}`:it,Ot=String(E(R)||"\u2014"),Nt=f(Ot,s),Ie=R.indexed_content||"",qt=[];return D.key==="site"&&R.post_id&&R.vector_store_id&&R.file_id&&qt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
              data-provider="${a(R.provider||"")}"
              data-store-id="${a(R.vector_store_id||"")}"
              data-vector-id="${a(R.file_id||"")}"
              data-log-id="${a(R.id||"")}"
              data-post-id="${a(R.post_id||"")}"
              data-embedding-provider="${a(R.embedding_provider||"")}"
              data-embedding-model="${a(R.embedding_model||"")}"
              ${Q?'disabled aria-disabled="true"':""}
            >${a(o(Q?"Training...":"Retrain","gpt3-ai-content-generator"))}</button>`),D.key==="text"&&Ie&&R.vector_store_id&&R.file_id&&qt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
              data-provider="${a(R.provider||"")}"
              data-store-id="${a(R.vector_store_id||"")}"
              data-vector-id="${a(R.file_id||"")}"
              data-log-id="${a(R.id||"")}"
              data-embedding-provider="${a(R.embedding_provider||"")}"
              data-embedding-model="${a(R.embedding_model||"")}"
              data-content="${a(encodeURIComponent(Ie))}"
              ${Q?'disabled aria-disabled="true"':""}
            >${a(o(Q?"Training...":"Edit","gpt3-ai-content-generator"))}</button>`),Ie&&qt.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_view"
              data-snippet="${a(Ie)}"
              ${Q?'disabled aria-disabled="true"':""}
            >${a(o("View","gpt3-ai-content-generator"))}</button>`),R.file_id&&qt.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
              data-provider="${a(R.provider||"")}"
              data-store-id="${a(R.vector_store_id||"")}"
              data-vector-id="${a(R.file_id||"")}"
              data-log-id="${a(R.id||"")}"
              ${Q?'disabled aria-disabled="true"':""}
            >${a(o("Delete","gpt3-ai-content-generator"))}</button>`),`<tr data-log-id="${a(R.id||"")}">
          <td>${a(fe)}</td>
          <td title="${a(mt)}">
            <span class="aipkit_popover_option_label_group">
              ${Ge}
              <span>${a(_t)}</span>
            </span>
          </td>
          <td><span class="aipkit_content-type-tag ${a(D.className)}">${a(D.label)}</span></td>
          <td title="${a(Ot)}">${a(Nt)}</td>
          <td><span class="aipkit_status-tag ${a(Z.className)}">${a(Z.label)}</span></td>
          <td class="aipkit_actions_cell">
            <div class="aipkit-table-actions-group">${qt.join("")}</div>
          </td>
        </tr>`}).join("");F.innerHTML=O}function G(F,q,O){if(!q)return;q.innerHTML="";let R=Number(F?.total_logs||0),D=Number(F?.total_pages||0),Z=Number(F?.current_page||1);if(!R)return;let Q=document.createElement("span");if(Q.className="aipkit_pagination-count",Q.textContent=`${R.toLocaleString()} ${i("source","sources",R,"gpt3-ai-content-generator")}`,q.appendChild(Q),D<=1)return;let fe=document.createElement("span");fe.className="aipkit_pagination-links";let Ae=document.createElement("button");Ae.type="button",Ae.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",Ae.textContent=o("Prev","gpt3-ai-content-generator"),Ae.disabled=Z<=1,Ae.addEventListener("click",()=>O(Z-1));let We=document.createElement("span");We.className="aipkit_pagination-current",We.textContent=`${Z}/${D}`;let Ge=document.createElement("button");Ge.type="button",Ge.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",Ge.textContent=o("Next","gpt3-ai-content-generator"),Ge.disabled=Z>=D,Ge.addEventListener("click",()=>O(Z+1)),fe.appendChild(Ae),fe.appendChild(We),fe.appendChild(Ge),q.appendChild(fe)}function J(){let F=document.getElementById("aipkit_sources_module_container");if(!F)return;let q=document.getElementById("aipkit_sources_table_body"),O=document.getElementById("aipkit_sources_pagination"),R=document.getElementById("aipkit_sources_status"),D=document.getElementById("aipkit_sources_provider_filter"),Z=document.getElementById("aipkit_sources_index_filter"),Q=document.getElementById("aipkit_sources_status_filter"),fe=document.getElementById("aipkit_sources_type_filter"),Ae=document.getElementById("aipkit_sources_search_input"),We=document.getElementById("aipkit_sources_provider_popover_body"),Ge=document.getElementById("aipkit_sources_settings_trigger"),it=document.getElementById("aipkit_sources_settings_popover"),_t=document.getElementById("aipkit_sources_indexing_manage"),mt=F.querySelector('[data-aipkit-settings-action="indexing-controls"]'),Ot=_t||mt,Nt=document.getElementById("aipkit_sources_settings_save"),Ie=document.getElementById("aipkit_sources_settings_sheet"),qt=Ie?Ie.querySelector(".aipkit_builder_sheet_close"):null,Wt=document.getElementById("aipkit_save_indexing_settings_btn"),ui=document.getElementById("aipkit_indexing_settings_messages"),ae=document.getElementById("aipkit_sources_settings_sheet_messages"),Ce=document.getElementById("aipkit_sources_semantic_manage"),Le=F.querySelector('[data-aipkit-settings-action="semantic-search"]'),Oe=Ce||Le,$e=document.getElementById("aipkit_sources_semantic_sheet"),He=$e?$e.querySelector(".aipkit_builder_sheet_close"):null,je=document.getElementById("aipkit_sources_semantic_vector_provider"),Qe=document.getElementById("aipkit_sources_semantic_target_id"),xt=document.getElementById("aipkit_sources_semantic_target_label"),bi=document.getElementById("aipkit_sources_semantic_embedding_model"),gt=document.getElementById("aipkit_sources_semantic_embedding_provider"),It=document.getElementById("aipkit_sources_semantic_num_results"),ze=document.getElementById("aipkit_sources_semantic_no_results_text"),Ye=document.getElementById("aipkit_sources_semantic_shortcode_copy"),Ze=document.getElementById("aipkit_sources_semantic_demo_form"),ei=document.getElementById("aipkit_sources_semantic_demo_input"),ci=document.getElementById("aipkit_sources_semantic_demo_results"),Jt=document.getElementById("aipkit_sources_semantic_demo_submit"),Gt=document.getElementById("aipkit_sources_index_empty_action"),Di=document.getElementById("aipkit_sources_index_create_trigger"),bt=document.getElementById("aipkit_sources_editor_modal"),di=bt?bt.querySelector(".aipkit_sources_editor_textarea"):null,Ht=bt?bt.querySelector(".aipkit_sources_editor_close"):null,Wi=bt?bt.querySelector(".aipkit_sources_editor_cancel"):null,Sn=bt?bt.querySelector(".aipkit_sources_editor_save"):null,Ki=document.getElementById("aipkit_sources_view_modal"),ln=Ki?Ki.querySelector(".aipkit_sources_view_textarea"):null,Vn=Ki?Ki.querySelector(".aipkit_sources_view_close"):null,_e=Ki?Ki.querySelector(".aipkit_sources_view_close_btn"):null,be=document.getElementById("aipkit_sources_delete_modal"),Pe=be?be.querySelector(".aipkit_sources_delete_close"):null,At=be?be.querySelector(".aipkit_sources_delete_cancel"):null,et=be?be.querySelector(".aipkit_sources_delete_confirm"):null;if(!q||typeof window.aipkit_apiRequest!="function")return;let Lt=d(),fi=Lt.indexByProvider&&typeof Lt.indexByProvider=="object"?{...Lt.indexByProvider}:{},Vt=Lt.embeddingByProvider&&typeof Lt.embeddingByProvider=="object"?{...Lt.embeddingByProvider}:{};D&&typeof Lt.provider=="string"&&Array.from(D.options).some(te=>te.value===Lt.provider)&&(D.value=Lt.provider),Q&&typeof Lt.status=="string"&&Array.from(Q.options).some(te=>te.value===Lt.status)&&(Q.value=Lt.status),fe&&typeof Lt.type=="string"&&Array.from(fe.options).some(te=>te.value===Lt.type)&&(fe.value=Lt.type),typeof window.aipkit_initChatSelectPickers=="function"&&window.aipkit_initChatSelectPickers();let hi=null,mi=null,Bi=null,gi=null,ti=null,ji=null,Me={page:1,perPage:10,provider:D?D.value:"",status:Q?Q.value:"",type:fe?fe.value:"",search:Ae?Ae.value.trim():"",indexByProvider:fi,embeddingByProvider:Vt,openIndexCreateOnOpen:!1},pi={activeProvider:"",stores:{},syncTokens:{}},Hi={nonce:F.dataset.settingsNonce||"",isPro:F.dataset.settingsIsPro==="1"||F.dataset.settingsIsPro==="true"},En={initialized:!1,accordionsBound:!1,saveBound:!1,autosaveBound:!1,originalSettings:{}},Do=null,Ao=!1,Wo=!1,gn={nonce:F.dataset.semanticSearchNonce||"",pineconeIndexes:p(F.dataset.semanticPineconeIndexes),qdrantCollections:p(F.dataset.semanticQdrantCollections)},uo={initialized:!1,autosaveBound:!1,dirty:!1},Ca=null,Ho=!1,ta=!1,Vo={pinecone_api_key:F.dataset.pineconeApiKey||"",qdrant_api_key:F.dataset.qdrantApiKey||"",qdrant_url:F.dataset.qdrantUrl||""},ia=null,Mn=()=>{hi&&window.clearTimeout(hi),hi=window.setTimeout(()=>{W(R,"","")},3e3)},xr=()=>{gi&&window.clearTimeout(gi),gi=window.setTimeout(()=>{W(ui,"","")},3e3)},xa=()=>!Z||Z.disabled?"":Z.value||"",Uo=()=>!Z||!Z.id?null:document.getElementById(`${Z.id}_picker_btn`),Go=j=>{if(!Z)return;let te=!j;Z.hidden=te;let ce=Uo();ce&&(ce.hidden=te)},na=(j,te={})=>{if(!Z)return;Z.disabled=j;let ce=Uo();ce&&(te.disableTrigger!==!1?(ce.disabled=j,j?ce.setAttribute("aria-disabled","true"):ce.removeAttribute("aria-disabled")):(ce.disabled=!1,ce.removeAttribute("aria-disabled")))},_o=(j,te)=>{if(!Gt||!Di)return;Gt.hidden=!j;let ce=Uo();if(ce&&(j?ce.hidden=!0:(!Z||!Z.hidden)&&(ce.hidden=!1)),!j)return;let re=g(te),ge=w(re);Di.textContent=r(o("Create new %s","gpt3-ai-content-generator"),ge.singular.toLowerCase());let Te=C(re),Ee=!!re&&Te!==!1;Di.disabled=!Ee,Ee?(Di.removeAttribute("aria-disabled"),Di.removeAttribute("title")):(Di.setAttribute("aria-disabled","true"),Di.setAttribute("title",o("Add credentials to create.","gpt3-ai-content-generator")))},oa=j=>{let te=Uo();if(!te||!j)return;let ce=j.getBoundingClientRect(),re={hidden:te.hidden,style:te.getAttribute("style")||""};te.hidden=!1,te.style.position="fixed",te.style.left=`${Math.round(ce.left)}px`,te.style.top=`${Math.round(ce.top)}px`,te.style.width=`${Math.round(ce.width)}px`,te.style.height=`${Math.round(ce.height)}px`,te.style.opacity="0",te.style.pointerEvents="none",te.click();let ge=()=>{te.setAttribute("style",re.style),re.hidden&&(te.hidden=!0)};window.requestAnimationFrame(()=>{window.requestAnimationFrame(ge)})},aa=()=>!Z||!Z.id?null:document.getElementById(`${Z.id}_picker_popover`),An=()=>{let j=aa();if(!j)return null;j.classList.add("aipkit_sources_index_picker_popover");let te=j.querySelector(".aipkit_model_settings_popover_body");if(!te)return null;let ce=te.querySelector(".aipkit_sources_index_picker_actions");return ce||(ce=document.createElement("div"),ce.className="aipkit_sources_index_picker_actions",ce.innerHTML=`
          <div class="aipkit_sources_index_action_list">
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_sources_index_new_btn">
              <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
              ${Yt(o("New","gpt3-ai-content-generator"))}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_delete_btn" disabled aria-disabled="true">
              <span class="dashicons dashicons-trash" aria-hidden="true"></span>
              ${Yt(o("Delete","gpt3-ai-content-generator"))}
            </button>
          </div>
          <div class="aipkit_sources_index_inline_form" style="display: none;">
            <div class="aipkit_popover_options_list">
              <div class="aipkit_popover_option_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label aipkit_sources_index_create_label" for="aipkit_sources_index_name_input">
                    ${Yt(o("Create","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="text"
                      id="aipkit_sources_index_name_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--vector-wide aipkit_popover_option_input--framed"
                      placeholder=""
                      data-aipkit-provider-name-input
                    >
                  </div>
                </div>
              </div>
              <div class="aipkit_popover_option_row aipkit_sources_index_dimension_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label" for="aipkit_sources_index_dimension_input">
                    ${Yt(o("Dimension","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="number"
                      id="aipkit_sources_index_dimension_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--compact aipkit_popover_option_input--framed"
                      min="1"
                      placeholder="${Yt(o("e.g. 1536","gpt3-ai-content-generator"))}"
                      data-aipkit-provider-dimension-input
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="aipkit_sources_index_inline_actions">
              <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_create">
                ${Yt(o("Cancel","gpt3-ai-content-generator"))}
              </button>
              <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_sources_index_create_btn">
                ${Yt(o("Create","gpt3-ai-content-generator"))}
              </button>
            </div>
          </div>
          <div class="aipkit_inline_confirm aipkit_sources_index_inline_confirm" style="display: none;">
            <div class="aipkit_inline_confirm_content">
              <p class="aipkit_builder_help_text aipkit_sources_index_delete_confirm_text"></p>
              <div class="aipkit_inline_confirm_actions">
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_confirm_delete">
                  ${Yt(o("Confirm","gpt3-ai-content-generator"))}
                </button>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_delete">
                  ${Yt(o("Cancel","gpt3-ai-content-generator"))}
                </button>
              </div>
            </div>
          </div>
          <p class="aipkit_form-help aipkit_sources_index_status" aria-live="polite" style="display: none;"></p>
        `,te.appendChild(ce)),ce},fo=()=>{let j=An();return j?{footer:j,actionList:j.querySelector(".aipkit_sources_index_action_list"),newButton:j.querySelector(".aipkit_sources_index_new_btn"),deleteButton:j.querySelector(".aipkit_sources_index_delete_btn"),inlineForm:j.querySelector(".aipkit_sources_index_inline_form"),createButton:j.querySelector(".aipkit_sources_index_create_btn"),cancelCreate:j.querySelector(".aipkit_sources_index_cancel_create"),nameInput:j.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:j.querySelector("[data-aipkit-provider-dimension-input]"),dimensionRow:j.querySelector(".aipkit_sources_index_dimension_row"),createLabel:j.querySelector(".aipkit_sources_index_create_label"),deleteConfirm:j.querySelector(".aipkit_sources_index_inline_confirm"),deleteConfirmText:j.querySelector(".aipkit_sources_index_delete_confirm_text"),confirmDelete:j.querySelector(".aipkit_sources_index_confirm_delete"),cancelDelete:j.querySelector(".aipkit_sources_index_cancel_delete"),statusEl:j.querySelector(".aipkit_sources_index_status")}:null},Lo=(j,te)=>{let ce=fo(),re=R||(ce?ce.statusEl:null);re&&(W(re,j,te),ce&&re===ce.statusEl&&(re.style.display=j?"block":"none"))},qo=()=>{Bi&&window.clearTimeout(Bi),Bi=window.setTimeout(()=>{Lo("","")},3e3)},Rn=()=>{let j=fo();j&&(j.inlineForm&&(j.inlineForm.style.display="none"),j.deleteConfirm&&(j.deleteConfirm.style.display="none"),j.actionList&&(j.actionList.style.display=""),j.nameInput&&(j.nameInput.value=""),j.dimensionInput&&(j.dimensionInput.value=""),Lo("",""))},Bn=j=>{let te=fo();if(!te)return;let ce=g(j),re=ce?C(ce):null,ge=!!ce&&re!==!1,Te=ge&&!!(Z&&Z.value);te.nameInput&&(te.nameInput.disabled=!ge),te.dimensionInput&&(te.dimensionInput.disabled=!ge),te.newButton&&(te.newButton.disabled=!ge,ge?te.newButton.removeAttribute("aria-disabled"):te.newButton.setAttribute("aria-disabled","true")),te.createButton&&(te.createButton.disabled=!ge,ge?te.createButton.removeAttribute("aria-disabled"):te.createButton.setAttribute("aria-disabled","true")),te.deleteButton&&(te.deleteButton.disabled=!Te,Te?te.deleteButton.removeAttribute("aria-disabled"):te.deleteButton.setAttribute("aria-disabled","true"))},Aa=j=>{let te=fo();if(!te||!te.dimensionInput)return;let ce=g(j),re=m(ce);if(!re||!re.needsDimension)return;let ge=re.defaultDimension||1536;te.dimensionInput.value||(te.dimensionInput.value=String(ge))},Fn=j=>{let te=fo();if(!te)return;let ce=g(j),re=m(ce),ge=w(ce),Te=re?re.namePlaceholder:"",Ee=re?re.nameLabel:ge.singular;te.createLabel&&(te.createLabel.textContent=ge.singular),te.nameInput&&(te.nameInput.placeholder=Te,te.nameInput.setAttribute("aria-label",Ee)),te.dimensionRow&&(te.dimensionRow.style.display=re&&re.needsDimension?"":"none"),Bn(ce)},zn=()=>{let j=fo();if(!j||j.footer.dataset.indexActionsBound==="true")return;j.newButton&&j.newButton.addEventListener("click",()=>{Rn(),j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display=""),Aa(D?D.value:""),j.nameInput&&(j.nameInput.focus(),j.nameInput.select())}),j.cancelCreate&&j.cancelCreate.addEventListener("click",()=>{Rn()}),j.deleteButton&&j.deleteButton.addEventListener("click",()=>{let ce=g(D?D.value:""),re=Z?Z.value:"";if(!ce||!re){let Ne=w(ce);Lo(r(o("Select a %s to delete.","gpt3-ai-content-generator"),Ne.singular.toLowerCase()),"error"),qo();return}let ge=Z&&Z.selectedOptions?Z.selectedOptions[0]:null,Te=ge?ge.textContent:re,Ee=u(ce),Re=Ee?Ee.label:w(ce).singular.toLowerCase();j.deleteConfirmText&&(j.deleteConfirmText.textContent=r(o('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Re,Te)),j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display="none"),j.deleteConfirm&&(j.deleteConfirm.style.display="")}),j.cancelDelete&&j.cancelDelete.addEventListener("click",()=>{Rn()}),j.createButton&&j.createButton.addEventListener("click",async()=>{let ce=g(D?D.value:"");if(!ce)return;let re=await Mo(ce,j.createButton,{root:j.inlineForm,statusUpdater:Lo,clearStatusSoon:qo});Bn(ce),re&&re.success&&Rn()}),j.confirmDelete&&j.confirmDelete.addEventListener("click",async()=>{let ce=g(D?D.value:""),re=Z?Z.value:"";if(!ce||!re)return;let ge=Z&&Z.selectedOptions?Z.selectedOptions[0]:null,Te=ge?ge.textContent:re,Ee=await Po(ce,re,Te,j.confirmDelete,{skipConfirm:!0,statusUpdater:Lo,clearStatusSoon:qo,defaultLabel:o("Confirm","gpt3-ai-content-generator")});Un(),Ee&&(Rn(),yn(1))}),j.footer.dataset.indexActionsBound="true";let te=Uo();te&&te.dataset.indexActionsBound!=="true"&&(te.addEventListener("click",()=>{Rn(),Fn(Me.provider||""),Me.openIndexCreateOnOpen&&(Me.openIndexCreateOnOpen=!1,j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display=""),Aa(Me.provider||""),j.nameInput&&(j.nameInput.focus(),j.nameInput.select()))}),te.dataset.indexActionsBound="true")},Qn=(j,te,ce={})=>{if(!Z)return;let re=g(j),ge=re&&Me.indexByProvider[re]||"",Te=w(re),Ee=!!re;Go(Ee),Z.dataset.aipkitPickerTitle=Te.singular;let Re=document.getElementById(`${Z.id}_picker_title`);Re&&(Re.textContent=Te.singular);let Ne=document.getElementById(`${Z.id}_picker_search`);if(Ne){let ft=Te.singular?`Search ${Te.singular.toLowerCase()}...`:o("Search...","gpt3-ai-content-generator");Ne.setAttribute("placeholder",ft)}if(Z.innerHTML="",!Ee){let ft=document.createElement("option");ft.value="",ft.textContent=Te.plural,Z.appendChild(ft),Z.value="",na(!0),_o(!1,re),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(re);return}if(ce.loading){let ft=document.createElement("option");ft.value="",ft.textContent=Te.loading,ft.disabled=!0,Z.appendChild(ft),Z.value="",na(!0,{disableTrigger:!1}),_o(!1,re),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(re);return}let Be=Array.isArray(te)?te:[];if(!Be.length){let ft=document.createElement("option");ft.value="",ft.textContent=ce.emptyLabel||Te.empty,ft.disabled=!0,Z.appendChild(ft),Z.value="",na(!0,{disableTrigger:!1}),_o(!0,re),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),zn(),Fn(re);return}let dt=document.createElement("option");dt.value="",dt.textContent=r(o("All %s","gpt3-ai-content-generator"),Te.plural.toLowerCase()),Z.appendChild(dt),Be.forEach(ft=>{let Xi=v(re,ft),Li=L(re,ft);if(!Xi)return;let Tt=document.createElement("option");Tt.value=Xi,Tt.textContent=Li||Xi,Z.appendChild(Tt)});let Rt=Me.indexByProvider[re]||"",ii=Rt?Be.some(ft=>v(re,ft)===Rt):!1;Rt&&!ii&&(Me.indexByProvider[re]=""),Z.value=ii?Rt:"",na(!1),_o(!1,re),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),re&&ge!==Me.indexByProvider[re]&&_({provider:Me.provider,status:Me.status,type:Me.type,indexByProvider:Me.indexByProvider,embeddingByProvider:Me.embeddingByProvider}),zn(),Fn(re)},mo=()=>ui||R||(We?We.querySelector("#aipkit_sources_provider_panel_status"):null),an=(j,te)=>{let ce=mo();W(ce,j,te)},kn=()=>{mi&&window.clearTimeout(mi),mi=window.setTimeout(()=>{an("","")},3e3)},La=()=>{Ki&&(Ki.classList.remove("aipkit-active"),Ki.setAttribute("aria-hidden","true"),ln&&(ln.value=""))},Cn=j=>{!Ki||!ln||(ln.value=j||"",ln.scrollTop=0,Ki.classList.add("aipkit-active"),Ki.setAttribute("aria-hidden","false"),ln.focus())},Jn=()=>{bt&&(bt.classList.remove("aipkit-active"),bt.setAttribute("aria-hidden","true"),bt.dataset.provider="",bt.dataset.storeId="",bt.dataset.vectorId="",bt.dataset.logId="",bt.dataset.embeddingProvider="",bt.dataset.embeddingModel="",di&&(di.value=""))},er=j=>{!bt||!di||(bt.dataset.provider=j.dataset.provider||"",bt.dataset.storeId=j.dataset.storeId||"",bt.dataset.vectorId=j.dataset.vectorId||"",bt.dataset.logId=j.dataset.logId||"",bt.dataset.embeddingProvider=j.dataset.embeddingProvider||"",bt.dataset.embeddingModel=j.dataset.embeddingModel||"",di.value=j.dataset.content?decodeURIComponent(j.dataset.content):"",bt.classList.add("aipkit-active"),bt.setAttribute("aria-hidden","false"),setTimeout(()=>di.focus(),0))},go=()=>{be&&(be.classList.remove("aipkit-active"),be.setAttribute("aria-hidden","true"),be.dataset.provider="",be.dataset.storeId="",be.dataset.vectorId="",be.dataset.logId="")},Io=j=>{be&&(be.dataset.provider=j.provider||"",be.dataset.storeId=j.storeId||"",be.dataset.vectorId=j.vectorId||"",be.dataset.logId=j.logId||"",be.classList.add("aipkit-active"),be.setAttribute("aria-hidden","false"),et&&(et.disabled=!1))},Ii=j=>{let te=document.getElementById(j);return te?te.value:""},hn=j=>{let te=n[g(j)];return te?Ii(te):""},dn=()=>{let j={...h()};return j.pinecone=!!Vo.pinecone_api_key,j.qdrant=!!(Vo.qdrant_api_key&&Vo.qdrant_url),window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=j,j};dn();let To=j=>j.startsWith("pinecone_")?"pinecone":j.startsWith("qdrant_")?"qdrant":"",tr=async()=>{if(!We)return;let j=We.querySelectorAll("[data-aipkit-provider-config]");if(!j.length)return;let te={},ce=!1,re=new Set;if(j.forEach(ge=>{let Te=ge.dataset.aipkitProviderConfig;if(!Te)return;let Ee=ge.value.trim();if(te[Te]=Ee,Vo[Te]!==Ee){ce=!0;let Re=To(Te);Re&&re.add(Re)}}),!!ce){an(o("Saving...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",te),Object.keys(te).forEach(ge=>{Vo[ge]=te[ge]}),dn(),Un(),re.forEach(ge=>{C(ge)!==!1&&(pi.activeProvider===ge?pn(ge,{silent:!0}):pi.stores[ge]=null)}),an(o("Saved","gpt3-ai-content-generator"),"success"),kn()}catch(ge){let Te=ge&&ge.message?ge.message:o("Save failed.","gpt3-ai-content-generator");an(`${o("Error:","gpt3-ai-content-generator")} ${Te}`,"error"),kn()}}},ra=()=>{ia&&window.clearTimeout(ia),ia=window.setTimeout(()=>{tr()},600)},Yn=(j=We)=>j?{nameInput:j.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:j.querySelector("[data-aipkit-provider-dimension-input]"),deleteButton:j.querySelector("[data-aipkit-provider-delete-selected]")}:{},Un=()=>{let j=g(D?D.value:We?.dataset.provider||""),te=Z?Z.value:"",ce=!!j&&!!te&&C(j)===!0,{deleteButton:re}=Yn();re&&(re.disabled=!ce,ce?re.removeAttribute("aria-disabled"):re.setAttribute("aria-disabled","true")),Bn(j)},$n=(j,te,ce={})=>{let re=g(j),ge=g(D?D.value:"");if(!re){Qn("",[]),Un();return}re===ge&&(Qn(re,te,{loading:ce.loading===!0,emptyLabel:ce.emptyLabel}),Un())},Xn=(j,te,ce,re)=>{j&&(te?(j.disabled=!0,j.setAttribute("aria-disabled","true"),j.textContent=re):(j.disabled=!1,j.removeAttribute("aria-disabled"),j.textContent=ce))},pn=async(j,te={})=>{let ce=m(j);if(!ce)return;let re=g(j),ge=te.silent===!0;if(C(re)===!1){an(o("Add provider credentials to load stores.","gpt3-ai-content-generator"),"error"),kn();return}let Ee=hn(re);if(!Ee){an(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),kn();return}let Re=`${re}-${Date.now()}`;pi.syncTokens[re]=Re,$n(re,pi.stores[re],{loading:!0}),ge||an(o("Syncing stores...","gpt3-ai-content-generator"),"");let Ne={_ajax_nonce:Ee};re==="openai"&&(Ne.limit=100,Ne.order="desc");let Be=te.triggerButton||(We&&We.dataset.provider===re?We.querySelector(".aipkit_sources_provider_sync"):null);Xn(Be,!0,o("Sync","gpt3-ai-content-generator"),o("Syncing...","gpt3-ai-content-generator"));try{let dt=await window.aipkit_apiRequest(ce.listAction,Ne);if(pi.syncTokens[re]!==Re)return;let Rt=Array.isArray(dt[ce.listKey])?dt[ce.listKey]:[];pi.stores[re]=Rt,b(re,Rt),re==="pinecone"?gn.pineconeIndexes=Rt:re==="qdrant"&&(gn.qdrantCollections=Rt),je&&g(je.value)===re&&ko(re,{preserveValue:!0}),pi.activeProvider===re&&$n(re,Rt),ge||(an(dt.message||o("Stores synced.","gpt3-ai-content-generator"),"success"),kn())}catch(dt){if(pi.syncTokens[re]!==Re)return;let Rt=dt&&dt.message?dt.message:o("Sync failed.","gpt3-ai-content-generator");an(`${o("Error:","gpt3-ai-content-generator")} ${Rt}`,"error"),kn(),$n(re,pi.stores[re])}finally{Xn(Be,!1,o("Sync","gpt3-ai-content-generator"),o("Syncing...","gpt3-ai-content-generator"))}},Po=async(j,te,ce,re,ge={})=>{let Te=u(j);if(!Te)return!1;let Ee=g(j),Re=typeof ge.statusUpdater=="function"?ge.statusUpdater:an,Ne=typeof ge.clearStatusSoon=="function"?ge.clearStatusSoon:kn,Be=ge.defaultLabel||(re?re.textContent.trim():"")||o("Delete","gpt3-ai-content-generator"),dt=ge.loadingLabel||o("Deleting...","gpt3-ai-content-generator"),Rt=!1;if(!te)return Re(o("Missing store identifier.","gpt3-ai-content-generator"),"error"),Ne(),!1;let ii=ce||te,ft=r(o('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Te.label,ii);if(ge.skipConfirm!==!0&&!window.confirm(ft))return!1;let Xi=hn(Ee);if(!Xi)return Re(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),Ne(),!1;Xn(re,!0,Be,dt),Re(o("Deleting...","gpt3-ai-content-generator"),"");let Li={_ajax_nonce:Xi};Li[Te.param]=te;try{let Tt=await window.aipkit_apiRequest(Te.action,Li),ki=(Array.isArray(pi.stores[Ee])?pi.stores[Ee]:[]).filter(Ti=>v(Ee,Ti)!==te);pi.stores[Ee]=ki,b(Ee,ki),Ee==="pinecone"?gn.pineconeIndexes=ki:Ee==="qdrant"&&(gn.qdrantCollections=ki),je&&g(je.value)===Ee&&ko(Ee,{preserveValue:!0}),pi.activeProvider===Ee&&$n(Ee,ki),Re(Tt.message||o("Deleted.","gpt3-ai-content-generator"),"success"),Ne(),Rt=!0}catch(Tt){let _i=Tt&&Tt.message?Tt.message:o("Delete failed.","gpt3-ai-content-generator");Re(`${o("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Ne()}finally{Xn(re,!1,Be,dt)}return Rt},Mo=async(j,te,ce={})=>{let re=m(j);if(!re)return{success:!1,createdId:""};let ge=g(j),Te=typeof ce.statusUpdater=="function"?ce.statusUpdater:an,Ee=typeof ce.clearStatusSoon=="function"?ce.clearStatusSoon:kn,Re=!1,Ne="";if(C(ge)===!1)return Te(o("Add provider credentials to create stores.","gpt3-ai-content-generator"),"error"),Ee(),{success:!1,createdId:""};let dt=hn(ge);if(!dt)return Te(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),Ee(),{success:!1,createdId:""};let{nameInput:Rt,dimensionInput:ii}=Yn(ce.root||We),ft=Rt?Rt.value.trim():"";if(!ft)return Te(o("Name is required.","gpt3-ai-content-generator"),"error"),Ee(),{success:!1,createdId:""};let Xi=0;if(re.needsDimension&&(Xi=ii?parseInt(ii.value,10):0,!Xi||Number.isNaN(Xi)))return Te(o("Dimension is required.","gpt3-ai-content-generator"),"error"),Ee(),{success:!1,createdId:""};Xn(te,!0,o("Create","gpt3-ai-content-generator"),o("Creating...","gpt3-ai-content-generator")),Te(o("Creating...","gpt3-ai-content-generator"),"");let Li={_ajax_nonce:dt,name:ft};re.needsDimension&&(Li.dimension=Xi),ge==="openai"&&(Li.source_type="sources_module_create");try{let Tt=await window.aipkit_apiRequest(re.createAction,Li),_i=Tt[re.createKey];if(_i){let ki=Array.isArray(pi.stores[ge])?pi.stores[ge].slice():[];Ne=v(ge,_i),Ne&&ki.some(Ti=>v(ge,Ti)===Ne)||ki.unshift(_i),pi.stores[ge]=ki,b(ge,pi.stores[ge]),ge==="pinecone"?gn.pineconeIndexes=pi.stores[ge]:ge==="qdrant"&&(gn.qdrantCollections=pi.stores[ge]),je&&g(je.value)===ge&&ko(ge,{preserveValue:!0}),pi.activeProvider===ge&&$n(ge,pi.stores[ge])}else await pn(ge);Rt&&(Rt.value=""),ii&&(ii.value=""),Te(Tt.message||o("Store created.","gpt3-ai-content-generator"),"success"),Ee(),Re=!0}catch(Tt){let _i=Tt&&Tt.message?Tt.message:o("Create failed.","gpt3-ai-content-generator");Te(`${o("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Ee()}finally{Xn(te,!1,o("Create","gpt3-ai-content-generator"),o("Creating...","gpt3-ai-content-generator"))}return{success:Re,createdId:Ne}},Dn=j=>{let te=g(j);if(pi.activeProvider=te,Rn(),!te)Qn("",[]);else{let ce=pi.stores[te];if(Array.isArray(ce))$n(te,ce);else if(C(te))$n(te,[],{loading:!0}),pn(te,{silent:!0});else{let re=w(te);$n(te,[],{emptyLabel:r(o("Add credentials to load %s.","gpt3-ai-content-generator"),re.plural.toLowerCase())})}}Un()},sa=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():`text_${Date.now()}`,Bo=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now(),Fo=j=>typeof CSS<"u"&&CSS.escape?CSS.escape(String(j)):String(j).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),ir=async(j,te,ce,re,ge)=>{let Te=j.toLowerCase();if(Te==="openai"){let Ne=Ii("aipkit_vector_store_nonce_openai");if(!Ne)throw new Error(o("OpenAI nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:Ne,target_store_id:te,text_content:ce,source_type:"text_entry_global_form"});return}if(!re||!ge)throw new Error(o("Select an embedding model.","gpt3-ai-content-generator"));let Ee=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ce,embedding_provider:re,embedding_model:ge}),Re=Ee.embeddings&&Ee.embeddings.length?Ee.embeddings[0]:null;if(!Re)throw new Error(o("Failed to generate embedding.","gpt3-ai-content-generator"));if(Te==="pinecone"){let Ne=Ii("aipkit_vector_store_pinecone_nonce_management");if(!Ne)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));let Be=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:Ne,vectors:JSON.stringify([{id:Be,values:Re,metadata:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:ce,vector_id:Be}}]),embedding_provider:re,embedding_model:ge,original_text_content:ce,index_name:te});return}if(Te==="qdrant"){let Ne=Ii("aipkit_vector_store_qdrant_nonce_management");if(!Ne)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));let Be=Bo(),dt={_ajax_nonce:Ne,vectors:JSON.stringify([{id:Be,vector:Re,payload:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:ce,vector_id:Be}}]),embedding_provider:re,embedding_model:ge,original_text_content:ce,collection_name:te,source_context:"sources_module_edit"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",dt);return}throw new Error(o("Unsupported provider for edit.","gpt3-ai-content-generator"))},Yt=window.aipkit_escapeHtml||(j=>j==null?"":String(j)),nr=(j,te)=>{let ce=document.createElement("div");ce.className="aipkit_indexing_settings_section";let re=document.createElement("h5");re.textContent=o("Basic Labels","gpt3-ai-content-generator"),ce.appendChild(re);let ge=document.createElement("table");ge.className="wp-list-table widefat striped",ge.innerHTML=`
        <thead>
          <tr>
            <th>${Yt(o("Label Type","gpt3-ai-content-generator"))}</th>
            <th>${Yt(o("Custom Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Te=ge.querySelector("tbody"),Ee=["source_url","title","excerpt","content"],Re=[o("Source URL","gpt3-ai-content-generator"),o("Title","gpt3-ai-content-generator"),o("Excerpt","gpt3-ai-content-generator"),o("Content","gpt3-ai-content-generator")];return Ee.forEach((Ne,Be)=>{let dt=te&&te[Ne]?te[Ne]:Re[Be],Rt=En.originalSettings?.[j]?.basic_labels?.[Ne]||dt,ii=document.createElement("tr");ii.innerHTML=`
          <td><code>${Yt(Re[Be])}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Yt(j)}][basic_labels][${Yt(Ne)}]"
              value="${Yt(Rt)}"
              placeholder="${Yt(dt)}"
              ${Hi.isPro?"":"disabled"}
            >
          </td>
        `,Te.appendChild(ii)}),ce.appendChild(ge),ce},qa=(j,te,ce,re)=>{let ge=document.createElement("div");if(ge.className="aipkit_indexing_settings_section",!re||Object.keys(re).length===0)return ge.innerHTML=`<p><em>${Yt(r(o("No %s found for this content type.","gpt3-ai-content-generator"),j.toLowerCase()))}</em></p>`,ge;let Te=document.createElement("h5");Te.textContent=j,ge.appendChild(Te);let Ee=document.createElement("table");Ee.className="wp-list-table widefat striped",Ee.innerHTML=`
        <thead>
          <tr>
            <th class="check-column">
              <input type="checkbox" class="aipkit-indexing-select-all" ${Hi.isPro?"":"disabled"} />
            </th>
            <th>${Yt(o("Field / Taxonomy","gpt3-ai-content-generator"))}</th>
            <th>${Yt(o("Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Re=Ee.querySelector("tbody");Object.keys(re).forEach(Be=>{let dt=re[Be],Rt=En.originalSettings?.[te]?.[ce]?.[Be]||{},ii=typeof Rt.enabled=="boolean"?Rt.enabled:!0,ft=Rt.label||"",Xi=document.createElement("tr");Xi.innerHTML=`
          <th scope="row" class="check-column">
            <input
              type="checkbox"
              name="settings[${Yt(te)}][${Yt(ce)}][${Yt(Be)}][enabled]"
              value="1"
              ${ii?"checked":""}
              ${Hi.isPro?"":"disabled"}
            >
          </th>
          <td><code>${Yt(Be)}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Yt(te)}][${Yt(ce)}][${Yt(Be)}][label]"
              value="${Yt(ft)}"
              placeholder="${Yt(dt)}"
              ${Hi.isPro?"":"disabled"}
            >
          </td>
        `,Re.appendChild(Xi)});let Ne=Ee.querySelector(".aipkit-indexing-select-all");return Ne&&Ne.addEventListener("change",Be=>{Re.querySelectorAll('input[type="checkbox"]').forEach(dt=>{dt.checked=Be.target.checked})}),ge.appendChild(Ee),ge},Ia=(j,te,ce)=>{let re=document.createElement("div");re.className="aipkit_accordion";let ge=document.createElement("div");ge.className="aipkit_accordion-header",ge.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${Yt(te)}`;let Te=document.createElement("div");return Te.className="aipkit_accordion-content",Te.appendChild(nr(j,ce.basic_labels||{})),Te.appendChild(qa(o("Custom Fields","gpt3-ai-content-generator"),j,"fields",ce.fields||{})),Te.appendChild(qa(o("Taxonomies","gpt3-ai-content-generator"),j,"taxonomies",ce.taxonomies||{})),j==="product"&&ce.woo_attributes&&Te.appendChild(qa(o("Product Data","gpt3-ai-content-generator"),j,"woo_attributes",ce.woo_attributes)),re.appendChild(ge),re.appendChild(Te),re},Ta=async()=>{let j=document.getElementById("aipkit_indexing_settings_form_container");if(j){if(j.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${Yt(o("Loading content types...","gpt3-ai-content-generator"))}</p>`,!Hi.nonce){j.innerHTML=`<p class="aipkit_text-danger">${Yt(o("Error: Security token is missing. Cannot load settings.","gpt3-ai-content-generator"))}</p>`;return}try{let te=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:Hi.nonce}),ce={},re={};if(te&&typeof te.success<"u"){if(!te.success)throw new Error(te.data||"Failed to load content types.");ce=te.data?.cpt_data||{},re=te.data?.saved_settings||{}}else te&&(ce=te.cpt_data||{},re=te.saved_settings||{});if(En.originalSettings=re||{},j.innerHTML="",!Object.keys(ce).length){j.innerHTML=`<p class="aipkit_text-center">${Yt(o("No content types found. Please add content and try again.","gpt3-ai-content-generator"))}</p>`;return}let ge=document.createElement("div");ge.className="aipkit_accordion-group",Object.keys(ce).forEach(Ee=>{let Re=ce[Ee];ge.appendChild(Ia(Ee,Re.label||Ee,Re))}),j.appendChild(ge);let Te=document.getElementById("aipkit_indexing_settings_form");Te&&!En.accordionsBound&&(Te.addEventListener("click",Ee=>{let Re=Ee.target.closest(".aipkit_accordion-header");Re&&(Re.classList.toggle("aipkit_active"),Re.nextElementSibling&&Re.nextElementSibling.classList.toggle("aipkit_active"))}),En.accordionsBound=!0)}catch(te){j.innerHTML=`<p class="aipkit_text-danger">${Yt(te&&te.message?te.message:o("Failed to load content types.","gpt3-ai-content-generator"))}</p>`}}},or=()=>{let j=document.getElementById("aipkit_indexing_settings_form_container");if(!j)return{};let te={},ce=document.getElementById("aipkit_hide_user_uploads_checkbox");te.hide_user_uploads=ce?ce.checked:!0;let re=document.getElementById("aipkit_show_index_button_checkbox");te.show_index_button=re?re.checked:!0;let ge=document.getElementById("aipkit_chunk_avg_chars_per_token"),Te=document.getElementById("aipkit_chunk_max_tokens_per_chunk"),Ee=document.getElementById("aipkit_chunk_overlap_tokens");if(ge&&Te&&Ee){let Re=parseInt(ge.value,10),Ne=parseInt(Te.value,10),Be=parseInt(Ee.value,10);Number.isNaN(Re)||(te.chunk_avg_chars_per_token=Re),Number.isNaN(Ne)||(te.chunk_max_tokens_per_chunk=Ne),Number.isNaN(Be)||(te.chunk_overlap_tokens=Be)}return j.querySelectorAll('input[type="checkbox"]').forEach(Re=>{let Ne=Re.name.match(/[^[\]']+/g);if(Ne&&Ne.length===5&&Ne[4]==="enabled"){let[,Be,dt,Rt]=Ne;te[Be]||(te[Be]={}),te[Be][dt]||(te[Be][dt]={}),te[Be][dt][Rt]||(te[Be][dt][Rt]={}),te[Be][dt][Rt].enabled=Re.checked}}),j.querySelectorAll('input[type="text"]').forEach(Re=>{let Ne=Re.name.match(/[^[\]']+/g);if(Ne&&Ne.length===5&&Ne[4]==="label"){let[,Be,dt,Rt]=Ne;te[Be]||(te[Be]={}),te[Be][dt]||(te[Be][dt]={}),te[Be][dt][Rt]||(te[Be][dt][Rt]={}),te[Be][dt][Rt].label=Re.value.trim()}else if(Ne&&Ne.length===4&&Ne[2]==="basic_labels"){let[,Be,,dt]=Ne;te[Be]||(te[Be]={}),te[Be].basic_labels||(te[Be].basic_labels={}),te[Be].basic_labels[dt]=Re.value.trim()}}),te},ca=(j,te)=>{if(!j)return;j.dataset.label||(j.dataset.label=j.textContent.trim());let ce=j.dataset.label||o("Save","gpt3-ai-content-generator"),re=j.querySelector(".aipkit_spinner"),ge=j.querySelector(".aipkit_btn-text"),Te=te?o("Saving...","gpt3-ai-content-generator"):ce;ge?ge.textContent=Te:j.textContent=Te,re&&(re.style.display=te?"inline-block":"none"),j.disabled=te},Pa=(j,te)=>{if(!ui)return;W(ui,te,{success:"success",error:"error",info:"loading"}[j]||""),(j==="success"||j==="error")&&xr()},la=async(j={})=>{let{button:te=null,mode:ce="manual"}=j;if(!Hi.nonce)return;te&&ca(te,!0),ce==="auto"&&Pa("info",o("Auto-saving...","gpt3-ai-content-generator"));let re=or();try{let ge=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:Hi.nonce,settings:JSON.stringify(re)});En.originalSettings=re;let Te=ge.message||o("Settings saved!","gpt3-ai-content-generator");Pa("success",ce==="auto"?o("Saved","gpt3-ai-content-generator"):Te)}catch(ge){let Te=ge&&ge.message?ge.message:o("Failed to save settings.","gpt3-ai-content-generator");Pa("error",Te)}finally{te&&ca(te,!1)}},ar=j=>{let te=document.getElementById("aipkit_upgradeBtn");if(te){te.click();return}let ce=j&&j.dataset?j.dataset.upgradeUrl:"";ce&&window.open(ce,"_blank","noopener")},Ar=j=>{j.preventDefault();let te=j.currentTarget;if(te&&te.dataset&&te.dataset.upgradeOnly==="1"){ar(te);return}la({button:j.currentTarget,mode:"manual"})},Ma=async()=>{if(Ao){Wo=!0;return}Ao=!0,await la({mode:"auto"}),Ao=!1,Wo&&(Wo=!1,Ma())},Ba=()=>{Hi.nonce&&(Do&&window.clearTimeout(Do),Do=window.setTimeout(()=>{Ma()},600))},Fa=()=>{if(En.autosaveBound)return;[{element:document.getElementById("aipkit_hide_user_uploads_checkbox"),events:["change"]},{element:document.getElementById("aipkit_show_index_button_checkbox"),events:["change"]},{element:document.getElementById("aipkit_chunk_avg_chars_per_token"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_max_tokens_per_chunk"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_overlap_tokens"),events:["input","change"]}].forEach(({element:te,events:ce})=>{te&&(ce.forEach(re=>{te.addEventListener(re,Ba)}),te.addEventListener("blur",Ba))}),En.autosaveBound=!0},oo=()=>{if(En.initialized)return!0;let j=document.getElementById("indexing-settings-tab-content");return j?j.dataset.initialized==="true"?(En.initialized=!0,!0):(Ta(),En.saveBound||(Wt&&Wt.addEventListener("click",Ar),En.saveBound=!0),Fa(),j.dataset.initialized="true",En.initialized=!0,!0):!1},rr=()=>{it&&(it.classList.remove("aipkit-active"),it.setAttribute("aria-hidden","true"),Ge&&Ge.setAttribute("aria-expanded","false"))},Ko=()=>{Ie&&(Ie.classList.add("aipkit-active"),Ie.setAttribute("aria-hidden","false"),qt&&qt.focus())},da=()=>{Ie&&(Ie.classList.remove("aipkit-active"),Ie.setAttribute("aria-hidden","true"))},sr=()=>ui||R,Ji=(j,te)=>{let ce=sr();W(ce,j,te)},On=()=>{ti&&window.clearTimeout(ti),ti=window.setTimeout(()=>{Ji("","")},3e3)},pa=j=>{if(!xt)return;let te=w(j);xt.textContent=te.singular},ko=(j,te={})=>{if(!Qe)return;let ce=g(j),ge=te.preserveValue===!0?Qe.value:"";Qe.innerHTML=`<option value="">${Yt(o("-- Select --","gpt3-ai-content-generator"))}</option>`;let Te=[];if(ce==="pinecone"?Te=gn.pineconeIndexes:ce==="qdrant"&&(Te=gn.qdrantCollections),Array.isArray(Te)&&Te.forEach(Ee=>{let Re=Ee?.name||Ee?.id||(typeof Ee=="string"?Ee:"");if(!Re)return;let Ne=document.createElement("option");Ne.value=Re,Ne.textContent=Re,Qe.appendChild(Ne)}),ge&&Qe.querySelector(`option[value="${Fo(ge)}"]`))Qe.value=ge;else if(ge){let Ee=document.createElement("option");Ee.value=ge,Ee.textContent=ge,Qe.appendChild(Ee),Qe.value=ge}},ua=()=>{if(!gt||!bi)return;let j=bi.options[bi.selectedIndex];j&&j.dataset.provider&&(gt.value=j.dataset.provider)},wo=()=>({semantic_search_vector_provider:je?je.value:"",semantic_search_target_id:Qe?Qe.value:"",semantic_search_embedding_provider:gt?gt.value:"",semantic_search_embedding_model:bi?bi.value:"",semantic_search_num_results:It?It.value:"",semantic_search_no_results_text:ze?ze.value:""}),Zn=async(j={})=>{let te=j.mode||"auto";ua();let ce=wo();if(ce.semantic_search_vector_provider){te==="auto"&&Ji(o("Saving...","gpt3-ai-content-generator"),"loading");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",ce),uo.dirty=!1,Ji(o(te==="auto"?"Saved":"Settings saved!","gpt3-ai-content-generator"),"success"),On()}catch(re){let ge=re&&re.message?re.message:o("Failed to save settings.","gpt3-ai-content-generator");Ji(`${o("Error:","gpt3-ai-content-generator")} ${ge}`,"error"),On()}}},$a=async()=>{if(Ho){ta=!0;return}Ho=!0,await Zn({mode:"auto"}),Ho=!1,ta&&(ta=!1,$a())},eo=()=>{Ca&&window.clearTimeout(Ca),uo.dirty=!0,Ca=window.setTimeout(()=>{$a()},600)},li=()=>{if(uo.autosaveBound)return;let j=(te,ce=["change"])=>{te&&ce.forEach(re=>te.addEventListener(re,eo))};j(je),j(Qe),j(bi),j(It,["input","change"]),j(ze,["input","change"]),uo.autosaveBound=!0},ho=()=>uo.initialized||!je||!Qe||!bi?!1:(pa(je.value),ko(je.value,{preserveValue:!0}),ua(),li(),uo.initialized=!0,!0),cr=()=>{$e&&(ho(),$e.classList.add("aipkit-active"),$e.setAttribute("aria-hidden","false"),He&&He.focus())},_a=()=>{$e&&($e.classList.remove("aipkit-active"),$e.setAttribute("aria-hidden","true"))},Oa=j=>{if(!Jt)return;let te=Jt.querySelector(".aipkit_spinner");te&&(te.style.display=j?"inline-block":"none"),Jt.disabled=j,Jt.setAttribute("aria-disabled",j?"true":"false")},Si=(j,te="")=>{ci&&(ci.className="aipkit_sources_semantic_results aipkit_form-help",te&&ci.classList.add(`aipkit_form-help-${te}`),ci.textContent=j)},lr=async j=>{if(!ci)return;let te=wo();if(!te.semantic_search_vector_provider||!te.semantic_search_target_id||!te.semantic_search_embedding_model){Si(o("Complete semantic search settings before running a demo.","gpt3-ai-content-generator"));return}if(!gn.nonce){Si(o("Security token missing. Please reload.","gpt3-ai-content-generator"),"error");return}(uo.dirty||Ho)&&await Zn({mode:"auto"}),Oa(!0),ci.innerHTML='<div class="aipkit-search-loading"><span class="aipkit_spinner"></span></div>';try{let ce=await window.aipkit_apiRequest("aipkit_perform_semantic_search",{nonce:gn.nonce,query:j});ci.className="aipkit_sources_semantic_results",ci.innerHTML=ce.html||`<p>${Yt(te.semantic_search_no_results_text||o("No results found.","gpt3-ai-content-generator"))}</p>`}catch(ce){let re=ce&&ce.message?ce.message:o("An error occurred while searching.","gpt3-ai-content-generator");Si(`${o("Error:","gpt3-ai-content-generator")} ${re}`,"error")}finally{Oa(!1)}},yn=async(j=1)=>{Me.page=j,W(R,"",""),q.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${Yt(o("Loading sources...","gpt3-ai-content-generator"))}</td></tr>`,O&&(O.innerHTML="");try{let te=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:Me.page,per_page:Me.perPage,provider:Me.provider,status:Me.status,type:Me.type,search:Me.search,store_id:xa()});N(q,te.logs||[]),G(te.pagination||{},O,yn)}catch(te){let ce=te&&te.message?te.message:o("Error loading sources.","gpt3-ai-content-generator");H(q,O,ce),W(R,ce,"error")}},rn=(()=>{let j=document.getElementById("aipkit_sources_training_toggle"),te=document.getElementById("aipkit_sources_training_card");if(!j||!te)return null;let ce=te.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),re=te.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),ge=te.querySelector(".aipkit_training_text_input"),Te=te.querySelector("#aipkit_training_qa_question"),Ee=te.querySelector("#aipkit_training_qa_answer"),Re=te.querySelector("#aipkit_training_files_input"),Ne=te.querySelector(".aipkit_training_files_button"),Be=te.querySelector(".aipkit_builder_dropzone"),dt=te.querySelector("#aipkit_training_file_list"),Rt=te.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),ii=te.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),ft=te.querySelector(".aipkit_training_stop_btn"),Xi=te.querySelector(".aipkit_training_action_row"),Li=te.querySelector("#aipkit_training_status")||R,Tt=document.getElementById("aipkit_sources_embedding_row"),_i=document.getElementById("aipkit_sources_embedding_model"),ki=te.querySelector("#aipkit_vs_wp_content_mode"),Ti=te.querySelector("#aipkit_vs_wp_content_status"),Pt=te.querySelector("#aipkit_vs_wp_content_status_specific"),Tn=te.querySelector("#aipkit_vs_wp_content_list_area"),Ut=te.querySelector("#aipkit_vs_wp_content_pagination"),Na=te.querySelector("#aipkit_vs_wp_content_messages_area"),Ra=te.querySelector("#aipkit_vs_global_target_select"),un=te.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Ei=te.querySelector("#aipkit_wp_content_bulk_panel"),Da=te.querySelector("#aipkit_wp_content_specific_panel"),pr=te.querySelector("#aipkit_wp_content_bulk_hint"),_n=te.querySelector("#aipkit_wp_content_specific_types_panel"),Ue=te.querySelector("#aipkit_wp_content_status_wrap_bulk"),Wa=te.querySelector("#aipkit_wp_content_status_wrap_specific"),Vi=new Map,zi={page:1,selectedIds:new Set},en=null,ao=null,$o=!1,Ui=(le,xe)=>{Li&&(Li.textContent=le||"",Li.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),le&&Li.classList.add("is-visible"),xe&&Li.classList.add(`is-${xe}`))},vn=(le=2500)=>{en&&window.clearTimeout(en),en=window.setTimeout(()=>{Ui("","")},le)},sn=(le,xe="")=>{if(!Na)return;W(Na,le||"",xe==="error"?"error":xe==="success"?"success":"")},cn=(le=2500)=>{ao&&window.clearTimeout(ao),ao=window.setTimeout(()=>{sn("","")},le)},to=()=>{let le=g(D?D.value:""),xe=Z&&!Z.disabled&&Z.value||"";return!le||!xe?null:{providerKey:le,storeId:xe}},Ha=()=>{let le=g(D?D.value:"");if(!le||le==="all")return Ui(o("Select a provider first.","gpt3-ai-content-generator"),"error"),vn(),!1;let xe=to();if(!xe||!xe.storeId){let ye=w(le);return Ui(r(o("Select a %s first.","gpt3-ai-content-generator"),ye.singular),"error"),vn(),!1}return!0},ma=le=>{if(!Number.isFinite(le))return"";let xe=["B","KB","MB","GB"],ye=le,Ve=0;for(;ye>=1024&&Ve<xe.length-1;)ye/=1024,Ve+=1;let nt=Ve===0?0:1;return`${ye.toFixed(nt)} ${xe[Ve]}`},Ln=()=>{Be&&(Be.style.display=Vi.size>0&&$o?"none":"")},Fi=(le=1500)=>{dt&&window.setTimeout(()=>{Vi.clear(),dt.innerHTML="",Ln()},le)},vo=le=>{if(!dt||!le)return null;let xe=`${le.name}_${le.size}_${le.lastModified}`;if(Vi.has(xe))return Vi.get(xe);let ye=document.createElement("div");ye.className="aipkit_training_file_row",ye.dataset.fileKey=xe;let Ve=document.createElement("div");Ve.className="aipkit_training_file_meta";let nt=document.createElement("span");nt.className="aipkit_training_file_name",nt.textContent=le.name;let yt=document.createElement("span");yt.className="aipkit_training_file_size",yt.textContent=ma(le.size);let rt=document.createElement("span");return rt.className="aipkit_training_file_status",rt.textContent=o("Queued","gpt3-ai-content-generator"),Ve.appendChild(nt),Ve.appendChild(yt),ye.appendChild(Ve),ye.appendChild(rt),dt.appendChild(ye),Vi.set(xe,ye),ye},Pi=(le,xe,ye)=>{let Ve=vo(le);if(!Ve)return;let nt=Ve.querySelector(".aipkit_training_file_status");nt&&(nt.textContent=xe||"",nt.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),ye&&nt.classList.add(`is-${ye}`))},Zi=async(le,xe,ye)=>{if(!le||!le.name||typeof window.aipkit_apiRequest!="function")return!1;let Ve=g(xe);if(!Ve)return!1;let nt=String(le.name||"").trim();if(!nt)return!1;let yt=Et=>String(Et||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),rt=yt(nt),Dt=nt.replace(/\.[^/.]+$/,""),kt=[nt,rt,Dt&&Dt!==nt?Dt:""].filter(Boolean),Bt=async(Et,fn)=>{let ni=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:1,per_page:fn,provider:Ve,store_id:ye||"",type:"file",search:Et||""});return Array.isArray(ni.logs)?ni.logs:[]},ct=(Et,fn)=>{if(!Et.length)return null;let ni=fn.map(yt).filter(Boolean);return Et.find(oi=>{let nn=yt(oi.message),Gi=yt(oi.post_title),Eo=yt(oi.file_id);return ni.some(Pn=>nn&&nn.includes(Pn)||Gi&&Gi.includes(Pn)||Eo&&Eo.includes(Pn))})||null};try{for(let ni of kt){let oi=await Bt(ni,10),nn=ct(oi,[ni,rt]);if(nn){let Gi=String(nn.status||"").toLowerCase();if(Gi==="indexed"||Gi==="skipped_already_indexed"||Gi==="success")return Pi(le,o("Trained","gpt3-ai-content-generator"),"success"),!0;if(Gi==="failed")return Pi(le,o("Failed","gpt3-ai-content-generator"),"error"),!0;if(Gi==="processing"||Gi==="queued")return Pi(le,o("Processing","gpt3-ai-content-generator"),"loading"),!0}}let Et=await Bt("",20),fn=ct(Et,kt);if(fn){let ni=String(fn.status||"").toLowerCase();if(ni==="indexed"||ni==="skipped_already_indexed"||ni==="success")return Pi(le,o("Trained","gpt3-ai-content-generator"),"success"),!0;if(ni==="failed")return Pi(le,o("Failed","gpt3-ai-content-generator"),"error"),!0;if(ni==="processing"||ni==="queued")return Pi(le,o("Processing","gpt3-ai-content-generator"),"loading"),!0}}catch{}return!1},ro=(le,xe,ye,Ve=0)=>{if(!le||!xe||!ye)return;if(Ve>=30){Zi(ye,"openai",le).then(rt=>{rt||Pi(ye,o("Queued","gpt3-ai-content-generator"),"warning")});return}let yt=Ii("aipkit_vector_store_nonce_openai");if(!yt||typeof window.aipkit_apiRequest!="function"){Zi(ye,"openai",le);return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:le,batch_id:xe,_ajax_nonce:yt}).then(rt=>{let Dt=(rt.status||"").toLowerCase();if(Dt==="completed"){Pi(ye,o("Trained","gpt3-ai-content-generator"),"success"),yn(1);return}if(Dt==="failed"||Dt==="cancelled"){Pi(ye,o("Failed","gpt3-ai-content-generator"),"error");return}Pi(ye,o("Processing","gpt3-ai-content-generator"),"loading"),setTimeout(()=>{ro(le,xe,ye,Ve+1)},2500)}).catch(()=>{setTimeout(()=>{ro(le,xe,ye,Ve+1)},3e3)})},ur=le=>le?Array.isArray(le)?le.flatMap(xe=>{if(Array.isArray(xe))return xe;if(xe&&typeof xe=="object"){if(Array.isArray(xe.models))return xe.models;if(Array.isArray(xe.items))return xe.items;if(xe.id)return[xe]}return[]}):typeof le=="object"?Object.values(le).flatMap(xe=>Array.isArray(xe)?xe:[]):[]:[],jo=le=>{let xe=window.aipkit_dashboard?.embeddingModels||{};return ur(xe[le]||[])},ga=(le,xe)=>{if(!xe)return null;let Ve=jo(le).find(rt=>rt&&rt.id===xe),nt=Ve?.dimensions||Ve?.dimension||Ve?.output_dimensionality||Ve?.outputDimensionality||Ve?.output_dimension,yt=nt?Number(nt):NaN;if(Number.isFinite(yt)&&yt>0)return yt;if(Ve&&typeof Ve.name=="string"){let rt=Ve.name.match(/\((\d{3,5})\)/);if(rt)return Number(rt[1])}return le==="google"?768:1536},tn=le=>{if(!_i)return;let xe=g(le),ye=xe&&Me.embeddingByProvider?Me.embeddingByProvider[xe]:"";if(!ye)return;let Ve=Fo(ye);_i.querySelector(`option[value="${Ve}"]`)&&(_i.value=ye)},Gn=()=>{if(!_i)return;let le=_i.value||"",xe=["openai","google","openrouter","azure"],ye={openai:o("OpenAI","gpt3-ai-content-generator"),google:o("Google","gpt3-ai-content-generator"),openrouter:o("OpenRouter","gpt3-ai-content-generator"),azure:o("Azure","gpt3-ai-content-generator")};_i.innerHTML="";let Ve=document.createElement("option");Ve.value="",Ve.textContent=o("Select embedding model","gpt3-ai-content-generator"),_i.appendChild(Ve);let nt=!1;if(xe.forEach(rt=>{let Dt=jo(rt);if(!Dt.length)return;let kt=document.createElement("optgroup");kt.label=ye[rt]||rt,Dt.forEach(Bt=>{let ct=Bt.id||"";if(!ct)return;let Et=document.createElement("option");Et.value=`${rt}::${ct}`,Et.textContent=Bt.name||ct,Et.dataset.provider=rt,Et.dataset.model=ct,kt.appendChild(Et)}),kt.children.length&&(_i.appendChild(kt),nt=!0)}),!nt){_i.innerHTML="";let rt=document.createElement("option");rt.value="",rt.textContent=o("No embedding models found.","gpt3-ai-content-generator"),_i.appendChild(rt),_i.disabled=!0;return}if(_i.disabled=!1,le){let rt=Fo(le);if(_i.querySelector(`option[value="${rt}"]`)){_i.value=le;return}}let yt=_i.querySelector("optgroup option");yt&&(_i.value=yt.value)},Nn=()=>{if(!_i)return null;let le=_i.options[_i.selectedIndex],xe=le&&le.dataset.provider||"",ye=le&&le.dataset.model||"";if(!xe||!ye){let Ve=_i.value||"";if(Ve&&Ve.includes("::")){let[nt,yt]=Ve.split("::");xe=nt||"",ye=yt||""}}return!xe||!ye?null:{provider:xe,model:ye,dimension:ga(xe,ye)}},Va=le=>{!ft||!ii||(le?(ft.hidden=!1,ft.disabled=!1,ii.disabled=!0):(ft.hidden=!0,ft.disabled=!1,ii.disabled=!1))},$i=()=>{let le=to(),xe=g(D?D.value:le?.providerKey||"");if(Rt.forEach(ye=>{ye.disabled=!1,ye.removeAttribute("aria-disabled")}),Tt){let ye=xe==="pinecone"||xe==="qdrant";Tt.hidden=!ye,ye&&tn(xe)}if(Ra){let ye=le?le.storeId:"";Ra.innerHTML=ye?`<option value="${Yt(ye)}">${Yt(ye)}</option>`:'<option value=""></option>',Ra.value=ye}},ot=le=>{if(!ce||!le)return;ce.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(ye=>{let Ve=ye.dataset.aipkitTab===le;ye.classList.toggle("is-active",Ve),ye.setAttribute("aria-selected",Ve?"true":"false")}),re.forEach(ye=>{let Ve=ye.dataset.aipkitPanel===le;ye.classList.toggle("is-active",Ve),ye.hidden=!Ve}),ii&&(ii.style.display=le==="files"?"none":""),Xi&&Xi.classList.toggle("aipkit_builder_action_row--end",le==="files")},Oi=()=>{let le=ce?ce.querySelector(".aipkit_builder_tab.is-active"):null;return le?le.dataset.aipkitTab:""},Oo=()=>ki&&ki.value||"bulk",Ua=le=>{let xe=le==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",ye=document.getElementById(xe);return ye?Array.from(ye.selectedOptions).map(Ve=>Ve.value).filter(Boolean):[]},Ga=le=>{let xe=le==="specific"?Pt:Ti;return xe&&xe.value||"publish"},bo=()=>Tn?Array.from(Tn.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(le=>le.value):[],ka=(le,xe,ye)=>{if(!xe)return;xe.innerHTML="";let Ve=Number(le?.total_posts||0),nt=Number(le?.total_pages||0),yt=Number(le?.current_page||1);if(!Ve)return;let rt=document.createElement("span");if(rt.className="aipkit_pagination-count",rt.textContent=`${Ve.toLocaleString()} ${i("item","items",Ve,"gpt3-ai-content-generator")}`,xe.appendChild(rt),nt<=1)return;let Dt=document.createElement("span");Dt.className="aipkit_pagination-links";let kt=document.createElement("button");kt.type="button",kt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",kt.textContent=o("Prev","gpt3-ai-content-generator"),kt.disabled=yt<=1,kt.addEventListener("click",()=>ye(yt-1));let Bt=document.createElement("span");Bt.className="aipkit_pagination-current",Bt.textContent=`${yt}/${nt}`;let ct=document.createElement("button");ct.type="button",ct.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",ct.textContent=o("Next","gpt3-ai-content-generator"),ct.disabled=yt>=nt,ct.addEventListener("click",()=>ye(yt+1)),Dt.appendChild(kt),Dt.appendChild(Bt),Dt.appendChild(ct),xe.appendChild(Dt)},_r=(le,xe)=>{if(!Tn)return;if(Tn.innerHTML="",!Array.isArray(le)||!le.length){Tn.innerHTML=`<p class="aipkit_builder_help_text">${Yt(o("No posts found for selection.","gpt3-ai-content-generator"))}</p>`,Ut&&(Ut.innerHTML="");return}let ye=document.createElement("ul"),Ve=document.createElement("div");Ve.className="aipkit_wp_content_select_all_wrapper";let nt=document.createElement("label");nt.className="aipkit_training_site_option";let yt=document.createElement("input");yt.type="checkbox",yt.checked=le.every(rt=>zi.selectedIds.has(String(rt.id))),nt.appendChild(yt),nt.appendChild(document.createTextNode(o("Select all","gpt3-ai-content-generator"))),Ve.appendChild(nt),Tn.appendChild(Ve),Tn.appendChild(ye),le.forEach(rt=>{let Dt=document.createElement("li");Dt.className="aipkit_wp_content_list_item";let kt=document.createElement("input");kt.type="checkbox",kt.name="wp_content_to_index[]",kt.value=String(rt.id),kt.checked=zi.selectedIds.has(String(rt.id)),kt.addEventListener("change",()=>{kt.checked?zi.selectedIds.add(String(rt.id)):zi.selectedIds.delete(String(rt.id)),yt.checked=le.every(fn=>zi.selectedIds.has(String(fn.id)))});let Bt=document.createElement("a");Bt.className="aipkit_wp_content_title",Bt.href=rt.edit_link||"#",Bt.target="_blank",Bt.rel="noopener noreferrer",Bt.textContent=rt.title||o("Untitled","gpt3-ai-content-generator");let ct=document.createElement("span");ct.className="aipkit_wp_content_type",ct.textContent=rt.type_label||"";let Et=document.createElement("span");Et.className="aipkit_wp_content_indexed_status",Et.textContent=rt.is_already_indexed?o("Indexed","gpt3-ai-content-generator"):"",Dt.appendChild(kt),Dt.appendChild(Bt),Dt.appendChild(ct),Dt.appendChild(Et),ye.appendChild(Dt)}),yt.addEventListener("change",()=>{yt.checked?le.forEach(rt=>zi.selectedIds.add(String(rt.id))):le.forEach(rt=>zi.selectedIds.delete(String(rt.id))),Tn.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(rt=>{rt.checked=yt.checked})}),ka(xe,Ut,so)},so=async le=>{if(!Tn)return;let xe=to(),ye=Oo(),Ve=Ua(ye);if(!Ve.length){Tn.innerHTML="",Ut&&(Ut.innerHTML=""),sn(o("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let nt=Ii("aipkit_wp_content_fetch_nonce");if(!nt){sn(o("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let yt=Ga(ye);try{sn(o("Loading content...","gpt3-ai-content-generator"),"");let rt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:nt,post_types:Ve,post_status:yt,target_store_id:xe?xe.storeId:"",paged:le});zi.page=le,_r(rt.posts||[],rt.pagination||{}),sn("","")}catch(rt){sn(rt&&rt.message?rt.message:o("Failed to load content.","gpt3-ai-content-generator"),"error")}},zo=le=>{ki&&(ki.value=le),Ei&&(Ei.hidden=le!=="bulk"),_n&&(_n.hidden=le!=="specific"),Da&&(Da.hidden=le!=="specific"),Ue&&(Ue.hidden=le!=="bulk"),Wa&&(Wa.hidden=le!=="specific"),pr&&(pr.hidden=le!=="bulk"),le==="specific"&&so(1)},Ka=()=>{te.querySelectorAll(".aipkit_training_site_dropdown").forEach(xe=>{let ye=xe.querySelector(".aipkit_training_site_dropdown_btn"),Ve=xe.querySelector(".aipkit_training_site_dropdown_label"),nt=xe.querySelector(".aipkit_training_site_dropdown_panel"),rt=xe.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Dt=document.getElementById(rt);if(!ye||!nt||!Dt)return;let kt=()=>{let ct=nt.querySelectorAll('input[type="checkbox"]:checked'),Et=xe.dataset.placeholder||o("Select types","gpt3-ai-content-generator"),fn=xe.dataset.selectedLabel||o("selected","gpt3-ai-content-generator");Ve&&(ct.length?Ve.textContent=`${ct.length} ${fn}`:Ve.textContent=Et)},Bt=()=>{let ct=Array.from(nt.querySelectorAll('input[type="checkbox"]:checked')).map(Et=>Et.value);Array.from(Dt.options).forEach(Et=>{Et.selected=ct.includes(Et.value)})};ye.addEventListener("click",()=>{let ct=ye.getAttribute("aria-expanded")==="true";ye.setAttribute("aria-expanded",ct?"false":"true"),nt.hidden=ct}),nt.addEventListener("change",()=>{Bt(),kt(),Oo()==="specific"&&so(1)}),document.addEventListener("click",ct=>{xe.contains(ct.target)||(ye.setAttribute("aria-expanded","false"),nt.hidden=!0)}),Bt(),kt()})},ja=async(le,xe,ye)=>{let Ve=Ii("aipkit_wp_content_fetch_nonce");if(!Ve)throw new Error("WP content fetch nonce missing.");let nt=[],yt=1,rt=1;do{let Dt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Ve,post_types:le,post_status:xe,target_store_id:ye||"",paged:yt});(Array.isArray(Dt?.posts)?Dt.posts:[]).forEach(ct=>{nt.push({id:String(ct.id),title:ct.title||r(o("Post %s","gpt3-ai-content-generator"),ct.id)})});let Bt=parseInt(Dt?.pagination?.total_pages||1,10);rt=Number.isNaN(Bt)?1:Bt,yt+=1}while(yt<=rt);return nt},za=()=>Tn?Array.from(Tn.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(le=>{let xe=le.closest(".aipkit_wp_content_list_item"),ye=xe?xe.querySelector(".aipkit_wp_content_title"):null;return{id:String(le.value||""),title:ye&&ye.textContent.trim()||r(o("Post %s","gpt3-ai-content-generator"),le.value)}}):[],No=(le,xe,ye,Ve)=>{let nt=r(o("Post %s","gpt3-ai-content-generator"),le),yt=Ve&&Ve.get(String(le))||nt;return r(o("Training: %s (%d/%d)","gpt3-ai-content-generator"),yt,xe+1,ye)},Ro=async(le,xe)=>{if(!window.aipkit_dashboard?.ajaxurl)throw new Error(o("AJAX configuration is missing.","gpt3-ai-content-generator"));le.set("action",xe);let ye=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:le,credentials:"same-origin"}),Ve=await ye.json();if(!ye.ok||!Ve.success){let nt=Ve?.data?.message||o("Upload failed.","gpt3-ai-content-generator");throw new Error(nt)}return Ve.data},wa=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`text_${Date.now()}`,ha=()=>{let le=Nn();return le||(Ui(o("Select an embedding model.","gpt3-ai-content-generator"),"warning"),vn(),null)},fr=async(le,xe)=>{if(!window.aipkit_dashboard?.nonce)throw new Error(o("Embedding nonce missing.","gpt3-ai-content-generator"));let ye=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:le,embedding_provider:xe.provider,embedding_model:xe.model,_ajax_nonce:window.aipkit_dashboard.nonce}),Ve=ye.embeddings&&ye.embeddings.length?ye.embeddings[0]:null;if(!Ve)throw new Error(o("Failed to generate embedding.","gpt3-ai-content-generator"));return Ve},So=async({content:le,indexName:xe,embedding:ye,metadata:Ve})=>{let nt=Ii("aipkit_vector_store_pinecone_nonce_management");if(!nt)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));let yt=await fr(le,ye);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:nt,vectors:JSON.stringify([{id:Ve.vector_id,values:yt,metadata:Ve}]),embedding_provider:ye.provider,embedding_model:ye.model,original_text_content:le,index_name:xe})},mr=async({content:le,collectionName:xe,embedding:ye,metadata:Ve,sourceContext:nt})=>{let yt=Ii("aipkit_vector_store_qdrant_nonce_management");if(!yt)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));let rt=await fr(le,ye),Dt={_ajax_nonce:yt,vectors:JSON.stringify([{id:Ve.vector_id,vector:rt,payload:Ve}]),embedding_provider:ye.provider,embedding_model:ye.model,original_text_content:le,collection_name:xe,source_context:nt||"sources_module"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Dt)},io=async()=>{if($o)return;let le=to();if(!le){Ui(o("Select a provider and index first.","gpt3-ai-content-generator"),"warning"),vn();return}let xe=Oi(),ye="",Ve=[],nt=null,yt="text_entry_global_form",rt="file_upload_global_form";if(xe==="text"){if(ye=ge?ge.value.trim():"",!ye){Ui(o("Add text to train.","gpt3-ai-content-generator"),"warning"),vn();return}}else if(xe==="qa"){let kt=Te?Te.value.trim():"",Bt=Ee?Ee.value.trim():"";if(!kt||!Bt){Ui(o("Add a question and answer to train.","gpt3-ai-content-generator"),"warning"),vn();return}ye=`Q: ${kt}
A: ${Bt}`}else if(xe==="files"){if(Ve=Re?Array.from(Re.files||[]):[],!Ve.length){Re&&Re.click(),Ui(o("Choose files to upload.","gpt3-ai-content-generator"),"warning"),vn();return}}else if(xe==="website"){let kt=Oo(),Bt=Ga(kt),ct=Ua(kt),Et=bo();if(kt==="specific"&&!Et.length){Ui(o("Select content to train.","gpt3-ai-content-generator"),"warning"),vn();return}if(kt==="bulk"&&!ct.length){Ui(o("Select at least one post type.","gpt3-ai-content-generator"),"warning"),vn();return}nt={mode:kt,statusValue:Bt,postTypes:ct,selectedPostIds:Et}}else{Ui(o("Select a training tab to continue.","gpt3-ai-content-generator"),"warning"),vn();return}let Dt=null;if(!((le.providerKey==="pinecone"||le.providerKey==="qdrant")&&(Dt=ha(),!Dt))){$o=!0,Va(!0),Rt.forEach(kt=>{kt.disabled=!0}),Ui(o("Preparing training...","gpt3-ai-content-generator"),"loading");try{if(xe==="files"){Ln();for(let kt=0;kt<Ve.length;kt+=1){let Bt=Ve[kt];Ui(r(o("Uploading %1$d of %2$d...","gpt3-ai-content-generator"),kt+1,Ve.length),"loading"),Pi(Bt,o("Uploading","gpt3-ai-content-generator"),"loading");try{let ct=new FormData;if(le.providerKey==="openai"){let Et=Ii("aipkit_vector_store_nonce_openai");if(!Et)throw new Error(o("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));ct.append("aipkit_vs_global_file_to_submit",Bt),ct.append("target_store_id",le.storeId),ct.append("source_type",rt),ct.append("_ajax_nonce",Et);let fn=await Ro(ct,"aipkit_upload_and_add_file_to_store_direct_openai");Pi(Bt,o("Processing","gpt3-ai-content-generator"),"loading");let ni=fn?.batch?.id;Zi(Bt,le.providerKey,le.storeId).then(oi=>{if(!oi){if(ni){ro(le.storeId,ni,Bt);return}Pi(Bt,o("Queued","gpt3-ai-content-generator"),"warning")}})}else if(le.providerKey==="pinecone"){let Et=Ii("aipkit_vector_store_pinecone_nonce_management");if(!Et)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));ct.append("file_to_upload",Bt),ct.append("index_name",le.storeId),ct.append("embedding_provider",Dt.provider),ct.append("embedding_model",Dt.model),ct.append("_ajax_nonce",Et),await Ro(ct,"aipkit_upload_file_and_upsert_to_pinecone"),Pi(Bt,o("Trained","gpt3-ai-content-generator"),"success")}else if(le.providerKey==="qdrant"){let Et=Ii("aipkit_vector_store_qdrant_nonce_management");if(!Et)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));ct.append("file_to_upload",Bt),ct.append("target_store_id",le.storeId),ct.append("embedding_provider",Dt.provider),ct.append("embedding_model",Dt.model),ct.append("source_context","sources_module_file_upload"),ct.append("_ajax_nonce",Et),await Ro(ct,"aipkit_upload_file_and_upsert_to_qdrant"),Pi(Bt,o("Trained","gpt3-ai-content-generator"),"success")}}catch(ct){throw Pi(Bt,o("Failed","gpt3-ai-content-generator"),"error"),ct}}Re&&(Re.value=""),Ln(),Ui(o("Saved","gpt3-ai-content-generator"),"success"),sn(o("Saved","gpt3-ai-content-generator"),"success"),cn(),vn(),Fi(),yn(1);return}if(xe==="website"&&nt){let{mode:kt,statusValue:Bt,postTypes:ct}=nt,Et=[],fn=new Map;if(kt==="bulk"){Ui(o("Preparing website content...","gpt3-ai-content-generator"),"loading");let ni=await ja(ct,Bt,le.storeId);if(Et=ni.map(oi=>oi.id),fn=new Map(ni.map(oi=>[String(oi.id),oi.title])),!Et.length){sn(o("No posts found for selection.","gpt3-ai-content-generator"),"error"),Ui(o("Nothing to train.","gpt3-ai-content-generator"),"warning"),vn();return}}if(kt!=="bulk"){let ni=za();Et=ni.map(oi=>oi.id),fn=new Map(ni.map(oi=>[String(oi.id),oi.title]))}if(Ui(o("Training...","gpt3-ai-content-generator"),"loading"),sn(r(o("Training %d item(s)...","gpt3-ai-content-generator"),Et.length),""),le.providerKey==="openai"){let ni=Ii("aipkit_wp_content_index_nonce");if(!ni)throw new Error(o("WP content index nonce missing.","gpt3-ai-content-generator"));for(let oi=0;oi<Et.length;oi+=1){let nn=Et[oi];sn(No(nn,oi,Et.length,fn),""),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{_ajax_nonce:ni,post_ids:[nn],target_store_id:le.storeId,provider:"openai"})}}else if(le.providerKey==="pinecone")for(let ni=0;ni<Et.length;ni+=1){let oi=Et[ni];sn(No(oi,ni,Et.length,fn),"");let nn=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Ii("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[oi]}),Gi=nn.posts_content&&nn.posts_content[oi]?nn.posts_content[oi]:null;if(!Gi||!Gi.content)continue;let Eo=Bo(),Pn={source:"wordpress_post",created_at:new Date().toISOString(),post_id:oi,title:Gi.title||"",url:Gi.edit_link||"",vector_id:Eo};Pn.vector_id=Eo,await So({content:Gi.content,indexName:le.storeId,embedding:Dt,metadata:Pn})}else if(le.providerKey==="qdrant")for(let ni=0;ni<Et.length;ni+=1){let oi=Et[ni];sn(No(oi,ni,Et.length,fn),"");let nn=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Ii("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[oi]}),Gi=nn.posts_content&&nn.posts_content[oi]?nn.posts_content[oi]:null;if(!Gi||!Gi.content)continue;let Eo=wa(),Pn={source:"wordpress_post",created_at:new Date().toISOString(),post_id:oi,title:Gi.title||"",url:Gi.edit_link||"",vector_id:Eo};await mr({content:Gi.content,collectionName:le.storeId,embedding:Dt,metadata:Pn,sourceContext:"sources_module_website"})}Ui(o("Saved","gpt3-ai-content-generator"),"success"),vn(),yn(1);return}if(le.providerKey==="openai"){let kt=Ii("aipkit_vector_store_nonce_openai");if(!kt)throw new Error(o("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:kt,target_store_id:le.storeId,text_content:ye,source_type:yt})}else if(le.providerKey==="pinecone"){let kt=Bo(),Bt={source:yt,created_at:new Date().toISOString(),original_content:ye,vector_id:kt};await So({content:ye,indexName:le.storeId,embedding:Dt,metadata:Bt})}else if(le.providerKey==="qdrant"){let kt=Bo(),Bt={source:yt,created_at:new Date().toISOString(),original_content:ye,vector_id:kt};await mr({content:ye,collectionName:le.storeId,embedding:Dt,metadata:Bt,sourceContext:"sources_module_training"})}xe==="text"&&ge&&(ge.value=""),xe==="qa"&&(Te&&(Te.value=""),Ee&&(Ee.value="")),Ui(o("Saved","gpt3-ai-content-generator"),"success"),vn(),yn(1)}catch(kt){Ui(r(o("Error: %s","gpt3-ai-content-generator"),kt?.message||o("Training failed.","gpt3-ai-content-generator")),"error")}finally{$o=!1,Va(!1),$i(),Ln()}}};if(j.addEventListener("click",()=>{let le=te.hidden;te.hidden=!le,j.setAttribute("aria-expanded",le?"true":"false"),le&&($i(),Gn(),tn(D?D.value:""))}),ce){let le=ce.querySelector(".aipkit_builder_tab.is-active");le&&ot(le.dataset.aipkitTab),ce.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(xe=>{xe.addEventListener("click",()=>{ot(xe.dataset.aipkitTab)})})}return Ne&&Re&&Ne.addEventListener("click",()=>{Ha()&&Re.click()}),Re&&Re.addEventListener("change",()=>{if(!Ha()){Re.value="";return}let le=Array.from(Re.files||[]);le.length&&(le.forEach(xe=>{vo(xe),Pi(xe,o("Queued","gpt3-ai-content-generator"))}),Ln(),io())}),Rt.forEach(le=>{le.addEventListener("click",io)}),ft&&ft.addEventListener("click",()=>{$o&&(ft.disabled=!0,Ui(o("Stopping...","gpt3-ai-content-generator"),"warning"))}),_i&&_i.addEventListener("change",()=>{let le=g(D?D.value:"");le&&(Me.embeddingByProvider[le]=_i.value||"",_({provider:Me.provider,status:Me.status,type:Me.type,indexByProvider:Me.indexByProvider,embeddingByProvider:Me.embeddingByProvider}))}),un.length&&un.forEach(le=>{le.addEventListener("change",()=>{le.checked&&zo(le.value)})}),Ti&&Ti.addEventListener("change",()=>{Oo()==="specific"&&so(1)}),Pt&&Pt.addEventListener("change",()=>{Oo()==="specific"&&so(1)}),Ka(),$i(),Gn(),tn(D?D.value:""),zo(Oo()),{updateTargetState:$i}})();D&&D.addEventListener("change",()=>{Me.provider=D.value,Dn(Me.provider),rn?.updateTargetState?.(),_({provider:Me.provider,status:Me.status,type:Me.type,indexByProvider:Me.indexByProvider,embeddingByProvider:Me.embeddingByProvider}),yn(1)}),Di&&Di.addEventListener("click",()=>{g(D?D.value:"")&&(Me.openIndexCreateOnOpen=!0,oa(Di))}),Q&&Q.addEventListener("change",()=>{Me.status=Q.value,_({provider:Me.provider,status:Me.status,type:Me.type,indexByProvider:Me.indexByProvider,embeddingByProvider:Me.embeddingByProvider}),yn(1)}),fe&&fe.addEventListener("change",()=>{Me.type=fe.value,_({provider:Me.provider,status:Me.status,type:Me.type,indexByProvider:Me.indexByProvider,embeddingByProvider:Me.embeddingByProvider}),yn(1)});let fa=()=>{if(!Ae)return;let j=Ae.value.trim();j!==Me.search&&(Me.search=j,yn(1))},dr=()=>{Ae&&(ji&&window.clearTimeout(ji),ji=window.setTimeout(()=>{fa()},300))};if(Ae&&(Ae.addEventListener("input",dr),Ae.addEventListener("search",fa),Ae.addEventListener("keydown",j=>{j.key==="Enter"&&(j.preventDefault(),ji&&window.clearTimeout(ji),fa())})),Z&&Z.addEventListener("change",()=>{let j=g(D?D.value:"");j&&(Me.indexByProvider[j]=Z.value||"",_({provider:Me.provider,status:Me.status,type:Me.type,indexByProvider:Me.indexByProvider,embeddingByProvider:Me.embeddingByProvider}),Un(),rn?.updateTargetState?.(),yn(1))}),We&&We.dataset.configListenersAttached!=="true"){let j=te=>{te.target.closest("[data-aipkit-provider-config]")&&ra()};We.addEventListener("input",j),We.addEventListener("change",j),We.dataset.configListenersAttached="true"}Ht&&Ht.addEventListener("click",Jn),Wi&&Wi.addEventListener("click",Jn),bt&&!bt.dataset.bound&&(document.addEventListener("keydown",j=>{j.key==="Escape"&&bt.classList.contains("aipkit-active")&&Jn()}),bt.dataset.bound="1"),Vn&&Vn.addEventListener("click",La),_e&&_e.addEventListener("click",La),Pe&&Pe.addEventListener("click",go),At&&At.addEventListener("click",go),et&&et.addEventListener("click",async()=>{if(!be)return;let j=be.dataset.provider||"",te=be.dataset.storeId||"",ce=be.dataset.vectorId||"",re=be.dataset.logId||"";if(!j||!te||!ce||!re){W(R,o("Missing source details.","gpt3-ai-content-generator"),"error"),Mn(),go();return}go();let ge=null,Te=[];if(q){let Ee=Fo(re);if(ge=q.querySelector(`tr[data-log-id="${Ee}"]`),ge){Te=Array.from(ge.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")),Te.forEach(Ne=>{Ne.disabled=!0,Ne.setAttribute("aria-disabled","true")});let Re=ge.querySelector(".aipkit_sources_action_delete");Re&&(Re.textContent=o("Deleting...","gpt3-ai-content-generator"))}}et&&(et.disabled=!0),W(R,o("Deleting...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:j,store_id:te,vector_id:ce,log_id:re}),W(R,o("Deleted","gpt3-ai-content-generator"),"success"),Mn(),yn(Me.page||1)}catch(Ee){let Re=Ee&&Ee.message?Ee.message:o("Failed to delete source.","gpt3-ai-content-generator");W(R,`${o("Error:","gpt3-ai-content-generator")} ${Re}`,"error"),Mn(),Te.forEach(Be=>{Be.disabled=!1,Be.removeAttribute("aria-disabled")});let Ne=ge?ge.querySelector(".aipkit_sources_action_delete"):null;Ne&&(Ne.textContent=o("Delete","gpt3-ai-content-generator"))}finally{et&&(et.disabled=!1)}}),Sn&&Sn.addEventListener("click",async()=>{if(!bt||!di)return;let j=di.value.trim();if(!j){W(R,o("Text cannot be empty.","gpt3-ai-content-generator"),"error"),Mn();return}let te=bt.dataset.provider||"",ce=bt.dataset.storeId||"",re=bt.dataset.vectorId||"",ge=bt.dataset.logId||"",Te=bt.dataset.embeddingProvider||"",Ee=bt.dataset.embeddingModel||"";if(!te||!ce||!re||!ge){W(R,o("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}Jn();let Re=[];if(q&&ge){let Ne=Fo(ge),Be=q.querySelector(`tr[data-log-id="${Ne}"]`);Re=Be?Array.from(Be.querySelectorAll(".aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[],Re.forEach(dt=>{dt.disabled=!0,dt.setAttribute("aria-disabled","true"),dt.classList.contains("aipkit_sources_action_edit")&&(dt.textContent=o("Training...","gpt3-ai-content-generator"))})}W(R,o("Training...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:te,store_id:ce,vector_id:re,log_id:ge}),await ir(te,ce,j,Te,Ee),W(R,o("Trained","gpt3-ai-content-generator"),"success"),Mn(),yn(Me.page||1)}catch(Ne){let Be=Ne&&Ne.message?Ne.message:o("Failed to save source.","gpt3-ai-content-generator");W(R,`${o("Error:","gpt3-ai-content-generator")} ${Be}`,"error"),Mn(),Re.forEach(dt=>{dt.disabled=!1,dt.removeAttribute("aria-disabled"),dt.classList.contains("aipkit_sources_action_edit")&&(dt.textContent=o("Edit","gpt3-ai-content-generator"))})}}),F.addEventListener("click",async j=>{let te=j.target.closest(".aipkit_sources_provider_create");if(te){let Re=te.dataset.provider||"";Re&&Mo(Re,te);return}let ce=j.target.closest(".aipkit_sources_provider_delete_selected");if(ce){let Re=g(D?D.value:ce.dataset.provider||""),Ne=Z?Z.value:"";if(!Re||!Ne){let Rt=w(Re);an(r(o("Select a %s to delete.","gpt3-ai-content-generator"),Rt.singular.toLowerCase()),"error"),kn();return}let Be=Z&&Z.selectedOptions?Z.selectedOptions[0]:null,dt=Be?Be.textContent:Ne;Po(Re,Ne,dt,ce);return}let re=j.target.closest(".aipkit_sources_action_edit");if(re){er(re);return}let ge=j.target.closest(".aipkit_sources_action_view");if(ge){let Re=ge.dataset.snippet||"";if(!Re){W(R,o("No preview available for this source.","gpt3-ai-content-generator"),"error"),Mn();return}Cn(Re);return}let Te=j.target.closest(".aipkit_sources_action_delete");if(Te){let Re=Te.dataset.provider||"",Ne=Te.dataset.storeId||"",Be=Te.dataset.vectorId||"",dt=Te.dataset.logId||"";if(!Re||!Ne||!Be||!dt){W(R,o("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}Io({provider:Re,storeId:Ne,vectorId:Be,logId:dt});return}let Ee=j.target.closest(".aipkit_sources_action_retrain");if(Ee){let Re=Ee.dataset.provider||"",Ne=Ee.dataset.storeId||"",Be=Ee.dataset.vectorId||"",dt=Ee.dataset.logId||"",Rt=Ee.dataset.postId||"",ii=Ee.dataset.embeddingProvider||"",ft=Ee.dataset.embeddingModel||"";if(!Re||!Ne||!Be||!dt||!Rt){W(R,o("Missing source details.","gpt3-ai-content-generator"),"error"),Mn();return}let Xi=Ee.closest("tr"),Li=Xi?Array.from(Xi.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[];Li.forEach(Tt=>{Tt.disabled=!0,Tt.setAttribute("aria-disabled","true")}),Ee.textContent=o("Training...","gpt3-ai-content-generator"),W(R,o("Retraining...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:Re,store_id:Ne,vector_id:Be,log_id:dt,post_id:Rt,embedding_provider:ii,embedding_model:ft}),W(R,o("Retrained","gpt3-ai-content-generator"),"success"),Mn(),yn(Me.page||1)}catch(Tt){let _i=Tt&&Tt.message?Tt.message:o("Failed to retrain source.","gpt3-ai-content-generator");W(R,`${o("Error:","gpt3-ai-content-generator")} ${_i}`,"error"),Mn(),Li.forEach(ki=>{ki.disabled=!1,ki.removeAttribute("aria-disabled")}),Ee.textContent=o("Retrain","gpt3-ai-content-generator")}}}),Ge&&Ge.addEventListener("click",()=>{oo()}),Ot&&Ot.addEventListener("click",j=>{j.preventDefault(),oo(),rr(),Ko()}),Oe&&Oe.addEventListener("click",j=>{j.preventDefault(),rr(),cr()}),qt&&qt.addEventListener("click",j=>{j.preventDefault(),da()}),Ie&&Ie.addEventListener("click",j=>{j.target===Ie&&da()}),He&&He.addEventListener("click",j=>{j.preventDefault(),_a()}),$e&&$e.addEventListener("click",j=>{j.target===$e&&_a()}),document.addEventListener("keydown",j=>{j.key==="Escape"&&Ie&&Ie.classList.contains("aipkit-active")&&da(),j.key==="Escape"&&$e&&$e.classList.contains("aipkit-active")&&_a()}),je&&je.addEventListener("change",()=>{let j=je.value;pa(j),ko(j),Qe&&(Qe.value=""),eo()}),Qe&&Qe.addEventListener("change",eo),bi&&bi.addEventListener("change",()=>{ua(),eo()}),It&&(It.addEventListener("input",eo),It.addEventListener("change",eo)),ze&&(ze.addEventListener("input",eo),ze.addEventListener("change",eo)),Ye&&Ye.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode("[aipkit_semantic_search]",Ye)}),Ze&&Ze.addEventListener("submit",j=>{if(j.preventDefault(),!ei)return;let te=ei.value.trim();te&&lr(te)}),ui&&ae&&(ae.innerHTML=""),Dn(D?D.value:""),typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(F),typeof window.aipkitSources_initSettingsPopoverPanels=="function"&&window.aipkitSources_initSettingsPopoverPanels(F),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_sources_module_container"),yn(1)}window.aipkit_initSources=J})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_stats_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let a=r.querySelector(".aipkit_model_settings_popover_title"),s=r.querySelector(".aipkit_model_settings_popover_back"),l=o.querySelector("#aipkit_stats_settings_trigger"),c={root:r.dataset.titleRoot||"Log Settings","log-retention":r.dataset.titleLogRetention||"Log retention"},n=null,e=t=>{let d=t||"root",_=r.querySelector(`[data-aipkit-settings-panel="${d}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!_)return;let p=_.dataset.aipkitSettingsPanel||"root";p!==n&&(i.forEach(f=>{f.hidden=f!==_}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),n=p,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",t=>{let d=t.target.closest("[data-aipkit-panel-target]");if(!d)return;t.preventDefault();let _=d.dataset.aipkitPanelTarget;e(_)}),s&&s.addEventListener("click",t=>{t.preventDefault(),e("root")}),l&&l.addEventListener("click",()=>{e("root")}),e("root"),r.dataset.panelsBound="true"}window.aipkitStats_initSettingsPopoverPanels=k})();(function(){"use strict";let r="aipkit_stats_overview_open",i=e=>typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml(e):(e==null?"":String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a=e=>{let t=Number(e||0);return Number.isNaN(t)?"0":t.toLocaleString()},s=e=>{let t=Number(e);if(!t)return"";let d=new Date(t*1e3);return Number.isNaN(d.getTime())?"":d.toLocaleString()},l=e=>{let t=Number(e);if(!t)return"";let d=Date.now()/1e3,_=Math.floor(d-t);if(Number.isNaN(_)||_<0)return s(t);if(_<60)return"Just now";let p=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],f=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let g of p)if(_>=g.seconds){let m=Math.floor(_/g.seconds);return f?f.format(-m,g.unit):`${m} ${g.unit}${m!==1?"s":""} ago`}return s(t)},c=e=>{if(typeof e=="string")return e;if(e==null)return"";try{return JSON.stringify(e,null,2)}catch{return String(e)}};function n(){let e=document.getElementById("aipkit_stats_container");if(!e)return;typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(e),typeof window.aipkitStats_initSettingsPopoverPanels=="function"&&window.aipkitStats_initSettingsPopoverPanels(e);let t={days:parseInt(e.dataset.defaultDays||30,10)||30,perPage:20,page:1,search:"",botId:"",module:"",selectedLogId:null},d=wp.i18n&&wp.i18n.__?wp.i18n.__:ae=>ae,_={page:1,search:"",botTitles:{}},p=null,f=null,g=null,m=!1,u={status:e.querySelector("#aipkit_stats_status"),overviewPanel:e.querySelector("#aipkit_stats_overview_panel"),overviewToggle:e.querySelector("#aipkit_stats_overview_toggle"),overviewPeriod:e.querySelector("#aipkit_stats_period_label"),totalConversations:e.querySelector("#aipkit_stats_total_conversations"),totalMessages:e.querySelector("#aipkit_stats_total_messages"),uniqueUsers:e.querySelector("#aipkit_stats_unique_users"),avgTokens:e.querySelector("#aipkit_stats_avg_tokens"),daysFilter:e.querySelector("#aipkit_stats_days_filter"),botFilter:e.querySelector("#aipkit_stats_bot_filter"),moduleFilter:e.querySelector("#aipkit_stats_module_filter"),searchInput:e.querySelector("#aipkit_stats_search_input"),exportBtn:e.querySelector("#aipkit_stats_export_btn"),deleteAllBtn:e.querySelector("#aipkit_stats_delete_all_btn"),tableMenu:e.querySelector("#aipkit_stats_table_menu"),tableMenuTrigger:e.querySelector("#aipkit_stats_table_menu_trigger"),tableBody:e.querySelector("#aipkit_stats_table_body"),pagination:e.querySelector("#aipkit_stats_pagination"),detailPanel:e.querySelector("#aipkit_stats_detail_panel"),conversationChart:e.querySelector("#aipkit_stats_conversation_chart"),moduleChart:e.querySelector("#aipkit_stats_module_chart"),settingsToggle:document.getElementById("aipkit_stats_auto_delete_toggle"),retentionSelect:document.getElementById("aipkit_stats_retention_days"),retentionRow:e.querySelector("[data-aipkit-stats-retention-row]"),cronRow:e.querySelector("[data-aipkit-stats-cron-row]"),cronStatus:document.getElementById("aipkit_stats_cron_status"),cronText:document.getElementById("aipkit_stats_cron_text"),cronLastRun:document.getElementById("aipkit_stats_cron_last_run"),settingsPopover:document.getElementById("aipkit_stats_settings_popover"),settingsTrigger:document.getElementById("aipkit_stats_settings_trigger"),settingsUsersNav:e.querySelector('[data-aipkit-settings-action="users"]'),userSheet:document.getElementById("aipkit_stats_user_sheet"),userSheetClose:document.getElementById("aipkit_stats_user_sheet_close"),userSearchInput:document.getElementById("aipkit_stats_user_search"),userTableBody:document.getElementById("aipkit_stats_user_table_body"),userTableFoot:document.querySelector("#aipkit_stats_user_sheet tfoot"),userPagination:document.getElementById("aipkit_stats_user_pagination"),userNoResults:document.getElementById("aipkit_stats_user_no_results"),shortcodeSnippet:document.getElementById("aipkit_stats_shortcode_snippet"),shortcodeToggle:document.getElementById("aipkit_stats_shortcode_toggle"),shortcodeConfig:document.getElementById("aipkit_stats_shortcode_config"),shortcodeOptions:e.querySelectorAll(".aipkit_stats_shortcode_option")},w=(()=>{try{let ae=e.dataset.moduleLabels||"{}";return JSON.parse(ae)}catch{return{}}})(),h=e.dataset.isPro==="1",C=e.dataset.userCreditsNonce||"",x=(ae,Ce="")=>{if(!u.status)return;let Le=u.status,Oe=Le.classList.contains("aipkit_training_status");if(Le.textContent=ae||"",Le.classList.remove("aipkit_status_error","aipkit_status_success","aipkit_status_warning","aipkit_status_loading"),Oe){Le.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ae&&Le.classList.add("is-visible"),Ce&&Le.classList.add(`is-${Ce}`);return}Le.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),Ce==="success"?Le.classList.add("aipkit_form-help-success"):Ce==="error"&&Le.classList.add("aipkit_form-help-error")},v=()=>{try{return localStorage.getItem(r)==="1"}catch{return!1}},L=ae=>{u.retentionRow&&(u.retentionRow.hidden=!ae),u.cronRow&&(u.cronRow.hidden=!ae),u.retentionSelect&&(u.retentionSelect.disabled=!ae||!h)},P=ae=>{!ae||!u.cronStatus||(ae.state&&u.cronStatus.setAttribute("data-state",ae.state),u.cronText&&ae.status_text&&(u.cronText.textContent=ae.status_text),u.cronLastRun&&ae.last_run_label&&(u.cronLastRun.textContent=ae.last_run_label))},b=ae=>{u.tableBody&&(u.tableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${i(ae)}</td>
                </tr>
            `)},y=ae=>{u.userTableBody&&(u.userTableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${i(ae)}</td>
                </tr>
            `,u.userNoResults&&(u.userNoResults.hidden=!0))},S=ae=>{if(!ae)return d("N/A","gpt3-ai-content-generator");let Ce=new Date(ae*1e3);return Number.isNaN(Ce.getTime())?d("N/A","gpt3-ai-content-generator"):Ce.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},E=(ae,Ce)=>{let Le=Array.isArray(ae)?ae:[],Oe='<ul class="aipkit_stats_usage_list">';return Le.length?(Le.forEach(($e,He)=>{let je=He>=2;Oe+=`<li class="${je?"aipkit_stats_usage_extra":""}"${je?" hidden":""}>${$e}</li>`}),Oe+="</ul>",{html:Oe,hasToggle:Le.length>2}):(Oe+=`<li>${i(Ce)}</li>`,Oe+="</ul>",{html:Oe,hasToggle:!1})},A=(ae,Ce)=>{if(!u.userTableBody)return;if(u.userTableBody.innerHTML="",!Array.isArray(ae)||ae.length===0){u.userNoResults&&(u.userNoResults.hidden=!1);return}u.userNoResults&&(u.userNoResults.hidden=!0);let Le=Ce||{};ae.forEach(Oe=>{let $e=document.createElement("tr");$e.dataset.userId=Oe.id;let He=document.createElement("td");He.textContent=`${Oe.display_name} (${Oe.email})`,$e.appendChild(He);let je=document.createElement("td"),Qe=document.createElement("input");Qe.type="number",Qe.className="aipkit_form-input aipkit_stats_credits_balance_input",Qe.value=Oe.token_balance||0,Qe.dataset.userId=Oe.id,Qe.dataset.originalValue=Oe.token_balance||0,Qe.setAttribute("min","0"),Qe.setAttribute("step","1"),Qe.title=d("Press Enter or blur to save changes","gpt3-ai-content-generator"),je.appendChild(Qe);let xt=document.createElement("span");xt.className="aipkit_stats_credits_balance_status",je.appendChild(xt),$e.appendChild(je);let bi=document.createElement("td");bi.textContent=a(Oe.total_used_all_bots||0),$e.appendChild(bi);let gt=document.createElement("td"),It=[],ze=Oe.tokens_used||{},Ye=Oe.image_usage||{used:0};Ye.used>0&&It.push(`<strong>${i(d("Image Generator","gpt3-ai-content-generator"))}:</strong> ${a(Ye.used)}`),Object.keys(ze||{}).sort((Ht,Wi)=>Number(Ht)-Number(Wi)).forEach(Ht=>{let Wi=ze[Ht]||0;if(Wi<=0)return;let Sn=Le[Ht]||`Bot #${Ht}`;It.push(`<strong>${i(Sn)}:</strong> ${a(Wi)}`)});let Ze=E(It,"-");gt.innerHTML=Ze.html+(Ze.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${i(d("Show more","gpt3-ai-content-generator"))}...</button>`:""),$e.appendChild(gt);let ei=document.createElement("td"),ci=[],Jt=Oe.last_reset||{};Ye.used>0&&ci.push(`<strong>${i(d("Image Generator","gpt3-ai-content-generator"))}:</strong> ${i(S(Ye.last_reset))}`);let Gt=new Set([...Object.keys(ze||{}),...Object.keys(Jt||{})]);Array.from(Gt).sort((Ht,Wi)=>Number(Ht)-Number(Wi)).forEach(Ht=>{if((ze||{})[Ht]<=0)return;let Wi=Le[Ht]||`Bot #${Ht}`;ci.push(`<strong>${i(Wi)}:</strong> ${i(S(Jt[Ht]||0))}`)});let Di=It.length>0?d("N/A","gpt3-ai-content-generator"):"-",bt=E(ci,Di);ei.innerHTML=bt.html+(bt.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${i(d("Show more","gpt3-ai-content-generator"))}...</button>`:""),$e.appendChild(ei);let di=document.createElement("td");if(di.className="aipkit_stats_user_actions_cell",Oe.purchase_history&&Oe.purchase_history.length){let Ht=document.createElement("button");Ht.type="button",Ht.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_stats_purchase_history_btn",Ht.title=d("View purchase history","gpt3-ai-content-generator"),Ht.innerHTML='<span class="dashicons dashicons-cart" aria-hidden="true"></span>',Ht.dataset.userName=Oe.display_name,Ht.dataset.history=JSON.stringify(Oe.purchase_history),di.appendChild(Ht)}else di.textContent="-";$e.appendChild(di),u.userTableBody.appendChild($e)})},M=ae=>{if(!u.userPagination||!u.userTableFoot)return;u.userPagination.innerHTML="";let Ce=Number(ae?.total_users||0),Le=Number(ae?.total_pages||0),Oe=Number(ae?.current_page||1);if(!Ce){u.userTableFoot.hidden=!0;return}let $e=document.createElement("span");if($e.className="aipkit_pagination-count",$e.textContent=`${Ce.toLocaleString()} ${d("users","gpt3-ai-content-generator")}`,u.userPagination.appendChild($e),Le<=1){u.userTableFoot.hidden=!0;return}let He=document.createElement("span");He.className="aipkit_pagination-links";let je=document.createElement("button");je.type="button",je.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",je.textContent=`\xAB ${d("Previous","gpt3-ai-content-generator")}`,je.disabled=Oe<=1,je.addEventListener("click",()=>$(Oe-1,_.search));let Qe=document.createElement("span");Qe.className="aipkit_pagination-current",Qe.textContent=`${d("Page","gpt3-ai-content-generator")} ${Oe} ${d("of","gpt3-ai-content-generator")} ${Le}`;let xt=document.createElement("button");xt.type="button",xt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",xt.textContent=`${d("Next","gpt3-ai-content-generator")} \xBB`,xt.disabled=Oe>=Le,xt.addEventListener("click",()=>$(Oe+1,_.search)),He.appendChild(je),He.appendChild(Qe),He.appendChild(xt),u.userPagination.appendChild(He),u.userTableFoot.hidden=!1},$=async(ae=1,Ce="")=>{if(!(!u.userTableBody||typeof window.aipkit_apiRequest!="function")){y(d("Loading user credits...","gpt3-ai-content-generator")),_.page=ae,_.search=Ce;try{let Le=await window.aipkit_apiRequest("aipkit_get_user_credits_data",{page:ae,search:Ce});_.botTitles=Le.bot_titles||{},A(Le.users_data||[],_.botTitles),M(Le.pagination||{})}catch(Le){u.userTableBody&&(u.userTableBody.innerHTML=`
                        <tr>
                            <td colspan="6" class="aipkit_stats_table_placeholder aipkit_text-danger">${i(Le.message||d("Error loading user credits.","gpt3-ai-content-generator"))}</td>
                        </tr>
                    `),u.userNoResults&&(u.userNoResults.hidden=!0),u.userTableFoot&&(u.userTableFoot.hidden=!0)}}},W=()=>{u.settingsPopover&&(u.settingsPopover.classList.remove("aipkit-active"),u.settingsPopover.setAttribute("aria-hidden","true"),u.settingsTrigger&&u.settingsTrigger.setAttribute("aria-expanded","false"))},H=()=>{u.userSheet&&(u.userSheet.classList.add("aipkit-active"),u.userSheet.setAttribute("aria-hidden","false"),$(_.page,_.search),u.userSearchInput&&u.userSearchInput.focus())},N=()=>{u.userSheet&&(u.userSheet.classList.remove("aipkit-active"),u.userSheet.setAttribute("aria-hidden","true"))},G=()=>{if(!u.shortcodeSnippet||!u.shortcodeOptions)return;let ae=!0,Ce=!0,Le=!0;u.shortcodeOptions.forEach(He=>{He.name==="cfg_show_chatbot"&&(ae=He.checked),He.name==="cfg_show_aiforms"&&(Ce=He.checked),He.name==="cfg_show_imagegenerator"&&(Le=He.checked)});let Oe=[];ae||Oe.push('chatbot="false"'),Ce||Oe.push('aiforms="false"'),Le||Oe.push('imagegenerator="false"');let $e="[aipkit_token_usage";Oe.length&&($e+=` ${Oe.join(" ")}`),$e+="]",u.shortcodeSnippet.textContent=$e},J=(ae,Ce)=>{let Le=Array.isArray(ae)?ae:[],Oe=document.createElement("div");Oe.className="aipkit-modal-overlay aipkit-active";let $e=()=>Le.length?Le.map(je=>{let Qe=je?.date?.date?new Date(je.date.date):null,xt=Qe&&!Number.isNaN(Qe.getTime())?Qe.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"",bi=(je.products||[]).map(gt=>`
                                <div class="aipkit_stats_purchase_product">
                                    <span class="aipkit_stats_purchase_product_name">${i(gt.name)}</span>
                                    <span class="aipkit_stats_purchase_product_meta">
                                        ${gt.quantity>1?`${Number(gt.quantity)}x `:""}
                                        ${a(gt.tokens_per_item)} ${i(d("tokens","gpt3-ai-content-generator"))}
                                    </span>
                                </div>
                            `).join("");return`
                            <div class="aipkit_stats_purchase_item">
                                <div class="aipkit_stats_purchase_header">
                                    <div class="aipkit_stats_purchase_date">${i(xt)}</div>
                                    <div class="aipkit_stats_purchase_summary">
                                        <span class="aipkit_stats_purchase_tokens">+${a(je.tokens_granted)}</span>
                                        <span class="aipkit_stats_purchase_amount">${i(je.total_amount)} ${i(je.currency)}</span>
                                    </div>
                                </div>
                                <div class="aipkit_stats_purchase_order">${i(d("Order #","gpt3-ai-content-generator"))}${i(je.order_id)}</div>
                                ${bi?`<div class="aipkit_stats_purchase_products">${bi}</div>`:""}
                            </div>
                        `}).join(""):`<p>${i(d("No purchase history found for this user.","gpt3-ai-content-generator"))}</p>`;Oe.innerHTML=`
                <div class="aipkit-modal-content aipkit_stats_purchase_modal">
                    <div class="aipkit-modal-header">
                        <h3 class="aipkit-modal-title">${i(d("Purchase History for","gpt3-ai-content-generator"))} ${i(Ce||"")}</h3>
                        <button class="aipkit-modal-close-btn" type="button" aria-label="${i(d("Close","gpt3-ai-content-generator"))}">&times;</button>
                    </div>
                    <div class="aipkit-modal-body">
                        <div class="aipkit_stats_purchase_history_list">${$e()}</div>
                    </div>
                </div>
            `;let He=()=>{Oe.classList.remove("aipkit-active"),window.setTimeout(()=>{Oe.parentNode&&Oe.parentNode.removeChild(Oe)},200)};Oe.addEventListener("click",je=>{je.target===Oe&&He()}),Oe.querySelector(".aipkit-modal-close-btn")?.addEventListener("click",He),document.body.appendChild(Oe)},F=ae=>{if(!ae)return;let Ce=ae.dataset.userId,Le=ae.parentElement?ae.parentElement.querySelector(".aipkit_stats_credits_balance_status"):null,Oe=ae.dataset.originalValue||ae.defaultValue,$e=ae.value;if(String($e)!==String(Oe)){if(!C){Le&&(Le.textContent="ERR");return}Le&&(Le.innerHTML='<span class="aipkit_spinner"></span>'),clearTimeout(g),g=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",{_ajax_nonce:C,user_id:Ce,balance:$e}).then(He=>{Le&&(Le.textContent="OK"),ae.dataset.originalValue=He.new_balance,window.setTimeout(()=>{Le&&(Le.textContent="")},1500)}).catch(()=>{Le&&(Le.textContent="ERR"),ae.value=Oe,window.setTimeout(()=>{Le&&(Le.textContent="")},2500)})},400)}},q=ae=>{if(!u.conversationChart)return;u.conversationChart.innerHTML="";let Ce=Object.entries(ae||{});if(!Ce.length){u.conversationChart.innerHTML=`<div class="aipkit_stats_table_placeholder">${i("No data available.")}</div>`;return}let Le=Math.max(...Ce.map(([,It])=>Number(It)||0),1),Oe=document.createElement("div");Oe.className="aipkit_stats_chart_wrapper";let $e=document.createElement("div");$e.className="aipkit_stats_y_axis";let He=4;for(let It=He;It>=0;It--){let ze=document.createElement("span");ze.className="aipkit_stats_y_label";let Ye=Math.round(Le/He*It);ze.textContent=Ye>=1e3?`${(Ye/1e3).toFixed(1)}k`:Ye,$e.appendChild(ze)}Oe.appendChild($e);let je=document.createElement("div");je.className="aipkit_stats_bars_container";for(let It=0;It<He;It++){let ze=document.createElement("div");ze.className="aipkit_stats_grid_line",ze.style.bottom=`${(It+1)/He*100}%`,je.appendChild(ze)}let Qe=document.createElement("div");Qe.className="aipkit_stats_bars_wrapper",Ce.forEach(([It,ze])=>{let Ye=document.createElement("div");Ye.className="aipkit_stats_bar_group";let Ze=document.createElement("div"),ei=Math.max(2,Math.round(Number(ze)/Le*100));Ze.className="aipkit_stats_bar",Ze.style.height=`${ei}%`,Ze.title=`${It}: ${ze}`,Ye.appendChild(Ze),Qe.appendChild(Ye)}),je.appendChild(Qe),Oe.appendChild(je);let xt=document.createElement("div");xt.className="aipkit_stats_x_axis";let bi=Math.min(Ce.length,7),gt=Math.max(1,Math.floor(Ce.length/bi));Ce.forEach(([It],ze)=>{let Ye=document.createElement("span");if(Ye.className="aipkit_stats_x_label",ze%gt===0||ze===Ce.length-1){let Ze=It.split("-");Ye.textContent=Ze.length>=3?`${Ze[1]}/${Ze[2]}`:It}xt.appendChild(Ye)}),Oe.appendChild(xt),u.conversationChart.appendChild(Oe)},O=ae=>{if(u.moduleChart){if(typeof window.aipkit_renderTokenUsageChart!="function"){u.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${i("Chart renderer unavailable.")}</p>`;return}if(!ae||Object.keys(ae).length===0){u.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${i("No data available.")}</p>`;return}window.aipkit_renderTokenUsageChart(u.moduleChart,ae)}},R=ae=>ae?w[ae]?w[ae]:ae.replace(/[_-]/g," ").replace(/\b\w/g,Ce=>Ce.toUpperCase()):w.chatbot||"Chatbot",D=ae=>{if(!u.tableBody)return;if(!Array.isArray(ae)||!ae.length){b("No logs found.");return}let Ce=ae.map(Le=>{let Oe=Le.last_message_content?String(Le.last_message_content):"",$e=l(Le.last_message_ts),He=s(Le.last_message_ts),je=a(Le.total_conversation_tokens||0),Qe=Number(Le.id);return`
                    <tr class="aipkit_stats_row${t.selectedLogId===Qe?" aipkit_stats_row_active":""}" data-log-id="${i(Le.id)}">
                        <td title="${i(He)}">${i($e)}</td>
                        <td>${i(Le.user_display_name||"\u2014")}</td>
                        <td>${i(Le.bot_name||R(Le.module))}</td>
                        <td>${i(a(Le.message_count||0))}</td>
                        <td>${i(je)}</td>
                        <td><span class="aipkit_stats_preview">${i(Oe)}</span></td>
                    </tr>
                `});u.tableBody.innerHTML=Ce.join("")},Z=()=>({days:t.days,bot_id:t.botId,module:t.module,search:t.search}),Q=(ae,Ce)=>{let Le=new Blob([ae],{type:"text/csv;charset=utf-8;"}),Oe=URL.createObjectURL(Le),$e=document.createElement("a");$e.href=Oe,$e.download=Ce||"aipkit-logs.csv",document.body.appendChild($e),$e.click(),$e.remove(),URL.revokeObjectURL(Oe)},fe=async ae=>{if(!(!ae||!window.confirm("Delete this conversation?"))){x("Deleting conversation...");try{let Le=await window.aipkit_apiRequest("aipkit_stats_delete_log",{log_id:ae});x(Le.message||"Conversation deleted."),t.selectedLogId===Number(ae)&&(t.selectedLogId=null,_t(null)),Nt(),window.setTimeout(()=>x(""),2e3)}catch(Le){x(Le.message||"Failed to delete conversation.","error")}}},Ae=async()=>{if(window.confirm("Delete all logs that match the current filters?")){x("Deleting logs...");try{let Ce=await window.aipkit_apiRequest("aipkit_stats_delete_logs",Z());x(Ce.message||"Logs deleted."),t.selectedLogId=null,_t(null),Nt(),window.setTimeout(()=>x(""),2500)}catch(Ce){x(Ce.message||"Failed to delete logs.","error")}}},We=async()=>{x("Preparing export...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_export_logs",Z());if(!ae||!ae.csv)throw new Error("Export failed.");Q(ae.csv,ae.filename),x(ae.message||"Export ready."),window.setTimeout(()=>x(""),2e3)}catch(ae){x(ae.message||"Failed to export logs.","error")}},Ge=ae=>{if(!u.tableMenu||!u.tableMenuTrigger)return;let Ce=ae??u.tableMenu.hidden;u.tableMenu.hidden=!Ce,u.tableMenuTrigger.setAttribute("aria-expanded",Ce?"true":"false")},it=ae=>{if(u.pagination){if(typeof window.aipkit_renderLogsPagination=="function"){window.aipkit_renderLogsPagination(ae,u.pagination,Ce=>{t.page=Ce,Nt()});return}u.pagination.innerHTML=""}},_t=ae=>{if(!u.detailPanel)return;if(!ae){u.detailPanel.innerHTML=`
                    <div class="aipkit_stats_detail_empty">
                        <div>
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.4; margin-bottom: 12px;">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <div>${i("Select a conversation to view details.")}</div>
                        </div>
                    </div>
                `;return}let Ce=Ye=>{let Ze=(Ye||"").toLowerCase();return Ze==="assistant"||Ze==="model"||Ze==="bot"?"bot":Ze==="user"?"user":Ze||"unknown"},Le=(Ye,Ze)=>{for(let ei=Ze+1;ei<Ye.length;ei+=1)if(Ce(Ye[ei]?.role)==="bot")return Ye[ei];return null},Oe=Ye=>Ye>=85?"is-excellent":Ye>=70?"is-good":Ye>=50?"is-fair":"is-poor",$e=`
                <div class="aipkit_stats_detail_header">
                    <div class="aipkit_stats_detail_title">${i(ae.user_display_name||"User")}</div>
                    <div class="aipkit_stats_detail_meta">
                        ${i(ae.bot_name||R(ae.module))}
                        &middot; ${i(s(ae.last_message_ts))}
                        &middot; ${i(a(ae.message_count||0))} ${i("messages")}
                        ${ae.ip_address?`&middot; ${i(`IP ${ae.ip_address}`)}`:""}
                    </div>
                </div>
            `,He=Array.isArray(ae.messages)?ae.messages:[],je=String(ae.module||"").toLowerCase().replace(/[\s-]+/g,"_"),Qe=(()=>{if(typeof window.markdownit!="function")return null;let Ye=window.markdownit({html:!1,linkify:!0,typographer:!0});return window.hljs&&typeof window.markdownitHighlight=="function"&&Ye.use(window.markdownitHighlight,{hljs:window.hljs}),Ye})(),xt=Ye=>{let Ze=String(Ye||"").trim().toLowerCase();return Ze?Ze.startsWith("generate ")||Ze.startsWith("content writer request"):!1},bi=Ye=>{if(!Ye||typeof Ye!="object")return null;let Ze=Ye.payload_sent;if(!Ze||typeof Ze!="object")return null;let ei=Array.isArray(Ze.messages)?Ze.messages:Array.isArray(Ze.input)?Ze.input:null;if(!Array.isArray(ei))return null;let ci=ei.find(Jt=>Jt&&Jt.role==="user"&&typeof Jt.content=="string"&&Jt.content.trim());return ci?ci.content.trim():null},gt=(Ye,Ze)=>{if(!Ye||typeof Ye!="object")return null;let ei={"generate excerpt":"custom_excerpt_prompt","generate tags":"custom_tags_prompt","generate meta description":"custom_meta_prompt","generate focus keyword":"custom_keyword_prompt","generate image prompt":"image_prompt","generate featured image":"featured_image_prompt","generate title":"custom_title_prompt"},ci=String(Ze||"").trim().toLowerCase(),Jt=ei[ci];if(!Jt||typeof Ye[Jt]!="string")return null;let Gt=Ye[Jt].trim();return Gt||null},It=Ye=>{if(!Ye||typeof Ye!="object")return null;for(let Ze in Ye){if(!Object.prototype.hasOwnProperty.call(Ye,Ze)||!/_prompt$/i.test(Ze))continue;let ei=Ye[Ze];if(typeof ei=="string"&&ei.trim())return ei.trim()}return null};if(je==="content_writer"&&Array.isArray(He)&&He.length)for(let Ye=0;Ye<He.length;Ye+=1){let Ze=He[Ye];if(!Ze||Ze.role!=="user"||typeof Ze.content!="string")continue;let ei=Ze.content.trim();if(!ei||!xt(ei))continue;let ci=null,Jt=He[Ye+1]?.request_payload;Jt&&(ci=bi(Jt)),!ci&&Ze.request_payload&&(ci=bi(Ze.request_payload)),!ci&&Ze.request_payload&&(ci=gt(Ze.request_payload,ei)),!ci&&Ze.request_payload&&(ci=It(Ze.request_payload)),ci&&(Ze.original_content=Ze.content,Ze.content=ci)}let ze=He.map((Ye,Ze)=>{let ei=Ce(Ye.role),ci=s(Ye.timestamp),Jt=c(Ye.content),Gt=ei==="user"?"User":ei==="bot"?"Assistant":ei,bt=String(Ye.message_id||`msg_${Ze}`).replace(/[^a-zA-Z0-9_-]/g,"")||`msg_${Ze}`,di=[],Ht="",Wi="",Sn="";if(ei==="user"){let At=Le(He,Ze),et=At?.provider||"",Lt=At?.model||"",fi=At?.usage?.total_tokens??At?.usage?.totalTokenCount??null;et&&di.push(et),Lt&&di.push(Lt),typeof fi=="number"&&fi>0&&di.push(`${a(fi)} tokens`);let Vt=At?.request_payload||null;if(di.length||Vt)if(Vt){let hi=`aipkit_stats_payload_${bt}`,mi=di.length?di.join(" / "):"Request payload";Ht=`
                                <button type="button" class="aipkit_stats_meta_toggle" data-aipkit-stats-toggle="${hi}" aria-expanded="false">
                                    <span>${i(mi)}</span>
                                    <span class="aipkit_stats_meta_chevron" aria-hidden="true"></span>
                                </button>
                            `,Sn+=`
                                <div class="aipkit_stats_expandable" id="${hi}" hidden>
                                    <div class="aipkit_stats_expandable_header">${i("Request Payload")}</div>
                                    <div class="aipkit_stats_expandable_body">
                                        <pre class="aipkit_stats_payload">${i(JSON.stringify(Vt,null,2))}</pre>
                                    </div>
                                </div>
                            `}else di.length&&(Ht=`<div class="aipkit_stats_meta_info">${i(di.join(" / "))}</div>`)}if(ei==="bot"){let At=Array.isArray(Ye.vector_search_scores)?Ye.vector_search_scores:[];if(At.length>0){let et=At.reduce((mi,Bi)=>{let gi=Number(mi?.score??0);return Number(Bi?.score??0)>gi?Bi:mi},At[0]),Lt=et?.score!==void 0?Math.round(Number(et.score)*100):0,fi=Oe(Lt),Vt=`aipkit_stats_scores_${bt}`;Wi=`
                            <button type="button" class="aipkit_stats_score_badge ${fi}" data-aipkit-stats-toggle="${Vt}" aria-expanded="false">
                                ${i(`Score ${Lt}%`)}
                            </button>
                        `;let hi=At.map(mi=>{let Bi=mi?.provider||"Unknown",gi="";if(Bi==="OpenAI")gi=mi.store_name||mi.store_id?` \xB7 ${mi.store_name||mi.store_id}`:"";else if(Bi==="Pinecone"){let pi=mi.namespace?` \xB7 ${mi.namespace}`:"";gi=mi.index_name?` \xB7 ${mi.index_name}${pi}`:pi}else Bi==="Qdrant"&&(gi=mi.collection_name?` \xB7 ${mi.collection_name}`:"");let ti=mi?.score!==void 0?Math.round(Number(mi.score)*100):null,ji=ti!==null?Oe(ti):"is-poor",Me=mi?.content_preview||"";return`
                                <div class="aipkit_stats_score_item">
                                    <div class="aipkit_stats_score_title">${i(Bi)}${i(gi)}</div>
                                    <div class="aipkit_stats_score_value ${ji}">
                                        ${i(ti!==null?`${ti}%`:"\u2014")}
                                    </div>
                                    <div class="aipkit_stats_score_preview">${i(Me)}</div>
                                </div>
                            `}).join("");Sn+=`
                            <div class="aipkit_stats_expandable" id="${Vt}" hidden>
                                <div class="aipkit_stats_expandable_header">${i("Vector Search Results")}</div>
                                <div class="aipkit_stats_expandable_body aipkit_stats_scores_list">
                                    ${hi}
                                </div>
                            </div>
                        `}}let Ki=!!Ht,ln=!!Wi,_e=Ki||ln?`
                    <div class="aipkit_stats_meta_bar${Ki&&!ln||!Ki&&ln?" aipkit_stats_meta_bar--compact":""}">
                        ${Ki?Ht:""}
                        <div class="aipkit_stats_meta_actions">
                            ${Wi||""}
                        </div>
                    </div>
                `:"",be=!!(Qe&&typeof Jt=="string"),Pe=be?Qe.render(Jt):i(Jt);return`
                    <div class="aipkit_stats_message aipkit_stats_message--${i(ei)}" style="animation-delay: ${Ze*.05}s">
                        <div class="aipkit_stats_message_meta">${i(Gt)}${ci?` \xB7 ${i(ci)}`:""}</div>
                        <div class="aipkit_stats_message_body${be?" aipkit_stats_message_body--markdown":""}">${Pe}</div>
                        ${_e}
                        ${Sn}
                    </div>
                `}).join("");u.detailPanel.innerHTML=`
                ${$e}
                <div class="aipkit_stats_detail_messages">
                    ${ze||`<div class="aipkit_stats_table_placeholder">${i("No messages found.")}</div>`}
                    <div class="aipkit_stats_detail_footer">
                        <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_stats_detail_delete" data-log-id="${i(ae.id)}">
                            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                            ${i("Delete")}
                        </button>
                    </div>
                </div>
            `},mt=async()=>{x("Loading stats...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_overview",{days:t.days});u.totalConversations.textContent=a(ae.summary?.total_conversations||0),u.totalMessages.textContent=a(ae.summary?.total_messages||0),u.uniqueUsers.textContent=a(ae.summary?.unique_users||0),u.avgTokens.textContent=a(ae.summary?.avg_tokens||0),u.overviewPeriod&&(u.overviewPeriod.textContent=ae.summary?.period_label||""),q(ae.charts?.daily_conversations||{}),O(ae.charts?.daily_tokens||{}),x("")}catch(ae){x(ae.message||"Failed to load stats.","error")}},Ot=(ae,Ce=!0)=>{if(u.overviewPanel){if(u.overviewPanel.hidden=!ae,u.overviewToggle&&(u.overviewToggle.setAttribute("aria-expanded",ae?"true":"false"),u.overviewToggle.classList.toggle("is-active",ae)),Ce)try{localStorage.setItem(r,ae?"1":"0")}catch{}ae&&mt()}},Nt=async()=>{b("Loading logs...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_logs",{days:t.days,page:t.page,per_page:t.perPage,bot_id:t.botId,module:t.module,search:t.search}),Ce=Array.isArray(ae.logs)?ae.logs:[];!t.selectedLogId&&!m&&Ce.length&&(t.selectedLogId=Number(Ce[0].id),m=!0),D(Ce),it(ae.pagination||{}),t.selectedLogId&&m&&Ie(t.selectedLogId)}catch(ae){b(ae.message||"Failed to load logs.")}},Ie=async ae=>{if(!ae){_t(null);return}u.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${i("Loading conversation...")}</div>`;try{let Ce=await window.aipkit_apiRequest("aipkit_stats_get_log_detail",{log_id:ae});_t(Ce)}catch(Ce){u.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${i(Ce.message||"Failed to load conversation.")}</div>`}},qt=ae=>{t.search=ae.trim(),t.page=1,p&&clearTimeout(p),p=window.setTimeout(()=>{Nt()},300)},Wt=async()=>{if(u.cronStatus)try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_log_cron_status",{});P(ae)}catch{}},ui=async()=>{if(!u.settingsToggle||!u.retentionSelect)return;let ae=u.settingsToggle.checked?"1":"0",Ce=parseInt(u.retentionSelect.value,10)||90;x("Saving settings...","loading");try{let Le=await window.aipkit_apiRequest("aipkit_stats_save_settings",{enable_pruning:ae,retention_period_days:Ce});L(u.settingsToggle.checked),x(Le.message||"Settings saved.","success"),Wt(),window.setTimeout(()=>x(""),2e3)}catch(Le){x(Le.message||"Failed to save settings.","error")}};if(u.daysFilter&&(u.daysFilter.value=String(t.days),u.daysFilter.addEventListener("change",()=>{t.days=parseInt(u.daysFilter.value,10)||30,t.page=1,u.overviewPanel&&!u.overviewPanel.hidden&&mt(),Nt()})),u.botFilter&&u.botFilter.addEventListener("change",()=>{t.botId=u.botFilter.value,t.page=1,Nt()}),u.moduleFilter&&u.moduleFilter.addEventListener("change",()=>{t.module=u.moduleFilter.value,t.page=1,Nt()}),u.searchInput&&u.searchInput.addEventListener("input",ae=>{qt(ae.target.value||"")}),u.overviewToggle&&u.overviewPanel&&u.overviewToggle.addEventListener("click",()=>{let ae=!u.overviewPanel.hidden;Ot(!ae)}),u.tableBody&&u.tableBody.addEventListener("click",ae=>{let Ce=ae.target.closest("tr[data-log-id]");if(!Ce)return;let Le=Ce.getAttribute("data-log-id");Le&&(t.selectedLogId=Number(Le),u.tableBody.querySelectorAll("tr").forEach(Oe=>{Oe.classList.toggle("aipkit_stats_row_active",Oe===Ce)}),Ie(Le))}),u.detailPanel&&u.detailPanel.addEventListener("click",ae=>{let Ce=ae.target.closest(".aipkit_stats_detail_delete");if(!Ce){let Le=ae.target.closest("[data-aipkit-stats-toggle]");if(!Le)return;let Oe=Le.getAttribute("data-aipkit-stats-toggle");if(!Oe)return;let $e=document.getElementById(Oe);if(!$e)return;let He=Le.getAttribute("aria-expanded")==="true";$e.hidden=He,Le.setAttribute("aria-expanded",He?"false":"true"),Le.classList.toggle("is-expanded",!He);return}fe(Ce.getAttribute("data-log-id"))}),u.tableMenuTrigger&&u.tableMenu&&u.tableMenuTrigger.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),Ge(u.tableMenu.hidden)}),document.addEventListener("click",ae=>{!u.tableMenu||u.tableMenu.hidden||ae.target.closest("#aipkit_stats_table_menu")||ae.target.closest("#aipkit_stats_table_menu_trigger")||Ge(!1)}),document.addEventListener("keydown",ae=>{ae.key!=="Escape"||!u.tableMenu||u.tableMenu.hidden||Ge(!1)}),u.deleteAllBtn&&u.deleteAllBtn.addEventListener("click",()=>{Ge(!1),Ae()}),u.exportBtn&&u.exportBtn.addEventListener("click",()=>{Ge(!1),We()}),u.settingsToggle&&u.settingsToggle.addEventListener("change",()=>{if(!h){u.settingsToggle.checked=!1,x("Upgrade to Pro to enable auto-delete.","error");return}L(u.settingsToggle.checked),ui()}),u.retentionSelect&&u.retentionSelect.addEventListener("change",()=>{h&&ui()}),u.shortcodeToggle&&u.shortcodeConfig&&u.shortcodeToggle.addEventListener("click",ae=>{ae.preventDefault();let Ce=!u.shortcodeConfig.hidden;u.shortcodeConfig.hidden=Ce,u.shortcodeToggle.setAttribute("aria-expanded",Ce?"false":"true"),u.shortcodeToggle.classList.toggle("is-active",!Ce)}),u.shortcodeOptions&&u.shortcodeOptions.length&&(u.shortcodeOptions.forEach(ae=>{ae.addEventListener("change",G)}),G()),u.shortcodeSnippet&&u.shortcodeSnippet.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(u.shortcodeSnippet.textContent,u.shortcodeSnippet)}),u.settingsUsersNav&&u.settingsUsersNav.addEventListener("click",ae=>{ae.preventDefault(),W(),H()}),u.userSheetClose&&u.userSheetClose.addEventListener("click",ae=>{ae.preventDefault(),N()}),u.userSheet&&u.userSheet.addEventListener("click",ae=>{ae.target===u.userSheet&&N()}),u.userSearchInput&&(u.userSearchInput.addEventListener("input",()=>{clearTimeout(f);let ae=u.userSearchInput.value.trim();f=window.setTimeout(()=>{$(1,ae)},350)}),u.userSearchInput.addEventListener("keydown",ae=>{if(ae.key==="Enter"){ae.preventDefault(),clearTimeout(f);let Ce=u.userSearchInput.value.trim();$(1,Ce),u.userSearchClear&&(u.userSearchClear.hidden=Ce.length===0)}})),u.userSearchClear&&u.userSearchClear.addEventListener("click",()=>{u.userSearchInput&&(u.userSearchInput.value=""),u.userSearchClear.hidden=!0,$(1,"")}),u.userTableBody){let ae="data-user-credits-listeners";u.userTableBody.getAttribute(ae)||(u.userTableBody.addEventListener("change",Ce=>{Ce.target.matches(".aipkit_stats_credits_balance_input")&&F(Ce.target)}),u.userTableBody.addEventListener("keypress",Ce=>{Ce.key==="Enter"&&Ce.target.matches(".aipkit_stats_credits_balance_input")&&(Ce.preventDefault(),Ce.target.blur())}),u.userTableBody.addEventListener("click",Ce=>{let Le=Ce.target.closest(".aipkit_stats_usage_toggle");if(Le){Ce.preventDefault();let $e=Le.closest("td");if($e){let He=$e.querySelectorAll(".aipkit_stats_usage_extra");if(He.length){let je=He[0].hidden;He.forEach(Qe=>{Qe.hidden=!je}),Le.textContent=je?d("Show less","gpt3-ai-content-generator"):`${d("Show more","gpt3-ai-content-generator")}...`}}return}let Oe=Ce.target.closest(".aipkit_stats_purchase_history_btn");if(Oe){Ce.preventDefault();let $e=Oe.dataset.history?JSON.parse(Oe.dataset.history):[];J($e,Oe.dataset.userName||"")}}),u.userTableBody.setAttribute(ae,"true"))}document.addEventListener("keydown",ae=>{ae.key==="Escape"&&u.userSheet&&u.userSheet.classList.contains("aipkit-active")&&N()}),Ot(v(),!1),Nt(),L(!!u.settingsToggle?.checked)}window.aipkit_initStats=n})();(function(){"use strict";function k(){let o={},r=document.getElementById("aipkit_settings_container");return r&&r.querySelectorAll("input[name], select[name], textarea[name]").forEach(a=>{a.type==="checkbox"?o[a.name]=a.checked?"1":"0":a.type==="radio"?a.checked&&(o[a.name]=a.value):o[a.name]=a.value}),o}window.aipkit_getCurrentFormData=k})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function k(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let o=window.aipkit_getCurrentFormData(),r=window.aipkit_lastSavedData||{};if(JSON.stringify(o)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let i="aipkit_settings_global_messages";window.aipkit_showSavingIndicator(i,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",o),window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"success","Settings saved!"),window.aipkit_lastSavedData=o,typeof window.aipkit_queueProviderAutoSync=="function"&&window.aipkit_queueProviderAutoSync(r,o)}catch(a){window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"error","Save failed: "+a.message),console.error("AIPKit Auto-Save Error:",a)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let i="data-autosave-listener-attached";r.getAttribute(i)||(r.addEventListener("change",function(a){let s=a.target;s.matches(".aipkit_autosave_trigger")&&s.id!=="aipkit_provider"&&(s.tagName.toLowerCase()==="select"||s.type==="checkbox"||s.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),r.addEventListener("blur",function(a){let s=a.target;if(s.matches(".aipkit_autosave_trigger")&&s.id!=="aipkit_provider"){let l=s.tagName.toLowerCase();(l==="input"||l==="textarea")&&s.type!=="range"&&s.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),r.setAttribute(i,"true"))}function o(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=k,window.aipkit_updateLastSavedData=o})();(function(){"use strict";function k(r){try{return new Date(r+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return r}}function o(r){return typeof r!="number"?r:r.toLocaleString()}window.aipkit_formatChartDate=k,window.aipkit_formatChartNumber=o})();(function(){"use strict";let k=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],o="#B0BEC5",r={};function i(s){r={};let l=0;s.forEach(c=>{if(c==="Other")r[c]=o;else{let n;do n=k[l%k.length],l++;while(n===o&&k.length>1);r[c]=n}})}function a(s){return r[s]||"#cccccc"}window.aipkit_assignModuleColors=i,window.aipkit_getModuleColor=a})();(function(){"use strict";function k(a,s){if(!s||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let l=a.target,c=l.getAttribute("data-date"),n=l.getAttribute("data-module"),e=parseInt(l.getAttribute("data-value"),10),t=parseInt(l.getAttribute("data-daily-total"),10),d=window.aipkit_getModuleColor(n),_=n?o(n.replace(/[-_]/g," ")):"Unknown";s.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(c)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${d}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${_}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(e)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(t)} tokens)</span>
        `,s.classList.add("aipkit_active"),r(a,s)}function o(a){return a?a.charAt(0).toUpperCase()+a.slice(1):""}function r(a,s){if(!s)return;let l=s.parentElement;if(!l)return;let c=l.getBoundingClientRect(),n=a.clientX-c.left,e=a.clientY-c.top,t=s.offsetWidth,d=s.offsetHeight,_=n+15,p=e-d-10;_+t>c.width-5&&(_=n-t-15),_<5&&(_=5),p<5&&(p=e+15),p+d>c.height-5&&(p=c.height-d-5),s.style.left=`${_}px`,s.style.top=`${p}px`,s.style.transform="translate(0, 0)"}function i(a){a&&a.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=k,window.aipkit_moveChartTooltip=r,window.aipkit_hideChartTooltip=i})();(function(){"use strict";let k="http://www.w3.org/2000/svg";function o(i,a){if(i.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),i.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let s=Object.keys(a);if(s.length===0){i.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let l=new Set;s.forEach(S=>{Object.keys(a[S]).forEach(E=>l.add(E))});let c=Array.from(l);c.sort((S,E)=>{if(S==="Other")return 1;if(E==="Other")return-1;let A=M=>M?r(M.replace(/[-_]/g," ")):"Unknown";return A(S).localeCompare(A(E))}),window.aipkit_assignModuleColors(c);let n=1;s.forEach(S=>{let E=Object.values(a[S]).reduce((A,M)=>A+M,0);E>n&&(n=E)}),n=n*1.05;let e=s.length,t=Math.max(250,i.clientHeight||250),d=c.length>0?Math.max(40,Math.ceil(c.length/3)*20):0,_={top:20,right:20,bottom:30+d,left:50},p=i.clientWidth-_.left-_.right,f=t-_.top-_.bottom,g=Math.max(1,p/e*.8),m=Math.max(0,p/e*.2),u=document.createElementNS(k,"svg");u.setAttribute("viewBox",`0 0 ${i.clientWidth} ${t}`),u.setAttribute("preserveAspectRatio","xMidYMid meet"),u.setAttribute("class","aipkit_token_usage_chart_svg"),u.setAttribute("aria-label","Token usage per module per day chart");let w=document.createElementNS(k,"g");w.setAttribute("transform",`translate(${_.left}, ${_.top})`),u.appendChild(w);let h=document.createElement("div");h.className="aipkit_chart_tooltip",i.style.position="relative",i.appendChild(h);let C=document.createElementNS(k,"g");C.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),w.appendChild(C);let x=document.createElementNS(k,"line");x.setAttribute("x1",0),x.setAttribute("y1",0),x.setAttribute("x2",0),x.setAttribute("y2",f),C.appendChild(x);let v=5;for(let S=0;S<v;S++){let E=Math.round(n*(S/(v-1))),A=f-f*(S/(v-1)),M=document.createElementNS(k,"text");M.setAttribute("x",-5),M.setAttribute("y",A+3),M.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),M.textContent=window.aipkit_formatChartNumber(E),C.appendChild(M);let $=document.createElementNS(k,"line");$.setAttribute("x1",0),$.setAttribute("y1",A),$.setAttribute("x2",p),$.setAttribute("y2",A),$.setAttribute("class","aipkit_chart_grid_line"),w.insertBefore($,w.firstChild)}let L=document.createElementNS(k,"g");L.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),L.setAttribute("transform",`translate(0, ${f})`),w.appendChild(L);let P=document.createElementNS(k,"line");P.setAttribute("x1",0),P.setAttribute("y1",0),P.setAttribute("x2",p),P.setAttribute("y2",0),L.appendChild(P);let b=Math.max(1,Math.ceil(e/(p/60)));s.forEach((S,E)=>{if(E%b===0||E===e-1){let A=E*(g+m)+g/2+m/2,M=document.createElementNS(k,"text");M.setAttribute("x",A),M.setAttribute("y",_.bottom-d-10),M.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),M.textContent=window.aipkit_formatChartDate(S),L.appendChild(M)}});let y=document.createElementNS(k,"g");if(w.appendChild(y),s.forEach((S,E)=>{let A=a[S],M=f,$=0;c.filter(N=>A[N]>0).forEach(N=>{let G=A[N]||0;$+=G;let J=G/n*f;M-=J;let F=E*(g+m)+m/2,q=document.createElementNS(k,"rect");q.setAttribute("x",F),q.setAttribute("y",M),q.setAttribute("width",g),q.setAttribute("height",Math.max(.1,J)),q.setAttribute("class","aipkit_chart_bar"),q.setAttribute("fill",window.aipkit_getModuleColor(N)),q.setAttribute("data-date",S),q.setAttribute("data-module",N),q.setAttribute("data-value",G),q.setAttribute("data-daily-total",0),q.addEventListener("mouseenter",O=>window.aipkit_showStackedTooltip(O,h)),q.addEventListener("mousemove",O=>window.aipkit_moveChartTooltip(O,h)),q.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(h)),y.appendChild(q)}),y.querySelectorAll(`rect[data-date="${S}"]`).forEach(N=>N.setAttribute("data-daily-total",$))}),c.length>0){let S=document.createElementNS(k,"g");S.setAttribute("class","aipkit_chart_legend"),S.setAttribute("transform",`translate(0, ${f+_.bottom-d+5})`),w.appendChild(S);let E=0,A=0,M=20,$=p,W=35;c.forEach(H=>{let N=r(H.replace(/[-_]/g," ")),J=N.length*7+25+W;E>0&&E+J>$&&(E=0,A+=M);let F=document.createElementNS(k,"g");F.setAttribute("transform",`translate(${E}, ${A})`);let q=document.createElementNS(k,"rect");q.setAttribute("width",10),q.setAttribute("height",10),q.setAttribute("y",-5),q.setAttribute("fill",window.aipkit_getModuleColor(H)),F.appendChild(q);let O=document.createElementNS(k,"text");O.setAttribute("x",15),O.setAttribute("y",0),O.setAttribute("class","aipkit_chart_legend_label"),O.textContent=N,F.appendChild(O),S.appendChild(F),E+=J})}i.appendChild(u)}function r(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}window.aipkit_renderTokenUsageChart=o})();(function(){"use strict";function k(i){let a=i.getFullYear(),s=String(i.getMonth()+1).padStart(2,"0"),l=String(i.getDate()).padStart(2,"0");return`${a}-${s}-${l}`}function o(i){let a=Number.isFinite(i)&&i>0?i:7,s=new Date;s.setHours(0,0,0,0);let l={};for(let c=a-1;c>=0;c-=1){let n=new Date(s);n.setDate(s.getDate()-c),l[k(n)]={}}return l}function r(i){let a=document.getElementById("aipkit_token_usage_chart_container");if(!a){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let s=a.querySelector(".aipkit_chart_loading_placeholder"),l=a.querySelector(".aipkit_chart_error_placeholder"),c=a.querySelector(".aipkit_chart_nodata_placeholder");l&&(l.style.display="none"),c&&(c.style.display="none"),s&&(s.style.display="flex");let n=[3,7,14,30,90],e=parseInt(i,10);if(!e||isNaN(e)){try{let d=localStorage.getItem("aipkit_stats_period_days"),_=parseInt(d,10);d&&!isNaN(_)&&n.includes(_)&&(e=_)}catch{}let t=document.getElementById("aipkit_stats_period_select");if(t){let d=parseInt(t.value,10);(!e||isNaN(e))&&(e=!isNaN(d)&&n.includes(d)?d:3),n.includes(e)&&String(t.value)!==String(e)&&(t.value=String(e))}else a.dataset.defaultDays?e=parseInt(a.dataset.defaultDays,10)||3:e=3}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:e}).then(t=>{if(s&&(s.style.display="none"),t&&t.daily_token_data){let d=t.daily_token_data;if(d&&typeof d=="object"&&Object.values(d).some(p=>p&&typeof p=="object"&&Object.values(p).some(f=>Number(f)>0)))window.aipkit_renderTokenUsageChart(a,d);else{let p=Object.keys(d).length>0?d:o(e);window.aipkit_renderTokenUsageChart(a,p)}}else throw new Error("Invalid data received for chart.")}).catch(t=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",t),s&&(s.style.display="none"),l)l.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,l.style.display="flex";else{let d=document.createElement("div");d.className="aipkit_chart_error_placeholder",d.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${t.message})`,a.innerHTML="",a.appendChild(d)}})}window.aipkit_loadTokenUsageChart=r,document.addEventListener("change",function(i){let a=i.target;if(a&&a.id==="aipkit_stats_period_select"){let s=parseInt(a.value,10)||7;typeof window.aipkit_loadTokenUsageChart=="function"&&window.aipkit_loadTokenUsageChart(s);try{[3,7,14,30,90].includes(s)&&localStorage.setItem("aipkit_stats_period_days",String(s))}catch{}}})})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openai=r);let i=document.getElementById("aipkit_openai_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openai_model"]');if(!i&&a.length===0){console.warn("OpenAI Sync: No OpenAI model selects found (#aipkit_openai_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.openai||[],l=Array.isArray(s)?s:[],c=m=>{if(!m)return[];let u=k("Recommended","gpt3-ai-content-generator"),w=Array.from(m.querySelectorAll("optgroup")).find(h=>h.label===u||h.label==="Recommended");return w?Array.from(w.querySelectorAll("option")).map(h=>({id:h.value,name:h.textContent.trim()||h.value})).filter(h=>h.id):[]};if(l.length===0){let m=i||a[0];l=c(m)}let n=new Set(l.map(m=>m?.id).filter(Boolean)),e=r&&typeof r=="object"?r:{},t=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],d=Object.keys(e),_=t.filter(m=>d.includes(m)).concat(d.filter(m=>!t.includes(m)).sort()),p=m=>{let u=m.value;m.innerHTML="";let w=!1,h=!1;if(l.length>0){let C=document.createElement("optgroup");C.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(x=>{if(!x||typeof x!="object"||!x.id)return;let v=new Option(x.name||x.id,x.id);x.id===u&&(v.selected=!0,w=!0),C.appendChild(v)}),C.children.length>0&&(m.appendChild(C),h=!0)}if(_.forEach(C=>{let x=Array.isArray(e[C])?e[C].slice():[];if(x.length===0)return;x.sort((L,P)=>(L.name||L.id||"").localeCompare(P.name||P.id||""));let v=document.createElement("optgroup");v.label=C,x.forEach(L=>{let P=L?.id||"";if(!P||n.has(P))return;let b=new Option(L.name||P,P);P===u&&(b.selected=!0,w=!0),v.appendChild(b)}),v.children.length>0&&(m.appendChild(v),h=!0)}),!h){m.appendChild(new Option("No models found.",""));return}if(!w&&u&&!m.querySelector(`option[value="${CSS.escape(u)}"]`)){let C=new Option(u+"",u,!1,!0);m.insertBefore(C,m.firstChild),m.value=u,w=!0}if(m.options.length>0&&m.selectedIndex===-1){let C=-1;for(let x=0;x<m.options.length;x++)if(!m.options[x].disabled&&m.options[x].value){C=x;break}m.selectedIndex=C!==-1?C:0}};i&&p(i),a.forEach(p);let f=document.getElementById("aipkit_content_writer_provider"),g=document.getElementById("aipkit_content_writer_model");f&&g&&f.value==="openai"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(f,g)}window.aipkit_updateOpenAIModels=o})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openrouter=Array.isArray(r)?r:[]);let i=document.getElementById("aipkit_openrouter_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openrouter_model"]');if(!i&&a.length===0){console.warn("OpenRouter Sync: No OpenRouter model selects found (#aipkit_openrouter_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.openrouter||[],l=Array.isArray(s)?s:[],c=t=>{if(!t)return[];let d=k("Recommended","gpt3-ai-content-generator"),_=Array.from(t.querySelectorAll("optgroup")).find(p=>p.label===d||p.label==="Recommended");return _?Array.from(_.querySelectorAll("option")).map(p=>({id:p.value,name:p.textContent.trim()||p.value})).filter(p=>p.id):[]};if(l.length===0){let t=i||a[0];l=c(t)}let n=new Set(l.map(t=>t?.id).filter(Boolean)),e=t=>{let d=t.value;t.innerHTML="";let _=!1,p=!1;if(l.length>0){let m=document.createElement("optgroup");m.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(u=>{if(u&&typeof u=="object"&&u.id){let w=new Option(u.name||u.id,u.id);u.id===d&&(w.selected=!0,_=!0),m.appendChild(w)}}),m.children.length>0&&(t.appendChild(m),p=!0)}if(!r||!r.length){p||t.appendChild(new Option("No models found.",""));return}let f={};if(r.forEach(m=>{if(!m||!m.id||n.has(m.id))return;let u=m.id.split("/"),w=(u.length>1?u[0]:"other").toLowerCase();f[w]||(f[w]=[]),f[w].push(m)}),Object.keys(f).sort().forEach(m=>{let u=document.createElement("optgroup");u.label=m.charAt(0).toUpperCase()+m.slice(1),f[m].sort((w,h)=>(w.name||"").localeCompare(h.name||"")),f[m].forEach(w=>{let h=new Option(w.name||w.id,w.id);w.id===d&&(h.selected=!0,_=!0),u.appendChild(h)}),u.children.length>0&&(t.appendChild(u),p=!0)}),!_&&d&&!t.querySelector(`option[value="${CSS.escape(d)}"]`)){let m=new Option(d+"",d,!1,!0);t.insertBefore(m,t.firstChild)}if(!_&&t.options.length>0&&t.selectedIndex===-1){let m=-1;for(let u=0;u<t.options.length;u++)if(!t.options[u].disabled&&t.options[u].value){m=u;break}t.selectedIndex=m!==-1?m:0}};i&&e(i),a.forEach(e)}window.aipkit_updateOpenRouterModels=o})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){let i=document.getElementById("aipkit_google_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_google_model"]');if(!i&&a.length===0){console.warn("Google Sync: No Google model selects found (#aipkit_google_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.google||[],l=Array.isArray(s)?s:[],c=d=>{if(!d)return[];let _=k("Recommended","gpt3-ai-content-generator"),p=Array.from(d.querySelectorAll("optgroup")).find(f=>f.label===_||f.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(l.length===0){let d=i||a[0];l=c(d)}let n=new Set(l.map(d=>d?.id).filter(Boolean)),e=Array.isArray(r)?r.slice():[];e.sort((d,_)=>(d.name||d.id||"").localeCompare(_.name||_.id||""));let t=d=>{let _=d.value;d.innerHTML="";let p=!1,f=!1,g=l.length>0?document.createElement("optgroup"):null;if(g&&(g.label=k("All models","gpt3-ai-content-generator")),l.length>0){let m=document.createElement("optgroup");m.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(u=>{if(u&&typeof u=="object"&&u.id){let w=new Option(u.name||u.id,u.id);(u.id===_||`models/${u.id}`===_)&&(w.selected=!0,p=!0),m.appendChild(w)}}),m.children.length>0&&(d.appendChild(m),f=!0)}if(!e.length){f||d.appendChild(new Option("No models found.",""));return}if(e.forEach(m=>{let u=m.id||"",w=m.name||u;if(!u||n.has(u))return;let h=new Option(w,u);(u===_||`models/${u}`===_)&&(h.selected=!0,p=!0),g?g.appendChild(h):(d.appendChild(h),f=!0)}),g&&g.children.length>0&&(d.appendChild(g),f=!0),!p&&_){let m=_.startsWith("models/")?_.substring(7):_;if(!d.querySelector(`option[value="${CSS.escape(m)}"]`)){let u=m,w=new Option(u+"",_,!1,!0);d.insertBefore(w,d.firstChild),d.value=_}}if(d.options.length>0&&d.selectedIndex===-1){let m=-1;for(let u=0;u<d.options.length;u++)if(!d.options[u].disabled&&d.options[u].value){m=u;break}d.selectedIndex=m!==-1?m:0}};i&&t(i),a.forEach(t)}window.aipkit_updateGoogleModels=o})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_azure_deployment"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_azure_deployment"]');if(!r&&i.length===0){console.warn("Azure Sync: No Azure deployment selects found (#aipkit_azure_deployment or chat selects).");return}let a=s=>{let l=s.value;s.innerHTML="";let c=o&&typeof o=="object"&&!Array.isArray(o)&&(o["Chat Models"]||o["Embedding Models"]||o["Image Models"]);if(!o||Array.isArray(o)&&!o.length||c&&Object.keys(o).length===0){if(s.appendChild(new Option("No deployments found.","")),l){let e=new Option(l+"",l,!1,!0);s.appendChild(e),s.value=l}return}let n=!1;if(c)Object.keys(o).forEach(e=>{let t=o[e];if(t&&Array.isArray(t)&&t.length>0){let d=document.createElement("optgroup");d.label=e,t.sort((_,p)=>(_.id||"").localeCompare(p.id||"")),t.forEach(_=>{let p=_.id||"",f=_.name||p;if(!p)return;let g=p+(f&&f!==p?` (model: ${f})`:""),m=new Option(g,p);p===l&&(m.selected=!0,n=!0),d.appendChild(m)}),s.appendChild(d)}});else{let e=Array.isArray(o)?o:[];e.sort((t,d)=>(t.id||"").localeCompare(d.id||"")),e.forEach(t=>{let d=t.id||"",_=t.name||d;if(!d)return;let p=d+(_&&_!==d?` (model: ${_})`:""),f=new Option(p,d);d===l&&(f.selected=!0,n=!0),s.appendChild(f)})}if(!n&&s.value&&!s.querySelector(`option[value="${CSS.escape(s.value)}"]`)){let e=new Option(s.value+"",s.value,!1,!0);s.appendChild(e),n=!0}if(!n&&s.options.length>0&&s.selectedIndex===-1){let e=-1;for(let t=0;t<s.options.length;t++)if(!s.options[t].disabled&&s.options[t].value){e=t;break}s.selectedIndex=e!==-1?e:0}};r&&a(r),i.forEach(a)}window.aipkit_updateAzureDeployments=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.claude=Array.isArray(r)?r:[]);let i=document.getElementById("aipkit_claude_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_claude_model"]');if(!i&&a.length===0){console.warn("Claude Sync: No Claude model selects found (#aipkit_claude_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.claude||[],l=Array.isArray(s)?s:[],c=p=>{if(!p)return[];let f=k("Recommended","gpt3-ai-content-generator"),g=Array.from(p.querySelectorAll("optgroup")).find(m=>m.label===f||m.label==="Recommended");return g?Array.from(g.querySelectorAll("option")).map(m=>({id:m.value,name:m.textContent.trim()||m.value})).filter(m=>m.id):[]};if(l.length===0){let p=i||a[0];l=c(p)}let n=new Set(l.map(p=>p?.id).filter(Boolean)),e=Array.isArray(r)?r.slice():[];e.sort((p,f)=>(p.name||p.id||"").localeCompare(f.name||f.id||""));let t=p=>{let f=p.value;p.innerHTML="";let g=!1,m=!1,u=l.length>0?document.createElement("optgroup"):null;if(u&&(u.label=k("All models","gpt3-ai-content-generator")),l.length>0){let w=document.createElement("optgroup");w.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(h=>{if(!h||typeof h!="object"||!h.id)return;let C=new Option(h.name||h.id,h.id);h.id===f&&(C.selected=!0,g=!0),w.appendChild(C)}),w.children.length>0&&(p.appendChild(w),m=!0)}if(e.forEach(w=>{let h=w?.id||"",C=w?.name||h;if(!h||n.has(h))return;let x=new Option(C,h);h===f&&(x.selected=!0,g=!0),u?u.appendChild(x):(p.appendChild(x),m=!0)}),u&&u.children.length>0&&(p.appendChild(u),m=!0),!m){p.appendChild(new Option("No models found.",""));return}if(!g&&f&&!p.querySelector(`option[value="${CSS.escape(f)}"]`)){let w=new Option(f+"",f,!1,!0);p.insertBefore(w,p.firstChild),p.value=f}if(p.options.length>0&&p.selectedIndex===-1){let w=-1;for(let h=0;h<p.options.length;h++)if(!p.options[h].disabled&&p.options[h].value){w=h;break}p.selectedIndex=w!==-1?w:0}};i&&t(i),a.forEach(t);let d=document.getElementById("aipkit_content_writer_provider"),_=document.getElementById("aipkit_content_writer_model");d&&_&&d.value==="claude"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(d,_)}window.aipkit_updateClaudeModels=o})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.deepseek=Array.isArray(r)?r:[]);let i=document.getElementById("aipkit_deepseek_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_deepseek_model"]');if(!i&&a.length===0){console.warn("DeepSeek Sync: No DeepSeek model selects found (#aipkit_deepseek_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.deepseek||[],l=Array.isArray(s)?s:[],c=d=>{if(!d)return[];let _=k("Recommended","gpt3-ai-content-generator"),p=Array.from(d.querySelectorAll("optgroup")).find(f=>f.label===_||f.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(l.length===0){let d=i||a[0];l=c(d)}let n=Array.isArray(r)?r.slice():[];n.sort((d,_)=>(d.name||d.id||"").localeCompare(_.name||_.id||"")),l.length===0&&n.length>0&&(l=n.slice(0,3).map(d=>({id:d?.id||"",name:d?.name||d?.id||""})).filter(d=>d.id));let e=new Set(l.map(d=>d?.id).filter(Boolean)),t=d=>{let _=d.value;d.innerHTML="";let p=!1,f=!1,g=l.length>0?document.createElement("optgroup"):null;if(g&&(g.label=k("All models","gpt3-ai-content-generator")),l.length>0){let m=document.createElement("optgroup");m.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(u=>{if(!u||typeof u!="object"||!u.id)return;let w=new Option(u.name||u.id,u.id);u.id===_&&(w.selected=!0,p=!0),m.appendChild(w)}),m.children.length>0&&(d.appendChild(m),f=!0)}if(!n.length){f||d.appendChild(new Option("No models found.",""));return}if(n.forEach(m=>{let u=m?.id||"",w=m?.name||u;if(!u||e.has(u))return;let h=new Option(w,u);u===_&&(h.selected=!0,p=!0),g?g.appendChild(h):(d.appendChild(h),f=!0)}),g&&g.children.length>0&&(d.appendChild(g),f=!0),!p&&_&&!d.querySelector(`option[value="${CSS.escape(_)}"]`)){let m=new Option(_+"",_,!1,!0);d.insertBefore(m,d.firstChild)}if(d.options.length>0&&d.selectedIndex===-1){let m=-1;for(let u=0;u<d.options.length;u++)if(!d.options[u].disabled&&d.options[u].value){m=u;break}d.selectedIndex=m!==-1?m:0}};i&&t(i),a.forEach(t)}window.aipkit_updateDeepSeekModels=o})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.ollama=Array.isArray(r)?r:[]);let i=document.getElementById("aipkit_ollama_model"),a=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_ollama_model"]');if(!i&&a.length===0){console.warn("Ollama Sync: No Ollama model selects found (#aipkit_ollama_model or chat selects).");return}let s=window.aipkit_dashboard?.recommendedModels?.ollama||[],l=Array.isArray(s)?s:[],c=d=>{if(!d)return[];let _=k("Recommended","gpt3-ai-content-generator"),p=Array.from(d.querySelectorAll("optgroup")).find(f=>f.label===_||f.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(l.length===0){let d=i||a[0];l=c(d)}let n=Array.isArray(r)?r.slice():[];n.sort((d,_)=>(d.name||d.id||"").localeCompare(_.name||_.id||"")),l.length===0&&n.length>0&&(l=n.slice(0,3).map(d=>({id:d?.id||"",name:d?.name||d?.id||""})).filter(d=>d.id));let e=new Set(l.map(d=>d?.id).filter(Boolean)),t=d=>{let _=d.value;d.innerHTML="";let p=!1,f=!1,g=l.length>0?document.createElement("optgroup"):null;if(g&&(g.label=k("All models","gpt3-ai-content-generator")),l.length>0){let m=document.createElement("optgroup");m.label=k("Recommended","gpt3-ai-content-generator"),l.forEach(u=>{if(!u||typeof u!="object"||!u.id)return;let w=new Option(u.name||u.id,u.id);u.id===_&&(w.selected=!0,p=!0),m.appendChild(w)}),m.children.length>0&&(d.appendChild(m),f=!0)}if(!n.length){f||d.appendChild(new Option("No models found.",""));return}if(n.forEach(m=>{let u=m?.id||"",w=m?.name||u;if(!u||e.has(u))return;let h=new Option(w,u);u===_&&(h.selected=!0,p=!0),g?g.appendChild(h):(d.appendChild(h),f=!0)}),g&&g.children.length>0&&(d.appendChild(g),f=!0),!p&&_&&!d.querySelector(`option[value="${CSS.escape(_)}"]`)){let m=new Option(_+"",_,!1,!0);d.insertBefore(m,d.firstChild)}if(d.options.length>0&&d.selectedIndex===-1){let m=-1;for(let u=0;u<d.options.length;u++)if(!d.options[u].disabled&&d.options[u].value){m=u;break}d.selectedIndex=m!==-1?m:0}};i&&t(i),a.forEach(t)}window.aipkit_updateOllamaModels=o})();(function(){"use strict";function k(i,a){let s=Array.isArray(a)?a:[],l=JSON.stringify(s),n=`[id^="${i==="models"?"aipkit_elevenlabs_models_json_":"aipkit_elevenlabs_voices_json_"}"]`;document.querySelectorAll(n).forEach(e=>{i==="models"?e.dataset.models=l:e.dataset.voices=l})}function o(i,a="aipkit_elevenlabs_voice_id"){let s=Array.isArray(i)?i:[];k("voices",s);let l=document.getElementById(a);if(!l){console.warn(`ElevenLabs Sync (Voices): Select element #${a} not found.`);return}if(typeof a=="string"&&a.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){window.aipkit_chatTts_updateElevenLabsVoiceSelect(a,s,l.value||"");return}let c=l.value;if(l.innerHTML="",l.appendChild(new Option("-- Select a Voice (Optional) --","")),!s.length){c&&c!==""&&(l.appendChild(new Option(c+"",c,!1,!0)),l.value=c);return}let n=!1;if(s.sort((e,t)=>(e.name||e.id||"").localeCompare(t.name||t.id||"")),s.forEach(e=>{let t=e.id||"",d=e.name||t;if(!t)return;let _=new Option(d,t);t===c&&(_.selected=!0,n=!0),l.appendChild(_)}),!n&&c&&c!==""&&!l.querySelector(`option[value="${CSS.escape(c)}"]`)){let e=new Option(c+"",c,!1,!0);l.appendChild(e),l.value=c}}function r(i,a="aipkit_elevenlabs_tts_model_id"){let s=Array.isArray(i)?i:[];k("models",s);let l=document.getElementById(a);if(!l){console.warn(`ElevenLabs Sync (Models): Select element #${a} not found.`);return}if(typeof a=="string"&&a.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){window.aipkit_chatTts_updateElevenLabsModelsSelect(a,s,l.value||"");return}let c=l.value;if(l.innerHTML="",l.appendChild(new Option("-- Select a Model (Optional) --","")),!s.length){c&&c!==""&&(l.appendChild(new Option(c+"",c,!1,!0)),l.value=c);return}let n=!1;if(s.sort((e,t)=>(e.name||e.id||"").localeCompare(t.name||t.id||"")),s.forEach(e=>{let t=e.id||"",d=e.name||t;if(!t)return;let _=new Option(d,t);t===c&&(_.selected=!0,n=!0),l.appendChild(_)}),!n&&c&&c!==""&&!l.querySelector(`option[value="${CSS.escape(c)}"]`)){let e=new Option(c+"",c,!1,!0);l.appendChild(e),l.value=c}}window.aipkit_updateElevenLabsVoices=o,window.aipkit_updateElevenLabsModelsSelect=r})();(function(){"use strict";function k(o,r="aipkit_pinecone_default_index"){let i=document.getElementById(r);if(!i){console.warn(`Pinecone Sync: Select element #${r} not found.`);return}let a=i.value;if(i.innerHTML="",i.appendChild(new Option("-- Select Default Index --","")),!o||!o.length){i.appendChild(new Option("(No indexes found - Sync again)","")),a&&a!==""&&(i.appendChild(new Option(a+"",a,!1,!0)),i.value=a);return}let s=!1;if(o.sort((l,c)=>(l.name||l.id||"").localeCompare(c.name||c.id||"")),o.forEach(l=>{let c=l.name||l.id||(typeof l=="string"?l:"");if(!c)return;let n=new Option(c,c);c===a&&(n.selected=!0,s=!0),i.appendChild(n)}),!s&&a&&a!==""&&!i.querySelector(`option[value="${CSS.escape(a)}"]`)){let l=new Option(a+"",a,!1,!0);i.appendChild(l),i.value=a}}window.aipkit_updatePineconeIndexes=k})();(function(){"use strict";function k(o,r="aipkit_qdrant_default_collection"){let i=document.getElementById(r);if(!i){console.warn(`Qdrant Sync: Select element #${r} not found.`);return}let a=i.multiple,s=a?Array.from(i.selectedOptions).map(c=>c.value).filter(Boolean):[i.value];if(i.innerHTML="",a||i.appendChild(new Option("-- Select Collection (Optional) --","")),!o||!o.length){i.appendChild(new Option("(No collections found - Sync again)","")),s.length&&(s.forEach(c=>{c&&i.appendChild(new Option(c+"",c,!1,!0))}),!a&&s[0]&&(i.value=s[0]));return}let l=new Set;if(o.sort((c,n)=>(c.name||c.id||"").localeCompare(n.name||n.id||"")),o.forEach(c=>{let n=c.name||c.id||"";if(!n)return;let e=s.includes(n),t=new Option(n,n,!1,e);e&&l.add(n),i.appendChild(t)}),s.forEach(c=>{if(c&&!l.has(c)&&!i.querySelector(`option[value="${CSS.escape(c)}"]`)){let n=new Option(c+"",c,!1,!0);i.appendChild(n)}}),!a&&s[0]&&!i.value&&(i.value=s[0]),typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let c=i.closest(".aipkit_popover_options_list")||i.closest(".aipkit_popover_option_main")||document;window.aipkit_populateQdrantCollectionsMultiSelect(c)}}window.aipkit_updateQdrantCollections=k})();(function(){"use strict";function k(o,r=""){let i=r||"aipkit_replicate_model",a=document.getElementById(i);if(window.aipkit_dashboard&&window.aipkit_dashboard.imageGeneratorModels&&(window.aipkit_dashboard.imageGeneratorModels.replicate=o),window.aipkit_image_generator_config_public&&(window.aipkit_image_generator_config_public.replicate_models=o),!a){r&&console.warn(`Replicate Sync: Select element #${i} not found.`);return}let s=a.value;if(a.innerHTML="",!o||!o.length){a.appendChild(new Option("(No models found - Sync again)","")),s&&s!==""&&(a.appendChild(new Option(s+"",s,!1,!0)),a.value=s);return}let l=!1;if(o.sort((c,n)=>(c.name||c.id||"").localeCompare(n.name||n.id||"")),o.forEach(c=>{let n=c.id||"",e=c.name||n;if(!n)return;let t=new Option(e,n);n===s&&(t.selected=!0,l=!0),a.appendChild(t)}),!l&&s&&s!==""&&!a.querySelector(`option[value="${CSS.escape(s)}"]`)){let c=new Option(s+"",s,!1,!0);a.insertBefore(c,a.firstChild),a.value=s}if(!a.value&&a.options.length>0){let c=-1;for(let n=0;n<a.options.length;n++)if(!a.options[n].disabled&&a.options[n].value){c=n;break}a.selectedIndex=c!==-1?c:0}}window.aipkit_updateReplicateModels=k})();(function(){"use strict";function k(g,m,u={}){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function")return console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing."),null;let w=u&&typeof u=="object"?u:{},h=!!w.silent,C=w.showErrors!==!1,x=w.showSuccess===!0,v=!!g,L=(F,q="")=>{let O=Array.isArray(F)?F:[],R=document.getElementById("aipkit_google_tts_voices_json_main");R&&(R.dataset.voices=JSON.stringify(O));let D=q||document.querySelector('select[name="tts_google_voice_id"]')?.id||"";if(D&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let Z=document.getElementById(D);window.aipkit_updateGoogleVoiceSelect(D,O,Z&&Z.value||"")}},P=F=>{let q=Array.isArray(F)?F:[];window.aipkit_chat_config=window.aipkit_chat_config||{},window.aipkit_chat_config.openaiVectorStores=q,typeof window.aipkit_invalidateModuleCache=="function"&&["chatbot","sources","content-writer","autogpt","ai-forms"].forEach(O=>{window.aipkit_invalidateModuleCache(O)}),typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("aipkit:vector-store-list-updated",{detail:{provider:"openai",stores:q}}))},b={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,GoogleTtsVoices:L,OpenAIVectorStores:P,Azure:window.aipkit_updateAzureDeployments,Claude:window.aipkit_updateClaudeModels,DeepSeek:window.aipkit_updateDeepSeekModels,Ollama:window.aipkit_updateOllamaModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof b[m]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${m}.`),alert(`AIPKit Error: Cannot update UI for ${m}.`);return}let y="aipkit_settings_global_messages",S=v?!!g.closest(".aipkit_popover_options_list")&&!g.closest("#aipkit_settings_container .aipkit_settings_advanced_panel"):!1;!h&&!S&&document.getElementById(y)&&(window.aipkit_clearStatusMessages(y),window.aipkit_showSavingIndicator(y,!1));let E=v?g.querySelector(".aipkit_btn-text"):null,A=v?g.getAttribute("data-target-select"):w.targetSelectId||"",M=null,$=F=>!F||!(F instanceof Element)?null:F.querySelector(".aipkit_builder_card--shortcode .aipkit_model_sync_status")||F.querySelector(".aipkit_builder_card_status .aipkit_model_sync_status");if(S){let q=g.closest(".aipkit_popover_flyout_body")?.closest(".aipkit-modal-content")?.querySelector(".aipkit_popover_flyout_header")||g.closest(".aipkit_popover_context_flyout")?.querySelector(".aipkit_popover_flyout_header")||g.closest(".aipkit_popover_flyout_header");if(q&&(M=q.querySelector(".aipkit_popover_status_inline")),!M){let O=g.closest(".aipkit_model_settings_popover");O&&(M=O.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline.aipkit_model_sync_status"))}if(!M){let O=g.closest(".aipkit_popover_option_row");O&&(M=O.querySelector(".aipkit_popover_status_inline"))}if(!M){let O=g.closest(".aipkit_model_settings_panel");O&&(M=O.querySelector(".aipkit_popover_status_inline.aipkit_model_sync_status"))}}else{let F=v?g.closest(".aipkit_chatbot_model_field"):null,q=v?g.closest(".aipkit_chatbot_builder"):null;if(!q&&A){let O=document.getElementById(A);q=O?O.closest(".aipkit_chatbot_builder"):null}q||(q=document.querySelector('.aipkit_chatbot_builder[data-aipkit-chatbot-layout="next"]')),q&&q.getAttribute("data-aipkit-chatbot-layout")==="next"&&(M=$(q)),M||(M=F?F.querySelector(".aipkit_model_sync_status"):null)}if(!M){let F=document.querySelector('.aipkit_chatbot_builder[data-aipkit-chatbot-layout="next"]');F&&(M=$(F))}if(!M&&m){let F=document.querySelector(`.aipkit_chatbot_model_field[data-provider="${m}"]`);F&&(M=F.querySelector(".aipkit_model_sync_status"))}let W=(F,q,O)=>{if(!M)return;let R=M.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_save_status_container");R&&F&&(R.textContent="",R.className="aipkit_save_status_container"),M.textContent=F||"",M.classList.remove("success","error","loading"),q&&M.classList.add(q),O?M.setAttribute("title",O):M.removeAttribute("title"),M.classList.contains("aipkit_popover_status_inline")&&(M.style.display=F?"inline-block":"none")};W("Syncing\u2026","loading");let H=E?E.textContent:m.includes("ElevenLabs")||m.includes("Pinecone")||m.includes("Qdrant")||m.includes("VectorStores")||m.includes("Replicate")?"Sync Items":"Sync Models";E&&(E.textContent="");let N=null;return v&&(N=g.querySelector(".aipkit_spinner"),N||(N=document.createElement("span"),N.className="aipkit_spinner",g.appendChild(N)),N.style.display="inline-block",g.classList.add("aipkit_loading"),g.disabled=!0),(m==="GoogleTtsVoices"?window.aipkit_apiRequest("aipkit_sync_google_tts_voices"):window.aipkit_apiRequest("aipkit_sync_models",{provider:m})).then(F=>{m==="OpenRouter"&&Array.isArray(F?.embedding_models)&&(window.aipkit_dashboard=window.aipkit_dashboard||{},window.aipkit_dashboard.embeddingModels=window.aipkit_dashboard.embeddingModels||{},window.aipkit_dashboard.embeddingModels.openrouter=F.embedding_models);let q=m==="GoogleTtsVoices"?F.voices:m==="OpenAIVectorStores"?F.stores:F.models,O=Array.isArray(F?.recommended_models)?F.recommended_models:[],D={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"}[m]||"";D&&O.length>0&&(window.aipkit_dashboard=window.aipkit_dashboard||{},window.aipkit_dashboard.recommendedModels=window.aipkit_dashboard.recommendedModels||{},window.aipkit_dashboard.recommendedModels[D]=O),w.skipUpdate||(A?b[m](q,A):b[m](q)),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers(),(m==="PineconeIndexes"||m==="QdrantCollections")&&typeof window.aipkit_refreshTrainingSourcesCount=="function"&&window.aipkit_refreshTrainingSourcesCount(),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():h||console.warn("Model Sync Init: Cannot update autosave baseline.");let Z="models";m==="ElevenLabs"||m==="GoogleTtsVoices"?Z="voices":m==="ElevenLabsModels"?Z="synthesis models":m==="PineconeIndexes"?Z="indexes":m==="QdrantCollections"?Z="collections":m==="OpenAIVectorStores"&&(Z="vector stores"),(!h||x)&&!S&&document.getElementById(y)&&window.aipkit_showMessage(y,"success",`${m.replace(/Indexes|Collections|Models/,"")} ${Z} synced!`),W("Saved","success"),M&&setTimeout(()=>W("",null),2500)}).catch(F=>{let q=F?.message||"Sync failed.";if(C&&!S&&document.getElementById(y)&&window.aipkit_showMessage(y,"error",`Sync failed: ${q}`),console.error(`AIPKit Sync Error (${m}):`,F),W(q,"error",q),M&&setTimeout(()=>W("",null),5e3),w.propagateError)throw F}).finally(()=>{if(v){g.disabled=!1,g.classList.remove("aipkit_loading");let F=g.querySelector(".aipkit_spinner");F&&(F.style.display="none"),E&&(E.textContent=H)}})}function o(g){if(!g)return;let m="data-sync-listener-attached";g.getAttribute(m)||(g.addEventListener("click",function(u){let w=u.target.closest(".aipkit_sync_btn");if(!w||w.disabled)return;u.preventDefault();let h=w.getAttribute("data-provider")||"";if(!h){let C=w.closest(".aipkit_chatbot_model_field");C&&C.getAttribute("data-provider")&&(h=C.getAttribute("data-provider"))}h?k(w,h):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",w)}),g.setAttribute(m,"true"))}function r(){o(document.getElementById("aipkit_module-container")),o(document.getElementById("aipkit_chatbot_main_tab_content_container"))}let i=[],a=!1;function s(g,m){if(!g||typeof g!="object")return"";let u=g[m];return u==null?"":String(u).trim()}function l(g,m,u){return u.some(w=>s(g,w)!==s(m,w))}function c(g){return s(g,"azure_api_key")!==""&&s(g,"azure_endpoint")!==""}function n(g,m){let u=String(g||"").trim();if(!u)return!1;if(u==="Ollama")return!0;if(u==="Azure")return c(m);let h={OpenAI:"openai_api_key",OpenRouter:"openrouter_api_key",Google:"google_api_key",Claude:"claude_api_key",DeepSeek:"deepseek_api_key"}[u];return h?s(m,h)!=="":!1}function e(g,m){return[{provider:"OpenAI",keys:["openai_api_key","openai_base_url","openai_api_version"],ready:w=>s(w,"openai_api_key")!==""},{provider:"OpenAIVectorStores",keys:["openai_api_key","openai_base_url","openai_api_version"],ready:w=>s(w,"openai_api_key")!==""},{provider:"OpenRouter",keys:["openrouter_api_key","openrouter_base_url","openrouter_api_version"],ready:w=>s(w,"openrouter_api_key")!==""},{provider:"Google",keys:["google_api_key","google_base_url","google_api_version"],ready:w=>s(w,"google_api_key")!==""},{provider:"GoogleTtsVoices",keys:["google_api_key","google_base_url","google_api_version"],ready:w=>s(w,"google_api_key")!==""},{provider:"Azure",keys:["azure_api_key","azure_endpoint","azure_authoring_version","azure_inference_version"],ready:w=>c(w)},{provider:"Claude",keys:["claude_api_key","claude_base_url","claude_api_version"],ready:w=>s(w,"claude_api_key")!==""},{provider:"DeepSeek",keys:["deepseek_api_key","deepseek_base_url","deepseek_api_version"],ready:w=>s(w,"deepseek_api_key")!==""},{provider:"Ollama",keys:["ollama_base_url"],ready:w=>s(w,"ollama_base_url")!==""},{provider:"ElevenLabs",keys:["elevenlabs_api_key"],ready:w=>s(w,"elevenlabs_api_key")!==""},{provider:"ElevenLabsModels",keys:["elevenlabs_api_key"],ready:w=>s(w,"elevenlabs_api_key")!==""},{provider:"Replicate",keys:["replicate_api_key"],ready:w=>s(w,"replicate_api_key")!==""},{provider:"PineconeIndexes",keys:["pinecone_api_key"],ready:w=>s(w,"pinecone_api_key")!==""},{provider:"QdrantCollections",keys:["qdrant_url","qdrant_api_key"],ready:w=>s(w,"qdrant_url")!==""&&s(w,"qdrant_api_key")!==""}].filter(w=>l(g,m,w.keys)&&w.ready(m)).map(w=>w.provider)}function t(g){return g?document.querySelector(`.aipkit_sync_btn[data-provider="${g}"]`):null}let d=null;function _(){if(a)return;let g=i.shift();if(!g)return;a=!0;let{provider:m,options:u,resolve:w,reject:h}=g,C=t(m),x=k(C,m,u);d={provider:m,promise:x},x&&typeof x.finally=="function"?x.then(v=>{typeof w=="function"&&w(v)}).catch(v=>{typeof h=="function"&&h(v)}).finally(()=>{d=null,a=!1,_()}):(d=null,typeof w=="function"&&w(null),a=!1,_())}function p(g,m={}){if(!g)return null;if(d&&d.provider===g&&d.promise)return d.promise;if(i.some(x=>x.provider===g)){let x=i.find(v=>v.provider===g);return x&&x.promise?x.promise:null}let w,h,C=new Promise((x,v)=>{w=x,h=v});return i.push({provider:g,options:m,resolve:w,reject:h,promise:C}),_(),C}function f(g,m){if(!g||!m)return;e(g,m).forEach(w=>p(w,{silent:!0,showSuccess:!0}))}window.aipkit_initSyncButtons=r,window.aipkit_syncModels=k,window.aipkit_queueProviderSync=p,window.aipkit_queueProviderAutoSync=f,window.aipkit_isProviderReadyForAutoSync=n})();(function(){"use strict";let k=window.wp?.i18n?.__||function(y){return y},o="#aipkit_settings_container #aipkit_provider, #aipkit_settings_container .aipkit_model_field select.aipkit_form-input",r=null,i=null,a=!1,s=y=>{y&&(y.style.position="",y.style.left="",y.style.top="",y.style.bottom="",y.style.width="",y.style.maxWidth="",y.style.minWidth="")},l=(y,S)=>{if(!y||!S)return;y.classList.remove("aipkit_settings_dropdown--dropup");let E=12,A=y.getBoundingClientRect(),M=S.getBoundingClientRect().height||S.scrollHeight||0,$=window.innerHeight-A.bottom-E,W=A.top-E;M>$&&W>$&&y.classList.add("aipkit_settings_dropdown--dropup")},c=(y,S)=>{if(!y||!S)return;l(y,S);let E=12,A=y.getBoundingClientRect(),$=y.classList.contains("aipkit_settings_provider_dropdown")?220:260,W=Math.max(160,window.innerWidth-32),H=Math.min(Math.max(A.width,$),W);S.style.position="fixed",S.style.width=`${Math.round(H)}px`,S.style.minWidth=`${Math.round(Math.min($,H))}px`,S.style.maxWidth=`${Math.round(H)}px`;let N=S.getBoundingClientRect().height||S.scrollHeight||0,J=y.classList.contains("aipkit_settings_dropdown--dropup")?A.top-N-6:A.bottom+6;J+N>window.innerHeight-E&&(J=window.innerHeight-E-N),J<E&&(J=E);let F=A.left;F+H>window.innerWidth-E&&(F=window.innerWidth-E-H),F<E&&(F=E),S.style.left=`${Math.round(F)}px`,S.style.top=`${Math.round(J)}px`,S.style.bottom="auto"},n=y=>{if(!y)return"";let S=y.getAttribute("data-aipkit-picker-title");if(S)return S;let E=y.id&&document.querySelector(`label[for="${y.id}"]`)||y.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");if(!E)return"";let A=E.cloneNode(!0);return A.querySelectorAll(".aipkit_form-label-helper").forEach(M=>{M.remove()}),A.textContent.replace(/\s+/g," ").trim()},e=y=>{if(!y)return"";let S=y.selectedOptions&&y.selectedOptions.length?y.selectedOptions[0]:y.querySelector("option[selected]");if(S)return S.textContent.trim();let E=y.querySelector("option");return E?E.textContent.trim():""},t=y=>y&&y.id==="aipkit_provider",d=y=>!!(y&&(y.classList.contains("aipkit_settings_provider_dropdown")||y.classList.contains("aipkit_settings_model_dropdown"))),_=y=>String(y||"").trim().toLowerCase(),p=(y,S)=>{if(!y)return;let E="aipkit_settings_select_picker_icon--";y.classList.forEach(M=>{M.startsWith(E)&&y.classList.remove(M)});let A=_(S);A&&y.classList.add(`${E}${A}`)},f=y=>({buttonId:`${y}_picker_btn`,labelId:`${y}_picker_label`,popoverId:`${y}_picker_popover`,titleId:`${y}_picker_title`,searchId:`${y}_picker_search`,listId:`${y}_picker_list`}),g=y=>{if(!y||!y.id)return null;let S=f(y.id);if(!document.getElementById("aipkit_settings_container"))return null;if(t(y)){let q=document.getElementById(S.popoverId);q&&!q.classList.contains("aipkit_settings_provider_dropdown")&&(q.remove(),q=null),q||(q=document.createElement("div"),q.id=S.popoverId,q.className="aipkit_popover_multiselect aipkit_settings_provider_dropdown",y.insertAdjacentElement("beforebegin",q));let O=document.getElementById(S.buttonId);if(O&&O.parentElement!==q&&(O.remove(),O=null),!O){O=document.createElement("button"),O.type="button",O.id=S.buttonId,O.className="aipkit_popover_multiselect_btn aipkit_settings_select_picker_btn aipkit_settings_select_picker_btn--provider",O.setAttribute("aria-expanded","false");let Ae=document.createElement("span");Ae.className="aipkit_settings_select_picker_icon",Ae.setAttribute("aria-hidden","true"),O.appendChild(Ae);let We=document.createElement("span");We.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",We.id=S.labelId,We.textContent=e(y)||k("Select","gpt3-ai-content-generator"),O.appendChild(We),q.appendChild(O)}let R=q.querySelector(".aipkit_popover_multiselect_panel");R||(R=document.createElement("div"),R.className="aipkit_popover_multiselect_panel aipkit_settings_provider_dropdown_panel",R.hidden=!0,R.setAttribute("role","menu"),q.appendChild(R));let D=R.querySelector(".aipkit_settings_select_picker_list");D||(D=document.createElement("div"),D.className="aipkit_popover_multiselect_options aipkit_settings_select_picker_list",D.id=S.listId,D.setAttribute("role","listbox"),R.appendChild(D));let Z=`${S.popoverId}_panel`;R.id=Z,O.setAttribute("aria-controls",Z);let Q=document.getElementById(S.labelId)||(()=>{let Ae=document.createElement("span");return Ae.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",Ae.id=S.labelId,O.appendChild(Ae),Ae})(),fe=O.querySelector(".aipkit_settings_select_picker_icon")||(()=>{let Ae=document.createElement("span");return Ae.className="aipkit_settings_select_picker_icon",Ae.setAttribute("aria-hidden","true"),O.insertBefore(Ae,O.firstChild),Ae})();return p(fe,y.value),y.classList.contains("screen-reader-text")||y.classList.add("screen-reader-text"),{ids:S,button:O,popover:q,label:Q,search:null,list:D}}let A=document.getElementById(S.popoverId);A&&!A.classList.contains("aipkit_settings_model_dropdown")&&(A.remove(),A=null),A||(A=document.createElement("div"),A.id=S.popoverId,A.className="aipkit_popover_multiselect aipkit_settings_model_dropdown",y.insertAdjacentElement("beforebegin",A));let M=document.getElementById(S.buttonId);if(M&&M.parentElement!==A&&(M.remove(),M=null),!M){M=document.createElement("button"),M.type="button",M.id=S.buttonId,M.className="aipkit_popover_multiselect_btn aipkit_settings_select_picker_btn",M.setAttribute("aria-expanded","false");let q=document.createElement("span");q.className="aipkit_popover_multiselect_label aipkit_settings_select_picker_label",q.id=S.labelId,q.textContent=e(y)||k("Select","gpt3-ai-content-generator"),M.appendChild(q),A.appendChild(M)}let $=A.querySelector(".aipkit_popover_multiselect_panel");$||($=document.createElement("div"),$.className="aipkit_popover_multiselect_panel aipkit_settings_model_dropdown_panel",$.hidden=!0,$.setAttribute("role","menu"),A.appendChild($));let W=$.querySelector(".aipkit_settings_select_picker_search");W||(W=document.createElement("div"),W.className="aipkit_settings_select_picker_search",$.appendChild(W));let H=document.getElementById(S.searchId);(!H||H.parentElement!==W)&&(H=document.createElement("input"),H.type="search",H.id=S.searchId,H.className="aipkit_form-input",W.appendChild(H));let N=n(y),G=N?`Search ${N.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");H.setAttribute("placeholder",G);let J=$.querySelector(".aipkit_settings_select_picker_list");J||(J=document.createElement("div"),J.className="aipkit_popover_multiselect_options aipkit_settings_select_picker_list",J.id=S.listId,J.setAttribute("role","listbox"),$.appendChild(J));let F=`${S.popoverId}_panel`;return $.id=F,M.setAttribute("aria-controls",F),y.classList.contains("screen-reader-text")||y.classList.add("screen-reader-text"),{ids:S,button:M,popover:A,label:document.getElementById(S.labelId),search:document.getElementById(S.searchId),list:document.getElementById(S.listId)}},m=y=>{let S=[];return y&&Array.from(y.children).forEach(A=>{if(A.tagName==="OPTGROUP"){let M=Array.from(A.children).filter($=>$.tagName==="OPTION").map($=>({value:$.value,label:$.textContent.trim(),disabled:$.disabled,selected:$.selected}));S.push({groupLabel:A.label||"",options:M})}else A.tagName==="OPTION"&&S.push({groupLabel:"",options:[{value:A.value,label:A.textContent.trim(),disabled:A.disabled,selected:A.selected}]})}),S},u=(y,S,E="")=>{if(!y||!S)return;let A=E.trim().toLowerCase();if(S.innerHTML="",t(y)){let W=m(y).flatMap(H=>H.options||[]).filter(H=>A?H.label.toLowerCase().includes(A):!0);if(!W.length){let H=document.createElement("div");H.className="aipkit_popover_multiselect_empty aipkit_settings_select_picker_empty",H.textContent=k(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),S.appendChild(H);return}W.forEach(H=>{let N=document.createElement("button");N.type="button",N.className="aipkit_settings_select_picker_item aipkit_popover_multiselect_item aipkit_settings_provider_dropdown_item",N.setAttribute("role","option"),N.dataset.value=H.value,N.dataset.label=H.label,H.disabled&&(N.classList.add("is-disabled"),N.setAttribute("aria-disabled","true")),y.value===H.value?(N.classList.add("is-active"),N.setAttribute("aria-selected","true")):N.setAttribute("aria-selected","false");let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),p(G,H.value);let J=document.createElement("span");J.className="aipkit_settings_select_picker_text aipkit_popover_multiselect_text",J.textContent=H.label,N.appendChild(G),N.appendChild(J),S.appendChild(N)});return}let M=m(y),$=!1;if(M.forEach(W=>{let H=W.options.filter(G=>A?G.label.toLowerCase().includes(A):!0);if(!H.length)return;if(W.groupLabel){let G=document.createElement("div");G.className="aipkit_settings_select_picker_group_label",G.textContent=W.groupLabel,S.appendChild(G)}let N=`aipkit_settings_picker_${y.id}`;H.forEach(G=>{let J=document.createElement("label");J.className="aipkit_settings_select_picker_item aipkit_popover_multiselect_item aipkit_settings_model_dropdown_item",J.setAttribute("role","option"),J.dataset.value=G.value,J.dataset.label=G.label,G.disabled&&(J.classList.add("is-disabled"),J.setAttribute("aria-disabled","true")),y.value===G.value?(J.classList.add("is-active"),J.setAttribute("aria-selected","true")):J.setAttribute("aria-selected","false");let F=document.createElement("span");F.className="aipkit_settings_model_dropdown_item_label";let q=document.createElement("input");q.type="radio",q.className="aipkit_settings_select_picker_radio",q.name=N,q.value=G.value,q.checked=y.value===G.value,q.disabled=!!G.disabled;let O=document.createElement("span");O.className="aipkit_settings_select_picker_text aipkit_popover_multiselect_text",O.textContent=G.label,F.appendChild(q),F.appendChild(O),J.appendChild(F),S.appendChild(J),$=!0})}),!$){let W=document.createElement("div");W.className="aipkit_settings_select_picker_empty",W.textContent=k(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),S.appendChild(W)}},w=(y,S)=>{if(!y||!S)return;let E=e(y);if(S.textContent=E||k("Select","gpt3-ai-content-generator"),t(y)){let A=S.closest("button"),M=A?A.querySelector(".aipkit_settings_select_picker_icon"):null;p(M,y.value)}},h=(y,S)=>{if(!y||!S)return;if(S.closest(".aipkit_settings_provider_dropdown")||S.closest(".aipkit_settings_model_dropdown")){S.style.left="",S.style.top="";return}if(S.closest(".aipkit_settings_select_picker_popover")?.classList.contains("aipkit_settings_select_picker_popover--provider-anchor")){S.style.left="",S.style.top="";return}let E=y.getBoundingClientRect(),A=S.getBoundingClientRect(),M=A.width||320,$=A.height||0,W=window.innerWidth,H=window.innerHeight,N=12;if(y.dataset.aipkitPopoverPlacement==="bottom"){let F=E.left;F+M>W-N&&(F=E.right-M),F=Math.max(N,Math.min(F,W-M-N));let q=E.bottom+8;q+$>H-N&&(q=E.top-$-8),q=Math.max(N,Math.min(q,H-$-N)),S.style.left=`${Math.round(F)}px`,S.style.top=`${Math.round(q)}px`;return}let G=E.right+10;G+M>W-N&&(G=E.left-M-10),G=Math.max(N,Math.min(G,W-M-N));let J=E.top;J+$>H-N&&(J=H-$-N),J=Math.max(N,J),S.style.left=`${Math.round(G)}px`,S.style.top=`${Math.round(J)}px`},C=()=>{if(!(!r||!i||a)){if(d(r)){let y=r.querySelector(".aipkit_popover_multiselect_panel");c(r,y);return}a=!0,window.requestAnimationFrame(()=>{let y=r.querySelector(".aipkit_model_settings_popover_panel");h(i,y),a=!1})}},x=()=>{if(r){if(d(r)){r.classList.remove("is-open"),r.classList.remove("aipkit_settings_dropdown--dropup");let y=r.querySelector(".aipkit_popover_multiselect_panel");y&&(y.hidden=!0,s(y))}else r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true");i&&i.setAttribute("aria-expanded","false"),r=null,i=null}},v=(y,S,E)=>{if(!y||!S)return;r&&r!==S&&x(),r=S,i=y;let A=d(S);if(A){S.classList.add("is-open");let H=S.querySelector(".aipkit_popover_multiselect_panel");H&&(H.hidden=!1)}else S.classList.add("aipkit-active"),S.setAttribute("aria-hidden","false");y.setAttribute("aria-expanded","true");let M=S.querySelector(".aipkit_settings_select_picker_search input"),$=S.querySelector(".aipkit_settings_select_picker_list");if($&&u(E,$,M?M.value:""),A){let H=S.querySelector(".aipkit_popover_multiselect_panel");H&&window.requestAnimationFrame(()=>{c(S,H)})}if(M&&M.offsetParent!==null&&(M.focus(),M.select()),A)return;let W=S.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{h(y,W)})},L=(y,S)=>{if(!y||!S)return;let{button:E,popover:A,list:M,search:$}=S;if(E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("click",W=>{if(W.preventDefault(),r===A){x();return}v(E,A,y)}),E.dataset.pickerListenerAttached="true"),A&&!d(A)&&A.dataset.overlayListenerAttached!=="true"){A.addEventListener("click",H=>{H.target===A&&x()});let W=A.querySelector(".aipkit_model_settings_popover_close");W&&W.addEventListener("click",H=>{H.preventDefault(),x()}),A.dataset.overlayListenerAttached="true"}if(M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("click",W=>{let H=W.target.closest(".aipkit_settings_select_picker_item");if(!H||H.classList.contains("is-disabled"))return;let N=H.dataset.value??"";y.value=N,y.dispatchEvent(new Event("change",{bubbles:!0})),w(y,S.label),u(y,M,$?$.value:""),x()}),M.dataset.pickerListenerAttached="true"),$&&$.dataset.pickerListenerAttached!=="true"&&($.addEventListener("input",()=>{u(y,M,$.value)}),$.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("change",()=>{w(y,S.label),u(y,M,$?$.value:"")}),y.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerObserverAttached!=="true"){let W=!1;new MutationObserver(()=>{W||(W=!0,window.requestAnimationFrame(()=>{w(y,S.label),u(y,M,$?$.value:""),W=!1}))}).observe(y,{childList:!0,subtree:!0}),y.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitSettingsPickerEscapeBound||(document.addEventListener("keydown",W=>{W.key==="Escape"&&r&&x()}),document.body.dataset.aipkitSettingsPickerEscapeBound="true"),document.body.dataset.aipkitSettingsPickerOutsideBound||(document.addEventListener("mousedown",W=>{if(!r||!d(r))return;let H=W.target;r.contains(H)||i&&i.contains(H)||x()}),document.body.dataset.aipkitSettingsPickerOutsideBound="true"),document.body.dataset.aipkitSettingsPickerRepositionBound||(window.addEventListener("resize",C),window.addEventListener("scroll",C,!0),document.body.dataset.aipkitSettingsPickerRepositionBound="true")};function P(){let y=document.getElementById("aipkit_settings_container");if(!y)return;let S=y.querySelectorAll(o);S.length&&S.forEach(E=>{if(!E.id||E.dataset.aipkitPickerInit==="true")return;let A=g(E);A&&(w(E,A.label),u(E,A.list,A.search?A.search.value:""),L(E,A),E.dataset.aipkitPickerInit="true")})}function b(){let y=document.getElementById("aipkit_settings_container");if(!y)return;y.querySelectorAll(o).forEach(E=>{if(!E.id)return;let A=g(E);A&&(w(E,A.label),u(E,A.list,A.search?A.search.value:""),L(E,A),E.dataset.aipkitPickerInit="true")})}window.aipkit_initSettingsSelectPickers=P,window.aipkit_refreshSettingsSelectPickers=b})();(function(){"use strict";function k(r,i,a){if(!r||!i)return;i.hidden=!a,i.style.display=a?"grid":"none",r.querySelectorAll(".aipkit_settings_advanced_toggle_link").forEach(l=>{l.setAttribute("aria-expanded",a?"true":"false"),l.classList.toggle("is-open",a)})}function o(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let i=r.querySelector("#aipkit_settings_advanced_group");if(!i)return;let a=!i.hidden&&i.style.display!=="none";k(r,i,a),r.dataset.aipkitAdvancedToggleInit!=="true"&&(r.addEventListener("click",s=>{let l=s.target.closest(".aipkit_settings_advanced_toggle_link");if(!l||!r.contains(l))return;s.preventDefault();let c=i.hidden;k(r,i,c)}),r.dataset.aipkitAdvancedToggleInit="true")}window.aipkit_initSettingsAdvancedToggle=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_settings_container");if(!o)return;let r=o.querySelectorAll("[data-aipkit-settings-page-link]"),i=o.querySelectorAll("[data-aipkit-settings-page]");if(!r.length||!i.length)return;let a=new Set(Array.from(i).map(c=>c.dataset.aipkitSettingsPage||"")),s=a.has("ai")?"ai":Array.from(a)[0]||"",l=c=>{let n=a.has(c)?c:s;n&&(r.forEach(e=>{let t=e.dataset.aipkitSettingsPageLink===n;e.classList.toggle("is-active",t),e.setAttribute("aria-current",t?"page":"false")}),i.forEach(e=>{let t=e.dataset.aipkitSettingsPage===n;e.hidden=!t}),n==="ai"&&typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers())};r.forEach(c=>{c.dataset.aipkitSettingsPageNavBound!=="true"&&(c.addEventListener("click",n=>{n.preventDefault(),l(c.dataset.aipkitSettingsPageLink||s)}),c.dataset.aipkitSettingsPageNavBound="true")}),l(s)}window.aipkit_initSettingsPageNav=k})();(function(){"use strict";let k=window.wp?.i18n?.__||(f=>f),o="aipkit_settings_global_messages";function r(){return document.getElementById("aipkit_settings_container")}function i(){let f=r();return f?f.querySelector(".aipkit_settings_simple_form--others"):null}function a(f,g){if(typeof window.aipkit_showMessage=="function"){window.aipkit_showMessage(o,f,g);return}f==="error"?console.error(g):console.log(g)}function s(f,g,m=""){if(!f)return;if(g){f.dataset.originalLabel||(f.dataset.originalLabel=f.textContent||""),f.disabled=!0,f.classList.add("aipkit_loading");let w=f.querySelector(".aipkit_spinner");w||(w=document.createElement("span"),w.className="aipkit_spinner",f.appendChild(w)),w.style.display="inline-block",m&&(f.textContent=m,f.appendChild(w));return}f.disabled=!1,f.classList.remove("aipkit_loading"),f.dataset.originalLabel&&(f.textContent=f.dataset.originalLabel,delete f.dataset.originalLabel);let u=f.querySelector(".aipkit_spinner");u&&(u.style.display="none",f.appendChild(u))}function l(f,g){let m=JSON.stringify(f,null,2),u=new Blob([m],{type:"application/json"}),w=URL.createObjectURL(u),h=document.createElement("a");h.href=w,h.download=g,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(w)}function c(f,g){if(!f||typeof f!="object")return"";let m=f[g];return m==null?"":String(m).trim()}function n(f,g){switch(f){case"OpenAI":return c(g,"openai_api_key")!=="";case"OpenRouter":return c(g,"openrouter_api_key")!=="";case"Google":return c(g,"google_api_key")!=="";case"Azure":return c(g,"azure_api_key")!==""&&c(g,"azure_endpoint")!=="";case"Claude":return c(g,"claude_api_key")!=="";case"DeepSeek":return c(g,"deepseek_api_key")!=="";case"Ollama":return c(g,"ollama_base_url")!=="";case"ElevenLabs":case"ElevenLabsModels":return c(g,"elevenlabs_api_key")!=="";case"Replicate":return c(g,"replicate_api_key")!=="";case"PineconeIndexes":return c(g,"pinecone_api_key")!=="";case"QdrantCollections":return c(g,"qdrant_url")!==""&&c(g,"qdrant_api_key")!=="";default:return!1}}async function e(f){if(typeof window.aipkit_apiRequest!="function"){a("error",k("API helper missing.","gpt3-ai-content-generator"));return}s(f,!0,k("Exporting...","gpt3-ai-content-generator"));try{let g=await window.aipkit_apiRequest("aipkit_export_settings_backup");if(!g||typeof g!="object"||!g.export_data)throw new Error(k("Export payload was empty.","gpt3-ai-content-generator"));let m=g.filename||`aipkit-settings-backup-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`;l(g.export_data,m),a("success",g.message||k("Settings export completed.","gpt3-ai-content-generator"))}catch(g){a("error",k("Export failed: ","gpt3-ai-content-generator")+(g?.message||""))}finally{s(f,!1)}}async function t(f,g){let m=f?.files?.[0];if(m){if(typeof window.aipkit_apiRequest!="function"){a("error",k("API helper missing.","gpt3-ai-content-generator"));return}s(g,!0,k("Importing...","gpt3-ai-content-generator")),a("info",k("Importing settings...","gpt3-ai-content-generator"));try{let u=await window.aipkit_apiRequest("aipkit_import_settings_backup",{settings_backup_file:m});a("success",u?.message||k("Settings imported. Reloading...","gpt3-ai-content-generator")),s(g,!1),setTimeout(()=>{window.location.reload()},750)}catch(u){a("error",k("Import failed: ","gpt3-ai-content-generator")+(u?.message||"")),s(g,!1)}finally{f&&(f.value="")}}}async function d(f,g,m){if(typeof window.aipkit_apiRequest!="function")return a("error",k("API helper missing.","gpt3-ai-content-generator")),!1;s(f,!0,k("Working...","gpt3-ai-content-generator"));try{let u=await window.aipkit_apiRequest(g);return a("success",u?.message||m),typeof window.aipkit_updateLastSavedData=="function"&&window.aipkit_updateLastSavedData(),!0}catch(u){return a("error",k("Action failed: ","gpt3-ai-content-generator")+(u?.message||"")),!1}finally{s(f,!1)}}async function _(f){if(typeof window.aipkit_queueProviderSync!="function"){a("error",k("Model sync helper is not available.","gpt3-ai-content-generator"));return}let g=typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_getCurrentFormData():{},u=[{provider:"OpenAI",label:"OpenAI"},{provider:"OpenRouter",label:"OpenRouter"},{provider:"Google",label:"Google"},{provider:"Azure",label:"Azure"},{provider:"Claude",label:"Claude"},{provider:"DeepSeek",label:"DeepSeek"},{provider:"Ollama",label:"Ollama"},{provider:"ElevenLabs",label:"ElevenLabs Voices"},{provider:"ElevenLabsModels",label:"ElevenLabs Models"},{provider:"Replicate",label:"Replicate"},{provider:"PineconeIndexes",label:"Pinecone"},{provider:"QdrantCollections",label:"Qdrant"}].filter(C=>n(C.provider,g));if(!u.length){a("info",k("No providers are ready to sync yet.","gpt3-ai-content-generator"));return}s(f,!0,k("Syncing...","gpt3-ai-content-generator")),a("info",k("Running sync for all ready providers...","gpt3-ai-content-generator"));let w=[],h=[];for(let C of u)try{await window.aipkit_queueProviderSync(C.provider,{silent:!0,showErrors:!1,showSuccess:!1,propagateError:!0}),h.push(C.label)}catch(x){w.push({label:C.label,message:x?.message||k("Unknown error","gpt3-ai-content-generator")})}if(typeof window.aipkit_updateLastSavedData=="function"&&window.aipkit_updateLastSavedData(),w.length>0){let C=w.map(x=>x.label).join(", ");a("error",k("Sync completed with errors: ","gpt3-ai-content-generator")+C)}else a("success",k("Models synced for: ","gpt3-ai-content-generator")+h.join(", "));s(f,!1)}function p(){let f=i();if(!f||f.dataset.aipkitOthersActionsBound==="true")return;let g=f.querySelector("#aipkit_settings_import_trigger"),m=f.querySelector("#aipkit_settings_import_file");f.addEventListener("click",u=>{let w=u.target.closest("[data-aipkit-settings-action]");if(!w||w.disabled)return;let h=w.getAttribute("data-aipkit-settings-action");if(h)switch(u.preventDefault(),h){case"export-backup":e(w);break;case"import-trigger":m&&m.click();break;case"create-restore-point":d(w,"aipkit_create_settings_restore_point",k("Restore point created.","gpt3-ai-content-generator"));break;case"restore-restore-point":d(w,"aipkit_restore_settings_restore_point",k("Restore point applied. Reloading...","gpt3-ai-content-generator")).then(C=>{C&&setTimeout(()=>{window.location.reload()},750)});break;case"clear-model-cache":d(w,"aipkit_clear_settings_model_cache",k("Model cache cleared.","gpt3-ai-content-generator"));break;case"clear-transients":d(w,"aipkit_clear_settings_transients",k("Transient cache cleared.","gpt3-ai-content-generator"));break;case"sync-all-models":_(w);break;default:break}}),m&&m.addEventListener("change",()=>{t(m,g)}),f.dataset.aipkitOthersActionsBound="true"}window.aipkit_initSettingsOthersActions=p})();(function(){"use strict";let k=!1,o=window.aipkit_escapeHtml||(m=>m||""),r={},i={},a=120,s="aipkit_content_writer_messages";function l(m,u){if(!m||typeof m!="string")return"";if(m.length<=u)return m;let w=m.substring(0,u-1);return w.substring(0,w.lastIndexOf(" ")).trim()+"\u2026"}function c(m){let u={"":i.use_default_position||"Default",default:i.use_default_position||"Default",replace:i.replace_selection||"Replace",after:i.insert_after||"After",before:i.insert_before||"Before"};return u[m]||u[""]}function n(m){let u=document.createElement("div");u.className="aipkit_assistant_action_card",u.dataset.actionId=m.id,u.dataset.label=m.label,u.dataset.prompt=m.prompt,u.dataset.insertPosition=m.insert_position||"";let w=o(m.prompt),h=l(w,a),C=w.length>a;return u.innerHTML=`
      <div class="aipkit_assistant_action_drag" draggable="true" title="Drag to reorder">
        <span class="dashicons dashicons-move" aria-hidden="true"></span>
      </div>
      <div class="aipkit_assistant_action_content">
        <div class="aipkit_assistant_action_label">${o(m.label)}</div>
        <div class="aipkit_assistant_action_prompt ${C?"":"aipkit_assistant_action_prompt--full"}">${C?h:w}</div>
        ${C?'<button type="button" class="aipkit-enhancer-prompt-toggle" style="background:none;border:none;padding:0;color:#2271b1;font-size:11px;cursor:pointer;text-decoration:underline;">Show more</button>':""}
      </div>
      <div class="aipkit_assistant_action_controls">
        <button type="button" class="aipkit_assistant_action_btn_small aipkit-enhancer-edit-action-btn" aria-label="${o(i.edit_action||"Edit")}">
          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
        </button>
        <button type="button" class="aipkit_assistant_action_btn_small aipkit_assistant_action_btn_small--danger aipkit-enhancer-delete-action-btn" aria-label="${o(i.delete_action||"Delete")}">
          <span class="dashicons dashicons-trash" aria-hidden="true"></span>
        </button>
      </div>
    `,u}function e(m,u=!1){let w=(m.insert_position||"").trim();return`
      <div class="aipkit_assistant_action_edit_form">
        <div class="aipkit_assistant_action_edit_row">
          <div>
            <label class="aipkit_assistant_action_edit_label">${o(i.action_label||"Label")}</label>
            <input type="text" class="aipkit-edit-label" value="${o(m.label)}" placeholder="${o(i.action_label||"Action name")}" maxlength="50">
          </div>
          <div>
            <label class="aipkit_assistant_action_edit_label">${o(i.insert_position||"Position")}</label>
            <select class="aipkit-edit-position">
              <option value="" ${w===""?"selected":""}>${o(i.use_default_position||"Use default")}</option>
              <option value="replace" ${w==="replace"?"selected":""}>${o(i.replace_selection||"Replace selection")}</option>
              <option value="after" ${w==="after"?"selected":""}>${o(i.insert_after||"Insert after")}</option>
              <option value="before" ${w==="before"?"selected":""}>${o(i.insert_before||"Insert before")}</option>
            </select>
          </div>
        </div>
        <div>
          <label class="aipkit_assistant_action_edit_label">${o(i.action_prompt||"Prompt")}</label>
          <textarea class="aipkit-edit-prompt" rows="3" placeholder="${o("Enter prompt. Use %s for selected text.")}">${o(m.prompt)}</textarea>
        </div>
        <div class="aipkit_assistant_action_edit_actions">
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--secondary aipkit-enhancer-cancel-action-btn">
            ${o(i.cancel||"Cancel")}
          </button>
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--primary aipkit-enhancer-save-action-btn">
            ${o(i.save||"Save")}
          </button>
        </div>
      </div>
    `}function t(m){let u={id:m.dataset.actionId,label:m.dataset.label,prompt:m.dataset.prompt,insert_position:m.dataset.insertPosition||""};m.classList.add("aipkit_assistant_action_card--editing"),m.innerHTML=e(u);let w=m.querySelector(".aipkit-edit-prompt");w&&(w.value=u.prompt);let h=m.querySelector(".aipkit-edit-label");h&&(h.focus(),h.select())}function d(m,u){m.dataset.actionId=u.id,m.dataset.label=u.label,m.dataset.prompt=u.prompt,m.dataset.insertPosition=u.insert_position||"",m.classList.remove("aipkit_assistant_action_card--editing");let w=n(u);m.innerHTML=w.innerHTML}function _(m){if(m.querySelectorAll(".aipkit_assistant_action_card").length>=10){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",i.max_actions_reached||"Maximum of 10 actions reached.");return}if(m.querySelector('[data-action-id^="new-"]'))return;let w=document.createElement("div");w.className="aipkit_assistant_action_card aipkit_assistant_action_card--editing",w.dataset.actionId=`new-${Date.now()}`,w.dataset.label="",w.dataset.prompt="",w.dataset.insertPosition="",w.innerHTML=e({id:w.dataset.actionId,label:"",prompt:"",insert_position:""},!0),m.prepend(w);let h=w.querySelector(".aipkit-edit-label");h&&h.focus()}async function p(m){if(k)return;let u=m.querySelector(".aipkit-edit-label"),w=m.querySelector(".aipkit-edit-prompt"),h=m.querySelector(".aipkit-edit-position");if(!u||!w)return;m.querySelectorAll(".aipkit_form-help-error").forEach(y=>y.remove()),u.style.borderColor="",w.style.borderColor="";let C=u.value.trim(),x=w.value.trim(),v=h?h.value:"",L=m.dataset.actionId,P=!1;if(!C){u.style.borderColor="#dc2626";let y=document.createElement("div");y.className="aipkit_form-help aipkit_form-help-error",y.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",y.textContent=i.label_required||"Label is required",u.parentNode.appendChild(y),P=!0}if(!x){w.style.borderColor="#dc2626";let y=document.createElement("div");y.className="aipkit_form-help aipkit_form-help-error",y.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",y.textContent=i.prompt_required||"Prompt is required",w.parentNode.appendChild(y),P=!0}if(P)return;k=!0;let b=m.querySelector(".aipkit-enhancer-save-action-btn");b&&(b.textContent=i.saving_action||"Saving...",b.disabled=!0);try{let y=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:L,label:C,prompt:x,insert_position:v,_ajax_nonce:r.nonce_manage_actions});d(m,y.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",i.action_saved||"Action saved successfully")}catch(y){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${i.error||"Error"}: ${y.message}`),b&&(b.textContent=i.save||"Save",b.disabled=!1)}finally{k=!1}}async function f(m){let u=m.querySelector("#aipkit_enhancer_actions_list");u.innerHTML=`
      <div class="aipkit_assistant_loading" style="text-align:center;padding:24px;color:#64748b;">
        <span class="dashicons dashicons-update" style="animation:spin 1s linear infinite;"></span>
        <span style="margin-left:8px;">${o(i.loading_actions||"Loading actions...")}</span>
      </div>
    `;try{let w=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions});u.innerHTML="";let h=w.actions||[];h.length===0?u.innerHTML=`
          <div class="aipkit_assistant_empty_state">
            <div class="aipkit_assistant_empty_state_icon">
              <span class="dashicons dashicons-edit-large" aria-hidden="true"></span>
            </div>
            <div class="aipkit_assistant_empty_state_text">
              ${o(i.no_actions||'No actions yet. Click "Add Action" to create one.')}
            </div>
          </div>
        `:h.forEach(C=>{u.appendChild(n(C))})}catch(w){u.innerHTML="",typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",w.message||i.loading_failed||"Failed to load actions.")}}function g(){let m=document.getElementById("aipkit_enhancer_actions_container");if(!m)return;let u=m.closest(".aipkit_assistant_settings_redesigned")||m;if(u.dataset.listenerAttached==="true")return;u.dataset.listenerAttached="true",m.dataset.listenerAttached="true";let w=m.closest(".aipkit_assistant_settings_redesigned")||u;r=window.aipkit_post_enhancer||{},i=r.text||{};let h=m.querySelector("#aipkit_enhancer_actions_list");if(!h)return;let C=w.querySelectorAll(".aipkit_assistant_position_option"),x=()=>{C.forEach(b=>{let y=b.querySelector("input[type=radio]");b.classList.toggle("aipkit_assistant_position_option--active",!!(y&&y.checked))})};x(),C.forEach(b=>{let y=b.querySelector("input[type=radio]");y&&y.addEventListener("change",x)});let v=null,L=null,P=async()=>{if(k)return;let b=Array.from(h.querySelectorAll(".aipkit_assistant_action_card")).map(A=>A.dataset.actionId).filter(A=>A&&!A.startsWith("new-"));if(!b.length)return;let y=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,S=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,E=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;k=!0,y&&y(i.saving_order||"Saving order...");try{await window.aipkit_apiRequest("aipkit_reorder_enhancer_actions",{order:b,_ajax_nonce:r.nonce_manage_actions}),S&&S(i.order_saved||"Order saved.")}catch(A){E?E(`${i.error||"Error"}: ${A.message}`):typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${i.error||"Error"}: ${A.message}`)}finally{k=!1}};h.addEventListener("dragstart",b=>{let y=b.target.closest(".aipkit_assistant_action_drag");if(!y)return;let S=y.closest(".aipkit_assistant_action_card");if(!S||S.classList.contains("aipkit_assistant_action_card--editing")){b.preventDefault();return}v=S,S.classList.add("aipkit_dragging");try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",S.dataset.actionId||"")}catch{}}),h.addEventListener("dragend",async()=>{v&&v.classList.remove("aipkit_dragging"),v=null,L=null,await P()}),h.addEventListener("dragover",b=>{if(!v)return;let y=b.target.closest(".aipkit_assistant_action_card");if(!y||y===v)return;b.preventDefault();let S=y.getBoundingClientRect(),A=b.clientY<S.top+S.height/2?y:y.nextSibling;(L!==y||v.nextSibling!==A)&&(h.insertBefore(v,A),L=y)}),h.addEventListener("drop",async b=>{v&&(b.preventDefault(),await P())}),u.addEventListener("click",async b=>{let y=b.target.closest(".aipkit-enhancer-add-new-btn"),S=b.target.closest(".aipkit-enhancer-reset-actions-btn"),E=b.target.closest(".aipkit-enhancer-edit-action-btn"),A=b.target.closest(".aipkit-enhancer-delete-action-btn"),M=b.target.closest(".aipkit-enhancer-save-action-btn"),$=b.target.closest(".aipkit-enhancer-cancel-action-btn"),W=b.target.closest(".aipkit-enhancer-prompt-toggle");if(y)_(h);else if(S){if(!confirm(i.confirm_reset_actions||"Reset all actions to defaults? This cannot be undone."))return;try{await window.aipkit_apiRequest("aipkit_reset_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions}),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",i.actions_reset||"Actions reset to defaults."),f(m)}catch(H){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${i.error||"Error"}: ${H.message}`)}}else if(W){let H=W.closest(".aipkit_assistant_action_card"),N=H.querySelector(".aipkit_assistant_action_prompt"),G=H.dataset.prompt;W.textContent.toLowerCase().includes("more")?(N.textContent=o(G),N.classList.add("aipkit_assistant_action_prompt--full"),W.textContent="Show less"):(N.textContent=l(o(G),a),N.classList.remove("aipkit_assistant_action_prompt--full"),W.textContent="Show more")}else if(E)t(E.closest(".aipkit_assistant_action_card"));else if(M)await p(M.closest(".aipkit_assistant_action_card"));else if($){let H=$.closest(".aipkit_assistant_action_card");H.dataset.actionId.startsWith("new-")?H.remove():d(H,{id:H.dataset.actionId,label:H.dataset.label,prompt:H.dataset.prompt,insert_position:H.dataset.insertPosition})}else if(A){if(k)return;let H=A.closest(".aipkit_assistant_action_card"),N=H.dataset.actionId;if(!confirm(i.confirm_delete_action||"Delete this action? This cannot be undone."))return;k=!0,A.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:N,_ajax_nonce:r.nonce_manage_actions}),H.style.transition="opacity 0.2s, transform 0.2s",H.style.opacity="0",H.style.transform="translateX(-10px)",setTimeout(()=>H.remove(),200),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"success",i.action_deleted||"Action deleted.")}catch(G){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(s,"error",`${i.error||"Error"}: ${G.message}`),A.disabled=!1}finally{k=!1}}}),u.addEventListener("keydown",b=>{if(b.key==="Enter"&&b.target.matches("input[type=text]")){b.preventDefault();let y=b.target.closest(".aipkit_assistant_action_card--editing");y&&p(y)}}),window.aipkit_enhancer_reload_actions=()=>f(m),f(m)}window.aipkit_initEnhancerActionsUI=g})();(function(){"use strict";let k=[],o=[];function r(s){let l=document.getElementById("aipkit_semantic_search_target_id");if(!l)return;let c=l.value;l.innerHTML='<option value="">-- Select --</option>';let n=[];s==="pinecone"?n=k:s==="qdrant"&&(n=o),Array.isArray(n)&&n.forEach(e=>{let t=e.name||e.id||(typeof e=="string"?e:null);if(t){let d=document.createElement("option");d.value=t,d.textContent=t,l.appendChild(d)}}),l.querySelector(`option[value="${CSS.escape(c)}"]`)&&(l.value=c)}function i(s){let l=document.getElementById("aipkit_semantic_search_embedding_provider");if(!l||!s)return;let c=s.options[s.selectedIndex];c&&c.dataset.provider&&(l.value=c.dataset.provider)}function a(){let s=document.getElementById("aipkit_settings_container");if(!s)return;let l="data-semantic-search-listener-attached";if(s.getAttribute(l))return;let c=document.getElementById("aipkit_semantic_search_vector_provider"),n=document.getElementById("aipkit_pinecone_indexes_json_main"),e=document.getElementById("aipkit_qdrant_collections_json_main"),t=document.getElementById("aipkit_semantic_search_embedding_model");if(c){if(n&&n.dataset.indexes)try{k=JSON.parse(n.dataset.indexes)||[]}catch(d){console.error("Error parsing Pinecone indexes JSON:",d)}if(e&&e.dataset.collections)try{o=JSON.parse(e.dataset.collections)||[]}catch(d){console.error("Error parsing Qdrant collections JSON:",d)}c&&(c.addEventListener("change",d=>{if(r(d.target.value),typeof window.aipkit_handleAutoSave=="function"){let _=document.getElementById("aipkit_semantic_search_target_id");_&&(_.value=""),window.aipkit_handleAutoSave()}}),r(c.value)),t&&(t.addEventListener("change",d=>{i(d.target)}),i(t)),s.setAttribute(l,"true")}}window.aipkit_initSemanticSearchUI=a})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let i=r.querySelector("#aipkit_provider");if(!i)return;let a=i.value,s=r.querySelectorAll(".aipkit_api_key_field"),l=r.querySelectorAll(".aipkit_model_field"),c=r.querySelectorAll(".aipkit_advanced_settings_provider"),n=r.querySelector("#aipkit_safety_settings_accordion"),e=r.querySelectorAll(".aipkit_param_not_openai");s.forEach(p=>p.style.display="none"),l.forEach(p=>p.style.display="none"),c.forEach(p=>p.style.display="none"),n&&(n.style.display="none"),r.querySelectorAll(`.aipkit_api_key_field[data-provider="${a}"]`).forEach(p=>{p.style.display=p.classList.contains("aipkit_settings_simple_row")?"grid":"block"}),r.querySelectorAll(`.aipkit_model_field[data-provider="${a}"]`).forEach(p=>{p.style.display=p.classList.contains("aipkit_settings_simple_row")?"grid":"block"});let _=r.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${a}"]`);_&&(_.style.display="block"),a==="Google"&&n&&(n.style.display="block"),a==="OpenAI"||a==="Google"?e.forEach(p=>p.style.display="none"):e.forEach(p=>p.style.display="block"),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function o(){let r=document.getElementById("aipkit_provider");if(r){let i="data-provider-listener-attached";if(r.getAttribute(i)==="true")return;r.addEventListener("change",function(){let a=r.value;k();let s=function(){if(typeof window.aipkit_queueProviderSync!="function"||typeof window.aipkit_getCurrentFormData!="function"||typeof window.aipkit_isProviderReadyForAutoSync!="function")return;let c=window.aipkit_getCurrentFormData();if(window.aipkit_isProviderReadyForAutoSync(a,c)){window.aipkit_queueProviderSync(a,{silent:!0,showSuccess:!0});return}typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage("aipkit_settings_global_messages","info",a+" credentials missing. Add API key.")},l=null;typeof window.aipkit_handleAutoSave=="function"?l=window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found."),l&&typeof l.finally=="function"?l.finally(s):s()}),r.setAttribute(i,"true"),k()}}window.aipkit_toggleProviderFields=k,window.aipkit_initProviderSelectListener=o})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_settings_container");!r||r.dataset.aipkitLabelClickGuard==="true"||(r.addEventListener("click",function(i){let a=i.target.closest(".aipkit_settings_simple_row > .aipkit_form-label, .aipkit_settings_advanced_label");!a||!r.contains(a)||i.preventDefault()}),r.dataset.aipkitLabelClickGuard="true")}function o(){k(),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),typeof window.aipkit_initSettingsSelectPickers=="function"?window.aipkit_initSettingsSelectPickers():console.error("Settings Init: aipkit_initSettingsSelectPickers not found."),typeof window.aipkit_initSettingsAdvancedToggle=="function"?window.aipkit_initSettingsAdvancedToggle():console.error("Settings Init: aipkit_initSettingsAdvancedToggle not found."),typeof window.aipkit_initSettingsPageNav=="function"?window.aipkit_initSettingsPageNav():console.error("Settings Init: aipkit_initSettingsPageNav not found."),typeof window.aipkit_initSettingsOthersActions=="function"?window.aipkit_initSettingsOthersActions():console.error("Settings Init: aipkit_initSettingsOthersActions not found."),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(i=>{i.dataset.accordionListenerAttached!=="true"&&(i.addEventListener("click",function(){let a=this.nextElementSibling;if(a){this.classList.toggle("aipkit_active"),a.classList.toggle("aipkit_active");let s=this.closest(".aipkit_accordion");s?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(s.style.display="block")}}),i.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found."),typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found.")}window.aipkit_initSettings=o})();(function(){"use strict";let k=!1;function o(){let r=document.getElementById("aipkit_role_manager_container");if(!r){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let i=r.querySelector("#aipkit_save_roles_btn"),a=r.querySelector("#aipkit_role_manager_form"),s=r.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),s&&(s.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let l=window.aipkit_role_manager_config,c=l.text||{};if(!i||!a||!s){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let n="data-role-save-listener";i.getAttribute(n)||(i.addEventListener("click",function(e){if(e.preventDefault(),k)return;k=!0;let t=i.querySelector(".aipkit_btn-text"),d=i.querySelector(".aipkit_spinner");i.disabled=!0,d&&(d.style.display="inline-block"),t&&(t.textContent=c.saving||"Saving..."),s.innerHTML="",s.className="aipkit_settings_messages";let _=new FormData(a);_.append("action","aipkit_save_role_permissions"),fetch(l.ajaxurl,{method:"POST",body:_,credentials:"same-origin"}).then(p=>p.ok?p.json():p.json().then(f=>{throw new Error(f.data.message||`HTTP error! status: ${p.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${p.status}`)})).then(p=>{if(!p.success){let f=p.data&&p.data.message?p.data.message:"An unknown error occurred.";throw new Error(f)}return p.data}).then(p=>{let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-success",f.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${p.message||c.success||"Permissions saved!"}`,s.appendChild(f),setTimeout(()=>{f.remove()},4e3)}).catch(p=>{console.error("AIPKit Role Manager Save Error:",p);let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-error",f.innerHTML=`<span class="dashicons dashicons-warning"></span> ${p.message||c.fail||"Failed to save permissions."}`,s.appendChild(f),setTimeout(()=>{f.remove()},6e3)}).finally(()=>{k=!1,i.disabled=!1,d&&(d.style.display="none"),t&&(t.textContent=c.saveButton||"Save Permissions")})}),i.setAttribute(n,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&o()}),window.aipkit_initRoleManager=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}o.addEventListener("change",function(i){let a=i.target,s=a.closest(".aipkit_chatbot-settings-area");if(!s)return;if(a.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(s),window.aipkit_toggleOpenAISpecificSettingsVisibility(s),window.aipkit_toggleGoogleSpecificSettingsVisibility(s),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(s);return}if(a.matches('select[name$="_model"]')||a.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(s);return}let l=a.closest(".aipkit_stt_provider_select");if(l){let f=l.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f?window.aipkit_toggleSttModelFields(f):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",l);return}let c=a.closest(".aipkit_vector_store_toggle_switch");if(c){let f=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");if(f){window.aipkit_toggleVectorStoreSettingsVisibility(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f);let g=f.querySelector('.aipkit_feature_config_btn[data-feature="vector_store"]');g&&(g.disabled=!c.checked,g.title=c.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let n=a.closest(".aipkit_vector_store_provider_select");if(n){let f=n.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&(window.aipkit_toggleVectorStoreProviderFields(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f));return}let e=a.closest(".aipkit_vector_embedding_provider_select");if(e){let f=e.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_populateVectorEmbeddingModelSelect(f);return}let t=a.closest(".aipkit_openai_web_search_enable_toggle");if(t){let f=t.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleOpenAIWebSearchSubSettings(f);let g=f.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');g&&(g.disabled=!t.checked)}return}let d=a.closest(".aipkit_openai_web_search_loc_type_select");if(d){let f=d.closest(".aipkit_chatbot-settings-area");f&&window.aipkit_toggleOpenAIWebSearchLocationDetails(f);return}let _=a.closest(".aipkit_google_search_grounding_enable_toggle");if(_){let f=_.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleGoogleSearchGroundingSubSettings(f);let g=f.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');g&&(g.disabled=!_.checked)}return}let p=a.closest(".aipkit_google_grounding_mode_select");if(p){let f=p.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_toggleGoogleGroundingDynamicThreshold(f);return}}),o.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{i.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(i),window.aipkit_toggleOpenAISpecificSettingsVisibility(i),window.aipkit_toggleGoogleSpecificSettingsVisibility(i)),i.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(i),i.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(i),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(i));let a=i.querySelector(".aipkit_openai_web_search_enable_toggle"),s=i.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');s&&a&&(s.disabled=!a.checked,s.title=a.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure");let l=i.querySelector(".aipkit_google_search_grounding_enable_toggle"),c=i.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');c&&l&&(c.disabled=!l.checked,c.title=l.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")})}window.aipkit_initProviderSelectToggles=k})();(function(){"use strict";function k(o){if(!o){console.warn("AIPKit Chat Fields: No settings area provided to toggle model fields.");return}let r=o.querySelector(".aipkit_chatbot_provider_select");if(!r){console.warn("AIPKit Chat Fields: Provider select not found in the given settings area.");return}let i=r.value,a=["OpenAI","Google","Claude","OpenRouter","Azure","Ollama","DeepSeek"];o.querySelectorAll(".aipkit_chatbot_model_field").forEach(c=>{c.style.display="none";let n=c.querySelector(".aipkit_cb_web_search_toggle");n&&(n.style.display="none");let e=c.querySelector(".aipkit_cb_stateful_conv_toggle");e&&(e.style.display="none");let t=c.querySelector(".aipkit_cb_image_upload_toggle");t&&(t.style.display="none");let d=c.querySelector(".aipkit_cb_voice_input_toggle");d&&(d.style.display="none")});let l=o.querySelector(`.aipkit_chatbot_model_field[data-provider="${i}"]`);if(l){l.style.display="block",o.querySelectorAll(".aipkit_feature_toggle_item").forEach(_=>{let p=(_.dataset.providers||"").trim();if(!p||p==="*"){_.style.display="";return}let f=p.split(/\s+/);_.style.display=f.includes(i)?"":"none"}),typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(o),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(o);let n=l.querySelector(".aipkit_cb_web_search_toggle");n&&(n.dataset.provider||"").split(" ").includes(i)&&(n.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(o));let e=l.querySelector(".aipkit_cb_stateful_conv_toggle");e&&i==="OpenAI"&&(e.style.display="inline-flex");let t=l.querySelector(".aipkit_cb_image_upload_toggle");t&&(i==="OpenAI"||i==="Claude"?(t.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(o)):t.style.display="none");let d=l.querySelector(".aipkit_cb_voice_input_toggle");d&&(d.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(o)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(o)}}window.aipkit_toggleChatbotModelFields=k})();(function(){"use strict";function k(o){o&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(o)}window.aipkit_toggleOpenAISpecificSettingsVisibility=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=r?.value==="OpenAI",a=o.querySelector(".aipkit_openai_web_search_enable_toggle");a||(a=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),a||(a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let s=o.querySelector(".aipkit_openai_web_search_conditional_settings");if(!a||!s)return;let l=a.tagName==="SELECT"?a.value==="1":a.checked;if(s.style.display=i&&l?"block":"none",i&&l)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(o);else{let c=o.querySelector(".aipkit_openai_web_search_location_details");c&&(c.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_openai_web_search_enable_toggle");r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let i=o.querySelector(".aipkit_openai_web_search_loc_type_select"),a=o.querySelector(".aipkit_openai_web_search_location_details");if(!i||!a){a&&(a.style.display="none");return}let s=r?r.tagName==="SELECT"?r.value==="1":r.checked:!1,l=(i.value||"")==="approximate";a.style.display=s&&l?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=k})();(function(){"use strict";function k(o){o&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(o)}window.aipkit_toggleGoogleSpecificSettingsVisibility=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=r?.value==="Google",a=o.querySelector(".aipkit_google_search_grounding_enable_toggle");a||(a=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),a||(a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let s=o.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!a||!s)return;let l=a.tagName==="SELECT"?a.value==="1":a.checked,c=i&&l;s.style.display=c?"block":"none",c?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(o):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(o,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=k})();(function(){"use strict";function k(o,r=null){if(!o)return;let i=o.querySelector(".aipkit_google_grounding_mode_select"),a=o.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),s=o.querySelector(".aipkit_google_search_grounding_enable_toggle");s||(s=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),s||(s=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let l=o.querySelector(".aipkit_google_search_grounding_conditional_settings"),c=l&&l.style.display==="none";if(!i||!a||!s){a&&(a.style.display="none");return}if(c){a.style.display="none";return}let n=r!==null?r:(s.tagName==="SELECT"?s.value==="1":s.checked)&&i.value==="MODE_DYNAMIC";a.style.display=n?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_stt_provider_select");if(!r)return;let i=r.value;o.querySelectorAll(".aipkit_stt_model_field").forEach(s=>{s.style.display=s.getAttribute("data-stt-provider")===i?"block":"none"})}window.aipkit_toggleSttModelFields=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_toggle_switch");r||(r=o.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let i=o.querySelector(".aipkit_vector_store_settings_conditional_row"),a=o.querySelector(".aipkit_context_grid"),s=o.querySelector(".aipkit_context_layout"),l=o.querySelector(".aipkit_vector_store_advanced_field"),c=o.querySelector(".aipkit_vector_store_top_k_field"),n=o.querySelector(".aipkit_vector_store_confidence_field");if(!r||!i)return;let e=r.tagName==="SELECT"?r.value==="1":r.checked;if(i.style.display=e?"block":"none",l){if(l.style.display=e?"block":"none",!e){let t=l.querySelector(".aipkit_vector_store_advanced_disclosure");t&&(t.open=!1)}c&&(c.style.display=""),n&&(n.style.display="")}else c&&(c.style.display=e?"block":"none"),n&&(n.style.display=e?"block":"none");e?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(o):(o.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_pinecone_key_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_qdrant_url_field, .aipkit_vector_store_qdrant_key_field, .aipkit_vector_store_embedding_config_row").forEach(t=>t.style.display="none"),a&&a.setAttribute("data-vector-provider",""),s&&s.setAttribute("data-vector-provider",""))}window.aipkit_toggleVectorStoreSettingsVisibility=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_provider_select"),i=o.querySelector(".aipkit_vector_store_toggle_switch");if(i||(i=o.querySelector(".aipkit_vector_store_enable_select")),i||(i=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select")),!r||!i)return;let a=o.closest(".aipkit_chatbot_builder")||document.querySelector(".aipkit_chatbot_builder"),s=o.querySelector(".aipkit_chatbot_provider_select")||(a?a.querySelector(".aipkit_chatbot_provider_select"):null),c=(s?String(s.value||"").trim():"").toLowerCase()==="claude",n=Array.from(r.options||[]).find(P=>P&&P.value==="claude_files");if(n){let P=!!n.disabled;if(n.disabled=!c,P!==n.disabled&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),n.disabled&&r.value==="claude_files"){let b=Array.from(r.options||[]).find(y=>y&&y.value&&!y.disabled&&y.value!=="claude_files");if(b&&r.value!==b.value){r.value=b.value,r.dispatchEvent(new Event("change",{bubbles:!0}));return}}}let e=r.value,t=i.tagName==="SELECT"?i.value==="1":i.checked,d=o.querySelector(".aipkit_context_grid"),_=o.querySelector(".aipkit_context_layout"),p=o.querySelector(".aipkit_vector_store_openai_field"),f=o.querySelector(".aipkit_vector_store_pinecone_field"),g=o.querySelector(".aipkit_vector_store_pinecone_key_field"),m=o.querySelector(".aipkit_vector_store_qdrant_field"),u=o.querySelector(".aipkit_vector_store_qdrant_url_field"),w=o.querySelector(".aipkit_vector_store_qdrant_key_field"),h=o.querySelector(".aipkit_vector_store_embedding_config_row"),C=o.querySelector(".aipkit_vector_store_advanced_field"),x=o.querySelector(".aipkit_vector_store_top_k_field"),v=o.querySelector(".aipkit_vector_store_confidence_field"),L=["openai","pinecone","qdrant"].includes(e);if(p&&(p.style.display=t&&e==="openai"?"block":"none"),f&&(f.style.display=t&&e==="pinecone"?"block":"none"),g&&(g.style.display=t&&e==="pinecone"?"block":"none"),m&&(m.style.display=t&&e==="qdrant"?"block":"none"),u&&(u.style.display=t&&e==="qdrant"?"block":"none"),w&&(w.style.display=t&&e==="qdrant"?"block":"none"),h&&(h.style.display=t&&(e==="pinecone"||e==="qdrant")?"block":"none"),C){if(C.style.display=t&&L?"block":"none",!t||!L){let P=C.querySelector(".aipkit_vector_store_advanced_disclosure");P&&(P.open=!1)}x&&(x.style.display=""),v&&(v.style.display="")}else x&&(x.style.display=t&&L?"block":"none"),v&&(v.style.display=t&&L?"block":"none");d&&d.setAttribute("data-vector-provider",t?e:""),_&&_.setAttribute("data-vector-provider",t?e:""),t&&e==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(o):t&&(e==="pinecone"||e==="qdrant")&&(e==="pinecone"&&typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(o),e==="qdrant"&&typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"&&window.aipkit_populateQdrantCollectionsMultiSelect(o),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(o),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(o))}window.aipkit_toggleVectorStoreProviderFields=k})();(function(){"use strict";let k=!1,o=window.wp&&window.wp.i18n?window.wp.i18n:null,r=o&&typeof o.__=="function"?o.__:l=>l;function i(l){let c=l.querySelector('select[name="openai_vector_store_ids[]"]'),n=window.aipkit_escapeHtml||function(P){return P};if(!c)return;let e=l.querySelector("[data-aipkit-vector-stores-dropdown]"),t=e?e.querySelector(".aipkit_popover_multiselect_btn"):null,d=e?e.querySelector(".aipkit_popover_multiselect_label"):null,_=e?e.querySelector(".aipkit_popover_multiselect_panel"):null,p=e?e.querySelector(".aipkit_popover_multiselect_options"):null,f=e?.dataset.placeholder||"Select stores",g=e?.dataset.selectedLabel||"selected",m=window.aipkit_chat_config?.openaiVectorStores||[],u=a(c),w=Array.from(c.options).filter(P=>P.selected).map(P=>P.value),h=u&&u.length?u:w;if(c.innerHTML="",m.length>0){let P=1;m.forEach(b=>{if(b&&b.id){let y="(Files: N/A)";b.file_counts&&typeof b.file_counts.total=="number"?y=`(${b.file_counts.total} ${b.file_counts.total===1?"File":"Files"})`:b.file_counts&&(y="(Files: ?)");let S=b.name||`Untitled store ${P}`,E=`${n(S)} ${y}`,A=document.createElement("option");A.value=b.id,A.textContent=E,h.includes(b.id)&&(A.selected=!0),c.appendChild(A),P+=1}})}m.length>0&&h.forEach(P=>{if(!m.some(y=>y.id===P)&&!c.querySelector(`option[value="${CSS.escape(P)}"]`)){let y=document.createElement("option");y.value=P,y.textContent=P,y.selected=!0,c.appendChild(y)}}),c.options.length===0&&(c.innerHTML='<option value="" disabled>-- No vector stores found --</option>');let C=()=>{if(!d)return;let P=Array.from(c.options).filter(y=>y.selected&&y.value);if(!P.length){d.textContent=f;return}let b=P.map(y=>y.textContent.trim()).filter(Boolean);if(b.length<=2){d.textContent=b.join(", ");return}d.textContent=`${b.length} ${g}`},x=()=>{if(!p)return;let P=Array.from(p.querySelectorAll('input[type="checkbox"]:checked'));if(P.length>2){let y=P[P.length-1];y&&(y.checked=!1)}let b=Array.from(p.querySelectorAll('input[type="checkbox"]:checked')).map(y=>y.value);Array.from(c.options).forEach(y=>{y.selected=b.includes(y.value)}),c.dispatchEvent(new Event("change",{bubbles:!0})),C()},v=()=>{if(!p)return;p.innerHTML="";let P=Array.from(c.options),b=P.filter(y=>y.value);if(!b.length){let y=document.createElement("div");y.className="aipkit_popover_multiselect_empty",y.textContent=P[0]?.textContent||"-- No Stores Found --",p.appendChild(y),C();return}b.forEach(y=>{let S=document.createElement("label");S.className="aipkit_popover_multiselect_item";let E=document.createElement("input");E.type="checkbox",E.value=y.value,E.checked=y.selected,E.disabled=y.disabled;let A=document.createElement("span");A.className="aipkit_popover_multiselect_text",A.textContent=y.textContent,S.appendChild(E),S.appendChild(A),p.appendChild(S)}),C()},L=P=>{!e||!t||(e.classList.toggle("is-open",P),t.setAttribute("aria-expanded",P?"true":"false"),_&&(_.hidden=!P))};e&&t&&!e.dataset.listenerAttached&&(t.addEventListener("click",P=>{P.preventDefault(),L(!e.classList.contains("is-open"))}),document.addEventListener("click",P=>{e.classList.contains("is-open")&&(e.contains(P.target)||L(!1))}),t.addEventListener("keydown",P=>{P.key==="Escape"&&L(!1)}),e.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",x),p.dataset.listenerAttached="true"),v(),s(l,{selectElement:c,dropdown:e,dropdownPanel:_,dropdownOptions:p,setOpenState:L,placeholder:f})}function a(l){if(!l||!l.dataset.aipkitPendingVectorSelection)return[];let c=[];try{let n=JSON.parse(l.dataset.aipkitPendingVectorSelection);Array.isArray(n)&&(c=n.map(e=>String(e||"").trim()).filter(Boolean).slice(-2))}catch{c=[]}return delete l.dataset.aipkitPendingVectorSelection,c}function s(l,c){let{selectElement:n,dropdown:e,dropdownPanel:t,dropdownOptions:d,setOpenState:_,placeholder:p}=c||{};if(!e||!t||!d||!n)return;let f=t.querySelector(".aipkit_vector_store_dropdown_actions");f||(f=document.createElement("div"),f.className="aipkit_vector_store_dropdown_actions",f.innerHTML=`
        <div class="aipkit_vector_store_dropdown_action_list">
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_vector_store_dropdown_new_btn">
            <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
            ${r("New Store","gpt3-ai-content-generator")}
          </button>
        </div>
        <div class="aipkit_vector_store_dropdown_inline_form" style="display:none;">
          <input
            type="text"
            class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--framed aipkit_vector_store_dropdown_name_input"
            placeholder="${r("e.g. Product FAQ","gpt3-ai-content-generator")}"
          />
          <div class="aipkit_vector_store_dropdown_inline_actions">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_vector_store_dropdown_cancel_btn">
              ${r("Cancel","gpt3-ai-content-generator")}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_vector_store_dropdown_create_btn">
              ${r("Create","gpt3-ai-content-generator")}
            </button>
          </div>
        </div>
        <p class="aipkit_form-help aipkit_vector_store_dropdown_status" style="display:none;" aria-live="polite"></p>
      `,t.insertBefore(f,d));let g=f.querySelector(".aipkit_vector_store_dropdown_action_list"),m=f.querySelector(".aipkit_vector_store_dropdown_inline_form"),u=f.querySelector(".aipkit_vector_store_dropdown_create_btn"),w=f.querySelector(".aipkit_vector_store_dropdown_cancel_btn"),h=f.querySelector(".aipkit_vector_store_dropdown_new_btn"),C=f.querySelector(".aipkit_vector_store_dropdown_name_input"),x=f.querySelector(".aipkit_vector_store_dropdown_status"),v=()=>{f&&typeof f._aipkitVectorStoreStatusTimer=="number"&&f._aipkitVectorStoreStatusTimer&&(window.clearTimeout(f._aipkitVectorStoreStatusTimer),f._aipkitVectorStoreStatusTimer=0)},L=(A=3200)=>{v(),f&&(f._aipkitVectorStoreStatusTimer=window.setTimeout(()=>{P("")},A))},P=(A,M="",$=0)=>{v(),x&&(x.textContent=A||"",x.style.display=A?"block":"none",x.classList.remove("aipkit_color_notice_success","aipkit_color_notice_error","aipkit_color_notice_info"),M==="success"?x.classList.add("aipkit_color_notice_success"):M==="error"?x.classList.add("aipkit_color_notice_error"):M==="info"&&x.classList.add("aipkit_color_notice_info"),A&&Number($)>0&&L(Number($)))},b=()=>{C&&(C.value=""),g&&(g.style.display=""),m&&(m.style.display="none"),P("")},y=()=>{g&&(g.style.display="none"),m&&(m.style.display="block"),P(""),C&&(C.focus(),C.select())},S=async()=>{if(!u||!C)return;let A=String(C.value||"").trim();if(!A){P(r("Store name is required.","gpt3-ai-content-generator"),"error",3e3);return}if(typeof window.aipkit_apiRequest!="function"){P(r("API request helper is unavailable.","gpt3-ai-content-generator"),"error",3e3);return}let M=document.getElementById("aipkit_vector_store_nonce_openai"),$=M?String(M.value||"").trim():"";if(!$){P(r("OpenAI nonce is missing.","gpt3-ai-content-generator"),"error",3e3);return}let W=u.textContent;u.disabled=!0,u.textContent=r("Creating...","gpt3-ai-content-generator"),w&&(w.disabled=!0),P("");try{let H=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:$,name:A,source_type:"chatbot_training_text"}),N=H?.store||H;if(!N||!N.id)throw new Error(r("OpenAI vector store creation failed.","gpt3-ai-content-generator"));window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]);let G=window.aipkit_chat_config.openaiVectorStores;G.some(O=>O&&O.id===N.id)||G.unshift(N);let q=Array.from(n.options).filter(O=>O.selected&&O.value).map(O=>O.value).filter(O=>O&&O!==N.id).slice(-1);q.push(N.id),n.dataset.aipkitPendingVectorSelection=JSON.stringify(q),i(l),_(!0),P(H?.message||r("Vector store created.","gpt3-ai-content-generator"),"success",2800)}catch(H){let N=H&&H.message?H.message:r("Create failed.","gpt3-ai-content-generator");P(`${r("Error:","gpt3-ai-content-generator")} ${N}`,"error",3200)}finally{u.disabled=!1,u.textContent=W,w&&(w.disabled=!1)}},E=typeof window.aipkit_apiRequest=="function";h&&(h.disabled=!E,E?h.removeAttribute("title"):h.setAttribute("title",r("Creation is unavailable right now.","gpt3-ai-content-generator"))),f.dataset.listenerAttached||(h&&h.addEventListener("click",()=>{y()}),w&&w.addEventListener("click",()=>{b()}),u&&u.addEventListener("click",S),C&&C.addEventListener("keydown",A=>{if(A.key==="Enter"){A.preventDefault(),S();return}A.key==="Escape"&&(A.preventDefault(),b())}),f.dataset.listenerAttached="true"),d.children.length?(h&&(h.textContent=r("New Store","gpt3-ai-content-generator")),(!m||m.style.display==="none")&&P("")):(P(r("No stores found. Create your first one.","gpt3-ai-content-generator"),"info"),h&&(h.textContent=r("Create Store","gpt3-ai-content-generator"))),!n.value&&p&&e&&!e.classList.contains("is-open")&&_(!1)}window.aipkit_populateOpenAIVectorStoresMultiSelect=i,k||(window.addEventListener("aipkit:vector-store-list-updated",l=>{if(String(l?.detail?.provider||"").toLowerCase()!=="openai")return;Array.from(document.querySelectorAll('select[name="openai_vector_store_ids[]"]')).forEach(e=>{let t=e.closest(".aipkit_settings_accordion_body")||e.closest(".aipkit_chatbot_builder")||e.parentElement;t&&i(t)})}),k=!0)})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector('select[name="qdrant_collection_names[]"]');if(!r)return;let i=o.querySelector("[data-aipkit-qdrant-collections-dropdown]"),a=i?i.querySelector(".aipkit_popover_multiselect_btn"):null,s=i?i.querySelector(".aipkit_popover_multiselect_label"):null,l=i?i.querySelector(".aipkit_popover_multiselect_panel"):null,c=i?i.querySelector(".aipkit_popover_multiselect_options"):null;if(!i||!c)return;let n=i.dataset.placeholder||"Select collections",e=i.dataset.selectedLabel||"selected",t=()=>{if(!s)return;let f=Array.from(r.options).filter(m=>m.selected&&m.value);if(!f.length){s.textContent=n;return}let g=f.map(m=>m.textContent.trim()).filter(Boolean);if(g.length<=2){s.textContent=g.join(", ");return}s.textContent=`${g.length} ${e}`},d=()=>{let f=Array.from(c.querySelectorAll('input[type="checkbox"]:checked')).map(g=>g.value);Array.from(r.options).forEach(g=>{g.selected=f.includes(g.value)}),r.dispatchEvent(new Event("change",{bubbles:!0})),t()},_=()=>{c.innerHTML="";let f=Array.from(r.options),g=f.filter(m=>m.value);if(!g.length){let m=document.createElement("div");m.className="aipkit_popover_multiselect_empty",m.textContent=f[0]?.textContent||"-- No Collections Found --",c.appendChild(m),t();return}g.forEach(m=>{let u=document.createElement("label");u.className="aipkit_popover_multiselect_item";let w=document.createElement("input");w.type="checkbox",w.value=m.value,w.checked=m.selected,w.disabled=m.disabled;let h=document.createElement("span");h.className="aipkit_popover_multiselect_text",h.textContent=m.textContent,u.appendChild(w),u.appendChild(h),c.appendChild(u)}),t()},p=f=>{!i||!a||(i.classList.toggle("is-open",f),a.setAttribute("aria-expanded",f?"true":"false"),l&&(l.hidden=!f))};i&&a&&!i.dataset.listenerAttached&&(a.addEventListener("click",f=>{f.preventDefault(),p(!i.classList.contains("is-open"))}),document.addEventListener("click",f=>{i.classList.contains("is-open")&&(i.contains(f.target)||p(!1))}),a.addEventListener("keydown",f=>{f.key==="Escape"&&p(!1)}),i.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",d),c.dataset.listenerAttached="true"),_()}window.aipkit_populateQdrantCollectionsMultiSelect=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector('select[name="pinecone_index_name"]');if(!r)return;let i=o.querySelector("[data-aipkit-pinecone-index-dropdown]"),a=i?i.querySelector(".aipkit_popover_multiselect_btn"):null,s=i?i.querySelector(".aipkit_popover_multiselect_label"):null,l=i?i.querySelector(".aipkit_popover_multiselect_panel"):null,c=i?i.querySelector(".aipkit_popover_multiselect_options"):null,n=window.aipkit_escapeHtml||function(x){return x},e=window.aipkit_chat_config?.pineconeIndexes||[],t=String(r.value||"").trim(),d=i&&i.dataset&&i.dataset.placeholder||"Select index",_=[],p=new Set;Array.isArray(e)&&e.forEach(x=>{let v=String(x?.name||x?.id||"").trim();if(!v||p.has(v))return;p.add(v);let L=String(x?.name||v),P=x?.total_vector_count,y=P!=null&&P!=="Error"&&P!=="No Host"?` (Vectors: ${Number(P).toLocaleString()})`:P==="Error"||P==="No Host"?" (Stats Err)":" (Vectors: ?)";_.push({value:v,label:n(`${L}${y}`),disabled:!1})}),t&&!p.has(t)&&(_.push({value:t,label:n(`${t}`),disabled:!1}),p.add(t)),_.length||_.push({value:"",label:"-- No Indexes Found (Sync in AI Settings) --",disabled:!0}),r.innerHTML="";let f=new Option(d,"");f.selected=!t,r.appendChild(f);let g=!1;_.forEach(x=>{let v=new Option(x.label,x.value);x.disabled&&(v.disabled=!0),!x.disabled&&x.value&&x.value===t&&(v.selected=!0,g=!0),r.appendChild(v)}),t&&!g&&(r.value="");let m=()=>{if(!s)return;let x=r.selectedOptions&&r.selectedOptions.length?r.selectedOptions[0]:null,v=x&&x.textContent?x.textContent.trim():"";s.textContent=v||d},u=()=>{if(!c)return;c.innerHTML="";let x=Array.from(r.options).filter(L=>!L.disabled&&L.value);if(!x.length){let L=document.createElement("div");L.className="aipkit_popover_multiselect_empty",L.textContent=r.options[0]?.textContent||"-- No Indexes Found (Sync in AI Settings) --",c.appendChild(L),m();return}let v=i.dataset.pineconeRadioName||`aipkit_pinecone_index_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;i.dataset.pineconeRadioName=v,x.forEach(L=>{let P=document.createElement("label");P.className="aipkit_popover_multiselect_item aipkit_vector_store_pinecone_item";let b=document.createElement("span");b.className="aipkit_vector_store_pinecone_item_label";let y=document.createElement("input");y.type="radio",y.name=v,y.className="aipkit_vector_store_pinecone_radio",y.value=L.value,y.checked=L.selected;let S=document.createElement("span");S.className="aipkit_popover_multiselect_text",S.textContent=L.textContent,b.appendChild(y),b.appendChild(S),P.appendChild(b),c.appendChild(P)}),m()},w=()=>{if(!c)return;let x=c.querySelector(".aipkit_vector_store_pinecone_radio:checked");if(!x)return;let v=x.value||"";(r.value||"")!==v?(r.value=v,r.dispatchEvent(new Event("change",{bubbles:!0}))):m()},h=()=>{if(!c){m();return}let x=r.value||"";c.querySelectorAll(".aipkit_vector_store_pinecone_radio").forEach(v=>{v.checked=v.value===x}),m()},C=x=>{!i||!a||(i.classList.toggle("is-open",x),a.setAttribute("aria-expanded",x?"true":"false"),l&&(l.hidden=!x))};i&&a&&!i.dataset.listenerAttached&&(a.addEventListener("click",x=>{x.preventDefault(),C(!i.classList.contains("is-open"))}),document.addEventListener("click",x=>{i.classList.contains("is-open")&&(i.contains(x.target)||C(!1))}),document.addEventListener("keydown",x=>{x.key==="Escape"&&C(!1)}),i.dataset.listenerAttached="true"),c&&!c.dataset.listenerAttached&&(c.addEventListener("change",x=>{x.target&&x.target.matches(".aipkit_vector_store_pinecone_radio")&&(w(),C(!1))}),c.dataset.listenerAttached="true"),r.dataset.pineconeDropdownBound!=="1"&&(r.addEventListener("change",h),r.dataset.pineconeDropdownBound="1"),u(),h()}window.aipkit_populatePineconeIndexSelect=k})();(function(){"use strict";function k(o){let r=o.querySelector('select[name="vector_embedding_provider"]');r&&(r.value===""&&(r.value="openai"),r.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=k})();(function(){"use strict";function k(o){let r=o.querySelector('select[name="vector_embedding_provider"]'),i=o.querySelector('select[name="vector_embedding_model"]'),a=window.aipkit_escapeHtml||function(n){return n};if(!r||!i)return;let s=r.value,l=i.value;i.innerHTML="",i.appendChild(new Option(a("-- Select Model --"),""));let c=[];if(s==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?c=window.aipkit_chat_config.openaiEmbeddingModels:s==="google"&&window.aipkit_chat_config?.googleEmbeddingModels?c=window.aipkit_chat_config.googleEmbeddingModels:s==="openrouter"&&window.aipkit_chat_config?.openrouterEmbeddingModels?c=window.aipkit_chat_config.openrouterEmbeddingModels:s==="azure"&&window.aipkit_chat_config?.azureEmbeddingModels&&(c=window.aipkit_chat_config.azureEmbeddingModels),c.length>0&&c.forEach(n=>{if(n&&n.id){let e=new Option(a(n.name||n.id),n.id);n.id===l&&(e.selected=!0),i.appendChild(e)}}),l&&!i.querySelector(`option[value="${CSS.escape(l)}"]`)){let n=new Option(a(l)+"",l,!1,!0);i.appendChild(n),i.value=l}i.options.length<=1&&(i.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_toggle_switch");r||(r=o.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let i=o.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),a=o.querySelector(".aipkit_vector_store_provider_select"),s=o.querySelector(".aipkit_chatbot_provider_select"),l=o.querySelector(".aipkit_file_upload_field_group");if(!r||!i||!l)return;let c=r.tagName==="SELECT"?r.value==="1":r.checked,n=i.dataset.isProPlan==="true",e=a?a.value:"",t=s?s.value:"",d=e==="claude_files",_=t==="Claude";if(a){let m=Array.from(a.options||[]).find(u=>u&&u.value==="claude_files");m&&(m.disabled=!_)}if(d&&!_&&a){let m=Array.from(a.options||[]).find(w=>w&&w.value&&w.value!=="claude_files"),u=m?m.value:"openai";if(a.value!==u){a.value=u,a.dispatchEvent(new Event("change",{bubbles:!0}));return}}let f=n&&c&&(!d||_),g="";n?d&&!_?g='Claude Files requires the chatbot "Provider" to be set to Claude.':c||(g='File upload requires "Enable Vector Store" to be active for this bot.'):g="File upload is a paid feature. Please upgrade.",f?(i.disabled=!1,l.classList.remove("aipkit_dimmed_row"),l.style&&(l.style.opacity=""),l.removeAttribute("title")):(i.checked&&(i.checked=!1,i.dispatchEvent(new Event("change",{bubbles:!0}))),i.disabled=!0,l.classList.add("aipkit_dimmed_row"),l.style&&l.style.opacity&&(l.style.opacity=""),l.setAttribute("title",g))}window.aipkit_toggleFileUploadAvailability=k})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelector('select[name="theme"]'),a=r.querySelector('input[name="theme"]:checked'),s=()=>i?i.value:a?a.value:"",l=r.querySelector(".aipkit_custom_theme_config_btn, .aipkit_open_custom_theme_modal_btn"),c=s()==="custom";l&&(l.style.display=c?"inline-flex":"none")}function o(){let r=document.querySelector(".aipkit_chatbot_module_container")||document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Theme Toggle: Module container not found.");return}r.dataset.themeSettingsListenerAttached||(r.addEventListener("click",function(i){i.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(i):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),r.addEventListener("change",function(i){let a=i.target;if(a.matches&&a.matches('select[name="theme"]')||a.matches&&a.matches('input[name="theme"]')){let s=a.closest('.aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]')||a.closest(".aipkit_chatbot-settings-area")||r;if(s){k(s);let l=s.querySelector(".aipkit_open_custom_theme_modal_btn");if(l&&a.value==="custom"&&typeof window.aipkit_openChatbotSettingsModalById=="function"){let c=l.getAttribute("data-modal-target");c&&window.aipkit_openChatbotSettingsModalById(c)}}}}),r.dataset.themeSettingsListenerAttached="true"),document.documentElement.dataset.aipkitResetListenerAttached||(document.addEventListener("click",function(i){i.target.closest(".aipkit_chatbot_settings_modal .aipkit_reset_custom_theme_btn")&&typeof window.aipkit_handleResetCustomTheme=="function"&&window.aipkit_handleResetCustomTheme(i)}),document.documentElement.dataset.aipkitResetListenerAttached="true"),r.querySelectorAll('.aipkit_chatbot-settings-area, .aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]').forEach(i=>{k(i)})}window.aipkit_initChatThemeSettingsToggle=o})();(function(){"use strict";function k(o){let r=o.target.closest(".aipkit_reset_custom_theme_btn");if(!r)return;let i=r.dataset.botId,a=document.getElementById("aipkit_chatbot_main_tab_content_container"),s=document.getElementById(`aipkit_bot_${i}_custom_theme_settings_container`)||(a?a.querySelector(`#aipkit_bot_${i}_custom_theme_settings_container`):null),l=document.getElementById(`aipkit_reset_theme_status_${i}`)||(a?a.querySelector(`#aipkit_reset_theme_status_${i}`):null);if(!s||!l){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",i);return}let c=s.dataset.defaults;if(!c){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"error","Error: Defaults not found.",2e3);return}try{let n=JSON.parse(c);s.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(t=>{let _=t.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(_&&_[1]){let p=_[1];if(Object.prototype.hasOwnProperty.call(n,p)){t.type==="checkbox"?t.checked=String(n[p])==="1":t.value=n[p]!==null?String(n[p]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});t.dispatchEvent(f)}else if(Object.prototype.hasOwnProperty.call(n,p+"_placeholder")){t.type==="checkbox"?t.checked=String(n[p+"_placeholder"])==="1":t.value=n[p+"_placeholder"]!==null?String(n[p+"_placeholder"]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});t.dispatchEvent(f)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"success","\u2714 Reverted.",2e3)}catch(n){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",n),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(l,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=k})();(function(){"use strict";function k(f){let g=new Event("input",{bubbles:!0,cancelable:!0}),m=new Event("change",{bubbles:!0,cancelable:!0});f.dispatchEvent(g),f.dispatchEvent(m)}function o(){document.documentElement.dataset.aipkitApplyingThemePreset="1"}function r(){window.setTimeout(()=>{delete document.documentElement.dataset.aipkitApplyingThemePreset},0)}function i(f,g,m){let u=f.querySelector(`input[name="custom_theme_settings[${g}]"], select[name="custom_theme_settings[${g}]"]`);if(u){if(u.type==="checkbox"){let w=m==="1";u.checked!==w&&(u.checked=w,k(u));return}u.value!==m&&(u.value=m,k(u))}}function a(f){let g=f.closest(".aipkit_chatbot_settings_form");if(!g)return;let m=f.dataset.presetKey||"",u=g.querySelector('select[name="theme"]');if(u&&!u.disabled){let h=-1,C=Array.from(u.options||[]);m&&(h=C.findIndex(x=>(x.value||"")==="custom"&&x.dataset&&x.dataset.presetKey===m)),h<0&&(h=C.findIndex(x=>(x.value||"")==="custom"&&!(x.dataset&&x.dataset.presetKey))),h>=0&&u.selectedIndex!==h&&(u.selectedIndex=h,k(u));return}let w=g.querySelector('input[name="theme"][value="custom"]');w&&!w.checked&&(w.checked=!0,k(w))}function s(f,g){if(!f)return;let m=f.querySelector('input[name="theme_preset_key"]');m&&!m.disabled&&(m.value=g||"")}function l(f){return f?document.getElementById(`aipkit_bot_${f}_custom_theme_settings_container`):null}function c(f){let g=f.closest(".aipkit_custom_theme_settings_container");if(g)return g;let m=f.dataset.botId||f.closest("[data-bot-id]")?.dataset.botId;return l(m)}function n(f){let g=f.closest(".aipkit_chatbot_settings_form");if(!g)return null;let m=g.querySelector(".aipkit_custom_theme_settings_container");if(m)return m;let u=g.dataset.botId||g.closest("[data-bot-id]")?.dataset.botId;return l(u)}function e(f){let g=f.closest(".aipkit_custom_theme_presets");g&&g.querySelectorAll(".aipkit_custom_theme_preset").forEach(m=>{let u=m===f;m.classList.toggle("is-selected",u),m.setAttribute("aria-pressed",u?"true":"false")})}function t(f){let g=f.dataset.primary,m=f.dataset.secondary,u=f.dataset.presetKey||"";if(!g||!m)return;let w=c(f);if(!w)return;let h=f.closest(".aipkit_chatbot_settings_form");o(),a(f),s(h,u),i(w,"primary_color",g),i(w,"secondary_color",m),i(w,"auto_text_contrast","1"),r(),e(f)}function d(f){if(!f||f.disabled)return;let g=f.selectedOptions&&f.selectedOptions.length?f.selectedOptions[0]:null;if(!g||!g.dataset)return;let m=g.dataset.presetKey||"",u=g.dataset.primary||"",w=g.dataset.secondary||"";if(!m||!u||!w){let x=f.closest(".aipkit_chatbot_settings_form");s(x,"");return}let h=n(f);if(!h)return;let C=f.closest(".aipkit_chatbot_settings_form");o(),s(C,m),i(h,"primary_color",u),i(h,"secondary_color",w),i(h,"auto_text_contrast","1"),r()}function _(f){if(!f||!f.closest||document.documentElement.dataset.aipkitApplyingThemePreset==="1")return;let g=f.closest(".aipkit_chatbot_settings_form");g&&s(g,"")}function p(){document.documentElement.dataset.aipkitCustomThemePresetsBound||(document.addEventListener("click",f=>{let g=f.target.closest(".aipkit_custom_theme_preset");g&&(f.preventDefault(),t(g))}),document.addEventListener("change",f=>{let g=f.target;!g||!g.matches||!g.matches('select[name="theme"]')||d(g)}),document.addEventListener("change",f=>{let g=f.target;!g||!g.matches||!g.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')||_(g)}),document.documentElement.dataset.aipkitCustomThemePresetsBound="1")}window.aipkit_initCustomThemePresets=p})();(function(){"use strict";let k=".aipkit_builder_theme_row_content",o=".aipkit_builder_theme_row",r=".aipkit_theme_scroll_btn",i=".aipkit_theme_scroll_btn--prev",a=".aipkit_theme_scroll_btn--next";function s(_){let p=_.closest(o);return p?{row:p,prev:p.querySelector(i),next:p.querySelector(a)}:null}function l(_){return Math.max(180,Math.round(_.clientWidth*.75))}function c(_){let p=s(_);if(!p||!p.prev||!p.next)return;let f=Math.max(0,_.scrollWidth-_.clientWidth),g=_.scrollLeft<=1,m=_.scrollLeft>=f-1;p.prev.disabled=f===0||g,p.next.disabled=f===0||m}function n(_){let p=_.target.closest(r);if(!p||p.disabled)return;let f=p.closest(o),g=f?f.querySelector(k):null;if(!g)return;let m=p.classList.contains("aipkit_theme_scroll_btn--next")?1:-1;g.scrollBy({left:m*l(g),behavior:"smooth"})}function e(_){let p=_.target;!(p instanceof HTMLElement)||!p.matches(k)||c(p)}function t(){document.querySelectorAll(k).forEach(_=>{c(_)})}function d(_){let p=document.documentElement;p.dataset.aipkitThemeRowScrollBound||(document.addEventListener("click",n),document.addEventListener("scroll",e,!0),window.addEventListener("resize",t),p.dataset.aipkitThemeRowScrollBound="1"),_&&t()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>d(!0)):d(!0),window.aipkit_initThemeRowScroll=function(){d(!0)}})();(function(){"use strict";function k(c){if(!c)return;let n=c.querySelector(".aipkit_chatbot_provider_select");n||(n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let e=c.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');e||(e=document.querySelector('#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_model_field[data-provider="OpenAI"] select'));let t=c.querySelector(".aipkit_reasoning_effort_field"),d=t?t.querySelector(".aipkit_reasoning_effort_slider"):null,_=t?t.querySelector('input[name="reasoning_effort"]'):null,p=t?t.querySelector(".aipkit_reasoning_effort_label"):null,f=null;if(t?f=t.closest('section[data-section="reasoning"], .aipkit_reasoning_section'):f=c.querySelector(".aipkit_reasoning_section"),!t)return;let g=t.querySelector('select[name="reasoning_effort"]'),m=()=>{t.classList.add("aipkit_hidden"),f&&f.classList.add("aipkit_hidden"),g&&(g.disabled=!0),t.style.opacity="",t.removeAttribute("title")},u=()=>{t.classList.remove("aipkit_hidden"),f&&f.classList.remove("aipkit_hidden"),g&&(g.disabled=!1),t.style.opacity="",t.removeAttribute("title")};if(!n||!e){m();return}let w=(n.value||"").toLowerCase(),C=(e.value||"").toLowerCase();w==="openai"&&r(C)?(u(),o(d,_,p,C)):m()}function o(c,n,e,t){if(!c||!n)return;let d=a(t),_=d.allowed,p=_.map(m=>m==="medium"?"med":m);c.dataset.reasoningValues=JSON.stringify(_),c.dataset.reasoningLabels=JSON.stringify(p),c.max=String(Math.max(0,_.length-1));let f=n.value||"";f==="minimal"&&(f="low"),_.includes(f)||(f=d.defaultValue),_.includes(f)||(f=_[0]||""),f&&(n.value=f);let g=Math.max(0,_.indexOf(f));c.value=String(g),e&&(e.textContent=p[g]||p[0]||""),c.dispatchEvent(new Event("input",{bubbles:!0}))}function r(c){if(i(c))return!1;let n=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),e=c.includes("gpt-5");return n||e}function i(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let n=c.match(/gpt-5\.(\d+)/);if(n)return Number.parseInt(n[1],10)>=2;let e=c.match(/gpt-(\d+)/);return e?Number.parseInt(e[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_toggleReasoningEffort=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(L){return L},o="#aipkit_chatbot_builder_bot_select, #aipkit_sources_provider_filter, #aipkit_sources_index_filter, .aipkit_vector_store_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_model_field select",r=null,i=null,a=!1,s=L=>!!(L&&(L.classList.contains("aipkit_chatbot_provider_select")||L.classList.contains("aipkit_vector_store_provider_select")||L.id==="aipkit_sources_provider_filter")),l=L=>!!(L&&L.id==="aipkit_chatbot_builder_bot_select"),c=L=>{let P=String(L||"").trim().toLowerCase();return P==="claude_files"?"claude":P},n=(L,P)=>{if(!L)return;let b="aipkit_settings_select_picker_icon--";L.classList.forEach(S=>{S.startsWith(b)&&L.classList.remove(S)}),L.classList.remove("is-hidden");let y=c(P);if(!y){L.classList.add("is-hidden");return}L.classList.add(`${b}${y}`)},e=L=>{if(!L)return"";let P=L.getAttribute("data-aipkit-picker-title");if(P)return P;let b=L.id&&document.querySelector(`label[for="${L.id}"]`)||L.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return b?b.textContent.trim():""},t=L=>{if(!L)return"";let P=L.selectedOptions&&L.selectedOptions.length?L.selectedOptions[0]:L.querySelector("option[selected]");if(P)return P.textContent.trim();let b=L.querySelector("option");return b?b.textContent.trim():""},d=L=>({buttonId:`${L}_picker_btn`,labelId:`${L}_picker_label`,popoverId:`${L}_picker_popover`,titleId:`${L}_picker_title`,searchId:`${L}_picker_search`,listId:`${L}_picker_list`}),_=L=>{if(!L||!L.id)return null;let P=d(L.id),b=L.closest(".aipkit_chatbot_builder");if(!b)return null;let y=document.getElementById(P.buttonId);if(!y){if(y=document.createElement("button"),y.type="button",y.id=P.buttonId,y.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",y.setAttribute("data-aipkit-popover-target",P.popoverId),y.setAttribute("aria-controls",P.popoverId),y.setAttribute("aria-expanded","false"),y.dataset.aipkitPopoverPlacement="bottom",s(L)){y.classList.add("aipkit_settings_select_picker_btn--provider");let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),n(M,L.value),y.appendChild(M)}let E=document.createElement("span");E.className="aipkit_settings_select_picker_label",E.id=P.labelId,E.textContent=t(L)||k("Select","gpt3-ai-content-generator");let A=document.createElement("span");A.className="dashicons dashicons-arrow-down-alt2",A.setAttribute("aria-hidden","true"),y.appendChild(E),y.appendChild(A),L.insertAdjacentElement("beforebegin",y)}L.classList.contains("screen-reader-text")||L.classList.add("screen-reader-text");let S=document.getElementById(P.popoverId);if(!S){S=document.createElement("div"),S.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",s(L)&&S.classList.add("aipkit_settings_select_picker_popover--provider"),S.id=P.popoverId,S.setAttribute("aria-hidden","true");let E=document.createElement("div");E.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",E.setAttribute("role","dialog"),E.setAttribute("aria-labelledby",P.titleId);let A=document.createElement("div");A.className="aipkit_model_settings_popover_header";let M=document.createElement("span");M.className="aipkit_model_settings_popover_title",M.id=P.titleId,M.textContent=e(L)||k("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',A.appendChild(M),A.appendChild($);let W=document.createElement("div");W.className="aipkit_model_settings_popover_body";let H=document.createElement("div");H.className="aipkit_settings_select_picker_search";let N=document.createElement("input");N.type="search",N.id=P.searchId,N.className="aipkit_form-input";let G=e(L),J=G?`Search ${G.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");N.setAttribute("placeholder",J),H.appendChild(N);let F=document.createElement("div");F.className="aipkit_settings_select_picker_list",F.id=P.listId,F.setAttribute("role","listbox"),W.appendChild(H),W.appendChild(F),E.appendChild(A),E.appendChild(W),S.appendChild(E),b.appendChild(S),(s(L)||l(L))&&(H.style.display="none")}return{ids:P,button:y,popover:S,label:document.getElementById(P.labelId),search:document.getElementById(P.searchId),list:document.getElementById(P.listId)}},p=L=>{let P=[];return L&&Array.from(L.children).forEach(y=>{if(y.tagName==="OPTGROUP"){let S=Array.from(y.children).filter(E=>E.tagName==="OPTION").map(E=>({value:E.value,label:E.textContent.trim(),disabled:E.disabled,selected:E.selected}));P.push({groupLabel:y.label||"",options:S})}else y.tagName==="OPTION"&&P.push({groupLabel:"",options:[{value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}]})}),P},f=(L,P,b="")=>{if(!L||!P)return;let y=b.trim().toLowerCase();if(P.innerHTML="",l(L)){let A=Array.from(L.options).map(G=>({value:G.value,label:G.textContent.trim(),disabled:G.disabled,selected:G.selected})),M=G=>G.disabled&&G.value===""&&/^-+$/.test(G.label.replace(/\s+/g,"")),$=A.filter(G=>G.value==="__new__"),W=A.filter(G=>G.value!=="__new__"&&!M(G)),H=y?W.filter(G=>G.label.toLowerCase().includes(y)):W,N=G=>{let J=document.createElement("button");J.type="button",J.className="aipkit_settings_select_picker_item",J.setAttribute("role","option"),J.dataset.value=G.value,J.dataset.label=G.label,G.disabled&&(J.classList.add("is-disabled"),J.setAttribute("aria-disabled","true")),L.value===G.value?(J.classList.add("is-active"),J.setAttribute("aria-selected","true")):J.setAttribute("aria-selected","false");let F=document.createElement("span");F.className="aipkit_settings_select_picker_text",F.textContent=G.label;let q=document.createElement("span");q.className="dashicons dashicons-yes aipkit_settings_select_picker_check",J.appendChild(F),J.appendChild(q),P.appendChild(J)};if($.forEach(N),H.forEach(N),!$.length&&!H.length){let G=document.createElement("div");G.className="aipkit_settings_select_picker_empty",G.textContent=k(y?"No matches found.":"No options available.","gpt3-ai-content-generator"),P.appendChild(G)}return}let S=p(L),E=!1;if(S.forEach(A=>{let M=A.options.filter($=>y?$.label.toLowerCase().includes(y):!0);if(M.length){if(A.groupLabel){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=A.groupLabel,P.appendChild($)}M.forEach($=>{let W=document.createElement("button");if(W.type="button",W.className="aipkit_settings_select_picker_item",W.setAttribute("role","option"),W.dataset.value=$.value,W.dataset.label=$.label,$.disabled&&(W.classList.add("is-disabled"),W.setAttribute("aria-disabled","true")),L.value===$.value?(W.classList.add("is-active"),W.setAttribute("aria-selected","true")):W.setAttribute("aria-selected","false"),s(L)){W.classList.add("aipkit_settings_select_picker_item--provider");let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),n(G,$.value),W.appendChild(G)}let H=document.createElement("span");H.className="aipkit_settings_select_picker_text",H.textContent=$.label;let N=document.createElement("span");N.className="dashicons dashicons-yes aipkit_settings_select_picker_check",W.appendChild(H),W.appendChild(N),P.appendChild(W),E=!0})}}),!E){let A=document.createElement("div");A.className="aipkit_settings_select_picker_empty",A.textContent=k(y?"No matches found.":"No options available.","gpt3-ai-content-generator"),P.appendChild(A)}},g=(L,P)=>{if(!L||!P)return;let b=t(L);if(P.textContent=b||k("Select","gpt3-ai-content-generator"),s(L)){let y=P.closest("button"),S=y?y.querySelector(".aipkit_settings_select_picker_icon"):null;n(S,L.value)}},m=(L,P)=>{if(!L||!P)return;let b=L.getBoundingClientRect(),y=P.getBoundingClientRect(),S=y.width||320,E=y.height||0,A=window.innerWidth,M=window.innerHeight,$=12,W=b.left;W+S>A-$&&(W=b.right-S),W=Math.max($,Math.min(W,A-S-$));let H=b.bottom+8;H+E>M-$&&(H=b.top-E-8),H=Math.max($,Math.min(H,M-E-$)),P.style.left=`${Math.round(W)}px`,P.style.top=`${Math.round(H)}px`},u=()=>{!r||!i||a||(a=!0,window.requestAnimationFrame(()=>{let L=r.querySelector(".aipkit_model_settings_popover_panel");m(i,L),a=!1}))},w=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},h=(L,P,b)=>{if(!L||!P)return;r&&r!==P&&w(),r=P,i=L,P.classList.add("aipkit-active"),P.setAttribute("aria-hidden","false"),L.setAttribute("aria-expanded","true");let y=P.querySelector(".aipkit_settings_select_picker_search input"),S=P.querySelector(".aipkit_settings_select_picker_list");S&&f(b,S,y?y.value:""),y&&y.offsetParent!==null&&(y.focus(),y.select());let E=P.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{m(L,E)})},C=(L,P)=>{if(!L||!P)return;let{button:b,popover:y,list:S,search:E}=P;if(b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("click",A=>{if(A.preventDefault(),r===y){w();return}h(b,y,L)}),b.dataset.pickerListenerAttached="true"),y&&y.dataset.overlayListenerAttached!=="true"){y.addEventListener("click",M=>{M.target===y&&w()});let A=y.querySelector(".aipkit_model_settings_popover_close");A&&A.addEventListener("click",M=>{M.preventDefault(),w()}),y.dataset.overlayListenerAttached="true"}if(S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("click",A=>{let M=A.target.closest(".aipkit_settings_select_picker_item");if(!M||M.classList.contains("is-disabled"))return;let $=M.dataset.value??"";L.value=$,L.dispatchEvent(new Event("change",{bubbles:!0})),g(L,P.label),f(L,S,E?E.value:""),w()}),S.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("input",()=>{f(L,S,E.value)}),E.dataset.pickerListenerAttached="true"),L&&L.dataset.pickerListenerAttached!=="true"&&(L.addEventListener("change",()=>{g(L,P.label),f(L,S,E?E.value:""),r===y&&w()}),L.dataset.pickerListenerAttached="true"),L&&L.dataset.pickerObserverAttached!=="true"){let A=!1;new MutationObserver(()=>{A||(A=!0,window.requestAnimationFrame(()=>{g(L,P.label),f(L,S,E?E.value:""),A=!1}))}).observe(L,{childList:!0,subtree:!0}),L.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitChatPickerEscapeBound||(document.addEventListener("keydown",A=>{A.key==="Escape"&&r&&w()}),document.body.dataset.aipkitChatPickerEscapeBound="true"),document.body.dataset.aipkitChatPickerRepositionBound||(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),document.body.dataset.aipkitChatPickerRepositionBound="true")};function x(){let L=document.querySelector(".aipkit_chatbot_builder");if(!L)return;let P=L.querySelectorAll(o);P.length&&P.forEach(b=>{if(!b.id||b.dataset.aipkitPickerInit==="true")return;let y=_(b);y&&(g(b,y.label),f(b,y.list,y.search?y.search.value:""),C(b,y),b.dataset.aipkitPickerInit="true")})}function v(){let L=document.querySelector(".aipkit_chatbot_builder");if(!L)return;L.querySelectorAll(o).forEach(b=>{if(!b.id)return;let y=_(b);y&&(g(b,y.label),f(b,y.list,y.search?y.search.value:""),C(b,y),b.dataset.aipkitPickerInit="true")})}window.aipkit_initChatSelectPickers=x,window.aipkit_refreshChatSelectPickers=v})();(function(){"use strict";let k={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"};function o(i){let a=k[i];if(!a)return!0;let s=window.aipkit_dashboard?.providerStatus?.[a];return typeof s>"u"?!0:!!s}function r(i,a={}){return i?typeof window.aipkit_queueProviderSync!="function"?(console.warn("AIPKit Chatbot Sync: aipkit_queueProviderSync is not available."),!1):o(i)?(window.aipkit_queueProviderSync(i,a),!0):!1:!1}window.aipkit_requestChatbotModelSync=r})();(function(){"use strict";function k(r,i,a){let s=document.getElementById(r);if(!s)return;if(s.innerHTML="",!i||i.length===0){s.appendChild(new Option("(No voices found - Sync again)",""));return}s.appendChild(new Option("-- Select Voice --",""));let l={};i.forEach(n=>{let e=n.languageCodes[0]||"und";l[e]||(l[e]=[]),l[e].push(n)}),Object.keys(l).sort().forEach(n=>{let e=document.createElement("optgroup");try{let t=new Intl.DisplayNames(["en"],{type:"language"}).of(n.split("-")[0]);e.label=`${t} (${n})`}catch{e.label=n}l[n].sort((t,d)=>t.name.localeCompare(d.name)),l[n].forEach(t=>{let d=new Option(t.name,t.id);t.id===a&&(d.selected=!0),e.appendChild(d)}),s.appendChild(e)}),a&&!s.value&&(Array.from(s.options).some(e=>e.value===a)?s.value=a:console.warn(`AIPKit TTS: Saved Google voice ID "${a}" not found in synced list for ${r}.`))}function o(r){let i=r.getAttribute("data-target-select"),a=r.querySelector(".aipkit_spinner"),s=r.closest(".aipkit_popover_audio_flyout"),l=s?s.querySelector(".aipkit_tts_sync_status"):null;if(!l){let t=r.closest(".aipkit_popover_option_row");l=t?t.querySelector(".aipkit_tts_sync_status"):null}if(!l){let t=r.closest(".aipkit_form-group");l=t?t.querySelector(".aipkit_form-help"):null}if(!i){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(l||console.error("AIPKit TTS Sync (Google): Could not find message container for button:",r),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}let c=l&&l.classList.contains("aipkit_popover_status_inline"),n=(t,d)=>{!l||!c||(l.textContent=t||"",l.classList.remove("success","error","loading"),d&&l.classList.add(d),l.style.display=t?"inline-block":"none")};if(r.disabled=!0,r.classList.add("aipkit_loading"),a&&(a.style.display="inline-block"),l){let t=l.dataset.baseClass||l.className||"aipkit_form-help";l.dataset.baseClass||(l.dataset.baseClass=t),l.textContent="",l.className=t,l.style.display=t.includes("aipkit_popover_status_inline")?"none":""}c&&n("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(t=>{if(t&&t.voices){let d=document.getElementById(i),_=d?d.value:"";k(i,t.voices,_);let p=document.getElementById("aipkit_google_tts_voices_json_main");p&&(p.dataset.voices=JSON.stringify(t.voices)),l&&(c?n(t.message||"Sync successful!","success"):window.aipkit_showTemporaryMessage(l,"success",t.message||"Sync successful!"))}else throw new Error("Invalid response received from voice sync.")}).catch(t=>{console.error("AIPKit TTS Sync Error (Google):",t),l&&(c?n(`Sync failed: ${t.message||"Unknown error"}`,"error"):window.aipkit_showTemporaryMessage(l,"error",`Sync failed: ${t.message||"Unknown error"}`))}).finally(()=>{r.disabled=!1,r.classList.remove("aipkit_loading"),a&&(a.style.display="none")})}window.aipkit_updateGoogleVoiceSelect=k,window.aipkit_handleSyncGoogleVoices=o})();(function(){"use strict";function k(r,i,a){let s=document.getElementById(r);if(!s){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${r} not found.`);return}if(s.innerHTML="",!i||i.length===0){if(s.appendChild(new Option("(No voices found - Sync voices to load)","")),a){let c=new Option(a+"",a,!1,!0);s.appendChild(c),s.value=a}return}s.appendChild(new Option("-- Select Voice --","")),i.sort((c,n)=>(c.name||c.id||"").localeCompare(n.name||n.id||""));let l=!1;if(i.forEach(c=>{let n=new Option(c.name,c.id);c.id===a&&(n.selected=!0,l=!0),s.appendChild(n)}),a&&!l){let c=!1;for(let n=0;n<s.options.length;n++)if(s.options[n].value===a){c=!0,s.value=a;break}if(!c){let n=new Option(a+"",a,!1,!0);s.appendChild(n),s.value=a,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${a}" not found in synced list for #${r}, added as manual.`)}}else!a&&s.options.length>0&&(s.value="")}function o(r,i,a){let s=document.getElementById(r);if(!s){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${r} not found.`);return}if(s.innerHTML="",!i||i.length===0){if(s.appendChild(new Option("(No models found - Sync models to load)","")),a){let c=new Option(a+"",a,!1,!0);s.appendChild(c),s.value=a}return}s.appendChild(new Option("-- Select Model --","")),i.sort((c,n)=>(c.name||c.id||"").localeCompare(n.name||n.id||""));let l=!1;if(i.forEach(c=>{let n=c.id||"",e=c.name||n;if(!n)return;let t=new Option(e,n);n===a&&(t.selected=!0,l=!0),s.appendChild(t)}),a&&!l){let c=!1;for(let n=0;n<s.options.length;n++)if(s.options[n].value===a){c=!0,s.value=a;break}if(!c){let n=new Option(a+"",a,!1,!0);s.appendChild(n),s.value=a,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${a}" not found in synced list for #${r}, added as manual.`)}}else!a&&s.options.length>0&&(s.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=k,window.aipkit_chatTts_updateElevenLabsModelsSelect=o})();(function(){"use strict";function k(i,a){let s=i.querySelector(".aipkit_tts_conditional_settings"),l=i.querySelector(".aipkit_tts_auto_play_container");s&&(s.style.display=a?"block":"none"),l&&(l.style.display=a?"block":"none")}function o(i){let a=i.querySelector(".aipkit_tts_provider_select");if(!a)return;let s=a.value;i.querySelectorAll(".aipkit_tts_provider_settings").forEach(c=>{if(c.getAttribute("data-provider")===s){if(c.style.display="block",s==="OpenAI"){let n=c.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');n&&(n.style.display="block")}}else c.style.display="none"})}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit TTS Settings: Main content container not found.");return}let a=typeof window.aipkit_updateGoogleVoiceSelect=="function",s=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",l=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",c=typeof window.aipkit_handleSyncGoogleVoices=="function";a||console.error("AIPKit TTS Settings: Google voice update function missing."),s||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),l||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),c||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),i.addEventListener("change",function(e){let t=e.target.closest(".aipkit_tts_toggle_switch"),d=e.target.closest(".aipkit_tts_provider_select");if(t){let _=t.closest(".aipkit_accordion-content");_&&(k(_,t.checked),t.checked&&o(_))}else if(d){let _=d.closest(".aipkit_accordion-content");_&&o(_)}}),i.addEventListener("click",function(e){let t=e.target.closest(".aipkit_sync_tts_voices_btn");t&&t.getAttribute("data-provider")==="Google"&&c&&window.aipkit_handleSyncGoogleVoices(t)}),i.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(e=>{let t=e.querySelector(".aipkit_tts_toggle_switch");t&&(k(e,t.checked),t.checked&&o(e));let d=e.querySelector('select[name="tts_google_voice_id"]');d&&!a&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),d&&d.options.length<=1&&(d.innerHTML='<option value="">(Sync voices to load)</option>');let _=e.querySelector('select[name="tts_elevenlabs_voice_id"]');if(_&&s){let g="";if(_&&_.id){let w=_.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);w&&w[1]&&(g=w[1])}let m=g?document.getElementById(`aipkit_elevenlabs_voices_json_${g}`):null,u=m?m.dataset.voices:null;try{let w=u?JSON.parse(u):[],h=_.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(_.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",w),_.options.length<=1&&(_.innerHTML='<option value="">(Sync voices to load)</option>')}}else _&&_.options.length<=1&&(_.innerHTML='<option value="">(Sync voices to load)</option>');let p=e.querySelector('select[name="tts_elevenlabs_model_id"]');if(p&&l){let g="";if(p&&p.id){let w=p.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);w&&w[1]&&(g=w[1])}let m=g?document.getElementById(`aipkit_elevenlabs_models_json_${g}`):null,u=m?m.dataset.models:null;try{let w=u?JSON.parse(u):[],h=p.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(p.id,w,h)}catch(w){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",w),p.options.length<=1&&(p.innerHTML='<option value="">(Sync models to load)</option>')}}else p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync models to load)</option>');let f=e.querySelector('select[name="tts_openai_model_id"]');f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync models to load)</option>')})}window.aipkit_initTtsSettingsUI=r})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}o.addEventListener("submit",function(r){let i=r.target.closest(".aipkit_chatbot_settings_form");if(!i)return;r.preventDefault();let a=i.getAttribute("data-bot-id"),s=i.querySelector(".aipkit_save_bot_settings_btn");s||(s=document.getElementById("aipkit_chatbot_header_save_btn"));let l=document.getElementById("aipkit_chatbot_global_save_status_container"),c=i.querySelector(`#aipkit_action_feedback_${a}`);if(!a||!s||!l){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",i),l||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}c&&(c.innerHTML=""),l.textContent="",l.className="aipkit_save_status_container",s.disabled=!0,s.classList.add("aipkit_loading");let n=s.querySelector(".aipkit_spinner");n||(n=document.createElement("span"),n.className="aipkit_spinner",s.appendChild(n)),n.style.display="inline-block";let e=new FormData(i),t={};for(let[_,p]of e.entries())if(_.endsWith("[]")){let f=_.slice(0,-2);t[f]=e.getAll(_)}else t.hasOwnProperty(_)||(t[_]=p);t.bot_id=a,function(){let p=document.getElementById(`aipkit_bot_${a}_custom_theme_settings_container`);if(!p)return;p.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["], textarea[name^="custom_theme_settings["]').forEach(g=>{let m=g.getAttribute("name");if(!m)return;let u=!0;(g.type==="checkbox"||g.type==="radio")&&(u=g.checked),u?t[m]=g.value:g.type==="checkbox"&&(t[m]="0")})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_ai_params_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p;["temperature","max_completion_tokens","reasoning_effort"].forEach(m=>{let u=f.querySelector(`[name="${m}"]`);u&&(t[m]=u.value)})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_web_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,g=m=>f.querySelector(`[name="${m}"]`);["openai_web_search_context_size","openai_web_search_loc_type","openai_web_search_loc_country","openai_web_search_loc_city","openai_web_search_loc_region","openai_web_search_loc_timezone"].forEach(m=>{let u=g(m);u&&(t[m]=u.value)}),["google_grounding_mode","google_grounding_dynamic_threshold"].forEach(m=>{let u=g(m);u&&(t[m]=u.value)}),["claude_web_search_max_uses","claude_web_search_loc_type","claude_web_search_loc_country","claude_web_search_loc_city","claude_web_search_loc_region","claude_web_search_loc_timezone","claude_web_search_allowed_domains","claude_web_search_blocked_domains","claude_web_search_cache_ttl"].forEach(m=>{let u=g(m);u&&(t[m]=u.value)})}(),function(){let p=document.getElementById(`aipkit_bot_${a}_vector_store_modal`);if(!p)return;let f=x=>p.querySelector(x),g=p.querySelector(".aipkit_modal_body")||p,m=g.querySelector('input[name="enable_vector_store"]');m&&(t.enable_vector_store=m.checked?"1":"0");let u=f('select[name="vector_store_provider"]');if(u&&(t.vector_store_provider=u.value),t.vector_store_provider==="openai"){let x=f('select[name="openai_vector_store_ids[]"]');x?t.openai_vector_store_ids=Array.from(x.selectedOptions).map(v=>v.value):t.openai_vector_store_ids=[]}else delete t.openai_vector_store_ids;if(t.vector_store_provider==="pinecone"){let x=f('select[name="pinecone_index_name"]');x&&(t.pinecone_index_name=x.value)}else delete t.pinecone_index_name;if(t.vector_store_provider==="qdrant"){let x=f('select[name="qdrant_collection_names[]"]');if(x){let v=Array.from(x.selectedOptions).map(L=>L.value);t.qdrant_collection_names=v,t.qdrant_collection_name=v[0]||""}else t.qdrant_collection_names=[],t.qdrant_collection_name=""}else delete t.qdrant_collection_names,delete t.qdrant_collection_name;if(t.vector_store_provider==="pinecone"||t.vector_store_provider==="qdrant"){let x=f('select[name="vector_embedding_provider"]'),v=f('select[name="vector_embedding_model"]');x&&(t.vector_embedding_provider=x.value),v&&(t.vector_embedding_model=v.value)}else delete t.vector_embedding_provider,delete t.vector_embedding_model;let w=f('input[name="vector_store_top_k"]');w&&(t.vector_store_top_k=w.value);let h=f('input[name="vector_store_confidence_threshold"]');h&&(t.vector_store_confidence_threshold=h.value);let C=g.querySelector('input[name="content_aware_enabled"]');C&&(t.content_aware_enabled=C.checked?"1":"0")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_conversations_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,g=f.querySelector('input[name="stream_enabled"]');g&&(t.stream_enabled=g.checked?"1":"0");let m=f.querySelector('input[name="openai_conversation_state_enabled"]');m&&(t.openai_conversation_state_enabled=m.checked?"1":"0");let u=f.querySelector('input[name="max_messages"]');u&&(t.max_messages=u.value);let w=f.querySelector('select[name="reasoning_effort"]');w&&(t.reasoning_effort=w.value)}(),function(){let p=document.getElementById(`aipkit_bot_${a}_images_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,g=f.querySelector('select[name="chat_image_model_id"]'),m=f.querySelector('input[name="image_triggers"]');g&&(t.chat_image_model_id=g.value),m&&(t.image_triggers=m.value);let u=f.querySelector('input[name="enable_image_upload"]');u&&(t.enable_image_upload=u.checked?"1":"0")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_audio_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,g=w=>f.querySelector(`[name="${w}"]`);function m(w){let h=g(w);h&&(t[w]=h.checked?"1":"0")}function u(w){let h=g(w);h&&(t[w]=h.value)}m("enable_voice_input"),u("stt_provider"),u("stt_openai_model_id"),m("tts_enabled"),u("tts_provider"),u("tts_google_voice_id"),u("tts_openai_voice_id"),u("tts_openai_model_id"),u("tts_elevenlabs_voice_id"),u("tts_elevenlabs_model_id"),m("tts_auto_play"),m("enable_realtime_voice"),m("direct_voice_mode"),m("input_audio_noise_reduction"),u("realtime_model"),u("realtime_voice"),u("turn_detection"),u("input_audio_format"),u("output_audio_format"),u("speed")}(),function(){let p=document.getElementById(`aipkit_bot_${a}_token_mgmt_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p,g=f.querySelector('input[name="token_guest_limit"]'),m=f.querySelector('input[name="token_user_limit"]'),u=f.querySelector('select[name="token_limit_mode"]'),w=f.querySelector('select[name="token_reset_period"]'),h=f.querySelector('input[name="token_limit_message"]');g&&(t.token_guest_limit=g.value),m&&(t.token_user_limit=m.value),u&&(t.token_limit_mode=u.value),w&&(t.token_reset_period=w.value),h&&(t.token_limit_message=h.value),f.querySelectorAll('input[name^="token_role_limits["]').forEach(x=>{let v=x.getAttribute("name");v&&(t[v]=x.value)})}(),function(){let p=document.getElementById("aipkit_starters_flyout");if(!p)return;let f=p.querySelector('textarea[name="conversation_starters"]');f&&(t.conversation_starters=f.value)}(),function(){let p=document.getElementById(`aipkit_bot_${a}_popup_settings_modal`);if(!p)return;let f=p.querySelector(".aipkit_modal_body")||p;function g(D){return f.querySelector(`[name="${D}"]`)}function m(D){return f.querySelector(`[name="${D}"]:checked`)}function u(D,Z){typeof Z<"u"&&Z!==null&&(t[D]=Z)}let w=g("popup_position");w&&u("popup_position",w.value);let h=g("popup_delay");h&&u("popup_delay",h.value);let C=g("site_wide_enabled");C&&u("site_wide_enabled",C.checked?"1":"0");let x=g("popup_icon_style");if(x)u("popup_icon_style",x.value);else{let D=m("popup_icon_style");D&&u("popup_icon_style",D.value)}let v=g("popup_icon_size");v&&u("popup_icon_size",v.value);let L=g("popup_icon_type");if(L)u("popup_icon_type",L.value);else{let D=m("popup_icon_type");D&&u("popup_icon_type",D.value)}let P=m("popup_icon_default");P&&u("popup_icon_default",P.value);let b=g("popup_icon_custom_url");b&&u("popup_icon_custom_url",b.value);let y=g("header_avatar_type");if(y)u("header_avatar_type",y.value);else{let D=m("header_avatar_type");D&&u("header_avatar_type",D.value)}let S=m("header_avatar_default");S&&u("header_avatar_default",S.value);let E=g("header_avatar_url");E&&u("header_avatar_url",E.value);let A=g("header_online_text");A&&u("header_online_text",A.value);let M=g("popup_label_enabled");M&&u("popup_label_enabled",M.checked?"1":"0");let $=g("popup_label_text");$&&u("popup_label_text",$.value);let W=g("popup_label_mode");W&&u("popup_label_mode",W.value);let H=g("popup_label_size");H&&u("popup_label_size",H.value);let N=g("popup_label_delay_seconds");N&&u("popup_label_delay_seconds",N.value);let G=g("popup_label_auto_hide_seconds");G&&u("popup_label_auto_hide_seconds",G.value);let J=g("popup_label_dismissible");J&&u("popup_label_dismissible",J.checked?"1":"0");let F=g("popup_label_show_on_desktop");F&&u("popup_label_show_on_desktop",F.checked?"1":"0");let q=g("popup_label_show_on_mobile");q&&u("popup_label_show_on_mobile",q.checked?"1":"0");let O=g("popup_label_frequency");O&&u("popup_label_frequency",O.value);let R=g("popup_label_version");R&&u("popup_label_version",R.value)}();let d=t.provider;if(d==="OpenAI")t.model=t.openai_model;else if(d==="OpenRouter")t.model=t.openrouter_model;else if(d==="Google")t.model=t.google_model;else if(d==="Azure")t.model=t.azure_deployment;else if(d==="Claude")t.model=t.claude_model;else if(d==="DeepSeek")t.model=t.deepseek_model;else if(d==="Ollama"){let _=i.querySelector('select[name="ollama_model"]'),p=typeof t.ollama_model<"u"?t.ollama_model:_?_.value:"";t.model=p||""}else t.model="";delete t.openai_model,delete t.openrouter_model,delete t.google_model,delete t.azure_deployment,delete t.claude_model,delete t.deepseek_model,delete t.ollama_model,function(){let p=document.getElementById(`aipkit_bot_${a}_vector_store_modal`),f=m=>p?p.querySelector(m):null,g=m=>i.querySelector(m);if(t.vector_store_provider==="openai"){let m=f('select[name="openai_vector_store_ids[]"]')||g('select[name="openai_vector_store_ids[]"]');m?t.openai_vector_store_ids=Array.from(m.selectedOptions).map(u=>u.value):t.openai_vector_store_ids=[]}else t.hasOwnProperty("openai_vector_store_ids")&&delete t.openai_vector_store_ids;if(t.vector_store_provider==="pinecone"||t.vector_store_provider==="qdrant"){if(t.vector_store_provider==="qdrant"){let w=f('select[name="qdrant_collection_names[]"]')||g('select[name="qdrant_collection_names[]"]');if(w){let h=Array.from(w.selectedOptions).map(C=>C.value);t.qdrant_collection_names=h,t.qdrant_collection_name=h[0]||""}else t.qdrant_collection_names=[],t.qdrant_collection_name=""}else if(t.vector_store_provider==="pinecone"){let w=f('select[name="pinecone_index_name"]')||g('select[name="pinecone_index_name"]');w&&(t.pinecone_index_name=w.value)}let m=f('select[name="vector_embedding_provider"]')||g('select[name="vector_embedding_provider"]');m&&(t.vector_embedding_provider=m.value);let u=f('select[name="vector_embedding_model"]')||g('select[name="vector_embedding_model"]');u&&(t.vector_embedding_model=u.value)}else delete t.pinecone_index_name,delete t.qdrant_collection_name,delete t.qdrant_collection_names,delete t.vector_embedding_provider,delete t.vector_embedding_model}(),aipkit_apiRequest("aipkit_save_chatbot_settings",t).then(_=>{l.textContent=_.message||"Settings Saved!",l.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(a)}).catch(_=>{l.textContent="Error: "+_.message,l.classList.add("error")}).finally(()=>{s.disabled=!1,s.classList.remove("aipkit_loading");let _=s.querySelector(".aipkit_spinner");if(_&&(_.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(s,"Save");else{let p=Array.from(s.childNodes).find(f=>f.nodeType===Node.TEXT_NODE);p?p.textContent="Save":s.insertBefore(document.createTextNode("Save"),s.firstChild),_&&s.appendChild(_)}setTimeout(()=>{l&&(l.textContent="",l.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Deleter: Main content container not found."),i&&i.querySelectorAll(".aipkit_delete_bot_btn").forEach(s=>{s.getAttribute("data-is-default")==="1"&&(s.disabled=!0)}),i&&i.addEventListener("click",function(s){let l=s.target.closest(".aipkit_delete_bot_btn");if(!l||l.disabled)return;let c=l.getAttribute("data-bot-id"),n=l.getAttribute("data-bot-name"),e=l.closest(".aipkit_chatbot_settings_form"),d=document.getElementById("aipkit_header_action_feedback")||(e?e.querySelector(`#aipkit_action_feedback_${c}`):null),_=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!d){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",l);return}let p=`aipkit_delete_confirmation_${c}`,f=d.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_delete_confirmation",f.style.display="none",d.insertBefore(f,d.firstChild));let g=`aipkit_action_status_${c}`,m=d.querySelector(`#${g}`);if(m||(m=document.createElement("div"),m.id=g,m.className="aipkit_action_status_message",d.appendChild(m)),f.style.display!=="none"&&f.innerHTML!=="")return;_&&(_.textContent="",_.className="aipkit_save_status_container");let u=d.querySelector(".aipkit_reset_confirmation");u&&(u.style.display="none"),m.textContent="",m.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let w=f.querySelector(".aipkit_delete_confirm_btn"),h=f.querySelector(".aipkit_delete_cancel_btn"),C=()=>{f.innerHTML="",f.style.display="none",o(l,c,m,_)},x=()=>{f.innerHTML="",f.style.display="none"};w.addEventListener("click",C,{once:!0}),h.addEventListener("click",x,{once:!0})});let a=document.querySelector(".aipkit_chatbot_module_container");a&&a.addEventListener("click",function(s){let l=s.target.closest(".aipkit_header_delete_btn");if(!l)return;let c=l.closest(".aipkit_tab_dropdown_menu");c&&(c.style.display="none");let n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),e=n?.dataset?.botId,t=n?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",_=document.getElementById("aipkit_header_action_feedback")||(n?n.querySelector(`#aipkit_action_feedback_${e}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!e||!_)return;if(t){_.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{_.innerHTML=""},3e3);return}let f=`aipkit_delete_confirmation_${e}`,g=_.querySelector(`#${f}`);g||(g=document.createElement("div"),g.id=f,g.className="aipkit_confirmation_message aipkit_delete_confirmation",g.style.display="none",_.insertBefore(g,_.firstChild));let m=`aipkit_action_status_${e}`,u=_.querySelector(`#${m}`);u||(u=document.createElement("div"),u.id=m,u.className="aipkit_action_status_message",_.appendChild(u)),p&&(p.textContent="",p.className="aipkit_save_status_container");let w=_.querySelector(".aipkit_reset_confirmation");w&&(w.style.display="none"),u.textContent="",u.className="aipkit_action_status_message",g.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
          </div>`,g.style.display="block";let h=g.querySelector(".aipkit_delete_confirm_btn"),C=g.querySelector(".aipkit_delete_cancel_btn");h?.addEventListener("click",()=>{g.innerHTML="",g.style.display="none",o(l,e,u,p)},{once:!0}),C?.addEventListener("click",()=>{g.innerHTML="",g.style.display="none"},{once:!0})})}function o(i,a,s,l){let c=i.querySelector(".aipkit_spinner"),n=document.getElementById("aipkit_chatbot_main_selector_container");l&&(l.textContent="",l.className="aipkit_save_status_container"),s.textContent="",s.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),c&&(c.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Deleting..."):i.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:a}).then(e=>{s.textContent=e.message||"Chatbot deleted successfully.",s.classList.add("success");let t=!1;if(n){let _=n.querySelector(`.aipkit_tab_button[data-bot-id="${a}"]`),p=n.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${a}"]`);if(_)t=_.classList.contains("aipkit_active"),_.remove();else if(p){t=p.classList.contains("aipkit_active"),p.remove();let f=n.querySelector(".aipkit_tab_dropdown_menu");if(f&&f.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let m=f.closest(".aipkit_tab_dropdown_container");m&&m.remove()}}}let d=document.getElementById(`chatbot-${a}-content`);if(d&&d.remove(),setTimeout(()=>{let _=document.getElementById(`aipkit_action_status_${a}`);_&&(_.textContent="",_.className="aipkit_action_status_message")},4e3),t){let _=n?.querySelector(".aipkit_tab_button_default");if(_)_.click();else{let p=n?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(p)p.click();else{let f=n?.querySelector(".aipkit_tab_dropdown_item");if(f)f.click();else{let g=n?.querySelector(".aipkit_create-new-button");if(g)g.click();else{let m=document.getElementById("aipkit_admin_chat_preview_container");m&&(m.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(e=>{s.textContent="Error: "+(e.message||"Failed to delete chatbot."),s.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),c&&(c.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Delete"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_action_status_message")},5e3)})}function r(i){if(!i)return"";let a=document.createElement("div");return a.textContent=i,a.innerHTML}window.aipkit_initDeleteBot=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Resetter: Main content container not found."),i&&i.addEventListener("click",function(s){let l=s.target.closest(".aipkit_reset_bot_btn");if(!l||l.disabled)return;let c=l.getAttribute("data-bot-id"),n=l.getAttribute("data-bot-name"),e=l.closest(".aipkit_chatbot_settings_form"),d=document.getElementById("aipkit_header_action_feedback")||(e?e.querySelector(`#aipkit_action_feedback_${c}`):null),_=document.getElementById("aipkit_chatbot_global_save_status_container");if(!c||!d){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",l);return}let p=`aipkit_reset_confirmation_${c}`,f=d.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",d.insertBefore(f,d.firstChild));let g=`aipkit_action_status_${c}`,m=d.querySelector(`#${g}`);if(m||(m=document.createElement("div"),m.id=g,m.className="aipkit_action_status_message",d.appendChild(m)),f.style.display!=="none"&&f.innerHTML!=="")return;_&&(_.textContent="",_.className="aipkit_save_status_container");let u=d.querySelector(".aipkit_delete_confirmation");u&&(u.style.display="none"),m.textContent="",m.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let w=f.querySelector(".aipkit_reset_confirm_btn"),h=f.querySelector(".aipkit_reset_cancel_btn"),C=()=>{f.innerHTML="",f.style.display="none",o(l,c,m,_)},x=()=>{f.innerHTML="",f.style.display="none"};w.addEventListener("click",C,{once:!0}),h.addEventListener("click",x,{once:!0})});let a=document.querySelector(".aipkit_chatbot_module_container");a&&a.addEventListener("click",function(s){let l=s.target.closest(".aipkit_header_reset_btn");if(!l)return;let c=l.closest(".aipkit_tab_dropdown_menu");c&&(c.style.display="none");let n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),e=n?.dataset?.botId,d=document.getElementById("aipkit_header_action_feedback")||(n?n.querySelector(`#aipkit_action_feedback_${e}`):null),_=document.getElementById("aipkit_chatbot_global_save_status_container");if(!e||!d)return;let p=`aipkit_reset_confirmation_${e}`,f=d.querySelector(`#${p}`);f||(f=document.createElement("div"),f.id=p,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",d.insertBefore(f,d.firstChild));let g=`aipkit_action_status_${e}`,m=d.querySelector(`#${g}`);m||(m=document.createElement("div"),m.id=g,m.className="aipkit_action_status_message",d.appendChild(m)),_&&(_.textContent="",_.className="aipkit_save_status_container");let u=d.querySelector(".aipkit_delete_confirmation");u&&(u.style.display="none"),m.textContent="",m.className="aipkit_action_status_message",f.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Reset</button>
          </div>`,f.style.display="block";let w=f.querySelector(".aipkit_reset_confirm_btn"),h=f.querySelector(".aipkit_reset_cancel_btn");w?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none",o(l,e,m,_)},{once:!0}),h?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none"},{once:!0})})}function o(i,a,s,l){let c=i.querySelector(".aipkit_spinner");l&&(l.textContent="",l.className="aipkit_save_status_container"),s.textContent="",s.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),c&&(c.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Resetting..."):i.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:a}).then(n=>{s.textContent=n.message||"Chatbot reset successfully!",s.classList.add("success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),aipkit_loadModule("chatbot",{force_active_bot_id:a,aipkit_force_refresh:!0},function(e){e&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",e),s.textContent="Reset OK, but UI refresh failed. Reload page.",s.classList.add("error"))}),setTimeout(()=>{let e=document.getElementById(`aipkit_action_status_${a}`);e&&(e.textContent="",e.className="aipkit_action_status_message")},4e3)}).catch(n=>{s.textContent="Error: "+(n.message||"Failed to reset chatbot."),s.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),c&&(c.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Reset"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_action_status_message")},5e3)})}function r(i){if(!i)return"";let a=document.createElement("div");return a.textContent=i,a.innerHTML}window.aipkit_initResetBot=k})();(function(){"use strict";function r(s,l=5,c=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(s)}catch(n){console.error("AIPKit Chat Preview: Error during chat initialization.",n),s.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else l>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${c}ms... (${l} retries left)`),setTimeout(()=>{r(s,l-1,c)},c)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),s.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function i(){let s=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),l=document.getElementById("aipkit_admin_chat_preview_container"),c=document.querySelector(".aipkit_chatbot-preview-column"),n=window.aipkit_dashboard?.text||{};if(!l||!c){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(l.innerHTML="",c.classList.remove("aipkit_loading"),s){let e=s.getAttribute("data-tab-type"),t=s.getAttribute("data-bot-id");e==="bot"&&t?a(t):e==="create"?l.innerHTML=`<p class="aipkit_preview_placeholder">${n.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:e==="settings"?l.innerHTML=`<p class="aipkit_preview_placeholder">${n.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:l.innerHTML=`<p class="aipkit_preview_placeholder">${n.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?l.innerHTML=`<p class="aipkit_preview_placeholder">${n.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:l.innerHTML=`<p class="aipkit_preview_placeholder">${n.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function a(s){let l=document.getElementById("aipkit_admin_chat_preview_container"),c=document.querySelector(".aipkit_chatbot-preview-column"),n=parseInt(s,10);if(!l||!c){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}if(!Number.isFinite(n)||n<=0){let f=window.aipkit_dashboard?.text||{};l.innerHTML=`<p class="aipkit_preview_placeholder">${f.previewPlaceholderSelect||"Select a chatbot to see the preview."}</p>`,c.classList.remove("aipkit_loading");return}let e=null,t=0,d=()=>{t=Date.now(),c.classList.add("aipkit_loading")},_=()=>{if(e&&(clearTimeout(e),e=null),!t){c.classList.remove("aipkit_loading");return}let g=240-(Date.now()-t);g>0?setTimeout(()=>{c.classList.remove("aipkit_loading")},g):c.classList.remove("aipkit_loading")};e=setTimeout(d,160),l.innerHTML="";let p=new URL(window.aipkit_dashboard.ajaxurl);p.searchParams.append("action","aipkit_get_chatbot_shortcode"),p.searchParams.append("bot_id",String(n)),p.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(p).then(f=>f.json()).then(f=>{if(f.success&&f.data&&f.data.html){l.innerHTML=f.data.html;let g=l.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");if(g){l.classList.toggle("aipkit-preview-inline",g.classList.contains("aipkit_chat_container")),l.classList.toggle("aipkit-preview-popup",g.classList.contains("aipkit_popup_wrapper"));let u=window.getComputedStyle(g).getPropertyValue("--aipkit-chat-container-border-radius").trim();u&&u!=="initial"&&u!=="inherit"&&u!=="unset"?l.style.setProperty("--aipkit-chat-container-border-radius",u):l.style.removeProperty("--aipkit-chat-container-border-radius"),r(g)}else console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${s} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,f.data.html),l.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>'}else{let g=f.data&&f.data.message?f.data.message:"Invalid response received for shortcode preview.";throw new Error(g)}}).catch(f=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${s}:`,f),l.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${f.message}</p>`}).finally(()=>{_()})}window.aipkit_loadInitialChatPreview=i,window.aipkit_refreshChatPreview=a})();(function(){"use strict";function k(){let l=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!l)return;let c=function(e){return e?e.tagName==="SELECT"?e.value==="1":!!e.checked:!1},n=function(e){let t=e.target.closest(".aipkit_popup_toggle_switch");if(t){let u=t.closest(".aipkit_chatbot-settings-area");if(u){o(u,t.checked),i(u,t);let w=u.querySelector(".aipkit_popup_config_btn_placeholder");w&&(w.disabled=!t.checked,w.title=t.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let d=e.target.closest('input[name="popup_icon_default"]');if(d){let u=d.closest(".aipkit_chatbot-settings-area");if(u){let w=d.value==="__custom__"?"custom":"default";r(u,w)}return}let _=e.target.closest('select[name="popup_icon_type"]');if(_){let u=_.closest(".aipkit_chatbot-settings-area");u&&r(u,_.value);return}let p=e.target.closest('input[name="popup_icon_type"]');if(p){let u=p.closest(".aipkit_chatbot-settings-area");u&&r(u,p.value);return}let f=e.target.closest(".aipkit_popup_hint_toggle_switch");if(f){let u=f.closest(".aipkit_chatbot-settings-area");u&&s(u,f.checked);return}let g=e.target.closest(".aipkit_starters_toggle_switch");if(g){let u=g.closest(".aipkit_chatbot-settings-area");if(u){let w=u.querySelector(".aipkit_starters_config_btn");if(w){let h=c(g);w.disabled=!h,w.title=h?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}}return}let m=e.target.closest(".aipkit_voice_input_toggle_switch");if(m){let u=m.closest(".aipkit_chatbot-settings-area");u&&a(u,m.checked);return}};l.addEventListener("change",n),l.querySelectorAll(".aipkit_chatbot-settings-area").forEach(e=>{let t=e.querySelector(".aipkit_popup_toggle_switch");if(t){o(e,t.checked),i(e,t);let m=e.querySelector(".aipkit_popup_config_btn_placeholder");m&&(m.disabled=!t.checked,m.title=t.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}let d=e.querySelector('input[name="popup_icon_default"]:checked');if(d){let m=d.value==="__custom__"?"custom":"default";r(e,m)}else{let m=e.querySelector('select[name="popup_icon_type"]');if(m)r(e,m.value);else{let u=e.querySelector('input[name="popup_icon_type"]:checked');u?r(e,u.value):r(e,"default")}}let _=e.querySelector(".aipkit_voice_input_toggle_switch");_&&a(e,_.checked);let p=e.querySelector(".aipkit_popup_hint_toggle_switch");p&&s(e,p.checked);let f=e.querySelector(".aipkit_starters_toggle_switch"),g=e.querySelector(".aipkit_starters_config_btn");if(g){let m=c(f);g.disabled=!m,g.title=m?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}})}function o(l,c){let n=l.querySelector(".aipkit_popup_settings_accordion");if(n&&(n.style.display=c?"block":"none",!c)){let t=n.querySelector(".aipkit_accordion-header"),d=n.querySelector(".aipkit_accordion-content");t&&t.classList.remove("aipkit_active"),d&&d.classList.remove("aipkit_active")}let e=l.querySelector(".aipkit_popup_icon_options_container");e&&(e.style.display=c?"block":"none")}function r(l,c){let n=l.querySelector(".aipkit_popup_icon_default_selector_container"),e=l.querySelector(".aipkit_popup_icon_custom_input_container"),t=!!l.querySelector(".aipkit_popup_icon_default_selector .aipkit_option_card--custom-url");n&&(n.style.display=t||c==="default"?"block":"none"),e&&(e.style.display=c==="custom"?"block":"none")}function i(l,c){let n=c.checked,e=c.getAttribute("data-sidebar-target"),t=l.querySelector("#"+e);if(!t)return;let d=t.querySelector(".aipkit_sidebar_toggle_switch"),_=t.querySelector("label");if(!d||!_)return;let p=t.getAttribute("data-tooltip-disabled")||"";n?(d.getAttribute("data-original-state")===null&&d.setAttribute("data-original-state",d.checked?"checked":"unchecked"),d.checked=!1,d.disabled=!0,t.setAttribute("title",p),t.classList.add("aipkit-disabled-tooltip"),_.style.opacity="0.6"):(d.disabled=!1,t.removeAttribute("title"),t.classList.remove("aipkit-disabled-tooltip"),_.style.opacity="1",d.getAttribute("data-original-state")==="checked"&&(d.checked=!0),d.removeAttribute("data-original-state"))}function a(l,c){let n=l.querySelector(".aipkit_stt_provider_conditional_row");n&&(n.style.display=c?"block":"none")}function s(l,c){let n=l.querySelector(".aipkit_popup_hint_conditional_row");n&&(n.style.display=c?"block":"none");let e=l.querySelectorAll(".aipkit_popup_hint_extra");e&&e.length&&e.forEach(t=>{t.style.display=c?"":"none"})}window.aipkit_initAppearanceToggles=k,window.aipkit_togglePopupDependentSettingsVisibility=o,window.aipkit_toggleSidebarCheckboxState=i,window.aipkit_togglePopupIconValueInputs=r,window.aipkit_toggleSttSettingsVisibility=a,window.aipkit_togglePopupHintSettingsVisibility=s})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o)return;let r=function(i){return i?i.tagName==="SELECT"?i.value==="1":!!i.checked:!1};o.addEventListener("change",function(i){let a=i.target.closest(".aipkit_starters_toggle_switch");if(!a)return;let s=a.closest(".aipkit_chatbot-settings-area");if(!s)return;let l=s.querySelector(".aipkit_starters_conditional_row");l&&(l.style.display=r(a)?"block":"none")}),o.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{let a=i.querySelector(".aipkit_starters_toggle_switch"),s=i.querySelector(".aipkit_starters_conditional_row");a&&s&&(s.style.display=r(a)?"block":"none")})}window.aipkit_initConversationStartersToggle=k})();(function(){"use strict";let k="aipkit_last_selected_chatbot",o="aipkit_chatbotAccordionState",r="aipkit_last_open_chatbot_accordion",i=()=>{try{let e=localStorage.getItem(r);return typeof e=="string"?e:""}catch{return""}},a=()=>{if(window[o]&&typeof window[o]=="object"){let e=window[o].openSectionKey;if(typeof e=="string")return e}return i()},s=(e="")=>{let t=String(e||"").trim();(!window[o]||typeof window[o]!="object")&&(window[o]={}),window[o].openSectionKey=t;try{t?localStorage.setItem(r,t):localStorage.removeItem(r)}catch{}},l=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now();function c(e){let t=document.getElementById("aipkit_admin_chat_preview_container");if(!t)return;t.classList.remove("aipkit-preview-inline","aipkit-preview-popup");let d=document.createElement("p");d.className="aipkit_preview_placeholder",d.textContent=e,t.innerHTML="",t.appendChild(d)}function n(){let e=document.querySelector(".aipkit_chatbot_builder");if(!e||e.dataset.aipkitContext==="sources")return;document.documentElement.classList.add("aipkit-chatbot-builder-page");let t=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:I=>I,d=window.wp&&window.wp.i18n&&window.wp.i18n._n?window.wp.i18n._n:(I,T,B)=>B===1?I:T,_=window.wp&&window.wp.i18n&&window.wp.i18n.sprintf?window.wp.i18n.sprintf:(I,...T)=>{if(!I||!T.length)return I;let B=0;return String(I).replace(/%\d*\$?[sd]/g,()=>{let U=B<T.length?T[B]:"";return B+=1,String(U)})},p={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0},f=e.getAttribute("data-aipkit-chatbot-layout")||"next",g=e.dataset.openaiApiKeySet==="true",m=e.dataset.pineconeApiKeySet==="true",u=e.dataset.qdrantApiKeySet==="true",w=e.dataset.qdrantUrlSet==="true",h=e.dataset.googleApiKeySet==="true",C=e.dataset.azureApiKeySet==="true",x=e.dataset.claudeApiKeySet==="true",v=e.querySelector("#aipkit_chatbot_builder_bot_select"),L=e.getAttribute("data-active-bot-id")||v&&v.value||"",P=String(L||""),b=new Map,y=new Map,S=null,E=!1;if(L)try{localStorage.setItem(k,L)}catch{}let A=e.querySelector(".aipkit_builder_new_bot_btn"),M=e.querySelector("[data-aipkit-bot-tabs]"),$=e.querySelector(".aipkit_builder_bot_overflow"),W=e.querySelector(".aipkit_builder_bot_overflow_trigger"),H=e.querySelector(".aipkit_builder_bot_overflow_menu"),N=10,G=null,J=null,F=document.getElementById("aipkit_builder_sheet"),q=F?F.querySelector(".aipkit_builder_sheet_panel"):null,O=document.getElementById("aipkit_model_settings_popover"),R=document.getElementById("aipkit_settings_accordion"),D=R||(O?O.querySelector(".aipkit_model_settings_popover_panel"):null),Z=O&&O.getAttribute("data-aipkit-mode")==="disabled",Q=O?O.querySelector(".aipkit_model_settings_popover_close"):null,fe=O?O.querySelector(".aipkit_model_settings_popover_title"):null,Ae=O?O.querySelector(".aipkit_model_settings_popover_back"):null,We=O?O.querySelector(".aipkit_model_settings_popover_footer"):null,Ge=null,it="root",_t=F?F.querySelector(".aipkit_builder_sheet_title"):null,mt=F?F.querySelector(".aipkit_builder_sheet_description"):null,Ot=F?F.querySelector(".aipkit_builder_sheet_body"):null,Nt=F?F.querySelectorAll(".aipkit_builder_sheet_section"):[],Ie=F?F.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'):null,qt=F?F.querySelector(".aipkit_builder_sheet_close"):null,Wt=e.querySelector(".aipkit_bot_name_input"),ui=e.querySelector("[data-aipkit-chatbot-summary]"),ae=e.querySelector("[data-aipkit-interface-summary]"),Ce=e.querySelector("[data-aipkit-context-summary]"),Le=e.querySelector("[data-aipkit-behavior-summary]"),Oe=e.querySelector("[data-aipkit-tools-summary]"),$e=e.querySelector("[data-aipkit-safety-summary]"),He=e.querySelector("[data-aipkit-limits-summary]"),je=e.querySelector("[data-aipkit-rules-summary]"),Qe=e.querySelector("[data-aipkit-popup-summary]"),xt=e.querySelector('textarea[name="instructions"]'),bi=e.querySelector(".aipkit_builder_instructions_expand"),gt=document.getElementById("aipkit_builder_instructions_modal"),It=gt?gt.querySelector(".aipkit_builder_instructions_close"):null,ze=gt?gt.querySelector(".aipkit_builder_instructions_modal_textarea"):null,Ye=gt?gt.querySelector(".aipkit_builder_instructions_count"):null,Ze=()=>{let I=e.querySelector(".aipkit_chatbot_provider_select");return I?I.value:""},ei=I=>{if(!I)return"";let T=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${I}"]`);if(!T)return"";let B=T.querySelector("select");return B&&B.value||""},ci=I=>{let T=String(I||"").toLowerCase();return/(?:^|[-_])chat(?:[-_]|$)/.test(T)?!1:T.indexOf("gpt-5")!==-1||T.indexOf("o1")!==-1||T.indexOf("o3")!==-1||T.indexOf("o4")!==-1},Jt=()=>{let I=Ze();return I!=="OpenAI"?!1:ci(ei(I))},Gt=I=>{if(!I)return"";let T=I.selectedOptions&&I.selectedOptions.length?I.selectedOptions[0]:I.options&&I.selectedIndex>=0&&I.selectedIndex<I.options.length?I.options[I.selectedIndex]:null;return T&&T.textContent?T.textContent.trim():""},Di=I=>!I||!I.selectedOptions?[]:Array.from(I.selectedOptions).map(T=>T&&T.textContent?T.textContent.trim():"").filter(Boolean),bt=I=>String(I||"").replace(/\s+\([^)]*\)\s*$/,"").trim(),di=()=>{let I=e.querySelector(".aipkit_vector_embedding_select"),T=Gt(I);if(!T){let B=e.querySelector('[name="vector_embedding_model"]');T=B?String(B.value||""):""}return bt(T)},Ht=()=>{if(!ui)return;let I=ui.dataset.defaultSummary||"Select engine and model",T=e.querySelector(".aipkit_chatbot_provider_select"),B=T&&T.value||"",U=Gt(T),z="";if(B){let K=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${B}"]`);if(K){let V=K.querySelector("select");z=Gt(V)}}let X=[];U&&X.push(U),z&&X.push(z);let ie=X.length?X.join(" | "):I;ui.textContent=ie,ui.setAttribute("title",ie)},Wi=()=>{if(!Qe)return;let I=Qe.dataset.defaultSummary||"Popup settings",T=e.querySelector('select[name="popup_position"]'),B=e.querySelector('select[name="aipkit_deploy_popup_scope"]'),U=[],z=Gt(T),X=Gt(B);z&&U.push(z),X&&U.push(X);let ie=U.length?U.join(" | "):I;Qe.textContent=ie,Qe.setAttribute("title",ie)},Sn=()=>{let I=e.querySelector('.aipkit_custom_theme_presets .aipkit_custom_theme_preset.is-selected, .aipkit_custom_theme_presets .aipkit_custom_theme_preset[aria-pressed="true"]');if(!I)return"";let T=I.querySelector(".aipkit_custom_theme_preset_label");return T&&T.textContent?T.textContent.trim():""},Ki=()=>{let I=e.querySelector('select[name="theme"]');if(I&&!I.disabled){if((I.value||"")==="custom"){let B=Sn();if(B)return B}return Gt(I)}let T=e.querySelector('input[name="theme"]:checked');if(T&&!T.disabled){if((T.value||"")==="custom"){let X=Sn();if(X)return X}let B=T.closest(".aipkit_theme_choice_card"),U=B?B.querySelector(".aipkit_theme_choice_label"):null,z=U&&U.textContent?U.textContent.trim():"";if(z)return z}return""},ln=()=>{if(!ae)return;let I=ae.dataset.defaultSummary||"Select theme",B=Ki()||I;ae.textContent=B,ae.setAttribute("title",B)},Vn=()=>{if(!Ce)return;let I=Ce.dataset.defaultSummary||"",T=[],B=e.querySelector(".aipkit_vector_store_enable_select");if(B&&B.checked){let X=e.querySelector(".aipkit_vector_store_provider_select"),ie=X&&X.value||"",K=Gt(X),V=[];if(ie==="openai")V=Di(e.querySelector('select[name="openai_vector_store_ids[]"]'));else if(ie==="pinecone"){let ne=Gt(e.querySelector('select[name="pinecone_index_name"]'));ne&&(V=[ne])}else ie==="qdrant"&&(V=Di(e.querySelector('select[name="qdrant_collection_names[]"]')));let Y=Array.from(new Set(V.map(ne=>bt(ne)).filter(Boolean)));if(K){let ne=Y.length?`${K}: ${Y.join(", ")}`:K;T.push(ne)}else Y.length&&T.push(Y.join(", "));if(ie==="pinecone"||ie==="qdrant"){let ne=di();ne&&T.push(ne)}}let U=e.querySelector(".aipkit_content_aware_enable_select");U&&U.checked&&T.push(t("Page context","gpt3-ai-content-generator"));let z=T.length?T.join(" | "):I;Ce.textContent=z,Ce.setAttribute("title",z)},_e=I=>{let T=String(I||"").toLowerCase(),B={none:t("None","gpt3-ai-content-generator"),low:t("Low","gpt3-ai-content-generator"),medium:t("Medium","gpt3-ai-content-generator"),high:t("High","gpt3-ai-content-generator"),xhigh:t("Very high","gpt3-ai-content-generator")};return B[T]||B.none},be=()=>{if(!Le)return;let I=Le.dataset.defaultSummary||t("Response length and memory","gpt3-ai-content-generator"),T=e.querySelector('[name="max_completion_tokens"]'),B=e.querySelector('[name="max_messages"]'),U=e.querySelector('[name="reasoning_effort"]'),z=Jt(),X=T?String(T.value||"").trim():"",ie=B?String(B.value||"").trim():"",K=z?_e(U?U.value:""):"",Y=X!==""||ie!==""?z?_(t("Response length: %1$s | Memory: %2$s | Reasoning: %3$s","gpt3-ai-content-generator"),X||"-",ie||"-",K):_(t("Response length: %1$s | Memory: %2$s","gpt3-ai-content-generator"),X||"-",ie||"-"):I;Le.textContent=Y,Le.setAttribute("title",Y)},Pe=()=>{let I=String(Ze()||"").toLowerCase(),B={openai:".aipkit_openai_web_search_enable_toggle",google:".aipkit_google_search_grounding_enable_toggle",claude:".aipkit_claude_web_search_enable_toggle",openrouter:".aipkit_openrouter_web_search_enable_toggle"}[I]||"";return B?e.querySelector(B):null},At=()=>{if(!Oe)return;let I=Oe.dataset.defaultSummary||"",T=[],B=ut=>ut?ut.tagName==="SELECT"?ut.value==="1":!!ut.checked:!1,U=e.querySelector(".aipkit_file_upload_toggle_select");B(U)&&T.push(t("File Upload","gpt3-ai-content-generator"));let z=String(Ze()||""),X=z==="OpenAI"||z==="Claude"||z==="OpenRouter",ie=e.querySelector(".aipkit_image_analysis_checkbox");X&&B(ie)&&T.push(t("Image Analysis","gpt3-ai-content-generator"));let K=e.querySelector(".aipkit_tools_image_generation_toggle");B(K)&&T.push(t("Image generation","gpt3-ai-content-generator"));let V=Pe();B(V)&&T.push(t("Web Search","gpt3-ai-content-generator"));let Y=e.querySelector(".aipkit_voice_input_toggle_switch");B(Y)&&T.push(t("Speech to Text","gpt3-ai-content-generator"));let ne=e.querySelector(".aipkit_tts_toggle_switch");B(ne)&&T.push(t("Text to Speech","gpt3-ai-content-generator"));let de=e.querySelector(".aipkit_enable_realtime_voice_toggle");B(de)&&T.push(t("Realtime Voice","gpt3-ai-content-generator"));let we=T.length,De=we>3?_(t("Enabled: %d","gpt3-ai-content-generator"),we):we>0?_(t("Enabled: %s","gpt3-ai-content-generator"),T.join(", ")):I;Oe.textContent=De,Oe.setAttribute("title",De)},et=()=>{if(!$e)return;let I=$e.dataset.defaultSummary||"",T=[],B=V=>V?V.tagName==="SELECT"?V.value==="1":!!V.checked:!1,U=e.querySelector('[name="enable_ip_anonymization"]');B(U)&&T.push(t("IP anonymization","gpt3-ai-content-generator"));let z=e.querySelector('[name="enable_consent_compliance"]');B(z)&&T.push(t("Consent notice","gpt3-ai-content-generator"));let X=e.querySelector('[name="openai_moderation_enabled"]'),ie=String(Ze()||"").toLowerCase();B(X)&&ie==="openai"&&T.push(t("Moderation","gpt3-ai-content-generator"));let K=T.length?`${t("Enabled","gpt3-ai-content-generator")}: ${T.join(", ")}`:I;$e.textContent=K,$e.setAttribute("title",K)},Lt=I=>{let T=String(I||"").toLowerCase(),B={never:t("never","gpt3-ai-content-generator"),daily:t("1 day","gpt3-ai-content-generator"),weekly:t("1 week","gpt3-ai-content-generator"),monthly:t("1 month","gpt3-ai-content-generator")};return B[T]||B.monthly},fi=I=>String(I??"").trim()||t("Unlimited","gpt3-ai-content-generator"),Vt=()=>{if(!He)return;let I=He.dataset.defaultSummary||"",T=e.querySelector('[name="token_limit_mode"]'),B=T?String(T.value||""):"",U=I;if(B==="role_based"){let z=e.querySelector('[name="token_reset_period"]'),X=Lt(z?z.value:"");U=_(t("Enabled: role based limit reset period: %s.","gpt3-ai-content-generator"),X)}else if(B==="general"||B===""){let z=e.querySelector('[name="token_guest_limit"]'),X=e.querySelector('[name="token_user_limit"]');U=_(t("Guests: %1$s Users: %2$s","gpt3-ai-content-generator"),fi(z?z.value:""),fi(X?X.value:""))}He.textContent=U,He.setAttribute("title",U)},hi=I=>{if(!I)return 0;if(Array.isArray(I))return I.length;if(typeof I=="string"){let T=I.trim();if(!T)return 0;try{return hi(JSON.parse(T))}catch{return 0}}if(typeof I=="object"){if(Array.isArray(I.triggers))return I.triggers.length;if(Array.isArray(I.rules))return I.rules.length}return 0},mi=(I,T,B)=>{let U=d(T,B,I,"gpt3-ai-content-generator");return/%\d*\$?[ds]/.test(U)?U.replace(/%\d*\$?[ds]/,String(I)):`${I} ${U}`},Bi=()=>{if(!je)return;let I=je.dataset.defaultSummary||"",T=e.querySelector('textarea[name="triggers_json"]'),B=T?hi(T.value):0,U=T&&B>0?mi(B,"%d rule","%d rules"):I;je.textContent=U,je.setAttribute("title",U)};ui&&!e.dataset.chatbotSummaryBound&&(e.addEventListener("change",I=>{let T=I.target;T&&(T.matches(".aipkit_chatbot_provider_select")||T.closest(".aipkit_chatbot_model_field select"))&&Ht()}),e.dataset.chatbotSummaryBound="1"),ae&&!e.dataset.interfaceSummaryBound&&(e.addEventListener("change",I=>{let T=I.target;T&&(T.matches('input[name="theme"]')||T.matches('select[name="theme"]'))&&ln()}),e.addEventListener("click",I=>{I.target.closest(".aipkit_custom_theme_preset")&&window.setTimeout(()=>{ln()},0)}),e.dataset.interfaceSummaryBound="1"),Qe&&!e.dataset.popupSummaryBound&&(e.addEventListener("change",I=>{let T=I.target;T&&(T.matches('select[name="popup_position"]')||T.matches('select[name="aipkit_deploy_popup_scope"]'))&&Wi()}),e.dataset.popupSummaryBound="1"),Ce&&!e.dataset.contextSummaryBound&&(e.addEventListener("change",I=>{let T=I.target;T&&(T.matches(".aipkit_vector_store_enable_select")||T.matches(".aipkit_vector_store_provider_select")||T.matches('select[name="openai_vector_store_ids[]"]')||T.matches('select[name="pinecone_index_name"]')||T.matches('select[name="qdrant_collection_names[]"]')||T.matches(".aipkit_vector_embedding_select")||T.matches('[name="vector_embedding_provider"]')||T.matches('[name="vector_embedding_model"]')||T.matches(".aipkit_content_aware_enable_select")||T.matches('[name="content_aware_enabled"]'))&&Vn()}),e.dataset.contextSummaryBound="1"),Le&&!e.dataset.behaviorSummaryBound&&(e.addEventListener("change",I=>{let T=I.target;T&&(T.matches(".aipkit_chatbot_provider_select")||T.closest(".aipkit_chatbot_model_field select")||T.matches('[name="max_completion_tokens"]')||T.matches('[name="max_messages"]')||T.matches('[name="reasoning_effort"]'))&&be()}),e.addEventListener("input",I=>{let T=I.target;T&&(T.matches('[name="max_completion_tokens"]')||T.matches('[name="max_messages"]'))&&be()}),e.dataset.behaviorSummaryBound="1"),Oe&&!e.dataset.toolsSummaryBound&&(e.addEventListener("change",I=>{let T=I.target;T&&(T.matches(".aipkit_file_upload_toggle_select")||T.matches(".aipkit_image_analysis_checkbox")||T.matches(".aipkit_tools_image_generation_toggle")||T.matches(".aipkit_openai_web_search_enable_toggle")||T.matches(".aipkit_google_search_grounding_enable_toggle")||T.matches(".aipkit_claude_web_search_enable_toggle")||T.matches(".aipkit_openrouter_web_search_enable_toggle")||T.matches(".aipkit_voice_input_toggle_switch")||T.matches(".aipkit_tts_toggle_switch")||T.matches(".aipkit_enable_realtime_voice_toggle")||T.matches(".aipkit_chatbot_provider_select"))&&At()}),e.dataset.toolsSummaryBound="1"),$e&&!e.dataset.safetySummaryBound&&(e.addEventListener("change",I=>{let T=I.target;T&&(T.matches('[name="enable_ip_anonymization"]')||T.matches('[name="enable_consent_compliance"]')||T.matches('[name="openai_moderation_enabled"]')||T.matches(".aipkit_chatbot_provider_select"))&&et()}),e.dataset.safetySummaryBound="1"),He&&!e.dataset.limitsSummaryBound&&(e.addEventListener("change",I=>{let T=I.target;T&&(T.matches('[name="token_limit_mode"]')||T.matches('[name="token_guest_limit"]')||T.matches('[name="token_user_limit"]')||T.matches('[name="token_reset_period"]'))&&Vt()}),e.addEventListener("input",I=>{let T=I.target;T&&(T.matches('[name="token_guest_limit"]')||T.matches('[name="token_user_limit"]'))&&Vt()}),e.dataset.limitsSummaryBound="1"),je&&!e.dataset.rulesSummaryBound&&(e.addEventListener("input",I=>{let T=I.target;T&&(T.matches('textarea[name="triggers_json"]')||T.closest(".aipkit_trigger_builder_container"))&&window.setTimeout(()=>{Bi()},0)}),e.addEventListener("change",I=>{let T=I.target;T&&(T.matches('textarea[name="triggers_json"]')||T.closest(".aipkit_trigger_builder_container"))&&window.setTimeout(()=>{Bi()},0)}),e.addEventListener("click",I=>{I.target.closest(".aipkit_trigger_builder_container")&&window.setTimeout(()=>{Bi()},0)}),e.dataset.rulesSummaryBound="1"),Ht(),ln(),Wi(),Vn(),be(),At(),et(),Vt(),Bi();let gi=()=>{W&&W.setAttribute("aria-expanded","false"),H&&(H.hidden=!0)},ti=(I="")=>{if(!H)return;let T=String(I||"").trim().toLowerCase(),B=Array.from(H.querySelectorAll(".aipkit_builder_bot_overflow_item")),U=0;B.forEach(X=>{let ie=String(X.dataset.botLabel||"").toLowerCase(),K=T===""||ie.includes(T);X.hidden=!K,K&&(U+=1)});let z=H.querySelector(".aipkit_builder_bot_overflow_empty");z&&(z.hidden=U>0)},ji=()=>{if(!H||!v)return;let I=String(v.value||"");H.innerHTML="";let T=Array.from(v.options||[]).filter(U=>U&&U.value&&U.value!=="__new__"&&!U.disabled),B=T.length>=N;if(B){let U=document.createElement("div");U.className="aipkit_builder_bot_overflow_search",U.setAttribute("role","none");let z=document.createElement("input");z.type="search",z.className="aipkit_builder_bot_overflow_search_input",z.autocomplete="off",z.setAttribute("placeholder",t("Search chatbots...","gpt3-ai-content-generator")),z.setAttribute("aria-label",t("Search chatbots","gpt3-ai-content-generator")),U.appendChild(z),H.appendChild(U)}if(T.forEach(U=>{let z=String(U.value||""),X=(U.textContent||"").trim(),ie=z===I,K=document.createElement("button");K.type="button",K.className="aipkit_builder_bot_overflow_item",ie&&K.classList.add("is-active"),K.dataset.botId=z,K.dataset.botLabel=X.toLowerCase(),K.setAttribute("role","menuitemradio"),K.setAttribute("aria-checked",ie?"true":"false"),K.textContent=X,H.appendChild(K)}),B){let U=document.createElement("div");U.className="aipkit_builder_bot_overflow_empty",U.textContent=t("No matching chatbots.","gpt3-ai-content-generator"),U.hidden=!0,H.appendChild(U),ti("")}},Me=()=>{if(!M)return;Array.from(M.querySelectorAll(".aipkit_builder_bot_tab_label")).forEach(T=>{let B=T.closest(".aipkit_builder_bot_tab");if(!B||B.hidden){T.classList.remove("aipkit_is_truncated");return}let U=Math.ceil(T.scrollWidth)>T.clientWidth+1;T.classList.toggle("aipkit_is_truncated",U)})},pi=()=>{if(!M)return;let I=Array.from(M.querySelectorAll(".aipkit_builder_bot_tab"));if(!I.length){W&&(W.hidden=!0),$&&($.hidden=!0),gi(),ji();return}I.forEach(st=>{st.hidden=!1});let T=st=>{if(!st)return 0;let ke=st.columnGap&&st.columnGap!=="normal"?st.columnGap:st.gap,pe=parseFloat(ke||"0");return Number.isFinite(pe)?pe:0},B=st=>{if(!st)return 0;let ke=window.getComputedStyle(st),pe=parseFloat(ke.width||"0"),Ke=parseFloat(ke.marginLeft||"0"),me=parseFloat(ke.marginRight||"0"),tt=st.getBoundingClientRect().width||st.offsetWidth||pe,wt=Number.isFinite(tt)?tt:0,ai=Number.isFinite(Ke)?Ke:0,Zt=Number.isFinite(me)?me:0;return Math.ceil(wt+ai+Zt)},U=window.getComputedStyle(M),z=T(U),X=M.closest(".aipkit_builder_bot_tabs_shell"),ie=X?window.getComputedStyle(X):null,K=T(ie),V=M.closest(".aipkit_builder_bot_tabs_row"),Y=V?V.getBoundingClientRect():M.getBoundingClientRect(),ne=Math.max(0,Math.floor(Y.width)),de=B(A),we=B(W),De=de>0?de+K:0,ut=st=>{let ke=st.getBoundingClientRect();return Math.ceil(ke.width||st.offsetWidth||0)},Ct=I.findIndex(st=>st.classList.contains("is-active")),Ft=st=>{let ke=0,pe=[];if(I.forEach((Ke,me)=>{let he=ut(Ke);if(he<=0)return;let tt=pe.length===0?he:ke+z+he;tt<=st+.5&&(pe.push(me),ke=tt)}),Ct!==-1&&!pe.includes(Ct)){let Ke=[],me=0;for(let he=Ct;he>=0;he--){let tt=ut(I[he]);if(tt<=0)continue;let wt=Ke.length===0?tt:me+z+tt;if(wt>st+.5)break;Ke.unshift(he),me=wt}pe=Ke.length>0?Ke:[Ct]}return pe},qi=Math.max(0,ne-De),pt=Ft(qi);if(pt.length<I.length&&we>0){let st=we+K,ke=Math.max(0,ne-De-st);pt=Ft(ke)}let Xt=new Set(pt),vt=0;I.forEach((st,ke)=>{let pe=Xt.has(ke);st.hidden=!pe,pe||(vt+=1)}),Me();let Kt=vt>0;W&&(W.hidden=!Kt),$&&($.hidden=!Kt),Kt||gi(),ji()},Hi=(I="")=>{if(!M||!v)return;let T=String(I||v.value||"");Array.from(M.querySelectorAll(".aipkit_builder_bot_tab")).forEach(z=>{let X=String(z.dataset.botId||""),ie=T!==""&&X===T;z.classList.toggle("is-active",ie),z.setAttribute("aria-selected",ie?"true":"false"),z.setAttribute("tabindex",ie?"0":"-1");let K=Array.from(v.options||[]).find(V=>String(V.value||"")===X);if(K){let V=(K.textContent||"").trim(),Y=z.querySelector(".aipkit_builder_bot_tab_label");Y?Y.textContent=V:z.textContent=V}}),pi();let U=M.querySelector(".aipkit_builder_bot_tab.is-active:not([hidden])");U&&typeof U.scrollIntoView=="function"&&U.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})},En=I=>typeof window<"u"&&window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(I)):String(I).replace(/([ #;?%&,.+*~\\':"!^$\[\]()=>|/@])/g,"\\$1"),Do=I=>Array.isArray(I)?I.map(T=>String(T??"")):I==null||I===""?[]:[String(I)],Ao=I=>{if(Array.isArray(I))return I.some(B=>Ao(B));if(I===!0||I===1)return!0;let T=String(I??"").trim().toLowerCase();return T==="1"||T==="true"||T==="yes"||T==="on"},Wo=(I,T)=>{if(!I)return;let B=(I.tagName||"").toUpperCase(),U=(I.type||"").toLowerCase();if(U==="checkbox"){if(Array.isArray(T)){let z=T.map(X=>String(X??""));I.checked=z.includes(String(I.value||"1"));return}I.checked=Ao(T);return}if(U==="radio"){I.checked=String(I.value||"")===String(T??"");return}if(B==="SELECT"&&I.multiple){let z=Do(T);Array.from(I.options||[]).forEach(X=>{X.selected=z.includes(String(X.value||""))});return}I.value=T==null?"":String(T)},gn=(I,T,B)=>{if(!I||!T)return!1;let U=`[name="${En(T)}"]`,z=Array.from(I.querySelectorAll(U));return z.length?(z.forEach(X=>Wo(X,B)),!0):!1},uo=(I,T)=>{let B=String(I||"").trim(),U=String(T||"").trim();if(!B||!U||B===U)return;let z=["aipkit_bot_","aipkit_theme_choice_","aipkit_image_model_choice_","aipkit_embed_code_","aipkit_embed_allowed_domains_","aipkit_reset_confirmation_","aipkit_delete_confirmation_","aipkit_elevenlabs_voices_json_","aipkit_elevenlabs_models_json_"],X=V=>{if(!V||typeof V!="string")return V;let Y=V;return z.forEach(ne=>{let de=`${ne}${B}`,we=`${ne}${U}`;Y.includes(de)&&(Y=Y.split(de).join(we))}),Y},ie=["id","for","aria-controls","aria-labelledby","data-target"];[e,F,O,gt,document.getElementById("aipkit_builder_embed_modal")].filter(Boolean).forEach(V=>{[V,...Array.from(V.querySelectorAll("[id],[for],[aria-controls],[aria-labelledby],[data-target]"))].forEach(ne=>{ie.forEach(de=>{if(!ne.hasAttribute(de))return;let we=ne.getAttribute(de),De=X(we);De!==we&&ne.setAttribute(de,De)})})})},Ca=I=>{if(!I||typeof I!="object")return null;let T=String(I.bot_id||"").trim();return T?{bot_id:T,bot_name:String(I.bot_name||""),is_default:!!I.is_default,settings:I.settings&&typeof I.settings=="object"?{...I.settings}:{},deploy_mode:String(I.deploy_mode||"inline"),shortcode:String(I.shortcode||""),embed_code:String(I.embed_code||""),embed_allowed_domains:String(I.embed_allowed_domains||""),conversation_starters_text:String(I.conversation_starters_text||""),triggers_json:String(I.triggers_json||"[]")}:null},Ho=I=>{let T=Ca(I);return T?(b.set(T.bot_id,T),T):null},ta=(I="")=>{let T=String(I||"").trim();if(T&&b.has(T))return Promise.resolve(b.get(T));let B=T||"__all__";if(y.has(B))return y.get(B);if(typeof window.aipkit_apiRequest!="function")return Promise.reject(new Error("Chatbot state API unavailable."));let U=T?{bot_id:T}:{},z=window.aipkit_apiRequest("aipkit_get_chatbot_switch_state",U).then(X=>(X&&X.bot&&Ho(X.bot),X&&X.bots&&typeof X.bots=="object"&&Object.keys(X.bots).forEach(ie=>{Ho(X.bots[ie])}),T?b.get(T)||null:X)).finally(()=>{y.delete(B)});return y.set(B,z),z},Vo=()=>S||(v&&Array.from(v.options||[]).filter(T=>T.value&&T.value!=="__new__"&&!T.disabled).length>1?(S=ta().catch(()=>{}).finally(()=>{S=null}),S):Promise.resolve()),ia=(I,T)=>{let B=String(I||"").trim();if(!B||!T)return!1;let U=e.querySelector("form.aipkit_chatbot_settings_form");if(!U)return!1;let z=String(P||U.dataset.botId||B).trim();z&&z!==B&&uo(z,B),P=B,e.setAttribute("data-active-bot-id",B),U.dataset.botId=B,v&&String(v.value||"")!==B&&(v.value=B),Hi(B);let X=T.settings&&typeof T.settings=="object"?T.settings:{};Object.entries(X).forEach(([ne,de])=>{if(!ne)return;if(ne==="token_role_limits"&&de&&typeof de=="object"){Object.entries(de).forEach(([De,ut])=>{gn(e,`token_role_limits[${De}]`,ut)});return}!gn(e,ne,de)&&Array.isArray(de)&&!ne.endsWith("[]")&&gn(e,`${ne}[]`,de)}),Wt&&(Wt.value=T.bot_name||""),gn(e,"conversation_starters",T.conversation_starters_text),gn(e,"triggers_json",T.triggers_json),gn(e,"embed_allowed_domains",T.embed_allowed_domains);let ie=e.querySelector("[data-aipkit-top-mode-select]");ie&&T.deploy_mode&&(ie.value=T.deploy_mode),T.shortcode&&e.querySelectorAll(".aipkit_builder_shortcode_pill").forEach(de=>{de.setAttribute("data-shortcode",T.shortcode);let we=de.querySelector(".aipkit_shortcode_text");we?we.textContent=T.shortcode:de.textContent=T.shortcode});let K=document.getElementById(`aipkit_embed_code_${B}`);K&&typeof T.embed_code=="string"&&(K.value=T.embed_code);let V=e.querySelector(".aipkit_active_bot_name_display");V&&(V.textContent=T.bot_name||"");let Y=e.querySelector('.aipkit_popover_footer_btn[data-action="delete"]');if(Y){let ne=!!T.is_default;Y.disabled=ne,Y.setAttribute("aria-disabled",ne?"true":"false"),Y.setAttribute("title",t(ne?"Default bot cannot be deleted.":"Delete chatbot","gpt3-ai-content-generator"))}io(),Yo(),Pn(),Qa(),oi(),Ia(),Gi(),qr(),Br(),Fa(),nn(),Ja(R),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),Ht(),ln(),Wi(),Vn(),be(),At(),et(),Vt(),Bi();try{localStorage.setItem(k,B)}catch{}if(typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(B),F&&F.classList.contains("aipkit-active")&&typeof window.aipkit_initTriggerBuilderUI=="function"){let ne=F.querySelector('.aipkit_builder_sheet_section[data-sheet="triggers"]');ne&&!ne.hidden&&window.aipkit_initTriggerBuilderUI(B)}return!0},Mn=async I=>{let T=String(I||"").trim();if(!T||T==="__new__"||E)return!1;if(b.has(T)){if(v&&String(v.value||"")!==T)return!1;E=!0;try{return ia(T,b.get(T))}finally{E=!1}}let B=await ta(T);if(!B||v&&String(v.value||"")!==T)return!1;E=!0;try{return ia(T,B)}finally{E=!1}},xr=I=>{if(!I)return p;let T=window.aipkit_dashboard&&window.aipkit_dashboard.models&&Array.isArray(window.aipkit_dashboard.models.openrouter)?window.aipkit_dashboard.models.openrouter:[],B=String(I).trim().toLowerCase();if(!B)return p;let U=T.find(z=>(z&&z.id?String(z.id):"").trim().toLowerCase()===B);return!U||!U.capabilities||typeof U.capabilities!="object"?p:{...p,...U.capabilities}},xa=I=>{if(!I||Ze()!=="OpenRouter")return!0;let B=ei("OpenRouter");return!!xr(B)[I]},Uo=(I,T,B,U)=>{if(!I||!T)return;I.classList.toggle("aipkit_popover_option_row--disabled",B),I.setAttribute("aria-disabled",B?"true":"false"),T.disabled=!!B;let z=I.querySelector(".aipkit_popover_option_label");z&&(z.dataset.defaultTooltip||(z.dataset.defaultTooltip=z.getAttribute("data-tooltip")||""),z.setAttribute("data-tooltip",B&&U||z.dataset.defaultTooltip))},Go=e.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),na=e.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),_o=e.querySelector(".aipkit_training_text_input"),oa=e.querySelector("#aipkit_training_qa_question"),aa=e.querySelector("#aipkit_training_qa_answer"),An=e.querySelector("#aipkit_training_files_input"),fo=e.querySelector(".aipkit_training_files_button"),Lo=e.querySelector(".aipkit_builder_dropzone"),qo=e.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),Rn=e.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),Bn=e.querySelector(".aipkit_training_stop_btn"),Aa=e.querySelector("#aipkit_sources_training_card .aipkit_builder_action_row"),Fn=e.querySelector("#aipkit_training_status"),zn=e.querySelector("#aipkit_training_file_list"),Qn=new Map,mo=null,an={page:1,selectedIds:new Set},kn=e.querySelector(".aipkit_training_sources_btn"),La=e.querySelector("#aipkit_sources_training_card"),Cn=e.querySelector("[data-aipkit-context-source-dropdown]"),Jn=Cn?Cn.querySelector(".aipkit_popover_multiselect_btn"):null,er=Cn?Cn.querySelector(".aipkit_popover_multiselect_label"):null,go=Cn?Cn.querySelector(".aipkit_popover_multiselect_panel"):null,Io=Cn?Array.from(Cn.querySelectorAll(".aipkit_context_source_option")):[],Ii=e.querySelector(".aipkit_vector_store_enable_select"),hn=e.querySelector(".aipkit_content_aware_enable_select"),dn=e.querySelector("[data-aipkit-tools-enabled-dropdown]"),To=dn?dn.querySelector(".aipkit_popover_multiselect_btn"):null,tr=dn?dn.querySelector(".aipkit_popover_multiselect_label"):null,ra=dn?dn.querySelector(".aipkit_popover_multiselect_panel"):null,Yn=dn?Array.from(dn.querySelectorAll(".aipkit_tools_enabled_option")):[],Un=e.querySelector("#aipkit_vs_wp_content_messages_area"),$n=e.querySelector("#aipkit_vs_wp_content_mode"),Xn=e.querySelector("#aipkit_vs_load_wp_content_btn"),pn=e.querySelector("#aipkit_vs_global_target_select"),Po=e.querySelector("#aipkit_vs_wp_content_status"),Mo=e.querySelector("#aipkit_vs_wp_content_status_specific"),Dn=e.querySelector("#aipkit_vs_wp_content_list_area"),sa=e.querySelector("#aipkit_vs_wp_content_pagination"),Bo=e.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Fo=e.querySelector("#aipkit_wp_content_bulk_panel"),ir=e.querySelector("#aipkit_wp_content_specific_panel"),Yt=e.querySelector("#aipkit_wp_content_bulk_hint"),nr=e.querySelector("#aipkit_wp_content_specific_types_panel"),qa=()=>{let I=D&&D.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return I?I.tagName==="SELECT"?I.value==="1":!!I.checked:!1},Ia=()=>{if(!La)return;let I=qa();La.hidden=!I};Ia();let Ta=(I,T,B,U=2)=>{let z=I.filter(ie=>ie&&ie.checked);if(!z.length)return T?.dataset.placeholder||B;if(z.length>U)return`${z.length} selected`;let X=z.map(ie=>{let K=ie.closest("label")?.querySelector(".aipkit_popover_multiselect_text");return K?K.textContent.trim():""}).filter(Boolean);return X.length?X.join(", "):`${z.length} selected`},or=()=>{er&&(er.textContent=Ta(Io,Cn,"Select data source",2))},ca=()=>{if(!Io.length)return;let I=!!(Ii&&(Ii.tagName==="SELECT"&&Ii.value==="1"||Ii.checked)),T=!!(hn&&(hn.tagName==="SELECT"&&hn.value==="1"||hn.checked));Io.forEach(B=>{B&&(B.value==="vector"?B.checked=I:B.value==="page_context"&&(B.checked=T))}),or()},Pa=()=>{let I=Io.find(B=>B.value==="vector"),T=Io.find(B=>B.value==="page_context");if(Ii&&I){let B=!!I.checked,U=Ii.tagName==="SELECT"?Ii.value==="1":!!Ii.checked;B!==U&&(Ii.tagName==="SELECT"?Ii.value=B?"1":"0":Ii.checked=B,Ii.dispatchEvent(new Event("change",{bubbles:!0})))}if(hn&&T){let B=!!T.checked,U=hn.tagName==="SELECT"?hn.value==="1":!!hn.checked;B!==U&&(hn.tagName==="SELECT"?hn.value=B?"1":"0":hn.checked=B,hn.dispatchEvent(new Event("change",{bubbles:!0})))}or()},la=()=>{!Jn||!go||(Jn.setAttribute("aria-expanded","false"),go.hidden=!0,Cn.classList.remove("is-open"))};Cn&&Jn&&go&&!Cn.dataset.bound&&(Jn.addEventListener("click",I=>{if(I.preventDefault(),Jn.getAttribute("aria-expanded")==="true"){la();return}Jn.setAttribute("aria-expanded","true"),go.hidden=!1,Cn.classList.add("is-open")}),Io.forEach(I=>{I.addEventListener("change",()=>{Pa()})}),document.addEventListener("click",I=>{Cn.contains(I.target)||la()}),document.addEventListener("keydown",I=>{I.key==="Escape"&&la()}),Ii&&Ii.addEventListener("change",ca),hn&&hn.addEventListener("change",ca),ca(),Cn.dataset.bound="1");let ar=I=>I?I.tagName==="SELECT"?I.value==="1":!!I.checked:!1,Ar=(I,T)=>{if(!I||I.disabled)return;let B=!!T;ar(I)!==B&&(I.tagName==="SELECT"?I.value=B?"1":"0":I.checked=B,I.dispatchEvent(new Event("change",{bubbles:!0})))},Ma=I=>{switch(I){case"file_upload":return e.querySelector(".aipkit_file_upload_toggle_select");case"web_search":return Pe();case"image_analysis":return e.querySelector(".aipkit_image_analysis_checkbox");case"image_generation":return e.querySelector(".aipkit_tools_image_generation_toggle");case"speech_to_text":return e.querySelector(".aipkit_voice_input_toggle_switch");case"text_to_speech":return e.querySelector(".aipkit_tts_toggle_switch");case"realtime_voice":return e.querySelector(".aipkit_enable_realtime_voice_toggle");default:return null}},Ba=()=>{tr&&(tr.textContent=Ta(Yn,dn,"Select tools",2))},Fa=()=>{if(!Yn.length)return;let I={};Yn.forEach(T=>{let B=T.dataset.toolKey||T.value;I[B]=!!T.checked}),e.querySelectorAll("[data-aipkit-tool-key]").forEach(T=>{let B=T.dataset.aipkitToolKey||"";if(!B)return;let U=I[B]!==!1;T.classList.toggle("aipkit_tools_feature_row--is-hidden",!U)})},oo=()=>{Yn.length&&(Yn.forEach(I=>{if(!I)return;let T=I.dataset.toolKey||I.value,B=Ma(T);B&&(I.checked=ar(B));let z=I.dataset.staticDisabled==="1"||!B||B.disabled;I.disabled=z;let X=I.closest(".aipkit_tools_enabled_item");X&&X.classList.toggle("is-disabled",z)}),Ba(),Fa())},rr=()=>{Yn.length&&(Yn.forEach(I=>{if(!I||I.disabled)return;let T=I.dataset.toolKey||I.value,B=Ma(T);B&&Ar(B,I.checked)}),Ba(),Fa())},Ko=()=>{!To||!ra||(To.setAttribute("aria-expanded","false"),ra.hidden=!0,dn.classList.remove("is-open"),Kn())};if(dn&&To&&ra&&!dn.dataset.bound){To.addEventListener("click",T=>{if(T.preventDefault(),To.getAttribute("aria-expanded")==="true"){Ko();return}To.setAttribute("aria-expanded","true"),ra.hidden=!1,dn.classList.add("is-open"),Kn()}),Yn.forEach(T=>{T.addEventListener("change",()=>{rr()})}),document.addEventListener("click",T=>{dn.contains(T.target)||Ko()}),document.addEventListener("keydown",T=>{T.key==="Escape"&&Ko()}),[".aipkit_file_upload_toggle_select",".aipkit_openai_web_search_enable_toggle",".aipkit_google_search_grounding_enable_toggle",".aipkit_claude_web_search_enable_toggle",".aipkit_openrouter_web_search_enable_toggle",".aipkit_image_analysis_checkbox",".aipkit_tools_image_generation_toggle",".aipkit_voice_input_toggle_switch",".aipkit_tts_toggle_switch",".aipkit_enable_realtime_voice_toggle"].forEach(T=>{e.querySelectorAll(T).forEach(B=>{B.addEventListener("change",oo)})});let I=e.querySelector(".aipkit_chatbot_provider_select");I&&I.addEventListener("change",()=>{window.requestAnimationFrame(oo)}),oo(),dn.dataset.bound="1"}let da=e.querySelector("#aipkit_wp_content_status_wrap_bulk"),sr=e.querySelector("#aipkit_wp_content_status_wrap_specific"),Ji=F?F.querySelector('.aipkit_builder_sheet_section[data-sheet="sources"]'):null,On=Ji?Ji.querySelector("#aipkit_sources_table_body"):null,pa=Ji?Ji.querySelector(".aipkit_sources_search_input"):null,ko=Ji?Ji.querySelector(".aipkit_sources_filter_select"):null,ua=Ji?Ji.querySelector(".aipkit_sources_refresh_btn"):null,wo=Ji?Ji.querySelector("#aipkit_sources_pagination"):null,Zn=Ji?Ji.querySelector("#aipkit_sources_status"):null,$a=Ji?Ji.querySelector("#aipkit_sources_provider_label"):null,eo=Ji?Ji.querySelector("#aipkit_sources_store_label"):null,li=document.getElementById("aipkit_sources_editor_modal"),ho=li?li.querySelector(".aipkit_sources_editor_textarea"):null,cr=li?li.querySelector(".aipkit_sources_editor_close"):null,_a=li?li.querySelector(".aipkit_sources_editor_cancel"):null,Oa=li?li.querySelector(".aipkit_sources_editor_save"):null,Si=document.getElementById("aipkit_sources_delete_modal"),lr=Si?Si.querySelector(".aipkit_sources_delete_close"):null,yn=Si?Si.querySelector(".aipkit_sources_delete_cancel"):null,yo=Si?Si.querySelector(".aipkit_sources_delete_confirm"):null,rn=document.getElementById("aipkit_builder_embed_modal"),fa=rn?rn.querySelector(".aipkit_builder_embed_close"):null,dr=rn?rn.querySelector(".aipkit_builder_embed_done"):null,j=document.getElementById("aipkit_image_settings_flyout"),te=j?j.querySelector(".aipkit_popover_flyout_close"):null,ce=null,re=document.getElementById("aipkit_parameters_flyout"),ge=re?re.querySelector(".aipkit_popover_flyout_close"):null,Te=null,Ee=document.getElementById("aipkit_popup_hint_flyout"),Re=Ee?Ee.querySelector(".aipkit_popover_flyout_close"):null,Ne=null,Be=document.getElementById("aipkit_security_privacy_flyout"),dt=Be?Be.querySelector(".aipkit_popover_flyout_close"):null,Rt=D?D.querySelector('[data-aipkit-settings-panel="safety"]'):null,ii=null,ft=document.getElementById("aipkit_starters_flyout"),Xi=ft?ft.querySelector(".aipkit_popover_flyout_close"):null,Li=null,Tt=document.getElementById("aipkit_custom_theme_flyout"),_i=Tt?Tt.querySelector(".aipkit_popover_flyout_close"):null,ki=null,Ti=null,Pt=document.getElementById("aipkit_builder_web_settings_modal"),Tn=Pt?Pt.querySelector(".aipkit_builder_web_settings_close"):null,Ut=document.getElementById("aipkit_builder_context_settings_modal"),Na=Ut?Ut.querySelector(".aipkit_builder_context_settings_close"):null,Ra=D?D.querySelector('[data-aipkit-settings-panel="context"]'):null,un=null,Ei=document.getElementById("aipkit_builder_token_limits_modal"),Da=Ei?Ei.querySelector(".aipkit_builder_token_limits_close"):null,pr=D?D.querySelector('[data-aipkit-settings-panel="limits"]'):null,_n=null,Ue=document.getElementById("aipkit_builder_audio_settings_modal"),Wa=Ue?Ue.querySelector(".aipkit_builder_audio_settings_close"):null,Vi=null,zi=e.querySelector("#aipkit_builder_popup_settings_panel"),en=e.querySelector("[data-aipkit-popup-launcher-dropdown]"),ao=en?en.querySelector(".aipkit_popover_multiselect_btn"):null,$o=en?en.querySelector(".aipkit_popover_multiselect_label"):null,Ui=en?en.querySelector(".aipkit_popover_multiselect_panel"):null,vn=en?Array.from(en.querySelectorAll(".aipkit_popup_launcher_radio")):[],sn={};["popup_position","popup_icon_style","popup_icon_size"].forEach(I=>{let T=e.querySelector(`select[name="${I}"]`);T&&(sn[I]=T)});let cn=e.querySelector("[data-aipkit-theme-dropdown]"),to=cn?cn.querySelector(".aipkit_popover_multiselect_btn"):null,Ha=cn?cn.querySelector(".aipkit_popover_multiselect_label"):null,ma=cn?cn.querySelector(".aipkit_popover_multiselect_panel"):null,Ln=cn?Array.from(cn.querySelectorAll(".aipkit_interface_theme_radio")):[],Fi=e.querySelector('select[name="theme"]'),vo=e.querySelector('input[name="theme_preset_key"]'),Pi=e.querySelector(".aipkit_theme_config_btn"),Zi=e.querySelector("[data-aipkit-image-model-dropdown]"),ro=Zi?Zi.querySelector(".aipkit_popover_multiselect_btn"):null,ur=Zi?Zi.querySelector(".aipkit_popover_multiselect_label"):null,jo=Zi?Zi.querySelector(".aipkit_popover_multiselect_panel"):null,ga=Zi?Array.from(Zi.querySelectorAll(".aipkit_tools_image_model_radio")):[],tn=e.querySelector('select[name="chat_image_model_id"]'),Gn=e.querySelector("[data-aipkit-replicate-key-trigger]"),Nn=e.querySelector("[data-aipkit-replicate-key-popover]"),Va=Nn?Nn.querySelector("[data-aipkit-replicate-key-close]"):null,$i=document.getElementById("aipkit_chatbot_global_save_status_container"),ot=(I,T)=>{if(!$i)return;let B=typeof I=="string"?I:"",U=typeof T=="string"?T.trim():"",z=!U&&/saving|syncing|deleting|duplicating|resetting|loading|refreshing/i.test(B),X=$i.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_model_sync_status");X&&B&&(X.textContent="",X.classList.remove("success","error","loading")),$i.textContent=B,$i.className="aipkit_save_status_container",U?$i.classList.add(U):z&&$i.classList.add("loading")},Oi=()=>{$i&&setTimeout(()=>{$i.textContent="",$i.className="aipkit_save_status_container"},2500)},Oo=()=>{let I=j&&j.querySelector('input[name="replicate_api_key"]')||D&&D.querySelector('input[name="replicate_api_key"]')||F?.querySelector('input[name="replicate_api_key"]');return I?String(I.value||"").trim():""},Ua=I=>{if(!(I!==void 0?String(I||"").trim():Oo())||typeof window.aipkit_queueProviderSync!="function")return null;ot("Syncing models...","loading");let B=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return B&&typeof B.then=="function"&&B.then(()=>{ot("Models synced!","success"),Oi()}).catch(U=>{ot(`Error: ${U?.message||"Sync failed."}`,"error"),Oi()}),B},Ga=e.dataset.modelSettingsTitle||"Settings",bo=I=>{if(!D||!I)return;let T=I.getBoundingClientRect(),B=D.getBoundingClientRect(),U=B.width||420,z=B.height||0,X=window.innerWidth,ie=window.innerHeight,K=12,V=T.right+10;V+U>X-K&&(V=T.left-U-10),V=Math.max(K,Math.min(V,X-U-K));let Y=T.top;Y+z>ie-K&&(Y=ie-z-K),Y=Math.max(K,Y),D.style.left=`${Math.round(V)}px`,D.style.top=`${Math.round(Y)}px`,re&&re.classList.contains("is-open")&&Te&&_r(Te),j&&j.classList.contains("is-open")&&ce&&so(ce),Pt&&Pt.classList.contains("is-open")&&Ti&&No(Ti),Ut&&Ut.classList.contains("is-open")&&un&&Ro(un),Ei&&Ei.classList.contains("is-open")&&_n&&wa(_n),Ue&&Ue.classList.contains("is-open")&&Vi&&ha(Vi)},ka=I=>{if(!O)return;let T=Array.from(O.querySelectorAll("[data-aipkit-settings-panel]"));if(!T.length)return;let B=I||"root",U=O.querySelector(`[data-aipkit-settings-panel="${B}"]`)||O.querySelector('[data-aipkit-settings-panel="root"]');if(!U)return;let z=U.dataset.aipkitSettingsPanel||"root";if(z!==it&&((()=>{re&&(re.classList.remove("is-open"),re.setAttribute("aria-hidden","true")),Te&&(Te.setAttribute("aria-expanded","false"),Te=null),j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true")),ce&&(ce.setAttribute("aria-expanded","false"),ce=null),Be&&(Be.classList.remove("is-open"),Be.setAttribute("aria-hidden","true")),ii&&(ii.setAttribute("aria-expanded","false"),ii=null),ba(),Ko(),Pt&&(Pt.classList.remove("is-open"),Pt.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),Ut&&(Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true")),un&&(un.setAttribute("aria-expanded","false"),un=null),Ei&&(Ei.classList.remove("is-open"),Ei.setAttribute("aria-hidden","true")),_n&&(_n.setAttribute("aria-expanded","false"),_n=null),Ue&&(Ue.classList.remove("is-open"),Ue.setAttribute("aria-hidden","true")),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null),ft&&(ft.classList.remove("is-open"),ft.setAttribute("aria-hidden","true")),Li&&(Li.setAttribute("aria-expanded","false"),Li=null),Tt&&(Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true")),ki&&(ki.setAttribute("aria-expanded","false"),ki=null)})(),it=z),T.forEach(ie=>{ie.hidden=ie!==U}),fe){let ie={root:O.dataset.titleRoot||"Settings",appearance:O.dataset.titleAppearance||"Appearance",behavior:O.dataset.titleBehavior||"Behavior",context:O.dataset.titleContext||"Context",tools:O.dataset.titleTools||"Tools",safety:O.dataset.titleSafety||"Safety",limits:O.dataset.titleLimits||"Limits"};fe.textContent=ie[z]||ie.root}Ae&&(Ae.hidden=z==="root"),We&&(We.hidden=z!=="root"),z==="behavior"&&Ja(U),z==="limits"&&Gi(),O.classList.contains("aipkit-active")&&Ge&&window.requestAnimationFrame(()=>{bo(Ge)})},_r=I=>{if(!re||!I)return;let T=I.getBoundingClientRect(),B=D?D.getBoundingClientRect():null,U=B&&B.width>0&&B.height>0,z=re.getBoundingClientRect(),X=z.width||320,ie=z.height||260,K=window.innerWidth,V=window.innerHeight,Y=12,ne=(B?B.right:T.right)+8;ne+X>K-Y&&(ne=(B?B.left:T.left)-X-8),ne=Math.max(Y,Math.min(ne,K-X-Y));let de=B?B.top:T.top-8;de+ie>V-Y&&(de=V-ie-Y),de<Y&&(de=Y),re.style.left=`${Math.round(ne)}px`,re.style.top=`${Math.round(de)}px`},so=I=>{if(!j||!I)return;let T=I.getBoundingClientRect(),B=D?D.getBoundingClientRect():null,U=j.getBoundingClientRect(),z=U.width||340,X=U.height||220,ie=window.innerWidth,K=window.innerHeight,V=12,Y=(B?B.right:T.right)+8;Y+z>ie-V&&(Y=(B?B.left:T.left)-z-8),Y=Math.max(V,Math.min(Y,ie-z-V));let ne=B?B.top:T.top-8;ne+X>K-V&&(ne=K-X-V),ne<V&&(ne=V),j.style.left=`${Math.round(Y)}px`,j.style.top=`${Math.round(ne)}px`},zo=I=>{if(!Ee||!I)return;let T=I.getBoundingClientRect(),B=I.closest(".aipkit_builder_card--settings, .aipkit_settings_accordion"),U=B?B.getBoundingClientRect():T,z=I.closest(".aipkit_popover_multiselect_panel"),X=z?z.getBoundingClientRect():null,ie=X&&X.width>0&&X.height>0?X:T,K=Ee.getBoundingClientRect(),V=K.width||320,Y=K.height||240,ne=window.innerWidth,de=window.innerHeight,we=12,De=8,ut=Math.max(U.right,ie.right),Ct=Math.min(U.left,ie.left),Ft=ut+De,qi=Ct-V-De,pt=ne-we-Ft,yi=qi-we,Xt;pt>=V||pt>=yi?Xt=Ft:Xt=qi,Xt=Math.max(we,Math.min(Xt,ne-V-we));let vt=de-ie.bottom+De;vt<we&&(vt=we),de-vt-Y<we&&(vt=Math.max(we,de-Y-we)),Ee.style.left=`${Math.round(Xt)}px`,Ee.style.top="auto",Ee.style.bottom=`${Math.round(vt)}px`},Ka=I=>{if(!ft||!I)return;let T=I.getBoundingClientRect(),B=I.closest(".aipkit_builder_card--settings, .aipkit_settings_accordion"),U=B?B.getBoundingClientRect():T,z=I.closest(".aipkit_interface_cell--controls, .aipkit_interface_feature_row"),X=z?z.getBoundingClientRect():T,ie=ft.getBoundingClientRect(),K=ie.width||400,V=ie.height||240,Y=window.innerWidth,ne=window.innerHeight,de=12,we=8,De=U.right+we,ut=U.left-K-we,Ct=Y-de-De,Ft=ut-de,qi;Ct>=K||Ct>=Ft?qi=De:qi=ut,qi=Math.max(de,Math.min(qi,Y-K-de));let pt=ne-X.bottom;pt<de&&(pt=de),ne-pt-V<de&&(pt=Math.max(de,ne-V-de)),ft.style.left=`${Math.round(qi)}px`,ft.style.top="auto",ft.style.bottom=`${Math.round(pt)}px`},ja=I=>{if(!Be||!I)return;let T=I.getBoundingClientRect(),B=D?D.getBoundingClientRect():null,U=B&&B.width>0&&B.height>0,X=Be.getBoundingClientRect().width||400,ie=window.innerWidth,K=window.innerHeight,V=12,Y=(U?B.right:T.right)+8;Y+X>ie-V&&(Y=(U?B.left:T.left)-X-8),Y=Math.max(V,Math.min(Y,ie-X-V));let ne=U?K-B.bottom:K-T.bottom,de=Math.max(V,ne);Be.style.left=`${Math.round(Y)}px`,Be.style.top="auto",Be.style.bottom=`${Math.round(de)}px`},za=I=>{if(!Tt||!I)return;let T=I.getBoundingClientRect();if(T.width===0&&T.height===0&&e){let we=e.querySelector(".aipkit_theme_config_btn")||e.querySelector("[data-aipkit-theme-dropdown] .aipkit_popover_multiselect_btn")||e.querySelector('select[name="theme"]')||e.querySelector('.aipkit_theme_choice_card input[name="theme"][value="custom"]')?.closest(".aipkit_theme_choice_card");if(we){let De=we.getBoundingClientRect();(De.width>0||De.height>0)&&(T=De)}}let B=D?D.getBoundingClientRect():null,U=B&&B.width>0&&B.height>0,z=Tt.getBoundingClientRect(),X=z.width||400,ie=z.height||260,K=window.innerWidth,V=window.innerHeight,Y=12,ne=(U?B.right:T.right)+8;ne+X>K-Y&&(ne=(U?B.left:T.left)-X-8),ne=Math.max(Y,Math.min(ne,K-X-Y));let de=U?B.top:T.top-8;de+ie>V-Y&&(de=V-ie-Y),de<Y&&(de=Y),Tt.style.left=`${Math.round(ne)}px`,Tt.style.top=`${Math.round(de)}px`},No=I=>{if(!Pt||!I)return;let T=D?D.getBoundingClientRect():null,B=T&&T.width>0&&T.height>0,U=I.getBoundingClientRect(),z=Pt.querySelector(".aipkit-modal-content"),X=z?z.getBoundingClientRect():null,ie=X?X.width:520,K=X?X.height:420,V=window.innerWidth,Y=window.innerHeight,ne=12,de=(B?T.right:U.right)+10;de+ie>V-ne&&(de=(B?T.left:U.left)-ie-10),de=Math.max(ne,Math.min(de,V-ie-ne));let we=U.top-8;we+K>Y-ne&&(we=Y-K-ne),we<ne&&(we=ne),Pt.style.left=`${Math.round(de)}px`,Pt.style.top=`${Math.round(we)}px`,Pt.style.bottom="auto"},Ro=I=>{if(!Ut||!I)return;let T=D?D.getBoundingClientRect():null,B=I.getBoundingClientRect(),U=Ut.querySelector(".aipkit-modal-content"),z=U?U.getBoundingClientRect():null,X=z?z.width:560,ie=window.innerWidth,K=12,V=(T?T.right:B.right)+8;V+X>ie-K&&(V=(T?T.left:B.left)-X-8),V=Math.max(K,Math.min(V,ie-X-K));let Y=T?T.top:K;Ut.style.left=`${Math.round(V)}px`,Ut.style.top=`${Math.round(Y)}px`},wa=I=>{if(!Ei||!I)return;let T=D?D.getBoundingClientRect():null,B=I.getBoundingClientRect(),U=Ei.querySelector(".aipkit-modal-content"),z=U?U.getBoundingClientRect():null,X=z?z.width:620,ie=z?z.height:400,K=window.innerWidth,V=12,Y=(T?T.right:B.right)+8;Y+X>K-V&&(Y=(T?T.left:B.left)-X-8),Y=Math.max(V,Math.min(Y,K-X-V));let ne=T?T.bottom-ie:B.top-12;ne<V&&(ne=V),Ei.style.left=`${Math.round(Y)}px`,Ei.style.top=`${Math.round(ne)}px`},ha=I=>{if(!Ue||!I)return;let T=D?D.getBoundingClientRect():null,B=T&&T.width>0&&T.height>0,U=I.getBoundingClientRect(),z=Ue.querySelector(".aipkit-modal-content"),X=z?z.getBoundingClientRect():null,ie=X?X.width:520,K=X?X.height:460,V=window.innerWidth,Y=12,ne=(B?T.right:U.right)+10;ne+ie>V-Y&&(ne=(B?T.left:U.left)-ie-10),ne=Math.max(Y,Math.min(ne,V-ie-Y));let de=window.innerHeight,we=U.top-8;we+K>de-Y&&(we=de-K-Y),we<Y&&(we=Y),Ue.style.left=`${Math.round(ne)}px`,Ue.style.top=`${Math.round(we)}px`,Ue.style.bottom="auto"},fr=I=>{Z||!O||!D||!I||(F&&F.classList.contains("aipkit-active")&&(F.classList.remove("aipkit-active"),F.setAttribute("aria-hidden","true")),ka("root"),Ge=I,O.classList.add("aipkit-active"),O.setAttribute("aria-hidden","false"),I.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_model_settings_popover"),Ja(D),io(),Yo(),nn(),window.requestAnimationFrame(()=>{bo(I)}))},So=()=>{O&&(ka("root"),Pt&&(Pt.classList.remove("is-open"),Pt.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),Ut&&(Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true")),un&&(un.setAttribute("aria-expanded","false"),un=null),Ei&&(Ei.classList.remove("is-open"),Ei.setAttribute("aria-hidden","true")),_n&&(_n.setAttribute("aria-expanded","false"),_n=null),Ue&&(Ue.classList.remove("is-open"),Ue.setAttribute("aria-hidden","true")),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null),re&&(re.classList.remove("is-open"),re.setAttribute("aria-hidden","true")),Te&&(Te.setAttribute("aria-expanded","false"),Te=null),j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true")),ce&&(ce.setAttribute("aria-expanded","false"),ce=null),Be&&(Be.classList.remove("is-open"),Be.setAttribute("aria-hidden","true")),ii&&(ii.setAttribute("aria-expanded","false"),ii=null),va(),ba(),Ko(),O.classList.remove("aipkit-active"),O.setAttribute("aria-hidden","true"),Ge&&Ge.setAttribute("aria-expanded","false"),Ge=null)},mr=()=>{if(!D)return;let I=e.querySelector(".aipkit_chatbot_provider_select"),T=I?I.value:"",B=xa("web_search_plugin"),U=ie=>ie?ie.tagName==="SELECT"?ie.value==="1":ie.type==="checkbox"?ie.checked:ie.value==="1":!1,z={OpenAI:{row:D.querySelector(".aipkit_web_search_toggle_openai"),toggle:D.querySelector(".aipkit_openai_web_search_enable_toggle"),button:D.querySelector('.aipkit_web_search_config_btn[data-web-provider="openai"]')},Google:{row:D.querySelector(".aipkit_web_search_toggle_google"),toggle:D.querySelector(".aipkit_google_search_grounding_enable_toggle"),button:D.querySelector('.aipkit_web_search_config_btn[data-web-provider="google"]')},Claude:{row:D.querySelector(".aipkit_web_search_toggle_claude"),toggle:D.querySelector(".aipkit_claude_web_search_enable_toggle"),button:D.querySelector('.aipkit_web_search_config_btn[data-web-provider="claude"]')},OpenRouter:{row:D.querySelector(".aipkit_web_search_toggle_openrouter"),toggle:D.querySelector(".aipkit_openrouter_web_search_enable_toggle"),button:D.querySelector('.aipkit_web_search_config_btn[data-web-provider="openrouter"]')}};Object.entries(z).forEach(([ie,K])=>{if(K.row&&(K.row.style.display=T===ie?"":"none"),K.button){let Y=ie==="OpenRouter"?B:!0;K.button.style.display=Y&&U(K.toggle)?"":"none"}}),Pt&&Ti&&Pt.classList.contains("is-open")&&(Ti.offsetParent!==null&&Ti.style.display!=="none"&&!Ti.hidden||(Pt.classList.remove("is-open"),Pt.setAttribute("aria-hidden","true"),Ti.setAttribute("aria-expanded","false"),Ti=null));let X=z.OpenRouter;if(X.row&&X.toggle){let ie=T==="OpenRouter"&&!B;ie&&U(X.toggle)&&(X.toggle.tagName==="SELECT"?X.toggle.value="0":X.toggle.type==="checkbox"?X.toggle.checked=!1:X.toggle.value="0",X.toggle.dispatchEvent(new Event("change",{bubbles:!0}))),Uo(X.row,X.toggle,ie,t("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"))}oo()},io=()=>{let I=K=>K?K.tagName==="SELECT"?K.value==="1":K.type==="checkbox"?K.checked:K.value==="1":!1,T=K=>{if(!K)return;let V=D&&D.querySelector(".aipkit_claude_web_search_enable_toggle")||K.querySelector(".aipkit_claude_web_search_enable_toggle"),Y=I(V),ne=K.querySelector(".aipkit_claude_web_search_conditional_settings");ne&&(ne.style.display=Y?"":"none");let de=K.querySelector(".aipkit_claude_web_search_loc_type_select"),we=K.querySelector(".aipkit_claude_web_search_location_details");we&&(we.style.display=Y&&de&&de.value==="approximate"?"":"none")},B=(K,V)=>{if(!K)return;let Y=D&&D.querySelector(".aipkit_openrouter_web_search_enable_toggle")||K.querySelector(".aipkit_openrouter_web_search_enable_toggle"),ne=V&&I(Y);!V&&Y&&I(Y)&&(Y.tagName==="SELECT"?Y.value="0":Y.type==="checkbox"?Y.checked=!1:Y.value="0",Y.dispatchEvent(new Event("change",{bubbles:!0})));let de=K.querySelector(".aipkit_openrouter_web_search_conditional_settings");de&&(de.style.display=ne?"":"none")},U=e.querySelector(".aipkit_chatbot_provider_select"),z=U?U.value:"",X=xa("web_search_plugin"),ie=Pt||F;if(ie){let K=ie.querySelector(".aipkit_web_modal_section_openai"),V=ie.querySelector(".aipkit_web_modal_section_google"),Y=ie.querySelector(".aipkit_web_modal_section_claude"),ne=ie.querySelector(".aipkit_web_modal_section_openrouter");K&&(K.style.display=z==="OpenAI"?"":"none"),V&&(V.style.display=z==="Google"?"":"none"),Y&&(Y.style.display=z==="Claude"?"":"none"),ne&&(ne.style.display=z==="OpenRouter"&&X?"":"none"),typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(ie),typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(ie),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(ie),typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(ie),T(ie),B(ie,X)}mr()},le=()=>{let I=D&&D.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return I?I.tagName==="SELECT"?I.value==="1"?"1":"0":I.checked?"1":"0":"0"},xe=()=>{if(!D)return"0";let I=D.querySelector(".aipkit_file_upload_toggle_select");return!I||I.disabled?"0":I.tagName==="SELECT"?I.value==="1"?"1":"0":I.checked?"1":"0"},ye=()=>Ra||Ut,Ve=()=>pr||Ei,nt=()=>{let I=ye();return I?{providerSelect:I.querySelector('[name="vector_store_provider"]'),openaiStoresSelect:I.querySelector('select[name="openai_vector_store_ids[]"]'),pineconeIndexSelect:I.querySelector('[name="pinecone_index_name"]'),qdrantCollectionsSelect:I.querySelector('select[name="qdrant_collection_names[]"]'),pineconeKeyInput:I.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:I.querySelector('[name="qdrant_url"]'),qdrantKeyInput:I.querySelector('[name="qdrant_api_key"]')}:{}},yt=I=>I?Array.from(I.options).filter(T=>!T.disabled&&T.value):[],rt=I=>I?(I.selectedOptions?Array.from(I.selectedOptions):[]).some(B=>!B.disabled&&B.value):!1,Dt=I=>{if(!I)return!1;let T=I.options[I.selectedIndex];if(T&&!T.disabled&&T.value)return!0;let B=yt(I)[0];return B?(I.value=B.value,I.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},kt=I=>{if(!I)return!1;if(rt(I))return!0;let T=yt(I)[0];return T?(T.selected=!0,I.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},Bt=I=>{if(!D)return;let T=D.querySelector(".aipkit_vector_store_popover_row .aipkit_popover_warning");if(T){if(!I){T.classList.remove("is-visible"),T.setAttribute("aria-hidden","true"),T.setAttribute("data-tooltip",""),T.removeAttribute("aria-label");return}T.classList.add("is-visible"),T.setAttribute("aria-hidden","false"),T.setAttribute("data-tooltip",I),T.setAttribute("aria-label",I)}},ct=()=>{if(xe()!=="1"){Bt("");return}let{providerSelect:I,openaiStoresSelect:T,pineconeIndexSelect:B,qdrantCollectionsSelect:U,pineconeKeyInput:z,qdrantUrlInput:X,qdrantKeyInput:ie}=nt(),K=I?I.value:"",V=e.querySelector(".aipkit_chatbot_provider_select"),Y=V?V.value:"",ne=!!(z&&z.value.trim()),de=!!(X&&X.value.trim()),we=!!(ie&&ie.value.trim()),De=rt(T),ut=rt(B),Ct=rt(U),Ft="";K?K==="openai"?g?De||(Ft="No OpenAI vector stores found. Create a vector store."):Ft="Add your OpenAI API key to enable OpenAI vector stores.":K==="pinecone"?ne?ut||(Ft="No Pinecone indexes found. Create an index."):Ft="Add your Pinecone API key to enable Pinecone.":K==="qdrant"?!de&&!we?Ft="Add your Qdrant URL and API key to enable Qdrant.":de?we?Ct||(Ft="No Qdrant collections found. Create a collection."):Ft="Add your Qdrant API key to enable Qdrant.":Ft="Add your Qdrant URL to enable Qdrant.":K==="claude_files"?Y!=="Claude"?Ft="Claude Files requires the chatbot provider to be Claude.":x||(Ft="Add your Claude API key to enable Claude Files."):Ft="Select and configure a vector provider to use file uploads.":Ft="Select and configure a vector provider to use file uploads.",Bt(Ft)},Et=()=>{let I=ye();if(!D||!I)return;let T=D.querySelector(".aipkit_vector_store_enable_select");T&&!T.checked&&(T.checked=!0,T.dispatchEvent(new Event("change",{bubbles:!0})));let{providerSelect:B,openaiStoresSelect:U,pineconeIndexSelect:z,qdrantCollectionsSelect:X,pineconeKeyInput:ie,qdrantUrlInput:K,qdrantKeyInput:V}=nt(),Y=!!(ie&&ie.value.trim()),ne=!!(K&&K.value.trim()),de=!!(V&&V.value.trim()),we="";g?we="openai":Y?we="pinecone":(de||ne)&&(we="qdrant"),B&&we&&B.value!==we&&(B.value=we,B.dispatchEvent(new Event("change",{bubbles:!0}))),we==="openai"?kt(U):we==="pinecone"?Dt(z):we==="qdrant"&&kt(X),ct()},fn=()=>{let I=ye();if(!I)return!1;let T=I.querySelector('[name="vector_store_provider"]');if(!T)return!1;let B=e.querySelector(".aipkit_chatbot_provider_select"),z=(B?B.value:"")==="Claude",X=Array.from(T.options||[]).find(V=>V&&V.value==="claude_files");if(!X)return!1;let ie=!z,K=!1;if(X.disabled!==ie&&(X.disabled=ie,K=!0),ie&&T.value==="claude_files"){let V=Array.from(T.options||[]).find(ne=>ne&&ne.value&&!ne.disabled&&ne.value!=="claude_files"),Y=V?V.value:"openai";if(T.value!==Y)return T.value=Y,T.dispatchEvent(new Event("change",{bubbles:!0})),!0}return K&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),!1},ni=()=>{if(!D)return;let I=D.querySelector(".aipkit_file_upload_toggle_select");if(!I)return;let T=I.closest(".aipkit_popover_option_row"),B=T?T.querySelector(".aipkit_popover_option_label"):null,U=I.dataset.isProPlan==="true",z=U,X=I.dataset.tooltipDefault||"",ie=ye(),K=ie?ie.querySelector('[name="vector_store_provider"]'):null,V=K?K.value:"",Y=e.querySelector(".aipkit_chatbot_provider_select"),ne=Y?Y.value:"";if(fn())return;U?V==="claude_files"&&ne!=="Claude"&&(X="Claude Files requires the chatbot provider to be Claude.",z=!1):(X=I.dataset.tooltipUpgrade||X,z=!1),T&&T.classList.toggle("aipkit_popover_option_row--disabled",!z),I.disabled=!z,B&&B.setAttribute("data-tooltip",X);let de=I.tagName==="SELECT"?I.value==="1":I.checked;!z&&de&&(I.tagName==="SELECT"?I.value="0":I.checked=!1,I.dispatchEvent(new Event("change",{bubbles:!0}))),oo()},oi=()=>{let I=ye();I&&(typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(I),typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(I))},nn=()=>{if(!D)return;let I=le()==="1",T=D.querySelector(".aipkit_file_upload_toggle_select");!I&&T&&!T.disabled&&(T.tagName==="SELECT"?T.value==="1":T.checked)&&(T.tagName==="SELECT"?T.value="0":T.checked=!1,T.dispatchEvent(new Event("change",{bubbles:!0}))),oi(),ni(),ct(),Ia()},Gi=()=>{let I=Ve();if(!I)return;let T=I.querySelector(".aipkit_token_limit_mode_select"),B=I.querySelector(".aipkit_limits_primary_grid"),U=I.querySelector(".aipkit_token_general_user_limit_field"),z=I.querySelector(".aipkit_token_role_limits_container");if(!T||!U||!z)return;let X=T.value;B&&B.classList.toggle("aipkit_limits_primary_grid--role-based",X==="role_based"),U.style.display=X==="general"?"block":"none",z.style.display=X==="role_based"?"block":"none"},Eo=()=>{if(!Ue)return;let I=(Ue.dataset.activeAudioFeature||"").trim(),T=Ue.querySelectorAll(".aipkit_audio_feature_group");T.length&&T.forEach(B=>{if(!I){B.style.display="";return}B.style.display=B.classList.contains(`aipkit_audio_feature_group--${I}`)?"":"none"})},Pn=()=>{if(!Ue)return;let I=pt=>pt?pt.tagName==="SELECT"?pt.value==="1":pt.type==="checkbox"?pt.checked:pt.value==="1":!1,T=pt=>I(e.querySelector(pt)),B=(pt,yi)=>{e.querySelectorAll(`.aipkit_audio_settings_config_btn[data-audio-feature="${pt}"]`).forEach(Xt=>{Xt.style.display=yi?"":"none"})},U=T(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch"),z=T(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch"),X=T(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle"),ie=Ue.querySelector(".aipkit_stt_provider_conditional_row"),K=Ue.querySelector(".aipkit_stt_provider_row"),V=K&&K.dataset.sttControlsHidden==="1";if(K&&(K.style.display=U&&!V?"block":"none"),ie&&(ie.style.display=U&&!V?"flex":"none"),U&&V&&K){let pt=K.dataset.sttDefaultProvider,yi=K.dataset.sttDefaultModel,Xt=Ue.querySelector(".aipkit_stt_provider_select"),vt=Ue.querySelector('[name="stt_openai_model_id"]'),Kt=(st,ke,pe)=>{if(!st||!ke)return;if(!Array.from(st.options).some(me=>me.value===ke)){let me=new Option(pe||ke,ke,!0,!0);st.add(me)}st.value=ke};Kt(Xt,pt),Kt(vt,yi,"whisper-1")}B("stt",U&&!V),typeof window.aipkit_toggleSttModelFields=="function"&&window.aipkit_toggleSttModelFields(Ue);let Y=Ue.querySelector(".aipkit_tts_conditional_settings"),ne=Ue.querySelector(".aipkit_tts_provider_row"),de=Ue.querySelector(".aipkit_tts_auto_play_container");ne&&(ne.style.display=z?"block":"none"),Y&&(Y.style.display=z?"flex":"none"),de&&(de.style.display=z?"block":"none");let we=Ue.querySelector(".aipkit_tts_provider_select");if(we){let pt=we.value;Ue.querySelectorAll(".aipkit_tts_field").forEach(ke=>{let pe=ke.getAttribute("data-provider");ke.style.display=z&&pe===pt?"block":"none"});let yi=Ue.querySelector(".aipkit_tts_google_voice_inline"),Xt=Ue.querySelector(".aipkit_tts_openai_voice_inline"),vt=Ue.querySelector(".aipkit_tts_openai_model_inline"),Kt=Ue.querySelector(".aipkit_tts_elevenlabs_voice_inline"),st=Ue.querySelector(".aipkit_tts_elevenlabs_model_inline");yi&&(yi.style.display=z&&pt==="Google"?"block":"none"),Xt&&(Xt.style.display=z&&pt==="OpenAI"?"block":"none"),vt&&(vt.style.display=z&&pt==="OpenAI"?"block":"none"),Kt&&(Kt.style.display=z&&pt==="ElevenLabs"?"block":"none"),st&&(st.style.display=z&&pt==="ElevenLabs"?"block":"none")}else if(z===!1){Ue.querySelectorAll(".aipkit_tts_field").forEach(st=>{st.style.display="none"});let pt=Ue.querySelector(".aipkit_tts_google_voice_inline");pt&&(pt.style.display="none");let yi=Ue.querySelector(".aipkit_tts_openai_voice_inline");yi&&(yi.style.display="none");let Xt=Ue.querySelector(".aipkit_tts_openai_model_inline");Xt&&(Xt.style.display="none");let vt=Ue.querySelector(".aipkit_tts_elevenlabs_voice_inline");vt&&(vt.style.display="none");let Kt=Ue.querySelector(".aipkit_tts_elevenlabs_model_inline");Kt&&(Kt.style.display="none")}B("tts",z);let De=Ue.querySelector(".aipkit_realtime_voice_settings_container"),ut=Ue.querySelector(".aipkit_realtime_voice_inline_controls"),Ct=Ue.querySelector(".aipkit_realtime_voice_inline_row"),qi=De&&De.getAttribute("data-force-visible")==="1"?!0:X;if(De&&(De.style.display=qi?"block":"none"),Ct&&(Ct.style.display=qi?"block":"none"),ut&&(ut.style.display=qi?"flex":"none"),Ue.querySelectorAll(".aipkit_rt_dependent").forEach(pt=>{pt.style.display=qi?"":"none"}),B("realtime",X),Ue.classList.contains("is-open")){let pt=String(Ue.dataset.activeAudioFeature||"").trim().toLowerCase();if(pt&&!(pt==="stt"&&U||pt==="tts"&&z||pt==="realtime"&&X)){Ue.classList.remove("is-open"),Ue.setAttribute("aria-hidden","true"),delete Ue.dataset.activeAudioFeature,Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null);let Xt=Ue.querySelector("#aipkit_builder_audio_settings_title");Xt&&Xt.dataset.defaultTitle&&(Xt.textContent=Xt.dataset.defaultTitle)}}oo(),Eo()};function Kn(){if(!R)return;let I=en&&en.classList.contains("is-open")||cn&&cn.classList.contains("is-open")||dn&&dn.classList.contains("is-open")||Zi&&Zi.classList.contains("is-open")||Nn&&Nn.classList.contains("is-open")||!!e.querySelector("[data-aipkit-interface-controls-dropdown].is-open");R.classList.toggle("aipkit_settings_accordion--allow-overflow",I)}let ya=()=>{!ao||!Ui||(ao.setAttribute("aria-expanded","false"),Ui.hidden=!0,en.classList.remove("is-open"),Kn())},Qo=()=>{!to||!ma||!cn||(to.setAttribute("aria-expanded","false"),ma.hidden=!0,cn.classList.remove("is-open"),Kn())},va=()=>{!ro||!jo||!Zi||(ro.setAttribute("aria-expanded","false"),jo.hidden=!0,Zi.classList.remove("is-open"),Kn())},ba=()=>{!Gn||!Nn||(Gn.setAttribute("aria-expanded","false"),Nn.hidden=!0,Nn.classList.remove("is-open"),Kn())},Br=()=>{if(!Pi||!Fi||!Ln.length)return;let I=Ln.find(B=>{let U=B.getAttribute("data-theme-value")||B.value||"",z=B.getAttribute("data-preset-key")||"";return U==="custom"&&z===""}),T=!!(I&&!I.disabled);Pi.hidden=!T,Pi.disabled=!T,Pi.setAttribute("aria-disabled",T?"false":"true"),!T&&ki===Pi&&Jo()},Lr=()=>{if(!Ha||!Fi)return;let I=Fi.selectedOptions&&Fi.selectedOptions.length?Fi.selectedOptions[0]:null,T=I&&I.textContent?I.textContent.trim():"",B=(Fi.value||"")==="custom"?Sn():"";Ha.textContent=B||T||cn.dataset.placeholder||"Select theme",Br()},Fr=I=>{!vo||vo.disabled||(vo.value=I||"")},$r=(I,T)=>{if((I||"")!=="custom"){Fr("");return}Fr(T||"")},Yr=()=>{if($r("custom",""),e.querySelectorAll(".aipkit_custom_theme_preset").forEach(I=>{I.classList.remove("is-selected"),I.setAttribute("aria-pressed","false")}),Fi&&!Fi.disabled&&Fi.value==="custom"){let I=Array.from(Fi.options||[]).findIndex(T=>(T.value||"")==="custom"&&!(T.dataset&&T.dataset.presetKey));I>=0&&Fi.selectedIndex!==I&&(Fi.selectedIndex=I)}if(Ln.length){let I=Ln.find(T=>{let B=T.getAttribute("data-theme-value")||T.value||"",U=T.getAttribute("data-preset-key")||"";return B==="custom"&&U===""});I&&(I.checked=!0)}Lr()},gr=()=>{if(!Fi||!Ln.length){Lr();return}let I=Fi.selectedOptions&&Fi.selectedOptions.length?Fi.selectedOptions[0]:null,T=Fi.value||"",B=I&&I.dataset&&I.dataset.presetKey?I.dataset.presetKey:"",U=!1;if(Ln.forEach(K=>{let V=K.getAttribute("data-theme-value")||K.value||"",Y=K.getAttribute("data-preset-key")||"",ne=V===T&&Y===B;K.checked=ne,ne&&(U=!0)}),!U&&T){let K=Ln.find(V=>(V.getAttribute("data-theme-value")||V.value||"")===T);K&&(K.checked=!0)}let z=Ln.find(K=>K.checked),X=z?z.getAttribute("data-theme-value")||z.value||"":T,ie=z?z.getAttribute("data-preset-key")||"":B;$r(X,ie),Lr()},Or=I=>{if(!I||!Fi)return;let T=I.getAttribute("data-theme-value")||I.value||"",B=I.getAttribute("data-preset-key")||"";if(!T)return;let U=-1,z=Array.from(Fi.options||[]);if(z.forEach((ie,K)=>{if(U!==-1||(ie.value||"")!==T)return;(ie.dataset&&ie.dataset.presetKey?ie.dataset.presetKey:"")===B&&(U=K)}),U===-1&&(U=z.findIndex(ie=>(ie.value||"")===T)),U<0||!z[U])return;let X=Fi.selectedIndex!==U;Fi.selectedIndex=U,X?Fi.dispatchEvent(new Event("change",{bubbles:!0})):gr()},Nr=()=>{if(!ur||!tn)return;let I=tn.selectedOptions&&tn.selectedOptions.length?tn.selectedOptions[0]:null,T=I&&I.textContent?I.textContent.trim():"";ur.textContent=T||Zi.dataset.placeholder||"Select model"},kr=()=>{if(!tn||!ga.length){Nr();return}let I=tn.value||"",T=!1;if(ga.forEach(B=>{let U=B.value===I;B.checked=U,U&&(T=!0)}),!T&&I){let B=ga.find(U=>U.value===I);B&&(B.checked=!0)}Nr()},Xr=I=>{if(!I||!tn)return;let T=I.value||"";if(!T)return;let U=Array.from(tn.options||[]).findIndex(X=>(X.value||"")===T);if(U<0){let X=new Option(T,T,!0,!0);tn.add(X),U=tn.options.length-1}let z=tn.selectedIndex!==U;tn.selectedIndex=U,z?tn.dispatchEvent(new Event("change",{bubbles:!0})):kr()},wr=()=>{if(!$o)return;let I=[],T=Gt(sn.popup_position),B=Gt(sn.popup_icon_style),U=Gt(sn.popup_icon_size);T&&I.push(T),B&&I.push(B),U&&I.push(U),$o.textContent=I.length>0?I.join(" \u2022 "):en.dataset.placeholder||"Position, style, size"},hr=()=>{if(!vn.length){wr();return}vn.forEach(I=>{let T=I.getAttribute("data-target-name");!T||!sn[T]||(I.checked=sn[T].value===I.value)}),wr()},Zr=I=>{if(!I)return;let T=I.getAttribute("data-target-name");if(!T)return;let B=sn[T];if(!(!B||B.disabled)){if(B.value===I.value){wr();return}B.value=I.value,B.dispatchEvent(new Event("change",{bubbles:!0})),wr()}},Qa=()=>{if(!zi)return;let I=ut=>{let Ct=zi.querySelector(ut);if(!Ct)return;let Ft=(Ct.getAttribute("data-default-url")||"").trim();if(!Ft)return;let qi=(Ct.value||"").trim(),pt=qi.toLowerCase();(!qi||(pt==="spark"||pt==="chat-bubble"||pt==="openai"||pt==="plus"||pt==="question-mark"))&&(Ct.value=Ft)},T=zi.querySelector('input[name="popup_icon_default"]:checked'),B=T&&T.value==="__custom__"?"custom":"default",U=zi.querySelector(".aipkit_popup_icon_custom_input_container");U&&(B==="custom"?(U.removeAttribute("hidden"),I('[name="popup_icon_custom_url"]')):U.setAttribute("hidden",""));let z=zi.querySelector('[name="popup_icon_type"]');z&&z.value!==B&&(z.value=B);let X=zi.querySelector('input[name="header_avatar_default"]:checked'),ie=X&&X.value==="__custom__"?"custom":"default",K=zi.querySelector(".aipkit_header_avatar_custom_input_container");K&&(ie==="custom"?(K.removeAttribute("hidden"),I('[name="header_avatar_url"]')):K.setAttribute("hidden",""));let V=zi.querySelector('[name="header_avatar_type"]');V&&V.value!==ie&&(V.value=ie);let Y=zi.querySelector('select[name="popup_icon_style"]');if(Y){let ut=zi.querySelectorAll('input[name="popup_icon_style"]');ut.length&&ut.forEach(Ct=>{Ct.checked=Ct.value===Y.value})}let ne=e.querySelector(".aipkit_popup_hint_toggle_switch"),de=ne?ne.checked:!1;e.querySelectorAll(".aipkit_popup_hint_config_btn").forEach(ut=>{ut.hidden=!de,de||ut.setAttribute("aria-expanded","false")}),!de&&Ee&&Ee.classList.contains("is-open")&&yr();let De=Ee||zi;if(De){De.querySelectorAll(".aipkit_popup_hint_extra").forEach(Ct=>{de?Ct.removeAttribute("hidden"):Ct.setAttribute("hidden","")});let ut=De.querySelector(".aipkit_popup_hint_conditional_row");ut&&(de?ut.removeAttribute("hidden"):ut.setAttribute("hidden",""))}hr()},yr=()=>{Ee&&(Ee.classList.remove("is-open"),Ee.setAttribute("aria-hidden","true"),Ne&&(Ne.setAttribute("aria-expanded","false"),Ne=null))},Rr=()=>{Be&&(Be.classList.remove("is-open"),Be.setAttribute("aria-hidden","true"),ii&&(ii.setAttribute("aria-expanded","false"),ii=null))},Dr=()=>{let I=Rt||Be;if(!I)return;let T=I.querySelector('[name="enable_consent_compliance"]'),B=T?T.tagName==="SELECT"?T.value==="1":T.checked:!1;I.querySelectorAll(".aipkit_consent_field_row").forEach(U=>{B?U.removeAttribute("hidden"):U.setAttribute("hidden","")}),O&&O.classList.contains("aipkit-active")&&Ge&&requestAnimationFrame(()=>{bo(Ge)})},Wr=()=>{let I=Rt||Be;if(!I)return;let T=I.querySelector('[name="openai_moderation_enabled"]'),B=T?T.tagName==="SELECT"?T.value==="1":T.checked:!1;I.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(U=>{B?U.removeAttribute("hidden"):U.setAttribute("hidden","")}),O&&O.classList.contains("aipkit-active")&&Ge&&requestAnimationFrame(()=>{bo(Ge)})},qr=()=>{let I=Rt||Be;if(!I)return;let T=e.querySelector(".aipkit_chatbot_provider_select"),U=(T?T.value:"")==="OpenAI";if(I.querySelectorAll(".aipkit_openai_moderation_row").forEach(X=>{X.style.display=U?"":"none"}),U){Wr();return}I.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(X=>{X.setAttribute("hidden","")})},Ir=()=>{ft&&(ft.classList.remove("is-open"),ft.setAttribute("aria-hidden","true"),Li&&(Li.setAttribute("aria-expanded","false"),Li=null))},Jo=()=>{Tt&&(Tt.classList.remove("is-open"),Tt.setAttribute("aria-hidden","true"),ki&&(ki.setAttribute("aria-expanded","false"),ki=null))},Hr=I=>{if(!Tt||!I)return;Tt.classList.contains("is-open")||(Tt.classList.add("is-open"),Tt.setAttribute("aria-hidden","false")),ki&&ki!==I&&ki.setAttribute("aria-expanded","false"),I.setAttribute&&I.setAttribute("aria-expanded","true"),ki=I,window.requestAnimationFrame(()=>{za(I)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_custom_theme_flyout")},Ja=I=>{if(!I)return;let T=I.querySelector(".aipkit_reasoning_effort_slider"),B=I.querySelector(".aipkit_reasoning_effort_label"),U=I.querySelector('input[name="reasoning_effort"]');if(!T||!B||!U)return;let z=()=>{let X=[],ie=[];try{T.dataset.reasoningValues&&(X=JSON.parse(T.dataset.reasoningValues)),T.dataset.reasoningLabels&&(ie=JSON.parse(T.dataset.reasoningLabels))}catch{X=[],ie=[]}(!Array.isArray(X)||X.length===0)&&(X=["none","low","medium","high","xhigh"]),(!Array.isArray(ie)||ie.length===0)&&(ie=X.slice());let K=parseInt(T.value,10),V=Number.isNaN(K)?0:Math.min(X.length-1,Math.max(0,K)),Y=X[V]||X[0],ne=ie[V]||Y;U.value=Y,B.textContent=ne};z(),T.dataset.reasoningBound||(T.addEventListener("input",z),T.addEventListener("change",z),T.dataset.reasoningBound="1")},Yo=()=>{if(!D)return;let I=()=>{let De=D.querySelector(".aipkit_behavior_compact_row");if(!De)return;if(window.innerWidth<=960){De.style.gridTemplateColumns="";return}let ut=Array.from(De.querySelectorAll(".aipkit_behavior_compact_cell")).filter(Ft=>!Ft||Ft.hidden?!1:window.getComputedStyle(Ft).display!=="none"),Ct=Math.max(1,ut.length);De.style.gridTemplateColumns=`repeat(${Ct}, minmax(0, 1fr))`},T=e.querySelector(".aipkit_chatbot_provider_select"),B=T?T.value:"",U=B==="OpenAI",z=Jt(),X=xa("image_input"),ie=B==="OpenAI"||B==="Claude"||B==="OpenRouter"&&X,K=D.querySelector(".aipkit_stateful_convo_checkbox"),V=D.querySelector(".aipkit_stateful_convo_group");K&&(K.disabled=!U),V&&(V.style.display=U?"":"none",V.removeAttribute("title"));let Y=D&&D.querySelector(".aipkit_reasoning_effort_field")||re&&re.querySelector(".aipkit_reasoning_effort_field");Y&&(Y.style.display=z?"":"none"),be();let ne=D&&D.querySelector(".aipkit_image_analysis_popover_row")||j&&j.querySelector(".aipkit_image_analysis_popover_row");if(ne&&(ne.style.display=ie?"":"none"),B==="OpenRouter"&&!X){let De=j&&j.querySelector(".aipkit_image_analysis_select")||D&&D.querySelector(".aipkit_image_analysis_select")||F.querySelector(".aipkit_image_analysis_select"),ut=j&&j.querySelector(".aipkit_image_analysis_checkbox")||D&&D.querySelector(".aipkit_image_analysis_checkbox")||F.querySelector(".aipkit_image_analysis_checkbox");De&&De.value!=="0"?(De.value="0",De.dispatchEvent(new Event("change",{bubbles:!0}))):ut&&ut.checked&&(ut.checked=!1,ut.dispatchEvent(new Event("change",{bubbles:!0})))}oo(),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(re||D),I(),window.requestAnimationFrame(I);let de=D.querySelector(".aipkit_model_settings_panel:not([hidden])"),we=de?de.querySelector(".aipkit_popover_options_list"):D.querySelector(".aipkit_popover_options_list");if(we){let De=we.querySelectorAll(".aipkit_popover_option_row");De.forEach(Ct=>Ct.classList.remove("aipkit_last_visible_row"));let ut=null;De.forEach(Ct=>{Ct.style.display!=="none"&&(ut=Ct)}),ut&&ut.classList.add("aipkit_last_visible_row")}O&&O.classList.contains("aipkit-active")&&Ge&&bo(Ge),e.dataset.behaviorCompactLayoutBound||(window.addEventListener("resize",I),e.dataset.behaviorCompactLayoutBound="1")};if(e.dataset.shortcodeCopyBound||(e.addEventListener("click",I=>{let T=I.target.closest(".aipkit_shortcode_pill");if(!T)return;let B=T.dataset.shortcode||T.querySelector(".aipkit_shortcode_text")?.textContent||"";B&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(B,T)}),e.dataset.shortcodeCopyBound="1"),e.dataset.embedCopyBound||(e.addEventListener("click",I=>{let T=I.target.closest(".aipkit_copy_embed_code_btn");if(!T)return;let B=T.dataset.target;if(!B)return;let U=document.getElementById(B);if(!U)return;let z=U.value||U.textContent||"";z&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(z,T)}),e.dataset.embedCopyBound="1"),R&&!e.dataset.accordionBound){let I=Array.from(R.querySelectorAll(".aipkit_accordion_section")),T=z=>{if(!z)return;let X=z.querySelector(".aipkit_accordion_header"),ie=z.querySelector(".aipkit_accordion_body");!X||!ie||(X.setAttribute("aria-expanded","false"),ie.hidden=!0)},B=(z,X)=>{if(!z)return;let ie=z.querySelector(".aipkit_accordion_header"),K=z.querySelector(".aipkit_accordion_body");if(!(!ie||!K)&&(ie.setAttribute("aria-expanded","true"),K.hidden=!1,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),X==="rules"&&typeof window.aipkit_initTriggerBuilderUI=="function")){let V=v&&v.value||e.getAttribute("data-active-bot-id");V&&V!=="__new__"&&window.aipkit_initTriggerBuilderUI(V)}};I.forEach(z=>{let X=z.querySelector(".aipkit_accordion_header"),ie=z.querySelector(".aipkit_accordion_body");if(!X||!ie)return;let K=z.getAttribute("data-aipkit-accordion")||"";X.setAttribute("aria-expanded","false"),ie.hidden=!0,!(K==="rules"&&X.classList.contains("aipkit_builder_sheet_trigger"))&&X.addEventListener("click",()=>{if(X.getAttribute("aria-expanded")==="true"){T(z),s("");return}I.forEach(Y=>{Y!==z&&T(Y)}),B(z,K),s(K)})});let U=a();if(U&&U!=="rules"){let z=I.find(X=>(X.getAttribute("data-aipkit-accordion")||"")===U);z&&!z.hidden?B(z,U):s("")}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_accordion"),Ja(R),io(),Yo(),nn(),e.dataset.accordionBound="1"}if(O&&!Z&&e.querySelectorAll(".aipkit_cb_ai_settings_toggle").forEach(T=>{T.classList.add("aipkit_model_settings_popover_trigger"),T.setAttribute("aria-haspopup","dialog"),T.setAttribute("aria-expanded","false"),T.setAttribute("aria-controls","aipkit_model_settings_popover"),T.setAttribute("aria-label",Ga),T.setAttribute("title",Ga)}),M&&v&&!e.dataset.botTabsBound&&(M.addEventListener("click",I=>{let T=I.target.closest(".aipkit_builder_bot_tab");if(!T)return;gi();let B=String(T.dataset.botId||"");if(!B||B===String(v.value||"")){Hi(v.value||"");return}v.value=B,v.dispatchEvent(new Event("change",{bubbles:!0}))}),W&&H&&(W.addEventListener("click",I=>{if(I.preventDefault(),W.hidden)return;if(W.getAttribute("aria-expanded")==="true"){gi();return}ji(),H.hidden=!1,W.setAttribute("aria-expanded","true");let B=H.querySelector(".aipkit_builder_bot_overflow_search_input");B&&typeof B.focus=="function"&&window.requestAnimationFrame(()=>{B.focus(),typeof B.select=="function"&&B.select()})}),H.addEventListener("click",I=>{let T=I.target.closest(".aipkit_builder_bot_overflow_item");if(!T)return;let B=String(T.dataset.botId||"");if(!B){gi();return}B!==String(v.value||"")?(v.value=B,v.dispatchEvent(new Event("change",{bubbles:!0}))):Hi(B),gi()}),H.addEventListener("input",I=>{let T=I.target.closest(".aipkit_builder_bot_overflow_search_input");T&&ti(T.value||"")}),document.addEventListener("click",I=>{!H||H.hidden||!$||I.target.closest(".aipkit_builder_bot_overflow")||gi()}),document.addEventListener("keydown",I=>{I.key==="Escape"&&gi()})),typeof ResizeObserver=="function"?(J=new ResizeObserver(()=>{pi()}),J.observe(M)):window.addEventListener("resize",pi),e.dataset.botTabsBound="1"),v){let I=v.value||"";Hi(I),v.addEventListener("change",async()=>{let T=v.value;if(!T){Hi(I);return}if(T==="__new__"){typeof G=="function"&&G();let U=I||e.getAttribute("data-active-bot-id")||"";if(U)v.value=U;else{let z=Array.from(v.options).find(X=>X.value&&X.value!=="__new__"&&!X.disabled);z&&(v.value=z.value,I=z.value)}Hi(v.value||I);return}I=T,Hi(T);try{localStorage.setItem(k,T)}catch(U){console.warn("AIPKit Chat Builder: Failed to store selected chatbot:",U)}let B=!1;try{B=await Mn(T)}catch{B=!1}!B&&typeof window.aipkit_loadModule=="function"&&(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),window.aipkit_loadModule("chatbot",{force_active_bot_id:T,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}))}),Vo()}if((A||v)&&!e.dataset.newBotActionBound){let I=!1;G=()=>{if(I||typeof window.aipkit_apiRequest!="function")return;let T=t("New Chatbot","gpt3-ai-content-generator");I=!0,A&&(A.disabled=!0),ot(t("Creating chatbot...","gpt3-ai-content-generator"),""),window.aipkit_apiRequest("aipkit_create_chatbot",{bot_name:T}).then(B=>{let U=B&&B.bot_id?String(B.bot_id):"";if(!U)throw new Error(t("Chatbot created but no bot ID was returned.","gpt3-ai-content-generator"));try{localStorage.setItem(k,U)}catch{}ot(B.message||t("Chatbot created successfully.","gpt3-ai-content-generator"),"success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:U,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(U),Oi()}).catch(B=>{ot(`Error: ${B.message||t("Failed to create chatbot.","gpt3-ai-content-generator")}`,"error"),Oi()}).finally(()=>{I=!1,A&&(A.disabled=!1)})},A&&A.addEventListener("click",G),e.dataset.newBotActionBound="1"}if(F&&!e.dataset.sheetBound){let I=B=>{if(!F)return;O&&O.classList.contains("aipkit-active")&&So();let U=B.dataset.sheetTitle||"Sheet",z=B.dataset.sheetDescription||"Settings will appear here.",X=B.dataset.sheetContent||"placeholder";if(_t&&(_t.textContent=U),mt&&(mt.textContent=z),Nt.length){let ie=!1;Nt.forEach(K=>{let V=K.dataset.sheet===X;K.hidden=!V,V&&(ie=!0)}),!ie&&Ie&&(Ie.hidden=!1)}if(Wn&&(Wn.textContent="",Wn.classList.remove("success","error","loading"),Wn.style.display="none"),F.classList.add("aipkit-active"),F.setAttribute("aria-hidden","false"),qt&&qt.focus(),X==="sources"&&typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(),X==="triggers"&&typeof window.aipkit_initTriggerBuilderUI=="function"){let ie=v&&v.value||e.getAttribute("data-active-bot-id");ie&&ie!=="__new__"&&window.aipkit_initTriggerBuilderUI(ie)}typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_sheet"),io(),Pn(),Yo(),Qa()},T=()=>{F.classList.remove("aipkit-active"),F.setAttribute("aria-hidden","true")};e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_builder_sheet_trigger");U&&(B.preventDefault(),U.closest('[data-aipkit-accordion="rules"]')&&s(""),I(U))}),qt&&qt.addEventListener("click",T),F.addEventListener("click",B=>{B.target===F&&T()}),document.addEventListener("keydown",B=>{B.key==="Escape"&&F.classList.contains("aipkit-active")&&T()}),e.dataset.sheetBound="1"}if(D&&!e.dataset.modelPopoverBound){O&&(e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_model_settings_popover_trigger");if(U){if(B.preventDefault(),B.stopPropagation(),O.classList.contains("aipkit-active")&&Ge===U){So();return}fr(U)}}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_style_settings_trigger");if(!U)return;B.preventDefault(),B.stopPropagation();let z=U.dataset.aipkitPanelTarget||"appearance";ka(z)})),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_popover_params_config_btn");if(!U||(B.preventDefault(),!re))return;let z=!re.classList.contains("is-open");re.classList.toggle("is-open",z),re.setAttribute("aria-hidden",z?"false":"true"),Te&&Te!==U&&Te.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),Te=z?U:null,z&&(window.requestAnimationFrame(()=>{_r(U)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_parameters_flyout"),Ja(re),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(re))}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_image_settings_config_btn");if(!U||(B.preventDefault(),!j))return;let z=!j.classList.contains("is-open");j.classList.toggle("is-open",z),j.setAttribute("aria-hidden",z?"false":"true"),ce&&ce!==U&&ce.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),ce=z?U:null,z&&(window.requestAnimationFrame(()=>{so(U)}),Ua())}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_popup_hint_config_btn");if(!U||(B.preventDefault(),!Ee))return;let z=!Ee.classList.contains("is-open");Ee.classList.toggle("is-open",z),Ee.setAttribute("aria-hidden",z?"false":"true"),Ne&&Ne!==U&&Ne.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),Ne=z?U:null,z&&window.requestAnimationFrame(()=>{zo(U)})}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_starters_config_btn");if(!U||(B.preventDefault(),!ft))return;let z=!ft.classList.contains("is-open");ft.classList.toggle("is-open",z),ft.setAttribute("aria-hidden",z?"false":"true"),Li&&Li!==U&&Li.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),Li=z?U:null,z&&window.requestAnimationFrame(()=>{Ka(U)})}),e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_security_privacy_config_btn");if(!U||(B.preventDefault(),!Be))return;let z=!Be.classList.contains("is-open");Be.classList.toggle("is-open",z),Be.setAttribute("aria-hidden",z?"false":"true"),ii&&ii!==U&&ii.setAttribute("aria-expanded","false"),U.setAttribute("aria-expanded",z?"true":"false"),ii=z?U:null,z&&(window.requestAnimationFrame(()=>{ja(U)}),Dr(),qr())});let I=()=>{j&&(j.classList.remove("is-open"),j.setAttribute("aria-hidden","true"),ce&&(ce.setAttribute("aria-expanded","false"),ce=null))};te&&te.addEventListener("click",B=>{B.preventDefault(),I()}),Re&&Re.addEventListener("click",B=>{B.preventDefault(),yr()}),dt&&dt.addEventListener("click",B=>{B.preventDefault(),Rr()}),Xi&&Xi.addEventListener("click",B=>{B.preventDefault(),Ir()}),_i&&_i.addEventListener("click",B=>{B.preventDefault(),Jo()}),document.addEventListener("click",B=>{!j||!j.classList.contains("is-open")||B.target.closest(".aipkit_image_settings_config_btn")||B.target.closest("#aipkit_image_settings_flyout")||I()}),document.addEventListener("click",B=>{!Ee||!Ee.classList.contains("is-open")||B.target.closest(".aipkit_popup_hint_config_btn")||B.target.closest("#aipkit_popup_hint_flyout")||yr()}),document.addEventListener("click",B=>{!Be||!Be.classList.contains("is-open")||B.target.closest(".aipkit_security_privacy_config_btn")||B.target.closest("#aipkit_security_privacy_flyout")||Rr()}),document.addEventListener("click",B=>{!ft||!ft.classList.contains("is-open")||B.target.closest(".aipkit_starters_config_btn")||B.target.closest("#aipkit_starters_flyout")||Ir()}),document.addEventListener("click",B=>{!Tt||!Tt.classList.contains("is-open")||B.target.closest(".aipkit_theme_config_btn")||B.target.closest("[data-aipkit-theme-dropdown]")||B.target.closest('select[name="theme"]')||B.target.closest(".aipkit_builder_theme_select")||B.target.closest(".aipkit_theme_choice_group")||B.target.closest("#aipkit_custom_theme_flyout")||Jo()});let T=()=>{re&&(re.classList.remove("is-open"),re.setAttribute("aria-hidden","true"),Te&&(Te.setAttribute("aria-expanded","false"),Te=null))};if(ge&&ge.addEventListener("click",B=>{B.preventDefault(),T()}),document.addEventListener("click",B=>{!re||!re.classList.contains("is-open")||B.target.closest(".aipkit_popover_params_config_btn")||B.target.closest("#aipkit_parameters_flyout")||T()}),Q&&Q.addEventListener("click",So),Ae&&Ae.addEventListener("click",()=>{ka("root")}),O&&O.addEventListener("click",B=>{B.target===O&&So()}),document.addEventListener("keydown",B=>{B.key==="Escape"&&O&&O.classList.contains("aipkit-active")&&So()}),D&&!D.dataset.footerActionsBound){let B=e.getAttribute("data-default-bot-id")||"",U=!1,z=K=>{D.querySelectorAll(".aipkit_popover_footer_btn").forEach(Y=>{Y.disabled=!!K})},X=()=>{let K=Array.from(v&&v.options||[]).map(Y=>String(Y&&Y.value||"").trim()).filter(Y=>Y&&Y!=="__new__"),V=[v?String(v.value||"").trim():"",String(e.getAttribute("data-active-bot-id")||"").trim(),String((e.querySelector("form.aipkit_chatbot_settings_form")||{}).dataset?.botId||"").trim(),String((e.querySelector(".aipkit_builder_bot_tab.is-active[data-bot-id]")||{}).dataset?.botId||"").trim()];for(let Y of V)if(!(!Y||Y==="__new__")&&/^\d+$/.test(Y)&&(!K.length||K.includes(Y)))return Y;return K[0]||""},ie=K=>{let V=String(K||""),Y=Array.from(v&&v.options||[]).map(de=>String(de&&de.value||"")).filter(de=>de&&de!=="__new__");if(!Y.length)return"";let ne=Y.indexOf(V);if(ne===-1)return B&&String(B)!==V?String(B):Y[0]||"";for(let de=ne-1;de>=0;de-=1){let we=Y[de];if(we&&we!==V)return we}for(let de=ne+1;de<Y.length;de+=1){let we=Y[de];if(we&&we!==V)return we}return B&&String(B)!==V?String(B):""};D.addEventListener("click",K=>{let V=K.target.closest(".aipkit_popover_footer_btn");if(!V||(K.preventDefault(),U))return;let Y=V.getAttribute("data-action"),ne=X();if(!Y||!ne||typeof window.aipkit_apiRequest!="function"){Y&&typeof window.aipkit_apiRequest=="function"&&(ot(t("Error: Invalid chatbot selected.","gpt3-ai-content-generator"),"error"),Oi());return}if(Y==="delete"){if(V.disabled||ne===B)return;let de=ie(ne);U=!0,z(!0),ot("Deleting...",""),window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:ne}).then(we=>{ot(we.message||"Deleted","success");try{de?localStorage.setItem(k,de):localStorage.removeItem(k)}catch{}if(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"){let De=String(de||B||""),ut={layout:f,aipkit_silent:!0,aipkit_force_refresh:!0};De&&De!==String(ne)?ut.force_active_bot_id=De:ut.force_active_tab="create",window.aipkit_loadModule("chatbot",ut)}else if(typeof window.aipkit_refreshChatPreview=="function"){let De=String(de||B||"");window.aipkit_refreshChatPreview(De||ne)}Oi()}).catch(we=>{ot(`Error: ${we.message||"Failed to delete."}`,"error"),Oi()}).finally(()=>{U=!1,z(!1)});return}if(Y==="duplicate"){U=!0,z(!0),ot("Duplicating...",""),window.aipkit_apiRequest("aipkit_duplicate_chatbot",{bot_id:ne}).then(de=>{let we=String(de&&de.bot_id||"");if(ot(de.message||"Duplicated","success"),we)try{localStorage.setItem(k,we)}catch{}typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:we||ne,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(we||ne),Oi()}).catch(de=>{ot(`Error: ${de.message||"Failed to duplicate."}`,"error"),Oi()}).finally(()=>{U=!1,z(!1)});return}Y==="reset"&&(U=!0,z(!0),ot("Resetting...",""),window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:ne}).then(de=>{ot(de.message||"Saved","success"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:ne,layout:f,aipkit_silent:!0,aipkit_force_refresh:!0}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ne),Oi()}).catch(de=>{ot(`Error: ${de.message||"Failed to reset."}`,"error"),Oi()}).finally(()=>{U=!1,z(!1)}))}),D.dataset.footerActionsBound="1"}window.addEventListener("resize",()=>{O&&O.classList.contains("aipkit-active")&&Ge&&bo(Ge),Pt&&Pt.classList.contains("is-open")&&Ti&&No(Ti),Ut&&Ut.classList.contains("is-open")&&un&&Ro(un),Ei&&Ei.classList.contains("is-open")&&_n&&wa(_n),Ue&&Ue.classList.contains("is-open")&&Vi&&ha(Vi),j&&j.classList.contains("is-open")&&ce&&so(ce),Ee&&Ee.classList.contains("is-open")&&Ne&&zo(Ne),Be&&Be.classList.contains("is-open")&&ii&&ja(ii),ft&&ft.classList.contains("is-open")&&Li&&Ka(Li),Tt&&Tt.classList.contains("is-open")&&ki&&za(ki)}),window.addEventListener("scroll",()=>{O&&O.classList.contains("aipkit-active")&&Ge&&bo(Ge),Pt&&Pt.classList.contains("is-open")&&Ti&&No(Ti),Ut&&Ut.classList.contains("is-open")&&un&&Ro(un),Ei&&Ei.classList.contains("is-open")&&_n&&wa(_n),Ue&&Ue.classList.contains("is-open")&&Vi&&ha(Vi),j&&j.classList.contains("is-open")&&ce&&so(ce),Ee&&Ee.classList.contains("is-open")&&Ne&&zo(Ne),Be&&Be.classList.contains("is-open")&&ii&&ja(ii),ft&&ft.classList.contains("is-open")&&Li&&Ka(Li),Tt&&Tt.classList.contains("is-open")&&ki&&za(ki)},!0),e.dataset.modelPopoverBound="1"}if(xt&&$i&&!xt.dataset.autosaveBound){let I=xt.value,T=!1,B=null,U=V=>{Ye&&(Ye.textContent=`${V.length.toLocaleString()} characters`)},z=V=>{ze&&(ze.value=V,U(V))},X=V=>{let Y=v&&v.value||e.getAttribute("data-active-bot-id");Y&&(T=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_instructions",{bot_id:Y,instructions:V}).then(ne=>{I=V,xt.dataset.dirty="0",ot(ne.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Y),Oi()}).catch(ne=>{ot(`Error: ${ne.message||"Failed to save."}`,"error"),xt.dataset.dirty="1"}).finally(()=>{if(T=!1,B!==null&&B!==I){let ne=B;B=null,X(ne)}else B=null}))},ie=()=>{!gt||!ze||(z(xt.value),gt.classList.add("aipkit-active"),gt.setAttribute("aria-hidden","false"),setTimeout(()=>ze.focus(),0))},K=V=>{if(!gt||(gt.classList.remove("aipkit-active"),gt.setAttribute("aria-hidden","true"),!V||!ze))return;let Y=ze.value;if(Y!==xt.value&&(xt.value=Y,xt.dataset.dirty="1"),xt.dataset.dirty==="1"){if(T){B=xt.value;return}X(xt.value)}};ze&&!ze.dataset.bound&&(ze.addEventListener("input",()=>{U(ze.value),xt.dataset.dirty="1"}),ze.dataset.bound="1"),gt&&!gt.dataset.bound&&(bi&&bi.addEventListener("click",ie),It&&It.addEventListener("click",()=>{K(!0)}),document.addEventListener("keydown",V=>{V.key==="Escape"&&gt.classList.contains("aipkit-active")&&K(!0)}),gt.dataset.bound="1"),xt.addEventListener("input",()=>{xt.dataset.dirty="1"}),xt.addEventListener("blur",()=>{let V=xt.value;if(xt.dataset.dirty==="1"){if(V===I){xt.dataset.dirty="0";return}if(T){B=V;return}X(V)}}),xt.dataset.autosaveBound="1"}if(Go){let I=Go.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]"),T=U=>{U&&(I.forEach(z=>{let X=z.dataset.aipkitTab===U;z.classList.toggle("is-active",X),z.setAttribute("aria-selected",X?"true":"false")}),na.forEach(z=>{let X=z.dataset.aipkitPanel===U;z.classList.toggle("is-active",X),z.hidden=!X}),Rn&&(Rn.style.display=U==="files"?"none":""),Aa&&Aa.classList.toggle("aipkit_builder_action_row--end",U==="files"))},B=Go.querySelector(".aipkit_builder_tab.is-active");B&&T(B.dataset.aipkitTab),I.forEach(U=>{U.addEventListener("click",()=>{T(U.dataset.aipkitTab)})})}let co=e.querySelector('textarea[name="triggers_json"]'),Ya=e.querySelector(".aipkit_trigger_builder_container"),Wn=e.querySelector(".aipkit_triggers_status");if((co||Ya)&&$i&&!e.dataset.triggersAutosaveBound){let I=co?co.value:"[]",T=!1,B=null,U=null,z=()=>{let de=v&&v.value||e.getAttribute("data-active-bot-id");if(!de)return null;let we="";if(typeof window.aipkit_getTriggerBuilderState=="function"){let De=window.aipkit_getTriggerBuilderState(de);De&&Array.isArray(De.triggers)&&(typeof window.aipkit_updateTriggersJsonForSave=="function"&&window.aipkit_updateTriggersJsonForSave(de,De.triggers),we=co?co.value:JSON.stringify(De.triggers,null,2))}return!we&&co&&(we=co.value),we||(we="[]"),{botId:de,triggersJson:we}},X=(de,we)=>{Wn&&(Wn.textContent=de||"",Wn.classList.remove("success","error","loading"),we&&Wn.classList.add(we),Wn.style.display=de?"inline-block":"none")},ie=()=>{Wn&&setTimeout(()=>{Wn.textContent="",Wn.classList.remove("success","error","loading"),Wn.style.display="none"},2500)},K=(de,we)=>{we&&(T=!0,ot("Auto-saving...",""),X("Saving...","loading"),window.aipkit_apiRequest("aipkit_update_chatbot_triggers",{bot_id:we,triggers_json:de}).then(De=>{I=de,ot(De.message||"Saved","success"),X("Saved","success"),Oi(),ie()}).catch(De=>{ot(`Error: ${De.message||"Failed to save."}`,"error"),X("Error","error"),ie()}).finally(()=>{if(T=!1,B!==null&&B!==I){let De=B;B=null;let ut=z();ut&&K(De,ut.botId)}else B=null}))},V=de=>{if(de===I)return;if(T){B=de;return}let we=z();we&&K(de,we.botId)},Y=()=>{U&&clearTimeout(U),U=setTimeout(()=>{let de=z();de&&V(de.triggersJson)},900)};typeof window.aipkit_requestTriggerAutosave!="function"&&(window.aipkit_requestTriggerAutosave=Y);let ne=de=>{de.target&&de.target.closest(".aipkit_trigger_builder_container")&&Y()};Ya&&(Ya.addEventListener("input",ne),Ya.addEventListener("change",ne),Ya.addEventListener("click",ne)),co&&(co.addEventListener("input",Y),co.addEventListener("blur",Y)),e.dataset.triggersAutosaveBound="1"}if(Pt&&!Pt.dataset.bound){let I=Pt.querySelector("#aipkit_builder_web_settings_title"),T=I?I.textContent.trim():t("Web search","gpt3-ai-content-generator"),B={openai:t("Web options (OpenAI)","gpt3-ai-content-generator"),google:t("Web options (Google)","gpt3-ai-content-generator"),claude:t("Web options (Claude)","gpt3-ai-content-generator"),openrouter:t("Web options (OpenRouter)","gpt3-ai-content-generator")},U=(ie="")=>{if(!I)return;let K=String(ie||"").trim().toLowerCase();I.textContent=B[K]||T},z=ie=>{if(!Pt||!ie)return;let K=String(ie.dataset.webProvider||"").trim().toLowerCase();Pt.dataset.activeWebProvider=K,U(K),Pt.classList.add("is-open"),Pt.setAttribute("aria-hidden","false"),ie.setAttribute("aria-expanded","true"),Ti=ie,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_web_settings_modal"),io(),window.requestAnimationFrame(()=>{No(ie)})},X=()=>{Pt.classList.remove("is-open"),Pt.setAttribute("aria-hidden","true"),delete Pt.dataset.activeWebProvider,U(""),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null)};e.addEventListener("click",ie=>{let K=ie.target.closest(".aipkit_web_search_config_btn");if(K){if(ie.preventDefault(),Pt.classList.contains("is-open")&&Ti===K){X();return}z(K)}}),Tn&&Tn.addEventListener("click",X),document.addEventListener("click",ie=>{Pt.classList.contains("is-open")&&(ie.target.closest(".aipkit_web_search_config_btn")||ie.target.closest("#aipkit_builder_web_settings_modal")||X())}),document.addEventListener("keydown",ie=>{ie.key==="Escape"&&Pt.classList.contains("is-open")&&X()}),Pt.dataset.bound="1"}if(Ut&&!Ut.dataset.bound){let I=B=>{!Ut||!B||(Ut.classList.add("is-open"),Ut.setAttribute("aria-hidden","false"),B.setAttribute("aria-expanded","true"),un=B,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_context_settings_modal"),oi(),window.requestAnimationFrame(()=>{Ro(B)}))},T=()=>{Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true"),un&&(un.setAttribute("aria-expanded","false"),un=null)};e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_vector_store_config_btn");if(U){if(B.preventDefault(),Ut.classList.contains("is-open")&&un===U){T();return}I(U)}}),Na&&Na.addEventListener("click",T),document.addEventListener("click",B=>{Ut.classList.contains("is-open")&&(B.target.closest(".aipkit_vector_store_config_btn")||B.target.closest("#aipkit_builder_context_settings_modal")||T())}),document.addEventListener("keydown",B=>{B.key==="Escape"&&Ut.classList.contains("is-open")&&T()}),Ut.dataset.bound="1"}if(Ei&&!Ei.dataset.bound){let I=B=>{!Ei||!B||(Ei.classList.add("is-open"),Ei.setAttribute("aria-hidden","false"),B.setAttribute("aria-expanded","true"),_n=B,Gi(),window.requestAnimationFrame(()=>{wa(B)}))},T=()=>{Ei.classList.remove("is-open"),Ei.setAttribute("aria-hidden","true"),_n&&(_n.setAttribute("aria-expanded","false"),_n=null)};e.addEventListener("click",B=>{let U=B.target.closest(".aipkit_limit_usage_config_btn");if(U){if(B.preventDefault(),Ei.classList.contains("is-open")&&_n===U){T();return}I(U)}}),Da&&Da.addEventListener("click",T),document.addEventListener("click",B=>{Ei.classList.contains("is-open")&&(B.target.closest(".aipkit_limit_usage_config_btn")||B.target.closest("#aipkit_builder_token_limits_modal")||T())}),document.addEventListener("keydown",B=>{B.key==="Escape"&&Ei.classList.contains("is-open")&&T()}),Ei.dataset.bound="1"}if(Ue&&!Ue.dataset.bound){let I=Ue.querySelector("#aipkit_builder_audio_settings_title"),T=I?I.textContent.trim():t("Audio","gpt3-ai-content-generator");I&&!I.dataset.defaultTitle&&(I.dataset.defaultTitle=T);let B={stt:t("Speech to Text options","gpt3-ai-content-generator"),tts:t("Text to Speech options","gpt3-ai-content-generator"),realtime:t("Realtime voice options","gpt3-ai-content-generator")},U=(ie="")=>{if(!I)return;let K=String(ie||"").trim().toLowerCase();I.textContent=B[K]||T},z=ie=>{if(!Ue||!ie)return;let K=String(ie.dataset.audioFeature||"").trim().toLowerCase();Ue.dataset.activeAudioFeature=K,U(K),Ue.classList.add("is-open"),Ue.setAttribute("aria-hidden","false"),ie.setAttribute("aria-expanded","true"),Vi=ie,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_audio_settings_modal"),Pn(),typeof window.aipkit_syncAudioTtsOnOpen=="function"&&window.aipkit_syncAudioTtsOnOpen().catch(()=>{}),window.requestAnimationFrame(()=>{ha(ie)})},X=()=>{Ue.classList.remove("is-open"),Ue.setAttribute("aria-hidden","true"),delete Ue.dataset.activeAudioFeature,U(""),Vi&&(Vi.setAttribute("aria-expanded","false"),Vi=null)};e.addEventListener("click",ie=>{let K=ie.target.closest(".aipkit_audio_settings_config_btn");if(K){if(ie.preventDefault(),Ue.classList.contains("is-open")&&Vi===K){X();return}z(K)}}),Wa&&Wa.addEventListener("click",X),document.addEventListener("click",ie=>{Ue.classList.contains("is-open")&&(ie.target.closest(".aipkit_audio_settings_config_btn")||ie.target.closest("#aipkit_builder_audio_settings_modal")||X())}),document.addEventListener("keydown",ie=>{ie.key==="Escape"&&Ue.classList.contains("is-open")&&X()}),Ue.dataset.bound="1"}if(Wt&&$i&&!Wt.dataset.autosaveBound){let I=Wt.value.trim(),T=!1,B=null,U=X=>{if(!v)return;let ie=v.options[v.selectedIndex];ie&&(ie.text=X),Hi(v.value||"")},z=X=>{let ie=v&&v.value||e.getAttribute("data-active-bot-id");ie&&(T=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:ie,new_name:X}).then(K=>{let V=(K.new_name||X).trim();I=V,Wt.value=V,U(V),ot("Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ie),Oi()}).catch(K=>{ot(`Error: ${K.message||"Failed to save."}`,"error")}).finally(()=>{if(T=!1,B!==null&&B!==I){let K=B;B=null,z(K)}else B=null}))};Wt.addEventListener("keydown",X=>{X.key==="Enter"&&(X.preventDefault(),Wt.blur())}),Wt.addEventListener("blur",()=>{let X=Wt.value.trim();if(!X){Wt.value=I,ot("Name cannot be empty.","error");return}if(X!==I){if(T){B=X;return}z(X)}}),Wt.dataset.autosaveBound="1"}if($i&&!e.dataset.modelAutosaveBound){let I=e.querySelector(".aipkit_chatbot_provider_select");if(I){let T=!1,B=null,U=V=>{if(!V)return"";let Y=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${V}"]`);if(!Y)return"";let ne=Y.querySelector("select");return ne?ne.value:""},z=I.value||"",X=U(z),ie=(V,Y)=>{let ne=v&&v.value||e.getAttribute("data-active-bot-id");ne&&(T=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_model_settings",{bot_id:ne,provider:V,model:Y}).then(de=>{if(z=V,X=Y,ot(de.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(ne),Oi(),typeof window.aipkit_requestChatbotModelSync=="function"){let we=I?I.value||"":V,De=U(we);we===V&&De===Y&&window.aipkit_requestChatbotModelSync(V,{silent:!0})}}).catch(de=>{ot(`Error: ${de.message||"Failed to save."}`,"error")}).finally(()=>{if(T=!1,B){let{provider:de,model:we}=B;B=null,(de!==z||we!==X)&&ie(de,we)}}))},K=(V,Y)=>{if(!(V===z&&Y===X)){if(T){B={provider:V,model:Y};return}ie(V,Y)}};e.addEventListener("change",V=>{let Y=V.target;if(!Y)return;if(Y.matches(".aipkit_chatbot_provider_select")){let de=Y.value||"",we=U(de);K(de,we),O&&O.classList.contains("aipkit-active")&&So(),io(),Yo(),qr(),ni(),ct();return}let ne=Y.closest(".aipkit_chatbot_model_field select");if(ne){let de=I.value||"",we=ne.value||"";K(de,we),io(),Yo()}})}e.dataset.modelAutosaveBound="1"}if($i&&!e.dataset.deployWizardBound){let I=e.querySelector("[data-aipkit-top-mode-select]"),T=e.querySelector('textarea[name="embed_allowed_domains"]'),B=e.querySelector("[data-aipkit-appearance-popup-select]"),U=e.querySelector('select[name="aipkit_deploy_popup_scope"]'),z=Array.from(e.querySelectorAll("[data-aipkit-popup-options]")),X=Array.from(e.querySelectorAll(".aipkit_interface_popup_scope_row")),ie=e.querySelector("[data-aipkit-popup-launcher-cell]"),K=ie?ie.closest(".aipkit_interface_theme_top_row--primary"):null;if(I||B||U||z.length){let V=pe=>pe==="popup"||pe==="external"?pe:"inline",Y=()=>B?B.value==="1"?"popup":"inline":z.some(pe=>!pe.hidden)?"popup":"inline",ne=()=>I?V(I.value):Y(),de=()=>U&&U.value==="sitewide"?"sitewide":"page",we=pe=>{let Ke=e.querySelector(".aipkit_sidebar_toggle_group");if(!Ke)return;let me=Ke.querySelector(".aipkit_sidebar_toggle_switch"),he=Ke.querySelector(".aipkit_interface_toggle_label");if(!me)return;let tt=Ke.getAttribute("data-tooltip-disabled")||"";if(pe){if(me.getAttribute("data-original-state")===null){let wt=me.tagName==="SELECT"?me.value==="1"?"checked":"unchecked":me.checked?"checked":"unchecked";me.setAttribute("data-original-state",wt)}me.tagName==="SELECT"?me.value="0":me.checked=!1,me.disabled=!0,Ke.setAttribute("title",tt),me.setAttribute("title",tt),he&&he.setAttribute("title",tt),Ke.classList.add("aipkit-disabled-tooltip"),he&&(he.style.opacity="0.6")}else me.disabled=!1,Ke.removeAttribute("title"),me.removeAttribute("title"),he&&he.removeAttribute("title"),Ke.classList.remove("aipkit-disabled-tooltip"),he&&(he.style.opacity="1"),me.getAttribute("data-original-state")==="checked"&&(me.tagName==="SELECT"?me.value="1":me.checked=!0),me.removeAttribute("data-original-state")},De=pe=>{let Ke=O||F;if(!Ke)return;let me=Ke.querySelectorAll('[data-popup-only="header-identity"]');me.length&&me.forEach(he=>{he.hidden=!pe})},ut=pe=>{let Ke=e.querySelector(".aipkit_popup_status_text_group");if(!Ke)return;let me=Ke.querySelector('input[name="header_online_text"]');if(!me)return;let he=Ke.querySelector(".aipkit_popover_option_label"),tt=Ke.getAttribute("data-tooltip-disabled")||"";if(pe){me.disabled=!1,Ke.removeAttribute("title"),me.removeAttribute("title"),he&&he.removeAttribute("title"),Ke.classList.remove("aipkit-disabled-tooltip");return}me.disabled=!0,tt&&(Ke.setAttribute("title",tt),me.setAttribute("title",tt),he&&he.setAttribute("title",tt)),Ke.classList.add("aipkit-disabled-tooltip")},Ct=pe=>{ie&&(ie.hidden=!pe,ie.setAttribute("aria-hidden",pe?"false":"true"),K&&K.classList.toggle("aipkit_interface_theme_top_row--no-launcher",!pe),pe||ya())},Ft=()=>{let pe=ne(),Ke=pe==="popup";B&&pe!=="external"&&(B.value=pe==="popup"?"1":"0"),z.forEach(me=>{if(me.hidden=!Ke,!Ke){let he=me.querySelector(".aipkit_accordion_header"),tt=me.querySelector(".aipkit_accordion_body");he&&tt&&(he.setAttribute("aria-expanded","false"),tt.hidden=!0),(me.getAttribute("data-aipkit-accordion")||"")==="popup"&&a()==="popup"&&s("")}}),X.forEach(me=>{me.hidden=!Ke}),U&&(U.disabled=!Ke),we(Ke),De(Ke),ut(Ke),Ct(Ke),Ee&&Ee.classList.contains("is-open")&&(Ke&&Ne?window.requestAnimationFrame(()=>{zo(Ne)}):yr())},qi=()=>{if(!rn)return;rn.classList.add("aipkit-active"),rn.setAttribute("aria-hidden","false");let pe=rn.querySelector('textarea[name="embed_allowed_domains"]')||rn.querySelector(".aipkit_copy_embed_code_btn");pe&&typeof pe.focus=="function"&&window.setTimeout(()=>pe.focus(),0)},pt=()=>{rn&&(rn.classList.remove("aipkit-active"),rn.setAttribute("aria-hidden","true"))},yi=null,Xt=!1,vt=null,Kt=()=>{let pe=ne(),Ke=Y(),he=(pe==="external"?Ke:pe)==="popup"?"1":"0",tt=he==="1"&&de()==="sitewide"?"1":"0",wt={popup_enabled:he,site_wide_enabled:tt};return T&&(wt.embed_allowed_domains=T.value||""),wt};yi=Kt();let st=pe=>{let Ke=v&&v.value||e.getAttribute("data-active-bot-id");if(!Ke||!pe)return;Xt=!0,ot("Auto-saving...","");let me={bot_id:Ke,popup_enabled:pe.popup_enabled,site_wide_enabled:pe.site_wide_enabled};Object.prototype.hasOwnProperty.call(pe,"embed_allowed_domains")&&(me.embed_allowed_domains=pe.embed_allowed_domains),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",me).then(he=>{yi=pe,ot(he.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Ke),Oi()}).catch(he=>{ot(`Error: ${he.message||"Failed to save."}`,"error")}).finally(()=>{if(Xt=!1,vt){let he=vt;vt=null,(!yi||JSON.stringify(he)!==JSON.stringify(yi))&&st(he)}})},ke=pe=>{if(pe&&!(yi&&JSON.stringify(pe)===JSON.stringify(yi))){if(Xt){vt=pe;return}st(pe)}};if(I&&I.addEventListener("change",()=>{I.value=V(I.value),B&&I.value!=="external"&&(B.value=I.value==="popup"?"1":"0"),I.value==="external"?qi():pt(),Ft(),ke(Kt())}),B&&B.addEventListener("change",()=>{B.value=B.value==="1"?"1":"0",I&&I.value!=="external"&&(I.value=B.value==="1"?"popup":"inline"),Ft(),ke(Kt())}),U&&U.addEventListener("change",()=>{U.value=U.value==="sitewide"?"sitewide":"page",Ft(),ke(Kt())}),T){let pe=null,Ke=()=>{pe&&clearTimeout(pe),pe=setTimeout(()=>{ke(Kt())},350)};T.addEventListener("input",Ke),T.addEventListener("change",()=>{pe&&(clearTimeout(pe),pe=null),ke(Kt())}),T.addEventListener("blur",()=>{pe&&(clearTimeout(pe),pe=null),ke(Kt())})}rn&&rn.dataset.bound!=="1"&&(fa&&fa.addEventListener("click",pt),dr&&dr.addEventListener("click",pt),rn.addEventListener("click",pe=>{pe.target===rn&&pt()}),document.addEventListener("keydown",pe=>{pe.key==="Escape"&&rn.classList.contains("aipkit-active")&&pt()}),rn.dataset.bound="1"),Ft(),e.dataset.deployWizardBound="1"}}if(D&&$i&&!e.dataset.aiParamsAutosaveBound){let I=!1,T=null,B=()=>{let Y=De=>re&&re.querySelector(De)||D.querySelector(De),ne=Y('[name="temperature"]'),de=Y('[name="max_completion_tokens"]'),we=Y('[name="max_messages"]');return{temperature:ne?ne.value:"",maxTokens:de?de.value:"",maxMessages:we?we.value:""}},{temperature:U,maxTokens:z,maxMessages:X}=B(),ie=(Y,ne,de)=>{let we=v&&v.value||e.getAttribute("data-active-bot-id");!we||Y===""||ne===""||de===""||(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_ai_parameters",{bot_id:we,temperature:Y,max_completion_tokens:ne,max_messages:de}).then(De=>{U=Y,z=ne,X=de,ot(De.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(we),Oi()}).catch(De=>{ot(`Error: ${De.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T){let{temperature:De,maxTokens:ut,maxMessages:Ct}=T;T=null,(De!==U||ut!==z||Ct!==X)&&ie(De,ut,Ct)}}))},K=(Y,ne,de)=>{if(!(Y===U&&ne===z&&de===X)){if(I){T={temperature:Y,maxTokens:ne,maxMessages:de};return}ie(Y,ne,de)}},V=Y=>{let ne=Y.target;if(ne&&(ne.matches('[name="temperature"]')||ne.matches('[name="max_completion_tokens"]')||ne.matches('[name="max_messages"]'))){let{temperature:de,maxTokens:we,maxMessages:De}=B();K(de,we,De)}};D.addEventListener("change",V),re&&re.addEventListener("change",V),e.dataset.aiParamsAutosaveBound="1"}if((Pt||D)&&$i&&!e.dataset.webSettingsAutosaveBound){let I=!1,T=null,B=()=>{let K=Y=>{let ne=Pt?Pt.querySelector(Y):null;return ne?ne.value:""},V=Y=>{let ne=D&&D.querySelector(Y)||e&&e.querySelector(Y)||Pt&&Pt.querySelector(Y);return ne?ne.tagName==="SELECT"?ne.value==="1"?"1":"0":ne.checked?"1":"0":"0"};return{openai_web_search_enabled:V(".aipkit_openai_web_search_enable_toggle"),openai_web_search_context_size:K('[name="openai_web_search_context_size"]'),openai_web_search_loc_type:K('[name="openai_web_search_loc_type"]'),openai_web_search_loc_country:K('[name="openai_web_search_loc_country"]'),openai_web_search_loc_city:K('[name="openai_web_search_loc_city"]'),openai_web_search_loc_region:K('[name="openai_web_search_loc_region"]'),openai_web_search_loc_timezone:K('[name="openai_web_search_loc_timezone"]'),claude_web_search_enabled:V(".aipkit_claude_web_search_enable_toggle"),claude_web_search_max_uses:K('[name="claude_web_search_max_uses"]'),claude_web_search_loc_type:K('[name="claude_web_search_loc_type"]'),claude_web_search_loc_country:K('[name="claude_web_search_loc_country"]'),claude_web_search_loc_city:K('[name="claude_web_search_loc_city"]'),claude_web_search_loc_region:K('[name="claude_web_search_loc_region"]'),claude_web_search_loc_timezone:K('[name="claude_web_search_loc_timezone"]'),claude_web_search_allowed_domains:K('[name="claude_web_search_allowed_domains"]'),claude_web_search_blocked_domains:K('[name="claude_web_search_blocked_domains"]'),claude_web_search_cache_ttl:K('[name="claude_web_search_cache_ttl"]'),openrouter_web_search_enabled:V(".aipkit_openrouter_web_search_enable_toggle"),openrouter_web_search_engine:K('[name="openrouter_web_search_engine"]'),openrouter_web_search_max_results:K('[name="openrouter_web_search_max_results"]'),openrouter_web_search_search_prompt:K('[name="openrouter_web_search_search_prompt"]'),google_search_grounding_enabled:V(".aipkit_google_search_grounding_enable_toggle"),web_toggle_default_on:V(".aipkit_web_toggle_default_on"),google_grounding_mode:K('[name="google_grounding_mode"]'),google_grounding_dynamic_threshold:K('[name="google_grounding_dynamic_threshold"]')}},U=B(),z=K=>{let V=v&&v.value||e.getAttribute("data-active-bot-id");V&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_web_settings",{bot_id:V,...K}).then(Y=>{U=K,ot(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T){let Y=T;T=null,JSON.stringify(Y)!==JSON.stringify(U)&&z(Y)}}))},X=K=>{if(JSON.stringify(K)!==JSON.stringify(U)){if(I){T=K;return}z(K)}},ie=K=>{let V=K.target;V&&(V.matches(".aipkit_openai_web_search_enable_toggle")||V.matches(".aipkit_openai_web_search_loc_type_select")||V.matches('[name="openai_web_search_context_size"]')||V.matches('[name="openai_web_search_loc_country"]')||V.matches('[name="openai_web_search_loc_city"]')||V.matches('[name="openai_web_search_loc_region"]')||V.matches('[name="openai_web_search_loc_timezone"]')||V.matches(".aipkit_claude_web_search_enable_toggle")||V.matches(".aipkit_claude_web_search_loc_type_select")||V.matches('[name="claude_web_search_max_uses"]')||V.matches('[name="claude_web_search_loc_country"]')||V.matches('[name="claude_web_search_loc_city"]')||V.matches('[name="claude_web_search_loc_region"]')||V.matches('[name="claude_web_search_loc_timezone"]')||V.matches('[name="claude_web_search_allowed_domains"]')||V.matches('[name="claude_web_search_blocked_domains"]')||V.matches('[name="claude_web_search_cache_ttl"]')||V.matches(".aipkit_openrouter_web_search_enable_toggle")||V.matches('[name="openrouter_web_search_engine"]')||V.matches('[name="openrouter_web_search_max_results"]')||V.matches('[name="openrouter_web_search_search_prompt"]')||V.matches(".aipkit_google_search_grounding_enable_toggle")||V.matches(".aipkit_web_toggle_default_on")||V.matches(".aipkit_google_grounding_mode_select")||V.matches('[name="google_grounding_dynamic_threshold"]'))&&(io(),X(B()))};D&&D.addEventListener("change",ie),Pt&&(!D||!D.contains(Pt))&&Pt.addEventListener("change",ie),e.dataset.webSettingsAutosaveBound="1"}if((Ut||D)&&$i&&!e.dataset.contextSettingsAutosaveBound){let I=!1,T=null,B=()=>{let ee=ue=>{let ve=ye(),qe=ve?ve.querySelector(ue):null;return qe?qe.value:""},oe=ue=>{let ve=D&&D.querySelector(ue)||e&&e.querySelector(ue)||Ut&&Ut.querySelector(ue);return ve?ve.tagName==="SELECT"?ve.value==="1"?"1":"0":ve.checked?"1":"0":"0"},se=ue=>{let ve=ye(),qe=ve?ve.querySelector(ue):null;return qe?Array.from(qe.selectedOptions).map(Se=>Se.value).filter(Boolean):[]};return{enable_vector_store:oe(".aipkit_vector_store_enable_select"),vector_store_provider:ee('[name="vector_store_provider"]'),openai_vector_store_ids:se('select[name="openai_vector_store_ids[]"]'),pinecone_index_name:ee('[name="pinecone_index_name"]'),qdrant_collection_names:se('select[name="qdrant_collection_names[]"]'),vector_embedding_provider:ee('[name="vector_embedding_provider"]'),vector_embedding_model:ee('[name="vector_embedding_model"]'),vector_store_top_k:ee('[name="vector_store_top_k"]'),vector_store_confidence_threshold:ee('[name="vector_store_confidence_threshold"]'),content_aware_enabled:oe(".aipkit_content_aware_enable_select")}},U=B(),z=D&&D.closest(".aipkit_model_settings_popover")?.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline")||Ut&&Ut.querySelector(".aipkit_popover_flyout_header .aipkit_popover_status_inline")||Ut&&Ut.querySelector(".aipkit_popover_status_inline")||D&&D.querySelector(".aipkit_popover_status_inline")||null,X=(ee,oe)=>{z&&(z.textContent=ee||"",z.classList.remove("success","error","loading"),oe&&z.classList.add(oe),z.style.display=ee?"inline-block":"none")},ie=()=>{z&&setTimeout(()=>{z.textContent="",z.classList.remove("success","error","loading"),z.style.display="none"},2500)},K=!1,V=null,Y={},ne=ye();ne&&ne.querySelectorAll('[name="pinecone_api_key"], [name="qdrant_url"], [name="qdrant_api_key"]').forEach(ee=>{Y[ee.name]=ee.value});let de=()=>{let{pineconeKeyInput:ee,qdrantUrlInput:oe,qdrantKeyInput:se}=nt(),ue=!!(ee&&ee.value.trim()||m),ve=!!(oe&&oe.value.trim()||w),qe=!!(se&&se.value.trim()||u);return{pinecone:ue,qdrant:ve&&qe}},we=0,De=(ee,oe)=>ee?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(ee,{silent:!0,showErrors:!1,targetSelectId:oe,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,ee,{silent:!0,showErrors:!1,targetSelectId:oe,propagateError:!0}):null:null,ut=(ee,oe)=>{let se=++we;X("Syncing...","loading");let ue=De(ee,oe);if(ue&&typeof ue.then=="function"){ue.then(()=>{we===se&&(X("Synced","success"),ie())}).catch(ve=>{we===se&&X(`Error: ${ve.message||"Sync failed."}`,"error")});return}ie()},Ct=ee=>{let oe=de();if(ee==="pinecone"&&oe.pinecone){let{pineconeIndexSelect:se}=nt();ut("PineconeIndexes",se?se.id:"")}else if(ee==="qdrant"&&oe.qdrant){let{qdrantCollectionsSelect:se}=nt();ut("QdrantCollections",se?se.id:"")}},Ft=ee=>{!ee||!Object.keys(ee).length||(K=!0,X("Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",ee).then(oe=>{Object.keys(ee).forEach(se=>{Y[se]=ee[se]}),Object.prototype.hasOwnProperty.call(ee,"pinecone_api_key")&&Ct("pinecone"),(Object.prototype.hasOwnProperty.call(ee,"qdrant_url")||Object.prototype.hasOwnProperty.call(ee,"qdrant_api_key"))&&Ct("qdrant"),X(oe.message||"Saved","success"),ie()}).catch(oe=>{X(`Error: ${oe.message||"Failed to save."}`,"error")}).finally(()=>{if(K=!1,V){let oe=V;V=null,Ft(oe)}}))},qi=ee=>{if(!ee)return;let oe=Object.keys(ee).reduce((se,ue)=>(ee[ue]!==Y[ue]&&(se[ue]=ee[ue]),se),{});if(Object.keys(oe).length){if(K){V={...V||{},...oe};return}Ft(oe)}},pt=ee=>{let oe=v&&v.value||e.getAttribute("data-active-bot-id");oe&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_context_settings",{bot_id:oe,...ee}).then(se=>{U=ee,ot(se.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(oe),Oi()}).catch(se=>{ot(`Error: ${se.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T){let se=T;T=null,JSON.stringify(se)!==JSON.stringify(U)&&pt(se)}}))},yi=ee=>{if(JSON.stringify(ee)!==JSON.stringify(U)){if(I){T=ee;return}pt(ee)}},Xt=ee=>{let oe=ee.target;if(oe){if(oe.matches('[name="pinecone_api_key"]')||oe.matches('[name="qdrant_url"]')||oe.matches('[name="qdrant_api_key"]')){let se=oe.value||"";qi({[oe.name]:se}),ct(),qn(B());return}if(oe.matches(".aipkit_vector_store_enable_select")||oe.matches(".aipkit_vector_store_provider_select")||oe.matches('select[name="openai_vector_store_ids[]"]')||oe.matches('select[name="qdrant_collection_names[]"]')||oe.matches('[name="pinecone_index_name"]')||oe.matches(".aipkit_vector_embedding_select")||oe.matches('[name="vector_embedding_provider"]')||oe.matches('[name="vector_embedding_model"]')||oe.matches('[name="vector_store_top_k"]')||oe.matches('[name="vector_store_confidence_threshold"]')||oe.matches('[name="content_aware_enabled"]')){if(oe.matches(".aipkit_vector_embedding_select")&&rs(oe),oe.matches(".aipkit_vector_store_enable_select")&&(nn(),Ct(B().vector_store_provider)),oe.matches(".aipkit_vector_store_provider_select")&&(oi(),Ct(oe.value||""),ni(),ct()),oe.matches('[name="vector_embedding_provider"]')){let ue=ye();ue&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(ue),Pr(ue)}if(oe.matches('[name="vector_embedding_model"]')){let ue=ye();Pr(ue)}let se=B();yi(se),ct(),qn(se),ke(se),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(1)}}};D&&D.addEventListener("change",Xt),Ut&&Ut.addEventListener("change",Xt);let vt=(ee,oe)=>{Fn&&(Fn.textContent=ee||"",Fn.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ee&&Fn.classList.add("is-visible"),oe&&Fn.classList.add(`is-${oe}`))},Kt=(ee=2500)=>{Fn&&setTimeout(()=>{Fn.textContent="",Fn.classList.remove("is-visible","is-success","is-error","is-warning","is-loading")},ee)},st=(ee,oe="info")=>{if(Un){if(typeof window.aipkit_showOpenAIVectorStatus=="function"){window.aipkit_showOpenAIVectorStatus(ee||"",oe,Un.id);return}Un.textContent=ee||""}},ke=(ee=null)=>{if(!pn)return;let oe=ee||B();if(!oe||oe.enable_vector_store!=="1"){pn.innerHTML='<option value=""></option>',pn.value="";return}let se="";oe.vector_store_provider==="openai"?se=(Array.isArray(oe.openai_vector_store_ids)?oe.openai_vector_store_ids.filter(Boolean):[])[0]||"":oe.vector_store_provider==="pinecone"?se=oe.pinecone_index_name||"":oe.vector_store_provider==="qdrant"&&(se=(Array.isArray(oe.qdrant_collection_names)?oe.qdrant_collection_names.filter(Boolean):[])[0]||""),pn.innerHTML=se?`<option value="${se}">${se}</option>`:'<option value=""></option>',pn.value=se,pn.dispatchEvent(new Event("change"))},pe=()=>$n&&$n.value||"bulk",Ke=ee=>{let oe=ee==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",se=document.getElementById(oe);return se?Array.from(se.selectedOptions).map(ue=>ue.value).filter(Boolean):[]},me=ee=>{let oe=ee==="specific"?Mo:Po;return oe&&oe.value||"publish"},he=()=>{let ee=document.getElementById("aipkit_vs_wp_content_list_area");return ee?Array.from(ee.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(oe=>oe.value):[]},tt=(ee,oe,se)=>{if(!oe)return;oe.innerHTML="";let ue=Number(ee?.total_posts||0),ve=Number(ee?.total_pages||0),qe=Number(ee?.current_page||1);if(!ue)return;let Se=document.createElement("span");if(Se.className="aipkit_pagination-count",Se.textContent=`${ue.toLocaleString()} ${d("item","items",ue,"gpt3-ai-content-generator")}`,oe.appendChild(Se),ve<=1)return;let Je=document.createElement("span");Je.className="aipkit_pagination-links";let lt=document.createElement("button");lt.type="button",lt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",lt.textContent=t("Prev","gpt3-ai-content-generator"),lt.disabled=qe<=1,lt.addEventListener("click",()=>se(qe-1));let wi=document.createElement("span");wi.className="aipkit_pagination-current",wi.textContent=`${qe}/${ve}`;let $t=document.createElement("button");$t.type="button",$t.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",$t.textContent=t("Next","gpt3-ai-content-generator"),$t.disabled=qe>=ve,$t.addEventListener("click",()=>se(qe+1)),Je.appendChild(lt),Je.appendChild(wi),Je.appendChild($t),oe.appendChild(Je)},wt=(ee,oe)=>{if(!Dn)return;if(Dn.innerHTML="",!Array.isArray(ee)||!ee.length){let Se=document.createElement("p");Se.className="aipkit_builder_help_text",Se.textContent=t("No posts found for selection.","gpt3-ai-content-generator"),Dn.appendChild(Se),sa&&(sa.innerHTML="");return}let se=document.createElement("ul"),ue=document.createElement("div");ue.className="aipkit_wp_content_select_all_wrapper";let ve=document.createElement("label");ve.className="aipkit_training_site_option";let qe=document.createElement("input");qe.type="checkbox",qe.checked=ee.every(Se=>an.selectedIds.has(String(Se.id))),ve.appendChild(qe),ve.appendChild(document.createTextNode(t("Select all","gpt3-ai-content-generator"))),ue.appendChild(ve),Dn.appendChild(ue),Dn.appendChild(se),ee.forEach(Se=>{let Je=document.createElement("li");Je.className="aipkit_wp_content_list_item";let lt=document.createElement("input");lt.type="checkbox",lt.name="wp_content_to_index[]",lt.value=String(Se.id),lt.checked=an.selectedIds.has(String(Se.id)),lt.addEventListener("change",()=>{lt.checked?an.selectedIds.add(String(Se.id)):an.selectedIds.delete(String(Se.id)),qe.checked=ee.every(wn=>an.selectedIds.has(String(wn.id)))});let wi=document.createElement("a");wi.className="aipkit_wp_content_title",wi.href=Se.edit_link||"#",wi.target="_blank",wi.rel="noopener noreferrer",wi.textContent=Se.title||t("Untitled","gpt3-ai-content-generator");let $t=document.createElement("span");$t.className="aipkit_wp_content_type",$t.textContent=Se.type_label||"";let vi=document.createElement("span");vi.className="aipkit_wp_content_indexed_status",vi.textContent=Se.is_already_indexed?t("Indexed","gpt3-ai-content-generator"):"",Je.appendChild(lt),Je.appendChild(wi),Je.appendChild($t),Je.appendChild(vi),se.appendChild(Je)}),qe.addEventListener("change",()=>{qe.checked?ee.forEach(Se=>an.selectedIds.add(String(Se.id))):ee.forEach(Se=>an.selectedIds.delete(String(Se.id))),Dn.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(Se=>{Se.checked=qe.checked})}),tt(oe,sa,ai)},ai=async ee=>{if(!Dn)return;let oe=pe(),se=Ke(oe);if(!se.length){Dn.innerHTML="",sa&&(sa.innerHTML=""),st(t("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let ue=Ri("aipkit_wp_content_fetch_nonce");if(!ue){st(t("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let ve=me(oe),qe=pn&&pn.value||"";try{st(t("Loading content...","gpt3-ai-content-generator"),"");let Se=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ue,post_types:se,post_status:ve,target_store_id:qe,paged:ee});an.page=ee,wt(Se.posts||[],Se.pagination||{}),st("","")}catch(Se){st(Se&&Se.message?Se.message:t("Failed to load content.","gpt3-ai-content-generator"),"error")}},Zt=ee=>{$n&&($n.value=ee),Fo&&(Fo.hidden=ee!=="bulk"),nr&&(nr.hidden=ee!=="specific"),ir&&(ir.hidden=ee!=="specific"),da&&(da.hidden=ee!=="bulk"),sr&&(sr.hidden=ee!=="specific"),Yt&&(Yt.hidden=ee!=="bulk"),ee==="specific"&&ai(1)},ri=()=>{e.querySelectorAll(".aipkit_training_site_dropdown").forEach(oe=>{let se=oe.querySelector(".aipkit_training_site_dropdown_btn"),ue=oe.querySelector(".aipkit_training_site_dropdown_label"),ve=oe.querySelector(".aipkit_training_site_dropdown_panel"),Se=oe.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Je=document.getElementById(Se);if(!se||!ve||!Je)return;let lt=()=>{let $t=ve.querySelectorAll('input[type="checkbox"]:checked'),vi=oe.dataset.placeholder||t("Select types","gpt3-ai-content-generator"),wn=oe.dataset.selectedLabel||t("selected","gpt3-ai-content-generator");ue&&($t.length?ue.textContent=`${$t.length} ${wn}`:ue.textContent=vi)},wi=()=>{let $t=Array.from(ve.querySelectorAll('input[type="checkbox"]:checked')).map(vi=>vi.value);Array.from(Je.options).forEach(vi=>{vi.selected=$t.includes(vi.value)})};se.addEventListener("click",()=>{let $t=se.getAttribute("aria-expanded")==="true";se.setAttribute("aria-expanded",$t?"false":"true"),ve.hidden=$t}),ve.addEventListener("change",()=>{wi(),lt(),pe()==="specific"&&ai(1)}),document.addEventListener("click",$t=>{oe.contains($t.target)||(se.setAttribute("aria-expanded","false"),ve.hidden=!0)}),wi(),lt()})},Qt=async(ee,oe,se)=>{let ue=Ri("aipkit_wp_content_fetch_nonce");if(!ue||!ee.length)return{total:0};let ve=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ue,post_types:ee,post_status:oe,target_store_id:se||"",paged:1}),qe=parseInt(ve?.pagination?.total_posts||0,10);return{total:Number.isNaN(qe)?0:qe,totalPages:parseInt(ve?.pagination?.total_pages||1,10)}},Mi=async(ee,oe,se)=>{let ue=Ri("aipkit_wp_content_fetch_nonce");if(!ue)throw new Error("WP content fetch nonce missing.");let ve=[],qe=1,Se=1;do{let Je=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ue,post_types:ee,post_status:oe,target_store_id:se||"",paged:qe}),lt=Array.isArray(Je?.posts)?Je.posts:[];lt.length&&(window.aipkit_wpContentTitleMap=window.aipkit_wpContentTitleMap||{},lt.forEach($t=>{$t&&$t.id&&(window.aipkit_wpContentTitleMap[String($t.id)]=$t.title||window.aipkit_wpContentTitleMap[String($t.id)]||"")})),ve.push(...lt.map($t=>String($t.id)));let wi=parseInt(Je?.pagination?.total_pages||1,10);Se=Number.isNaN(wi)?1:wi,st(`Preparing... collected ${ve.length} item(s).`,"info"),qe+=1}while(qe<=Se);return ve},Ci=(ee,oe)=>ee<=200||oe!=="publish"?Promise.resolve(!1):new Promise(se=>{let ue=document.getElementById("aipkit_background_indexing_confirm"),ve=document.getElementById("aipkit_background_indexing_message"),qe=document.getElementById("aipkit_background_indexing_yes"),Se=document.getElementById("aipkit_background_indexing_no"),Je=document.getElementById("aipkit_wp_content_bulk_hint");if(!ue||!ve||!qe||!Se){se(window.confirm(`You're about to index ${ee} items. Run in the background?`));return}ve.textContent=`You're about to index ${ee} items. Run in the background?`,Je&&(Je.hidden=!0),ue.hidden=!1;let lt=()=>{ue.hidden=!0,Je&&(Je.hidden=!1),qe.removeEventListener("click",wi),Se.removeEventListener("click",$t)},wi=()=>{lt(),se(!0)},$t=()=>{lt(),se(!1)};qe.addEventListener("click",wi),Se.addEventListener("click",$t)}),Yi=async({botId:ee,postTypes:oe,provider:se,targetStoreId:ue,embeddingProvider:ve,embeddingModel:qe})=>{let Se=window.aipkit_chat_config?.automationsNonce||"";if(!Se)throw new Error("Automations nonce missing.");let Je=`Chatbot ${ee} website indexing`,lt={_ajax_nonce:Se,task_id:0,task_name:Je,task_type:"content_indexing",task_status:"active",task_frequency:"one-time",index_existing_now_flag:"1",only_new_updated_flag:"0",post_types:oe,target_store_provider:se,target_store_id:ue};return(se==="pinecone"||se==="qdrant")&&(lt.embedding_provider=ve||"",lt.embedding_model=qe||""),window.aipkit_apiRequest("aipkit_save_automated_task",lt)};if($n&&!e.dataset.trainingWebsiteBound){if(typeof window.aipkit_initWpContentModeToggle=="function"&&window.aipkit_initWpContentModeToggle(),Xn&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&!Xn.dataset.listenerAttached&&(Xn.addEventListener("click",()=>{window.aipkit_fetchWordPressContentForTraining(1)}),Xn.dataset.listenerAttached="true"),typeof window.aipkit_updatePostTypeCounts=="function"&&(window.aipkit_updatePostTypeCounts(),Po&&!Po.dataset.listenerAttached&&(Po.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),Po.dataset.listenerAttached="true"),pn&&!pn.dataset.listenerAttached&&(pn.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),pn.dataset.listenerAttached="true")),ke(B()),ri(),Bo.length){Bo.forEach(oe=>{oe.dataset.listenerAttached||(oe.addEventListener("change",()=>{Zt(oe.value)}),oe.dataset.listenerAttached="true")});let ee=Array.from(Bo).find(oe=>oe.checked);Zt(ee?ee.value:pe())}else Zt(pe());Mo&&!Mo.dataset.listenerAttached&&(Mo.addEventListener("change",()=>{pe()==="specific"&&ai(1)}),Mo.dataset.listenerAttached="true"),pn&&!pn.dataset.websiteListenerAttached&&(pn.addEventListener("change",()=>{pe()==="specific"&&ai(1)}),pn.dataset.websiteListenerAttached="true"),e.dataset.trainingWebsiteBound="1"}let Co=ee=>`${ee.name}::${ee.size}::${ee.lastModified}`,lo=ee=>{if(!Number.isFinite(ee)||ee<=0)return"0 KB";let oe=["B","KB","MB","GB"],se=ee,ue=0;for(;se>=1024&&ue<oe.length-1;)se/=1024,ue+=1;let ve=ue===0?0:1;return`${se.toFixed(ve)} ${oe[ue]}`},jn=()=>zn&&zn.dataset.upgradeUrl||"",Hn=()=>{if(!Lo)return;let ee=Qn.size>0;Lo.style.display=ee?"none":""},Xa=(ee=1500)=>{zn&&(mo&&window.clearTimeout(mo),mo=window.setTimeout(()=>{Qn.clear(),zn.innerHTML="",An&&(An.value=""),Hn(),mo=null},ee))},br=()=>Qn.size?Array.from(Qn.values()).every(ee=>{let oe=ee.querySelector(".aipkit_training_file_status");return oe?oe.classList.contains("is-success")||oe.classList.contains("is-error"):!1}):!1,Sr=()=>{mo&&!br()&&(window.clearTimeout(mo),mo=null),br()&&Xa(),Hn()},Sa=ee=>{if(!zn)return null;let oe=Co(ee);if(Qn.has(oe))return Qn.get(oe);let se=document.createElement("div");se.className="aipkit_training_file_row",se.dataset.fileKey=oe;let ue=document.createElement("div");ue.className="aipkit_training_file_meta";let ve=document.createElement("span");ve.className="aipkit_training_file_name",ve.textContent=ee.name;let qe=document.createElement("span");qe.className="aipkit_training_file_size",qe.textContent=lo(ee.size);let Se=document.createElement("span");return Se.className="aipkit_training_file_status",Se.textContent="Queued",ue.appendChild(ve),ue.appendChild(qe),se.appendChild(ue),se.appendChild(Se),zn.appendChild(se),Qn.set(oe,se),se},on=(ee,oe,se)=>{let ue=Sa(ee);if(!ue)return;let ve=ue.querySelector(".aipkit_training_file_status");if(ve){if(ve.textContent="",ve.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),se&&ve.classList.add(`is-${se}`),oe==="Upgrade"&&jn()){ve.classList.add("is-upgrade");let qe=document.createElement("a");qe.className="aipkit_training_file_upgrade",qe.href=jn(),qe.textContent=oe,ve.appendChild(qe)}else ve.textContent=oe;Sr()}},Xo=async(ee,oe=null)=>{if(!ee||!ee.name||typeof window.aipkit_apiRequest!="function")return!1;let se=v&&v.value||e.getAttribute("data-active-bot-id");if(!se)return!1;let ue=oe||B();if(!ue||ue.enable_vector_store!=="1")return!1;let ve=String(ee.name||"").trim();if(!ve)return!1;let qe=vi=>String(vi||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),Se=qe(ve),Je=ve.replace(/\.[^/.]+$/,""),lt=[ve,Se,Je&&Je!==ve?Je:""].filter(Boolean),wi=async(vi,wn)=>{let mn=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",{bot_id:se,page:1,per_page:wn,search:vi||"",enable_vector_store:ue.enable_vector_store,vector_store_provider:ue.vector_store_provider,openai_vector_store_ids:ue.openai_vector_store_ids||[],pinecone_index_name:ue.pinecone_index_name,qdrant_collection_names:ue.qdrant_collection_names||[]});return Array.isArray(mn.logs)?mn.logs:[]},$t=(vi,wn)=>{if(!vi.length)return null;let mn=wn.map(qe).filter(Boolean);return vi.find(In=>{let xo=qe(In.message),Ni=qe(In.post_title),Xe=qe(In.file_id);return mn.some(ht=>xo&&xo.includes(ht)||Ni&&Ni.includes(ht)||Xe&&Xe.includes(ht))})||null};try{for(let mn of lt){let In=await wi(mn,10),xo=$t(In,[mn,Se]);if(xo){let Ni=String(xo.status||"").toLowerCase();if(Ni==="indexed"||Ni==="skipped_already_indexed")return on(ee,"Trained","success"),!0;if(Ni==="failed")return on(ee,"Failed","error"),!0;if(Ni==="processing"||Ni==="queued")return on(ee,"Processing","loading"),!0}}let vi=await wi("",20),wn=$t(vi,lt);if(wn){let mn=String(wn.status||"").toLowerCase();if(mn==="indexed"||mn==="skipped_already_indexed")return on(ee,"Trained","success"),!0;if(mn==="failed")return on(ee,"Failed","error"),!0;if(mn==="processing"||mn==="queued")return on(ee,"Processing","loading"),!0}}catch{}return!1},Zo=(ee,oe,se,ue=0)=>{if(!ee||!oe||!se)return;if(ue>=30){Xo(se,B()).then(Se=>{Se||on(se,"Queued","warning")});return}let qe=Ri("aipkit_vector_store_nonce_openai");if(!qe||typeof window.aipkit_apiRequest!="function"){Xo(se,B());return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:ee,batch_id:oe,_ajax_nonce:qe}).then(Se=>{let Je=(Se.status||"").toLowerCase();if(Je==="completed"){on(se,"Trained","success"),qn(B()),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}if(Je==="failed"||Je==="cancelled"){on(se,"Failed","error");return}on(se,"Processing","loading"),setTimeout(()=>{Zo(ee,oe,se,ue+1)},2500)}).catch(()=>{setTimeout(()=>{Zo(ee,oe,se,ue+1)},3e3)})},po=ee=>{if(!kn)return;let oe=kn.dataset.baseLabel||kn.querySelector(".aipkit_training_sources_label")?.textContent.trim()||kn.textContent.replace(/\(\d+\)/,"").trim(),se=Number.isFinite(ee)?ee:0,ue=kn.querySelector(".aipkit_training_sources_count");ue?(ue.textContent=String(se),kn.setAttribute("aria-label",`${oe} (${se})`)):kn.textContent=`${oe} (${se})`},qn=async(ee=null)=>{if(!kn||typeof window.aipkit_apiRequest!="function")return;if(ee&&ee.enable_vector_store!=="1"){po(0);return}let oe=ee?ee.vector_store_provider:"";if(oe==="openai"&&!(Array.isArray(ee.openai_vector_store_ids)?ee.openai_vector_store_ids:[]).length){po(0);return}if(oe==="pinecone"&&!ee.pinecone_index_name){po(0);return}if(oe==="qdrant"&&!(Array.isArray(ee.qdrant_collection_names)?ee.qdrant_collection_names:[]).length){po(0);return}let se=v&&v.value||e.getAttribute("data-active-bot-id");if(!se){po(0);return}try{let ue={bot_id:se};ee&&(ue.enable_vector_store=ee.enable_vector_store,ue.vector_store_provider=ee.vector_store_provider,ue.openai_vector_store_ids=ee.openai_vector_store_ids||[],ue.pinecone_index_name=ee.pinecone_index_name,ue.qdrant_collection_names=ee.qdrant_collection_names||[]);let ve=await window.aipkit_apiRequest("aipkit_get_chatbot_training_source_count",ue),qe=Number(ve.count||0);po(Number.isNaN(qe)?0:qe)}catch{}};window.aipkit_refreshTrainingSourcesCount=()=>{qn(B())};let Za=()=>{if(!kn||e.dataset.trainingAutoSync)return;let ee=()=>{document.visibilityState==="visible"&&qn(B())},oe=window.setInterval(ee,6e4);e.dataset.trainingAutoSync="1",e.dataset.trainingAutoSyncInterval=String(oe),document.addEventListener("visibilitychange",ee)},Ri=ee=>{let oe=document.getElementById(ee);return oe?oe.value:""},Ea=ee=>{let oe=String(ee),se=window.aipkit_wpContentTitleMap||{};if(se&&se[oe])return se[oe];if(Dn){let ue=Dn.querySelector(`input[name="wp_content_to_index[]"][value="${oe}"]`);if(ue){let ve=ue.closest(".aipkit_wp_content_list_item"),qe=ve?ve.querySelector(".aipkit_wp_content_title"):null,Se=qe?qe.textContent.trim():"";if(Se)return Se}}return`${t("Post","gpt3-ai-content-generator")} ${oe}`},Tr=(ee,oe,se)=>{let ue=Ea(ee);return`${t("Training","gpt3-ai-content-generator")}: ${ue} (${oe+1}/${se})`},Gr=async ee=>{let oe=Ri("aipkit_wp_content_fetch_nonce");if(!oe)throw new Error("WP content fetch nonce missing.");let se=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:oe,get_content_for_ids:[String(ee)]});return(se&&se.posts_content?se.posts_content:{})[String(ee)]||null},Kr=async(ee,oe,se)=>{if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let ue=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ee,embedding_provider:oe,embedding_model:se,_ajax_nonce:window.aipkit_dashboard.nonce}),ve=ue.embeddings&&ue.embeddings.length?ue.embeddings[0]:null;if(!ve)throw new Error("Failed to generate embedding.");return ve},ts=async(ee,oe)=>{let se=Array.isArray(ee)?ee:[];if(se.length)for(let ue=0;ue<se.length;ue+=1){if(window.aipkit_isIndexingStopped){st(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let ve=se[ue];st(Tr(ve,ue,se.length),"info"),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{...oe,post_ids:[ve]})}},is=async(ee,oe)=>{let se=Array.isArray(ee)?ee:[];if(se.length)for(let ue=0;ue<se.length;ue+=1){if(window.aipkit_isIndexingStopped){st(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let ve=se[ue]||{},qe=ve.postId||ve.id;if(!qe)continue;st(Tr(qe,ue,se.length),"info");let Se=await Gr(qe);if(!Se||!Se.content)continue;let Je=ve.metadata&&ve.metadata.vector_id||`wp_post_${qe}`,lt={source:"wordpress_post",created_at:new Date().toISOString(),post_id:qe,title:Se.title||"",url:Se.edit_link||"",vector_id:Je},wi=await Kr(Se.content,oe.embedding_provider,oe.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:oe._ajax_nonce,vectors:JSON.stringify([{id:Je,values:wi,metadata:lt}]),embedding_provider:oe.embedding_provider,embedding_model:oe.embedding_model,original_text_content:Se.content,index_name:oe.index_name})}},ns=async(ee,oe)=>{let se=Array.isArray(ee)?ee:[];if(se.length)for(let ue=0;ue<se.length;ue+=1){if(window.aipkit_isIndexingStopped){st(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let ve=se[ue]||{},qe=ve.postId||ve.id;if(!qe)continue;st(Tr(qe,ue,se.length),"info");let Se=await Gr(qe);if(!Se||!Se.content)continue;let Je=l(),lt={source:"wordpress_post",created_at:new Date().toISOString(),post_id:qe,title:Se.title||"",url:Se.edit_link||"",vector_id:Je},wi=await Kr(Se.content,oe.embedding_provider,oe.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",{_ajax_nonce:oe._ajax_nonce,vectors:JSON.stringify([{id:Je,vector:wi,payload:lt}]),embedding_provider:oe.embedding_provider,embedding_model:oe.embedding_model,original_text_content:Se.content,collection_name:oe.collection_name,source_context:"chatbot_settings_website"})}};typeof window.aipkit_indexOpenAIBatch!="function"&&(window.aipkit_indexOpenAIBatch=ts),typeof window.aipkit_indexPineconeBatch!="function"&&(window.aipkit_indexPineconeBatch=is),typeof window.aipkit_indexQdrantBatch!="function"&&(window.aipkit_indexQdrantBatch=ns);let Er=ee=>ee?Array.isArray(ee)?ee.flatMap(oe=>{if(Array.isArray(oe))return oe;if(oe&&typeof oe=="object"){if(Array.isArray(oe.models))return oe.models;if(Array.isArray(oe.items))return oe.items;if(oe.id)return[oe]}return[]}):typeof ee=="object"?Object.values(ee).flatMap(oe=>Array.isArray(oe)?oe:[]):[]:[],jr=ee=>{let oe=window.aipkit_chat_config||{};return ee==="openai"?Er(oe.openaiEmbeddingModels):ee==="google"?Er(oe.googleEmbeddingModels):ee==="openrouter"?Er(oe.openrouterEmbeddingModels):ee==="azure"?Er(oe.azureEmbeddingModels):[]},os=(ee,oe)=>!ee||!oe?"":`${ee}::${oe}`,as=ee=>{let oe=(ee||"").split("::"),se=oe.shift()||"",ue=oe.join("::")||"";return{provider:se,model:ue}},Pr=ee=>{if(!ee)return;let oe=ee.querySelector(".aipkit_vector_embedding_select");if(!oe)return;let se=ee.querySelector('[name="vector_embedding_provider"]'),ue=ee.querySelector('[name="vector_embedding_model"]'),ve=se?se.value:"",qe=ue?ue.value:"",Se=os(ve,qe);if(!Se||oe.value===Se)return;let Je=typeof CSS<"u"&&CSS.escape?CSS.escape(Se):Se.replace(/"/g,'\\"');oe.querySelector(`option[value="${Je}"]`)&&(oe.value=Se)},rs=ee=>{let oe=ye();if(!oe||!ee)return;let se=oe.querySelector('[name="vector_embedding_provider"]'),ue=oe.querySelector('[name="vector_embedding_model"]'),ve=ee.selectedOptions[0],qe=as(ee.value||""),Se=qe.provider||ve&&ve.dataset.provider||"",Je=qe.model||"";se&&(se.value=Se),ue&&(ue.value=Je),se&&ue&&Se&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&(ue.value=Je,window.aipkit_populateVectorEmbeddingModelSelect(oe),Je&&(ue.value=Je))},zr=(ee,oe)=>{if(!oe)return null;let ue=jr(ee).find(Se=>Se&&Se.id===oe),ve=ue?.dimensions||ue?.dimension||ue?.output_dimensionality||ue?.outputDimensionality||ue?.output_dimension,qe=ve?Number(ve):NaN;if(Number.isFinite(qe)&&qe>0)return qe;if(ue&&typeof ue.name=="string"){let Se=ue.name.match(/\((\d{3,5})\)/);if(Se)return Number(Se[1])}return ee==="google"?768:1536},Mr=()=>{let{pineconeKeyInput:ee,qdrantUrlInput:oe,qdrantKeyInput:se}=nt(),ue=!!(ee&&ee.value.trim()||m),ve=!!(oe&&oe.value.trim()||w),qe=!!(se&&se.value.trim()||u);return{openai:g,pinecone:ue,qdrant:ve&&qe}},ss=()=>{let ee=Mr();return ee.openai?"openai":ee.pinecone?"pinecone":ee.qdrant?"qdrant":""},cs=()=>g?"openai":h?"google":C?"azure":"",Qr=()=>{let ee=ye();if(!ee)return{provider:"",model:""};let oe=ee.querySelector('[name="vector_embedding_provider"]'),se=ee.querySelector('[name="vector_embedding_model"]'),ue=oe?oe.value:"";ue||(ue=cs(),oe&&ue&&(oe.value=ue,typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(ee)));let ve=se?se.value:"";if(!ve&&ue){let qe=jr(ue);ve=qe.length?qe[0].id:"",se&&ve&&(se.value=ve)}return Pr(ee),{provider:ue,model:ve}},Cr=ee=>{if(!ee)return"";let se=(ee.selectedOptions?Array.from(ee.selectedOptions):[]).find(ue=>ue&&ue.value);return se?se.value:""},Jr=(ee,oe)=>{!ee||!oe||Array.from(ee.options).forEach(se=>{se.selected=se.value===oe})},ls=async ee=>{let{openaiStoresSelect:oe}=nt(),se=Cr(oe);if(!se&&oe&&(kt(oe),se=Cr(oe)),!se){let ue=Ri("aipkit_vector_store_nonce_openai");if(!ue)throw new Error("OpenAI vector store nonce missing.");let ve=`Chatbot ${ee} ${Date.now()}`,qe=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:ue,name:ve,source_type:"chatbot_training_text"}),Se=qe.store||qe;if(!Se||!Se.id)throw new Error("OpenAI vector store creation failed.");if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]),window.aipkit_chat_config.openaiVectorStores.some(lt=>lt&&lt.id===Se.id)||window.aipkit_chat_config.openaiVectorStores.push(Se),typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"){let lt=ye();lt&&window.aipkit_populateOpenAIVectorStoresMultiSelect(lt)}oe&&Jr(oe,Se.id),se=Se.id}return se},ds=async(ee,oe)=>{let{pineconeIndexSelect:se}=nt(),ue=se?se.value:"";if(!ue&&se&&(Dt(se),ue=se.value),!ue){let ve=Ri("aipkit_vector_store_pinecone_nonce_management");if(!ve)throw new Error("Pinecone nonce missing.");let qe=`chatbot-${ee}-${Date.now()}`,Se=await window.aipkit_apiRequest("aipkit_create_index_pinecone",{_ajax_nonce:ve,name:qe,dimension:oe,metric:"cosine"}),Je=Se.index||Se,lt=Je?.name||qe;if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.pineconeIndexes)||(window.aipkit_chat_config.pineconeIndexes=[]),window.aipkit_chat_config.pineconeIndexes.some($t=>$t&&$t.name===lt||$t===lt)||window.aipkit_chat_config.pineconeIndexes.push(Je||lt),typeof window.aipkit_populatePineconeIndexSelect=="function"){let $t=ye();$t&&window.aipkit_populatePineconeIndexSelect($t)}se&&(se.value=lt),ue=lt}return ue},ps=async(ee,oe)=>{let{qdrantCollectionsSelect:se}=nt(),ue=Cr(se);if(!ue&&se&&(kt(se),ue=Cr(se)),!ue){let ve=Ri("aipkit_vector_store_qdrant_nonce_management");if(!ve)throw new Error("Qdrant nonce missing.");let qe=`chatbot-${ee}-${Date.now()}`;if(await window.aipkit_apiRequest("aipkit_create_collection_qdrant",{_ajax_nonce:ve,name:qe,dimension:oe,metric:"Cosine"}),window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.qdrantCollections)||(window.aipkit_chat_config.qdrantCollections=[]),window.aipkit_chat_config.qdrantCollections.some(Je=>Je&&Je.name===qe||Je===qe||Je?.id===qe)||window.aipkit_chat_config.qdrantCollections.push({name:qe}),se){if(!Array.from(se.options).some(lt=>lt.value===qe)){let lt=document.createElement("option");lt.value=qe,lt.textContent=qe,se.appendChild(lt)}Jr(se,qe)}if(typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let Je=ye();Je&&window.aipkit_populateQdrantCollectionsMultiSelect(Je)}ue=qe}return ue};if(qo.length&&!e.dataset.trainingTextBound){let ee=!1,oe=Se=>{!Bn||!Rn||(Se?(Bn.hidden=!1,Bn.disabled=!1,Rn.disabled=!0):(Bn.hidden=!0,Bn.disabled=!1,Rn.disabled=!1))},se=()=>{let Se=Go?Go.querySelector(".aipkit_builder_tab.is-active"):null;return Se?Se.dataset.aipkitTab:""},ue=()=>{let Se=D?D.querySelector(".aipkit_file_upload_toggle_select"):null;return Se?Se.dataset.isProPlan==="true":window.aipkit_chat_config?.isProPlan===!0||window.aipkit_dashboard?.isProPlan===!0};fo&&An&&fo.addEventListener("click",()=>{An.click()});let ve=async()=>{if(ee)return;let Se=se(),Je="",lt="chatbot_training_text",wi=[],$t=null;if(Se==="text"){if(Je=_o?_o.value.trim():"",!Je){vt("Add text to train.","warning"),Kt();return}}else if(Se==="qa"){let Xe=oa?oa.value.trim():"",ht=aa?aa.value.trim():"";if(!Xe||!ht){vt("Add a question and answer to train.","warning"),Kt();return}Je=`Q: ${Xe}
A: ${ht}`,lt="chatbot_training_qa"}else if(Se==="files"){if(!ue()){vt("Upgrade to use file uploads.","warning");return}if(wi=An?Array.from(An.files||[]):[],!wi.length){An&&An.click(),vt("Choose files to upload.","warning"),Kt();return}lt="chatbot_training_file"}else if(Se==="website"){let Xe=pe(),ht=me(Xe),Mt=Ke(Xe),Fe=he();if(Xe==="specific"){if(!Fe.length){vt("Select content to train.","warning"),Kt();return}}else if(!Mt.length){vt("Select at least one post type.","warning"),Kt();return}$t={mode:Xe,statusValue:ht,postTypes:Mt,selectedPostIds:Fe}}else{vt("Select a training tab to continue.","warning"),Kt();return}let vi=v&&v.value||e.getAttribute("data-active-bot-id");if(!vi){vt("Select a chatbot before training.","error"),Kt();return}let wn=nt(),mn=wn?wn.providerSelect:null,In=mn?mn.value:"";if(In==="claude_files"){vt("Claude Files is available for frontend chat upload only. Use OpenAI, Pinecone, or Qdrant for training.","warning"),Kt();return}let xo=["openai","pinecone","qdrant"],Ni="";if(In&&xo.includes(In)?Ni=In:Ni=ss(),!Ni){vt("Add an OpenAI, Pinecone, or Qdrant key to train.","error");return}ee=!0,oe(!0),qo.forEach(Xe=>{Xe.disabled=!0}),vt("Preparing training...","loading");try{let Xe=D&&D.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");Xe&&(Xe.tagName==="SELECT"?Xe.value="1":Xe.checked=!0),mn&&(mn.value=Ni),nn(),oi();let ht="",Mt="",Fe="",jt="",xi="";if(Ni==="openai"){if(!g)throw new Error("OpenAI API key missing.");Fe=await ls(vi)}else if(Ni==="pinecone"){if(!Mr().pinecone)throw new Error("Pinecone API key missing.");let St=Qr();if(ht=St.provider,Mt=St.model,!ht||!Mt)throw new Error("Select an embedding provider and model.");let at=zr(ht,Mt);jt=await ds(vi,at)}else if(Ni==="qdrant"){if(!Mr().qdrant)throw new Error("Qdrant URL and API key are required.");let St=Qr();if(ht=St.provider,Mt=St.model,!ht||!Mt)throw new Error("Select an embedding provider and model.");let at=zr(ht,Mt);xi=await ps(vi,at)}if(yi(B()),ct(),ke(B()),Se==="files"){Hn();for(let si=0;si<wi.length;si+=1){let St=wi[si];vt(`Uploading ${si+1} of ${wi.length}...`,"loading"),on(St,"Uploading","loading");try{let at=new FormData;if(Ni==="openai"){let zt=Ri("aipkit_vector_store_nonce_openai");if(!zt)throw new Error("OpenAI vector store nonce missing.");at.append("aipkit_vs_global_file_to_submit",St),at.append("target_store_id",Fe),at.append("source_type",lt),at.append("_ajax_nonce",zt);let Ai=await window.aipkit_api_upsertFile(at,"aipkit_upload_and_add_file_to_store_direct_openai");on(St,"Processing","loading");let Qi=Ai?.batch?.id;Xo(St,B()).then(xn=>{if(!xn){if(Qi){Zo(Fe,Qi,St);return}on(St,"Queued","warning")}})}else if(Ni==="pinecone"){let zt=Ri("aipkit_vector_store_pinecone_nonce_management");if(!zt)throw new Error("Pinecone nonce missing.");at.append("file_to_upload",St),at.append("index_name",jt),at.append("embedding_provider",ht),at.append("embedding_model",Mt),at.append("_ajax_nonce",zt),await window.aipkit_api_upsertFile(at,"aipkit_upload_file_and_upsert_to_pinecone"),on(St,"Trained","success")}else if(Ni==="qdrant"){let zt=Ri("aipkit_vector_store_qdrant_nonce_management");if(!zt)throw new Error("Qdrant nonce missing.");at.append("file_to_upload",St),at.append("target_store_id",xi),at.append("embedding_provider",ht),at.append("embedding_model",Mt),at.append("source_context","chatbot_settings_file_upload"),at.append("_ajax_nonce",zt),await window.aipkit_api_upsertFile(at,"aipkit_upload_file_and_upsert_to_qdrant"),on(St,"Trained","success")}}catch(at){throw on(St,"Failed","error"),at}}An&&(An.value=""),Hn(),vt("Saved","success"),Kt(),qn(),ee=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}else if(Se==="website"&&$t){let{mode:si,statusValue:St,postTypes:at,selectedPostIds:zt}=$t,Ai=zt,Qi=Ai.length;if(si==="bulk"){if(vt("Preparing website content...","loading"),Qi=(await Qt(at,St,Fe)).total,!Qi){st("No posts found for selection.","error"),vt("Nothing to train.","warning"),Kt();return}if(await Ci(Qi,St)){await Yi({botId:vi,postTypes:at,provider:Ni,targetStoreId:Ni==="openai"?Fe:Ni==="pinecone"?jt:xi,embeddingProvider:ht,embeddingModel:Mt}),st("Queued in the background. You can monitor it in the Automate module. You can close this page.","success"),vt("Queued","success"),Kt(),qn(B()),ee=!1,oe(!1);return}if(Qi>200&&St!=="publish"&&st("Background indexing supports published content only.","info"),Ai=await Mi(at,St,Fe),!Ai.length){st("No posts found for selection.","error"),vt("Nothing to train.","warning"),Kt();return}}vt("Training...","loading"),st(`Training ${Qi||Ai.length} item(s)...`,"info"),window.aipkit_isIndexingStopped=!1;let xn=Un?Un.id:"aipkit_training_wp_status";if(Ni==="openai"){let bn=Ri("aipkit_wp_content_index_nonce");if(!bn)throw new Error("WP content index nonce missing.");await window.aipkit_indexOpenAIBatch(Ai,{_ajax_nonce:bn,target_store_id:Fe,provider:"openai",source_type:"wordpress_content"},xn)}else if(Ni==="pinecone"){let bn=Ri("aipkit_vector_store_pinecone_nonce_management");if(!bn)throw new Error("Pinecone nonce missing.");let no=Ai.map(ea=>({id:`wp_post_${ea}`,postId:ea,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${ea}`}}));await window.aipkit_indexPineconeBatch(no,{_ajax_nonce:bn,index_name:jt,embedding_provider:ht,embedding_model:Mt,source_type:"wordpress_content"},xn)}else if(Ni==="qdrant"){let bn=Ri("aipkit_vector_store_qdrant_nonce_management");if(!bn)throw new Error("Qdrant nonce missing.");let no=Ai.map(ea=>({id:typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`wp_post_${ea}`,postId:ea,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${ea}`}}));await window.aipkit_indexQdrantBatch(no,{_ajax_nonce:bn,collection_name:xi,embedding_provider:ht,embedding_model:Mt,source_type:"wordpress_content"},xn)}vt("Saved","success"),Kt(),qn(B()),ee=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}else{if(vt("Training...","loading"),Ni==="openai"){let si=Ri("aipkit_vector_store_nonce_openai");if(!si)throw new Error("OpenAI vector store nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:si,target_store_id:Fe,text_content:Je,source_type:lt})}else if(Ni==="pinecone"){let si=Ri("aipkit_vector_store_pinecone_nonce_management");if(!si)throw new Error("Pinecone nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let St=`text_${Date.now()}`,at={source:lt,created_at:new Date().toISOString(),original_content:Je,vector_id:St},zt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Je,embedding_provider:ht,embedding_model:Mt,_ajax_nonce:window.aipkit_dashboard.nonce}),Ai=zt.embeddings&&zt.embeddings.length?zt.embeddings[0]:null;if(!Ai)throw new Error("Failed to generate embedding.");await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:si,vectors:JSON.stringify([{id:St,values:Ai,metadata:at}]),embedding_provider:ht,embedding_model:Mt,original_text_content:Je,index_name:jt})}else if(Ni==="qdrant"){let si=Ri("aipkit_vector_store_qdrant_nonce_management");if(!si)throw new Error("Qdrant nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let St=l(),at={source:lt,created_at:new Date().toISOString(),original_content:Je,vector_id:St},zt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Je,embedding_provider:ht,embedding_model:Mt,_ajax_nonce:window.aipkit_dashboard.nonce}),Ai=zt.embeddings&&zt.embeddings.length?zt.embeddings[0]:null;if(!Ai)throw new Error("Failed to generate embedding.");let Qi={_ajax_nonce:si,vectors:JSON.stringify([{id:St,vector:Ai,payload:at}]),embedding_provider:ht,embedding_model:Mt,original_text_content:Je,collection_name:xi,source_context:"chatbot_settings_training"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Qi)}Se==="text"&&_o&&(_o.value=""),Se==="qa"&&(oa&&(oa.value=""),aa&&(aa.value="")),vt("Saved","success"),Kt(),qn(),ee=!1,oe(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}}catch(Xe){vt(`Error: ${Xe.message||"Training failed."}`,"error")}finally{ee=!1,oe(!1),qo.forEach(Xe=>{Xe.disabled=!1}),Hn()}},qe=()=>{if(!An)return;let Se=Array.from(An.files||[]);if(Se.length){if(Se.forEach(Je=>{Sa(Je),on(Je,"Queued")}),Hn(),!ue()){vt("Upgrade to use file uploads.","warning"),Se.forEach(Je=>{on(Je,"Upgrade","warning")});return}ve()}};An&&An.addEventListener("change",qe),qo.forEach(Se=>{Se.addEventListener("click",ve)}),Bn&&!Bn.dataset.listenerAttached&&(Bn.addEventListener("click",()=>{ee&&(window.aipkit_isIndexingStopped=!0,Bn.disabled=!0,vt("Stopping...","warning"))}),Bn.dataset.listenerAttached="true"),qn(),Za(),e.dataset.trainingTextBound="1"}if(Ji&&!e.dataset.sourcesSheetBound){let ee=window.aipkit_escapeHtml||function(Xe){return Xe},oe={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant",claude_files:"Claude Files"},se={page:1,search:"",status:""},ue=null,ve=(Xe,ht)=>{Zn&&(Zn.textContent=Xe||"",Zn.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),ht==="success"&&Zn.classList.add("aipkit_form-help-success"),ht==="error"&&Zn.classList.add("aipkit_form-help-error"))},qe=()=>{Zn&&setTimeout(()=>{Zn.textContent="",Zn.classList.remove("aipkit_form-help-success","aipkit_form-help-error")},2500)},Se=(Xe,ht)=>{$a&&($a.textContent=Xe||"\u2014"),eo&&(eo.textContent=ht||"\u2014")},Je=()=>{let Xe=B(),ht=Xe.vector_store_provider||"",Mt=oe[ht]||"",Fe=[],jt="",xi=ye(),si=xi?xi.querySelector('select[name="openai_vector_store_ids[]"]'):null;if(ht==="openai"){if(Fe=Array.isArray(Xe.openai_vector_store_ids)?Xe.openai_vector_store_ids.filter(Boolean):[],si){let St=Array.from(si.selectedOptions).map(at=>at.textContent.trim()).filter(Boolean);St.length&&(jt=St.join(", "))}jt||(jt=Fe.join(", "))}else ht==="pinecone"?Xe.pinecone_index_name&&(Fe=[Xe.pinecone_index_name],jt=Xe.pinecone_index_name):ht==="qdrant"&&(Fe=Array.isArray(Xe.qdrant_collection_names)?Xe.qdrant_collection_names.filter(Boolean):[],jt=Fe.join(", "));return{contextSettings:Xe,providerKey:ht,providerLabel:Mt,storeIds:Fe,storeLabel:jt}},lt=Xe=>{On&&(On.innerHTML=`<tr><td colspan="5" class="aipkit_text-center">${ee(Xe)}</td></tr>`,wo&&(wo.innerHTML=""))},wi=(Xe,ht)=>{if(!On)return;if(!Xe.length){lt("No sources found.");return}let Mt=Xe.map(Fe=>{let jt=(Fe.provider||ht||"").toLowerCase(),xi=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(Fe.message||"",Fe.file_id||"",jt,Fe):"N/A",si=xi==="Text"?"aipkit_type-text":xi==="File Upload"?"aipkit_type-file":xi==="Site Content"?"aipkit_type-site":"aipkit_type-na",St=Fe.status==="indexed"||Fe.status==="skipped_already_indexed"||Fe.status==="success"?"aipkit_status-success":Fe.status==="failed"?"aipkit_status-warning":"aipkit_status-info",at="\u2014";Fe.status&&(at=Fe.status==="indexed"||Fe.status==="skipped_already_indexed"||Fe.status==="success"?"Trained":Fe.status.replace(/_/g," "));let zt=Fe.status==="processing"||Fe.status==="queued",Ai=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(Fe.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(Fe.timestamp):Fe.timestamp||"\u2014",Qi=Fe.indexed_content||"",xn=Fe.post_title||(Fe.post_id?`Post #${Fe.post_id}`:"")||Qi||Fe.message||Fe.file_id||"\u2014",bn=xn.length>60?`${xn.substring(0,60)}...`:xn,no=[];return xi==="Site Content"&&Fe.post_id&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
                    data-provider="${ee(Fe.provider||ht)}"
                    data-store-id="${ee(Fe.vector_store_id||"")}"
                    data-vector-id="${ee(Fe.file_id||"")}"
                    data-log-id="${ee(Fe.id||"")}"
                    data-post-id="${ee(Fe.post_id||"")}"
                    data-embedding-provider="${ee(Fe.embedding_provider||"")}"
                    data-embedding-model="${ee(Fe.embedding_model||"")}"
                    ${zt?'disabled aria-disabled="true"':""}
                  >${zt?"Training...":"Retrain"}</button>`),xi==="Text"&&Qi&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
                    data-provider="${ee(Fe.provider||ht)}"
                    data-store-id="${ee(Fe.vector_store_id||"")}"
                    data-vector-id="${ee(Fe.file_id||"")}"
                    data-log-id="${ee(Fe.id||"")}"
                    data-embedding-provider="${ee(Fe.embedding_provider||"")}"
                    data-embedding-model="${ee(Fe.embedding_model||"")}"
                    data-content="${encodeURIComponent(Qi)}"
                    ${zt?'disabled aria-disabled="true"':""}
                  >${zt?"Training...":"Edit"}</button>`),Qi&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_view_snippet_icon"
                    data-file-id="${ee(Fe.id||"")}"
                    data-snippet="${ee(Qi)}"
                    ${Fe.batch_id?`data-batch-id="${ee(Fe.batch_id)}" data-store-id="${ee(Fe.vector_store_id||"")}"`:""}
                    ${zt?'disabled aria-disabled="true"':""}
                  >View</button>`),Fe.file_id&&no.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
                    data-provider="${ee(Fe.provider||ht)}"
                    data-store-id="${ee(Fe.vector_store_id||"")}"
                    data-vector-id="${ee(Fe.file_id||"")}"
                    data-log-id="${ee(Fe.id||"")}"
                    ${zt?'disabled aria-disabled="true"':""}
                  >Delete</button>`),`<tr data-log-id="${ee(Fe.id||"")}">
                <td style="white-space: nowrap;">${ee(Ai)}</td>
                <td><span class="aipkit_content-type-tag ${si}">${ee(xi)}</span></td>
                <td title="${ee(xn)}">${ee(bn)}</td>
                <td style="white-space: nowrap;"><span class="aipkit_status-tag ${St}">${ee(at)}</span></td>
                <td class="aipkit_actions_cell">
                  <div class="aipkit-table-actions-group">${no.join("")}</div>
                </td>
              </tr>`}).join("");On.innerHTML=Mt,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(On,ht)},$t=async(Xe=1)=>{if(!On||typeof window.aipkit_apiRequest!="function")return;let ht=v&&v.value||e.getAttribute("data-active-bot-id");if(!ht){lt("Select a chatbot to view sources.");return}let{contextSettings:Mt,providerKey:Fe,providerLabel:jt,storeIds:xi,storeLabel:si}=Je();if(Se(jt,si),Mt.enable_vector_store!=="1"){lt("Enable a knowledge base to view sources.");return}if(!Fe||!xi.length){lt("Select a knowledge base store to view sources.");return}On.innerHTML='<tr><td colspan="5" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading sources...</td></tr>',wo&&(wo.innerHTML="");try{let St={bot_id:ht,page:Xe,search:se.search,status:se.status,enable_vector_store:Mt.enable_vector_store,vector_store_provider:Mt.vector_store_provider,openai_vector_store_ids:Mt.openai_vector_store_ids||[],pinecone_index_name:Mt.pinecone_index_name,qdrant_collection_names:Mt.qdrant_collection_names||[]},at=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",St);se.page=Xe,wi(at.logs||[],jt),typeof window.aipkit_renderLogsPagination=="function"&&at.pagination&&wo&&window.aipkit_renderLogsPagination(at.pagination,wo,zt=>$t(zt))}catch(St){lt(`Error loading sources: ${ee(St.message||"Unknown error")}`)}},vi=(Xe=1)=>{!F||!F.classList.contains("aipkit-active")||Ji.hidden||$t(Xe)};window.aipkit_refreshSourcesSheet=vi;let wn=()=>{li&&(li.classList.remove("aipkit-active"),li.setAttribute("aria-hidden","true"),li.dataset.provider="",li.dataset.storeId="",li.dataset.vectorId="",li.dataset.logId="",li.dataset.embeddingProvider="",li.dataset.embeddingModel="",ho&&(ho.value=""))},mn=Xe=>{!li||!ho||(li.dataset.provider=Xe.dataset.provider||"",li.dataset.storeId=Xe.dataset.storeId||"",li.dataset.vectorId=Xe.dataset.vectorId||"",li.dataset.logId=Xe.dataset.logId||"",li.dataset.embeddingProvider=Xe.dataset.embeddingProvider||"",li.dataset.embeddingModel=Xe.dataset.embeddingModel||"",ho.value=Xe.dataset.content?decodeURIComponent(Xe.dataset.content):"",li.classList.add("aipkit-active"),li.setAttribute("aria-hidden","false"),setTimeout(()=>ho.focus(),0))},In=()=>{Si&&(Si.classList.remove("aipkit-active"),Si.setAttribute("aria-hidden","true"),Si.dataset.provider="",Si.dataset.storeId="",Si.dataset.vectorId="",Si.dataset.logId="")},xo=Xe=>{Si&&(Si.dataset.provider=Xe.providerLabel||"",Si.dataset.storeId=Xe.storeId||"",Si.dataset.vectorId=Xe.vectorId||"",Si.dataset.logId=Xe.logId||"",Si.classList.add("aipkit-active"),Si.setAttribute("aria-hidden","false"),yo&&(yo.disabled=!1))},Ni=async(Xe,ht,Mt,Fe,jt)=>{let xi=Xe.toLowerCase();if(xi==="openai"){let at=Ri("aipkit_vector_store_nonce_openai");if(!at)throw new Error("OpenAI nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:at,target_store_id:ht,text_content:Mt,source_type:"chatbot_training_text"});return}if(!Fe||!jt){let at=B();Fe=Fe||at.vector_embedding_provider,jt=jt||at.vector_embedding_model}if(!Fe||!jt)throw new Error("Select an embedding provider and model.");let si=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:Mt,embedding_provider:Fe,embedding_model:jt}),St=si.embeddings&&si.embeddings.length?si.embeddings[0]:null;if(!St)throw new Error("Failed to generate embedding.");if(xi==="pinecone"){let at=Ri("aipkit_vector_store_pinecone_nonce_management");if(!at)throw new Error("Pinecone nonce missing.");let zt=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:at,vectors:JSON.stringify([{id:zt,values:St,metadata:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:Mt,vector_id:zt}}]),embedding_provider:Fe,embedding_model:jt,original_text_content:Mt,index_name:ht});return}if(xi==="qdrant"){let at=Ri("aipkit_vector_store_qdrant_nonce_management");if(!at)throw new Error("Qdrant nonce missing.");let zt=l(),Ai={_ajax_nonce:at,vectors:JSON.stringify([{id:zt,vector:St,payload:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:Mt,vector_id:zt}}]),embedding_provider:Fe,embedding_model:jt,original_text_content:Mt,collection_name:ht,source_context:"chatbot_settings_sources_sheet"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Ai)}};pa&&pa.addEventListener("input",()=>{ue&&window.clearTimeout(ue),ue=window.setTimeout(()=>{se.search=pa.value.trim(),vi(1)},300)}),ko&&ko.addEventListener("change",()=>{se.status=ko.value,vi(1)}),ua&&ua.addEventListener("click",()=>{vi(se.page||1)}),cr&&cr.addEventListener("click",wn),_a&&_a.addEventListener("click",wn),li&&!li.dataset.bound&&(document.addEventListener("keydown",Xe=>{Xe.key==="Escape"&&li.classList.contains("aipkit-active")&&wn()}),li.dataset.bound="1"),Oa&&Oa.addEventListener("click",async()=>{if(!li||!ho)return;let Xe=ho.value.trim();if(!Xe){ve("Text cannot be empty.","error"),qe();return}let ht=li.dataset.provider||"",Mt=li.dataset.storeId||"",Fe=li.dataset.vectorId||"",jt=li.dataset.logId||"",xi=li.dataset.embeddingProvider||"",si=li.dataset.embeddingModel||"";if(!ht||!Mt||!Fe||!jt){ve("Missing source details.","error"),qe();return}if(wn(),On&&jt){let St=typeof CSS<"u"&&CSS.escape?CSS.escape(String(jt)):String(jt).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),at=On.querySelector(`tr[data-log-id="${St}"]`),zt=at?at.querySelector(".aipkit_sources_action_edit"):null,Ai=at?at.querySelector(".aipkit_view_snippet_icon"):null,Qi=at?at.querySelector(".aipkit_sources_action_delete"):null;zt&&(zt.disabled=!0,zt.setAttribute("aria-disabled","true"),zt.textContent="Training..."),Ai&&(Ai.disabled=!0,Ai.setAttribute("aria-disabled","true")),Qi&&(Qi.disabled=!0,Qi.setAttribute("aria-disabled","true"))}ve("Training...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:ht,store_id:Mt,vector_id:Fe,log_id:jt}),await Ni(ht,Mt,Xe,xi,si),ve("Trained","success"),qe(),wn(),vi(se.page||1),qn(B())}catch(St){ve(`Error: ${St.message||"Failed to save."}`,"error")}}),lr&&lr.addEventListener("click",In),yn&&yn.addEventListener("click",In),yo&&yo.addEventListener("click",async()=>{if(!Si)return;let Xe=Si.dataset.provider||"",ht=Si.dataset.storeId||"",Mt=Si.dataset.vectorId||"",Fe=Si.dataset.logId||"";if(!Xe||!ht||!Mt||!Fe){ve("Missing source details.","error"),qe(),In();return}In();let jt=null,xi=null,si=null,St=null,at=null;if(On&&Fe){let zt=typeof CSS<"u"&&CSS.escape?CSS.escape(String(Fe)):String(Fe).replace(/[^a-zA-Z0-9_-]/g,"\\$&");jt=On.querySelector(`tr[data-log-id="${zt}"]`),jt&&(xi=jt.querySelector(".aipkit_sources_action_edit"),si=jt.querySelector(".aipkit_sources_action_retrain"),St=jt.querySelector(".aipkit_view_snippet_icon"),at=jt.querySelector(".aipkit_sources_action_delete"),[xi,si,St,at].forEach(Ai=>{Ai&&(Ai.disabled=!0,Ai.setAttribute("aria-disabled","true"))}),at&&(at.textContent="Deleting..."))}yo&&(yo.disabled=!0),ve("Deleting...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:Xe,store_id:ht,vector_id:Mt,log_id:Fe}),ve("Deleted","success"),qe(),vi(se.page||1),qn(B())}catch(zt){ve(`Error: ${zt.message||"Failed to delete."}`,"error"),[xi,si,St,at].forEach(Ai=>{Ai&&(Ai.disabled=!1,Ai.removeAttribute("aria-disabled"))}),at&&(at.textContent="Delete")}finally{yo&&(yo.disabled=!1)}}),Si&&!Si.dataset.bound&&(document.addEventListener("keydown",Xe=>{Xe.key==="Escape"&&Si.classList.contains("aipkit-active")&&In()}),Si.dataset.bound="1"),Ji.addEventListener("click",async Xe=>{let ht=Xe.target.closest(".aipkit_sources_action_edit");if(ht){mn(ht);return}let Mt=Xe.target.closest(".aipkit_sources_action_delete");if(Mt){let jt=Mt.dataset.provider||"",xi=Mt.dataset.storeId||"",si=Mt.dataset.vectorId||"",St=Mt.dataset.logId||"";if(!jt||!xi||!si||!St){ve("Missing source details.","error"),qe();return}xo({providerLabel:jt,storeId:xi,vectorId:si,logId:St});return}let Fe=Xe.target.closest(".aipkit_sources_action_retrain");if(Fe){let jt=Fe.dataset.provider||"",xi=Fe.dataset.storeId||"",si=Fe.dataset.vectorId||"",St=Fe.dataset.logId||"",at=Fe.dataset.postId||"",zt=Fe.dataset.embeddingProvider||"",Ai=Fe.dataset.embeddingModel||"";if(!jt||!xi||!si||!St||!at){ve("Missing source details.","error"),qe();return}Fe.disabled=!0,Fe.setAttribute("aria-disabled","true"),Fe.textContent="Training...";let Qi=Fe.closest("tr"),xn=Qi?Qi.querySelector(".aipkit_view_snippet_icon"):null,bn=Qi?Qi.querySelector(".aipkit_sources_action_delete"):null;xn&&(xn.disabled=!0,xn.setAttribute("aria-disabled","true")),bn&&(bn.disabled=!0,bn.setAttribute("aria-disabled","true")),ve("Retraining...","");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:jt,store_id:xi,vector_id:si,log_id:St,post_id:at,embedding_provider:zt,embedding_model:Ai}),ve("Retrained","success"),qe(),vi(se.page||1),qn(B())}catch(no){ve(`Error: ${no.message||"Failed to retrain."}`,"error"),Fe.disabled=!1,Fe.removeAttribute("aria-disabled"),Fe.textContent="Retrain",xn&&(xn.disabled=!1,xn.removeAttribute("aria-disabled")),bn&&(bn.disabled=!1,bn.removeAttribute("aria-disabled"))}}}),e.dataset.sourcesSheetBound="1"}e.dataset.contextSettingsAutosaveBound="1"}let vr=Ve();if(vr&&$i&&!e.dataset.tokenLimitsAutosaveBound){let I=!1,T=null,B=()=>{let K=vr.querySelectorAll('input[name^="token_role_limits["]'),V={};return K.forEach(Y=>{let ne=Y.getAttribute("name");ne&&(V[ne]=Y.value)}),V},U=()=>{let K=V=>{let Y=vr.querySelector(V);return Y?Y.value:""};return{token_guest_limit:K('[name="token_guest_limit"]'),token_user_limit:K('[name="token_user_limit"]'),token_limit_mode:K('[name="token_limit_mode"]'),token_reset_period:K('[name="token_reset_period"]'),token_limit_message:K('[name="token_limit_message"]'),role_limits:B()}},z=U(),X=K=>{let V=v&&v.value||e.getAttribute("data-active-bot-id");if(!V)return;I=!0,ot("Auto-saving...","");let Y={bot_id:V,token_guest_limit:K.token_guest_limit,token_user_limit:K.token_user_limit,token_limit_mode:K.token_limit_mode,token_reset_period:K.token_reset_period,token_limit_message:K.token_limit_message};Object.entries(K.role_limits).forEach(([ne,de])=>{Y[ne]=de}),window.aipkit_apiRequest("aipkit_update_chatbot_token_limits",Y).then(ne=>{z=K,ot(ne.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(ne=>{ot(`Error: ${ne.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T){let ne=T;T=null,JSON.stringify(ne)!==JSON.stringify(z)&&X(ne)}})},ie=K=>{if(JSON.stringify(K)!==JSON.stringify(z)){if(I){T=K;return}X(K)}};vr.addEventListener("change",K=>{let V=K.target;if(V){if(V.matches(".aipkit_token_limit_mode_select")){Gi(),ie(U());return}(V.matches('[name="token_guest_limit"]')||V.matches('[name="token_user_limit"]')||V.matches('[name="token_reset_period"]')||V.matches('[name="token_limit_message"]')||V.matches('input[name^="token_role_limits["]'))&&ie(U())}}),e.dataset.tokenLimitsAutosaveBound="1"}let Vr=(R?R.querySelector('[data-aipkit-settings-panel="appearance"]'):null)||(O?O.querySelector('[data-aipkit-settings-panel="appearance"]'):null);if(Vr&&$i&&!e.dataset.styleSettingsAutosaveBound){let I=Vr;if(I){let T=!1,B=null,U=()=>{let ke=I.querySelector('[name="enable_conversation_starters"]'),pe=I.querySelector(".aipkit_starters_config_btn");if(!ke||!pe)return;let Ke=!ke.disabled&&(ke.tagName==="SELECT"?ke.value==="1":!!ke.checked);pe.hidden=!Ke,pe.disabled=!Ke,pe.setAttribute("aria-disabled",Ke?"false":"true"),Ke||(pe.setAttribute("aria-expanded","false"),Ir())},z=I.querySelector("[data-aipkit-interface-controls-dropdown]"),X=z?z.querySelector(".aipkit_popover_multiselect_btn"):null,ie=z?z.querySelector(".aipkit_popover_multiselect_label"):null,K=z?z.querySelector(".aipkit_popover_multiselect_panel"):null,V=z?Array.from(z.querySelectorAll(".aipkit_interface_control_option")):[],Y={};Array.from(I.querySelectorAll(".aipkit_interface_control_hidden_select")).forEach(ke=>{let pe=ke.getAttribute("name");pe&&(Y[pe]=ke)});let ne=I.querySelector(".aipkit_interface_control_option--sidebar"),de=ne?ne.closest(".aipkit_interface_control_item--sidebar"):null,we=e.querySelector("[data-aipkit-top-mode-select]"),De=ke=>ke?ke.tagName==="SELECT"?ke.value==="1":!!ke.checked:!1,ut=(ke,pe)=>{if(!ke||ke.disabled)return;let Ke=!!pe;De(ke)!==Ke&&(ke.tagName==="SELECT"?ke.value=Ke?"1":"0":ke.checked=Ke,ke.dispatchEvent(new Event("change",{bubbles:!0})))},Ct=()=>{ie&&(ie.textContent=Ta(V,z,"Select controls",2))},Ft=()=>{V.forEach(ke=>{if(!ke)return;let pe=Y[ke.value];pe&&(ke.checked=De(pe))}),Ct()},qi=()=>{V.forEach(ke=>{if(!ke||ke.disabled)return;let pe=Y[ke.value];pe&&ut(pe,ke.checked)}),Ct()},pt=()=>{if(!ne||!de)return;let ke=Y.enable_conversation_sidebar,pe=ke?ke.disabled:we?we.value==="popup"||we.value==="external":!1,Ke=de.getAttribute("data-tooltip-disabled")||"";pe?(ne.disabled=!0,de.classList.add("is-disabled"),Ke&&de.setAttribute("title",Ke)):(ne.disabled=!1,de.classList.remove("is-disabled"),de.removeAttribute("title"))},yi=()=>{!X||!K||(X.setAttribute("aria-expanded","false"),K.hidden=!0,z.classList.remove("is-open"),Kn())};z&&X&&K&&!z.dataset.bound&&(X.addEventListener("click",ke=>{if(ke.preventDefault(),X.getAttribute("aria-expanded")==="true"){yi();return}X.setAttribute("aria-expanded","true"),K.hidden=!1,z.classList.add("is-open"),Kn()}),V.forEach(ke=>{ke.addEventListener("change",()=>{qi()})}),document.addEventListener("click",ke=>{z.contains(ke.target)||yi()}),document.addEventListener("keydown",ke=>{ke.key==="Escape"&&yi()}),Object.values(Y).forEach(ke=>{ke.addEventListener("change",()=>{pt(),Ft()})}),we&&we.dataset.interfaceControlsBound!=="1"&&(we.addEventListener("change",()=>{window.requestAnimationFrame(()=>{pt(),Ft()})}),we.dataset.interfaceControlsBound="1"),pt(),Ft(),z.dataset.bound="1"),cn&&to&&ma&&Fi&&!cn.dataset.bound&&(to.addEventListener("click",ke=>{if(ke.preventDefault(),to.getAttribute("aria-expanded")==="true"){Qo();return}to.setAttribute("aria-expanded","true"),ma.hidden=!1,cn.classList.add("is-open"),Kn(),gr()}),Ln.forEach(ke=>{ke.addEventListener("change",()=>{ke.checked&&(Or(ke),Qo())})}),document.addEventListener("click",ke=>{cn&&!cn.contains(ke.target)&&Qo()}),document.addEventListener("keydown",ke=>{ke.key==="Escape"&&Qo()}),cn.dataset.bound="1"),Fi&&Fi.dataset.themeDropdownBound!=="1"&&(Fi.addEventListener("change",()=>{gr()}),Fi.dataset.themeDropdownBound="1"),Pi&&Pi.dataset.bound!=="1"&&(Pi.addEventListener("click",ke=>{if(ke.preventDefault(),Pi.hidden||Pi.disabled)return;let pe=Ln.find(he=>{let tt=he.getAttribute("data-theme-value")||he.value||"",wt=he.getAttribute("data-preset-key")||"";return tt==="custom"&&wt===""});if(pe&&!pe.disabled&&(pe.checked||(pe.checked=!0,Or(pe))),Qo(),Tt&&Tt.classList.contains("is-open")&&ki===Pi){Jo();return}Hr(Pi)}),Pi.dataset.bound="1"),gr();let Xt=()=>{let ke={},pe=Ci=>{let Yi=I.querySelector(Ci);return!Yi||Yi.disabled?null:Yi.value||""},Ke=Ci=>!Ci||Ci.disabled?null:Ci.tagName==="SELECT"?Ci.value==="1"?"1":"0":Ci.checked?"1":"0",me=I.querySelector('select[name="theme"]');if(me&&!me.disabled)ke.theme=me.value||"light";else{let Ci=I.querySelector('input[name="theme"]:checked');if(Ci&&!Ci.disabled)ke.theme=Ci.value||"light";else{let Yi=e.querySelector('input[name="theme"]:checked, select[name="theme"]');Yi&&!Yi.disabled&&(ke.theme=Yi.value||"light")}}let he="";if((ke.theme||"")==="custom"&&(vo&&!vo.disabled&&(he=vo.value||""),!he&&me&&!me.disabled)){let Ci=me.selectedOptions&&me.selectedOptions.length?me.selectedOptions[0]:null;he=Ci&&Ci.dataset&&Ci.dataset.presetKey?Ci.dataset.presetKey:""}ke.theme_preset_key=he;let tt=pe('input[name="greeting"]');tt!==null&&(ke.greeting=tt);let wt=pe('input[name="subgreeting"]');wt!==null&&(ke.subgreeting=wt);let ai=pe('input[name="input_placeholder"]');ai!==null&&(ke.input_placeholder=ai);let Zt=pe('input[name="footer_text"]');Zt!==null&&(ke.footer_text=Zt);let ri=pe('input[name="custom_typing_text"]');ri!==null&&(ke.custom_typing_text=ri);let Qt=Ci=>{let Yi=I.querySelector(`[name="${Ci}"]`);if(!(!Yi||Yi.disabled)){if(Yi.tagName==="SELECT"){ke[Ci]=Yi.value==="1"?"1":"0";return}ke[Ci]=Yi.checked?"1":"0"}};Qt("enable_download"),Qt("enable_copy_button"),Qt("enable_fullscreen"),Qt("enable_feedback"),Qt("enable_conversation_sidebar"),Qt("enable_conversation_starters");let Mi=v&&v.value||e.getAttribute("data-active-bot-id");if(Mi){let Ci=document.getElementById(`aipkit_bot_${Mi}_enable_consent_compliance`),Yi=Ke(Ci);Yi!==null&&(ke.enable_consent_compliance=Yi);let Co=document.getElementById(`aipkit_bot_${Mi}_enable_ip_anonymization`),lo=Ke(Co);lo!==null&&(ke.enable_ip_anonymization=lo);let jn=document.getElementById(`aipkit_bot_${Mi}_consent_title`);jn&&!jn.disabled&&(ke.consent_title=jn.value||"");let Hn=document.getElementById(`aipkit_bot_${Mi}_consent_message`);Hn&&!Hn.disabled&&(ke.consent_message=Hn.value||"");let Xa=document.getElementById(`aipkit_bot_${Mi}_consent_button`);Xa&&!Xa.disabled&&(ke.consent_button=Xa.value||"");let br=document.getElementById(`aipkit_bot_${Mi}_openai_moderation_enabled`),Sr=Ke(br);Sr!==null&&(ke.openai_moderation_enabled=Sr);let Sa=document.getElementById(`aipkit_bot_${Mi}_openai_moderation_message`);Sa&&!Sa.disabled&&(ke.openai_moderation_message=Sa.value||"");let on=document.getElementById(`aipkit_bot_${Mi}_banned_words`);on&&!on.disabled&&(ke.banned_words=on.value||"");let Xo=document.getElementById(`aipkit_bot_${Mi}_banned_words_message`);Xo&&!Xo.disabled&&(ke.banned_words_message=Xo.value||"");let Zo=document.getElementById(`aipkit_bot_${Mi}_banned_ips`);Zo&&!Zo.disabled&&(ke.banned_ips=Zo.value||"");let po=document.getElementById(`aipkit_bot_${Mi}_banned_ips_message`);po&&!po.disabled&&(ke.banned_ips_message=po.value||"");let qn=document.getElementById(`aipkit_bot_${Mi}_custom_theme_settings_container`);qn&&qn.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(Ri=>{let Ea=Ri.getAttribute("name");Ea&&(Ri.type==="checkbox"?ke[Ea]=Ri.checked?"1":"0":Ri.type==="radio"?Ri.checked&&(ke[Ea]=Ri.value):ke[Ea]=Ri.value)});let Za=document.getElementById(`aipkit_bot_${Mi}_conversation_starters`);Za&&!Za.disabled&&(ke.conversation_starters=Za.value||"")}return ke},vt=Xt(),Kt=ke=>{let pe=v&&v.value||e.getAttribute("data-active-bot-id");pe&&(T=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_style_settings",{bot_id:pe,...ke}).then(Ke=>{vt=ke,ot(Ke.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(pe),Oi()}).catch(Ke=>{ot(`Error: ${Ke.message||"Failed to save."}`,"error")}).finally(()=>{if(T=!1,B){let Ke=B;B=null,JSON.stringify(Ke)!==JSON.stringify(vt)&&Kt(Ke)}}))},st=ke=>{if(JSON.stringify(ke)!==JSON.stringify(vt)){if(T){B=ke;return}Kt(ke)}};I.addEventListener("change",ke=>{let pe=ke.target;if(pe&&((pe.matches('input[name="enable_conversation_starters"]')||pe.matches('select[name="enable_conversation_starters"]'))&&U(),pe.matches('input[name="greeting"]')||pe.matches('input[name="subgreeting"]')||pe.matches('input[name="input_placeholder"]')||pe.matches('input[name="footer_text"]')||pe.matches('input[name="custom_typing_text"]')||pe.matches('input[name="enable_download"]')||pe.matches('input[name="enable_copy_button"]')||pe.matches('input[name="enable_fullscreen"]')||pe.matches('input[name="enable_feedback"]')||pe.matches('input[name="enable_conversation_sidebar"]')||pe.matches('input[name="enable_conversation_starters"]')||pe.matches('select[name="enable_download"]')||pe.matches('select[name="enable_copy_button"]')||pe.matches('select[name="enable_fullscreen"]')||pe.matches('select[name="enable_feedback"]')||pe.matches('select[name="enable_conversation_sidebar"]')||pe.matches('select[name="enable_conversation_starters"]')||pe.matches('select[name="theme"]')||pe.matches('input[name="theme"]'))){if((pe.matches('select[name="theme"]')||pe.matches('input[name="theme"]'))&&typeof Jo=="function")if(pe.value!=="custom")Jo();else{let me=pe.matches&&pe.matches('select[name="theme"]')&&pe.selectedOptions&&pe.selectedOptions.length?pe.selectedOptions[0]:null;if(!!(me&&me.dataset&&me.dataset.presetKey))Jo();else{let tt=I.querySelector(".aipkit_theme_config_btn:not([hidden])")||I.querySelector("[data-aipkit-theme-dropdown] .aipkit_popover_multiselect_btn")||pe.closest(".aipkit_theme_choice_card")||pe;Hr(tt)}}st(Xt())}}),U(),e.addEventListener("change",ke=>{let pe=ke.target;!pe||!pe.matches||!pe.matches('select[name="theme"]')&&!pe.matches('input[name="theme"]')||I.contains(pe)||st(Xt())}),e.dataset.customThemeAutosaveBound||(document.addEventListener("change",ke=>{let pe=ke.target;pe&&pe.matches&&pe.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')&&(!(document.documentElement.dataset.aipkitApplyingThemePreset==="1")&&(Fi?.value||"")==="custom"&&Yr(),st(Xt()))}),e.dataset.customThemeAutosaveBound="1"),I.addEventListener("blur",ke=>{let pe=ke.target;pe&&(pe.matches('input[name="greeting"]')||pe.matches('input[name="subgreeting"]')||pe.matches('input[name="input_placeholder"]')||pe.matches('input[name="footer_text"]')||pe.matches('input[name="custom_typing_text"]'))&&st(Xt())},!0),document.addEventListener("change",ke=>{let pe=ke.target;pe&&pe.matches('textarea[name="conversation_starters"], [name="enable_consent_compliance"], [name="enable_ip_anonymization"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], [name="openai_moderation_enabled"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&(pe.matches('[name="enable_consent_compliance"]')&&Dr(),pe.matches('[name="openai_moderation_enabled"]')&&Wr(),st(Xt()))}),document.addEventListener("blur",ke=>{let pe=ke.target;pe&&pe.matches('textarea[name="conversation_starters"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&st(Xt())},!0),e.dataset.styleSettingsAutosaveBound="1"}}if(F&&$i&&!e.dataset.imageSettingsAutosaveBound){let I=!1,T=null;Zi&&ro&&jo&&tn&&!Zi.dataset.bound&&(ro.addEventListener("click",K=>{if(K.preventDefault(),ro.getAttribute("aria-expanded")==="true"){va();return}Qo(),ya(),ro.setAttribute("aria-expanded","true"),jo.hidden=!1,Zi.classList.add("is-open"),Kn(),kr()}),ga.forEach(K=>{K.addEventListener("change",()=>{K.checked&&(Xr(K),va())})}),document.addEventListener("click",K=>{Zi&&!Zi.contains(K.target)&&va()}),document.addEventListener("keydown",K=>{K.key==="Escape"&&va()}),Zi.dataset.bound="1"),tn&&tn.dataset.imageModelDropdownBound!=="1"&&(tn.addEventListener("change",()=>{kr()}),tn.dataset.imageModelDropdownBound="1"),kr(),Gn&&Nn&&!Gn.dataset.bound&&(Gn.addEventListener("click",K=>{if(K.preventDefault(),Gn.getAttribute("aria-expanded")==="true"){ba();return}Qo(),ya(),va(),Gn.setAttribute("aria-expanded","true"),Nn.hidden=!1,Nn.classList.add("is-open"),Kn()}),Va&&Va.addEventListener("click",K=>{K.preventDefault(),ba()}),document.addEventListener("click",K=>{Nn.classList.contains("is-open")&&(Gn.contains(K.target)||Nn.contains(K.target)||ba())}),document.addEventListener("keydown",K=>{K.key==="Escape"&&ba()}),Gn.dataset.bound="1");let B=()=>{let K=j&&j.querySelector('select[name="chat_image_model_id"]')||D&&D.querySelector('select[name="chat_image_model_id"]')||F.querySelector('select[name="chat_image_model_id"]'),V=j&&j.querySelector('input[name="image_triggers"]')||j&&j.querySelector('textarea[name="image_triggers"]')||D&&D.querySelector('input[name="image_triggers"]')||D&&D.querySelector('textarea[name="image_triggers"]')||F.querySelector('input[name="image_triggers"]')||F.querySelector('textarea[name="image_triggers"]');if(!K||!V)return null;let Y=j&&j.querySelector(".aipkit_image_analysis_select")||D&&D.querySelector(".aipkit_image_analysis_select")||F.querySelector(".aipkit_image_analysis_select"),ne=j&&j.querySelector(".aipkit_image_analysis_checkbox")||D&&D.querySelector(".aipkit_image_analysis_checkbox")||F.querySelector(".aipkit_image_analysis_checkbox"),de=Y&&Y.value!==""?Y.value:ne&&ne.checked?"1":"0";return{chat_image_model_id:K.value||"",image_triggers:V.value||"",enable_image_upload:de}},U=B()||{},z=K=>{let V=v&&v.value||e.getAttribute("data-active-bot-id");V&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_image_settings",{bot_id:V,...K}).then(Y=>{U=K,ot(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T){let Y=T;T=null,JSON.stringify(Y)!==JSON.stringify(U)&&z(Y)}}))},X=K=>{if(K&&JSON.stringify(K)!==JSON.stringify(U)){if(I){T=K;return}z(K)}},ie=K=>{let V=K.target;V&&(V.matches('select[name="chat_image_model_id"]')||V.matches('input[name="image_triggers"]')||V.matches('textarea[name="image_triggers"]')||V.matches(".aipkit_image_analysis_checkbox")||V.matches(".aipkit_image_analysis_select"))&&X(B())};F.addEventListener("change",ie),D&&D.addEventListener("change",ie),j&&j.addEventListener("change",ie),e.dataset.imageSettingsAutosaveBound="1"}if(F&&$i&&!e.dataset.replicateKeyAutosaveBound){let T=j&&j.querySelector('input[name="replicate_api_key"]')||D&&D.querySelector('input[name="replicate_api_key"]')||F.querySelector('input[name="replicate_api_key"]');if(T){let B=!1,U=null,z=T.value||"",X=V=>{B=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:V}).then(Y=>{z=V,ot(Y.message||"Saved","success"),Oi(),Ua(V)}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(B=!1,U!==null){let Y=U;U=null,Y!==z&&X(Y)}})},ie=V=>{if(V!==z){if(B){U=V;return}X(V)}},K=V=>{let Y=V.target;!Y||!Y.matches('input[name="replicate_api_key"]')||ie(Y.value||"")};F.addEventListener("change",K),F.addEventListener("blur",K,!0),D&&(D.addEventListener("change",K),D.addEventListener("blur",K,!0)),j&&(j.addEventListener("change",K),j.addEventListener("blur",K,!0)),e.dataset.replicateKeyAutosaveBound="1"}}if(Ue&&$i&&!e.dataset.audioSettingsAutosaveBound){let I=!1,T=null,B=()=>{let me=Qt=>{let Mi=Ue.querySelector(Qt);return Mi?Mi.value:null},he=Qt=>Qt?Qt.tagName==="SELECT"?Qt.value:Qt.type==="checkbox"?Qt.checked?"1":"0":Qt.value?Qt.value:"0":null,tt=Qt=>he(e.querySelector(Qt)),wt={},ai=tt(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch");if(ai!==null){wt.enable_voice_input=ai;let Qt=me('[name="stt_provider"]');Qt!==null&&(wt.stt_provider=Qt);let Mi=me('[name="stt_openai_model_id"]');Mi!==null&&(wt.stt_openai_model_id=Mi)}let Zt=tt(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch");if(Zt!==null){wt.tts_enabled=Zt;let Qt=he('[name="tts_auto_play"]');Qt!==null&&(wt.tts_auto_play=Qt);let Mi=me('[name="tts_provider"]');Mi!==null&&(wt.tts_provider=Mi);let Ci=me('[name="tts_google_voice_id"]');Ci!==null&&(wt.tts_google_voice_id=Ci);let Yi=me('[name="tts_openai_voice_id"]');Yi!==null&&(wt.tts_openai_voice_id=Yi);let Co=me('[name="tts_openai_model_id"]');Co!==null&&(wt.tts_openai_model_id=Co);let lo=me('[name="tts_elevenlabs_voice_id"]');lo!==null&&(wt.tts_elevenlabs_voice_id=lo);let jn=me('[name="tts_elevenlabs_model_id"]');jn!==null&&(wt.tts_elevenlabs_model_id=jn)}let ri=tt(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle");if(ri!==null){wt.enable_realtime_voice=ri;let Qt=he('[name="direct_voice_mode"]');Qt!==null&&(wt.direct_voice_mode=Qt);let Mi=he('[name="input_audio_noise_reduction"]');Mi!==null&&(wt.input_audio_noise_reduction=Mi);let Ci=me('[name="realtime_model"]');Ci!==null&&(wt.realtime_model=Ci);let Yi=me('[name="realtime_voice"]');Yi!==null&&(wt.realtime_voice=Yi);let Co=me('[name="turn_detection"]');Co!==null&&(wt.turn_detection=Co);let lo=me('[name="input_audio_format"]');lo!==null&&(wt.input_audio_format=lo);let jn=me('[name="output_audio_format"]');jn!==null&&(wt.output_audio_format=jn);let Hn=me('[name="speed"]');Hn!==null&&(wt.speed=Hn)}return wt},U=B(),X=(()=>{let me=Ue.querySelector('[name="elevenlabs_api_key"]');return me?me.value:""})(),ie=!1,K=null,V=!1,Y=Ue.querySelector(".aipkit_tts_sync_status"),ne=(me,he,tt)=>{Y&&(Y.textContent=me||"",Y.classList.remove("success","error","loading"),he&&Y.classList.add(he),tt?Y.setAttribute("title",tt):Y.removeAttribute("title"),Y.style.display=me?"inline-block":"none")},de=(me=2500)=>{Y&&setTimeout(()=>{ne("")},me)},we=()=>{let me=Ue.querySelector('[name="tts_provider"]');return me?me.value:""},De=()=>{let me=Ue.querySelector(".aipkit_tts_toggle_switch");return me?me.tagName==="SELECT"?me.value==="1":!!me.checked:!1},ut=()=>{let me=Ue.querySelector('select[name="tts_google_voice_id"]');return!me||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_updateGoogleVoiceSelect!="function"||V?Promise.resolve():(V=!0,ne("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(he=>{if(!he||!he.voices)throw new Error("Invalid response received from voice sync.");let tt=me.value||"";window.aipkit_updateGoogleVoiceSelect(me.id,he.voices,tt);let wt=document.getElementById("aipkit_google_tts_voices_json_main");wt&&(wt.dataset.voices=JSON.stringify(he.voices)),ne(he.message||"Synced","success"),de()}).catch(he=>{let tt=he?.message||"Sync failed.";throw ne(tt,"error",tt),de(5e3),he}).finally(()=>{V=!1}))},Ct=()=>{let me=st();if(!me||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect!="function"||typeof window.aipkit_chatTts_updateElevenLabsModelsSelect!="function")return Promise.resolve();let he=Ue.querySelector('select[name="tts_elevenlabs_voice_id"]'),tt=Ue.querySelector('select[name="tts_elevenlabs_model_id"]');if(!he&&!tt||V)return Promise.resolve();V=!0,ne("Syncing...","loading");let wt=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabs"}).then(Zt=>{let ri=Zt?.models||[];he&&window.aipkit_chatTts_updateElevenLabsVoiceSelect(he.id,ri,he.value||"");let Qt=document.getElementById(`aipkit_elevenlabs_voices_json_${me}`);Qt&&(Qt.dataset.voices=JSON.stringify(ri))}),ai=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabsModels"}).then(Zt=>{let ri=Zt?.models||[];tt&&window.aipkit_chatTts_updateElevenLabsModelsSelect(tt.id,ri,tt.value||"");let Qt=document.getElementById(`aipkit_elevenlabs_models_json_${me}`);Qt&&(Qt.dataset.models=JSON.stringify(ri))});return Promise.allSettled([wt,ai]).then(Zt=>{let ri=Zt.find(Qt=>Qt.status==="rejected");if(ri){let Qt=ri.reason?.message||"Sync failed.";throw ne(Qt,"error",Qt),de(5e3),ri.reason}return ne("Synced","success"),de(),Zt}).finally(()=>{V=!1})},Ft=me=>{try{let he=me?JSON.parse(me):[];return Array.isArray(he)&&he.length>0}catch{return!1}},qi=me=>me?!!(me.options&&me.options.length>1):!1,pt=()=>{let me=Ue.querySelector('select[name="tts_google_voice_id"]'),he=document.getElementById("aipkit_google_tts_voices_json_main");return!Ft(he?.dataset?.voices)||!qi(me)},yi=()=>{let me=st();if(!me)return!1;let he=Ue.querySelector('select[name="tts_elevenlabs_voice_id"]'),tt=Ue.querySelector('select[name="tts_elevenlabs_model_id"]'),wt=document.getElementById(`aipkit_elevenlabs_voices_json_${me}`),ai=document.getElementById(`aipkit_elevenlabs_models_json_${me}`),Zt=Ft(wt?.dataset?.voices),ri=Ft(ai?.dataset?.models);return!Zt||!ri||!qi(he)||!qi(tt)},Xt=()=>{if(!De())return Promise.resolve();let me=we();return me==="Google"?pt()?ut():Promise.resolve():me==="ElevenLabs"&&yi()?Ct():Promise.resolve()};window.aipkit_syncAudioTtsOnOpen=Xt;let vt=me=>{me!=null&&(ie=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{elevenlabs_api_key:me}).then(he=>{X=me,ot(he.message||"Saved","success"),Oi(),we()==="ElevenLabs"&&De()&&Ct().catch(()=>{})}).catch(he=>{ot(`Error: ${he.message||"Failed to save."}`,"error")}).finally(()=>{if(ie=!1,K!==null){let he=K;K=null,he!==X&&vt(he)}}))},Kt=me=>{if(me!=null&&me!==X){if(ie){K=me;return}vt(me)}},st=()=>v&&v.value||e.getAttribute("data-active-bot-id"),ke=()=>{let me=st();Ue.querySelectorAll(".aipkit_audio_format_combo_select").forEach(Zt=>{let ri=Zt.closest(".aipkit_popover_option_row"),Qt=ri?.querySelector('[name="input_audio_format"]'),Mi=ri?.querySelector('[name="output_audio_format"]'),Ci=Zt.querySelector('option[value="current"]');!Qt||!Mi||!Ci||(Ci.textContent=`In: ${Qt.value} / Out: ${Mi.value}`,Zt.value="current")});let tt=Ue.querySelector('select[name="tts_google_voice_id"]');if(tt&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let Zt=document.getElementById("aipkit_google_tts_voices_json_main");try{let ri=Zt?.dataset?.voices?JSON.parse(Zt.dataset.voices):[];window.aipkit_updateGoogleVoiceSelect(tt.id,ri,tt.value||"")}catch(ri){console.warn("AIPKit Builder: Failed to parse Google TTS voices data.",ri)}}let wt=Ue.querySelector('select[name="tts_elevenlabs_voice_id"]');if(me&&wt&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){let Zt=document.getElementById(`aipkit_elevenlabs_voices_json_${me}`);try{let ri=Zt?.dataset?.voices?JSON.parse(Zt.dataset.voices):[];window.aipkit_chatTts_updateElevenLabsVoiceSelect(wt.id,ri,wt.value||"")}catch(ri){console.warn("AIPKit Builder: Failed to parse ElevenLabs voices data.",ri)}}let ai=Ue.querySelector('select[name="tts_elevenlabs_model_id"]');if(me&&ai&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){let Zt=document.getElementById(`aipkit_elevenlabs_models_json_${me}`);try{let ri=Zt?.dataset?.models?JSON.parse(Zt.dataset.models):[];window.aipkit_chatTts_updateElevenLabsModelsSelect(ai.id,ri,ai.value||"")}catch(ri){console.warn("AIPKit Builder: Failed to parse ElevenLabs models data.",ri)}}},pe=me=>{let he=st();he&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_audio_settings",{bot_id:he,...me}).then(tt=>{U=me,ot(tt.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(he),Oi()}).catch(tt=>{ot(`Error: ${tt.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T){let tt=T;T=null,JSON.stringify(tt)!==JSON.stringify(U)&&pe(tt)}}))},Ke=me=>{if(!(!me||Object.keys(me).length===0)&&JSON.stringify(me)!==JSON.stringify(U)){if(I){T=me;return}pe(me)}};e.addEventListener("change",me=>{let he=me.target;!he||!(he.matches(".aipkit_audio_toggle_voice_input_row .aipkit_voice_input_toggle_switch")||he.matches(".aipkit_audio_toggle_tts_row .aipkit_tts_toggle_switch")||he.matches(".aipkit_audio_toggle_realtime_row .aipkit_enable_realtime_voice_toggle"))||(Pn(),Ke(B()))}),Ue.addEventListener("change",me=>{let he=me.target;if(he){if(he.matches(".aipkit_audio_format_combo_select")){let tt=he.closest(".aipkit_popover_option_row"),wt=tt?.querySelector('[name="input_audio_format"]'),ai=tt?.querySelector('[name="output_audio_format"]'),Zt=he.querySelector('option[value="current"]'),ri=he.value||"";if(!wt||!ai||!Zt||!ri)return;ri.startsWith("in:")?wt.value=ri.replace("in:",""):ri.startsWith("out:")&&(ai.value=ri.replace("out:","")),Zt.textContent=`In: ${wt.value} / Out: ${ai.value}`,he.value="current",wt.dispatchEvent(new Event("change",{bubbles:!0})),ai.dispatchEvent(new Event("change",{bubbles:!0}));return}if(he.matches('[name="elevenlabs_api_key"]')){Kt(he.value);return}if((he.matches(".aipkit_voice_input_toggle_switch")||he.matches(".aipkit_stt_provider_select")||he.matches('[name="stt_openai_model_id"]')||he.matches(".aipkit_tts_toggle_switch")||he.matches('[name="tts_auto_play"]')||he.matches(".aipkit_tts_provider_select")||he.matches('[name="tts_google_voice_id"]')||he.matches('[name="tts_openai_voice_id"]')||he.matches('[name="tts_openai_model_id"]')||he.matches('[name="tts_elevenlabs_voice_id"]')||he.matches('[name="tts_elevenlabs_model_id"]')||he.matches(".aipkit_enable_realtime_voice_toggle")||he.matches('[name="direct_voice_mode"]')||he.matches('[name="input_audio_noise_reduction"]')||he.matches('[name="realtime_model"]')||he.matches('[name="realtime_voice"]')||he.matches('[name="turn_detection"]')||he.matches('[name="input_audio_format"]')||he.matches('[name="output_audio_format"]')||he.matches('[name="speed"]'))&&(Pn(),Ke(B()),he.matches(".aipkit_tts_provider_select")&&De())){let tt=we();tt==="Google"?ut().catch(()=>{}):tt==="ElevenLabs"&&Ct().catch(()=>{})}}}),Pn(),ke(),e.dataset.audioSettingsAutosaveBound="1"}if(zi&&$i&&!e.dataset.popupSettingsAutosaveBound){let I=!1,T=null;en&&ao&&Ui&&!en.dataset.bound&&(ao.addEventListener("click",K=>{if(K.preventDefault(),ao.getAttribute("aria-expanded")==="true"){ya();return}ao.setAttribute("aria-expanded","true"),Ui.hidden=!1,en.classList.add("is-open"),Kn(),hr()}),vn.forEach(K=>{K.addEventListener("change",()=>{K.checked&&Zr(K)})}),Object.values(sn).forEach(K=>{K.addEventListener("change",()=>{hr()})}),document.addEventListener("click",K=>{en&&!en.contains(K.target)&&ya()}),document.addEventListener("keydown",K=>{K.key==="Escape"&&ya()}),hr(),en.dataset.bound="1");let B=()=>{let K=ai=>zi&&zi.querySelector(ai)||Ee&&Ee.querySelector(ai)||e.querySelector(ai),V=ai=>{let Zt=K(ai);return Zt?Zt.value:null},Y=ai=>{let Zt=K(ai);return Zt?Zt.checked?"1":"0":null},ne={},de=V('[name="popup_position"]');de!==null&&(ne.popup_position=de);let we=V('[name="popup_delay"]');we!==null&&(ne.popup_delay=we);let De=V('[name="popup_icon_style"]');De!==null&&(ne.popup_icon_style=De);let ut=V('[name="popup_icon_size"]');ut!==null&&(ne.popup_icon_size=ut);let Ct=V('[name="popup_icon_default"]:checked');if(Ct!==null)Ct==="__custom__"?ne.popup_icon_type="custom":(ne.popup_icon_type="default",ne.popup_icon_default=Ct);else{let ai=V('[name="popup_icon_type"]');ai!==null&&(ne.popup_icon_type=ai)}let Ft=V('[name="popup_icon_custom_url"]');Ft!==null&&(ne.popup_icon_custom_url=Ft);let qi=V('[name="header_avatar_default"]:checked');if(qi!==null)qi==="__custom__"?ne.header_avatar_type="custom":(ne.header_avatar_type="default",ne.header_avatar_default=qi);else{let ai=V('[name="header_avatar_type"]');ai!==null&&(ne.header_avatar_type=ai)}let pt=V('[name="header_avatar_url"]');pt!==null&&(ne.header_avatar_url=pt);let yi=V('[name="header_online_text"]');yi!==null&&(ne.header_online_text=yi);let Xt=Y('[name="popup_label_enabled"]');Xt!==null&&(ne.popup_label_enabled=Xt);let vt=V('[name="popup_label_text"]');vt!==null&&(ne.popup_label_text=vt);let Kt=V('[name="popup_label_mode"]');Kt!==null&&(ne.popup_label_mode=Kt);let st=V('[name="popup_label_size"]');st!==null&&(ne.popup_label_size=st);let ke=V('[name="popup_label_delay_seconds"]');ke!==null&&(ne.popup_label_delay_seconds=ke);let pe=V('[name="popup_label_auto_hide_seconds"]');pe!==null&&(ne.popup_label_auto_hide_seconds=pe);let Ke=Y('[name="popup_label_dismissible"]');Ke!==null&&(ne.popup_label_dismissible=Ke);let me=Y('[name="popup_label_show_on_desktop"]');me!==null&&(ne.popup_label_show_on_desktop=me);let he=Y('[name="popup_label_show_on_mobile"]');he!==null&&(ne.popup_label_show_on_mobile=he);let tt=V('[name="popup_label_frequency"]');tt!==null&&(ne.popup_label_frequency=tt);let wt=V('[name="popup_label_version"]');return wt!==null&&(ne.popup_label_version=wt),ne},U=B(),z=()=>v&&v.value||e.getAttribute("data-active-bot-id"),X=K=>{let V=z();V&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_popup_settings",{bot_id:V,...K}).then(Y=>{U=K,ot(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T){let Y=T;T=null,JSON.stringify(Y)!==JSON.stringify(U)&&X(Y)}}))},ie=K=>{if(!(!K||Object.keys(K).length===0)&&JSON.stringify(K)!==JSON.stringify(U)){if(I){T=K;return}X(K)}};zi.addEventListener("change",K=>{let V=K.target;V&&((V.matches('[name="popup_icon_default"]')||V.matches('select[name="popup_icon_style"]')||V.matches('[name="header_avatar_default"]')||V.matches(".aipkit_popup_hint_toggle_switch"))&&Qa(),(V.matches('[name="popup_position"]')||V.matches('[name="popup_delay"]')||V.matches('[name="popup_icon_style"]')||V.matches('[name="popup_icon_size"]')||V.matches('[name="popup_icon_default"]')||V.matches('[name="popup_icon_custom_url"]')||V.matches('[name="header_avatar_default"]')||V.matches('[name="header_avatar_url"]')||V.matches('[name="header_online_text"]')||V.matches('[name="popup_label_enabled"]')||V.matches('[name="popup_label_text"]')||V.matches('[name="popup_label_mode"]')||V.matches('[name="popup_label_size"]')||V.matches('[name="popup_label_delay_seconds"]')||V.matches('[name="popup_label_auto_hide_seconds"]')||V.matches('[name="popup_label_dismissible"]')||V.matches('[name="popup_label_show_on_desktop"]')||V.matches('[name="popup_label_show_on_mobile"]')||V.matches('[name="popup_label_frequency"]')||V.matches('[name="popup_label_version"]'))&&ie(B()))}),e.addEventListener("change",K=>{let V=K.target;!V||!V.matches||!(V.matches('[name="header_online_text"]')||V.matches('[name="popup_delay"]')||V.matches('[name="popup_label_enabled"]')||V.matches(".aipkit_popup_hint_toggle_switch")||V.matches('select[name="popup_position"]')||V.matches('select[name="popup_icon_style"]')||V.matches('select[name="popup_icon_size"]'))||((V.matches('[name="popup_label_enabled"]')||V.matches(".aipkit_popup_hint_toggle_switch"))&&Qa(),!zi.contains(V)&&ie(B()))}),Ee&&Ee.addEventListener("change",K=>{let V=K.target;V&&(V.matches('[name="popup_label_text"]')||V.matches('[name="popup_label_mode"]')||V.matches('[name="popup_label_size"]')||V.matches('[name="popup_label_delay_seconds"]')||V.matches('[name="popup_label_auto_hide_seconds"]')||V.matches('[name="popup_label_dismissible"]')||V.matches('[name="popup_label_show_on_desktop"]')||V.matches('[name="popup_label_show_on_mobile"]')||V.matches('[name="popup_label_frequency"]')||V.matches('[name="popup_label_version"]'))&&ie(B())}),Qa(),e.dataset.popupSettingsAutosaveBound="1"}if(D&&$i&&!e.dataset.conversationSettingsAutosaveBound){let I=!1,T=null,B=()=>{let K=Y=>{let ne=D&&D.querySelector(Y)||re&&re.querySelector(Y);return ne?ne.value:""},V=Y=>{let ne=D.querySelector(Y);return ne?ne.tagName==="SELECT"?ne.value==="1"?"1":"0":ne.checked?"1":"0":"0"};return{stream_enabled:V(".aipkit_stream_enable_toggle"),openai_conversation_state_enabled:V(".aipkit_stateful_convo_checkbox"),reasoning_effort:K('[name="reasoning_effort"]')}},U=B(),z=K=>{let V=v&&v.value||e.getAttribute("data-active-bot-id");V&&(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_conversation_settings",{bot_id:V,...K}).then(Y=>{U=K,ot(Y.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(V),Oi()}).catch(Y=>{ot(`Error: ${Y.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T){let Y=T;T=null,JSON.stringify(Y)!==JSON.stringify(U)&&z(Y)}}))},X=K=>{if(JSON.stringify(K)!==JSON.stringify(U)){if(I){T=K;return}z(K)}},ie=K=>{let V=K.target;V&&(V.matches(".aipkit_stream_enable_toggle")||V.matches(".aipkit_stateful_convo_checkbox")||V.matches(".aipkit_reasoning_effort_slider")||V.matches('[name="reasoning_effort"]'))&&(Yo(),X(B()))};D.addEventListener("change",ie),re&&re.addEventListener("change",ie),e.dataset.conversationSettingsAutosaveBound="1"}if(D&&$i&&!e.dataset.fileUploadAutosaveBound){let I=!1,T=null,B=()=>{let ie=D.querySelector('[name="enable_file_upload"]');return!ie||ie.disabled?"":ie.tagName==="SELECT"?ie.value==="1"?"1":"0":ie.checked?"1":"0"},U=B(),z=ie=>{let K=v&&v.value||e.getAttribute("data-active-bot-id");!K||ie===""||(I=!0,ot("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_file_upload_settings",{bot_id:K,enable_file_upload:ie}).then(V=>{U=ie,ot(V.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(K),Oi()}).catch(V=>{ot(`Error: ${V.message||"Failed to save."}`,"error")}).finally(()=>{if(I=!1,T!==null&&T!==U){let V=T;T=null,z(V)}else T=null}))},X=ie=>{if(!(ie===""||ie===U)){if(I){T=ie;return}z(ie)}};D.addEventListener("change",ie=>{let K=ie.target;K&&K.matches('[name="enable_file_upload"]')&&(X(B()),xe()==="1"?Et():ct())}),e.dataset.fileUploadAutosaveBound="1"}let Ur=v&&v.value||e.getAttribute("data-active-bot-id");if(Ur&&typeof window.aipkit_refreshChatPreview=="function"){window.aipkit_refreshChatPreview(Ur);return}let es=window.aipkit_dashboard?.text?.previewPlaceholderSelect||"Select a bot to see the preview.";c(es)}window.aipkit_initChatbotBuilder=n})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelector(".aipkit_token_limit_mode_select"),a=r.querySelector(".aipkit_token_general_user_limit_field"),s=r.querySelector(".aipkit_token_role_limits_container");if(!i||!a||!s){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let l=i.value;a.style.display=l==="general"?"block":"none",s.style.display=l==="role_based"?"block":"none"}function o(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Token Management JS: Main content container not found.");return}r.addEventListener("change",function(a){let s=a.target.closest(".aipkit_token_limit_mode_select");if(!s)return;let l=s.closest(".aipkit_accordion-content");l?k(l):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",s)}),r.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(a=>{let s=a.querySelector(".aipkit_accordion-content");s&&k(s)})}window.aipkit_initTokenManagementUI=o})();(function(){"use strict";function k(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let r=document.querySelector(".aipkit_chatbot_module_container");r&&(r.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js."),typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatSelectPickers=="function"?window.aipkit_initChatSelectPickers():console.error("AIPKit Chat Admin Main: aipkit_initChatSelectPickers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Chat Admin Main: aipkit_initSyncButtons function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles(".aipkit_chatbot_module_container"):console.error("AIPKit Chat Admin Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCustomThemePresets=="function"?window.aipkit_initCustomThemePresets():console.error("AIPKit Chat Admin Main: aipkit_initCustomThemePresets function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initChatbotBuilder=="function"&&window.aipkit_initChatbotBuilder(),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found.");let o=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(o){let r=o.dataset.botId,i=document.getElementById(`aipkit_trigger_builder_${r}`);r&&i&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(r):r&&i&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${r}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy(),function(){let i=document.querySelector(".aipkit_chatbot_module_container");i&&i.addEventListener("click",function(a){if(a.target.closest(".aipkit_header_reset_btn, .aipkit_header_delete_btn, .aipkit_actions_dropdown_container .aipkit_tab_dropdown_trigger"))return;if(a.target.closest("#aipkit_chatbot_header_save_btn")){let n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");n&&(typeof n.requestSubmit=="function"?n.requestSubmit():n.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})));return}if(a.target.closest(".aipkit_header_reset_btn")){let n=i.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");n&&(n.style.display="none");let t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form")?.dataset.botId,d=i.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",_=i.querySelector("#aipkit_header_action_feedback");if(!t||!_)return;_.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_reset_confirmation" id="aipkit_reset_confirmation_${t}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_inline">Confirm</button>
              </div>
            </div>`,_.querySelector(".aipkit_reset_cancel_inline")?.addEventListener("click",()=>{_.innerHTML=""},{once:!0}),_.querySelector(".aipkit_reset_confirm_inline")?.addEventListener("click",()=>{_.innerHTML='<span class="aipkit_action_status_message">Resetting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:t}).then(p=>{_.innerHTML=`<span class="aipkit_action_status_message success">${p.message||"Chatbot reset successfully!"}</span>`,typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:t,aipkit_silent:!0,aipkit_force_refresh:!0}),setTimeout(()=>{_.innerHTML=""},3e3)}).catch(p=>{_.innerHTML=`<span class="aipkit_action_status_message error">Error: ${p.message||"Failed to reset chatbot."}</span>`,setTimeout(()=>{_.innerHTML=""},4e3)})},{once:!0});return}if(a.target.closest(".aipkit_header_delete_btn")){let n=i.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");n&&(n.style.display="none");let e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),t=e?.dataset.botId,d=e?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",_=i.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",p=i.querySelector("#aipkit_header_action_feedback");if(!t||!p)return;if(d){p.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{p.innerHTML=""},3e3);return}p.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_delete_confirmation" id="aipkit_delete_confirmation_${t}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_inline">Confirm</button>
              </div>
            </div>`,p.querySelector(".aipkit_delete_cancel_inline")?.addEventListener("click",()=>{p.innerHTML=""},{once:!0}),p.querySelector(".aipkit_delete_confirm_inline")?.addEventListener("click",()=>{p.innerHTML='<span class="aipkit_action_status_message">Deleting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:t}).then(f=>{p.innerHTML=`<span class="aipkit_action_status_message success">${f.message||"Chatbot deleted successfully."}</span>`;let g=null,m=document.getElementById("aipkit_chatbot_main_selector_container");if(m){let u=Array.from(m.querySelectorAll(".aipkit_tab_dropdown_item[data-bot-id]")),w=u.filter(C=>{let x=C.getAttribute("data-bot-id");return x&&x!==String(t)}),h=u.findIndex(C=>C.getAttribute("data-bot-id")===String(t));if(h>0){let C=u[h-1],x=C?C.getAttribute("data-bot-id"):null;x&&x!==String(t)&&(g=x)}!g&&w.length>0&&(g=w[0].getAttribute("data-bot-id"))}if(typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("chatbot"),typeof window.aipkit_loadModule=="function"){let u=g?{force_active_bot_id:g}:{};u.aipkit_silent=!0,u.aipkit_force_refresh=!0,window.aipkit_loadModule("chatbot",u)}setTimeout(()=>{p.innerHTML=""},3e3)}).catch(f=>{p.innerHTML=`<span class="aipkit_action_status_message error">Error: ${f.message||"Failed to delete chatbot."}</span>`,setTimeout(()=>{p.innerHTML=""},4e3)})},{once:!0});return}})}()}window.aipkit_initChatbot=k})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"modified",sortDirection:"desc",isLoading:!1}})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_ai_forms_container"),a=window.aipkit_escapeHtml||(n=>n),s=wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n,l=wp.i18n&&wp.i18n._n?wp.i18n._n:null,c=wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:null;r&&(r.innerHTML="",!(!o||o.length===0)&&o.forEach(n=>{let e=window.aipkit_dashboard?.isProPlan??!1,t=window.aipkit_dashboard?.upgradeUrl||"#",d="",_="";if(e)d=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label">${s("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="pdf_download" value="true">
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`;else{let E=s("This is a Pro feature. Please upgrade.","gpt3-ai-content-generator");d=`
              <div class="aipkit_popover_option_row aipkit_popover_option_row--disabled">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label" data-tooltip="${a(E)}">${s("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch" disabled>
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`,_=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main aipkit_popover_option_main--stacked">
                      <p class="aipkit_form-help">${s("Save as PDF is available on the Pro plan.","gpt3-ai-content-generator")}</p>
                      <a class="aipkit_btn aipkit_btn-primary" href="${a(t)}" target="_blank" rel="noopener noreferrer">
                        ${s("Upgrade to Pro","gpt3-ai-content-generator")}
                      </a>
                  </div>
              </div>`}let p=r.insertRow(),f=p.insertCell();f.classList.add("aipkit_ai_form_title_cell");let g=a(n.title||s("Untitled","gpt3-ai-content-generator")),m=n.updated_at||n.updatedAt||n.updated||"",u="",w="";m&&(typeof window.aipkit_formatRelativeDateTime=="function"?u=window.aipkit_formatRelativeDateTime(m):typeof window.aipkit_formatUtcDateTime=="function"?u=window.aipkit_formatUtcDateTime(m):u=m,typeof window.aipkit_formatUtcDateTime=="function"&&(w=window.aipkit_formatUtcDateTime(m)));let h=n.submissions_count??n.submission_count??n.submissionsCount??0,C=Number.isFinite(Number(h))?Number(h):0,x=[];if(u){let E=c?c(s("Updated %s","gpt3-ai-content-generator"),u):`${s("Updated","gpt3-ai-content-generator")} ${u}`,A=w?` title="${a(w)}"`:"";x.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_updated"${A}>${a(E)}</span>`)}if(C>0){let E=`${C} ${s(C===1?"submission":"submissions","gpt3-ai-content-generator")}`;l&&c&&(E=c(l("%s submission","%s submissions",C,"gpt3-ai-content-generator"),C)),x.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_count">${a(E)}</span>`)}let v=x.length?`
          <span class="aipkit_ai_form_meta">
            ${x.join('<span class="aipkit_ai_form_meta_sep" aria-hidden="true">&middot;</span>')}
          </span>
        `:"";f.innerHTML=`
        <span class="aipkit_ai_form_title_text" title="${g}">${g}</span>
        ${v}
      `;let L=p.insertCell();L.classList.add("aipkit_ai_form_model_cell");let P=n.model||s("Default","gpt3-ai-content-generator");L.textContent=P,L.title=P;let b=p.insertCell();b.classList.add("aipkit_shortcode_cell","aipkit_ai_form_shortcode_cell");let y=`aipkit_ai_form_theme_${n.id}`;b.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${n.id}" readonly value="${a(n.shortcode)}" data-aipkit-shortcode-display="${n.id}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${n.id}" title="${s("Shortcode settings","gpt3-ai-content-generator")}" aria-label="${s("Shortcode settings","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-shortcode" aria-hidden="true"></span>
              <span class="screen-reader-text">${s("Shortcode settings","gpt3-ai-content-generator")}</span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator aipkit_model_settings_popover_panel" id="aif-configurator-${n.id}" style="display: none;" role="dialog" aria-modal="false" aria-labelledby="aif-shortcode-title-${n.id}">
            <div class="aipkit_model_settings_popover_header">
                <span class="aipkit_model_settings_popover_title" id="aif-shortcode-title-${n.id}">
                  ${s("Shortcode Settings","gpt3-ai-content-generator")}
                </span>
                <button
                    type="button"
                    class="aipkit_model_settings_popover_close aipkit_aiform_shortcode_close"
                    aria-label="${s("Close","gpt3-ai-content-generator")}"
                >
                    <span class="dashicons dashicons-no-alt"></span>
                </button>
            </div>
            <div class="aipkit_model_settings_popover_body">
                <div class="aipkit_popover_options_list">
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Show Provider Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="show_provider" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Show Model Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="show_model" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Copy Button","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="copy_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Save as Post","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="save_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    ${d}
                    ${_}
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <label class="aipkit_popover_option_label" for="${y}">
                              ${s("Theme","gpt3-ai-content-generator")}
                            </label>
                            <div class="aipkit_popover_option_actions">
                                <select id="${y}" class="aipkit_popover_option_select aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="theme">
                                    <option value="light">${s("Light (default)","gpt3-ai-content-generator")}</option>
                                    <option value="dark">${s("Dark","gpt3-ai-content-generator")}</option>
                                    <option value="custom">${s("Custom","gpt3-ai-content-generator")}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${s("Shortcode","gpt3-ai-content-generator")}</span>
                            <div class="aipkit_popover_option_actions">
                                <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" readonly value="${a(n.shortcode)}" data-aipkit-shortcode-display="${n.id}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="aipkit_popover_flyout_footer">
                <span class="aipkit_popover_flyout_footer_text">
                    ${s("Need help?","gpt3-ai-content-generator")}
                </span>
                <a
                    class="aipkit_popover_flyout_footer_link"
                    href="https://docs.aipower.org/docs/category/ai-forms"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    ${s("Documentation","gpt3-ai-content-generator")}
                </a>
            </div>
        </div>
      `,i&&typeof window.aipkitForms_applyStoredShortcodeConfig=="function"&&window.aipkitForms_applyStoredShortcodeConfig(n.id,i);let S=p.insertCell();S.classList.add("aipkit_form_actions_cell"),S.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_edit_ai_form_btn" data-form-id="${n.id}" title="${s("Edit","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            ${s("Edit","gpt3-ai-content-generator")}
          </button>
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_preview_ai_form_btn" data-form-id="${n.id}" data-form-title="${a(n.title||"")}" title="${s("Preview","gpt3-ai-content-generator")}" aria-label="${s("Preview","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-visibility" aria-hidden="true"></span>
            <span class="screen-reader-text">${s("Preview","gpt3-ai-content-generator")}</span>
          </button>
          <div class="aipkit_actions_menu">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_actions_menu_toggle" title="${s("More actions","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-ellipsis"></span>
            </button>
            <div class="aipkit_actions_dropdown_menu">
              <button type="button" class="aipkit_dropdown-item-btn aipkit_duplicate_ai_form_btn" data-form-id="${n.id}" title="${s("Duplicate","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-page"></span>
                <span>${s("Duplicate","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_export_ai_form_btn" data-form-id="${n.id}" title="${s("Export","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-download"></span>
                <span>${s("Export","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_dropdown-item--danger aipkit_delete_ai_form_btn" data-form-id="${n.id}" data-form-title="${a(n.title)}" title="${s("Delete","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-trash"></span>
                <span>${s("Delete","gpt3-ai-content-generator")}</span>
              </button>
            </div>
          </div>
        </div>
      `}))}window.aipkitForms_renderTable=k})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsListState,i=document.getElementById("aipkit_ai_forms_pagination"),a=document.getElementById("aipkit_ai_forms_count_summary");if(!i||!o||!r)return;let s=wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,l=wp.i18n&&wp.i18n._n?wp.i18n._n:(t,d,_)=>_===1?t:d;i.innerHTML="";let{total_forms:c,total_pages:n}=o,e=r.currentPage;if(a){let t=l("form","forms",c,"gpt3-ai-content-generator");a.textContent=`${c.toLocaleString()} ${t}`}if(!(c<=0)&&n>1){let t=document.createElement("span");t.className="aipkit_pagination-links";let d=document.createElement("button");d.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",d.innerHTML=`\xAB ${s("Previous","gpt3-ai-content-generator")}`,d.disabled=e<=1,t.appendChild(d);let _=document.createElement("span");_.className="aipkit_pagination-current",_.textContent=`${s("Page","gpt3-ai-content-generator")} ${e} ${s("of","gpt3-ai-content-generator")} ${n}`,t.appendChild(_);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",p.innerHTML=`${s("Next","gpt3-ai-content-generator")} \xBB`,p.disabled=e>=n,t.appendChild(p),i.appendChild(t)}}window.aipkitForms_renderPagination=k})();(function(){"use strict";function k(){let o=window.aipkitAIFormsListState;if(!o||o.isLoading)return;o.isLoading=!0;let r=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_no_ai_forms_message"),a=document.getElementById("aipkit_ai_forms_pagination");r&&(r.innerHTML='<tr><td colspan="4" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),i&&(i.style.display="none"),a&&(a.innerHTML="");let l={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:o.currentPage,search:o.searchQuery,sort_by:o.sortColumn,sort_order:o.sortDirection};window.aipkit_apiRequest("aipkit_list_ai_forms",l).then(c=>{if(typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(c.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(c.pagination||{}),i&&(!c.forms||c.forms.length===0)){i.style.display="block";let n=!!o.searchQuery&&o.searchQuery.trim().length>0;i.textContent=n?"No forms found matching your search.":"No AI Forms have been created yet."}}).catch(c=>{r&&(r.innerHTML=`<tr><td colspan="4" style="color:red;text-align:center;">Error loading forms: ${c.message}</td></tr>`)}).finally(()=>{o.isLoading=!1})}window.aipkitForms_fetchForms=k})();(function(){"use strict";let k;function o(){let r=document.getElementById("aipkit_ai_forms_list_container");if(!r||r.dataset.listListenersAttached)return;r.dataset.listListenersAttached="true";let i=window.aipkitAIFormsListState;if(!i){console.error("AI Forms Events: List state object is not available.");return}r.addEventListener("click",function(s){let l=s.target,c=l.closest(".aipkit-sortable-col");if(c){let n=c.dataset.sortKey;i.sortColumn===n?i.sortDirection=i.sortDirection==="asc"?"desc":"asc":(i.sortColumn=n,i.sortDirection="asc"),i.currentPage=1,r.querySelectorAll(".aipkit-sortable-col").forEach(e=>e.removeAttribute("data-sort-direction")),c.setAttribute("data-sort-direction",i.sortDirection),window.aipkitForms_fetchForms();return}if(l.matches(".aipkit_pagination_prev")){i.currentPage>1&&(i.currentPage--,window.aipkitForms_fetchForms());return}if(l.matches(".aipkit_pagination_next")){i.currentPage++,window.aipkitForms_fetchForms();return}});let a=r.querySelector("#aipkit_ai_forms_search_input");a&&a.addEventListener("input",function(){clearTimeout(k),k=setTimeout(()=>{i.searchQuery=this.value,i.currentPage=1,window.aipkitForms_fetchForms()},400)})}window.aipkitForms_attachListEventListeners=o})();(function(){"use strict";function k(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=k})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=o.querySelector("#aipkit_ai_form_elements_palette"),a=o.querySelector("#aipkit_ai_form_designer_area"),s=o.querySelector("#aipkit_form_designer_placeholder");if(!i||!a){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&a.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(c=>{c.dataset.dragStartListenerAttached!=="true"&&(c.addEventListener("dragstart",n=>{r.draggedElementType=n.target.dataset.elementType,n.dataTransfer.setData("text/plain",r.draggedElementType),n.dataTransfer.effectAllowed="copy",n.target.classList.add("aipkit-dragging"),r.draggedElement=null}),c.addEventListener("dragend",n=>{n.target.classList.remove("aipkit-dragging"),r.draggedElementType=null}),c.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",a.dataset.dragListenersAttached!=="true"&&(a.addEventListener("dragstart",c=>{c.target.classList.contains("aipkit_dropped_element")&&(r.draggedElement=c.target,c.dataTransfer.setData("text/element-id",c.target.id),c.dataTransfer.effectAllowed="move",setTimeout(()=>{r.draggedElement&&(r.draggedElement.style.opacity="0.5")},0),r.draggedElementType=null)}),a.addEventListener("dragend",c=>{r.draggedElement&&(r.draggedElement.style.opacity="1",r.draggedElement=null)}),a.addEventListener("dragover",c=>{c.preventDefault();let n=c.target.closest(".aipkit_dropped_element");a.classList.add("aipkit-drag-over"),r.draggedElement&&n&&r.draggedElement!==n?c.dataTransfer.dropEffect="move":c.dataTransfer.dropEffect="copy"}),a.addEventListener("dragleave",c=>{a.contains(c.relatedTarget)||a.classList.remove("aipkit-drag-over")}),a.addEventListener("drop",c=>{c.preventDefault(),a.classList.remove("aipkit-drag-over");let n=c.dataTransfer.getData("text/element-id");if(r.draggedElement&&n===r.draggedElement.id){let e=c.target.closest(".aipkit_dropped_element"),t=null;if(e&&e!==r.draggedElement){let d=e.getBoundingClientRect();t=c.clientY>d.top+d.height/2?e.nextSibling:e}a.insertBefore(r.draggedElement,t),r.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){if(s&&s.style.display!=="none"&&(s.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let e=window.aipkitForms_createNewFormElementData(r.draggedElementType);r.formStructure.push(e),window.aipkitForms_renderDroppedElement(a,e,null)}r.draggedElementType=null,r.draggedElement=null}),a.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=k})();(function(){"use strict";function k(){let o=window.aipkitAIFormsState,r=document.getElementById("aipkit_ai_form_designer_area");if(!r)return;let i=[];r.querySelectorAll(".aipkit_layout_row").forEach(s=>{let l=s.id,c=o.formStructure.find(t=>t.internalId===l);if(!c)return;let n={internalId:l,type:"layout-row",columns:[]};s.querySelectorAll(".aipkit_layout_column").forEach(t=>{let d=t.id,_=c.columns.find(g=>g.internalId===d);if(!_)return;let p={internalId:d,width:_.width,elements:[]};t.querySelectorAll(".aipkit_dropped_element").forEach(g=>{let m=g.id,u=null;o.formStructure.forEach(w=>{w.columns.forEach(h=>{let C=h.elements.find(x=>x.internalId===m);C&&(u=C)})}),u&&p.elements.push(u)}),n.columns.push(p)}),i.push(n)}),o.formStructure=i}window.aipkitForms_updateFormStructureOrder=k})();(function(){"use strict";function k(r){let i=window.aipkitAIFormsState;i.droppedElementCounter++;let a=`field_${r.replace(/-/g,"_")}_${i.droppedElementCounter}`;switch(r){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:r,label:`New ${r.replace(/-/g," ").replace(/\b\w/g,c=>c.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:a,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let s,l;return r==="select"?(s="New Dropdown",l="select"):r==="radio-button"?(s="New Radio Buttons",l="radio"):(s="New Checkbox Group",l="checkbox"),{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:r,label:s,fieldId:`${l}_${i.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${i.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function o(r){let i=Date.now(),a=[];switch(r){case"1-col":a=[{internalId:`col-${i}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":a=[{internalId:`col-${i}-1`,width:"50%",elements:[]},{internalId:`col-${i}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":a=[{internalId:`col-${i}-1`,width:"33.33%",elements:[]},{internalId:`col-${i}-2`,width:"33.33%",elements:[]},{internalId:`col-${i}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":a=[{internalId:`col-${i}-1`,width:"30%",elements:[]},{internalId:`col-${i}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":a=[{internalId:`col-${i}-1`,width:"70%",elements:[]},{internalId:`col-${i}-2`,width:"30%",elements:[]}];break;default:a=[{internalId:`col-${i}-1`,width:"100%",elements:[]}]}return{internalId:`row-${i}`,type:"layout-row",columns:a}}window.aipkitForms_createNewFormElementData=k,window.aipkitForms_createNewLayoutData=o})();(function(){"use strict";function k(o,r,i=null){let a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,s=window.aipkit_escapeHtml||function(p){return p},l=document.createElement("div");l.className="aipkit_dropped_element",l.id=r.internalId,l.dataset.elementType=r.type;let c=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${a("Drag to reorder","gpt3-ai-content-generator")}"></span>`,n="",e=`${r.internalId}-field`,t="";switch(r.helpText&&(t=`<p class="aipkit_dropped_element_help_text">${s(r.helpText)}</p>`),r.type){case"text-input":n=`<label class="aipkit_dropped_element_label" for="${e}">${s(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${e}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${s(r.placeholder)}" readonly>
                    ${t}`;break;case"textarea":n=`<label class="aipkit_dropped_element_label" for="${e}">${s(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${e}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${s(r.placeholder)}" readonly></textarea>
                    ${t}`;break;case"select":let p="";r.options&&r.options.length>0?r.options.forEach(m=>{p+=`<option value="${s(m.value)}">${s(m.text)}</option>`}):p=`<option>${a("No options configured","gpt3-ai-content-generator")}</option>`,n=`<label class="aipkit_dropped_element_label" for="${e}">${s(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${e}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${p}</select>
                    ${t}`;break;case"radio-button":let f="";r.options&&r.options.length>0?r.options.forEach((m,u)=>{let w=`${e}-${u}`;f+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${w}" class="aipkit_dropped_element_field" name="preview-${r.internalId}" disabled>
                                    <label for="${w}">${s(m.text)}</label>
                                </div>`}):f=`<p class="aipkit-no-options-note">${a("No options configured","gpt3-ai-content-generator")}</p>`,n=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${s(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${f}
                    </fieldset>
                    ${t}`;break;case"checkbox":let g="";r.options&&r.options.length>0?r.options.forEach((m,u)=>{let w=`${e}-${u}`;g+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${w}" class="aipkit_dropped_element_field" name="preview-${r.internalId}-${u}" disabled>
                                    <label for="${w}">${s(m.text)}</label>
                                </div>`}):g=`<p class="aipkit-no-options-note">${a("No options configured","gpt3-ai-content-generator")}</p>`,n=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${s(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${g}
                    </fieldset>
                    ${t}`;break;case"file-upload":n=`<label class="aipkit_dropped_element_label" for="${e}">${s(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${e}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${t}`;break;default:n=`<p>${s(r.label)}</p>${t}`}let d=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${a("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,_=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${a("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;l.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${n}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${c}
            ${d}
            ${_}
        </div>
    `,i?o.insertBefore(l,i):o.appendChild(l)}window.aipkitForms_renderFieldInColumn=k,window.aipkitForms_renderDroppedElement=k})();(function(){"use strict";function k(o,r){let i=window.aipkitAIFormsState,a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c;if(!r){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let s=r.querySelector("#aipkit_ai_form_designer_area");if(!s){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let l=s.querySelector(`#${CSS.escape(o)}`);if(l&&(l.remove(),i.formStructure.forEach(c=>{c.columns.forEach(n=>{n.elements=n.elements.filter(e=>e.internalId!==o)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r),i.selectedDesignerElementId===o&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(r):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),s.querySelectorAll(".aipkit_dropped_element").length===0&&s.querySelectorAll(".aipkit_layout_row").length===0)){let c=s.querySelector("#aipkit_form_designer_placeholder");c||(c=document.createElement("div"),c.className="aipkit_form_designer_placeholder",c.id="aipkit_form_designer_placeholder",c.innerHTML=`<span class="dashicons dashicons-layout"></span>${a("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,s.appendChild(c)),c.style.display="flex"}}window.aipkitForms_deleteDroppedElement=k})();(function(){"use strict";function k(){let o=window.aipkitAIFormsState,r=wp.i18n&&wp.i18n.__?wp.i18n.__:g=>g,i=document.getElementById("aipkit_form_editor_container");if(!i)return;let a=i.querySelector("#aipkit_ai_form_prompt_template"),s=i.querySelector("#aipkit_prompt_validation_results");if(!a||!s)return;let l=a.value,c=[],n=[],e=new Set;o.formStructure.forEach(g=>{g.columns.forEach(m=>{m.elements.forEach(u=>{u.fieldId&&e.add(u.fieldId)})})});let t=/{[a-zA-Z0-9_]+}/g,d=(l.match(t)||[]).map(g=>g.slice(1,-1)),_=new Set(d);d.forEach(g=>{e.has(g)||c.push(`Variable <code>{${g}}</code> is used in the prompt but not defined as a form field.`)}),e.forEach(g=>{_.has(g)||n.push(`Field <code>{${g}}</code> is defined but not used in the prompt.`)});let p=l;if(d.forEach(g=>{let m=new RegExp(`\\{${g}\\}`,"g");p=p.replace(m,"")}),/[{}]/.test(p)&&c.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),s.className="aipkit_form-help",s.innerHTML="",c.length>0){s.classList.add("aipkit-validation-error");let g=`<strong>${r("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;c.forEach(m=>{g+=`<li>${m}</li>`}),g+="</ul>",s.innerHTML=g}else{s.classList.add("aipkit-validation-success");let g=`<strong>${r("Validation Passed!","gpt3-ai-content-generator")}</strong> (${d.length} of ${e.size} fields used).`;n.length>0&&(g+=`<br><strong>${r("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,n.forEach(m=>{g+=`<li>${m}</li>`}),g+="</ul>"),s.innerHTML=g}s.style.display="block",s.dismissTimer&&clearTimeout(s.dismissTimer);let f=c.length>0?8e3:5e3;s.dismissTimer=setTimeout(()=>{s.style.display="none",s.innerHTML=""},f)}window.aipkitForms_validatePrompt=k})();(function(){"use strict";function k(o,r){let i=window.aipkitAIFormsState,a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p,l=window.aipkit_escapeHtml||function(p){return p};if(!r){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}r.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(p=>p.classList.remove("aipkit-element-selected"));let c=r.querySelector(`#${CSS.escape(o)}`);c&&c.classList.add("aipkit-element-selected"),i.selectedDesignerElementId=o;let n=null;for(let p of i.formStructure){for(let f of p.columns){let g=f.elements.find(m=>m.internalId===o);if(g){n=g;break}}if(n)break}if(!n){console.error(`showSettingsPanel: Could not find element data for ID ${o} in state.`,i.formStructure);return}let e=r.querySelector("#aipkit_ai_form_elements_palette"),t=r.querySelector("#aipkit_ai_form_element_settings_panel"),d=t?t.querySelector("#aipkit_settings_panel_fields"):null,_=t?t.querySelector("#aipkit_settings_panel_element_type"):null;if(!e||!t||!d||!_){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(_.textContent=`(${n.type.replace(/-/g," ").replace(/\b\w/g,p=>p.toUpperCase())})`,d.innerHTML="",d.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${n.internalId}">${s(a.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${n.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="label" value="${l(n.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${n.internalId}">${s(a.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${n.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="fieldId" value="${l(n.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${s("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${s(a.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(n.type==="text-input"||n.type==="textarea")&&(d.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${n.internalId}">${s(a.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${n.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="placeholder" value="${l(n.placeholder||"")}">
                </div>`),d.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${n.internalId}">
                    <input type="checkbox" id="setting-required-${n.internalId}" class="aipkit-setting-field" data-setting="required" ${n.required?"checked":""}>
                    ${s(a.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${n.internalId}">${s("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${n.internalId}" class="aipkit_form-input aipkit_builder_textarea aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${l(s("This text will appear under the field.","gpt3-ai-content-generator"))}">${l(n.helpText||"")}</textarea>
            </div>
        `,n.type==="select"||n.type==="radio-button"||n.type==="checkbox"){let p=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${s(a.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(n.options||[]).forEach((f,g)=>{p+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-value" data-option-index="${g}" value="${l(f.value)}" placeholder="${s(a.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-text" data-option-index="${g}" value="${l(f.text)}" placeholder="${s(a.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${s(a.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),p+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${s(a.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,d.innerHTML+=p}e.style.display="none",t.style.display="block"}window.aipkitForms_showSettingsPanel=k})();(function(){"use strict";function k(o){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n;if(!o){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let a=o.querySelector("#aipkit_ai_form_element_settings_panel");if(!a){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let s=a.querySelector("#aipkit_select_options_container");if(!s){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let l=s.querySelectorAll(".aipkit_select_option_row").length,c=document.createElement("div");c.className="aipkit_select_option_row",c.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${l}" placeholder="${i(r.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${l}" placeholder="${i(r.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${i(r.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,s.appendChild(c)}window.aipkitForms_addSelectOptionRow=k})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}o.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(s=>s.classList.remove("aipkit-element-selected")),r.selectedDesignerElementId=null;let i=o.querySelector("#aipkit_ai_form_elements_palette"),a=o.querySelector("#aipkit_ai_form_element_settings_panel");i&&(i.style.display="block"),a&&(a.style.display="none")}window.aipkitForms_hideSettingsPanel=k})();(function(){"use strict";function k(o,r){let i=window.aipkitAIFormsState,a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f;if(!r){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let l=null;for(let f of i.formStructure){for(let g of f.columns){let m=g.elements.find(u=>u.internalId===o);if(m){l=m;break}}if(l)break}if(!l){console.error(`updateElementFromSettingsPanel: Element data for ID ${o} not found.`);return}let c=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!c){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let n=c.querySelector('input[data-setting="label"]');n&&(l.label=n.value);let e=c.querySelector('input[data-setting="fieldId"]');if(e){let f=e.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!f){let m=l.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");m||(m=l.type.replace(/-/g,"_")),f=`${m}_${o.split("-").pop()}`}let g=!0;e:for(let m of i.formStructure)for(let u of m.columns)if(u.elements.some(w=>w.internalId!==o&&w.fieldId===f)){g=!1;break e}g&&f.length>0?(l.fieldId=f,e.value=f,e.classList.remove("aipkit_input_error")):f.length>0&&e.classList.add("aipkit_input_error")}let t=c.querySelector('input[data-setting="required"]');t&&(l.required=t.checked);let d=c.querySelector('textarea[data-setting="helpText"]');if(d&&(l.helpText=d.value),l.type==="text-input"||l.type==="textarea"){let f=c.querySelector('input[data-setting="placeholder"]');f&&(l.placeholder=f.value)}(l.type==="select"||l.type==="radio-button"||l.type==="checkbox")&&(l.options=[],c.querySelectorAll(".aipkit_select_option_row").forEach(g=>{let m=g.querySelector('input[data-setting="option-value"]'),u=g.querySelector('input[data-setting="option-text"]');m&&u&&m.value.trim()!==""?l.options.push({value:m.value,text:u.value}):m&&u&&m.value.trim()===""&&u.value.trim()!==""&&l.options.push({value:u.value,text:u.value})}));let _=r.querySelector("#aipkit_ai_form_designer_area"),p=_?_.querySelector(`#${CSS.escape(o)}`):null;if(p&&_){let f=p.parentElement,g=_.scrollTop,m=p.classList.contains("aipkit-element-selected"),u=p.nextElementSibling;if(p.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(f,l,u):console.error("AI Forms updateElement: renderFieldInColumn function missing."),m){let w=_.querySelector(`#${CSS.escape(o)}`);w&&w.classList.add("aipkit-element-selected")}_.scrollTop=g}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r)}window.aipkitForms_updateElementFromSettingsPanel=k})();(function(){"use strict";function k(a){let s=window.aipkitAIFormsState;if(!a)return;let l=a.querySelector("#aipkit_prompt_snippets_container");if(!l)return;l.innerHTML="";let c=new Set;if(s.formStructure.forEach(n=>{n.columns.forEach(e=>{e.elements.forEach(t=>{t.fieldId&&c.add(t.fieldId)})})}),c.size>0){let n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e;c.forEach(e=>{let t=document.createElement("button");t.type="button",t.className="aipkit_prompt_snippet",t.dataset.fieldId=e,t.title=n("Click to copy","gpt3-ai-content-generator"),t.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${e}}`,l.appendChild(t)})}}function o(a){if(!a)return;let s=a.querySelector("#aipkit_form_editor_container");if(!s){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let l=s.querySelector("#aipkit_prompt_snippets_container");if(!l){console.warn("AI Forms: Prompt snippets container not found for init.");return}l.dataset.listenerAttached!=="true"&&(l.addEventListener("click",function(c){let n=c.target.closest(".aipkit_prompt_snippet");if(!n)return;let e=n.dataset.fieldId;e&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${e}}`,n)}),l.dataset.listenerAttached="true")}function r(a,s){if(!a)return;let l=a.querySelector("#aipkit_ai_form_ai_provider");l&&(l.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(s?l.dataset.aipkitProviderNoticeArmed="true":delete l.dataset.aipkitProviderNoticeArmed),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(a))}function i(a=null,s){let l=window.aipkitAIFormsState,c=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:g=>g,e=window.aipkit_escapeHtml||function(g){return g};if(!s){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}l.currentFormId=a,l.droppedElementCounter=0,l.formStructure=[],l.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(s):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let t=s.querySelector("#aipkit_form_editor_container"),d=s.querySelector("#aipkit_ai_forms_list_container"),_=s.querySelector("#aipkit_ai_forms_editor_actions"),p=s.querySelector("#aipkit_create_new_ai_form_btn"),f=s.querySelector("#aipkit_ai_forms_settings_trigger");d.style.display="none",t.style.display="block",_&&(_.style.display="flex"),p&&(p.style.display="none"),f&&(f.style.display="none"),requestAnimationFrame(()=>{let g=()=>{typeof window.aipkitForms_refreshSelectPickers=="function"&&window.aipkitForms_refreshSelectPickers(s)},m=s.querySelector("#aipkit_ai_form_title"),u=t.querySelector("#aipkit_ai_form_prompt_template"),w=t.querySelector("#aipkit_ai_form_id"),h=t.querySelector("#aipkit_ai_form_designer_area"),C=t.querySelector("#aipkit_ai_form_ai_provider"),x=t.querySelector("#aipkit_ai_form_ai_model"),v=t.querySelector("#aipkit_ai_form_temperature"),L=t.querySelector("#aipkit_ai_form_temperature_value"),P=t.querySelector("#aipkit_ai_form_max_tokens"),b=t.querySelector("#aipkit_ai_form_max_tokens_value"),y=t.querySelector("#aipkit_ai_form_top_p"),S=t.querySelector("#aipkit_ai_form_top_p_value"),E=t.querySelector("#aipkit_ai_form_frequency_penalty"),A=t.querySelector("#aipkit_ai_form_frequency_penalty_value"),M=t.querySelector("#aipkit_ai_form_presence_penalty"),$=t.querySelector("#aipkit_ai_form_presence_penalty_value"),W=s.querySelector("#aipkit_preview_ai_form_btn"),H=()=>{let Q=document.createElement("div");return Q.className="aipkit_form_designer_placeholder",Q.id="aipkit_form_designer_placeholder",Q.innerHTML=`<span class="dashicons dashicons-layout"></span>${n("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,Q};if(!t||!d||!m||!u||!w||!h||!C||!x||!v||!P||!W||!L||!b||!y||!S||!E||!A||!M||!$){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:s.innerHTML.substring(0,500)});return}let N=s.querySelector("#aipkit_ai_forms_header_title_default"),G=s.querySelector("#aipkit_ai_forms_header_title_editor"),J=s.querySelector("#aipkit_ai_forms_title_display"),F=s.querySelector("#aipkit_ai_forms_title_text"),q=n("New Form","gpt3-ai-content-generator"),O=()=>{if(!F||!J||!m)return;let fe=m.value.trim()||q;F.textContent=fe,J.setAttribute("title",fe)},R=()=>{!J||!m||(J.style.display="none",m.style.display="inline-block",m.focus(),m.select())},D=()=>{!J||!m||(m.style.display="none",J.style.display="inline-flex",O())};N&&(N.style.display="none"),G&&(G.style.display="flex"),G&&G.dataset.inlineTitleBound!=="true"&&J&&m&&(J.addEventListener("click",R),m.addEventListener("blur",D),m.addEventListener("keydown",Q=>{Q.key==="Enter"&&(Q.preventDefault(),m.blur())}),m.addEventListener("input",O),G.dataset.inlineTitleBound="true"),m.value="",u.value="",w.value="",h.innerHTML="",h.appendChild(H()),D(),k(s);let Z={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Engine",model_label:"Model"};if(t.querySelectorAll('input[name^="labels["]').forEach(Q=>{let fe=Q.name.match(/labels\[(.+)\]/),Ae=fe?fe[1]:null;Ae&&Z[Ae]!==void 0?Q.value=Z[Ae]:Q.value=""}),!a){if(C.value="OpenAI",v&&L){let Q=window.aipkit_dashboard?.ai_params?.temperature||1;v.value=Q,L.textContent=Q}if(P&&b){let Q=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;P.value=Q,b.textContent=Q}if(y&&S){let Q=window.aipkit_dashboard?.ai_params?.top_p||1;y.value=Q,S.textContent=Q}if(E&&A){let Q=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;E.value=Q,A.textContent=Q}if(M&&$){let Q=window.aipkit_dashboard?.ai_params?.presence_penalty||0;M.value=Q,$.textContent=Q}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(t)),typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(C.value,t),g(),r(t,!0)}a?(W.disabled=!1,w.value=a,h.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${n("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:a,_ajax_nonce:c.nonce_manage_forms}).then(Q=>{if(Q.form){m.value=Q.form.title||"",D(),u.value=Q.form.prompt_template||"",C.value=Q.form.ai_provider||"OpenAI",v&&L&&(v.value=Q.form.temperature,L.textContent=Q.form.temperature),P&&b&&(P.value=Q.form.max_tokens,b.textContent=Q.form.max_tokens),y&&S&&(y.value=Q.form.top_p,S.textContent=Q.form.top_p),E&&A&&(E.value=Q.form.frequency_penalty,A.textContent=Q.form.frequency_penalty),M&&$&&(M.value=Q.form.presence_penalty,$.textContent=Q.form.presence_penalty);let fe=Q.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(Jt=>{let Gt=t.querySelector(`input[name="labels[${Jt}]"]`);Gt&&(Gt.value=fe[Jt]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(C.value,Q.form.ai_model);let We=t.querySelector("#aipkit_ai_form_reasoning_effort");We&&(We.value=Q.form.reasoning_effort||""),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(t);let Ge=t.querySelector('input[name="enable_vector_store"]'),it=Ge?Ge.closest('[data-aipkit-settings-panel="context"]'):null;if(it){let Jt=it.querySelector('select[name="vector_store_provider"]'),Gt=it.querySelector('select[name="openai_vector_store_ids[]"]'),Di=it.querySelector('select[name="pinecone_index_name"]'),bt=it.querySelector('select[name="qdrant_collection_name"]'),di=it.querySelector(".aipkit_vector_embedding_select"),Ht=it.querySelector('select[name="vector_embedding_provider"]'),Wi=it.querySelector('select[name="vector_embedding_model"]'),Sn=it.querySelector('input[name="vector_store_top_k"]'),Ki=it.querySelector("#aipkit_ai_form_vector_store_top_k_value"),ln=it.querySelector('input[name="vector_store_confidence_threshold"]'),Vn=it.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");if(Ge.checked=Q.form.enable_vector_store==="1",Jt&&(Jt.value=Q.form.vector_store_provider||"openai"),Di&&(Di.value=Q.form.pinecone_index_name||""),Di&&Q.form.pinecone_index_name&&!Array.from(Di.options).some(_e=>_e.value===Q.form.pinecone_index_name)){let _e=new Option(`${Q.form.pinecone_index_name}`,Q.form.pinecone_index_name,!1,!0);Di.appendChild(_e),Di.value=Q.form.pinecone_index_name}if(bt){let _e=Array.isArray(Q.form.qdrant_collection_names)?Q.form.qdrant_collection_names[0]:Q.form.qdrant_collection_name||"";if(_e&&!Array.from(bt.options).some(be=>be.value===_e)){let be=new Option(`${_e}`,_e,!1,!0);bt.appendChild(be)}_e&&(bt.value=_e)}if(Ht&&(Ht.value=Q.form.vector_embedding_provider||"openai"),Sn&&Ki){let _e=Q.form.vector_store_top_k||3;Sn.value=_e,Ki.textContent=_e}if(ln&&Vn){let _e=Q.form.vector_store_confidence_threshold||20;ln.value=_e,Vn.textContent=_e+"%"}if(Gt&&Q.form.openai_vector_store_ids&&Array.isArray(Q.form.openai_vector_store_ids)){let _e=new Set(Array.from(Gt.options).map(be=>be.value));Q.form.openai_vector_store_ids.forEach((be,Pe)=>{if(be&&!_e.has(be)){let At=new Option(be,be,!1,!0);Gt.appendChild(At),_e.add(be)}}),Array.from(Gt.options).forEach(be=>{be.selected=Q.form.openai_vector_store_ids.includes(be.value)})}typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(it),Wi&&(Wi.value=Q.form.vector_embedding_model||""),typeof window.aipkitForms_syncEmbeddingSelectFromInputs=="function"&&window.aipkitForms_syncEmbeddingSelectFromInputs(it,di),Ge.dispatchEvent(new Event("change",{bubbles:!0}))}let _t=t.querySelector('input[name="openai_web_search_enabled"]'),mt=t.querySelector('input[name="claude_web_search_enabled"]'),Ot=t.querySelector('input[name="openrouter_web_search_enabled"]'),Nt=t.querySelector('input[name="google_search_grounding_enabled"]');_t&&(_t.checked=Q.form.openai_web_search_enabled==="1"),mt&&(mt.checked=Q.form.claude_web_search_enabled==="1"),Ot&&(Ot.checked=Q.form.openrouter_web_search_enabled==="1"),Nt&&(Nt.checked=Q.form.google_search_grounding_enabled==="1");let Ie=t.querySelector('select[name="openai_web_search_context_size"]'),qt=t.querySelector('select[name="openai_web_search_loc_type"]'),Wt=t.querySelector('input[name="openai_web_search_loc_country"]'),ui=t.querySelector('input[name="openai_web_search_loc_city"]'),ae=t.querySelector('input[name="openai_web_search_loc_region"]'),Ce=t.querySelector('input[name="openai_web_search_loc_timezone"]');Ie&&(Ie.value=Q.form.openai_web_search_context_size||"medium"),qt&&(qt.value=Q.form.openai_web_search_loc_type||"none"),Wt&&(Wt.value=Q.form.openai_web_search_loc_country||""),ui&&(ui.value=Q.form.openai_web_search_loc_city||""),ae&&(ae.value=Q.form.openai_web_search_loc_region||""),Ce&&(Ce.value=Q.form.openai_web_search_loc_timezone||"");let Le=t.querySelector('input[name="claude_web_search_max_uses"]'),Oe=t.querySelector('select[name="claude_web_search_loc_type"]'),$e=t.querySelector('input[name="claude_web_search_loc_country"]'),He=t.querySelector('input[name="claude_web_search_loc_city"]'),je=t.querySelector('input[name="claude_web_search_loc_region"]'),Qe=t.querySelector('input[name="claude_web_search_loc_timezone"]'),xt=t.querySelector('input[name="claude_web_search_allowed_domains"]'),bi=t.querySelector('input[name="claude_web_search_blocked_domains"]'),gt=t.querySelector('select[name="claude_web_search_cache_ttl"]');Le&&(Le.value=Q.form.claude_web_search_max_uses||"5"),Oe&&(Oe.value=Q.form.claude_web_search_loc_type||"none"),$e&&($e.value=Q.form.claude_web_search_loc_country||""),He&&(He.value=Q.form.claude_web_search_loc_city||""),je&&(je.value=Q.form.claude_web_search_loc_region||""),Qe&&(Qe.value=Q.form.claude_web_search_loc_timezone||""),xt&&(xt.value=Q.form.claude_web_search_allowed_domains||""),bi&&(bi.value=Q.form.claude_web_search_blocked_domains||""),gt&&(gt.value=Q.form.claude_web_search_cache_ttl||"none");let It=t.querySelector('select[name="openrouter_web_search_engine"]'),ze=t.querySelector('input[name="openrouter_web_search_max_results"]'),Ye=t.querySelector('input[name="openrouter_web_search_search_prompt"]');It&&(It.value=Q.form.openrouter_web_search_engine||"auto"),ze&&(ze.value=Q.form.openrouter_web_search_max_results||"5"),Ye&&(Ye.value=Q.form.openrouter_web_search_search_prompt||"");let Ze=t.querySelector('select[name="google_grounding_mode"]'),ei=t.querySelector('input[name="google_grounding_dynamic_threshold"]'),ci=t.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(Ze&&(Ze.value=Q.form.google_grounding_mode||"DEFAULT_MODE"),ei){let Jt=Q.form.google_grounding_dynamic_threshold||.3;ei.value=Jt,ci&&(ci.textContent=Jt)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(C.value,t),_t&&_t.dispatchEvent(new Event("change",{bubbles:!0})),mt&&mt.dispatchEvent(new Event("change",{bubbles:!0})),Ot&&Ot.dispatchEvent(new Event("change",{bubbles:!0})),Nt&&Nt.dispatchEvent(new Event("change",{bubbles:!0})),Q.form.structure&&Array.isArray(Q.form.structure))if(l.formStructure=Q.form.structure,h.innerHTML="",l.formStructure.length===0)h.appendChild(H());else{l.formStructure.forEach(Gt=>{window.aipkitForms_renderLayoutRow(h,Gt,null,s)});let Jt=0;l.formStructure.forEach(Gt=>{Gt.columns.forEach(Di=>{Di.elements.forEach(bt=>{let di=bt.internalId.split("-"),Ht=parseInt(di[di.length-1],10)||0;Ht>Jt&&(Jt=Ht)})})}),l.droppedElementCounter=Jt}else h.innerHTML="",h.appendChild(H());g(),r(t,!0),k(s)}else throw new Error(Q.message||n("Could not load form data.","gpt3-ai-content-generator"))}).catch(Q=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(s,"error",Q.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(s):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):(W.disabled=!0,D())})}window.aipkitForms_showFormEditor=i,window.aipkitForms_updatePromptSnippets=k,window.aipkitForms_initPromptSnippets=o})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState,i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:p=>p;if(!o){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}r.currentFormId=null,r.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(o):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let a=o.querySelector("#aipkit_form_editor_container"),s=o.querySelector("#aipkit_ai_forms_list_container"),l=o.querySelector("#aipkit_ai_forms_editor_actions"),c=o.querySelector("#aipkit_create_new_ai_form_btn"),n=o.querySelector("#aipkit_ai_forms_settings_trigger"),e=o.querySelector("#aipkit_ai_forms_header_title_default"),t=o.querySelector("#aipkit_ai_forms_header_title_editor");if(a&&(a.style.display="none"),s&&(s.style.display="block"),l&&(l.style.display="none"),c&&(c.style.display=""),n&&(n.style.display=""),e&&(e.style.display=""),t&&(t.style.display="none"),typeof window.aipkitForms_closePreviewSheet=="function"&&window.aipkitForms_closePreviewSheet(o),a){let p=a.querySelector("#aipkit_ai_form_ai_provider");p&&delete p.dataset.aipkitProviderNoticeArmed}let d=document.getElementById("aipkit_provider_notice_ai_forms");if(d&&d.classList.add("aipkit_provider_notice--hidden"),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(o),a){let p=a.querySelector("#aipkit_ai_form_preview_container");p&&(p.style.display="none",p.innerHTML="");let f=o.querySelector("#aipkit_preview_ai_form_btn");if(f&&f.classList.contains("aipkit-preview-active")){f.classList.remove("aipkit-preview-active");let g=f.querySelector(".aipkit_btn-text");g&&(g.textContent=i("Preview","gpt3-ai-content-generator"))}}let _=o.querySelector("#aipkit_ai_forms_messages");_&&(_.innerHTML="")}window.aipkitForms_hideFormEditor=k})();(function(){"use strict";function k(o,r){let i=window.aipkitAIFormsState,a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:gt=>gt,l={value:null},c=()=>r.querySelector("#aipkit_ai_forms_status"),n=(gt,It)=>{let ze=c();if(!ze)return;let Ye=ze.classList.contains("aipkit_training_status");if(ze.textContent=gt||"",Ye){ze.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),gt&&ze.classList.add("is-visible"),It&&ze.classList.add(`is-${It}`);return}ze.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),It==="success"?ze.classList.add("aipkit_form-help-success"):It==="error"&&ze.classList.add("aipkit_form-help-error")},e=(gt=2500)=>{l.value&&window.clearTimeout(l.value),l.value=window.setTimeout(()=>{n("","")},gt)};if(!r){console.error("AI Forms saveForm: formsContainerElement not provided.");return}let t=r.querySelector("#aipkit_form_editor_container");if(!t){console.error("AI Forms saveForm: editorContainer not found in provided formsContainerElement.");return}let d=r.querySelector("#aipkit_ai_form_title"),_=t.querySelector("#aipkit_ai_form_prompt_template"),p=t.querySelector("#aipkit_ai_form_id"),f=t.querySelector("#aipkit_ai_form_ai_provider"),g=t.querySelector("#aipkit_ai_form_ai_model"),m=t.querySelector("#aipkit_ai_form_temperature"),u=t.querySelector("#aipkit_ai_form_max_tokens"),w=t.querySelector("#aipkit_ai_form_top_p"),h=t.querySelector("#aipkit_ai_form_frequency_penalty"),C=t.querySelector("#aipkit_ai_form_presence_penalty"),x=t.querySelector("#aipkit_ai_form_reasoning_effort"),v=t.querySelector('input[name="enable_vector_store"]'),L=t.querySelector('select[name="vector_store_provider"]'),P=t.querySelector('select[name="openai_vector_store_ids[]"]'),b=t.querySelector('select[name="pinecone_index_name"]'),y=t.querySelector('select[name="qdrant_collection_name"]'),S=t.querySelector('select[name="vector_embedding_provider"]'),E=t.querySelector('select[name="vector_embedding_model"]'),A=t.querySelector('input[name="vector_store_top_k"]'),M=t.querySelector('input[name="vector_store_confidence_threshold"]'),$=t.querySelector('input[name="openai_web_search_enabled"]'),W=t.querySelector('input[name="claude_web_search_enabled"]'),H=t.querySelector('input[name="openrouter_web_search_enabled"]'),N=t.querySelector('input[name="google_search_grounding_enabled"]'),G=t.querySelector('select[name="openai_web_search_context_size"]'),J=t.querySelector('select[name="openai_web_search_loc_type"]'),F=t.querySelector('input[name="openai_web_search_loc_country"]'),q=t.querySelector('input[name="openai_web_search_loc_city"]'),O=t.querySelector('input[name="openai_web_search_loc_region"]'),R=t.querySelector('input[name="openai_web_search_loc_timezone"]'),D=t.querySelector('input[name="claude_web_search_max_uses"]'),Z=t.querySelector('select[name="claude_web_search_loc_type"]'),Q=t.querySelector('input[name="claude_web_search_loc_country"]'),fe=t.querySelector('input[name="claude_web_search_loc_city"]'),Ae=t.querySelector('input[name="claude_web_search_loc_region"]'),We=t.querySelector('input[name="claude_web_search_loc_timezone"]'),Ge=t.querySelector('input[name="claude_web_search_allowed_domains"]'),it=t.querySelector('input[name="claude_web_search_blocked_domains"]'),_t=t.querySelector('select[name="claude_web_search_cache_ttl"]'),mt=t.querySelector('select[name="openrouter_web_search_engine"]'),Ot=t.querySelector('input[name="openrouter_web_search_max_results"]'),Nt=t.querySelector('input[name="openrouter_web_search_search_prompt"]'),Ie=t.querySelector('select[name="google_grounding_mode"]'),qt=t.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!d||!_||!p||!f||!g||!m||!u||!w||!h||!C){console.error("AI Forms saveForm: One or more critical form editor inputs not found in editorContainer.");return}let Wt=d.value.trim(),ui=_.value.trim(),ae=p.value;if(Wt||(Wt=s("New Form","gpt3-ai-content-generator"),d.value=Wt,d.dispatchEvent(new Event("input",{bubbles:!0}))),!ui){alert(s(a.text.promptTemplateRequired||"Prompt template is required.","gpt3-ai-content-generator"));return}let Ce=new Set,Le=!0;e:for(let gt of i.formStructure)for(let It of gt.columns)for(let ze of It.elements){if(!ze.fieldId||!/^[a-zA-Z0-9_]+$/.test(ze.fieldId)){alert(s(`Invalid Field Variable Name: "${ze.fieldId||""}" for element "${ze.label}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(ze.internalId,r);let Ye=t.querySelector(`#setting-field-id-${ze.internalId}`);Ye&&Ye.focus(),Le=!1;break e}if(Ce.has(ze.fieldId)){alert(s(`Duplicate Field Variable Name: "${ze.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(ze.internalId,r);let Ye=t.querySelector(`#setting-field-id-${ze.internalId}`);Ye&&Ye.focus(),Le=!1;break e}Ce.add(ze.fieldId)}if(!Le)return;let Oe=P?Array.from(P.selectedOptions).map(gt=>gt.value):[],$e=t.querySelectorAll('input[name^="labels["]'),He={};$e.forEach(gt=>{let It=gt.name.match(/\[(.*?)\]/);if(It&&It[1]){let ze=It[1];He[ze]=gt.value}});let je=JSON.stringify(He),Qe={_ajax_nonce:a.nonce_manage_forms,form_id:ae||null,title:Wt,prompt_template:ui,form_structure:JSON.stringify(i.formStructure),ai_provider:f.value,ai_model:g.value,temperature:m.value,max_tokens:u.value,top_p:w.value,frequency_penalty:h.value,presence_penalty:C.value,reasoning_effort:x?.value,enable_vector_store:v?.checked?"1":"0",vector_store_provider:L?.value,openai_vector_store_ids:Oe,pinecone_index_name:b?.value||"",qdrant_collection_name:y?.value||"",vector_embedding_provider:S?.value,vector_embedding_model:E?.value||"",vector_store_top_k:A?.value||3,vector_store_confidence_threshold:M?.value||20,openai_web_search_enabled:$?.checked?"1":"0",claude_web_search_enabled:W?.checked?"1":"0",openrouter_web_search_enabled:H?.checked?"1":"0",google_search_grounding_enabled:N?.checked?"1":"0",openai_web_search_context_size:G?.value||"medium",openai_web_search_loc_type:J?.value||"none",openai_web_search_loc_country:F?.value||"",openai_web_search_loc_city:q?.value||"",openai_web_search_loc_region:O?.value||"",openai_web_search_loc_timezone:R?.value||"",claude_web_search_max_uses:D?.value||"5",claude_web_search_loc_type:Z?.value||"none",claude_web_search_loc_country:Q?.value||"",claude_web_search_loc_city:fe?.value||"",claude_web_search_loc_region:Ae?.value||"",claude_web_search_loc_timezone:We?.value||"",claude_web_search_allowed_domains:Ge?.value||"",claude_web_search_blocked_domains:it?.value||"",claude_web_search_cache_ttl:_t?.value||"none",openrouter_web_search_engine:mt?.value||"auto",openrouter_web_search_max_results:Ot?.value||"5",openrouter_web_search_search_prompt:Nt?.value||"",google_grounding_mode:Ie?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:qt?.value||"0.30",labels:je},xt=o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent:o.textContent,bi=o.querySelector(".aipkit_spinner");o.disabled=!0,bi&&(bi.style.display="inline-block"),o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent=s(a.text.savingForm||"Saving...","gpt3-ai-content-generator"):o.firstChild.textContent=s(a.text.savingForm||"Saving...","gpt3-ai-content-generator")+" ",n(s("Saving...","gpt3-ai-content-generator"),"loading"),window.aipkit_apiRequest("aipkit_save_ai_form",Qe).then(gt=>{if(!ae&&gt.form_id){p&&(p.value=gt.form_id),i.currentFormId=gt.form_id;let It=r.querySelector("#aipkit_preview_ai_form_btn");It&&(It.disabled=!1)}n(gt.message||s(a.text.formSaved||"Form saved!","gpt3-ai-content-generator"),"success"),e(),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(gt=>{n(gt.message||s(a.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator"),"error"),e(4e3)}).finally(()=>{o.disabled=!1,bi&&(bi.style.display="none"),o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent=xt:o.firstChild.textContent=xt})}window.aipkitForms_saveForm=k})();(function(){"use strict";function k(o,r,i){let a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n;if(!i){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let l={_ajax_nonce:a.nonce_manage_forms,form_id:o},c=r.textContent;r.disabled=!0,r.textContent=s(a.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",l).then(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",n.message||s(a.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",n.message||s(a.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let e=i.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${o}"]`);e&&(e.disabled=!1,e.textContent=c)})}window.aipkitForms_deleteForm=k})();(function(){"use strict";function k(o,r){let i=window.aipkit_ai_forms_config||{text:{}},a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n;if(!r){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let s={_ajax_nonce:i.nonce_manage_forms},l=o.querySelector(".aipkit_btn-text")?.textContent||a("Delete All Forms","gpt3-ai-content-generator"),c=o.querySelector(".aipkit_spinner");o.disabled=!0,o.querySelector(".aipkit_btn-text")&&(o.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${a(i.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",s).then(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"success",n.message||a(i.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"error",n.message||a(i.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{o.querySelector(".aipkit_btn-text")&&(o.querySelector(".aipkit_btn-text").textContent=l),c&&(c.style.display="none"),o.disabled=!1})}window.aipkitForms_deleteAllForms=k})();(function(){"use strict";function k(o,r,i){let a=window.aipkit_ai_forms_config||{text:{}},s=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n;if(!i){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let l={_ajax_nonce:a.nonce_manage_forms,form_id:o},c=r.textContent;r.disabled=!0,r.textContent=s(a.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",l).then(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",n.message||s("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",n.message||s(a.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let n=i.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${o}"]`);n&&(n.disabled=!1,n.textContent=c)})}window.aipkitForms_duplicateForm=k})();(function(){"use strict";async function k(o){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s,a=o.textContent;o.disabled=!0,o.textContent=i("Exporting...","gpt3-ai-content-generator");try{let s=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:r.nonce_manage_forms});if(s.forms&&Array.isArray(s.forms)&&s.forms.length>0){let l=s.forms.map(p=>(delete p.id,delete p.status,p)),n=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,e=JSON.stringify(l,null,2),t=new Blob([e],{type:"application/json"}),d=URL.createObjectURL(t),_=document.createElement("a");_.href=d,_.download=n,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(d)}else throw new Error(i("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(s){alert(i("Error exporting forms: ","gpt3-ai-content-generator")+s.message)}finally{o.disabled=!1,o.textContent=a}}window.aipkitForms_exportAllForms=k})();(function(){"use strict";async function k(o,r){let i=window.aipkit_ai_forms_config||{text:{}},a=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:l=>l,s=r.textContent;r.disabled=!0,r.textContent=a("Exporting...","gpt3-ai-content-generator");try{let l=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:o,_ajax_nonce:i.nonce_manage_forms});if(l.form){let c=l.form,n=c.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),e=`aipkit-form-${o}-${n}.json`;delete c.id,delete c.status;let t=JSON.stringify(c,null,2),d=new Blob([t],{type:"application/json"}),_=URL.createObjectURL(d),p=document.createElement("a");p.href=_,p.download=e,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(_)}else throw new Error(a("Form data not found in response.","gpt3-ai-content-generator"))}catch(l){alert(a("Error exporting form: ","gpt3-ai-content-generator")+l.message)}finally{r.disabled=!1,r.textContent=s}}window.aipkitForms_exportForm=k})();(function(){"use strict";let k=document.getElementById("aipkit_ai_forms_import_messages"),o;function r(s,l){if(!k)return;let c=window.aipkit_escapeHtml||(n=>n);k.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${s}">${c(l)}</div>`,o&&clearTimeout(o),o=setTimeout(()=>{k.innerHTML=""},8e3)}function i(){k&&(k.innerHTML=""),o&&clearTimeout(o)}async function a(s){let l=window.aipkit_ai_forms_config||{text:{}},c=window.wp?.i18n?.__||(d=>d),n=s.files;if(!n.length)return;let e=n[0];i(),r("info",c("Reading file...","gpt3-ai-content-generator"));let t=new FileReader;t.onload=async function(d){try{let _=d.target.result,p=JSON.parse(_);if(typeof p=="object"&&p!==null&&!Array.isArray(p)&&(p=[p]),!Array.isArray(p))throw new Error(c("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(p.length===0){r("warning",c("File contains no forms to import.","gpt3-ai-content-generator"));return}r("info",c("Importing...","gpt3-ai-content-generator"));let f=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:l.nonce_manage_forms,forms_json:JSON.stringify(p)});r(f.failed_count>0?"warning":"success",f.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(_){r("error",c("Error processing import file: ","gpt3-ai-content-generator")+_.message)}},t.onerror=function(){r("error",c("Error reading the selected file.","gpt3-ai-content-generator"))},t.readAsText(e)}window.aipkitForms_importForms=a})();(function(){"use strict";let k="aipkit_ai_forms_status",o=!1,r=null,i=null,a=null;function s(){return document.getElementById(k)}function l(w,h){let C=s();if(!C)return;let x=C.classList.contains("aipkit_training_status");if(C.textContent=w||"",x){C.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),w&&C.classList.add("is-visible"),h&&C.classList.add(`is-${h}`);return}C.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),h==="success"?C.classList.add("aipkit_form-help-success"):h==="error"&&C.classList.add("aipkit_form-help-error")}function c(w=2500){a&&window.clearTimeout(a),a=window.setTimeout(()=>{l("","")},w)}function n(){return document.getElementById("aipkit_ai_forms_settings_form")}function e(){let w=n();if(!w)return console.error("AI Forms Save Settings: Settings form not found."),null;let h=new FormData(w),C={};return h.forEach((x,v)=>{C[v]=x}),C}function t(w){if(!w)return"";let h={};return Object.keys(w).sort().forEach(C=>{h[C]=w[C]}),JSON.stringify(h)}function d(w){i=t(w)}function _(w){return t(w)!==i}async function p(w,h){let C=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:L=>L;if(typeof window.aipkit_apiRequest!="function"){console.error("AI Forms Save Settings: aipkit_apiRequest not found.");return}l(C("Saving...","gpt3-ai-content-generator"),"loading");let x="",v=null;h&&(x=h.querySelector(".aipkit_btn-text")?.textContent||C("Save AI Forms Settings","gpt3-ai-content-generator"),v=h.querySelector(".aipkit_spinner"),h.disabled=!0,v&&(v.style.display="inline-block"),h.querySelector(".aipkit_btn-text")&&(h.querySelector(".aipkit_btn-text").textContent=C("Saving...","gpt3-ai-content-generator")));try{let L=await window.aipkit_apiRequest("aipkit_save_ai_forms_settings",w);return l(L.message||C("Settings saved!","gpt3-ai-content-generator"),"success"),c(),d(w),L}catch(L){throw l(L.message||C("Failed to save settings.","gpt3-ai-content-generator"),"error"),c(4e3),console.error("AI Forms Save Settings Error:",L),L}finally{h&&(h.disabled=!1,v&&(v.style.display="none"),h.querySelector(".aipkit_btn-text")&&(h.querySelector(".aipkit_btn-text").textContent=x))}}function f(w,h){if(w){if(o){r=w;return}o=!0,p(w,h).catch(()=>{}).finally(()=>{if(o=!1,r){let C=r;r=null,_(C)&&f(C,null)}})}}function g(w){let h=e();f(h,w)}function m(){let w=e();!w||!_(w)||f(w,null)}function u(){let w=e();w&&d(w)}window.aipkitForms_saveAiFormsSettings=g,window.aipkitForms_handleSettingsAutosave=m,window.aipkitForms_updateSettingsAutosaveBaseline=u})();(function(){"use strict";function k(o,r,i){let a=window.aipkit_escapeHtml||function(l){return l};if(!o){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let s=o.querySelector("#aipkit_ai_forms_messages");s?(s.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${r}">${a(i)}</div>`,setTimeout(()=>{s.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=k})();(function(){"use strict";function k(r){if(!r){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let i=r.querySelector(".aipkit_token_limit_mode_select"),a=r.querySelector(".aipkit_token_general_user_limit_field"),s=r.querySelector(".aipkit_token_role_limits_container");if(!i||!a||!s){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let l=i.value;a.hidden=l!=="general",s.hidden=l!=="role_based"}function o(r){if(!r){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let i="data-token-listener-attached";r.getAttribute(i)!=="true"&&(r.addEventListener("change",function(a){a.target.closest(".aipkit_token_limit_mode_select")&&k(r)}),k(r),r.setAttribute(i,"true"))}window.aipkit_initAIFormsTokenManagementUI=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_ai_forms_container");return o||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=k})();(function(){"use strict";function k(o){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a;o.dataset.clickListenerAttached!=="true"&&(o.addEventListener("click",function(a){let s=a.target,l=n=>s.closest(n),c=o.querySelector("#aipkit_form_editor_container");if(s.matches("#aipkit_create_new_ai_form_btn")||l("#aipkit_create_new_ai_form_btn"))a.preventDefault(),typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,o);else if(l(".aipkit_actions_menu_toggle")){a.preventDefault(),a.stopPropagation();let n=s.closest(".aipkit_actions_menu");if(!n)return;let e=n.querySelector(".aipkit_actions_dropdown_menu");if(!e)return;let t=e.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(d=>{d!==e&&(d.style.display="none")}),e.style.display=t?"none":"block",!t){let d=_=>{n.contains(_.target)||(e.style.display="none")};document.addEventListener("click",d,{once:!0,capture:!0})}}else if(l("#aipkit_import_ai_forms_btn")){a.preventDefault();let n=o.querySelector("#aipkit_ai_forms_import_file_input");n&&n.click()}else if(s.matches(".aipkit_edit_ai_form_btn")||l(".aipkit_edit_ai_form_btn")){a.preventDefault();let e=l(".aipkit_edit_ai_form_btn").dataset.formId;typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(e,o)}else if(l(".aipkit_preview_ai_form_btn")){a.preventDefault();let n=l(".aipkit_preview_ai_form_btn"),e=n.dataset.formId,t=n.dataset.formTitle||"";typeof window.aipkitForms_openPreviewSheet=="function"&&window.aipkitForms_openPreviewSheet(e,t,o)}else if(s.matches(".aipkit_duplicate_ai_form_btn")||l(".aipkit_duplicate_ai_form_btn")){a.preventDefault();let n=l(".aipkit_duplicate_ai_form_btn"),e=n.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(e,n,o)}else if(s.matches("#aipkit_export_all_ai_forms_btn")||l("#aipkit_export_all_ai_forms_btn")){a.preventDefault();let n=l("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(n)}else if(s.matches(".aipkit_export_ai_form_btn")||l(".aipkit_export_ai_form_btn")){a.preventDefault();let n=l(".aipkit_export_ai_form_btn"),e=n.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(e,n)}else if(s.matches(".aipkit_delete_ai_form_btn")||l(".aipkit_delete_ai_form_btn")){a.preventDefault();let n=l(".aipkit_delete_ai_form_btn"),e=n.dataset.formId,t=n.dataset.formTitle||`Form ID ${e}`,_=`${i(r.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${t}`,p=()=>{typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(e,n,o)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(_,{title:i("Confirm","gpt3-ai-content-generator"),confirmText:i("Delete","gpt3-ai-content-generator"),cancelText:i("Cancel","gpt3-ai-content-generator"),onConfirm:p});return}confirm(_)&&p()}else if(s.matches("#aipkit_delete_all_ai_forms_btn")||l("#aipkit_delete_all_ai_forms_btn")){a.preventDefault();let n=l("#aipkit_delete_all_ai_forms_btn"),e=i(r.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"),t=()=>{typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(n,o)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(e,{title:i("Confirm","gpt3-ai-content-generator"),confirmText:i("Delete","gpt3-ai-content-generator"),cancelText:i("Cancel","gpt3-ai-content-generator"),onConfirm:t});return}confirm(e)&&t()}else if(s.matches(".aipkit_form_shortcode_input"))a.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(s.value,s);else if(l(".aipkit_aiform_settings_toggle")){a.preventDefault();let n=l(".aipkit_aiform_settings_toggle"),e=n.dataset.formId,t=o.querySelector(`#aif-configurator-${e}`);if(!t)return;let d=t.closest("tr"),_=()=>{let g=n.getBoundingClientRect(),m=t.getBoundingClientRect(),u=m.width||400,w=m.height||0,h=window.innerWidth,C=window.innerHeight,x=12,v=g.left;v+u>h-x&&(v=g.right-u),v=Math.max(x,Math.min(v,h-u-x));let L=g.bottom+8;L+w>C-x&&(L=g.top-w-8),L=Math.max(x,Math.min(L,C-w-x)),t.style.left=`${Math.round(v)}px`,t.style.top=`${Math.round(L)}px`};o.querySelectorAll(".aipkit_shortcode_configurator").forEach(g=>{g!==t&&(g.style.display="none");let m=g.closest("tr");m&&m.classList.remove("aipkit_shortcode_row_open")});let f=t.style.display==="flex";if(t.style.display=f?"none":"flex",d&&d.classList.toggle("aipkit_shortcode_row_open",!f),!f){_();let g=m=>{!t.contains(m.target)&&!n.contains(m.target)&&(t.style.display="none",d&&d.classList.remove("aipkit_shortcode_row_open"),document.removeEventListener("click",g,!0))};setTimeout(()=>{document.addEventListener("click",g,{capture:!0,once:!0})},0)}}else if(l(".aipkit_aiform_shortcode_close")){a.preventDefault();let e=l(".aipkit_aiform_shortcode_close").closest(".aipkit_shortcode_configurator");if(e){e.style.display="none";let t=e.closest("tr");t&&t.classList.remove("aipkit_shortcode_row_open")}}else if(s.matches("#aipkit_validate_prompt_btn")||l("#aipkit_validate_prompt_btn"))a.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(s.matches("#aipkit_save_ai_form_btn")||l("#aipkit_save_ai_form_btn")){a.preventDefault();let n=l("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(n,o)}else if(s.matches("#aipkit_cancel_edit_ai_form_btn")||l("#aipkit_cancel_edit_ai_form_btn"))a.preventDefault(),typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(o);else if(s.matches("#aipkit_preview_ai_form_btn")||l("#aipkit_preview_ai_form_btn")){a.preventDefault();let n=c.querySelector("#aipkit_ai_form_id").value;if(!n){alert(i("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}let e=o.querySelector("#aipkit_ai_form_title"),t=e?e.value:"";typeof window.aipkitForms_openPreviewSheet=="function"?window.aipkitForms_openPreviewSheet(n,t,o):console.error("AI Forms Preview: Preview sheet helper not available.")}else if(l(".aipkit_dropped_element_settings_btn")){a.preventDefault();let n=l(".aipkit_dropped_element");n&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(n.id,o)}else if(l(".aipkit_dropped_element_delete_btn")){a.preventDefault();let n=l(".aipkit_dropped_element");n&&confirm(i(r.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(n.id,o)}else if(l(".aipkit_layout_row_delete_btn")){if(a.preventDefault(),confirm(i("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let n=l(".aipkit_layout_row");n&&(Array.from(n.querySelectorAll(".aipkit_dropped_element")).map(t=>t.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(o),n.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(o))}}else if(l("#aipkit_settings_panel_close_btn"))a.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(o);else if(l(".aipkit_remove_option_btn")){a.preventDefault();let n=l(".aipkit_select_option_row");n&&(n.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,o))}else l("#aipkit_add_select_option_btn")&&(a.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(o))}),o.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=k})();(function(){"use strict";let k="aipkit_ai_forms_shortcode_config_v1_";function o(l){if(!l||!window.localStorage)return null;try{let c=window.localStorage.getItem(`${k}${l}`);if(!c)return null;let n=JSON.parse(c);return n&&typeof n=="object"?n:null}catch{return null}}function r(l,c){if(!(!l||!window.localStorage))try{window.localStorage.setItem(`${k}${l}`,JSON.stringify(c))}catch{}}function i(l,c){if(!l)return;let n=c.querySelector(`#aif-configurator-${l}`),e=c.querySelector(`#aif-shortcode-input-${l}`);if(!n||!e)return;let t=n.querySelectorAll(".aipkit-aiform-config-input"),d=[],_={};t.forEach(g=>{let m=g.dataset.attrName;m&&(g.type==="checkbox"?(_[m]=!!g.checked,g.checked&&d.push(`${m}="true"`)):g.type==="select-one"&&(_[m]=g.value,g.value&&g.value!=="light"&&d.push(`${m}="${g.value}"`)))});let p=`[aipkit_ai_form id=${l}`;d.length>0&&(p+=" "+d.join(" ")),p+="]",e.value=p,c.querySelectorAll(`[data-aipkit-shortcode-display="${l}"]`).forEach(g=>{g&&"value"in g&&(g.value=p)}),r(l,_)}function a(l,c){if(!l||!c)return;let n=o(l);if(!n)return;let e=c.querySelector(`#aif-configurator-${l}`);if(!e)return;e.querySelectorAll(".aipkit-aiform-config-input").forEach(d=>{let _=d.dataset.attrName;_&&(d.type==="checkbox"?Object.prototype.hasOwnProperty.call(n,_)&&(d.checked=!!n[_]):d.type==="select-one"&&typeof n[_]=="string"&&(d.value=n[_]))}),i(l,c)}function s(l){l.dataset.changeListenerAttached!=="true"&&(l.addEventListener("change",function(c){let n=c.target;if(n.matches(".aipkit-aiform-config-input")){let e=n.dataset.formId;i(e,l)}else n.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(n),n.value="")}),l.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=s,window.aipkitForms_applyStoredShortcodeConfig=a})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState,i=o.querySelector("#aipkit_ai_form_element_settings_panel");if(!i){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(i.dataset.inputListenerAttached==="true")return;let a=()=>{r.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(r.selectedDesignerElementId,o)};i.addEventListener("input",s=>{s.target.matches(".aipkit-setting-field")&&a()}),i.addEventListener("change",s=>{s.target.matches('.aipkit-setting-field[type="checkbox"]')&&a()}),i.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=k})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=o.querySelector("#aipkit_ai_form_elements_palette"),a=o.querySelector("#aipkit_ai_form_designer_area");if(!i||!a){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&a.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(l=>{l.dataset.dragStartListenerAttached!=="true"&&(l.addEventListener("dragstart",c=>{c.target.classList.add("aipkit-dragging"),r.draggedElement=null,c.target.dataset.layoutType?(r.draggedLayoutType=c.target.dataset.layoutType,r.draggedElementType=null,c.dataTransfer.setData("text/plain",r.draggedLayoutType),c.dataTransfer.effectAllowed="copy"):(r.draggedElementType=c.target.dataset.elementType,r.draggedLayoutType=null,c.dataTransfer.setData("text/plain",r.draggedElementType),c.dataTransfer.effectAllowed="copy")}),l.addEventListener("dragend",c=>{c.target.classList.remove("aipkit-dragging"),r.draggedElementType=null,r.draggedLayoutType=null}),l.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",a.dataset.dragListenersAttached!=="true"&&(a.addEventListener("dragstart",l=>{let c=l.target.closest(".aipkit_layout_row"),n=l.target.closest(".aipkit_dropped_element");if(c&&l.target.classList.contains("aipkit_layout_row_drag_handle"))r.draggedElement=c,l.dataTransfer.setData("text/row-id",c.id),l.dataTransfer.effectAllowed="move";else if(n&&l.target.classList.contains("aipkit_dropped_element_drag_handle"))r.draggedElement=n,l.dataTransfer.setData("text/element-id",n.id),l.dataTransfer.effectAllowed="move";else return;r.draggedElementType=null,r.draggedLayoutType=null,setTimeout(()=>{r.draggedElement&&r.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),a.addEventListener("dragend",l=>{r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null)}),a.addEventListener("dragover",l=>{l.preventDefault(),a.classList.add("aipkit-drag-over"),r.draggedElement?l.dataTransfer.dropEffect="move":l.dataTransfer.dropEffect="copy"}),a.addEventListener("dragleave",l=>{a.contains(l.relatedTarget)||a.classList.remove("aipkit-drag-over")}),a.addEventListener("drop",l=>{l.preventDefault(),l.stopPropagation(),a.classList.remove("aipkit-drag-over");let c=a.querySelector("#aipkit_form_designer_placeholder");if(r.draggedLayoutType){c&&(c.style.display="none");let n=window.aipkitForms_createNewLayoutData(r.draggedLayoutType);r.formStructure.push(n),window.aipkitForms_renderLayoutRow(a,n,null,o),r.draggedLayoutType=null}else if(r.draggedElement&&r.draggedElement.classList.contains("aipkit_layout_row")){let n=l.target.closest(".aipkit_layout_row");if(n&&n!==r.draggedElement){let e=n.getBoundingClientRect(),d=l.clientY>e.top+e.height/2?n.nextSibling:n;a.insertBefore(r.draggedElement,d)}window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){c&&(c.style.display="none");let n=window.aipkitForms_createNewLayoutData("1-col"),e=window.aipkitForms_createNewFormElementData(r.draggedElementType);n.columns[0].elements.push(e),r.formStructure.push(n),window.aipkitForms_renderLayoutRow(a,n,null,o),r.draggedElementType=null}r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(o)}),a.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=k})();(function(){"use strict";function k(o){let r=o.querySelector("#aipkit_ai_forms_settings_form");r&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(r):console.error("AI Forms Init: Could not initialize token management UI for settings popover.")}window.aipkitForms_initializeTokenUI=k})();(function(){"use strict";function k(o){let r=(o||document).querySelector("#aipkit_ai_forms_settings_form");if(!r)return;let i="data-aipkit-aiforms-autosave-attached";if(r.getAttribute(i)==="true")return;let a=()=>{typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};r.addEventListener("change",s=>{let l=s.target;if(!l||!l.matches(".aipkit_autosave_trigger"))return;(l.tagName.toLowerCase()==="select"||l.type==="checkbox"||l.type==="range")&&a()}),r.addEventListener("blur",s=>{let l=s.target;if(!l||!l.matches(".aipkit_autosave_trigger"))return;let c=l.tagName.toLowerCase();(c==="input"||c==="textarea")&&l.type!=="range"&&l.type!=="checkbox"&&a()},!0),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),r.setAttribute(i,"true")}window.aipkitForms_initSettingsAutosave=k})();(function(){"use strict";function k(o){if(!o)return;let r="data-accordion-listener-attached";o.getAttribute(r)!=="true"&&(o.addEventListener("click",function(i){let a=i.target.closest(".aipkit_accordion-header");if(!a||!a.closest(".aipkit_ai_forms_container"))return;i.preventDefault();let s=a.closest(".aipkit_accordion-group"),l=a.dataset.aipkitContextAccordion==="1";if(s&&!a.classList.contains("aipkit_active")){let n=s.querySelector(".aipkit_accordion-header.aipkit_active");if(n){n.classList.remove("aipkit_active");let e=n.nextElementSibling;e&&e.classList.remove("aipkit_active")}}let c=a.nextElementSibling;c&&(a.classList.toggle("aipkit_active"),c.classList.toggle("aipkit_active"),l&&c.classList.contains("aipkit_active")&&typeof window.aipkitForms_refreshOpenaiStores=="function"&&window.aipkitForms_refreshOpenaiStores(c))}),o.setAttribute(r,"true"))}window.aipkitForms_initializeAccordions=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(f){return f},o={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0};function r(f){if(!f)return o;let g=Array.isArray(window.aipkit_dashboard?.models?.openrouter)?window.aipkit_dashboard.models.openrouter:[],m=String(f).trim().toLowerCase(),u=g.find(w=>(w?.id?String(w.id).trim().toLowerCase():"")===m);return!u||typeof u.capabilities!="object"?o:{...o,...u.capabilities}}function i(f,g,m){return f!=="OpenRouter"||!m?!0:!!r(g)[m]}function a(f,g,m,u){if(!f||!g)return;f.classList.toggle("aipkit_popover_option_row--disabled",m),f.setAttribute("aria-disabled",m?"true":"false"),g.disabled=!!m;let w=f.querySelector(".aipkit_popover_option_label");w&&(w.dataset.defaultTooltip||(w.dataset.defaultTooltip=w.getAttribute("data-tooltip")||""),w.setAttribute("data-tooltip",m&&u||w.dataset.defaultTooltip))}function s(f,g=""){let m=document.getElementById("aipkit_ai_form_ai_model"),u=window.aipkit_dashboard?.models||{};if(!m||!u)return;let w=f.toLowerCase(),h=u[w];(typeof h>"u"||h===null)&&(h=w==="openai"?{}:[]),m.innerHTML="",m.disabled=!1;let C=window.aipkit_dashboard?.recommendedModels?.[w]||[],x=Array.isArray(C)?C:[],v=new Set(x.map(P=>P?.id).filter(Boolean));if(!h||Array.isArray(h)&&h.length===0||!Array.isArray(h)&&Object.keys(h).length===0){let P=new Option("No models found. Sync in main settings.","");m.appendChild(P),m.disabled=!0;return}let L=!1;if(Array.isArray(h)){if(x.length>0){let b=document.createElement("optgroup");b.label=k("Recommended","gpt3-ai-content-generator"),x.forEach(y=>{if(y&&y.id){let S=new Option(y.name||y.id,y.id);y.id===g&&(S.selected=!0,L=!0),b.appendChild(S)}}),b.children.length>0&&m.appendChild(b)}let P=x.length>0?document.createElement("optgroup"):null;P&&(P.label=k("All models","gpt3-ai-content-generator")),h.forEach(b=>{if(b&&b.id&&v.has(b.id))return;let y=new Option(b.name,b.id);b.id===g&&(y.selected=!0,L=!0),P?P.appendChild(y):m.appendChild(y)}),P&&P.children.length>0&&m.appendChild(P)}else{if(x.length>0){let P=document.createElement("optgroup");P.label=k("Recommended","gpt3-ai-content-generator"),x.forEach(b=>{if(b&&b.id){let y=new Option(b.name||b.id,b.id);b.id===g&&(y.selected=!0,L=!0),P.appendChild(y)}}),P.children.length>0&&m.appendChild(P)}Object.keys(h).forEach(P=>{let b=document.createElement("optgroup");b.label=P,h[P].forEach(y=>{if(y&&y.id&&v.has(y.id))return;let S=new Option(y.name,y.id);y.id===g&&(S.selected=!0,L=!0),b.appendChild(S)}),b.children.length>0&&m.appendChild(b)})}if(!L&&g){let P=new Option(`${g}`,g,!1,!0);m.insertBefore(P,m.firstChild),P.selected=!0}m.selectedIndex===-1&&m.options.length>0&&(m.options[0].selected=!0),m.options.length||(m.disabled=!0)}function l(f,g){let m=g||document,u=m.querySelector("#aipkit_ai_form_ai_model"),w=u&&u.value||"",h=i(f,w,"web_search_plugin"),C=m.querySelector('input[name="openai_web_search_enabled"]'),x=m.querySelector('input[name="claude_web_search_enabled"]'),v=m.querySelector('input[name="openrouter_web_search_enabled"]'),L=m.querySelector('input[name="google_search_grounding_enabled"]'),P=m.querySelector(".aipkit_ai_form_web_search_row--openai"),b=m.querySelector(".aipkit_ai_form_web_search_row--claude"),y=m.querySelector(".aipkit_ai_form_web_search_row--openrouter"),S=m.querySelector(".aipkit_ai_form_web_search_row--google"),E=m.querySelector(".aipkit_ai_form_openai_web_search_settings"),A=m.querySelector(".aipkit_ai_form_claude_web_search_settings"),M=m.querySelector(".aipkit_ai_form_openrouter_web_search_settings"),$=m.querySelector(".aipkit_ai_form_google_search_grounding_settings"),W=m.querySelector(".aipkit_ai_form_openai_web_search_location_details"),H=m.querySelector(".aipkit_ai_form_claude_web_search_location_details"),N=m.querySelector(".aipkit_ai_form_web_search_empty_state"),G=f==="OpenAI";P&&(P.style.display=G?"block":"none"),!G&&C&&(C.checked=!1);let J=G&&C&&C.checked;E&&(E.style.display=J?"block":"none"),!J&&W?W.style.display="none":J&&typeof window.aipkitForms_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkitForms_toggleOpenAIWebSearchLocationDetails(m);let F=f==="Claude";b&&(b.style.display=F?"block":"none"),!F&&x&&(x.checked=!1);let q=F&&x&&x.checked;A&&(A.style.display=q?"block":"none"),!q&&H?H.style.display="none":q&&typeof window.aipkitForms_toggleClaudeWebSearchLocationDetails=="function"&&window.aipkitForms_toggleClaudeWebSearchLocationDetails(m);let O=f==="OpenRouter";y&&(y.style.display=O?"block":"none"),!O&&v&&(v.checked=!1);let R=O&&!h;v&&R&&(v.checked=!1),a(y,v,R,k("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"));let D=O&&h&&v&&v.checked;M&&(M.style.display=D?"block":"none");let Z=f==="Google";S&&(S.style.display=Z?"block":"none"),!Z&&L&&(L.checked=!1);let Q=Z&&L&&L.checked;$&&($.style.display=Q?"block":"none"),Q&&typeof window.aipkitForms_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkitForms_toggleGoogleGroundingDynamicThreshold(m),N&&(N.style.display=!G&&!F&&!O&&!Z?"block":"none")}function c(f){let g=f.querySelector("#aipkit_ai_form_ai_provider"),m=f.querySelector("#aipkit_ai_form_ai_model"),u=f.querySelector(".aipkit_ai_form_reasoning_effort_field"),w=f.querySelector("#aipkit_ai_form_reasoning_effort");if(!g||!m||!u||!w){u&&(u.style.display="none");return}let h=g.value,x=(m.value||"").toLowerCase();if(!(h==="OpenAI"&&n(x))){u.style.display="none";return}u.style.display="block";let v=t(x),L=new Set(v.allowed),P=w.value||"";P==="minimal"&&(P="low"),Array.from(w.options).forEach(b=>{let y=L.has(b.value);b.hidden=!y,b.disabled=!y}),L.has(P)||(P=v.defaultValue),L.has(P)||(P=v.allowed[0]||""),P&&(w.value=P)}function n(f){if(e(f))return!1;let g=f.startsWith("o1")||f.startsWith("o3")||f.startsWith("o4"),m=f.includes("gpt-5");return g||m}function e(f){return/(?:^|[-_])chat(?:[-_]|$)/.test(f)}function t(f){return _(f)?{allowed:["high"],defaultValue:"high"}:f.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:d(f)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function d(f){let g=f.match(/gpt-5\.(\d+)/);if(g)return Number.parseInt(g[1],10)>=2;let m=f.match(/gpt-(\d+)/);return m?Number.parseInt(m[1],10)>=6:!1}function _(f){return/gpt-5(\.\d+)?-pro/.test(f)}function p(f){let g=f.querySelector("#aipkit_ai_form_ai_provider"),m=f.querySelector("#aipkit_ai_form_ai_model");!g||!m||(g.dataset.modelListenerAttached!=="true"&&(g.addEventListener("change",function(){s(this.value),l(this.value,f),c(f)}),g.dataset.modelListenerAttached="true"),m.dataset.reasoningListenerAttached!=="true"&&(m.addEventListener("change",function(){c(f),l(g.value,f)}),m.dataset.reasoningListenerAttached="true"),s(g.value),l(g.value,f),c(f))}window.aipkitForms_initAiConfig=p,window.aipkitForms_populateAiModels=s,window.aipkitForms_updateWebSearchVisibility=l,window.aipkitForms_toggleReasoningEffort=c})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(N){return N},o={loaded:!1,loading:!1},r={saving:!1,queued:null,last:{pinecone_api_key:"",qdrant_url:"",qdrant_api_key:""}},i=()=>{let N=window.wp&&window.wp.i18n?window.wp.i18n:null;return{__:N&&typeof N.__=="function"?N.__:J=>J}},a=()=>{let N=window.aipkit_ai_forms_config||{},G=N.vectorStores?N.vectorStores.openai:[];return Array.isArray(G)?G:[]},s=N=>{window.aipkit_ai_forms_config||(window.aipkit_ai_forms_config={}),window.aipkit_ai_forms_config.vectorStores||(window.aipkit_ai_forms_config.vectorStores={}),window.aipkit_ai_forms_config.vectorStores.openai=N},l=N=>N?N.querySelector('select[name="openai_vector_store_ids[]"]'):null,c=N=>N?Array.from(N.options).some(G=>G.value&&!G.disabled):!1,n=(N,G)=>{let J=N.id||N.vector_store_id||"",q=N.name||N.vector_store_name||""||`Untitled store ${G}`,O=N.file_counts?N.file_counts.total:null,R=" (Files: N/A)";return typeof O=="number"&&(R=` (${O} ${O===1?"File":"Files"})`),{id:J,label:`${q}${R}`}},e=(N,G,J={})=>{if(!N)return;let{__:F}=i(),O=J.preserveSelection===!0?new Set(Array.from(N.selectedOptions||[]).map(Z=>Z.value)):new Set;N.innerHTML="";let R=Array.isArray(G)?G:[],D=1;if(R.forEach(Z=>{if(!Z||typeof Z!="object")return;let{id:Q,label:fe}=n(Z,D);if(!Q)return;let Ae=new Option(k(fe),Q);O.has(Q)&&(Ae.selected=!0),N.appendChild(Ae),D+=1}),!N.options.length){let Z=new Option(F("No stores found.","gpt3-ai-content-generator"),"");Z.disabled=!0,N.appendChild(Z)}},t=N=>{N&&typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(N)},d=async(N,G={})=>{let J=l(N);if(!J)return;let{__:F}=i(),q=G.force===!0,O=a();if(O.length&&(!q||!o.loaded)){e(J,O,{preserveSelection:!0}),t(N),o.loaded=!0;return}if(!q&&o.loaded&&c(J)||o.loading)return;let R=document.getElementById("aipkit_vector_store_nonce_openai"),D=R?R.value:"";if(!D||typeof window.aipkit_apiRequest!="function")return;o.loading=!0,J.innerHTML="";let Z=new Option(F("Loading vector stores...","gpt3-ai-content-generator"),"");Z.disabled=!0,J.appendChild(Z);try{let Q=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:D,limit:100,order:"desc"}),fe=Array.isArray(Q.stores)?Q.stores:[];s(fe),e(J,fe,{preserveSelection:!0}),t(N),o.loaded=!0}catch(Q){let fe=Q&&Q.message?Q.message:F("Unable to load stores.","gpt3-ai-content-generator");J.innerHTML="";let Ae=new Option(fe,"");Ae.disabled=!0,J.appendChild(Ae)}finally{o.loading=!1}},_=N=>{N&&d(N,{force:!0})},p=N=>{if(!N)return null;let G=N.closest(".aipkit_model_settings_popover");return G?G.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline"):null},f=(N,G,J)=>{let F=p(N);F&&(F.textContent=G||"",F.classList.remove("success","error","loading"),J&&F.classList.add(J),F.style.display=G?"inline-block":"none")},g=(N,G=2500)=>{window.setTimeout(()=>{f(N,"","")},G)},m=N=>N?{pineconeKeyInput:N.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:N.querySelector('[name="qdrant_url"]'),qdrantKeyInput:N.querySelector('[name="qdrant_api_key"]')}:{},u=N=>{let G=N?.closest("#aipkit_ai_forms_container"),J=G?G.dataset:{},{pineconeKeyInput:F,qdrantUrlInput:q,qdrantKeyInput:O}=m(N),R=F?.value.trim(),D=q?.value.trim(),Z=O?.value.trim(),Q=!!(R||J?.pineconeApiKeySet==="true"),fe=!!(D||J?.qdrantUrlSet==="true")&&!!(Z||J?.qdrantApiKeySet==="true");return{pinecone:Q,qdrant:fe}},w=(N,G)=>N?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(N,{silent:!0,showErrors:!1,targetSelectId:G,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,N,{silent:!0,showErrors:!1,targetSelectId:G,propagateError:!0}):null:null,h=(N,G,J)=>{if(!G)return;f(N,"Syncing...","loading");let F=w(G,J);if(F&&typeof F.then=="function"){F.then(()=>{f(N,"Synced","success"),g(N)}).catch(q=>{f(N,`Error: ${q?.message||"Sync failed."}`,"error")});return}g(N)},C=(N,G)=>{if(!N||!G)return;if(G==="openai"){d(N);return}let J=u(N);G==="pinecone"&&J.pinecone?h(N,"PineconeIndexes","aipkit_ai_form_pinecone_index_name"):G==="qdrant"&&J.qdrant&&h(N,"QdrantCollections","aipkit_ai_form_qdrant_collection_name")},x=(N,G)=>{!G||!Object.keys(G).length||typeof window.aipkit_apiRequest=="function"&&(r.saving=!0,f(N,"Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",G).then(J=>{Object.keys(G).forEach(q=>{r.last[q]=G[q]});let F=N.closest("#aipkit_ai_forms_container");F&&(Object.prototype.hasOwnProperty.call(G,"pinecone_api_key")&&(F.dataset.pineconeApiKeySet=G.pinecone_api_key?"true":"false"),Object.prototype.hasOwnProperty.call(G,"qdrant_url")&&(F.dataset.qdrantUrlSet=G.qdrant_url?"true":"false"),Object.prototype.hasOwnProperty.call(G,"qdrant_api_key")&&(F.dataset.qdrantApiKeySet=G.qdrant_api_key?"true":"false")),Object.prototype.hasOwnProperty.call(G,"pinecone_api_key")&&C(N,"pinecone"),(Object.prototype.hasOwnProperty.call(G,"qdrant_url")||Object.prototype.hasOwnProperty.call(G,"qdrant_api_key"))&&C(N,"qdrant"),f(N,J.message||"Saved","success"),g(N)}).catch(J=>{f(N,`Error: ${J?.message||"Failed to save."}`,"error")}).finally(()=>{if(r.saving=!1,r.queued){let J=r.queued;r.queued=null,x(N,J)}}))},v=(N,G)=>{if(!G)return;let J=Object.keys(G).reduce((F,q)=>(G[q]!==r.last[q]&&(F[q]=G[q]),F),{});if(Object.keys(J).length){if(r.saving){r.queued={...r.queued||{},...J};return}x(N,J)}},L=N=>{if(!N)return;let G=N.querySelector(".aipkit_vector_store_enable_select"),J=N.querySelector(".aipkit_vector_store_settings_conditional_row"),F=N.querySelector(".aipkit_vector_store_provider_select"),q=N.querySelector(".aipkit_vector_store_openai_field"),O=N.querySelector(".aipkit_vector_store_pinecone_field"),R=N.querySelector(".aipkit_vector_store_pinecone_key_field"),D=N.querySelector(".aipkit_vector_store_qdrant_field"),Z=N.querySelector(".aipkit_vector_store_qdrant_url_field"),Q=N.querySelector(".aipkit_vector_store_qdrant_key_field"),fe=N.querySelector(".aipkit_vector_store_embedding_config_row");if(!G||!J||!F)return;let Ae=G.tagName==="SELECT"?G.value==="1":G.checked;if(J.style.display=Ae?"block":"none",!Ae){[q,O,R,D,Z,Q,fe].forEach(Ge=>{Ge&&(Ge.style.display="none")});return}let We=F.value||"openai";q&&(q.style.display=We==="openai"?"block":"none"),O&&(O.style.display=We==="pinecone"?"block":"none"),R&&(R.style.display=We==="pinecone"?"block":"none"),D&&(D.style.display=We==="qdrant"?"block":"none"),Z&&(Z.style.display=We==="qdrant"?"block":"none"),Q&&(Q.style.display=We==="qdrant"?"block":"none"),fe&&(fe.style.display=We==="pinecone"||We==="qdrant"?"block":"none"),We==="openai"&&(d(N),t(N))},P=N=>{let G=(N||"").split("::"),J=G.shift()||"",F=G.join("::")||"";return{provider:J,model:F}},b=(N,G)=>!N||!G?"":`${N}::${G}`,y=(N,G,J)=>{if(!N||!G||!J)return;let F=b(G,J);if(!F)return;let q=typeof CSS<"u"&&CSS.escape?CSS.escape(F):F.replace(/"/g,'\\"');if(N.querySelector(`option[value="${q}"]`))return;let O=document.createElement("option");O.value=F,O.dataset.provider=G,O.textContent=`${J}`,N.appendChild(O)},S=(N,G)=>{if(!N)return;let J=G||N.querySelector(".aipkit_vector_embedding_select");if(!J)return;let F=N.querySelector('select[name="vector_embedding_provider"]'),q=N.querySelector('select[name="vector_embedding_model"]'),O=F?F.value:"",R=q?q.value:"",D=b(O,R);if(D){y(J,O,R),J.value=D;return}J.value=""},E=(N,G)=>{if(!G||!N)return;let J=G.querySelector('select[name="vector_embedding_provider"]'),F=G.querySelector('select[name="vector_embedding_model"]'),{provider:q,model:O}=P(N.value);J&&(J.value=q),J&&F&&typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(G),F&&(F.value=O)};function A(N){let G=N.querySelector(".aipkit_vector_embedding_provider_select"),J=N.querySelector(".aipkit_vector_embedding_model_select"),q=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!G||!J||!q)return;let R=G.value.toLowerCase(),D=q[R]||[];J.innerHTML="",J.appendChild(new Option(`-- Select ${G.options[G.selectedIndex]?.text||""} Model --`,"")),D&&Array.isArray(D)&&D.length>0?(D.forEach(Z=>{J.appendChild(new Option(k(Z.name),Z.id))}),J.disabled=!1):(J.appendChild(new Option("(No models found - Sync in Settings)","")),J.disabled=!0)}function M(N){let G=N||document,J=G.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),F=G.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!J||!F)return;let q=J.value==="approximate";F.style.display=q?"block":"none"}function $(N){let G=N||document,J=G.querySelector(".aipkit_ai_form_claude_web_search_loc_type_select"),F=G.querySelector(".aipkit_ai_form_claude_web_search_location_details");if(!J||!F)return;let q=J.value==="approximate";F.style.display=q?"block":"none"}function W(N){let G=N||document,J=G.querySelector(".aipkit_ai_form_google_grounding_mode_select"),F=G.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!J||!F)return;let q=J.value==="MODE_DYNAMIC";F.style.display=q?"block":"none"}function H(N){let G=N.querySelector("#aipkit_form_editor_container");if(!G)return;let J=G.querySelector("#aipkit_ai_form_settings_popover");if(!J)return;let F=J.querySelector('[data-aipkit-settings-panel="context"]'),q=J.querySelector('[data-aipkit-settings-panel="tools"]');if(!F)return;let O=G.querySelector("#aipkit_ai_form_ai_provider"),R=m(F);r.last={pinecone_api_key:R.pineconeKeyInput?.value||"",qdrant_url:R.qdrantUrlInput?.value||"",qdrant_api_key:R.qdrantKeyInput?.value||""};let D="data-vector-config-listener-attached";if(F.getAttribute(D)!=="true"&&(F.addEventListener("change",Z=>{let Q=Z.target;if(Q){if(Q.matches('[name="pinecone_api_key"]')||Q.matches('[name="qdrant_url"]')||Q.matches('[name="qdrant_api_key"]')){v(F,{[Q.name]:Q.value||""});return}if(Q.matches(".aipkit_vector_store_enable_select")||Q.matches(".aipkit_vector_store_provider_select")){L(F);let fe=F.querySelector(".aipkit_vector_store_provider_select"),Ae=fe?fe.value:"";C(F,Ae);return}if(Q.matches(".aipkit_vector_embedding_select")){E(Q,F);return}if(Q.matches(".aipkit_vector_embedding_provider_select")||Q.matches(".aipkit_vector_embedding_model_select")){typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(F),S(F);return}Q.matches('select[name="openai_vector_store_ids[]"]')&&t(F)}}),F.addEventListener("input",Z=>{let Q=Z.target;if(Q){if(Q.matches("#aipkit_ai_form_vector_store_top_k")){let fe=F.querySelector("#aipkit_ai_form_vector_store_top_k_value");fe&&(fe.textContent=Q.value)}else if(Q.matches("#aipkit_ai_form_vector_store_confidence_threshold")){let fe=F.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");fe&&(fe.textContent=Q.value+"%")}}}),F.setAttribute(D,"true")),q){let Z="data-tools-config-listener-attached";q.getAttribute(Z)!=="true"&&(q.addEventListener("change",Q=>{let fe=Q.target;if(fe.matches(".aipkit_ai_form_openai_web_search_toggle")||fe.matches(".aipkit_ai_form_claude_web_search_toggle")||fe.matches(".aipkit_ai_form_openrouter_web_search_toggle")||fe.matches(".aipkit_ai_form_google_search_grounding_toggle")){if(typeof window.aipkitForms_updateWebSearchVisibility=="function"){let Ae=O?O.value:"";window.aipkitForms_updateWebSearchVisibility(Ae,G)}}else fe.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?M(q):fe.matches(".aipkit_ai_form_claude_web_search_loc_type_select")?$(q):fe.matches(".aipkit_ai_form_google_grounding_mode_select")&&W(q)}),q.addEventListener("input",Q=>{let fe=Q.target;if(fe.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let Ae=q.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");Ae&&(Ae.textContent=parseFloat(fe.value).toFixed(2))}}),q.setAttribute(Z,"true"))}typeof window.aipkitForms_updateWebSearchVisibility=="function"&&O&&window.aipkitForms_updateWebSearchVisibility(O.value,G),L(F),A(F),S(F),t(F)}window.aipkitForms_initVectorConfig=H,window.aipkitForms_populateVectorEmbeddingModels=A,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=M,window.aipkitForms_toggleClaudeWebSearchLocationDetails=$,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=W,window.aipkitForms_refreshOpenaiStores=_,window.aipkitForms_syncEmbeddingSelectFromInputs=S})();(function(){"use strict";function k(r,i,a,s){let l=window.aipkitAIFormsState,c=document.createElement("div");c.className="aipkit_layout_row",c.id=i.internalId;let n=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,e=document.createElement("div");e.className="aipkit_layout_row_columns_container",i.columns.forEach(t=>{let d=document.createElement("div");d.className="aipkit_layout_column",d.id=t.internalId,d.style.flexBasis=t.width,o(d,s),t.elements.forEach(_=>{window.aipkitForms_renderFieldInColumn(d,_)}),e.appendChild(d)}),c.innerHTML=n,c.appendChild(e),a?r.insertBefore(c,a):r.appendChild(c)}function o(r,i){let a=window.aipkitAIFormsState;r.addEventListener("dragover",s=>{s.preventDefault(),s.stopPropagation(),r.classList.add("aipkit-drag-over"),(a.draggedElement||a.draggedElementType)&&(s.dataTransfer.dropEffect=a.draggedElement?"move":"copy")}),r.addEventListener("dragleave",s=>{s.preventDefault(),s.stopPropagation(),r.classList.remove("aipkit-drag-over")}),r.addEventListener("drop",s=>{if(s.preventDefault(),r.classList.remove("aipkit-drag-over"),a.draggedElementType||a.draggedElement&&a.draggedElement.classList.contains("aipkit_dropped_element")){s.stopPropagation();let l=r.id;if(a.draggedElementType){let c=window.aipkitForms_createNewFormElementData(a.draggedElementType);a.formStructure.forEach(n=>{let e=n.columns.find(t=>t.internalId===l);e&&e.elements.push(c)}),window.aipkitForms_renderFieldInColumn(r,c,null,i)}else a.draggedElement&&(r.appendChild(a.draggedElement),window.aipkitForms_updateFormStructureOrder());a.draggedElementType=null,a.draggedElement&&(a.draggedElement.classList.remove("aipkit-row-dragging-source"),a.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_ai_form_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let a=r.querySelector(".aipkit_model_settings_popover_title"),s=r.querySelector(".aipkit_model_settings_popover_back"),l=o.querySelector("#aipkit_ai_form_settings_trigger"),c={root:r.dataset.titleRoot||"Settings",parameters:r.dataset.titleParameters||"Parameters",context:r.dataset.titleContext||"Context",tools:r.dataset.titleTools||"Tools"},n=null,e=t=>{let d=t||"root",_=r.querySelector(`[data-aipkit-settings-panel="${d}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!_)return;let p=_.dataset.aipkitSettingsPanel||"root";p!==n&&(i.forEach(f=>{f.hidden=f!==_}),a&&(a.textContent=c[p]||c.root),s&&(s.hidden=p==="root"),n=p,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",t=>{let d=t.target.closest("[data-aipkit-panel-target]");if(!d)return;t.preventDefault();let _=d.dataset.aipkitPanelTarget;e(_)}),s&&s.addEventListener("click",t=>{t.preventDefault(),e("root")}),l&&l.addEventListener("click",()=>{e("root")}),e("root"),r.dataset.panelsBound="true"}window.aipkitForms_initEditorSettingsPopover=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_form_editor_container");if(!r)return;let i=r.querySelector("#aipkit_ai_form_prompt_template"),a=r.querySelector(".aipkit_ai_form_prompt_expand"),s=document.getElementById("aipkit_ai_form_prompt_modal");if(!i||!a||!s)return;let l=s.querySelector(".aipkit_ai_form_prompt_modal_textarea"),c=s.querySelector(".aipkit_ai_form_prompt_count"),n=s.querySelector(".aipkit_ai_form_prompt_modal_close");if(s.dataset.bound==="1")return;let e=p=>{c&&(c.textContent=`${p.length.toLocaleString()} characters`)},t=p=>{l&&(l.value=p,e(p))},d=()=>{l&&(t(i.value||""),s.classList.add("aipkit-active"),s.setAttribute("aria-hidden","false"),setTimeout(()=>l.focus(),0))},_=p=>{if(s.classList.remove("aipkit-active"),s.setAttribute("aria-hidden","true"),!p||!l)return;let f=l.value;f!==i.value&&(i.value=f,i.dispatchEvent(new Event("input",{bubbles:!0})))};a.addEventListener("click",p=>{p.preventDefault(),d()}),n&&n.addEventListener("click",()=>{_(!0)}),document.addEventListener("keydown",p=>{p.key==="Escape"&&s.classList.contains("aipkit-active")&&_(!0)}),l&&l.dataset.bound!=="1"&&(l.addEventListener("input",()=>{e(l.value)}),l.dataset.bound="1"),s.dataset.bound="1"}window.aipkitForms_initPromptModal=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_ai_forms_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let a=r.querySelector(".aipkit_model_settings_popover_title"),s=r.querySelector(".aipkit_model_settings_popover_back"),l=r.querySelector(".aipkit_model_settings_popover_footer"),c=o.querySelector("#aipkit_ai_forms_settings_trigger"),n={root:r.dataset.titleRoot||"Settings",limits:r.dataset.titleLimits||"Limits","custom-css":r.dataset.titleCustomCss||"Custom CSS","provider-filtering":r.dataset.titleProviderFiltering||"Provider Filtering"},e=null,t=d=>{let _=d||"root",p=r.querySelector(`[data-aipkit-settings-panel="${_}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let f=p.dataset.aipkitSettingsPanel||"root";f!==e&&(i.forEach(g=>{g.hidden=g!==p}),a&&(a.textContent=n[f]||n.root),s&&(s.hidden=f==="root"),l&&(l.hidden=f==="root"),f==="limits"&&typeof window.aipkitForms_initializeTokenUI=="function"&&window.aipkitForms_initializeTokenUI(o),e=f,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",d=>{let _=d.target.closest("[data-aipkit-panel-target]");if(!_)return;d.preventDefault();let p=_.dataset.aipkitPanelTarget;t(p)}),s&&s.addEventListener("click",d=>{d.preventDefault(),t("root")}),c&&c.addEventListener("click",()=>{t("root")}),t("root"),r.dataset.panelsBound="true"}window.aipkitForms_initSettingsPopoverPanels=k})();(function(){"use strict";let k=[{key:"openai",label:"OpenAI"},{key:"google",label:"Google"},{key:"claude",label:"Claude"},{key:"openrouter",label:"OpenRouter"},{key:"azure",label:"Azure",keepWhenEmpty:!0,emptyMessage:"No Azure deployments found. Sync Azure models in main settings first."},{key:"ollama",label:"Ollama",requiresPro:!0},{key:"deepseek",label:"DeepSeek"}],o=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c,r=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(c,n)=>c.replace("%d",n),i=c=>{if(!c)return null;if(typeof c=="string")return{id:c,name:c};if(typeof c=="object"){let n=c.id||c.name||"";return n?{id:n,name:c.name||c.id||n}:null}return null},a=c=>{if(!c)return null;if(Array.isArray(c))return c.map(i).filter(Boolean);if(typeof c=="object"){let n={};return Object.keys(c).forEach(e=>{let d=(Array.isArray(c[e])?c[e]:[]).map(i).filter(Boolean);d.length&&(n[e]=d)}),n}return null},s=c=>c?Array.isArray(c)?c.length>0:Object.keys(c).length>0:!1;function l(c){let n=c||document,e=n.querySelector("#aipkit_ai_forms_models_selector");if(!e||e.dataset.enhanced==="true")return;let t=n.querySelector("#aipkit_aiforms_frontend_models"),d=n.querySelector("#aipkit_aiforms_frontend_providers");if(!t||!d)return;let _=o(),p=r(),g=(e.dataset.initialValue||t.value||"").split(",").map(b=>b.trim()).filter(Boolean),m=new Set(g),u=window.aipkit_dashboard||{},w=u.models||{},h=!!u.isProPlan,C=k.filter(b=>!b.requiresPro||h).map(b=>({...b,models:a(w[b.key])})).filter(b=>b.keepWhenEmpty||s(b.models));e.innerHTML="",e.classList.add("aipkit_models_selector--ready");let x=document.createElement("input");x.type="search",x.placeholder=_("Filter models...","gpt3-ai-content-generator"),x.className="aipkit_models_selector-search",e.appendChild(x);let v=document.createElement("div");v.className="aipkit_models_selector-summary",e.appendChild(v);let L=document.createElement("div");L.className="aipkit_models_selector-providers",e.appendChild(L);let P=b=>{let y=Array.from(e.querySelectorAll('.aipkit_models_selector-item input[type="checkbox"]:checked')),S=y.map(M=>M.value.trim()).filter(Boolean),E=new Set;y.forEach(M=>{M.dataset.providerName&&E.add(M.dataset.providerName)});let A=S.length?C.map(M=>M.label).filter(M=>E.has(M)).join(", "):"";t.value=S.join(", "),d.value=A,S.length===0?v.textContent=_("Showing all models (none selected)","gpt3-ai-content-generator"):S.length===1?v.textContent=_("1 model selected","gpt3-ai-content-generator"):v.textContent=p(_("%d models selected","gpt3-ai-content-generator"),S.length),b&&typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};C.forEach(b=>{let y=document.createElement("div");y.className="aipkit_models_selector-provider",y.dataset.provider=b.key;let S=document.createElement("div");S.className="aipkit_models_selector-provider-header",S.innerHTML=`<strong>${b.label}</strong>`;let E=document.createElement("div");E.className="aipkit_models_selector-provider-actions";let A=document.createElement("button");A.type="button",A.className="aipkit_btn aipkit_btn-xs",A.textContent=_("All","gpt3-ai-content-generator");let M=document.createElement("button");M.type="button",M.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",M.textContent=_("None","gpt3-ai-content-generator"),E.appendChild(A),E.appendChild(M),S.appendChild(E),y.appendChild(S);let $=document.createElement("div");$.className="aipkit_models_selector-models";let W=H=>{if(!H||!H.id)return;let N=document.createElement("label");N.className="aipkit_models_selector-item",N.title=H.id;let G=document.createElement("input");G.type="checkbox",G.value=H.id,G.checked=m.has(H.id),G.dataset.providerName=b.label,G.addEventListener("change",()=>P(!0));let J=document.createElement("span");J.textContent=H.name||H.id,N.appendChild(G),N.appendChild(J),$.appendChild(N)};if(Array.isArray(b.models)?b.models.forEach(H=>W(H)):b.models&&typeof b.models=="object"&&Object.keys(b.models).forEach(H=>{let N=b.models[H]||[];if(!N.length)return;let G=document.createElement("div");G.className="aipkit_models_selector-subgroup",G.textContent=H.charAt(0).toUpperCase()+H.slice(1),$.appendChild(G),N.forEach(J=>W(J))}),!s(b.models)){let H=document.createElement("div");H.className="aipkit_models_selector-empty",H.textContent=_(b.emptyMessage||"No models found.","gpt3-ai-content-generator"),$.appendChild(H)}A.addEventListener("click",()=>{$.querySelectorAll('input[type="checkbox"]').forEach(H=>{H.checked=!0}),P(!0)}),M.addEventListener("click",()=>{$.querySelectorAll('input[type="checkbox"]').forEach(H=>{H.checked=!1}),P(!0)}),y.appendChild($),L.appendChild(y)}),x.addEventListener("input",()=>{let b=x.value.toLowerCase();L.querySelectorAll(".aipkit_models_selector-provider").forEach(y=>{let S=!1;y.querySelectorAll(".aipkit_models_selector-item").forEach(E=>{let M=E.textContent.toLowerCase().includes(b);E.style.display=M?"":"none",M&&(S=!0)}),y.style.display=S||b===""?"":"none"})}),P(!1),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),e.dataset.enhanced="true"}window.aipkitForms_initAllowedModelsSelector=l})();(function(){"use strict";let k=window.wp?.i18n?.__||function(L){return L},o="#aipkit_ai_forms_container #aipkit_ai_form_ai_provider, #aipkit_ai_forms_container #aipkit_ai_form_ai_model, #aipkit_ai_forms_container #aipkit_ai_form_vector_store_provider",r=null,i=null,a=!1,s=L=>!!(L&&(L.id==="aipkit_ai_form_ai_provider"||L.id==="aipkit_ai_form_vector_store_provider")),l=L=>!!(L&&s(L)),c=(L,P)=>{if(!L)return!1;let b=n(P);return b?["openai","openrouter","google","azure","claude","deepseek","ollama","pinecone","qdrant"].includes(b):!1},n=L=>String(L||"").trim().toLowerCase(),e=(L,P,b)=>{if(!L)return;let y="aipkit_settings_select_picker_icon--";L.classList.forEach(A=>{A.startsWith(y)&&L.classList.remove(A)});let S=n(b),E=c(P,S);L.hidden=!E,E&&L.classList.add(`${y}${S}`)},t=L=>{if(!L)return"";let P=L.getAttribute("data-aipkit-picker-title");if(P)return P;let b=L.id&&document.querySelector(`label[for="${L.id}"]`)||L.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return b?b.textContent.trim():""},d=L=>{if(!L)return"";let P=L.selectedOptions&&L.selectedOptions.length?L.selectedOptions[0]:L.querySelector("option[selected]");if(P)return P.textContent.trim();let b=L.querySelector("option");return b?b.textContent.trim():""},_=L=>({buttonId:`${L}_picker_btn`,labelId:`${L}_picker_label`,popoverId:`${L}_picker_popover`,titleId:`${L}_picker_title`,searchId:`${L}_picker_search`,listId:`${L}_picker_list`}),p=(L,P)=>{if(!L||!L.id||!P)return null;let b=_(L.id),y=document.getElementById(b.buttonId);if(!y){if(y=document.createElement("button"),y.type="button",y.id=b.buttonId,y.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",y.setAttribute("data-aipkit-popover-target",b.popoverId),y.setAttribute("aria-controls",b.popoverId),y.setAttribute("aria-expanded","false"),y.dataset.aipkitPopoverPlacement="bottom",s(L)){y.classList.add("aipkit_settings_select_picker_btn--provider");let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),e(M,L,L.value),y.appendChild(M)}let E=document.createElement("span");E.className="aipkit_settings_select_picker_label",E.id=b.labelId,E.textContent=d(L)||k("Select","gpt3-ai-content-generator");let A=document.createElement("span");A.className="dashicons dashicons-arrow-down-alt2",A.setAttribute("aria-hidden","true"),y.appendChild(E),y.appendChild(A),L.insertAdjacentElement("beforebegin",y)}L.classList.contains("screen-reader-text")||L.classList.add("screen-reader-text");let S=document.getElementById(b.popoverId);if(!S){S=document.createElement("div"),S.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",S.id=b.popoverId,S.setAttribute("aria-hidden","true"),s(L)&&S.classList.add("aipkit_settings_select_picker_popover--provider");let E=document.createElement("div");E.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",E.setAttribute("role","dialog"),E.setAttribute("aria-labelledby",b.titleId);let A=document.createElement("div");A.className="aipkit_model_settings_popover_header";let M=document.createElement("span");M.className="aipkit_model_settings_popover_title",M.id=b.titleId,M.textContent=t(L)||k("Select","gpt3-ai-content-generator");let $=document.createElement("button");$.type="button",$.className="aipkit_model_settings_popover_close",$.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),$.innerHTML='<span class="dashicons dashicons-no-alt"></span>',A.appendChild(M),A.appendChild($);let W=document.createElement("div");W.className="aipkit_model_settings_popover_body";let H=document.createElement("div");H.className="aipkit_settings_select_picker_search";let N=document.createElement("input");N.type="search",N.id=b.searchId,N.className="aipkit_form-input";let G=t(L),J=G?`Search ${G.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");N.setAttribute("placeholder",J),H.appendChild(N);let F=document.createElement("div");F.className="aipkit_settings_select_picker_list",F.id=b.listId,F.setAttribute("role","listbox"),W.appendChild(H),W.appendChild(F),E.appendChild(A),E.appendChild(W),S.appendChild(E),P.appendChild(S),l(L)&&(H.style.display="none")}return{ids:b,button:y,popover:S,label:document.getElementById(b.labelId),search:document.getElementById(b.searchId),list:document.getElementById(b.listId)}},f=L=>{let P=[];return L&&Array.from(L.children).forEach(y=>{if(y.tagName==="OPTGROUP"){let S=Array.from(y.children).filter(E=>E.tagName==="OPTION").map(E=>({value:E.value,label:E.textContent.trim(),disabled:E.disabled,selected:E.selected}));P.push({label:y.label,options:S})}else y.tagName==="OPTION"&&P.push({label:"",options:[{value:y.value,label:y.textContent.trim(),disabled:y.disabled,selected:y.selected}]})}),P},g=(L,P,b="")=>{if(!L||!P)return;P.innerHTML="";let y=f(L),S=b.trim().toLowerCase(),E=!1;if(y.forEach(A=>{let M=A.options.filter($=>S?$.label.toLowerCase().includes(S):!0);if(M.length){if(A.label){let $=document.createElement("div");$.className="aipkit_settings_select_picker_group_label",$.textContent=A.label,P.appendChild($)}M.forEach($=>{let W=document.createElement("button");if(W.type="button",W.className="aipkit_settings_select_picker_item",$.disabled&&W.classList.add("is-disabled"),$.selected&&W.classList.add("is-active"),W.dataset.value=$.value,s(L)&&c(L,$.value)){let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),e(G,L,$.value),W.appendChild(G)}let H=document.createElement("span");H.className="aipkit_settings_select_picker_text",H.textContent=$.label||$.value;let N=document.createElement("span");N.className="dashicons dashicons-yes aipkit_settings_select_picker_check",N.setAttribute("aria-hidden","true"),W.appendChild(H),W.appendChild(N),P.appendChild(W),E=!0})}}),!E){let A=document.createElement("div");A.className="aipkit_settings_select_picker_empty",A.textContent=k(S?"No matches found.":"No options available.","gpt3-ai-content-generator"),P.appendChild(A)}},m=(L,P)=>{if(!L||!P)return;let b=d(L);if(P.textContent=b||k("Select","gpt3-ai-content-generator"),s(L)){let y=P.closest("button"),S=y?y.querySelector(".aipkit_settings_select_picker_icon"):null;e(S,L,L.value)}},u=(L,P)=>{if(!L||!P)return;let b=L.getBoundingClientRect(),y=P.getBoundingClientRect(),S=y.width||320,E=y.height||0,A=window.innerWidth,M=window.innerHeight,$=12;if(L.dataset.aipkitPopoverPlacement==="bottom"){let N=b.left;N+S>A-$&&(N=b.right-S),N=Math.max($,Math.min(N,A-S-$));let G=b.bottom+8;G+E>M-$&&(G=b.top-E-8),G=Math.max($,Math.min(G,M-E-$)),P.style.left=`${Math.round(N)}px`,P.style.top=`${Math.round(G)}px`;return}let W=b.right+10;W+S>A-$&&(W=b.left-S-10),W=Math.max($,Math.min(W,A-S-$));let H=b.top;H+E>M-$&&(H=M-E-$),H=Math.max($,H),P.style.left=`${Math.round(W)}px`,P.style.top=`${Math.round(H)}px`},w=()=>{!r||!i||a||(a=!0,window.requestAnimationFrame(()=>{let L=r.querySelector(".aipkit_model_settings_popover_panel");u(i,L),a=!1}))},h=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},C=(L,P,b)=>{if(!L||!P)return;r&&r!==P&&h(),r=P,i=L,P.classList.add("aipkit-active"),P.setAttribute("aria-hidden","false"),L.setAttribute("aria-expanded","true");let y=P.querySelector(".aipkit_settings_select_picker_search input"),S=P.querySelector(".aipkit_settings_select_picker_list");S&&g(b,S,y?y.value:""),y&&y.offsetParent!==null&&(y.focus(),y.select());let E=P.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(L,E)})},x=(L,P)=>{if(!L||!P)return;let{button:b,popover:y,list:S,search:E}=P;if(b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("click",A=>{if(A.preventDefault(),r===y){h();return}C(b,y,L)}),b.dataset.pickerListenerAttached="true"),y&&y.dataset.overlayListenerAttached!=="true"){y.addEventListener("click",M=>{M.target===y&&h()});let A=y.querySelector(".aipkit_model_settings_popover_close");A&&A.addEventListener("click",M=>{M.preventDefault(),h()}),y.dataset.overlayListenerAttached="true"}if(S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("click",A=>{let M=A.target.closest(".aipkit_settings_select_picker_item");if(!M||M.classList.contains("is-disabled"))return;let $=M.dataset.value??"";L.value=$,L.dispatchEvent(new Event("change",{bubbles:!0})),m(L,P.label),g(L,S,E?E.value:""),h()}),S.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("input",()=>{g(L,S,E.value)}),E.dataset.pickerListenerAttached="true"),L&&L.dataset.pickerListenerAttached!=="true"&&(L.addEventListener("change",()=>{m(L,P.label),g(L,S,E?E.value:"")}),L.dataset.pickerListenerAttached="true"),L&&L.dataset.pickerObserverAttached!=="true"){let A=!1;new MutationObserver(()=>{A||(A=!0,window.requestAnimationFrame(()=>{m(L,P.label),g(L,S,E?E.value:""),A=!1}))}).observe(L,{childList:!0,subtree:!0}),L.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitAiFormsPickerEscapeBound||(document.addEventListener("keydown",A=>{A.key==="Escape"&&r&&h()}),document.body.dataset.aipkitAiFormsPickerEscapeBound="true"),document.body.dataset.aipkitAiFormsPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitAiFormsPickerRepositionBound="true")};function v(L){let P=L||document.getElementById("aipkit_ai_forms_container");if(!P)return;let b=P.querySelectorAll(o);b.length&&b.forEach(y=>{if(!y.id||y.dataset.aipkitPickerInit==="true")return;let S=p(y,P);S&&(m(y,S.label),g(y,S.list,S.search?S.search.value:""),x(y,S),y.dataset.aipkitPickerInit="true")})}window.aipkitForms_initSelectPickers=v,window.aipkitForms_refreshSelectPickers=function(L){let P=L||document.getElementById("aipkit_ai_forms_container");if(!P)return;let b=P.querySelectorAll(o);b.length&&b.forEach(y=>{if(!y.id)return;let S=p(y,P);S&&(m(y,S.label),g(y,S.list,S.search?S.search.value:""),x(y,S),y.dataset.aipkitPickerInit="true")})}})();(function(){"use strict";let k={css:new Set,js:new Set},o=()=>{let d=typeof wp<"u"&&wp.i18n?wp.i18n:null;return{__:d&&typeof d.__=="function"?d.__:_=>_}},r=window.aipkit_escapeHtml||(d=>d),i=d=>{if(!d||k.css.has(d))return;if(document.querySelector(`link[href="${d}"]`)){k.css.add(d);return}let _=document.createElement("link");_.rel="stylesheet",_.href=d,document.head.appendChild(_),k.css.add(d)},a=d=>!d||k.js.has(d)?Promise.resolve():new Promise((_,p)=>{if(document.querySelector(`script[src="${d}"]`)){k.js.add(d),_();return}let f=document.createElement("script");f.src=d,f.async=!0,f.onload=()=>{k.js.add(d),_()},f.onerror=()=>p(new Error(`Failed to load script: ${d}`)),document.body.appendChild(f)}),s=(d,_,p="info")=>{if(!d)return;let f=p==="error"?"aipkit_ai_forms_preview_message aipkit_ai_forms_preview_message--error":"aipkit_ai_forms_preview_message",g=p==="error"?"":'<span class="aipkit_spinner" aria-hidden="true"></span>';d.innerHTML=`
      <div class="${f}">
        ${g}
        <span>${r(_)}</span>
      </div>
    `},l=(d,_,p={})=>{let{__:f}=o(),g=window.aipkit_ai_forms_config||{},m=p.loadingText||f("Loading preview...","gpt3-ai-content-generator");return _?d?typeof window.aipkit_apiRequest!="function"?(s(_,f("Preview loader is unavailable.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("API request helper missing."))):(s(_,m),window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:d,_ajax_nonce:g.nonce_manage_forms}).then(u=>(u.config&&(window.aipkit_ai_forms_public_config=u.config),u.models&&(window.aipkit_ai_forms_models=u.models),u.assets&&u.assets.css&&Object.values(u.assets.css).forEach(i),_.innerHTML=u.html||"",u.assets&&u.assets.js?Promise.all(Object.values(u.assets.js).map(a)):null)).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(u=>{let w=u&&u.message?u.message:"Unknown error.";throw s(_,`${f("Preview failed:","gpt3-ai-content-generator")} ${w}`,"error"),u})):(s(_,f("Missing form ID for preview.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("Form ID missing."))):Promise.reject(new Error("Preview container not found."))},c=d=>{let _=d||document.getElementById("aipkit_ai_forms_container");if(!_)return null;let p=_.querySelector("#aipkit_ai_forms_preview_sheet");return p?{container:_,overlay:p,panel:p.querySelector(".aipkit_builder_sheet_panel"),closeButton:p.querySelector("#aipkit_ai_forms_preview_sheet_close"),title:p.querySelector("#aipkit_ai_forms_preview_sheet_title"),description:p.querySelector("#aipkit_ai_forms_preview_sheet_description"),previewFrame:p.querySelector("#aipkit_ai_forms_preview_frame")}:null},n=(d,_,p)=>{let{__:f}=o(),g=c(p);if(!g)return;let m=_&&String(_).trim()||f("Untitled","gpt3-ai-content-generator");g.title&&(g.title.textContent=f("Preview","gpt3-ai-content-generator")),g.description&&(g.description.textContent="",g.description.removeAttribute("title"),g.description.setAttribute("hidden","true")),g.overlay.classList.add("aipkit-active"),g.overlay.setAttribute("aria-hidden","false"),g.previewFrame&&l(d,g.previewFrame).catch(()=>{}),g.closeButton&&g.closeButton.focus()},e=d=>{let _=c(d);_&&(_.overlay.classList.remove("aipkit-active"),_.overlay.setAttribute("aria-hidden","true"),_.previewFrame&&(_.previewFrame.innerHTML=""))},t=d=>{let _=c(d);!_||_.overlay.dataset.previewSheetInitialized==="true"||(_.closeButton&&_.closeButton.addEventListener("click",p=>{p.preventDefault(),e(_.container)}),_.overlay.addEventListener("click",p=>{p.target===_.overlay&&e(_.container)}),document.addEventListener("keydown",p=>{p.key==="Escape"&&_.overlay.classList.contains("aipkit-active")&&e(_.container)}),_.overlay.dataset.previewSheetInitialized="true")};window.aipkitForms_loadFormPreview=l,window.aipkitForms_openPreviewSheet=n,window.aipkitForms_closePreviewSheet=e,window.aipkitForms_initPreviewSheet=t})();(function(){"use strict";function k(){let o=window.aipkitForms_validateContainer();if(!o)return;let r=()=>{typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(o):console.error("AI Forms Init: aipkit_initContentWriterPopovers function not found.")};if(o.dataset.aipkitInitialized==="true"){r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"&&window.aipkitForms_initSettingsPopoverPanels(o),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(o),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(o),typeof window.aipkitForms_initSettingsAutosave=="function"&&window.aipkitForms_initSettingsAutosave(o),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(o),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(o),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(o),window.aipkitForms_initializeDragAndDrop(o),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(o),window.aipkitForms_initializeTokenUI(o);return}r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"?window.aipkitForms_initSettingsPopoverPanels(o):console.error("AI Forms Init: aipkitForms_initSettingsPopoverPanels function not found."),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(o),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(o),typeof window.aipkitForms_initSettingsAutosave=="function"?window.aipkitForms_initSettingsAutosave(o):console.error("AI Forms Init: aipkitForms_initSettingsAutosave function not found."),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(o),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(o),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(o),window.aipkitForms_attachClickEventListeners(o),window.aipkitForms_attachChangeEventListeners(o),window.aipkitForms_attachSettingsPanelListeners(o),window.aipkitForms_initializeAccordions(o),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(o):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(o),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(o),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(o):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(o):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),o.dataset.aipkitInitialized="true"}window.aipkit_initAiForms=k})();(function(){"use strict";let k="",o={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",status:"task_config_status",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",status:"task_config_status",prompts:"task_config_ai",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",status:"task_config_status",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",status:"task_config_status",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function r(){let l=document.getElementById("aipkit_automated_task_form"),c=document.getElementById("aipkit_provider_notice_autogpt");if(!l||!c)return;l.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"][data-aipkit-provider-notice-defer="1"]').forEach(_=>{delete _.dataset.aipkitProviderNoticeArmed});let e=Array.from(l.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"]')),t=_=>_&&(_.offsetParent!==null||_.getClientRects().length>0),d=e.filter(t);if(!d.length){c.classList.add("aipkit_provider_notice--hidden");return}d.forEach(_=>{_.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(_.dataset.aipkitProviderNoticeArmed="true")}),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(l)}function i(l){if(!l)return null;let c="content_writing";return l==="content_indexing"?c="content_indexing":l==="community_reply_comments"?c="community_reply_comments":l==="enhance_existing_content"&&(c="enhance_existing_content"),window.aipkit_wizardConfig[c]||null}function a(l){let c=document.querySelector(".aipkit_wizard_content_container"),n=document.getElementById("aipkit_save_task_btn");if(!c)return;let e=i(l);if(!e){c.querySelectorAll(".aipkit_wizard_content_step").forEach(d=>{d.style.display="none",d.classList.remove("aipkit_active")}),n&&(n.style.display="none"),r();return}let t=new Set(Object.values(e.contentMap));c.querySelectorAll(".aipkit_wizard_content_step").forEach(d=>{let _=d.dataset.contentId||"";t.has(_)?(d.style.display="block",d.classList.add("aipkit_active")):(d.style.display="none",d.classList.remove("aipkit_active"))}),n&&(n.style.display="inline-flex"),r()}function s(l){k=l,a(l)}window.aipkit_renderWizard=s,window.aipkit_initWizardNavigation=()=>{},window.aipkit_resetWizard=()=>{k="",a("")},window.aipkit_wizardConfig=o})();(function(){"use strict";function k(o){let r=window.aipkit_automated_tasks_config||{},i=r.text||{},a=window.aipkit_escapeHtml||function(n){return n},s=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!s)return Promise.resolve();s.innerHTML=`<option value="">${a(i.loading_stores||"Loading...")}</option>`,s.disabled=!0;let l=[],c=i.select_target_store||"-- Select Target Store --";return o==="openai"&&r.openai_vector_stores?l=r.openai_vector_stores:o==="pinecone"&&r.pinecone_indexes?(l=r.pinecone_indexes,c=i.select_target_index||"-- Select Target Index --"):o==="qdrant"&&r.qdrant_collections&&(l=r.qdrant_collections,c=i.select_target_collection||"-- Select Target Collection --"),s.innerHTML=`<option value="">${a(c)}</option>`,l&&Array.isArray(l)&&l.length>0?(l.forEach(n=>{let e=n.id||n.name,t=n.name||n.id,d=a(t);o==="openai"&&n.file_counts?.total!==void 0?d+=` (Files: ${n.file_counts.total})`:o==="pinecone"&&n.dimension!==void 0&&(d+=` (Dim: ${n.dimension})`),s.appendChild(new Option(d,e))}),s.disabled=!1):(s.appendChild(new Option(a(i.no_targets_found_configure||`No ${o} targets found. Configure in AI Training.`),"")),s.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=k})();(function(){"use strict";function k(){let o=window.aipkit_automated_tasks_config||{},r=o.text||{},i=window.aipkit_escapeHtml||function(_){return _},a=document.getElementById("aipkit_task_content_indexing_embedding_model"),s=window.aipkit_automated_tasks_form_state||{},l=s.pendingEmbeddingModelSelection;if(!a)return Promise.resolve();a.innerHTML=`<option value="">${i(r.select_embedding_model||"-- Select Model --")}</option>`;let c=o.openai_embedding_models||[],n=o.google_embedding_models||[],e=o.openrouter_embedding_models||[],t=o.azure_embedding_models||[],d=(_,p,f)=>{let g=document.createElement("optgroup");return g.label=i(_),p&&p.length>0&&p.forEach(m=>{let u=`${f}:${m.id}`;g.appendChild(new Option(i(m.name||m.id),u))}),g};if(a.appendChild(d("OpenAI",c,"openai")),a.appendChild(d("Google",n,"google")),a.appendChild(d("OpenRouter",e,"openrouter")),a.appendChild(d("Azure",t,"azure")),a.disabled=c.length===0&&n.length===0&&e.length===0&&t.length===0,a.disabled&&(a.innerHTML=`<option value="">${i(r.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),l&&a.querySelector(`option[value="${CSS.escape(l)}"]`))a.value=l,s.pendingEmbeddingModelSelection=null;else if(a.options.length>1){let _=a.querySelector("optgroup");_&&_.options.length>0&&(a.value=_.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=k})();(function(){"use strict";function k(o){let r=o.target.value,i=document.getElementById("aipkit_task_content_indexing_embedding_model_group"),a=document.getElementById("aipkit_task_content_indexing_embedding_model_divider");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(r):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),i){let s=r==="pinecone"||r==="qdrant";i.style.display=s?"block":"none",a&&(a.style.display=s?"flex":"none"),s&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_autogpt_container");if(!o)return;let r=o.querySelector("#aipkit_task_content_indexing_target_store_provider");if(r){if(r.dataset.listenerAttached==="true")return;typeof window.aipkit_handleTargetStoreProviderChange=="function"?(r.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:r}),r.dataset.listenerAttached="true"):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found.")}}window.aipkit_initContentIndexingTaskFormUI=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},o=window.wp?.i18n?.__||function(i){return i};function r(i,a){let s=i.value,l=s?s.toLowerCase():"",c=window.aipkit_dashboard?.models,n=window.aipkit_automated_tasks_form_state||{};if(!a)return;if(!c){a.innerHTML=`<option value="">${k("Error: Model data object not found")}</option>`,a.disabled=!0;return}let e=c[l];(typeof e>"u"||e===null)&&(console.warn(`AutoGPT Model Populator: No model data for provider '${l}'.`),e=l==="openai"?{}:[]);let t=n.pendingModelSelection||a.value;a.innerHTML="";let d=window.aipkit_dashboard?.recommendedModels?.[l]||[],_=Array.isArray(d)?d:[],p=new Set(_.map(f=>f?.id).filter(Boolean));if(l==="openai"&&typeof e=="object"&&!Array.isArray(e)){if(_.length>0){let f=document.createElement("optgroup");f.label=k(o("Recommended","gpt3-ai-content-generator")),_.forEach(g=>{g&&typeof g=="object"&&g.id&&f.appendChild(new Option(k(g.name||g.id),g.id))}),f.children.length>0&&a.appendChild(f)}Object.keys(e).forEach(f=>{let g=document.createElement("optgroup");g.label=k(f),Array.isArray(e[f])&&e[f].forEach(m=>{if(m&&m.id){if(p.has(m.id))return;g.appendChild(new Option(k(m.name||m.id),m.id))}}),a.appendChild(g)})}else if(Array.isArray(e)){if(_.length>0){let g=document.createElement("optgroup");g.label=k(o("Recommended","gpt3-ai-content-generator")),_.forEach(m=>{m&&typeof m=="object"&&m.id&&g.appendChild(new Option(k(m.name||m.id),m.id))}),g.children.length>0&&a.appendChild(g)}let f=_.length>0?document.createElement("optgroup"):null;f&&(f.label=k(o("All models","gpt3-ai-content-generator"))),e.forEach(g=>{if(g&&g.id){if(p.has(g.id))return;let m=new Option(k(g.name||g.id),g.id);f?f.appendChild(m):a.appendChild(m)}}),f&&f.children.length>0&&a.appendChild(f)}else console.warn(`AutoGPT Model Populator: Unexpected format for provider '${l}'.`),a.appendChild(new Option(k(`No models for ${s} (Format Error)`),""));if(a.options.length===0)a.appendChild(new Option(k(`No models for ${s}`),"")),a.disabled=!0;else{a.disabled=!1;let f=!1;if(t&&a.querySelector(`option[value="${CSS.escape(t)}"]`)&&(a.value=t,f=!0),!f&&a.options.length>0){let g=a.querySelector('option:not([value=""])');g&&(a.value=g.value)}}n&&(n.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort(),a&&a.dispatchEvent(new Event("change",{bubbles:!0}))}window.aipkit_task_cw_populateModels=r})();(function(){"use strict";function k(o){if(!o)return;let r=o.closest(".aipkit_slider_wrapper"),i=null;if(r&&(i=r.querySelector(".aipkit_slider_value")),!i){let a=o.closest(".aipkit_ai_temperature_control");a&&(i=a.querySelector(".aipkit_ai_behavior_value"))}i&&(i.textContent=o.value,o.dataset.listenerAttached||(o.addEventListener("input",()=>i.textContent=o.value),o.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.closest(".aipkit_slider_wrapper"),i=r?r.querySelector(".aipkit_slider_value"):null;i&&(i.textContent=o.value,o.dataset.listenerAttached||(o.addEventListener("input",()=>i.textContent=o.value),o.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=k})();(function(){"use strict";function k(o){let r=o.target,i=r.closest(".aipkit_post_settings_redesigned")||r.closest(".aipkit_wizard_content_step")||document,a=i.querySelector("#aipkit_task_cw_schedule_options_wrapper"),s=i.querySelector("#aipkit_task_cw_smart_schedule_fields"),l=i.querySelector(".aipkit_task_schedule_from_input_option"),c=l?l.querySelector(".aipkit_post_schedule_radio_text"):null,n=l?l.querySelector(".aipkit_popover_warning[data-tooltip]"):null;if(!a)return;let e=r.value==="publish";a.style.display=e?"block":"none";let t=document.getElementById("aipkit_automated_task_type"),d=new Set(["content_writing_bulk","content_writing_csv","content_writing_gsheets"]),_=`Accepted formats: YYYY-MM-DD HH:MM[:SS], YYYY/MM/DD HH:MM, MM/DD/YYYY HH:MM, DD/MM/YYYY HH:MM, or ISO 8601.

Times use the site timezone unless an offset/Z is provided.`,p={content_writing_bulk:{label:"Use Dates from List",tooltip:`Use when your list includes a publish date on each line.

`+_},content_writing_csv:{label:"Use Dates from CSV",tooltip:`Use when your CSV includes a publish date column.

`+_},content_writing_gsheets:{label:"Use Dates from Sheets",tooltip:`Use when your Google Sheets includes a publish date column.

`+_}},f={label:"Use Dates from Input",tooltip:`Use when your input includes a publish date.

`+_},g=()=>{if(!t)return;let h=p[t.value]||f;c&&(c.textContent=h.label),n&&n.setAttribute("data-tooltip",h.tooltip)},m=t&&d.has(t.value);if(l&&(g(),l.style.display=m?"inline-flex":"none",!m)){let h=l.querySelector('input[name="schedule_mode"][value="from_input"]');if(h&&h.checked){let C=i.querySelector('input[name="schedule_mode"][value="immediate"]');C&&(C.checked=!0,C.dispatchEvent(new Event("change",{bubbles:!0})))}}t&&!t.dataset.fromInputCopyListener&&(t.addEventListener("change",()=>{g()}),t.dataset.fromInputCopyListener="true"),i.querySelectorAll('input[name="schedule_mode"]').forEach(h=>{h.dataset.listenerAttached||(h.addEventListener("change",function(){let C=t&&d.has(t.value);s&&(s.style.display=this.value==="smart"?"block":"none")}),h.dataset.listenerAttached="true")});let w=i.querySelector('input[name="schedule_mode"]:checked');w&&s&&(s.style.display=w.value==="smart"?"block":"none")}window.aipkit_toggleTaskCwScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||(e=>e);function o(e){if(!e)return;let t=e.querySelector(".aipkit_task_cw_vector_store_toggle"),d=e.querySelectorAll(".aipkit_task_cw_vector_store_settings_container");if(!t||!d.length)return;let _=t.checked;d.forEach(p=>{p.style.display=_?"block":"none"}),_&&r(e)}function r(e){if(!e)return;let t=e.querySelector(".aipkit_task_cw_vector_store_provider_select");if(!t)return;let d=t.value,_=e.querySelector(".aipkit_task_cw_vector_openai_field"),p=e.querySelector(".aipkit_task_cw_vector_pinecone_field"),f=e.querySelector(".aipkit_task_cw_vector_qdrant_field"),g=e.querySelector(".aipkit_task_cw_vector_embedding_config_row"),m=(u,w)=>{u&&(u.style.display=w?"block":"none")};if(m(_,d==="openai"),m(p,d==="pinecone"),m(f,d==="qdrant"),g){let u=d==="pinecone"||d==="qdrant";g.style.display=u?"block":"none",u&&i(e)}}function i(e){let t=e.querySelector("#aipkit_task_cw_vector_embedding_model");if(!t)return;let d=e.querySelector("#aipkit_task_cw_vector_embedding_provider"),_=d?d.value:"openai",p=window.aipkit_automated_tasks_config||{},f=window.aipkit_automated_tasks_form_state||{},g=[];if(_==="google"?g=p.google_embedding_models||[]:_==="openrouter"?g=p.openrouter_embedding_models||[]:_==="azure"?g=p.azure_embedding_models||[]:g=p.openai_embedding_models||[],t.innerHTML="",g.length>0){t.add(new Option("-- Select Model --","")),g.forEach(u=>{t.add(new Option(k(u.name||u.id),u.id))}),t.disabled=!1;let m=f.pendingEmbeddingModelSelection;m&&Array.from(t.options).find(w=>w.value===m)&&(t.value=m,f.pendingEmbeddingModelSelection=null)}else t.add(new Option("No models found","")),t.disabled=!0}function a(e){if(!e)return;let t=e.getAttribute("aria-expanded")==="true",d=e.getAttribute("aria-controls"),_=document.getElementById(d);_&&(e.setAttribute("aria-expanded",(!t).toString()),_.setAttribute("aria-hidden",t?"true":"false"))}function s(e){if(!e)return;let t=document.getElementById(e.id+"_value");t&&(t.textContent=e.value)}function l(e){e&&(e.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(t=>{t.querySelector(".aipkit_task_cw_vector_store_toggle")&&(o(t),t.querySelectorAll(".aipkit_vector_slider").forEach(d=>{s(d)}))}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(e))}function c(){let e=document.getElementById("aipkit_autogpt_container");!e||e.dataset.kbListenerAttached==="true"||(e.addEventListener("change",t=>{let d=t.target;if(d.matches(".aipkit_task_cw_vector_store_toggle")){let _=d.closest(".aipkit_vector_settings_redesigned");o(_)}else if(d.matches(".aipkit_task_cw_vector_store_provider_select")){let _=d.closest(".aipkit_vector_settings_redesigned");r(_)}else if(d.matches(".aipkit_task_cw_vector_embedding_provider_select")){let _=d.closest(".aipkit_vector_settings_redesigned");i(_)}}),e.addEventListener("input",t=>{let d=t.target;d.matches(".aipkit_vector_slider")&&s(d)}),e.addEventListener("click",t=>{let d=t.target.closest(".aipkit_vector_settings_chunk_header--collapsible");if(!d)return;let _=d.closest(".aipkit_vector_settings_redesigned");!_||!_.querySelector(".aipkit_task_cw_vector_store_toggle")||(t.preventDefault(),a(d))}),l(e),e.dataset.kbListenerAttached="true")}function n(){let e=document.getElementById("aipkit_autogpt_container");e&&(c(),e.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(t=>{t.querySelector(".aipkit_task_cw_vector_store_toggle")&&(o(t),r(t),i(t))}))}window.aipkit_initCwKnowledgeBaseUI=c,window.aipkit_cw_task_populateEmbeddingModelSelect=i,window.aipkit_updateCwKnowledgeBaseUI=n})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_automated_task_form");if(!i){console.warn("Content Writing UI Init: Could not find main form element.");return}let a=i.querySelector("#aipkit_task_cw_ai_provider"),s=i.querySelector("#aipkit_task_cw_ai_model");a&&s&&typeof window.aipkit_task_cw_populateModels=="function"&&(a.dataset.cwProviderListenerAttached||(a.addEventListener("change",()=>window.aipkit_task_cw_populateModels(a,s)),a.dataset.cwProviderListenerAttached="true"),s.dataset.cwModelListenerAttached||(s.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),s.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(a,s),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let l=i.querySelector("#aipkit_task_cw_ai_temperature");l&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(l);let c=i.querySelector("#aipkit_task_cw_post_status");c&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(c.dataset.cwStatusListenerAttached||(c.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),c.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:c})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect(i),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initTaskRssInputHandler=="function"?window.aipkit_initTaskRssInputHandler():typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let e=i.querySelector(".aipkit_task_cw_image_enable_toggle");e&&(e.dataset.cwImgListenerAttached||(e.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),e.dataset.cwImgListenerAttached="true"));let t=i.querySelector("#aipkit_task_cw_image_provider");t&&(t.dataset.cwImgListenerAttached||(t.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),t.dataset.cwImgListenerAttached="true"));let d=i.querySelector("#aipkit_task_cw_generate_featured_image");d&&(d.dataset.cwImgListenerAttached||(d.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),d.dataset.cwImgListenerAttached="true"));let _=i.querySelector(".aipkit_task_cw_image_placement_select");_&&(_.dataset.cwImgListenerAttached||(_.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),_.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100));let p=i.querySelector(".aipkit_image_settings_redesigned");p&&p.dataset.imageChunkListenerAttached!=="true"&&(p.addEventListener("click",C=>{let x=C.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!x)return;C.preventDefault();let v=x.getAttribute("aria-expanded")==="true",L=x.getAttribute("aria-controls");if(!L)return;let P=document.getElementById(L);x.setAttribute("aria-expanded",(!v).toString()),P&&P.setAttribute("aria-hidden",v?"true":"false")}),p.dataset.imageChunkListenerAttached="true");let f=async C=>{if(!C||!C.name)return;let x=C.value.trim(),v=C.dataset.apiKeyBaseline||"";if(x===v||C.dataset.apiKeySaving==="true"||typeof window.aipkit_apiRequest!="function")return;let L=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,P=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,b=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;C.dataset.apiKeySaving="true",C.dataset.apiKeyBaseline=x,L&&L("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[C.name]:x}),P&&P("Updated")}catch(y){C.dataset.apiKeyBaseline=v,b&&b(`Error: ${y.message||"Failed to save."}`)}finally{C.dataset.apiKeySaving="false"}};i.querySelectorAll(".aipkit_task_cw_stock_api_key, #aipkit_task_cw_replicate_api_key").forEach(C=>{if(C.dataset.apiKeyListenerAttached==="true")return;C.dataset.apiKeyBaseline=C.value.trim();let x=()=>{f(C)};C.addEventListener("change",x),C.addEventListener("blur",x),C.dataset.apiKeyListenerAttached="true"}),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let m=i.querySelector("#aipkit_task_cw_ai_settings_toggle"),u=i.querySelector("#aipkit_task_cw_ai_parameters_row");m&&u&&(m.dataset.cwAiSettingsListenerAttached||(m.addEventListener("click",()=>{let C=u.style.display==="none"||u.style.display==="";u.style.display=C?"block":"none",m.classList.toggle("aipkit_active",C),m.setAttribute("aria-expanded",C)}),m.dataset.cwAiSettingsListenerAttached="true"));let w=i.querySelector("#aipkit_task_config_ai");w&&(w.dataset.cwPromptListenerAttached||(w.addEventListener("click",C=>{let x=C.target.closest(".aipkit_textarea_toggle");if(!x)return;let v=x.dataset.target,L=document.getElementById(v),P=x.querySelector(".dashicons");if(!L||!P)return;L.classList.toggle("aipkit_collapsed")?(P.classList.remove("dashicons-minus"),P.classList.add("dashicons-plus-alt2"),x.title="Expand"):(P.classList.remove("dashicons-plus-alt2"),P.classList.add("dashicons-minus"),x.title="Collapse")}),w.dataset.cwPromptListenerAttached="true"));let h=i.querySelector("#aipkit_task_config_seo");h&&(h.dataset.cwSeoPromptListenerAttached||(h.addEventListener("click",C=>{let x=C.target.closest(".aipkit_textarea_toggle");if(!x)return;let v=x.dataset.target,L=document.getElementById(v),P=x.querySelector(".dashicons");if(!L||!P)return;L.classList.toggle("aipkit_collapsed")?(P.classList.remove("dashicons-minus"),P.classList.add("dashicons-plus-alt2"),x.title="Expand"):(P.classList.remove("dashicons-plus-alt2"),P.classList.add("dashicons-minus"),x.title="Collapse")}),h.dataset.cwSeoPromptListenerAttached="true"))}function o(){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let a=window.aipkit_debug||!1,s=i.querySelector(".aipkit_task_cw_image_enable_toggle"),l=i.querySelector("#aipkit_task_cw_generate_featured_image"),c=i.querySelector(".aipkit_task_cw_image_settings_container"),n=i.querySelector("#aipkit_task_cw_image_provider");if(!s||!l||!c||!n)return;let e=s.checked,t=l.checked,d=e||t,_=n.value,p=_==="pexels"||_==="pixabay";if(c.style.display=d?"block":"none",d){let f=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],g=i.querySelector(".aipkit_task_cw_image_placement_select"),m=i.querySelector(".aipkit_task_cw_image_placement_x_field"),u=i.querySelector("#aipkit_task_cw_pexels_options"),w=i.querySelector("#aipkit_task_cw_pixabay_options"),h=i.querySelector("#aipkit_task_cw_replicate_options"),C=i.querySelector(".aipkit_task_cw_image_display_chunk"),x=i.querySelector("#aipkit_task_cw_image_model_group"),v=i.querySelector("#aipkit_task_cw_image_model_divider");if(f.forEach(L=>{let P=i.querySelector(L);if(P){let b=P.closest(".aipkit_form-group");b&&(b.style.display=e?"block":"none")}}),C&&(C.style.display=e?"":"none"),g&&m){let L=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(g.value);m.style.display=e&&L?"block":"none"}u&&(u.style.display=d&&p&&_==="pexels"?"block":"none"),w&&(w.style.display=d&&p&&_==="pixabay"?"block":"none"),h&&(h.style.display=d&&_==="replicate"?"block":"none"),x&&(x.style.display=d&&!p?"":"none"),v&&(v.style.display=d&&!p?"":"none"),d&&!p&&typeof r=="function"&&r(_)}}function r(i){let a=document.getElementById("aipkit_task_cw_image_model");if(!a)return;let s=a.value,c=window.aipkit_dashboard?.imageGeneratorModels?.[i.toLowerCase()]||[],n=window.aipkit_escapeHtml||function(t){return t},e=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||a.value;if(a.innerHTML="",c.length>0?(c.forEach(t=>{a.appendChild(new Option(n(t.name),t.id))}),a.querySelector(`option[value="${CSS.escape(e)}"]`)&&(a.value=e)):a.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null),typeof window.aipkit_updateAutogptAiSummaries=="function"&&a.value!==s){let t=document.getElementById("aipkit_autogpt_container");window.aipkit_updateAutogptAiSummaries(t)}}window.aipkit_initContentWritingTaskFormUI=k,window.aipkit_updateTaskImageSettingsUI=o,window.aipkit_populateTaskImageModels=r})();(function(){"use strict";function k(){let o=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!o)return;let r=o.querySelector("#aipkit_task_cc_ai_provider"),i=o.querySelector("#aipkit_task_cc_ai_model");r&&i&&typeof window.aipkit_task_cw_populateModels=="function"&&(r.dataset.ccProviderListenerAttached||(r.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(r,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),r.dataset.ccProviderListenerAttached="true"),i.dataset.ccModelListenerAttached||(i.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),i.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(r,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let a=o.querySelector("#aipkit_task_cc_ai_temperature");a&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(a);let s=o.querySelector("#aipkit_task_cc_content_max_tokens");s&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(s);let l=o.querySelector("#aipkit_task_cc_ai_settings_toggle"),c=o.querySelector("#aipkit_task_cc_ai_parameters_row");l&&c&&(l.dataset.ccAiSettingsListenerAttached||(l.addEventListener("click",()=>{let n=c.style.display==="none"||c.style.display==="";c.style.display=n?"block":"none",l.classList.toggle("aipkit_active",n),l.setAttribute("aria-expanded",n)}),l.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=k})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelectorAll("[data-aipkit-popover-target]");if(!i.length)return;let a=null,s=null,l=!1,c=_=>_?r.querySelector(`#${_}`):null,n=(_,p)=>{if(!_||!p)return;let f=_.getBoundingClientRect(),g=p.getBoundingClientRect(),m=g.width||400,u=g.height||0,w=window.innerWidth,h=window.innerHeight,C=12;if(_.dataset.aipkitPopoverPlacement==="bottom"){let L=f.left;L+m>w-C&&(L=f.right-m),L=Math.max(C,Math.min(L,w-m-C));let P=f.bottom+8;P+u>h-C&&(P=f.top-u-8),P=Math.max(C,Math.min(P,h-u-C)),p.style.left=`${Math.round(L)}px`,p.style.top=`${Math.round(P)}px`;return}if(_.dataset.aipkitPopoverPlacement==="left"){let L=f.left-m-10;L<C&&(L=f.right+10),L=Math.max(C,Math.min(L,w-m-C));let P=f.top;P+u>h-C&&(P=h-u-C),P=Math.max(C,P),p.style.left=`${Math.round(L)}px`,p.style.top=`${Math.round(P)}px`;return}let x=f.right+10;x+m>w-C&&(x=f.right-m-10),x=Math.max(C,Math.min(x,w-m-C));let v=f.top;v+u>h-C&&(v=h-u-C),v=Math.max(C,v),p.style.left=`${Math.round(x)}px`,p.style.top=`${Math.round(v)}px`},e=()=>{!s||!a||l||(l=!0,window.requestAnimationFrame(()=>{let _=a.querySelector(".aipkit_model_settings_popover_panel");n(s,_),l=!1}))},t=()=>{a&&(a.classList.remove("aipkit-active"),a.setAttribute("aria-hidden","true"),s&&s.setAttribute("aria-expanded","false"),a=null,s=null)},d=_=>{if(!_)return;let p=_.getAttribute("data-aipkit-popover-target"),f=c(p);if(!f)return;a&&a!==f&&t(),a=f,s=_,f.classList.add("aipkit-active"),f.setAttribute("aria-hidden","false"),_.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${p}`),typeof window.aipkit_initAutogptPromptFlyouts=="function"&&window.aipkit_initAutogptPromptFlyouts(r);let g=f.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{n(_,g)})};i.forEach(_=>{_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",p=>{if(p.preventDefault(),!(_.dataset.aipkitPopoverKeepOpen==="true")&&a&&s===_&&a.classList.contains("aipkit-active")){t();return}d(_)}),_.dataset.popoverListenerAttached="true")}),r.querySelectorAll(".aipkit_model_settings_popover").forEach(_=>{_.dataset.overlayListenerAttached!=="true"&&(_.addEventListener("click",f=>{f.target===_&&t()}),_.dataset.overlayListenerAttached="true");let p=_.querySelector(".aipkit_model_settings_popover_close");p&&p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",f=>{f.preventDefault(),t()}),p.dataset.popoverListenerAttached="true"),_.querySelectorAll("[data-aipkit-popover-close]").forEach(f=>{f.dataset.popoverListenerAttached!=="true"&&(f.addEventListener("click",g=>{g.preventDefault(),t()}),f.dataset.popoverListenerAttached="true")})}),r.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",_=>{_.key==="Escape"&&a&&t()}),r.dataset.escapeListenerAttached="true"),r.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),r.dataset.repositionListenersAttached="true")}function o(){let r=document.getElementById("aipkit_autogpt_container");r&&k(r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o(),window.aipkit_initAutogptPopovers=k})();(function(){"use strict";let k=n=>{if(!n)return"";let e=n.options?n.options[n.selectedIndex]:null;return e?e.textContent.trim():""},o=n=>n?Array.from(n.selectedOptions||[]).map(e=>e.textContent.trim()).filter(Boolean):[],r=(n,e)=>{let t=n.filter(Boolean);return t.length?t.join(", "):e||""},i=(n,e)=>{if(!n)return;n.textContent=e,n.title=e;let t=n.dataset.aipkitPlaceholder||"",d="active";t&&e===t&&(d="placeholder"),n.dataset.aipkitSummaryState=d},a=(n,e)=>{if(!n)return;let t=e||document,d=n.dataset.aipkitAutogptSummary||"",_=n.dataset.aipkitAutogptProvider||"",p=n.dataset.aipkitAutogptModel||"",f=p?t.querySelector(p):null,g=k(f),m=n.dataset.aipkitPlaceholder||"Select";if(d==="images"){let u=n.dataset.aipkitDisabledLabel||m,w=n.dataset.aipkitAutogptToggle||"",h=n.dataset.aipkitAutogptFeaturedToggle||"",C=w?t.querySelector(w):null,x=h?t.querySelector(h):null;if(!(C&&C.checked||x&&x.checked)){i(n,u);return}let L=_?t.querySelector(_):null,P=L?L.value:"",b=k(L);if(["pexels","pixabay"].includes(P)){i(n,b||m);return}i(n,g||b||m);return}if(d==="vector"){let u=n.dataset.aipkitDisabledLabel||m,w=n.dataset.aipkitAutogptToggle||"",h=w?t.querySelector(w):null;if(!(h?h.checked:!0)){i(n,u);return}let x=_?t.querySelector(_):null,v=x?x.value:"",L=k(x),P=n.dataset.aipkitAutogptStore||"",b=n.dataset.aipkitAutogptOpenaiStore||"",y=n.dataset.aipkitAutogptPineconeStore||"",S=n.dataset.aipkitAutogptQdrantStore||"",E="";if(v==="openai"&&b){let A=t.querySelector(b);E=o(A).join(", ")}else v==="pinecone"&&y?E=k(t.querySelector(y)):v==="qdrant"&&S?E=k(t.querySelector(S)):P&&(E=k(t.querySelector(P)));i(n,r([E,L],m));return}i(n,g||m)},s=(n,e)=>{if(!n||n.dataset.aipkitAutogptSummaryBound==="true")return;let t=e||document,d=n.dataset.aipkitAutogptProvider||"",_=n.dataset.aipkitAutogptModel||"",p=n.dataset.aipkitAutogptToggle||"",f=n.dataset.aipkitAutogptFeaturedToggle||"",g=[n.dataset.aipkitAutogptStore||"",n.dataset.aipkitAutogptOpenaiStore||"",n.dataset.aipkitAutogptPineconeStore||"",n.dataset.aipkitAutogptQdrantStore||""].filter(Boolean),m=d?t.querySelector(d):null,u=_?t.querySelector(_):null,w=p?t.querySelector(p):null,h=f?t.querySelector(f):null,C=()=>a(n,t);m&&m.addEventListener("change",C),u&&u.addEventListener("change",C),w&&w.addEventListener("change",C),h&&h.addEventListener("change",C),g.forEach(x=>{let v=t.querySelector(x);v&&v.addEventListener("change",C)}),n.dataset.aipkitAutogptSummaryBound="true",a(n,t)};function l(n){let e=n||document.getElementById("aipkit_autogpt_container");if(!e)return;e.querySelectorAll("[data-aipkit-autogpt-summary]").forEach(d=>{s(d,e),a(d,e)})}function c(){let n=document.getElementById("aipkit_autogpt_container");n&&l(n)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.aipkit_updateAutogptAiSummaries=l})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"]},o={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},r=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),i=()=>{let t=document.getElementById("aipkit_automated_task_type"),d=t?t.value:"";return d==="content_writing"?"bulk":d&&d.startsWith("content_writing_")&&d.replace("content_writing_","")||"bulk"},a=(t,d)=>{let _=k[t]||[],p=o[d]||[],f=[..._,...p];return f.filter((g,m)=>f.indexOf(g)===m)},s=(t,d)=>{if(!t)return;let _=t.dataset.label||"Variables:",p=t.dataset.copyTitle||"Click to copy";t.innerHTML=`${r(_)} `,d.forEach((f,g)=>{let m=document.createElement("code");m.className="aipkit-placeholder",m.title=p,m.textContent=f,t.appendChild(m),g<d.length-1&&t.appendChild(document.createTextNode(" "))})},l=t=>{let d=t||document.getElementById("aipkit_autogpt_container");if(!d)return;let _=i(),p=d.querySelectorAll(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");p.length&&p.forEach(f=>{let g=f.dataset.promptType||"",m=a(g,_);m.length&&s(f,m)})};function c(t){let d=t.querySelectorAll(".aipkit_cw_prompt_library_select");d.length&&d.forEach(_=>{_.dataset.promptLibraryAttached!=="true"&&(_.addEventListener("change",()=>{let p=_.getAttribute("data-aipkit-prompt-target");if(!p||!_.value)return;let f=t.querySelector(`#${p}`);f&&(f.value=_.value,f.dispatchEvent(new Event("input",{bubbles:!0})))}),_.dataset.promptLibraryAttached="true")})}function n(t){if(!t)return;let d=t.querySelectorAll("[data-aipkit-flyout-target]");if(!d.length)return;let _=null,p=null,f=!1,g=C=>C?t.querySelector(`#${C}`):null,m=(C,x,v)=>{if(!C||!x||!_)return;let L=C.getBoundingClientRect(),P=v?v.getBoundingClientRect():L,b=x.getBoundingClientRect(),y=b.width||580,S=b.height||420,E=window.innerWidth,A=window.innerHeight,M=12,$=P.left-y-10;$<M&&($=P.right+10),$=Math.max(M,Math.min($,E-y-M));let W=P.top;W+S>A-M&&(W=A-S-M),W=Math.max(M,W),_.style.left=`${Math.round($)}px`,_.style.top=`${Math.round(W)}px`},u=()=>{!_||!p||f||(f=!0,window.requestAnimationFrame(()=>{let C=_.querySelector(".aipkit_cw_prompt_panel"),x=p.closest(".aipkit_model_settings_popover_panel");m(p,C,x),f=!1}))},w=()=>{_&&(_.classList.remove("is-open"),_.setAttribute("aria-hidden","true"),p&&p.setAttribute("aria-expanded","false"),_=null,p=null)},h=C=>{let x=C.getAttribute("data-aipkit-flyout-target"),v=g(x);v&&(_&&_!==v&&w(),_=v,p=C,v.classList.add("is-open"),v.setAttribute("aria-hidden","false"),C.setAttribute("aria-expanded","true"),l(v),window.requestAnimationFrame(()=>{let L=v.querySelector(".aipkit_cw_prompt_panel"),P=C.closest(".aipkit_model_settings_popover_panel");m(C,L,P)}))};d.forEach(C=>{C.dataset.promptFlyoutListenerAttached!=="true"&&(C.addEventListener("click",x=>{if(x.preventDefault(),_&&p===C&&_.classList.contains("is-open")){w();return}h(C)}),C.dataset.promptFlyoutListenerAttached="true")}),t.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(C=>{C.dataset.overlayListenerAttached!=="true"&&(C.addEventListener("click",x=>{x.target===C&&w()}),C.dataset.overlayListenerAttached="true")}),t.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",C=>{C.key==="Escape"&&_&&w()}),t.dataset.promptFlyoutEscapeAttached="true"),t.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",C=>{if(!_)return;let x=C.target;x.closest(".aipkit_cw_prompt_flyout")||x.closest("[data-aipkit-flyout-target]")||w()}),t.dataset.promptFlyoutClickAttached="true"),t.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),t.dataset.promptFlyoutRepositionAttached="true")}function e(t){let d=t||document.getElementById("aipkit_autogpt_container");d&&(c(d),n(d),l(d))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>e()):e(),window.aipkit_initAutogptPromptFlyouts=e,window.aipkit_updateAutogptPromptPlaceholders=()=>{l()}})();(function(){"use strict";function k(){let c=document.querySelector("#aipkit_task_cw_ai_provider"),n=document.querySelector("#aipkit_task_cw_ai_model"),e=document.querySelector(".aipkit_task_cw_reasoning_effort_field"),t=e?e.closest(".aipkit_ai_settings_redesigned"):null;if(!c||!n||!e){e&&(e.style.display="none");return}let d=(c.value||"").toLowerCase(),p=(n.value||"").toLowerCase();d==="openai"&&r(p)?(e.style.display="block",t&&o(t,p)):e.style.display="none"}function o(c,n){let e=c.querySelector("[data-aipkit-reasoning-select]"),t=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!e||!t.length)return;let d=a(n),_=new Set(d.allowed);t.forEach(m=>{let u=m.querySelector(".aipkit_ai_reasoning_input");if(!u)return;let w=u.value==="minimal"?"low":u.value,h=_.has(w);m.style.display=h?"":"none",h||(u.checked=!1)});let p=e.value||"";p==="minimal"&&(p="low"),_.has(p)||(p=d.defaultValue),_.has(p)||(p=d.allowed[0]||"");let f=e.value;p&&(e.value=p);let g=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(g){g.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>u.classList.remove("aipkit_ai_reasoning_option--selected"));let m=g.closest(".aipkit_ai_reasoning_option");m&&m.classList.add("aipkit_ai_reasoning_option--selected")}f!==e.value&&e.dispatchEvent(new Event("change",{bubbles:!0}))}function r(c){if(i(c))return!1;let n=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),e=c.includes("gpt-5");return n||e}function i(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let n=c.match(/gpt-5\.(\d+)/);if(n)return Number.parseInt(n[1],10)>=2;let e=c.match(/gpt-(\d+)/);return e?Number.parseInt(e[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_autogpt_cw_toggleReasoningEffort=k})();(function(){"use strict";function k(){let c=document.querySelector("#aipkit_task_cc_ai_provider"),n=document.querySelector("#aipkit_task_cc_ai_model"),e=document.querySelector(".aipkit_task_cc_reasoning_effort_field"),t=e?e.closest(".aipkit_ai_settings_redesigned"):null;if(!c||!n||!e){e&&(e.style.display="none");return}let d=(c.value||"").toLowerCase(),p=(n.value||"").toLowerCase();d==="openai"&&r(p)?(e.style.display="block",t&&o(t,p)):e.style.display="none"}function o(c,n){let e=c.querySelector("[data-aipkit-reasoning-select]"),t=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!e||!t.length)return;let d=a(n),_=new Set(d.allowed);t.forEach(m=>{let u=m.querySelector(".aipkit_ai_reasoning_input");if(!u)return;let w=u.value==="minimal"?"low":u.value,h=_.has(w);m.style.display=h?"":"none",h||(u.checked=!1)});let p=e.value||"";p==="minimal"&&(p="low"),_.has(p)||(p=d.defaultValue),_.has(p)||(p=d.allowed[0]||"");let f=e.value;p&&(e.value=p);let g=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(g){g.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>u.classList.remove("aipkit_ai_reasoning_option--selected"));let m=g.closest(".aipkit_ai_reasoning_option");m&&m.classList.add("aipkit_ai_reasoning_option--selected")}f!==e.value&&e.dispatchEvent(new Event("change",{bubbles:!0}))}function r(c){if(i(c))return!1;let n=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),e=c.includes("gpt-5");return n||e}function i(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let n=c.match(/gpt-5\.(\d+)/);if(n)return Number.parseInt(n[1],10)>=2;let e=c.match(/gpt-(\d+)/);return e?Number.parseInt(e[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_autogpt_cc_toggleReasoningEffort=k})();(function(){"use strict";function k(o,r){let i=document.getElementById("aipkit_save_task_btn"),a=i?i.querySelector(".aipkit_btn-text"):null,s=o.elements.task_id,l=o.elements.task_name,c=o.elements.task_type,n=o.elements.task_status,e=document.getElementById("aipkit_cancel_edit_task_btn"),d=(window.aipkit_automated_tasks_config||{}).text||{},_=document.getElementById("aipkit_autogpt_header_title_default"),p=document.getElementById("aipkit_autogpt_header_title_editor"),f=document.getElementById("aipkit_autogpt_title_display"),g=document.getElementById("aipkit_autogpt_title_text"),m=document.getElementById("aipkit_autogpt_task_title_input"),u=g&&g.dataset.defaultLabel||m&&m.placeholder||"New Task",w=()=>{let v=(m?m.value.trim():"")||u;g&&(g.textContent=v),f&&f.setAttribute("title",v),l&&(l.value=v)},h=()=>{!f||!m||(f.style.display="none",m.style.display="inline-block",m.focus(),m.select())},C=()=>{!f||!m||(m.style.display="none",f.style.display="inline-flex",w())};_&&(_.style.display="none"),p&&(p.style.display="flex"),p&&p.dataset.inlineTitleBound!=="true"&&f&&m&&(f.addEventListener("click",h),m.addEventListener("blur",C),m.addEventListener("keydown",x=>{x.key==="Enter"&&(x.preventDefault(),m.blur())}),m.addEventListener("input",w),p.dataset.inlineTitleBound="true"),r?(a&&(a.textContent=d.save_task_button||"Save Task"),s&&(s.value=r.id||""),m&&(m.value=r.task_name||u),w(),c&&(c.value=r.task_type||"content_indexing"),n&&(n.value=r.status||"active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),e&&(e.style.display="inline-flex")):(a&&(a.textContent=d.save_task_button||"Save Task"),s&&(s.value=""),m&&(m.value=u),w(),c&&(c.value="content_indexing"),n&&(n.value="active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),e&&(e.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(r){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let a=i.elements["post_types[]"];a&&(Array.from(a.options).forEach(l=>l.selected=!1),(r.post_types||[]).forEach(l=>{let c=a.querySelector(`option[value="${k(l)}"]`);c&&(c.selected=!0)}));let s=i.elements.target_store_provider;s&&(s.value=r.target_store_provider||"openai",s.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(r.target_store_provider||"openai").then(()=>{let l=i.elements.target_store_id;l&&(l.value=r.target_store_id||"")}),i.elements.index_existing_now_flag&&(i.elements.index_existing_now_flag.checked=r.index_existing_now_flag==="1"),i.elements.only_new_updated_flag&&(i.elements.only_new_updated_flag.checked=r.only_new_updated_flag==="1"),(r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&r.embedding_provider&&r.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${r.embedding_provider}:${r.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),i.elements.task_frequency&&(i.elements.task_frequency.value=r.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(r){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let a=r.cw_generation_mode||"bulk";if(a==="bulk"||a==="single"||a==="task"){let x=i.elements.content_title_bulk;x&&(x.value=r.content_title||"")}else if(a==="csv"){let x=i.elements.content_title;x&&(x.value=r.content_title||"")}else if(a==="rss"){i.elements.rss_feeds&&(i.elements.rss_feeds.value=r.rss_feeds||""),i.elements.rss_include_keywords&&(i.elements.rss_include_keywords.value=r.rss_include_keywords||""),i.elements.rss_exclude_keywords&&(i.elements.rss_exclude_keywords.value=r.rss_exclude_keywords||"");let x=i.elements.rss_feeds;x&&(typeof window.aipkit_initTaskRssInputHandler=="function"&&window.aipkit_initTaskRssInputHandler(),x.dispatchEvent(new Event("input",{bubbles:!0})))}else if(a==="url")i.elements.url_list&&(i.elements.url_list.value=r.url_list||"");else if(a==="gsheets"){let x=i.elements.gsheets_credentials;if(x){let v=r.gsheets_credentials,L=x.closest(".aipkit_gsheets_section_container");typeof v=="object"&&v!==null?x.value=JSON.stringify(v,null,2):x.value=v||"",x.value?(x.dataset.filename="credentials.json",L&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(L),100)):(delete x.dataset.filename,L&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(L,"clear"))}i.elements.gsheets_sheet_id&&(i.elements.gsheets_sheet_id.value=r.gsheets_sheet_id||"")}i.elements.custom_title_prompt&&(i.elements.custom_title_prompt.value=r.custom_title_prompt||""),i.elements.custom_content_prompt&&(i.elements.custom_content_prompt.value=r.custom_content_prompt||"");let s=document.getElementById("aipkit_task_cw_ai_provider"),l=document.getElementById("aipkit_task_cw_ai_model");s&&(s.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",r.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&l&&window.aipkit_task_cw_populateModels(s,l));let c=document.getElementById("aipkit_task_cw_ai_temperature");if(c){c.value=r.ai_temperature||"1.0";let x=document.getElementById("aipkit_task_cw_ai_temperature_value");x&&(x.textContent=c.value)}let n=document.getElementById("aipkit_task_cw_content_length");n&&(n.value=r.content_length||"medium",n.dispatchEvent(new Event("change",{bubbles:!0})));let e=i.elements.reasoning_effort;if(e){let x=r.reasoning_effort||"";x&&(e.value=x==="minimal"?"low":x,e.dispatchEvent(new Event("change",{bubbles:!0})))}l&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>l.dispatchEvent(new Event("change",{bubbles:!0})),100),i.elements.generate_meta_description&&(i.elements.generate_meta_description.checked=r.generate_meta_description==="1"),i.elements.custom_meta_prompt&&(i.elements.custom_meta_prompt.value=r.custom_meta_prompt||""),i.elements.generate_focus_keyword&&(i.elements.generate_focus_keyword.checked=r.generate_focus_keyword==="1"),i.elements.custom_keyword_prompt&&(i.elements.custom_keyword_prompt.value=r.custom_keyword_prompt||""),i.elements.generate_excerpt&&(i.elements.generate_excerpt.checked=r.generate_excerpt==="1"),i.elements.custom_excerpt_prompt&&(i.elements.custom_excerpt_prompt.value=r.custom_excerpt_prompt||""),i.elements.generate_tags&&(i.elements.generate_tags.checked=r.generate_tags==="1"),i.elements.custom_tags_prompt&&(i.elements.custom_tags_prompt.value=r.custom_tags_prompt||""),i.elements.generate_toc&&(i.elements.generate_toc.checked=r.generate_toc==="1"),i.elements.generate_seo_slug&&(i.elements.generate_seo_slug.checked=r.generate_seo_slug==="1"),i.elements.post_type&&(i.elements.post_type.value=r.post_type||"post");let t=i.elements.post_author;t&&(t.value=r.post_author||window.aipkit_dashboard?.currentUserId||"1");let d=document.getElementById("aipkit_task_cw_post_status");d&&(d.value=r.post_status||"draft");let _=r.schedule_mode||"immediate",p=i.querySelector(`input[name="schedule_mode"][value="${_}"]`);p&&(p.checked=!0),i.elements.smart_schedule_start_datetime&&(i.elements.smart_schedule_start_datetime.value=r.smart_schedule_start_datetime||""),i.elements.smart_schedule_interval_value&&(i.elements.smart_schedule_interval_value.value=r.smart_schedule_interval_value||"1"),i.elements.smart_schedule_interval_unit&&(i.elements.smart_schedule_interval_unit.value=r.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:d});let f=document.getElementById("aipkit_task_cw_post_categories");f&&f.options&&(Array.from(f.options).forEach(v=>v.selected=!1),(Array.isArray(r.post_categories)?r.post_categories.map(String):[]).forEach(v=>{let L=f.querySelector(`option[value="${k(v)}"]`);L&&(L.selected=!0)}),f.dispatchEvent(new Event("change",{bubbles:!0}))),i.elements.generate_images_enabled&&(i.elements.generate_images_enabled.checked=r.generate_images_enabled==="1"),i.elements.image_provider&&(i.elements.image_provider.value=(r.image_provider||"openai").toLowerCase()),i.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=r.image_model),i.elements.image_prompt&&(i.elements.image_prompt.value=r.image_prompt||""),i.elements.image_count&&(i.elements.image_count.value=r.image_count||"1"),i.elements.image_placement&&(i.elements.image_placement.value=r.image_placement||"after_first_h2"),i.elements.image_placement_param_x&&(i.elements.image_placement_param_x.value=r.image_placement_param_x||"2"),i.elements.image_size&&(i.elements.image_size.value=r.image_size||"large"),i.elements.image_alignment&&(i.elements.image_alignment.value=r.image_alignment||"none"),i.elements.generate_featured_image&&(i.elements.generate_featured_image.checked=r.generate_featured_image==="1"),i.elements.featured_image_prompt&&(i.elements.featured_image_prompt.value=r.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let g=i.querySelector('input[name="enable_vector_store"]');g&&(g.checked=r.enable_vector_store==="1",g.dispatchEvent(new Event("change",{bubbles:!0})));let m=i.querySelector("#aipkit_task_cw_vector_store_provider");m&&(m.value=r.vector_store_provider||"openai",m.dispatchEvent(new Event("change",{bubbles:!0})));let u=i.querySelector("#aipkit_task_cw_vector_store_top_k");if(u){u.value=r.vector_store_top_k||"3";let x=i.querySelector("#aipkit_task_cw_vector_store_top_k_value");x&&(x.textContent=u.value)}let w=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(w&&w.options){let x=Array.isArray(r.openai_vector_store_ids)?r.openai_vector_store_ids.map(String):[];Array.from(w.options).forEach(v=>{v.selected=x.includes(v.value)}),w.dispatchEvent(new Event("change",{bubbles:!0}))}let h=document.getElementById("aipkit_task_cw_pinecone_index_name");h&&(h.value=r.pinecone_index_name||"");let C=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(C&&(C.value=r.qdrant_collection_name||""),r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant"){let x=document.getElementById("aipkit_task_cw_vector_embedding_provider");x&&(x.value=r.vector_embedding_provider||"openai",x.dispatchEvent(new Event("change",{bubbles:!0})))}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),r.vector_store_provider&&(r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant")&&r.vector_embedding_model&&setTimeout(()=>{window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=r.vector_embedding_model);let x=i.querySelector("#aipkit_autogpt_cw_vector_settings_popover")||i;x&&typeof window.aipkit_cw_task_populateEmbeddingModelSelect=="function"&&window.aipkit_cw_task_populateEmbeddingModelSelect(x)},150),i.elements.task_frequency&&(i.elements.task_frequency.value=r.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=o})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_task_form");if(!r)return;let i=document.getElementById("aipkit_task_cc_ai_provider"),a=document.getElementById("aipkit_task_cc_ai_model");i&&a&&(i.value=o.ai_provider?o.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&o.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=o.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(i,a));let s=document.getElementById("aipkit_task_cc_ai_temperature");if(s){s.value=o.ai_temperature||1;let f=document.getElementById(s.id+"_value");f&&(f.textContent=s.value)}let l=document.getElementById("aipkit_task_cc_content_max_tokens");if(l){l.value=o.content_max_tokens||4e3;let f=document.getElementById(l.id+"_value");f&&(f.textContent=l.value),l.dispatchEvent(new Event("change",{bubbles:!0}))}let c=r.elements.cc_reasoning_effort;if(c){let f=o.reasoning_effort||"";f&&(c.value=f==="minimal"?"low":f,c.dispatchEvent(new Event("change",{bubbles:!0})))}a&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>a.dispatchEvent(new Event("change",{bubbles:!0})),100);let n=document.getElementById("aipkit_task_cc_custom_content_prompt");n&&(n.value=o.custom_content_prompt||"");let e=document.getElementById("aipkit_task_comment_reply_include_keywords");e&&(e.value=o.include_keywords||"");let t=document.getElementById("aipkit_task_comment_reply_exclude_keywords");t&&(t.value=o.exclude_keywords||"");let d=r.elements["post_types_for_comments[]"];d&&(Array.from(d.options).forEach(f=>f.selected=!1),(o.post_types_for_comments||[]).forEach(f=>{let g=d.querySelector(`option[value="${f}"]`);g&&(g.selected=!0)}));let _=r.elements.reply_action;_&&(_.value=o.reply_action||"approve");let p=r.elements.no_reply_to_replies;p&&(p.checked=o.no_reply_to_replies==="1"),r.elements.task_frequency&&(r.elements.task_frequency.value=o.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_automated_tasks_config||{},i=window.aipkit_dashboard||{},a=r.default_cw_prompts||{};if(!o)return;o.elements.custom_title_prompt&&(o.elements.custom_title_prompt.value=a.title||""),o.elements.custom_content_prompt&&(o.elements.custom_content_prompt.value=a.content||""),o.elements.custom_meta_prompt&&(o.elements.custom_meta_prompt.value=a.meta||""),o.elements.custom_keyword_prompt&&(o.elements.custom_keyword_prompt.value=a.keyword||""),o.elements.image_prompt&&(o.elements.image_prompt.value=a.image||""),o.elements.featured_image_prompt&&(o.elements.featured_image_prompt.value=a.featured_image||"");let s=document.getElementById("aipkit_task_cw_ai_provider"),l=document.getElementById("aipkit_task_cw_ai_model");if(s&&l){let n=(i.main_provider||"openai").toLowerCase();if(s.value=n,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(s,l);let e="",t=i?.models?.[n];switch(n){case"openai":e="gpt-4.1-mini";break;case"google":e="gemini-1.5-flash-latest";break;case"openrouter":e="moonshotai/kimi-k2.5";break;case"claude":e="claude-opus-4-6",Array.isArray(t)&&t.length>0&&(t.some(_=>_&&_.id==="claude-opus-4-6")||(e=t[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(t)&&t.length>0&&(e=t[0].id||"");break}l.querySelector(`option[value="${CSS.escape(e)}"]`)?l.value=e:console.warn(`Default model ${e} not found for provider ${n}.`)}}let c=document.getElementById("aipkit_task_cw_content_length");c&&(c.value="medium",c.dispatchEvent(new Event("change",{bubbles:!0}))),o.elements.generate_images_enabled&&(o.elements.generate_images_enabled.checked=!1),o.elements.image_provider&&(o.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{o.elements.image_model&&(o.elements.image_model.value="gpt-image-1")},0)),o.elements.image_count&&(o.elements.image_count.value="1"),o.elements.image_placement&&(o.elements.image_placement.value="after_first_h2"),o.elements.generate_featured_image&&(o.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_dashboard||{};if(!o)return;let i=document.getElementById("aipkit_task_cc_custom_content_prompt");i&&(i.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let a=document.getElementById("aipkit_task_cc_ai_provider"),s=document.getElementById("aipkit_task_cc_ai_model");if(a&&s){let c=(r.main_provider||"openai").toLowerCase();if(a.value=c,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(a,s);let n="",e=(r.models||{})[c]||{};switch(c){case"openai":n="gpt-4o-mini";break;case"google":n="gemini-1.5-flash-latest";break;case"openrouter":n="moonshotai/kimi-k2.5";break;case"claude":n="claude-opus-4-6",Array.isArray(e)&&e.length>0&&(e.some(d=>d&&d.id==="claude-opus-4-6")||(n=e[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(e)&&e.length>0&&(n=e[0].id||"");break}s.querySelector(`option[value="${CSS.escape(n)}"]`)&&(s.value=n)}}let l=document.getElementById("aipkit_task_cc_content_max_tokens");l&&(l.value="4000",l.dispatchEvent(new Event("change",{bubbles:!0})))}window.aipkit_form_setCommentReplyDefaults=k})();(function(){"use strict";function k(o,r,i,a=null){let s=document.getElementById("aipkit_automated_task_form"),l=document.getElementById("aipkit_automated_task_queue_wrapper");if(!s){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),s.reset(),s.elements.task_id&&(s.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),a){let d=((window.aipkit_automated_tasks_config||{}).task_types||{})[a.task_type];if(d){let _=s.elements.task_category;if(_){_.value=d.category;let p=new Event("change",{bubbles:!0});_.dispatchEvent(p)}}}else{let t=s.elements.task_category,d=s.elements.task_type;t&&d&&(t.value="content_creation",t.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{d.value="content_writing_bulk",d.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(s,a):console.error("Show Task Form: aipkit_form_populateCommonFields function is missing.");let c=s.elements.task_type;if(c&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:c}),a){let t=JSON.parse(a.task_config||"{}");a.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(t):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):a.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(t):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):a.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(t):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):a.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(t):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}o&&(o.style.display="block"),r&&(r.style.display="none"),l&&(l.style.display="none"),i&&(i.style.display="none");let n=document.getElementById("aipkit_autogpt_editor_actions");n&&(n.style.display="flex");let e=document.getElementById("aipkit_autogpt_cron_info");e&&(e.style.display="none"),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers()}window.aipkit_form_showAutomatedTaskForm=k})();(function(){"use strict";function k(o,r,i){let a=document.getElementById("aipkit_automated_task_queue_wrapper");o&&(o.style.display="none"),r&&(r.style.display="block"),a&&(a.style.display="block"),i&&(i.style.display="inline-flex");let s=document.getElementById("aipkit_autogpt_editor_actions");s&&(s.style.display="none");let l=document.getElementById("aipkit_autogpt_cron_info");l&&(l.style.display="inline-flex");let c=document.getElementById("aipkit_automated_task_form"),n=document.getElementById("aipkit_automated_task_id"),e=document.getElementById("aipkit_automated_task_category"),t=document.getElementById("aipkit_autogpt_header_title_default"),d=document.getElementById("aipkit_autogpt_header_title_editor"),_=document.getElementById("aipkit_autogpt_title_display"),p=document.getElementById("aipkit_autogpt_task_title_input");c&&c.reset(),n&&(n.value=""),t&&(t.style.display="block"),d&&(d.style.display="none"),_&&(_.style.display="inline-flex"),p&&(p.style.display="none"),e&&(e.value="",e.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=k})();(function(){"use strict";let k=()=>{typeof window.aipkit_updateAutogptPromptPlaceholders=="function"&&window.aipkit_updateAutogptPromptPlaceholders()};function o(s,l,c,n){if(!s||!l)return;s.innerHTML="";let e={content_writing_bulk:{icon:"dashicons-edit"},content_writing_csv:{icon:"dashicons-media-spreadsheet"},content_writing_rss:{icon:"dashicons-rss"},content_writing_url:{icon:"dashicons-admin-links"},content_writing_gsheets:{icon:"dashicons-analytics"}};c.forEach(([t,d])=>{let _=document.createElement("label");_.className="aipkit_cw_mode_card aipkit_autogpt_task_type_card",_.classList.toggle("is-active",t===n);let p=document.createElement("input");p.type="radio",p.name="aipkit_task_type_radio",p.value=t,p.checked=t===n,p.disabled=!!d.disabled,p.className="aipkit_task_type_input",p.addEventListener("change",()=>{p.checked&&(l.value=t,l.dispatchEvent(new Event("change",{bubbles:!0})),s.querySelectorAll(".aipkit_cw_mode_card").forEach(w=>w.classList.remove("is-active")),_.classList.add("is-active"))});let f=e[t]||{},g=document.createElement("span");g.className="aipkit_cw_mode_icon",g.innerHTML=`<span class="dashicons ${f.icon||"dashicons-admin-generic"}"></span>`;let m=document.createElement("span");m.className="aipkit_cw_mode_text";let u=document.createElement("span");u.className="aipkit_cw_mode_title",u.textContent=d.label,m.appendChild(u),d.disabled&&(_.classList.add("is-disabled"),_.setAttribute("aria-disabled","true")),_.appendChild(p),_.appendChild(g),_.appendChild(m),s.appendChild(_)})}function r(s,l){s&&s.querySelectorAll('input[name="aipkit_task_type_radio"]').forEach(c=>{let n=c.value===l;c.checked=n;let e=c.closest(".aipkit_cw_mode_card");e&&e.classList.toggle("is-active",n)})}function i(s){let l=s.target.value,c=document.querySelector(".aipkit_autogpt_form_right"),n=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;if(c){let h=!n&&l==="content_enhancement";c.style.display=h?"none":""}let e=document.getElementById("aipkit_automated_task_type"),t=document.getElementById("aipkit_automated_task_type_group"),d=document.getElementById("aipkit_automated_task_type_radios"),_=(window.aipkit_automated_tasks_config||{}).task_types||{},p=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),f=p.lastTaskTypeByCategory||{};p.lastTaskTypeByCategory=f;let g=window.aipkit_escapeHtml||function(h){return h};e.innerHTML="",e.disabled=!0,t&&(t.style.display="none"),d&&(d.innerHTML="");let m=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(m&&m.querySelectorAll(".aipkit_task_config_section").forEach(h=>{h.id==="aipkit_task_cw_input_modes_wrapper"&&h.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(C=>{C.style.display="none"}),h.style.display="none"}),!l){e.appendChild(new Option(g("-- Select a category first --"),"")),e.dispatchEvent(new Event("change",{bubbles:!0}));return}let u=Object.entries(_).filter(([h,C])=>C.category===l);if(u.length===0)e.appendChild(new Option(g("-- No tasks in this category --"),""));else if(u.length===1){let[h,C]=u[0],x=new Option(g(C.label),h);C.disabled&&(x.disabled=!0),e.appendChild(x),e.value=h,e.disabled=!0,t&&(t.style.display="none")}else e.appendChild(new Option(g("-- Select a Task Type --"),"")),u.forEach(([h,C])=>{let x=new Option(g(C.label),h);C.disabled&&(x.disabled=!0),e.appendChild(x)}),e.disabled=!1;if(u.length>1){let h=f[l];!h&&l==="content_creation"&&(h="content_writing_bulk"),!h&&u.length>0&&e.options.length&&(h=u[0][0]),h&&(e.value=h)}let w=!!d&&u.length>1&&l==="content_creation";t&&(t.style.display=w?"":"none"),d&&(w?o(d,e,u,e.value):d.innerHTML=""),e.dispatchEvent(new Event("change",{bubbles:!0}))}function a(s){let l=s.target.value,c=document.getElementById("aipkit_automated_task_type_radios");r(c,l);let n=document.getElementById("aipkit_automated_task_id"),e=!n||!n.value,t=document.getElementById("aipkit_wizard_next_btn"),d=t?t.querySelector(".aipkit_btn-text"):null,_=document.getElementById("aipkit_save_task_btn"),p=_?_.querySelector(".aipkit_btn-text"):null,f=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,m=((window.aipkit_automated_tasks_config||{}).task_types||{})[l],u=m&&m.pro===!0,w=(window.aipkit_automated_tasks_config||{}).text||{};if(m){let S=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),E=S.lastTaskTypeByCategory||{};E[m.category]=l,S.lastTaskTypeByCategory=E}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(l):console.error("Task Type Change: aipkit_renderWizard function is missing.");let h=document.querySelector(".aipkit_task_schedule_frequency"),C=document.getElementById("aipkit_automated_task_frequency");if(h&&C){let S=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={});l==="content_writing_bulk"||l==="content_writing_csv"?(!S.lastVisibleFrequency&&C.value&&(S.lastVisibleFrequency=C.value),C.value="one-time",h.style.display="none"):(h.style.display="",S.lastVisibleFrequency&&C.value==="one-time"&&(C.value=S.lastVisibleFrequency),S.lastVisibleFrequency=C.value)}let x=document.querySelectorAll("[data-aipkit-task-publishing]");if(x.length){let S=l&&l.startsWith("content_writing");x.forEach(E=>{E.style.display=S?"":"none"})}u&&!f?(d&&t&&(t.dataset.action="next",d.textContent=w.wizard_next_button||"Next",t.style.display="none"),p&&_&&(_.dataset.action="save",p.textContent=w.save_task_button||"Save Task",_.style.display="none")):(d&&t&&(t.dataset.action="next",d.textContent=w.wizard_next_button||"Next",t.style.display=""),p&&_&&(_.dataset.action="save",p.textContent=w.save_task_button||"Save Task",_.style.display=""));let v=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!v){console.error("Task Type Change: Could not find setup pane.");return}let L=v.querySelector("#aipkit_task_ci_source_wrapper"),P=v.querySelector("#aipkit_task_cw_input_modes_wrapper"),b=v.querySelector("#aipkit_task_cc_source_wrapper"),y=v.querySelector("#aipkit_task_ce_content_selection_wrapper");if(L&&(L.style.display="none"),P&&(P.style.display="none"),b&&(b.style.display="none"),y&&(y.style.display="none"),!!l){if(l==="content_indexing")L&&(L.style.display="block");else if(l.startsWith("content_writing")){if(k(),P){P.style.display="block";let S=l.replace("content_writing_",""),E=S==="content_writing"?"bulk":S,A=document.getElementById("aipkit_task_cw_generation_mode");A&&(A.value=E),P.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(M=>{M.id===`aipkit_task_cw_input_mode_${E}`?M.style.display="block":M.style.display="none"})}}else if(l==="community_reply_comments")b&&(b.style.display="block");else if(l==="enhance_existing_content"){y&&(y.style.display="block");let S=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),E=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(S&&E){let A=S.querySelector("#aipkit_task_ce_post_types");if(A&&!A.dataset.placeholderListenerAttached){let M=()=>{let W=Array.from(A.selectedOptions).map(N=>N.value).includes("product");E.querySelectorAll(".aipkit-product-placeholders").forEach(N=>{N.style.display=W?"inline":"none"})};A.addEventListener("change",M),A.dataset.placeholderListenerAttached="true",M()}}}e&&(l.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():l==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():l==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),l==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():l.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():l==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():l==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=i,window.aipkit_form_handleTaskTypeChange=a})();(function(){"use strict";function k(o,r="info"){let i=document.getElementById("aipkit_automated_task_form_status");if(!i)return;let a=i.classList.contains("aipkit_training_status");if(!o){i.textContent="",a?i.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):i.className="aipkit_form-help";return}if(i.textContent=o,a){let s=r==="info"?"loading":r;i.classList.remove("is-success","is-error","is-warning","is-loading"),i.classList.add("is-visible"),s&&i.classList.add(`is-${s}`)}else i.className=`aipkit_form-help aipkit_settings_message-${r}`;setTimeout(()=>{i.textContent===o&&(i.textContent="",a?i.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):i.className="aipkit_form-help")},5e3)}window.aipkit_form_showAutomatedTaskFormStatus=k})();(function(){"use strict";function k(o){let r=new FormData(o),i=Object.fromEntries(r.entries());return i.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:r,data:i}}window.aipkit_save_task_extractBaseData=k})();(function(){"use strict";function k(o,r){if(o.task_type==="content_indexing"){if(o.post_types=r.getAll("post_types[]"),o.target_store_provider=r.get("target_store_provider")||"openai",o.target_store_id=r.get("target_store_id")||"",o.target_store_provider==="pinecone"||o.target_store_provider==="qdrant"){let a=r.get("embedding_model")||"";if(a&&a.includes(":")){let[s,l]=a.split(":",2);o.embedding_provider=s,o.embedding_model=l}else o.embedding_provider="",o.embedding_model=a}else delete o.embedding_provider,delete o.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(a=>delete o[a])}else delete o.post_types,delete o["post_types[]"],delete o.target_store_provider,delete o.target_store_id,delete o.index_existing_now_flag,delete o.only_new_updated_flag,delete o.embedding_model,delete o.embedding_provider;return o}window.aipkit_save_task_handleContentIndexing=k})();(function(){"use strict";function k(o,r){return o.task_type.startsWith("content_writing")?(o.post_categories=r.getAll("post_categories[]"),o.openai_vector_store_ids=r.getAll("openai_vector_store_ids[]"),delete o["post_categories[]"],delete o["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(a=>delete o[a]),delete o.replicate_api_key,delete o.pexels_api_key,delete o.pixabay_api_key):(delete o.content_title,delete o.content_title_bulk,delete o.content_keywords,delete o.content_length,delete o.ai_temperature,delete o.post_type,delete o.post_author,delete o.post_status,delete o["post_categories[]"],delete o.post_categories,delete o.prompt_mode,delete o.custom_title_prompt,delete o.custom_content_prompt,delete o.generate_meta_description,delete o.custom_meta_prompt,delete o.generate_focus_keyword,delete o.custom_keyword_prompt,delete o.cw_generation_mode,delete o.rss_feeds,delete o.gsheets_sheet_id,delete o.gsheets_credentials,delete o.url_list,delete o.generate_toc,delete o.generate_images_enabled,delete o.image_provider,delete o.image_model,delete o.image_prompt,delete o.image_count,delete o.image_placement,delete o.image_placement_param_x,delete o.image_alignment,delete o.image_size,delete o.generate_featured_image,delete o.featured_image_prompt,delete o.pexels_orientation,delete o.pexels_size,delete o.pexels_color,delete o.pexels_api_key,delete o.pixabay_orientation,delete o.pixabay_image_type,delete o.pixabay_category,delete o.pixabay_api_key,delete o.replicate_api_key,delete o.enable_vector_store,delete o.vector_store_provider,delete o["openai_vector_store_ids[]"],delete o.openai_vector_store_ids,delete o.pinecone_index_name,delete o.qdrant_collection_name,delete o.vector_embedding_provider,delete o.vector_embedding_model,delete o.vector_store_top_k,delete o.rss_include_keywords,delete o.rss_exclude_keywords),o}window.aipkit_save_task_handleContentWriting=k})();(function(){"use strict";function k(o){let i=(window.aipkit_automated_tasks_config||{}).text||{};if(!o.task_name)return i.task_name_required||"Task name is required.";if(!o.task_category)return i.task_category_required||"Task category is required.";if(!o.task_type)return i.task_type_required||"Task type is required.";if(o.task_type==="content_indexing"){if(!o.target_store_id)return i.target_store_required||"A target vector store/index must be selected.";if(!o.post_types||o.post_types.length===0)return i.content_type_required||"Please select content types for indexing.";if(o.target_store_provider==="pinecone"||o.target_store_provider==="qdrant"){if(!o.embedding_provider)return i.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!o.embedding_model)return i.embedding_model_required||"Embedding model is required for this vector provider."}}if(o.task_type.startsWith("content_writing")){let a=o.cw_generation_mode||"bulk";if(a==="bulk"){if(!o.content_title_bulk?.trim())return i.content_title_required_cw_task||"At least one topic is required for Bulk mode."}else if(a==="csv"){if(!o.content_title?.trim())return i.csv_required_cw_task||"Please upload a CSV file."}else{if(a==="rss"&&!o.rss_feeds?.trim())return i.rss_required_cw_task||"Please add at least one RSS feed.";if(a==="url"&&!o.url_list?.trim())return i.url_required_cw_task||"Please add at least one URL.";if(a==="gsheets"){if(!o.gsheets_sheet_id?.trim())return i.gsheets_id_required_cw_task||"Please add a Google Sheet ID.";if(!o.gsheets_credentials?.trim())return i.gsheets_credentials_required_cw_task||"Please add Google Sheets credentials."}else if(a==="single"&&!o.content_title?.trim())return i.content_title_required_cw_task||"Please add a topic."}if(!o.custom_content_prompt?.trim())return"The Content Prompt cannot be empty.";if(!o.ai_provider||!o.ai_model)return i.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}if(o.task_type==="enhance_existing_content"){if(!o.post_types||o.post_types.length===0)return"Please select at least one post type to update.";if(o.update_title!=="1"&&o.update_excerpt!=="1"&&o.update_content!=="1"&&o.update_meta!=="1")return"Please select at least one field to update (Title, Excerpt, Content, or Meta Description)."}return!0}window.aipkit_save_task_validateData=k})();(function(){"use strict";async function k(o){let r=window.aipkit_automated_tasks_config||{},i={...o,_ajax_nonce:r.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",i)}window.aipkit_save_task_submitRequest=k})();(function(){"use strict";function k(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=k})();(function(){"use strict";async function k(o){if(o.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let r=o.target,i=document.getElementById("aipkit_save_task_btn");if(i&&i.dataset.action==="upgrade"){let l=window.aipkit_dashboard?.upgradeUrl;l?window.open(l,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let a=(window.aipkit_automated_tasks_config||{}).text||{},s=a.save_task_button||"Save Task";try{let{formData:l,data:c}=window.aipkit_save_task_extractBaseData(r),n;c.task_type==="content_indexing"?n=window.aipkit_save_task_handleContentIndexing(c,l):c.task_type.startsWith("content_writing")?n=window.aipkit_save_task_handleContentWriting(c,l):c.task_type==="enhance_existing_content"?n=window.aipkit_save_task_handleContentEnhancement(c,l):n=c;let e=window.aipkit_save_task_validateData(n);if(e!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(e,"error"),new Error("Validation failed: "+e);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,s,a.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(a.saving_task||"Saving task...","info");let t=await window.aipkit_save_task_submitRequest(n);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(t.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(l){console.error("Save Task Error:",l),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&l.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${l.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,s)}}window.aipkit_form_handleSaveTask=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_form"),r=document.getElementById("aipkit_autogpt_task_status_toggle"),i=document.getElementById("aipkit_autogpt_task_status_input"),a=document.getElementById("aipkit_autogpt_task_status_label"),s=document.getElementById("aipkit_autogpt_task_status_card"),l=document.getElementById("aipkit_automated_task_category"),c=document.querySelector("[data-aipkit-autogpt-category-selector]"),n=c?Array.from(c.querySelectorAll(".aipkit_cw_mode_card")):[],e=document.getElementById("aipkit_automated_task_type"),t=document.getElementById("aipkit_cancel_edit_task_btn"),d=document.getElementById("aipkit_automated_task_form_wrapper"),_=document.getElementById("aipkit_automated_task_list_wrapper"),p=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),o&&typeof window.aipkit_form_handleSaveTask=="function"?o.addEventListener("submit",window.aipkit_form_handleSaveTask):o&&console.error("Automated Task Form Init: handleSaveTask function not found."),l&&typeof window.aipkit_form_handleCategoryChange=="function"?l.addEventListener("change",window.aipkit_form_handleCategoryChange):l&&console.error("Automated Task Form Init: handleCategoryChange function not found.");let f=m=>{n.length&&n.forEach(u=>{let w=u.dataset.category===m;u.classList.toggle("is-active",w),u.setAttribute("aria-pressed",w?"true":"false")})};l&&n.length&&(n.forEach(m=>{m.addEventListener("click",()=>{let u=m.dataset.category||"";!u||u===l.value||(l.value=u,l.dispatchEvent(new Event("change",{bubbles:!0})))})}),l.addEventListener("change",()=>{f(l.value)}),f(l.value||"")),e&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(e.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:e})):e&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),t&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?t.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(d,_,p)}):t&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI();let g=()=>{if(!r||!i||!a)return;let m=(i.value||"active")==="active";r.checked=m,a.textContent=m?"Active":"Paused",s&&(s.dataset.status=m?"active":"paused")};window.aipkit_syncTaskStatusToggle=g,r&&i&&a&&(r.dataset.statusListenerAttached||(r.addEventListener("change",()=>{i.value=r.checked?"active":"paused",g()}),r.dataset.statusListenerAttached="true"),g())}window.aipkit_form_initAutomatedTaskForm=k})();(function(){"use strict";let k=!1,o=null,r=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return k},set isSubmitting(a){k=a},get pendingModelSelection(){return o},set pendingModelSelection(a){o=a},get pendingEmbeddingModelSelection(){return r},set pendingEmbeddingModelSelection(a){r=a}};function i(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=i})();(function(){"use strict";function k(o,r){o&&(o.classList.toggle("aipkit_loading",!!r),o.disabled=!!r)}window.aipkit_setAutogptActionButtonLoading=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_config||{},a=i.text||{},s=window.aipkit_escapeHtml||function(t){return t},l=window.aipkit_ucfirst||function(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""},c=i.frequencies||{},n=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(t=>{t.removeAttribute("data-sort-direction"),n&&t.dataset.sortBy===n.sortBy&&t.setAttribute("data-sort-direction",n.sortOrder.toLowerCase())}),!r){console.warn("Render Tasks Table: Table body not found.");return}if(r.innerHTML="",!o||o.length===0){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${a.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}o.forEach(t=>{let d=JSON.parse(t.task_config||"{}"),_=r.insertRow(),p=_.insertCell();p.textContent=s(t.task_name);let f=_.insertCell(),m=(i.task_types?.[t.task_type]||{}).label||l(t.task_type.replace(/_/g," "));f.innerHTML=`<span class="aipkit_task_type_badge" data-type="${s(t.task_type)}">${s(m)}</span>`;let u=d.indexing_frequency||d.task_frequency||"N/A",w=c[u]||l(u.replace(/_/g," "));_.insertCell().textContent=s(w);let h=_.insertCell();h.innerHTML=`<span class="aipkit_job_status_${s(t.status)}">${s(l(t.status))}</span>`;let C=_.insertCell(),x=t.last_run_time?new Date(t.last_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):a.never_run||"Never",v=t.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(t.next_run_time):t.next_run_time?new Date(t.next_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):a.not_scheduled||"Not Scheduled";C.innerHTML=`
        <div class="aipkit_task_timing">
          <div class="aipkit_task_timing_last">
            <span class="aipkit_task_timing_label">${a.last_label||"Last"}</span>
            <span class="aipkit_task_timing_value${t.last_run_time?"":" aipkit_never"}">${s(x)}</span>
          </div>
          <div class="aipkit_task_timing_next">
            <span class="aipkit_task_timing_label">${a.next_label||"Next"}</span>
            <span class="aipkit_task_timing_value">${s(v)}</span>
          </div>
        </div>
      `;let L=_.insertCell();L.className="aipkit_actions_cell",L.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="edit" data-task-id="${t.id}" title="${a.edit_button||"Edit"}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${a.edit_button||"Edit"}</span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="${t.status==="active"?"pause":"resume"}" data-task-id="${t.id}" title="${t.status==="active"?a.pause_button||"Pause":a.resume_button||"Resume"}">
            <span class="dashicons ${t.status==="active"?"dashicons-controls-pause":"dashicons-controls-play"}" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${t.status==="active"?a.pause_button||"Pause":a.resume_button||"Resume"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="run_now" data-task-id="${t.id}" ${t.status!=="active"?"disabled":""} title="${t.status!=="active"?a.task_not_active_run_title||"Task must be active to run":a.run_now_button||"Run Now"}">
            <span class="dashicons dashicons-controls-skipforward" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${a.run_now_button||"Run"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete" data-task-id="${t.id}" title="${a.delete_button||"Delete"}">
            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
          </button>
        </div>
      `})}window.aipkit_list_renderTasksTable=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_task_list_pagination"),a=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render List Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:s,total_pages:l,current_page:c}=o||{};if(!l||l<=1){s>0&&(r.innerHTML=`<span class="aipkit_pagination-count">${Number(s).toLocaleString()} ${Number(s)===1?a.task_singular||"task":a.task_plural||"tasks"}</span>`);return}let n=document.createElement("span");n.className="aipkit_pagination-count",n.textContent=`${Number(s).toLocaleString()} ${Number(s)===1?a.task_singular||"task":a.task_plural||"tasks"}`,r.appendChild(n);let e=document.createElement("span");e.className="aipkit_pagination-links";let t=document.createElement("button");t.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",t.innerHTML=`\xAB ${a.previous_button||"Previous"}`,t.disabled=Number(c)<=1,t.disabled||(t.dataset.page=Number(c)-1),e.appendChild(t);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`${a.page_label||"Page"} ${Number(c)} ${a.of_label||"of"} ${Number(l)}`,e.appendChild(d);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=`${a.next_button||"Next"} \xBB`,_.disabled=Number(c)>=Number(l),_.disabled||(_.dataset.page=Number(c)+1),e.appendChild(_),r.appendChild(e)}window.aipkit_list_renderListPagination=k})();(function(){"use strict";async function k(o=1){let r=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_list_state,a=window.aipkit_automated_tasks_config||{},s=a.text||{};if(!r){console.warn("Fetch Tasks: Table body not found.");return}r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${s.loading_tasks||"Loading tasks..."}</td></tr>`,i&&(i.page=o);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let l={page:o,search:i?i.search:"",orderby:i?i.sortBy:"created_at",order:i?i.sortOrder:"DESC",_ajax_nonce:a.nonce_manage_tasks},c=await window.aipkit_apiRequest("aipkit_get_automated_tasks",l);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=c.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(c.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(c.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(l){console.error("Fetch Tasks Error:",l),r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${s.error_loading_tasks||"Error loading tasks:"} ${l.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=k})();(function(){"use strict";function k(o){if(!o){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),o):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=k})();(function(){"use strict";async function k(o,r){let i=window.aipkit_automated_tasks_config||{},a=i.text||{},s=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!0,a.delete_button||"Delete",a.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:r,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(a.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${a.error_deleting_task||"Error deleting task:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,a.delete_button||"Delete")}},l=a.confirm_delete_task||"Are you sure you want to delete this task?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(l,{title:a.confirm_title||"Confirm",confirmText:a.delete_button||"Delete",cancelText:a.cancel_button||"Cancel",onConfirm:()=>{s()}});return}confirm(l)&&await s()}window.aipkit_handleDeleteTaskAction=k})();(function(){"use strict";async function k(o,r,i){let a=window.aipkit_automated_tasks_config||{},s=a.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!0):(o.classList.add("aipkit_loading"),o.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:r,status:i,_ajax_nonce:a.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${s.task_status_updated||"Task status updated to"} ${i}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(l){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${s.error_updating_status||"Error updating task status:"} ${l.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!1):(o.classList.remove("aipkit_loading"),o.disabled=!1)}}window.aipkit_handleToggleTaskStatusAction=k})();(function(){"use strict";async function k(o,r){let i=window.aipkit_automated_tasks_config||{},a=i.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!0):(o.classList.add("aipkit_loading"),o.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:r,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(a.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(s){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${a.error_initiating_run||"Error initiating task run:"} ${s.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!1):(o.classList.remove("aipkit_loading"),o.disabled=!1)}}window.aipkit_handleRunNowTaskAction=k})();(function(){"use strict";async function k(o){let r=o.target.closest("button[data-action]");if(!r)return;let i=r.dataset.action,a=r.dataset.taskId;if(!a)return;let l=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(c=>c.id.toString()===a.toString());switch(i){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(l);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(r,a);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let c=i==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(r,a,c)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(r,a);break;default:console.warn(`Unknown task action: ${i}`);break}}window.aipkit_list_handleTaskActionClick=k})();(function(){"use strict";function k(o){let r=o.target.closest("button[data-page]");if(r&&!r.disabled){let i=parseInt(r.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(i):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=k})();(function(){"use strict";function k(o,r="info"){if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(o,r);return}let i=document.getElementById("aipkit_automated_task_form_status");i&&(i.textContent=o,i.className=`aipkit_form-help aipkit_settings_message-${r}`,setTimeout(()=>{i.textContent===o&&(i.textContent="",i.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_list_wrapper"),r=document.getElementById("aipkit_automated_tasks_tbody"),i=document.getElementById("aipkit_add_new_task_btn"),a=document.getElementById("aipkit_automated_task_form_wrapper"),s=document.getElementById("aipkit_automated_task_list_pagination"),l=document.getElementById("aipkit_task_list_search_input"),c=o?o.querySelector(".aipkit_data-table"):null;if(i&&a&&o&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&i.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(a,o,i)}),r&&typeof window.aipkit_list_handleTaskActionClick=="function"&&r.addEventListener("click",window.aipkit_list_handleTaskActionClick),s&&typeof window.aipkit_list_handleListPaginationClick=="function"&&s.addEventListener("click",window.aipkit_list_handleListPaginationClick),l){let n;l.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{let e=window.aipkit_automated_tasks_list_state;e&&(e.search=l.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}c&&c.addEventListener("click",n=>{let e=n.target.closest("th.aipkit-sortable-col");if(!e)return;let t=e.dataset.sortBy,d=window.aipkit_automated_tasks_list_state;if(!d)return;let _="DESC";d.sortBy===t&&(_=d.sortOrder==="DESC"?"ASC":"DESC"),d.sortBy=t,d.sortOrder=_,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=k})();(function(){"use strict";let k=[],o=1,r="",i="created_at",a="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...k]},set tasks(l){k=Array.isArray(l)?l:[]},get page(){return o},set page(l){o=l},get search(){return r},set search(l){r=l},get sortBy(){return i},set sortBy(l){i=l},get sortOrder(){return a},set sortOrder(l){a=l}};function s(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=s})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_task_queue_tbody"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),a=window.aipkit_automated_tasks_config||{},s=a.text||{},l=window.aipkit_escapeHtml||function(d){return d},c=window.aipkit_ucfirst||function(d){return d?d.charAt(0).toUpperCase()+d.slice(1):""},n=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(d=>{d.removeAttribute("data-sort-direction"),n&&d.dataset.sortBy===n.sortBy&&d.setAttribute("data-sort-direction",n.sortOrder.toLowerCase())}),!r){console.warn("Render Queue Table: Table body not found.");return}r.innerHTML="";let t=Array.isArray(o)&&o.length>0;if(i&&(i.disabled=!t,i.setAttribute("aria-disabled",t?"false":"true"),t?i.title=s.delete_filtered_title||"Delete filtered items":i.title=s.queue_empty_delete||"No queue items available to delete."),!t){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${s.queue_empty||"Task queue is currently empty."}</td></tr>`;return}o.forEach(d=>{let _=r.insertRow(),p=_.insertCell(),f=document.createElement("textarea");f.innerHTML=d.target_title||`${s.target_id_prefix||"ID:"} ${d.target_identifier}`;let g=f.value,m=d.task_type.startsWith("content_writing"),u=d.task_type==="enhance_existing_content",w=null;m&&d.status==="completed"&&d.generated_post_id?w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${d.generated_post_id}&action=edit`:u&&!isNaN(parseInt(d.target_identifier,10))&&(w=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${d.target_identifier}&action=edit`),w?p.innerHTML=`<a href="${w}" target="_blank" title="${l(s.edit_generated_post_title||"View post")}">${l(g)}</a>`:p.textContent=g,_.insertCell().textContent=l(d.task_name||`${s.task_id_prefix||"Task"} ${d.task_id}`);let h=_.insertCell(),C=a.task_types&&a.task_types[d.task_type]?a.task_types[d.task_type].label:c(d.task_type.replace(/_/g," "));h.innerHTML=`<span class="aipkit_task_type_badge" data-type="${l(d.task_type)}">${l(C)}</span>`;let x=_.insertCell(),v=`<span class="aipkit_job_status_${l(d.status)}">${l(c(d.status))}`;d.status==="failed"&&d.attempts>1&&(v+=` <small>(${d.attempts}x)</small>`),v+="</span>",d.status==="failed"&&d.error_message&&(v+=`<span class="aipkit_queue_error_message" title="${l(d.error_message)}">${l(d.error_message)}</span>`),x.innerHTML=v;let L=_.insertCell();if(d.added_at){let y=new Date(d.added_at.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),S=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(d.added_at):y,E=`<div class="aipkit_queue_time_entry aipkit_queue_time_added" title="${l(y)}">${l(S)}</div>`;if(d.scheduled_gmt_time){let A=new Date(d.scheduled_gmt_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(d.scheduled_gmt_time):A;E+=`<div class="aipkit_queue_time_entry aipkit_queue_time_scheduled" title="${l(A)}">${l(s.scheduled_for_label||"\u2192")} ${l(M)}</div>`}L.innerHTML=E}else L.textContent=s.not_applicable||"\u2014";let P=_.insertCell();P.className="aipkit_actions_cell";let b='<div class="aipkit-table-actions-group">';d.status==="failed"&&(b+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="retry_queue_item" data-item-id="${d.id}" title="${s.retry_button||"Retry"}"><span class="dashicons dashicons-controls-repeat" aria-hidden="true"></span><span class="aipkit_btn_label">${s.retry_button||"Retry"}</span></button>`),b+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete_queue_item" data-item-id="${d.id}" title="${s.delete_button||"Delete"}"><span class="dashicons dashicons-trash" aria-hidden="true"></span></button>`,b+="</div>",P.innerHTML=b})}window.aipkit_queue_renderQueueTable=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_task_queue_pagination"),a=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render Queue Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:s,total_pages:l,current_page:c}=o||{};if(!s||s<=0)return;let n=document.createElement("span");if(n.className="aipkit_pagination-count",n.textContent=`${Number(s).toLocaleString()} ${Number(s)===1?a.item_singular||"item":a.item_plural||"items"}`,r.appendChild(n),l>1){let e=document.createElement("span");e.className="aipkit_pagination-links";let t=document.createElement("button");t.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",t.innerHTML=`\xAB ${a.previous_button||"Previous"}`,t.disabled=Number(c)<=1,t.disabled||(t.dataset.page=Number(c)-1),e.appendChild(t);let d=document.createElement("span");d.className="aipkit_pagination-current",d.textContent=`${a.page_label||"Page"} ${Number(c)} ${a.of_label||"of"} ${Number(l)}`,e.appendChild(d);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",_.innerHTML=`${a.next_button||"Next"} \xBB`,_.disabled=Number(c)>=Number(l),_.disabled||(_.dataset.page=Number(c)+1),e.appendChild(_),r.appendChild(e)}}window.aipkit_queue_renderQueuePagination=k})();(function(){"use strict";async function k(o=1){let r=window.aipkit_automated_tasks_queue_state;r?r.page=o:console.warn("Fetch/Render Queue: Queue state object not available.");let i=document.getElementById("aipkit_automated_task_queue_tbody"),a=window.aipkit_automated_tasks_config||{},s=a.text||{};if(!i){console.warn("Fetch/Render Queue: Table body not found.");return}i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${s.loading_queue||"Loading queue items..."}</td></tr>`;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let l={page:o,search:r?r.search:"",status_filter:r?r.status:"all",orderby:r?r.sortBy:"q.added_at",order:r?r.sortOrder:"DESC",_ajax_nonce:a.nonce_manage_tasks},c=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",l);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(c.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(c.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(l){console.error("Fetch/Render Queue Error:",l),i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${s.error_loading_queue||"Error loading queue:"} ${l.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=k})();(function(){"use strict";async function k(o){let r=o.target.closest("button[data-action]");if(!r)return;let i=r.dataset.action,a=r.dataset.itemId;if(!a)return;let s=window.aipkit_automated_tasks_config||{},l=s.text||{},c=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1,n=(e,t)=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(e,t);return}typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e,t)};if(i==="delete_queue_item"){let e=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,l.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:a,_ajax_nonce:s.nonce_manage_tasks}),n(l.queue_item_deleted||"Queue item deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(c)}catch(d){n(`${l.error_deleting_queue_item||"Error deleting item:"} ${d.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,l.delete_button||"Delete")}},t=l.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(t,{title:l.confirm_title||"Confirm",confirmText:l.delete_button||"Delete",cancelText:l.cancel_button||"Cancel",onConfirm:()=>{e()}});return}if(!confirm(t))return;await e()}else if(i==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,l.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:a,_ajax_nonce:s.nonce_manage_tasks}),n(l.item_marked_retry||"Item marked for retry. Queue processing will pick it up.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(c)}catch(e){n(`${l.error_retrying_item||"Error retrying item:"} ${e.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,l.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=k})();(function(){"use strict";async function k(){let o=document.getElementById("aipkit_delete_queue_by_status_btn"),r=document.getElementById("aipkit_task_queue_status_filter");if(!o||!r){console.error("Delete by status button or filter dropdown not found.");return}let i=r.value,a=r.options[r.selectedIndex].text.toLowerCase(),s=window.aipkit_automated_tasks_config||{},l=s.text||{},c=i==="all"?l.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(l.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",a),n=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(o,!0,l.delete_button||"Delete",l.deleting_task||"Deleting..."):o.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let e=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:i,_ajax_nonce:s.nonce_manage_tasks});typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(e.message||"Queue items deleted.","success"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.message||"Queue items deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(e){let t=`${l.errorDeletingAllItems||"Error deleting items:"} ${e.message||"Unknown error"}`;typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(t,"error"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(t,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(o,!1,l.delete_button||"Delete"):o.disabled=!1}};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(c,{title:l.confirm_title||"Confirm",confirmText:l.delete_button||"Delete",cancelText:l.cancel_button||"Cancel",onConfirm:()=>{n()}});return}confirm(c)&&await n()}window.aipkit_handleDeleteQueueByStatus=k})();(function(){"use strict";function k(o){let r=o.target.closest("button[data-page]");if(r&&!r.disabled){let i=parseInt(r.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(i):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_queue_tbody"),r=document.getElementById("aipkit_refresh_task_queue_btn"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),a=document.getElementById("aipkit_automated_task_queue_pagination"),s=document.getElementById("aipkit_task_queue_search_input"),l=document.getElementById("aipkit_task_queue_status_filter"),c=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(r&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&r.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),i&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&i.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),s){let n;s.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{let e=window.aipkit_automated_tasks_queue_state;e&&(e.search=s.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}l&&l.addEventListener("change",()=>{let n=window.aipkit_automated_tasks_queue_state;n&&(n.status=l.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),c&&c.addEventListener("click",n=>{let e=n.target.closest("th.aipkit-sortable-col");if(!e)return;let t=e.dataset.sortBy,d=window.aipkit_automated_tasks_queue_state;if(!d)return;let _="DESC";d.sortBy===t&&(_=d.sortOrder==="DESC"?"ASC":"DESC"),d.sortBy=t,d.sortOrder=_,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),o&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&o.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),a&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&a.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=k})();(function(){"use strict";let k=1,o="",r="all",i="q.added_at",a="DESC";window.aipkit_automated_tasks_queue_state={get page(){return k},set page(l){k=l},get search(){return o},set search(l){o=l},get status(){return r},set status(l){r=l},get sortBy(){return i},set sortBy(l){i=l},get sortOrder(){return a},set sortOrder(l){a=l}};function s(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=s})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_autogpt_container");if(o&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():o&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),(()=>{if(!o)return;let i=o.querySelector("#aipkit_autogpt_cron_status [data-aipkit-cron-timestamp]");if(!i)return;let a=i.dataset.aipkitCronTimestamp,s=a?parseInt(a,10):0;if(!s||Number.isNaN(s))return;let l=new Date(s*1e3),c=l.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});i.textContent=c,i.title=l.toLocaleString()})(),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(i){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",i)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.");if(typeof window.aipkit_initAutogptPopovers=="function")try{window.aipkit_initAutogptPopovers(o)}catch(i){console.error("AIPKit AutoGPT: Error initializing settings popovers:",i)}if(typeof window.aipkit_updateAutogptAiSummaries=="function")try{window.aipkit_updateAutogptAiSummaries(o)}catch(i){console.error("AIPKit AutoGPT: Error updating AI summaries:",i)}if(typeof window.aipkit_initAutogptAiSettingsRedesigned=="function")try{window.aipkit_initAutogptAiSettingsRedesigned(o)}catch(i){console.error("AIPKit AutoGPT: Error initializing AI settings UI:",i)}if(typeof window.aipkit_initAutogptPromptFlyouts=="function")try{window.aipkit_initAutogptPromptFlyouts(o)}catch(i){console.error("AIPKit AutoGPT: Error initializing prompt flyouts:",i)}typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_autogpt_container"):console.warn("AIPKit AutoGPT: aipkit_initApiKeyToggles not found.")}window.aipkit_initAutogpt=k})();(function(){"use strict";let k=null;function o(c,n="",e=0){let t=document.getElementById("aipkit_content_writer_form_status");if(!t)return;k&&(clearTimeout(k),k=null);let d="aipkit_cw_status_badge",_=(p="")=>{t.className=p?`${d} ${p}`:d};switch(_(),c){case"progress":t.textContent=n,_("aipkit_settings_message-info");break;case"info":t.textContent=n,_("aipkit_settings_message-info");break;case"success":t.textContent=n,_("aipkit_settings_message-success");break;case"error":t.textContent=n,_("aipkit_settings_message-error");break;case"clear":default:t.textContent="",_();return}e&&(k=setTimeout(()=>{t.textContent===n&&r()},e))}function r(){o("clear")}function i(c){o("progress",c)}function a(c,n=3e3){o("info",c,n)}function s(c){o("success",c,3e3)}function l(c){o("error",c)}window.aipkit_updateGeneralStatus=o,window.aipkit_clearGeneralStatus=r,window.aipkit_showProgress=i,window.aipkit_showInfo=a,window.aipkit_showSuccess=s,window.aipkit_showError=l})();(function(){"use strict";window.aipkit_cw_isAutosaving=!1,window.aipkit_cw_lastSavedData=null;function k(){let a=window.aipkit_cw_template_state,s=a?.currentTemplateId;if(!s)return null;let l="";if(Array.isArray(a?.currentTemplates)){let n=a.currentTemplates.find(e=>String(e.id)===String(s));n?.template_name&&(l=n.template_name)}if(!l){let n=document.getElementById("aipkit_cw_template_select");n?.selectedOptions?.length&&(l=n.selectedOptions[0].textContent.trim())}let c=parseInt(s,10);return!l||Number.isNaN(c)?null:{id:c,name:l}}function o(){if(typeof window.aipkit_getContentWriterFormConfig!="function")return null;let a=document.getElementById("aipkit_content_writer_form");return a?window.aipkit_getContentWriterFormConfig(a):null}async function r(){if(window.aipkit_cw_autosave_suspended||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getContentWriterFormConfig!="function"||window.aipkit_cw_isAutosaving)return;let a=window.aipkit_cw_template_state;if(a?.isSavingOrDeleting)return;let s=o();if(!s)return;let l=window.aipkit_cw_lastSavedData||{};if(JSON.stringify(s)===JSON.stringify(l))return;let c=k();if(!c)return;let n=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,e=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,t=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_isAutosaving=!0,n&&n("Saving...");try{let d=document.getElementById("aipkit_content_writer_template_nonce_field");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:c.id,template_name:c.name,template_type:"content_writer",config:JSON.stringify(s),_ajax_nonce:d?d.value:""}),window.aipkit_cw_lastSavedData=s,a&&(a.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(s)),a.currentTemplateModified=!1),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(String(c.id)),e&&e("Updated")}catch(d){t&&t(`Error: ${d.message||"Failed to save."}`),console.error("Content Writer Auto-Save Error:",d)}finally{window.aipkit_cw_isAutosaving=!1}}function i(){let a=o();a&&(window.aipkit_cw_lastSavedData=a)}window.aipkit_handleContentWriterAutoSave=r,window.aipkit_updateContentWriterAutosaveBaseline=i})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_form");if(!o)return;let r="data-aipkit-cw-autosave-attached";o.getAttribute(r)||(o.addEventListener("change",i=>{let a=i.target;if(!a||!a.matches(".aipkit_autosave_trigger"))return;(a.tagName.toLowerCase()==="select"||a.type==="checkbox"||a.type==="range")&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()}),o.addEventListener("blur",i=>{let a=i.target;if(!a||!a.matches(".aipkit_autosave_trigger"))return;let s=a.tagName.toLowerCase();(s==="input"||s==="textarea")&&a.type!=="range"&&a.type!=="checkbox"&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()},!0),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline(),o.setAttribute(r,"true"))}window.aipkit_initContentWriterAutosave=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.warn("Content Writer Accordions: Main container not found.");return}o.dataset.accordionListenerAttached!=="true"&&(o.addEventListener("click",function(r){let i=r.target.closest(".aipkit_accordion-header");if(!i)return;let a=i.closest(".aipkit_accordion");if(!a)return;let s=i.nextElementSibling;if(!s||!s.classList.contains("aipkit_accordion-content"))return;let l=a.closest(".aipkit_accordion-group");if(l&&!i.classList.contains("aipkit_active")){let c=l.querySelector(".aipkit_accordion-header.aipkit_active");if(c){c.classList.remove("aipkit_active");let n=c.nextElementSibling;n&&n.classList.remove("aipkit_active")}}i.classList.toggle("aipkit_active"),s.classList.toggle("aipkit_active")}),o.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(c){return c},o=null,r={title:"Title",content:"Content",image:"Image",meta:"Meta",keyword:"Keyword",tags:"Tags",excerpt:"Excerpt"},i=null;function a(c,n=""){if(o||(o=document.getElementById("aipkit_content_writer_form_status")),!o)return;i&&(clearTimeout(i),i=null),o.textContent=c;let e="aipkit_cw_status_badge";o.className=n?`${e} ${n}`:e}function s(c,n,e=""){let t=r[c]||"Step",d=e?k(e):"";switch(n){case"pending":break;case"generating":a(d||`Generating ${t}...`,"aipkit_settings_message-info");break;case"success":a(`${t} complete`,"aipkit_settings_message-success"),i=setTimeout(()=>{a("")},1400);break;case"error":a(`Error ${t}${d?": "+d:""}`,"aipkit_settings_message-error");break;case"skipped":d&&(a(`${t} skipped: ${d}`,"aipkit_settings_message-info"),i=setTimeout(()=>{a("")},1400));break}let _=document.getElementById(`aipkit_cw_status_${c}_generation`),p=_?_.querySelector(".aipkit_cw_status_icon"):null,f=_?_.querySelector(".status-text"):null;if(!(!_||!p||!f))switch(_.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),_.classList.add(`status-${n}`),n){case"pending":{f.textContent="Pending";let g="dashicons-text-page";c==="content"&&(g="dashicons-admin-post"),c==="image"&&(g="dashicons-format-image"),c==="excerpt"&&(g="dashicons-editor-quote"),c==="tags"&&(g="dashicons-tag"),c==="meta"&&(g="dashicons-search"),c==="keyword"&&(g="dashicons-flag"),p.className=`dashicons ${g} aipkit_cw_status_icon`;break}case"generating":f.textContent=d||"Generating...",p.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":f.textContent="Complete",p.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":f.textContent=`Error ${d?": "+d:""}`,p.className="dashicons dashicons-warning aipkit_cw_status_icon";break;case"skipped":f.textContent="Skipped",p.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function l(){a(""),["title","content","image","meta","keyword","excerpt","tags"].forEach(c=>{s(c,"pending")})}window.aipkit_updateCwGenerationStatus=s,window.aipkit_resetAllGenerationStatuses=l})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_form_status");o&&(o.textContent="",o.className="aipkit_cw_status_badge"),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending"))}window.aipkit_resetGenerationStatusIndicators=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(d){return d},o=window.aipkit_escapeHtml||function(d){return d},r=(d,_)=>(d?.elements?.[_]?.value||"").trim(),i=d=>String(d||"").split(/\r?\n/).map(_=>_.trim()).filter(Boolean),a=d=>d.map(_=>_.split("|")[0].trim()).filter(Boolean),s=d=>{try{let _=new URL(d);return _.protocol==="http:"||_.protocol==="https:"}catch{return!1}},l=d=>{let _=d?.querySelector(".aipkit_gsheets_indicator");return _?_.classList.contains("aipkit_gsheets_indicator--success"):!0};function c(d,_){d&&(d.textContent=_||k("Please review your input.","gpt3-ai-content-generator"),d.id==="aipkit_cw_action_validation"?d.className="aipkit_cw_action_validation":d.className="aipkit_cw_status_badge aipkit_settings_message-error")}function n(d){d&&(d.textContent="",d.id==="aipkit_cw_action_validation"?d.className="aipkit_cw_action_validation":d.className="aipkit_cw_status_badge")}function e(d,_){let p=_||document.getElementById("aipkit_cw_mode_select")?.value||"task";if(p==="single"&&(p="task"),p==="task")return a(i(r(d,"content_title_bulk"))).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one topic.","gpt3-ai-content-generator")};if(p==="csv"){let f=document.getElementById("aipkit_cw_csv_data_holder");return(f?f.value.trim():"")?{isValid:!0}:{isValid:!1,message:k("Please upload and parse a CSV file first.","gpt3-ai-content-generator")}}if(p==="rss")return i(r(d,"rss_feeds")).filter(s).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid RSS feed URL.","gpt3-ai-content-generator")};if(p==="url")return i(r(d,"url_list")).filter(s).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid website URL.","gpt3-ai-content-generator")};if(p==="gsheets"){let f=r(d,"gsheets_sheet_id"),g=r(d,"gsheets_credentials");return!f||!g?{isValid:!1,message:k("Please provide a Google Sheet ID and credentials.","gpt3-ai-content-generator")}:l(d)?{isValid:!0}:{isValid:!1,message:k("Verify access before generating.","gpt3-ai-content-generator")}}return{isValid:!0}}async function t(d,_,p){let f=new FormData(d),g=Object.fromEntries(f.entries()),m=d.elements["openai_vector_store_ids[]"];g.openai_vector_store_ids=m?Array.from(m.selectedOptions).map(P=>P.value):[],delete g["openai_vector_store_ids[]"];let u=window.aipkit_dashboard?.text||{},w=document.getElementById("aipkit_cw_mode_select"),h=w?w.value:"task";h==="single"&&(h="task"),g.cw_generation_mode=h;let C=document.getElementById("aipkit_cw_action_validation"),x=e(d,h);if(!x.isValid){let P=p||C;c(P,x.message),P!==C&&n(C);return}if(n(p),n(C),h==="csv"){let P=document.getElementById("aipkit_cw_csv_data_holder");g.content_title=P?P.value:""}else h==="url"?(g.url_list=d.elements.url_list?.value||"",g.content_title=g.url_list):h==="task"&&(g.content_title=d.elements.content_title_bulk?d.elements.content_title_bulk.value:"");delete g.content_title_bulk,delete g.content_title_csv;let v=document.getElementById("aipkit_cw_template_select"),L="";if(v&&v.selectedIndex>0){let P=v.options[v.selectedIndex];P&&(L=P.text)}if(L&&L.trim()!=="")g.task_name=L.trim();else{let P=(g.content_title||g.rss_feeds||g.gsheets_sheet_id||g.url_list||"").split(`
`)[0].trim();g.task_name=P||"Automated Content Writing Task"}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(_,!0,"Create Task","Creating Task..."):(_.disabled=!0,_.textContent="Creating Task..."),p&&(p.textContent="Creating automated task...",p.className="aipkit_cw_status_badge aipkit_settings_message-info");try{let P=document.getElementById("aipkit_content_writer_nonce");if(g._ajax_nonce=P?P.value:"",!g._ajax_nonce)throw new Error("Security token missing for task creation.");let b=await window.aipkit_apiRequest("aipkit_content_writer_create_task",g);p&&(p.textContent="",p.className="aipkit_cw_status_badge"),typeof window.aipkit_invalidateModuleCache=="function"&&window.aipkit_invalidateModuleCache("autogpt"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("autogpt",{aipkit_force_refresh:!0})}catch(P){console.error("Content Writer Create Task Error:",P),p&&(p.textContent=`Error creating task: ${o(P.message||"Unknown error")}`,p.className="aipkit_cw_status_badge aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(_,!1,"Create Task"):(_.disabled=!1,_.textContent="Create Task")}}window.aipkit_createContentWriterTask=t,window.aipkit_validateContentWriterInputs=e,window.aipkit_showContentWriterValidationError=c,window.aipkit_clearContentWriterValidationMessage=n})();(function(){"use strict";let k=()=>{let p=document.getElementById("aipkit_cw_mode_select"),f=p?p.value:"task";return f==="single"?"task":f},o=()=>{let p=k();return p==="task"||p==="csv"},r=p=>{!p?.frequencySelect||!p.frequencySelect.querySelector('option[value="one-time"]')||p.frequencySelect.value!=="one-time"&&(p.frequencySelect.value="one-time",p.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})))},i=()=>{let p=document.getElementById("aipkit_content_writer_container");if(!p)return null;let f=p.querySelector(".aipkit_cw_generate_split");if(!f)return null;let g=f.querySelector("#aipkit_content_writer_generate_btn"),m=f.querySelector(".aipkit_cw_generate_toggle"),u=f.querySelector(".aipkit_cw_generate_menu"),w=u?u.querySelector('[data-menu-panel="actions"]'):null,h=u?u.querySelector('[data-menu-panel="intervals"]'):null,C=w?Array.from(w.querySelectorAll("[data-action]")):[],x=h?Array.from(h.querySelectorAll("[data-interval]")):[],v=h?h.querySelector("[data-menu-back]"):null,L=p.querySelector("#aipkit_cw_task_frequency");return{container:p,split:f,generateBtn:g,toggleBtn:m,menu:u,menuActions:w,menuIntervals:h,actionItems:C,intervalItems:x,backBtn:v,frequencySelect:L}},a=p=>{!p?.menu||!p?.toggleBtn||(p.menu.hidden=!0,p.toggleBtn.setAttribute("aria-expanded","false"))},s=p=>{if(!p?.menu||!p?.split)return;let f=p.menu,g=p.split.getBoundingClientRect(),m=window.innerWidth,u=12;f.style.position="fixed",f.style.right="auto",f.style.bottom="auto",f.style.zIndex="100000",f.style.visibility="hidden";let w=f.getBoundingClientRect(),h=g.right-w.width;h=Math.max(u,Math.min(h,m-w.width-u));let C=g.bottom+6;f.style.left=`${Math.round(h)}px`,f.style.top=`${Math.round(C)}px`,f.style.visibility="visible"},l=p=>{!p?.menu||!p?.toggleBtn||(p.menu.hidden=!1,s(p),p.toggleBtn.setAttribute("aria-expanded","true"))},c=(p,f)=>{if(!p?.menuActions||!p?.menuIntervals)return;let g=f==="intervals";p.menuActions.hidden=g,p.menuIntervals.hidden=!g},n=(p,f)=>{p&&(p.split.dataset.aipkitCwAction=f||"generate",p.actionItems.forEach(g=>{let m=g.dataset.action===f;g.classList.toggle("is-active",m),g.setAttribute("aria-checked",m?"true":"false")}))},e=p=>{if(!p?.frequencySelect)return;let f=p.frequencySelect.value||p.frequencySelect.options[0]?.value||"";p.intervalItems.forEach(g=>{let m=g.dataset.interval===f;g.classList.toggle("is-active",m),g.setAttribute("aria-checked",m?"true":"false")})},t=(p,f)=>{p?.frequencySelect&&(p.frequencySelect.value=f,p.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})),e(p),a(p),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState())},d=p=>{let f=i();if(!f)return;let g=p||"generate",m=g==="create_task"&&o();if(m&&r(f),n(f,g),typeof window.aipkit_updateContentWriterActionState=="function"&&(f.menu&&g==="create_task"&&!m&&(f.menu.dataset.keepOpen="true"),window.aipkit_updateContentWriterActionState()),g==="create_task"&&f.menuIntervals&&!m){c(f,"intervals"),e(f),l(f);return}c(f,"actions"),a(f),m&&g==="create_task"&&f.generateBtn&&setTimeout(()=>{f.generateBtn.click()},0)},_=()=>{let p=i();p&&p.split.dataset.listenerAttached!=="true"&&(p.split.dataset.aipkitCwAction||(p.split.dataset.aipkitCwAction="generate"),n(p,p.split.dataset.aipkitCwAction),e(p),p.toggleBtn&&p.toggleBtn.addEventListener("click",f=>{if(f.preventDefault(),p.toggleBtn.disabled)return;(p.split.dataset.aipkitCwAction||"generate")==="create_task"&&!o()?(c(p,"intervals"),e(p)):c(p,"actions"),p.menu&&p.menu.hidden?l(p):a(p)}),p.actionItems.forEach(f=>{f.addEventListener("click",g=>{g.preventDefault(),!f.disabled&&d(f.dataset.action||"generate")})}),p.intervalItems.forEach(f=>{f.addEventListener("click",g=>{g.preventDefault(),!f.disabled&&t(p,f.dataset.interval||"")})}),p.backBtn&&p.backBtn.addEventListener("click",f=>{f.preventDefault(),c(p,"actions"),l(p)}),document.addEventListener("click",f=>{let g=f.target;!p.menu||p.menu.hidden||p.split.contains(g)||a(p)}),document.addEventListener("keydown",f=>{f.key==="Escape"&&(!p.menu||p.menu.hidden||a(p))}),p.split.dataset.listenerAttached="true")};window.aipkit_initContentWriterGenerateMenu=_,window.aipkit_setCwGenerateAction=d,window.aipkit_getCwGenerateAction=()=>i()?.split?.dataset.aipkitCwAction||"generate"})();(function(){"use strict";let k=window.wp?.i18n?.__||function(q){return q},o=100,r=[{key:"write",label:k("Writing","gpt3-ai-content-generator"),steps:["title","content"],isEnabled:()=>!0},{key:"optimize",label:k("Optimizing","gpt3-ai-content-generator"),steps:["meta","focus","excerpt","tags"],isEnabled:q=>q.generateMeta||q.generateFocus||q.generateExcerpt||q.generateTags},{key:"publish",label:k("Publishing","gpt3-ai-content-generator"),steps:["image","featured","save"],isEnabled:()=>!0}],i={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Running","gpt3-ai-content-generator"),done:k("Done","gpt3-ai-content-generator"),skipped:k("Skipped","gpt3-ai-content-generator"),error:k("Error","gpt3-ai-content-generator")},a=[{key:"title",label:k("Title","gpt3-ai-content-generator"),isEnabled:q=>!!q.customTitlePrompt},{key:"content",label:k("Content","gpt3-ai-content-generator"),isEnabled:()=>!0},{key:"meta",label:k("Meta","gpt3-ai-content-generator"),isEnabled:q=>q.generateMeta},{key:"focus",label:k("Focus","gpt3-ai-content-generator"),isEnabled:q=>q.generateFocus},{key:"excerpt",label:k("Excerpt","gpt3-ai-content-generator"),isEnabled:q=>q.generateExcerpt},{key:"tags",label:k("Tags","gpt3-ai-content-generator"),isEnabled:q=>q.generateTags},{key:"image",label:k("Image","gpt3-ai-content-generator"),isEnabled:q=>q.generateImages},{key:"featured",label:k("Featured","gpt3-ai-content-generator"),isEnabled:q=>q.generateFeatured},{key:"save",label:k("Save","gpt3-ai-content-generator"),isEnabled:()=>!0}],s={active:!1,stopRequested:!1,items:[],rows:[],totals:{processed:0,completed:0,failed:0}},l=(q,O)=>({customTitlePrompt:String(q.custom_title_prompt||"").trim(),generateMeta:q.generate_meta_description==="1",generateFocus:q.generate_focus_keyword==="1",generateExcerpt:q.generate_excerpt==="1",generateTags:q.generate_tags==="1",generateImages:O.generate_images_enabled==="1",generateFeatured:O.generate_featured_image==="1"}),c=q=>{let O={};return a.forEach(R=>{O[R.key]=R.isEnabled(q)?"waiting":"skipped"}),O},n=(q,O)=>{let R=document.createElement("span");R.className=`aipkit_cw_batch_step aipkit_cw_batch_step--${O}`,R.dataset.step=q.key,R.dataset.status=O;let D=document.createElement("span");D.className="aipkit_cw_batch_step_label",D.textContent=q.label;let Z=document.createElement("span");return Z.className="aipkit_cw_batch_step_status",Z.textContent=i[O]||O,R.appendChild(D),R.appendChild(Z),{wrapper:R,status:Z}},e=(q,O,R)=>{C(q,O,R)},t=q=>{q?.phases&&Object.keys(q.phases).forEach(O=>{let R=q.phases[O],D=R.dataset.status;D==="done"||D==="skipped"||(R.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",R.dataset.status="error")})},d=()=>{let q=document.getElementById("aipkit_content_writer_container");if(!q)return null;let O=q.querySelector("#aipkit_cw_batch_queue"),R=O?O.querySelector(".aipkit_cw_batch_list"):null,D=O?O.querySelector(".aipkit_cw_batch_count"):null,Z=O?O.querySelector(".aipkit_cw_batch_progress"):null,Q=O?O.querySelector(".aipkit_cw_batch_progress_bar"):null,fe=q.querySelector("#aipkit_content_writer_form_status"),Ae=q.querySelector("#aipkit_content_writer_generate_btn"),We=q.querySelector(".aipkit_cw_generate_toggle"),Ge=q.querySelector(".aipkit_cw_generate_menu"),it=Ge?Array.from(Ge.querySelectorAll(".aipkit_cw_generate_menu_item")):[],_t=q.querySelector("#aipkit_content_writer_stop_btn");return{container:q,queue:O,list:R,count:D,progress:Z,progressBar:Q,status:fe,generateBtn:Ae,generateToggle:We,generateMenu:Ge,generateMenuItems:it,stopBtn:_t}},_=()=>{s.totals.processed=0,s.totals.completed=0,s.totals.failed=0},p=()=>{let q=d();if(!q||!q.count||!q.progressBar||!q.progress)return;let O=s.items.length,R=s.totals.completed;q.count.textContent=`${R}/${O}`;let D=O>0?Math.round(R/O*100):0;q.progressBar.style.width=`${D}%`,q.progress.setAttribute("aria-valuenow",String(D))},f=(q,O)=>{let R=d();!R||!R.status||(R.status.textContent=q||"",R.status.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),O&&R.status.classList.add(`aipkit_settings_message-${O}`))},g=()=>{let q=d();!q||!q.list||(q.list.innerHTML="",s.rows=[],s.items=[],_(),p())},m=()=>{let q=d();q?.queue&&(q.queue.hidden=!1)},u=()=>{let q=d();q?.queue&&(q.queue.hidden=!0)},w=(q,O)=>{let R=document.createElement("div");R.className="aipkit_cw_batch_row";let D=document.createElement("div");D.className="aipkit_cw_batch_row_content";let Z=document.createElement("span");Z.className="aipkit_cw_batch_topic",Z.textContent=q.topic||"";let Q=document.createElement("div");Q.className="aipkit_cw_batch_phases";let fe={},Ae=c(O),We={};r.forEach(Ot=>{let Nt=Ot.steps.some(qt=>{let Wt=a.find(ui=>ui.key===qt);return Wt&&Wt.isEnabled(O)});if(!Ot.isEnabled(O)&&!Nt)return;let Ie=document.createElement("span");Ie.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--waiting",Ie.dataset.phase=Ot.key,Ie.dataset.status="waiting",Ie.setAttribute("title",Ot.label),Ie.setAttribute("aria-label",Ot.label),Q.appendChild(Ie),fe[Ot.key]=Ie,Ot.steps.forEach(qt=>{We[qt]={wrapper:Ie,phaseKey:Ot.key,status:{textContent:""}}})});let Ge=document.createElement("span");Ge.className="aipkit_cw_batch_status aipkit_cw_batch_status--waiting",Ge.textContent=k("Waiting","gpt3-ai-content-generator");let it=document.createElement("span");it.className="aipkit_cw_batch_error",it.hidden=!0;let _t=document.createElement("a");_t.className="aipkit_cw_batch_view",_t.textContent=k("View","gpt3-ai-content-generator"),_t.target="_blank",_t.rel="noopener noreferrer",_t.hidden=!0;let mt=document.createElement("span");return mt.className="aipkit_cw_batch_summary_text",D.appendChild(Z),D.appendChild(Q),D.appendChild(Ge),D.appendChild(it),D.appendChild(_t),R.appendChild(D),{row:R,topic:Z,summary:mt,status:Ge,error:it,view:_t,phases:fe,steps:We}},h=q=>{let O=a.find(R=>R.key===q);return O?O.label:q},C=(q,O,R)=>{if(!q?.phases)return;let D=r.find(Q=>Q.steps.includes(O));if(!D)return;let Z=q.phases[D.key];Z&&(R==="running"?(Z.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--running",Z.dataset.status="running",q.status&&(q.status.textContent=`${D.label} \xB7 ${h(O)}`)):R==="done"?(Z.dataset.status==="running"||O===D.steps[D.steps.length-1])&&(Z.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",Z.dataset.status="done"):R==="error"&&(Z.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",Z.dataset.status="error"))},x=(q,O)=>{let R=d();!R||!R.list||(R.list.innerHTML="",s.rows=q.map(D=>{let Z=w(D,O);return R.list.appendChild(Z.row),Z}))},v=(q,O,R={})=>{if(!q)return;q.row.classList.toggle("is-active",O==="running"),q.status.className=`aipkit_cw_batch_status aipkit_cw_batch_status--${O}`;let D={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Generating","gpt3-ai-content-generator"),success:k("Done","gpt3-ai-content-generator"),error:k("Failed","gpt3-ai-content-generator"),stopped:k("Stopped","gpt3-ai-content-generator")};if(q.status.textContent=D[O]||O,q.error&&(q.error.hidden=!0,q.error.textContent="",q.error.removeAttribute("title")),O==="success"&&q.phases&&Object.keys(q.phases).forEach(Z=>{let Q=q.phases[Z];Q.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",Q.dataset.status="done"}),R.summary!==void 0&&(q.summary.textContent=R.summary||""),R.viewLink?(q.view.href=R.viewLink,q.view.hidden=!1):O!=="success"&&(q.view.hidden=!0),O==="error"&&q.error){let Z=P(R.summary);Z&&(q.error.textContent=Z,q.error.title=L(R.summary),q.error.hidden=!1)}},L=q=>String(q||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),P=q=>{let O=L(q);return O?O.length>140?`${O.slice(0,137)}\u2026`:O:""},b=(q,O)=>{let R=L(O||q);return R?R.length>140?`${R.slice(0,140)}\u2026`:R:""},y=q=>{let O=new FormData(q),R=Object.fromEntries(O.entries()),D=q.elements["openai_vector_store_ids[]"];R.openai_vector_store_ids=D?Array.from(D.selectedOptions).map(Q=>Q.value):[],delete R["openai_vector_store_ids[]"];let Z=document.getElementById("aipkit_content_writer_nonce");return Z&&Z.value&&(R._ajax_nonce=Z.value),R},S=q=>{let O=q.elements["post_categories[]"],R=O?Array.from(O.selectedOptions).map(Z=>Z.value):[],D=q.querySelector('input[name="schedule_mode"]:checked')?.value||"immediate";return{ai_provider:q.elements.ai_provider?.value||"",ai_model:q.elements.ai_model?.value||"",ai_temperature:q.elements.ai_temperature?.value||"",reasoning_effort:q.elements.reasoning_effort?.value||"",cw_generation_mode:q.elements.cw_generation_mode?.value||"",post_type:q.elements.post_type?.value||"post",post_author:q.elements.post_author?.value||"",post_status:q.elements.post_status?.value||"draft",post_schedule_date:q.elements.post_schedule_date?.value||"",post_schedule_time:q.elements.post_schedule_time?.value||"",schedule_mode:D,smart_schedule_start_datetime:q.elements.smart_schedule_start_datetime?.value||"",smart_schedule_interval_value:q.elements.smart_schedule_interval_value?.value||"",smart_schedule_interval_unit:q.elements.smart_schedule_interval_unit?.value||"",post_categories:R,generate_toc:q.elements.generate_toc?.checked?"1":"0",generate_seo_slug:q.elements.generate_seo_slug?.checked?"1":"0",generate_images_enabled:q.elements.generate_images_enabled?.checked?"1":"0",generate_featured_image:q.elements.generate_featured_image?.checked?"1":"0",image_provider:q.elements.image_provider?.value||"",image_model:q.elements.image_model?.value||"",image_prompt:q.elements.image_prompt?.value||"",featured_image_prompt:q.elements.featured_image_prompt?.value||"",image_count:q.elements.image_count?.value||"1",image_placement:q.elements.image_placement?.value||"after_first_h2",image_placement_param_x:q.elements.image_placement_param_x?.value||"",image_alignment:q.elements.image_alignment?.value||"none",image_size:q.elements.image_size?.value||"large",pexels_orientation:q.elements.pexels_orientation?.value||"",pexels_size:q.elements.pexels_size?.value||"",pexels_color:q.elements.pexels_color?.value||"",pixabay_orientation:q.elements.pixabay_orientation?.value||"",pixabay_image_type:q.elements.pixabay_image_type?.value||"",pixabay_category:q.elements.pixabay_category?.value||"",generate_image_title:q.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:q.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:q.elements.generate_image_caption?.checked?"1":"0",generate_image_description:q.elements.generate_image_description?.checked?"1":"0",image_title_prompt:q.elements.image_title_prompt?.value||"",image_alt_text_prompt:q.elements.image_alt_text_prompt?.value||"",image_caption_prompt:q.elements.image_caption_prompt?.value||"",image_description_prompt:q.elements.image_description_prompt?.value||""}},E=(q,O)=>{let R=O.content_title||O.topic||"",D=O.inline_keywords||O.keywords||"",Z=D?`${R} | ${D}`:R,Q={...q,content_title:Z};return O.rss_description&&(Q.rss_description=O.rss_description),O.source_url&&(Q.source_url=O.source_url),O.url_content_context&&(Q.url_content_context=O.url_content_context),{data:Q,topic:R,keywords:D}},A=(q,O,R,D,Z,Q,fe)=>({original_topic:O,final_title:R,post_title:R,keywords:D,excerpt:Z||"",image_provider:q.image_provider,image_model:q.image_model,image_prompt:q.image_prompt,image_alignment:q.image_alignment,image_size:q.image_size,featured_image_prompt:q.featured_image_prompt,pexels_orientation:q.pexels_orientation,pexels_size:q.pexels_size,pexels_color:q.pexels_color,pixabay_orientation:q.pixabay_orientation,pixabay_image_type:q.pixabay_image_type,pixabay_category:q.pixabay_category,generate_image_title:q.generate_image_title,generate_image_alt_text:q.generate_image_alt_text,generate_image_caption:q.generate_image_caption,generate_image_description:q.generate_image_description,image_title_prompt:q.image_title_prompt,image_alt_text_prompt:q.image_alt_text_prompt,image_caption_prompt:q.image_caption_prompt,image_description_prompt:q.image_description_prompt,ai_provider:q.ai_provider,ai_model:q.ai_model,ai_temperature:q.ai_temperature,reasoning_effort:q.reasoning_effort,cw_generation_mode:q.cw_generation_mode,_ajax_nonce:Q,generate_images_enabled:q.generate_images_enabled,image_count:q.image_count,generate_featured_image:q.generate_featured_image,image_placement:q.image_placement,image_placement_param_x:q.image_placement_param_x,conversation_uuid:fe}),M=(q,O,R,D,Z,Q,fe)=>{let Ae=window.aipkit_getMarkdownRenderer?window.aipkit_getMarkdownRenderer():null,We=Ae?Ae.render(D):D,Ge=Array.isArray(O.post_categories)&&O.post_categories.length?O.post_categories:q.post_categories;return{post_title:R,post_content:We,generated_excerpt:Z.excerpt||"",generated_tags:Z.tags||"",meta_description:Z.meta_description||"",focus_keyword:Z.focus_keyword||"",post_type:O.post_type||q.post_type,post_author:O.post_author||q.post_author,post_status:q.post_status,post_schedule_date:O.post_schedule_date||q.post_schedule_date,post_schedule_time:O.post_schedule_time||q.post_schedule_time,post_categories:Ge,generate_toc:q.generate_toc,generate_seo_slug:q.generate_seo_slug,image_data:Q?JSON.stringify(Q):"",image_alignment:q.image_alignment,image_size:q.image_size,_ajax_nonce:fe}},$=async(q,O,R,D,Z)=>{let Q=q.item_config||{},{data:fe,topic:Ae,keywords:We}=E(O,Q),Ge=Ae,it=fe.conversation_uuid||void 0;if(!!String(fe.custom_title_prompt||"").trim()){e(D,"title","running");let ui=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",{...fe,conversation_uuid:it});if(!ui?.new_title)throw new Error(k("Title generation failed","gpt3-ai-content-generator"));Ge=ui.new_title,it=ui.conversation_uuid||it,e(D,"title","done")}else e(D,"title","skipped");e(D,"content","running");let Ot=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",{...fe,conversation_uuid:it});if(!Ot?.content)throw new Error(k("Content generation failed","gpt3-ai-content-generator"));e(D,"content","done"),it=Ot.conversation_uuid||it||void 0,e(D,"meta",Z.generateMeta?"done":"skipped"),e(D,"focus",Z.generateFocus?"done":"skipped"),e(D,"excerpt",Z.generateExcerpt?"done":"skipped"),e(D,"tags",Z.generateTags?"done":"skipped");let Nt=null;if(R.generate_images_enabled==="1"||R.generate_featured_image==="1"){Z.generateImages&&e(D,"image","running"),Z.generateFeatured&&e(D,"featured","running");let ui=Ot.focus_keyword||We||O.content_keywords||"",ae=A(R,Ae,Ge,ui,Ot.excerpt||"",O._ajax_nonce,it),Ce=R.generate_images_enabled==="1",Le=R.generate_featured_image==="1",Oe=Ce&&Le,$e=async(He={})=>{let je=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...ae,...He});if(!je?.image_data)throw new Error(k("Image generation failed","gpt3-ai-content-generator"));return je.image_data};if(Oe){let He=null,je=Qe=>{He||(He={...Qe,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(Ce){let Qe=await $e({generate_featured_image:"0"});je(Qe),Array.isArray(Qe.in_content_images)&&He.in_content_images.push(...Qe.in_content_images),Z.generateImages&&e(D,"image","done")}if(Le){let Qe=await $e({generate_images_enabled:"0",image_count:0});je(Qe),Qe.featured_image_id&&(He.featured_image_id=Qe.featured_image_id),Qe.featured_image_url&&(He.featured_image_url=Qe.featured_image_url),Z.generateFeatured&&e(D,"featured","done")}Nt=He}else Nt=await $e(),Z.generateImages&&e(D,"image","done"),Z.generateFeatured&&e(D,"featured","done")}else e(D,"image","skipped"),e(D,"featured","skipped");e(D,"save","running");let qt=M(R,Q,Ge,Ot.content,Ot,Nt,O._ajax_nonce),Wt=await window.aipkit_apiRequest("aipkit_content_writer_save_post",qt);return e(D,"save","done"),{summary:b(Ot.content,Ot.excerpt),viewLink:Wt.view_link||Wt.edit_link}},W=()=>{let q=d();s.active=!1,s.stopRequested=!1,q?.generateBtn&&(typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():q.generateBtn.disabled=!1,q.generateBtn.removeAttribute("aria-disabled")),q?.generateToggle&&(q.generateToggle.disabled=!1,q.generateToggle.removeAttribute("aria-disabled")),q?.generateMenuItems?.length&&q.generateMenuItems.forEach(O=>{O.disabled=!1,O.removeAttribute("aria-disabled")}),q?.stopBtn&&(q.stopBtn.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()},H=()=>{s.active&&(s.stopRequested=!0,f(k("Stopping...","gpt3-ai-content-generator"),"info"))},N=q=>{s.items.slice(q).forEach((O,R)=>{let D=s.rows[q+R];v(D,"stopped")})},G=async()=>{for(let R=0;R<s.items.length;R+=1){if(s.stopRequested){N(R);break}let D=s.rows[R];v(D,"running");try{let Z=await $(s.items[R],s.baseData,s.postConfig,D,s.stepContext);v(D,"success",Z),s.totals.completed+=1}catch(Z){t(D),v(D,"error",{summary:Z?.message||k("Failed","gpt3-ai-content-generator")}),s.totals.failed+=1}s.totals.processed+=1,p()}let q=s.items.length,O=s.totals.completed;s.stopRequested?f(k("Generation stopped.","gpt3-ai-content-generator"),"error"):f(`${O}/${q} ${k("completed","gpt3-ai-content-generator")}`,"success"),W()},J=async(q,O)=>{if(!q||!O)return;if(!window.aipkit_apiRequest){console.error("Batch generation: aipkit_apiRequest not available.");return}let R=d();if(!R?.generateBtn)return;if(s.active){f(k("Generation already in progress.","gpt3-ai-content-generator"),"info");return}let D=y(q),Z=S(q),Q=l(D,Z);try{s.active=!0,s.stopRequested=!1,_(),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(R.generateBtn,!0,k("Generate","gpt3-ai-content-generator"),k("Preparing\u2026","gpt3-ai-content-generator")):R.generateBtn.disabled=!0,R.queue&&(R.queue.dataset.cwMode=O),f(k("Preparing items\u2026","gpt3-ai-content-generator"),"info");let fe=await window.aipkit_apiRequest("aipkit_content_writer_prepare_batch",{...D,cw_generation_mode:O}),Ae=Array.isArray(fe.items)?fe.items:[];if(!Ae.length){f(k("No items found to generate.","gpt3-ai-content-generator"),"error"),W();return}g(),s.items=Ae.slice(0,o),s.baseData=D,s.postConfig=Z,s.stepContext=Q,x(s.items,Q),m(),p(),f(k("Generating content\u2026","gpt3-ai-content-generator"),"info"),await G()}catch(fe){f(fe?.message||k("Batch generation failed.","gpt3-ai-content-generator"),"error"),W()}},F=()=>{s.active=!1,s.stopRequested=!1,g(),u()};window.aipkit_cw_handleBatchGeneration=J,window.aipkit_cw_resetBatchQueue=F,window.aipkit_cw_requestBatchStop=H,window.aipkit_cw_isBatchActive=()=>s.active===!0})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},o=window.wp?.i18n?.__||function(i){return i};function r(i,a){let s=i.value,l=s?s.toLowerCase():"",c=window.aipkit_dashboard?.models;if(!a){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!c){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),a.innerHTML='<option value="">'+k("Error: Model data object not found")+"</option>",a.disabled=!0;return}let n=c[l];(typeof n>"u"||n===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${l}'. Defaulting to empty.`),n=l==="openai"?{}:[]),a.innerHTML="";let e=window.aipkit_dashboard?.recommendedModels?.[l]||[],t=Array.isArray(e)?e:[],d=new Set(t.map(_=>_?.id).filter(Boolean));if(l==="openai"&&typeof n=="object"&&!Array.isArray(n)){if(t.length>0){let _=document.createElement("optgroup");_.label=k(o("Recommended","gpt3-ai-content-generator")),t.forEach(p=>{if(p&&typeof p=="object"&&p.id){let f=new Option(k(p.name||p.id),p.id);_.appendChild(f)}}),_.children.length>0&&a.appendChild(_)}Object.keys(n).forEach(_=>{let p=document.createElement("optgroup");p.label=k(_);let f=n[_];Array.isArray(f)?f.forEach(g=>{if(!(g&&typeof g=="object"&&g.id&&d.has(g.id)))if(g&&typeof g=="object"&&g.id){let m=new Option(k(g.name||g.id),g.id);p.appendChild(m)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${_}':`,g)}):console.warn(`Content Writer Model Populator: Items for group '${_}' under '${l}' is not an array.`),p.children.length>0&&a.appendChild(p)})}else if(Array.isArray(n)){if(t.length>0){let p=document.createElement("optgroup");p.label=k(o("Recommended","gpt3-ai-content-generator")),t.forEach(f=>{if(f&&typeof f=="object"&&f.id){let g=new Option(k(f.name||f.id),f.id);p.appendChild(g)}}),p.children.length>0&&a.appendChild(p)}let _=t.length>0?document.createElement("optgroup"):null;_&&(_.label=k(o("All models","gpt3-ai-content-generator"))),n.forEach(p=>{if(!(p&&typeof p=="object"&&p.id&&d.has(p.id)))if(p&&typeof p=="object"&&p.id){let f=new Option(k(p.name||p.id),p.id);_?_.appendChild(f):a.appendChild(f)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${l}':`,p)}),_&&_.children.length>0&&a.appendChild(_)}else console.warn(`Content Writer Model Populator: Data for provider '${l}' is not in expected format. Actual type: ${typeof n}`),a.appendChild(new Option(k(`No models for ${s} (Format Error)`),""));if(!a.options||typeof a.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),a.appendChild(new Option(k("Error loading models"),"")),a.disabled=!0;else if(a.options.length===0)a.appendChild(new Option(k(`No models for ${s} (Sync in settings)`),"")),a.disabled=!0;else{a.disabled=!1;let _=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let p=window.aipkit_cw_template_state.pendingModelSelection;a.querySelector(`option[value="${CSS.escape(p)}"]`)?_=p:console.warn(`Content Writer Model Populator: Pending model '${p}' not found in new list for provider '${s}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(_===null){let p=a.querySelector("optgroup");p&&p.options&&p.options.length>0&&p.options[0].value?_=p.options[0].value:a.options&&a.options.length>0&&a.options[0].value?_=a.options[0].value:_=""}a.value=_}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let _=document.getElementById("aipkit_content_writer_container");_&&window.aipkit_cw_toggleReasoningEffort(_)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}window.aipkit_populateModelsForContentWriter=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(d){return d},o=d=>d&&d!=="single"?d:"task",r=d=>typeof d=="string"&&d.startsWith("existing"),i=d=>d==="existing"?"existing-content":d,a={"existing-images":{title:{label:"Image Title",desc:"Optimize attachment title"},content:{label:"Description",desc:"Update image description"},excerpt:{label:"Caption",desc:"Short image caption"},keyword:{label:"Alt Text",desc:"Describe the image for accessibility"}},"existing-products":{title:{label:"Product Title",desc:"Generate product headline"},content:{label:"Product Description",desc:"Generate main product description"},meta:{label:"Meta Description",desc:"SEO meta for product pages"},keyword:{label:"Focus Keyword",desc:"Primary keyword for product SEO"},excerpt:{label:"Short Description",desc:"Short summary of the product"},tags:{label:"Tags",desc:"Auto-generate product tags"}}},s=d=>{let _=document.getElementById("aipkit_content_writer_container");if(!_)return;let p=_.querySelectorAll(".aipkit_prompt_toggle_card[data-prompt-key]");if(!p.length)return;let f=a[d]||null;p.forEach(g=>{let m=g.dataset.promptKey,u=g.querySelector(".aipkit_prompt_toggle_label"),w=g.querySelector(".aipkit_prompt_toggle_desc");if(!u||!w)return;g.dataset.defaultLabel||(g.dataset.defaultLabel=u.textContent||""),g.dataset.defaultDesc||(g.dataset.defaultDesc=w.textContent||"");let h=f&&m?f[m]:null;h?(u.textContent=h.label,w.textContent=h.desc):(u.textContent=g.dataset.defaultLabel,w.textContent=g.dataset.defaultDesc)})},l=d=>{let _=document.querySelectorAll(".aipkit_cw_prompt_flyout");if(!_.length)return;let p=d==="existing-images",f=d==="existing-products";_.forEach(g=>{let m=g.querySelector(".aipkit_cw_prompt_panel"),u=g.querySelector(".aipkit_cw_prompt_editor_title");if(!m||!u)return;if(!g.dataset.defaultTitle){let h=u.textContent||m.getAttribute("aria-label")||"";g.dataset.defaultTitle=h}let w=g.dataset.defaultTitle||"";p&&g.dataset.existingImagesTitle?w=g.dataset.existingImagesTitle:f&&g.dataset.existingProductsTitle&&(w=g.dataset.existingProductsTitle),w&&(u.textContent=w,m.setAttribute("aria-label",w))})};function c(d){if(!document.getElementById("aipkit_content_writer_form"))return;let p=o(d),f=i(p),g=document.getElementById("aipkit_cw_single_output_wrapper");g&&f!=="task"&&(g.style.display="none");let m=document.getElementById("aipkit_cw_output_card");if(m){let h=g&&g.style.display!=="none";m.style.display=f==="task"&&h?"block":"none"}let u=document.getElementById("aipkit_cw_content_prompt_placeholders");if(u){let h="Use placeholders: {topic}, {keywords}",C=r(f);f==="rss"?h+=", {description}, {source_url}":f==="url"&&(h+=", {url_content}"),h+=".";let x=h.replace(/(\{[a-zA-Z0-9_]+\})/g,v=>`<code class="aipkit-placeholder" title="Click to copy">${k(v)}</code>`);u.innerHTML=x,u.hidden=C}typeof window.aipkit_setContentWriterPromptMode=="function"&&window.aipkit_setContentWriterPromptMode(f),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState(f);let w=document.getElementById("aipkit_cw_batch_queue");if(w){let h=w.querySelector(".aipkit_cw_batch_list"),C=h?h.children.length>0:!1,x=typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive();w.hidden=!(x||C)}typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),f.startsWith("existing")&&typeof window.aipkit_fetchContentWriterExistingPosts=="function"&&window.aipkit_fetchContentWriterExistingPosts(1)}function n(d){let _=document.getElementById("aipkit_content_writer_form");if(!_)return;let p=document.getElementById("aipkit_content_writer_generate_btn"),f=p?p.querySelector(".aipkit_btn-text"):null,g=p?p.querySelector(".aipkit_cw_task_suffix"):null,m=document.querySelector(".aipkit_cw_post_summary_trigger"),u=document.querySelector(".aipkit_cw_generate_split"),w=u?u.querySelector(".aipkit_cw_generate_toggle"):null,h=u?u.querySelector(".aipkit_cw_generate_menu"):null,C=_.querySelector("#aipkit_cw_task_frequency"),x=h?Array.from(h.querySelectorAll(".aipkit_cw_generate_menu_item[data-action]")):[],v=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,L=new Set(["task","csv","rss","gsheets","url"]),P=new Set(["rss","gsheets","url"]),b=o(d||document.getElementById("aipkit_cw_mode_select")?.value||"task");b=i(b);let y=r(b),S=b==="existing-images",E=b==="existing-products",A=b==="existing-content",M=L.has(b),$=P.has(b),W=M&&(!$||v),H=b==="task"||b==="csv";_.classList.toggle("aipkit_cw_mode_existing",y),_.classList.toggle("aipkit_cw_mode_existing_images",S),_.classList.toggle("aipkit_cw_mode_existing_products",E),_.classList.toggle("aipkit_cw_mode_existing_content",A),_.querySelectorAll(".aipkit_model_settings_popover.aipkit-active").forEach(R=>{R.classList.remove("aipkit-active"),R.setAttribute("aria-hidden","true")}),_.querySelectorAll(".aipkit_cw_popover_trigger[aria-expanded='true']").forEach(R=>R.setAttribute("aria-expanded","false")),_.querySelectorAll("[data-aipkit-cw-mode-only]").forEach(R=>{let Z=R.dataset.aipkitCwModeOnly===b;R.hidden=!Z,R.setAttribute("aria-hidden",Z?"false":"true"),!Z&&R.classList.contains("aipkit_model_settings_popover")&&(R.classList.remove("aipkit-active"),R.setAttribute("aria-hidden","true")),!Z&&R.classList.contains("aipkit_cw_popover_trigger")&&R.setAttribute("aria-expanded","false")}),s(b),l(b),typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),(()=>{if(!r)return;let R=window.aipkit_cw_template_state;if(!R)return;let Z=(Array.isArray(R.currentTemplates)?R.currentTemplates.find(Q=>String(Q.id)===String(R.currentTemplateId||"")):null)?.config||R.initialConfigForSelectedTemplate;!Z||typeof Z!="object"||["generate_title","generate_content"].forEach(Q=>{if(!Object.prototype.hasOwnProperty.call(Z,Q))return;let fe=_.elements[Q];if(!fe)return;let Ae=Z[Q];fe.checked=Ae==="1"||Ae===1||Ae===!0})})(),C&&H&&Array.from(C.options).some(D=>D.value==="one-time")&&C.value!=="one-time"&&(C.value="one-time");let G=!1;if(b==="rss"){let R=document.getElementById("aipkit_cw_rss_items_count");G=R&&parseInt(R.value,10)>0}let J=u?.dataset?.aipkitCwAction||"generate";if(y?J=!v&&E?"upgrade":"update":(M||(J="generate"),!W&&$&&(J="upgrade")),!y&&b==="rss"&&W?G?J==="fetch_feeds"&&(J="generate"):J="fetch_feeds":J==="fetch_feeds"&&(J="generate"),!y&&J==="create_task"&&!W&&(J="generate"),!y&&W&&J!=="generate"&&J!=="create_task"&&J!=="fetch_feeds"&&(J="generate"),u&&(u.dataset.aipkitCwAction=J),x.forEach(R=>{let D=R.dataset.action||"generate",Z=!M||$&&!v||y;D==="create_task"&&(R.hidden=Z);let Q=D===J;R.classList.toggle("is-active",Q),R.setAttribute("aria-checked",Q?"true":"false")}),w){let R=W&&!y&&!(b==="rss"&&!G);w.style.display=R?"":"none",w.disabled=!R}h&&(h.dataset.keepOpen==="true"||(h.hidden=!0),h.dataset.keepOpen="false"),u&&u.classList.toggle("is-single",!W||b==="rss"&&!G);let q={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",fetch_feeds:"Fetch Feeds",update:"Update"}[J]||"Generate";if(f?f.textContent=q:p&&(typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(p,q):p.textContent=q),p&&(p.dataset.action=J,y||(p.removeAttribute("aria-disabled"),p.dataset.aipkitExistingDisabled&&(p.disabled=!1,delete p.dataset.aipkitExistingDisabled))),g)if(J==="create_task"&&C&&!H){let R=C.options[C.selectedIndex],D=R?R.text:"";D?(g.textContent=` / ${D}`,g.hidden=!1):(g.textContent="",g.hidden=!0)}else g.textContent="",g.hidden=!0;if(m&&(m.hidden=y,m.setAttribute("aria-hidden",y?"true":"false"),y&&m.setAttribute("aria-expanded","false")),typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0);return}p?.dataset?.aipkitStopMode==="true"&&typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),typeof window.aipkit_cw_resetBatchQueue=="function"&&(J!=="generate"||!M)&&window.aipkit_cw_resetBatchQueue()}let e={task:{label:"Manual Entry",icon:"dashicons-edit"},csv:{label:"Import CSV",icon:"dashicons-media-spreadsheet"},rss:{label:"RSS Feed",icon:"dashicons-rss"},url:{label:"Website URL",icon:"dashicons-admin-links"},gsheets:{label:"Google Sheets",icon:"dashicons-analytics"},existing:{label:"Update Content",icon:"dashicons-update"},"existing-content":{label:"Update Content",icon:"dashicons-update"},"existing-images":{label:"Optimize Images",icon:"dashicons-format-image"},"existing-products":{label:"Optimize Products",icon:"dashicons-cart"}};function t(d){if(!d){console.error("Content Writer Mode: Scope element not provided for initialization.");return}let _=d.querySelector("#aipkit_cw_mode_select"),p=Array.from(d.querySelectorAll(".aipkit_cw_mode_card")),f=Array.from(d.querySelectorAll(".aipkit_cw_bulk_source_tab")),g=Array.from(d.querySelectorAll("[data-aipkit-bulk-source-panel]")),m=d.querySelector(".aipkit_cw_tab_content_container"),u=d.querySelector("[data-aipkit-source-selector]"),w=u?.querySelector("[data-aipkit-source-trigger]"),h=u?.querySelector(".aipkit_cw_source_menu"),C=h?Array.from(h.querySelectorAll(".aipkit_cw_source_option")):[],x=w?.querySelector("[data-source-label]"),v=w?.querySelector("[data-source-icon]");if(!_||!m){console.warn("Content Writer Mode: Mode selector or content container not found within the provided scope.");return}let L=A=>{p.length&&p.forEach(M=>{let $=M.dataset.mode===A;M.classList.toggle("is-active",$),M.setAttribute("aria-pressed",$?"true":"false")})},P=A=>{!f.length||!g.length||(f.forEach(M=>{let $=M.dataset.source===A;M.classList.toggle("is-active",$),M.setAttribute("aria-pressed",$?"true":"false")}),g.forEach(M=>{let $=M.dataset.aipkitBulkSourcePanel===A;M.classList.toggle("is-hidden",!$),M.hidden=!$,M.setAttribute("aria-hidden",$?"false":"true")}))},b=A=>{if(!C.length)return;let M=i(A),$=r(M);C.forEach(H=>{let N=H.dataset.source===M;H.classList.toggle("is-active",N),H.setAttribute("aria-selected",N?"true":"false")});let W=e[M]||e.task;if(x&&(x.dataset.defaultLabel||(x.dataset.defaultLabel=x.textContent||""),x.textContent=$?W.label:x.dataset.defaultLabel),v){let H=v.querySelector(".dashicons");if(H&&!v.dataset.defaultIcon){let N=H.className.split(" ").find(G=>G!=="dashicons");v.dataset.defaultIcon=N||"dashicons-plus-alt2"}if(H){let N=$?W.icon:v.dataset.defaultIcon||"dashicons-plus-alt2";H.className="dashicons "+N}v.dataset.sourceIcon=$?M:"more"}w&&w.classList.toggle("is-active",$)},y=(A=!1)=>{if(!h||!w)return;let M=w.getAttribute("aria-expanded")==="true",$=A||M;w.setAttribute("aria-expanded",$?"false":"true"),h.hidden=$},S=A=>{let M=o(A),$=i(M),W=$.startsWith("existing")?"existing":$;_.value!==M&&(_.value=M),m.querySelectorAll(".aipkit_cw_tab_content").forEach(H=>{H.classList.toggle("aipkit_active",H.dataset.pane===W)}),L($),P(M==="csv"?"csv":"task"),b($),c($)};_.addEventListener("change",function(A){S(A.target.value)}),w&&w.addEventListener("click",A=>{A.stopPropagation(),y()}),C.length&&C.forEach(A=>{A.addEventListener("click",()=>{let M=A.dataset.source||"task";_.value!==M&&(_.value=M,_.dispatchEvent(new Event("change",{bubbles:!0}))),y(!0)})}),document.addEventListener("click",A=>{u&&!u.contains(A.target)&&y(!0)}),document.addEventListener("keydown",A=>{A.key==="Escape"&&h&&!h.hidden&&(y(!0),w?.focus())}),p.length&&p.forEach(A=>{A.dataset.listenerAttached||(A.addEventListener("click",()=>{let M=A.dataset.mode||"task";_.value!==M&&(_.value=M,_.dispatchEvent(new Event("change",{bubbles:!0})))}),A.dataset.listenerAttached="true")}),f.length&&f.forEach(A=>{A.dataset.listenerAttached||(A.addEventListener("click",()=>{let $=(A.dataset.source||"task")==="csv"?"csv":"task";_.value!==$&&(_.value=$,_.dispatchEvent(new Event("change",{bubbles:!0})))}),A.dataset.listenerAttached="true")});let E=_.value||"task";S(E==="single"?"task":E)}window.aipkit_initContentWriterTabs=t,window.aipkit_updateContentWriterActionState=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(m){return String(m||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},o=["keyword","title","excerpt","content","meta","tags"],r={keyword:"Focus keyword",title:"Title",excerpt:"Excerpt",content:"Content",meta:"Meta description",tags:"Tags",slug:"URL"},a={"existing-content":{fieldOrder:o,fieldLabels:r,postTypeOverride:"",allowMeta:!0,allowTags:!0,allowSlug:!0},"existing-images":{fieldOrder:["keyword","title","excerpt","content"],fieldLabels:{keyword:"Alt text",title:"Image title",excerpt:"Caption",content:"Description"},postTypeOverride:"attachment",allowMeta:!1,allowTags:!1,allowSlug:!1,useImageMetadataPrompts:!0},"existing-products":{fieldOrder:o,fieldLabels:r,postTypeOverride:"product",allowMeta:!0,allowTags:!0,allowSlug:!0}},s=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}"],l=["{price}","{regular_price}","{sale_price}","{sku}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{product_categories}"],c={title:["{original_title}"],content:["{original_content}","{short_description}"],meta:["{original_title}","{short_description}","{original_content}"],keyword:["{original_title}","{original_content}"],excerpt:["{short_description}","{original_content}","{original_excerpt}"],tags:["{original_content}","{attributes}","{product_categories}"]},n=["{file_name}","{original_title}","{original_alt}","{original_caption}","{original_description}"],e=["Generate product titles, descriptions, and SEO fields.","Use product data like price, SKU, and attributes.","Bulk optimize selected products."],t={short:2e3,medium:4e3,long:6e3},d=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,_=window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.aipkit_dashboard.upgradeUrl:"",p=2400;function f(m=1){if(typeof window.aipkit_cw_existing_handleFetch=="function"){window.aipkit_cw_existing_handleFetch(m);return}window.aipkit_cw_existing_pendingFetch=m}function g(m){if(!m)return;let u=m.querySelector("[data-aipkit-existing-panel]");if(!u||u.dataset.init==="true")return;let w=u.querySelector("#aipkit_cw_existing_post_type"),h=u.querySelector("#aipkit_cw_existing_post_status"),C=u.querySelector("#aipkit_cw_existing_media_filter"),x=u.querySelector("#aipkit_cw_existing_search"),v=u.querySelector("#aipkit_cw_existing_refresh"),L=u.querySelector("#aipkit_cw_existing_select_all"),P=u.querySelector("#aipkit_cw_existing_posts_body"),b=u.querySelector("#aipkit_cw_existing_page_status"),y=u.querySelector("#aipkit_cw_existing_page_prev"),S=u.querySelector("#aipkit_cw_existing_page_next"),E=u.querySelector("#aipkit_cw_existing_selected_count"),A=document.getElementById("aipkit_content_writer_generate_btn")||u.querySelector("#aipkit_cw_existing_open_assistant"),M=document.getElementById("aipkit_cw_mode_select");if(!P)return;let $=document.getElementById("aipkit_content_writer_nonce"),W=10,H=1,N=1,G=null,J=!1,F=!1,q=!1,O=[],R=new Set,D=new Map,Z=w?w.value:"",Q=!1,fe=A?A.querySelector(".aipkit_btn-text"):null,Ae=A&&A.dataset.action||"generate",We=_e=>_e?_e==="existing"?"existing-content":_e.indexOf("existing-")===0?_e:"":"",Ge=()=>We(M?M.value:""),it=()=>a[Ge()]||a["existing-content"],_t=()=>!!Ge(),mt=document.getElementById("aipkit_content_writer_form_status"),Ot="",Nt=null,Ie=()=>{Nt&&(clearTimeout(Nt),Nt=null)},qt=(_e,be)=>{mt&&(Ie(),mt.textContent=_e||"",mt.className="aipkit_cw_status_badge",be==="info"?mt.classList.add("aipkit_settings_message-info"):be==="error"?mt.classList.add("aipkit_settings_message-error"):be==="success"&&mt.classList.add("aipkit_settings_message-success"),_e?mt.dataset.cwUpdateStatus="1":delete mt.dataset.cwUpdateStatus)},Wt=()=>{F&&(q=!0,qt("Stopping...","info"))},ui=()=>{mt&&(Ie(),Nt=setTimeout(()=>{mt.dataset.cwUpdateStatus==="1"&&qt("","")},4e3))},ae=_e=>{if(!mt){Ot="";return}if(!_e){mt.dataset.cwProNotice==="1"&&(!Ot||mt.textContent.startsWith(Ot))&&(mt.textContent="",mt.className="aipkit_cw_status_badge"),delete mt.dataset.cwProNotice,Ot="";return}let be=_?` <a class="aipkit_popover_upgrade_link" href="${k(_)}" target="_blank" rel="noopener noreferrer">Upgrade</a>`:"";Ot=_e,mt.dataset.cwProNotice="1",mt.className="aipkit_cw_status_badge aipkit_settings_message-info",mt.innerHTML=`${k(_e)}${be}`};if(w&&!d){let _e=w.querySelector('option[value="product"]');_e&&!_e.dataset.proLabel&&(_e.dataset.proLabel=_e.textContent||"Products")}let Ce=_e=>{Q=!!_e,A&&(A.dataset.action=Q?"upgrade":Ae,fe&&_t()&&(fe.textContent=Q?"Upgrade":"Update"))},Le=_e=>{let be=[],Pe=[];return _e.forEach(At=>{let et=O.find(Lt=>Number(Lt.id)===At);et&&et.type==="product"?be.push(At):Pe.push(At)}),{productIds:be,otherIds:Pe}},Oe=()=>{if(!_t()||Ge()!=="existing-content"){Ce(!1),ae("");return}if(d){Ce(!1),ae("");return}let _e=Array.from(R),{productIds:be,otherIds:Pe}=Le(_e);if(w&&w.value==="product"){Ce(!0);return}if(be.length&&!Pe.length){Ce(!0);return}if(be.length&&Pe.length){Ce(!1);return}Ce(!1),ae("")},$e=_e=>{P&&(P.innerHTML=`
        <tr class="aipkit_cw_existing_empty">
          <td colspan="7">${k(_e)}</td>
        </tr>
      `,He())},He=()=>{let _e=R.size;if(Oe(),E&&(E.textContent=`${_e} selected`),A&&_t()){let be=Q?F:_e===0||F;A.disabled=be,A.setAttribute("aria-disabled",be?"true":"false"),be?A.dataset.aipkitExistingDisabled="true":delete A.dataset.aipkitExistingDisabled}if(L){let be=O.length>0&&O.every(Pe=>R.has(Pe.id));L.checked=be}},je=()=>{b&&(b.textContent=`Page ${H} of ${N}`),y&&(y.disabled=H<=1),S&&(S.disabled=H>=N)},Qe=(_e,be)=>{if(O=Array.isArray(_e)?_e:[],H=be?.page||1,N=be?.total_pages||1,!O.length){$e("No posts found."),je(),He();return}let Pe=Ge()==="existing-images",At=O.map(et=>{let Lt=Number(et.id),fi=k(et.title||"(Untitled)"),Vt=k(et.edit_link||"#"),hi=k(et.type_label||""),mi=k(et.status_label||""),Bi=Pe?k(et.alt_text||""):"",gi=Pe?k(et.caption||""):"",ti=Pe?k(et.description||""):"",ji=Pe?k(et.thumb_url||""):"",Me=R.has(Lt)?"checked":"",pi=k(et.type||"post"),Hi=fi?` title="${fi}"`:"",En=Bi?` title="${Bi}"`:"",Do=gi?` title="${gi}"`:"",Ao=ti?` title="${ti}"`:"",Wo=ji?`<span class="aipkit_cw_existing_thumb"><img src="${ji}" alt="" loading="lazy"></span>`:'<span class="aipkit_cw_existing_thumb aipkit_cw_existing_thumb--empty" aria-hidden="true"></span>',gn=Pe?`
                <div class="aipkit_cw_existing_title_stack">
                  ${Wo}
                  <div class="aipkit_cw_existing_title_meta">
                    <a class="row-title aipkit_cw_existing_truncate" href="${Vt}" target="_blank" rel="noopener noreferrer"${Hi}>${fi}</a>
                    <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                  </div>
                </div>
              `:`
                <div class="aipkit_cw_existing_title_inline">
                  <a class="row-title aipkit_cw_existing_truncate" href="${Vt}" target="_blank" rel="noopener noreferrer"${Hi}>${fi}</a>
                  <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                </div>
              `;return`
            <tr id="post-${Lt}" data-post-type="${pi}">
              <td class="aipkit_cw_existing_col_check">
                <input type="checkbox" class="aipkit_cw_existing_row_checkbox" value="${Lt}" ${Me}>
              </td>
              <td class="aipkit_cw_existing_title">
                ${gn}
              </td>
              <td class="aipkit_cw_existing_col_type">${hi}</td>
              <td class="aipkit_cw_existing_col_status">${mi}</td>
              <td class="aipkit_cw_existing_col_alt"><span class="aipkit_cw_existing_truncate"${En}>${Bi}</span></td>
              <td class="aipkit_cw_existing_col_caption"><span class="aipkit_cw_existing_truncate"${Do}>${gi}</span></td>
              <td class="aipkit_cw_existing_col_description"><span class="aipkit_cw_existing_truncate"${Ao}>${ti}</span></td>
            </tr>
          `}).join("");P.innerHTML=At,je(),He()},xt=_e=>{let be=String(_e||"").trim();return be||"(Untitled)"},bi=(_e,be)=>{let Pe=u.querySelector(`#post-${_e}`);if(!Pe)return;let At=Pe.querySelector(".row-title");if(!At)return;let et=xt(be);At.textContent=et,At.setAttribute("title",et);let Lt=O.find(fi=>Number(fi.id)===_e);Lt&&(Lt.title=et)},gt=(_e,be,Pe)=>{let At=u.querySelector(`#post-${_e}`);if(!At)return;let et="",Lt="";if(be==="keyword")et=".aipkit_cw_existing_col_alt .aipkit_cw_existing_truncate",Lt="alt_text";else if(be==="excerpt")et=".aipkit_cw_existing_col_caption .aipkit_cw_existing_truncate",Lt="caption";else if(be==="content")et=".aipkit_cw_existing_col_description .aipkit_cw_existing_truncate",Lt="description";else return;let fi=At.querySelector(et);if(!fi)return;let Vt=String(Pe||"").trim();fi.textContent=Vt,Vt?fi.setAttribute("title",Vt):fi.removeAttribute("title");let hi=O.find(mi=>Number(mi.id)===_e);hi&&Lt&&(hi[Lt]=Vt)},It=_e=>{let be=D.get(_e);be&&(clearTimeout(be),D.delete(_e))},ze=(_e,be,Pe)=>{let At=u.querySelector(`#post-${_e}`);if(!At)return;let et=At.querySelector(".aipkit_cw_existing_status");if(et){if(It(_e),et.classList.remove("is-visible","is-error","is-success","is-processing","is-queued"),!Pe){et.textContent="";return}et.textContent=Pe,et.classList.add("is-visible"),be==="error"&&et.classList.add("is-error"),be==="success"&&et.classList.add("is-success"),be==="processing"&&et.classList.add("is-processing"),be==="queued"&&et.classList.add("is-queued")}},Ye=_e=>ze(_e,"",""),Ze=_e=>{It(_e);let be=setTimeout(()=>Ye(_e),p);D.set(_e,be)},ei=_e=>{if(F=_e,A&&_t()){let be=A.dataset&&A.dataset.aipkitStopMode==="true",Pe=Q?_e:R.size===0||_e&&!be;A.disabled=Pe,A.setAttribute("aria-disabled",Pe?"true":"false"),Pe?A.dataset.aipkitExistingDisabled="true":delete A.dataset.aipkitExistingDisabled}if(v&&(v.disabled=_e),w){let be=it();w.disabled=_e||!!be.postTypeOverride}h&&(h.disabled=_e),x&&(x.disabled=_e),y&&(y.disabled=_e||H<=1),S&&(S.disabled=_e||H>=N),L&&(L.disabled=_e),P.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(be=>{be.disabled=_e})},ci=()=>{let _e=it();w&&(_e.postTypeOverride?(w.value=_e.postTypeOverride,w.disabled=!0):(w.disabled=!1,w.value=Z||"")),h&&_e.postTypeOverride==="attachment"&&(h.value="")},Jt=_e=>{!A||!_t()||A.dataset&&A.dataset.aipkitStopMode==="true"||(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(A,_e,"Update","Updating..."):A.disabled=_e)},Gt=(_e,be)=>{let Pe=`${be}_update`,At=_e&&_e[Pe]||_e&&_e[be]||"";return String(At||"").trim()},Di=_e=>{let be=document.getElementById("aipkit_content_writer_form");if(!be||typeof window.aipkit_getContentWriterFormConfig!="function")return{error:"Content Writer form is not ready yet."};let Pe=window.aipkit_getContentWriterFormConfig(be),At=!!_e.useImageMetadataPrompts;if(!d&&_e.postTypeOverride==="product")return{error:"Optimize Products is a Pro feature. Upgrade to continue."};let et=Me=>At?Me==="title"?Pe.generate_image_title==="1":Me==="keyword"?Pe.generate_image_alt_text==="1":Me==="excerpt"?Pe.generate_image_caption==="1":Me==="content"?Pe.generate_image_description==="1":!1:Me==="meta"&&!_e.allowMeta||Me==="tags"&&!_e.allowTags?!1:Me==="title"?Pe.generate_title!=="0":Me==="content"?Pe.generate_content!=="0":Me==="meta"?Pe.generate_meta_description==="1":Me==="keyword"?Pe.generate_focus_keyword==="1":Me==="excerpt"?Pe.generate_excerpt==="1":Me==="tags"?Pe.generate_tags==="1":!1,Lt=At?{title:et("title")?Gt(Pe,"image_title_prompt"):"",content:et("content")?Gt(Pe,"image_description_prompt"):"",meta:"",keyword:et("keyword")?Gt(Pe,"image_alt_text_prompt"):"",excerpt:et("excerpt")?Gt(Pe,"image_caption_prompt"):"",tags:""}:{title:et("title")?Gt(Pe,"custom_title_prompt"):"",content:et("content")?Gt(Pe,"custom_content_prompt"):"",meta:et("meta")?Gt(Pe,"custom_meta_prompt"):"",keyword:et("keyword")?Gt(Pe,"custom_keyword_prompt"):"",excerpt:et("excerpt")?Gt(Pe,"custom_excerpt_prompt"):"",tags:et("tags")?Gt(Pe,"custom_tags_prompt"):""},fi=[],Vt=Me=>_e.fieldLabels?.[Me]||r[Me]||Me;if(et("title")&&!Lt.title&&fi.push(`${Vt("title")} prompt is required.`),et("content")&&!Lt.content&&fi.push(`${Vt("content")} prompt is required.`),et("meta")&&!Lt.meta&&fi.push(`${Vt("meta")} prompt is required.`),et("keyword")&&!Lt.keyword&&fi.push(`${Vt("keyword")} prompt is required.`),et("excerpt")&&!Lt.excerpt&&fi.push(`${Vt("excerpt")} prompt is required.`),et("tags")&&!Lt.tags&&fi.push(`${Vt("tags")} prompt is required.`),fi.length)return{error:fi.join(" ")};let hi=[],mi=(Me,pi)=>pi.some(Hi=>Me.includes(Hi)),Bi=Me=>At?n:_e.postTypeOverride==="product"&&c[Me]||s;if(_e.fieldOrder.forEach(Me=>{let pi=Lt[Me];if(!pi)return;let Hi=Bi(Me);mi(pi,Hi)||hi.push(`${Vt(Me)} prompt: add one of ${Hi.join(", ")}.`)}),hi.length)return{error:`${At?"Image optimization":_e.postTypeOverride==="product"?"Product update":"Update"} works best when prompts include source placeholders.

${hi.join(`
`)}`};let gi=String(Pe.content_length||"medium"),ti=t[gi]||t.medium,ji={ai_provider:Pe.ai_provider||"openai",ai_model:Pe.ai_model||"",temperature:parseFloat(Pe.ai_temperature||"1"),max_tokens:ti,reasoning_effort:Pe.reasoning_effort||"",generate_seo_slug:_e.allowSlug&&Pe.generate_seo_slug||"0",enable_vector_store:Pe.enable_vector_store||"0",vector_store_provider:Pe.vector_store_provider||"openai",vector_store_top_k:Pe.vector_store_top_k||"3",openai_vector_store_ids:Pe.openai_vector_store_ids||[],pinecone_index_name:Pe.pinecone_index_name||"",qdrant_collection_name:Pe.qdrant_collection_name||"",vector_embedding_provider:Pe.vector_embedding_provider||"",vector_embedding_model:Pe.vector_embedding_model||""};return{prompts:Lt,baseConfig:ji}},bt=(_e,be,Pe)=>({[_e]:{prompt:be},ai_provider:Pe.ai_provider,ai_model:Pe.ai_model,temperature:Pe.temperature,max_tokens:Pe.max_tokens,reasoning_effort:Pe.reasoning_effort,enable_vector_store:Pe.enable_vector_store,vector_store_provider:Pe.vector_store_provider,vector_store_top_k:Pe.vector_store_top_k,openai_vector_store_ids:Pe.openai_vector_store_ids,pinecone_index_name:Pe.pinecone_index_name,qdrant_collection_name:Pe.qdrant_collection_name,vector_embedding_provider:Pe.vector_embedding_provider,vector_embedding_model:Pe.vector_embedding_model}),di=async(_e=1)=>{if(!J){if(typeof window.aipkit_apiRequest!="function"){console.error("Content Writer Existing: aipkit_apiRequest not found.");return}J=!0,$e("Loading posts...");try{let Pe=it().postTypeOverride||(w?w.value:""),At=await window.aipkit_apiRequest("aipkit_content_writer_fetch_existing_posts",{_ajax_nonce:$?$.value:"",post_type:Pe,post_status:h?h.value:"",media_filter:C?C.value:"",search:x?x.value.trim():"",paged:_e,per_page:W});Qe(At.posts||[],At.pagination||{})}catch(be){console.error("Content Writer Existing: fetch failed",be),$e("Unable to load posts. Please try again.")}finally{J=!1}}},Ht=()=>{R.clear(),He()};P.addEventListener("change",_e=>{let be=_e.target;if(!be||!be.classList.contains("aipkit_cw_existing_row_checkbox"))return;let Pe=Number(be.value||0);Pe&&(be.checked?R.add(Pe):R.delete(Pe),He())}),L&&L.addEventListener("change",()=>{let _e=L.checked;O.forEach(Pe=>{_e?R.add(Number(Pe.id)):R.delete(Number(Pe.id))}),P.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Pe=>{Pe.checked=_e}),He()}),y&&y.addEventListener("click",()=>{H>1&&di(H-1)}),S&&S.addEventListener("click",()=>{H<N&&di(H+1)}),v&&v.addEventListener("click",()=>{Ht(),di(1)}),w&&w.addEventListener("change",()=>{it().postTypeOverride||(Z=w.value),Ht(),di(1)}),h&&h.addEventListener("change",()=>{Ht(),di(1)}),C&&C.addEventListener("change",()=>{Ht(),di(1)}),x&&x.addEventListener("input",()=>{G&&clearTimeout(G),G=setTimeout(()=>{Ht(),di(1)},300)});let Wi=_e=>{typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(_e,{title:"Update existing"}):alert(_e)},Sn=()=>{let _e="Bulk image optimization is available on Pro. Select one image or upgrade.";if(typeof window.aipkit_showAlertModal=="function"){let be=[];_&&be.push({label:"Upgrade to Pro",href:_,className:"aipkit_btn aipkit_btn-primary"}),be.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(_e,{title:"Optimize Images",actions:be})}else alert(_e)},Ki=()=>{let _e="Optimize Products is a Pro feature.";if(typeof window.aipkit_showAlertModal=="function"){let be=[];_&&be.push({label:"Upgrade to Pro",href:_,className:"aipkit_btn aipkit_btn-primary"}),be.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(_e,{title:"Optimize Products",bullets:e,actions:be})}else alert(_e)},ln=async(_e,be,Pe,At,et)=>{let Lt=`cw-existing-${_e}-${Date.now()}`,fi=!1;if(q)return ze(_e,"","Stopped"),Ze(_e),{success:!1,stopped:!0};for(let Vt of et.fieldOrder){let hi=be[Vt];if(!hi)continue;if(q)return ze(_e,"","Stopped"),Ze(_e),{success:!1,stopped:!0};ze(_e,"processing",`Updating ${et.fieldLabels[Vt]||Vt}...`);let mi=bt(Vt,hi,Pe),Bi={_ajax_nonce:At,post_id:_e,field:Vt,enhancements:JSON.stringify(mi),conversation_uuid:Lt};try{let gi=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",Bi,{timeout:18e4});gi&&Object.prototype.hasOwnProperty.call(gi,"updated_value")&&(Vt==="title"?bi(_e,gi.updated_value):gt(_e,Vt,gi.updated_value)),fi=!0}catch(gi){let ti=gi&&gi.message||"Update failed. Please try again.";return ze(_e,"error",ti),{success:!1}}}if(q)return ze(_e,"","Stopped"),Ze(_e),{success:!1,stopped:!0};if(Pe.generate_seo_slug==="1"&&fi){ze(_e,"processing","Updating URL...");try{await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",{_ajax_nonce:At,post_id:_e,action_type:"update_slug"},{timeout:3e4})}catch{return ze(_e,"error","URL update failed."),{success:!1}}}return fi?(ze(_e,"success","Updated"),Ze(_e),{success:!0}):(ze(_e,"error","No prompts selected."),{success:!1})},Vn=async()=>{if(F||!_t())return;let _e=Array.from(R);if(!_e.length)return;if(!d&&Ge()==="existing-content"){let{productIds:ti,otherIds:ji}=Le(_e);if(ti.length&&!ji.length){Ki(),He();return}ti.length&&ji.length&&(ti.forEach(Me=>{ze(Me,"error","Skipped (Pro)"),Ze(Me)}),_e=ji)}if(!_e.length){He();return}if(!d&&Ge()==="existing-images"&&_e.length>1){Sn();return}if(typeof window.aipkit_apiRequest!="function"){Wi("Update service is not available yet.");return}let be=window.aipkit_post_enhancer?.nonce_generate_title;if(!be){Wi("Update permission is missing. Please reload the page.");return}let Pe=it(),{prompts:At,baseConfig:et,error:Lt}=Di(Pe);if(Lt){!d&&Pe.postTypeOverride==="product"?Ki():Wi(Lt);return}if(!Pe.fieldOrder.some(ti=>!!At[ti])){Wi("No prompts selected for update.");return}q=!1,_e.forEach(ti=>{ze(ti,"queued","Queued")});let Vt=0,hi=0,mi=_e.length,Bi=null,gi=()=>{let ti=[];return ti.push(`Updating ${mi} item${mi===1?"":"s"}...`),Vt&&ti.push(`${Vt} done`),hi&&ti.push(`${hi} error${hi===1?"":"s"}`),ti.join(" ")};qt(gi(),"info"),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):Jt(!0),ei(!0);for(let ti=0;ti<_e.length;ti+=1){let ji=_e[ti];if(q){Bi=ti;break}let Me=await ln(ji,At,et,be,Pe);if(Me&&Me.stopped){q=!0,Bi=ti+1;break}Me&&Me.success?Vt+=1:hi+=1,qt(gi(),"info")}if(ei(!1),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():Jt(!1),q){(Bi!==null?_e.slice(Bi):[]).forEach(Me=>{ze(Me,"","Stopped"),Ze(Me)});let ji=[`Update stopped: ${Vt} done`];hi&&ji.push(`${hi} error${hi===1?"":"s"}`),qt(ji.join(", ")+".","info")}else hi?qt(`Update complete: ${Vt} done, ${hi} error${hi===1?"":"s"}.`,"error"):qt(`Update complete: ${Vt} done.`,"success");ui(),He()};u.dataset.init="true",window.aipkit_cw_existing_handleFetch=di,window.aipkit_runContentWriterExistingUpdate=Vn,window.aipkit_cw_isExistingUpdateActive=()=>F,window.aipkit_cw_requestExistingUpdateStop=Wt,M&&!M.dataset.aipkitExistingListener&&(M.addEventListener("change",()=>{C&&(C.value=""),ci(),Ht()},!0),M.dataset.aipkitExistingListener="true"),ci(),window.aipkit_cw_existing_pendingFetch&&(di(window.aipkit_cw_existing_pendingFetch),window.aipkit_cw_existing_pendingFetch=null)}window.aipkit_initContentWriterExistingContent=g,window.aipkit_fetchContentWriterExistingPosts=f})();(function(){"use strict";let k=[{key:"custom_title_prompt",textareaId:"aipkit_cw_custom_title_prompt",updateInputId:"aipkit_cw_custom_title_prompt_update"},{key:"custom_content_prompt",textareaId:"aipkit_cw_custom_content_prompt",updateInputId:"aipkit_cw_custom_content_prompt_update"},{key:"custom_meta_prompt",textareaId:"aipkit_cw_custom_meta_prompt",updateInputId:"aipkit_cw_custom_meta_prompt_update"},{key:"custom_keyword_prompt",textareaId:"aipkit_cw_custom_keyword_prompt",updateInputId:"aipkit_cw_custom_keyword_prompt_update"},{key:"custom_excerpt_prompt",textareaId:"aipkit_cw_custom_excerpt_prompt",updateInputId:"aipkit_cw_custom_excerpt_prompt_update"},{key:"custom_tags_prompt",textareaId:"aipkit_cw_custom_tags_prompt",updateInputId:"aipkit_cw_custom_tags_prompt_update"},{key:"image_prompt",textareaId:"aipkit_cw_image_prompt",updateInputId:"aipkit_cw_image_prompt_update"},{key:"featured_image_prompt",textareaId:"aipkit_cw_featured_image_prompt",updateInputId:"aipkit_cw_featured_image_prompt_update"},{key:"image_title_prompt",textareaId:"aipkit_cw_image_title_prompt",updateInputId:"aipkit_cw_image_title_prompt_update"},{key:"image_alt_text_prompt",textareaId:"aipkit_cw_image_alt_text_prompt",updateInputId:"aipkit_cw_image_alt_text_prompt_update"},{key:"image_caption_prompt",textareaId:"aipkit_cw_image_caption_prompt",updateInputId:"aipkit_cw_image_caption_prompt_update"},{key:"image_description_prompt",textareaId:"aipkit_cw_image_description_prompt",updateInputId:"aipkit_cw_image_description_prompt_update"}],o={create:{},update:{}},r={},i=[],a="create",s=!1,l=m=>m&&m!=="single"?m:"task",c=()=>{let m=document.getElementById("aipkit_cw_mode_select");return l(m?.value||"task")},n=m=>m&&m.indexOf("existing")===0?"update":"create",e=(m,u,w)=>{if(w)return String(m||"");let h=String(m||"").trim()?m:u||"";return String(h||"")},t=()=>{if(s)return;let m=a==="update";i.forEach(({key:u,textarea:w,updateInput:h})=>{if(!w)return;let C=w.value||"";if(!m){o.create[u]=C;return}r[u]&&(o.update[u]=C,h&&(h.value=C))})},d=()=>{s=!0;let m=a==="update";i.forEach(({key:u,textarea:w,updateInput:h})=>{if(!w)return;let C=o.create[u]||"",x=o.update[u]||"",v=!!r[u],L=m?e(x,C,v):C;w.value=L||"",m&&h&&(h.value=v?x:"")}),s=!1},_=m=>{let u=n(l(m));u!==a&&(t(),a=u,d())},p=m=>{!m||m.dataset.aipkitPromptModeInit==="true"||(i=k.map(u=>{let w=m.querySelector(`#${u.textareaId}`)||document.getElementById(u.textareaId),h=m.querySelector(`#${u.updateInputId}`)||document.getElementById(u.updateInputId);return{...u,textarea:w,updateInput:h}}),i.some(u=>u.textarea)&&(i.forEach(u=>{let w=u.textarea&&u.textarea.value||"";o.create[u.key]=w;let h=u.updateInput&&u.updateInput.value||"";o.update[u.key]=h,r[u.key]=!!h,u.textarea&&!u.textarea.dataset.aipkitPromptModeListener&&(u.textarea.addEventListener("input",()=>{if(s)return;let C=u.textarea.value||"";a==="update"?(o.update[u.key]=C,r[u.key]=!0,u.updateInput&&(u.updateInput.value=C)):o.create[u.key]=C}),u.textarea.dataset.aipkitPromptModeListener="true")}),m.dataset.aipkitPromptModeInit="true",_(c())))},f=m=>{if(!m||typeof m!="object")return;let u=w=>Object.prototype.hasOwnProperty.call(m,w);i.forEach(w=>{let h=w.key,C=`${h}_update`;if(u(h)&&(o.create[h]=m[h]||""),u(C)){let x=m[C]||"";o.update[h]=x,r[h]=!!x,w.updateInput&&(w.updateInput.value=r[h]?x:"")}}),d()},g=()=>({create:{...o.create},update:{...o.update}});window.aipkit_initContentWriterPromptModeManager=p,window.aipkit_setContentWriterPromptMode=_,window.aipkit_applyContentWriterPromptSets=f,window.aipkit_getContentWriterPromptSets=g})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"],image_title:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_alt_text:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_caption:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_description:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"]},o=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}","{price}","{regular_price}","{sale_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{total_sales}","{product_categories}"],r={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},i={existing:{title:["{original_title}","{original_content}","{original_focus_keyword}"],content:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],meta:["{original_title}","{original_content}","{original_focus_keyword}","{original_tags}","{categories}"],keyword:["{original_title}","{original_content}"],excerpt:["{original_title}","{original_content}","{original_excerpt}"],tags:["{original_title}","{original_content}","{original_tags}","{categories}"],image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],featured_image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"]},"existing-images":{title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],content:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],excerpt:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],keyword:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_alt_text:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_caption:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_description:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],featured_image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"]},"existing-products":{title:o,content:o,meta:o,keyword:o,excerpt:o,tags:o}},a={aipkit_cw_image_title_prompt:"image_title",aipkit_cw_image_alt_text_prompt:"image_alt_text",aipkit_cw_image_caption_prompt:"image_caption",aipkit_cw_image_description_prompt:"image_description"},s=_=>String(_??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),l=()=>{let p=document.getElementById("aipkit_cw_mode_select")?.value||"task";return p==="single"&&(p="task"),p},c=(_,p)=>{let f=window.aipkit_content_writer_config?.default_prompts||{};if(p==="existing-images"){let g=`${_}_update`;if(f[g])return f[g]}return f[_]||""},n=(_,p)=>{let f=i[p]||(p.indexOf("existing")===0?i.existing:null);if(f&&f[_])return f[_];let g=k[_]||[],m=r[p]||[],u=[...g,...m];return u.filter((w,h)=>u.indexOf(w)===h)},e=(_,p)=>{if(!_)return;let f=_.dataset.label||"Variables:",g=_.dataset.copyTitle||"Click to copy";_.innerHTML=`${s(f)} `,p.forEach((m,u)=>{let w=document.createElement("code");w.className="aipkit-placeholder",w.title=g,w.textContent=m,_.appendChild(w),u<p.length-1&&_.appendChild(document.createTextNode(" "))})},t=_=>{let p=_?.querySelector(".aipkit_cw_prompt_editor_placeholders");if(!p)return;let f=p.dataset.promptType||"",g=l(),m=n(f,g);e(p,m)};function d(_){if(!_)return;let p=_.querySelectorAll("[data-aipkit-flyout-target]");if(!p.length)return;let f=_.querySelectorAll(".aipkit_cw_prompt_library_select"),g=b=>{f.length&&f.forEach(y=>{let S=y.getAttribute("data-aipkit-prompt-target"),E=a[S];if(!E)return;let A=y.options?y.options[0]:null;if(!A)return;if(Array.from(y.options).forEach(($,W)=>{let H=$.dataset.aipkitMode||"both",N=!0;W!==0&&(b==="existing-images"?N=H!=="create":N=H!=="update"),$.hidden=!N}),y.dataset.aipkitDefaultCreate||(y.dataset.aipkitDefaultCreate=A.value||""),b==="existing-images"){let $=c(E,b);$&&(y.dataset.aipkitDefaultUpdate=$,A.value=$)}else A.value=y.dataset.aipkitDefaultCreate||A.value||"";y.selectedOptions.length&&y.selectedOptions[0].hidden&&(y.selectedIndex=0)})},m=null,u=null,w=!1,h=b=>b?_.querySelector(`#${b}`):null,C=(b,y,S)=>{if(!b||!y)return;let E=b.getBoundingClientRect(),A=S?S.getBoundingClientRect():E,M=y.getBoundingClientRect(),$=M.width||440,W=M.height||0,H=window.innerWidth,N=window.innerHeight,G=12,J=A.left-$-10;J<G&&(J=A.right+10),J=Math.max(G,Math.min(J,H-$-G));let F=A.top;F+W>N-G&&(F=N-W-G),F=Math.max(G,F),m.style.left=`${Math.round(J)}px`,m.style.top=`${Math.round(F)}px`},x=()=>{!u||!m||w||(w=!0,window.requestAnimationFrame(()=>{let b=m.querySelector(".aipkit_cw_prompt_panel"),y=u.closest(".aipkit_model_settings_popover_panel");C(u,b,y),w=!1}))},v=()=>{m&&(m.classList.remove("is-open"),m.setAttribute("aria-hidden","true"),u&&u.setAttribute("aria-expanded","false"),m=null,u=null)},L=b=>{let y=b.getAttribute("data-aipkit-flyout-target"),S=h(y);if(!S)return;m&&m!==S&&v(),m=S,u=b,S.classList.add("is-open"),S.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true"),t(S);let E=S.querySelector(".aipkit_cw_prompt_panel"),A=b.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{C(b,E,A)})};p.forEach(b=>{b.dataset.flyoutListenerAttached!=="true"&&(b.addEventListener("click",y=>{if(y.preventDefault(),m&&u===b&&m.classList.contains("is-open")){v();return}L(b)}),b.dataset.flyoutListenerAttached="true")});let P=l();if(g(P),f.forEach(b=>{let y=b.getAttribute("data-aipkit-prompt-target"),S=y?_.querySelector(`#${y}`):null;S&&typeof S.value=="string"&&S.value.trim()===""&&b.value&&(S.value=b.value),b.dataset.promptLibraryAttached!=="true"&&(b.addEventListener("change",()=>{let E=b.value;if(!E)return;let A=b.getAttribute("data-aipkit-prompt-target"),M=A?_.querySelector(`#${A}`):null;if(!M)return;M.value=E,M.dispatchEvent(new Event("input",{bubbles:!0})),typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave();let $=b.options?b.options[0]:null;$&&$.value===""&&(b.value="",b.selectedIndex=0)}),b.dataset.promptLibraryAttached="true")}),_.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(b=>{b.dataset.overlayListenerAttached!=="true"&&(b.addEventListener("click",S=>{S.target===b&&v()}),b.dataset.overlayListenerAttached="true");let y=b.querySelector(".aipkit_popover_flyout_close");y&&y.dataset.flyoutListenerAttached!=="true"&&(y.addEventListener("click",S=>{S.preventDefault(),v()}),y.dataset.flyoutListenerAttached="true")}),_.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",b=>{b.key==="Escape"&&m&&v()}),_.dataset.promptFlyoutEscapeAttached="true"),_.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",b=>{if(!m)return;let y=b.target;y.closest(".aipkit_cw_prompt_flyout")||y.closest("[data-aipkit-flyout-target]")||v()}),_.dataset.promptFlyoutClickAttached="true"),_.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",x),window.addEventListener("scroll",x,!0),_.dataset.promptFlyoutRepositionAttached="true"),_.dataset.promptFlyoutModeAttached!=="true"){let b=document.getElementById("aipkit_cw_mode_select");b&&b.addEventListener("change",()=>{g(l()),m&&t(m)}),_.dataset.promptFlyoutModeAttached="true"}window.aipkit_closeContentWriterPromptFlyout=v}window.aipkit_initContentWriterPromptFlyouts=d})();(function(){"use strict";let r=l=>String(l||"").replace(/\|/g," ").replace(/\r?\n/g," ").trim(),i=l=>{let c=String(l||"").trim();if(!c)return{value:"",raw:""};let n=c.match(/^(\d{4}-\d{2}-\d{2})(?:[T\s])(\d{2}:\d{2})(?::\d{2})?$/);return n?{value:`${n[1]}T${n[2]}`,raw:""}:{value:"",raw:c}},a=l=>l?l.replace("T"," ").trim():"";function s(l){let c=l||document.getElementById("aipkit_content_writer_container");if(!c)return;let n=c.querySelector("[data-aipkit-bulk-editor]");if(!n||n.dataset.bulkEditorAttached==="true")return;let e=n.querySelector("[data-aipkit-bulk-rows]"),t=n.querySelector("#aipkit_cw_bulk_row_template"),d=n.querySelector("#aipkit_cw_bulk_topics"),_=n.querySelector(".aipkit_cw_bulk_add_row"),p=n.querySelector(".aipkit_cw_bulk_toggle_raw"),f=n.querySelector("#aipkit_cw_bulk_raw"),g=n.querySelector(".aipkit_cw_bulk_grid"),m=n.querySelector(".aipkit_cw_bulk_toggle_details");if(!e||!t||!d)return;let u=!1,w,h=($,W)=>$?$.querySelector(`[data-bulk-field="${W}"]`):null,C=()=>{Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")).forEach((W,H)=>{let N=W.querySelector(".aipkit_cw_bulk_row_number");N&&(N.textContent=H+1)})},x=$=>{let W=r(h($,"topic")?.value||""),H=r(h($,"keywords")?.value||""),N=r(h($,"category")?.value||""),G=r(h($,"author")?.value||""),J=r(h($,"type")?.value||""),F=h($,"schedule")?.value||"";return F?(F=a(F),$.dataset.rawSchedule=""):$.dataset.rawSchedule&&(F=$.dataset.rawSchedule),{topic:W,keywords:H,category:N,author:G,type:J,schedule:F}},v=($,W)=>{if(!$||!W)return;let H=(G,J)=>{let F=h($,G);F&&(F.value=J||"")};H("topic",W.topic||""),H("keywords",W.keywords||""),H("category",W.category||""),H("author",W.author||""),H("type",W.type||"");let N=h($,"schedule");if(N){let G=i(W.schedule||"");N.value=G.value,$.dataset.rawSchedule=G.raw||""}},L=()=>{let $=Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")),W=[];return $.forEach(H=>{let{topic:N,keywords:G,category:J,author:F,type:q,schedule:O}=x(H);if(!N)return;let R=[N,G,J,F,q,O],D=-1;R.forEach((Z,Q)=>{Z&&(D=Q)}),D!==-1&&W.push(R.slice(0,D+1).join(" | "))}),W.join(`
`)},P=()=>{d&&(u=!0,d.value=L(),d.dispatchEvent(new Event("change",{bubbles:!0})),u=!1)},b=$=>{n.classList.toggle("is-details-open",$),m&&m.setAttribute("aria-expanded",$?"true":"false")},y=$=>{if(f){if(n.classList.toggle("is-raw-open",$),f.hidden=!$,p){p.setAttribute("aria-expanded",$?"true":"false");let W=$?p.dataset.labelGrid:p.dataset.labelRaw;if(W){let H=p.querySelector(".aipkit_cw_toggle_label");H?H.textContent=W:p.textContent=W}}g&&(g.hidden=$),_&&(_.hidden=$,_.disabled=$),m&&(m.hidden=$,$&&m.setAttribute("aria-expanded","false"))}},S=$=>{let H=document.importNode(t.content,!0).querySelector("[data-aipkit-bulk-row]");return H?(v(H,$||{}),H):null},E=()=>{let $=e.querySelectorAll("[data-aipkit-bulk-row]");if($.length>=1)return;let W=1-$.length;for(let H=0;H<W;H++){let N=S();N&&e.appendChild(N)}},A=()=>{let $=Array.from(e.querySelectorAll("[data-aipkit-bulk-row]")),W=$[$.length-1];if(!W)return;let H=x(W);if(Object.values(H).some(G=>G)&&$.length<100){let G=S();G&&(e.appendChild(G),C())}},M=()=>{let W=(d.value||"").split(/\r?\n/).filter(N=>N.trim()!=="");e.innerHTML="";let H=[];if(W.slice(0,100).forEach(N=>{let G=N.split("|").map(q=>q.trim()),J={topic:G[0]||"",keywords:G[1]||"",category:G[2]||"",author:G[3]||"",type:G[4]||"",schedule:G[5]||""},F=S(J);F&&H.push(F)}),!H.length){E(),C(),P();return}H.forEach(N=>e.appendChild(N)),E(),C()};d.value.trim()?M():(E(),C(),P()),y(!f.hidden),m&&!m.dataset.listenerAttached&&(m.addEventListener("click",$=>{$.preventDefault();let W=n.classList.contains("is-details-open");b(!W)}),m.dataset.listenerAttached="true",b(!1)),e.addEventListener("input",$=>{let W=$.target;!W||!W.closest("[data-aipkit-bulk-row]")||(P(),A())}),e.addEventListener("change",$=>{let W=$.target;!W||!W.closest("[data-aipkit-bulk-row]")||(P(),A())}),e.addEventListener("click",$=>{let W=$.target.closest(".aipkit_cw_bulk_remove_row");if(!W)return;let H=W.closest("[data-aipkit-bulk-row]");if(!H)return;e.querySelectorAll("[data-aipkit-bulk-row]").length<=1?H.querySelectorAll("input, select").forEach(G=>{G.value=""}):H.remove(),P(),C(),A()}),_&&_.addEventListener("click",$=>{if($.preventDefault(),e.querySelectorAll("[data-aipkit-bulk-row]").length>=100)return;let H=S();H&&e.appendChild(H),C()}),p&&f&&p.addEventListener("click",$=>{$.preventDefault();let W=!f.hidden;y(!W)}),d.addEventListener("input",()=>{u||(clearTimeout(w),w=setTimeout(()=>{M()},250))}),n.dataset.bulkEditorAttached="true"}window.aipkit_initContentWriterBulkEditor=s})();(function(){"use strict";let k=null,o=0;function r(){if(!k)return;let s=k;k=null,s.classList.remove("aipkit-active"),s.__aipkitAlertKeydown&&(document.removeEventListener("keydown",s.__aipkitAlertKeydown),s.__aipkitAlertKeydown=null);let l=()=>{s.parentNode&&s.parentNode.removeChild(s)};s.addEventListener("transitionend",l,{once:!0}),window.setTimeout(l,250)}function i(s,l={}){let c=l.title||"Notice",n=l.okText||"OK",e=l.okClass||"aipkit_btn-primary",t=Array.isArray(l.actions)?l.actions:null,d=Array.isArray(l.bullets)?l.bullets:null;k&&r();let _=document.createElement("div");_.className="aipkit-modal-overlay",_.addEventListener("click",L=>{L.target===_&&r()});let p=`aipkit_cw_alert_${Date.now()}_${o++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${p}_title`);let g=document.createElement("div");g.className="aipkit-modal-header";let m=document.createElement("h3");m.className="aipkit-modal-title",m.id=`${p}_title`,m.textContent=c;let u=document.createElement("button");u.type="button",u.className="aipkit-modal-close-btn",u.setAttribute("aria-label","Close"),u.textContent="\xD7",g.appendChild(m),g.appendChild(u);let w=document.createElement("div");w.className="aipkit-modal-body";let h=document.createElement("p");if(h.className="aipkit_cw_alert_modal_message",h.textContent=s||"",d&&d.length){let L=document.createElement("ul");L.className="aipkit_cw_alert_modal_list",d.forEach(P=>{let b=document.createElement("li");b.textContent=P,L.appendChild(b)}),w.appendChild(h),w.appendChild(L)}else w.appendChild(h);let C=document.createElement("div");C.className="aipkit_cw_alert_modal_actions";let x=null;if(t&&t.length)t.forEach((L,P)=>{let b=!!(L&&L.href),y=L?.label||(P===0?n:"Close"),S=L?.className||(P===0?"aipkit_btn aipkit_btn-primary":"aipkit_btn aipkit_btn-secondary"),E=document.createElement(b?"a":"button");E.className=S,E.textContent=y,b?(E.href=L.href,E.target=L.target||"_blank",E.rel=L.rel||"noopener noreferrer"):E.type="button";let A=()=>{typeof L?.onClick=="function"&&L.onClick(),L?.closeOnClick!==!1&&r()};E.addEventListener("click",A),C.appendChild(E),x||(x=E)});else{let L=document.createElement("button");L.type="button",L.className=`aipkit_btn ${e}`,L.textContent=n,L.addEventListener("click",r),C.appendChild(L),x=L}w.appendChild(C),f.appendChild(g),f.appendChild(w),_.appendChild(f),document.body.appendChild(_);let v=L=>{L.key==="Escape"&&r()};_.__aipkitAlertKeydown=v,document.addEventListener("keydown",v),u.addEventListener("click",r),window.requestAnimationFrame(()=>{_.classList.add("aipkit-active"),x&&x.focus()}),k=_}function a(s,l={}){let c=l.title||"Confirm",n=l.confirmText||"Confirm",e=l.cancelText||"Cancel",t=typeof l.onConfirm=="function"?l.onConfirm:null,d=typeof l.onCancel=="function"?l.onCancel:null;k&&r();let _=document.createElement("div");_.className="aipkit-modal-overlay",_.addEventListener("click",P=>{P.target===_&&(r(),d&&d())});let p=`aipkit_cw_confirm_${Date.now()}_${o++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${p}_title`);let g=document.createElement("div");g.className="aipkit-modal-header";let m=document.createElement("h3");m.className="aipkit-modal-title",m.id=`${p}_title`,m.textContent=c;let u=document.createElement("button");u.type="button",u.className="aipkit-modal-close-btn",u.setAttribute("aria-label","Close"),u.textContent="\xD7",g.appendChild(m),g.appendChild(u);let w=document.createElement("div");w.className="aipkit-modal-body";let h=document.createElement("p");h.className="aipkit_cw_alert_modal_message",h.textContent=s||"";let C=document.createElement("div");C.className="aipkit_cw_alert_modal_actions";let x=document.createElement("button");x.type="button",x.className="aipkit_btn aipkit_btn-secondary",x.textContent=e;let v=document.createElement("button");v.type="button",v.className="aipkit_btn aipkit_btn-primary",v.textContent=n,C.appendChild(x),C.appendChild(v),w.appendChild(h),w.appendChild(C),f.appendChild(g),f.appendChild(w),_.appendChild(f),document.body.appendChild(_);let L=P=>{P.key==="Escape"&&(r(),d&&d())};_.__aipkitAlertKeydown=L,document.addEventListener("keydown",L),u.addEventListener("click",()=>{r(),d&&d()}),x.addEventListener("click",()=>{r(),d&&d()}),v.addEventListener("click",()=>{r(),t&&t()}),window.requestAnimationFrame(()=>{_.classList.add("aipkit-active"),v.focus()}),k=_}window.aipkit_showAlertModal=i,window.aipkit_showConfirmModal=a,window.aipkit_closeAlertModal=r})();(function(){"use strict";function k(o,r){if(!o||!r||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(o.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(o,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(o,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary();else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let i=window.aipkit_escapeHtml||function(a){return a};r.innerHTML='<option value="">'+i("Models unavailable (Data Object Missing)")+"</option>",r.disabled=!0}}window.aipkit_handleProviderModelDropdowns=k})();(function(){"use strict";function k(o){if(!o){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let r=document.getElementById("aipkit_content_writer_temperature_value");r?o.dataset.listenerAttached||(o.addEventListener("input",()=>r.textContent=o.value),o.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=k})();(function(){"use strict";function k(o){if(!o){console.warn("Copy Button Handler: Button element not provided.");return}o.dataset.listenerAttached||(o.addEventListener("click",()=>{let r=document.getElementById("aipkit_cw_generated_title_display"),i=document.getElementById("aipkit_cw_generated_content_area"),a="";r&&r.style.display!=="none"&&(a+=r.textContent+`

`),i&&(a+=i.innerText),a.trim()&&navigator.clipboard.writeText(a.trim()).then(()=>{let s=o.querySelector(".dashicons");if(s){let l=s.className;s.className="dashicons dashicons-yes",setTimeout(()=>{s.className=l},1500)}}).catch(s=>console.error("Failed to copy: ",s))}),o.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_single_output_wrapper"),i=document.getElementById("aipkit_cw_output_card"),a=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.querySelector(".aipkit_content_writer_output_actions"),c=document.getElementById("aipkit_cw_status_display_container"),n=document.getElementById("aipkit_cw_generated_title_display"),e=document.getElementById("aipkit_cw_meta_chunk"),t=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),d=document.getElementById("aipkit_cw_generated_meta_desc"),_=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),p=document.getElementById("aipkit_cw_generated_focus_keyword"),f=document.getElementById("aipkit_cw_excerpt_output_wrapper"),g=document.getElementById("aipkit_cw_generated_excerpt"),m=document.getElementById("aipkit_cw_tags_output_wrapper"),u=document.getElementById("aipkit_cw_generated_tags"),w=document.getElementById("aipkit_cw_image_data_holder"),h=document.getElementById("aipkit_content_writer_copy_btn"),C=document.getElementById("aipkit_content_writer_clear_btn");if(r&&(r.style.display="none"),i&&(i.style.display="none"),a&&s){s.classList.remove("is-streaming");let x=s.closest(".aipkit_cw_output_chunk--primary");x&&x.classList.remove("has-overflow"),s.innerHTML="",a.scrollTop=0,l&&(l.style.display="none"),h&&(h.disabled=!0),C&&(C.disabled=!0),typeof window.aipkit_resetContentWriterRawHtml=="function"&&window.aipkit_resetContentWriterRawHtml(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction();let v=document.getElementById("aipkit_content_writer_form_status");v&&(v.textContent=""),c&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():c&&(c.style.display="none"),n&&(n.style.display="none",n.textContent=""),e&&(e.style.display="none"),t&&(t.style.display="none"),d&&(d.value=""),_&&(_.style.display="none"),p&&(p.value=""),f&&(f.style.display="none"),g&&(g.value=""),m&&(m.style.display="none"),u&&(u.value=""),w&&(w.value=""),typeof window.aipkit_updateMetaCountBadge=="function"&&window.aipkit_updateMetaCountBadge(),typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_resetContentWriterPreviewCounter=="function"&&window.aipkit_resetContentWriterPreviewCounter()}}function o(r,i){if(!r){console.warn("Clear Button Handler: Button element not provided.");return}r.dataset.listenerAttached||(r.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),r.dataset.listenerAttached="true")}window.aipkit_handleClearButton=o,window.aipkit_clearContentWriterOutput=k})();(function(){"use strict";function k(){return document.getElementById("aipkit_cw_expand_preview_btn")}function o(e){return e?e.closest(".aipkit_cw_output_chunk--primary"):document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_chunk--primary")}function r(e,t,d){return e?t==="restore"?e.dataset.labelRestore||d:e.dataset.labelExpand||d:d}function i(e,t){if(!e)return;let d=e.querySelector(".aipkit_cw_expand_label"),_=e.querySelector(".dashicons"),p=t?r(e,"restore","Restore preview"):r(e,"expand","Expand preview");d&&(d.textContent=p),e.setAttribute("title",p),e.setAttribute("aria-pressed",t?"true":"false"),_&&(_.classList.toggle("dashicons-fullscreen-alt",!t),_.classList.toggle("dashicons-fullscreen-exit-alt",t))}function a(e){let t=document.getElementById("aipkit_content_writer_output_display");!t||!e||(t.scrollHeight>t.clientHeight?e.classList.add("has-overflow"):e.classList.remove("has-overflow"))}function s(e){let t=k(),d=o(t);!t||!d||(e?d.classList.add("is-expanded"):d.classList.remove("is-expanded"),i(t,e),requestAnimationFrame(()=>a(d)))}function l(e){let t=k();t&&(t.disabled=!e,t.setAttribute("aria-disabled",e?"false":"true"),e||s(!1))}function c(){s(!1)}function n(){document.body?.dataset?.aipkitPreviewToggleAttached!=="true"&&(document.addEventListener("click",e=>{let t=e.target.closest("#aipkit_cw_expand_preview_btn");if(!t||t.disabled)return;let d=o(t);if(!d)return;let _=d.classList.contains("is-expanded");s(!_)}),document.body&&(document.body.dataset.aipkitPreviewToggleAttached="true"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n(),window.aipkit_resetContentWriterPreviewSize=c,window.aipkit_setContentWriterPreviewExpandEnabled=l})();(function(){"use strict";let k=u=>!u||typeof u!="object"?"":u.media_library_url||u.url||u.src||u.image_url||u.preview_url||"",o=u=>u==null?"":String(u).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=()=>{if(typeof window.aipkit_getContentWriterRawHtml=="function")return window.aipkit_getContentWriterRawHtml()||"";let u=document.getElementById("aipkit_cw_generated_content_area");return u?u.innerHTML:""},i=()=>{let u=document.getElementById("aipkit_cw_generated_content_area");if(!u)return;let w=r();w&&(u.innerHTML=w)},a=()=>({preview:document.getElementById("aipkit_cw_image_preview"),featuredWrap:document.getElementById("aipkit_cw_featured_image"),featuredImg:document.getElementById("aipkit_cw_featured_image_img"),inlineToggle:document.getElementById("aipkit_cw_inline_images_toggle"),inlineCount:document.getElementById("aipkit_cw_inline_images_count"),inlineGrid:document.getElementById("aipkit_cw_inline_images_grid")}),s=(u,w,h="")=>{u&&(u.hidden=!w,w?u.style.display=h||"":u.style.display="none")},l=u=>{u&&(u.innerHTML="",s(u,!1,"grid"))},c=()=>{let u=a();u.preview&&(u.featuredImg&&u.featuredImg.removeAttribute("src"),s(u.featuredWrap,!1,"flex"),u.inlineToggle&&(u.inlineToggle.setAttribute("aria-expanded","false"),u.inlineToggle.classList.remove("is-open")),u.inlineCount&&(u.inlineCount.textContent="0"),l(u.inlineGrid),s(u.inlineToggle,!1,"inline-flex"),s(u.preview,!1,"flex"),i())},n=u=>{!u.inlineToggle||!u.inlineGrid||u.inlineToggle.dataset.listenerAttached!=="true"&&(u.inlineToggle.addEventListener("click",()=>{let w=u.inlineToggle.getAttribute("aria-expanded")==="true";u.inlineToggle.setAttribute("aria-expanded",w?"false":"true"),u.inlineToggle.classList.toggle("is-open",!w),s(u.inlineGrid,!w,"grid")}),u.inlineToggle.dataset.listenerAttached="true")},e=(u,w)=>{if(!u.inlineToggle||!u.inlineGrid||!w.length)return!1;l(u.inlineGrid);let h=document.createDocumentFragment();return w.forEach((C,x)=>{let v=document.createElement("div");v.className="aipkit_cw_inline_image";let L=document.createElement("img");L.src=C,L.alt=`Generated image ${x+1}`,L.loading="lazy",L.decoding="async",v.appendChild(L),h.appendChild(v)}),u.inlineGrid.appendChild(h),s(u.inlineGrid,!1,"grid"),s(u.inlineToggle,!0,"inline-flex"),u.inlineToggle.setAttribute("aria-expanded","false"),u.inlineToggle.classList.remove("is-open"),u.inlineCount&&(u.inlineCount.textContent=String(w.length)),n(u),!0},t=(u,w,h)=>{let C=k(u);if(!C)return"";let x=u.alt||u.revised_prompt||u.caption||"Image",v=[];return["left","right","center","none"].includes(w)&&v.push(`align${w}`),v.push(`size-${h||"large"}`),`<img class="${o(v.join(" "))}" src="${o(C)}" alt="${o(x)}" loading="lazy" decoding="async" />`},d=(u,w)=>w.length?`${u}

${w.join(`

`)}`:u,_=(u,w,h)=>{if(!w.length)return u;let C=w.shift(),x=u.toLowerCase(),v=`</${h}>`,L=x.indexOf(v);return L!==-1?u=u.slice(0,L+v.length)+`

${C}

`+u.slice(L+v.length):u+=`

${C}`,d(u,w)},p=(u,w,h,C)=>{if(!w.length)return u;if(!C||C<=0)return d(u,w);let x=u.split(new RegExp(`(</${h}>)`,"ig")),v="",L=0,P=0;for(let b=0;b<x.length;b+=1)v+=x[b],b%2===1&&(L+=1,L%C===0&&P<w.length&&(v+=`

${w[P]}

`,P+=1));for(;P<w.length;)v+=`

${w[P]}`,P+=1;return v},f=u=>{let w=document.getElementById("aipkit_cw_generated_content_area");if(!w)return;let h=Array.isArray(u?.in_content_images)?u.in_content_images:[];if(!h.length){i();return}let C=r();if(C||(C=w.innerHTML),!C)return;let x=document.getElementById("aipkit_content_writer_form"),v=u?.placement_settings?.placement||x?.elements.image_placement?.value||"after_first_h2",L=u?.placement_settings?.param_x||x?.elements.image_placement_param_x?.value||2,P=parseInt(L,10)||2,b=x?.elements.image_alignment?.value||"none",y=x?.elements.image_size?.value||"large",S=h.map(A=>t(A,b,y)).filter(Boolean);if(!S.length){i();return}let E=C;switch(v){case"after_first_h2":E=_(E,S,"h2");break;case"after_first_h3":E=_(E,S,"h3");break;case"after_every_x_h2":E=p(E,S,"h2",P);break;case"after_every_x_h3":E=p(E,S,"h3",P);break;case"after_every_x_p":E=p(E,S,"p",P);break;case"at_end":default:E=d(E,S);break}w.innerHTML=E,typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()},g=(u,w)=>!u.featuredWrap||!u.featuredImg||!w?!1:(u.featuredImg.src=w,s(u.featuredWrap,!0,"flex"),!0),m=u=>{let w=a();if(!w.preview)return;c();let h=u;if(typeof u=="string")try{h=JSON.parse(u)}catch{return}if(!h||typeof h!="object")return;let x=(Array.isArray(h.in_content_images)?h.in_content_images:[]).map(k).filter(Boolean),v=h.featured_image_url||k(h.featured_image)||k(h.featured_image_data),L=g(w,v),P=e(w,x);f(h),(L||P)&&s(w.preview,!0,"flex")};window.aipkit_renderContentWriterImagePreview=m,window.aipkit_clearContentWriterImagePreview=c})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let i=r.elements.generate_meta_description,a=r.elements.generate_focus_keyword,s=r.elements.generate_excerpt,l=r.elements.generate_tags,c=r.querySelector(".aipkit_cw_prompt_row--meta"),n=r.querySelector(".aipkit_cw_prompt_row--keyword"),e=r.querySelector(".aipkit_cw_prompt_row--excerpt"),t=r.querySelector(".aipkit_cw_prompt_row--tags"),d=!!(i&&i.checked),_=!!(a&&a.checked),p=!!(s&&s.checked),f=!!(l&&l.checked),g=(u,w)=>{if(!u)return;u.classList.toggle("aipkit_popover_option_row--disabled",!w);let h=u.querySelector(".aipkit_cw_prompt_trigger");h&&(h.disabled=!w,h.setAttribute("aria-disabled",w?"false":"true"))};g(c,d),g(n,_),g(e,p),g(t,f);let m=r.querySelector(".aipkit_cw_prompt_flyout.is-open");if(m){let u=[];d||u.push("aipkit_cw_meta_prompt_flyout"),_||u.push("aipkit_cw_keyword_prompt_flyout"),p||u.push("aipkit_cw_excerpt_prompt_flyout"),f||u.push("aipkit_cw_tags_prompt_flyout"),u.includes(m.id)&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout()}}function o(){let r=document.getElementById("aipkit_content_writer_form");if(!r||r.dataset.optionToggleListenerAttached)return;let i=r.elements.generate_meta_description,a=r.elements.generate_focus_keyword,s=r.elements.generate_excerpt,l=r.elements.generate_tags;i&&i.addEventListener("change",k),a&&a.addEventListener("change",k),s&&s.addEventListener("change",k),l&&l.addEventListener("change",k),r.dataset.optionToggleListenerAttached="true",k()}window.aipkit_cw_toggleCustomOptionPrompts=k,window.aipkit_cw_initOptionPromptToggles=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.warn("Prompt Toggle Handler: Content writer container not found.");return}o.querySelectorAll(".aipkit_textarea_toggle").forEach(a=>{let s=a.dataset.target;if(!s)return;let l=`aipkit-cw-prompt-${s}-state`,c=localStorage.getItem(l),n=document.getElementById(s),e=a.querySelector(".dashicons");n&&e&&(c==="expanded"?(n.classList.remove("aipkit_collapsed"),e.classList.remove("dashicons-plus-alt2"),e.classList.add("dashicons-minus"),a.title="Collapse"):(n.classList.add("aipkit_collapsed"),e.classList.remove("dashicons-minus"),e.classList.add("dashicons-plus-alt2"),a.title="Expand"))});let i="data-prompt-toggle-listener-attached";o.getAttribute(i)||(o.addEventListener("click",function(a){let s=a.target.closest(".aipkit_textarea_toggle");if(!s)return;let l=s.dataset.target,c=document.getElementById(l),n=s.querySelector(".dashicons");if(!c||!n){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",s);return}let e=c.classList.toggle("aipkit_collapsed");e?(n.classList.remove("dashicons-minus"),n.classList.add("dashicons-plus-alt2"),s.title="Expand"):(n.classList.remove("dashicons-plus-alt2"),n.classList.add("dashicons-minus"),s.title="Collapse");let t=`aipkit-cw-prompt-${l}-state`;localStorage.setItem(t,e?"collapsed":"expanded")}),o.setAttribute(i,"true"))}window.aipkit_initPromptToggles=k})();(function(){"use strict";let k="";function o(_){k=typeof _=="string"?_:""}function r(){return k||""}function i(){k=""}function a(){let _=document.getElementById("aipkit_cw_meta_chunk");if(!_)return;let p=!1;_.querySelectorAll(".aipkit_cw_meta_field").forEach(g=>{window.getComputedStyle(g).display!=="none"&&(p=!0)}),_.style.display=p?"block":"none"}function s(){let _=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");_&&(_.style.display="flex")}function l(){let _=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");_&&(_.style.display="none")}function c(){let _=document.getElementById("aipkit_cw_article_counter"),p=document.getElementById("aipkit_cw_generated_content_area");if(!_||!p)return;if(p.querySelector(".aipkit_spinner")){_.textContent="",_.hidden=!0;return}let g=(p.textContent||"").trim(),m=g?g.split(/\s+/).length:0;if(!m){_.textContent="",_.hidden=!0;return}let u=m===1?"word":"words";_.textContent=`${m} ${u}`,_.hidden=!1}function n(){let _=document.getElementById("aipkit_cw_generated_content_area");if(!_)return;let p=!1,f=()=>{p||(p=!0,window.requestAnimationFrame(()=>{p=!1,c()}))};new MutationObserver(()=>{f()}).observe(_,{childList:!0,subtree:!0,characterData:!0}),f()}function e(){let _=document.getElementById("aipkit_cw_generated_meta_desc"),p=document.querySelector("#aipkit_content_writer_container .aipkit_cw_meta_char_count");if(!_||!p)return;function f(){let g=_.value.length,m=g>=120&&g<=160;p.textContent=`${g}/160`,p.style.color=m?"#16a34a":g>160?"#dc2626":"#94a3b8"}_.addEventListener("input",f),f()}function t(){if(!document.getElementById("aipkit_cw_meta_chunk"))return;let p=new MutationObserver(function(g){g.forEach(function(m){m.type==="attributes"&&m.attributeName==="style"&&a()})});["aipkit_cw_excerpt_output_wrapper","aipkit_cw_tags_output_wrapper","aipkit_cw_focus_keyword_output_wrapper","aipkit_cw_meta_desc_output_wrapper"].forEach(g=>{let m=document.getElementById(g);m&&p.observe(m,{attributes:!0,attributeFilter:["style"]})})}function d(){e(),t(),n()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d):d(),window.aipkit_updateMetaChunkVisibility=a,window.aipkit_showPrimaryAction=s,window.aipkit_hidePrimaryAction=l,window.aipkit_updateContentWriterPreviewCounter=c,window.aipkit_setContentWriterRawHtml=o,window.aipkit_getContentWriterRawHtml=r,window.aipkit_resetContentWriterRawHtml=i,window.aipkit_resetContentWriterPreviewCounter=function(){let _=document.getElementById("aipkit_cw_article_counter");_&&(_.textContent="",_.hidden=!0)}})();(function(){"use strict";function k(c){if(!c)return;let n=c.querySelector("#aipkit_content_writer_provider"),e=c.querySelector("#aipkit_content_writer_model"),t=c.querySelector(".aipkit_cw_reasoning_effort_field"),d=c.querySelector("#aipkit_content_writer_reasoning_effort");if(!n||!e||!t||!d){t&&(t.style.display="none");return}let _=(n.value||"").toLowerCase(),f=(e.value||"").toLowerCase();_==="openai"&&r(f)?(t.classList.contains("aipkit_popover_option_row")||t.classList.contains("aipkit_ai_behavior_control")?t.style.display="flex":t.style.display="block",o(c,f)):t.style.display="none"}function o(c,n){let e=c.querySelector("#aipkit_content_writer_reasoning_effort"),t=c.querySelectorAll(".aipkit_ai_reasoning_option");if(!e||!t.length)return;let d=a(n),_=new Set(d.allowed);t.forEach(u=>{let w=u.querySelector(".aipkit_ai_reasoning_input");if(!w)return;let h=w.value==="minimal"?"low":w.value,C=_.has(h);u.style.display=C?"":"none",C||(w.checked=!1)});let p=e.value||"";p==="minimal"&&(p="low");let f=c.querySelector(".aipkit_ai_reasoning_input:checked");!_.has(p)&&f&&(p=f.value),_.has(p)||(p=d.defaultValue),_.has(p)||(p=d.allowed[0]||"");let g=e.value;p&&(e.value=p);let m=c.querySelector(`.aipkit_ai_reasoning_input[value="${p}"]`);if(m){m.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(w=>w.classList.remove("aipkit_ai_reasoning_option--selected"));let u=m.closest(".aipkit_ai_reasoning_option");u&&u.classList.add("aipkit_ai_reasoning_option--selected")}g!==e.value&&e.dispatchEvent(new Event("change",{bubbles:!0}))}function r(c){if(i(c))return!1;let n=c.startsWith("o1")||c.startsWith("o3")||c.startsWith("o4"),e=c.includes("gpt-5");return n||e}function i(c){return/(?:^|[-_])chat(?:[-_]|$)/.test(c)}function a(c){return l(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(c){let n=c.match(/gpt-5\.(\d+)/);if(n)return Number.parseInt(n[1],10)>=2;let e=c.match(/gpt-(\d+)/);return e?Number.parseInt(e[1],10)>=6:!1}function l(c){return/gpt-5(\.\d+)?-pro/.test(c)}window.aipkit_cw_toggleReasoningEffort=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(m){return m},o=["pexels_api_key","pixabay_api_key"],r={},i={},a="",s=!1,l=!1,c="";function n(m){o.forEach(u=>{let w=m.querySelector(`.aipkit_cw_stock_api_key[name="${CSS.escape(u)}"]`);r[u]=w?w.value.trim():"",i[u]=!1})}function e(m){let u=m.querySelector("#aipkit_cw_replicate_api_key");a=u?u.value.trim():"",s=!1}async function t(m){if(!m||!m.name)return;let u=m.name;if(!o.includes(u))return;let w=m.value.trim(),h=r[u]||"";if(w===h||i[u]||typeof window.aipkit_apiRequest!="function")return;let C=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,x=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,v=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;i[u]=!0,r[u]=w,C&&C("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[u]:w}),x&&x("Updated")}catch(L){r[u]=h,v&&v(`Error: ${L.message||"Failed to save."}`),console.error("Content Writer Stock Image Key Save Error:",L)}finally{i[u]=!1}}async function d(m){if(!m)return;let u=m.value.trim(),w=a||"";if(u===w||s||typeof window.aipkit_apiRequest!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,C=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,x=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;s=!0,a=u,h&&h("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:u}),C&&C("Updated"),_(u,!0)}catch(v){a=w,x&&x(`Error: ${v.message||"Failed to save."}`),console.error("Content Writer Replicate Key Save Error:",v)}finally{s=!1}}function _(m,u=!1){let w=(m||"").trim();if(!w||l||!u&&w===c||typeof window.aipkit_queueProviderSync!="function")return;let h=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,C=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,x=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;l=!0,h&&h("Syncing models..."),window.aipkit_queueProviderSync("Replicate",{silent:!0,targetSelectId:"aipkit_cw_image_model",propagateError:!0}).then(()=>{c=w,C&&C("Models synced!")}).catch(v=>{x&&x(`Error: ${v.message||"Sync failed."}`),console.error("Content Writer Replicate Sync Error:",v)}).finally(()=>{l=!1})}function p(m){let u=document.getElementById("aipkit_cw_image_model");if(!u)return;let w=window.aipkit_dashboard?.imageGeneratorModels;if(!w){console.error("Image models data not found in aipkit_dashboard object."),u.innerHTML='<option value="">Error: Models not loaded</option>';return}let h=w[m.toLowerCase()]||[],C=window.aipkit_cw_template_state?.pendingImageModelSelection,x=u.value,v=C||x;u.innerHTML="",h.length>0?(h.forEach(L=>{u.appendChild(new Option(L.name,L.id))}),u.querySelector(`option[value="${CSS.escape(v)}"]`)?u.value=v:u.options.length>0&&(u.selectedIndex=0)):u.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function f(){let m=document.getElementById("aipkit_content_writer_container");if(!m)return;let u=m.querySelector(".aipkit_cw_image_enable_toggle"),w=m.querySelector("#aipkit_cw_generate_featured_image"),h=m.querySelector("#aipkit_cw_image_placement"),C=m.querySelector("#aipkit_cw_image_provider"),x=document.getElementById("aipkit_content_writer_form"),v=x?x.classList.contains("aipkit_cw_mode_existing_images"):!1,L=m.querySelectorAll(".aipkit_cw_image_settings_container"),P=m.querySelector(".aipkit_cw_prompt_row--image"),b=m.querySelector(".aipkit_cw_prompt_row--featured"),y=m.querySelector(".aipkit_cw_image_metadata_chunk"),S=Array.from(m.querySelectorAll(".aipkit_cw_image_metadata_subtoggle")).map(Q=>{let fe=Q.closest(".aipkit_image_toggle_card");return{toggle:Q,button:fe?fe.querySelector(".aipkit_cw_image_metadata_prompt_btn"):null}});if(!u||!w)return;let E=Q=>Q?Q.closest(".aipkit_popover_option_row")||Q.closest(".aipkit_form-group"):null,A=(Q,fe)=>{Q&&(fe?Q.style.display=Q.classList.contains("aipkit_popover_option_row")?"flex":"block":Q.style.display="none")},M=u.checked,$=w.checked,W=M||$||v,H=C?C.value:"",N=H==="pexels"||H==="pixabay";L.forEach(Q=>{Q.style.display=W?"block":"none"});let G=M&&!N,J=$&&!N,F=(Q,fe)=>{if(!Q)return;Q.style.display="",Q.classList.toggle("aipkit_popover_option_row--disabled",!fe);let Ae=Q.querySelector(".aipkit_cw_prompt_trigger");Ae&&(Ae.disabled=!fe,Ae.setAttribute("aria-disabled",fe?"false":"true"))};F(P,G),F(b,J);let q=v||W;if(y&&(y.style.display=q?"block":"none"),y){let Q=y.querySelector(".aipkit_image_settings_chunk_header--collapsible"),fe=y.querySelector(".aipkit_image_settings_chunk_body--collapsible");if(Q&&fe){let Ae=v;Q.setAttribute("aria-expanded",Ae?"true":"false"),fe.setAttribute("aria-hidden",Ae?"false":"true")}}S.length>0&&S.forEach(({toggle:Q,button:fe})=>{let Ae=q&&Q.checked;fe&&(fe.disabled=!Ae,fe.setAttribute("aria-disabled",Ae?"false":"true"))});let O=m.querySelector(".aipkit_cw_prompt_flyout.is-open"),R=O?m.querySelector(`.aipkit_cw_image_metadata_prompt_btn[data-aipkit-flyout-target="${CSS.escape(O.id)}"]`):null,D=R?R.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_cw_image_metadata_subtoggle"):null,Z=D&&q?D.checked:!1;if(O&&(O.id==="aipkit_cw_image_prompt_flyout"&&!G||O.id==="aipkit_cw_featured_image_prompt_flyout"&&!J||D&&!Z&&["aipkit_cw_image_title_prompt_flyout","aipkit_cw_image_alt_text_prompt_flyout","aipkit_cw_image_caption_prompt_flyout","aipkit_cw_image_description_prompt_flyout"].includes(O.id))&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),W){let Q=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],fe=m.querySelector("#aipkit_cw_replicate_options"),Ae=m.querySelector("#aipkit_cw_pexels_options"),We=m.querySelector("#aipkit_cw_pixabay_options"),Ge=m.querySelector("#aipkit_cw_image_model_group");if(Q.forEach(_t=>{let mt=m.querySelector(_t),Ot=E(mt);A(Ot,M)}),h){let _t=m.querySelector(".aipkit_cw_image_placement_x_field");if(_t){let mt=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(h.value);A(_t,M&&mt)}}fe&&(fe.style.display=H==="replicate"?"block":"none"),Ae&&(Ae.style.display=N&&H==="pexels"?"block":"none"),We&&(We.style.display=N&&H==="pixabay"?"block":"none"),Ge&&(Ge.style.display=N?"none":"");let it=m.querySelector("#aipkit_cw_image_model_wrapper");if(it&&(it.style.display=N?"none":""),!N&&H&&p(H),H==="replicate"){let _t=m.querySelector("#aipkit_cw_replicate_api_key");_(_t?_t.value:"",!1)}}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}function g(){let m=document.getElementById("aipkit_content_writer_container");m&&(m.dataset.imageHandlerAttached||(n(m),e(m),m.addEventListener("change",function(u){let w=u.target;if(w&&w.matches(".aipkit_cw_stock_api_key")){t(w);return}if(w&&w.matches(".aipkit_cw_replicate_api_key")){d(w);return}w.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider, .aipkit_cw_image_metadata_subtoggle")&&f()}),m.addEventListener("click",function(u){let w=u.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!w)return;let h=w.getAttribute("aria-expanded")==="true",C=w.getAttribute("aria-controls"),x=C?document.getElementById(C):null;w.setAttribute("aria-expanded",h?"false":"true"),x&&x.setAttribute("aria-hidden",h?"true":"false")}),f(),m.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=g,window.aipkit_updateImageSettingsUI=f})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(c){return c};function o(c){if(!c)return;let n=c.querySelector(".aipkit_cw_vector_store_toggle"),e=c.querySelectorAll(".aipkit_cw_vector_store_settings_container");if(n&&e.length>0){let t=n.checked;e.forEach(d=>{d.style.display=t?"block":"none"}),t&&r(c)}}function r(c){if(!c)return;let n=c.querySelector(".aipkit_cw_vector_store_provider_select");if(!n)return;let e=n.value,t=c.querySelector(".aipkit_cw_vector_openai_field"),d=c.querySelector(".aipkit_cw_vector_pinecone_field"),_=c.querySelector(".aipkit_cw_vector_qdrant_field"),p=c.querySelector(".aipkit_cw_vector_embedding_config_row"),f=(g,m)=>{g&&(g.style.display=m?"block":"none")};if(f(t,e==="openai"),f(d,e==="pinecone"),f(_,e==="qdrant"),p){let g=e==="pinecone"||e==="qdrant";if(p.style.display=g?"block":"none",g){let m=p.querySelector(".aipkit_cw_vector_embedding_provider_select");m&&i(m.value)}}}function i(c){let n=document.getElementById("aipkit_cw_vector_embedding_model");if(!n)return;let t=(window.aipkit_dashboard?.embeddingModels||{})[c.toLowerCase()]||[],d=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";n.innerHTML=`<option value="">${k("-- Select Model --")}</option>`,t.length>0?(t.forEach(_=>{if(_&&_.id){let p=new Option(k(_.name||_.id),_.id);_.id===d&&(p.selected=!0),n.appendChild(p)}}),n.disabled=!1):(n.disabled=!0,n.innerHTML=`<option value="">${k("-- No models found --")}</option>`)}function a(c){if(!c)return;let n=c.getAttribute("aria-expanded")==="true",e=c.getAttribute("aria-controls"),t=document.getElementById(e);t&&(c.setAttribute("aria-expanded",!n),t.setAttribute("aria-hidden",n))}function s(c){if(!c)return;let n=document.getElementById(c.id+"_value");if(!n)return;let e=c.value;c.id==="aipkit_cw_vector_store_confidence_threshold"&&(e=e+"%"),n.textContent=e}function l(){let c=document.getElementById("aipkit_content_writer_container");if(!c||c.dataset.vectorSettingsHandlerAttached)return;c.addEventListener("change",function(e){let t=e.target;if(t.matches(".aipkit_cw_vector_store_toggle")){let d=t.closest(".aipkit_vector_settings_redesigned")||t.closest(".aipkit_popover_options_list")||c;o(d)}else if(t.matches(".aipkit_cw_vector_store_provider_select")){let d=t.closest(".aipkit_vector_settings_redesigned")||t.closest(".aipkit_cw_vector_store_settings_container")||c;r(d)}else t.matches(".aipkit_cw_vector_embedding_provider_select")&&i(t.value);typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),c.addEventListener("input",function(e){let t=e.target;t.matches(".aipkit_vector_slider")&&s(t)}),c.addEventListener("click",function(e){let d=e.target.closest(".aipkit_vector_settings_chunk_header--collapsible");d&&(e.preventDefault(),a(d))}),c.querySelectorAll(".aipkit_vector_settings_redesigned, .aipkit_popover_options_list").forEach(e=>{e.querySelector(".aipkit_cw_vector_store_toggle")&&o(e)}),c.querySelectorAll(".aipkit_vector_slider").forEach(e=>{s(e)}),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),c.dataset.vectorSettingsHandlerAttached="true"}window.aipkit_initContentWriterVectorSettings=l,window.aipkit_cw_toggleVectorSettingsContainer=o,window.aipkit_cw_toggleProviderSpecificFields=r,window.aipkit_cw_populateEmbeddingModelSelect=i})();(function(){"use strict";function k(c){if(!c)return;let n=c.querySelector("#aipkit_content_writer_post_status"),e=c.querySelector(".aipkit_post_smart_schedule_container");if(!n)return;let t=n.value==="publish";e&&(e.style.display=t?"block":"none"),t&&o(c)}function o(c){if(!c)return;let n=c.querySelector('input[name="schedule_mode"]:checked'),e=c.querySelector(".aipkit_post_smart_schedule_fields");if(!e)return;let t=n&&n.value==="smart";e.style.display=t?"flex":"none"}function r(c){if(!c)return;let n=c.getAttribute("aria-expanded")==="true",e=c.getAttribute("aria-controls"),t=document.getElementById(e);t&&(c.setAttribute("aria-expanded",!n),t.setAttribute("aria-hidden",n))}function i(c){if(!c)return;let n=c.querySelector("#aipkit_content_writer_post_status");n&&(n.addEventListener("change",()=>{k(c)}),k(c)),c.querySelectorAll('input[name="schedule_mode"]').forEach(t=>{t.addEventListener("change",()=>{o(c)})}),o(c)}function a(){document.addEventListener("click",c=>{let n=c.target.closest(".aipkit_post_settings_chunk_header--collapsible");if(n){c.preventDefault(),r(n);return}}),document.addEventListener("keydown",c=>{if(c.key!=="Enter"&&c.key!==" ")return;let n=c.target.closest(".aipkit_post_settings_chunk_header--collapsible");n&&(c.preventDefault(),r(n))})}function s(c){let n=c.target;if(!n||!n.id||n.id!=="aipkit_cw_post_settings_popover")return;let e=n.querySelector(".aipkit_post_settings_redesigned");e&&!e.dataset.postSettingsInitialized&&(i(e),e.dataset.postSettingsInitialized="true")}function l(){a(),document.addEventListener("aipkit:popover:opened",s),document.querySelectorAll(".aipkit_post_settings_redesigned").forEach(e=>{e.dataset.postSettingsInitialized||(i(e),e.dataset.postSettingsInitialized="true")}),new MutationObserver(e=>{e.forEach(t=>{if(t.type==="attributes"&&t.attributeName==="aria-hidden"){let d=t.target.closest("#aipkit_cw_post_settings_popover");if(d&&t.target.getAttribute("aria-hidden")==="false"){let _=d.querySelector(".aipkit_post_settings_redesigned");_&&!_.dataset.postSettingsInitialized&&(i(_),_.dataset.postSettingsInitialized="true")}}})}).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["aria-hidden"]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),window.aipkit_initPostSettingsHandler=i})();(function(){"use strict";function k(o){let r=o||document.getElementById("aipkit_content_writer_container");if(!r)return;let i=r.querySelectorAll("[data-aipkit-vector-stores-dropdown]");i.length&&i.forEach(a=>{let s=a.closest(".aipkit_popover_option_main"),l=a.closest(".aipkit_cw_vector_openai_field"),c=s||l,n=c?c.querySelector(".aipkit_popover_multiselect_select"):null;if(!n)return;let e=a.querySelector(".aipkit_popover_multiselect_btn"),t=a.querySelector(".aipkit_popover_multiselect_label"),d=a.querySelector(".aipkit_popover_multiselect_panel"),_=a.querySelector(".aipkit_popover_multiselect_options"),p=a.dataset.placeholder||"Select stores",f=a.dataset.selectedLabel||"selected",g=()=>{if(!t)return;let C=Array.from(n.options).filter(v=>v.selected&&v.value);if(!C.length){t.textContent=p;return}let x=C.map(v=>v.textContent.trim()).filter(Boolean);if(x.length<=2){t.textContent=x.join(", ");return}t.textContent=`${x.length} ${f}`},m=()=>{if(!_)return;_.innerHTML="";let C=Array.from(n.options),x=C.filter(v=>v.value);if(!x.length){let v=document.createElement("div");v.className="aipkit_popover_multiselect_empty",v.textContent=C[0]?.textContent||"-- No Stores Found --",_.appendChild(v),g();return}x.forEach(v=>{let L=document.createElement("label");L.className="aipkit_popover_multiselect_item";let P=document.createElement("input");P.type="checkbox",P.value=v.value,P.checked=v.selected,P.disabled=v.disabled;let b=document.createElement("span");b.className="aipkit_popover_multiselect_text",b.textContent=v.textContent,L.appendChild(P),L.appendChild(b),_.appendChild(L)}),g()},u=()=>{if(!_){g();return}let C=new Set(Array.from(n.options).filter(x=>x.selected).map(x=>x.value));_.querySelectorAll('input[type="checkbox"]').forEach(x=>{x.checked=C.has(x.value)}),g()},w=C=>{if(!_)return;let x=Array.from(_.querySelectorAll('input[type="checkbox"]:checked'));if(x.length>2){let L=C&&C.target;if(L&&L.checked)L.checked=!1;else{let P=x[x.length-1];P&&(P.checked=!1)}}let v=Array.from(_.querySelectorAll('input[type="checkbox"]:checked')).map(L=>L.value);Array.from(n.options).forEach(L=>{L.selected=v.includes(L.value)}),n.dispatchEvent(new Event("change",{bubbles:!0})),g()},h=C=>{!a||!e||(a.classList.toggle("is-open",C),e.setAttribute("aria-expanded",C?"true":"false"),d&&(d.hidden=!C))};m(),u(),a.dataset.vectorStoreMultiselectAttached||(e&&(e.addEventListener("click",C=>{C.preventDefault(),h(!a.classList.contains("is-open"))}),e.addEventListener("keydown",C=>{C.key==="Escape"&&h(!1)})),document.addEventListener("click",C=>{a.classList.contains("is-open")&&(a.contains(C.target)||h(!1))}),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",w),_.dataset.listenerAttached="true"),n.dataset.listenerAttached||(n.addEventListener("change",u),n.dataset.listenerAttached="true"),a.dataset.vectorStoreMultiselectAttached="true")})}window.aipkit_initContentWriterVectorStoreMultiSelect=k})();(function(){"use strict";function k(o){let r=o||document.getElementById("aipkit_content_writer_container");if(!r)return;let i=r.querySelectorAll("[data-aipkit-categories-dropdown]");i.length&&i.forEach(a=>{let s=a.closest(".aipkit_popover_option_main"),l=a.closest(".aipkit_post_taxonomy_row"),c=s||l,n=c?c.querySelector('select[name="post_categories[]"]'):null;if(!n)return;let e=a.querySelector(".aipkit_popover_multiselect_btn"),t=a.querySelector(".aipkit_popover_multiselect_label"),d=a.querySelector(".aipkit_popover_multiselect_panel"),_=a.querySelector(".aipkit_popover_multiselect_options"),p=a.dataset.placeholder||"Select categories",f=a.dataset.selectedLabel||"selected",g=()=>{if(!t)return;let C=Array.from(n.options).filter(v=>v.selected&&v.value);if(!C.length){t.textContent=p;return}let x=C.map(v=>v.textContent.trim()).filter(Boolean);if(x.length<=2){t.textContent=x.join(", ");return}t.textContent=`${x.length} ${f}`},m=()=>{if(!_)return;_.innerHTML="";let C=Array.from(n.options),x=C.filter(v=>v.value);if(!x.length){let v=document.createElement("div");v.className="aipkit_popover_multiselect_empty",v.textContent=C[0]?.textContent||"-- No Categories --",_.appendChild(v),g();return}x.forEach(v=>{let L=document.createElement("label");L.className="aipkit_popover_multiselect_item";let P=document.createElement("input");P.type="checkbox",P.value=v.value,P.checked=v.selected,P.disabled=v.disabled;let b=document.createElement("span");b.className="aipkit_popover_multiselect_text",b.textContent=v.textContent,L.appendChild(P),L.appendChild(b),_.appendChild(L)}),g()},u=()=>{if(!_){g();return}let C=new Set(Array.from(n.options).filter(x=>x.selected).map(x=>x.value));_.querySelectorAll('input[type="checkbox"]').forEach(x=>{x.checked=C.has(x.value)}),g()},w=()=>{if(!_)return;let C=Array.from(_.querySelectorAll('input[type="checkbox"]:checked')).map(x=>x.value);Array.from(n.options).forEach(x=>{x.selected=C.includes(x.value)}),n.dispatchEvent(new Event("change",{bubbles:!0})),g()},h=C=>{!a||!e||(a.classList.toggle("is-open",C),e.setAttribute("aria-expanded",C?"true":"false"),d&&(d.hidden=!C))};m(),u(),a.dataset.categoriesMultiselectAttached||(e&&(e.addEventListener("click",C=>{C.preventDefault(),h(!a.classList.contains("is-open"))}),e.addEventListener("keydown",C=>{C.key==="Escape"&&h(!1)})),document.addEventListener("click",C=>{a.classList.contains("is-open")&&(a.contains(C.target)||h(!1))}),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",w),_.dataset.listenerAttached="true"),n.dataset.listenerAttached||(n.addEventListener("change",u),n.dataset.listenerAttached="true"),a.dataset.categoriesMultiselectAttached="true")})}window.aipkit_initContentWriterCategoriesMultiSelect=k})();(function(){"use strict";let k=" \xB7 ",o=e=>{if(!e)return"";let t=e.options?e.options[e.selectedIndex]:null;return t?t.textContent.trim():""},r=e=>!e||!e.options?[]:Array.from(e.options).filter(t=>t.selected&&t.value).map(t=>t.textContent.trim()).filter(Boolean),i=(e,t)=>{let d=e.filter(Boolean);return d.length?d.join(k):t},a=(e,t)=>{if(!e)return;e.textContent=t,e.title=t;let d=e.closest(".aipkit_cw_settings_summary_text");d&&(d.title=t);let _=e.dataset.aipkitPlaceholder,p=e.dataset.aipkitDisabledLabel,f="active";p&&t===p?f="disabled":_&&t===_&&(f="placeholder"),e.dataset.aipkitSummaryState=f},s=e=>String(e||"").trim().toLowerCase(),l=(e,t,d=null)=>{if(!e)return;let _="aipkit_settings_select_picker_icon--";e.classList.forEach(m=>{m.startsWith(_)&&e.classList.remove(m)});let p=s(t),f=!d||d.includes(p),g=!!(p&&f);e.hidden=!g,g&&e.classList.add(`${_}${p}`)},c=e=>{if(!e)return;let t=document.getElementById("aipkit_content_writer_form"),d=t?t.classList.contains("aipkit_cw_mode_existing_images"):!1,_=e.querySelector('[data-aipkit-cw-summary="ai"]');if(_){let m=_.dataset.aipkitPlaceholder||"Not set",u=o(e.querySelector("#aipkit_content_writer_provider")),w=o(e.querySelector("#aipkit_content_writer_model"));a(_,i([w],m));let h=e.querySelector("#aipkit_content_writer_provider")?.value,C=_.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon");l(C,h)}let p=e.querySelector('[data-aipkit-cw-summary="images"]');if(p){let m=p.dataset.aipkitPlaceholder||"Not set",u=p.dataset.aipkitDisabledLabel||"Disabled",w=["#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description"],h=e.querySelector("#aipkit_cw_generate_images_enabled"),C=e.querySelector("#aipkit_cw_generate_featured_image"),x=h&&h.checked||C&&C.checked,v=e.querySelector("#aipkit_cw_image_provider"),L=v?v.value:"",P=o(v),b=o(e.querySelector("#aipkit_cw_image_model")),y=p.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_settings_select_picker_icon"),S=["openai","google","azure","replicate"];if(l(y,L,S),d){l(y,"",S);let E=w.map(A=>{let M=e.querySelector(A);if(!M||!M.checked)return"";let $=M.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_image_toggle_label");return $?$.textContent.trim():""}).filter(Boolean);a(p,i(E,u||m))}else x?S.includes(L)?a(p,i([b],m)):["pexels","pixabay"].includes(L)?a(p,i([P],m)):a(p,i([P,b],m)):(l(y,"",S),a(p,u))}let f=e.querySelector('[data-aipkit-cw-summary="vector"]');if(f){let m=f.dataset.aipkitPlaceholder||"Not set",u=f.dataset.aipkitDisabledLabel||"Disabled",w=e.querySelector("#aipkit_cw_enable_vector_store"),h=f.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon"),C=["openai","pinecone","qdrant"];if(w&&!w.checked)l(h,"",C),a(f,u);else{let x=e.querySelector("#aipkit_cw_vector_store_provider"),v=x?x.value:"",L="";if(v==="openai"){let P=e.querySelector("#aipkit_cw_openai_vector_store_ids");L=r(P).join(", ")}else v==="pinecone"?L=o(e.querySelector("#aipkit_cw_pinecone_index_name")):v==="qdrant"&&(L=o(e.querySelector("#aipkit_cw_qdrant_collection_name")));l(h,v,C),a(f,i([L],m))}}let g=e.querySelector('[data-aipkit-cw-summary="post"]');if(g){let m=g.dataset.aipkitPlaceholder||"Not set",u=o(e.querySelector("#aipkit_content_writer_post_status"));a(g,i([u],m))}};function n(e){let t=e||document.getElementById("aipkit_content_writer_container");if(!t||t.dataset.cwSummaryAttached==="true")return;let d=["#aipkit_content_writer_provider","#aipkit_content_writer_model","#aipkit_cw_generate_images_enabled","#aipkit_cw_generate_featured_image","#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description","#aipkit_cw_image_provider","#aipkit_cw_image_model","#aipkit_cw_enable_vector_store","#aipkit_cw_vector_store_provider","#aipkit_cw_openai_vector_store_ids","#aipkit_cw_pinecone_index_name","#aipkit_cw_qdrant_collection_name","#aipkit_content_writer_categories","#aipkit_content_writer_post_author","#aipkit_content_writer_post_status"],_=p=>d.some(f=>p.matches(f));t.addEventListener("change",p=>{let f=p.target;!f||!_(f)||c(t)}),c(t),t.dataset.cwSummaryAttached="true"}window.aipkit_initContentWriterSettingsSummary=n,window.aipkit_updateContentWriterSettingsSummary=function(){let e=document.getElementById("aipkit_content_writer_container");c(e)}})();(function(){"use strict";let k=window.wp?.i18n?.__||function(E){return E},o="#aipkit_content_writer_provider, #aipkit_content_writer_model, #aipkit_cw_image_provider, #aipkit_cw_image_model, #aipkit_task_cw_image_provider, #aipkit_task_cw_image_model, #aipkit_cw_vector_store_provider, #aipkit_cw_vector_embedding_provider, #aipkit_task_cw_vector_store_provider, #aipkit_task_ce_vector_store_provider, #aipkit_task_cw_vector_embedding_provider, #aipkit_task_ce_vector_embedding_provider, #aipkit_task_content_indexing_target_store_provider, #aipkit_enhancer_insert_position_default, #aipkit_cw_pinecone_index_name, #aipkit_cw_qdrant_collection_name, #aipkit_cw_vector_embedding_model, #aipkit_task_cw_ai_provider, #aipkit_task_cw_ai_model, #aipkit_task_cc_ai_provider, #aipkit_task_cc_ai_model, #aipkit_task_ce_ai_provider, #aipkit_task_ce_ai_model",r=null,i=null,a=!1,s=new Set(["aipkit_content_writer_provider","aipkit_cw_image_provider","aipkit_cw_vector_store_provider","aipkit_cw_vector_embedding_provider","aipkit_task_cw_image_provider","aipkit_task_cw_vector_store_provider","aipkit_task_ce_vector_store_provider","aipkit_task_cw_vector_embedding_provider","aipkit_task_ce_vector_embedding_provider","aipkit_task_content_indexing_target_store_provider","aipkit_task_cw_ai_provider","aipkit_task_cc_ai_provider","aipkit_task_ce_ai_provider"]),l=E=>!!(E&&E.id&&s.has(E.id)),c=E=>!!(E&&E.dataset?.aipkitPickerIcons==="assistant-position"),n=E=>!!(E&&(l(E)||c(E)||E.id==="aipkit_cw_pinecone_index_name"||E.id==="aipkit_cw_qdrant_collection_name"||E.id==="aipkit_cw_vector_embedding_model")),e=(E,A)=>{if(!E)return!1;let M=t(A);return M?E.id==="aipkit_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(M):E.id==="aipkit_task_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(M):E.id==="aipkit_cw_vector_store_provider"?["openai","pinecone","qdrant"].includes(M):E.id==="aipkit_task_cw_vector_store_provider"||E.id==="aipkit_task_ce_vector_store_provider"||E.id==="aipkit_task_content_indexing_target_store_provider"?["openai","pinecone","qdrant"].includes(M):E.id==="aipkit_cw_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(M):E.id==="aipkit_task_cw_vector_embedding_provider"||E.id==="aipkit_task_ce_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(M):["openai","openrouter","claude","google","azure","deepseek","ollama"].includes(M):!1},t=E=>String(E||"").trim().toLowerCase(),d=(E,A,M)=>{if(!E)return;let $="aipkit_settings_select_picker_icon--";E.classList.forEach(N=>{N.startsWith($)&&E.classList.remove(N)});let W=t(M),H=e(A,W);E.hidden=!H,H&&E.classList.add(`${$}${W}`)},_=(E,A)=>{if(!E)return;let M="aipkit_settings_select_picker_icon--assistant-";E.classList.forEach(W=>{W.startsWith(M)&&E.classList.remove(W)});let $=String(A||"").trim().toLowerCase();E.hidden=!$,$&&E.classList.add(`${M}${$}`)},p=E=>E&&(E.selectedOptions&&E.selectedOptions.length?E.selectedOptions[0]:E.querySelector("option[selected]"))?.dataset?.icon||"",f=E=>{if(!E)return"";let A=E.getAttribute("data-aipkit-picker-title");if(A)return A;let M=E.id&&document.querySelector(`label[for="${E.id}"]`)||E.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return M?M.textContent.trim():""},g=E=>{if(!E)return"";let A=E.selectedOptions&&E.selectedOptions.length?E.selectedOptions[0]:E.querySelector("option[selected]");if(A)return A.textContent.trim();let M=E.querySelector("option");return M?M.textContent.trim():""},m=E=>({buttonId:`${E}_picker_btn`,labelId:`${E}_picker_label`,popoverId:`${E}_picker_popover`,titleId:`${E}_picker_title`,searchId:`${E}_picker_search`,listId:`${E}_picker_list`}),u=E=>E?E.closest("#aipkit_cw_builder_sheet")||E.closest("#aipkit_content_writer_container")||E.closest("#aipkit_autogpt_container")||E.closest("#aipkit_ai_forms_container"):null,w=E=>{if(!E||!E.id)return null;let A=m(E.id),M=u(E);if(!M)return null;let $=document.getElementById(A.buttonId);if(!$){if($=document.createElement("button"),$.type="button",$.id=A.buttonId,$.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",$.setAttribute("data-aipkit-popover-target",A.popoverId),$.setAttribute("aria-controls",A.popoverId),$.setAttribute("aria-expanded","false"),$.dataset.aipkitPopoverPlacement="bottom",l(E)){$.classList.add("aipkit_settings_select_picker_btn--provider");let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),d(G,E,E.value),$.appendChild(G)}else if(c(E)){let G=document.createElement("span");G.className="aipkit_settings_select_picker_icon",G.setAttribute("aria-hidden","true"),_(G,p(E)),$.appendChild(G)}let H=document.createElement("span");H.className="aipkit_settings_select_picker_label",H.id=A.labelId,H.textContent=g(E)||k("Select","gpt3-ai-content-generator");let N=document.createElement("span");N.className="dashicons dashicons-arrow-down-alt2",N.setAttribute("aria-hidden","true"),$.appendChild(H),$.appendChild(N),E.insertAdjacentElement("beforebegin",$)}E.classList.contains("screen-reader-text")||E.classList.add("screen-reader-text");let W=document.getElementById(A.popoverId);if(!W){W=document.createElement("div"),W.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",W.id=A.popoverId,W.setAttribute("aria-hidden","true"),l(E)&&W.classList.add("aipkit_settings_select_picker_popover--provider");let H=document.createElement("div");H.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",H.setAttribute("role","dialog"),H.setAttribute("aria-labelledby",A.titleId);let N=document.createElement("div");N.className="aipkit_model_settings_popover_header";let G=document.createElement("span");G.className="aipkit_model_settings_popover_title",G.id=A.titleId,G.textContent=f(E)||k("Select","gpt3-ai-content-generator");let J=document.createElement("button");J.type="button",J.className="aipkit_model_settings_popover_close",J.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),J.innerHTML='<span class="dashicons dashicons-no-alt"></span>',N.appendChild(G),N.appendChild(J);let F=document.createElement("div");F.className="aipkit_model_settings_popover_body";let q=document.createElement("div");q.className="aipkit_settings_select_picker_search";let O=document.createElement("input");O.type="search",O.id=A.searchId,O.className="aipkit_form-input";let R=f(E),D=R?`Search ${R.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");O.setAttribute("placeholder",D),q.appendChild(O);let Z=document.createElement("div");Z.className="aipkit_settings_select_picker_list",Z.id=A.listId,Z.setAttribute("role","listbox"),F.appendChild(q),F.appendChild(Z),H.appendChild(N),H.appendChild(F),W.appendChild(H),M.appendChild(W),n(E)&&(q.style.display="none")}return{ids:A,button:$,popover:W,label:document.getElementById(A.labelId),search:document.getElementById(A.searchId),list:document.getElementById(A.listId)}},h=E=>{let A=[];return E&&Array.from(E.children).forEach($=>{if($.tagName==="OPTGROUP"){let W=Array.from($.children).filter(H=>H.tagName==="OPTION").map(H=>({value:H.value,label:H.textContent.trim(),disabled:H.disabled,selected:H.selected,icon:H.dataset?.icon||""}));A.push({label:$.label,options:W})}else $.tagName==="OPTION"&&A.push({label:"",options:[{value:$.value,label:$.textContent.trim(),disabled:$.disabled,selected:$.selected,icon:$.dataset?.icon||""}]})}),A},C=(E,A,M="")=>{if(!E||!A)return;A.innerHTML="";let $=h(E),W=M.trim().toLowerCase(),H=!1;if($.forEach(N=>{let G=N.options.filter(J=>W?J.label.toLowerCase().includes(W):!0);if(G.length){if(N.label){let J=document.createElement("div");J.className="aipkit_settings_select_picker_group_label",J.textContent=N.label,A.appendChild(J)}G.forEach(J=>{let F=document.createElement("button");if(F.type="button",F.className="aipkit_settings_select_picker_item",J.disabled&&F.classList.add("is-disabled"),J.selected&&F.classList.add("is-active"),F.dataset.value=J.value,l(E)&&e(E,J.value)){let R=document.createElement("span");R.className="aipkit_settings_select_picker_icon",R.setAttribute("aria-hidden","true"),d(R,E,J.value),F.appendChild(R)}else if(c(E)&&J.icon){let R=document.createElement("span");R.className="aipkit_settings_select_picker_icon",R.setAttribute("aria-hidden","true"),_(R,J.icon),F.appendChild(R)}let q=document.createElement("span");q.className="aipkit_settings_select_picker_text",q.textContent=J.label||J.value;let O=document.createElement("span");O.className="dashicons dashicons-yes aipkit_settings_select_picker_check",O.setAttribute("aria-hidden","true"),F.appendChild(q),F.appendChild(O),A.appendChild(F),H=!0})}}),!H){let N=document.createElement("div");N.className="aipkit_settings_select_picker_empty",N.textContent=k(W?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild(N)}},x=(E,A)=>{if(!E||!A)return;let M=g(E);if(A.textContent=M||k("Select","gpt3-ai-content-generator"),l(E)){let $=A.closest("button"),W=$?$.querySelector(".aipkit_settings_select_picker_icon"):null;d(W,E,E.value)}else if(c(E)){let $=A.closest("button"),W=$?$.querySelector(".aipkit_settings_select_picker_icon"):null;_(W,p(E))}},v=(E,A)=>{if(!E||!A)return;let M=E.getBoundingClientRect(),$=A.getBoundingClientRect(),W=$.width||320,H=$.height||0,N=window.innerWidth,G=window.innerHeight,J=12;if(E.dataset.aipkitPopoverPlacement==="bottom"){let O=M.left;O+W>N-J&&(O=M.right-W),O=Math.max(J,Math.min(O,N-W-J));let R=M.bottom+8;R+H>G-J&&(R=M.top-H-8),R=Math.max(J,Math.min(R,G-H-J)),A.style.left=`${Math.round(O)}px`,A.style.top=`${Math.round(R)}px`;return}let F=M.right+10;F+W>N-J&&(F=M.left-W-10),F=Math.max(J,Math.min(F,N-W-J));let q=M.top;q+H>G-J&&(q=G-H-J),q=Math.max(J,q),A.style.left=`${Math.round(F)}px`,A.style.top=`${Math.round(q)}px`},L=()=>{!r||!i||a||(a=!0,window.requestAnimationFrame(()=>{let E=r.querySelector(".aipkit_model_settings_popover_panel");v(i,E),a=!1}))},P=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},b=(E,A,M)=>{if(!E||!A)return;r&&r!==A&&P(),r=A,i=E,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),E.setAttribute("aria-expanded","true");let $=A.querySelector(".aipkit_settings_select_picker_search input"),W=A.querySelector(".aipkit_settings_select_picker_list");W&&C(M,W,$?$.value:""),$&&$.offsetParent!==null&&($.focus(),$.select());let H=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{v(E,H)})},y=(E,A)=>{if(!E||!A)return;let{button:M,popover:$,list:W,search:H}=A;if(M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("click",N=>{if(N.preventDefault(),r===$){P();return}b(M,$,E)}),M.dataset.pickerListenerAttached="true"),$&&$.dataset.overlayListenerAttached!=="true"){$.addEventListener("click",G=>{G.target===$&&P()});let N=$.querySelector(".aipkit_model_settings_popover_close");N&&N.addEventListener("click",G=>{G.preventDefault(),P()}),$.dataset.overlayListenerAttached="true"}if(W&&W.dataset.pickerListenerAttached!=="true"&&(W.addEventListener("click",N=>{let G=N.target.closest(".aipkit_settings_select_picker_item");if(!G||G.classList.contains("is-disabled"))return;let J=G.dataset.value??"";E.value=J,E.dispatchEvent(new Event("change",{bubbles:!0})),x(E,A.label),C(E,W,H?H.value:""),P()}),W.dataset.pickerListenerAttached="true"),H&&H.dataset.pickerListenerAttached!=="true"&&(H.addEventListener("input",()=>{C(E,W,H.value)}),H.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("change",()=>{x(E,A.label),C(E,W,H?H.value:"")}),E.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerObserverAttached!=="true"){let N=!1;new MutationObserver(()=>{N||(N=!0,window.requestAnimationFrame(()=>{x(E,A.label),C(E,W,H?H.value:""),N=!1}))}).observe(E,{childList:!0,subtree:!0}),E.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitContentWriterPickerEscapeBound||(document.addEventListener("keydown",N=>{N.key==="Escape"&&r&&P()}),document.body.dataset.aipkitContentWriterPickerEscapeBound="true"),document.body.dataset.aipkitContentWriterPickerRepositionBound||(window.addEventListener("resize",L),window.addEventListener("scroll",L,!0),document.body.dataset.aipkitContentWriterPickerRepositionBound="true")};function S(){let E=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);E.length&&E.forEach(A=>{let M=A.querySelectorAll(o);M.length&&M.forEach($=>{if(!$.id||$.dataset.aipkitPickerInit==="true")return;let W=w($);W&&(x($,W.label),C($,W.list,W.search?W.search.value:""),y($,W),$.dataset.aipkitPickerInit="true")})})}window.aipkit_initContentWriterSelectPickers=S,window.aipkit_refreshContentWriterSelectPickers=function(){let E=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);E.length&&E.forEach(A=>{let M=A.querySelectorAll(o);M.length&&M.forEach($=>{if(!$.id)return;let W=w($);W&&(x($,W.label),C($,W.list,W.search?W.search.value:""),y($,W),$.dataset.aipkitPickerInit="true")})})}})();(function(){"use strict";function k(c){c||(c=document.getElementById("aipkit_content_writer_container")),c&&(o(c),i(c),a(c))}function o(c){let n=c.querySelectorAll(".aipkit_ai_reasoning_input"),e=c.querySelector("#aipkit_content_writer_reasoning_effort");!n.length||!e||(n.forEach(t=>{t.addEventListener("change",function(){if(this.checked){e.value=this.value,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(p=>{p.classList.remove("aipkit_ai_reasoning_option--selected")});let d=this.closest(".aipkit_ai_reasoning_option");d&&d.classList.add("aipkit_ai_reasoning_option--selected");let _=new Event("change",{bubbles:!0});e.dispatchEvent(_)}})}),r(c))}function r(c){let n=c.querySelector("#aipkit_content_writer_reasoning_effort");if(!n)return;let e=n.value||"medium";e==="minimal"&&(e="low");let t=c.querySelector(`.aipkit_ai_reasoning_input[value="${e}"]`);if(t&&!t.checked){t.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>{_.classList.remove("aipkit_ai_reasoning_option--selected")});let d=t.closest(".aipkit_ai_reasoning_option");d&&d.classList.add("aipkit_ai_reasoning_option--selected")}}function i(c){let n=c.querySelector("#aipkit_content_writer_temperature"),e=c.querySelector("#aipkit_content_writer_temperature_value");!n||!e||n.dataset.enhancedListenerAttached!=="true"&&(n.addEventListener("input",function(){e.textContent=this.value}),n.dataset.enhancedListenerAttached="true")}function a(c){let n=c.querySelector("#aipkit_content_writer_content_length_slider"),e=c.querySelector("#aipkit_content_writer_content_length_value"),t=c.querySelector("#aipkit_content_writer_content_length_hint"),d=c.querySelector("#aipkit_content_writer_content_length");if(!n||!e||!t||!d||n.dataset.enhancedListenerAttached==="true")return;let _=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],p="medium",f=u=>{let w=_.findIndex(h=>h.key===u);return w===-1?_.findIndex(h=>h.key===p):w},g=u=>{let w=f(u),h=_[w];e.textContent=h.label,t.textContent=`Approx. ${h.words} words`,n.value=String(w+1)},m=(u,w=!1)=>{let h=_.some(C=>C.key===u)?u:p;d.value!==h&&(d.value=h),g(h),w&&d.dispatchEvent(new Event("change",{bubbles:!0}))};n.addEventListener("input",function(){let u=Math.max(1,Math.min(3,parseInt(this.value,10)))-1,w=_[u]?.key||p;m(w,!0)}),d.addEventListener("change",function(){m(this.value,!1)}),m(d.value||p,!1),n.dataset.enhancedListenerAttached="true"}function s(c,n){if(!c||!n)return;let e=c.querySelector("#aipkit_content_writer_reasoning_effort");e&&(e.value=n==="minimal"?"low":n);let t=c.querySelector(`.aipkit_ai_reasoning_input[value="${n==="minimal"?"low":n}"]`);if(t){t.checked=!0,c.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>{_.classList.remove("aipkit_ai_reasoning_option--selected")});let d=t.closest(".aipkit_ai_reasoning_option");d&&d.classList.add("aipkit_ai_reasoning_option--selected")}}function l(c){if(!c)return"medium";let n=c.querySelector(".aipkit_ai_reasoning_input:checked");if(n)return n.value;let e=c.querySelector("#aipkit_content_writer_reasoning_effort");return e?e.value:"medium"}window.aipkit_initAiSettingsRedesigned=k,window.aipkit_setReasoningEffort=s,window.aipkit_getReasoningEffort=l})();(function(){"use strict";function k(o,r,i,a,s,l){if(typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(o,r):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(i):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(s):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(l,s):console.error("Content Writer UI: handleClearButton function not found."),typeof window.aipkit_initContentWriterSettingsSummary=="function"?window.aipkit_initContentWriterSettingsSummary():console.error("Content Writer UI: initContentWriterSettingsSummary function not found."),typeof window.aipkit_initContentWriterSelectPickers=="function"?window.aipkit_initContentWriterSelectPickers():console.error("Content Writer UI: initContentWriterSelectPickers function not found."),typeof window.aipkit_initAiSettingsRedesigned=="function"){let c=document.getElementById("aipkit_content_writer_container");window.aipkit_initAiSettingsRedesigned(c)}}window.aipkit_initContentWriterUI=k})();(function(){"use strict";let k={intervalId:null,startTime:null};function o(c){let n=Math.floor(c/1e3),e=Math.floor(n/60),t=n%60;return`${e}:${String(t).padStart(2,"0")}`}function r(c){if(!c)return null;let n=c.querySelector(".aipkit_cw_btn_timer");if(n)return n;n=document.createElement("span"),n.className="aipkit_cw_btn_timer",n.setAttribute("aria-hidden","true"),n.hidden=!0;let e=c.querySelector(".aipkit_btn-text");return e?c.insertBefore(n,e):c.insertBefore(n,c.firstChild),n}function i(c){if(!c||k.intervalId)return;let n=r(c);if(!n)return;k.startTime=Date.now();let e=()=>{let t=Date.now()-k.startTime;n.textContent=o(t),n.hidden=!1};e(),k.intervalId=window.setInterval(e,1e3)}function a(c){k.intervalId&&(clearInterval(k.intervalId),k.intervalId=null),k.startTime=null;let n=r(c);n&&(n.hidden=!0,n.textContent="")}function s(c){let n=document.getElementById("aipkit_content_writer_generate_btn");if(!n)return;let e=n.closest(".aipkit_cw_generate_split"),t=e?e.querySelector(".aipkit_cw_generate_toggle"):null,d=e?e.querySelector(".aipkit_cw_generate_menu"):null,_=d?Array.from(d.querySelectorAll(".aipkit_cw_generate_menu_item")):[],p=document.getElementById("aipkit_content_writer_stop_btn");if(c){if(n.dataset.aipkitStopMode="true",e&&e.classList.add("is-single"),i(n),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(n,"Stop");else{let f=n.querySelector(".aipkit_btn-text");f?f.textContent="Stop":n.textContent="Stop"}n.disabled=!1,n.removeAttribute("aria-disabled"),n.style.display="inline-flex",t&&(t.style.display="none",t.disabled=!0),d&&(d.hidden=!0),_.length&&_.forEach(f=>{f.disabled=!0,f.setAttribute("aria-disabled","true")}),p&&(p.style.display="none");return}n.dataset.aipkitStopMode&&delete n.dataset.aipkitStopMode,a(n),e&&e.classList.remove("is-single"),t&&(t.style.display="",t.disabled=!1,t.removeAttribute("aria-disabled")),_.length&&_.forEach(f=>{f.disabled=!1,f.removeAttribute("aria-disabled")}),p&&(p.style.display="none")}function l(){let c=document.getElementById("aipkit_content_writer_generate_btn"),n=document.getElementById("aipkit_content_writer_stop_btn"),e=c?.dataset?.action||"generate",d={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",update:"Update"}[e]||"Generate";c&&(a(c),c.dataset.aipkitStopMode&&delete c.dataset.aipkitStopMode,typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(c,!1,d):(c.disabled=!1,c.textContent=d),c.style.display="inline-flex"),n&&(n.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()}window.aipkit_setContentWriterStopMode=s,window.aipkit_resetContentWriterButtons=l})();(function(){"use strict";function k(o){o.current&&(o.current.close(),o.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let r=document.getElementById("aipkit_cw_generated_content_area"),i=document.getElementById("aipkit_content_writer_output_display"),a=document.querySelector(".aipkit_content_writer_output_actions"),s=document.getElementById("aipkit_content_writer_copy_btn"),l=document.getElementById("aipkit_content_writer_clear_btn");r&&(r.textContent.trim().length>0||!!r.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))&&(!i||!i.classList.contains("aipkit_content_writer_output_error"))?(a&&(a.style.display="flex"),s&&(s.disabled=!1),l&&(l.disabled=!1),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_showPrimaryAction=="function"&&window.aipkit_showPrimaryAction(),typeof window.aipkit_updateMetaChunkVisibility=="function"&&window.aipkit_updateMetaChunkVisibility(),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(a&&(a.style.display="none"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=k})();(function(){"use strict";function k(l,c,n,e){let t=l.querySelector("[data-csv-upload-zone]"),d=l.querySelector("[data-csv-status]"),_=l.querySelector("[data-csv-status-card]"),p=l.querySelector("[data-csv-status-icon]"),f=l.querySelector("[data-csv-file-name]"),g=l.querySelector("[data-csv-message]");if(!(!d||!_)){if(c==="idle"){t&&t.classList.remove("is-hidden"),d.hidden=!0;return}if(t&&t.classList.add("is-hidden"),d.hidden=!1,_.dataset.status=c,p){let m="dashicons-yes-alt";c==="loading"&&(m="dashicons-update"),c==="error"&&(m="dashicons-warning"),p.innerHTML=`<span class="dashicons ${m}" aria-hidden="true"></span>`;let u=p.querySelector(".dashicons");u&&c==="loading"&&(u.style.animation="aipkit_csv_spin 1s linear infinite")}f&&e?f.textContent=e:f&&(f.textContent=""),g&&(g.textContent=n||"")}}async function o(l){let c=l.target,n=c.closest(".aipkit_csv_import_container")||c.closest(".aipkit_form-group");if(!n)return;let e=n.querySelector("[data-csv-status]")!==null,t=n.querySelector(".aipkit_csv_analysis_results"),d=n.querySelector(".aipkit_csv_data_holder"),_=document.getElementById("aipkit_content_writer_nonce"),p=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,f=_?_.value:p;if(!d||!f){console.error("CSV Handler: Missing data holder or nonce field."),e?k(n,"error","Error: A required component is missing.",null):t&&(t.textContent="Error: A required UI component or security token is missing.",t.className="aipkit_form-help aipkit_settings_message-error");return}let g=c.files[0];if(!g){e?k(n,"idle",null,null):t&&(t.textContent="Please select a CSV file first.",t.className="aipkit_form-help aipkit_settings_message-error");return}if(!g.name.toLowerCase().endsWith(".csv")){e?k(n,"error","Invalid file type. Please upload a .csv file.",g.name):t&&(t.textContent="Invalid file type. Please upload a .csv file.",t.className="aipkit_form-help aipkit_settings_message-error");return}e?k(n,"loading","Parsing CSV...",g.name):t&&(t.textContent="Parsing CSV...",t.className="aipkit_form-help aipkit_settings_message-info");let m=new FormData;m.append("file",g),m.append("_ajax_nonce",f),m.append("action","aipkit_content_writer_parse_csv");try{let u=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:m,credentials:"same-origin"});if(!u.ok){let C=`Server returned status ${u.status}`;try{let x=await u.json();x&&x.data&&x.data.message&&(C=x.data.message)}catch{}throw new Error(C)}let w=await u.json();if(!w.success)throw new Error(w.data?.message||"Unknown server error.");let h=w.data;if(h.tasks_found>0){d.value=h.formatted_data;let x=c.id==="aipkit_task_cw_csv_file_input"||!!c.closest("#aipkit_autogpt_container")?`Found ${h.tasks_found} ${h.tasks_found===1?"topic":"topics"}. Ready to save the task.`:`Found ${h.tasks_found} ${h.tasks_found===1?"topic":"topics"}. Hit Generate to proceed.`;e?k(n,"success",x,g.name):t&&(t.textContent=`Success! Found ${h.tasks_found} topics in the CSV file. Ready.`,t.className="aipkit_form-help aipkit_settings_message-success")}else{d.value="";let C="No valid topics found in the CSV file.";e?k(n,"error",C,g.name):t&&(t.textContent=C,t.className="aipkit_form-help aipkit_settings_message-error")}}catch(u){d.value="";let w=u.message||"Failed to parse CSV file.";e?k(n,"error",w,g.name):t&&(t.textContent=`Error: ${w}`,t.className="aipkit_form-help aipkit_settings_message-error"),console.error("CSV Parse Error:",u)}}function r(l){let c=l.target.closest("[data-csv-clear]");if(!c)return;let n=c.closest(".aipkit_csv_import_container");if(!n)return;let e=n.querySelector("input[type='file']"),t=n.querySelector(".aipkit_csv_data_holder");e&&(e.value=""),t&&(t.value=""),k(n,"idle",null,null)}function i(l){if(!l||l.dataset.dragDropAttached==="true")return;let c=d=>{d.preventDefault(),d.stopPropagation()},n=()=>l.classList.add("is-dragover"),e=()=>l.classList.remove("is-dragover"),t=d=>{c(d),e();let p=d.dataTransfer.files;if(p.length>0){let f=l.querySelector("input[type='file']");if(f){let g=new DataTransfer;g.items.add(p[0]),f.files=g.files,f.dispatchEvent(new Event("change",{bubbles:!0}))}}};["dragenter","dragover","dragleave","drop"].forEach(d=>{l.addEventListener(d,c,!1)}),["dragenter","dragover"].forEach(d=>{l.addEventListener(d,n,!1)}),["dragleave","drop"].forEach(d=>{l.addEventListener(d,e,!1)}),l.addEventListener("drop",t,!1),l.dataset.dragDropAttached="true"}function a(){let l=document.getElementById("aipkit_cw_csv_file_input");if(!l||l.dataset.listenerAttached==="true")return;l.addEventListener("change",o),l.dataset.listenerAttached="true";let c=l.closest(".aipkit_csv_import_container");if(c){let n=c.querySelector(".aipkit_csv_dropzone");i(n);let e=c.querySelector("[data-csv-clear]");e&&e.dataset.listenerAttached!=="true"&&(e.addEventListener("click",r),e.dataset.listenerAttached="true")}}function s(){let l=document.getElementById("aipkit_task_cw_csv_file_input");if(!l||l.dataset.listenerAttached==="true")return;l.addEventListener("change",o),l.dataset.listenerAttached="true";let c=l.closest(".aipkit_csv_import_container");if(c){let n=c.querySelector(".aipkit_csv_dropzone");i(n);let e=c.querySelector("[data-csv-clear]");e&&e.dataset.listenerAttached!=="true"&&(e.addEventListener("click",r),e.dataset.listenerAttached="true")}}window.aipkit_initCsvUploadHandler=a,window.aipkit_initTaskCsvUploadHandler=s})();(function(){"use strict";function k(o,r){let i=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!i||!i.value)throw new Error("Security token missing for stream. Please reload.");let a=new URL(window.aipkit_dashboard.ajaxurl);a.searchParams.append("action","aipkit_frontend_chat_stream"),a.searchParams.append("cache_key",o),a.searchParams.append("_ajax_nonce",i.value),r.current&&r.current.close();try{let s=new EventSource(a.toString());return s.userStopped=!1,s}catch(s){throw console.error("EventSource Connection Setup: EventSource creation error:",s),new Error("Could not connect to stream. "+s.message)}}window.aipkit_stream_setupEventSourceConnection=k})();(function(){"use strict";function k(r){let i=r.parentElement,a=i?.closest(".aipkit_cw_output_chunk--primary");a&&(i.scrollHeight>i.clientHeight?a.classList.add("has-overflow"):a.classList.remove("has-overflow"))}function o(r,i,a,s){if(r.data)try{let l=JSON.parse(r.data);if(l.delta){if(i.fullContent+=l.delta,a.classList.contains("is-streaming")||a.classList.add("is-streaming"),!s&&typeof window.aipkit_getMarkdownRenderer=="function"&&(s=window.aipkit_getMarkdownRenderer()),s)a.innerHTML=s.render(i.fullContent);else{let n=a.textContent||"";a.textContent=n+l.delta}typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(a.innerHTML);let c=a.parentElement;c&&c.scrollTo({top:c.scrollHeight,behavior:"smooth"}),k(a),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()}}catch(l){console.error("Stream Message Handler: Error parsing event data.",l)}}window.aipkit_stream_handleMessage=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};async function o(r,i,a,s,l,c){if(i.isDone)return;i.isDone=!0,c&&c.current&&(c.current.close(),c.current=null),a.classList.contains("is-streaming")&&a.classList.remove("is-streaming"),!s&&typeof window.aipkit_getMarkdownRenderer=="function"&&(s=window.aipkit_getMarkdownRenderer()),s&&(a.innerHTML=s.render(i.fullContent)),typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(a.innerHTML),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let n=document.getElementById("aipkit_content_writer_form"),e=n?n.elements.generate_meta_description:null,t=n?n.elements.generate_focus_keyword:null,d=n?n.elements.generate_excerpt:null,_=n?n.elements.generate_tags:null,p=document.getElementById("aipkit_content_writer_nonce")?.value,f=n.elements.ai_provider?.value,g=n.elements.ai_model?.value,m=n.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",u=document.getElementById("aipkit_cw_generated_title_display"),w=u?u.textContent:n.elements.content_title?.value.split("|")[0].trim()||"Untitled",h=n.elements.content_keywords?.value.trim()||"",C="",x=document.getElementById("aipkit_content_writer_title");if(x){let S=x.value.split("|")||[];S.length>1&&(C=S[1].trim())}let v=C||h,L=v;if(t?.checked&&!v&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let S=n.elements.enable_vector_store,E=S&&S.checked?"1":"0",A=n.elements.vector_store_provider?.value,M=n.elements["openai_vector_store_ids[]"],$=M?Array.from(M.selectedOptions).map(q=>q.value):[],W=n.elements.pinecone_index_name?.value,H=n.elements.qdrant_collection_name?.value,N=n.elements.vector_store_top_k?.value,G=n.elements.vector_store_confidence_threshold?.value,J={generated_content:i.fullContent,final_title:w,provider:f,model:g,prompt_mode:m,custom_keyword_prompt:n.elements.custom_keyword_prompt.value,enable_vector_store:E,vector_store_provider:A,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:H,vector_store_top_k:N,vector_store_confidence_threshold:G,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",J);if(F&&F.focus_keyword){L=F.focus_keyword;let q=document.getElementById("aipkit_cw_generated_focus_keyword"),O=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");q&&O&&(q.value=L,O.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",S.message||"Failed")}}else if(v){let S=document.getElementById("aipkit_cw_generated_focus_keyword"),E=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");S&&E&&(S.value=v.split(",")[0].trim(),E.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let P=n?n.elements.generate_images_enabled:null,b=n?n.elements.generate_featured_image:null;if((P?.checked||b?.checked)&&i.fullContent.trim()!==""){let S=P?.checked,E=b?.checked,A=String(n.elements.image_provider?.value||"").toLowerCase(),M=String(n.elements.image_model?.value||"").toLowerCase(),$=A==="openai"&&M.startsWith("gpt-image-1"),W=S?parseInt(n.elements.image_count?.value,10)||1:0,H=document.getElementById("aipkit_cw_generated_excerpt"),N=W+(E?1:0),G=S&&E?W>1?`Generating ${W} content images and 1 featured image...`:"Generating 1 content image and 1 featured image...":E?"Generating featured image...":S?W>1?`Generating ${W} content images...`:"Generating content image...":N>1?`Generating ${N} images...`:N===1?"Generating 1 image...":"Generating images...",J={original_topic:x?x.value.split("|")[0].trim():w,final_title:w,post_title:w,keywords:L,excerpt:H?H.value:"",ai_provider:n.elements.ai_provider?.value,ai_model:n.elements.ai_model?.value,ai_temperature:n.elements.ai_temperature?.value,reasoning_effort:n.elements.reasoning_effort?.value,image_provider:n.elements.image_provider?.value,image_model:n.elements.image_model?.value,image_prompt:n.elements.image_prompt?.value,image_alignment:n.elements.image_alignment?.value,image_size:n.elements.image_size?.value,featured_image_prompt:n.elements.featured_image_prompt?.value,generate_image_title:n.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:n.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:n.elements.generate_image_caption?.checked?"1":"0",generate_image_description:n.elements.generate_image_description?.checked?"1":"0",image_title_prompt:n.elements.image_title_prompt?.value,image_alt_text_prompt:n.elements.image_alt_text_prompt?.value,image_caption_prompt:n.elements.image_caption_prompt?.value,image_description_prompt:n.elements.image_description_prompt?.value,pexels_orientation:n.elements.pexels_orientation?.value,pexels_size:n.elements.pexels_size?.value,pexels_color:n.elements.pexels_color?.value,pixabay_orientation:n.elements.pixabay_orientation?.value,pixabay_image_type:n.elements.pixabay_image_type?.value,pixabay_category:n.elements.pixabay_category?.value,_ajax_nonce:p,generate_images_enabled:S?"1":"0",image_count:W,generate_featured_image:E?"1":"0",image_placement:n.elements.image_placement?.value,image_placement_param_x:n.elements.image_placement_param_x?.value,cw_generation_mode:n.elements.cw_generation_mode?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0},F=O=>{let R=document.getElementById("aipkit_cw_image_data_holder");R&&(R.value=JSON.stringify(O)),typeof window.aipkit_renderContentWriterImagePreview=="function"&&window.aipkit_renderContentWriterImagePreview(O)},q=async(O={},R="")=>{typeof window.aipkit_updateCwGenerationStatus=="function"&&R&&window.aipkit_updateCwGenerationStatus("image","generating",R);let D=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...J,...O});if(!D?.image_data)throw new Error("Image generation failed or returned no data.");return D.image_data};try{let O=S&&E,R=$&&S&&W>1,D=null,Z=Q=>{D||(D={...Q,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(O){if(S&&W>0)if(R&&W>1)for(let Q=0;Q<W;Q++){let fe=await q({generate_featured_image:"0",image_count:1,image_start_index:Q+1},`Generating content image ${Q+1} of ${W}...`);Z(fe),Array.isArray(fe.in_content_images)&&D.in_content_images.push(...fe.in_content_images),F(D)}else{let Q=await q({generate_featured_image:"0"},W>1?`Generating ${W} content images...`:"Generating content image...");Z(Q),D.in_content_images=Q.in_content_images||[],F(D)}if(E){let Q=await q({generate_images_enabled:"0",image_count:0},"Generating featured image...");Z(Q),D.featured_image_id=Q.featured_image_id||null,D.featured_image_url=Q.featured_image_url||null}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",G),D=await q();if(D)F(D),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success");else throw new Error("Image generation failed or returned no data.")}catch(O){typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",O.message||"Failed")}}else typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(d?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let S=n.elements.enable_vector_store,E=S&&S.checked?"1":"0",A=n.elements.vector_store_provider?.value,M=n.elements["openai_vector_store_ids[]"],$=M?Array.from(M.selectedOptions).map(q=>q.value):[],W=n.elements.pinecone_index_name?.value,H=n.elements.qdrant_collection_name?.value,N=n.elements.vector_store_top_k?.value,G=n.elements.vector_store_confidence_threshold?.value,J={generated_content:i.fullContent,final_title:w,keywords:L,provider:f,model:g,prompt_mode:m,custom_excerpt_prompt:n.elements.custom_excerpt_prompt.value,enable_vector_store:E,vector_store_provider:A,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:H,vector_store_top_k:N,vector_store_confidence_threshold:G,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",J);if(F&&F.excerpt){let q=document.getElementById("aipkit_cw_generated_excerpt"),O=document.getElementById("aipkit_cw_excerpt_output_wrapper");q&&O&&(q.value=F.excerpt,O.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",S.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(_?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let S=n.elements.enable_vector_store,E=S&&S.checked?"1":"0",A=n.elements.vector_store_provider?.value,M=n.elements["openai_vector_store_ids[]"],$=M?Array.from(M.selectedOptions).map(q=>q.value):[],W=n.elements.pinecone_index_name?.value,H=n.elements.qdrant_collection_name?.value,N=n.elements.vector_store_top_k?.value,G=n.elements.vector_store_confidence_threshold?.value,J={generated_content:i.fullContent,final_title:w,keywords:L,provider:f,model:g,prompt_mode:m,custom_tags_prompt:n.elements.custom_tags_prompt.value,enable_vector_store:E,vector_store_provider:A,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:H,vector_store_top_k:N,vector_store_confidence_threshold:G,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",J);if(F&&F.tags){let q=document.getElementById("aipkit_cw_generated_tags"),O=document.getElementById("aipkit_cw_tags_output_wrapper");q&&O&&(q.value=F.tags,O.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",S.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(e?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let S=n.elements.enable_vector_store,E=S&&S.checked?"1":"0",A=n.elements.vector_store_provider?.value,M=n.elements["openai_vector_store_ids[]"],$=M?Array.from(M.selectedOptions).map(q=>q.value):[],W=n.elements.pinecone_index_name?.value,H=n.elements.qdrant_collection_name?.value,N=n.elements.vector_store_top_k?.value,G=n.elements.vector_store_confidence_threshold?.value,J={generated_content:i.fullContent,final_title:w,keywords:L,provider:f,model:g,prompt_mode:m,custom_meta_prompt:n.elements.custom_meta_prompt.value,enable_vector_store:E,vector_store_provider:A,openai_vector_store_ids:$,pinecone_index_name:W,qdrant_collection_name:H,vector_store_top_k:N,vector_store_confidence_threshold:G,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:p},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",J);if(F&&F.meta_description){let q=document.getElementById("aipkit_cw_generated_meta_desc"),O=document.getElementById("aipkit_cw_meta_desc_output_wrapper");q&&O&&(q.value=F.meta_description,O.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(S){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",S.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c)}window.aipkit_stream_handleDone=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(r,i,a,s,l){if(i.isDone)return;if(l.current&&l.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(l);return}let c="Error during streaming.";if(r.data)try{c=JSON.parse(r.data).error||c}catch{}console.error("Stream Error Handler: Error event received:",r),a&&(a.textContent="",a.className="aipkit_cw_status_badge"),s&&s.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",c),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(l)}window.aipkit_stream_handleError=o})();(function(){"use strict";let k={current:null};function o(r,i){let a=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_form_status");if(!a||!s||!l){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let c=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let e of c)if(typeof window[e]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${e}`),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let n={fullContent:"",isDone:!1};s.innerHTML="",a.classList.remove("aipkit_content_writer_output_error"),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),window.aipkit_updateCwGenerationStatus("content","generating");try{i.current=window.aipkit_stream_setupEventSourceConnection(r,i);let e=window.aipkit_getMarkdownRenderer();i.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},i.current.onmessage=function(t){window.aipkit_stream_handleMessage(t,n,s,e)},i.current.addEventListener("done",function(t){window.aipkit_stream_handleDone(t,n,s,e,l,i)}),i.current.addEventListener("error",function(t){window.aipkit_stream_handleError(t,n,l,a,i)})}catch(e){console.error("EventSource Orchestrator: Error during setup:",e),l&&(l.textContent="",l.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=o,window.aipkit_contentWriterEventSourceInstanceRef=k})();(function(){"use strict";function k(o){o&&o.current&&o.current.close()}window.aipkit_stopContentWriterEventSource=k})();(function(){"use strict";async function k(o){let r=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),a=document.getElementById("aipkit_content_writer_form_status"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn"),n=document.querySelector(".aipkit_content_writer_progress_bar_container"),e=document.querySelector(".aipkit_content_writer_output_actions"),t=function(g){if(!g)return"Error";let m=g.message||"Error",u=g.details||g.data?.details,w=u?.provider,h=u?.model;return w||h?`${m} (${[w,h].filter(Boolean).join(" \xB7 ")})`:m};if(!r||!i||!a||!s||!l||!c||!e){console.error("Handle SSE: Missing UI elements.");return}let d=new FormData(r),_=Object.fromEntries(d.entries()),p=r.elements["openai_vector_store_ids[]"];if(_.openai_vector_store_ids=p?Array.from(p.selectedOptions).map(g=>g.value):[],delete _["openai_vector_store_ids[]"],!_.conversation_uuid){let g=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();g&&(_.conversation_uuid=g)}if(!_.content_title){a.textContent="",a.className="aipkit_cw_status_badge";return}let f=document.getElementById("aipkit_content_writer_nonce");if(f&&f.value)_._ajax_nonce=f.value;else{a.textContent="",a.className="aipkit_cw_status_badge";return}typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0),n&&(n.style.display="none"),e.style.display="none",s&&(s.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'),l.disabled=!0,c.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),a.textContent="",a.className="aipkit_cw_status_badge";try{_.content_title=document.getElementById("aipkit_content_writer_title").value;let g=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",_);if(!g.cache_key)throw new Error(g.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=g.cache_key,g.conversation_uuid){window.aipkit_current_conversation_uuid=g.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",g.conversation_uuid)}catch{}}if(typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(g.cache_key,o);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(g){console.error("Content Writer Init Stream Error:",g),a&&(a.textContent=t(g),a.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),window.aipkit_setLoadingStateOpenAI(i,!1,"Generate"),typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),s&&(s.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},o=function(i){if(!i)return"Error";let a=i.message||"Error",s=i.details||i.data?.details,l=s?.provider,c=s?.model;return l||c?`${a} (${[l,c].filter(Boolean).join(" \xB7 ")})`:a};async function r(){let i=document.getElementById("aipkit_content_writer_form"),a=document.getElementById("aipkit_content_writer_generate_btn"),s=document.getElementById("aipkit_content_writer_stop_btn"),l=document.getElementById("aipkit_content_writer_form_status"),c=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_content_writer_copy_btn"),e=document.getElementById("aipkit_content_writer_clear_btn"),t=document.querySelector(".aipkit_content_writer_progress_bar_container"),d=t?t.querySelector(".aipkit_content_writer_progress_bar"):null,_=document.querySelector(".aipkit_content_writer_output_actions"),p=document.getElementById("aipkit_cw_status_display_container");if(!i||!a||!s||!l||!c||!n||!e){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),l.textContent="",l.className="aipkit_cw_status_badge";return}let f=new FormData(i),g=Object.fromEntries(f.entries()),m=i.elements["openai_vector_store_ids[]"];if(g.openai_vector_store_ids=m?Array.from(m.selectedOptions).map(v=>v.value):[],delete g["openai_vector_store_ids[]"],!g.conversation_uuid){let v=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();v&&(g.conversation_uuid=v)}if(!g.content_title){l.textContent="",l.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let u=document.getElementById("aipkit_content_writer_nonce");if(u&&u.value)g._ajax_nonce=u.value;else{l.textContent="",l.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}p&&(p.style.display="block");let w=document.getElementById("aipkit_cw_generate_meta_desc"),h=document.getElementById("aipkit_cw_generate_focus_keyword"),C=document.getElementById("aipkit_cw_generate_excerpt"),x=document.getElementById("aipkit_cw_generate_tags");typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",C?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",x?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",w?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",h?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(a,!0,"Generate","Generating..."),s.style.display="none",_&&(_.style.display="none"),c&&(c.innerHTML=""),n.disabled=!0,e.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),l.textContent="Generating content, please wait...",l.className="aipkit_cw_status_badge aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),t&&d&&(t.style.display="block",d.style.width="0%",d.classList.add("aipkit_indeterminate"));try{let v=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",g);if(v.content){if(v.conversation_uuid){window.aipkit_current_conversation_uuid=v.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",v.conversation_uuid)}catch{}}let L=window.aipkit_getMarkdownRenderer();if(c&&(L?c.innerHTML=L.render(v.content):c.textContent=v.content,typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(c.innerHTML)),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),_&&(_.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),n.disabled=!1,e.disabled=!1,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),v.content&&C?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let P=i.elements.enable_vector_store,b=P&&P.checked?"1":"0",y=i.elements.vector_store_provider?.value,S=i.elements["openai_vector_store_ids[]"],E=S?Array.from(S.selectedOptions).map(G=>G.value):[],A=i.elements.pinecone_index_name?.value,M=i.elements.qdrant_collection_name?.value,$=i.elements.vector_store_top_k?.value,W=i.elements.vector_store_confidence_threshold?.value,H={generated_content:v.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||g.content_title,provider:g.ai_provider,model:g.ai_model,prompt_mode:g.prompt_mode,custom_excerpt_prompt:g.custom_excerpt_prompt,enable_vector_store:b,vector_store_provider:y,openai_vector_store_ids:E,pinecone_index_name:A,qdrant_collection_name:M,vector_store_top_k:$,vector_store_confidence_threshold:W,vector_embedding_provider:i.elements.vector_embedding_provider?.value,vector_embedding_model:i.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:g._ajax_nonce},N=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",H);if(N&&N.excerpt){let G=document.getElementById("aipkit_cw_generated_excerpt"),J=document.getElementById("aipkit_cw_excerpt_output_wrapper");G&&J&&(G.value=N.excerpt,J.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(P){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",P.message||"Not returned")}}if(v.content&&x?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let P=i.elements.enable_vector_store,b=P&&P.checked?"1":"0",y=i.elements.vector_store_provider?.value,S=i.elements["openai_vector_store_ids[]"],E=S?Array.from(S.selectedOptions).map(G=>G.value):[],A=i.elements.pinecone_index_name?.value,M=i.elements.qdrant_collection_name?.value,$=i.elements.vector_store_top_k?.value,W=i.elements.vector_store_confidence_threshold?.value,H={generated_content:v.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||g.content_title,provider:g.ai_provider,model:g.ai_model,prompt_mode:g.prompt_mode,custom_tags_prompt:g.custom_tags_prompt,enable_vector_store:b,vector_store_provider:y,openai_vector_store_ids:E,pinecone_index_name:A,qdrant_collection_name:M,vector_store_top_k:$,vector_store_confidence_threshold:W,vector_embedding_provider:i.elements.vector_embedding_provider?.value,vector_embedding_model:i.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:g._ajax_nonce},N=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",H);if(N&&N.tags){let G=document.getElementById("aipkit_cw_generated_tags"),J=document.getElementById("aipkit_cw_tags_output_wrapper");G&&J&&(G.value=N.tags,J.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(P){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",P.message||"Not returned")}}if(v.meta_description){let P=document.getElementById("aipkit_cw_generated_meta_desc"),b=document.getElementById("aipkit_cw_meta_desc_output_wrapper");P&&b&&(P.value=v.meta_description,b.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else w?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(v.focus_keyword){let P=document.getElementById("aipkit_cw_generated_focus_keyword"),b=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");P&&b&&(P.value=v.focus_keyword,b.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else h?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(v.message||"No content received.")}catch(v){console.error("Content Writer AJAX Error:",v),l&&(l.textContent=o(v),l.className="aipkit_cw_status_badge aipkit_settings_message-error"),c&&(c.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",v.message),C?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),x?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),w?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),h?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),_&&(_.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(a,!1,"Generate"),t&&(t.style.display="none"),d&&d.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){let i=document.getElementById("aipkit_content_writer_generate_btn"),a=()=>{if(i){if(typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(i,k("Stopping...","gpt3-ai-content-generator"));else{let l=i.querySelector(".aipkit_btn-text");l?l.textContent=k("Stopping...","gpt3-ai-content-generator"):i.textContent=k("Stopping...","gpt3-ai-content-generator")}i.disabled=!0,i.setAttribute("aria-disabled","true")}};if(typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){a(),typeof window.aipkit_cw_requestBatchStop=="function"&&window.aipkit_cw_requestBatchStop();return}if(typeof window.aipkit_cw_isExistingUpdateActive=="function"&&window.aipkit_cw_isExistingUpdateActive()){a(),typeof window.aipkit_cw_requestExistingUpdateStop=="function"&&window.aipkit_cw_requestExistingUpdateStop();return}if(!r||!r.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let s=document.getElementById("aipkit_content_writer_form_status");s&&(s.textContent=k("Stopping...","gpt3-ai-content-generator"),s.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),s.classList.add("aipkit_settings_message-info")),a(),r.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(r):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=o})();(function(){"use strict";let k={rss:["{description}"],url:["{url_content}"]},o=new Set(["task","csv","gsheets"]),r="{topic}",i=d=>{if(!d)return"Error";let _=d.message||"Error",p=d.details||d.data?.details,f=p?.provider,g=p?.model;return f||g?`${_} (${[f,g].filter(Boolean).join(" \xB7 ")})`:_},a=(d,_)=>{let p=d.querySelector(_);return p?String(p.value||""):""},s=(d,_)=>_.filter(p=>!d.includes(p)),l=(d,_,p)=>{let f=[],g=d==="rss"?"RSS":"URL";return _.length&&f.push(`Title prompt: missing ${_.join(", ")}.`),p.length&&f.push(`Content prompt: missing ${p.join(", ")}.`),f.length?`${g} mode works best when your prompts include the source placeholders.

${f.join(`
`)}

Please update your prompts and try again.`:""},c=(d,_)=>{let p=k[_];if(!p)return{shouldWarn:!1,message:""};let f=a(d,"#aipkit_cw_custom_title_prompt").trim(),g=a(d,"#aipkit_cw_custom_content_prompt").trim(),m=f?s(f,p):[],u=g?s(g,p):p.slice(),w=l(_,m,u);return{shouldWarn:!!w,message:w}},n=(d,_)=>_.length?`${d} mode requires ${r} in your prompts.

${_.join(`
`)}

Please update your prompts and try again.`:"",e=(d,_)=>{if(!o.has(_))return{shouldWarn:!1,message:""};let f={task:"Manual entry",csv:"CSV",gsheets:"Google Sheets"}[_]||"This",g=[{selector:"#aipkit_cw_custom_title_prompt",label:"Title prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_content_prompt",label:"Content prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_meta_prompt",label:"Meta description prompt",enabled:()=>!!d.querySelector("#aipkit_cw_generate_meta_desc")?.checked},{selector:"#aipkit_cw_custom_keyword_prompt",label:"Focus keyword prompt",enabled:()=>!!d.querySelector("#aipkit_cw_generate_focus_keyword")?.checked},{selector:"#aipkit_cw_custom_excerpt_prompt",label:"Excerpt prompt",enabled:()=>!!d.querySelector("#aipkit_cw_generate_excerpt")?.checked},{selector:"#aipkit_cw_custom_tags_prompt",label:"Tags prompt",enabled:()=>!!d.querySelector("#aipkit_cw_generate_tags")?.checked}],m=[];g.forEach(w=>{if(!w.enabled())return;let h=a(d,w.selector).trim();(h?s(h,[r]):[r]).length&&m.push(`${w.label}: missing ${r}.`)});let u=n(f,m);return{shouldWarn:!!u,message:u}};function t(d,_,p,f){d&&(d.dataset.listenerAttached||(d.addEventListener("click",async()=>{if(d.dataset.aipkitStopMode==="true"){typeof window.aipkit_handleStopGeneration=="function"&&window.aipkit_handleStopGeneration(f);return}try{delete window.aipkit_current_conversation_uuid,sessionStorage.removeItem("aipkit_current_conversation_uuid")}catch{}typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview();let g=document.getElementById("aipkit_cw_image_data_holder");if(g&&(g.value=""),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),d.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Upgrade URL not found. Please visit our website.",{title:"Upgrade"}):alert("Upgrade URL not found. Please visit our website.");return}if(d.dataset.action==="fetch_feeds"){typeof window.aipkit_handleRssFetchFromGenerateButton=="function"?window.aipkit_handleRssFetchFromGenerateButton(d):console.error("Fetch Feeds: Handler function not found.");return}let m=document.getElementById("aipkit_content_writer_form_status"),u=document.getElementById("aipkit_cw_action_validation"),w=d.dataset.action||"generate",h=w==="generate_single"?"generate":w,C=document.getElementById("aipkit_cw_mode_select"),x=C?C.value:"task";if(x==="single"&&(x="task"),x==="existing"||x.indexOf("existing-")===0){if(typeof window.aipkit_runContentWriterExistingUpdate=="function")window.aipkit_runContentWriterExistingUpdate();else{let R="Update panel is not ready yet. Please refresh the page and try again.";typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(R,{title:"Update existing"}):alert(R)}return}let v=R=>String(R||"").split(/\r?\n/).map(D=>D.trim()).filter(Boolean),L=R=>{let D=String(R||"").split("|").map(Z=>Z.trim());return{topic:D[0]||"",keywords:D[1]||"",category:D[2]||"",authorLogin:D[3]||"",type:D[4]||"",schedule:D[5]||""}},P=()=>{let R=Array.from(_.querySelectorAll("[data-aipkit-bulk-row]"));for(let D of R){let Z=D.querySelector('[data-bulk-field="topic"]'),Q=Z?Z.value.trim():"";if(!Q)continue;let fe=D.querySelector('[data-bulk-field="keywords"]')?.value.trim()||"",Ae=D.querySelector('[data-bulk-field="category"]')?.value.trim()||"",We=D.querySelector('[data-bulk-field="author"]'),Ge=We?We.value.trim():"",it=We?.selectedOptions?.[0]?.dataset?.userId||"",_t=D.querySelector('[data-bulk-field="type"]')?.value.trim()||"",mt=D.querySelector('[data-bulk-field="schedule"]')?.value.trim()||"";return{topic:Q,keywords:fe,category:Ae,authorLogin:Ge,authorId:it,type:_t,schedule:mt}}return null},b=R=>{if(!R||!R.topic)return;let D=document.getElementById("aipkit_content_writer_title"),Z=R.keywords?`${R.topic} | ${R.keywords}`:R.topic;D&&(D.value=Z,D.dispatchEvent(new Event("change",{bubbles:!0})));let Q=_.elements.post_type;Q&&R.type&&(Q.value=R.type,Q.dispatchEvent(new Event("change",{bubbles:!0})));let fe=_.elements["post_categories[]"];fe&&R.category&&(Array.from(fe.options).forEach(We=>{We.selected=We.value===R.category}),fe.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect());let Ae=_.elements.post_author;if(Ae){let We=R.authorId||"";if(!We&&R.authorLogin){let Ge=Array.from(Ae.options).find(it=>it.dataset.login===R.authorLogin||it.value===R.authorLogin);Ge&&(We=Ge.value)}We&&(Ae.value=We,Ae.dispatchEvent(new Event("change",{bubbles:!0})))}};if(h!=="upgrade"){let R=typeof window.aipkit_validateContentWriterInputs=="function"?window.aipkit_validateContentWriterInputs(_,x):{isValid:!0};if(!R.isValid){typeof window.aipkit_showContentWriterValidationError=="function"?window.aipkit_showContentWriterValidationError(m||u,R.message):m&&(m.textContent=R.message||"",m.className="aipkit_cw_status_badge aipkit_settings_message-error");return}}if(typeof window.aipkit_clearContentWriterValidationMessage=="function"?(window.aipkit_clearContentWriterValidationMessage(m),window.aipkit_clearContentWriterValidationMessage(u)):u&&(u.textContent=""),h==="generate"||h==="create_task"){let{shouldWarn:R,message:D}=c(_,x);if(R){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(D,{title:"Update prompts",okText:"Review prompts"}):alert(D);return}let Z=e(_,x);if(Z.shouldWarn){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(Z.message,{title:"Update prompts",okText:"Review prompts"}):alert(Z.message);return}}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let y=document.getElementById("aipkit_cw_status_display_container"),S=document.getElementById("aipkit_cw_generated_title_display"),E=document.getElementById("aipkit_content_writer_title");if(h==="create_task"){y&&(y.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(_,d,m):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),m&&(m.textContent="",m.className="aipkit_cw_status_badge"));return}let A=_.elements.content_title_bulk,M=v(A?A.value:""),$=h==="generate"&&x==="task"&&M.length===1;if($){let R=P()||L(M[0]);b(R),typeof window.aipkit_cw_resetBatchQueue=="function"&&window.aipkit_cw_resetBatchQueue()}if(h==="generate"&&!$){typeof window.aipkit_cw_handleBatchGeneration=="function"?window.aipkit_cw_handleBatchGeneration(_,x):console.error("Generate Button Listener: aipkit_cw_handleBatchGeneration function not found.");return}let W=document.getElementById("aipkit_cw_single_output_wrapper"),H=document.getElementById("aipkit_cw_output_card");W&&(W.style.display="block"),H&&(H.style.display="block"),y&&(y.style.display="block");let N=document.getElementById("aipkit_content_writer_stream_mode"),J=_.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),p&&(p.style.display="flex");let F={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[R,D]of Object.entries(F)){let Z=document.getElementById(D);Z&&!Z.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(R,"skipped")}let q=document.getElementById("aipkit_cw_generate_images_enabled"),O=document.getElementById("aipkit_cw_generate_featured_image");if(q&&O&&!q.checked&&!O.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),J){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),S&&(S.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(d,!0,"Generate","Generating...");let R=new FormData(_),D=Object.fromEntries(R.entries()),Z=_.elements["openai_vector_store_ids[]"];D.openai_vector_store_ids=Z?Array.from(Z.selectedOptions).map(Ae=>Ae.value):[],delete D["openai_vector_store_ids[]"];let Q=document.getElementById("aipkit_content_writer_nonce");D._ajax_nonce=Q?Q.value:"",window.aipkit_current_conversation_uuid&&(D.conversation_uuid=window.aipkit_current_conversation_uuid);let fe=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",D);if(fe&&fe.new_title){if(fe.conversation_uuid){window.aipkit_current_conversation_uuid=fe.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",fe.conversation_uuid)}catch{}}S&&(S.textContent=fe.new_title,S.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success")}else throw new Error(fe.message||"Failed to generate new title.")}catch(R){console.error("Title Generation Error:",R),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",R.message),m&&(m.textContent=i(R),m.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),S&&E&&(S.textContent=E.value.split("|")[0].trim(),S.style.display="block");!N||N.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(f):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),d.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=t})();(function(){"use strict";function k(o,r){o&&(o.dataset.listenerAttached||(o.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(r):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),o.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=k})();(function(){"use strict";function k(o,r){if(o===r)return!0;if(o==null||typeof o!="object"||r==null||typeof r!="object")return!1;let i=Object.keys(o),a=Object.keys(r);if(i.length!==a.length)return!1;for(let s of i)if(!a.includes(s)||!k(o[s],r[s]))return!1;return!0}window.aipkit_deepEqual=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_provider"),r=document.getElementById("aipkit_content_writer_temperature"),i=document.getElementById("aipkit_content_writer_post_author"),a=i?i.value:window.aipkit_dashboard?.currentUserId||"1",l=(o&&o.options.length>0?o.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),c=o?o.value.toLowerCase():l,n="",e=window.aipkit_dashboard?.models?.[c];switch(c){case"openai":n="gpt-4.1-mini";break;case"google":n="gemini-2.5-flash";break;case"openrouter":n="moonshotai/kimi-k2.5";break;case"claude":n="claude-opus-4-6",Array.isArray(e)&&e.length>0&&(e.some(p=>p&&p.id==="claude-opus-4-6")||(n=e[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(e)&&e.length>0?n=e[0].id||"":n="";break;default:n=""}let t=r&&r.defaultValue||"1.0",d=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:c,ai_model:n,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:t,reasoning_effort:"medium",post_type:"post",post_author:a,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:d.title,custom_content_prompt:d.content,generate_title:"1",generate_content:"1",generate_meta_description:"1",custom_meta_prompt:d.meta,generate_focus_keyword:"1",custom_keyword_prompt:d.keyword,generate_excerpt:"1",custom_excerpt_prompt:d.excerpt,generate_tags:"1",custom_tags_prompt:d.tags,custom_title_prompt_update:"",custom_content_prompt_update:"",custom_meta_prompt_update:"",custom_keyword_prompt_update:"",custom_excerpt_prompt_update:"",custom_tags_prompt_update:"",cw_generation_mode:"task",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"dall-e-3",image_prompt:d.image||"A high-quality, relevant image for an article about: {topic}",image_prompt_update:"",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",image_title_prompt:d.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt:d.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt:d.image_caption||"Write a short image caption based on: {topic}",image_description_prompt:d.image_description||"Write a brief image description based on: {topic}",image_title_prompt_update:d.image_title_update||d.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt_update:d.image_alt_text_update||d.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt_update:d.image_caption_update||d.image_caption||"Write a short image caption based on: {topic}",image_description_prompt_update:d.image_description_update||d.image_description||"Write a brief image description based on: {topic}",generate_featured_image:"0",featured_image_prompt:d.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",featured_image_prompt_update:"",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",vector_store_confidence_threshold:"20",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=k})();(function(){"use strict";function k(o){let r={};if(!o)return r;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","custom_title_prompt_update","custom_content_prompt_update","custom_meta_prompt_update","custom_keyword_prompt_update","custom_excerpt_prompt_update","custom_tags_prompt_update","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_prompt_update","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","image_title_prompt_update","image_alt_text_prompt_update","image_caption_prompt_update","image_description_prompt_update","featured_image_prompt","featured_image_prompt_update","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(v=>{o.elements[v]&&(r[v]=o.elements[v].value)});let a=o.elements.generate_meta_description;a?r.generate_meta_description=a.checked?"1":"0":r.generate_meta_description="0";let s=o.elements.generate_focus_keyword;s?r.generate_focus_keyword=s.checked?"1":"0":r.generate_focus_keyword="0";let l=o.elements.generate_excerpt;l?r.generate_excerpt=l.checked?"1":"0":r.generate_excerpt="0";let c=o.elements.generate_tags;c?r.generate_tags=c.checked?"1":"0":r.generate_tags="0";let n=o.elements.generate_title;n?r.generate_title=n.checked?"1":"0":r.generate_title="1";let e=o.elements.generate_content;e?r.generate_content=e.checked?"1":"0":r.generate_content="1";let t=o.elements.generate_toc;t?r.generate_toc=t.checked?"1":"0":r.generate_toc="0";let d=o.elements.generate_seo_slug;d?r.generate_seo_slug=d.checked?"1":"0":r.generate_seo_slug="0";let _=o.elements.generate_images_enabled;_?r.generate_images_enabled=_.checked?"1":"0":r.generate_images_enabled="0";let p=o.elements.generate_featured_image;p?r.generate_featured_image=p.checked?"1":"0":r.generate_featured_image="0",["generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(v=>{let L=o.elements[v];L?r[v]=L.checked?"1":"0":r[v]="1"});let f=o.elements.enable_vector_store;f?r.enable_vector_store=f.checked?"1":"0":r.enable_vector_store="0";let g=o.elements["openai_vector_store_ids[]"];g?r.openai_vector_store_ids=Array.from(g.selectedOptions).map(v=>v.value):r.openai_vector_store_ids=[];let m=o.querySelector("#aipkit_cw_prompt_mode_hidden_input");m?r.prompt_mode=m.value:r.prompt_mode="custom";let u=o.querySelector("#aipkit_cw_mode_select"),w=u?u.value:"task";r.cw_generation_mode=w==="single"?"task":w;let h=o.elements["post_categories[]"];h?r.post_categories=Array.from(h.selectedOptions).map(v=>v.value):r.post_categories=[];let C=["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt"],x=typeof window.aipkit_getContentWriterPromptSets=="function"?window.aipkit_getContentWriterPromptSets():null;return x&&x.create&&C.forEach(v=>{Object.prototype.hasOwnProperty.call(x.create,v)&&(r[v]=x.create[v])}),x&&x.update&&C.forEach(v=>{let L=`${v}_update`;Object.prototype.hasOwnProperty.call(x.update,v)&&(r[L]=x.update[v])}),r}window.aipkit_getContentWriterFormConfig=k})();(function(){"use strict";function k(o){if(!o||!o.value)return!1;let r=o.value,i=window.aipkit_cw_template_state.currentTemplates.find(a=>String(a.id)===String(r));return i&&String(i.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_post_status"),r=document.getElementById("aipkit_cw_schedule_options_wrapper"),i=document.getElementById("aipkit_cw_smart_schedule_fields"),a=document.querySelector(".aipkit_schedule_from_input_help"),s=document.querySelector(".aipkit_schedule_from_input_option");if(!o||!r)return;let l=o.value==="publish";r.style.display=l?"block":"none";let c=document.getElementById("aipkit_cw_mode_select"),n=c?c.value:"task",e=new Set(["task","csv","gsheets"]),t=e.has(n);if(s){s.style.display=t?"inline-flex":"none";let p=s.querySelector('input[name="schedule_mode"]');if(!t&&p&&p.checked){let f=document.querySelector('input[name="schedule_mode"][value="immediate"]');f&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(p=>{p.dataset.listenerAttached||(p.addEventListener("change",function(){let f=document.getElementById("aipkit_cw_mode_select"),g=f?f.value:"task",m=e.has(g);i&&(i.style.display=this.value==="smart"?"block":"none"),a&&(a.style.display=this.value==="from_input"&&m?"block":"none")}),p.dataset.listenerAttached="true")});let _=document.querySelector('input[name="schedule_mode"]:checked');_&&i&&(i.style.display=_.value==="smart"?"block":"none"),_&&a&&(a.style.display=_.value==="from_input"&&t?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(s){return s},o={image_title_prompt:"aipkit_cw_image_title_prompt",image_alt_text_prompt:"aipkit_cw_image_alt_text_prompt",image_caption_prompt:"aipkit_cw_image_caption_prompt",image_description_prompt:"aipkit_cw_image_description_prompt"};function r(s){if(!s)return"";let l=document.querySelector(`.aipkit_cw_prompt_library_select[data-aipkit-prompt-target="${CSS.escape(s)}"]`);if(!l)return"";let c=l.querySelector("option");return c?c.value:""}function i(){let s=document.getElementById("aipkit_cw_single_output_wrapper"),l=document.getElementById("aipkit_cw_generated_title_display"),c=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_cw_meta_chunk"),e=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),t=document.querySelector(".aipkit_content_writer_output_actions");s&&(s.style.display="none"),l&&(l.style.display="none",l.textContent=""),c&&(c.innerHTML=""),n&&(n.style.display="none"),e&&(e.style.display="none"),t&&(t.style.display="none"),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction()}function a(s,l=!1){let c=window.aipkit_cw_autosave_suspended===!0;window.aipkit_cw_autosave_suspended=!0;try{let n=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,e=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.currentTemplateId=s,s?sessionStorage.setItem("aipkit_cw_last_template_id",s):sessionStorage.removeItem("aipkit_cw_last_template_id");let t=window.aipkit_cw_template_state.currentTemplates.find(f=>String(f.id)===String(s)),d;if(t)d=JSON.parse(JSON.stringify(t.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),e&&!l&&e("Error: Cannot load default template.");return}d=window.aipkit_getDefaultContentWriterTemplateConfig()}let _=d&&d.template_scope==="prompts_only";_||(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(d)),window.aipkit_cw_template_state.currentTemplateModified=!1),i();let p=document.getElementById("aipkit_content_writer_form");if(!p){console.error("Apply Template: Content writer form not found.");return}if(!_&&d.ai_model&&p.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=d.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,d.image_model&&p.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=d.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,_){let f=document.getElementById("aipkit_cw_prompt_mode_hidden_input");f&&(f.value=d.prompt_mode||"custom"),["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt"].forEach(v=>{let L=Object.prototype.hasOwnProperty.call(d,v),P=p.elements[v];if(!P)return;let b=d[v]===null||typeof d[v]>"u"?"":d[v],y=!!o[v],S=typeof b=="string"?b.trim()==="":b==="";if((!L||S)&&y){P.value=r(o[v]);return}L&&(P.value=b)}),["generate_images_enabled","generate_featured_image","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(v=>{if(!Object.prototype.hasOwnProperty.call(d,v))return;let L=p.elements[v];if(!L)return;let P=d[v];L.checked=P==="1"||P===1||P===!0}),["generate_title","generate_content","generate_meta_description","generate_focus_keyword","generate_excerpt","generate_tags"].forEach(v=>{if(!Object.prototype.hasOwnProperty.call(d,v))return;let L=p.elements[v];if(!L)return;let P=d[v];L.checked=P==="1"||P===1||P===!0});let w=p.elements.content_length;w&&Object.prototype.hasOwnProperty.call(d,"content_length")&&(w.value=d.content_length||"medium",w.dispatchEvent(new Event("change",{bubbles:!0})));let h=p.elements.image_provider;h&&Object.prototype.hasOwnProperty.call(d,"image_provider")&&(h.value=d.image_provider||"",h.dispatchEvent(new Event("change",{bubbles:!0}))),["image_count","image_size","image_alignment","image_placement"].forEach(v=>{if(!Object.prototype.hasOwnProperty.call(d,v))return;let L=p.elements[v];if(!L)return;let P=d[v]===null||typeof d[v]>"u"?"":d[v];L.type==="checkbox"?L.checked=P==="1"||P===1||P===!0:L.value=P});let x=p.elements.image_model;if(x&&Object.prototype.hasOwnProperty.call(d,"image_model")){let v=d.image_model||"";v&&x.querySelector(`option[value="${CSS.escape(v)}"]`)&&(x.value=v)}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI()}else{["ai_provider","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(y=>{let S=p.elements[y];if(S){let E=Object.prototype.hasOwnProperty.call(d,y),A=d[y]===null||typeof d[y]>"u"?"":d[y],M=!!o[y],$=typeof A=="string"?A.trim()==="":A==="";if((!E||$)&&M){S.value=r(o[y]);return}if(y==="gsheets_credentials"&&typeof A=="object"&&A!==null)S.value=JSON.stringify(A,null,2);else if((y==="ai_temperature"||y==="vector_store_top_k"||y==="vector_store_confidence_threshold")&&S.type==="range"){S.value=A||(y==="ai_temperature"?"1.0":y==="vector_store_top_k"?"3":y==="vector_store_confidence_threshold"?"20":"");let W=document.getElementById(S.id+"_value");W&&(W.textContent=y==="vector_store_confidence_threshold"?S.value+"%":S.value)}else S.type==="checkbox"?S.checked=A==="1":S.value=A;y==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),y==="content_length"&&S.dispatchEvent(new Event("change",{bubbles:!0}))}});let g=p.elements.gsheets_credentials;if(g){let y=d.gsheets_credentials,S=g.closest(".aipkit_gsheets_section_container");g.value=typeof y=="object"&&y!==null?JSON.stringify(y,null,2):y||"",g.value?(g.dataset.filename="credentials.json",S&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(S),100)):(delete g.dataset.filename,S&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(S,"clear"))}let m={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",enable_vector_store:"0"};for(let[y,S]of Object.entries(m)){let E=p.elements[y];if(E){let A=Object.prototype.hasOwnProperty.call(d,y)?d[y]:S;E.checked=A==="1"||A===1||A===!0}}let u=document.getElementById("aipkit_cw_prompt_mode_hidden_input");u&&(u.value=d.prompt_mode||"custom");let w=p.querySelector("#aipkit_cw_mode_select"),h=d.cw_generation_mode||"task",C=h==="single"?"task":h;w&&(w.value=C,w.dispatchEvent(new Event("change",{bubbles:!0})));let x=p.elements["post_categories[]"];if(x){let y=Array.isArray(d.post_categories)?d.post_categories.map(S=>String(S)):[];Array.from(x.options).forEach(S=>{S.selected=y.includes(S.value)}),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect()}let v=p.elements["openai_vector_store_ids[]"];if(v){let y=Array.isArray(d.openai_vector_store_ids)?d.openai_vector_store_ids.map(String):[];Array.from(v.options).forEach(S=>{S.selected=y.includes(S.value)}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect()}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI();let L=p.elements.enable_vector_store;L&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(L.closest(".aipkit_popover_options_list")||L.closest(".aipkit_cw_settings_popover_body")||document.getElementById("aipkit_content_writer_container"));let P=p.elements.vector_store_provider;P&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(P.value=d.vector_store_provider||"openai",P.dispatchEvent(new Event("change",{bubbles:!0})));let b=p.elements.ai_provider;if(b){let y=b.value,S=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),E=(d.ai_provider||S).toLowerCase();if(y!==E)b.value=E,b.dispatchEvent(new Event("change",{bubbles:!0}));else{let A=p.elements.ai_model;A&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(b,A):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}b.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(s?b.dataset.aipkitProviderNoticeArmed="true":delete b.dataset.aipkitProviderNoticeArmed,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(p))}}if(typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts(),typeof window.aipkit_applyContentWriterPromptSets=="function"&&window.aipkit_applyContentWriterPromptSets(d),_&&(typeof window.aipkit_getContentWriterFormConfig=="function"&&(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=window.aipkit_getContentWriterFormConfig(p)),window.aipkit_cw_template_state.currentTemplateModified=!1),!l&&n&&n("Updated"),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(s),typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(s),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let f=document.getElementById("aipkit_content_writer_container");f&&window.aipkit_cw_toggleReasoningEffort(f)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers(),typeof window.aipkit_refreshUrlCounter=="function"&&window.aipkit_refreshUrlCounter(),typeof window.aipkit_refreshRssCounter=="function"&&window.aipkit_refreshRssCounter()}finally{c||(window.aipkit_cw_autosave_suspended=!1),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline()}}window.aipkit_applyContentWriterTemplate=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};async function o(r){if(!r){console.error("Fetch & Populate Templates: Select element is missing.");return}let i=document.getElementById("aipkit_content_writer_template_nonce_field"),a=typeof window.aipkit_clearGeneralStatus=="function"?window.aipkit_clearGeneralStatus:null,s=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;r.innerHTML=`<option value="">${k("Loading templates...")}</option>`,r.disabled=!0,a&&a();try{let l=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:i?i.value:""});window.aipkit_cw_template_state.currentTemplates=l.templates||[],r.innerHTML="";let c=new Option(k("-- Select Template --"),"");r.appendChild(c);let n=window.aipkit_cw_template_state.currentTemplates||[],e=window.aipkit_dashboard?.currentUserId?.toString(),t=null,d=[],_=[],p={};n.forEach(u=>{if(String(u.is_default)==="1"&&u.user_id.toString()===e&&(t=u.id),u.user_id.toString()===e)String(u.is_starter)==="1"||u.is_starter===!0?d.push(u):_.push(u);else{let w=u.display_name||`User ID: ${u.user_id}`;p[w]||(p[w]=[]),p[w].push(u)}});let f=u=>{if(u&&u.starter_order!==void 0&&u.starter_order!==null&&u.starter_order!==""){let x=Number(u.starter_order);if(Number.isFinite(x))return x}let h=(u&&u.template_name?String(u.template_name):"").match(/(\d[\d,]*)/);if(!h)return null;let C=parseInt(h[1].replace(/,/g,""),10);return Number.isFinite(C)?C:null};if(_.sort((u,w)=>u.is_default==="1"?-1:w.is_default==="1"?1:u.template_name.localeCompare(w.template_name)),d.sort((u,w)=>{let h=f(u),C=f(w);return h!==null&&C!==null?h-C:h!==null?-1:C!==null?1:u.template_name.localeCompare(w.template_name)}),d.length>0){let u=document.createElement("optgroup");u.label=k("Starter Templates"),d.forEach(w=>{u.appendChild(new Option(k(w.template_name),w.id))}),r.appendChild(u)}if(_.length>0){let u=document.createElement("optgroup");u.label=k("My Templates"),_.forEach(w=>{u.appendChild(new Option(k(w.template_name),w.id))}),r.appendChild(u)}Object.keys(p).sort().forEach(u=>{let w=document.createElement("optgroup");w.label=k(u),p[u].forEach(h=>{w.appendChild(new Option(k(h.template_name),h.id))}),r.appendChild(w)}),r.disabled=!1;let m=sessionStorage.getItem("aipkit_cw_last_template_id");m&&r.querySelector(`option[value="${CSS.escape(m)}"]`)?(r.value=m,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(m,!0)):t?(r.value=t,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(t,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}catch(l){console.error("Error fetching templates:",l),r.innerHTML=`<option value="">${k("Error loading templates")}</option>`,s&&s(`Error: ${l.message||"Failed to load templates."}`),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}}window.aipkit_fetchAndPopulateTemplates=o})();(function(){"use strict";async function k(o,r,i){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let a=document.getElementById("aipkit_content_writer_template_nonce_field"),s=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,l=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,c=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;s&&s("Updating...");try{let n=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:o,template_name:r,config:JSON.stringify(i),_ajax_nonce:a?a.value:""});l&&l("Updated"),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(n.template_config||i)),window.aipkit_cw_template_state.currentTemplateModified=!1,typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline();let e=document.getElementById("aipkit_cw_template_select"),t=n.template_id?String(n.template_id):"";t&&(window.aipkit_cw_template_state.currentTemplateId=t,sessionStorage.setItem("aipkit_cw_last_template_id",t)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&e&&(await window.aipkit_fetchAndPopulateTemplates(e),t&&(e.value=t,typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(t))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(t||window.aipkit_cw_template_state.currentTemplateId)}catch(n){console.error("Error saving template:",n),c&&c(`Error: ${n.message||"Failed to save template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_cw_rename_template_btn"),i=document.getElementById("aipkit_cw_delete_template_btn"),a=window.aipkit_dashboard||{},s=a.isAdmin||!1,l=a.currentUserId?String(a.currentUserId):"0",c=window.aipkit_cw_template_state.currentTemplates.find(d=>String(d.id)===String(o));if(!c){r&&(r.disabled=!0),i&&(i.disabled=!0);return}let n=String(c.user_id)===l,e=n||s,t=n||s;r&&(r.disabled=!e),i&&(i.disabled=!t)}window.aipkit_updateTemplateActionButtonsState=k})();(function(){"use strict";function k(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let o=document.getElementById("aipkit_content_writer_form");if(!o)return;let r=window.aipkit_getContentWriterFormConfig(o),i=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(r,i),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=k})();(function(){"use strict";function k(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),i=r.value,a=r.options[r.selectedIndex],s=a?a.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(a)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot rename the default template or no template is selected.",{title:"Template"}):alert("Cannot rename the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("rename",s)}window.aipkit_handleRenameContentWriterTemplate=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),i=r.value,a=r.options[r.selectedIndex],s=a?a.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete: core function missing.",{title:"Template"}):alert("Cannot delete: core function missing."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(a)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete the default template or no template is selected.",{title:"Template"}):alert("Cannot delete the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateDeleteConfirm(s)}window.aipkit_handleDeleteContentWriterTemplate=o})();(function(){"use strict";let k=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,o=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,r=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;async function i(){if(!window.aipkit_cw_template_state||window.aipkit_cw_template_state.isSavingOrDeleting)return;let s=document.getElementById("aipkit_content_writer_template_nonce_field"),l=document.getElementById("aipkit_cw_template_select");window.aipkit_cw_template_state.isSavingOrDeleting=!0,k&&k("Resetting starter templates...");try{await window.aipkit_apiRequest("aipkit_reset_cw_starter_templates",{_ajax_nonce:s?s.value:""}),sessionStorage.removeItem("aipkit_cw_last_template_id"),l&&typeof window.aipkit_fetchAndPopulateTemplates=="function"&&await window.aipkit_fetchAndPopulateTemplates(l),o&&o("Starter templates reset."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover()}catch(c){console.error("Error resetting starter templates:",c),r&&r(`Error: ${c.message||"Failed to reset starter templates."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}function a(){let s="Reset starter templates to their original defaults?",l="Starter Templates";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(s,{title:l,confirmText:"Reset",cancelText:"Cancel",onConfirm:i});return}window.confirm(s)&&i()}window.aipkit_handleResetStarterTemplates=a})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(p){return p},o={short:"Quick reads, ideal for news or updates",medium:"Standard blog posts with good depth",long:"In-depth guides and pillar content"};function r(p){let f=p.toLowerCase();return f.includes("short")?o.short:f.includes("medium")?o.medium:f.includes("long")?o.long:/\b600\b/.test(f)?o.short:/\b1200\b/.test(f)?o.medium:/\b2000\b/.test(f)?o.long:""}function i(p,f){if(f){let g=p.template_name.toLowerCase();return g.includes("short")?"dashicons-text-page":g.includes("medium")?"dashicons-text":g.includes("long")?"dashicons-media-document":"dashicons-star-filled"}return p.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function a(){return{select:document.getElementById("aipkit_cw_template_select"),button:document.getElementById("aipkit_cw_template_picker_btn"),label:document.getElementById("aipkit_cw_template_picker_label"),list:document.getElementById("aipkit_cw_template_picker_list"),search:document.getElementById("aipkit_cw_template_picker_search"),searchClear:document.getElementById("aipkit_cw_template_picker_search_clear")}}function s(p,f){let g=[],m=[],u={};p.forEach(C=>{if(C.user_id.toString()===f)String(C.is_starter)==="1"||C.is_starter===!0?g.push(C):m.push(C);else{let x=C.display_name||`User ID: ${C.user_id}`;u[x]||(u[x]=[]),u[x].push(C)}});let w=C=>{if(C&&C.starter_order!==void 0&&C.starter_order!==null&&C.starter_order!==""){let P=Number(C.starter_order);if(Number.isFinite(P))return P}let v=(C&&C.template_name?String(C.template_name):"").match(/(\d[\d,]*)/);if(!v)return null;let L=parseInt(v[1].replace(/,/g,""),10);return Number.isFinite(L)?L:null};g.sort((C,x)=>{let v=w(C),L=w(x);return v!==null&&L!==null?v-L:v!==null?-1:L!==null?1:C.template_name.localeCompare(x.template_name)}),m.sort((C,x)=>C.is_default==="1"?-1:x.is_default==="1"?1:C.template_name.localeCompare(x.template_name));let h={};return Object.keys(u).sort().forEach(C=>{h[C]=u[C].sort((x,v)=>x.template_name.localeCompare(v.template_name))}),{starterTemplates:g,myTemplates:m,otherUsersTemplates:h}}function l(p){let{label:f,button:g}=a();if(!f||!g||!p)return;let m=p.options[p.selectedIndex],u=m?m.text:k("Select template");f.textContent=u||k("Select template")}function c(p,f){if(!p)return;let g=String(f||"");p.querySelectorAll(".aipkit_cw_template_list_item").forEach(m=>{let w=(m.dataset.templateId||"")===g;m.classList.toggle("is-active",w),m.setAttribute("aria-selected",w?"true":"false")})}function n(p,f=""){let{list:g}=a();if(!g||!p)return;let m=window.aipkit_cw_template_state?.currentTemplates||[],u=window.aipkit_dashboard?.currentUserId?.toString();if(g.innerHTML="",!m.length){let b=p.disabled&&p.options.length&&p.options[0].text.toLowerCase().includes("loading"),y=document.createElement("div");y.className="aipkit_cw_template_picker_empty",y.textContent=k(b?"Loading templates...":"No templates found."),g.appendChild(y),l(p);return}let w=s(m,u),h=document.createDocumentFragment(),C=f.toLowerCase().trim(),x=(b,y)=>{let S=document.createElement("div");if(S.className="aipkit_cw_template_group_label",y){let A=document.createElement("span");A.className=`dashicons ${y}`,A.setAttribute("aria-hidden","true"),S.appendChild(A)}let E=document.createElement("span");return E.textContent=k(b),S.appendChild(E),S},v=(b,y)=>{let S=document.createElement("button");S.type="button",S.className="aipkit_cw_template_list_item",y&&S.classList.add("is-starter"),b.is_default==="1"&&S.classList.add("is-default"),S.dataset.templateId=String(b.id),S.dataset.templateLabel=b.template_name.toLowerCase(),S.setAttribute("role","option"),S.setAttribute("aria-selected","false");let E=i(b,y),A=document.createElement("span");A.className=`aipkit_cw_template_list_icon dashicons ${E}`,A.setAttribute("aria-hidden","true");let M=document.createElement("span");M.className="aipkit_cw_template_list_content";let $=document.createElement("span");if($.className="aipkit_cw_template_list_name",$.textContent=k(b.template_name),M.appendChild($),y){let H=r(b.template_name);if(H){let N=document.createElement("span");N.className="aipkit_cw_template_list_desc",N.textContent=k(H),M.appendChild(N)}}let W=document.createElement("span");return W.className="aipkit_cw_template_list_check dashicons dashicons-yes",W.setAttribute("aria-hidden","true"),S.appendChild(A),S.appendChild(M),S.appendChild(W),S},L=(b,y,S,E=!1)=>{let A=C?y.filter($=>$.template_name.toLowerCase().includes(C)):y;if(!A.length)return 0;let M=document.createElement("div");return M.className="aipkit_cw_template_group",E&&M.classList.add("is-starter-group"),M.appendChild(x(b,S)),A.forEach($=>{M.appendChild(v($,E))}),h.appendChild(M),A.length},P=0;if(P+=L("Starter Templates",w.starterTemplates,"dashicons-star-filled",!0),P+=L("My Templates",w.myTemplates,"dashicons-admin-users",!1),Object.keys(w.otherUsersTemplates).forEach(b=>{P+=L(b,w.otherUsersTemplates[b],"dashicons-groups",!1)}),P===0){let b=document.createElement("div");b.className="aipkit_cw_template_picker_empty",b.textContent=k(C?"No templates match your search.":"No templates found."),g.appendChild(b)}else g.appendChild(h);l(p),c(g,p.value)}function e(p){let{select:f}=a();f&&n(f,p)}function t(){let{search:p,searchClear:f}=a();if(!p)return;let g=null;p.addEventListener("input",u=>{let w=u.target.value;f&&(f.style.display=w?"flex":"none"),clearTimeout(g),g=setTimeout(()=>{e(w)},150)}),f&&f.addEventListener("click",()=>{p.value="",f.style.display="none",e(""),p.focus()});let m=document.getElementById("aipkit_cw_template_picker_popover");m&&new MutationObserver(w=>{w.forEach(h=>{h.attributeName==="aria-hidden"&&m.getAttribute("aria-hidden")==="true"&&p.value&&(p.value="",f&&(f.style.display="none"),e(""))})}).observe(m,{attributes:!0})}function d(){let{select:p,list:f,button:g}=a();!p||!f||(t(),f.dataset.listenerAttached||(f.addEventListener("click",m=>{let u=m.target.closest(".aipkit_cw_template_list_item");if(!u||!p)return;let w=u.dataset.templateId||"";p.value=w,p.dispatchEvent(new Event("change",{bubbles:!0})),c(f,w),g&&g.click()}),f.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",()=>{l(p),c(f,p.value)}),p.dataset.listenerAttached="true"),n(p))}function _(p){let{select:f,list:g}=a();f&&(p!==void 0&&(f.value=p),l(f),c(g,f.value))}window.aipkit_initTemplatePicker=d,window.aipkit_renderTemplatePicker=n,window.aipkit_updateTemplatePickerSelection=_})();(function(){"use strict";function k(){let a=document.getElementById("aipkit_cw_template_action_list"),s=document.getElementById("aipkit_cw_template_inline_form"),l=document.getElementById("aipkit_cw_template_inline_delete_confirm"),c=document.getElementById("aipkit_cw_template_name_input");a&&(a.style.display=""),s&&(s.style.display="none",delete s.dataset.mode),l&&(l.style.display="none"),c&&(c.value="")}function o(){k()}function r(a,s=""){let l=document.getElementById("aipkit_cw_template_inline_form"),c=document.getElementById("aipkit_cw_template_name_input"),n=document.getElementById("aipkit_cw_template_action_list");!l||!c||(n&&(n.style.display="none"),l.style.display="flex",l.dataset.mode=a,c.value=s,c.focus())}function i(){let a=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_name_input");!a||!s||o()}window.aipkit_showTemplateNameForm=r,window.aipkit_hideTemplateNameForm=i,window.aipkit_closeTemplateActionsPopover=o,window.aipkit_resetTemplateActionsPanel=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(i){let a=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_inline_delete_confirm"),l=document.getElementById("aipkit_cw_template_delete_confirm_text"),c=document.getElementById("aipkit_cw_template_action_list");!a||!s||!l||(a.style.display="none",c&&(c.style.display="none"),s.style.display="flex",l.innerHTML=`Delete "<strong>${k(i)}</strong>"?`)}function r(){let i=document.getElementById("aipkit_cw_template_inline_delete_confirm"),a=document.getElementById("aipkit_cw_template_action_list");i&&(i.style.display="none",a&&(a.style.display=""),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover())}window.aipkit_showTemplateDeleteConfirm=o,window.aipkit_hideTemplateDeleteConfirm=r})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_template_save_inline_btn"),r=document.getElementById("aipkit_cw_template_cancel_inline_btn"),i=document.getElementById("aipkit_cw_template_inline_form"),a=document.getElementById("aipkit_cw_template_name_input");if(!o||!r||!i||!a){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),o.addEventListener("click",async()=>{let s=i.dataset.mode,l=a.value.trim();if(!l){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}let c=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let e=window.aipkit_getContentWriterFormConfig(c);if(s==="new")await window.aipkit_saveContentWriterTemplate(0,l,e);else if(s==="rename"){let t=n.value;t&&await window.aipkit_saveContentWriterTemplate(parseInt(t),l,e)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_template_confirm_delete_btn"),r=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!o||!r){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),o.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),a=i.value,s=document.getElementById("aipkit_content_writer_template_nonce_field"),l=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,c=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,n=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.isSavingOrDeleting=!0,l&&l("Updating...");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:a,_ajax_nonce:s?s.value:""}),c&&c("Updated"),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(i)}catch(e){console.error("Error deleting template:",e),n&&n(`Error: ${e.message||"Failed to delete template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_template_select");if(!o){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(o):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?o.addEventListener("change",r=>window.aipkit_applyContentWriterTemplate(r.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_save_as_template_btn");if(!o){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_rename_template_btn");if(!o){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_delete_template_btn");if(!o){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_reset_starter_templates_btn");if(!o){console.warn("bindResetStarterTemplatesBtn: Button not found.");return}typeof window.aipkit_handleResetStarterTemplates=="function"?o.addEventListener("click",window.aipkit_handleResetStarterTemplates):console.error("bindResetStarterTemplatesBtn: handleResetStarterTemplates function missing.")}window.aipkit_bindResetStarterTemplatesBtn=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_post_status");if(!o){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(o.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=k})();(function(){"use strict";function k(){let o=document.querySelector(".aipkit_content_writer_inputs");if(!o){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(o.addEventListener("input",window.aipkit_checkFormForModifications),o.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=k})();(function(){"use strict";function k(){let o=["aipkit_initTemplateSelect","aipkit_initTemplatePicker","aipkit_bindSaveAsTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindResetStarterTemplatesBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let i of o)if(typeof window[i]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${i}`);return}window.aipkit_initTemplateSelect(),window.aipkit_initTemplatePicker(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindResetStarterTemplatesBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let r=document.getElementById("aipkit_cw_template_select");r&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(r.value):r&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){let i=document.getElementById("aipkit_cw_save_as_post_btn");if(!i){console.warn("Save as Post Handler: Button not found.");return}i.addEventListener("click",r)}async function r(){let i=document.getElementById("aipkit_content_writer_form"),a=document.getElementById("aipkit_cw_save_as_post_btn"),s=document.getElementById("aipkit_cw_generated_content_area"),l=document.getElementById("aipkit_content_writer_output_display"),c=document.getElementById("aipkit_cw_save_post_status");if(!i||!a||!s||!l||!c){console.error("Save as Post: Missing required UI elements.");return}let e=(typeof window.aipkit_getContentWriterRawHtml=="function"?window.aipkit_getContentWriterRawHtml():"")||s.innerHTML;if(!(s.textContent.trim().length>0||!!s.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))){c&&(c.textContent="Nothing to save. Please generate content first.",c.className="aipkit_cw_save_status aipkit_settings_message-error");return}let d=document.getElementById("aipkit_cw_generated_title_display"),_={post_title:d?d.textContent:"Untitled AI Post",post_content:e,generated_excerpt:i.elements.generated_excerpt?.value||"",generated_tags:i.elements.generated_tags?.value||"",meta_description:i.elements.meta_description?i.elements.meta_description.value:"",focus_keyword:i.elements.focus_keyword?i.elements.focus_keyword.value:"",post_type:i.elements.post_type?i.elements.post_type.value:"post",post_author:i.elements.post_author?i.elements.post_author.value:1,post_status:i.elements.post_status?i.elements.post_status.value:"draft",post_schedule_date:i.elements.post_schedule_date?i.elements.post_schedule_date.value:"",post_schedule_time:i.elements.post_schedule_time?i.elements.post_schedule_time.value:"",post_categories:i.elements["post_categories[]"]?Array.from(i.elements["post_categories[]"].selectedOptions).map(p=>p.value):[],generate_toc:i.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:i.elements.image_alignment?i.elements.image_alignment.value:"none",image_size:i.elements.image_size?i.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};c&&(c.textContent="Saving post...",c.className="aipkit_cw_save_status aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(a,!0,"Save","Saving...");try{let p=await window.aipkit_apiRequest("aipkit_content_writer_save_post",_);c&&(c.textContent=p.message||"Post saved successfully!",c.className="aipkit_cw_save_status aipkit_settings_message-success",p.edit_link&&(c.innerHTML+=` <a href="${k(p.edit_link)}" target="_blank">Edit Post</a>`))}catch(p){console.error("Error saving post:",p),c&&(c.textContent=`Error: ${p.message||"Failed to save post."}`,c.className="aipkit_cw_save_status aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(a,!1,"Save as Post"),setTimeout(()=>{c&&(c.textContent="",c.className="aipkit_cw_save_status")},5e3)}}window.aipkit_initSaveAsPostButton=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let r=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),a=document.getElementById("aipkit_content_writer_stop_btn"),s=document.getElementById("aipkit_content_writer_copy_btn"),l=document.getElementById("aipkit_content_writer_clear_btn"),c=document.getElementById("aipkit_content_writer_provider"),n=document.getElementById("aipkit_content_writer_model"),e=document.getElementById("aipkit_content_writer_temperature"),t=document.getElementById("aipkit_cw_save_as_post_btn"),d=document.querySelector(".aipkit_cw_generation_status_indicators");if(!r||!i||!a||!s||!l||!c||!n||!e||!t){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(o):console.error("Content Writer Main: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initContentWriterAssistantSheet=="function"&&window.aipkit_initContentWriterAssistantSheet(o),typeof window.aipkit_initContentWriterPromptFlyouts=="function"?window.aipkit_initContentWriterPromptFlyouts(o):console.error("Content Writer Main: aipkit_initContentWriterPromptFlyouts function not found."),typeof window.aipkit_initContentWriterPromptModeManager=="function"?window.aipkit_initContentWriterPromptModeManager(o):console.error("Content Writer Main: aipkit_initContentWriterPromptModeManager function not found."),typeof window.aipkit_initContentWriterBulkEditor=="function"?window.aipkit_initContentWriterBulkEditor(o):console.error("Content Writer Main: aipkit_initContentWriterBulkEditor function not found."),typeof window.aipkit_initContentWriterGenerateMenu=="function"?window.aipkit_initContentWriterGenerateMenu():console.error("Content Writer Main: aipkit_initContentWriterGenerateMenu function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_content_writer_container"),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(o):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_initContentWriterExistingContent=="function"?window.aipkit_initContentWriterExistingContent(o):console.error("Content Writer Main: aipkit_initContentWriterExistingContent function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(c.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(o)}),n.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(o)}),window.aipkit_cw_toggleReasoningEffort(o)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_content_writer_container"):console.error("Content Writer Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"?window.aipkit_initContentWriterVectorStoreMultiSelect(o):console.error("Content Writer Main: aipkit_initContentWriterVectorStoreMultiSelect function not found."),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"?window.aipkit_initContentWriterCategoriesMultiSelect(o):console.error("Content Writer Main: aipkit_initContentWriterCategoriesMultiSelect function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(c,n,e,i,s,l):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initContentWriterAutosave=="function"?window.aipkit_initContentWriterAutosave():console.error("Content Writer Main: aipkit_initContentWriterAutosave function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let _=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;_&&typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),_&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():_&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),_&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():_&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(i,r,d,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(a,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){t&&(t.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){t&&(t.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=k})();(function(){"use strict";let k=!1,o=null,r=null,i=null,a=!1,s=null,l="aipkit_image_generator_status",c="aipkit_image_gen_preview_theme",n=["dark","light"];function e(){let F=document.getElementById("aipkit_image_generator_container");if(!F){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(F.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(O){console.error("AIPKit Image Generator: Error calling public UI initializer:",O);let R=document.getElementById("aipkit_public_image_results");R&&(R.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let O=document.getElementById("aipkit_public_image_results");O&&(O.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}N(F),W(F),S(F),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_image_generator_container"):console.error("AIPKit Image Generator: aipkit_initApiKeyToggles function not found.")}function t(){return document.getElementById(l)}function d(F,q){let O=t();if(!O)return;let R=O.classList.contains("aipkit_training_status");if(O.textContent=F||"",R){O.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),F&&O.classList.add("is-visible"),q&&O.classList.add(`is-${q}`);return}O.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),q==="success"?O.classList.add("aipkit_form-help-success"):q==="error"&&O.classList.add("aipkit_form-help-error")}function _(F=2500){i&&window.clearTimeout(i),i=window.setTimeout(()=>{d("","")},F)}function p(F){window.aipkit_dashboard||(window.aipkit_dashboard={});let q=window.aipkit_dashboard.providerStatus||{};q.replicate=!!String(F||"").trim(),window.aipkit_dashboard.providerStatus=q,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(document)}function f(){return document.getElementById("aipkit_image_generator_settings_form")}function g(){let F=f();if(!F)return console.error("AIPKit Image Settings: Settings form not found."),null;let q=new FormData(F);if(q.has("frontend_models")){let R=F.querySelector("#aipkit_image_gen_frontend_models");R&&R.value===""&&q.set("frontend_models","")}else{let R=F.querySelector("#aipkit_image_gen_frontend_models");R&&q.append("frontend_models",R.value||"")}let O={};return q.forEach((R,D)=>{O[D]=R}),Object.prototype.hasOwnProperty.call(O,"replicate_api_key")&&delete O.replicate_api_key,O}function m(F){if(!F)return"";let q={};return Object.keys(F).sort().forEach(O=>{q[O]=F[O]}),JSON.stringify(q)}function u(F){r=m(F)}function w(F){return m(F)!==r}function h(F){if(!(F||"").trim()||typeof window.aipkit_queueProviderSync!="function")return null;let O=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:D=>D;d(O("Syncing models...","gpt3-ai-content-generator"),"loading");let R=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return R&&typeof R.then=="function"&&R.then(()=>{d(O("Models synced!","gpt3-ai-content-generator"),"success"),_()}).catch(D=>{d(D?.message||O("Sync failed.","gpt3-ai-content-generator"),"error"),_(4e3)}),R}async function C(F){let q=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:O=>O;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Settings: aipkit_apiRequest not found.");return}d(q("Saving...","gpt3-ai-content-generator"),"loading");try{let O=await window.aipkit_apiRequest("aipkit_save_image_settings",F);return d(O.message||q("Settings saved!","gpt3-ai-content-generator"),"success"),_(),u(F),O}catch(O){throw d(O.message||q("Failed to save settings.","gpt3-ai-content-generator"),"error"),_(4e3),console.error("AIPKit Image Settings Save Error:",O),O}}async function x(F){let q=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:O=>O;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Generator: aipkit_apiRequest not found.");return}d(q("Saving...","gpt3-ai-content-generator"),"loading");try{let O=await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:F});return p(F),d(O.message||q("Replicate key saved!","gpt3-ai-content-generator"),"success"),_(),h(F),O}catch(O){throw d(O.message||q("Failed to save Replicate key.","gpt3-ai-content-generator"),"error"),_(4e3),console.error("AIPKit Replicate Key Save Error:",O),O}}function v(F){if(F){if(k){o=F;return}k=!0,C(F).catch(()=>{}).finally(()=>{if(k=!1,o){let q=o;o=null,w(q)&&v(q)}})}}function L(){let F=g();!F||!w(F)||v(F)}function P(){let F=g();F&&u(F)}function b(F){if(!F)return;let q="data-aipkit-image-autosave-attached";if(F.hasAttribute(q))return;let O=()=>{L()};F.addEventListener("change",R=>{let D=R.target;!D||!D.matches(".aipkit_autosave_trigger")||O()}),F.addEventListener("blur",R=>{let D=R.target;!D||!D.matches(".aipkit_autosave_trigger")||O()},!0),F.setAttribute(q,"true"),P()}function y(F){let q=F.querySelector("#aipkit_replicate_api_key");if(!q)return;let O="data-replicate-autosave-attached";if(q.hasAttribute(O))return;s=q.value||"",p(s);let R=()=>{let D=q.value||"";D===s||a||(a=!0,x(D).then(()=>{s=D}).catch(()=>{}).finally(()=>{a=!1;let Z=g();Z&&u(Z)}))};q.addEventListener("change",R),q.addEventListener("blur",R),q.setAttribute(O,"true")}function S(F){let q=F.querySelector("#aipkit_image_generator_settings_popover");if(!q)return;typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(F):console.error("AIPKit Image Generator: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),E(q);let O="data-token-listener-attached";q.hasAttribute(O)||(q.addEventListener("change",function(R){R.target.closest(".aipkit_token_limit_mode_select")&&A(q)}),q.setAttribute(O,"true")),A(q);try{M(q)}catch(R){console.error("AIPKit Image Settings: Failed to init model selector",R)}b(q),y(q)}function E(F){let q=F.querySelector("#aipkit_image_generator_settings_panel");if(!q)return;let O=Array.from(q.querySelectorAll("[data-aipkit-settings-panel]"));if(!O.length||q.dataset.panelsBound==="true")return;let R=F.querySelector(".aipkit_model_settings_popover_title"),D=F.querySelector(".aipkit_model_settings_popover_back"),Z=document.getElementById("aipkit_image_generator_settings_trigger"),Q={root:q.dataset.titleRoot||"Settings","token-management":q.dataset.titleTokenManagement||"Token Management",replicate:q.dataset.titleReplicate||"Replicate","ui-text":q.dataset.titleUiText||"UI Text","custom-css":q.dataset.titleCustomCss||"Custom CSS","provider-filtering":q.dataset.titleProviderFiltering||"Provider Filtering"},fe=null,Ae=We=>{let Ge=We||"root",it=q.querySelector(`[data-aipkit-settings-panel="${Ge}"]`)||q.querySelector('[data-aipkit-settings-panel="root"]');if(!it)return;let _t=it.dataset.aipkitSettingsPanel||"root";if(_t!==fe){if(O.forEach(mt=>{mt.hidden=mt!==it}),R&&(R.textContent=Q[_t]||Q.root),D&&(D.hidden=_t==="root"),_t==="token-management"&&A(F),_t==="replicate"){let mt=F.querySelector("#aipkit_replicate_api_key");h(mt?mt.value:"")}fe=_t,F.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))})}};q.addEventListener("click",We=>{let Ge=We.target.closest("[data-aipkit-panel-target]");Ge&&(We.preventDefault(),Ae(Ge.dataset.aipkitPanelTarget))}),D&&D.addEventListener("click",We=>{We.preventDefault(),Ae("root")}),Z&&Z.addEventListener("click",()=>{Ae("root")}),Ae("root"),q.dataset.panelsBound="true"}function A(F){if(!F)return;let q=F.querySelector(".aipkit_token_limit_mode_select"),O=F.querySelector(".aipkit_token_general_user_limit_field"),R=F.querySelector(".aipkit_token_role_limits_container");if(!q||!O||!R)return;let D=q.value;O&&(O.hidden=D!=="general"),R&&(R.hidden=D!=="role_based")}function M(F){let q=F.querySelector("#aipkit_image_gen_models_selector");if(!q||q.getAttribute("data-enhanced")==="true")return;let O=F.querySelector("#aipkit_image_gen_frontend_models"),R=q.dataset.initialValue||"",Z=!0&&R===""?[]:R.split(",").map(Ie=>Ie.trim()).filter(Boolean),Q=new Set(Z),fe=window.aipkit_image_generator_config_public||{},Ae=Ie=>{if(!Ie||typeof Ie!="object")return!1;let qt={image_output:!0,image_generation:!0};if(!Ie.capabilities||typeof Ie.capabilities!="object")return!0;let Wt={...qt,...Ie.capabilities};return!!(Wt.image_output||Wt.image_generation)},We=fe.azure_models||[];if((!We||We.length===0)&&window.aipkit_dashboard_providers)try{Array.isArray(window.aipkit_dashboard_providers.AzureImage)&&(We=window.aipkit_dashboard_providers.AzureImage.map(Ie=>typeof Ie=="string"?{id:Ie,name:Ie}:Ie))}catch{}let Ge=[{key:"openai",label:"OpenAI",type:"flat",models:(fe.openai_models||[]).map(Ie=>({id:Ie.id,name:Ie.name}))},{key:"openrouter",label:"OpenRouter",type:"flat",models:(fe.openrouter_image_models||[]).filter(Ie=>Ae(Ie)).map(Ie=>({id:Ie.id||Ie.name||Ie,name:Ie.name||Ie.id||Ie}))},{key:"azure",label:"Azure",type:"flat",models:We.map(Ie=>Ie.id?Ie:{id:Ie.id||Ie.name||Ie,name:Ie.name||Ie.id||Ie})},{key:"google",label:"Google",type:"grouped",models:fe.google_models||{}},{key:"replicate",label:"Replicate",type:"flat",models:(fe.replicate_models||[]).map(Ie=>Ie.id?Ie:{id:Ie.id||Ie.name||Ie,name:Ie.name||Ie.id||Ie})}].filter(Ie=>Ie.key==="azure"||Ie.key==="openrouter"?!0:Ie.models&&(Array.isArray(Ie.models)?Ie.models.length:Object.keys(Ie.models).length));q.innerHTML="",q.classList.add("aipkit_models_selector--ready");let it=document.createElement("input");it.type="search",it.placeholder="Filter models...",it.className="aipkit_models_selector-search",q.appendChild(it);let _t=document.createElement("div");_t.className="aipkit_models_selector-summary",q.appendChild(_t);let mt=document.createElement("div");mt.className="aipkit_models_selector-providers",q.appendChild(mt),Ge.forEach(Ie=>{let qt=document.createElement("div");qt.className="aipkit_models_selector-provider",qt.dataset.provider=Ie.key;let Wt=document.createElement("div");Wt.className="aipkit_models_selector-provider-header",Wt.innerHTML=`<strong>${Ie.label}</strong>`;let ui=document.createElement("div");ui.className="aipkit_models_selector-provider-actions";let ae=document.createElement("button");ae.type="button",ae.className="aipkit_btn aipkit_btn-xs",ae.textContent="All";let Ce=document.createElement("button");Ce.type="button",Ce.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",Ce.textContent="None",ui.appendChild(ae),ui.appendChild(Ce),Wt.appendChild(ui),qt.appendChild(Wt);let Le=document.createElement("div");Le.className="aipkit_models_selector-models";let Oe=$e=>{if(!$e||!$e.id)return;let He=$e.id,je=document.createElement("label");je.className="aipkit_models_selector-item",je.title=He;let Qe=document.createElement("input");Qe.type="checkbox",Qe.value=He,Qe.checked=Q.has(He),Qe.dataset.modelId=He,Qe.addEventListener("change",()=>{Nt(!0)});let xt=document.createElement("span");xt.textContent=$e.name||He,je.appendChild(Qe),je.appendChild(xt),Le.appendChild(je)};if(Ie.type==="grouped"?Object.keys(Ie.models).forEach($e=>{let He=Ie.models[$e];if(!Array.isArray(He))return;let je=document.createElement("div");je.className="aipkit_models_selector-subgroup",je.textContent=$e.charAt(0).toUpperCase()+$e.slice(1),Le.appendChild(je),He.forEach(Qe=>Oe(Qe))}):Ie.models.forEach($e=>Oe($e)),Ie.key==="azure"&&Ie.models.length===0){let $e=document.createElement("div");$e.className="aipkit_models_selector-empty",$e.textContent="No Azure image models found. Sync Azure Image models in the main Models settings first.",Le.appendChild($e)}if(Ie.key==="openrouter"&&Ie.models.length===0){let $e=document.createElement("div");$e.className="aipkit_models_selector-empty",$e.textContent="No image-capable OpenRouter models found. Sync OpenRouter models in the main Models settings first.",Le.appendChild($e)}ae.addEventListener("click",()=>{Le.querySelectorAll('input[type="checkbox"]').forEach($e=>{$e.checked=!0}),Nt(!0)}),Ce.addEventListener("click",()=>{Le.querySelectorAll('input[type="checkbox"]').forEach($e=>{$e.checked=!1}),Nt(!0)}),qt.appendChild(Le),mt.appendChild(qt)}),it.addEventListener("input",()=>{let Ie=it.value.toLowerCase();mt.querySelectorAll(".aipkit_models_selector-item").forEach(qt=>{let Wt=qt.textContent.toLowerCase();qt.style.display=Wt.includes(Ie)?"":"none"})}),q.setAttribute("data-enhanced","true"),Ot();function Ot(){let Ie=Array.from(q.querySelectorAll(".aipkit_models_selector-item input:checked")).map(qt=>qt.value);Ie.length===0?_t.textContent="Showing all models (none selected)":_t.textContent=`${Ie.length} model${Ie.length>1?"s":""} selected`}function Nt(Ie=!1){let qt=Array.from(q.querySelectorAll(".aipkit_models_selector-item input:checked")).map(Wt=>Wt.value.trim()).filter(Boolean);O&&(O.value=qt.join(", ")),Ot(),Ie&&L()}window.aipkit_syncAllowedModelsHiddenField=Nt}function $(F=!1){typeof window.aipkit_syncAllowedModelsHiddenField=="function"&&window.aipkit_syncAllowedModelsHiddenField(F)}function W(F){let q=F.querySelector("#aipkit_theme_switcher_toggle_btn"),O=F.querySelector(".aipkit_image_generator_admin_preview_wrapper");if(!q||!O){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",F);return}let R=n.indexOf(localStorage.getItem(c)||"dark");R===-1&&(R=n.indexOf("dark")),H(n[R],O,q),q.hasAttribute("data-listener-attached")||(q.addEventListener("click",function(){R=(R+1)%n.length;let D=n[R];H(D,O,q),localStorage.setItem(c,D)}),q.setAttribute("data-listener-attached","true"))}function H(F,q,O){let R=q.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");R&&(n.forEach(Q=>R.classList.remove(`aipkit-theme-${Q}`)),R.classList.add(`aipkit-theme-${F}`));let D=F.charAt(0).toUpperCase()+F.slice(1),Z="Toggle Preview Theme";O.title=`${Z} (Current: ${D})`}function N(F){let q=F.querySelector("#aipkit_image_generator_shortcode_snippet"),O=F.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),R=F.querySelector("#aipkit_image_generator_shortcode_configurator"),D=F.querySelector("#aipkit_image_generator_shortcode_configurator .aipkit_model_settings_popover_close"),Z=F.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!q||!O||!R||Z.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",F);return}O.hasAttribute("data-listener-attached")||(O.addEventListener("click",()=>{let Q=R.style.display==="none"||!R.style.display;R.style.display=Q?"flex":"none",O.classList.toggle("aipkit_active",Q),O.setAttribute("aria-expanded",Q.toString())}),D&&D.addEventListener("click",()=>{R.style.display="none",O.classList.remove("aipkit_active"),O.setAttribute("aria-expanded","false")}),G(R),Z.forEach(Q=>Q.addEventListener("change",()=>{Q.name==="cfg_mode"&&G(R),J(F)})),q.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(q.textContent,q):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),J(F),O.setAttribute("data-listener-attached","true"))}function G(F){if(!F)return;let q=F.querySelector('select[name="cfg_mode"]');if(!q)return;let O=F.querySelector(".aipkit_image_shortcode_default_mode_row"),R=F.querySelector(".aipkit_image_shortcode_mode_switch_row"),D=F.querySelector('select[name="cfg_default_mode"]'),Z=F.querySelector('input[name="cfg_show_mode_switch"]'),Q=q.value==="both";O&&(O.hidden=!Q),R&&(R.hidden=!Q),Q||(D&&(D.value=q.value==="edit"?"edit":"generate"),Z&&(Z.checked=!0))}function J(F){let q=F.querySelector("#aipkit_image_generator_shortcode_snippet"),O=F.querySelector("#aipkit_image_generator_shortcode_configurator");if(!q||!O)return;let R=O.querySelector('input[name="cfg_show_provider"]').checked,D=O.querySelector('input[name="cfg_show_model"]').checked,Z=O.querySelector('input[name="cfg_show_history"]').checked,Q=O.querySelector('select[name="cfg_mode"]'),fe=O.querySelector('select[name="cfg_default_mode"]'),Ae=O.querySelector('input[name="cfg_show_mode_switch"]'),We=O.querySelector('select[name="cfg_theme"]'),Ge=O.querySelector('input[name="cfg_theme"]:checked'),it=We?We.value:Ge?Ge.value:"dark",_t=Q?Q.value:"generate",mt=fe?fe.value:"generate",Ot=Ae?Ae.checked:!0,Nt="[aipkit_image_generator";R||(Nt+=' show_provider="false"'),D||(Nt+=' show_model="false"'),Z&&(Nt+=' history="true"'),_t!=="generate"&&(Nt+=` mode="${_t}"`),_t==="both"&&mt!=="generate"&&(Nt+=` default_mode="${mt}"`),_t==="both"&&!Ot&&(Nt+=' show_mode_switch="false"'),it!=="dark"&&(Nt+=` theme="${it}"`),Nt+="]",q.textContent=Nt}window.aipkit_initImageGenerator=e})();(function(){"use strict";function k(o,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_title,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let c={_ajax_nonce:s,post_id:o};window.aipkit_apiRequest("aipkit_generate_title_suggestions",c).then(n=>{if(!n?.suggestions||n.suggestions.length===0)throw new Error(l.no_suggestions_title||"No title suggestions generated.");typeof r=="function"&&r(null,n.suggestions,i)}).catch(n=>{console.error("AIPKit Post Enhancer Fetcher (Title):",n),typeof r=="function"&&r(n,null,i)})}window.aipkit_fetchTitleSuggestions=k})();(function(){"use strict";let k=null;function o(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function r(s,l,c){k&&o();let n=window.aipkit_escapeHtml||function(u){return u},e=window.aipkit_escapeAttribute||n,t=c?.default_ai_provider||"N/A",d=c?.default_ai_model||"N/A",_=c?.default_ai_params||{},p=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",g=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${n(t)}</strong>`).replace("%2$s",`<strong>${n(d)}</strong>`).replace("%3$s",n(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",u=>{u.target===k&&o()});let m=document.createElement("div");return m.className="aipkit-modal-content",m.dataset.postId=s,m.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${n(l.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${n(l.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${g}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,k.appendChild(m),document.body.appendChild(k),m.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let n=window.aipkit_escapeHtml||function(d){return d},e=window.aipkit_escapeAttribute||n;c.innerHTML=`
            <p>${n(l.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(d=>`<li data-new-title="${e(d)}">${n(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let t=c.querySelector(".aipkit-suggestions-list");t&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(t):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let n=window.aipkit_escapeHtml||function(e){return e};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${n(l.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${n(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=r,window.aipkit_updateModalWithSuggestions=i,window.aipkit_updateModalWithError=a,window.aipkit_closePostTitleModal=o})();(function(){"use strict";let k=!1;function o(){k=!1}function r(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),n=c?.dataset.postId,e=l.dataset.newTitle,t=c?.querySelector(".aipkit-modal-status"),d=c?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!n||!e||!t||!d){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),t&&(t.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),k=!1;return}d.forEach(p=>p.classList.add("aipkit-disabled")),t.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_title||"Updating Title..."}`,t.style.color="",i(n,e,t,d,_)}function i(s,l,c,n,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',n.forEach(_=>_.classList.remove("aipkit-disabled")),k=!1;return}let t=window.aipkit_post_enhancer?.nonce_update_title;if(!t){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',n.forEach(_=>_.classList.remove("aipkit-disabled")),k=!1;return}let d={_ajax_nonce:t,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_title",d).then(_=>{let p=document.querySelector(`#post-${s} .row-title`);p?p.textContent=l:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${s}.`);let f=document.getElementById(`post-${s}`);if(f){let g=f.querySelector(`#inline_${s}`);if(g){let m=g.querySelector(".post_title");m?m.textContent=l:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${s}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${s}.`)}window.aipkit_closePostTitleModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Title):",_),c.innerHTML=`<span class="error">${_.message||e.error_updating_title||"Error updating title."}</span>`,n.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-title]");c&&r({currentTarget:c})})}window.aipkit_attachSuggestionClickListener=a,window.aipkit_resetTitleUpdateFlag=o})();(function(){"use strict";function k(o,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_excerpt,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let c={_ajax_nonce:s,post_id:o};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",c).then(n=>{if(!n?.suggestions||n.suggestions.length===0)throw new Error(l.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof r=="function"&&r(null,n.suggestions,i)}).catch(n=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",n),typeof r=="function"&&r(n,null,i)})}window.aipkit_fetchExcerptSuggestions=k})();(function(){"use strict";let k=null;function o(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function r(s,l,c){k&&o();let n=window.aipkit_escapeHtml||function(u){return u},e=window.aipkit_escapeAttribute||n,t=c?.default_ai_provider||"N/A",d=c?.default_ai_model||"N/A",_=c?.default_ai_params||{},p=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",g=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${n(t)}</strong>`).replace("%2$s",`<strong>${n(d)}</strong>`).replace("%3$s",n(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",u=>{u.target===k&&o()});let m=document.createElement("div");return m.className="aipkit-modal-content",m.dataset.postId=s,m.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${n(l.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${n(l.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${g}</p>
                </div>
            </div>
        `,k.appendChild(m),document.body.appendChild(k),m.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let n=window.aipkit_escapeHtml||function(d){return d},e=window.aipkit_escapeAttribute||n;c.innerHTML=`
            <p>${n(l.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(d=>`<li data-new-excerpt="${e(d)}">${n(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let t=c.querySelector(".aipkit-suggestions-list");t&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(t):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let n=window.aipkit_escapeHtml||function(e){return e};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${n(l.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${n(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=r,window.aipkit_updateModalWithExcerptSuggestions=i,window.aipkit_updateModalWithErrorExcerpt=a,window.aipkit_closePostExcerptModal=o})();(function(){"use strict";let k=!1;function o(){k=!1}function r(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),n=c?.dataset.postId,e=l.dataset.newExcerpt,t=c?.querySelector(".aipkit-modal-status"),d=c?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!n||e===void 0||!t||!d){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:n,newExcerpt:e,statusDiv:t,listItems:d}),t&&(t.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),k=!1;return}d.forEach(p=>p.classList.add("aipkit-disabled")),t.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_excerpt||"Updating Excerpt..."}`,t.style.color="",i(n,e,t,d,_)}function i(s,l,c,n,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',n.forEach(_=>_.classList.remove("aipkit-disabled")),k=!1;return}let t=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!t){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',n.forEach(_=>_.classList.remove("aipkit-disabled")),k=!1;return}let d={_ajax_nonce:t,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_excerpt",d).then(_=>{window.aipkit_closePostExcerptModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",_),c.innerHTML=`<span class="error">${_.message||e.error_updating_excerpt||"Error updating excerpt."}</span>`,n.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-excerpt]");c&&r({currentTarget:c})})}window.aipkit_attachExcerptSuggestionClickListener=a,window.aipkit_resetExcerptUpdateFlag=o})();(function(){"use strict";function k(o,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_meta,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let c={_ajax_nonce:s,post_id:o};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",c).then(n=>{if(!n?.suggestions||n.suggestions.length===0)throw new Error(l.no_suggestions_meta||"No meta description suggestions generated.");typeof r=="function"&&r(null,n.suggestions,i)}).catch(n=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",n),typeof r=="function"&&r(n,null,i)})}window.aipkit_fetchMetaSuggestions=k})();(function(){"use strict";let k=null;function o(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function r(s,l,c){k&&o();let n=window.aipkit_escapeHtml||function(u){return u},e=window.aipkit_escapeAttribute||n,t=c?.default_ai_provider||"N/A",d=c?.default_ai_model||"N/A",_=c?.default_ai_params||{},p=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",g=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${n(t)}</strong>`).replace("%2$s",`<strong>${n(d)}</strong>`).replace("%3$s",n(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",u=>{u.target===k&&o()});let m=document.createElement("div");return m.className="aipkit-modal-content",m.dataset.postId=s,m.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${n(l.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${e(l.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${n(l.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${g}</p>
                </div>
            </div>
        `,k.appendChild(m),document.body.appendChild(k),m.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let n=window.aipkit_escapeHtml||function(d){return d},e=window.aipkit_escapeAttribute||n;c.innerHTML=`
            <p>${n(l.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${s.map(d=>`<li data-new-meta="${e(d)}">${n(d)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let t=c.querySelector(".aipkit-suggestions-list");t&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(t):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let n=window.aipkit_escapeHtml||function(e){return e};c.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${n(l.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${n(s)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=r,window.aipkit_updateModalWithMetaSuggestions=i,window.aipkit_updateModalWithErrorMeta=a,window.aipkit_closePostMetaModal=o})();(function(){"use strict";let k=!1;function o(){k=!1}function r(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),n=c?.dataset.postId,e=l.dataset.newMeta,t=c?.querySelector(".aipkit-modal-status"),d=c?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!n||e===void 0||!t||!d){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:n,newMetaDesc:e,statusDiv:t,listItems:d}),t&&(t.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),k=!1;return}d.forEach(p=>p.classList.add("aipkit-disabled")),t.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_meta||"Updating Meta Desc..."}`,t.style.color="",i(n,e,t,d,_)}function i(s,l,c,n,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',n.forEach(_=>_.classList.remove("aipkit-disabled")),k=!1;return}let t=window.aipkit_post_enhancer?.nonce_update_meta;if(!t){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',n.forEach(_=>_.classList.remove("aipkit-disabled")),k=!1;return}let d={_ajax_nonce:t,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_meta_desc",d).then(_=>{try{let g=`${`#post-${s}`} .column-wpseo-metadesc`,m=document.querySelector(g);m&&(m.textContent=window.aipkit_escapeHtml(l),m.style.transition="background-color 0.1s ease-out",m.style.backgroundColor="#f0f7ff",setTimeout(()=>{m.style.backgroundColor=""},300))}catch(p){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",p)}window.aipkit_closePostMetaModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Meta):",_),c.innerHTML=`<span class="error">${_.message||e.error_updating_meta||"Error updating meta description."}</span>`,n.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-meta]");c&&r({currentTarget:c})})}window.aipkit_attachMetaSuggestionClickListener=a,window.aipkit_resetMetaUpdateFlag=o})();(function(){"use strict";function k(o,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let a=window.aipkit_post_enhancer,s=a?.nonce_generate_tags,l=a?.text||{};if(!s){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let c={_ajax_nonce:s,post_id:o};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",c).then(n=>{if(!n?.suggestions||n.suggestions.length===0)throw new Error(l.no_suggestions_tags||"No tag suggestions generated.");typeof r=="function"&&r(null,n.suggestions,i)}).catch(n=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",n),typeof r=="function"&&r(n,null,i)})}window.aipkit_fetchTagsSuggestions=k})();(function(){"use strict";let k=null;function o(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function r(s,l,c){k&&o();let n=window.aipkit_escapeHtml||(u=>u),e=window.aipkit_escapeAttribute||n,t=c?.default_ai_provider||"N/A",d=c?.default_ai_model||"N/A",_=c?.default_ai_params||{},p=_.temperature!==void 0?parseFloat(_.temperature).toFixed(1):"N/A",g=(l.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${n(t)}</strong>`).replace("%2$s",`<strong>${n(d)}</strong>`).replace("%3$s",n(p));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",u=>{u.target===k&&o()});let m=document.createElement("div");return m.className="aipkit-modal-content",m.dataset.postId=s,m.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${n(l.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${e(l.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${n(l.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${g}</p>
            </div>
        </div>
    `,k.appendChild(m),document.body.appendChild(k),m.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>k.classList.add("aipkit-active")),k}function i(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let n=window.aipkit_escapeHtml||(d=>d),e=window.aipkit_escapeAttribute||n;c.innerHTML=`
        <p>${n(l.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${s.map(d=>`<li data-new-tags="${e(d)}">${n(d)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let t=c.querySelector(".aipkit-suggestions-list");t&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(t):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function a(s,l){if(!k)return;let c=k.querySelector(".aipkit-modal-body");if(!c)return;let n=window.aipkit_escapeHtml||(e=>e);c.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${n(l.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${n(s)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=r,window.aipkit_updateModalWithTagsSuggestions=i,window.aipkit_updateModalWithErrorTags=a,window.aipkit_closePostTagsModal=o})();(function(){"use strict";let k=!1;function o(){k=!1}function r(s){if(k)return;k=!0;let l=s.currentTarget,c=l.closest(".aipkit-modal-content"),n=c?.dataset.postId,e=l.dataset.newTags,t=c?.querySelector(".aipkit-modal-status"),d=c?.querySelectorAll(".aipkit-suggestions-list li"),_=window.aipkit_post_enhancer?.text||{};if(!n||e===void 0||!t||!d){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:n,newTags:e,statusDiv:t,listItems:d}),t&&(t.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),k=!1;return}d.forEach(p=>p.classList.add("aipkit-disabled")),t.innerHTML=`<span class="aipkit_spinner"></span> ${_.updating_tags||"Updating Tags..."}`,t.style.color="",i(n,e,t,d,_)}function i(s,l,c,n,e){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),c.innerHTML='<span class="error">Error: Configuration missing.</span>',n.forEach(_=>_.classList.remove("aipkit-disabled")),k=!1;return}let t=window.aipkit_post_enhancer?.nonce_update_tags;if(!t){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),c.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',n.forEach(_=>_.classList.remove("aipkit-disabled")),k=!1;return}let d={_ajax_nonce:t,post_id:s,new_value:l};window.aipkit_apiRequest("aipkit_update_post_tags",d).then(_=>{let p=document.getElementById(`post-${s}`);if(p){let f=p.querySelector(".column-tags");f&&(f.textContent=l.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(_=>{console.error("AIPKit Post Enhancer Update Error (Tags):",_),c.innerHTML=`<span class="error">${_.message||e.error_updating_tags||"Error updating tags."}</span>`,n.forEach(p=>p.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function a(s){s&&s.addEventListener("click",function(l){let c=l.target.closest("li[data-new-tags]");c&&r({currentTarget:c})})}window.aipkit_attachTagsSuggestionClickListener=a,window.aipkit_resetTagsUpdateFlag=o})();(function(){"use strict";function k(o,r,i){let s=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorTags(o.message||s.error_loading_tags,s):r?window.aipkit_updateModalWithTagsSuggestions(r,s):window.aipkit_updateModalWithErrorTags(s.error_loading_tags||"Unknown error occurred.",s)}window.aipkit_handleTagsSuggestionsResult=k})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function k(n,e=60){return n.length<=e?n:n.substring(0,e-3)+"..."}function o(n,e="info"){let t=document.getElementById("aipkit-enhancer-bulk-status-log");if(t){let d=document.createElement("div");d.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${e}`,d.textContent=n,t.appendChild(d),t.scrollTop=t.scrollHeight}}function r(){let n=document.getElementById("aipkit-enhancer-bulk-progress-bar"),e=document.getElementById("aipkit-enhancer-progress-text"),t=document.getElementById("aipkit-enhancer-progress-stats");if(n&&window.aipkit_enhancer_bulkState.total>0){let d=window.aipkit_enhancer_bulkState.completed,_=window.aipkit_enhancer_bulkState.failed,p=window.aipkit_enhancer_bulkState.total,f=d+_,g=Math.round(f/p*100);n.style.width=`${g}%`,e&&(f===p?e.textContent="Update complete!":e.textContent=`Processing ${f+1} of ${p}...`),t&&(_>0?t.innerHTML=`${g}% \u2022 <span style="color: #28a745;">${d} successful</span> \u2022 <span style="color: #dc3545;">${_} failed</span>`:t.textContent=`${g}%`)}}function i(n){let e=document.getElementById("aipkit-enhancer-bulk-status-log");if(!e)return;let d=(window.aipkit_enhancer_postTitles||{})[n]||`Post #${n}`;d=k(d,60);let _=document.createElement("div");_.className="aipkit_enhancer_post_steps",_.id=`aipkit_enhancer_post_${n}_steps`;let p=document.createElement("div");p.className="aipkit_enhancer_post_header",p.innerHTML=`<strong>${d}</strong>`;let f=document.createElement("div");f.className="aipkit_enhancer_steps_container",f.id=`aipkit_enhancer_steps_${n}`,_.appendChild(p),_.appendChild(f),e.appendChild(_),e.scrollTop=e.scrollHeight;let g=[],m=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(u=>{m[u]&&m[u].prompt&&g.push({field:u,display_name:u.charAt(0).toUpperCase()+u.slice(1).replace("_"," ")})}),m.generate_seo_slug==="1"&&g.push({field:"slug",display_name:"URL"}),g.forEach(u=>{let w=document.createElement("div");w.className="aipkit_enhancer_step aipkit_enhancer_step--pending",w.id=`aipkit_enhancer_step_${n}_${u.field}`,w.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${u.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,f.appendChild(w)})}function a(n,e,t,d=""){let _=document.getElementById(`aipkit_enhancer_step_${n}_${e}`);if(!_)return;_.className=`aipkit_enhancer_step aipkit_enhancer_step--${t}`;let p="\u23F3",f="Pending";switch(t){case"processing":p="\u{1F504}",f="Processing...";break;case"completed":p="\u2705",f="Completed";break;case"error":p="\u274C",f="Failed";break;case"pending":p="\u23F3",f="Pending";break}_.querySelector(".aipkit_enhancer_step_icon").textContent=p,_.querySelector(".aipkit_enhancer_step_status").textContent=f,d&&(_.title=d);let g=document.getElementById("aipkit-enhancer-bulk-status-log");g&&(g.scrollTop=g.scrollHeight)}function s(n,e,t){let d=document.getElementById(`aipkit_enhancer_steps_${n}`);if(!d||t.length===0)return;let _=e.length+t.length,p=document.createElement("div");p.className="aipkit_enhancer_completion_message",e.length===0?p.innerHTML=`<strong style="color: #dc3545;">\u274C All ${_} enhancement steps failed!</strong>`:p.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${e.length} of ${_} steps. ${t.length} failed.</strong>`,d.appendChild(p);let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}function l(n,e){let t=document.getElementById(`aipkit_enhancer_steps_${n}`);if(!t)return;e.forEach(f=>{let g=document.getElementById(`aipkit_enhancer_step_${n}_${f.field}`);if(g){g.className=`aipkit_enhancer_step aipkit_enhancer_step--${f.status}`;let m="\u23F3";switch(f.status){case"completed":m="\u2705";break;case"error":m="\u274C";break;case"processing":m="\u{1F504}";break;case"pending":m="\u23F3";break}g.querySelector(".aipkit_enhancer_step_icon").textContent=m,g.querySelector(".aipkit_enhancer_step_status").textContent=f.status.charAt(0).toUpperCase()+f.status.slice(1),f.message&&(g.title=f.message)}});let d=e.filter(f=>f.status==="completed").length,_=e.length;if(d!==_){let f=document.createElement("div");f.className="aipkit_enhancer_completion_message";let g=e.filter(m=>m.status==="error").length;f.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${d} of ${_} steps. ${g} failed.</strong>`,t.appendChild(f)}let p=document.getElementById("aipkit-enhancer-bulk-status-log");p&&(p.scrollTop=p.scrollHeight)}function c(n,e){let t=document.getElementById(`aipkit_enhancer_steps_${n}`);if(!t)return;t.querySelectorAll(".aipkit_enhancer_step").forEach(f=>{f.classList.contains("aipkit_enhancer_step--completed")||(f.className="aipkit_enhancer_step aipkit_enhancer_step--error",f.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",f.querySelector(".aipkit_enhancer_step_status").textContent="Failed",f.title=e)});let _=document.createElement("div");_.className="aipkit_enhancer_completion_message",_.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${e}</strong>`,t.appendChild(_);let p=document.getElementById("aipkit-enhancer-bulk-status-log");p&&(p.scrollTop=p.scrollHeight)}window.aipkit_enhancer_logToModal=o,window.aipkit_enhancer_updateProgressBar=r,window.aipkit_enhancer_initStepProgress=i,window.aipkit_enhancer_updateFieldStatus=a,window.aipkit_enhancer_showPostCompletion=s,window.aipkit_enhancer_displayStepResults=l,window.aipkit_enhancer_showStepError=c,window.aipkit_enhancer_truncateTitle=k})();(function(){"use strict";function k(r="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let i=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!i)return;r==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let a=i.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");a&&(a.textContent="Start");let s=i.querySelector("#aipkit_bulk_enhancer_start_btn");s&&(s.disabled=!1,s.hidden=!0),i.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let l=i.querySelector("#aipkit_bulk_enhancer_cancel_btn");l&&(l.hidden=!1),i.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!1}function o(){let r=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!r)return;window.aipkit_enhancer_bulkState.isRunning&&k("user"),r.querySelector("#aipkit-enhancer-bulk-config").hidden=!1,r.querySelector("#aipkit-enhancer-bulk-progress").hidden=!0;let i=r.querySelector("#aipkit_bulk_enhancer_start_btn");i&&(i.disabled=!1,i.hidden=!1);let a=r.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");a&&(a.textContent="Start"),r.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let s=r.querySelector("#aipkit_bulk_enhancer_cancel_btn");s&&(s.hidden=!1),r.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0;let l=r.querySelector("#aipkit-enhancer-bulk-status-log");l&&(l.innerHTML="");let c=r.querySelector("#aipkit-enhancer-bulk-progress-bar");c&&(c.style.width="0%");let n=r.querySelector("#aipkit-enhancer-progress-text");n&&(n.textContent="Processing posts...");let e=r.querySelector("#aipkit-enhancer-progress-stats");e&&(e.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=k,window.aipkit_enhancer_returnToSettings=o})();(function(){"use strict";function k(n){let e=n.querySelector("#aipkit_bulk_ai_provider"),t=n.querySelector("#aipkit_bulk_ai_model"),d=n.querySelector(".aipkit_enhancer_reasoning_effort_field"),_=n.querySelector("#aipkit_bulk_reasoning_effort");if(!e||!t||!d||!_){d&&(d.style.display="none");return}let p=(e.value||"").toLowerCase(),g=(t.value||"").toLowerCase();if(!(p==="openai"&&r(g))){d.style.display="none";return}d.style.display="block",o(n,g)}function o(n,e){let t=n.querySelector("#aipkit_bulk_reasoning_effort");if(!t)return;let d=a(e),_=new Set(d.allowed),p=t.value||"";p==="minimal"&&(p="low"),Array.from(t.options).forEach(f=>{let g=_.has(f.value);f.hidden=!g,f.disabled=!g}),_.has(p)||(p=d.defaultValue),_.has(p)||(p=d.allowed[0]||""),p&&(t.value=p)}function r(n){if(i(n))return!1;let e=n.startsWith("o1")||n.startsWith("o3")||n.startsWith("o4"),t=n.includes("gpt-5");return e||t}function i(n){return/(?:^|[-_])chat(?:[-_]|$)/.test(n)}function a(n){return l(n)?{allowed:["high"],defaultValue:"high"}:n.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:s(n)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function s(n){let e=n.match(/gpt-5\.(\d+)/);if(e)return Number.parseInt(e[1],10)>=2;let t=n.match(/gpt-(\d+)/);return t?Number.parseInt(t[1],10)>=6:!1}function l(n){return/gpt-5(\.\d+)?-pro/.test(n)}function c(n,e){let t=n.value.toLowerCase(),_=(window.aipkit_dashboard?.models||{})[t]||[],p=window.aipkit_escapeHtml||(h=>h),f=window.wp?.i18n?.__||(h=>h),g=window.aipkit_dashboard?.recommendedModels?.[t]||[],m=Array.isArray(g)?g:[],u=new Set(m.map(h=>h?.id).filter(Boolean));if(e.innerHTML="",m.length>0){let h=document.createElement("optgroup");h.label=p(f("Recommended","gpt3-ai-content-generator")),m.forEach(C=>{C&&C.id&&h.appendChild(new Option(p(C.name||C.id),C.id))}),h.children.length>0&&e.appendChild(h)}if(t==="openai"&&typeof _=="object"&&!Array.isArray(_))Object.keys(_).forEach(h=>{let C=document.createElement("optgroup");C.label=p(h),Array.isArray(_[h])&&_[h].forEach(x=>{x&&x.id&&u.has(x.id)||x&&x.id&&C.appendChild(new Option(p(x.name||x.id),x.id))}),C.children.length>0&&e.appendChild(C)});else if(Array.isArray(_)){let h=m.length?document.createElement("optgroup"):null;h&&(h.label=p(f("All models","gpt3-ai-content-generator"))),_.forEach(C=>{if(!(C&&C.id&&u.has(C.id))&&C&&C.id){let x=new Option(p(C.name||C.id),C.id);h?h.appendChild(x):e.appendChild(x)}}),h&&h.children.length>0&&e.appendChild(h)}if(e.options.length===0)e.appendChild(new Option(p(`No models for ${n.value}`),"")),e.disabled=!0;else{e.disabled=!1;let h;switch(t){case"openai":h="gpt-4o-mini";break;case"google":h="gemini-1.5-flash-latest";break;case"openrouter":h="moonshotai/kimi-k2.5";break;case"claude":h="claude-opus-4-6",Array.isArray(_)&&_.length>0&&(_.some(x=>x&&x.id==="claude-opus-4-6")||(h=_[0].id||null));break;case"azure":case"deepseek":case"ollama":Array.isArray(_)&&_.length>0?h=_[0].id||null:h=null;break;default:h=null;break}h&&e.querySelector(`option[value="${CSS.escape(h)}"]`)?e.value=h:e.selectedIndex=0}let w=n.closest(".aipkit-enhancer-bulk-modal-overlay");w&&k(w)}window.aipkit_enhancer_populateBulkModels=c,window.aipkit_enhancer_toggleReasoningEffort=k})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],o=s=>{let l=parseInt(s,10);if(Number.isFinite(l)){if(l>=1&&l<=k.length)return k[l-1];let c=k.find(n=>n.tokens===l);if(c)return c}return k[1]};async function r(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let s=window.aipkit_enhancer_bulkState.queue.shift();await i(s),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(r,200)}async function i(s){try{let l=`enhancer-bulk-${s}-${Date.now()}`;typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(s);let c=window.aipkit_post_enhancer?.nonce_generate_title;if(!c)throw new Error("Security nonce not found.");let n=window.aipkit_enhancer_bulkState.enhancementsConfig,e=["keyword","title","excerpt","content","meta","tags"],t=[];e.forEach(p=>{n[p]&&n[p].prompt&&t.push(p)});let d=[],_=[];for(let p of t){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"processing");let f={_ajax_nonce:c,post_id:s,field:p,enhancer_source:"post_enhancer",enhancements:JSON.stringify({[p]:n[p],ai_provider:n.ai_provider,ai_model:n.ai_model,temperature:n.temperature,max_tokens:n.max_tokens,reasoning_effort:n.reasoning_effort,enable_vector_store:n.enable_vector_store,vector_store_provider:n.vector_store_provider,vector_store_top_k:n.vector_store_top_k,openai_vector_store_ids:n.openai_vector_store_ids,pinecone_index_name:n.pinecone_index_name,qdrant_collection_name:n.qdrant_collection_name,vector_embedding_provider:n.vector_embedding_provider,vector_embedding_model:n.vector_embedding_model}),conversation_uuid:l},g=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",f,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"completed",g.message),d.push(p)}catch(f){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,p,"error",f.message||"Processing failed"),_.push(p),console.error(`Failed to process field ${p} for post ${s}:`,f)}}if(n.generate_seo_slug==="1"&&d.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","processing");let p={_ajax_nonce:c,post_id:s,action_type:"update_slug",enhancer_source:"post_enhancer"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",p,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(s,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(s,d,_),d.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let f=(window.aipkit_enhancer_postTitles||{})[s]||`Post #${s}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(f=window.aipkit_enhancer_truncateTitle(f,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${f}". No fields were processed successfully.`,"error")}}catch(l){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(s,l.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let n=(window.aipkit_enhancer_postTitles||{})[s]||`Post #${s}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(n=window.aipkit_enhancer_truncateTitle(n,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${n}": ${l.message||"Unknown error"}`,"error")}}}function a(s){let l=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!l)return;let c={},n=l.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(n.length===0){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select at least one field to update.","error");return}n.forEach(h=>{let C=h.value,x=l.querySelector(`#aipkit_bulk_prompt_${C}`);x&&(c[C]={prompt:x.value})});let e=l.querySelector("#aipkit_bulk_ai_provider").value,t=l.querySelector("#aipkit_bulk_ai_model").value,d=l.querySelector("#aipkit_bulk_ai_temperature").value,_=l.querySelector("#aipkit_bulk_content_max_tokens"),p=o(_?_.value:""),f=l.querySelector("#aipkit_bulk_reasoning_effort").value;if(!e||!t){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select an AI Provider and Model.","error");return}c.ai_provider=e,c.ai_model=t,c.temperature=d,c.max_tokens=p.tokens,c.reasoning_effort=f;let g=l.querySelector("#aipkit_bulk_generate_seo_slug");g&&(c.generate_seo_slug=g.checked?"1":"0");let m=l.querySelector('input[name="enable_vector_store"]');if(m&&m.checked){if(c.enable_vector_store="1",c.vector_store_provider=l.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",c.vector_store_top_k=l.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,c.vector_store_provider==="openai"){let h=l.querySelector("#aipkit_bulk_openai_vector_store_ids");h&&(c.openai_vector_store_ids=Array.from(h.selectedOptions).map(C=>C.value))}else c.vector_store_provider==="pinecone"?c.pinecone_index_name=l.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":c.vector_store_provider==="qdrant"&&(c.qdrant_collection_name=l.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(c.vector_store_provider==="pinecone"||c.vector_store_provider==="qdrant")&&(c.vector_embedding_provider=l.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",c.vector_embedding_model=l.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else c.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...s],isRunning:!0,completed:0,failed:0,total:s.length,enhancementsConfig:c},l.querySelector("#aipkit-enhancer-bulk-config").hidden=!0,l.querySelector("#aipkit-enhancer-bulk-progress").hidden=!1;let u=l.querySelector("#aipkit_bulk_enhancer_start_btn");u&&(u.disabled=!0,u.hidden=!0),l.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!1;let w=l.querySelector("#aipkit_bulk_enhancer_cancel_btn");w&&(w.hidden=!0),l.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0,typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),r()}window.aipkit_enhancer_startBulkProcess=a})();(function(){"use strict";let k={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,isAutosaving:!1,autosaveSuspended:!1,autosaveTimer:null,autosaveDelay:800,lastSavedConfig:null,headerStatusTimeout:null,modalElement:null},o="aipkit_bulk_enhancer_selected_template",r=window.aipkit_escapeHtml||function(S){return S},i=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],a=()=>String(window.aipkit_post_enhancer?.default_ai_provider||"").trim().toLowerCase(),s=S=>{let E=parseInt(S,10);if(Number.isFinite(E)){if(E>=1&&E<=i.length)return i[E-1];let A=i.find(M=>M.tokens===E);if(A)return A}return i[1]},l=S=>{let E=S?.content_max_tokens??S?.max_tokens??S?.max_completion_tokens??"",A=parseInt(E,10);if(Number.isFinite(A)){let H=A>=1&&A<=i.length,N=i.some(G=>G.tokens===A);return H||N?s(A):A<=i[0].tokens?i[0]:A<=i[1].tokens?i[1]:i[2]}let M=String(S?.content_length||"").trim().toLowerCase(),$=i.find(H=>H.key===M);if($)return $;let W=parseInt(window.aipkit_post_enhancer?.default_ai_params?.max_completion_tokens??window.aipkit_post_enhancer?.default_ai_params?.max_tokens??"",10);return Number.isFinite(W)?W<=i[0].tokens?i[0]:W<=i[1].tokens?i[1]:i[2]:i[1]};function c(S){try{S&&String(S)!==""?localStorage.setItem(o,String(S)):localStorage.removeItem(o)}catch(E){console.warn("Failed to save template to localStorage:",E)}}function n(){try{return localStorage.getItem(o)}catch(S){return console.warn("Failed to load template from localStorage:",S),null}}function e(){let S=k.modalElement;if(!S)return{};let E={};["title","excerpt","content","meta","keyword","tags"].forEach(H=>{let N=S.querySelector(`#aipkit_bulk_enhance_${H}`),G=S.querySelector(`#aipkit_bulk_prompt_${H}`);N&&G&&(E[H]={enabled:N.checked?"1":"0",prompt:G.value})}),E.ai_provider=S.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",E.ai_model=S.querySelector("#aipkit_bulk_ai_model")?.value||"",E.ai_temperature=S.querySelector("#aipkit_bulk_ai_temperature")?.value;let M=S.querySelector("#aipkit_bulk_content_max_tokens"),$=s(M?M.value:"");E.content_max_tokens=String($.tokens),E.reasoning_effort=S.querySelector("#aipkit_bulk_reasoning_effort")?.value||"",E.generate_seo_slug=S.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let W=S.querySelector('input[name="enable_vector_store"]');if(W&&W.checked){if(E.enable_vector_store="1",E.vector_store_provider=S.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",E.vector_store_top_k=S.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",E.vector_store_provider==="openai"){let H=S.querySelector("#aipkit_bulk_openai_vector_store_ids");H&&(E.openai_vector_store_ids=Array.from(H.selectedOptions).map(N=>N.value))}else E.vector_store_provider==="pinecone"?E.pinecone_index_name=S.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":E.vector_store_provider==="qdrant"&&(E.qdrant_collection_name=S.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(E.vector_store_provider==="pinecone"||E.vector_store_provider==="qdrant")&&(E.vector_embedding_provider=S.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",E.vector_embedding_model=S.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else E.enable_vector_store="0";return E}function t(S){k.autosaveSuspended=!0,k.currentTemplateId=S,c(S),window.aipkit_bulk_template_state&&(window.aipkit_bulk_template_state.currentTemplateId=S),typeof window.aipkit_updateBulkTemplatePickerSelection=="function"&&window.aipkit_updateBulkTemplatePickerSelection(S,k.modalElement);let E=k.templates.find(R=>String(R.id)===String(S)),A=E?JSON.parse(JSON.stringify(E.config)):{};if(!A.content_max_tokens&&A.content_length){let R=i.find(D=>D.key===String(A.content_length).toLowerCase());A.content_max_tokens=String(R?.tokens||i[1].tokens)}Object.prototype.hasOwnProperty.call(A,"content_length")&&delete A.content_length,k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(A));let M=k.modalElement;if(!M)return;let $=M.querySelector("#aipkit_bulk_ai_provider"),W=M.querySelector("#aipkit_bulk_ai_model"),H=M.querySelector("#aipkit_bulk_ai_temperature"),N=M.querySelector("#aipkit_bulk_ai_temperature_value"),G=M.querySelector("#aipkit_bulk_content_max_tokens"),J=M.querySelector("#aipkit_bulk_content_max_tokens_value"),F=M.querySelector("#aipkit_bulk_reasoning_effort");if($){let R=a();$.value=A.ai_provider||R||"openai",$.dispatchEvent(new Event("change",{bubbles:!0}))}if(W&&A.ai_model&&setTimeout(()=>{W.querySelector(`option[value="${CSS.escape(A.ai_model)}"]`)&&(W.value=A.ai_model,W.dispatchEvent(new Event("change")))},150),H&&(H.value=A.ai_temperature||"1.0"),N&&(N.textContent=A.ai_temperature||"1.0"),G){let R=l(A),D=Math.max(0,i.findIndex(Z=>Z.key===R.key));G.value=String(D+1),J&&(J.textContent=`${R.words} words`)}F&&(F.value=A.reasoning_effort==="minimal"?"low":A.reasoning_effort||"",typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&window.aipkit_enhancer_toggleReasoningEffort(M)),["title","excerpt","content","meta","keyword","tags"].forEach(R=>{let D=M.querySelector(`#aipkit_bulk_enhance_${R}`),Z=M.querySelector(`#aipkit_bulk_prompt_${R}`);if(D&&Z){let Q=A[R]?.enabled==="1";D.checked!==Q&&(D.checked=Q,D.dispatchEvent(new Event("change"))),Z.value=A[R]?.prompt||Z.defaultValue}});let q=M.querySelector("#aipkit_bulk_generate_seo_slug");if(q){let R=A.generate_seo_slug==="1";q.checked!==R&&(q.checked=R,q.dispatchEvent(new Event("change")))}let O=M.querySelector('input[name="enable_vector_store"]');if(O&&(O.checked=A.enable_vector_store==="1",O.dispatchEvent(new Event("change"))),A.enable_vector_store==="1"){let R=M.querySelector("#aipkit_bulk_vector_store_provider");R&&(R.value=A.vector_store_provider||"openai",R.dispatchEvent(new Event("change",{bubbles:!0})));let D=M.querySelector("#aipkit_bulk_vector_store_top_k");if(D){D.value=A.vector_store_top_k||"3";let Z=M.querySelector("#aipkit_bulk_vector_store_top_k_value");Z&&(Z.textContent=D.value)}setTimeout(()=>{if(A.vector_store_provider==="openai"){let Z=M.querySelector("#aipkit_bulk_openai_vector_store_ids");Z&&Array.isArray(A.openai_vector_store_ids)&&Array.from(Z.options).forEach(Q=>{Q.selected=A.openai_vector_store_ids.includes(Q.value)})}else if(A.vector_store_provider==="pinecone"){let Z=M.querySelector("#aipkit_bulk_pinecone_index_name");Z&&(Z.value=A.pinecone_index_name||"",Z.dispatchEvent(new Event("change",{bubbles:!0})))}else if(A.vector_store_provider==="qdrant"){let Z=M.querySelector("#aipkit_bulk_qdrant_collection_name");Z&&(Z.value=A.qdrant_collection_name||"",Z.dispatchEvent(new Event("change",{bubbles:!0})))}if(A.vector_store_provider==="pinecone"||A.vector_store_provider==="qdrant"){let Z=M.querySelector("#aipkit_bulk_vector_embedding_provider"),Q=M.querySelector("#aipkit_bulk_vector_embedding_model");Z&&(Z.value=A.vector_embedding_provider||"openai",Z.dispatchEvent(new Event("change"))),Q&&A.vector_embedding_model&&setTimeout(()=>{Q.value=A.vector_embedding_model,Q.dispatchEvent(new Event("change",{bubbles:!0}))},150)}},100)}k.currentTemplateModified=!1,_(),window.clearTimeout(k.autosaveTimer),k.autosaveTimer=null,window.setTimeout(()=>{k.lastSavedConfig=e(),k.autosaveSuspended=!1},200)}function d(){let S=e();k.currentTemplateModified=!window.aipkit_deepEqual(S,k.initialConfigForSelectedTemplate),_(),v()}function _(){let S=k.modalElement;if(!S)return;let E=S.querySelector("#aipkit_enhancer_template_select").value,A=E&&String(E)!=="";S.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!A,S.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!A}function p(){let S=k.modalElement;if(!S)return;let E=S.querySelector("#aipkit_enhancer_template_action_list"),A=S.querySelector("#aipkit_enhancer_template_inline_form"),M=S.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),$=S.querySelector("#aipkit_enhancer_template_name_input");E&&(E.style.display=""),A&&(A.style.display="none",delete A.dataset.mode),M&&(M.style.display="none"),$&&($.value="")}function f(S,E=""){let A=k.modalElement;if(!A)return;let M=A.querySelector("#aipkit_enhancer_template_inline_form"),$=A.querySelector("#aipkit_enhancer_template_name_input"),W=A.querySelector("#aipkit_enhancer_template_action_list"),H=A.querySelector("#aipkit_enhancer_template_inline_delete_confirm");!M||!$||(W&&(W.style.display="none"),H&&(H.style.display="none"),M.style.display="flex",M.dataset.mode=S,$.value=E,$.focus())}function g(){p()}function m(S){let E=k.modalElement;if(!E)return;let A=E.querySelector("#aipkit_enhancer_template_inline_form"),M=E.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),$=E.querySelector("#aipkit_enhancer_template_delete_confirm_text"),W=E.querySelector("#aipkit_enhancer_template_action_list");!M||!$||(A&&(A.style.display="none"),W&&(W.style.display="none"),M.style.display="flex",$.innerHTML=`Delete "<strong>${r(S)}</strong>"?`)}function u(){p()}function w(S,E="info"){h(S,E)}function h(S,E="info"){let A=k.modalElement?.querySelector("#aipkit_bulk_autosave_status");if(A){if(k.headerStatusTimeout&&(clearTimeout(k.headerStatusTimeout),k.headerStatusTimeout=null),!S){A.textContent="",A.className="aipkit_cw_save_status aipkit_enhancer_modal_status";return}A.textContent=r(S),A.className=`aipkit_cw_save_status aipkit_enhancer_modal_status aipkit_settings_message-${E}`,E==="success"&&(k.headerStatusTimeout=setTimeout(()=>{A.textContent="",A.className="aipkit_cw_save_status aipkit_enhancer_modal_status"},2500))}}function C(){let S=k.currentTemplateId;if(!S)return null;let E="",A=k.templates.find($=>String($.id)===String(S));if(A?.template_name&&(E=A.template_name),!E){let $=k.modalElement?.querySelector("#aipkit_enhancer_template_select");$?.selectedOptions?.length&&(E=$.selectedOptions[0].textContent.trim())}let M=parseInt(S,10);return!E||Number.isNaN(M)?null:{id:M,name:E}}async function x(){if(k.autosaveSuspended||k.isSavingOrDeleting||k.isAutosaving)return;let S=e();if(!S||k.lastSavedConfig&&window.aipkit_deepEqual(S,k.lastSavedConfig))return;let E=C();if(E){k.isAutosaving=!0,h("Saving...","info");try{let A=window.aipkit_post_enhancer?.nonce_manage_templates;if(!A)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:E.id,template_name:E.name,config:JSON.stringify(S),template_type:"enhancer",_ajax_nonce:A}),k.lastSavedConfig=JSON.parse(JSON.stringify(S)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(S)),k.currentTemplateModified=!1,_(),h("Saved","success")}catch(A){h(`Error: ${A.message||"Failed to save."}`,"error"),console.error("Bulk Enhancer Auto-Save Error:",A)}finally{k.isAutosaving=!1}}}function v(){k.autosaveSuspended||k.isSavingOrDeleting||k.currentTemplateId&&(k.autosaveTimer&&clearTimeout(k.autosaveTimer),k.autosaveTimer=setTimeout(()=>{k.autosaveTimer=null,x()},k.autosaveDelay))}async function L(){let S=k.modalElement.querySelector("#aipkit_enhancer_template_select");S.innerHTML='<option value="">Loading...</option>',S.disabled=!0;try{let E=window.aipkit_post_enhancer?.nonce_manage_templates;if(!E)throw new Error("Security nonce for templates not found.");let A=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:E});k.templates=A.templates||[],S.innerHTML='<option value="">-- Select Template --</option>',k.templates.forEach($=>{S.appendChild(new Option(r($.template_name),$.id))}),S.disabled=!1;let M=n();M&&(k.templates.some(W=>String(W.id)===String(M))?(S.value=M,t(M)):c(null)),window.aipkit_bulk_template_state={templates:k.templates,currentTemplateId:k.currentTemplateId},typeof window.aipkit_renderBulkTemplatePicker=="function"&&window.aipkit_renderBulkTemplatePicker(k.modalElement)}catch(E){w("Error loading templates: "+E.message,"error")}}async function P(S,E){if(!k.isSavingOrDeleting){k.isSavingOrDeleting=!0,w("Saving template...","info");try{let A=e(),M=window.aipkit_post_enhancer?.nonce_manage_templates;if(!M)throw new Error("Security nonce for templates not found.");let $=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:S,template_name:E,config:JSON.stringify(A),template_type:"enhancer",_ajax_nonce:M});w($.message,"success"),await L(),k.modalElement.querySelector("#aipkit_enhancer_template_select").value=$.template_id,k.currentTemplateId=$.template_id,c($.template_id),k.currentTemplateModified=!1,k.lastSavedConfig=JSON.parse(JSON.stringify(A)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(A)),h("Saved","success"),_()}catch(A){w("Error saving: "+A.message,"error")}finally{k.isSavingOrDeleting=!1}}}async function b(){let S=k.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!S||k.isSavingOrDeleting)){k.isSavingOrDeleting=!0,w("Deleting...","info");try{let E=window.aipkit_post_enhancer?.nonce_manage_templates;if(!E)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:S,_ajax_nonce:E}),w("Template deleted.","success"),await L(),k.currentTemplateId=null;let A=n();A&&String(A)===String(S)&&c(null),k.lastSavedConfig=null,h("Template deleted","success"),_()}catch(E){w("Error deleting: "+E.message,"error")}finally{k.isSavingOrDeleting=!1}}}function y(S){k.modalElement=S;let E=S.querySelector("#aipkit_enhancer_template_select");E.addEventListener("change",J=>{h(""),p(),t(J.target.value)}),S.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{f("new")}),S.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let J=E.options[E.selectedIndex];k.currentTemplateId&&J&&f("rename",J.text)}),S.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",()=>{let J=E.options[E.selectedIndex];J&&m(J.text)});let A=S.querySelector("#aipkit_enhancer_template_inline_form"),M=S.querySelector("#aipkit_enhancer_template_save_inline_btn"),$=S.querySelector("#aipkit_enhancer_template_cancel_inline_btn"),W=S.querySelector("#aipkit_enhancer_template_name_input");M&&$&&A&&W&&($.addEventListener("click",g),M.addEventListener("click",async()=>{let J=A.dataset.mode,F=W.value.trim();if(!F){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}if(J==="new")await P(0,F);else if(J==="rename"){let q=E.value;q&&await P(parseInt(q,10),F)}g()}));let H=S.querySelector("#aipkit_enhancer_template_confirm_delete_btn"),N=S.querySelector("#aipkit_enhancer_template_cancel_delete_btn");H&&N&&(N.addEventListener("click",u),H.addEventListener("click",async()=>{await b(),u()})),L(),typeof window.aipkit_initBulkTemplatePicker=="function"&&window.aipkit_initBulkTemplatePicker(S);let G=J=>{J.target?.id!=="aipkit_enhancer_template_select"&&d()};S.addEventListener("input",G),S.addEventListener("change",G)}window.aipkit_enhancer_initTemplateControls=y,window.aipkit_enhancer_setHeaderStatus=h})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(_){return _},o=_=>_||document.querySelector(".aipkit_enhancer_bulk_modal");function r(_){let p=o(_);return{root:p,select:p?.querySelector("#aipkit_enhancer_template_select")||null,button:p?.querySelector("#aipkit_enhancer_template_picker_btn")||null,label:p?.querySelector("#aipkit_enhancer_template_picker_label")||null,list:p?.querySelector("#aipkit_enhancer_template_picker_list")||null,search:p?.querySelector("#aipkit_enhancer_template_picker_search")||null,searchClear:p?.querySelector("#aipkit_enhancer_template_picker_search_clear")||null,popover:p?.querySelector("#aipkit_enhancer_template_picker_popover")||null}}function i(_,p){let f=[],g={};_.forEach(u=>{if(!(String(u.is_starter)==="1"||u.is_starter===!0))if(p&&u.user_id?.toString()===p)f.push(u);else{let h=u.display_name||`User ID: ${u.user_id}`;g[h]||(g[h]=[]),g[h].push(u)}}),f.sort((u,w)=>u.is_default==="1"?-1:w.is_default==="1"?1:u.template_name.localeCompare(w.template_name));let m={};return Object.keys(g).sort().forEach(u=>{m[u]=g[u].sort((w,h)=>w.template_name.localeCompare(h.template_name))}),{myTemplates:f,otherUsersTemplates:m}}function a(_){return _.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function s(_,p){let{label:f}=r(p);if(!f||!_)return;let g=_.options[_.selectedIndex],m=g?g.text:k("Select template");f.textContent=m||k("Select template")}function l(_,p){if(!_)return;let f=String(p||"");_.querySelectorAll(".aipkit_cw_template_list_item").forEach(g=>{let u=(g.dataset.templateId||"")===f;g.classList.toggle("is-active",u),g.setAttribute("aria-selected",u?"true":"false")})}function c(_,p=""){let{select:f,list:g}=r(_);if(!f||!g)return;let m=window.aipkit_bulk_template_state?.templates||[],u=window.aipkit_dashboard?.currentUserId?.toString();if(g.innerHTML="",!m.length){let b=f.disabled&&f.options.length&&f.options[0].text.toLowerCase().includes("loading"),y=document.createElement("div");y.className="aipkit_cw_template_picker_empty",y.textContent=k(b?"Loading templates...":"No templates found."),g.appendChild(y),s(f,_);return}let w=i(m,u),h=document.createDocumentFragment(),C=p.toLowerCase().trim(),x=(b,y)=>{let S=document.createElement("div");if(S.className="aipkit_cw_template_group_label",y){let A=document.createElement("span");A.className=`dashicons ${y}`,A.setAttribute("aria-hidden","true"),S.appendChild(A)}let E=document.createElement("span");return E.textContent=k(b),S.appendChild(E),S},v=b=>{let y=document.createElement("button");y.type="button",y.className="aipkit_cw_template_list_item",b.is_default==="1"&&y.classList.add("is-default"),y.dataset.templateId=String(b.id),y.dataset.templateLabel=b.template_name.toLowerCase(),y.setAttribute("role","option"),y.setAttribute("aria-selected","false");let S=a(b),E=document.createElement("span");E.className=`aipkit_cw_template_list_icon dashicons ${S}`,E.setAttribute("aria-hidden","true");let A=document.createElement("span");A.className="aipkit_cw_template_list_content";let M=document.createElement("span");M.className="aipkit_cw_template_list_name",M.textContent=k(b.template_name),A.appendChild(M);let $=document.createElement("span");return $.className="aipkit_cw_template_list_check dashicons dashicons-yes",$.setAttribute("aria-hidden","true"),y.appendChild(E),y.appendChild(A),y.appendChild($),y},L=(b,y,S)=>{let E=C?y.filter(M=>M.template_name.toLowerCase().includes(C)):y;if(!E.length)return 0;let A=document.createElement("div");return A.className="aipkit_cw_template_group",A.appendChild(x(b,S)),E.forEach(M=>{A.appendChild(v(M))}),h.appendChild(A),E.length},P=0;if(P+=L("My Templates",w.myTemplates,"dashicons-admin-users"),Object.keys(w.otherUsersTemplates).forEach(b=>{P+=L(b,w.otherUsersTemplates[b],"dashicons-groups")}),P===0){let b=document.createElement("div");b.className="aipkit_cw_template_picker_empty",b.textContent=k(C?"No templates match your search.":"No templates found."),g.appendChild(b)}else g.appendChild(h);s(f,_),l(g,f.value)}function n(_,p){c(_,p)}function e(_){let{search:p,searchClear:f,popover:g}=r(_);if(!p)return;let m=null;p.addEventListener("input",u=>{let w=u.target.value;f&&(f.style.display=w?"flex":"none"),clearTimeout(m),m=setTimeout(()=>{n(_,w)},150)}),f&&f.addEventListener("click",()=>{p.value="",f.style.display="none",n(_,""),p.focus()}),g&&new MutationObserver(w=>{w.forEach(h=>{h.attributeName==="aria-hidden"&&g.getAttribute("aria-hidden")==="true"&&p.value&&(p.value="",f&&(f.style.display="none"),n(_,""))})}).observe(g,{attributes:!0})}function t(_){let{select:p,list:f,button:g}=r(_);!p||!f||(e(_),f.dataset.listenerAttached||(f.addEventListener("click",m=>{let u=m.target.closest(".aipkit_cw_template_list_item");if(!u||!p)return;let w=u.dataset.templateId||"";p.value=w,p.dispatchEvent(new Event("change",{bubbles:!0})),l(f,w),g&&g.click()}),f.dataset.listenerAttached="true"),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",()=>{s(p,_),l(f,p.value)}),p.dataset.listenerAttached="true"),c(_))}function d(_,p){let{select:f,list:g}=r(p);f&&(_!==void 0&&(f.value=_),s(f,p),l(g,f.value))}window.aipkit_initBulkTemplatePicker=t,window.aipkit_renderBulkTemplatePicker=c,window.aipkit_updateBulkTemplatePickerSelection=d})();(function(){"use strict";function k(o){let{postCount:r,providerOptions:i,defaultPrompts:a,promptLibrary:s,postType:l}=o,c=h=>String(h??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=h=>c(h).replace(/"/g,"&quot;").replace(/'/g,"&#39;"),e=(h=[])=>h.map(C=>!C?.label||!C?.prompt?"":`<option value="${n(C.prompt)}">${c(C.label)}</option>`).join(""),t=s||{},d=`<option value="${n(a.title||"")}">Default</option>${e(t.title)}`,_=`<option value="${n(a.content||"")}">Default</option>${e(t.content)}`,p=`<option value="${n(a.meta||"")}">Default</option>${e(t.meta)}`,f=`<option value="${n(a.keyword||"")}">Default</option>${e(t.keyword)}`,g=`<option value="${n(a.excerpt||"")}">Default</option>${e(t.excerpt)}`,m=`<option value="${n(a.tags||"")}">Default</option>${e(t.tags)}`,u="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}, {original_tags}, {categories}.";l==="product"&&(u+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),u=u.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let w="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}, {original_tags}, {categories}.";return l==="product"&&(w+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),w=w.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div id="aipkit_enhancer_bulk_modal" class="aipkit-modal-content aipkit-enhancer-bulk-modal-content aipkit_enhancer_bulk_modal" data-post-type="${n(l)}">
          <div class="aipkit-modal-header aipkit_enhancer_modal_header">
            <div class="aipkit_enhancer_header_left">
              <span class="aipkit_enhancer_header_icon" aria-hidden="true">
                <span class="dashicons dashicons-edit-large"></span>
              </span>
              <div class="aipkit_enhancer_header_text">
                <h3 class="aipkit-modal-title">Content Assistant</h3>
                <span class="aipkit_enhancer_modal_subtitle">Bulk content update</span>
              </div>
            </div>
            <div class="aipkit_enhancer_header_center">
              <div
                id="aipkit_bulk_autosave_status"
                class="aipkit_cw_save_status aipkit_enhancer_modal_status"
                aria-live="polite"
              ></div>
            </div>
            <div class="aipkit_enhancer_header_right">
              <button type="button" class="aipkit-modal-close-btn aipkit_enhancer_close_btn" aria-label="Close">\xD7</button>
            </div>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <div class="aipkit_enhancer_section aipkit_enhancer_engine_card">
                <div class="aipkit_enhancer_engine_fields">
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Template</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <button
                          type="button"
                          id="aipkit_enhancer_template_picker_btn"
                          class="aipkit_popover_option_btn aipkit_settings_select_picker_btn"
                          data-aipkit-popover-target="aipkit_enhancer_template_picker_popover"
                          data-aipkit-popover-placement="bottom"
                          data-aipkit-bulk-popover="templates"
                          aria-controls="aipkit_enhancer_template_picker_popover"
                          aria-expanded="false"
                        >
                          <span class="aipkit_settings_select_picker_label" id="aipkit_enhancer_template_picker_label">Select template</span>
                          <span class="dashicons dashicons-arrow-down-alt2" aria-hidden="true"></span>
                        </button>
                        <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_enhancer_engine_select screen-reader-text">
                        <option value="">-- Select Template --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Provider</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_provider" class="aipkit_enhancer_engine_select">${i}</select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Model</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_model" class="aipkit_enhancer_engine_select">
                          <option value="">-- Select Provider --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field aipkit_enhancer_engine_field--action">
                    <button
                      type="button"
                      class="aipkit_enhancer_settings_btn"
                      data-aipkit-popover-target="aipkit_bulk_settings_popover"
                      data-aipkit-popover-placement="bottom"
                      data-aipkit-bulk-popover="settings"
                      aria-controls="aipkit_bulk_settings_popover"
                      aria-expanded="false"
                      title="Advanced settings"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="aipkit_enhancer_section aipkit_enhancer_prompt_section"
                id="aipkit_bulk_prompt_section"
              >
                <div class="aipkit_enhancer_section_header">
                  <h4>What to update</h4>
                </div>
                <div class="aipkit_prompts_redesigned">
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="title">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Title</span>
                        <span class="aipkit_prompt_toggle_desc">Post title</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_title_prompt_flyout"
                          aria-controls="aipkit_bulk_title_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="content">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Content</span>
                        <span class="aipkit_prompt_toggle_desc">Rewrite the main body</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_content_prompt_flyout"
                          aria-controls="aipkit_bulk_content_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="meta">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Meta Description</span>
                        <span class="aipkit_prompt_toggle_desc">SEO snippet for search</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_meta_prompt_flyout"
                          aria-controls="aipkit_bulk_meta_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="keyword">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Focus Keyword</span>
                        <span class="aipkit_prompt_toggle_desc">Primary SEO keyword</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_keyword_prompt_flyout"
                          aria-controls="aipkit_bulk_keyword_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="excerpt">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Excerpt</span>
                        <span class="aipkit_prompt_toggle_desc">Short summary text</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_excerpt_prompt_flyout"
                          aria-controls="aipkit_bulk_excerpt_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="tags">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Tags</span>
                        <span class="aipkit_prompt_toggle_desc">Suggested tags list</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_tags_prompt_flyout"
                          aria-controls="aipkit_bulk_tags_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="seo_slug">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Optimize URL</span>
                        <span class="aipkit_prompt_toggle_desc">Generate a new slug</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1" class="aipkit_toggle_switch">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_bulk_settings_popover" data-aipkit-bulk-popover="settings" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_model_settings_popover_panel--wide aipkit_model_settings_popover_panel--allow-overflow aipkit_cw_settings_popover_panel" role="dialog" aria-label="Settings">
                <div class="aipkit_model_settings_popover_header">
                  <span class="aipkit_model_settings_popover_title">Settings</span>
                  <button type="button" class="aipkit_model_settings_popover_close" aria-label="Close">
                    <span class="dashicons dashicons-no-alt"></span>
                  </button>
                </div>
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_enhancer_settings_popover">
                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <!-- Sliders Row (2 columns) -->
                        <div class="aipkit_enhancer_sliders_row">
                          <!-- Temperature Slider (Creativity) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_temperature_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_ai_temperature">Creativity</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_ai_temperature_value">1.0</span>
                            </div>
                            <div class="aipkit_enhancer_temperature_slider_wrapper">
                              <div class="aipkit_enhancer_temperature_labels">
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--low">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                  Focused
                                </span>
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--high">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                  Creative
                                </span>
                              </div>
                              <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_enhancer_temperature_slider" min="0" max="2" step="0.1" value="1.0">
                            </div>
                          </div>

                          <!-- Max Tokens Slider (Content Length) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_tokens_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_content_max_tokens">Content Length</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_content_max_tokens_value">1200-1600 words</span>
                            </div>
                            <div class="aipkit_enhancer_tokens_slider_wrapper">
                              <div class="aipkit_enhancer_tokens_labels">
                                <span class="aipkit_enhancer_tokens_label">Short</span>
                                <span class="aipkit_enhancer_tokens_label">Medium</span>
                                <span class="aipkit_enhancer_tokens_label">Long</span>
                              </div>
                              <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_enhancer_tokens_slider" min="1" max="3" step="1" value="2">
                            </div>
                          </div>
                        </div>

                        <div class="aipkit_popover_option_row aipkit_enhancer_reasoning_effort_field">
                          <div class="aipkit_popover_option_main">
                            <div class="aipkit_popover_option_text">
                              <label class="aipkit_popover_option_label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                              <span class="aipkit_popover_option_helper">Controls thinking effort for supported models.</span>
                            </div>
                            <div class="aipkit_popover_option_actions">
                              <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_popover_option_select">
                                <option value="none">None</option>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="xhigh">XHigh</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <div class="aipkit_enhancer_vector_settings">
                      <!-- Enable Toggle -->
                      <div class="aipkit_enhancer_vector_toggle_card">
                        <div class="aipkit_enhancer_vector_toggle_row">
                          <div class="aipkit_enhancer_vector_toggle_info">
                            <span class="aipkit_enhancer_vector_toggle_label">Knowledge Base</span>
                            <span class="aipkit_enhancer_vector_toggle_desc">Use your vector stores for RAG-enhanced content</span>
                          </div>
                          <div class="aipkit_enhancer_vector_toggle_controls">
                            <label class="aipkit_switch">
                              <input type="checkbox" name="enable_vector_store" value="1" class="aipkit_toggle_switch">
                              <span class="aipkit_switch_slider"></span>
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Source Selector (shown when enabled) -->
                      <div class="aipkit_cw_vector_store_settings_container aipkit_enhancer_vector_source_container" hidden>
                        <div class="aipkit_enhancer_vector_source_selector">
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_store_provider">Provider</label>
                            <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="pinecone">Pinecone</option>
                              <option value="qdrant">Qdrant</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <!-- OpenAI Stores (Multiselect) -->
                            <div class="aipkit_cw_vector_openai_field">
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_openai_vector_store_ids">Vector Store</label>
                              <div
                                class="aipkit_popover_multiselect aipkit_vector_multiselect aipkit_enhancer_vector_multiselect"
                                data-aipkit-vector-stores-dropdown
                                data-placeholder="Select stores"
                                data-selected-label="selected"
                              >
                                <button
                                  type="button"
                                  class="aipkit_popover_multiselect_btn aipkit_vector_multiselect_btn aipkit_enhancer_vector_multiselect_btn"
                                  aria-expanded="false"
                                  aria-controls="aipkit_bulk_openai_vector_store_panel"
                                >
                                  <span class="aipkit_popover_multiselect_label">Select stores</span>
                                </button>
                                <div
                                  id="aipkit_bulk_openai_vector_store_panel"
                                  class="aipkit_popover_multiselect_panel aipkit_enhancer_vector_multiselect_panel"
                                  role="menu"
                                  hidden
                                >
                                  <div class="aipkit_popover_multiselect_options"></div>
                                </div>
                              </div>
                              <select
                                id="aipkit_bulk_openai_vector_store_ids"
                                name="openai_vector_store_ids[]"
                                class="aipkit_popover_multiselect_select"
                                multiple
                                size="3"
                                hidden
                                aria-hidden="true"
                                tabindex="-1"
                              ></select>
                            </div>
                            
                            <!-- Pinecone Index -->
                            <div class="aipkit_cw_vector_pinecone_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_pinecone_index_name">Index</label>
                              <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                            
                            <!-- Qdrant Collection -->
                            <div class="aipkit_cw_vector_qdrant_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                              <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                          </div>
                        </div>

                        <!-- Embedding Config (for Pinecone/Qdrant) -->
                        <div class="aipkit_cw_vector_embedding_config_row aipkit_enhancer_vector_embedding_selector" hidden>
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_provider">Embedding</label>
                            <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="google">Google</option>
                              <option value="azure">Azure</option>
                              <option value="openrouter">OpenRouter</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_model">Model</label>
                            <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_enhancer_vector_settings_select"></select>
                          </div>
                        </div>

                        <!-- Results Limit Slider -->
                        <div class="aipkit_vector_slider_group">
                          <div class="aipkit_vector_slider_header">
                            <label class="aipkit_vector_settings_label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                            <span class="aipkit_vector_slider_value" id="aipkit_bulk_vector_store_top_k_value">3</span>
                          </div>
                          <div class="aipkit_vector_slider_wrapper">
                            <div class="aipkit_vector_slider_labels">
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--min">
                                <span class="dashicons dashicons-minus" aria-hidden="true"></span>
                                Fewer
                              </span>
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--max">
                                More
                                <span class="dashicons dashicons-plus" aria-hidden="true"></span>
                              </span>
                            </div>
                            <input type="range" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_vector_slider" value="3" min="1" max="20" step="1">
                          </div>
                          <p class="aipkit_vector_slider_hint">Number of matching chunks to retrieve</p>
                        </div>
                      </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_enhancer_template_picker_popover" data-aipkit-bulk-popover="templates" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_cw_settings_popover_panel aipkit_cw_template_picker_popover_panel" role="dialog" aria-label="Templates">
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_cw_template_picker_search_wrap">
                    <span class="dashicons dashicons-search aipkit_cw_template_picker_search_icon" aria-hidden="true"></span>
                    <input
                      type="text"
                      id="aipkit_enhancer_template_picker_search"
                      class="aipkit_cw_template_picker_search"
                      placeholder="Search templates..."
                      autocomplete="off"
                    >
                    <button
                      type="button"
                      id="aipkit_enhancer_template_picker_search_clear"
                      class="aipkit_cw_template_picker_search_clear"
                      aria-label="Clear search"
                      style="display: none;"
                    >
                      <span class="dashicons dashicons-no-alt" aria-hidden="true"></span>
                    </button>
                  </div>
                  <div class="aipkit_cw_template_picker_list" id="aipkit_enhancer_template_picker_list" role="listbox" aria-label="Template list">
                    <div class="aipkit_cw_template_picker_empty">
                      Loading templates...
                    </div>
                  </div>
                  <div class="aipkit_cw_template_picker_actions">
                    <div class="aipkit_cw_template_action_list" id="aipkit_enhancer_template_action_list">
                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">
                        <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
                        New
                      </button>
                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        Rename
                      </button>
                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                        Delete
                      </button>
                    </div>
                    <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                      <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                    <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                      <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_title_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Title Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Title Prompt</span>
                    <select id="aipkit_bulk_title_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_title" title="Load template">
                      ${d}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_title" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.title||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="title" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_content_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Content Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Content Prompt</span>
                    <select id="aipkit_bulk_content_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_content" title="Load template">
                      ${_}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_content" class="aipkit_cw_prompt_editor_textarea" rows="10">${c(a.content||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="content" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_meta_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Meta Description Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Meta Description Prompt</span>
                    <select id="aipkit_bulk_meta_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_meta" title="Load template">
                      ${p}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_meta" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.meta||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="meta" data-label="Placeholders:" data-copy-title="Click to copy">${w}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_keyword_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Focus Keyword Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Focus Keyword Prompt</span>
                    <select id="aipkit_bulk_keyword_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_keyword" title="Load template">
                      ${f}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.keyword||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="keyword" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_excerpt_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Excerpt Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Excerpt Prompt</span>
                    <select id="aipkit_bulk_excerpt_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_excerpt" title="Load template">
                      ${g}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.excerpt||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="excerpt" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_tags_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Tags Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Tags Prompt</span>
                    <select id="aipkit_bulk_tags_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_tags" title="Load template">
                      ${m}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_tags" class="aipkit_cw_prompt_editor_textarea" rows="8">${c(a.tags||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="tags" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div id="aipkit-enhancer-bulk-progress" hidden>
              <div class="aipkit_enhancer_progress_header">
                <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
              </div>
              <div class="aipkit_progress_bar_container">
                <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled"></div>
              </div>
              <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <div class="aipkit_enhancer_footer_info">
              <div class="aipkit_enhancer_selection_badge">
                <span class="aipkit_enhancer_selection_count">${r}</span>
                <span class="aipkit_enhancer_selection_label">item${r===1?"":"s"} selected</span>
              </div>
            </div>
            <div class="aipkit_enhancer_footer_actions">
              <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-ghost" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span>Back</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                <span>Stop</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-success">
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                <span class="aipkit_btn-text">Start Processing</span>
                <span class="aipkit_spinner" hidden></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=k})();(function(){"use strict";function k(o,r){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let i={};o.forEach(f=>{let g=document.querySelector(`tr#post-${f}`);if(g){let m=g.querySelector(".row-title")||g.querySelector("strong a")||g.querySelector(".title a")||g.querySelector("a.row-title")||g.querySelector(".column-title strong a")||g.querySelector(".column-title .row-title");m&&(i[f]=m.textContent.trim())}i[f]||(i[f]=`Post #${f}`)}),window.aipkit_enhancer_postTitles=i;let a=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},s=window.aipkit_post_enhancer?.prompt_library||{},l=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],c=window.aipkit_post_enhancer?.default_ai_provider||"",n=String(c||"").trim().toLowerCase(),e={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",claude:"Claude",deepseek:"DeepSeek",ollama:"Ollama"},t=l.map(f=>{let g=f.toLowerCase();return`<option value="${g}" ${n&&g===n?"selected":""}>${e[g]||f.toUpperCase()}</option>`}).join(""),d=window.aipkit_enhancer_getBulkModalHtml({postCount:o.length,providerOptions:t,defaultPrompts:a,promptLibrary:s,postType:r});document.body.insertAdjacentHTML("beforeend",d);let _=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(_,o):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available.");let p=_.querySelector("#aipkit_bulk_ai_provider");p&&n&&Array.from(p.options).some(g=>g.value===n)&&(p.value=n,p.dispatchEvent(new Event("change",{bubbles:!0}))),requestAnimationFrame(()=>{_.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(b){return b},o=".aipkit_enhancer_bulk_modal",r=["#aipkit_bulk_ai_provider","#aipkit_bulk_ai_model","#aipkit_bulk_vector_store_provider","#aipkit_bulk_vector_embedding_provider","#aipkit_bulk_pinecone_index_name","#aipkit_bulk_qdrant_collection_name","#aipkit_bulk_vector_embedding_model"].join(", "),i=null,a=null,s=!1,l=new Set(["aipkit_bulk_ai_provider","aipkit_bulk_vector_store_provider","aipkit_bulk_vector_embedding_provider"]),c=b=>!!(b&&b.id&&l.has(b.id)),n=b=>String(b||"").trim().toLowerCase(),e=(b,y)=>{if(!b)return;let S="aipkit_settings_select_picker_icon--";b.classList.forEach(A=>{A.startsWith(S)&&b.classList.remove(A)}),b.classList.remove("is-hidden");let E=n(y);if(!E){b.classList.add("is-hidden");return}b.classList.add(`${S}${E}`)},t=b=>{if(!b)return"";let y=b.getAttribute("data-aipkit-picker-title");if(y)return y;let S=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return S?S.textContent.trim():""},d=b=>{if(!b)return"";let y=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(y)return y.textContent.trim();let S=b.querySelector("option");return S?S.textContent.trim():""},_=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),p=(b,y)=>{if(!b||!b.id||!y)return null;let S=_(b.id),E=y.querySelector(`#${S.buttonId}`);if(!E){if(E=document.createElement("button"),E.type="button",E.id=S.buttonId,E.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",E.setAttribute("data-aipkit-popover-target",S.popoverId),E.setAttribute("aria-controls",S.popoverId),E.setAttribute("aria-expanded","false"),E.dataset.aipkitPopoverPlacement="bottom",c(b)){E.classList.add("aipkit_settings_select_picker_btn--provider");let W=document.createElement("span");W.className="aipkit_settings_select_picker_icon",W.setAttribute("aria-hidden","true"),e(W,b.value),E.appendChild(W)}let M=document.createElement("span");M.className="aipkit_settings_select_picker_label",M.id=S.labelId,M.textContent=d(b)||k("Select","gpt3-ai-content-generator");let $=document.createElement("span");$.className="dashicons dashicons-arrow-down-alt2",$.setAttribute("aria-hidden","true"),E.appendChild(M),E.appendChild($),b.insertAdjacentElement("beforebegin",E)}b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let A=y.querySelector(`#${S.popoverId}`);if(!A){A=document.createElement("div"),A.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",c(b)&&A.classList.add("aipkit_settings_select_picker_popover--provider"),A.id=S.popoverId,A.setAttribute("aria-hidden","true");let M=document.createElement("div");M.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",M.setAttribute("role","dialog"),M.setAttribute("aria-labelledby",S.titleId);let $=document.createElement("div");$.className="aipkit_model_settings_popover_header";let W=document.createElement("span");W.className="aipkit_model_settings_popover_title",W.id=S.titleId,W.textContent=t(b)||k("Select","gpt3-ai-content-generator");let H=document.createElement("button");H.type="button",H.className="aipkit_model_settings_popover_close",H.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),H.innerHTML='<span class="dashicons dashicons-no-alt"></span>',$.appendChild(W),$.appendChild(H);let N=document.createElement("div");N.className="aipkit_model_settings_popover_body";let G=document.createElement("div");G.className="aipkit_settings_select_picker_search";let J=document.createElement("input");J.type="search",J.id=S.searchId,J.className="aipkit_form-input";let F=t(b),q=F?`Search ${F.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");J.setAttribute("placeholder",q),G.appendChild(J);let O=document.createElement("div");O.className="aipkit_settings_select_picker_list",O.id=S.listId,O.setAttribute("role","listbox"),N.appendChild(G),N.appendChild(O),M.appendChild($),M.appendChild(N),A.appendChild(M),y.appendChild(A),c(b)&&(G.style.display="none")}return{ids:S,button:E,popover:A,label:y.querySelector(`#${S.labelId}`),search:y.querySelector(`#${S.searchId}`),list:y.querySelector(`#${S.listId}`)}},f=b=>{let y=[];return b&&Array.from(b.children).forEach(E=>{if(E.tagName==="OPTGROUP"){let A=Array.from(E.children).filter(M=>M.tagName==="OPTION").map(M=>({value:M.value,label:M.textContent.trim(),disabled:M.disabled,selected:M.selected}));y.push({groupLabel:E.label||"",options:A})}else E.tagName==="OPTION"&&y.push({groupLabel:"",options:[{value:E.value,label:E.textContent.trim(),disabled:E.disabled,selected:E.selected}]})}),y},g=(b,y,S="")=>{if(!b||!y)return;let E=S.trim().toLowerCase();y.innerHTML="";let A=f(b),M=!1;if(A.forEach($=>{let W=$.options.filter(H=>E?H.label.toLowerCase().includes(E):!0);if(W.length){if($.groupLabel){let H=document.createElement("div");H.className="aipkit_settings_select_picker_group_label",H.textContent=$.groupLabel,y.appendChild(H)}W.forEach(H=>{let N=document.createElement("button");if(N.type="button",N.className="aipkit_settings_select_picker_item",N.setAttribute("role","option"),N.dataset.value=H.value,N.dataset.label=H.label,H.disabled&&(N.classList.add("is-disabled"),N.setAttribute("aria-disabled","true")),b.value===H.value?(N.classList.add("is-active"),N.setAttribute("aria-selected","true")):N.setAttribute("aria-selected","false"),c(b)){N.classList.add("aipkit_settings_select_picker_item--provider");let F=document.createElement("span");F.className="aipkit_settings_select_picker_icon",F.setAttribute("aria-hidden","true"),e(F,H.value),N.appendChild(F)}let G=document.createElement("span");G.className="aipkit_settings_select_picker_text",G.textContent=H.label;let J=document.createElement("span");J.className="dashicons dashicons-yes aipkit_settings_select_picker_check",N.appendChild(G),N.appendChild(J),y.appendChild(N),M=!0})}}),!M){let $=document.createElement("div");$.className="aipkit_settings_select_picker_empty",$.textContent=k(E?"No matches found.":"No options available.","gpt3-ai-content-generator"),y.appendChild($)}},m=(b,y)=>{if(!b||!y)return;let S=d(b);if(y.textContent=S||k("Select","gpt3-ai-content-generator"),c(b)){let E=y.closest("button"),A=E?E.querySelector(".aipkit_settings_select_picker_icon"):null;e(A,b.value)}},u=(b,y)=>{if(!b||!y)return;let S=b.getBoundingClientRect(),E=y.getBoundingClientRect(),A=E.width||320,M=E.height||0,$=window.innerWidth,W=window.innerHeight,H=12,N=S.left;N+A>$-H&&(N=S.right-A),N=Math.max(H,Math.min(N,$-A-H));let G=S.bottom+8;G+M>W-H&&(G=S.top-M-8),G=Math.max(H,Math.min(G,W-M-H)),y.style.left=`${Math.round(N)}px`,y.style.top=`${Math.round(G)}px`},w=()=>{!i||!a||s||(s=!0,window.requestAnimationFrame(()=>{let b=i.querySelector(".aipkit_model_settings_popover_panel");u(a,b),s=!1}))},h=()=>{i&&(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),i=null,a=null)},C=(b,y,S)=>{if(!b||!y)return;i&&i!==y&&h(),i=y,a=b,y.classList.add("aipkit-active"),y.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let E=y.querySelector(".aipkit_settings_select_picker_search input"),A=y.querySelector(".aipkit_settings_select_picker_list");A&&g(S,A,E?E.value:""),E&&E.offsetParent!==null&&(E.focus(),E.select());let M=y.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(b,M)})},x=(b,y)=>{if(!b||!y)return;let{button:S,popover:E,list:A,search:M}=y;if(S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("click",$=>{if($.preventDefault(),i===E){h();return}C(S,E,b)}),S.dataset.pickerListenerAttached="true"),E&&E.dataset.overlayListenerAttached!=="true"){E.addEventListener("click",W=>{W.target===E&&h()});let $=E.querySelector(".aipkit_model_settings_popover_close");$&&$.addEventListener("click",W=>{W.preventDefault(),h()}),E.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",$=>{let W=$.target.closest(".aipkit_settings_select_picker_item");if(!W||W.classList.contains("is-disabled"))return;let H=W.dataset.value??"";b.value=H,b.dispatchEvent(new Event("change",{bubbles:!0})),m(b,y.label),g(b,A,M?M.value:""),h()}),A.dataset.pickerListenerAttached="true"),M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("input",()=>{g(b,A,M.value)}),M.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{m(b,y.label),g(b,A,M?M.value:""),i===E&&h()}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let $=!1;new MutationObserver(()=>{$||($=!0,window.requestAnimationFrame(()=>{m(b,y.label),g(b,A,M?M.value:""),$=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitBulkPickerEscapeBound||(document.addEventListener("keydown",$=>{$.key==="Escape"&&i&&h()}),document.body.dataset.aipkitBulkPickerEscapeBound="true"),document.body.dataset.aipkitBulkPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitBulkPickerRepositionBound="true")};function v(b){if(!b||b.dataset.aipkitBulkPickerInit==="true")return;let y=b.querySelectorAll(r);y.length&&(y.forEach(S=>{if(!S.id||S.dataset.aipkitPickerInit==="true")return;let E=p(S,b);E&&(m(S,E.label),g(S,E.list,E.search?E.search.value:""),x(S,E),S.dataset.aipkitPickerInit="true")}),b.dataset.aipkitBulkPickerInit="true")}function L(){document.querySelectorAll(o).forEach(v)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",L):L(),new MutationObserver(L).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initBulkEnhancerSelectPickers=v})();(function(){"use strict";let k=window.aipkit_escapeHtml||(t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),o=["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],r=["{original_title}","{original_content}","{original_focus_keyword}","{original_meta_description}","{original_tags}","{categories}"],i=["{price}","{regular_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{purchase_note}","{product_categories}"],a=t=>t?.querySelector(".aipkit_enhancer_bulk_modal")?.dataset?.postType||"",s=(t,d)=>{let p=[...t==="meta"?r:o];return d==="product"&&p.push(...i),p.filter((f,g)=>p.indexOf(f)===g)},l=(t,d)=>{if(!t)return;let _=t.dataset.label||"Placeholders:",p=t.dataset.copyTitle||"Click to copy";t.innerHTML=`${k(_)} `,d.forEach((f,g)=>{let m=document.createElement("code");m.className="aipkit-placeholder",m.title=p,m.textContent=f,t.appendChild(m),g<d.length-1&&t.appendChild(document.createTextNode(" "))})},c=(t,d)=>{if(!t)return;let _=t.querySelector(".aipkit_bulk_prompt_placeholders");if(!_)return;let p=_.dataset.promptType||"",f=s(p,d);l(_,f)};function n(t){if(!t)return;let d=t.querySelectorAll("[data-aipkit-bulk-popover]");if(!d.length)return;let _=null,p=null,f=!1,g=C=>C?t.querySelector(`#${C}`):null,m=(C,x)=>{if(!C||!x)return;let v=C.getBoundingClientRect(),L=x.getBoundingClientRect(),P=L.width||400,b=L.height||0,y=window.innerWidth,S=window.innerHeight,E=12,A=v.left;A+P>y-E&&(A=v.right-P),A=Math.max(E,Math.min(A,y-P-E));let M=v.bottom+8;M+b>S-E&&(M=v.top-b-8),M=Math.max(E,Math.min(M,S-b-E)),x.style.left=`${Math.round(A)}px`,x.style.top=`${Math.round(M)}px`},u=()=>{!p||!_||f||(f=!0,window.requestAnimationFrame(()=>{let C=_.querySelector(".aipkit_model_settings_popover_panel");m(p,C),f=!1}))},w=()=>{_&&(_.classList.remove("aipkit-active"),_.setAttribute("aria-hidden","true"),p&&p.setAttribute("aria-expanded","false"),_?.dataset?.aipkitBulkPopover==="prompts"&&typeof window.aipkit_enhancer_closeBulkPromptFlyout=="function"&&window.aipkit_enhancer_closeBulkPromptFlyout(),_=null,p=null)},h=C=>{if(!C)return;let x=C.getAttribute("data-aipkit-popover-target"),v=g(x);if(!v)return;_&&_!==v&&w(),_=v,p=C,v.classList.add("aipkit-active"),v.setAttribute("aria-hidden","false"),C.setAttribute("aria-expanded","true");let L=v.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{m(C,L)})};d.forEach(C=>{C.dataset.popoverListenerAttached!=="true"&&(C.addEventListener("click",x=>{if(x.preventDefault(),_&&p===C){w();return}h(C)}),C.dataset.popoverListenerAttached="true")}),t.querySelectorAll(".aipkit_model_settings_popover[data-aipkit-bulk-popover]").forEach(C=>{C.dataset.overlayListenerAttached!=="true"&&(C.addEventListener("click",v=>{v.target===C&&w()}),C.dataset.overlayListenerAttached="true");let x=C.querySelector(".aipkit_model_settings_popover_close");x&&x.dataset.popoverListenerAttached!=="true"&&(x.addEventListener("click",v=>{v.preventDefault(),w()}),x.dataset.popoverListenerAttached="true")}),t.dataset.bulkPromptPopoverEscapeAttached!=="true"&&(document.addEventListener("keydown",C=>{C.key==="Escape"&&_&&w()}),t.dataset.bulkPromptPopoverEscapeAttached="true"),t.dataset.bulkPromptPopoverRepositionAttached!=="true"&&(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),t.dataset.bulkPromptPopoverRepositionAttached="true")}function e(t){if(!t)return;let d=t.querySelectorAll(".aipkit_prompt_edit_btn");if(!d.length)return;let _=a(t),p=null,f=null,g=!1,m=v=>v?t.querySelector(`#${v}`):null,u=(v,L,P)=>{if(!v||!L)return;let b=v.getBoundingClientRect(),y=L.getBoundingClientRect(),S=P?P.getBoundingClientRect():b,E=y.width||580,A=y.height||0,M=window.innerWidth,$=window.innerHeight,W=12,H=S.left-E-12;H<W&&(H=S.right+12),H=Math.max(W,Math.min(H,M-E-W));let N=S.top;N+A>$-W&&(N=$-A-W),N=Math.max(W,N),p.style.left=`${Math.round(H)}px`,p.style.top=`${Math.round(N)}px`},w=()=>{!f||!p||g||(g=!0,window.requestAnimationFrame(()=>{let v=p.querySelector(".aipkit_cw_prompt_panel"),L=f.closest(".aipkit_model_settings_popover_panel");u(f,v,L),g=!1}))},h=()=>{p&&(p.classList.remove("is-open"),p.setAttribute("aria-hidden","true"),f&&f.setAttribute("aria-expanded","false"),p=null,f=null)},C=v=>{let L=v.getAttribute("data-aipkit-flyout-target"),P=m(L);if(!P)return;p&&p!==P&&h(),p=P,f=v,P.classList.add("is-open"),P.setAttribute("aria-hidden","false"),v.setAttribute("aria-expanded","true"),c(P,_);let b=P.querySelector(".aipkit_cw_prompt_panel"),y=v.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(v,b,y)})};d.forEach(v=>{v.dataset.flyoutListenerAttached!=="true"&&(v.addEventListener("click",L=>{if(L.preventDefault(),p&&f===v){h();return}C(v)}),v.dataset.flyoutListenerAttached="true")}),t.querySelectorAll(".aipkit_cw_prompt_library_select").forEach(v=>{let L=v.getAttribute("data-aipkit-prompt-target"),P=L?t.querySelector(`#${L}`):null;P&&P.value.trim()===""&&v.value&&(P.value=v.value),v.dataset.promptLibraryAttached!=="true"&&(v.addEventListener("change",()=>{if(!v.value)return;let b=v.getAttribute("data-aipkit-prompt-target"),y=b?t.querySelector(`#${b}`):null;y&&(y.value=v.value,y.dispatchEvent(new Event("input",{bubbles:!0})))}),v.dataset.promptLibraryAttached="true")}),t.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(v=>{v.dataset.overlayListenerAttached!=="true"&&(v.addEventListener("click",L=>{L.target===v&&h()}),v.dataset.overlayListenerAttached="true")}),t.dataset.bulkPromptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",v=>{v.key==="Escape"&&p&&h()}),t.dataset.bulkPromptFlyoutEscapeAttached="true"),t.dataset.bulkPromptFlyoutClickAttached!=="true"&&(document.addEventListener("click",v=>{if(!p)return;let L=v.target;L.closest(".aipkit_cw_prompt_flyout")||L.closest("[data-aipkit-flyout-target]")||h()}),t.dataset.bulkPromptFlyoutClickAttached="true"),t.dataset.bulkPromptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),t.dataset.bulkPromptFlyoutRepositionAttached="true"),window.aipkit_enhancer_closeBulkPromptFlyout=h}window.aipkit_enhancer_initBulkPromptPopovers=n,window.aipkit_enhancer_initBulkPromptFlyouts=e})();(function(){"use strict";let k=window.aipkit_escapeHtml||(t=>t||""),o=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],r=t=>{let d=parseInt(t,10);if(Number.isFinite(d)){if(d>=1&&d<=o.length)return o[d-1];let _=o.find(p=>p.tokens===d);if(_)return _}return o[1]};function i(t,d){let _=window.aipkit_post_enhancer||{},p,f,g,m,u;t==="openai"?(p=d.querySelector("#aipkit_bulk_openai_vector_store_ids"),f=_.openai_vector_stores||[],g="id",m="name",u="No OpenAI stores found."):t==="pinecone"?(p=d.querySelector("#aipkit_bulk_pinecone_index_name"),f=_.pinecone_indexes||[],g="name",m="name",u="No Pinecone indexes found."):t==="qdrant"&&(p=d.querySelector("#aipkit_bulk_qdrant_collection_name"),f=_.qdrant_collections||[],g="name",m="name",u="No Qdrant collections found."),p&&(p.innerHTML="",f.length>0?p.multiple?f.forEach(w=>{p.add(new Option(k(w[m]),w[g]))}):(p.add(new Option("-- Select --","")),f.forEach(w=>{p.add(new Option(k(w[m]),w[g]))})):(p.add(new Option(u,"")),p.disabled=!0),t==="openai"&&a(d))}function a(t){let d=t.querySelector("[data-aipkit-vector-stores-dropdown]");if(!d)return;let _=d.closest(".aipkit_cw_vector_openai_field"),p=_?_.querySelector(".aipkit_popover_multiselect_select"):null;if(!p)return;let f=d.querySelector(".aipkit_popover_multiselect_btn"),g=d.querySelector(".aipkit_popover_multiselect_label"),m=d.querySelector(".aipkit_popover_multiselect_panel"),u=d.querySelector(".aipkit_popover_multiselect_options"),w=d.dataset.placeholder||"Select stores",h=d.dataset.selectedLabel||"selected",C=()=>{if(!g)return;let b=Array.from(p.options).filter(S=>S.selected&&S.value);if(!b.length){g.textContent=w;return}let y=b.map(S=>S.textContent.trim()).filter(Boolean);if(y.length<=2){g.textContent=y.join(", ");return}g.textContent=`${y.length} ${h}`},x=()=>{if(!u)return;u.innerHTML="";let b=Array.from(p.options),y=b.filter(S=>S.value);if(!y.length){let S=document.createElement("div");S.className="aipkit_popover_multiselect_empty",S.textContent=b[0]?.textContent||"-- No Stores Found --",u.appendChild(S),C();return}y.forEach(S=>{let E=document.createElement("label");E.className="aipkit_popover_multiselect_item";let A=document.createElement("input");A.type="checkbox",A.value=S.value,A.checked=S.selected,A.disabled=S.disabled;let M=document.createElement("span");M.className="aipkit_popover_multiselect_text",M.textContent=S.textContent,E.appendChild(A),E.appendChild(M),u.appendChild(E)}),C()},v=()=>{if(!u){C();return}let b=new Set(Array.from(p.options).filter(y=>y.selected).map(y=>y.value));u.querySelectorAll('input[type="checkbox"]').forEach(y=>{y.checked=b.has(y.value)}),C()},L=b=>{if(!u)return;let y=Array.from(u.querySelectorAll('input[type="checkbox"]:checked'));if(y.length>2){let E=b&&b.target;if(E&&E.checked)E.checked=!1;else{let A=y[y.length-1];A&&(A.checked=!1)}}let S=Array.from(u.querySelectorAll('input[type="checkbox"]:checked')).map(E=>E.value);Array.from(p.options).forEach(E=>{E.selected=S.includes(E.value)}),p.dispatchEvent(new Event("change",{bubbles:!0})),C()},P=b=>{!d||!f||(d.classList.toggle("is-open",b),f.setAttribute("aria-expanded",b?"true":"false"),m&&(m.hidden=!b))};x(),v(),d.dataset.vectorStoreMultiselectAttached||(f&&(f.addEventListener("click",b=>{b.preventDefault(),b.stopPropagation(),P(!d.classList.contains("is-open"))}),f.addEventListener("keydown",b=>{b.key==="Escape"&&P(!1)})),document.addEventListener("click",b=>{d.classList.contains("is-open")&&(d.contains(b.target)||P(!1))}),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",L),u.dataset.listenerAttached="true"),p.dataset.listenerAttached||(p.addEventListener("change",v),p.dataset.listenerAttached="true"),d.dataset.vectorStoreMultiselectAttached="true")}function s(t,d){let _=d.querySelector("#aipkit_bulk_vector_embedding_model");if(!_)return;let p=window.aipkit_post_enhancer||{},f=[];t==="google"?f=p.googleEmbeddingModels||[]:t==="openrouter"?f=p.openrouterEmbeddingModels||[]:t==="azure"?f=p.azureEmbeddingModels||[]:f=p.openaiEmbeddingModels||[],_.innerHTML="",f.length>0?(_.add(new Option("-- Select Model --","")),f.forEach(g=>{_.add(new Option(k(g.name||g.id),g.id))}),_.disabled=!1):(_.add(new Option("No models found","")),_.disabled=!0)}function l(t){let d=t.querySelector("#aipkit_bulk_vector_store_provider").value,_=t.querySelector(".aipkit_cw_vector_openai_field"),p=t.querySelector(".aipkit_cw_vector_pinecone_field"),f=t.querySelector(".aipkit_cw_vector_qdrant_field"),g=t.querySelector(".aipkit_cw_vector_embedding_config_row");_&&(_.hidden=!0),p&&(p.hidden=!0),f&&(f.hidden=!0),g&&(g.hidden=!0),d==="openai"?(_&&(_.hidden=!1),i("openai",t)):d==="pinecone"?(p&&(p.hidden=!1),g&&(g.hidden=!1),i("pinecone",t),s("openai",t)):d==="qdrant"&&(f&&(f.hidden=!1),g&&(g.hidden=!1),i("qdrant",t),s("openai",t))}function c(t){let d=t.querySelector('input[name="enable_vector_store"]'),_=t.querySelector(".aipkit_cw_vector_store_settings_container"),p=t.querySelector("#aipkit_bulk_vector_store_provider"),f=t.querySelector("#aipkit_bulk_vector_embedding_provider"),g=t.querySelector("#aipkit_bulk_vector_store_top_k"),m=t.querySelector("#aipkit_bulk_vector_store_top_k_value");if(!(!d||!_||!p)){if(d.addEventListener("change",()=>{_.hidden=!d.checked}),p.addEventListener("change",()=>l(t)),f&&f.addEventListener("change",u=>s(u.target.value,t)),g&&m){let u=()=>{m.textContent=g.value};g.addEventListener("input",u),u()}_.hidden=!d.checked,l(t)}}function n(t){let d=t.querySelectorAll(".aipkit_prompt_toggle_card, .aipkit_enhancer_prompt_card");d.length&&d.forEach(_=>{let p=_.querySelector('input[name="bulk_enhance_fields"], input[name="generate_seo_slug"]');if(!p)return;let f=()=>{_.classList.toggle("is-disabled",!p.checked)};f(),p.addEventListener("change",f),_.dataset.promptToggleAttached!=="true"&&(_.addEventListener("click",g=>{g.target.closest(".aipkit_prompt_edit_btn")||g.target.closest("a")||p.disabled||(g.target.closest(".aipkit_switch")&&g.preventDefault(),p.checked=!p.checked,p.dispatchEvent(new Event("change",{bubbles:!0})))}),_.dataset.promptToggleAttached="true")})}function e(t,d){if(!t)return;let _=t.querySelector("#aipkit-enhancer-bulk-config"),p=t.querySelector("#aipkit-enhancer-bulk-progress"),f=t.querySelector("#aipkit_bulk_enhancer_start_btn"),g=t.querySelector("#aipkit_bulk_enhancer_stop_btn"),m=t.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn");if(_&&(_.hidden=!1),p&&(p.hidden=!0),f){f.disabled=!1;let y=f.querySelector(".aipkit_btn-text");y&&(y.textContent="Start")}g&&(g.hidden=!0),m&&(m.hidden=!0);let u=t.querySelectorAll(".aipkit_enhancer_advanced_details");u.length&&u.forEach(y=>{if(y.dataset.toggleListenerAttached==="true")return;let S=y.querySelector("summary");S&&(S.addEventListener("click",E=>{E.preventDefault(),y.hasAttribute("open")?y.removeAttribute("open"):y.setAttribute("open","")}),y.dataset.toggleListenerAttached="true")});let w=t.querySelector(".aipkit_enhancer_settings_popover");w&&w.dataset.checkboxDelegateAttached!=="true"&&(w.addEventListener("click",y=>{let S=y.target?.closest?.(".aipkit_switch");if(S&&w.contains(S)){let M=S.querySelector('input[type="checkbox"]');if(!M||M.disabled)return;y.preventDefault(),M.checked=!M.checked,M.dispatchEvent(new Event("change",{bubbles:!0}));return}let E=y.target.closest(".aipkit_checkbox-label");if(!E||!w.contains(E))return;let A=E.querySelector('input[type="checkbox"]');!A||A.disabled||y.target!==A&&(y.preventDefault(),A.checked=!A.checked,A.dispatchEvent(new Event("change",{bubbles:!0})))}),w.dataset.checkboxDelegateAttached="true");function h(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),t&&(t.classList.remove("aipkit-active"),t.addEventListener("transitionend",()=>t.remove(),{once:!0}),setTimeout(()=>t?.remove(),500))}t.querySelector(".aipkit-modal-close-btn").addEventListener("click",h);let C=t.querySelector("#aipkit_bulk_ai_provider"),x=t.querySelector("#aipkit_bulk_ai_model"),v=t.querySelector("#aipkit_bulk_ai_temperature"),L=t.querySelector("#aipkit_bulk_ai_temperature_value"),P=t.querySelector("#aipkit_bulk_content_max_tokens"),b=t.querySelector("#aipkit_bulk_content_max_tokens_value");if(C&&x&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(C.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(C,x)),window.aipkit_enhancer_populateBulkModels(C,x)),x&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&x.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(t)),v&&L&&v.addEventListener("input",()=>L.textContent=v.value),P&&b){let y=()=>{let S=r(P.value);b.textContent=`${S.words} words`};P.addEventListener("input",y),y()}typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(t),n(t),typeof window.aipkit_enhancer_initBulkPromptPopovers=="function"&&window.aipkit_enhancer_initBulkPromptPopovers(t),typeof window.aipkit_enhancer_initBulkPromptFlyouts=="function"&&window.aipkit_enhancer_initBulkPromptFlyouts(t),t.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(d)}),t.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),t.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),c(t)}window.aipkit_enhancer_attachBulkModalListeners=e})();(function(){"use strict"})();(function(){"use strict";function k(o,r,i){let s=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithError(o.message||s.error_loading_title,s):r?window.aipkit_updateModalWithSuggestions(r,s):window.aipkit_updateModalWithError(s.error_loading_title||"Unknown error occurred.",s)}window.aipkit_handleTitleSuggestionsResult=k})();(function(){"use strict";function k(o,r,i){let s=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorExcerpt(o.message||s.error_loading_excerpt,s):r?window.aipkit_updateModalWithExcerptSuggestions(r,s):window.aipkit_updateModalWithErrorExcerpt(s.error_loading_excerpt||"Unknown error occurred.",s)}window.aipkit_handleExcerptSuggestionsResult=k})();(function(){"use strict";function k(o,r,i){let s=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorMeta(o.message||s.error_loading_meta,s):r?window.aipkit_updateModalWithMetaSuggestions(r,s):window.aipkit_updateModalWithErrorMeta(s.error_loading_meta||"Unknown error occurred.",s)}window.aipkit_handleMetaSuggestionsResult=k})();(function(){"use strict";function k(){}function o(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=o})();(function(){"use strict";function k(r){let i=r.target.closest(".aipkit_enhancer_item"),a=r.target.closest("#aipkit_bulk_enhance_btn");if(i){if(i.classList.contains("aipkit_enhancer_placeholder")){r.target.tagName==="A"&&r.preventDefault();return}r.preventDefault();let s=i.getAttribute("data-post-id"),l=i.getAttribute("data-action-type");if(!s||!l)return;let c=window.aipkit_post_enhancer||{},n=c.text||{};switch(l){case"title":window.aipkit_showLoadingModal(s,n,c),window.aipkit_fetchTitleSuggestions(s,window.aipkit_handleTitleSuggestionsResult,i);break;case"excerpt":window.aipkit_showLoadingExcerptModal(s,n,c),window.aipkit_fetchExcerptSuggestions(s,window.aipkit_handleExcerptSuggestionsResult,i);break;case"meta":window.aipkit_showLoadingMetaModal(s,n,c),window.aipkit_fetchMetaSuggestions(s,window.aipkit_handleMetaSuggestionsResult,i);break;case"tags":window.aipkit_showLoadingTagsModal(s,n,c),window.aipkit_fetchTagsSuggestions(s,window.aipkit_handleTagsSuggestionsResult,i);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${l}'.`);break}}else if(a){r.preventDefault();let s=document.querySelectorAll('input[name="post[]"]:checked');if(s.length===0){alert("Please select at least one post.");return}let l=Array.from(s).map(n=>n.value),c=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(l,c):alert("Error: Bulk processing feature is not available.")}}function o(){let r=document;if(!r)return;let i="data-post-enhancer-listener";document.body.getAttribute(i)||(r.addEventListener("click",k),document.body.setAttribute(i,"true"))}window.aipkit_initEnhancerEventListeners=o})();(function(){"use strict";function k(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(r=>typeof window[r]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),function(){let i=new WeakMap;function a(e){l(e),e.classList.add("aipkit-open")}function s(e){l(e);let t=setTimeout(()=>{e.classList.remove("aipkit-open")},180);i.set(e,t)}function l(e){let t=i.get(e);t&&(clearTimeout(t),i.delete(e))}function c(e){if(!e||e.dataset.aipkitHoverBound==="1")return;e.dataset.aipkitHoverBound="1",e.addEventListener("mouseenter",()=>a(e)),e.addEventListener("mouseleave",()=>s(e));let t=e.querySelector(".aipkit_enhancer_popover");t&&(t.addEventListener("mouseenter",()=>a(e)),t.addEventListener("mouseleave",()=>s(e)))}function n(){document.querySelectorAll(".aipkit_enhancer_action").forEach(c),new MutationObserver(d=>{for(let _ of d)_.addedNodes&&_.addedNodes.length&&_.addedNodes.forEach(p=>{p.nodeType===1&&(p.matches&&p.matches(".aipkit_enhancer_action")&&c(p),p.querySelectorAll&&p.querySelectorAll(".aipkit_enhancer_action").forEach(c))})}).observe(document.body,{childList:!0,subtree:!0})}n()}()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initPostEnhancer=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){r()}function r(){let i=document.getElementById("aipkit_vpp_embedding_model_select");if(!i){console.error("VPP Embedding Util: Embedding model select not found.");return}let a=window.aipkit_vpp_config||{},s=a.text||{};i.innerHTML=`<option value="">${k(s.select_model||"-- Select Model --")}</option>`;let l=[{key:"openai",label:"OpenAI",models:a.openaiEmbeddingModels||[]},{key:"google",label:"Google",models:a.googleEmbeddingModels||[]},{key:"openrouter",label:"OpenRouter",models:a.openrouterEmbeddingModels||[]},{key:"azure",label:"Azure",models:a.azureEmbeddingModels||[]}],c=!1;l.forEach(n=>{if(!n.models||n.models.length===0)return;c=!0;let e=document.createElement("optgroup");e.label=n.label,n.models.forEach(t=>{if(t&&t.id){let d=document.createElement("option");d.value=t.id,d.textContent=k(t.name||t.id),d.dataset.provider=n.key,e.appendChild(d)}}),e.children.length&&i.appendChild(e)}),c?(i.disabled=!1,i.options.length>1&&(i.selectedIndex=1)):(i.appendChild(new Option(k(s.no_embedding_models||"(No embedding models - Sync in AI Settings)"),"")),i.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=o,window.aipkit_vpp_populateEmbeddingModelSelect=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){let i=document.getElementById("aipkit_vpp_openai_vector_store_id"),a=document.getElementById("aipkit_vpp_openai_store_status"),s=window.aipkit_vpp_config||{},l=s.text||{},c=s.openai_vector_stores||[];if(!i){console.error("VPP OpenAI Provider: Store select not found.");return}i.innerHTML="",a&&(a.textContent=""),c.length>0?(i.appendChild(new Option(`-- ${k(l.select_store||"Select Existing Store")} --`,"")),c.forEach(n=>{let e="(Files: N/A)";n.file_counts&&typeof n.file_counts.total=="number"?e=`(${n.file_counts.total} ${n.file_counts.total===1?"File":"Files"})`:n.file_counts&&(e="(Files: ?)");let t=`${k(n.name||n.id)} ${e}`,d=new Option(t,n.id);i.appendChild(d)})):i.appendChild(new Option(k(l.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),i.disabled=c.length===0}async function r(i,a,s,l){let c=window.aipkit_vpp_config||{},n=c.text||{},e=i.length,t=0,d=0,_=0,p=[];try{let f=c.nonce_index_posts;if(!f)throw new Error("Nonce for indexing posts is missing in config.");for(let m of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}t++;let u=document.querySelector(`#post-${m}`),w=u?u.querySelector(".title .row-title"):null,h=w?w.textContent.trim():`Post #${m}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(m,"processing","",h),typeof window.aipkit_vpp_updateProgress=="function"){let x=t/e*100,v=(n.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",t).replace("%2$d",e)+` "${k(h)}"`;window.aipkit_vpp_updateProgress(x,v)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let C={_ajax_nonce:f,post_ids:[m],post_type:l,target_store_id:a,new_store_name_openai:s||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",C),d++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(m,"success","",h)}catch(x){if(_++,p.push({id:m,title:h,error:x.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${m}:`,x),typeof window.aipkit_vpp_updateProgressItem=="function"){let v=x?.message||n.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(m,"error",v,h)}}}let g=`Indexing complete. ${d} successful, ${_} failed.`;window.aipkit_isIndexingStopped&&t<e?g=`Indexing stopped. ${d} successful, ${_} failed.`:_>0&&console.error("Failed Posts:",p),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,_>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${d}/${e}`)}catch(f){console.error("VPP OpenAI Provider: Indexing setup error:",f),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,n.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(f.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),_>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=o,window.aipkit_vpp_startIndexingOpenAI=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){let i=document.getElementById("aipkit_vpp_pinecone_target_index_select"),a=document.getElementById("aipkit_vpp_pinecone_index_status"),s=window.aipkit_vpp_config||{},l=s.text||{},c=s.pinecone_indexes||[];if(!i){console.error("VPP Pinecone Provider: Index select not found.");return}i.innerHTML="",a&&(a.textContent=""),c.length>0?(i.appendChild(new Option(`-- ${k(l.select_pinecone_index||"Select Pinecone Index")} --`,"")),c.forEach(n=>{let e=n.name||n.id;if(e){let t=`${k(e)} (${n.dimension||"?"})`;i.appendChild(new Option(t,e))}})):i.appendChild(new Option(k(l.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),i.disabled=c.length===0}async function r(i,a,s,l,c){let n=window.aipkit_vpp_config||{},e=n.text||{},t=i.length,d=0,_=0,p=0,f=[];try{let g=n.nonce_index_posts;if(!g)throw new Error("Nonce for indexing posts is missing in config.");for(let u of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}d++;let w=document.querySelector(`#post-${u}`),h=w?w.querySelector(".title .row-title"):null,C=h?h.textContent.trim():`Post #${u}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"processing","",C),typeof window.aipkit_vpp_updateProgress=="function"){let v=d/t*100,L=(e.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",d).replace("%2$d",t)+` "${k(C)}"`;window.aipkit_vpp_updateProgress(v,L)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let x={_ajax_nonce:g,post_ids:[u],post_type:c,target_index_id:a,provider:"pinecone",embedding_provider:s,embedding_model:l};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",x),_++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"success","",C)}catch(v){if(p++,f.push({id:u,title:C,error:v.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${u}:`,v),typeof window.aipkit_vpp_updateProgressItem=="function"){let L=v?.message||e.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(u,"error",L,C)}}}let m=`Indexing complete. ${_} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&d<t?m=`Indexing stopped. ${_} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${_}/${t}`)}catch(g){console.error("VPP Pinecone Provider: Indexing error:",g),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,e.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=o,window.aipkit_vpp_startIndexingPinecone=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){let i=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),a=document.getElementById("aipkit_vpp_qdrant_collection_status"),s=window.aipkit_vpp_config||{},l=s.text||{},c=s.qdrant_collections||[];if(!i){console.error("VPP Qdrant Provider: Collection select not found.");return}i.innerHTML="",a&&(a.textContent=""),c.length>0?(i.appendChild(new Option(`-- ${k(l.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),c.forEach(n=>{let e=n.name||n.id;e&&i.appendChild(new Option(k(e),e))})):i.appendChild(new Option(k(l.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),i.disabled=c.length===0}async function r(i,a,s,l,c){let n=window.aipkit_vpp_config||{},e=n.text||{},t=i.length,d=0,_=0,p=0,f=[];try{let g=n.nonce_index_posts;if(!g)throw new Error("Nonce for indexing posts is missing in config.");for(let u of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}d++;let w=document.querySelector(`#post-${u}`),h=w?w.querySelector(".title .row-title"):null,C=h?h.textContent.trim():`Post #${u}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"processing","",C),typeof window.aipkit_vpp_updateProgress=="function"){let v=d/t*100,L=(e.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",d).replace("%2$d",t)+` "${k(C)}"`;window.aipkit_vpp_updateProgress(v,L)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let x={_ajax_nonce:g,post_ids:[u],post_type:c,target_collection_name:a,provider:"qdrant",embedding_provider:s,embedding_model:l};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",x),_++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"success","",C)}catch(v){if(p++,f.push({id:u,title:C,error:v.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${u}:`,v),typeof window.aipkit_vpp_updateProgressItem=="function"){let L=v?.message||e.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(u,"error",L,C)}}}let m=`Indexing complete. ${_} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&d<t?m=`Indexing stopped. ${_} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${_}/${t}`)}catch(g){console.error("VPP Qdrant Provider: Indexing error:",g),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,e.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=o,window.aipkit_vpp_startIndexingQdrant=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(b){return b},o="#aipkit_vpp_modal",r=["#aipkit_vpp_vector_store_provider","#aipkit_vpp_openai_vector_store_id","#aipkit_vpp_pinecone_target_index_select","#aipkit_vpp_qdrant_target_collection_select","#aipkit_vpp_embedding_model_select"].join(", "),i=null,a=null,s=!1,l=new Set(["aipkit_vpp_vector_store_provider"]),c=b=>!!(b&&b.id&&l.has(b.id)),n=b=>String(b||"").trim().toLowerCase(),e=(b,y)=>{if(!b)return;let S="aipkit_settings_select_picker_icon--";b.classList.forEach(A=>{A.startsWith(S)&&b.classList.remove(A)}),b.classList.remove("is-hidden");let E=n(y);if(!E){b.classList.add("is-hidden");return}b.classList.add(`${S}${E}`)},t=b=>{if(!b)return"";let y=b.getAttribute("data-aipkit-picker-title");if(y)return y;let S=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return S?S.textContent.trim():""},d=b=>{if(!b)return"";let y=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(y)return y.textContent.trim();let S=b.querySelector("option");return S?S.textContent.trim():""},_=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),p=(b,y)=>{if(!b||!b.id||!y)return null;let S=_(b.id),E=y.querySelector(`#${S.buttonId}`);if(!E){if(E=document.createElement("button"),E.type="button",E.id=S.buttonId,E.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",E.setAttribute("data-aipkit-popover-target",S.popoverId),E.setAttribute("aria-controls",S.popoverId),E.setAttribute("aria-expanded","false"),E.dataset.aipkitPopoverPlacement="bottom",c(b)){E.classList.add("aipkit_settings_select_picker_btn--provider");let W=document.createElement("span");W.className="aipkit_settings_select_picker_icon",W.setAttribute("aria-hidden","true"),e(W,b.value),E.appendChild(W)}let M=document.createElement("span");M.className="aipkit_settings_select_picker_label",M.id=S.labelId,M.textContent=d(b)||k("Select","gpt3-ai-content-generator");let $=document.createElement("span");$.className="dashicons dashicons-arrow-down-alt2",$.setAttribute("aria-hidden","true"),E.appendChild(M),E.appendChild($),b.insertAdjacentElement("beforebegin",E)}E.disabled=b.disabled,b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let A=y.querySelector(`#${S.popoverId}`);if(!A){A=document.createElement("div"),A.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",c(b)&&A.classList.add("aipkit_settings_select_picker_popover--provider"),A.id=S.popoverId,A.setAttribute("aria-hidden","true");let M=document.createElement("div");M.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",M.setAttribute("role","dialog"),M.setAttribute("aria-labelledby",S.titleId);let $=document.createElement("div");$.className="aipkit_model_settings_popover_header";let W=document.createElement("span");W.className="aipkit_model_settings_popover_title",W.id=S.titleId,W.textContent=t(b)||k("Select","gpt3-ai-content-generator");let H=document.createElement("button");H.type="button",H.className="aipkit_model_settings_popover_close",H.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),H.innerHTML='<span class="dashicons dashicons-no-alt"></span>',$.appendChild(W),$.appendChild(H);let N=document.createElement("div");N.className="aipkit_model_settings_popover_body";let G=document.createElement("div");G.className="aipkit_settings_select_picker_search";let J=document.createElement("input");J.type="search",J.id=S.searchId,J.className="aipkit_form-input";let F=t(b),q=F?`Search ${F.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");J.setAttribute("placeholder",q),G.appendChild(J);let O=document.createElement("div");O.className="aipkit_settings_select_picker_list",O.id=S.listId,O.setAttribute("role","listbox"),N.appendChild(G),N.appendChild(O),M.appendChild($),M.appendChild(N),A.appendChild(M),y.appendChild(A),(c(b)||b.dataset.aipkitPickerSearch==="false")&&(G.style.display="none")}return{ids:S,button:E,popover:A,label:y.querySelector(`#${S.labelId}`),search:y.querySelector(`#${S.searchId}`),list:y.querySelector(`#${S.listId}`)}},f=b=>{let y=[];return b&&Array.from(b.children).forEach(E=>{if(E.tagName==="OPTGROUP"){let A=Array.from(E.children).filter(M=>M.tagName==="OPTION").map(M=>({value:M.value,label:M.textContent.trim(),disabled:M.disabled,selected:M.selected}));y.push({groupLabel:E.label||"",options:A})}else E.tagName==="OPTION"&&y.push({groupLabel:"",options:[{value:E.value,label:E.textContent.trim(),disabled:E.disabled,selected:E.selected}]})}),y},g=(b,y,S="")=>{if(!b||!y)return;let E=S.trim().toLowerCase();y.innerHTML="";let A=f(b),M=!1;if(A.forEach($=>{let W=$.options.filter(H=>E?H.label.toLowerCase().includes(E):!0);if(W.length){if($.groupLabel){let H=document.createElement("div");H.className="aipkit_settings_select_picker_group_label",H.textContent=$.groupLabel,y.appendChild(H)}W.forEach(H=>{let N=document.createElement("button");if(N.type="button",N.className="aipkit_settings_select_picker_item",N.setAttribute("role","option"),N.dataset.value=H.value,N.dataset.label=H.label,H.disabled&&(N.classList.add("is-disabled"),N.setAttribute("aria-disabled","true")),b.value===H.value?(N.classList.add("is-active"),N.setAttribute("aria-selected","true")):N.setAttribute("aria-selected","false"),c(b)){N.classList.add("aipkit_settings_select_picker_item--provider");let F=document.createElement("span");F.className="aipkit_settings_select_picker_icon",F.setAttribute("aria-hidden","true"),e(F,H.value),N.appendChild(F)}let G=document.createElement("span");G.className="aipkit_settings_select_picker_text",G.textContent=H.label;let J=document.createElement("span");J.className="dashicons dashicons-yes aipkit_settings_select_picker_check",N.appendChild(G),N.appendChild(J),y.appendChild(N),M=!0})}}),!M){let $=document.createElement("div");$.className="aipkit_settings_select_picker_empty",$.textContent=k(E?"No matches found.":"No options available.","gpt3-ai-content-generator"),y.appendChild($)}},m=(b,y,S)=>{if(!b||!y)return;let E=d(b);if(y.textContent=E||k("Select","gpt3-ai-content-generator"),S&&(S.disabled=b.disabled),c(b)){let A=S?S.querySelector(".aipkit_settings_select_picker_icon"):null;e(A,b.value)}},u=(b,y)=>{if(!b||!y)return;let S=b.getBoundingClientRect(),E=y.getBoundingClientRect(),A=E.width||320,M=E.height||0,$=window.innerWidth,W=window.innerHeight,H=12,N=S.left;N+A>$-H&&(N=S.right-A),N=Math.max(H,Math.min(N,$-A-H));let G=S.bottom+8;G+M>W-H&&(G=S.top-M-8),G=Math.max(H,Math.min(G,W-M-H)),y.style.left=`${Math.round(N)}px`,y.style.top=`${Math.round(G)}px`},w=()=>{!i||!a||s||(s=!0,window.requestAnimationFrame(()=>{let b=i.querySelector(".aipkit_model_settings_popover_panel");u(a,b),s=!1}))},h=()=>{i&&(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-expanded","false"),i=null,a=null)},C=(b,y,S)=>{if(!b||!y)return;i&&i!==y&&h(),i=y,a=b,y.classList.add("aipkit-active"),y.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let E=y.querySelector(".aipkit_settings_select_picker_search input"),A=y.querySelector(".aipkit_settings_select_picker_list");A&&g(S,A,E?E.value:""),E&&E.offsetParent!==null&&(E.focus(),E.select());let M=y.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(b,M)})},x=(b,y)=>{if(!b||!y)return;let{button:S,popover:E,list:A,search:M,label:$}=y;if(S&&S.dataset.pickerListenerAttached!=="true"&&(S.addEventListener("click",W=>{if(W.preventDefault(),!S.disabled){if(i===E){h();return}C(S,E,b)}}),S.dataset.pickerListenerAttached="true"),E&&E.dataset.overlayListenerAttached!=="true"){E.addEventListener("click",H=>{H.target===E&&h()});let W=E.querySelector(".aipkit_model_settings_popover_close");W&&W.addEventListener("click",H=>{H.preventDefault(),h()}),E.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",W=>{let H=W.target.closest(".aipkit_settings_select_picker_item");if(!H||H.classList.contains("is-disabled"))return;let N=H.dataset.value??"";b.value=N,b.dispatchEvent(new Event("change",{bubbles:!0})),m(b,$,S),g(b,A,M?M.value:""),h()}),A.dataset.pickerListenerAttached="true"),M&&M.dataset.pickerListenerAttached!=="true"&&(M.addEventListener("input",()=>{g(b,A,M.value)}),M.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{m(b,$,S),g(b,A,M?M.value:""),i===E&&h()}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let W=!1;new MutationObserver(()=>{W||(W=!0,window.requestAnimationFrame(()=>{m(b,$,S),g(b,A,M?M.value:""),W=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitVppPickerEscapeBound||(document.addEventListener("keydown",W=>{W.key==="Escape"&&i&&h()}),document.body.dataset.aipkitVppPickerEscapeBound="true"),document.body.dataset.aipkitVppPickerRepositionBound||(window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),document.body.dataset.aipkitVppPickerRepositionBound="true")};function v(b){if(!b||b.dataset.aipkitVppPickerInit==="true")return;let y=b.querySelectorAll(r);y.length&&(y.forEach(S=>{if(!S.id||S.dataset.aipkitPickerInit==="true")return;let E=p(S,b);E&&(m(S,E.label,E.button),g(S,E.list,E.search?E.search.value:""),x(S,E),S.dataset.aipkitPickerInit="true")}),b.dataset.aipkitVppPickerInit="true")}function L(){document.querySelectorAll(o).forEach(v)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",L):L(),new MutationObserver(L).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initVppSelectPickers=v})();(function(){"use strict";let k="aipkit_vpp_modal",o=window.aipkit_escapeHtml||function(h){return h},r=window.aipkit_escapeAttribute||o,i=[],a="",s=!1,l=h=>{if(!h)return"Post";let C=window.aipkit_vpp_postTitles||{};if(C[h])return C[h];let x=document.querySelector(`#post-${h}`),v=x?x.querySelector(".title .row-title")||x.querySelector("strong a")||x.querySelector(".title a")||x.querySelector("a.row-title")||x.querySelector(".column-title strong a")||x.querySelector(".column-title .row-title"):null,L=v?v.textContent.trim():`Post #${h}`;return C[h]=L,window.aipkit_vpp_postTitles=C,L},c=h=>{let C=window.aipkit_vpp_config?.text||{};return{pending:C.status_pending||"Pending",processing:C.status_processing||"Processing",success:C.status_completed||"Completed",error:C.status_failed||"Failed",stopped:C.status_stopped||"Stopped"}[h]||h},n=(h,C)=>{let x=document.createElement("div");x.className="aipkit_vpp_progress_item aipkit_vpp_progress_item--pending",x.dataset.postId=h;let v=document.createElement("div");v.className="aipkit_vpp_progress_item_main";let L=document.createElement("div");L.className="aipkit_vpp_progress_item_title",L.textContent=C;let P=document.createElement("div");P.className="aipkit_vpp_progress_item_message",P.textContent="",P.style.display="none";let b=document.createElement("div");return b.className="aipkit_vpp_progress_item_status",b.textContent=c("pending"),v.appendChild(L),v.appendChild(P),x.appendChild(v),x.appendChild(b),x};function e(h,C){if(document.getElementById(k)){console.warn("VPP Modal UI: Modal already exists.");return}i=h,a=C,s=!1;let v=(window.aipkit_vpp_config||{}).text||{},L="",P=h.length;P===1?L=o(v.items_selected_singular||"You have selected %d item to index.").replace("%d",`<strong>${P}</strong>`):L=o(v.items_selected_plural||"You have selected %d items to index.").replace("%d",`<strong>${P}</strong>`);let b=document.createElement("div");b.id=k,b.className="aipkit-modal-overlay aipkit-active";let y=document.createElement("div");y.className="aipkit-modal-content aipkit_vpp_modal_content",y.innerHTML=`
            <div class="aipkit-modal-header aipkit_vpp_modal_header">
                <div class="aipkit_vpp_header_left">
                    <span class="aipkit_vpp_header_icon" aria-hidden="true">
                        <span class="dashicons dashicons-database"></span>
                    </span>
                    <div class="aipkit_vpp_header_text">
                        <h3 class="aipkit-modal-title">${o(v.modal_title||"Add Content to Vector Store")}</h3>
                        <span class="aipkit_vpp_header_subtitle">${o(v.modal_subtitle||"Index selected content for retrieval")}</span>
                    </div>
                </div>
                <button type="button" class="aipkit-modal-close-btn aipkit_vpp_close_btn" aria-label="${r(v.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body aipkit_vpp_modal_body">
                <div id="aipkit_vpp_status_message" class="aipkit_vpp_status_message" aria-live="polite"></div>

                <div class="aipkit_vpp_selection_card">
                    <span class="aipkit_vpp_selection_text">${L}</span>
                </div>

                <div class="aipkit_vpp_engine_card">
                    <div class="aipkit_enhancer_engine_card">
                        <div class="aipkit_enhancer_engine_fields">
                            <div class="aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_vector_store_provider">${o(v.provider_label||"Provider")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_vector_store_provider" class="aipkit_enhancer_engine_select">
                                            <option value="openai" selected>OpenAI</option>
                                            <option value="pinecone">Pinecone</option>
                                            <option value="qdrant">Qdrant</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_openai_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_openai_vector_store_id">${o(v.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(v.loading_stores||"Loading stores...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_pinecone_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_pinecone_target_index_select">${o(v.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(v.loading_indexes||"Loading indexes...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_qdrant_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_qdrant_target_collection_select">${o(v.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(v.loading_indexes||"Loading collections...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_embedding_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_embedding_model_select">${o(v.embedding_label||"Embedding")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_embedding_model_select" class="aipkit_enhancer_engine_select" data-aipkit-picker-search="false">
                                            <option value="">${o(v.select_model||"-- Select Model --")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="aipkit_vpp_progress_area" class="aipkit_vpp_section aipkit_vpp_section--progress" hidden>
                    <div class="aipkit_vpp_section_header">
                        <span class="aipkit_vpp_section_title">${o(v.section_progress_title||"Progress")}</span>
                    </div>
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <div id="aipkit_vpp_progress_text" class="aipkit_vpp_progress_text"></div>
                    <div id="aipkit_vpp_progress_log" class="aipkit_vpp_progress_log" role="list"></div>
                </div>
            </div>
            <div class="aipkit-modal-footer aipkit_vpp_modal_footer">
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${o(v.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" hidden></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                     <span class="aipkit_btn-text">${o(v.stop||"Stop")}</span>
                </button>
            </div>
        `,b.appendChild(y),document.body.appendChild(b),y.addEventListener("click",E=>{let A=E.target;A.closest(".aipkit-modal-close-btn")||A.closest(".aipkit_vpp_modal_close_btn")?d():A.closest("#aipkit_vpp_start_indexing_btn")?w():A.closest("#aipkit_vpp_stop_indexing_btn")&&t()}),b.addEventListener("click",E=>{E.target===b&&d()});let S=document.getElementById("aipkit_vpp_vector_store_provider");S&&(S.addEventListener("change",u),u({target:S}))}function t(){window.aipkit_isIndexingStopped=!0;let h=document.getElementById("aipkit_vpp_stop_indexing_btn"),C=window.aipkit_vpp_config?.text||{};if(h){h.disabled=!0;let x=h.querySelector(".aipkit_btn-text");x&&(x.textContent=C.stopping||"Stopping...")}}function d(){window.aipkit_isIndexingStopped=!0;let h=document.getElementById(k);h&&(h.classList.remove("aipkit-active"),setTimeout(()=>{h.parentNode&&h.parentNode.removeChild(h)},300))}function _(h,C){let x=document.querySelector(`#${k} .aipkit_vpp_progress_bar`),v=document.getElementById("aipkit_vpp_progress_text");x&&(x.style.width=`${Math.max(0,Math.min(100,h))}%`),v&&(v.textContent=C)}function p(h){let C=document.getElementById("aipkit_vpp_progress_log");if(!C)return;C.innerHTML="";let x=document.createDocumentFragment();(h||[]).forEach(v=>{let L=l(v);x.appendChild(n(v,L))}),C.appendChild(x),C.scrollTop=0}function f(h,C,x="",v=""){let L=document.getElementById("aipkit_vpp_progress_log");if(!L)return;let P=`.aipkit_vpp_progress_item[data-post-id="${h}"]`,b=L.querySelector(P);if(!b){let E=v||l(h);b=n(h,E),L.appendChild(b)}b.className=`aipkit_vpp_progress_item aipkit_vpp_progress_item--${C}`;let y=b.querySelector(".aipkit_vpp_progress_item_status"),S=b.querySelector(".aipkit_vpp_progress_item_message");y&&(y.textContent=c(C)),S&&(S.textContent=x||"",S.style.display=x?"":"none"),L.scrollTop=L.scrollHeight}function g(h,C="info"){let x=document.getElementById("aipkit_vpp_status_message");x&&(x.textContent=h,x.className=`aipkit_vpp_status_message aipkit_message-${C}`)}function m(){s=!1;let h=document.getElementById("aipkit_vpp_start_indexing_btn"),C=document.getElementById("aipkit_vpp_stop_indexing_btn"),x=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`),v=window.aipkit_vpp_config?.text||{};if(h){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(h,v.start_indexing||"Start Indexing"),h.disabled=!1,h.hidden=!1;let P=h.querySelector(".aipkit_spinner");P&&(P.hidden=!0)}if(C){C.hidden=!0,C.disabled=!1;let P=C.querySelector(".aipkit_btn-text");P&&(P.textContent=v.stop||"Stop")}x.forEach(P=>P.disabled=!1);let L=document.getElementById("aipkit_vpp_progress_area");L&&(L.hidden=!1)}function u(h){let C=h.target.value,x=document.getElementById("aipkit_vpp_openai_options"),v=document.getElementById("aipkit_vpp_pinecone_options"),L=document.getElementById("aipkit_vpp_qdrant_options"),P=document.getElementById("aipkit_vpp_embedding_options");x&&(x.hidden=!0),v&&(v.hidden=!0),L&&(L.hidden=!0),P&&(P.hidden=!0),C==="openai"?(x&&(x.hidden=!1),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):C==="pinecone"?(v&&(v.hidden=!1),P&&(P.hidden=!1),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):C==="qdrant"&&(L&&(L.hidden=!1),P&&(P.hidden=!1),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function w(){if(s)return;window.aipkit_isIndexingStopped=!1;let h=document.getElementById("aipkit_vpp_vector_store_provider").value,C=window.aipkit_vpp_config?.text||{},x="",v={post_ids:i,post_type:a,provider:h};if(h==="openai"){if(x=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!x){g(C.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}v.target_store_id=x}else if(h==="pinecone"){if(x=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!x){g(C.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}v.target_index_id=x;let S=document.getElementById("aipkit_vpp_embedding_model_select"),E=S?.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:null;if(v.embedding_model=S?S.value:"",v.embedding_provider=E&&E.dataset.provider||"",!v.embedding_provider||!v.embedding_model){g(C.error_no_embedding_config||"Please select an embedding model for Pinecone.","error");return}}else if(h==="qdrant"){if(x=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!x){g(C.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}v.target_collection_name=x;let S=document.getElementById("aipkit_vpp_embedding_model_select"),E=S?.selectedOptions&&S.selectedOptions.length?S.selectedOptions[0]:null;if(v.embedding_model=S?S.value:"",v.embedding_provider=E&&E.dataset.provider||"",!v.embedding_provider||!v.embedding_model){g(C.error_no_embedding_config||"Please select an embedding model for Qdrant.","error");return}}else{g(`Provider ${h} not yet supported for indexing.`,"error");return}s=!0;let L=document.getElementById("aipkit_vpp_start_indexing_btn"),P=document.getElementById("aipkit_vpp_stop_indexing_btn"),b=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`);if(L&&(L.hidden=!0),P){P.hidden=!1,P.disabled=!1;let S=P.querySelector(".aipkit_btn-text");S&&(S.textContent=C.stop||"Stop")}let y=document.getElementById("aipkit_vpp_progress_area");y&&(y.hidden=!1),typeof window.aipkit_vpp_initProgressLog=="function"&&window.aipkit_vpp_initProgressLog(i),_(0,C.status_preparing||"Preparing..."),h==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(i,x,null,a):h==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(i,x,v.embedding_provider,v.embedding_model,a):h==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(i,x,v.embedding_provider,v.embedding_model,a)}window.aipkit_vpp_showModal=e,window.aipkit_vpp_closeModal=d,window.aipkit_vpp_updateProgress=_,window.aipkit_vpp_initProgressLog=p,window.aipkit_vpp_updateProgressItem=f,window.aipkit_vpp_updateStatus=g,window.aipkit_vpp_resetModalAfterProcessing=m})();(function(){"use strict";let k="aipkit_add_to_vector_store_btn";function r(){let s=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(s.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let l=Array.from(s).map(c=>c.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(l,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function i(){let s=document.getElementById(k);return s&&!s.dataset.vppBound?(s.addEventListener("click",r),s.dataset.vppBound="1",!0):!!(s&&s.dataset.vppBound)}function a(){if(i())return;let s=document.querySelector("#wpbody-content")||document.body,l=Date.now();if(!s)return;let c=new MutationObserver(()=>{(i()||Date.now()-l>15e3)&&c.disconnect()});c.observe(s,{childList:!0,subtree:!0});let n=setInterval(()=>{(i()||Date.now()-l>15e3)&&clearInterval(n)},300)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",a):a()})();})();
