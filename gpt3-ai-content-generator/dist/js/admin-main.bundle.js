(()=>{(function(){"use strict";function k(r,i){if(!r)return;let e=r.querySelector(".aipkit_btn-text");if(e){e.textContent=i;return}let t=r.querySelector(".aipkit_spinner"),c=Array.from(r.childNodes).find(s=>s.nodeType===Node.TEXT_NODE);c?c.textContent=i+(t?" ":""):r.insertBefore(document.createTextNode(i+(t?" ":"")),r.firstChild),t&&r.appendChild(t)}function o(r,i,e,t=4e3){if(!r)return;let c=r.dataset.baseClass||"aipkit_form-help";r.dataset.baseClass||(r.dataset.baseClass=c),r.messageTimeoutId&&(clearTimeout(r.messageTimeoutId),r.messageTimeoutId=null),r.textContent=e,r.className=c,r.classList.add(`aipkit_form-help-${i}`),r.style.opacity="1",r.style.display="block",r.messageTimeoutId=setTimeout(()=>{r.style.opacity="0",setTimeout(()=>{r.textContent===e&&(r.textContent="",r.className=c,r.style.display="",r.messageTimeoutId=null)},300)},t)}window.aipkit_setButtonText=k,window.aipkit_showTemporaryMessage=o})();(function(){"use strict";function k(r){return r===null||typeof r>"u"?"":String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function o(r){return k(r)}window.aipkit_escapeHtml=k,window.aipkit_escapeAttribute=o})();(function(){"use strict";function k(r){let i=document.createElement("div");if(i.textContent="Copied!",Object.assign(i.style,{position:"absolute",fontSize:"12px",fontWeight:"600",color:"var(--aipkit_status-success, #38A169)",opacity:1,transition:"opacity .4s ease-out, transform .4s ease-out",zIndex:1000005,padding:"3px 6px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"3px",border:"1px solid var(--aipkit_status-success, #38A169)",transform:"translateY(-5px)",pointerEvents:"none"}),document.body.appendChild(i),r){let{top:e,left:t,width:c}=r.getBoundingClientRect(),s=e+window.scrollY+2,n=t+window.scrollX+c+5;i.style.top=`${s}px`,i.style.left=`${n}px`;let d=i.getBoundingClientRect(),a=8,l=window.innerWidth-a;if(d.right>l){let p=t+window.scrollX-d.width-5,_=Math.max(window.scrollX+a,p);i.style.left=`${_}px`}}else i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)";requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateY(0)"}),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateY(-5px)",i.addEventListener("transitionend",()=>i.remove(),{once:!0}),setTimeout(()=>{i.parentNode&&i.remove()},500)},1e3)}async function o(r,i){if(r)try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(r),k(i);return}throw new Error("Clipboard API not available")}catch(e){console.warn("[AIPKit] Clipboard API failed or unavailable \u2192 falling back to temporary textarea.",e);try{let t=document.createElement("textarea");t.value=r,t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",t.style.opacity="0",t.setAttribute("readonly",""),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999);let c=document.execCommand("copy");if(document.body.removeChild(t),c)k(i);else throw new Error('document.execCommand("copy") failed.')}catch(t){console.error("[AIPKit] Fallback copy method also failed. Prompting user.",t),window.prompt("Please copy the shortcode manually:",r)}}}window.aipkit_copyShortcode=o})();(function(){"use strict";function k(e){let t=Number(e);if(!t||isNaN(t))return"";try{let c=new Date(t*1e3);if(isNaN(c.getTime()))return"";let s=String(c.getHours()).padStart(2,"0"),n=String(c.getMinutes()).padStart(2,"0"),d=String(c.getSeconds()).padStart(2,"0");return`${s}:${n}:${d}`}catch(c){return console.error("Error formatting timestamp:",e,c),""}}function o(e){if(!e)return"";try{let t=new Date(e.replace(" ","T")+"Z");if(isNaN(t.getTime()))return"";let c=new Date,s=(t.getTime()-c.getTime())/1e3;if(s<0)return"In the past";if(s<60)return"in less than a minute";if(s<3600){let l=Math.round(s/60);return`in ${l} minute${l!==1?"s":""}`}let n=new Date(c.getFullYear(),c.getMonth(),c.getDate()),d=new Date(c.getFullYear(),c.getMonth(),c.getDate()+1),a=new Date(t.getFullYear(),t.getMonth(),t.getDate());return a.getTime()===n.getTime()?`Today at ${t.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:a.getTime()===d.getTime()?`Tomorrow at ${t.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}`:`on ${t.toLocaleDateString([],{month:"short",day:"numeric"})}`}catch(t){return console.error("Error formatting relative time:",e,t),e}}function r(e){if(!e)return"N/A";try{let t=new Date(e.replace(" ","T")+"Z");return isNaN(t.getTime())?"Invalid Date":t.toLocaleString()}catch(t){return console.error("Error formatting UTC date string:",e,t),e}}function i(e){if(!e)return"N/A";try{let t=new Date(e.replace(" ","T")+"Z");if(isNaN(t.getTime()))return"Invalid Date";let c=Math.floor((Date.now()-t.getTime())/1e3);if(Number.isNaN(c)||c<0)return t.toLocaleString();if(c<60)return"Just now";let s=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],n=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let d of s)if(c>=d.seconds){let a=Math.floor(c/d.seconds);return n?n.format(-a,d.unit):`${a} ${d.unit}${a!==1?"s":""} ago`}return t.toLocaleString()}catch(t){return console.error("Error formatting relative date string:",e,t),e}}window.aipkit_formatTimestamp=k,window.aipkit_formatFriendlyFutureDate=o,window.aipkit_formatUtcDateTime=r,window.aipkit_formatRelativeDateTime=i})();(function(){"use strict";function k(o){return!o||typeof o!="string"?"":o.charAt(0).toUpperCase()+o.slice(1)}window.aipkit_ucfirst=k,window.ucfirst=k})();(function(){"use strict";function k(){if(window.aipkit_markdownitInstance)return window.aipkit_markdownitInstance;if(typeof window.markdownit=="function"){let o=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0});return typeof window.hljs<"u"&&typeof window.markdownitHighlight=="function"&&o.use(window.markdownitHighlight,{hljs:window.hljs}),window.aipkit_markdownitInstance=o,o}else return console.warn("Markdown Renderer Utility: markdown-it library not found. Markdown rendering will be basic."),null}window.aipkit_getMarkdownRenderer=k})();(function(){"use strict";function k(o,r="",i="",e={}){if(!o)return"N/A";let t=o.toLowerCase();if(t.includes("text content submitted for indexing"))return"Text";if(t.includes("file content submitted for indexing")||t.includes("file content embedded and upserted")||t.includes("original filename:"))return"File Upload";if(t.includes("wordpress post content submitted for indexing"))return"Site Content";if(i==="openai")return"N/A";if(i==="pinecone"&&t.includes("vectors upserted")){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("pinecone_file_")||r.includes("file_"))return"File Upload"}if(i==="qdrant"){if(t.includes("points upserted to qdrant"))return e.post_id||t.includes("post id:")?"Site Content":"Text";if(t.includes("wordpress post content submitted for indexing"))return"Site Content"}if(r&&i==="pinecone"){if(r.startsWith("wp_post_"))return"Site Content";if(r.startsWith("text_"))return"Text";if(r.includes("file_")||r.includes("pinecone_file_"))return"File Upload"}return"N/A"}window.aipkit_determineContentType=k})();(function(){"use strict";async function k(i){return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("Core API request function is missing.")):window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",i)}async function o(i,e){if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return Promise.reject(new Error("AJAX configuration is missing."));i.set("action",e);try{let s=i.get("provider")||"openai",n=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null,d=n?i.get(n):null;if(d&&typeof d.size=="number"){let a=["text/plain","text/csv","application/json","text/json","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/csv","text/comma-separated-values"],l=Array.isArray(window.aipkit_uploadLimits?.allowed_mime_types)&&window.aipkit_uploadLimits.allowed_mime_types.length?window.aipkit_uploadLimits.allowed_mime_types:a,p=Number(window.aipkit_effectiveUploadLimitBytes||0);(!Number.isFinite(p)||p<=0)&&(p=10*1024*1024),s==="openai"&&(p=Math.min(p,10*1024*1024));let _=[];if(d.size>p&&_.push(`File is too large (${r(d.size)}). Max allowed is ${r(p)}.`),d.type&&!l.map(f=>f.toLowerCase()).includes(String(d.type).toLowerCase())&&_.push(`Unsupported file type (${d.type}). Allowed: ${l.join(", ")}.`),_.length){let f=new Error(_.join(" "));throw f.code="client_validation_failed",f}}}catch(s){throw console.warn("[AIPKit] Client-side file validation failed",s),s}let t;try{let s=i.has("file_to_upload")?"file_to_upload":i.has("aipkit_vs_global_file_to_submit")?"aipkit_vs_global_file_to_submit":null;if(s)try{let n=i.get(s);n&&console.debug("[AIPKit] File upload request",{action:e,fileField:s,name:n.name,size_bytes:n.size,type:n.type})}catch{}t=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:i,credentials:"same-origin"})}catch(s){throw console.error("[AIPKit] Network error during file upload",{action:e,error:s}),s}let c;try{c=await t.json()}catch(s){console.error("[AIPKit] Failed to parse JSON response for file upload",{action:e,status:t?.status,parseErr:s});let n=new Error(`Unexpected server response (status ${t?.status||"n/a"})`);throw n.status=t?.status,n}if(!t.ok||!c.success){let s=c?.data||{},n=new Error(s.message||`HTTP error! status: ${t.status}`);throw n.code=s.code,n.status=t.status,n.details=s.details||void 0,n.serverResponse=c,console.error("[AIPKit] File upload failed",{action:e,status:t.status,server:c}),n}return c.data}function r(i){if(!Number.isFinite(i))return`${i}`;let e=["B","KB","MB","GB"],t=0,c=i;for(;c>=1024&&t<e.length-1;)c/=1024,t++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:n=>n.toFixed(1)}).format(c)} ${e[t]}`}window.aipkit_api_upsertOpenAIText=k,window.aipkit_api_upsertFile=o})();(function(){"use strict";function k(o){let r=document.querySelector(o);if(!r)return;r.querySelectorAll(".aipkit_form-input.aipkit_range_slider").forEach(e=>{let t=e.id+"_value",c=null,s=e.closest(".aipkit_slider_wrapper");if(s&&(c=s.querySelector(".aipkit_slider_value")),!c)try{c=r.querySelector(`#${CSS.escape(t)}`)}catch{c=r.querySelector("#"+t)}if(c){let n=e.getAttribute("data-suffix")||(e.id.includes("confidence_threshold")?"%":"");c.textContent=e.value+n,e.hasAttribute("data-range-listener-attached")||(e.addEventListener("input",function(){c.textContent=this.value+n}),e.setAttribute("data-range-listener-attached","true"))}})}window.aipkit_attachRangeValueHandlers=k})();(function(){"use strict";function k(o){let r=document.querySelector(o);if(!r)return;let i="data-apikey-toggle-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(e){let t=e.target.closest(".aipkit_api-key-toggle");if(!t)return;let c=t.closest(".aipkit_api-key-wrapper");if(!c)return;let s=c.querySelector(".aipkit_form-input"),n=t.querySelector(".dashicons");!s||!n||(s.type==="password"?(s.type="text",n.classList.remove("dashicons-visibility"),n.classList.add("dashicons-hidden")):(s.type="password",n.classList.remove("dashicons-hidden"),n.classList.add("dashicons-visibility")))}),r.setAttribute(i,"true"))}window.aipkit_initApiKeyToggles=k})();(function(){"use strict";function k(o,r,i="Submit",e="Processing..."){if(!o)return;let t=o.querySelector(".aipkit_btn-text")||o.querySelector(".aipkit_btn_text"),c=o.querySelector(".aipkit_spinner"),s=o.querySelector(".dashicons");if(r){if(o.disabled=!0,!o.dataset.originalText)if(t)o.dataset.originalText=t.textContent;else{let d="";o.childNodes.forEach(a=>{a.nodeType===Node.TEXT_NODE&&(d+=a.textContent.trim())}),o.dataset.originalText=d.trim()}s&&(s.dataset.originalDisplay||(s.dataset.originalDisplay=s.style.display||"inline-block"),s.style.display="none");let n=i===""?"":o.dataset.loadingText||e;t?(o.dataset.originalText||(o.dataset.originalText=t.textContent),t.textContent=n):(!s||s.style.display==="none")&&n&&(Array.from(o.childNodes).forEach(d=>{d.nodeType===Node.TEXT_NODE&&d.remove()}),n&&o.insertBefore(document.createTextNode(n),o.firstChild)),c&&(c.style.display="inline-block")}else{o.disabled=!1;let n=i===""?"":o.dataset.originalText||i;s&&s.dataset.originalDisplay&&(s.style.display=s.dataset.originalDisplay,delete s.dataset.originalDisplay),t?t.textContent=n:i!==""&&(Array.from(o.childNodes).forEach(d=>{d.nodeType===Node.TEXT_NODE&&d.remove()}),n&&(s?s.insertAdjacentText("afterend"," "+n):o.insertBefore(document.createTextNode(n),o.firstChild))),c&&(c.style.display="none"),delete o.dataset.originalText}}window.aipkit_setLoadingStateOpenAI=k})();(function(){"use strict";function k(o,r="info",i="aipkit_knowledge_base_global_status"){let e=document.getElementById(i);if(!e)return;e.messageTimeoutId&&clearTimeout(e.messageTimeoutId),e.messageTimeoutId=null;let t=o?String(o).trim():"";if(t===""){e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.style.opacity="0",e.classList.remove("aipkit-active");return}let c=e.classList.contains("aipkit_settings_message-error"),s=r;c&&r!=="error"&&(s="error"),e.className="aipkit_form-help",s==="success"?e.classList.add("aipkit_settings_message-success"):s==="error"?e.classList.add("aipkit_settings_message-error"):e.classList.add("aipkit_settings_message-info"),s==="error"&&e.textContent||c&&r!=="error"&&e.textContent?e.textContent=e.textContent+`
`+t:e.textContent=t,e.style.display="block",e.style.opacity="1",e.classList.add("aipkit-active"),s!=="error"&&(e.messageTimeoutId=setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.textContent.includes(t)&&(e.textContent="",e.className="aipkit_form-help",e.style.display="none",e.classList.remove("aipkit-active"))},300)},5e3))}window.aipkit_showOpenAIVectorStatus=k})();(function(){"use strict";async function k(e,t,c,s){let n=document.getElementById("aipkit_nonce"),d=n&&n.value||window.aipkit_dashboard&&window.aipkit_dashboard.nonce||void 0;return await window.aipkit_apiRequest("aipkit_get_chunk_logs_by_batch",{_ajax_nonce:d,provider:e,store_id:t,batch_id:c,page:s,per_page:10})}function o({snippetText:e="",fileId:t="",provider:c="",batchId:s="",storeId:n=""}={}){let d=window.aipkit_escapeHtml||function(u){return u},a=document.createElement("div");a.className="aipkit-snippet-modal-overlay";let l=document.createElement("div");l.className="aipkit-snippet-modal-content";let p=c?`${c} Indexed Snippet`:"Indexed Snippet",_=t?` (${d(t)})`:"",f=!!s&&!!n&&!!c;l.innerHTML=`
      <div class="aipkit-snippet-modal-header">
        <h3 class="aipkit-snippet-modal-title">${p}${_}</h3>
        <button type="button" class="aipkit-snippet-modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="aipkit-snippet-modal-body">
        ${f?`
          <div class="aipkit-chunks-list"></div>
          <div class="aipkit-chunks-pagination" style="margin-top:10px; display:flex; justify-content: space-between; align-items:center;">
            <button class="button button-secondary aipkit-chunks-prev">Prev</button>
            <span class="aipkit-chunks-page-info"></span>
            <button class="button button-secondary aipkit-chunks-next">Next</button>
          </div>
        `:`
          <pre class="aipkit-snippet-modal-content-text">${d(e)}</pre>
        `}
      </div>
    `,a.appendChild(l),document.body.appendChild(a);function g(){a.classList.remove("active"),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)}l.querySelector(".aipkit-snippet-modal-close").addEventListener("click",g),a.addEventListener("click",u=>{u.target===a&&g()});function m(u){u.key==="Escape"&&(g(),document.removeEventListener("keydown",m))}if(document.addEventListener("keydown",m),requestAnimationFrame(()=>{a.classList.add("active")}),f){let u=l.querySelector(".aipkit-chunks-list"),h=l.querySelector(".aipkit-chunks-page-info"),v=l.querySelector(".aipkit-chunks-prev"),S=l.querySelector(".aipkit-chunks-next"),q=1,y=1,E=w=>{if(!w||!w.length){u.innerHTML="<p>No chunks found.</p>";return}u.innerHTML=w.map(A=>{let C=A.indexed_content||"",b=A.file_id||"";return`<div class="aipkit-chunk-item" style="margin-bottom:12px;">
            <div class="aipkit-chunk-title" style="font-weight:600; margin-bottom:6px;">${d(b)}</div>
            <pre class="aipkit-chunk-text">${d(C)}</pre>
          </div>`}).join("")};async function I(w){u.innerHTML='<p><span class="aipkit_spinner" style="display:inline-block;"></span> Loading...</p>';try{let A=await k(c,n,s,w);E(A.chunks||[]),q=A.pagination?.current_page||w,y=A.pagination?.total_pages||1,h.textContent=`Page ${q} / ${y}`,v.disabled=q<=1,S.disabled=q>=y}catch(A){u.innerHTML=`<p class="aipkit_text-danger">${A&&A.message||"Failed to load chunks."}</p>`}}v.addEventListener("click",()=>{q>1&&I(q-1)}),S.addEventListener("click",()=>{q<y&&I(q+1)}),I(1)}}function r(e,t,c=""){return o({snippetText:e,fileId:t,provider:c})}function i(e,t=""){e&&e.querySelectorAll(".aipkit_view_snippet_icon").forEach(c=>{let s=c.cloneNode(!0);c.parentNode.replaceChild(s,c),s.addEventListener("click",n=>{n.preventDefault();let d=s.dataset.snippet,a=s.dataset.fileId,l=s.dataset.batchId||"",p=s.dataset.storeId||"";o({snippetText:d,fileId:a,provider:t,batchId:l,storeId:p})})})}window.aipkit_showSnippetModal=r,window.aipkit_showSnippetModalEnhanced=o,window.aipkit_attachSnippetModalListeners=i})();(function(){"use strict";function k(o,r,i){if(!o||!r||typeof i!="function"){r&&(r.innerHTML="");return}r.innerHTML="";let{total_logs:e,total_pages:t,current_page:c}=o,s=parseInt(c,10);if(!e||e<=0||!t||t<=1)return;let n=wp.i18n&&wp.i18n.__?wp.i18n.__:g=>g,d=wp.i18n&&wp.i18n._n?wp.i18n._n:(g,m,u)=>u>1?m:g,a=document.createElement("span");a.className="aipkit_pagination-count",a.textContent=`${e.toLocaleString()} ${d("item","items",e)}`,r.appendChild(a);let l=document.createElement("span");l.className="aipkit_pagination-links";let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",p.innerHTML="&laquo; "+n("Previous","gpt3-ai-content-generator"),p.disabled=s<=1,p.disabled||p.addEventListener("click",g=>{g.preventDefault(),i(s-1)}),l.appendChild(p);let _=document.createElement("span");_.className="aipkit_pagination-current",_.textContent=`${n("Page","gpt3-ai-content-generator")} ${s} ${n("of","gpt3-ai-content-generator")} ${t}`,l.appendChild(_);let f=document.createElement("button");f.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",f.innerHTML=n("Next","gpt3-ai-content-generator")+" &raquo;",f.disabled=s>=t,f.disabled||f.addEventListener("click",g=>{g.preventDefault(),i(s+1)}),l.appendChild(f),r.appendChild(l)}window.aipkit_renderLogsPagination=k})();(function(){"use strict";function k(o){let r=document.querySelector(o);if(!r)return;let i="data-restore-icon-listener-attached";r.getAttribute(i)||(r.addEventListener("click",function(e){let t=e.target.closest(".aipkit_restore-default-icon");if(!t)return;let c=t.getAttribute("data-target-input"),s=t.getAttribute("data-default-value");if(!c||s===null){console.warn("AIPKit Restore Default: Missing target input ID or default value.",t);return}let n=document.getElementById(c);if(n){if(n.value!==s){n.value=s;let a=new Event("change",{bubbles:!0,cancelable:!0}),l=new Event("blur",{bubbles:!0,cancelable:!0});if(n.dispatchEvent(a),n.dispatchEvent(l),n.type==="range"){let p=document.getElementById(`${c}_value`);p&&(p.textContent=s)}}}else console.warn(`AIPKit Restore Default: Target input element #${c} not found.`)}),r.setAttribute(i,"true"))}window.aipkit_initRestoreDefaultIcons=k})();(function(){"use strict";function k(e){!e||!e.parentNode||e.classList.contains("aipkit_message_fadeout")||(e.classList.add("aipkit_message_fadeout"),e.addEventListener("animationend",()=>{e.parentNode&&e.parentNode.removeChild(e)},{once:!0}),setTimeout(()=>{e&&e.parentNode&&e.parentNode.removeChild(e)},500))}function o(e,t,c){let s=document.getElementById(e);if(!s){console.error(`AIPKit Message Handler: Container #${e} not found.`);return}s.querySelectorAll(".aipkit_settings_message").forEach(g=>{g.dataset.timerId&&clearTimeout(parseInt(g.dataset.timerId,10)),g.remove()});let d=s.querySelector(".aipkit_saving-indicator");d&&d.remove();let a=document.createElement("div");a.className=`aipkit_settings_message aipkit_settings_message-${t}`;let l=t==="success"?"dashicons-yes-alt":t==="error"?"dashicons-warning":"dashicons-info-alt",p=document.createElement("span");p.className=`dashicons ${l}`,p.style.marginRight="5px",a.appendChild(p),a.appendChild(document.createTextNode(` ${c}`));let _=document.createElement("span");_.className="dashicons dashicons-dismiss aipkit_settings_message-close",_.setAttribute("aria-label","Dismiss message"),_.title="Dismiss message",a.appendChild(_),s.appendChild(a);let f=setTimeout(()=>{k(a)},5e3);a.dataset.timerId=f}function r(e){let t=document.getElementById(e);if(!t){console.error(`AIPKit Message Handler: Container #${e} not found for close button init.`);return}let c=`data-close-listener-${e}`;t.getAttribute(c)!=="true"&&(t.addEventListener("click",function(s){let n=s.target.closest(".aipkit_settings_message-close");if(n){let d=n.closest(".aipkit_settings_message");d&&(d.dataset.timerId&&clearTimeout(parseInt(d.dataset.timerId,10)),k(d))}}),t.setAttribute(c,"true"))}function i(e){let t=document.getElementById(e);if(t){let c=t.querySelector(".aipkit_saving-indicator");c&&c.remove(),t.querySelectorAll(".aipkit_settings_message").forEach(n=>{n.dataset.timerId&&clearTimeout(parseInt(n.dataset.timerId,10)),n.remove()})}else console.warn(`AIPKit Message Handler: Container #${e} not found for clearing messages.`)}window.aipkit_showMessage=o,window.aipkit_initMessageCloseButtons=r,window.aipkit_clearStatusMessages=i})();(function(){"use strict";function k(i,e){let t=document.getElementById(i);if(!t){console.error(`AIPKit Saving Indicator: Container #${i} not found.`);return}let c=t.querySelector(".aipkit_saving-indicator");if(e)if(!c)typeof window.aipkit_clearStatusMessages=="function"?window.aipkit_clearStatusMessages(i):console.warn("AIPKit Saving Indicator: Cannot clear messages, dependency missing."),c=document.createElement("span"),c.className="aipkit_saving-indicator",c.innerHTML='Saving... <span class="aipkit_spinner" style="display:inline-block;"></span>',t.appendChild(c),requestAnimationFrame(()=>{let s=t.querySelector(".aipkit_saving-indicator");s&&s.classList.add("aipkit_active")});else{c.style.display="inline-flex",c.classList.add("aipkit_active");let s=c.querySelector(".aipkit_spinner");s&&(s.style.display="inline-block")}else c&&(c.classList.remove("aipkit_active"),setTimeout(()=>{c&&c.parentNode&&c.remove()},200))}function o(i){r(i);let e=document.createElement("span");e.className="aipkit-title-spinner aipkit_spinner",e.style.display="inline-block",i.parentNode.insertBefore(e,i.nextSibling)}function r(i){let e=i.parentNode.querySelector(".aipkit-title-spinner");e&&e.remove()}window.aipkit_showSavingIndicator=k,window.aipkit_showLinkSpinner=o,window.aipkit_hideLinkSpinner=r})();(function(){"use strict";function k(i){let e=i.textContent;i.textContent="Copied!",i.classList.add("aipkit-placeholder--copied"),setTimeout(()=>{i&&i.classList.contains("aipkit-placeholder--copied")&&(i.textContent=e,i.classList.remove("aipkit-placeholder--copied"))},1500)}function o(i){let e=i.target;if(!e.matches(".aipkit-placeholder"))return;i.preventDefault(),i.stopPropagation();let t=e.textContent;if(!navigator.clipboard){console.warn("AIPKit Placeholder Copy: Clipboard API not available.");return}navigator.clipboard.writeText(t).then(()=>{k(e)}).catch(c=>{console.error("AIPKit Placeholder Copy: Failed to copy placeholder. Error:",c)})}function r(){let i=document.body;if(i){let e="data-placeholder-copy-listener-attached";i.getAttribute(e)||(i.addEventListener("click",o),i.setAttribute(e,"true"))}else console.warn("AIPKit Placeholder Copy: Could not find document.body to attach delegated listener.")}document.addEventListener("DOMContentLoaded",r)})();(function(){"use strict";let k="select[data-aipkit-provider-notice-target]",o="a[data-aipkit-load-module]";function r(){let m=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return m&&typeof m=="object"?m:{}}function i(m){window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=m}function e(m){return m?String(m).trim().toLowerCase():""}function t(m,u){return!m||!u||!Object.prototype.hasOwnProperty.call(u,m)?null:!!u[m]}function c(m,u){if(!m)return"";let h=u?m.getAttribute(`data-message-${u}`):"";return h||m.getAttribute("data-message-default")||""}function s(m){m&&m.classList.add("aipkit_provider_notice--hidden")}function n(m){m&&m.classList.remove("aipkit_provider_notice--hidden")}function d(m,u){if(!m)return;let h=m.getAttribute("data-aipkit-provider-notice-target");if(!h)return;let v=document.getElementById(h);if(!v)return;if(m.getAttribute("data-aipkit-provider-notice-defer")==="1"&&m.dataset.aipkitProviderNoticeArmed!=="true"){s(v);return}let q=e(m.value);if(!q){s(v);return}let y=t(q,u);if(y===null){s(v);return}if(y){s(v);return}let E=v.querySelector(".aipkit_provider_notice_message");E&&(E.textContent=c(v,q)),n(v)}function a(m){return m?m.offsetParent!==null?!0:m.getClientRects().length>0:!1}function l(m){let u=r(),h=m||document,v=Array.from(h.querySelectorAll(k)),S=new Map;v.forEach(q=>{let y=q.getAttribute("data-aipkit-provider-notice-target");y&&(S.has(y)||S.set(y,[]),S.get(y).push(q))}),S.forEach(q=>{let y=q.find(a)||q[0];y&&d(y,u)})}function p(){let m={...r()},u=!1,h=H=>{let O=document.getElementById(H);if(O)return u=!0,String(O.value||"").trim()},v=h("aipkit_openai_api_key");v!==void 0&&(m.openai=v!=="");let S=h("aipkit_openrouter_api_key");S!==void 0&&(m.openrouter=S!=="");let q=h("aipkit_google_api_key");q!==void 0&&(m.google=q!=="");let y=h("aipkit_azure_api_key"),E=h("aipkit_azure_endpoint");(y!==void 0||E!==void 0)&&(m.azure=(y||"")!==""&&(E||"")!=="");let I=h("aipkit_claude_api_key");I!==void 0&&(m.claude=I!=="");let w=h("aipkit_deepseek_api_key");w!==void 0&&(m.deepseek=w!=="");let A=h("aipkit_ollama_base_url");A!==void 0&&(m.ollama=A!=="");let C=h("aipkit_replicate_api_key"),b=h("aipkit_task_cw_replicate_api_key");(C!==void 0||b!==void 0)&&(m.replicate=(C||"")!==""||(b||"")!=="");let x=h("aipkit_pinecone_api_key");x!==void 0&&(m.pinecone=x!=="");let T=h("aipkit_qdrant_api_key"),P=h("aipkit_qdrant_url");return(T!==void 0||P!==void 0)&&(m.qdrant=(T||"")!==""&&(P||"")!==""),u?(i(m),!0):!1}function _(){["aipkit_openai_api_key","aipkit_openrouter_api_key","aipkit_google_api_key","aipkit_azure_api_key","aipkit_azure_endpoint","aipkit_claude_api_key","aipkit_deepseek_api_key","aipkit_ollama_base_url","aipkit_replicate_api_key","aipkit_task_cw_replicate_api_key","aipkit_pinecone_api_key","aipkit_qdrant_api_key","aipkit_qdrant_url"].forEach(u=>{let h=document.getElementById(u);if(!h||h.dataset.aipkitProviderStatusBound==="true")return;let v=()=>{p()&&l(document)};h.addEventListener("input",v),h.addEventListener("change",v),h.dataset.aipkitProviderStatusBound="true"})}function f(m){(m||document).querySelectorAll(o).forEach(v=>{v.dataset.aipkitProviderNoticeLinkBound!=="true"&&(v.addEventListener("click",S=>{let q=v.getAttribute("data-aipkit-load-module");!q||typeof window.aipkit_loadModule!="function"||(S.preventDefault(),window.aipkit_loadModule(q))}),v.dataset.aipkitProviderNoticeLinkBound="true")})}function g(m){let u=m||document;u.querySelectorAll(k).forEach(v=>{v.dataset.aipkitProviderNoticeBound!=="true"&&(v.addEventListener("change",()=>{v.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(v.dataset.aipkitProviderNoticeArmed="true"),d(v,r())}),v.dataset.aipkitProviderNoticeBound="true")}),p(),l(u),_(),f(u)}window.aipkit_initProviderKeyNotices=g,document.addEventListener("DOMContentLoaded",function(){g(document)})})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelectorAll("[data-aipkit-popover-target]");if(!r.length)return;let i=null,e=null,t=!1,c=l=>l?o.querySelector(`#${l}`):null,s=(l,p)=>{if(!l||!p)return;let _=l.getBoundingClientRect(),f=p.getBoundingClientRect(),g=f.width||400,m=f.height||0,u=window.innerWidth,h=window.innerHeight,v=12;if(l.dataset.aipkitPopoverPlacement==="bottom"){let y=_.left;y+g>u-v&&(y=_.right-g),y=Math.max(v,Math.min(y,u-g-v));let E=_.bottom+8;E+m>h-v&&(E=_.top-m-8),E=Math.max(v,Math.min(E,h-m-v)),p.style.left=`${Math.round(y)}px`,p.style.top=`${Math.round(E)}px`;return}if(l.dataset.aipkitPopoverPlacement==="left"){let y=_.left-g-10;y<v&&(y=_.right+10),y=Math.max(v,Math.min(y,u-g-v));let E=_.top;E+m>h-v&&(E=h-m-v),E=Math.max(v,E),p.style.left=`${Math.round(y)}px`,p.style.top=`${Math.round(E)}px`;return}let S=_.right+10;S+g>u-v&&(S=_.right-g-10),S=Math.max(v,Math.min(S,u-g-v));let q=_.top;q+m>h-v&&(q=h-m-v),q=Math.max(v,q),p.style.left=`${Math.round(S)}px`,p.style.top=`${Math.round(q)}px`},n=()=>{!e||!i||t||(t=!0,window.requestAnimationFrame(()=>{let l=i.querySelector(".aipkit_model_settings_popover_panel");s(e,l),t=!1}))},d=()=>{if(!i)return;let l=i.id;i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),l==="aipkit_cw_template_picker_popover"&&typeof window.aipkit_resetTemplateActionsPanel=="function"&&window.aipkit_resetTemplateActionsPanel(),i=null,e=null},a=l=>{if(!l)return;let p=l.getAttribute("data-aipkit-popover-target"),_=c(p);if(!_)return;i&&i!==_&&d(),i=_,e=l,_.classList.add("aipkit-active"),_.setAttribute("aria-hidden","false"),l.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${p}`);let f=_.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{s(l,f)})};r.forEach(l=>{l.dataset.popoverListenerAttached!=="true"&&(l.addEventListener("click",p=>{if(p.preventDefault(),!(l.dataset.aipkitPopoverKeepOpen==="true")&&i&&e===l&&i.classList.contains("aipkit-active")){d();return}a(l)}),l.dataset.popoverListenerAttached="true")}),o.querySelectorAll(".aipkit_model_settings_popover").forEach(l=>{l.dataset.overlayListenerAttached!=="true"&&(l.addEventListener("click",_=>{_.target===l&&d()}),l.dataset.overlayListenerAttached="true");let p=l.querySelector(".aipkit_model_settings_popover_close");p&&p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",_=>{_.preventDefault(),d()}),p.dataset.popoverListenerAttached="true"),l.querySelectorAll("[data-aipkit-popover-close]").forEach(_=>{_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",f=>{f.preventDefault(),d()}),_.dataset.popoverListenerAttached="true")})}),o.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",l=>{l.key==="Escape"&&i&&d()}),o.dataset.escapeListenerAttached="true"),o.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",n),window.addEventListener("scroll",n,!0),o.dataset.repositionListenersAttached="true")}window.aipkit_initContentWriterPopovers=k})();(function(){"use strict";let k=e=>{if(!e)return null;let t=e.querySelector("#aipkit_enhancer_editor_integration"),c=e.querySelector("#aipkit_enhancer_list_button"),s=e.querySelector('input[name="enhancer_insert_position_default"]:checked');return!t||!c||!s?null:{enhancer_editor_integration:t.checked?"1":"0",enhancer_list_button:c.checked?"1":"0",enhancer_insert_position_default:s.value||"replace"}},o=e=>e?JSON.stringify(e):"",r=async e=>{if(!e||typeof window.aipkit_apiRequest!="function")return;let t=k(e);if(!t)return;let c=e.dataset.assistantAutosaveBaseline||"",s=o(t);if(!s||s===c||e.dataset.assistantAutosaveBusy==="true")return;let n=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,d=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,a=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;e.dataset.assistantAutosaveBusy="true",n&&n("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",t),e.dataset.assistantAutosaveBaseline=s,d&&d("Updated")}catch(l){a&&a(`Error: ${l.message||"Failed to save."}`),console.error("Content Writer Assistant Settings Save Error:",l)}finally{e.dataset.assistantAutosaveBusy="false"}};function i(e){let t=e||document.getElementById("aipkit_content_writer_container"),c=document.getElementById("aipkit_cw_builder_sheet");if(!t||!c)return;let s=c.querySelector(".aipkit_builder_sheet_title"),n=c.querySelector(".aipkit_builder_sheet_description"),d=c.querySelectorAll(".aipkit_builder_sheet_section"),a=c.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'),l=c.querySelector(".aipkit_builder_sheet_close"),p=f=>{if(!f)return;let g=f.getAttribute("data-sheet-title")||"Sheet",m=f.getAttribute("data-sheet-description")||"",u=f.getAttribute("data-sheet-content")||"placeholder";s&&(s.textContent=g),n&&(n.textContent=m);let h=!1;if(d.forEach(v=>{v.dataset.sheet===u?(v.hidden=!1,h=!0):v.hidden=!0}),!h&&a&&(a.hidden=!1),c.classList.add("aipkit-active"),c.setAttribute("aria-hidden","false"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_cw_builder_sheet"),u==="assistant"&&(typeof window.aipkit_initMessageCloseButtons=="function"&&window.aipkit_initMessageCloseButtons("aipkit_content_writer_messages"),typeof window.aipkit_initEnhancerActionsUI=="function"&&window.aipkit_initEnhancerActionsUI(),!c.dataset.assistantAutosaveBound)){let v=k(c);c.dataset.assistantAutosaveBaseline=o(v),c.addEventListener("change",S=>{let q=S.target;!q||!q.matches("#aipkit_enhancer_editor_integration")&&!q.matches("#aipkit_enhancer_list_button")&&!q.matches('input[name="enhancer_insert_position_default"]')||r(c)}),c.dataset.assistantAutosaveBound="true"}l&&l.focus()},_=()=>{c.classList.remove("aipkit-active"),c.setAttribute("aria-hidden","true")};t.dataset.assistantSheetBound||(t.addEventListener("click",f=>{let g=f.target.closest(".aipkit_builder_sheet_trigger");g&&(f.preventDefault(),p(g))}),t.dataset.assistantSheetBound="true"),l&&l.dataset.assistantSheetBound!=="true"&&(l.addEventListener("click",_),l.dataset.assistantSheetBound="true"),c.dataset.assistantSheetBound||(c.addEventListener("click",f=>{f.target===c&&_()}),document.addEventListener("keydown",f=>{f.key==="Escape"&&c.classList.contains("aipkit-active")&&_()}),c.dataset.assistantSheetBound="true")}window.aipkit_initContentWriterAssistantSheet=i})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],o=d=>{let a=k.findIndex(l=>l.key===d);return a===-1?1:a},r=(d,a)=>{let l=Number(d);if(!l||Number.isNaN(l))return"medium";let p="medium",_=1/0;return Object.keys(a).forEach(f=>{let g=Math.abs(l-a[f]);g<_&&(_=g,p=f)}),p},i=(d,a)=>{if(!d)return;let l=d.querySelector(".aipkit_ai_behavior_value"),p=d.querySelector(".aipkit_ai_behavior_hint"),_=d.querySelector(".aipkit_ai_length_slider"),f=k[o(a)];l&&(l.textContent=f.label),p&&(p.textContent=`Approx. ${f.words} words`),_&&(_.value=String(o(a)+1))},e=d=>{let a=d.querySelector(".aipkit_ai_temperature_control");if(!a)return;let l=a.querySelector(".aipkit_ai_temperature_slider"),p=a.querySelector(".aipkit_ai_behavior_value");if(!l||!p||l.dataset.enhancedListenerAttached==="true")return;let _=()=>{p.textContent=l.value};l.addEventListener("input",_),_(),l.dataset.enhancedListenerAttached="true"},t=d=>{let a=d.querySelectorAll(".aipkit_ai_reasoning_input"),l=d.querySelector("[data-aipkit-reasoning-select]");if(!a.length||!l||l.dataset.reasoningSyncAttached==="true")return;let p=f=>f==="minimal"?"low":f,_=f=>{let g=p(f);d.querySelectorAll(".aipkit_ai_reasoning_option").forEach(u=>u.classList.remove("aipkit_ai_reasoning_option--selected"));let m=d.querySelector(`.aipkit_ai_reasoning_input[value="${g}"]`);if(m){m.checked=!0;let u=m.closest(".aipkit_ai_reasoning_option");u&&u.classList.add("aipkit_ai_reasoning_option--selected")}};a.forEach(f=>{f.dataset.reasoningListenerAttached!=="true"&&(f.addEventListener("change",()=>{f.checked&&(l.value=p(f.value),l.dispatchEvent(new Event("change",{bubbles:!0})),_(f.value))}),f.dataset.reasoningListenerAttached="true")}),l.addEventListener("change",()=>{_(l.value||"medium")}),_(l.value||"medium"),l.dataset.reasoningSyncAttached="true"},c=d=>{let a=d.querySelector(".aipkit_ai_length_control");if(!a)return;let l=a.querySelector(".aipkit_ai_length_slider"),p=a.querySelector("[data-aipkit-length-input]");if(!l||!p||l.dataset.lengthListenerAttached==="true")return;let _=a.dataset.aipkitLengthMode||"content_length",f={short:Number(a.dataset.aipkitLengthShort||2e3),medium:Number(a.dataset.aipkitLengthMedium||4e3),long:Number(a.dataset.aipkitLengthLong||6e3)},g=(u,h)=>{let v=k.some(S=>S.key===u)?u:"medium";if(i(a,v),_==="content_length")p.value!==v&&(p.value=v);else{let S=f[v]||f.medium;Number(p.value)!==S&&(p.value=String(S))}h&&p.dispatchEvent(new Event("change",{bubbles:!0}))},m=()=>{if(_==="content_length"){g(p.value||"medium",!1);return}let u=r(p.value,f);g(u,!1)};l.addEventListener("input",()=>{let u=Math.max(1,Math.min(3,Number(l.value||2)))-1,h=k[u]?.key||"medium";g(h,!0)}),p.addEventListener("change",m),m(),l.dataset.lengthListenerAttached="true"},s=d=>{!d||d.dataset.aiSettingsInit==="true"||(e(d),c(d),t(d),d.dataset.aiSettingsInit="true")};function n(d){let a=d||document.getElementById("aipkit_autogpt_container");a&&a.querySelectorAll(".aipkit_ai_settings_redesigned").forEach(s)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>n()):n(),window.aipkit_initAutogptAiSettingsRedesigned=n})();window.aipkit_isIndexingStopped=!1;(function(){"use strict";function k(o,r={},i={}){return new Promise((e,t)=>{if(!window.aipkit_dashboard||!window.aipkit_dashboard.ajaxurl)return t(new Error("AIPKit AJAX is not properly initialized (missing aipkit_dashboard object)"));let c=new FormData;c.append("action",o),!Object.prototype.hasOwnProperty.call(r,"_ajax_nonce")&&window.aipkit_dashboard&&window.aipkit_dashboard.nonce&&c.append("_ajax_nonce",window.aipkit_dashboard.nonce);for(let d in r)Object.prototype.hasOwnProperty.call(r,d)&&(Array.isArray(r[d])?r[d].forEach(a=>{c.append(d+"[]",a)}):c.append(d,r[d]));let s=new AbortController,n=setTimeout(()=>{s.abort()},i.timeout||12e4);fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:c,credentials:"same-origin",signal:s.signal}).then(d=>(clearTimeout(n),d.json())).then(d=>{if(d.success)e(d.data);else{let a=d.data||{},l=a.message||"Unknown error",p=new Error(l);a.debug_error&&(p.debug=a.debug_error),p.data=a,a.code&&(p.code=a.code),a.details&&(p.details=a.details),t(p)}}).catch(d=>{clearTimeout(n),d.name==="AbortError"?t(new Error("Request timeout")):t(d)})})}window.aipkit_apiRequest=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_modulesMenu");if(o){let i=o.querySelector(".aipkit_dropdown-panel"),e=o.querySelector(".aipkit_menu-trigger");e&&e.addEventListener("click",function(t){t.stopPropagation(),o.classList.toggle("aipkit_show-menu")}),i&&i.addEventListener("click",function(t){t.stopPropagation()})}document.addEventListener("click",function(i){o&&o.classList.contains("aipkit_show-menu")&&(o.contains(i.target)||o.classList.remove("aipkit_show-menu"))});let r=document.getElementById("aipkit_modulesMenuMobile");if(r){r.addEventListener("click",function(e){e.stopPropagation(),r.classList.toggle("aipkit_show-menu")});let i=r.querySelector(".aipkit_dropdown-menu");i&&i.addEventListener("click",function(e){e.stopPropagation()})}}window.aipkit_initSettingsMenus=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_upgradeBtn"),e=document.getElementById("aipkit_upgradeModal");!i||!e||(i.addEventListener("click",function(t){t.preventDefault(),o(e)}),e.querySelectorAll("[data-close-modal]").forEach(function(t){t.addEventListener("click",function(c){c.preventDefault(),r(e)})}),document.addEventListener("keydown",function(t){t.key==="Escape"&&e.classList.contains("aipkit_active")&&r(e)}),e.querySelector(".aipkit_modal").addEventListener("click",function(t){t.stopPropagation()}))}function o(i){i.classList.add("aipkit_active"),document.body.classList.add("aipkit_upgrade_modal_open");let e=i.querySelector('button, a, [tabindex]:not([tabindex="-1"])');e&&setTimeout(()=>e.focus(),100)}function r(i){i.classList.remove("aipkit_active"),document.body.classList.remove("aipkit_upgrade_modal_open")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initUpgradeModal=k})();(function(){"use strict";let k={settings:"aipkit_initSettings",chatbot:"aipkit_initChatbot",stats:"aipkit_initStats","image-generator":"aipkit_initImageGenerator",sources:"aipkit_initSources","ai-forms":"aipkit_initAiForms",autogpt:"aipkit_initAutogpt","content-writer":"aipkit_initContentWriter"};async function o(r,i,e){let t={};if(typeof i=="function"?e=i:typeof i=="object"&&i!==null&&(t=i),r==="chatbot"&&!t.force_active_bot_id&&!t.force_active_tab)try{let l=localStorage.getItem("aipkit_last_selected_chatbot");l&&(t.force_active_bot_id=l)}catch(l){console.warn("AIPKit Loader: Failed to retrieve saved chatbot from localStorage:",l)}if(r==="chatbot"&&!t.layout)try{new URLSearchParams(window.location.search).get("aipkit_chatbot_layout")==="next"&&(t.layout="next")}catch(l){console.warn("AIPKit Loader: Failed to read chatbot layout flag from URL:",l)}document.querySelectorAll(".aipkit_module-link").forEach(l=>l.classList.remove("aipkit_active"));let s=document.querySelector(`.aipkit_module-link[data-module="${r}"]`);s&&s.classList.add("aipkit_active");let n=document.getElementById("aipkit_module-container");if(!n)return console.error("AIPKit Loader: Module container #aipkit_module-container not found."),typeof e=="function"&&e(new Error("Module container not found.")),Promise.reject(new Error("Module container not found."));let d=window.aipkit_dashboard?.text?.loading?window.aipkit_dashboard.text.loading.replace("%s",r):`Loading ${r}...`;if(n.innerHTML=`
            <div class="aipkit_container aipkit_loading-placeholder">
                <div class="aipkit_container-body">
                    <p style="text-align: center; padding: 30px;">
                        <span class="aipkit_spinner"
                            style="display: inline-block; width: 20px; height: 20px; border-width: 3px; vertical-align: middle; margin-right: 10px;">
                        </span>
                        ${d}
                    </p>
                </div>
            </div>
        `,typeof window.aipkit_apiRequest!="function"){let l="Core API function missing. Cannot load module.";return console.error(`AIPKit Loader: aipkit_apiRequest function not found for module '${r}'.`),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(n,r,l),typeof e=="function"&&e(new Error(l)),Promise.reject(new Error(l))}let a={module:r,...t};try{let l=await window.aipkit_apiRequest("aipkit_dashboard_load_module",a);if(!l||typeof l.html!="string")throw new Error('Missing or invalid "html" in response data');n.innerHTML=l.html,r==="chatbot"&&l.openaiVectorStores&&(window.aipkit_chat_config?window.aipkit_chat_config.openaiVectorStores=l.openaiVectorStores:console.warn("AIPKit Loader: window.aipkit_chat_config object not found; cannot update openaiVectorStores.")),typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():console.warn("AIPKit Loader: aipkit_initializeTabs function not found.");let p=k[r];if(p&&typeof window[p]=="function")try{window[p]()}catch(_){let f=`Error initializing ${r} module scripts.`;return console.error(`AIPKit Loader: Error executing initializer '${p}':`,_),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(n,r,f+` (Details: ${_.message})`),typeof e=="function"&&e(new Error(f+` (Details: ${_.message})`)),Promise.reject(new Error(f+` (Details: ${_.message})`))}return typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(n),typeof e=="function"&&e(),Promise.resolve()}catch(l){return l&&l.debug?console.error(`AIPKit Loader: Module loading error for '${r}':`,l.message,`
Server debug:`,l.debug):console.error(`AIPKit Loader: Module loading error for '${r}':`,l),typeof window.aipkit_renderModuleError=="function"&&window.aipkit_renderModuleError(n,r,l.message),typeof e=="function"&&e(l),Promise.reject(l)}}window.aipkit_loadModule=o})();(function(){"use strict";function k(o,r,i){if(!o)return;let e=window.aipkit_dashboard?.text||{},t=e.errorLoadingModuleTitle||"Error Loading Module",c=e.errorLoadingModuleMsg||"An error occurred while loading the '%s' module. Please try again later or check the console.",s=e.errorDetails||"Details:",n=c.replace("%s",r);o.innerHTML=`
            <div class="aipkit_container">
                <div class="aipkit_container-header">
                    <div class="aipkit_container-title" style="color: var(--aipkit_status-warning, red);">${t}</div>
                </div>
                <div class="aipkit_container-body">
                    <p>${n}</p>
                    <p><strong>${s}</strong></p>
                    <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f8f8; border: 1px solid #eee; padding: 5px;">${i||"No specific error details available."}</pre>
                </div>
            </div>`}window.aipkit_renderModuleError=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_modulesMenu");if(!o)return;let r=o.querySelector(".aipkit_dropdown-panel");r&&(r.addEventListener("change",function(i){let e=i.target;if(e.matches&&e.matches(".aipkit_module-toggle")){let t=r.querySelectorAll(".aipkit_module-toggle");t.forEach(_=>_.disabled=!0),t.forEach(_=>_.disabled=!0);let c=e.getAttribute("data-module"),s=e.getAttribute("data-option-key"),n=e.getAttribute("data-icon"),d=e.getAttribute("data-label"),a=e.checked,l=document.querySelector(`.aipkit_module-link[data-module="${c}"]`);a?l?l.style.display="":console.log(`Module Toggle: Enabling '${c}'. Nav link will appear on refresh if needed.`):l&&(l.style.display="none");let p={moduleKey:s,enabled:a?"1":"0"};if(typeof window.aipkit_apiRequest!="function"){console.error("Module Toggle: API request function missing."),e.checked=!a,l&&(l.style.display=a?"none":""),t.forEach(_=>_.disabled=!1);return}window.aipkit_apiRequest("aipkit_update_module_setting",p).then(()=>{console.log(`Module Toggle: '${c}' status updated successfully.`)}).catch(_=>{console.error("Error updating module setting:",_.message),alert(`Error updating module setting: ${_.message}`),e.checked=!a,l&&(l.style.display=a?"none":"")}).finally(()=>{t.forEach(_=>_.disabled=!1)})}}),r.addEventListener("click",function(i){let e=i.target.closest(".aipkit_module-item");if(e){let t=e.querySelector(".aipkit_toggle-switch");if(t&&!t.contains(i.target)){let c=e.querySelector(".aipkit_module-toggle");if(c&&!c.disabled){c.checked=!c.checked;let s=new Event("change",{bubbles:!0});c.dispatchEvent(s)}}}}))}window.aipkit_initModuleToggles=k})();(function(){"use strict";function k(){document.querySelectorAll(".aipkit_tabs").forEach(i=>{if(i.dataset.tabGroupListenerAttached==="true")return;let e=i.querySelectorAll(".aipkit_tab"),t=i.nextElementSibling;if(!t||!t.classList.contains("aipkit_tab_content_container")){let c=i.closest(".aipkit_container-body, .aipkit_container"),s=c?c.querySelector(".aipkit_tab_content_container"):null;if(!s)return;let n=s.querySelectorAll(".aipkit_tab-content");o(i,e,n)}else{let c=t.querySelectorAll(".aipkit_tab-content");o(i,e,c)}})}function o(r,i,e){i.forEach(t=>{t.addEventListener("click",function(){i.forEach(n=>n.classList.remove("aipkit_active")),this.classList.add("aipkit_active"),e.forEach(n=>n.classList.remove("aipkit_active"));let c=this.getAttribute("data-tab"),s=Array.from(e).find(n=>n.id===c+"-content");s&&(s.classList.add("aipkit_active"),s.id==="indexing-settings-tab-content"&&typeof window.aipkit_initIndexingSettings=="function"&&window.aipkit_initIndexingSettings())})}),r.dataset.tabGroupListenerAttached="true"}window.aipkit_initializeTabs=k})();document.addEventListener("DOMContentLoaded",function(){typeof window.aipkit_initSettingsMenus=="function"?window.aipkit_initSettingsMenus():console.error("AIPKit Main: aipkit_initSettingsMenus function not found."),typeof window.aipkit_initModuleToggles=="function"?window.aipkit_initModuleToggles():console.error("AIPKit Main: aipkit_initModuleToggles function not found.");let r=new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager";if(r)console.log("AIPKit Main: On Role Manager page, skipping initial module load.");else if(typeof window.aipkit_loadModule=="function"){let i=["settings","chatbot","content-writer","ai-forms","image-generator","sources"],e=Array.from(document.querySelectorAll(".aipkit_module-link")),t=null;for(let c=0;c<i.length;c++){let s=i[c];if(e.find(d=>d.getAttribute("data-module")===s&&d.offsetParent!==null)){t=s;break}}if(!t){let c=e.find(s=>s.offsetParent!==null);c&&(t=c.getAttribute("data-module"))}if(t)window.aipkit_loadModule(t);else if(e.find(s=>s.getAttribute("data-module")==="settings"))window.aipkit_loadModule("settings");else{let s=document.getElementById("aipkit_module-container");s&&typeof window.aipkit_renderModuleError=="function"?window.aipkit_renderModuleError(s,"initial","No modules enabled or accessible. Please activate modules via the top-right menu or check permissions."):s&&(s.innerHTML='<p style="text-align:center; padding: 30px;">No modules enabled. Activate modules via the top-right menu.</p>')}}else if(typeof window.aipkit_loadModule!="function"&&!r){console.error("AIPKit Main: Module loader function (aipkit_loadModule) not found.");let i=document.getElementById("aipkit_module-container");i&&(i.innerHTML='<p style="color:red; text-align:center; padding: 30px;">Critical Error: Failed to load dashboard components.</p>')}});(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_sources_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),t=r.querySelector(".aipkit_model_settings_popover_back"),c=o.querySelector("#aipkit_sources_settings_trigger"),s={root:r.dataset.titleRoot||"Settings",general:r.dataset.titleGeneral||"General","provider-credentials":r.dataset.titleProviderCredentials||"Provider credentials","document-chunking":r.dataset.titleDocumentChunking||"Document chunking"},n=null,d=a=>{let l=a||"root",p=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let _=p.dataset.aipkitSettingsPanel||"root";_!==n&&(i.forEach(f=>{f.hidden=f!==p}),e&&(e.textContent=s[_]||s.root),t&&(t.hidden=_==="root"),n=_,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",a=>{let l=a.target.closest("[data-aipkit-panel-target]");if(!l)return;a.preventDefault();let p=l.dataset.aipkitPanelTarget;d(p)}),t&&t.addEventListener("click",a=>{a.preventDefault(),d("root")}),c&&c.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitSources_initSettingsPopoverPanels=k})();(function(){"use strict";let k=window.wp&&window.wp.i18n?window.wp.i18n:null,o=k&&typeof k.__=="function"?k.__:M=>M,r=k&&typeof k.sprintf=="function"?k.sprintf:(M,...B)=>M.replace(/%s/g,()=>B.shift()),i=k&&typeof k._n=="function"?k._n:(M,B,V)=>V===1?M:B,e=typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml:M=>String(M??""),t=60,c={openai:{singular:o("Vector store","gpt3-ai-content-generator"),plural:o("Vector stores","gpt3-ai-content-generator"),loading:o("Loading vector stores...","gpt3-ai-content-generator"),empty:o("No vector stores found.","gpt3-ai-content-generator")},pinecone:{singular:o("Index","gpt3-ai-content-generator"),plural:o("Indexes","gpt3-ai-content-generator"),loading:o("Loading indexes...","gpt3-ai-content-generator"),empty:o("No indexes found.","gpt3-ai-content-generator")},qdrant:{singular:o("Collection","gpt3-ai-content-generator"),plural:o("Collections","gpt3-ai-content-generator"),loading:o("Loading collections...","gpt3-ai-content-generator"),empty:o("No collections found.","gpt3-ai-content-generator")},default:{singular:o("Index","gpt3-ai-content-generator"),plural:o("Indexes","gpt3-ai-content-generator"),loading:o("Loading indexes...","gpt3-ai-content-generator"),empty:o("No indexes found.","gpt3-ai-content-generator")}},s={openai:{key:"openai",typeLabel:o("Vector stores","gpt3-ai-content-generator"),emptyLabel:o("No vector stores found.","gpt3-ai-content-generator"),loadingLabel:o("Loading vector stores...","gpt3-ai-content-generator"),listAction:"aipkit_list_vector_stores_openai",listKey:"stores",createAction:"aipkit_create_vector_store_openai",createKey:"store",nameLabel:o("Store name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. Product FAQ","gpt3-ai-content-generator"),countSingular:o("store","gpt3-ai-content-generator"),countPlural:o("stores","gpt3-ai-content-generator"),needsDimension:!1},pinecone:{key:"pinecone",typeLabel:o("Indexes","gpt3-ai-content-generator"),emptyLabel:o("No indexes found.","gpt3-ai-content-generator"),loadingLabel:o("Loading indexes...","gpt3-ai-content-generator"),listAction:"aipkit_list_indexes_pinecone",listKey:"indexes",createAction:"aipkit_create_index_pinecone",createKey:"index",nameLabel:o("Index name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. site-content","gpt3-ai-content-generator"),countSingular:o("index","gpt3-ai-content-generator"),countPlural:o("indexes","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536},qdrant:{key:"qdrant",typeLabel:o("Collections","gpt3-ai-content-generator"),emptyLabel:o("No collections found.","gpt3-ai-content-generator"),loadingLabel:o("Loading collections...","gpt3-ai-content-generator"),listAction:"aipkit_list_collections_qdrant",listKey:"collections",createAction:"aipkit_create_collection_qdrant",createKey:"collection",nameLabel:o("Collection name","gpt3-ai-content-generator"),namePlaceholder:o("e.g. docs","gpt3-ai-content-generator"),countSingular:o("collection","gpt3-ai-content-generator"),countPlural:o("collections","gpt3-ai-content-generator"),needsDimension:!0,defaultDimension:1536}},n={openai:"aipkit_vector_store_nonce_openai",pinecone:"aipkit_vector_store_pinecone_nonce_management",qdrant:"aipkit_vector_store_qdrant_nonce_management"},d={openai:{action:"aipkit_delete_vector_store_openai",param:"store_id",label:o("vector store","gpt3-ai-content-generator")},pinecone:{action:"aipkit_delete_index_pinecone",param:"index_name",label:o("index","gpt3-ai-content-generator")},qdrant:{action:"aipkit_delete_collection_qdrant",param:"collection_name",label:o("collection","gpt3-ai-content-generator")}},a="aipkit_sources_filters_v1";function l(){try{let M=window.localStorage.getItem(a);if(!M)return{};let B=JSON.parse(M);return B&&typeof B=="object"?B:{}}catch{return{}}}function p(M){try{window.localStorage.setItem(a,JSON.stringify(M))}catch{}}function _(M){if(!M)return[];try{let B=JSON.parse(M);return Array.isArray(B)?B:[]}catch{return[]}}function f(M,B){return M?M.length>B?`${M.slice(0,B)}...`:M:""}function g(M){return String(M||"").trim().toLowerCase()}function m(M){return s[g(M)]||null}function u(M){return d[g(M)]||null}function h(M){let B=g(M);return c[B]||c.default}function v(){let M=window.aipkit_dashboard&&window.aipkit_dashboard.providerStatus;return M&&typeof M=="object"?M:{}}function S(M){let B=g(M),V=v();return Object.prototype.hasOwnProperty.call(V,B)?!!V[B]:null}function q(M){let B=S(M);return B===!0?{label:o("Connected","gpt3-ai-content-generator"),className:"aipkit_status-success"}:B===!1?{label:o("Needs setup","gpt3-ai-content-generator"),className:"aipkit_status-warning"}:{label:o("Unknown","gpt3-ai-content-generator"),className:"aipkit_status-info"}}function y(M,B){return!B||typeof B!="object"?"":M==="openai"?B.id||B.vector_store_id||"":M==="pinecone"?B.name||B.id||"":M==="qdrant"?B.name||B.id||B.collection_name||"":B.id||B.name||""}function E(M,B){let V=y(M,B);return!B||typeof B!="object"?V||"\u2014":B.name||B.vector_store_name||V||"\u2014"}function I(M){let B=String(M?.message||"").toLowerCase(),V=g(M?.provider||""),L=String(M?.file_id||""),U=!!M?.post_id;if(B.includes("file content submitted for indexing")||B.includes("file content embedded and upserted")||B.includes("original filename:")||B.includes("file uploaded"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if((V==="pinecone"||V==="qdrant")&&L&&(L.includes("pinecone_file_")||L.includes("file_"))&&!L.startsWith("wp_post_")&&!L.startsWith("text_"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"};if(B.includes("text content submitted for indexing"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(V==="qdrant"&&B.includes("points upserted to qdrant"))return U||B.includes("post id:")?{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"}:{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(V==="pinecone"&&B.includes("vectors upserted")){if(L.startsWith("wp_post_"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(L.startsWith("text_"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"};if(L.includes("pinecone_file_")||L.includes("file_"))return{key:"file",label:o("File Upload","gpt3-ai-content-generator"),className:"aipkit_type-file"}}if(B.includes("wordpress post content submitted for indexing"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(U)return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(V==="pinecone"&&L){if(L.startsWith("wp_post_"))return{key:"site",label:o("Site Content","gpt3-ai-content-generator"),className:"aipkit_type-site"};if(L.startsWith("text_"))return{key:"text",label:o("Text","gpt3-ai-content-generator"),className:"aipkit_type-text"}}return{key:"na",label:o("N/A","gpt3-ai-content-generator"),className:""}}function w(M){let B=M||"";return B==="indexed"||B==="skipped_already_indexed"||B==="success"?{label:o("Trained","gpt3-ai-content-generator"),className:"aipkit_status-success"}:B==="failed"?{label:B.replace(/_/g," "),className:"aipkit_status-warning"}:B?{label:B.replace(/_/g," "),className:"aipkit_status-info"}:{label:"\u2014",className:"aipkit_status-info"}}function A(M){return M.post_title?String(M.post_title):M.post_id?`${o("Post","gpt3-ai-content-generator")} #${M.post_id}`:M.indexed_content?String(M.indexed_content):M.message?String(M.message):M.file_id?String(M.file_id):M.vector_store_name?String(M.vector_store_name):"\u2014"}function C(M){let B=g(M);return B?{openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant"}[B]||String(M):"\u2014"}function b(M){let B=g(M);return B&&["openai","pinecone","qdrant"].includes(B)?`aipkit_settings_select_picker_icon--${B}`:""}function x(M){return M.vector_store_name?String(M.vector_store_name):M.vector_store_id?String(M.vector_store_id):"\u2014"}function T(M,B,V){if(!M)return;let L=M.classList.contains("aipkit_training_status");if(M.textContent=B||"",L){M.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),B&&M.classList.add("is-visible"),V&&M.classList.add(`is-${V}`);return}M.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),V==="success"?M.classList.add("aipkit_form-help-success"):V==="error"&&M.classList.add("aipkit_form-help-error")}function P(M,B,V){M&&(M.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${e(V)}</td></tr>`,B&&(B.innerHTML=""))}function H(M,B){if(!M)return;if(!Array.isArray(B)||!B.length){P(M,null,o("No sources found.","gpt3-ai-content-generator"));return}let V=B.map(L=>{let U=I(L),W=w(L.status),ee=L.status==="processing"||L.status==="queued",ne=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(L.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(L.timestamp):L.timestamp||"\u2014",z=C(L.provider),ge=b(L.provider),Ae=ge?`<span class="aipkit_settings_select_picker_icon ${e(ge)}" aria-hidden="true"></span>`:"",ot=x(L),ze=f(ot,40),Xe=z?`${z} \xB7 ${ot}`:ot,Ge=String(A(L)||"\u2014"),It=f(Ge,t),Qe=L.indexed_content||"",Ce=[];return U.key==="site"&&L.post_id&&L.vector_store_id&&L.file_id&&Ce.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              data-post-id="${e(L.post_id||"")}"
              data-embedding-provider="${e(L.embedding_provider||"")}"
              data-embedding-model="${e(L.embedding_model||"")}"
              ${ee?'disabled aria-disabled="true"':""}
            >${e(o(ee?"Training...":"Retrain","gpt3-ai-content-generator"))}</button>`),U.key==="text"&&Qe&&L.vector_store_id&&L.file_id&&Ce.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              data-embedding-provider="${e(L.embedding_provider||"")}"
              data-embedding-model="${e(L.embedding_model||"")}"
              data-content="${e(encodeURIComponent(Qe))}"
              ${ee?'disabled aria-disabled="true"':""}
            >${e(o(ee?"Training...":"Edit","gpt3-ai-content-generator"))}</button>`),Qe&&Ce.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_view"
              data-snippet="${e(Qe)}"
              ${ee?'disabled aria-disabled="true"':""}
            >${e(o("View","gpt3-ai-content-generator"))}</button>`),L.file_id&&Ce.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
              data-provider="${e(L.provider||"")}"
              data-store-id="${e(L.vector_store_id||"")}"
              data-vector-id="${e(L.file_id||"")}"
              data-log-id="${e(L.id||"")}"
              ${ee?'disabled aria-disabled="true"':""}
            >${e(o("Delete","gpt3-ai-content-generator"))}</button>`),`<tr data-log-id="${e(L.id||"")}">
          <td>${e(ne)}</td>
          <td title="${e(Xe)}">
            <span class="aipkit_popover_option_label_group">
              ${Ae}
              <span>${e(ze)}</span>
            </span>
          </td>
          <td><span class="aipkit_content-type-tag ${e(U.className)}">${e(U.label)}</span></td>
          <td title="${e(Ge)}">${e(It)}</td>
          <td><span class="aipkit_status-tag ${e(W.className)}">${e(W.label)}</span></td>
          <td class="aipkit_actions_cell">
            <div class="aipkit-table-actions-group">${Ce.join("")}</div>
          </td>
        </tr>`}).join("");M.innerHTML=V}function O(M,B,V){if(!B)return;B.innerHTML="";let L=Number(M?.total_logs||0),U=Number(M?.total_pages||0),W=Number(M?.current_page||1);if(!L)return;let ee=document.createElement("span");if(ee.className="aipkit_pagination-count",ee.textContent=`${L.toLocaleString()} ${i("source","sources",L,"gpt3-ai-content-generator")}`,B.appendChild(ee),U<=1)return;let ne=document.createElement("span");ne.className="aipkit_pagination-links";let z=document.createElement("button");z.type="button",z.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",z.textContent=o("Prev","gpt3-ai-content-generator"),z.disabled=W<=1,z.addEventListener("click",()=>V(W-1));let ge=document.createElement("span");ge.className="aipkit_pagination-current",ge.textContent=`${W}/${U}`;let Ae=document.createElement("button");Ae.type="button",Ae.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",Ae.textContent=o("Next","gpt3-ai-content-generator"),Ae.disabled=W>=U,Ae.addEventListener("click",()=>V(W+1)),ne.appendChild(z),ne.appendChild(ge),ne.appendChild(Ae),B.appendChild(ne)}function F(){let M=document.getElementById("aipkit_sources_module_container");if(!M)return;let B=document.getElementById("aipkit_sources_table_body"),V=document.getElementById("aipkit_sources_pagination"),L=document.getElementById("aipkit_sources_status"),U=document.getElementById("aipkit_sources_provider_filter"),W=document.getElementById("aipkit_sources_index_filter"),ee=document.getElementById("aipkit_sources_status_filter"),ne=document.getElementById("aipkit_sources_type_filter"),z=document.getElementById("aipkit_sources_search_input"),ge=document.getElementById("aipkit_sources_provider_popover_body"),Ae=document.getElementById("aipkit_sources_settings_trigger"),ot=document.getElementById("aipkit_sources_settings_popover"),ze=document.getElementById("aipkit_sources_indexing_manage"),Xe=M.querySelector('[data-aipkit-settings-action="indexing-controls"]'),Ge=ze||Xe,It=document.getElementById("aipkit_sources_settings_save"),Qe=document.getElementById("aipkit_sources_settings_sheet"),Ce=Qe?Qe.querySelector(".aipkit_builder_sheet_close"):null,St=document.getElementById("aipkit_save_indexing_settings_btn"),Rt=document.getElementById("aipkit_indexing_settings_messages"),vi=document.getElementById("aipkit_sources_settings_sheet_messages"),gi=document.getElementById("aipkit_sources_semantic_manage"),ae=M.querySelector('[data-aipkit-settings-action="semantic-search"]'),ke=gi||ae,ye=document.getElementById("aipkit_sources_semantic_sheet"),ve=ye?ye.querySelector(".aipkit_builder_sheet_close"):null,Re=document.getElementById("aipkit_sources_semantic_vector_provider"),Ie=document.getElementById("aipkit_sources_semantic_target_id"),at=document.getElementById("aipkit_sources_semantic_target_label"),rt=document.getElementById("aipkit_sources_semantic_embedding_model"),Ft=document.getElementById("aipkit_sources_semantic_embedding_provider"),_i=document.getElementById("aipkit_sources_semantic_num_results"),Lt=document.getElementById("aipkit_sources_semantic_no_results_text"),Et=document.getElementById("aipkit_sources_semantic_shortcode_copy"),tt=document.getElementById("aipkit_sources_semantic_demo_form"),De=document.getElementById("aipkit_sources_semantic_demo_input"),Ke=document.getElementById("aipkit_sources_semantic_demo_results"),xt=document.getElementById("aipkit_sources_semantic_demo_submit"),zt=document.getElementById("aipkit_sources_index_empty_action"),wt=document.getElementById("aipkit_sources_index_create_trigger"),Je=document.getElementById("aipkit_sources_editor_modal"),ui=Je?Je.querySelector(".aipkit_sources_editor_textarea"):null,bi=Je?Je.querySelector(".aipkit_sources_editor_close"):null,Xt=Je?Je.querySelector(".aipkit_sources_editor_cancel"):null,Tt=Je?Je.querySelector(".aipkit_sources_editor_save"):null,Qt=document.getElementById("aipkit_sources_view_modal"),ii=Qt?Qt.querySelector(".aipkit_sources_view_textarea"):null,Ri=Qt?Qt.querySelector(".aipkit_sources_view_close"):null,Qi=Qt?Qt.querySelector(".aipkit_sources_view_close_btn"):null,Ht=document.getElementById("aipkit_sources_delete_modal"),_e=Ht?Ht.querySelector(".aipkit_sources_delete_close"):null,Me=Ht?Ht.querySelector(".aipkit_sources_delete_cancel"):null,Ee=Ht?Ht.querySelector(".aipkit_sources_delete_confirm"):null;if(!B||typeof window.aipkit_apiRequest!="function")return;let lt=l(),st=lt.indexByProvider&&typeof lt.indexByProvider=="object"?{...lt.indexByProvider}:{},jt=lt.embeddingByProvider&&typeof lt.embeddingByProvider=="object"?{...lt.embeddingByProvider}:{};U&&typeof lt.provider=="string"&&Array.from(U.options).some(Y=>Y.value===lt.provider)&&(U.value=lt.provider),ee&&typeof lt.status=="string"&&Array.from(ee.options).some(Y=>Y.value===lt.status)&&(ee.value=lt.status),ne&&typeof lt.type=="string"&&Array.from(ne.options).some(Y=>Y.value===lt.type)&&(ne.value=lt.type),typeof window.aipkit_initChatSelectPickers=="function"&&window.aipkit_initChatSelectPickers();let Jt=null,$t=null,vt=null,Pt=null,ki=null,oi=null,Be={page:1,perPage:10,provider:U?U.value:"",status:ee?ee.value:"",type:ne?ne.value:"",search:z?z.value.trim():"",indexByProvider:st,embeddingByProvider:jt,openIndexCreateOnOpen:!1},Mt={activeProvider:"",stores:{},syncTokens:{}},ut={nonce:M.dataset.settingsNonce||"",isPro:M.dataset.settingsIsPro==="1"||M.dataset.settingsIsPro==="true"},Ci={initialized:!1,accordionsBound:!1,saveBound:!1,autosaveBound:!1,originalSettings:{}},tn=null,Dt=!1,on=!1,Zi={nonce:M.dataset.semanticSearchNonce||"",pineconeIndexes:_(M.dataset.semanticPineconeIndexes),qdrantCollections:_(M.dataset.semanticQdrantCollections)},sn={initialized:!1,autosaveBound:!1,dirty:!1},En=null,ni=!1,Vn=!1,Cn={pinecone_api_key:M.dataset.pineconeApiKey||"",qdrant_api_key:M.dataset.qdrantApiKey||"",qdrant_url:M.dataset.qdrantUrl||""},cn=null,ct=()=>{Jt&&window.clearTimeout(Jt),Jt=window.setTimeout(()=>{T(L,"","")},3e3)},yo=()=>{Pt&&window.clearTimeout(Pt),Pt=window.setTimeout(()=>{T(Rt,"","")},3e3)},Ti=()=>!W||W.disabled?"":W.value||"",Vt=()=>!W||!W.id?null:document.getElementById(`${W.id}_picker_btn`),vo=j=>{if(!W)return;let Y=!j;W.hidden=Y;let de=Vt();de&&(de.hidden=Y)},Bi=(j,Y={})=>{if(!W)return;W.disabled=j;let de=Vt();de&&(Y.disableTrigger!==!1?(de.disabled=j,j?de.setAttribute("aria-disabled","true"):de.removeAttribute("aria-disabled")):(de.disabled=!1,de.removeAttribute("aria-disabled")))},li=(j,Y)=>{if(!zt||!wt)return;zt.hidden=!j;let de=Vt();if(de&&(j?de.hidden=!0:(!W||!W.hidden)&&(de.hidden=!1)),!j)return;let ue=g(Y),fe=h(ue);wt.textContent=r(o("Create new %s","gpt3-ai-content-generator"),fe.singular.toLowerCase());let Fe=S(ue),$e=!!ue&&Fe!==!1;wt.disabled=!$e,$e?(wt.removeAttribute("aria-disabled"),wt.removeAttribute("title")):(wt.setAttribute("aria-disabled","true"),wt.setAttribute("title",o("Add credentials to create.","gpt3-ai-content-generator")))},bo=j=>{let Y=Vt();if(!Y||!j)return;let de=j.getBoundingClientRect(),ue={hidden:Y.hidden,style:Y.getAttribute("style")||""};Y.hidden=!1,Y.style.position="fixed",Y.style.left=`${Math.round(de.left)}px`,Y.style.top=`${Math.round(de.top)}px`,Y.style.width=`${Math.round(de.width)}px`,Y.style.height=`${Math.round(de.height)}px`,Y.style.opacity="0",Y.style.pointerEvents="none",Y.click();let fe=()=>{Y.setAttribute("style",ue.style),ue.hidden&&(Y.hidden=!0)};window.requestAnimationFrame(()=>{window.requestAnimationFrame(fe)})},an=()=>!W||!W.id?null:document.getElementById(`${W.id}_picker_popover`),di=()=>{let j=an();if(!j)return null;j.classList.add("aipkit_sources_index_picker_popover");let Y=j.querySelector(".aipkit_model_settings_popover_body");if(!Y)return null;let de=Y.querySelector(".aipkit_sources_index_picker_actions");return de||(de=document.createElement("div"),de.className="aipkit_sources_index_picker_actions",de.innerHTML=`
          <div class="aipkit_sources_index_action_list">
            <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_btn-small aipkit_sources_index_new_btn">
              <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
              ${Wt(o("New","gpt3-ai-content-generator"))}
            </button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_delete_btn" disabled aria-disabled="true">
              <span class="dashicons dashicons-trash" aria-hidden="true"></span>
              ${Wt(o("Delete","gpt3-ai-content-generator"))}
            </button>
          </div>
          <div class="aipkit_sources_index_inline_form" style="display: none;">
            <div class="aipkit_popover_options_list">
              <div class="aipkit_popover_option_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label aipkit_sources_index_create_label" for="aipkit_sources_index_name_input">
                    ${Wt(o("Create","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="text"
                      id="aipkit_sources_index_name_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--wide aipkit_popover_option_input--vector-wide aipkit_popover_option_input--framed"
                      placeholder=""
                      data-aipkit-provider-name-input
                    >
                  </div>
                </div>
              </div>
              <div class="aipkit_popover_option_row aipkit_sources_index_dimension_row">
                <div class="aipkit_popover_option_main">
                  <label class="aipkit_popover_option_label" for="aipkit_sources_index_dimension_input">
                    ${Wt(o("Dimension","gpt3-ai-content-generator"))}
                  </label>
                  <div class="aipkit_popover_option_actions">
                    <input
                      type="number"
                      id="aipkit_sources_index_dimension_input"
                      class="aipkit_form-input aipkit_popover_option_input aipkit_popover_option_input--compact aipkit_popover_option_input--framed"
                      min="1"
                      placeholder="${Wt(o("e.g. 1536","gpt3-ai-content-generator"))}"
                      data-aipkit-provider-dimension-input
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="aipkit_sources_index_inline_actions">
              <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_create">
                ${Wt(o("Cancel","gpt3-ai-content-generator"))}
              </button>
              <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_sources_index_create_btn">
                ${Wt(o("Create","gpt3-ai-content-generator"))}
              </button>
            </div>
          </div>
          <div class="aipkit_inline_confirm aipkit_sources_index_inline_confirm" style="display: none;">
            <div class="aipkit_inline_confirm_content">
              <p class="aipkit_builder_help_text aipkit_sources_index_delete_confirm_text"></p>
              <div class="aipkit_inline_confirm_actions">
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_btn-small aipkit_sources_index_confirm_delete">
                  ${Wt(o("Confirm","gpt3-ai-content-generator"))}
                </button>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_sources_index_cancel_delete">
                  ${Wt(o("Cancel","gpt3-ai-content-generator"))}
                </button>
              </div>
            </div>
          </div>
          <p class="aipkit_form-help aipkit_sources_index_status" aria-live="polite" style="display: none;"></p>
        `,Y.appendChild(de)),de},kn=()=>{let j=di();return j?{footer:j,actionList:j.querySelector(".aipkit_sources_index_action_list"),newButton:j.querySelector(".aipkit_sources_index_new_btn"),deleteButton:j.querySelector(".aipkit_sources_index_delete_btn"),inlineForm:j.querySelector(".aipkit_sources_index_inline_form"),createButton:j.querySelector(".aipkit_sources_index_create_btn"),cancelCreate:j.querySelector(".aipkit_sources_index_cancel_create"),nameInput:j.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:j.querySelector("[data-aipkit-provider-dimension-input]"),dimensionRow:j.querySelector(".aipkit_sources_index_dimension_row"),createLabel:j.querySelector(".aipkit_sources_index_create_label"),deleteConfirm:j.querySelector(".aipkit_sources_index_inline_confirm"),deleteConfirmText:j.querySelector(".aipkit_sources_index_delete_confirm_text"),confirmDelete:j.querySelector(".aipkit_sources_index_confirm_delete"),cancelDelete:j.querySelector(".aipkit_sources_index_cancel_delete"),statusEl:j.querySelector(".aipkit_sources_index_status")}:null},wn=(j,Y)=>{let de=kn(),ue=L||(de?de.statusEl:null);ue&&(T(ue,j,Y),de&&ue===de.statusEl&&(ue.style.display=j?"block":"none"))},Pi=()=>{vt&&window.clearTimeout(vt),vt=window.setTimeout(()=>{wn("","")},3e3)},fi=()=>{let j=kn();j&&(j.inlineForm&&(j.inlineForm.style.display="none"),j.deleteConfirm&&(j.deleteConfirm.style.display="none"),j.actionList&&(j.actionList.style.display=""),j.nameInput&&(j.nameInput.value=""),j.dimensionInput&&(j.dimensionInput.value=""),wn("",""))},Un=j=>{let Y=kn();if(!Y)return;let de=g(j),ue=de?S(de):null,fe=!!de&&ue!==!1,Fe=fe&&!!(W&&W.value);Y.nameInput&&(Y.nameInput.disabled=!fe),Y.dimensionInput&&(Y.dimensionInput.disabled=!fe),Y.newButton&&(Y.newButton.disabled=!fe,fe?Y.newButton.removeAttribute("aria-disabled"):Y.newButton.setAttribute("aria-disabled","true")),Y.createButton&&(Y.createButton.disabled=!fe,fe?Y.createButton.removeAttribute("aria-disabled"):Y.createButton.setAttribute("aria-disabled","true")),Y.deleteButton&&(Y.deleteButton.disabled=!Fe,Fe?Y.deleteButton.removeAttribute("aria-disabled"):Y.deleteButton.setAttribute("aria-disabled","true"))},Ji=j=>{let Y=kn();if(!Y||!Y.dimensionInput)return;let de=g(j),ue=m(de);if(!ue||!ue.needsDimension)return;let fe=ue.defaultDimension||1536;Y.dimensionInput.value||(Y.dimensionInput.value=String(fe))},wi=j=>{let Y=kn();if(!Y)return;let de=g(j),ue=m(de),fe=h(de),Fe=ue?ue.namePlaceholder:"",$e=ue?ue.nameLabel:fe.singular;Y.createLabel&&(Y.createLabel.textContent=fe.singular),Y.nameInput&&(Y.nameInput.placeholder=Fe,Y.nameInput.setAttribute("aria-label",$e)),Y.dimensionRow&&(Y.dimensionRow.style.display=ue&&ue.needsDimension?"":"none"),Un(de)},Mn=()=>{let j=kn();if(!j||j.footer.dataset.indexActionsBound==="true")return;j.newButton&&j.newButton.addEventListener("click",()=>{fi(),j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display=""),Ji(U?U.value:""),j.nameInput&&(j.nameInput.focus(),j.nameInput.select())}),j.cancelCreate&&j.cancelCreate.addEventListener("click",()=>{fi()}),j.deleteButton&&j.deleteButton.addEventListener("click",()=>{let de=g(U?U.value:""),ue=W?W.value:"";if(!de||!ue){let We=h(de);wn(r(o("Select a %s to delete.","gpt3-ai-content-generator"),We.singular.toLowerCase()),"error"),Pi();return}let fe=W&&W.selectedOptions?W.selectedOptions[0]:null,Fe=fe?fe.textContent:ue,$e=u(de),Ne=$e?$e.label:h(de).singular.toLowerCase();j.deleteConfirmText&&(j.deleteConfirmText.textContent=r(o('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Ne,Fe)),j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display="none"),j.deleteConfirm&&(j.deleteConfirm.style.display="")}),j.cancelDelete&&j.cancelDelete.addEventListener("click",()=>{fi()}),j.createButton&&j.createButton.addEventListener("click",async()=>{let de=g(U?U.value:"");if(!de)return;let ue=await un(de,j.createButton,{root:j.inlineForm,statusUpdater:wn,clearStatusSoon:Pi});Un(de),ue&&ue.success&&fi()}),j.confirmDelete&&j.confirmDelete.addEventListener("click",async()=>{let de=g(U?U.value:""),ue=W?W.value:"";if(!de||!ue)return;let fe=W&&W.selectedOptions?W.selectedOptions[0]:null,Fe=fe?fe.textContent:ue,$e=await io(de,ue,Fe,j.confirmDelete,{skipConfirm:!0,statusUpdater:wn,clearStatusSoon:Pi,defaultLabel:o("Confirm","gpt3-ai-content-generator")});Ze(),$e&&(fi(),Ki(1))}),j.footer.dataset.indexActionsBound="true";let Y=Vt();Y&&Y.dataset.indexActionsBound!=="true"&&(Y.addEventListener("click",()=>{fi(),wi(Be.provider||""),Be.openIndexCreateOnOpen&&(Be.openIndexCreateOnOpen=!1,j.actionList&&(j.actionList.style.display="none"),j.inlineForm&&(j.inlineForm.style.display=""),Ji(Be.provider||""),j.nameInput&&(j.nameInput.focus(),j.nameInput.select()))}),Y.dataset.indexActionsBound="true")},Ui=(j,Y,de={})=>{if(!W)return;let ue=g(j),fe=ue&&Be.indexByProvider[ue]||"",Fe=h(ue),$e=!!ue;vo($e),W.dataset.aipkitPickerTitle=Fe.singular;let Ne=document.getElementById(`${W.id}_picker_title`);Ne&&(Ne.textContent=Fe.singular);let We=document.getElementById(`${W.id}_picker_search`);if(We){let Z=Fe.singular?`Search ${Fe.singular.toLowerCase()}...`:o("Search...","gpt3-ai-content-generator");We.setAttribute("placeholder",Z)}if(W.innerHTML="",!$e){let Z=document.createElement("option");Z.value="",Z.textContent=Fe.plural,W.appendChild(Z),W.value="",Bi(!0),li(!1,ue),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),Mn(),wi(ue);return}if(de.loading){let Z=document.createElement("option");Z.value="",Z.textContent=Fe.loading,Z.disabled=!0,W.appendChild(Z),W.value="",Bi(!0,{disableTrigger:!1}),li(!1,ue),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),Mn(),wi(ue);return}let R=Array.isArray(Y)?Y:[];if(!R.length){let Z=document.createElement("option");Z.value="",Z.textContent=de.emptyLabel||Fe.empty,Z.disabled=!0,W.appendChild(Z),W.value="",Bi(!0,{disableTrigger:!1}),li(!0,ue),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),Mn(),wi(ue);return}let D=document.createElement("option");D.value="",D.textContent=r(o("All %s","gpt3-ai-content-generator"),Fe.plural.toLowerCase()),W.appendChild(D),R.forEach(Z=>{let se=y(ue,Z),re=E(ue,Z);if(!se)return;let K=document.createElement("option");K.value=se,K.textContent=re||se,W.appendChild(K)});let N=Be.indexByProvider[ue]||"",X=N?R.some(Z=>y(ue,Z)===N):!1;N&&!X&&(Be.indexByProvider[ue]=""),W.value=X?N:"",Bi(!1),li(!1,ue),typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),ue&&fe!==Be.indexByProvider[ue]&&p({provider:Be.provider,status:Be.status,type:Be.type,indexByProvider:Be.indexByProvider,embeddingByProvider:Be.embeddingByProvider}),Mn(),wi(ue)},Di=()=>Rt||L||(ge?ge.querySelector("#aipkit_sources_provider_panel_status"):null),bt=(j,Y)=>{let de=Di();T(de,j,Y)},ln=()=>{$t&&window.clearTimeout($t),$t=window.setTimeout(()=>{bt("","")},3e3)},Ut=()=>{Qt&&(Qt.classList.remove("aipkit-active"),Qt.setAttribute("aria-hidden","true"),ii&&(ii.value=""))},So=j=>{!Qt||!ii||(ii.value=j||"",ii.scrollTop=0,Qt.classList.add("aipkit-active"),Qt.setAttribute("aria-hidden","false"),ii.focus())},Gn=()=>{Je&&(Je.classList.remove("aipkit-active"),Je.setAttribute("aria-hidden","true"),Je.dataset.provider="",Je.dataset.storeId="",Je.dataset.vectorId="",Je.dataset.logId="",Je.dataset.embeddingProvider="",Je.dataset.embeddingModel="",ui&&(ui.value=""))},Wi=j=>{!Je||!ui||(Je.dataset.provider=j.dataset.provider||"",Je.dataset.storeId=j.dataset.storeId||"",Je.dataset.vectorId=j.dataset.vectorId||"",Je.dataset.logId=j.dataset.logId||"",Je.dataset.embeddingProvider=j.dataset.embeddingProvider||"",Je.dataset.embeddingModel=j.dataset.embeddingModel||"",ui.value=j.dataset.content?decodeURIComponent(j.dataset.content):"",Je.classList.add("aipkit-active"),Je.setAttribute("aria-hidden","false"),setTimeout(()=>ui.focus(),0))},ti=()=>{Ht&&(Ht.classList.remove("aipkit-active"),Ht.setAttribute("aria-hidden","true"),Ht.dataset.provider="",Ht.dataset.storeId="",Ht.dataset.vectorId="",Ht.dataset.logId="")},Eo=j=>{Ht&&(Ht.dataset.provider=j.provider||"",Ht.dataset.storeId=j.storeId||"",Ht.dataset.vectorId=j.vectorId||"",Ht.dataset.logId=j.logId||"",Ht.classList.add("aipkit-active"),Ht.setAttribute("aria-hidden","false"),Ee&&(Ee.disabled=!1))},Gi=j=>{let Y=document.getElementById(j);return Y?Y.value:""},Mi=j=>{let Y=n[g(j)];return Y?Gi(Y):""},Ue=()=>{let j={...v()};return j.pinecone=!!Cn.pinecone_api_key,j.qdrant=!!(Cn.qdrant_api_key&&Cn.qdrant_url),window.aipkit_dashboard||(window.aipkit_dashboard={}),window.aipkit_dashboard.providerStatus=j,j};Ue();let Co=j=>j.startsWith("pinecone_")?"pinecone":j.startsWith("qdrant_")?"qdrant":"",Hi=async()=>{if(!ge)return;let j=ge.querySelectorAll("[data-aipkit-provider-config]");if(!j.length)return;let Y={},de=!1,ue=new Set;if(j.forEach(fe=>{let Fe=fe.dataset.aipkitProviderConfig;if(!Fe)return;let $e=fe.value.trim();if(Y[Fe]=$e,Cn[Fe]!==$e){de=!0;let Ne=Co(Fe);Ne&&ue.add(Ne)}}),!!de){bt(o("Saving...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",Y),Object.keys(Y).forEach(fe=>{Cn[fe]=Y[fe]}),Ue(),Ze(),ue.forEach(fe=>{S(fe)!==!1&&(Mt.activeProvider===fe?Kn(fe,{silent:!0}):Mt.stores[fe]=null)}),bt(o("Saved","gpt3-ai-content-generator"),"success"),ln()}catch(fe){let Fe=fe&&fe.message?fe.message:o("Save failed.","gpt3-ai-content-generator");bt(`${o("Error:","gpt3-ai-content-generator")} ${Fe}`,"error"),ln()}}},Fi=()=>{cn&&window.clearTimeout(cn),cn=window.setTimeout(()=>{Hi()},600)},Si=(j=ge)=>j?{nameInput:j.querySelector("[data-aipkit-provider-name-input]"),dimensionInput:j.querySelector("[data-aipkit-provider-dimension-input]"),deleteButton:j.querySelector("[data-aipkit-provider-delete-selected]")}:{},Ze=()=>{let j=g(U?U.value:ge?.dataset.provider||""),Y=W?W.value:"",de=!!j&&!!Y&&S(j)===!0,{deleteButton:ue}=Si();ue&&(ue.disabled=!de,de?ue.removeAttribute("aria-disabled"):ue.setAttribute("aria-disabled","true")),Un(j)},ai=(j,Y,de={})=>{let ue=g(j),fe=g(U?U.value:"");if(!ue){Ui("",[]),Ze();return}ue===fe&&(Ui(ue,Y,{loading:de.loading===!0,emptyLabel:de.emptyLabel}),Ze())},xn=(j,Y,de,ue)=>{j&&(Y?(j.disabled=!0,j.setAttribute("aria-disabled","true"),j.textContent=ue):(j.disabled=!1,j.removeAttribute("aria-disabled"),j.textContent=de))},Kn=async(j,Y={})=>{let de=m(j);if(!de)return;let ue=g(j),fe=Y.silent===!0;if(S(ue)===!1){bt(o("Add provider credentials to load stores.","gpt3-ai-content-generator"),"error"),ln();return}let $e=Mi(ue);if(!$e){bt(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),ln();return}let Ne=`${ue}-${Date.now()}`;Mt.syncTokens[ue]=Ne,ai(ue,Mt.stores[ue],{loading:!0}),fe||bt(o("Syncing stores...","gpt3-ai-content-generator"),"");let We={_ajax_nonce:$e};ue==="openai"&&(We.limit=100,We.order="desc");let R=Y.triggerButton||(ge&&ge.dataset.provider===ue?ge.querySelector(".aipkit_sources_provider_sync"):null);xn(R,!0,o("Sync","gpt3-ai-content-generator"),o("Syncing...","gpt3-ai-content-generator"));try{let D=await window.aipkit_apiRequest(de.listAction,We);if(Mt.syncTokens[ue]!==Ne)return;let N=Array.isArray(D[de.listKey])?D[de.listKey]:[];Mt.stores[ue]=N,ue==="pinecone"?Zi.pineconeIndexes=N:ue==="qdrant"&&(Zi.qdrantCollections=N),Re&&g(Re.value)===ue&&qn(ue,{preserveValue:!0}),Mt.activeProvider===ue&&ai(ue,N),fe||(bt(D.message||o("Stores synced.","gpt3-ai-content-generator"),"success"),ln())}catch(D){if(Mt.syncTokens[ue]!==Ne)return;let N=D&&D.message?D.message:o("Sync failed.","gpt3-ai-content-generator");bt(`${o("Error:","gpt3-ai-content-generator")} ${N}`,"error"),ln(),ai(ue,Mt.stores[ue])}finally{xn(R,!1,o("Sync","gpt3-ai-content-generator"),o("Syncing...","gpt3-ai-content-generator"))}},io=async(j,Y,de,ue,fe={})=>{let Fe=u(j);if(!Fe)return!1;let $e=g(j),Ne=typeof fe.statusUpdater=="function"?fe.statusUpdater:bt,We=typeof fe.clearStatusSoon=="function"?fe.clearStatusSoon:ln,R=fe.defaultLabel||(ue?ue.textContent.trim():"")||o("Delete","gpt3-ai-content-generator"),D=fe.loadingLabel||o("Deleting...","gpt3-ai-content-generator"),N=!1;if(!Y)return Ne(o("Missing store identifier.","gpt3-ai-content-generator"),"error"),We(),!1;let X=de||Y,Z=r(o('Are you sure you want to delete the %s "%s"? This action cannot be undone.',"gpt3-ai-content-generator"),Fe.label,X);if(fe.skipConfirm!==!0&&!window.confirm(Z))return!1;let se=Mi($e);if(!se)return Ne(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),We(),!1;xn(ue,!0,R,D),Ne(o("Deleting...","gpt3-ai-content-generator"),"");let re={_ajax_nonce:se};re[Fe.param]=Y;try{let K=await window.aipkit_apiRequest(Fe.action,re),J=(Array.isArray(Mt.stores[$e])?Mt.stores[$e]:[]).filter(oe=>y($e,oe)!==Y);Mt.stores[$e]=J,$e==="pinecone"?Zi.pineconeIndexes=J:$e==="qdrant"&&(Zi.qdrantCollections=J),Re&&g(Re.value)===$e&&qn($e,{preserveValue:!0}),Mt.activeProvider===$e&&ai($e,J),Ne(K.message||o("Deleted.","gpt3-ai-content-generator"),"success"),We(),N=!0}catch(K){let $=K&&K.message?K.message:o("Delete failed.","gpt3-ai-content-generator");Ne(`${o("Error:","gpt3-ai-content-generator")} ${$}`,"error"),We()}finally{xn(ue,!1,R,D)}return N},un=async(j,Y,de={})=>{let ue=m(j);if(!ue)return{success:!1,createdId:""};let fe=g(j),Fe=typeof de.statusUpdater=="function"?de.statusUpdater:bt,$e=typeof de.clearStatusSoon=="function"?de.clearStatusSoon:ln,Ne=!1,We="";if(S(fe)===!1)return Fe(o("Add provider credentials to create stores.","gpt3-ai-content-generator"),"error"),$e(),{success:!1,createdId:""};let D=Mi(fe);if(!D)return Fe(o("Provider nonce missing.","gpt3-ai-content-generator"),"error"),$e(),{success:!1,createdId:""};let{nameInput:N,dimensionInput:X}=Si(de.root||ge),Z=N?N.value.trim():"";if(!Z)return Fe(o("Name is required.","gpt3-ai-content-generator"),"error"),$e(),{success:!1,createdId:""};let se=0;if(ue.needsDimension&&(se=X?parseInt(X.value,10):0,!se||Number.isNaN(se)))return Fe(o("Dimension is required.","gpt3-ai-content-generator"),"error"),$e(),{success:!1,createdId:""};xn(Y,!0,o("Create","gpt3-ai-content-generator"),o("Creating...","gpt3-ai-content-generator")),Fe(o("Creating...","gpt3-ai-content-generator"),"");let re={_ajax_nonce:D,name:Z};ue.needsDimension&&(re.dimension=se),fe==="openai"&&(re.source_type="sources_module_create");try{let K=await window.aipkit_apiRequest(ue.createAction,re),$=K[ue.createKey];if($){let J=Array.isArray(Mt.stores[fe])?Mt.stores[fe].slice():[];We=y(fe,$),We&&J.some(oe=>y(fe,oe)===We)||J.unshift($),Mt.stores[fe]=J,fe==="pinecone"?Zi.pineconeIndexes=Mt.stores[fe]:fe==="qdrant"&&(Zi.qdrantCollections=Mt.stores[fe]),Re&&g(Re.value)===fe&&qn(fe,{preserveValue:!0}),Mt.activeProvider===fe&&ai(fe,Mt.stores[fe])}else await Kn(fe);N&&(N.value=""),X&&(X.value=""),Fe(K.message||o("Store created.","gpt3-ai-content-generator"),"success"),$e(),Ne=!0}catch(K){let $=K&&K.message?K.message:o("Create failed.","gpt3-ai-content-generator");Fe(`${o("Error:","gpt3-ai-content-generator")} ${$}`,"error"),$e()}finally{xn(Y,!1,o("Create","gpt3-ai-content-generator"),o("Creating...","gpt3-ai-content-generator"))}return{success:Ne,createdId:We}},Bn=j=>{let Y=g(j);if(Mt.activeProvider=Y,fi(),!Y)Ui("",[]);else{let de=Mt.stores[Y];if(Array.isArray(de))ai(Y,de);else if(S(Y))ai(Y,[],{loading:!0}),Kn(Y,{silent:!0});else{let ue=h(Y);ai(Y,[],{emptyLabel:r(o("Add credentials to load %s.","gpt3-ai-content-generator"),ue.plural.toLowerCase())})}}Ze()},no=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():`text_${Date.now()}`,Fn=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now(),fn=j=>typeof CSS<"u"&&CSS.escape?CSS.escape(String(j)):String(j).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),oo=async(j,Y,de,ue,fe)=>{let Fe=j.toLowerCase();if(Fe==="openai"){let We=Gi("aipkit_vector_store_nonce_openai");if(!We)throw new Error(o("OpenAI nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:We,target_store_id:Y,text_content:de,source_type:"text_entry_global_form"});return}if(!ue||!fe)throw new Error(o("Select an embedding model.","gpt3-ai-content-generator"));let $e=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:de,embedding_provider:ue,embedding_model:fe}),Ne=$e.embeddings&&$e.embeddings.length?$e.embeddings[0]:null;if(!Ne)throw new Error(o("Failed to generate embedding.","gpt3-ai-content-generator"));if(Fe==="pinecone"){let We=Gi("aipkit_vector_store_pinecone_nonce_management");if(!We)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));let R=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:We,vectors:JSON.stringify([{id:R,values:Ne,metadata:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:de,vector_id:R}}]),embedding_provider:ue,embedding_model:fe,original_text_content:de,index_name:Y});return}if(Fe==="qdrant"){let We=Gi("aipkit_vector_store_qdrant_nonce_management");if(!We)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));let R=Fn(),D={_ajax_nonce:We,vectors:JSON.stringify([{id:R,vector:Ne,payload:{source:"text_entry_global_form",created_at:new Date().toISOString(),original_content:de,vector_id:R}}]),embedding_provider:ue,embedding_model:fe,original_text_content:de,collection_name:Y,source_context:"sources_module_edit"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",D);return}throw new Error(o("Unsupported provider for edit.","gpt3-ai-content-generator"))},Wt=window.aipkit_escapeHtml||(j=>j==null?"":String(j)),ao=(j,Y)=>{let de=document.createElement("div");de.className="aipkit_indexing_settings_section";let ue=document.createElement("h5");ue.textContent=o("Basic Labels","gpt3-ai-content-generator"),de.appendChild(ue);let fe=document.createElement("table");fe.className="wp-list-table widefat striped",fe.innerHTML=`
        <thead>
          <tr>
            <th>${Wt(o("Label Type","gpt3-ai-content-generator"))}</th>
            <th>${Wt(o("Custom Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Fe=fe.querySelector("tbody"),$e=["source_url","title","excerpt","content"],Ne=[o("Source URL","gpt3-ai-content-generator"),o("Title","gpt3-ai-content-generator"),o("Excerpt","gpt3-ai-content-generator"),o("Content","gpt3-ai-content-generator")];return $e.forEach((We,R)=>{let D=Y&&Y[We]?Y[We]:Ne[R],N=Ci.originalSettings?.[j]?.basic_labels?.[We]||D,X=document.createElement("tr");X.innerHTML=`
          <td><code>${Wt(Ne[R])}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Wt(j)}][basic_labels][${Wt(We)}]"
              value="${Wt(N)}"
              placeholder="${Wt(D)}"
              ${ut.isPro?"":"disabled"}
            >
          </td>
        `,Fe.appendChild(X)}),de.appendChild(fe),de},$n=(j,Y,de,ue)=>{let fe=document.createElement("div");if(fe.className="aipkit_indexing_settings_section",!ue||Object.keys(ue).length===0)return fe.innerHTML=`<p><em>${Wt(r(o("No %s found for this content type.","gpt3-ai-content-generator"),j.toLowerCase()))}</em></p>`,fe;let Fe=document.createElement("h5");Fe.textContent=j,fe.appendChild(Fe);let $e=document.createElement("table");$e.className="wp-list-table widefat striped",$e.innerHTML=`
        <thead>
          <tr>
            <th class="check-column">
              <input type="checkbox" class="aipkit-indexing-select-all" ${ut.isPro?"":"disabled"} />
            </th>
            <th>${Wt(o("Field / Taxonomy","gpt3-ai-content-generator"))}</th>
            <th>${Wt(o("Label for AI Context","gpt3-ai-content-generator"))}</th>
          </tr>
        </thead>
        <tbody></tbody>`;let Ne=$e.querySelector("tbody");Object.keys(ue).forEach(R=>{let D=ue[R],N=Ci.originalSettings?.[Y]?.[de]?.[R]||{},X=typeof N.enabled=="boolean"?N.enabled:!0,Z=N.label||"",se=document.createElement("tr");se.innerHTML=`
          <th scope="row" class="check-column">
            <input
              type="checkbox"
              name="settings[${Wt(Y)}][${Wt(de)}][${Wt(R)}][enabled]"
              value="1"
              ${X?"checked":""}
              ${ut.isPro?"":"disabled"}
            >
          </th>
          <td><code>${Wt(R)}</code></td>
          <td>
            <input
              type="text"
              class="regular-text"
              name="settings[${Wt(Y)}][${Wt(de)}][${Wt(R)}][label]"
              value="${Wt(Z)}"
              placeholder="${Wt(D)}"
              ${ut.isPro?"":"disabled"}
            >
          </td>
        `,Ne.appendChild(se)});let We=$e.querySelector(".aipkit-indexing-select-all");return We&&We.addEventListener("change",R=>{Ne.querySelectorAll('input[type="checkbox"]').forEach(D=>{D.checked=R.target.checked})}),fe.appendChild($e),fe},jn=(j,Y,de)=>{let ue=document.createElement("div");ue.className="aipkit_accordion";let fe=document.createElement("div");fe.className="aipkit_accordion-header",fe.innerHTML=`<span class="dashicons dashicons-arrow-right-alt2"></span>${Wt(Y)}`;let Fe=document.createElement("div");return Fe.className="aipkit_accordion-content",Fe.appendChild(ao(j,de.basic_labels||{})),Fe.appendChild($n(o("Custom Fields","gpt3-ai-content-generator"),j,"fields",de.fields||{})),Fe.appendChild($n(o("Taxonomies","gpt3-ai-content-generator"),j,"taxonomies",de.taxonomies||{})),j==="product"&&de.woo_attributes&&Fe.appendChild($n(o("Product Data","gpt3-ai-content-generator"),j,"woo_attributes",de.woo_attributes)),ue.appendChild(fe),ue.appendChild(Fe),ue},zn=async()=>{let j=document.getElementById("aipkit_indexing_settings_form_container");if(j){if(j.innerHTML=`<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${Wt(o("Loading content types...","gpt3-ai-content-generator"))}</p>`,!ut.nonce){j.innerHTML=`<p class="aipkit_text-danger">${Wt(o("Error: Security token is missing. Cannot load settings.","gpt3-ai-content-generator"))}</p>`;return}try{let Y=await window.aipkit_apiRequest("aipkit_get_cpt_indexing_options",{_ajax_nonce:ut.nonce}),de={},ue={};if(Y&&typeof Y.success<"u"){if(!Y.success)throw new Error(Y.data||"Failed to load content types.");de=Y.data?.cpt_data||{},ue=Y.data?.saved_settings||{}}else Y&&(de=Y.cpt_data||{},ue=Y.saved_settings||{});if(Ci.originalSettings=ue||{},j.innerHTML="",!Object.keys(de).length){j.innerHTML=`<p class="aipkit_text-center">${Wt(o("No content types found. Please add content and try again.","gpt3-ai-content-generator"))}</p>`;return}let fe=document.createElement("div");fe.className="aipkit_accordion-group",Object.keys(de).forEach($e=>{let Ne=de[$e];fe.appendChild(jn($e,Ne.label||$e,Ne))}),j.appendChild(fe);let Fe=document.getElementById("aipkit_indexing_settings_form");Fe&&!Ci.accordionsBound&&(Fe.addEventListener("click",$e=>{let Ne=$e.target.closest(".aipkit_accordion-header");Ne&&(Ne.classList.toggle("aipkit_active"),Ne.nextElementSibling&&Ne.nextElementSibling.classList.toggle("aipkit_active"))}),Ci.accordionsBound=!0)}catch(Y){j.innerHTML=`<p class="aipkit_text-danger">${Wt(Y&&Y.message?Y.message:o("Failed to load content types.","gpt3-ai-content-generator"))}</p>`}}},Qn=()=>{let j=document.getElementById("aipkit_indexing_settings_form_container");if(!j)return{};let Y={},de=document.getElementById("aipkit_hide_user_uploads_checkbox");Y.hide_user_uploads=de?de.checked:!0;let ue=document.getElementById("aipkit_show_index_button_checkbox");Y.show_index_button=ue?ue.checked:!0;let fe=document.getElementById("aipkit_chunk_avg_chars_per_token"),Fe=document.getElementById("aipkit_chunk_max_tokens_per_chunk"),$e=document.getElementById("aipkit_chunk_overlap_tokens");if(fe&&Fe&&$e){let Ne=parseInt(fe.value,10),We=parseInt(Fe.value,10),R=parseInt($e.value,10);Number.isNaN(Ne)||(Y.chunk_avg_chars_per_token=Ne),Number.isNaN(We)||(Y.chunk_max_tokens_per_chunk=We),Number.isNaN(R)||(Y.chunk_overlap_tokens=R)}return j.querySelectorAll('input[type="checkbox"]').forEach(Ne=>{let We=Ne.name.match(/[^[\]']+/g);if(We&&We.length===5&&We[4]==="enabled"){let[,R,D,N]=We;Y[R]||(Y[R]={}),Y[R][D]||(Y[R][D]={}),Y[R][D][N]||(Y[R][D][N]={}),Y[R][D][N].enabled=Ne.checked}}),j.querySelectorAll('input[type="text"]').forEach(Ne=>{let We=Ne.name.match(/[^[\]']+/g);if(We&&We.length===5&&We[4]==="label"){let[,R,D,N]=We;Y[R]||(Y[R]={}),Y[R][D]||(Y[R][D]={}),Y[R][D][N]||(Y[R][D][N]={}),Y[R][D][N].label=Ne.value.trim()}else if(We&&We.length===4&&We[2]==="basic_labels"){let[,R,,D]=We;Y[R]||(Y[R]={}),Y[R].basic_labels||(Y[R].basic_labels={}),Y[R].basic_labels[D]=Ne.value.trim()}}),Y},Nn=(j,Y)=>{if(!j)return;j.dataset.label||(j.dataset.label=j.textContent.trim());let de=j.dataset.label||o("Save","gpt3-ai-content-generator"),ue=j.querySelector(".aipkit_spinner"),fe=j.querySelector(".aipkit_btn-text"),Fe=Y?o("Saving...","gpt3-ai-content-generator"):de;fe?fe.textContent=Fe:j.textContent=Fe,ue&&(ue.style.display=Y?"inline-block":"none"),j.disabled=Y},ro=(j,Y)=>{if(!Rt)return;T(Rt,Y,{success:"success",error:"error",info:"loading"}[j]||""),(j==="success"||j==="error")&&yo()},mn=async(j={})=>{let{button:Y=null,mode:de="manual"}=j;if(!ut.nonce)return;Y&&Nn(Y,!0),de==="auto"&&ro("info",o("Auto-saving...","gpt3-ai-content-generator"));let ue=Qn();try{let fe=await window.aipkit_apiRequest("aipkit_save_cpt_indexing_options",{_ajax_nonce:ut.nonce,settings:JSON.stringify(ue)});Ci.originalSettings=ue;let Fe=fe.message||o("Settings saved!","gpt3-ai-content-generator");ro("success",de==="auto"?o("Saved","gpt3-ai-content-generator"):Fe)}catch(fe){let Fe=fe&&fe.message?fe.message:o("Failed to save settings.","gpt3-ai-content-generator");ro("error",Fe)}finally{Y&&Nn(Y,!1)}},Ho=j=>{let Y=document.getElementById("aipkit_upgradeBtn");if(Y){Y.click();return}let de=j&&j.dataset?j.dataset.upgradeUrl:"";de&&window.open(de,"_blank","noopener")},An=j=>{j.preventDefault();let Y=j.currentTarget;if(Y&&Y.dataset&&Y.dataset.upgradeOnly==="1"){Ho(Y);return}mn({button:j.currentTarget,mode:"manual"})},xo=async()=>{if(Dt){on=!0;return}Dt=!0,await mn({mode:"auto"}),Dt=!1,on&&(on=!1,xo())},hn=()=>{ut.nonce&&(tn&&window.clearTimeout(tn),tn=window.setTimeout(()=>{xo()},600))},Vo=()=>{if(Ci.autosaveBound)return;[{element:document.getElementById("aipkit_hide_user_uploads_checkbox"),events:["change"]},{element:document.getElementById("aipkit_show_index_button_checkbox"),events:["change"]},{element:document.getElementById("aipkit_chunk_avg_chars_per_token"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_max_tokens_per_chunk"),events:["input","change"]},{element:document.getElementById("aipkit_chunk_overlap_tokens"),events:["input","change"]}].forEach(({element:Y,events:de})=>{Y&&(de.forEach(ue=>{Y.addEventListener(ue,hn)}),Y.addEventListener("blur",hn))}),Ci.autosaveBound=!0},so=()=>{if(Ci.initialized)return!0;let j=document.getElementById("indexing-settings-tab-content");return j?j.dataset.initialized==="true"?(Ci.initialized=!0,!0):(zn(),Ci.saveBound||(St&&St.addEventListener("click",An),Ci.saveBound=!0),Vo(),j.dataset.initialized="true",Ci.initialized=!0,!0):!1},Vi=()=>{ot&&(ot.classList.remove("aipkit-active"),ot.setAttribute("aria-hidden","true"),Ae&&Ae.setAttribute("aria-expanded","false"))},Ao=()=>{Qe&&(Qe.classList.add("aipkit-active"),Qe.setAttribute("aria-hidden","false"),Ce&&Ce.focus())},nn=()=>{Qe&&(Qe.classList.remove("aipkit-active"),Qe.setAttribute("aria-hidden","true"))},qo=()=>Rt||L,yn=(j,Y)=>{let de=qo();T(de,j,Y)},co=()=>{ki&&window.clearTimeout(ki),ki=window.setTimeout(()=>{yn("","")},3e3)},On=j=>{if(!at)return;let Y=h(j);at.textContent=Y.singular},qn=(j,Y={})=>{if(!Ie)return;let de=g(j),fe=Y.preserveValue===!0?Ie.value:"";Ie.innerHTML=`<option value="">${Wt(o("-- Select --","gpt3-ai-content-generator"))}</option>`;let Fe=[];if(de==="pinecone"?Fe=Zi.pineconeIndexes:de==="qdrant"&&(Fe=Zi.qdrantCollections),Array.isArray(Fe)&&Fe.forEach($e=>{let Ne=$e?.name||$e?.id||(typeof $e=="string"?$e:"");if(!Ne)return;let We=document.createElement("option");We.value=Ne,We.textContent=Ne,Ie.appendChild(We)}),fe&&Ie.querySelector(`option[value="${fn(fe)}"]`))Ie.value=fe;else if(fe){let $e=document.createElement("option");$e.value=fe,$e.textContent=`${fe} (${o("Manual","gpt3-ai-content-generator")})`,Ie.appendChild($e),Ie.value=fe}},dn=()=>{if(!Ft||!rt)return;let j=rt.options[rt.selectedIndex];j&&j.dataset.provider&&(Ft.value=j.dataset.provider)},Io=()=>({semantic_search_vector_provider:Re?Re.value:"",semantic_search_target_id:Ie?Ie.value:"",semantic_search_embedding_provider:Ft?Ft.value:"",semantic_search_embedding_model:rt?rt.value:"",semantic_search_num_results:_i?_i.value:"",semantic_search_no_results_text:Lt?Lt.value:""}),Lo=async(j={})=>{let Y=j.mode||"auto";dn();let de=Io();if(de.semantic_search_vector_provider){Y==="auto"&&yn(o("Saving...","gpt3-ai-content-generator"),"loading");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",de),sn.dirty=!1,yn(o(Y==="auto"?"Saved":"Settings saved!","gpt3-ai-content-generator"),"success"),co()}catch(ue){let fe=ue&&ue.message?ue.message:o("Failed to save settings.","gpt3-ai-content-generator");yn(`${o("Error:","gpt3-ai-content-generator")} ${fe}`,"error"),co()}}},Jn=async()=>{if(ni){Vn=!0;return}ni=!0,await Lo({mode:"auto"}),ni=!1,Vn&&(Vn=!1,Jn())},rn=()=>{En&&window.clearTimeout(En),sn.dirty=!0,En=window.setTimeout(()=>{Jn()},600)},lo=()=>{if(sn.autosaveBound)return;let j=(Y,de=["change"])=>{Y&&de.forEach(ue=>Y.addEventListener(ue,rn))};j(Re),j(Ie),j(rt),j(_i,["input","change"]),j(Lt,["input","change"]),sn.autosaveBound=!0},po=()=>sn.initialized||!Re||!Ie||!rt?!1:(On(Re.value),qn(Re.value,{preserveValue:!0}),dn(),lo(),sn.initialized=!0,!0),Yn=()=>{ye&&(po(),ye.classList.add("aipkit-active"),ye.setAttribute("aria-hidden","false"),ve&&ve.focus())},Rn=()=>{ye&&(ye.classList.remove("aipkit-active"),ye.setAttribute("aria-hidden","true"))},Dn=j=>{if(!xt)return;let Y=xt.querySelector(".aipkit_spinner");Y&&(Y.style.display=j?"inline-block":"none"),xt.disabled=j,xt.setAttribute("aria-disabled",j?"true":"false")},Xn=(j,Y="")=>{Ke&&(Ke.className="aipkit_sources_semantic_results aipkit_form-help",Y&&Ke.classList.add(`aipkit_form-help-${Y}`),Ke.textContent=j)},To=async j=>{if(!Ke)return;let Y=Io();if(!Y.semantic_search_vector_provider||!Y.semantic_search_target_id||!Y.semantic_search_embedding_model){Xn(o("Complete semantic search settings before running a demo.","gpt3-ai-content-generator"));return}if(!Zi.nonce){Xn(o("Security token missing. Please reload.","gpt3-ai-content-generator"),"error");return}(sn.dirty||ni)&&await Lo({mode:"auto"}),Dn(!0),Ke.innerHTML='<div class="aipkit-search-loading"><span class="aipkit_spinner"></span></div>';try{let de=await window.aipkit_apiRequest("aipkit_perform_semantic_search",{nonce:Zi.nonce,query:j});Ke.className="aipkit_sources_semantic_results",Ke.innerHTML=de.html||`<p>${Wt(Y.semantic_search_no_results_text||o("No results found.","gpt3-ai-content-generator"))}</p>`}catch(de){let ue=de&&de.message?de.message:o("An error occurred while searching.","gpt3-ai-content-generator");Xn(`${o("Error:","gpt3-ai-content-generator")} ${ue}`,"error")}finally{Dn(!1)}},Ki=async(j=1)=>{Be.page=j,T(L,"",""),B.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${Wt(o("Loading sources...","gpt3-ai-content-generator"))}</td></tr>`,V&&(V.innerHTML="");try{let Y=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:Be.page,per_page:Be.perPage,provider:Be.provider,status:Be.status,type:Be.type,search:Be.search,store_id:Ti()});H(B,Y.logs||[]),O(Y.pagination||{},V,Ki)}catch(Y){let de=Y&&Y.message?Y.message:o("Error loading sources.","gpt3-ai-content-generator");P(B,V,de),T(L,de,"error")}},_o=(()=>{let j=document.getElementById("aipkit_sources_training_toggle"),Y=document.getElementById("aipkit_sources_training_card");if(!j||!Y)return null;let de=Y.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),ue=Y.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),fe=Y.querySelector(".aipkit_training_text_input"),Fe=Y.querySelector("#aipkit_training_qa_question"),$e=Y.querySelector("#aipkit_training_qa_answer"),Ne=Y.querySelector("#aipkit_training_files_input"),We=Y.querySelector(".aipkit_training_files_button"),R=Y.querySelector(".aipkit_builder_dropzone"),D=Y.querySelector("#aipkit_training_file_list"),N=Y.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),X=Y.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),Z=Y.querySelector(".aipkit_training_stop_btn"),se=Y.querySelector(".aipkit_training_action_row"),re=Y.querySelector("#aipkit_training_status")||L,K=document.getElementById("aipkit_sources_embedding_row"),$=document.getElementById("aipkit_sources_embedding_model"),J=Y.querySelector("#aipkit_vs_wp_content_mode"),oe=Y.querySelector("#aipkit_vs_wp_content_status"),he=Y.querySelector("#aipkit_vs_wp_content_status_specific"),Pe=Y.querySelector("#aipkit_vs_wp_content_list_area"),pt=Y.querySelector("#aipkit_vs_wp_content_pagination"),ri=Y.querySelector("#aipkit_vs_wp_content_messages_area"),Yt=Y.querySelector("#aipkit_vs_global_target_select"),ft=Y.querySelectorAll('input[name="aipkit_wp_content_mode"]'),At=Y.querySelector("#aipkit_wp_content_bulk_panel"),Zt=Y.querySelector("#aipkit_wp_content_specific_panel"),hi=Y.querySelector("#aipkit_wp_content_bulk_hint"),xi=Y.querySelector("#aipkit_wp_content_specific_types_panel"),Ct=Y.querySelector("#aipkit_wp_content_status_wrap_bulk"),ei=Y.querySelector("#aipkit_wp_content_status_wrap_specific"),Bt=new Map,pi={page:1,selectedIds:new Set},Ei=null,$i=null,qe=!1,xe=(ce,we)=>{re&&(re.textContent=ce||"",re.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ce&&re.classList.add("is-visible"),we&&re.classList.add(`is-${we}`))},Ve=(ce=2500)=>{Ei&&window.clearTimeout(Ei),Ei=window.setTimeout(()=>{xe("","")},ce)},He=(ce,we="")=>{if(!ri)return;T(ri,ce||"",we==="error"?"error":we==="success"?"success":"")},dt=(ce=2500)=>{$i&&window.clearTimeout($i),$i=window.setTimeout(()=>{He("","")},ce)},it=()=>{let ce=g(U?U.value:""),we=W&&!W.disabled&&W.value||"";return!ce||!we?null:{providerKey:ce,storeId:we}},Ye=()=>{let ce=g(U?U.value:"");if(!ce||ce==="all")return xe(o("Select a provider first.","gpt3-ai-content-generator"),"error"),Ve(),!1;let we=it();if(!we||!we.storeId){let Se=h(ce);return xe(r(o("Select a %s first.","gpt3-ai-content-generator"),Se.singular),"error"),Ve(),!1}return!0},ht=ce=>{if(!Number.isFinite(ce))return"";let we=["B","KB","MB","GB"],Se=ce,Oe=0;for(;Se>=1024&&Oe<we.length-1;)Se/=1024,Oe+=1;let _t=Oe===0?0:1;return`${Se.toFixed(_t)} ${we[Oe]}`},Li=()=>{R&&(R.style.display=Bt.size>0&&qe?"none":"")},ji=(ce=1500)=>{D&&window.setTimeout(()=>{Bt.clear(),D.innerHTML="",Li()},ce)},gn=ce=>{if(!D||!ce)return null;let we=`${ce.name}_${ce.size}_${ce.lastModified}`;if(Bt.has(we))return Bt.get(we);let Se=document.createElement("div");Se.className="aipkit_training_file_row",Se.dataset.fileKey=we;let Oe=document.createElement("div");Oe.className="aipkit_training_file_meta";let _t=document.createElement("span");_t.className="aipkit_training_file_name",_t.textContent=ce.name;let gt=document.createElement("span");gt.className="aipkit_training_file_size",gt.textContent=ht(ce.size);let G=document.createElement("span");return G.className="aipkit_training_file_status",G.textContent=o("Queued","gpt3-ai-content-generator"),Oe.appendChild(_t),Oe.appendChild(gt),Se.appendChild(Oe),Se.appendChild(G),D.appendChild(Se),Bt.set(we,Se),Se},Ai=(ce,we,Se)=>{let Oe=gn(ce);if(!Oe)return;let _t=Oe.querySelector(".aipkit_training_file_status");_t&&(_t.textContent=we||"",_t.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),Se&&_t.classList.add(`is-${Se}`))},pn=async(ce,we,Se)=>{if(!ce||!ce.name||typeof window.aipkit_apiRequest!="function")return!1;let Oe=g(we);if(!Oe)return!1;let _t=String(ce.name||"").trim();if(!_t)return!1;let gt=pe=>String(pe||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),G=gt(_t),Q=_t.replace(/\.[^/.]+$/,""),te=[_t,G,Q&&Q!==_t?Q:""].filter(Boolean),ie=async(pe,me)=>{let be=await window.aipkit_apiRequest("aipkit_get_global_vector_sources",{page:1,per_page:me,provider:Oe,store_id:Se||"",type:"file",search:pe||""});return Array.isArray(be.logs)?be.logs:[]},le=(pe,me)=>{if(!pe.length)return null;let be=me.map(gt).filter(Boolean);return pe.find(Le=>{let yt=gt(Le.message),nt=gt(Le.post_title),Gt=gt(Le.file_id);return be.some(yi=>yt&&yt.includes(yi)||nt&&nt.includes(yi)||Gt&&Gt.includes(yi))})||null};try{for(let be of te){let Le=await ie(be,10),yt=le(Le,[be,G]);if(yt){let nt=String(yt.status||"").toLowerCase();if(nt==="indexed"||nt==="skipped_already_indexed"||nt==="success")return Ai(ce,o("Trained","gpt3-ai-content-generator"),"success"),!0;if(nt==="failed")return Ai(ce,o("Failed","gpt3-ai-content-generator"),"error"),!0;if(nt==="processing"||nt==="queued")return Ai(ce,o("Processing","gpt3-ai-content-generator"),"loading"),!0}}let pe=await ie("",20),me=le(pe,te);if(me){let be=String(me.status||"").toLowerCase();if(be==="indexed"||be==="skipped_already_indexed"||be==="success")return Ai(ce,o("Trained","gpt3-ai-content-generator"),"success"),!0;if(be==="failed")return Ai(ce,o("Failed","gpt3-ai-content-generator"),"error"),!0;if(be==="processing"||be==="queued")return Ai(ce,o("Processing","gpt3-ai-content-generator"),"loading"),!0}}catch{}return!1},vn=(ce,we,Se,Oe=0)=>{if(!ce||!we||!Se)return;if(Oe>=30){pn(Se,"openai",ce).then(G=>{G||Ai(Se,o("Queued","gpt3-ai-content-generator"),"warning")});return}let gt=Gi("aipkit_vector_store_nonce_openai");if(!gt||typeof window.aipkit_apiRequest!="function"){pn(Se,"openai",ce);return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:ce,batch_id:we,_ajax_nonce:gt}).then(G=>{let Q=(G.status||"").toLowerCase();if(Q==="completed"){Ai(Se,o("Trained","gpt3-ai-content-generator"),"success"),Ki(1);return}if(Q==="failed"||Q==="cancelled"){Ai(Se,o("Failed","gpt3-ai-content-generator"),"error");return}Ai(Se,o("Processing","gpt3-ai-content-generator"),"loading"),setTimeout(()=>{vn(ce,we,Se,Oe+1)},2500)}).catch(()=>{setTimeout(()=>{vn(ce,we,Se,Oe+1)},3e3)})},Ln=ce=>ce?Array.isArray(ce)?ce.flatMap(we=>{if(Array.isArray(we))return we;if(we&&typeof we=="object"){if(Array.isArray(we.models))return we.models;if(Array.isArray(we.items))return we.items;if(we.id)return[we]}return[]}):typeof ce=="object"?Object.values(ce).flatMap(we=>Array.isArray(we)?we:[]):[]:[],Mo=ce=>{let we=window.aipkit_dashboard?.embeddingModels||{};return Ln(we[ce]||[])},Bo=(ce,we)=>{if(!we)return null;let Oe=Mo(ce).find(G=>G&&G.id===we),_t=Oe?.dimensions||Oe?.dimension||Oe?.output_dimensionality||Oe?.outputDimensionality||Oe?.output_dimension,gt=_t?Number(_t):NaN;if(Number.isFinite(gt)&&gt>0)return gt;if(Oe&&typeof Oe.name=="string"){let G=Oe.name.match(/\((\d{3,5})\)/);if(G)return Number(G[1])}return ce==="google"?768:1536},uo=ce=>{if(!$)return;let we=g(ce),Se=we&&Be.embeddingByProvider?Be.embeddingByProvider[we]:"";if(!Se)return;let Oe=fn(Se);$.querySelector(`option[value="${Oe}"]`)&&($.value=Se)},fo=()=>{if(!$)return;let ce=$.value||"",we=["openai","google","openrouter","azure"],Se={openai:o("OpenAI","gpt3-ai-content-generator"),google:o("Google","gpt3-ai-content-generator"),openrouter:o("OpenRouter","gpt3-ai-content-generator"),azure:o("Azure","gpt3-ai-content-generator")};$.innerHTML="";let Oe=document.createElement("option");Oe.value="",Oe.textContent=o("Select embedding model","gpt3-ai-content-generator"),$.appendChild(Oe);let _t=!1;if(we.forEach(G=>{let Q=Mo(G);if(!Q.length)return;let te=document.createElement("optgroup");te.label=Se[G]||G,Q.forEach(ie=>{let le=ie.id||"";if(!le)return;let pe=document.createElement("option");pe.value=`${G}::${le}`,pe.textContent=ie.name||le,pe.dataset.provider=G,pe.dataset.model=le,te.appendChild(pe)}),te.children.length&&($.appendChild(te),_t=!0)}),!_t){$.innerHTML="";let G=document.createElement("option");G.value="",G.textContent=o("No embedding models found.","gpt3-ai-content-generator"),$.appendChild(G),$.disabled=!0;return}if($.disabled=!1,ce){let G=fn(ce);if($.querySelector(`option[value="${G}"]`)){$.value=ce;return}}let gt=$.querySelector("optgroup option");gt&&($.value=gt.value)},Ni=()=>{if(!$)return null;let ce=$.options[$.selectedIndex],we=ce&&ce.dataset.provider||"",Se=ce&&ce.dataset.model||"";if(!we||!Se){let Oe=$.value||"";if(Oe&&Oe.includes("::")){let[_t,gt]=Oe.split("::");we=_t||"",Se=gt||""}}return!we||!Se?null:{provider:we,model:Se,dimension:Bo(we,Se)}},Zn=ce=>{!Z||!X||(ce?(Z.hidden=!1,Z.disabled=!1,X.disabled=!0):(Z.hidden=!0,Z.disabled=!1,X.disabled=!1))},Tn=()=>{let ce=it(),we=g(U?U.value:ce?.providerKey||"");if(N.forEach(Se=>{Se.disabled=!1,Se.removeAttribute("aria-disabled")}),K){let Se=we==="pinecone"||we==="qdrant";K.hidden=!Se,Se&&uo(we)}if(Yt){let Se=ce?ce.storeId:"";Yt.innerHTML=Se?`<option value="${Wt(Se)}">${Wt(Se)}</option>`:'<option value=""></option>',Yt.value=Se}},bn=ce=>{if(!de||!ce)return;de.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(Se=>{let Oe=Se.dataset.aipkitTab===ce;Se.classList.toggle("is-active",Oe),Se.setAttribute("aria-selected",Oe?"true":"false")}),ue.forEach(Se=>{let Oe=Se.dataset.aipkitPanel===ce;Se.classList.toggle("is-active",Oe),Se.hidden=!Oe}),X&&(X.style.display=ce==="files"?"none":""),se&&se.classList.toggle("aipkit_builder_action_row--end",ce==="files")},en=()=>{let ce=de?de.querySelector(".aipkit_builder_tab.is-active"):null;return ce?ce.dataset.aipkitTab:""},Pn=()=>J&&J.value||"bulk",Ii=ce=>{let we=ce==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Se=document.getElementById(we);return Se?Array.from(Se.selectedOptions).map(Oe=>Oe.value).filter(Boolean):[]},Fo=ce=>{let we=ce==="specific"?he:oe;return we&&we.value||"publish"},mo=()=>Pe?Array.from(Pe.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(ce=>ce.value):[],$o=(ce,we,Se)=>{if(!we)return;we.innerHTML="";let Oe=Number(ce?.total_posts||0),_t=Number(ce?.total_pages||0),gt=Number(ce?.current_page||1);if(!Oe)return;let G=document.createElement("span");if(G.className="aipkit_pagination-count",G.textContent=`${Oe.toLocaleString()} ${i("item","items",Oe,"gpt3-ai-content-generator")}`,we.appendChild(G),_t<=1)return;let Q=document.createElement("span");Q.className="aipkit_pagination-links";let te=document.createElement("button");te.type="button",te.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",te.textContent=o("Prev","gpt3-ai-content-generator"),te.disabled=gt<=1,te.addEventListener("click",()=>Se(gt-1));let ie=document.createElement("span");ie.className="aipkit_pagination-current",ie.textContent=`${gt}/${_t}`;let le=document.createElement("button");le.type="button",le.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",le.textContent=o("Next","gpt3-ai-content-generator"),le.disabled=gt>=_t,le.addEventListener("click",()=>Se(gt+1)),Q.appendChild(te),Q.appendChild(ie),Q.appendChild(le),we.appendChild(Q)},No=(ce,we)=>{if(!Pe)return;if(Pe.innerHTML="",!Array.isArray(ce)||!ce.length){Pe.innerHTML=`<p class="aipkit_builder_help_text">${Wt(o("No posts found for selection.","gpt3-ai-content-generator"))}</p>`,pt&&(pt.innerHTML="");return}let Se=document.createElement("ul"),Oe=document.createElement("div");Oe.className="aipkit_wp_content_select_all_wrapper";let _t=document.createElement("label");_t.className="aipkit_training_site_option";let gt=document.createElement("input");gt.type="checkbox",gt.checked=ce.every(G=>pi.selectedIds.has(String(G.id))),_t.appendChild(gt),_t.appendChild(document.createTextNode(o("Select all","gpt3-ai-content-generator"))),Oe.appendChild(_t),Pe.appendChild(Oe),Pe.appendChild(Se),ce.forEach(G=>{let Q=document.createElement("li");Q.className="aipkit_wp_content_list_item";let te=document.createElement("input");te.type="checkbox",te.name="wp_content_to_index[]",te.value=String(G.id),te.checked=pi.selectedIds.has(String(G.id)),te.addEventListener("change",()=>{te.checked?pi.selectedIds.add(String(G.id)):pi.selectedIds.delete(String(G.id)),gt.checked=ce.every(me=>pi.selectedIds.has(String(me.id)))});let ie=document.createElement("a");ie.className="aipkit_wp_content_title",ie.href=G.edit_link||"#",ie.target="_blank",ie.rel="noopener noreferrer",ie.textContent=G.title||o("Untitled","gpt3-ai-content-generator");let le=document.createElement("span");le.className="aipkit_wp_content_type",le.textContent=G.type_label||"";let pe=document.createElement("span");pe.className="aipkit_wp_content_indexed_status",pe.textContent=G.is_already_indexed?o("Indexed","gpt3-ai-content-generator"):"",Q.appendChild(te),Q.appendChild(ie),Q.appendChild(le),Q.appendChild(pe),Se.appendChild(Q)}),gt.addEventListener("change",()=>{gt.checked?ce.forEach(G=>pi.selectedIds.add(String(G.id))):ce.forEach(G=>pi.selectedIds.delete(String(G.id))),Pe.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(G=>{G.checked=gt.checked})}),$o(we,pt,Wn)},Wn=async ce=>{if(!Pe)return;let we=it(),Se=Pn(),Oe=Ii(Se);if(!Oe.length){Pe.innerHTML="",pt&&(pt.innerHTML=""),He(o("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let _t=Gi("aipkit_wp_content_fetch_nonce");if(!_t){He(o("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let gt=Fo(Se);try{He(o("Loading content...","gpt3-ai-content-generator"),"");let G=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:_t,post_types:Oe,post_status:gt,target_store_id:we?we.storeId:"",paged:ce});pi.page=ce,No(G.posts||[],G.pagination||{}),He("","")}catch(G){He(G&&G.message?G.message:o("Failed to load content.","gpt3-ai-content-generator"),"error")}},Oo=ce=>{J&&(J.value=ce),At&&(At.hidden=ce!=="bulk"),xi&&(xi.hidden=ce!=="specific"),Zt&&(Zt.hidden=ce!=="specific"),Ct&&(Ct.hidden=ce!=="bulk"),ei&&(ei.hidden=ce!=="specific"),hi&&(hi.hidden=ce!=="bulk"),ce==="specific"&&Wn(1)},Go=()=>{Y.querySelectorAll(".aipkit_training_site_dropdown").forEach(we=>{let Se=we.querySelector(".aipkit_training_site_dropdown_btn"),Oe=we.querySelector(".aipkit_training_site_dropdown_label"),_t=we.querySelector(".aipkit_training_site_dropdown_panel"),G=we.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",Q=document.getElementById(G);if(!Se||!_t||!Q)return;let te=()=>{let le=_t.querySelectorAll('input[type="checkbox"]:checked'),pe=we.dataset.placeholder||o("Select types","gpt3-ai-content-generator"),me=we.dataset.selectedLabel||o("selected","gpt3-ai-content-generator");Oe&&(le.length?Oe.textContent=`${le.length} ${me}`:Oe.textContent=pe)},ie=()=>{let le=Array.from(_t.querySelectorAll('input[type="checkbox"]:checked')).map(pe=>pe.value);Array.from(Q.options).forEach(pe=>{pe.selected=le.includes(pe.value)})};Se.addEventListener("click",()=>{let le=Se.getAttribute("aria-expanded")==="true";Se.setAttribute("aria-expanded",le?"false":"true"),_t.hidden=le}),_t.addEventListener("change",()=>{ie(),te(),Pn()==="specific"&&Wn(1)}),document.addEventListener("click",le=>{we.contains(le.target)||(Se.setAttribute("aria-expanded","false"),_t.hidden=!0)}),ie(),te()})},eo=async(ce,we,Se)=>{let Oe=Gi("aipkit_wp_content_fetch_nonce");if(!Oe)throw new Error("WP content fetch nonce missing.");let _t=[],gt=1,G=1;do{let Q=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Oe,post_types:ce,post_status:we,target_store_id:Se||"",paged:gt});(Array.isArray(Q?.posts)?Q.posts:[]).forEach(le=>{_t.push({id:String(le.id),title:le.title||r(o("Post %s","gpt3-ai-content-generator"),le.id)})});let ie=parseInt(Q?.pagination?.total_pages||1,10);G=Number.isNaN(ie)?1:ie,gt+=1}while(gt<=G);return _t},Ro=()=>Pe?Array.from(Pe.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(ce=>{let we=ce.closest(".aipkit_wp_content_list_item"),Se=we?we.querySelector(".aipkit_wp_content_title"):null;return{id:String(ce.value||""),title:Se&&Se.textContent.trim()||r(o("Post %s","gpt3-ai-content-generator"),ce.value)}}):[],go=(ce,we,Se,Oe)=>{let _t=r(o("Post %s","gpt3-ai-content-generator"),ce),gt=Oe&&Oe.get(String(ce))||_t;return r(o("Training: %s (%d/%d)","gpt3-ai-content-generator"),gt,we+1,Se)},ko=async(ce,we)=>{if(!window.aipkit_dashboard?.ajaxurl)throw new Error(o("AJAX configuration is missing.","gpt3-ai-content-generator"));ce.set("action",we);let Se=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:ce,credentials:"same-origin"}),Oe=await Se.json();if(!Se.ok||!Oe.success){let _t=Oe?.data?.message||o("Upload failed.","gpt3-ai-content-generator");throw new Error(_t)}return Oe.data},wo=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`text_${Date.now()}`,Ko=()=>{let ce=Ni();return ce||(xe(o("Select an embedding model.","gpt3-ai-content-generator"),"warning"),Ve(),null)},ho=async(ce,we)=>{if(!window.aipkit_dashboard?.nonce)throw new Error(o("Embedding nonce missing.","gpt3-ai-content-generator"));let Se=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:ce,embedding_provider:we.provider,embedding_model:we.model,_ajax_nonce:window.aipkit_dashboard.nonce}),Oe=Se.embeddings&&Se.embeddings.length?Se.embeddings[0]:null;if(!Oe)throw new Error(o("Failed to generate embedding.","gpt3-ai-content-generator"));return Oe},to=async({content:ce,indexName:we,embedding:Se,metadata:Oe})=>{let _t=Gi("aipkit_vector_store_pinecone_nonce_management");if(!_t)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));let gt=await ho(ce,Se);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:_t,vectors:JSON.stringify([{id:Oe.vector_id,values:gt,metadata:Oe}]),embedding_provider:Se.provider,embedding_model:Se.model,original_text_content:ce,index_name:we})},Do=async({content:ce,collectionName:we,embedding:Se,metadata:Oe,sourceContext:_t})=>{let gt=Gi("aipkit_vector_store_qdrant_nonce_management");if(!gt)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));let G=await ho(ce,Se),Q={_ajax_nonce:gt,vectors:JSON.stringify([{id:Oe.vector_id,vector:G,payload:Oe}]),embedding_provider:Se.provider,embedding_model:Se.model,original_text_content:ce,collection_name:we,source_context:_t||"sources_module"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",Q)},Wo=async()=>{if(qe)return;let ce=it();if(!ce){xe(o("Select a provider and index first.","gpt3-ai-content-generator"),"warning"),Ve();return}let we=en(),Se="",Oe=[],_t=null,gt="text_entry_global_form",G="file_upload_global_form";if(we==="text"){if(Se=fe?fe.value.trim():"",!Se){xe(o("Add text to train.","gpt3-ai-content-generator"),"warning"),Ve();return}}else if(we==="qa"){let te=Fe?Fe.value.trim():"",ie=$e?$e.value.trim():"";if(!te||!ie){xe(o("Add a question and answer to train.","gpt3-ai-content-generator"),"warning"),Ve();return}Se=`Q: ${te}
A: ${ie}`}else if(we==="files"){if(Oe=Ne?Array.from(Ne.files||[]):[],!Oe.length){Ne&&Ne.click(),xe(o("Choose files to upload.","gpt3-ai-content-generator"),"warning"),Ve();return}}else if(we==="website"){let te=Pn(),ie=Fo(te),le=Ii(te),pe=mo();if(te==="specific"&&!pe.length){xe(o("Select content to train.","gpt3-ai-content-generator"),"warning"),Ve();return}if(te==="bulk"&&!le.length){xe(o("Select at least one post type.","gpt3-ai-content-generator"),"warning"),Ve();return}_t={mode:te,statusValue:ie,postTypes:le,selectedPostIds:pe}}else{xe(o("Select a training tab to continue.","gpt3-ai-content-generator"),"warning"),Ve();return}let Q=null;if(!((ce.providerKey==="pinecone"||ce.providerKey==="qdrant")&&(Q=Ko(),!Q))){qe=!0,Zn(!0),N.forEach(te=>{te.disabled=!0}),xe(o("Preparing training...","gpt3-ai-content-generator"),"loading");try{if(we==="files"){Li();for(let te=0;te<Oe.length;te+=1){let ie=Oe[te];xe(r(o("Uploading %1$d of %2$d...","gpt3-ai-content-generator"),te+1,Oe.length),"loading"),Ai(ie,o("Uploading","gpt3-ai-content-generator"),"loading");try{let le=new FormData;if(ce.providerKey==="openai"){let pe=Gi("aipkit_vector_store_nonce_openai");if(!pe)throw new Error(o("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));le.append("aipkit_vs_global_file_to_submit",ie),le.append("target_store_id",ce.storeId),le.append("source_type",G),le.append("_ajax_nonce",pe);let me=await ko(le,"aipkit_upload_and_add_file_to_store_direct_openai");Ai(ie,o("Processing","gpt3-ai-content-generator"),"loading");let be=me?.batch?.id;pn(ie,ce.providerKey,ce.storeId).then(Le=>{if(!Le){if(be){vn(ce.storeId,be,ie);return}Ai(ie,o("Queued","gpt3-ai-content-generator"),"warning")}})}else if(ce.providerKey==="pinecone"){let pe=Gi("aipkit_vector_store_pinecone_nonce_management");if(!pe)throw new Error(o("Pinecone nonce missing.","gpt3-ai-content-generator"));le.append("file_to_upload",ie),le.append("index_name",ce.storeId),le.append("embedding_provider",Q.provider),le.append("embedding_model",Q.model),le.append("_ajax_nonce",pe),await ko(le,"aipkit_upload_file_and_upsert_to_pinecone"),Ai(ie,o("Trained","gpt3-ai-content-generator"),"success")}else if(ce.providerKey==="qdrant"){let pe=Gi("aipkit_vector_store_qdrant_nonce_management");if(!pe)throw new Error(o("Qdrant nonce missing.","gpt3-ai-content-generator"));le.append("file_to_upload",ie),le.append("target_store_id",ce.storeId),le.append("embedding_provider",Q.provider),le.append("embedding_model",Q.model),le.append("source_context","sources_module_file_upload"),le.append("_ajax_nonce",pe),await ko(le,"aipkit_upload_file_and_upsert_to_qdrant"),Ai(ie,o("Trained","gpt3-ai-content-generator"),"success")}}catch(le){throw Ai(ie,o("Failed","gpt3-ai-content-generator"),"error"),le}}Ne&&(Ne.value=""),Li(),xe(o("Saved","gpt3-ai-content-generator"),"success"),He(o("Saved","gpt3-ai-content-generator"),"success"),dt(),Ve(),ji(),Ki(1);return}if(we==="website"&&_t){let{mode:te,statusValue:ie,postTypes:le}=_t,pe=[],me=new Map;if(te==="bulk"){xe(o("Preparing website content...","gpt3-ai-content-generator"),"loading");let be=await eo(le,ie,ce.storeId);if(pe=be.map(Le=>Le.id),me=new Map(be.map(Le=>[String(Le.id),Le.title])),!pe.length){He(o("No posts found for selection.","gpt3-ai-content-generator"),"error"),xe(o("Nothing to train.","gpt3-ai-content-generator"),"warning"),Ve();return}}if(te!=="bulk"){let be=Ro();pe=be.map(Le=>Le.id),me=new Map(be.map(Le=>[String(Le.id),Le.title]))}if(xe(o("Training...","gpt3-ai-content-generator"),"loading"),He(r(o("Training %d item(s)...","gpt3-ai-content-generator"),pe.length),""),ce.providerKey==="openai"){let be=Gi("aipkit_wp_content_index_nonce");if(!be)throw new Error(o("WP content index nonce missing.","gpt3-ai-content-generator"));for(let Le=0;Le<pe.length;Le+=1){let yt=pe[Le];He(go(yt,Le,pe.length,me),""),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{_ajax_nonce:be,post_ids:[yt],target_store_id:ce.storeId,provider:"openai"})}}else if(ce.providerKey==="pinecone")for(let be=0;be<pe.length;be+=1){let Le=pe[be];He(go(Le,be,pe.length,me),"");let yt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Gi("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[Le]}),nt=yt.posts_content&&yt.posts_content[Le]?yt.posts_content[Le]:null;if(!nt||!nt.content)continue;let Gt=Fn(),yi={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Le,title:nt.title||"",url:nt.edit_link||"",vector_id:Gt};yi.vector_id=Gt,await to({content:nt.content,indexName:ce.storeId,embedding:Q,metadata:yi})}else if(ce.providerKey==="qdrant")for(let be=0;be<pe.length;be+=1){let Le=pe[be];He(go(Le,be,pe.length,me),"");let yt=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Gi("aipkit_wp_content_fetch_nonce"),get_content_for_ids:[Le]}),nt=yt.posts_content&&yt.posts_content[Le]?yt.posts_content[Le]:null;if(!nt||!nt.content)continue;let Gt=wo(),yi={source:"wordpress_post",created_at:new Date().toISOString(),post_id:Le,title:nt.title||"",url:nt.edit_link||"",vector_id:Gt};await Do({content:nt.content,collectionName:ce.storeId,embedding:Q,metadata:yi,sourceContext:"sources_module_website"})}xe(o("Saved","gpt3-ai-content-generator"),"success"),Ve(),Ki(1);return}if(ce.providerKey==="openai"){let te=Gi("aipkit_vector_store_nonce_openai");if(!te)throw new Error(o("OpenAI vector store nonce missing.","gpt3-ai-content-generator"));await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:te,target_store_id:ce.storeId,text_content:Se,source_type:gt})}else if(ce.providerKey==="pinecone"){let te=Fn(),ie={source:gt,created_at:new Date().toISOString(),original_content:Se,vector_id:te};await to({content:Se,indexName:ce.storeId,embedding:Q,metadata:ie})}else if(ce.providerKey==="qdrant"){let te=Fn(),ie={source:gt,created_at:new Date().toISOString(),original_content:Se,vector_id:te};await Do({content:Se,collectionName:ce.storeId,embedding:Q,metadata:ie,sourceContext:"sources_module_training"})}we==="text"&&fe&&(fe.value=""),we==="qa"&&(Fe&&(Fe.value=""),$e&&($e.value="")),xe(o("Saved","gpt3-ai-content-generator"),"success"),Ve(),Ki(1)}catch(te){xe(r(o("Error: %s","gpt3-ai-content-generator"),te?.message||o("Training failed.","gpt3-ai-content-generator")),"error")}finally{qe=!1,Zn(!1),Tn(),Li()}}};if(j.addEventListener("click",()=>{let ce=Y.hidden;Y.hidden=!ce,j.setAttribute("aria-expanded",ce?"true":"false"),ce&&(Tn(),fo(),uo(U?U.value:""))}),de){let ce=de.querySelector(".aipkit_builder_tab.is-active");ce&&bn(ce.dataset.aipkitTab),de.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]").forEach(we=>{we.addEventListener("click",()=>{bn(we.dataset.aipkitTab)})})}return We&&Ne&&We.addEventListener("click",()=>{Ye()&&Ne.click()}),Ne&&Ne.addEventListener("change",()=>{if(!Ye()){Ne.value="";return}let ce=Array.from(Ne.files||[]);ce.length&&(ce.forEach(we=>{gn(we),Ai(we,o("Queued","gpt3-ai-content-generator"))}),Li(),Wo())}),N.forEach(ce=>{ce.addEventListener("click",Wo)}),Z&&Z.addEventListener("click",()=>{qe&&(Z.disabled=!0,xe(o("Stopping...","gpt3-ai-content-generator"),"warning"))}),$&&$.addEventListener("change",()=>{let ce=g(U?U.value:"");ce&&(Be.embeddingByProvider[ce]=$.value||"",p({provider:Be.provider,status:Be.status,type:Be.type,indexByProvider:Be.indexByProvider,embeddingByProvider:Be.embeddingByProvider}))}),ft.length&&ft.forEach(ce=>{ce.addEventListener("change",()=>{ce.checked&&Oo(ce.value)})}),oe&&oe.addEventListener("change",()=>{Pn()==="specific"&&Wn(1)}),he&&he.addEventListener("change",()=>{Pn()==="specific"&&Wn(1)}),Go(),Tn(),fo(),uo(U?U.value:""),Oo(Pn()),{updateTargetState:Tn}})();U&&U.addEventListener("change",()=>{Be.provider=U.value,Bn(Be.provider),_o?.updateTargetState?.(),p({provider:Be.provider,status:Be.status,type:Be.type,indexByProvider:Be.indexByProvider,embeddingByProvider:Be.embeddingByProvider}),Ki(1)}),wt&&wt.addEventListener("click",()=>{g(U?U.value:"")&&(Be.openIndexCreateOnOpen=!0,bo(wt))}),ee&&ee.addEventListener("change",()=>{Be.status=ee.value,p({provider:Be.provider,status:Be.status,type:Be.type,indexByProvider:Be.indexByProvider,embeddingByProvider:Be.embeddingByProvider}),Ki(1)}),ne&&ne.addEventListener("change",()=>{Be.type=ne.value,p({provider:Be.provider,status:Be.status,type:Be.type,indexByProvider:Be.indexByProvider,embeddingByProvider:Be.embeddingByProvider}),Ki(1)});let In=()=>{if(!z)return;let j=z.value.trim();j!==Be.search&&(Be.search=j,Ki(1))},Po=()=>{z&&(oi&&window.clearTimeout(oi),oi=window.setTimeout(()=>{In()},300))};if(z&&(z.addEventListener("input",Po),z.addEventListener("search",In),z.addEventListener("keydown",j=>{j.key==="Enter"&&(j.preventDefault(),oi&&window.clearTimeout(oi),In())})),W&&W.addEventListener("change",()=>{let j=g(U?U.value:"");j&&(Be.indexByProvider[j]=W.value||"",p({provider:Be.provider,status:Be.status,type:Be.type,indexByProvider:Be.indexByProvider,embeddingByProvider:Be.embeddingByProvider}),Ze(),_o?.updateTargetState?.(),Ki(1))}),ge&&ge.dataset.configListenersAttached!=="true"){let j=Y=>{Y.target.closest("[data-aipkit-provider-config]")&&Fi()};ge.addEventListener("input",j),ge.addEventListener("change",j),ge.dataset.configListenersAttached="true"}bi&&bi.addEventListener("click",Gn),Xt&&Xt.addEventListener("click",Gn),Je&&!Je.dataset.bound&&(document.addEventListener("keydown",j=>{j.key==="Escape"&&Je.classList.contains("aipkit-active")&&Gn()}),Je.dataset.bound="1"),Ri&&Ri.addEventListener("click",Ut),Qi&&Qi.addEventListener("click",Ut),_e&&_e.addEventListener("click",ti),Me&&Me.addEventListener("click",ti),Ee&&Ee.addEventListener("click",async()=>{if(!Ht)return;let j=Ht.dataset.provider||"",Y=Ht.dataset.storeId||"",de=Ht.dataset.vectorId||"",ue=Ht.dataset.logId||"";if(!j||!Y||!de||!ue){T(L,o("Missing source details.","gpt3-ai-content-generator"),"error"),ct(),ti();return}ti();let fe=null,Fe=[];if(B){let $e=fn(ue);if(fe=B.querySelector(`tr[data-log-id="${$e}"]`),fe){Fe=Array.from(fe.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")),Fe.forEach(We=>{We.disabled=!0,We.setAttribute("aria-disabled","true")});let Ne=fe.querySelector(".aipkit_sources_action_delete");Ne&&(Ne.textContent=o("Deleting...","gpt3-ai-content-generator"))}}Ee&&(Ee.disabled=!0),T(L,o("Deleting...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:j,store_id:Y,vector_id:de,log_id:ue}),T(L,o("Deleted","gpt3-ai-content-generator"),"success"),ct(),Ki(Be.page||1)}catch($e){let Ne=$e&&$e.message?$e.message:o("Failed to delete source.","gpt3-ai-content-generator");T(L,`${o("Error:","gpt3-ai-content-generator")} ${Ne}`,"error"),ct(),Fe.forEach(R=>{R.disabled=!1,R.removeAttribute("aria-disabled")});let We=fe?fe.querySelector(".aipkit_sources_action_delete"):null;We&&(We.textContent=o("Delete","gpt3-ai-content-generator"))}finally{Ee&&(Ee.disabled=!1)}}),Tt&&Tt.addEventListener("click",async()=>{if(!Je||!ui)return;let j=ui.value.trim();if(!j){T(L,o("Text cannot be empty.","gpt3-ai-content-generator"),"error"),ct();return}let Y=Je.dataset.provider||"",de=Je.dataset.storeId||"",ue=Je.dataset.vectorId||"",fe=Je.dataset.logId||"",Fe=Je.dataset.embeddingProvider||"",$e=Je.dataset.embeddingModel||"";if(!Y||!de||!ue||!fe){T(L,o("Missing source details.","gpt3-ai-content-generator"),"error"),ct();return}Gn();let Ne=[];if(B&&fe){let We=fn(fe),R=B.querySelector(`tr[data-log-id="${We}"]`);Ne=R?Array.from(R.querySelectorAll(".aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[],Ne.forEach(D=>{D.disabled=!0,D.setAttribute("aria-disabled","true"),D.classList.contains("aipkit_sources_action_edit")&&(D.textContent=o("Training...","gpt3-ai-content-generator"))})}T(L,o("Training...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:Y,store_id:de,vector_id:ue,log_id:fe}),await oo(Y,de,j,Fe,$e),T(L,o("Trained","gpt3-ai-content-generator"),"success"),ct(),Ki(Be.page||1)}catch(We){let R=We&&We.message?We.message:o("Failed to save source.","gpt3-ai-content-generator");T(L,`${o("Error:","gpt3-ai-content-generator")} ${R}`,"error"),ct(),Ne.forEach(D=>{D.disabled=!1,D.removeAttribute("aria-disabled"),D.classList.contains("aipkit_sources_action_edit")&&(D.textContent=o("Edit","gpt3-ai-content-generator"))})}}),M.addEventListener("click",async j=>{let Y=j.target.closest(".aipkit_sources_provider_create");if(Y){let Ne=Y.dataset.provider||"";Ne&&un(Ne,Y);return}let de=j.target.closest(".aipkit_sources_provider_delete_selected");if(de){let Ne=g(U?U.value:de.dataset.provider||""),We=W?W.value:"";if(!Ne||!We){let N=h(Ne);bt(r(o("Select a %s to delete.","gpt3-ai-content-generator"),N.singular.toLowerCase()),"error"),ln();return}let R=W&&W.selectedOptions?W.selectedOptions[0]:null,D=R?R.textContent:We;io(Ne,We,D,de);return}let ue=j.target.closest(".aipkit_sources_action_edit");if(ue){Wi(ue);return}let fe=j.target.closest(".aipkit_sources_action_view");if(fe){let Ne=fe.dataset.snippet||"";if(!Ne){T(L,o("No preview available for this source.","gpt3-ai-content-generator"),"error"),ct();return}So(Ne);return}let Fe=j.target.closest(".aipkit_sources_action_delete");if(Fe){let Ne=Fe.dataset.provider||"",We=Fe.dataset.storeId||"",R=Fe.dataset.vectorId||"",D=Fe.dataset.logId||"";if(!Ne||!We||!R||!D){T(L,o("Missing source details.","gpt3-ai-content-generator"),"error"),ct();return}Eo({provider:Ne,storeId:We,vectorId:R,logId:D});return}let $e=j.target.closest(".aipkit_sources_action_retrain");if($e){let Ne=$e.dataset.provider||"",We=$e.dataset.storeId||"",R=$e.dataset.vectorId||"",D=$e.dataset.logId||"",N=$e.dataset.postId||"",X=$e.dataset.embeddingProvider||"",Z=$e.dataset.embeddingModel||"";if(!Ne||!We||!R||!D||!N){T(L,o("Missing source details.","gpt3-ai-content-generator"),"error"),ct();return}let se=$e.closest("tr"),re=se?Array.from(se.querySelectorAll(".aipkit_sources_action_retrain, .aipkit_sources_action_edit, .aipkit_sources_action_view, .aipkit_sources_action_delete")):[];re.forEach(K=>{K.disabled=!0,K.setAttribute("aria-disabled","true")}),$e.textContent=o("Training...","gpt3-ai-content-generator"),T(L,o("Retraining...","gpt3-ai-content-generator"),"");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:Ne,store_id:We,vector_id:R,log_id:D,post_id:N,embedding_provider:X,embedding_model:Z}),T(L,o("Retrained","gpt3-ai-content-generator"),"success"),ct(),Ki(Be.page||1)}catch(K){let $=K&&K.message?K.message:o("Failed to retrain source.","gpt3-ai-content-generator");T(L,`${o("Error:","gpt3-ai-content-generator")} ${$}`,"error"),ct(),re.forEach(J=>{J.disabled=!1,J.removeAttribute("aria-disabled")}),$e.textContent=o("Retrain","gpt3-ai-content-generator")}}}),Ae&&Ae.addEventListener("click",()=>{so()}),Ge&&Ge.addEventListener("click",j=>{j.preventDefault(),so(),Vi(),Ao()}),ke&&ke.addEventListener("click",j=>{j.preventDefault(),Vi(),Yn()}),Ce&&Ce.addEventListener("click",j=>{j.preventDefault(),nn()}),Qe&&Qe.addEventListener("click",j=>{j.target===Qe&&nn()}),ve&&ve.addEventListener("click",j=>{j.preventDefault(),Rn()}),ye&&ye.addEventListener("click",j=>{j.target===ye&&Rn()}),document.addEventListener("keydown",j=>{j.key==="Escape"&&Qe&&Qe.classList.contains("aipkit-active")&&nn(),j.key==="Escape"&&ye&&ye.classList.contains("aipkit-active")&&Rn()}),Re&&Re.addEventListener("change",()=>{let j=Re.value;On(j),qn(j),Ie&&(Ie.value=""),rn()}),Ie&&Ie.addEventListener("change",rn),rt&&rt.addEventListener("change",()=>{dn(),rn()}),_i&&(_i.addEventListener("input",rn),_i.addEventListener("change",rn)),Lt&&(Lt.addEventListener("input",rn),Lt.addEventListener("change",rn)),Et&&Et.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode("[aipkit_semantic_search]",Et)}),tt&&tt.addEventListener("submit",j=>{if(j.preventDefault(),!De)return;let Y=De.value.trim();Y&&To(Y)}),Rt&&vi&&(vi.innerHTML=""),Bn(U?U.value:""),typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(M),typeof window.aipkitSources_initSettingsPopoverPanels=="function"&&window.aipkitSources_initSettingsPopoverPanels(M),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_sources_module_container"),Ki(1)}window.aipkit_initSources=F})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_stats_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),t=r.querySelector(".aipkit_model_settings_popover_back"),c=o.querySelector("#aipkit_stats_settings_trigger"),s={root:r.dataset.titleRoot||"Log Settings","log-retention":r.dataset.titleLogRetention||"Log retention"},n=null,d=a=>{let l=a||"root",p=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let _=p.dataset.aipkitSettingsPanel||"root";_!==n&&(i.forEach(f=>{f.hidden=f!==p}),e&&(e.textContent=s[_]||s.root),t&&(t.hidden=_==="root"),n=_,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",a=>{let l=a.target.closest("[data-aipkit-panel-target]");if(!l)return;a.preventDefault();let p=l.dataset.aipkitPanelTarget;d(p)}),t&&t.addEventListener("click",a=>{a.preventDefault(),d("root")}),c&&c.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitStats_initSettingsPopoverPanels=k})();(function(){"use strict";let r="aipkit_stats_overview_open",i=d=>typeof window.aipkit_escapeHtml=="function"?window.aipkit_escapeHtml(d):(d==null?"":String(d)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),e=d=>{let a=Number(d||0);return Number.isNaN(a)?"0":a.toLocaleString()},t=d=>{let a=Number(d);if(!a)return"";let l=new Date(a*1e3);return Number.isNaN(l.getTime())?"":l.toLocaleString()},c=d=>{let a=Number(d);if(!a)return"";let l=Date.now()/1e3,p=Math.floor(l-a);if(Number.isNaN(p)||p<0)return t(a);if(p<60)return"Just now";let _=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}],f=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(let g of _)if(p>=g.seconds){let m=Math.floor(p/g.seconds);return f?f.format(-m,g.unit):`${m} ${g.unit}${m!==1?"s":""} ago`}return t(a)},s=d=>{if(typeof d=="string")return d;if(d==null)return"";try{return JSON.stringify(d,null,2)}catch{return String(d)}};function n(){let d=document.getElementById("aipkit_stats_container");if(!d)return;typeof window.aipkit_initContentWriterPopovers=="function"&&window.aipkit_initContentWriterPopovers(d),typeof window.aipkitStats_initSettingsPopoverPanels=="function"&&window.aipkitStats_initSettingsPopoverPanels(d);let a={days:parseInt(d.dataset.defaultDays||30,10)||30,perPage:20,page:1,search:"",botId:"",module:"",selectedLogId:null},l=wp.i18n&&wp.i18n.__?wp.i18n.__:ae=>ae,p={page:1,search:"",botTitles:{}},_=null,f=null,g=null,m=!1,u={status:d.querySelector("#aipkit_stats_status"),overviewPanel:d.querySelector("#aipkit_stats_overview_panel"),overviewToggle:d.querySelector("#aipkit_stats_overview_toggle"),overviewPeriod:d.querySelector("#aipkit_stats_period_label"),totalConversations:d.querySelector("#aipkit_stats_total_conversations"),totalMessages:d.querySelector("#aipkit_stats_total_messages"),uniqueUsers:d.querySelector("#aipkit_stats_unique_users"),avgTokens:d.querySelector("#aipkit_stats_avg_tokens"),daysFilter:d.querySelector("#aipkit_stats_days_filter"),botFilter:d.querySelector("#aipkit_stats_bot_filter"),moduleFilter:d.querySelector("#aipkit_stats_module_filter"),searchInput:d.querySelector("#aipkit_stats_search_input"),exportBtn:d.querySelector("#aipkit_stats_export_btn"),deleteAllBtn:d.querySelector("#aipkit_stats_delete_all_btn"),tableMenu:d.querySelector("#aipkit_stats_table_menu"),tableMenuTrigger:d.querySelector("#aipkit_stats_table_menu_trigger"),tableBody:d.querySelector("#aipkit_stats_table_body"),pagination:d.querySelector("#aipkit_stats_pagination"),detailPanel:d.querySelector("#aipkit_stats_detail_panel"),conversationChart:d.querySelector("#aipkit_stats_conversation_chart"),moduleChart:d.querySelector("#aipkit_stats_module_chart"),settingsToggle:document.getElementById("aipkit_stats_auto_delete_toggle"),retentionSelect:document.getElementById("aipkit_stats_retention_days"),retentionRow:d.querySelector("[data-aipkit-stats-retention-row]"),cronRow:d.querySelector("[data-aipkit-stats-cron-row]"),cronStatus:document.getElementById("aipkit_stats_cron_status"),cronText:document.getElementById("aipkit_stats_cron_text"),cronLastRun:document.getElementById("aipkit_stats_cron_last_run"),settingsPopover:document.getElementById("aipkit_stats_settings_popover"),settingsTrigger:document.getElementById("aipkit_stats_settings_trigger"),settingsUsersNav:d.querySelector('[data-aipkit-settings-action="users"]'),userSheet:document.getElementById("aipkit_stats_user_sheet"),userSheetClose:document.getElementById("aipkit_stats_user_sheet_close"),userSearchInput:document.getElementById("aipkit_stats_user_search"),userTableBody:document.getElementById("aipkit_stats_user_table_body"),userTableFoot:document.querySelector("#aipkit_stats_user_sheet tfoot"),userPagination:document.getElementById("aipkit_stats_user_pagination"),userNoResults:document.getElementById("aipkit_stats_user_no_results"),shortcodeSnippet:document.getElementById("aipkit_stats_shortcode_snippet"),shortcodeToggle:document.getElementById("aipkit_stats_shortcode_toggle"),shortcodeConfig:document.getElementById("aipkit_stats_shortcode_config"),shortcodeOptions:d.querySelectorAll(".aipkit_stats_shortcode_option")},h=(()=>{try{let ae=d.dataset.moduleLabels||"{}";return JSON.parse(ae)}catch{return{}}})(),v=d.dataset.isPro==="1",S=d.dataset.userCreditsNonce||"",q=(ae,ke="")=>{if(!u.status)return;let ye=u.status,ve=ye.classList.contains("aipkit_training_status");if(ye.textContent=ae||"",ye.classList.remove("aipkit_status_error","aipkit_status_success","aipkit_status_warning","aipkit_status_loading"),ve){ye.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),ae&&ye.classList.add("is-visible"),ke&&ye.classList.add(`is-${ke}`);return}ye.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),ke==="success"?ye.classList.add("aipkit_form-help-success"):ke==="error"&&ye.classList.add("aipkit_form-help-error")},y=()=>{try{return localStorage.getItem(r)==="1"}catch{return!1}},E=ae=>{u.retentionRow&&(u.retentionRow.hidden=!ae),u.cronRow&&(u.cronRow.hidden=!ae),u.retentionSelect&&(u.retentionSelect.disabled=!ae||!v)},I=ae=>{!ae||!u.cronStatus||(ae.state&&u.cronStatus.setAttribute("data-state",ae.state),u.cronText&&ae.status_text&&(u.cronText.textContent=ae.status_text),u.cronLastRun&&ae.last_run_label&&(u.cronLastRun.textContent=ae.last_run_label))},w=ae=>{u.tableBody&&(u.tableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${i(ae)}</td>
                </tr>
            `)},A=ae=>{u.userTableBody&&(u.userTableBody.innerHTML=`
                <tr>
                    <td colspan="6" class="aipkit_stats_table_placeholder">${i(ae)}</td>
                </tr>
            `,u.userNoResults&&(u.userNoResults.hidden=!0))},C=ae=>{if(!ae)return l("N/A","gpt3-ai-content-generator");let ke=new Date(ae*1e3);return Number.isNaN(ke.getTime())?l("N/A","gpt3-ai-content-generator"):ke.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},b=(ae,ke)=>{let ye=Array.isArray(ae)?ae:[],ve='<ul class="aipkit_stats_usage_list">';return ye.length?(ye.forEach((Re,Ie)=>{let at=Ie>=2;ve+=`<li class="${at?"aipkit_stats_usage_extra":""}"${at?" hidden":""}>${Re}</li>`}),ve+="</ul>",{html:ve,hasToggle:ye.length>2}):(ve+=`<li>${i(ke)}</li>`,ve+="</ul>",{html:ve,hasToggle:!1})},x=(ae,ke)=>{if(!u.userTableBody)return;if(u.userTableBody.innerHTML="",!Array.isArray(ae)||ae.length===0){u.userNoResults&&(u.userNoResults.hidden=!1);return}u.userNoResults&&(u.userNoResults.hidden=!0);let ye=ke||{};ae.forEach(ve=>{let Re=document.createElement("tr");Re.dataset.userId=ve.id;let Ie=document.createElement("td");Ie.textContent=`${ve.display_name} (${ve.email})`,Re.appendChild(Ie);let at=document.createElement("td"),rt=document.createElement("input");rt.type="number",rt.className="aipkit_form-input aipkit_stats_credits_balance_input",rt.value=ve.token_balance||0,rt.dataset.userId=ve.id,rt.dataset.originalValue=ve.token_balance||0,rt.setAttribute("min","0"),rt.setAttribute("step","1"),rt.title=l("Press Enter or blur to save changes","gpt3-ai-content-generator"),at.appendChild(rt);let Ft=document.createElement("span");Ft.className="aipkit_stats_credits_balance_status",at.appendChild(Ft),Re.appendChild(at);let _i=document.createElement("td");_i.textContent=e(ve.total_used_all_bots||0),Re.appendChild(_i);let Lt=document.createElement("td"),Et=[],tt=ve.tokens_used||{},De=ve.image_usage||{used:0};De.used>0&&Et.push(`<strong>${i(l("Image Generator","gpt3-ai-content-generator"))}:</strong> ${e(De.used)}`),Object.keys(tt||{}).sort((Tt,Qt)=>Number(Tt)-Number(Qt)).forEach(Tt=>{let Qt=tt[Tt]||0;if(Qt<=0)return;let ii=ye[Tt]||`Bot #${Tt}`;Et.push(`<strong>${i(ii)}:</strong> ${e(Qt)}`)});let Ke=b(Et,"-");Lt.innerHTML=Ke.html+(Ke.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${i(l("Show more","gpt3-ai-content-generator"))}...</button>`:""),Re.appendChild(Lt);let xt=document.createElement("td"),zt=[],wt=ve.last_reset||{};De.used>0&&zt.push(`<strong>${i(l("Image Generator","gpt3-ai-content-generator"))}:</strong> ${i(C(De.last_reset))}`);let Je=new Set([...Object.keys(tt||{}),...Object.keys(wt||{})]);Array.from(Je).sort((Tt,Qt)=>Number(Tt)-Number(Qt)).forEach(Tt=>{if((tt||{})[Tt]<=0)return;let Qt=ye[Tt]||`Bot #${Tt}`;zt.push(`<strong>${i(Qt)}:</strong> ${i(C(wt[Tt]||0))}`)});let ui=Et.length>0?l("N/A","gpt3-ai-content-generator"):"-",bi=b(zt,ui);xt.innerHTML=bi.html+(bi.hasToggle?`<button type="button" class="aipkit_btn-as-link aipkit_stats_usage_toggle">${i(l("Show more","gpt3-ai-content-generator"))}...</button>`:""),Re.appendChild(xt);let Xt=document.createElement("td");if(Xt.className="aipkit_stats_user_actions_cell",ve.purchase_history&&ve.purchase_history.length){let Tt=document.createElement("button");Tt.type="button",Tt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_stats_purchase_history_btn",Tt.title=l("View purchase history","gpt3-ai-content-generator"),Tt.innerHTML='<span class="dashicons dashicons-cart" aria-hidden="true"></span>',Tt.dataset.userName=ve.display_name,Tt.dataset.history=JSON.stringify(ve.purchase_history),Xt.appendChild(Tt)}else Xt.textContent="-";Re.appendChild(Xt),u.userTableBody.appendChild(Re)})},T=ae=>{if(!u.userPagination||!u.userTableFoot)return;u.userPagination.innerHTML="";let ke=Number(ae?.total_users||0),ye=Number(ae?.total_pages||0),ve=Number(ae?.current_page||1);if(!ke){u.userTableFoot.hidden=!0;return}let Re=document.createElement("span");if(Re.className="aipkit_pagination-count",Re.textContent=`${ke.toLocaleString()} ${l("users","gpt3-ai-content-generator")}`,u.userPagination.appendChild(Re),ye<=1){u.userTableFoot.hidden=!0;return}let Ie=document.createElement("span");Ie.className="aipkit_pagination-links";let at=document.createElement("button");at.type="button",at.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",at.textContent=`\xAB ${l("Previous","gpt3-ai-content-generator")}`,at.disabled=ve<=1,at.addEventListener("click",()=>P(ve-1,p.search));let rt=document.createElement("span");rt.className="aipkit_pagination-current",rt.textContent=`${l("Page","gpt3-ai-content-generator")} ${ve} ${l("of","gpt3-ai-content-generator")} ${ye}`;let Ft=document.createElement("button");Ft.type="button",Ft.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Ft.textContent=`${l("Next","gpt3-ai-content-generator")} \xBB`,Ft.disabled=ve>=ye,Ft.addEventListener("click",()=>P(ve+1,p.search)),Ie.appendChild(at),Ie.appendChild(rt),Ie.appendChild(Ft),u.userPagination.appendChild(Ie),u.userTableFoot.hidden=!1},P=async(ae=1,ke="")=>{if(!(!u.userTableBody||typeof window.aipkit_apiRequest!="function")){A(l("Loading user credits...","gpt3-ai-content-generator")),p.page=ae,p.search=ke;try{let ye=await window.aipkit_apiRequest("aipkit_get_user_credits_data",{page:ae,search:ke});p.botTitles=ye.bot_titles||{},x(ye.users_data||[],p.botTitles),T(ye.pagination||{})}catch(ye){u.userTableBody&&(u.userTableBody.innerHTML=`
                        <tr>
                            <td colspan="6" class="aipkit_stats_table_placeholder aipkit_text-danger">${i(ye.message||l("Error loading user credits.","gpt3-ai-content-generator"))}</td>
                        </tr>
                    `),u.userNoResults&&(u.userNoResults.hidden=!0),u.userTableFoot&&(u.userTableFoot.hidden=!0)}}},H=()=>{u.settingsPopover&&(u.settingsPopover.classList.remove("aipkit-active"),u.settingsPopover.setAttribute("aria-hidden","true"),u.settingsTrigger&&u.settingsTrigger.setAttribute("aria-expanded","false"))},O=()=>{u.userSheet&&(u.userSheet.classList.add("aipkit-active"),u.userSheet.setAttribute("aria-hidden","false"),P(p.page,p.search),u.userSearchInput&&u.userSearchInput.focus())},F=()=>{u.userSheet&&(u.userSheet.classList.remove("aipkit-active"),u.userSheet.setAttribute("aria-hidden","true"))},M=()=>{if(!u.shortcodeSnippet||!u.shortcodeOptions)return;let ae=!0,ke=!0,ye=!0;u.shortcodeOptions.forEach(Ie=>{Ie.name==="cfg_show_chatbot"&&(ae=Ie.checked),Ie.name==="cfg_show_aiforms"&&(ke=Ie.checked),Ie.name==="cfg_show_imagegenerator"&&(ye=Ie.checked)});let ve=[];ae||ve.push('chatbot="false"'),ke||ve.push('aiforms="false"'),ye||ve.push('imagegenerator="false"');let Re="[aipkit_token_usage";ve.length&&(Re+=` ${ve.join(" ")}`),Re+="]",u.shortcodeSnippet.textContent=Re},B=(ae,ke)=>{let ye=Array.isArray(ae)?ae:[],ve=document.createElement("div");ve.className="aipkit-modal-overlay aipkit-active";let Re=()=>ye.length?ye.map(at=>{let rt=at?.date?.date?new Date(at.date.date):null,Ft=rt&&!Number.isNaN(rt.getTime())?rt.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"",_i=(at.products||[]).map(Lt=>`
                                <div class="aipkit_stats_purchase_product">
                                    <span class="aipkit_stats_purchase_product_name">${i(Lt.name)}</span>
                                    <span class="aipkit_stats_purchase_product_meta">
                                        ${Lt.quantity>1?`${Number(Lt.quantity)}x `:""}
                                        ${e(Lt.tokens_per_item)} ${i(l("tokens","gpt3-ai-content-generator"))}
                                    </span>
                                </div>
                            `).join("");return`
                            <div class="aipkit_stats_purchase_item">
                                <div class="aipkit_stats_purchase_header">
                                    <div class="aipkit_stats_purchase_date">${i(Ft)}</div>
                                    <div class="aipkit_stats_purchase_summary">
                                        <span class="aipkit_stats_purchase_tokens">+${e(at.tokens_granted)}</span>
                                        <span class="aipkit_stats_purchase_amount">${i(at.total_amount)} ${i(at.currency)}</span>
                                    </div>
                                </div>
                                <div class="aipkit_stats_purchase_order">${i(l("Order #","gpt3-ai-content-generator"))}${i(at.order_id)}</div>
                                ${_i?`<div class="aipkit_stats_purchase_products">${_i}</div>`:""}
                            </div>
                        `}).join(""):`<p>${i(l("No purchase history found for this user.","gpt3-ai-content-generator"))}</p>`;ve.innerHTML=`
                <div class="aipkit-modal-content aipkit_stats_purchase_modal">
                    <div class="aipkit-modal-header">
                        <h3 class="aipkit-modal-title">${i(l("Purchase History for","gpt3-ai-content-generator"))} ${i(ke||"")}</h3>
                        <button class="aipkit-modal-close-btn" type="button" aria-label="${i(l("Close","gpt3-ai-content-generator"))}">&times;</button>
                    </div>
                    <div class="aipkit-modal-body">
                        <div class="aipkit_stats_purchase_history_list">${Re()}</div>
                    </div>
                </div>
            `;let Ie=()=>{ve.classList.remove("aipkit-active"),window.setTimeout(()=>{ve.parentNode&&ve.parentNode.removeChild(ve)},200)};ve.addEventListener("click",at=>{at.target===ve&&Ie()}),ve.querySelector(".aipkit-modal-close-btn")?.addEventListener("click",Ie),document.body.appendChild(ve)},V=ae=>{if(!ae)return;let ke=ae.dataset.userId,ye=ae.parentElement?ae.parentElement.querySelector(".aipkit_stats_credits_balance_status"):null,ve=ae.dataset.originalValue||ae.defaultValue,Re=ae.value;if(String(Re)!==String(ve)){if(!S){ye&&(ye.textContent="ERR");return}ye&&(ye.innerHTML='<span class="aipkit_spinner"></span>'),clearTimeout(g),g=setTimeout(()=>{window.aipkit_apiRequest("aipkit_admin_update_token_balance",{_ajax_nonce:S,user_id:ke,balance:Re}).then(Ie=>{ye&&(ye.textContent="OK"),ae.dataset.originalValue=Ie.new_balance,window.setTimeout(()=>{ye&&(ye.textContent="")},1500)}).catch(()=>{ye&&(ye.textContent="ERR"),ae.value=ve,window.setTimeout(()=>{ye&&(ye.textContent="")},2500)})},400)}},L=ae=>{if(!u.conversationChart)return;u.conversationChart.innerHTML="";let ke=Object.entries(ae||{});if(!ke.length){u.conversationChart.innerHTML=`<div class="aipkit_stats_table_placeholder">${i("No data available.")}</div>`;return}let ye=Math.max(...ke.map(([,Et])=>Number(Et)||0),1),ve=document.createElement("div");ve.className="aipkit_stats_chart_wrapper";let Re=document.createElement("div");Re.className="aipkit_stats_y_axis";let Ie=4;for(let Et=Ie;Et>=0;Et--){let tt=document.createElement("span");tt.className="aipkit_stats_y_label";let De=Math.round(ye/Ie*Et);tt.textContent=De>=1e3?`${(De/1e3).toFixed(1)}k`:De,Re.appendChild(tt)}ve.appendChild(Re);let at=document.createElement("div");at.className="aipkit_stats_bars_container";for(let Et=0;Et<Ie;Et++){let tt=document.createElement("div");tt.className="aipkit_stats_grid_line",tt.style.bottom=`${(Et+1)/Ie*100}%`,at.appendChild(tt)}let rt=document.createElement("div");rt.className="aipkit_stats_bars_wrapper",ke.forEach(([Et,tt])=>{let De=document.createElement("div");De.className="aipkit_stats_bar_group";let Ke=document.createElement("div"),xt=Math.max(2,Math.round(Number(tt)/ye*100));Ke.className="aipkit_stats_bar",Ke.style.height=`${xt}%`,Ke.title=`${Et}: ${tt}`,De.appendChild(Ke),rt.appendChild(De)}),at.appendChild(rt),ve.appendChild(at);let Ft=document.createElement("div");Ft.className="aipkit_stats_x_axis";let _i=Math.min(ke.length,7),Lt=Math.max(1,Math.floor(ke.length/_i));ke.forEach(([Et],tt)=>{let De=document.createElement("span");if(De.className="aipkit_stats_x_label",tt%Lt===0||tt===ke.length-1){let Ke=Et.split("-");De.textContent=Ke.length>=3?`${Ke[1]}/${Ke[2]}`:Et}Ft.appendChild(De)}),ve.appendChild(Ft),u.conversationChart.appendChild(ve)},U=ae=>{if(u.moduleChart){if(typeof window.aipkit_renderTokenUsageChart!="function"){u.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${i("Chart renderer unavailable.")}</p>`;return}if(!ae||Object.keys(ae).length===0){u.moduleChart.innerHTML=`<p class="aipkit_stats_table_placeholder">${i("No data available.")}</p>`;return}window.aipkit_renderTokenUsageChart(u.moduleChart,ae)}},W=ae=>ae?h[ae]?h[ae]:ae.replace(/[_-]/g," ").replace(/\b\w/g,ke=>ke.toUpperCase()):h.chatbot||"Chatbot",ee=ae=>{if(!u.tableBody)return;if(!Array.isArray(ae)||!ae.length){w("No logs found.");return}let ke=ae.map(ye=>{let ve=ye.last_message_content?String(ye.last_message_content):"",Re=c(ye.last_message_ts),Ie=t(ye.last_message_ts),at=e(ye.total_conversation_tokens||0),rt=Number(ye.id);return`
                    <tr class="aipkit_stats_row${a.selectedLogId===rt?" aipkit_stats_row_active":""}" data-log-id="${i(ye.id)}">
                        <td title="${i(Ie)}">${i(Re)}</td>
                        <td>${i(ye.user_display_name||"\u2014")}</td>
                        <td>${i(ye.bot_name||W(ye.module))}</td>
                        <td>${i(e(ye.message_count||0))}</td>
                        <td>${i(at)}</td>
                        <td><span class="aipkit_stats_preview">${i(ve)}</span></td>
                    </tr>
                `});u.tableBody.innerHTML=ke.join("")},ne=()=>({days:a.days,bot_id:a.botId,module:a.module,search:a.search}),z=(ae,ke)=>{let ye=new Blob([ae],{type:"text/csv;charset=utf-8;"}),ve=URL.createObjectURL(ye),Re=document.createElement("a");Re.href=ve,Re.download=ke||"aipkit-logs.csv",document.body.appendChild(Re),Re.click(),Re.remove(),URL.revokeObjectURL(ve)},ge=async ae=>{if(!(!ae||!window.confirm("Delete this conversation?"))){q("Deleting conversation...");try{let ye=await window.aipkit_apiRequest("aipkit_stats_delete_log",{log_id:ae});q(ye.message||"Conversation deleted."),a.selectedLogId===Number(ae)&&(a.selectedLogId=null,Ge(null)),Ce(),window.setTimeout(()=>q(""),2e3)}catch(ye){q(ye.message||"Failed to delete conversation.","error")}}},Ae=async()=>{if(window.confirm("Delete all logs that match the current filters?")){q("Deleting logs...");try{let ke=await window.aipkit_apiRequest("aipkit_stats_delete_logs",ne());q(ke.message||"Logs deleted."),a.selectedLogId=null,Ge(null),Ce(),window.setTimeout(()=>q(""),2500)}catch(ke){q(ke.message||"Failed to delete logs.","error")}}},ot=async()=>{q("Preparing export...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_export_logs",ne());if(!ae||!ae.csv)throw new Error("Export failed.");z(ae.csv,ae.filename),q(ae.message||"Export ready."),window.setTimeout(()=>q(""),2e3)}catch(ae){q(ae.message||"Failed to export logs.","error")}},ze=ae=>{if(!u.tableMenu||!u.tableMenuTrigger)return;let ke=ae??u.tableMenu.hidden;u.tableMenu.hidden=!ke,u.tableMenuTrigger.setAttribute("aria-expanded",ke?"true":"false")},Xe=ae=>{if(u.pagination){if(typeof window.aipkit_renderLogsPagination=="function"){window.aipkit_renderLogsPagination(ae,u.pagination,ke=>{a.page=ke,Ce()});return}u.pagination.innerHTML=""}},Ge=ae=>{if(!u.detailPanel)return;if(!ae){u.detailPanel.innerHTML=`
                    <div class="aipkit_stats_detail_empty">
                        <div>
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.4; margin-bottom: 12px;">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <div>${i("Select a conversation to view details.")}</div>
                        </div>
                    </div>
                `;return}let ke=De=>{let Ke=(De||"").toLowerCase();return Ke==="assistant"||Ke==="model"||Ke==="bot"?"bot":Ke==="user"?"user":Ke||"unknown"},ye=(De,Ke)=>{for(let xt=Ke+1;xt<De.length;xt+=1)if(ke(De[xt]?.role)==="bot")return De[xt];return null},ve=De=>De>=85?"is-excellent":De>=70?"is-good":De>=50?"is-fair":"is-poor",Re=`
                <div class="aipkit_stats_detail_header">
                    <div class="aipkit_stats_detail_title">${i(ae.user_display_name||"User")}</div>
                    <div class="aipkit_stats_detail_meta">
                        ${i(ae.bot_name||W(ae.module))}
                        &middot; ${i(t(ae.last_message_ts))}
                        &middot; ${i(e(ae.message_count||0))} ${i("messages")}
                        ${ae.ip_address?`&middot; ${i(`IP ${ae.ip_address}`)}`:""}
                    </div>
                </div>
            `,Ie=Array.isArray(ae.messages)?ae.messages:[],at=String(ae.module||"").toLowerCase().replace(/[\s-]+/g,"_"),rt=(()=>{if(typeof window.markdownit!="function")return null;let De=window.markdownit({html:!1,linkify:!0,typographer:!0});return window.hljs&&typeof window.markdownitHighlight=="function"&&De.use(window.markdownitHighlight,{hljs:window.hljs}),De})(),Ft=De=>{let Ke=String(De||"").trim().toLowerCase();return Ke?Ke.startsWith("generate ")||Ke.startsWith("content writer request"):!1},_i=De=>{if(!De||typeof De!="object")return null;let Ke=De.payload_sent;if(!Ke||typeof Ke!="object")return null;let xt=Array.isArray(Ke.messages)?Ke.messages:Array.isArray(Ke.input)?Ke.input:null;if(!Array.isArray(xt))return null;let zt=xt.find(wt=>wt&&wt.role==="user"&&typeof wt.content=="string"&&wt.content.trim());return zt?zt.content.trim():null},Lt=(De,Ke)=>{if(!De||typeof De!="object")return null;let xt={"generate excerpt":"custom_excerpt_prompt","generate tags":"custom_tags_prompt","generate meta description":"custom_meta_prompt","generate focus keyword":"custom_keyword_prompt","generate image prompt":"image_prompt","generate featured image":"featured_image_prompt","generate title":"custom_title_prompt"},zt=String(Ke||"").trim().toLowerCase(),wt=xt[zt];if(!wt||typeof De[wt]!="string")return null;let Je=De[wt].trim();return Je||null},Et=De=>{if(!De||typeof De!="object")return null;for(let Ke in De){if(!Object.prototype.hasOwnProperty.call(De,Ke)||!/_prompt$/i.test(Ke))continue;let xt=De[Ke];if(typeof xt=="string"&&xt.trim())return xt.trim()}return null};if(at==="content_writer"&&Array.isArray(Ie)&&Ie.length)for(let De=0;De<Ie.length;De+=1){let Ke=Ie[De];if(!Ke||Ke.role!=="user"||typeof Ke.content!="string")continue;let xt=Ke.content.trim();if(!xt||!Ft(xt))continue;let zt=null,wt=Ie[De+1]?.request_payload;wt&&(zt=_i(wt)),!zt&&Ke.request_payload&&(zt=_i(Ke.request_payload)),!zt&&Ke.request_payload&&(zt=Lt(Ke.request_payload,xt)),!zt&&Ke.request_payload&&(zt=Et(Ke.request_payload)),zt&&(Ke.original_content=Ke.content,Ke.content=zt)}let tt=Ie.map((De,Ke)=>{let xt=ke(De.role),zt=t(De.timestamp),wt=s(De.content),Je=xt==="user"?"User":xt==="bot"?"Assistant":xt,bi=String(De.message_id||`msg_${Ke}`).replace(/[^a-zA-Z0-9_-]/g,"")||`msg_${Ke}`,Xt=[],Tt="",Qt="",ii="";if(xt==="user"){let lt=ye(Ie,Ke),st=lt?.provider||"",jt=lt?.model||"",Jt=lt?.usage?.total_tokens??lt?.usage?.totalTokenCount??null;st&&Xt.push(st),jt&&Xt.push(jt),typeof Jt=="number"&&Jt>0&&Xt.push(`${e(Jt)} tokens`);let $t=lt?.request_payload||null;if(Xt.length||$t)if($t){let vt=`aipkit_stats_payload_${bi}`,Pt=Xt.length?Xt.join(" / "):"Request payload";Tt=`
                                <button type="button" class="aipkit_stats_meta_toggle" data-aipkit-stats-toggle="${vt}" aria-expanded="false">
                                    <span>${i(Pt)}</span>
                                    <span class="aipkit_stats_meta_chevron" aria-hidden="true"></span>
                                </button>
                            `,ii+=`
                                <div class="aipkit_stats_expandable" id="${vt}" hidden>
                                    <div class="aipkit_stats_expandable_header">${i("Request Payload")}</div>
                                    <div class="aipkit_stats_expandable_body">
                                        <pre class="aipkit_stats_payload">${i(JSON.stringify($t,null,2))}</pre>
                                    </div>
                                </div>
                            `}else Xt.length&&(Tt=`<div class="aipkit_stats_meta_info">${i(Xt.join(" / "))}</div>`)}if(xt==="bot"){let lt=Array.isArray(De.vector_search_scores)?De.vector_search_scores:[];if(lt.length>0){let st=lt.reduce((Pt,ki)=>{let oi=Number(Pt?.score??0);return Number(ki?.score??0)>oi?ki:Pt},lt[0]),jt=st?.score!==void 0?Math.round(Number(st.score)*100):0,Jt=ve(jt),$t=`aipkit_stats_scores_${bi}`;Qt=`
                            <button type="button" class="aipkit_stats_score_badge ${Jt}" data-aipkit-stats-toggle="${$t}" aria-expanded="false">
                                ${i(`Score ${jt}%`)}
                            </button>
                        `;let vt=lt.map(Pt=>{let ki=Pt?.provider||"Unknown",oi="";if(ki==="OpenAI")oi=Pt.store_name||Pt.store_id?` \xB7 ${Pt.store_name||Pt.store_id}`:"";else if(ki==="Pinecone"){let Ci=Pt.namespace?` \xB7 ${Pt.namespace}`:"";oi=Pt.index_name?` \xB7 ${Pt.index_name}${Ci}`:Ci}else ki==="Qdrant"&&(oi=Pt.collection_name?` \xB7 ${Pt.collection_name}`:"");let Be=Pt?.score!==void 0?Math.round(Number(Pt.score)*100):null,Mt=Be!==null?ve(Be):"is-poor",ut=Pt?.content_preview||"";return`
                                <div class="aipkit_stats_score_item">
                                    <div class="aipkit_stats_score_title">${i(ki)}${i(oi)}</div>
                                    <div class="aipkit_stats_score_value ${Mt}">
                                        ${i(Be!==null?`${Be}%`:"\u2014")}
                                    </div>
                                    <div class="aipkit_stats_score_preview">${i(ut)}</div>
                                </div>
                            `}).join("");ii+=`
                            <div class="aipkit_stats_expandable" id="${$t}" hidden>
                                <div class="aipkit_stats_expandable_header">${i("Vector Search Results")}</div>
                                <div class="aipkit_stats_expandable_body aipkit_stats_scores_list">
                                    ${vt}
                                </div>
                            </div>
                        `}}let Ri=!!Tt,Qi=!!Qt,_e=Ri||Qi?`
                    <div class="aipkit_stats_meta_bar${Ri&&!Qi||!Ri&&Qi?" aipkit_stats_meta_bar--compact":""}">
                        ${Ri?Tt:""}
                        <div class="aipkit_stats_meta_actions">
                            ${Qt||""}
                        </div>
                    </div>
                `:"",Me=!!(rt&&typeof wt=="string"),Ee=Me?rt.render(wt):i(wt);return`
                    <div class="aipkit_stats_message aipkit_stats_message--${i(xt)}" style="animation-delay: ${Ke*.05}s">
                        <div class="aipkit_stats_message_meta">${i(Je)}${zt?` \xB7 ${i(zt)}`:""}</div>
                        <div class="aipkit_stats_message_body${Me?" aipkit_stats_message_body--markdown":""}">${Ee}</div>
                        ${_e}
                        ${ii}
                    </div>
                `}).join("");u.detailPanel.innerHTML=`
                ${Re}
                <div class="aipkit_stats_detail_messages">
                    ${tt||`<div class="aipkit_stats_table_placeholder">${i("No messages found.")}</div>`}
                    <div class="aipkit_stats_detail_footer">
                        <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_stats_detail_delete" data-log-id="${i(ae.id)}">
                            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                            ${i("Delete")}
                        </button>
                    </div>
                </div>
            `},It=async()=>{q("Loading stats...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_overview",{days:a.days});u.totalConversations.textContent=e(ae.summary?.total_conversations||0),u.totalMessages.textContent=e(ae.summary?.total_messages||0),u.uniqueUsers.textContent=e(ae.summary?.unique_users||0),u.avgTokens.textContent=e(ae.summary?.avg_tokens||0),u.overviewPeriod&&(u.overviewPeriod.textContent=ae.summary?.period_label||""),L(ae.charts?.daily_conversations||{}),U(ae.charts?.daily_tokens||{}),q("")}catch(ae){q(ae.message||"Failed to load stats.","error")}},Qe=(ae,ke=!0)=>{if(u.overviewPanel){if(u.overviewPanel.hidden=!ae,u.overviewToggle&&(u.overviewToggle.setAttribute("aria-expanded",ae?"true":"false"),u.overviewToggle.classList.toggle("is-active",ae)),ke)try{localStorage.setItem(r,ae?"1":"0")}catch{}ae&&It()}},Ce=async()=>{w("Loading logs...");try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_logs",{days:a.days,page:a.page,per_page:a.perPage,bot_id:a.botId,module:a.module,search:a.search}),ke=Array.isArray(ae.logs)?ae.logs:[];!a.selectedLogId&&!m&&ke.length&&(a.selectedLogId=Number(ke[0].id),m=!0),ee(ke),Xe(ae.pagination||{}),a.selectedLogId&&m&&St(a.selectedLogId)}catch(ae){w(ae.message||"Failed to load logs.")}},St=async ae=>{if(!ae){Ge(null);return}u.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${i("Loading conversation...")}</div>`;try{let ke=await window.aipkit_apiRequest("aipkit_stats_get_log_detail",{log_id:ae});Ge(ke)}catch(ke){u.detailPanel.innerHTML=`<div class="aipkit_stats_table_placeholder">${i(ke.message||"Failed to load conversation.")}</div>`}},Rt=ae=>{a.search=ae.trim(),a.page=1,_&&clearTimeout(_),_=window.setTimeout(()=>{Ce()},300)},vi=async()=>{if(u.cronStatus)try{let ae=await window.aipkit_apiRequest("aipkit_stats_get_log_cron_status",{});I(ae)}catch{}},gi=async()=>{if(!u.settingsToggle||!u.retentionSelect)return;let ae=u.settingsToggle.checked?"1":"0",ke=parseInt(u.retentionSelect.value,10)||90;q("Saving settings...","loading");try{let ye=await window.aipkit_apiRequest("aipkit_stats_save_settings",{enable_pruning:ae,retention_period_days:ke});E(u.settingsToggle.checked),q(ye.message||"Settings saved.","success"),vi(),window.setTimeout(()=>q(""),2e3)}catch(ye){q(ye.message||"Failed to save settings.","error")}};if(u.daysFilter&&(u.daysFilter.value=String(a.days),u.daysFilter.addEventListener("change",()=>{a.days=parseInt(u.daysFilter.value,10)||30,a.page=1,u.overviewPanel&&!u.overviewPanel.hidden&&It(),Ce()})),u.botFilter&&u.botFilter.addEventListener("change",()=>{a.botId=u.botFilter.value,a.page=1,Ce()}),u.moduleFilter&&u.moduleFilter.addEventListener("change",()=>{a.module=u.moduleFilter.value,a.page=1,Ce()}),u.searchInput&&u.searchInput.addEventListener("input",ae=>{Rt(ae.target.value||"")}),u.overviewToggle&&u.overviewPanel&&u.overviewToggle.addEventListener("click",()=>{let ae=!u.overviewPanel.hidden;Qe(!ae)}),u.tableBody&&u.tableBody.addEventListener("click",ae=>{let ke=ae.target.closest("tr[data-log-id]");if(!ke)return;let ye=ke.getAttribute("data-log-id");ye&&(a.selectedLogId=Number(ye),u.tableBody.querySelectorAll("tr").forEach(ve=>{ve.classList.toggle("aipkit_stats_row_active",ve===ke)}),St(ye))}),u.detailPanel&&u.detailPanel.addEventListener("click",ae=>{let ke=ae.target.closest(".aipkit_stats_detail_delete");if(!ke){let ye=ae.target.closest("[data-aipkit-stats-toggle]");if(!ye)return;let ve=ye.getAttribute("data-aipkit-stats-toggle");if(!ve)return;let Re=document.getElementById(ve);if(!Re)return;let Ie=ye.getAttribute("aria-expanded")==="true";Re.hidden=Ie,ye.setAttribute("aria-expanded",Ie?"false":"true"),ye.classList.toggle("is-expanded",!Ie);return}ge(ke.getAttribute("data-log-id"))}),u.tableMenuTrigger&&u.tableMenu&&u.tableMenuTrigger.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),ze(u.tableMenu.hidden)}),document.addEventListener("click",ae=>{!u.tableMenu||u.tableMenu.hidden||ae.target.closest("#aipkit_stats_table_menu")||ae.target.closest("#aipkit_stats_table_menu_trigger")||ze(!1)}),document.addEventListener("keydown",ae=>{ae.key!=="Escape"||!u.tableMenu||u.tableMenu.hidden||ze(!1)}),u.deleteAllBtn&&u.deleteAllBtn.addEventListener("click",()=>{ze(!1),Ae()}),u.exportBtn&&u.exportBtn.addEventListener("click",()=>{ze(!1),ot()}),u.settingsToggle&&u.settingsToggle.addEventListener("change",()=>{if(!v){u.settingsToggle.checked=!1,q("Upgrade to Pro to enable auto-delete.","error");return}E(u.settingsToggle.checked),gi()}),u.retentionSelect&&u.retentionSelect.addEventListener("change",()=>{v&&gi()}),u.shortcodeToggle&&u.shortcodeConfig&&u.shortcodeToggle.addEventListener("click",ae=>{ae.preventDefault();let ke=!u.shortcodeConfig.hidden;u.shortcodeConfig.hidden=ke,u.shortcodeToggle.setAttribute("aria-expanded",ke?"false":"true"),u.shortcodeToggle.classList.toggle("is-active",!ke)}),u.shortcodeOptions&&u.shortcodeOptions.length&&(u.shortcodeOptions.forEach(ae=>{ae.addEventListener("change",M)}),M()),u.shortcodeSnippet&&u.shortcodeSnippet.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(u.shortcodeSnippet.textContent,u.shortcodeSnippet)}),u.settingsUsersNav&&u.settingsUsersNav.addEventListener("click",ae=>{ae.preventDefault(),H(),O()}),u.userSheetClose&&u.userSheetClose.addEventListener("click",ae=>{ae.preventDefault(),F()}),u.userSheet&&u.userSheet.addEventListener("click",ae=>{ae.target===u.userSheet&&F()}),u.userSearchInput&&(u.userSearchInput.addEventListener("input",()=>{clearTimeout(f);let ae=u.userSearchInput.value.trim();f=window.setTimeout(()=>{P(1,ae)},350)}),u.userSearchInput.addEventListener("keydown",ae=>{if(ae.key==="Enter"){ae.preventDefault(),clearTimeout(f);let ke=u.userSearchInput.value.trim();P(1,ke),u.userSearchClear&&(u.userSearchClear.hidden=ke.length===0)}})),u.userSearchClear&&u.userSearchClear.addEventListener("click",()=>{u.userSearchInput&&(u.userSearchInput.value=""),u.userSearchClear.hidden=!0,P(1,"")}),u.userTableBody){let ae="data-user-credits-listeners";u.userTableBody.getAttribute(ae)||(u.userTableBody.addEventListener("change",ke=>{ke.target.matches(".aipkit_stats_credits_balance_input")&&V(ke.target)}),u.userTableBody.addEventListener("keypress",ke=>{ke.key==="Enter"&&ke.target.matches(".aipkit_stats_credits_balance_input")&&(ke.preventDefault(),ke.target.blur())}),u.userTableBody.addEventListener("click",ke=>{let ye=ke.target.closest(".aipkit_stats_usage_toggle");if(ye){ke.preventDefault();let Re=ye.closest("td");if(Re){let Ie=Re.querySelectorAll(".aipkit_stats_usage_extra");if(Ie.length){let at=Ie[0].hidden;Ie.forEach(rt=>{rt.hidden=!at}),ye.textContent=at?l("Show less","gpt3-ai-content-generator"):`${l("Show more","gpt3-ai-content-generator")}...`}}return}let ve=ke.target.closest(".aipkit_stats_purchase_history_btn");if(ve){ke.preventDefault();let Re=ve.dataset.history?JSON.parse(ve.dataset.history):[];B(Re,ve.dataset.userName||"")}}),u.userTableBody.setAttribute(ae,"true"))}document.addEventListener("keydown",ae=>{ae.key==="Escape"&&u.userSheet&&u.userSheet.classList.contains("aipkit-active")&&F()}),Qe(y(),!1),Ce(),E(!!u.settingsToggle?.checked)}window.aipkit_initStats=n})();(function(){"use strict";function k(){let o={},r=document.getElementById("aipkit_settings_container");return r&&r.querySelectorAll("input[name], select[name], textarea[name]").forEach(e=>{e.type==="checkbox"?o[e.name]=e.checked?"1":"0":e.type==="radio"?e.checked&&(o[e.name]=e.value):o[e.name]=e.value}),o}window.aipkit_getCurrentFormData=k})();(function(){"use strict";window.aipkit_isSaving=!1,window.aipkit_lastSavedData=null;async function k(){if(typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getCurrentFormData!="function"){console.error("AIPKit Auto Save Logic: Missing required UI, API, or data helper functions.");return}let o=window.aipkit_getCurrentFormData(),r=window.aipkit_lastSavedData||{};if(JSON.stringify(o)===JSON.stringify(window.aipkit_lastSavedData)||window.aipkit_isSaving)return;window.aipkit_isSaving=!0;let i="aipkit_settings_messages";window.aipkit_showSavingIndicator(i,!0);try{await window.aipkit_apiRequest("aipkit_save_ai_settings",o),window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"success","Settings saved!"),window.aipkit_lastSavedData=o,typeof window.aipkit_queueProviderAutoSync=="function"&&window.aipkit_queueProviderAutoSync(r,o)}catch(e){window.aipkit_showSavingIndicator(i,!1),window.aipkit_showMessage(i,"error","Save failed: "+e.message),console.error("AIPKit Auto-Save Error:",e)}finally{window.aipkit_isSaving=!1}}window.aipkit_handleAutoSave=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let i="data-autosave-listener-attached";r.getAttribute(i)||(r.addEventListener("change",function(e){let t=e.target;t.matches(".aipkit_autosave_trigger")&&t.id!=="aipkit_provider"&&(t.tagName.toLowerCase()==="select"||t.type==="checkbox"||t.type==="range")&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}),r.addEventListener("blur",function(e){let t=e.target;if(t.matches(".aipkit_autosave_trigger")&&t.id!=="aipkit_provider"){let c=t.tagName.toLowerCase();(c==="input"||c==="textarea")&&t.type!=="range"&&t.type!=="checkbox"&&(typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.error("Autosave Init: aipkit_handleAutoSave not found"))}},!0),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():console.error("Autosave Init: aipkit_updateLastSavedData not found"),r.setAttribute(i,"true"))}function o(){typeof window.aipkit_getCurrentFormData=="function"?window.aipkit_lastSavedData=window.aipkit_getCurrentFormData():console.error("AIPKit Autosave: Cannot update baseline, aipkit_getCurrentFormData not found.")}window.aipkit_attachAutoSaveListeners=k,window.aipkit_updateLastSavedData=o})();(function(){"use strict";function k(r){try{return new Date(r+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return r}}function o(r){return typeof r!="number"?r:r.toLocaleString()}window.aipkit_formatChartDate=k,window.aipkit_formatChartNumber=o})();(function(){"use strict";let k=["#4A6FA5","#61A0FF","#81C784","#FFB74D","#BA68C8","#E57373","#FFF176","#7986CB","#4DB6AC","#F06292","#A1887F","#90A4AE"],o="#B0BEC5",r={};function i(t){r={};let c=0;t.forEach(s=>{if(s==="Other")r[s]=o;else{let n;do n=k[c%k.length],c++;while(n===o&&k.length>1);r[s]=n}})}function e(t){return r[t]||"#cccccc"}window.aipkit_assignModuleColors=i,window.aipkit_getModuleColor=e})();(function(){"use strict";function k(e,t){if(!t||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"){console.error("Tooltip Error: Missing tooltip element or utility/color functions.");return}let c=e.target,s=c.getAttribute("data-date"),n=c.getAttribute("data-module"),d=parseInt(c.getAttribute("data-value"),10),a=parseInt(c.getAttribute("data-daily-total"),10),l=window.aipkit_getModuleColor(n),p=n?o(n.replace(/[-_]/g," ")):"Unknown";t.innerHTML=`
            <span class="aipkit_chart_tooltip_date">${window.aipkit_formatChartDate(s)}:</span><br>
            <span class="aipkit_chart_tooltip_model" style="color: #ffffff; background-color: ${l}; padding: 1px 4px; border-radius: 2px; font-weight: bold;">${p}</span> <?php // Use module name ?>
            <span class="aipkit_chart_tooltip_value">${window.aipkit_formatChartNumber(d)} tokens</span><br>
            <span class="aipkit_chart_tooltip_total">(Total: ${window.aipkit_formatChartNumber(a)} tokens)</span>
        `,t.classList.add("aipkit_active"),r(e,t)}function o(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function r(e,t){if(!t)return;let c=t.parentElement;if(!c)return;let s=c.getBoundingClientRect(),n=e.clientX-s.left,d=e.clientY-s.top,a=t.offsetWidth,l=t.offsetHeight,p=n+15,_=d-l-10;p+a>s.width-5&&(p=n-a-15),p<5&&(p=5),_<5&&(_=d+15),_+l>s.height-5&&(_=s.height-l-5),t.style.left=`${p}px`,t.style.top=`${_}px`,t.style.transform="translate(0, 0)"}function i(e){e&&e.classList.remove("aipkit_active")}window.aipkit_showStackedTooltip=k,window.aipkit_moveChartTooltip=r,window.aipkit_hideChartTooltip=i})();(function(){"use strict";let k="http://www.w3.org/2000/svg";function o(i,e){if(i.innerHTML="",typeof window.aipkit_assignModuleColors!="function"||typeof window.aipkit_getModuleColor!="function"||typeof window.aipkit_formatChartNumber!="function"||typeof window.aipkit_formatChartDate!="function"||typeof window.aipkit_showStackedTooltip!="function"||typeof window.aipkit_moveChartTooltip!="function"||typeof window.aipkit_hideChartTooltip!="function"){console.error("AIPKit Chart Renderer: Missing required chart utility/color/tooltip functions."),i.innerHTML='<p style="color:red">Error rendering chart: Dependencies missing.</p>';return}let t=Object.keys(e);if(t.length===0){i.innerHTML='<p style="text-align:center; padding:20px;">No data available for chart.</p>';return}let c=new Set;t.forEach(C=>{Object.keys(e[C]).forEach(b=>c.add(b))});let s=Array.from(c);s.sort((C,b)=>{if(C==="Other")return 1;if(b==="Other")return-1;let x=T=>T?r(T.replace(/[-_]/g," ")):"Unknown";return x(C).localeCompare(x(b))}),window.aipkit_assignModuleColors(s);let n=1;t.forEach(C=>{let b=Object.values(e[C]).reduce((x,T)=>x+T,0);b>n&&(n=b)}),n=n*1.05;let d=t.length,a=250,l=s.length>0?Math.max(40,Math.ceil(s.length/3)*20):0,p={top:20,right:20,bottom:30+l,left:50},_=i.clientWidth-p.left-p.right,f=a-p.top-p.bottom,g=Math.max(1,_/d*.8),m=Math.max(0,_/d*.2),u=document.createElementNS(k,"svg");u.setAttribute("viewBox",`0 0 ${i.clientWidth} ${a}`),u.setAttribute("preserveAspectRatio","xMidYMid meet"),u.setAttribute("class","aipkit_token_usage_chart_svg"),u.setAttribute("aria-label","Token usage per module per day chart");let h=document.createElementNS(k,"g");h.setAttribute("transform",`translate(${p.left}, ${p.top})`),u.appendChild(h);let v=document.createElement("div");v.className="aipkit_chart_tooltip",i.style.position="relative",i.appendChild(v);let S=document.createElementNS(k,"g");S.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_y"),h.appendChild(S);let q=document.createElementNS(k,"line");q.setAttribute("x1",0),q.setAttribute("y1",0),q.setAttribute("x2",0),q.setAttribute("y2",f),S.appendChild(q);let y=5;for(let C=0;C<y;C++){let b=Math.round(n*(C/(y-1))),x=f-f*(C/(y-1)),T=document.createElementNS(k,"text");T.setAttribute("x",-5),T.setAttribute("y",x+3),T.setAttribute("class","aipkit_chart_label aipkit_chart_label_y"),T.textContent=window.aipkit_formatChartNumber(b),S.appendChild(T);let P=document.createElementNS(k,"line");P.setAttribute("x1",0),P.setAttribute("y1",x),P.setAttribute("x2",_),P.setAttribute("y2",x),P.setAttribute("class","aipkit_chart_grid_line"),h.insertBefore(P,h.firstChild)}let E=document.createElementNS(k,"g");E.setAttribute("class","aipkit_chart_axis aipkit_chart_axis_x"),E.setAttribute("transform",`translate(0, ${f})`),h.appendChild(E);let I=document.createElementNS(k,"line");I.setAttribute("x1",0),I.setAttribute("y1",0),I.setAttribute("x2",_),I.setAttribute("y2",0),E.appendChild(I);let w=Math.max(1,Math.ceil(d/(_/60)));t.forEach((C,b)=>{if(b%w===0||b===d-1){let x=b*(g+m)+g/2+m/2,T=document.createElementNS(k,"text");T.setAttribute("x",x),T.setAttribute("y",p.bottom-l-10),T.setAttribute("class","aipkit_chart_label aipkit_chart_label_x"),T.textContent=window.aipkit_formatChartDate(C),E.appendChild(T)}});let A=document.createElementNS(k,"g");if(h.appendChild(A),t.forEach((C,b)=>{let x=e[C],T=f,P=0;s.filter(F=>x[F]>0).forEach(F=>{let M=x[F]||0;P+=M;let B=M/n*f;T-=B;let V=b*(g+m)+m/2,L=document.createElementNS(k,"rect");L.setAttribute("x",V),L.setAttribute("y",T),L.setAttribute("width",g),L.setAttribute("height",Math.max(.1,B)),L.setAttribute("class","aipkit_chart_bar"),L.setAttribute("fill",window.aipkit_getModuleColor(F)),L.setAttribute("data-date",C),L.setAttribute("data-module",F),L.setAttribute("data-value",M),L.setAttribute("data-daily-total",0),L.addEventListener("mouseenter",U=>window.aipkit_showStackedTooltip(U,v)),L.addEventListener("mousemove",U=>window.aipkit_moveChartTooltip(U,v)),L.addEventListener("mouseleave",()=>window.aipkit_hideChartTooltip(v)),A.appendChild(L)}),A.querySelectorAll(`rect[data-date="${C}"]`).forEach(F=>F.setAttribute("data-daily-total",P))}),s.length>0){let C=document.createElementNS(k,"g");C.setAttribute("class","aipkit_chart_legend"),C.setAttribute("transform",`translate(0, ${f+p.bottom-l+5})`),h.appendChild(C);let b=0,x=0,T=20,P=_,H=35;s.forEach(O=>{let F=r(O.replace(/[-_]/g," ")),B=F.length*7+25+H;b>0&&b+B>P&&(b=0,x+=T);let V=document.createElementNS(k,"g");V.setAttribute("transform",`translate(${b}, ${x})`);let L=document.createElementNS(k,"rect");L.setAttribute("width",10),L.setAttribute("height",10),L.setAttribute("y",-5),L.setAttribute("fill",window.aipkit_getModuleColor(O)),V.appendChild(L);let U=document.createElementNS(k,"text");U.setAttribute("x",15),U.setAttribute("y",0),U.setAttribute("class","aipkit_chart_legend_label"),U.textContent=F,V.appendChild(U),C.appendChild(V),b+=B})}i.appendChild(u)}function r(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}window.aipkit_renderTokenUsageChart=o})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_token_usage_chart_container");if(!r){console.warn("AIPKit Chart Fetcher: Container not found.");return}if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_renderTokenUsageChart!="function"){console.error("AIPKit Chart Fetcher: Missing required API or render functions.");return}let i=r.querySelector(".aipkit_chart_loading_placeholder"),e=r.querySelector(".aipkit_chart_error_placeholder"),t=r.querySelector(".aipkit_chart_nodata_placeholder");e&&(e.style.display="none"),t&&(t.style.display="none"),i&&(i.style.display="flex");let c=[3,7,14,30,90],s=parseInt(o,10);if(!s||isNaN(s)){try{let d=localStorage.getItem("aipkit_stats_period_days"),a=parseInt(d,10);d&&!isNaN(a)&&c.includes(a)&&(s=a)}catch{}let n=document.getElementById("aipkit_stats_period_select");if(n){let d=parseInt(n.value,10);(!s||isNaN(s))&&(s=!isNaN(d)&&c.includes(d)?d:3),c.includes(s)&&String(n.value)!==String(s)&&(n.value=String(s))}else r.dataset.defaultDays?s=parseInt(r.dataset.defaultDays,10)||3:s=3}window.aipkit_apiRequest("aipkit_get_token_usage_chart_data",{days:s}).then(n=>{if(i&&(i.style.display="none"),n&&n.daily_token_data){let d=n.daily_token_data;if(d&&typeof d=="object"&&Object.values(d).some(l=>l&&typeof l=="object"&&Object.values(l).some(p=>Number(p)>0)))window.aipkit_renderTokenUsageChart(r,d);else{let l=n.notice||window.aipkit_dashboard?.text?.chartNoData||"No token usage data found for the selected period.",p=n.manage_logs_url,_=e||t;if(_){_.textContent="";let f=document.createTextNode(l+" ");if(_.appendChild(f),p){let g=document.createElement("a");g.href=p,g.target="_blank",g.rel="noopener noreferrer",g.textContent=window.aipkit_dashboard?.text?.manageLogs||"View stats",_.appendChild(g)}_.style.display="flex"}else{let f=document.createElement("div");f.className="aipkit_chart_error_placeholder",f.textContent=l,r.innerHTML="",r.appendChild(f)}}}else throw new Error("Invalid data received for chart.")}).catch(n=>{if(console.error("AIPKit Chart Fetcher: Error loading data:",n),i&&(i.style.display="none"),e)e.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${n.message})`,e.style.display="flex";else{let d=document.createElement("div");d.className="aipkit_chart_error_placeholder",d.textContent=(window.aipkit_dashboard?.text?.chartError||"Error loading chart data.")+` (${n.message})`,r.innerHTML="",r.appendChild(d)}})}window.aipkit_loadTokenUsageChart=k,document.addEventListener("change",function(o){let r=o.target;if(r&&r.id==="aipkit_stats_period_select"){let i=parseInt(r.value,10)||7;typeof window.aipkit_loadTokenUsageChart=="function"&&window.aipkit_loadTokenUsageChart(i);try{[3,7,14,30,90].includes(i)&&localStorage.setItem("aipkit_stats_period_days",String(i))}catch{}}})})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openai=r);let i=document.getElementById("aipkit_openai_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openai_model"]');if(!i&&e.length===0){console.warn("OpenAI Sync: No OpenAI model selects found (#aipkit_openai_model or chat selects).");return}let t=window.aipkit_dashboard?.recommendedModels?.openai||[],c=Array.isArray(t)?t:[],s=m=>{if(!m)return[];let u=k("Recommended","gpt3-ai-content-generator"),h=Array.from(m.querySelectorAll("optgroup")).find(v=>v.label===u||v.label==="Recommended");return h?Array.from(h.querySelectorAll("option")).map(v=>({id:v.value,name:v.textContent.trim()||v.value})).filter(v=>v.id):[]};if(c.length===0){let m=i||e[0];c=s(m)}let n=new Set(c.map(m=>m?.id).filter(Boolean)),d=r&&typeof r=="object"?r:{},a=["o1 models","o3 models","o4 models","gpt-3.5 models","gpt-4 models","gpt-5 models","fine-tuned models","others"],l=Object.keys(d),p=a.filter(m=>l.includes(m)).concat(l.filter(m=>!a.includes(m)).sort()),_=m=>{let u=m.value;m.innerHTML="";let h=!1,v=!1;if(c.length>0){let S=document.createElement("optgroup");S.label=k("Recommended","gpt3-ai-content-generator"),c.forEach(q=>{if(!q||typeof q!="object"||!q.id)return;let y=new Option(q.name||q.id,q.id);q.id===u&&(y.selected=!0,h=!0),S.appendChild(y)}),S.children.length>0&&(m.appendChild(S),v=!0)}if(p.forEach(S=>{let q=Array.isArray(d[S])?d[S].slice():[];if(q.length===0)return;q.sort((E,I)=>(E.name||E.id||"").localeCompare(I.name||I.id||""));let y=document.createElement("optgroup");y.label=S,q.forEach(E=>{let I=E?.id||"";if(!I||n.has(I))return;let w=new Option(E.name||I,I);I===u&&(w.selected=!0,h=!0),y.appendChild(w)}),y.children.length>0&&(m.appendChild(y),v=!0)}),!v){m.appendChild(new Option("No models found.",""));return}if(!h&&u&&!m.querySelector(`option[value="${CSS.escape(u)}"]`)){let S=new Option(u+" (manual)",u,!1,!0);m.insertBefore(S,m.firstChild),m.value=u,h=!0}if(m.options.length>0&&m.selectedIndex===-1){let S=-1;for(let q=0;q<m.options.length;q++)if(!m.options[q].disabled&&m.options[q].value){S=q;break}m.selectedIndex=S!==-1?S:0}};i&&_(i),e.forEach(_);let f=document.getElementById("aipkit_content_writer_provider"),g=document.getElementById("aipkit_content_writer_model");f&&g&&f.value==="openai"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(f,g)}window.aipkit_updateOpenAIModels=o})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.openrouter=Array.isArray(r)?r:[]);let i=document.getElementById("aipkit_openrouter_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_openrouter_model"]');if(!i&&e.length===0){console.warn("OpenRouter Sync: No OpenRouter model selects found (#aipkit_openrouter_model or chat selects).");return}let t=window.aipkit_dashboard?.recommendedModels?.openrouter||[],c=Array.isArray(t)?t:[],s=a=>{if(!a)return[];let l=k("Recommended","gpt3-ai-content-generator"),p=Array.from(a.querySelectorAll("optgroup")).find(_=>_.label===l||_.label==="Recommended");return p?Array.from(p.querySelectorAll("option")).map(_=>({id:_.value,name:_.textContent.trim()||_.value})).filter(_=>_.id):[]};if(c.length===0){let a=i||e[0];c=s(a)}let n=new Set(c.map(a=>a?.id).filter(Boolean)),d=a=>{let l=a.value;a.innerHTML="";let p=!1,_=!1;if(c.length>0){let m=document.createElement("optgroup");m.label=k("Recommended","gpt3-ai-content-generator"),c.forEach(u=>{if(u&&typeof u=="object"&&u.id){let h=new Option(u.name||u.id,u.id);u.id===l&&(h.selected=!0,p=!0),m.appendChild(h)}}),m.children.length>0&&(a.appendChild(m),_=!0)}if(!r||!r.length){_||a.appendChild(new Option("No models found.",""));return}let f={};if(r.forEach(m=>{if(!m||!m.id||n.has(m.id))return;let u=m.id.split("/"),h=(u.length>1?u[0]:"other").toLowerCase();f[h]||(f[h]=[]),f[h].push(m)}),Object.keys(f).sort().forEach(m=>{let u=document.createElement("optgroup");u.label=m.charAt(0).toUpperCase()+m.slice(1),f[m].sort((h,v)=>(h.name||"").localeCompare(v.name||"")),f[m].forEach(h=>{let v=new Option(h.name||h.id,h.id);h.id===l&&(v.selected=!0,p=!0),u.appendChild(v)}),u.children.length>0&&(a.appendChild(u),_=!0)}),!p&&l&&!a.querySelector(`option[value="${CSS.escape(l)}"]`)){let m=new Option(l+" (manual)",l,!1,!0);a.insertBefore(m,a.firstChild)}if(!p&&a.options.length>0&&a.selectedIndex===-1){let m=-1;for(let u=0;u<a.options.length;u++)if(!a.options[u].disabled&&a.options[u].value){m=u;break}a.selectedIndex=m!==-1?m:0}};i&&d(i),e.forEach(d)}window.aipkit_updateOpenRouterModels=o})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){let i=document.getElementById("aipkit_google_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_google_model"]');if(!i&&e.length===0){console.warn("Google Sync: No Google model selects found (#aipkit_google_model or chat selects).");return}let t=window.aipkit_dashboard?.recommendedModels?.google||[],c=Array.isArray(t)?t:[],s=l=>{if(!l)return[];let p=k("Recommended","gpt3-ai-content-generator"),_=Array.from(l.querySelectorAll("optgroup")).find(f=>f.label===p||f.label==="Recommended");return _?Array.from(_.querySelectorAll("option")).map(f=>({id:f.value,name:f.textContent.trim()||f.value})).filter(f=>f.id):[]};if(c.length===0){let l=i||e[0];c=s(l)}let n=new Set(c.map(l=>l?.id).filter(Boolean)),d=Array.isArray(r)?r.slice():[];d.sort((l,p)=>(l.name||l.id||"").localeCompare(p.name||p.id||""));let a=l=>{let p=l.value;l.innerHTML="";let _=!1,f=!1,g=c.length>0?document.createElement("optgroup"):null;if(g&&(g.label=k("All models","gpt3-ai-content-generator")),c.length>0){let m=document.createElement("optgroup");m.label=k("Recommended","gpt3-ai-content-generator"),c.forEach(u=>{if(u&&typeof u=="object"&&u.id){let h=new Option(u.name||u.id,u.id);(u.id===p||`models/${u.id}`===p)&&(h.selected=!0,_=!0),m.appendChild(h)}}),m.children.length>0&&(l.appendChild(m),f=!0)}if(!d.length){f||l.appendChild(new Option("No models found.",""));return}if(d.forEach(m=>{let u=m.id||"",h=m.name||u;if(!u||n.has(u))return;let v=new Option(h,u);(u===p||`models/${u}`===p)&&(v.selected=!0,_=!0),g?g.appendChild(v):(l.appendChild(v),f=!0)}),g&&g.children.length>0&&(l.appendChild(g),f=!0),!_&&p){let m=p.startsWith("models/")?p.substring(7):p;if(!l.querySelector(`option[value="${CSS.escape(m)}"]`)){let u=m,h=new Option(u+" (manual)",p,!1,!0);l.insertBefore(h,l.firstChild),l.value=p}}if(l.options.length>0&&l.selectedIndex===-1){let m=-1;for(let u=0;u<l.options.length;u++)if(!l.options[u].disabled&&l.options[u].value){m=u;break}l.selectedIndex=m!==-1?m:0}};i&&a(i),e.forEach(a)}window.aipkit_updateGoogleModels=o})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_azure_deployment"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_azure_deployment"]');if(!r&&i.length===0){console.warn("Azure Sync: No Azure deployment selects found (#aipkit_azure_deployment or chat selects).");return}let e=t=>{let c=t.value;t.innerHTML="";let s=o&&typeof o=="object"&&!Array.isArray(o)&&(o["Chat Models"]||o["Embedding Models"]||o["Image Models"]);if(!o||Array.isArray(o)&&!o.length||s&&Object.keys(o).length===0){if(r.appendChild(new Option("No deployments found.","")),c){let d=new Option(c+" (manual)",c,!1,!0);r.appendChild(d),r.value=c}return}let n=!1;if(s)Object.keys(o).forEach(d=>{let a=o[d];if(a&&Array.isArray(a)&&a.length>0){let l=document.createElement("optgroup");l.label=d,a.sort((p,_)=>(p.id||"").localeCompare(_.id||"")),a.forEach(p=>{let _=p.id||"",f=p.name||_;if(!_)return;let g=_+(f&&f!==_?` (model: ${f})`:""),m=new Option(g,_);_===c&&(m.selected=!0,n=!0),l.appendChild(m)}),t.appendChild(l)}});else{let d=Array.isArray(o)?o:[];d.sort((a,l)=>(a.id||"").localeCompare(l.id||"")),d.forEach(a=>{let l=a.id||"",p=a.name||l;if(!l)return;let _=l+(p&&p!==l?` (model: ${p})`:""),f=new Option(_,l);l===c&&(f.selected=!0,n=!0),t.appendChild(f)})}if(!n&&t.value&&!t.querySelector(`option[value="${CSS.escape(t.value)}"]`)){let d=new Option(t.value+" (not in synced list)",t.value,!1,!0);t.appendChild(d),n=!0}if(!n&&t.options.length>0&&t.selectedIndex===-1){let d=-1;for(let a=0;a<t.options.length;a++)if(!t.options[a].disabled&&t.options[a].value){d=a;break}t.selectedIndex=d!==-1?d:0}};r&&e(r),i.forEach(e)}window.aipkit_updateAzureDeployments=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){window.aipkit_dashboard&&(window.aipkit_dashboard.models=window.aipkit_dashboard.models||{},window.aipkit_dashboard.models.claude=Array.isArray(r)?r:[]);let i=document.getElementById("aipkit_claude_model"),e=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_claude_model"]');if(!i&&e.length===0){console.warn("Claude Sync: No Claude model selects found (#aipkit_claude_model or chat selects).");return}let t=window.aipkit_dashboard?.recommendedModels?.claude||[],c=Array.isArray(t)?t:[],s=_=>{if(!_)return[];let f=k("Recommended","gpt3-ai-content-generator"),g=Array.from(_.querySelectorAll("optgroup")).find(m=>m.label===f||m.label==="Recommended");return g?Array.from(g.querySelectorAll("option")).map(m=>({id:m.value,name:m.textContent.trim()||m.value})).filter(m=>m.id):[]};if(c.length===0){let _=i||e[0];c=s(_)}let n=new Set(c.map(_=>_?.id).filter(Boolean)),d=Array.isArray(r)?r.slice():[];d.sort((_,f)=>(_.name||_.id||"").localeCompare(f.name||f.id||""));let a=_=>{let f=_.value;_.innerHTML="";let g=!1,m=!1,u=c.length>0?document.createElement("optgroup"):null;if(u&&(u.label=k("All models","gpt3-ai-content-generator")),c.length>0){let h=document.createElement("optgroup");h.label=k("Recommended","gpt3-ai-content-generator"),c.forEach(v=>{if(!v||typeof v!="object"||!v.id)return;let S=new Option(v.name||v.id,v.id);v.id===f&&(S.selected=!0,g=!0),h.appendChild(S)}),h.children.length>0&&(_.appendChild(h),m=!0)}if(d.forEach(h=>{let v=h?.id||"",S=h?.name||v;if(!v||n.has(v))return;let q=new Option(S,v);v===f&&(q.selected=!0,g=!0),u?u.appendChild(q):(_.appendChild(q),m=!0)}),u&&u.children.length>0&&(_.appendChild(u),m=!0),!m){_.appendChild(new Option("No models found.",""));return}if(!g&&f&&!_.querySelector(`option[value="${CSS.escape(f)}"]`)){let h=new Option(f+" (manual)",f,!1,!0);_.insertBefore(h,_.firstChild),_.value=f}if(_.options.length>0&&_.selectedIndex===-1){let h=-1;for(let v=0;v<_.options.length;v++)if(!_.options[v].disabled&&_.options[v].value){h=v;break}_.selectedIndex=h!==-1?h:0}};i&&a(i),e.forEach(a);let l=document.getElementById("aipkit_content_writer_provider"),p=document.getElementById("aipkit_content_writer_model");l&&p&&l.value==="claude"&&typeof window.aipkit_populateModelsForContentWriter=="function"&&window.aipkit_populateModelsForContentWriter(l,p)}window.aipkit_updateClaudeModels=o})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_deepseek_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_deepseek_model"]');if(!r&&i.length===0){console.warn("DeepSeek Sync: No DeepSeek model selects found (#aipkit_deepseek_model or chat selects).");return}let e=t=>{let c=t.value;if(t.innerHTML="",!o||!o.length){r.appendChild(new Option("No models found.",""));return}let s=!1;if(o.sort((n,d)=>(n.name||n.id||"").localeCompare(d.name||d.id||"")),o.forEach(n=>{let d=n.id||"",a=n.name||d;if(!d)return;let l=new Option(a,d);d===c&&(l.selected=!0,s=!0),t.appendChild(l)}),!s&&t.value&&!t.querySelector(`option[value="${CSS.escape(t.value)}"]`)){let n=new Option(t.value+" (manual)",t.value,!1,!0);t.insertBefore(n,t.firstChild)}!s&&t.options.length>0&&t.selectedIndex===-1&&(t.selectedIndex=0)};r&&e(r),i.forEach(e)}window.aipkit_updateDeepSeekModels=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_ollama_model"),i=document.querySelectorAll('select[id^="aipkit_bot_"][id$="_ollama_model"]');if(!r&&i.length===0){console.warn("Ollama Sync: No Ollama model selects found (#aipkit_ollama_model or chat selects).");return}let e=t=>{let c=t.value;if(t.innerHTML="",!o||!o.length){r.appendChild(new Option("No models found.",""));return}o.sort((n,d)=>(n.name||n.id||"").localeCompare(d.name||d.id||""));let s=!1;if(o.forEach(n=>{let d=n.id||"",a=n.name||d;if(!d)return;let l=new Option(a,d);d===c&&(l.selected=!0,s=!0),t.appendChild(l)}),!s&&t.value&&!t.querySelector(`option[value="${CSS.escape(t.value)}"]`)){let n=new Option(t.value+" (manual)",t.value,!1,!0);t.insertBefore(n,t.firstChild)}t.options.length>0&&t.selectedIndex===-1&&(t.selectedIndex=0)};r&&e(r),i.forEach(e)}window.aipkit_updateOllamaModels=k})();(function(){"use strict";function k(i,e){let t=Array.isArray(e)?e:[],c=JSON.stringify(t),n=`[id^="${i==="models"?"aipkit_elevenlabs_models_json_":"aipkit_elevenlabs_voices_json_"}"]`;document.querySelectorAll(n).forEach(d=>{i==="models"?d.dataset.models=c:d.dataset.voices=c})}function o(i,e="aipkit_elevenlabs_voice_id"){let t=Array.isArray(i)?i:[];k("voices",t);let c=document.getElementById(e);if(!c){console.warn(`ElevenLabs Sync (Voices): Select element #${e} not found.`);return}if(typeof e=="string"&&e.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){window.aipkit_chatTts_updateElevenLabsVoiceSelect(e,t,c.value||"");return}let s=c.value;if(c.innerHTML="",c.appendChild(new Option("-- Select a Voice (Optional) --","")),!t.length){s&&s!==""&&(c.appendChild(new Option(s+" (manual/not synced)",s,!1,!0)),c.value=s);return}let n=!1;if(t.sort((d,a)=>(d.name||d.id||"").localeCompare(a.name||a.id||"")),t.forEach(d=>{let a=d.id||"",l=d.name||a;if(!a)return;let p=new Option(l,a);a===s&&(p.selected=!0,n=!0),c.appendChild(p)}),!n&&s&&s!==""&&!c.querySelector(`option[value="${CSS.escape(s)}"]`)){let d=new Option(s+" (manual/not synced)",s,!1,!0);c.appendChild(d),c.value=s}}function r(i,e="aipkit_elevenlabs_tts_model_id"){let t=Array.isArray(i)?i:[];k("models",t);let c=document.getElementById(e);if(!c){console.warn(`ElevenLabs Sync (Models): Select element #${e} not found.`);return}if(typeof e=="string"&&e.startsWith("aipkit_bot_")&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){window.aipkit_chatTts_updateElevenLabsModelsSelect(e,t,c.value||"");return}let s=c.value;if(c.innerHTML="",c.appendChild(new Option("-- Select a Model (Optional) --","")),!t.length){s&&s!==""&&(c.appendChild(new Option(s+" (manual/not synced)",s,!1,!0)),c.value=s);return}let n=!1;if(t.sort((d,a)=>(d.name||d.id||"").localeCompare(a.name||a.id||"")),t.forEach(d=>{let a=d.id||"",l=d.name||a;if(!a)return;let p=new Option(l,a);a===s&&(p.selected=!0,n=!0),c.appendChild(p)}),!n&&s&&s!==""&&!c.querySelector(`option[value="${CSS.escape(s)}"]`)){let d=new Option(s+" (manual/not synced)",s,!1,!0);c.appendChild(d),c.value=s}}window.aipkit_updateElevenLabsVoices=o,window.aipkit_updateElevenLabsModelsSelect=r})();(function(){"use strict";function k(o,r="aipkit_pinecone_default_index"){let i=document.getElementById(r);if(!i){console.warn(`Pinecone Sync: Select element #${r} not found.`);return}let e=i.value;if(i.innerHTML="",i.appendChild(new Option("-- Select Default Index --","")),!o||!o.length){i.appendChild(new Option("(No indexes found - Sync again)","")),e&&e!==""&&(i.appendChild(new Option(e+" (manual)",e,!1,!0)),i.value=e);return}let t=!1;if(o.sort((c,s)=>(c.name||c.id||"").localeCompare(s.name||s.id||"")),o.forEach(c=>{let s=c.name||c.id||(typeof c=="string"?c:"");if(!s)return;let n=new Option(s,s);s===e&&(n.selected=!0,t=!0),i.appendChild(n)}),!t&&e&&e!==""&&!i.querySelector(`option[value="${CSS.escape(e)}"]`)){let c=new Option(e+" (manual)",e,!1,!0);i.appendChild(c),i.value=e}}window.aipkit_updatePineconeIndexes=k})();(function(){"use strict";function k(o,r="aipkit_qdrant_default_collection"){let i=document.getElementById(r);if(!i){console.warn(`Qdrant Sync: Select element #${r} not found.`);return}let e=i.multiple,t=e?Array.from(i.selectedOptions).map(s=>s.value).filter(Boolean):[i.value];if(i.innerHTML="",e||i.appendChild(new Option("-- Select Collection (Optional) --","")),!o||!o.length){i.appendChild(new Option("(No collections found - Sync again)","")),t.length&&(t.forEach(s=>{s&&i.appendChild(new Option(s+" (manual)",s,!1,!0))}),!e&&t[0]&&(i.value=t[0]));return}let c=new Set;if(o.sort((s,n)=>(s.name||s.id||"").localeCompare(n.name||n.id||"")),o.forEach(s=>{let n=s.name||s.id||"";if(!n)return;let d=t.includes(n),a=new Option(n,n,!1,d);d&&c.add(n),i.appendChild(a)}),t.forEach(s=>{if(s&&!c.has(s)&&!i.querySelector(`option[value="${CSS.escape(s)}"]`)){let n=new Option(s+" (manual)",s,!1,!0);i.appendChild(n)}}),!e&&t[0]&&!i.value&&(i.value=t[0]),typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let s=i.closest(".aipkit_popover_options_list")||i.closest(".aipkit_popover_option_main")||document;window.aipkit_populateQdrantCollectionsMultiSelect(s)}}window.aipkit_updateQdrantCollections=k})();(function(){"use strict";function k(o,r=""){let i=r||"aipkit_replicate_model",e=document.getElementById(i);if(window.aipkit_dashboard&&window.aipkit_dashboard.imageGeneratorModels&&(window.aipkit_dashboard.imageGeneratorModels.replicate=o),window.aipkit_image_generator_config_public&&(window.aipkit_image_generator_config_public.replicate_models=o),!e){r&&console.warn(`Replicate Sync: Select element #${i} not found.`);return}let t=e.value;if(e.innerHTML="",!o||!o.length){e.appendChild(new Option("(No models found - Sync again)","")),t&&t!==""&&(e.appendChild(new Option(t+" (manual/not synced)",t,!1,!0)),e.value=t);return}let c=!1;if(o.sort((s,n)=>(s.name||s.id||"").localeCompare(n.name||n.id||"")),o.forEach(s=>{let n=s.id||"",d=s.name||n;if(!n)return;let a=new Option(d,n);n===t&&(a.selected=!0,c=!0),e.appendChild(a)}),!c&&t&&t!==""&&!e.querySelector(`option[value="${CSS.escape(t)}"]`)){let s=new Option(t+" (manual)",t,!1,!0);e.insertBefore(s,e.firstChild),e.value=t}if(!e.value&&e.options.length>0){let s=-1;for(let n=0;n<e.options.length;n++)if(!e.options[n].disabled&&e.options[n].value){s=n;break}e.selectedIndex=s!==-1?s:0}}window.aipkit_updateReplicateModels=k})();(function(){"use strict";function k(f,g,m={}){if(typeof window.aipkit_clearStatusMessages!="function"||typeof window.aipkit_showSavingIndicator!="function"||typeof window.aipkit_showMessage!="function"||typeof window.aipkit_apiRequest!="function")return console.error("AIPKit Model Sync Init: Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync models/voices, required functions missing."),null;let u=m&&typeof m=="object"?m:{},h=!!u.silent,v=u.showErrors!==!1,S=!!f,q=(O,F="")=>{let M=Array.isArray(O)?O:[],B=document.getElementById("aipkit_google_tts_voices_json_main");B&&(B.dataset.voices=JSON.stringify(M));let V=F||document.querySelector('select[name="tts_google_voice_id"]')?.id||"";if(V&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let L=document.getElementById(V);window.aipkit_updateGoogleVoiceSelect(V,M,L&&L.value||"")}},y={OpenAI:window.aipkit_updateOpenAIModels,OpenRouter:window.aipkit_updateOpenRouterModels,Google:window.aipkit_updateGoogleModels,GoogleTtsVoices:q,Azure:window.aipkit_updateAzureDeployments,Claude:window.aipkit_updateClaudeModels,DeepSeek:window.aipkit_updateDeepSeekModels,Ollama:window.aipkit_updateOllamaModels,ElevenLabs:window.aipkit_updateElevenLabsVoices,ElevenLabsModels:window.aipkit_updateElevenLabsModelsSelect,PineconeIndexes:window.aipkit_updatePineconeIndexes,QdrantCollections:window.aipkit_updateQdrantCollections,Replicate:window.aipkit_updateReplicateModels};if(typeof y[g]!="function"){console.error(`AIPKit Model Sync Init: Missing update function for provider ${g}.`),alert(`AIPKit Error: Cannot update UI for ${g}.`);return}let E="aipkit_settings_messages",I=S?!!f.closest(".aipkit_popover_options_list"):!1;!h&&!I&&document.getElementById(E)&&(window.aipkit_clearStatusMessages(E),window.aipkit_showSavingIndicator(E,!1));let w=S?f.querySelector(".aipkit_btn-text"):null,A=S?f.getAttribute("data-target-select"):u.targetSelectId||"",C=null;if(I){let F=f.closest(".aipkit_popover_flyout_body")?.closest(".aipkit-modal-content")?.querySelector(".aipkit_popover_flyout_header")||f.closest(".aipkit_popover_context_flyout")?.querySelector(".aipkit_popover_flyout_header")||f.closest(".aipkit_popover_flyout_header");if(F&&(C=F.querySelector(".aipkit_popover_status_inline")),!C){let M=f.closest(".aipkit_model_settings_popover");M&&(C=M.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline.aipkit_model_sync_status"))}if(!C){let M=f.closest(".aipkit_popover_option_row");M&&(C=M.querySelector(".aipkit_popover_status_inline"))}if(!C){let M=f.closest(".aipkit_model_settings_panel");M&&(C=M.querySelector(".aipkit_popover_status_inline.aipkit_model_sync_status"))}}else{let O=S?f.closest(".aipkit_chatbot_model_field"):null,F=S?f.closest(".aipkit_chatbot_builder"):null;F&&F.getAttribute("data-aipkit-chatbot-layout")==="next"&&(C=F.querySelector(".aipkit_builder_card_status .aipkit_model_sync_status")),C||(C=O?O.querySelector(".aipkit_model_sync_status"):null)}if(!C&&g){let O=document.querySelector(`.aipkit_chatbot_model_field[data-provider="${g}"]`);O&&(C=O.querySelector(".aipkit_model_sync_status"))}let b=(O,F,M)=>{if(!C)return;let B=C.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_save_status_container");B&&O&&(B.textContent="",B.className="aipkit_save_status_container"),C.textContent=O||"",C.classList.remove("success","error","loading"),F&&C.classList.add(F),M?C.setAttribute("title",M):C.removeAttribute("title"),C.classList.contains("aipkit_popover_status_inline")&&(C.style.display=O?"inline-block":"none")};b("Syncing\u2026","loading");let x=w?w.textContent:g.includes("ElevenLabs")||g.includes("Pinecone")||g.includes("Qdrant")||g.includes("Replicate")?"Sync Items":"Sync Models";w&&(w.textContent="");let T=null;return S&&(T=f.querySelector(".aipkit_spinner"),T||(T=document.createElement("span"),T.className="aipkit_spinner",f.appendChild(T)),T.style.display="inline-block",f.classList.add("aipkit_loading"),f.disabled=!0),(g==="GoogleTtsVoices"?window.aipkit_apiRequest("aipkit_sync_google_tts_voices"):window.aipkit_apiRequest("aipkit_sync_models",{provider:g})).then(O=>{g==="OpenRouter"&&Array.isArray(O?.embedding_models)&&(window.aipkit_dashboard=window.aipkit_dashboard||{},window.aipkit_dashboard.embeddingModels=window.aipkit_dashboard.embeddingModels||{},window.aipkit_dashboard.embeddingModels.openrouter=O.embedding_models);let F=g==="GoogleTtsVoices"?O.voices:O.models;u.skipUpdate||(A?y[g](F,A):y[g](F)),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers(),(g==="PineconeIndexes"||g==="QdrantCollections")&&typeof window.aipkit_refreshTrainingSourcesCount=="function"&&window.aipkit_refreshTrainingSourcesCount(),typeof window.aipkit_updateLastSavedData=="function"?window.aipkit_updateLastSavedData():h||console.warn("Model Sync Init: Cannot update autosave baseline.");let M="models";g==="ElevenLabs"||g==="GoogleTtsVoices"?M="voices":g==="ElevenLabsModels"?M="synthesis models":g==="PineconeIndexes"?M="indexes":g==="QdrantCollections"&&(M="collections"),!h&&!I&&document.getElementById(E)&&window.aipkit_showMessage(E,"success",`${g.replace(/Indexes|Collections|Models/,"")} ${M} synced!`),b("Saved","success"),C&&setTimeout(()=>b("",null),2500)}).catch(O=>{let F=O?.message||"Sync failed.";if(v&&!I&&document.getElementById(E)&&window.aipkit_showMessage(E,"error",`Sync failed: ${F}`),console.error(`AIPKit Sync Error (${g}):`,O),b(F,"error",F),C&&setTimeout(()=>b("",null),5e3),u.propagateError)throw O}).finally(()=>{if(S){f.disabled=!1,f.classList.remove("aipkit_loading");let O=f.querySelector(".aipkit_spinner");O&&(O.style.display="none"),w&&(w.textContent=x)}})}function o(f){if(!f)return;let g="data-sync-listener-attached";f.getAttribute(g)||(f.addEventListener("click",function(m){let u=m.target.closest(".aipkit_sync_btn");if(!u||u.disabled)return;m.preventDefault();let h=u.getAttribute("data-provider")||"";if(!h){let v=u.closest(".aipkit_chatbot_model_field");v&&v.getAttribute("data-provider")&&(h=v.getAttribute("data-provider"))}h?k(u,h):console.warn("AIPKit Model Sync Init: Sync button missing data-provider attribute:",u)}),f.setAttribute(g,"true"))}function r(){o(document.getElementById("aipkit_module-container")),o(document.getElementById("aipkit_chatbot_main_tab_content_container"))}let i=[],e=!1;function t(f,g){if(!f||typeof f!="object")return"";let m=f[g];return m==null?"":String(m).trim()}function c(f,g,m){return m.some(u=>t(f,u)!==t(g,u))}function s(f){return t(f,"azure_api_key")!==""&&t(f,"azure_endpoint")!==""}function n(f,g){return[{provider:"OpenAI",keys:["openai_api_key"],ready:u=>t(u,"openai_api_key")!==""},{provider:"OpenRouter",keys:["openrouter_api_key"],ready:u=>t(u,"openrouter_api_key")!==""},{provider:"Google",keys:["google_api_key"],ready:u=>t(u,"google_api_key")!==""},{provider:"GoogleTtsVoices",keys:["google_api_key"],ready:u=>t(u,"google_api_key")!==""},{provider:"Azure",keys:["azure_api_key","azure_endpoint"],ready:u=>s(u)},{provider:"Claude",keys:["claude_api_key"],ready:u=>t(u,"claude_api_key")!==""},{provider:"DeepSeek",keys:["deepseek_api_key"],ready:u=>t(u,"deepseek_api_key")!==""},{provider:"ElevenLabs",keys:["elevenlabs_api_key"],ready:u=>t(u,"elevenlabs_api_key")!==""},{provider:"ElevenLabsModels",keys:["elevenlabs_api_key"],ready:u=>t(u,"elevenlabs_api_key")!==""},{provider:"Replicate",keys:["replicate_api_key"],ready:u=>t(u,"replicate_api_key")!==""},{provider:"PineconeIndexes",keys:["pinecone_api_key"],ready:u=>t(u,"pinecone_api_key")!==""},{provider:"QdrantCollections",keys:["qdrant_url","qdrant_api_key"],ready:u=>t(u,"qdrant_url")!==""&&t(u,"qdrant_api_key")!==""}].filter(u=>c(f,g,u.keys)&&u.ready(g)).map(u=>u.provider)}function d(f){return f?document.querySelector(`.aipkit_sync_btn[data-provider="${f}"]`):null}let a=null;function l(){if(e)return;let f=i.shift();if(!f)return;e=!0;let{provider:g,options:m,resolve:u,reject:h}=f,v=d(g),S=k(v,g,m);a={provider:g,promise:S},S&&typeof S.finally=="function"?S.then(q=>{typeof u=="function"&&u(q)}).catch(q=>{typeof h=="function"&&h(q)}).finally(()=>{a=null,e=!1,l()}):(a=null,typeof u=="function"&&u(null),e=!1,l())}function p(f,g={}){if(!f)return null;if(a&&a.provider===f&&a.promise)return a.promise;if(i.some(S=>S.provider===f)){let S=i.find(q=>q.provider===f);return S&&S.promise?S.promise:null}let u,h,v=new Promise((S,q)=>{u=S,h=q});return i.push({provider:f,options:g,resolve:u,reject:h,promise:v}),l(),v}function _(f,g){if(!f||!g)return;n(f,g).forEach(u=>p(u,{silent:!0}))}window.aipkit_initSyncButtons=r,window.aipkit_syncModels=k,window.aipkit_queueProviderSync=p,window.aipkit_queueProviderAutoSync=_})();(function(){"use strict";let k=window.wp?.i18n?.__||function(y){return y},o="#aipkit_settings_container .aipkit_settings-form-row--provider-model select.aipkit_form-input",r=null,i=null,e=!1,t=y=>{if(!y)return"";let E=y.getAttribute("data-aipkit-picker-title");if(E)return E;let I=y.id&&document.querySelector(`label[for="${y.id}"]`)||y.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return I?I.textContent.trim():""},c=y=>{if(!y)return"";let E=y.selectedOptions&&y.selectedOptions.length?y.selectedOptions[0]:y.querySelector("option[selected]");if(E)return E.textContent.trim();let I=y.querySelector("option");return I?I.textContent.trim():""},s=y=>y&&y.id==="aipkit_provider",n=y=>String(y||"").trim().toLowerCase(),d=(y,E)=>{if(!y)return;let I="aipkit_settings_select_picker_icon--";y.classList.forEach(A=>{A.startsWith(I)&&y.classList.remove(A)});let w=n(E);w&&y.classList.add(`${I}${w}`)},a=y=>({buttonId:`${y}_picker_btn`,labelId:`${y}_picker_label`,popoverId:`${y}_picker_popover`,titleId:`${y}_picker_title`,searchId:`${y}_picker_search`,listId:`${y}_picker_list`}),l=y=>{if(!y||!y.id)return null;let E=a(y.id),I=document.getElementById("aipkit_settings_container");if(!I)return null;let w=document.getElementById(E.buttonId),A=s(y)||!!y.closest(".aipkit_settings-form-col--model-select");if(!w){w=document.createElement("button"),w.type="button",w.id=E.buttonId,w.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",w.setAttribute("data-aipkit-popover-target",E.popoverId),w.setAttribute("aria-controls",E.popoverId),w.setAttribute("aria-expanded","false");let b=document.createElement("span");if(b.className="aipkit_settings_select_picker_label",b.id=E.labelId,b.textContent=c(y)||k("Select","gpt3-ai-content-generator"),s(y)){let T=document.createElement("span");T.className="aipkit_settings_select_picker_icon",T.setAttribute("aria-hidden","true"),d(T,y.value),w.classList.add("aipkit_settings_select_picker_btn--provider"),w.appendChild(T)}let x=document.createElement("span");x.className="dashicons dashicons-arrow-down-alt2",x.setAttribute("aria-hidden","true"),w.appendChild(b),w.appendChild(x),y.insertAdjacentElement("beforebegin",w)}if(s(y)){let b=w.querySelector(".aipkit_settings_select_picker_icon")||(()=>{let x=document.createElement("span");return x.className="aipkit_settings_select_picker_icon",x.setAttribute("aria-hidden","true"),w.classList.add("aipkit_settings_select_picker_btn--provider"),w.insertBefore(x,w.firstChild),x})();d(b,y.value)}A&&(w.dataset.aipkitPopoverPlacement="bottom"),y.classList.contains("screen-reader-text")||y.classList.add("screen-reader-text");let C=document.getElementById(E.popoverId);if(!C){let b=s(y);C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",b&&C.classList.add("aipkit_settings_select_picker_popover--provider","aipkit_settings_select_picker_popover--provider-anchor"),C.id=E.popoverId,C.setAttribute("aria-hidden","true");let x=document.createElement("div");x.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",b&&x.classList.add("aipkit_settings_select_picker_popover_panel--provider-anchor"),x.setAttribute("role","dialog"),x.setAttribute("aria-labelledby",E.titleId);let T=document.createElement("div");T.className="aipkit_model_settings_popover_header";let P=document.createElement("span");P.className="aipkit_model_settings_popover_title",P.id=E.titleId,P.textContent=t(y)||k("Select","gpt3-ai-content-generator");let H=document.createElement("button");H.type="button",H.className="aipkit_model_settings_popover_close",H.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),H.innerHTML='<span class="dashicons dashicons-no-alt"></span>',T.appendChild(P),T.appendChild(H);let O=document.createElement("div");O.className="aipkit_model_settings_popover_body";let F=document.createElement("div");F.className="aipkit_settings_select_picker_search";let M=document.createElement("input");M.type="search",M.id=E.searchId,M.className="aipkit_form-input";let B=t(y),V=B?`Search ${B.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");M.setAttribute("placeholder",V),F.appendChild(M);let L=document.createElement("div");L.className="aipkit_settings_select_picker_list",L.id=E.listId,L.setAttribute("role","listbox"),O.appendChild(F),O.appendChild(L),x.appendChild(T),x.appendChild(O),C.appendChild(x),(b&&y.closest(".aipkit_settings-form-col--provider-select")||I).appendChild(C),b&&(F.hidden=!0)}return{ids:E,button:w,popover:C,label:document.getElementById(E.labelId),search:document.getElementById(E.searchId),list:document.getElementById(E.listId)}},p=y=>{let E=[];return y&&Array.from(y.children).forEach(w=>{if(w.tagName==="OPTGROUP"){let A=Array.from(w.children).filter(C=>C.tagName==="OPTION").map(C=>({value:C.value,label:C.textContent.trim(),disabled:C.disabled,selected:C.selected}));E.push({groupLabel:w.label||"",options:A})}else w.tagName==="OPTION"&&E.push({groupLabel:"",options:[{value:w.value,label:w.textContent.trim(),disabled:w.disabled,selected:w.selected}]})}),E},_=(y,E,I="")=>{if(!y||!E)return;let w=I.trim().toLowerCase();E.innerHTML="";let A=p(y),C=!1;if(A.forEach(b=>{let x=b.options.filter(T=>w?T.label.toLowerCase().includes(w):!0);if(x.length){if(b.groupLabel){let T=document.createElement("div");T.className="aipkit_settings_select_picker_group_label",T.textContent=b.groupLabel,E.appendChild(T)}x.forEach(T=>{let P=document.createElement("button");P.type="button",P.className="aipkit_settings_select_picker_item",P.setAttribute("role","option"),P.dataset.value=T.value,P.dataset.label=T.label,T.disabled&&(P.classList.add("is-disabled"),P.setAttribute("aria-disabled","true")),y.value===T.value?(P.classList.add("is-active"),P.setAttribute("aria-selected","true")):P.setAttribute("aria-selected","false");let H=document.createElement("span");H.className="aipkit_settings_select_picker_text",H.textContent=T.label;let O=document.createElement("span");if(O.className="dashicons dashicons-yes aipkit_settings_select_picker_check",s(y)){P.classList.add("aipkit_settings_select_picker_item--provider");let F=document.createElement("span");F.className="aipkit_settings_select_picker_icon",F.setAttribute("aria-hidden","true"),d(F,T.value),P.appendChild(F)}P.appendChild(H),P.appendChild(O),E.appendChild(P),C=!0})}}),!C){let b=document.createElement("div");b.className="aipkit_settings_select_picker_empty",b.textContent=k(w?"No matches found.":"No options available.","gpt3-ai-content-generator"),E.appendChild(b)}},f=(y,E)=>{if(!y||!E)return;let I=c(y);if(E.textContent=I||k("Select","gpt3-ai-content-generator"),s(y)){let w=E.closest("button"),A=w?w.querySelector(".aipkit_settings_select_picker_icon"):null;d(A,y.value)}},g=(y,E)=>{if(!y||!E)return;if(E.closest(".aipkit_settings_select_picker_popover")?.classList.contains("aipkit_settings_select_picker_popover--provider-anchor")){E.style.left="",E.style.top="";return}let I=y.getBoundingClientRect(),w=E.getBoundingClientRect(),A=w.width||320,C=w.height||0,b=window.innerWidth,x=window.innerHeight,T=12;if(y.dataset.aipkitPopoverPlacement==="bottom"){let O=I.left;O+A>b-T&&(O=I.right-A),O=Math.max(T,Math.min(O,b-A-T));let F=I.bottom+8;F+C>x-T&&(F=I.top-C-8),F=Math.max(T,Math.min(F,x-C-T)),E.style.left=`${Math.round(O)}px`,E.style.top=`${Math.round(F)}px`;return}let P=I.right+10;P+A>b-T&&(P=I.left-A-10),P=Math.max(T,Math.min(P,b-A-T));let H=I.top;H+C>x-T&&(H=x-C-T),H=Math.max(T,H),E.style.left=`${Math.round(P)}px`,E.style.top=`${Math.round(H)}px`},m=()=>{!r||!i||e||(e=!0,window.requestAnimationFrame(()=>{let y=r.querySelector(".aipkit_model_settings_popover_panel");g(i,y),e=!1}))},u=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},h=(y,E,I)=>{if(!y||!E)return;r&&r!==E&&u(),r=E,i=y,E.classList.add("aipkit-active"),E.setAttribute("aria-hidden","false"),y.setAttribute("aria-expanded","true");let w=E.querySelector(".aipkit_settings_select_picker_search input"),A=E.querySelector(".aipkit_settings_select_picker_list");A&&_(I,A,w?w.value:""),w&&w.offsetParent!==null&&(w.focus(),w.select());let C=E.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{g(y,C)})},v=(y,E)=>{if(!y||!E)return;let{button:I,popover:w,list:A,search:C}=E;if(I&&I.dataset.pickerListenerAttached!=="true"&&(I.addEventListener("click",b=>{if(b.preventDefault(),r===w){u();return}h(I,w,y)}),I.dataset.pickerListenerAttached="true"),w&&w.dataset.overlayListenerAttached!=="true"){w.addEventListener("click",x=>{x.target===w&&u()});let b=w.querySelector(".aipkit_model_settings_popover_close");b&&b.addEventListener("click",x=>{x.preventDefault(),u()}),w.dataset.overlayListenerAttached="true"}if(A&&A.dataset.pickerListenerAttached!=="true"&&(A.addEventListener("click",b=>{let x=b.target.closest(".aipkit_settings_select_picker_item");if(!x||x.classList.contains("is-disabled"))return;let T=x.dataset.value??"";y.value=T,y.dispatchEvent(new Event("change",{bubbles:!0})),f(y,E.label),_(y,A,C?C.value:""),u()}),A.dataset.pickerListenerAttached="true"),C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("input",()=>{_(y,A,C.value)}),C.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerListenerAttached!=="true"&&(y.addEventListener("change",()=>{f(y,E.label),_(y,A,C?C.value:"")}),y.dataset.pickerListenerAttached="true"),y&&y.dataset.pickerObserverAttached!=="true"){let b=!1;new MutationObserver(()=>{b||(b=!0,window.requestAnimationFrame(()=>{f(y,E.label),_(y,A,C?C.value:""),b=!1}))}).observe(y,{childList:!0,subtree:!0}),y.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitSettingsPickerEscapeBound||(document.addEventListener("keydown",b=>{b.key==="Escape"&&r&&u()}),document.body.dataset.aipkitSettingsPickerEscapeBound="true"),document.body.dataset.aipkitSettingsPickerOutsideBound||(document.addEventListener("mousedown",b=>{if(!r||!r.classList.contains("aipkit_settings_select_picker_popover--provider-anchor"))return;let x=b.target;r.contains(x)||i&&i.contains(x)||u()}),document.body.dataset.aipkitSettingsPickerOutsideBound="true"),document.body.dataset.aipkitSettingsPickerRepositionBound||(window.addEventListener("resize",m),window.addEventListener("scroll",m,!0),document.body.dataset.aipkitSettingsPickerRepositionBound="true")};function S(){let y=document.getElementById("aipkit_settings_container");if(!y)return;let E=y.querySelectorAll(o);E.length&&E.forEach(I=>{if(!I.id||I.dataset.aipkitPickerInit==="true")return;let w=l(I);w&&(f(I,w.label),_(I,w.list,w.search?w.search.value:""),v(I,w),I.dataset.aipkitPickerInit="true")})}function q(){let y=document.getElementById("aipkit_settings_container");if(!y)return;y.querySelectorAll(o).forEach(I=>{if(!I.id)return;let w=l(I);w&&(f(I,w.label),_(I,w.list,w.search?w.search.value:""),v(I,w),I.dataset.aipkitPickerInit="true")})}window.aipkit_initSettingsSelectPickers=S,window.aipkit_refreshSettingsSelectPickers=q})();(function(){"use strict";let k=!1,o=window.aipkit_escapeHtml||(m=>m||""),r={},i={},e=120,t="aipkit_content_writer_messages";function c(m,u){if(!m||typeof m!="string")return"";if(m.length<=u)return m;let h=m.substring(0,u-1);return h.substring(0,h.lastIndexOf(" ")).trim()+"\u2026"}function s(m){let u={"":i.use_default_position||"Default",default:i.use_default_position||"Default",replace:i.replace_selection||"Replace",after:i.insert_after||"After",before:i.insert_before||"Before"};return u[m]||u[""]}function n(m){let u=document.createElement("div");u.className="aipkit_assistant_action_card",u.dataset.actionId=m.id,u.dataset.label=m.label,u.dataset.prompt=m.prompt,u.dataset.insertPosition=m.insert_position||"";let h=o(m.prompt),v=c(h,e),S=h.length>e;return u.innerHTML=`
      <div class="aipkit_assistant_action_drag" draggable="true" title="Drag to reorder">
        <span class="dashicons dashicons-move" aria-hidden="true"></span>
      </div>
      <div class="aipkit_assistant_action_content">
        <div class="aipkit_assistant_action_label">${o(m.label)}</div>
        <div class="aipkit_assistant_action_prompt ${S?"":"aipkit_assistant_action_prompt--full"}">${S?v:h}</div>
        ${S?'<button type="button" class="aipkit-enhancer-prompt-toggle" style="background:none;border:none;padding:0;color:#2271b1;font-size:11px;cursor:pointer;text-decoration:underline;">Show more</button>':""}
      </div>
      <div class="aipkit_assistant_action_controls">
        <button type="button" class="aipkit_assistant_action_btn_small aipkit-enhancer-edit-action-btn" aria-label="${o(i.edit_action||"Edit")}">
          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
        </button>
        <button type="button" class="aipkit_assistant_action_btn_small aipkit_assistant_action_btn_small--danger aipkit-enhancer-delete-action-btn" aria-label="${o(i.delete_action||"Delete")}">
          <span class="dashicons dashicons-trash" aria-hidden="true"></span>
        </button>
      </div>
    `,u}function d(m,u=!1){let h=(m.insert_position||"").trim();return`
      <div class="aipkit_assistant_action_edit_form">
        <div class="aipkit_assistant_action_edit_row">
          <div>
            <label class="aipkit_assistant_action_edit_label">${o(i.action_label||"Label")}</label>
            <input type="text" class="aipkit-edit-label" value="${o(m.label)}" placeholder="${o(i.action_label||"Action name")}" maxlength="50">
          </div>
          <div>
            <label class="aipkit_assistant_action_edit_label">${o(i.insert_position||"Position")}</label>
            <select class="aipkit-edit-position">
              <option value="" ${h===""?"selected":""}>${o(i.use_default_position||"Use default")}</option>
              <option value="replace" ${h==="replace"?"selected":""}>${o(i.replace_selection||"Replace selection")}</option>
              <option value="after" ${h==="after"?"selected":""}>${o(i.insert_after||"Insert after")}</option>
              <option value="before" ${h==="before"?"selected":""}>${o(i.insert_before||"Insert before")}</option>
            </select>
          </div>
        </div>
        <div>
          <label class="aipkit_assistant_action_edit_label">${o(i.action_prompt||"Prompt")}</label>
          <textarea class="aipkit-edit-prompt" rows="3" placeholder="${o("Enter prompt. Use %s for selected text.")}">${o(m.prompt)}</textarea>
        </div>
        <div class="aipkit_assistant_action_edit_actions">
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--secondary aipkit-enhancer-cancel-action-btn">
            ${o(i.cancel||"Cancel")}
          </button>
          <button type="button" class="aipkit_assistant_action_btn aipkit_assistant_action_btn--primary aipkit-enhancer-save-action-btn">
            ${o(i.save||"Save")}
          </button>
        </div>
      </div>
    `}function a(m){let u={id:m.dataset.actionId,label:m.dataset.label,prompt:m.dataset.prompt,insert_position:m.dataset.insertPosition||""};m.classList.add("aipkit_assistant_action_card--editing"),m.innerHTML=d(u);let h=m.querySelector(".aipkit-edit-prompt");h&&(h.value=u.prompt);let v=m.querySelector(".aipkit-edit-label");v&&(v.focus(),v.select())}function l(m,u){m.dataset.actionId=u.id,m.dataset.label=u.label,m.dataset.prompt=u.prompt,m.dataset.insertPosition=u.insert_position||"",m.classList.remove("aipkit_assistant_action_card--editing");let h=n(u);m.innerHTML=h.innerHTML}function p(m){if(m.querySelectorAll(".aipkit_assistant_action_card").length>=10){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"error",i.max_actions_reached||"Maximum of 10 actions reached.");return}if(m.querySelector('[data-action-id^="new-"]'))return;let h=document.createElement("div");h.className="aipkit_assistant_action_card aipkit_assistant_action_card--editing",h.dataset.actionId=`new-${Date.now()}`,h.dataset.label="",h.dataset.prompt="",h.dataset.insertPosition="",h.innerHTML=d({id:h.dataset.actionId,label:"",prompt:"",insert_position:""},!0),m.prepend(h);let v=h.querySelector(".aipkit-edit-label");v&&v.focus()}async function _(m){if(k)return;let u=m.querySelector(".aipkit-edit-label"),h=m.querySelector(".aipkit-edit-prompt"),v=m.querySelector(".aipkit-edit-position");if(!u||!h)return;m.querySelectorAll(".aipkit_form-help-error").forEach(A=>A.remove()),u.style.borderColor="",h.style.borderColor="";let S=u.value.trim(),q=h.value.trim(),y=v?v.value:"",E=m.dataset.actionId,I=!1;if(!S){u.style.borderColor="#dc2626";let A=document.createElement("div");A.className="aipkit_form-help aipkit_form-help-error",A.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",A.textContent=i.label_required||"Label is required",u.parentNode.appendChild(A),I=!0}if(!q){h.style.borderColor="#dc2626";let A=document.createElement("div");A.className="aipkit_form-help aipkit_form-help-error",A.style.cssText="color:#dc2626;font-size:11px;margin-top:4px;",A.textContent=i.prompt_required||"Prompt is required",h.parentNode.appendChild(A),I=!0}if(I)return;k=!0;let w=m.querySelector(".aipkit-enhancer-save-action-btn");w&&(w.textContent=i.saving_action||"Saving...",w.disabled=!0);try{let A=await window.aipkit_apiRequest("aipkit_save_enhancer_action",{id:E,label:S,prompt:q,insert_position:y,_ajax_nonce:r.nonce_manage_actions});l(m,A.action),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"success",i.action_saved||"Action saved successfully")}catch(A){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"error",`${i.error||"Error"}: ${A.message}`),w&&(w.textContent=i.save||"Save",w.disabled=!1)}finally{k=!1}}async function f(m){let u=m.querySelector("#aipkit_enhancer_actions_list");u.innerHTML=`
      <div class="aipkit_assistant_loading" style="text-align:center;padding:24px;color:#64748b;">
        <span class="dashicons dashicons-update" style="animation:spin 1s linear infinite;"></span>
        <span style="margin-left:8px;">${o(i.loading_actions||"Loading actions...")}</span>
      </div>
    `;try{let h=await window.aipkit_apiRequest("aipkit_get_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions});u.innerHTML="";let v=h.actions||[];v.length===0?u.innerHTML=`
          <div class="aipkit_assistant_empty_state">
            <div class="aipkit_assistant_empty_state_icon">
              <span class="dashicons dashicons-edit-large" aria-hidden="true"></span>
            </div>
            <div class="aipkit_assistant_empty_state_text">
              ${o(i.no_actions||'No actions yet. Click "Add Action" to create one.')}
            </div>
          </div>
        `:v.forEach(S=>{u.appendChild(n(S))})}catch(h){u.innerHTML="",typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"error",h.message||i.loading_failed||"Failed to load actions.")}}function g(){let m=document.getElementById("aipkit_enhancer_actions_container");if(!m)return;let u=m.closest(".aipkit_assistant_settings_redesigned")||m;if(u.dataset.listenerAttached==="true")return;u.dataset.listenerAttached="true",m.dataset.listenerAttached="true";let h=m.closest(".aipkit_assistant_settings_redesigned")||u;r=window.aipkit_post_enhancer||{},i=r.text||{};let v=m.querySelector("#aipkit_enhancer_actions_list");if(!v)return;let S=h.querySelectorAll(".aipkit_assistant_position_option"),q=()=>{S.forEach(w=>{let A=w.querySelector("input[type=radio]");w.classList.toggle("aipkit_assistant_position_option--active",!!(A&&A.checked))})};q(),S.forEach(w=>{let A=w.querySelector("input[type=radio]");A&&A.addEventListener("change",q)});let y=null,E=null,I=async()=>{if(k)return;let w=Array.from(v.querySelectorAll(".aipkit_assistant_action_card")).map(x=>x.dataset.actionId).filter(x=>x&&!x.startsWith("new-"));if(!w.length)return;let A=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,C=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,b=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;k=!0,A&&A(i.saving_order||"Saving order...");try{await window.aipkit_apiRequest("aipkit_reorder_enhancer_actions",{order:w,_ajax_nonce:r.nonce_manage_actions}),C&&C(i.order_saved||"Order saved.")}catch(x){b?b(`${i.error||"Error"}: ${x.message}`):typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"error",`${i.error||"Error"}: ${x.message}`)}finally{k=!1}};v.addEventListener("dragstart",w=>{let A=w.target.closest(".aipkit_assistant_action_drag");if(!A)return;let C=A.closest(".aipkit_assistant_action_card");if(!C||C.classList.contains("aipkit_assistant_action_card--editing")){w.preventDefault();return}y=C,C.classList.add("aipkit_dragging");try{w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",C.dataset.actionId||"")}catch{}}),v.addEventListener("dragend",async()=>{y&&y.classList.remove("aipkit_dragging"),y=null,E=null,await I()}),v.addEventListener("dragover",w=>{if(!y)return;let A=w.target.closest(".aipkit_assistant_action_card");if(!A||A===y)return;w.preventDefault();let C=A.getBoundingClientRect(),x=w.clientY<C.top+C.height/2?A:A.nextSibling;(E!==A||y.nextSibling!==x)&&(v.insertBefore(y,x),E=A)}),v.addEventListener("drop",async w=>{y&&(w.preventDefault(),await I())}),u.addEventListener("click",async w=>{let A=w.target.closest(".aipkit-enhancer-add-new-btn"),C=w.target.closest(".aipkit-enhancer-reset-actions-btn"),b=w.target.closest(".aipkit-enhancer-edit-action-btn"),x=w.target.closest(".aipkit-enhancer-delete-action-btn"),T=w.target.closest(".aipkit-enhancer-save-action-btn"),P=w.target.closest(".aipkit-enhancer-cancel-action-btn"),H=w.target.closest(".aipkit-enhancer-prompt-toggle");if(A)p(v);else if(C){if(!confirm(i.confirm_reset_actions||"Reset all actions to defaults? This cannot be undone."))return;try{await window.aipkit_apiRequest("aipkit_reset_enhancer_actions",{_ajax_nonce:r.nonce_manage_actions}),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"success",i.actions_reset||"Actions reset to defaults."),f(m)}catch(O){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"error",`${i.error||"Error"}: ${O.message}`)}}else if(H){let O=H.closest(".aipkit_assistant_action_card"),F=O.querySelector(".aipkit_assistant_action_prompt"),M=O.dataset.prompt;H.textContent.toLowerCase().includes("more")?(F.textContent=o(M),F.classList.add("aipkit_assistant_action_prompt--full"),H.textContent="Show less"):(F.textContent=c(o(M),e),F.classList.remove("aipkit_assistant_action_prompt--full"),H.textContent="Show more")}else if(b)a(b.closest(".aipkit_assistant_action_card"));else if(T)await _(T.closest(".aipkit_assistant_action_card"));else if(P){let O=P.closest(".aipkit_assistant_action_card");O.dataset.actionId.startsWith("new-")?O.remove():l(O,{id:O.dataset.actionId,label:O.dataset.label,prompt:O.dataset.prompt,insert_position:O.dataset.insertPosition})}else if(x){if(k)return;let O=x.closest(".aipkit_assistant_action_card"),F=O.dataset.actionId;if(!confirm(i.confirm_delete_action||"Delete this action? This cannot be undone."))return;k=!0,x.disabled=!0;try{await window.aipkit_apiRequest("aipkit_delete_enhancer_action",{id:F,_ajax_nonce:r.nonce_manage_actions}),O.style.transition="opacity 0.2s, transform 0.2s",O.style.opacity="0",O.style.transform="translateX(-10px)",setTimeout(()=>O.remove(),200),typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"success",i.action_deleted||"Action deleted.")}catch(M){typeof window.aipkit_showMessage=="function"&&window.aipkit_showMessage(t,"error",`${i.error||"Error"}: ${M.message}`),x.disabled=!1}finally{k=!1}}}),u.addEventListener("keydown",w=>{if(w.key==="Enter"&&w.target.matches("input[type=text]")){w.preventDefault();let A=w.target.closest(".aipkit_assistant_action_card--editing");A&&_(A)}}),window.aipkit_enhancer_reload_actions=()=>f(m),f(m)}window.aipkit_initEnhancerActionsUI=g})();(function(){"use strict";let k=[],o=[];function r(t){let c=document.getElementById("aipkit_semantic_search_target_id");if(!c)return;let s=c.value;c.innerHTML='<option value="">-- Select --</option>';let n=[];t==="pinecone"?n=k:t==="qdrant"&&(n=o),Array.isArray(n)&&n.forEach(d=>{let a=d.name||d.id||(typeof d=="string"?d:null);if(a){let l=document.createElement("option");l.value=a,l.textContent=a,c.appendChild(l)}}),c.querySelector(`option[value="${CSS.escape(s)}"]`)&&(c.value=s)}function i(t){let c=document.getElementById("aipkit_semantic_search_embedding_provider");if(!c||!t)return;let s=t.options[t.selectedIndex];s&&s.dataset.provider&&(c.value=s.dataset.provider)}function e(){let t=document.getElementById("aipkit_settings_container");if(!t)return;let c="data-semantic-search-listener-attached";if(t.getAttribute(c))return;let s=document.getElementById("aipkit_semantic_search_vector_provider"),n=document.getElementById("aipkit_pinecone_indexes_json_main"),d=document.getElementById("aipkit_qdrant_collections_json_main"),a=document.getElementById("aipkit_semantic_search_embedding_model");if(s){if(n&&n.dataset.indexes)try{k=JSON.parse(n.dataset.indexes)||[]}catch(l){console.error("Error parsing Pinecone indexes JSON:",l)}if(d&&d.dataset.collections)try{o=JSON.parse(d.dataset.collections)||[]}catch(l){console.error("Error parsing Qdrant collections JSON:",l)}s&&(s.addEventListener("change",l=>{if(r(l.target.value),typeof window.aipkit_handleAutoSave=="function"){let p=document.getElementById("aipkit_semantic_search_target_id");p&&(p.value=""),window.aipkit_handleAutoSave()}}),r(s.value)),a&&(a.addEventListener("change",l=>{i(l.target)}),i(a)),t.setAttribute(c,"true")}}window.aipkit_initSemanticSearchUI=e})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_settings_container");if(!r)return;let i=r.querySelector("#aipkit_provider");if(!i)return;let e=i.value,t=e.toLowerCase(),c=r.querySelectorAll(".aipkit_api_key_field"),s=r.querySelectorAll(".aipkit_model_field"),n=r.querySelectorAll(".aipkit_advanced_settings_provider"),d=r.querySelector("#aipkit_safety_settings_accordion"),a=r.querySelector(".aipkit_openai_store_field"),l=r.querySelectorAll(".aipkit_param_not_openai");c.forEach(g=>g.style.display="none"),s.forEach(g=>g.style.display="none"),n.forEach(g=>g.style.display="none"),d&&(d.style.display="none"),a&&(a.style.display="none"),r.querySelectorAll(`.aipkit_api_key_field[data-provider="${e}"]`).forEach(g=>g.style.display="block"),r.querySelectorAll(`.aipkit_model_field[data-provider="${e}"]`).forEach(g=>g.style.display="block");let f=r.querySelector(`.aipkit_advanced_settings_provider[data-provider-setting="${e}"]`);f&&(f.style.display="block"),e==="Google"?d&&(d.style.display="block"):e==="OpenAI"&&a&&(a.style.display="block"),e==="OpenAI"||e==="Google"?l.forEach(g=>g.style.display="none"):l.forEach(g=>g.style.display="block"),typeof window.aipkit_refreshSettingsSelectPickers=="function"&&window.aipkit_refreshSettingsSelectPickers()}function o(){let r=document.getElementById("aipkit_provider");if(r){let i="data-provider-listener-attached";if(r.getAttribute(i)==="true")return;r.addEventListener("change",function(){k(),typeof window.aipkit_handleAutoSave=="function"?window.aipkit_handleAutoSave():console.warn("Provider Toggle: Autosave function not found.")}),r.setAttribute(i,"true"),k()}}window.aipkit_toggleProviderFields=k,window.aipkit_initProviderSelectListener=o})();(function(){"use strict";function k(n){let d=n?n.dataset:{};return{notSet:d.textNotSet||"Not set",notSelected:d.textNotSelected||"Not selected",statusSet:d.textSet||"Set",statusMissing:d.textMissing||"Missing",statusIncomplete:d.textIncomplete||"Incomplete",labelApiKey:d.labelApiKey||"API Key",labelApiKeyEndpoint:d.labelApiKeyEndpoint||"API Key & Endpoint",labelBaseUrl:d.labelBaseUrl||"Base URL"}}function o(n,d){let a=n.querySelector(d);return a?String(a.value||"").trim():""}function r(n,d){return d?n.querySelector(`.aipkit_model_field[data-provider="${d}"] select`):null}function i(n,d){if(!n)return d.notSelected;let a=String(n.value||"").trim();if(!a)return d.notSelected;let l=n.selectedOptions&&n.selectedOptions[0]?n.selectedOptions[0]:null;return(l?String(l.textContent||"").trim():a)||d.notSelected}function e(){let n=document.getElementById("aipkit_settings_container");if(!n)return;let d=n.querySelector("#aipkit_settings_summary_card");if(!d)return;let a=k(d),l=n.querySelector("#aipkit_provider"),p=l?l.value:"",_=l&&l.selectedOptions&&l.selectedOptions[0]?String(l.selectedOptions[0].textContent||"").trim():"",f=d.querySelector('[data-aipkit-summary="provider"]');f&&(f.textContent=_||a.notSet);let g=d.querySelector('[data-aipkit-summary="model"]');if(g){let q=r(n,p);g.textContent=i(q,a)}let m=d.querySelector('[data-aipkit-summary-label="connection"]'),u=d.querySelector('[data-aipkit-summary="connection-status"]'),h=a.labelApiKey,v=a.statusMissing,S="aipkit_status-warning";if(p==="Azure"){h=a.labelApiKeyEndpoint;let q=o(n,"#aipkit_azure_api_key"),y=o(n,"#aipkit_azure_endpoint");q&&y?(v=a.statusSet,S="aipkit_status-success"):v=a.statusIncomplete}else if(p==="Ollama")h=a.labelBaseUrl,o(n,"#aipkit_ollama_base_url")&&(v=a.statusSet,S="aipkit_status-success");else if(p){let y={OpenAI:"#aipkit_openai_api_key",OpenRouter:"#aipkit_openrouter_api_key",Google:"#aipkit_google_api_key",Claude:"#aipkit_claude_api_key",DeepSeek:"#aipkit_deepseek_api_key"}[p];y&&o(n,y)&&(v=a.statusSet,S="aipkit_status-success")}m&&(m.textContent=h),u&&(u.textContent=v,u.classList.remove("aipkit_status-success","aipkit_status-warning","aipkit_status-info"),u.classList.add(S))}function t(){let n=document.getElementById("aipkit_settings_container");if(!n||!n.querySelector("#aipkit_settings_summary_card"))return;let a="data-summary-listener-attached";if(n.getAttribute(a)!=="true"){let l="#aipkit_provider, .aipkit_model_field select, .aipkit_api_key_field input",p=_=>{_.target.matches(l)&&e()};n.addEventListener("change",p),n.addEventListener("input",p),n.setAttribute(a,"true")}e()}function c(){let n=document.getElementById("aipkit_settings_container");if(!n)return;let d=n.querySelector("#aipkit_settings_advanced_popover");if(!d)return;let a=n.querySelectorAll(".aipkit_settings_advanced_btn");if(!a.length)return;let l=d.querySelector(".aipkit_model_settings_popover_panel"),p=d.querySelector(".aipkit_model_settings_popover_close"),_=null,f=!1,g=S=>{if(!l||!S)return;let q=S.getBoundingClientRect(),y=l.getBoundingClientRect(),E=y.width||400,I=y.height||0,w=window.innerWidth,A=window.innerHeight,C=12,b=q.right+10;b+E>w-C&&(b=q.left-E-10),b=Math.max(C,Math.min(b,w-E-C));let x=q.top;x+I>A-C&&(x=A-I-C),x=Math.max(C,x),l.style.left=`${Math.round(b)}px`,l.style.top=`${Math.round(x)}px`},m=()=>{!_||!d.classList.contains("aipkit-active")||f||(f=!0,window.requestAnimationFrame(()=>{g(_),f=!1}))},u=S=>{S&&(_=S,d.classList.add("aipkit-active"),d.setAttribute("aria-hidden","false"),a.forEach(q=>{q.setAttribute("aria-expanded",q===S?"true":"false")}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_settings_advanced_popover"),window.requestAnimationFrame(()=>{g(S)}))},h=()=>{d.classList.remove("aipkit-active"),d.setAttribute("aria-hidden","true"),a.forEach(S=>{S.setAttribute("aria-expanded","false")}),_=null},v=S=>{S&&S.preventDefault();let q=S?S.currentTarget:null;if(d.classList.contains("aipkit-active")&&_===q){h();return}u(q)};a.forEach(S=>{S.dataset.popoverListenerAttached!=="true"&&(S.addEventListener("click",v),S.dataset.popoverListenerAttached="true")}),p&&p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",h),p.dataset.popoverListenerAttached="true"),d.dataset.overlayListenerAttached!=="true"&&(d.addEventListener("click",S=>{S.target===d&&h()}),d.dataset.overlayListenerAttached="true"),d.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",S=>{S.key==="Escape"&&d.classList.contains("aipkit-active")&&h()}),d.dataset.escapeListenerAttached="true"),d.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",m),window.addEventListener("scroll",m,!0),d.dataset.repositionListenersAttached="true")}function s(){typeof window.aipkit_initMessageCloseButtons=="function"?window.aipkit_initMessageCloseButtons("aipkit_settings_messages"):console.error("Settings Init: aipkit_initMessageCloseButtons not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_settings_container"):console.error("Settings Init: aipkit_attachRangeValueHandlers not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_settings_container"):console.error("Settings Init: aipkit_initApiKeyToggles not found."),typeof window.aipkit_initRestoreDefaultIcons=="function"?window.aipkit_initRestoreDefaultIcons("#aipkit_settings_container"):console.error("Settings Init: aipkit_initRestoreDefaultIcons not found."),typeof window.aipkit_initProviderSelectListener=="function"?window.aipkit_initProviderSelectListener():console.error("Settings Init: aipkit_initProviderSelectListener not found."),typeof window.aipkit_initSettingsSelectPickers=="function"?window.aipkit_initSettingsSelectPickers():console.error("Settings Init: aipkit_initSettingsSelectPickers not found."),c(),document.querySelectorAll("#aipkit_settings_container .aipkit_accordion-header").forEach(d=>{d.dataset.accordionListenerAttached!=="true"&&(d.addEventListener("click",function(){let a=this.nextElementSibling;if(a){this.classList.toggle("aipkit_active"),a.classList.toggle("aipkit_active");let l=this.closest(".aipkit_accordion");l?.id==="aipkit_safety_settings_accordion"&&document.getElementById("aipkit_provider")?.value==="Google"&&(l.style.display="block")}}),d.dataset.accordionListenerAttached="true")}),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("Settings Init: aipkit_initSyncButtons not found."),typeof window.aipkit_attachAutoSaveListeners=="function"?window.aipkit_attachAutoSaveListeners():console.error("Settings Init: aipkit_attachAutoSaveListeners not found."),typeof window.aipkit_loadTokenUsageChart=="function"?window.aipkit_loadTokenUsageChart():console.error("Settings Init: aipkit_loadTokenUsageChart function not found."),typeof window.aipkit_initEnhancerActionsUI=="function"?window.aipkit_initEnhancerActionsUI():console.error("Settings Init: aipkit_initEnhancerActionsUI not found."),typeof window.aipkit_initSemanticSearchUI=="function"?window.aipkit_initSemanticSearchUI():console.error("Settings Init: aipkit_initSemanticSearchUI not found."),t()}window.aipkit_initSettings=s,window.aipkit_updateSettingsSummary=e,window.aipkit_initSettingsSummary=t})();(function(){"use strict";let k=!1;function o(){let r=document.getElementById("aipkit_role_manager_container");if(!r){console.error("AIPKit Role Manager: Container #aipkit_role_manager_container not found, even on Role Manager page. Check view file.");return}let i=r.querySelector("#aipkit_save_roles_btn"),e=r.querySelector("#aipkit_role_manager_form"),t=r.querySelector("#aipkit_role_manager_messages");if(typeof window.aipkit_role_manager_config>"u"){console.error("AIPKit Role Manager Error: Configuration object (aipkit_role_manager_config) not found."),t&&(t.innerHTML='<div class="aipkit_settings_message aipkit_settings_message-error"><span class="dashicons dashicons-warning"></span> Error: Script configuration missing.</div>');return}let c=window.aipkit_role_manager_config,s=c.text||{};if(!i||!e||!t){console.warn("AIPKit Role Manager: Missing required elements (save button, form, or messages container).");return}let n="data-role-save-listener";i.getAttribute(n)||(i.addEventListener("click",function(d){if(d.preventDefault(),k)return;k=!0;let a=i.querySelector(".aipkit_btn-text"),l=i.querySelector(".aipkit_spinner");i.disabled=!0,l&&(l.style.display="inline-block"),a&&(a.textContent=s.saving||"Saving..."),t.innerHTML="",t.className="aipkit_settings_messages";let p=new FormData(e);p.append("action","aipkit_save_role_permissions"),fetch(c.ajaxurl,{method:"POST",body:p,credentials:"same-origin"}).then(_=>_.ok?_.json():_.json().then(f=>{throw new Error(f.data.message||`HTTP error! status: ${_.status}`)}).catch(()=>{throw new Error(`HTTP error! status: ${_.status}`)})).then(_=>{if(!_.success){let f=_.data&&_.data.message?_.data.message:"An unknown error occurred.";throw new Error(f)}return _.data}).then(_=>{let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-success",f.innerHTML=`<span class="dashicons dashicons-yes-alt"></span> ${_.message||s.success||"Permissions saved!"}`,t.appendChild(f),setTimeout(()=>{f.remove()},4e3)}).catch(_=>{console.error("AIPKit Role Manager Save Error:",_);let f=document.createElement("div");f.className="aipkit_settings_message aipkit_settings_message-error",f.innerHTML=`<span class="dashicons dashicons-warning"></span> ${_.message||s.fail||"Failed to save permissions."}`,t.appendChild(f),setTimeout(()=>{f.remove()},6e3)}).finally(()=>{k=!1,i.disabled=!1,l&&(l.style.display="none"),a&&(a.textContent=s.saveButton||"Save Permissions")})}),i.setAttribute(n,"true"))}document.addEventListener("DOMContentLoaded",function(){new URLSearchParams(window.location.search).get("page")==="aipkit-role-manager"&&o()}),window.aipkit_initRoleManager=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o){console.warn("AIPKit Chat Fields: Main content container (#aipkit_chatbot_main_tab_content_container) not found for delegation.");return}o.addEventListener("change",function(i){let e=i.target,t=e.closest(".aipkit_chatbot-settings-area");if(!t)return;if(e.matches(".aipkit_chatbot_provider_select")){window.aipkit_toggleChatbotModelFields(t),window.aipkit_toggleOpenAISpecificSettingsVisibility(t),window.aipkit_toggleGoogleSpecificSettingsVisibility(t),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(t);return}if(e.matches('select[name$="_model"]')||e.matches('select[name$="_deployment"]')){typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(t);return}let c=e.closest(".aipkit_stt_provider_select");if(c){let f=c.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f?window.aipkit_toggleSttModelFields(f):console.warn("AIPKit Chat Fields: Could not find parent settings area for STT provider select:",c);return}let s=e.closest(".aipkit_vector_store_toggle_switch");if(s){let f=s.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");if(f){window.aipkit_toggleVectorStoreSettingsVisibility(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f);let g=f.querySelector('.aipkit_feature_config_btn[data-feature="vector_store"]');g&&(g.disabled=!s.checked,g.title=s.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let n=e.closest(".aipkit_vector_store_provider_select");if(n){let f=n.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&(window.aipkit_toggleVectorStoreProviderFields(f),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(f));return}let d=e.closest(".aipkit_vector_embedding_provider_select");if(d){let f=d.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_populateVectorEmbeddingModelSelect(f);return}let a=e.closest(".aipkit_openai_web_search_enable_toggle");if(a){let f=a.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleOpenAIWebSearchSubSettings(f);let g=f.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');g&&(g.disabled=!a.checked)}return}let l=e.closest(".aipkit_openai_web_search_loc_type_select");if(l){let f=l.closest(".aipkit_chatbot-settings-area");f&&window.aipkit_toggleOpenAIWebSearchLocationDetails(f);return}let p=e.closest(".aipkit_google_search_grounding_enable_toggle");if(p){let f=p.closest(".aipkit_chatbot-settings-area");if(f){window.aipkit_toggleGoogleSearchGroundingSubSettings(f);let g=f.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');g&&(g.disabled=!p.checked)}return}let _=e.closest(".aipkit_google_grounding_mode_select");if(_){let f=_.closest(".aipkit_chatbot-settings-area, .aipkit_accordion-content");f&&window.aipkit_toggleGoogleGroundingDynamicThreshold(f);return}}),o.querySelectorAll(".aipkit_chatbot-settings-area").forEach(i=>{i.querySelector(".aipkit_chatbot_provider_select")&&(window.aipkit_toggleChatbotModelFields(i),window.aipkit_toggleOpenAISpecificSettingsVisibility(i),window.aipkit_toggleGoogleSpecificSettingsVisibility(i)),i.querySelector(".aipkit_stt_provider_select")&&window.aipkit_toggleSttModelFields(i),i.querySelector(".aipkit_vector_store_toggle_switch")&&(window.aipkit_toggleVectorStoreSettingsVisibility(i),typeof window.aipkit_toggleFileUploadAvailability=="function"&&window.aipkit_toggleFileUploadAvailability(i));let e=i.querySelector(".aipkit_openai_web_search_enable_toggle"),t=i.querySelector('.aipkit_feature_config_btn[data-feature="openai_web_search"]');t&&e&&(t.disabled=!e.checked,t.title=e.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure");let c=i.querySelector(".aipkit_google_search_grounding_enable_toggle"),s=i.querySelector('.aipkit_feature_config_btn[data-feature="google_search_grounding"]');s&&c&&(s.disabled=!c.checked,s.title=c.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")})}window.aipkit_initProviderSelectToggles=k})();(function(){"use strict";function k(o){if(!o){console.warn("AIPKit Chat Fields: No settings area provided to toggle model fields.");return}let r=o.querySelector(".aipkit_chatbot_provider_select");if(!r){console.warn("AIPKit Chat Fields: Provider select not found in the given settings area.");return}let i=r.value,e=["OpenAI","Google","Claude","OpenRouter","Azure","Ollama","DeepSeek"];o.querySelectorAll(".aipkit_chatbot_model_field").forEach(s=>{s.style.display="none";let n=s.querySelector(".aipkit_cb_web_search_toggle");n&&(n.style.display="none");let d=s.querySelector(".aipkit_cb_stateful_conv_toggle");d&&(d.style.display="none");let a=s.querySelector(".aipkit_cb_image_upload_toggle");a&&(a.style.display="none");let l=s.querySelector(".aipkit_cb_voice_input_toggle");l&&(l.style.display="none")});let c=o.querySelector(`.aipkit_chatbot_model_field[data-provider="${i}"]`);if(c){c.style.display="block";let s=o.querySelector("#aipkit_chatbot_global_save_status_container");if(s){let _=c.querySelector(".aipkit_model_status_slot");_&&!_.contains(s)&&_.appendChild(s)}o.querySelectorAll(".aipkit_feature_toggle_item").forEach(_=>{let f=(_.dataset.providers||"").trim();if(!f||f==="*"){_.style.display="";return}let g=f.split(/\s+/);_.style.display=g.includes(i)?"":"none"}),typeof window.aipkit_setInitialStreamToggleState=="function"&&window.aipkit_setInitialStreamToggleState(o),typeof window.aipkit_setInitialStatefulConvState=="function"&&window.aipkit_setInitialStatefulConvState(o);let d=c.querySelector(".aipkit_cb_web_search_toggle");d&&(d.dataset.provider||"").split(" ").includes(i)&&(d.style.display="inline-flex",typeof window.aipkit_setInitialWebSearchToggleState=="function"&&window.aipkit_setInitialWebSearchToggleState(o));let a=c.querySelector(".aipkit_cb_stateful_conv_toggle");a&&i==="OpenAI"&&(a.style.display="inline-flex");let l=c.querySelector(".aipkit_cb_image_upload_toggle");l&&(i==="OpenAI"||i==="Claude"?(l.style.display="inline-flex",typeof window.aipkit_setInitialImageUploadToggleState=="function"&&window.aipkit_setInitialImageUploadToggleState(o)):l.style.display="none");let p=c.querySelector(".aipkit_cb_voice_input_toggle");p&&(p.style.display="inline-flex",typeof window.aipkit_setInitialVoiceInputToggleState=="function"&&window.aipkit_setInitialVoiceInputToggleState(o)),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(o)}}window.aipkit_toggleChatbotModelFields=k})();(function(){"use strict";function k(o){o&&typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(o)}window.aipkit_toggleOpenAISpecificSettingsVisibility=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=r?.value==="OpenAI",e=o.querySelector(".aipkit_openai_web_search_enable_toggle");e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let t=o.querySelector(".aipkit_openai_web_search_conditional_settings");if(!e||!t)return;let c=e.tagName==="SELECT"?e.value==="1":e.checked;if(t.style.display=i&&c?"block":"none",i&&c)typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(o);else{let s=o.querySelector(".aipkit_openai_web_search_location_details");s&&(s.style.display="none")}}window.aipkit_toggleOpenAIWebSearchSubSettings=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_openai_web_search_enable_toggle");r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_openai_web_search_enable_toggle")),r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_openai_web_search_enable_toggle"));let i=o.querySelector(".aipkit_openai_web_search_loc_type_select"),e=o.querySelector(".aipkit_openai_web_search_location_details");if(!i||!e){e&&(e.style.display="none");return}let t=r?r.tagName==="SELECT"?r.value==="1":r.checked:!1,c=(i.value||"")==="approximate";e.style.display=t&&c?"block":"none"}window.aipkit_toggleOpenAIWebSearchLocationDetails=k})();(function(){"use strict";function k(o){o&&typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(o)}window.aipkit_toggleGoogleSpecificSettingsVisibility=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_chatbot_provider_select");r||(r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let i=r?.value==="Google",e=o.querySelector(".aipkit_google_search_grounding_enable_toggle");e||(e=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),e||(e=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let t=o.querySelector(".aipkit_google_search_grounding_conditional_settings");if(!e||!t)return;let c=e.tagName==="SELECT"?e.value==="1":e.checked,s=i&&c;t.style.display=s?"block":"none",s?typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(o):typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(o,!1)}window.aipkit_toggleGoogleSearchGroundingSubSettings=k})();(function(){"use strict";function k(o,r=null){if(!o)return;let i=o.querySelector(".aipkit_google_grounding_mode_select"),e=o.querySelector(".aipkit_google_grounding_dynamic_threshold_container"),t=o.querySelector(".aipkit_google_search_grounding_enable_toggle");t||(t=document.querySelector("#aipkit_model_settings_popover .aipkit_google_search_grounding_enable_toggle")),t||(t=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_google_search_grounding_enable_toggle"));let c=o.querySelector(".aipkit_google_search_grounding_conditional_settings"),s=c&&c.style.display==="none";if(!i||!e||!t){e&&(e.style.display="none");return}if(s){e.style.display="none";return}let n=r!==null?r:(t.tagName==="SELECT"?t.value==="1":t.checked)&&i.value==="MODE_DYNAMIC";e.style.display=n?"block":"none"}window.aipkit_toggleGoogleGroundingDynamicThreshold=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_stt_provider_select");if(!r)return;let i=r.value;o.querySelectorAll(".aipkit_stt_model_field").forEach(t=>{t.style.display=t.getAttribute("data-stt-provider")===i?"block":"none"})}window.aipkit_toggleSttModelFields=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_toggle_switch");r||(r=o.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let i=o.querySelector(".aipkit_vector_store_settings_conditional_row"),e=o.querySelector(".aipkit_vector_store_top_k_field"),t=o.querySelector(".aipkit_vector_store_confidence_field");if(!r||!i)return;let c=r.tagName==="SELECT"?r.value==="1":r.checked;i.style.display=c?"block":"none",e&&(e.style.display=c?"block":"none"),t&&(t.style.display=c?"block":"none"),c?typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(o):o.querySelectorAll(".aipkit_vector_store_openai_field, .aipkit_vector_store_pinecone_field, .aipkit_vector_store_pinecone_key_field, .aipkit_vector_store_qdrant_field, .aipkit_vector_store_qdrant_url_field, .aipkit_vector_store_qdrant_key_field, .aipkit_vector_store_embedding_config_row").forEach(s=>s.style.display="none")}window.aipkit_toggleVectorStoreSettingsVisibility=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_provider_select"),i=o.querySelector(".aipkit_vector_store_toggle_switch");if(i||(i=o.querySelector(".aipkit_vector_store_enable_select")),i||(i=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select")),!r||!i)return;let e=o.querySelector(".aipkit_chatbot_provider_select"),t=e?e.value:"",c=Array.from(r.options||[]).find(v=>v&&v.value==="claude_files");if(c&&(c.disabled=t!=="Claude",c.disabled&&r.value==="claude_files")){let v=Array.from(r.options||[]).find(S=>S&&S.value&&!S.disabled&&S.value!=="claude_files");if(v&&r.value!==v.value){r.value=v.value,r.dispatchEvent(new Event("change",{bubbles:!0}));return}}let s=r.value,n=i.tagName==="SELECT"?i.value==="1":i.checked,d=o.querySelector(".aipkit_vector_store_openai_field"),a=o.querySelector(".aipkit_vector_store_pinecone_field"),l=o.querySelector(".aipkit_vector_store_pinecone_key_field"),p=o.querySelector(".aipkit_vector_store_qdrant_field"),_=o.querySelector(".aipkit_vector_store_qdrant_url_field"),f=o.querySelector(".aipkit_vector_store_qdrant_key_field"),g=o.querySelector(".aipkit_vector_store_embedding_config_row"),m=o.querySelector(".aipkit_vector_store_top_k_field"),u=o.querySelector(".aipkit_vector_store_confidence_field"),h=["openai","pinecone","qdrant"].includes(s);d&&(d.style.display=n&&s==="openai"?"block":"none"),a&&(a.style.display=n&&s==="pinecone"?"block":"none"),l&&(l.style.display=n&&s==="pinecone"?"block":"none"),p&&(p.style.display=n&&s==="qdrant"?"block":"none"),_&&(_.style.display=n&&s==="qdrant"?"block":"none"),f&&(f.style.display=n&&s==="qdrant"?"block":"none"),g&&(g.style.display=n&&(s==="pinecone"||s==="qdrant")?"block":"none"),m&&(m.style.display=n&&h?"block":"none"),u&&(u.style.display=n&&h?"block":"none"),n&&s==="openai"?typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"&&window.aipkit_populateOpenAIVectorStoresMultiSelect(o):n&&(s==="pinecone"||s==="qdrant")&&(s==="pinecone"&&typeof window.aipkit_populatePineconeIndexSelect=="function"&&window.aipkit_populatePineconeIndexSelect(o),s==="qdrant"&&typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"&&window.aipkit_populateQdrantCollectionsMultiSelect(o),typeof window.aipkit_populateVectorEmbeddingProviderSelect=="function"&&window.aipkit_populateVectorEmbeddingProviderSelect(o),typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(o))}window.aipkit_toggleVectorStoreProviderFields=k})();(function(){"use strict";function k(o){let r=o.querySelector('select[name="openai_vector_store_ids[]"]'),i=window.aipkit_escapeHtml||function(h){return h};if(!r)return;let e=o.querySelector("[data-aipkit-vector-stores-dropdown]"),t=e?e.querySelector(".aipkit_popover_multiselect_btn"):null,c=e?e.querySelector(".aipkit_popover_multiselect_label"):null,s=e?e.querySelector(".aipkit_popover_multiselect_panel"):null,n=e?e.querySelector(".aipkit_popover_multiselect_options"):null,d=e?.dataset.placeholder||"Select stores",a=e?.dataset.selectedLabel||"selected",l=window.aipkit_chat_config?.openaiVectorStores||[],p=Array.from(r.options).filter(h=>h.selected).map(h=>h.value);if(r.innerHTML="",l.length>0){let h=1;l.forEach(v=>{if(v&&v.id){let S="(Files: N/A)";v.file_counts&&typeof v.file_counts.total=="number"?S=`(${v.file_counts.total} ${v.file_counts.total===1?"File":"Files"})`:v.file_counts&&(S="(Files: ?)");let q=v.name||`Untitled store ${h}`,y=`${i(q)} ${S}`,E=document.createElement("option");E.value=v.id,E.textContent=y,p.includes(v.id)&&(E.selected=!0),r.appendChild(E),h+=1}})}let _=1;p.forEach(h=>{if(!l.some(S=>S.id===h)&&!r.querySelector(`option[value="${CSS.escape(h)}"]`)){let S=document.createElement("option");S.value=h,S.textContent=`Manual store ${_} (not synced)`,S.selected=!0,r.appendChild(S),_+=1}}),r.options.length===0&&(r.innerHTML='<option value="" disabled>-- No Stores Found (Sync in AI Training) --</option>');let f=()=>{if(!c)return;let h=Array.from(r.options).filter(S=>S.selected&&S.value);if(!h.length){c.textContent=d;return}let v=h.map(S=>S.textContent.trim()).filter(Boolean);if(v.length<=2){c.textContent=v.join(", ");return}c.textContent=`${v.length} ${a}`},g=()=>{if(!n)return;let h=Array.from(n.querySelectorAll('input[type="checkbox"]:checked'));if(h.length>2){let S=h[h.length-1];S&&(S.checked=!1)}let v=Array.from(n.querySelectorAll('input[type="checkbox"]:checked')).map(S=>S.value);Array.from(r.options).forEach(S=>{S.selected=v.includes(S.value)}),r.dispatchEvent(new Event("change",{bubbles:!0})),f()},m=()=>{if(!n)return;n.innerHTML="";let h=Array.from(r.options),v=h.filter(S=>S.value);if(!v.length){let S=document.createElement("div");S.className="aipkit_popover_multiselect_empty",S.textContent=h[0]?.textContent||"-- No Stores Found --",n.appendChild(S),f();return}v.forEach(S=>{let q=document.createElement("label");q.className="aipkit_popover_multiselect_item";let y=document.createElement("input");y.type="checkbox",y.value=S.value,y.checked=S.selected,y.disabled=S.disabled;let E=document.createElement("span");E.className="aipkit_popover_multiselect_text",E.textContent=S.textContent,q.appendChild(y),q.appendChild(E),n.appendChild(q)}),f()},u=h=>{!e||!t||(e.classList.toggle("is-open",h),t.setAttribute("aria-expanded",h?"true":"false"),s&&(s.hidden=!h))};e&&t&&!e.dataset.listenerAttached&&(t.addEventListener("click",h=>{h.preventDefault(),u(!e.classList.contains("is-open"))}),document.addEventListener("click",h=>{e.classList.contains("is-open")&&(e.contains(h.target)||u(!1))}),t.addEventListener("keydown",h=>{h.key==="Escape"&&u(!1)}),e.dataset.listenerAttached="true"),n&&!n.dataset.listenerAttached&&(n.addEventListener("change",g),n.dataset.listenerAttached="true"),m()}window.aipkit_populateOpenAIVectorStoresMultiSelect=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector('select[name="qdrant_collection_names[]"]');if(!r)return;let i=o.querySelector("[data-aipkit-qdrant-collections-dropdown]"),e=i?i.querySelector(".aipkit_popover_multiselect_btn"):null,t=i?i.querySelector(".aipkit_popover_multiselect_label"):null,c=i?i.querySelector(".aipkit_popover_multiselect_panel"):null,s=i?i.querySelector(".aipkit_popover_multiselect_options"):null;if(!i||!s)return;let n=i.dataset.placeholder||"Select collections",d=i.dataset.selectedLabel||"selected",a=()=>{if(!t)return;let f=Array.from(r.options).filter(m=>m.selected&&m.value);if(!f.length){t.textContent=n;return}let g=f.map(m=>m.textContent.trim()).filter(Boolean);if(g.length<=2){t.textContent=g.join(", ");return}t.textContent=`${g.length} ${d}`},l=()=>{let f=Array.from(s.querySelectorAll('input[type="checkbox"]:checked')).map(g=>g.value);Array.from(r.options).forEach(g=>{g.selected=f.includes(g.value)}),r.dispatchEvent(new Event("change",{bubbles:!0})),a()},p=()=>{s.innerHTML="";let f=Array.from(r.options),g=f.filter(m=>m.value);if(!g.length){let m=document.createElement("div");m.className="aipkit_popover_multiselect_empty",m.textContent=f[0]?.textContent||"-- No Collections Found --",s.appendChild(m),a();return}g.forEach(m=>{let u=document.createElement("label");u.className="aipkit_popover_multiselect_item";let h=document.createElement("input");h.type="checkbox",h.value=m.value,h.checked=m.selected,h.disabled=m.disabled;let v=document.createElement("span");v.className="aipkit_popover_multiselect_text",v.textContent=m.textContent,u.appendChild(h),u.appendChild(v),s.appendChild(u)}),a()},_=f=>{!i||!e||(i.classList.toggle("is-open",f),e.setAttribute("aria-expanded",f?"true":"false"),c&&(c.hidden=!f))};i&&e&&!i.dataset.listenerAttached&&(e.addEventListener("click",f=>{f.preventDefault(),_(!i.classList.contains("is-open"))}),document.addEventListener("click",f=>{i.classList.contains("is-open")&&(i.contains(f.target)||_(!1))}),e.addEventListener("keydown",f=>{f.key==="Escape"&&_(!1)}),i.dataset.listenerAttached="true"),s&&!s.dataset.listenerAttached&&(s.addEventListener("change",l),s.dataset.listenerAttached="true"),p()}window.aipkit_populateQdrantCollectionsMultiSelect=k})();(function(){"use strict";function k(o){let r=o.querySelector('select[name="pinecone_index_name"]'),i=window.aipkit_escapeHtml||function(c){return c};if(!r)return;let e=window.aipkit_chat_config?.pineconeIndexes||[],t=r.value;if(r.innerHTML="",r.appendChild(new Option(i("-- Select Index --"),"")),e.length>0&&e.forEach(c=>{let s=c.name||c.id||"",n=c.name||s,d=c.total_vector_count!==void 0&&c.total_vector_count!==null&&c.total_vector_count!=="Error"&&c.total_vector_count!=="No Host"?` (Vectors: ${Number(c.total_vector_count).toLocaleString()})`:(c.total_vector_count||"")==="Error"||(c.total_vector_count||"")==="No Host"?" (Stats Err)":" (Vectors: ?)",a=i(n+d),l=new Option(a,s);s===t&&(l.selected=!0),r.appendChild(l)}),t&&!r.querySelector(`option[value="${CSS.escape(t)}"]`)){let c=new Option(i(t)+" (Manual/Not Synced)",t,!1,!0);r.appendChild(c),r.value=t}r.options.length<=1&&(r.innerHTML='<option value="" disabled>-- No Indexes Found (Sync in AI Settings) --</option>')}window.aipkit_populatePineconeIndexSelect=k})();(function(){"use strict";function k(o){let r=o.querySelector('select[name="vector_embedding_provider"]');r&&(r.value===""&&(r.value="openai"),r.dispatchEvent(new Event("change")))}window.aipkit_populateVectorEmbeddingProviderSelect=k})();(function(){"use strict";function k(o){let r=o.querySelector('select[name="vector_embedding_provider"]'),i=o.querySelector('select[name="vector_embedding_model"]'),e=window.aipkit_escapeHtml||function(n){return n};if(!r||!i)return;let t=r.value,c=i.value;i.innerHTML="",i.appendChild(new Option(e("-- Select Model --"),""));let s=[];if(t==="openai"&&window.aipkit_chat_config?.openaiEmbeddingModels?s=window.aipkit_chat_config.openaiEmbeddingModels:t==="google"&&window.aipkit_chat_config?.googleEmbeddingModels?s=window.aipkit_chat_config.googleEmbeddingModels:t==="openrouter"&&window.aipkit_chat_config?.openrouterEmbeddingModels?s=window.aipkit_chat_config.openrouterEmbeddingModels:t==="azure"&&window.aipkit_chat_config?.azureEmbeddingModels&&(s=window.aipkit_chat_config.azureEmbeddingModels),s.length>0&&s.forEach(n=>{if(n&&n.id){let d=new Option(e(n.name||n.id),n.id);n.id===c&&(d.selected=!0),i.appendChild(d)}}),c&&!i.querySelector(`option[value="${CSS.escape(c)}"]`)){let n=new Option(e(c)+" (Manual/Not Synced)",c,!1,!0);i.appendChild(n),i.value=c}i.options.length<=1&&(i.innerHTML='<option value="" disabled>-- Select Provider or Sync Models --</option>')}window.aipkit_populateVectorEmbeddingModelSelect=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector(".aipkit_vector_store_toggle_switch");r||(r=o.querySelector(".aipkit_vector_store_enable_select")),r||(r=document.querySelector("#aipkit_model_settings_popover .aipkit_vector_store_enable_select"));let i=o.querySelector('input[name="enable_file_upload"].aipkit_file_upload_toggle_switch'),e=o.querySelector(".aipkit_vector_store_provider_select"),t=o.querySelector(".aipkit_chatbot_provider_select"),c=o.querySelector(".aipkit_file_upload_field_group");if(!r||!i||!c)return;let s=r.tagName==="SELECT"?r.value==="1":r.checked,n=i.dataset.isProPlan==="true",d=e?e.value:"",a=t?t.value:"",l=d==="claude_files",p=a==="Claude";if(e){let m=Array.from(e.options||[]).find(u=>u&&u.value==="claude_files");m&&(m.disabled=!p)}if(l&&!p&&e){let m=Array.from(e.options||[]).find(h=>h&&h.value&&h.value!=="claude_files"),u=m?m.value:"openai";if(e.value!==u){e.value=u,e.dispatchEvent(new Event("change",{bubbles:!0}));return}}let f=n&&s&&(!l||p),g="";n?l&&!p?g='Claude Files requires the chatbot "Provider" to be set to Claude.':s||(g='File upload requires "Enable Vector Store" to be active for this bot.'):g="File upload is a paid feature. Please upgrade.",f?(i.disabled=!1,c.classList.remove("aipkit_dimmed_row"),c.style&&(c.style.opacity=""),c.removeAttribute("title")):(i.checked&&(i.checked=!1,i.dispatchEvent(new Event("change",{bubbles:!0}))),i.disabled=!0,c.classList.add("aipkit_dimmed_row"),c.style&&c.style.opacity&&(c.style.opacity=""),c.setAttribute("title",g))}window.aipkit_toggleFileUploadAvailability=k})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelector('select[name="theme"]'),e=r.querySelector('input[name="theme"]:checked'),t=()=>i?i.value:e?e.value:"",c=r.querySelector(".aipkit_custom_theme_config_btn, .aipkit_open_custom_theme_modal_btn"),s=t()==="custom";c&&(c.style.display=s?"inline-flex":"none")}function o(){let r=document.querySelector(".aipkit_chatbot_module_container")||document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Theme Toggle: Module container not found.");return}r.dataset.themeSettingsListenerAttached||(r.addEventListener("click",function(i){i.target.closest(".aipkit_reset_custom_theme_btn")&&(typeof window.aipkit_handleResetCustomTheme=="function"?window.aipkit_handleResetCustomTheme(i):console.error("AIPKit Theme Toggle: aipkit_handleResetCustomTheme function not found."))}),r.addEventListener("change",function(i){let e=i.target;if(e.matches&&e.matches('select[name="theme"]')||e.matches&&e.matches('input[name="theme"]')){let t=e.closest('.aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]')||e.closest(".aipkit_chatbot-settings-area")||r;if(t){k(t);let c=t.querySelector(".aipkit_open_custom_theme_modal_btn");if(c&&e.value==="custom"&&typeof window.aipkit_openChatbotSettingsModalById=="function"){let s=c.getAttribute("data-modal-target");s&&window.aipkit_openChatbotSettingsModalById(s)}}}}),r.dataset.themeSettingsListenerAttached="true"),document.documentElement.dataset.aipkitResetListenerAttached||(document.addEventListener("click",function(i){i.target.closest(".aipkit_chatbot_settings_modal .aipkit_reset_custom_theme_btn")&&typeof window.aipkit_handleResetCustomTheme=="function"&&window.aipkit_handleResetCustomTheme(i)}),document.documentElement.dataset.aipkitResetListenerAttached="true"),r.querySelectorAll('.aipkit_chatbot-settings-area, .aipkit_model_settings_panel[data-aipkit-settings-panel="appearance"]').forEach(i=>{k(i)})}window.aipkit_initChatThemeSettingsToggle=o})();(function(){"use strict";function k(o){let r=o.target.closest(".aipkit_reset_custom_theme_btn");if(!r)return;let i=r.dataset.botId,e=document.getElementById("aipkit_chatbot_main_tab_content_container"),t=document.getElementById(`aipkit_bot_${i}_custom_theme_settings_container`)||(e?e.querySelector(`#aipkit_bot_${i}_custom_theme_settings_container`):null),c=document.getElementById(`aipkit_reset_theme_status_${i}`)||(e?e.querySelector(`#aipkit_reset_theme_status_${i}`):null);if(!t||!c){console.error("AIPKit Theme Reset: Could not find theme settings container or status span for bot",i);return}let s=t.dataset.defaults;if(!s){console.error("AIPKit Theme Reset: No default values found in data-defaults attribute."),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"error","Error: Defaults not found.",2e3);return}try{let n=JSON.parse(s);t.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(a=>{let p=a.getAttribute("name").match(/custom_theme_settings\[(.*?)\]/);if(p&&p[1]){let _=p[1];if(Object.prototype.hasOwnProperty.call(n,_)){a.type==="checkbox"?a.checked=String(n[_])==="1":a.value=n[_]!==null?String(n[_]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});a.dispatchEvent(f)}else if(Object.prototype.hasOwnProperty.call(n,_+"_placeholder")){a.type==="checkbox"?a.checked=String(n[_+"_placeholder"])==="1":a.value=n[_+"_placeholder"]!==null?String(n[_+"_placeholder"]):"";let f=new Event("change",{bubbles:!0,cancelable:!0});a.dispatchEvent(f)}}}),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"success","\u2714 Reverted.",2e3)}catch(n){console.error("AIPKit Theme Reset: Error parsing default values JSON or applying defaults.",n),typeof window.aipkit_showTemporaryMessage=="function"&&window.aipkit_showTemporaryMessage(c,"error","Error resetting.",2e3)}}window.aipkit_handleResetCustomTheme=k})();(function(){"use strict";function k(s){let n=new Event("input",{bubbles:!0,cancelable:!0}),d=new Event("change",{bubbles:!0,cancelable:!0});s.dispatchEvent(n),s.dispatchEvent(d)}function o(s,n,d){let a=s.querySelector(`input[name="custom_theme_settings[${n}]"], select[name="custom_theme_settings[${n}]"]`);if(a){if(a.type==="checkbox"){let l=d==="1";a.checked!==l&&(a.checked=l,k(a));return}a.value!==d&&(a.value=d,k(a))}}function r(s){let n=s.closest(".aipkit_chatbot_settings_form");if(!n)return;let d=n.querySelector('input[name="theme"][value="custom"]');d&&!d.checked&&(d.checked=!0,k(d))}function i(s){let n=s.closest(".aipkit_custom_theme_settings_container");if(n)return n;let d=s.dataset.botId||s.closest("[data-bot-id]")?.dataset.botId;return d?document.getElementById(`aipkit_bot_${d}_custom_theme_settings_container`):null}function e(s){let n=s.closest(".aipkit_custom_theme_presets");n&&n.querySelectorAll(".aipkit_custom_theme_preset").forEach(d=>{let a=d===s;d.classList.toggle("is-selected",a),d.setAttribute("aria-pressed",a?"true":"false")})}function t(s){let n=s.dataset.primary,d=s.dataset.secondary;if(!n||!d)return;let a=i(s);a&&(r(s),o(a,"primary_color",n),o(a,"secondary_color",d),o(a,"auto_text_contrast","1"),e(s))}function c(){document.documentElement.dataset.aipkitCustomThemePresetsBound||(document.addEventListener("click",s=>{let n=s.target.closest(".aipkit_custom_theme_preset");n&&(s.preventDefault(),t(n))}),document.documentElement.dataset.aipkitCustomThemePresetsBound="1")}window.aipkit_initCustomThemePresets=c})();(function(){"use strict";let k=".aipkit_builder_theme_row_content",o=".aipkit_builder_theme_row",r=".aipkit_theme_scroll_btn",i=".aipkit_theme_scroll_btn--prev",e=".aipkit_theme_scroll_btn--next";function t(p){let _=p.closest(o);return _?{row:_,prev:_.querySelector(i),next:_.querySelector(e)}:null}function c(p){return Math.max(180,Math.round(p.clientWidth*.75))}function s(p){let _=t(p);if(!_||!_.prev||!_.next)return;let f=Math.max(0,p.scrollWidth-p.clientWidth),g=p.scrollLeft<=1,m=p.scrollLeft>=f-1;_.prev.disabled=f===0||g,_.next.disabled=f===0||m}function n(p){let _=p.target.closest(r);if(!_||_.disabled)return;let f=_.closest(o),g=f?f.querySelector(k):null;if(!g)return;let m=_.classList.contains("aipkit_theme_scroll_btn--next")?1:-1;g.scrollBy({left:m*c(g),behavior:"smooth"})}function d(p){let _=p.target;!(_ instanceof HTMLElement)||!_.matches(k)||s(_)}function a(){document.querySelectorAll(k).forEach(p=>{s(p)})}function l(p){let _=document.documentElement;_.dataset.aipkitThemeRowScrollBound||(document.addEventListener("click",n),document.addEventListener("scroll",d,!0),window.addEventListener("resize",a),_.dataset.aipkitThemeRowScrollBound="1"),p&&a()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>l(!0)):l(!0),window.aipkit_initThemeRowScroll=function(){l(!0)}})();(function(){"use strict";function k(t){if(!t)return;let c=t.querySelector(".aipkit_chatbot_provider_select");c||(c=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_provider_select"));let s=t.querySelector('.aipkit_chatbot_model_field[data-provider="OpenAI"] select');s||(s=document.querySelector('#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active .aipkit_chatbot_settings_form .aipkit_chatbot_model_field[data-provider="OpenAI"] select'));let n=t.querySelector(".aipkit_reasoning_effort_field"),d=n?n.querySelector(".aipkit_reasoning_effort_slider"):null,a=n?n.querySelector('input[name="reasoning_effort"]'):null,l=n?n.querySelector(".aipkit_reasoning_effort_label"):null,p=null;if(n?p=n.closest('section[data-section="reasoning"], .aipkit_reasoning_section'):p=t.querySelector(".aipkit_reasoning_section"),!n)return;let _=n.querySelector('select[name="reasoning_effort"]'),f=()=>{n.classList.add("aipkit_hidden"),p&&p.classList.add("aipkit_hidden"),_&&(_.disabled=!0),n.style.opacity="",n.removeAttribute("title")},g=()=>{n.classList.remove("aipkit_hidden"),p&&p.classList.remove("aipkit_hidden"),_&&(_.disabled=!1),n.style.opacity="",n.removeAttribute("title")};if(!c||!s){f();return}let m=(c.value||"").toLowerCase(),h=(s.value||"").toLowerCase(),v=h.startsWith("o1")||h.startsWith("o3")||h.startsWith("o4"),S=h.includes("gpt-5");m==="openai"&&(v||S)?(g(),o(d,a,l,h)):f()}function o(t,c,s,n){if(!t||!c)return;let d=r(n),a=d.allowed,l=a.map(f=>f==="medium"?"med":f);t.dataset.reasoningValues=JSON.stringify(a),t.dataset.reasoningLabels=JSON.stringify(l),t.max=String(Math.max(0,a.length-1));let p=c.value||"";p==="minimal"&&(p="low"),a.includes(p)||(p=d.defaultValue),a.includes(p)||(p=a[0]||""),p&&(c.value=p);let _=Math.max(0,a.indexOf(p));t.value=String(_),s&&(s.textContent=l[_]||l[0]||""),t.dispatchEvent(new Event("input",{bubbles:!0}))}function r(t){return e(t)?{allowed:["high"],defaultValue:"high"}:t.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(t)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(t){let c=t.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let s=t.match(/gpt-(\d+)/);return s?Number.parseInt(s[1],10)>=6:!1}function e(t){return/gpt-5(\.\d+)?-pro/.test(t)}window.aipkit_toggleReasoningEffort=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(E){return E},o="#aipkit_chatbot_builder_bot_select, #aipkit_sources_provider_filter, #aipkit_sources_index_filter, .aipkit_vector_store_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_provider_select, .aipkit_builder_ai_model .aipkit_chatbot_model_field select",r=null,i=null,e=!1,t=E=>!!(E&&(E.classList.contains("aipkit_chatbot_provider_select")||E.classList.contains("aipkit_vector_store_provider_select")||E.id==="aipkit_sources_provider_filter")),c=E=>!!(E&&E.id==="aipkit_chatbot_builder_bot_select"),s=E=>{let I=String(E||"").trim().toLowerCase();return I==="claude_files"?"claude":I},n=(E,I)=>{if(!E)return;let w="aipkit_settings_select_picker_icon--";E.classList.forEach(C=>{C.startsWith(w)&&E.classList.remove(C)}),E.classList.remove("is-hidden");let A=s(I);if(!A){E.classList.add("is-hidden");return}E.classList.add(`${w}${A}`)},d=E=>{if(!E)return"";let I=E.getAttribute("data-aipkit-picker-title");if(I)return I;let w=E.id&&document.querySelector(`label[for="${E.id}"]`)||E.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return w?w.textContent.trim():""},a=E=>{if(!E)return"";let I=E.selectedOptions&&E.selectedOptions.length?E.selectedOptions[0]:E.querySelector("option[selected]");if(I)return I.textContent.trim();let w=E.querySelector("option");return w?w.textContent.trim():""},l=E=>({buttonId:`${E}_picker_btn`,labelId:`${E}_picker_label`,popoverId:`${E}_picker_popover`,titleId:`${E}_picker_title`,searchId:`${E}_picker_search`,listId:`${E}_picker_list`}),p=E=>{if(!E||!E.id)return null;let I=l(E.id),w=E.closest(".aipkit_chatbot_builder");if(!w)return null;let A=document.getElementById(I.buttonId);if(!A){if(A=document.createElement("button"),A.type="button",A.id=I.buttonId,A.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",A.setAttribute("data-aipkit-popover-target",I.popoverId),A.setAttribute("aria-controls",I.popoverId),A.setAttribute("aria-expanded","false"),A.dataset.aipkitPopoverPlacement="bottom",t(E)){A.classList.add("aipkit_settings_select_picker_btn--provider");let T=document.createElement("span");T.className="aipkit_settings_select_picker_icon",T.setAttribute("aria-hidden","true"),n(T,E.value),A.appendChild(T)}let b=document.createElement("span");b.className="aipkit_settings_select_picker_label",b.id=I.labelId,b.textContent=a(E)||k("Select","gpt3-ai-content-generator");let x=document.createElement("span");x.className="dashicons dashicons-arrow-down-alt2",x.setAttribute("aria-hidden","true"),A.appendChild(b),A.appendChild(x),E.insertAdjacentElement("beforebegin",A)}E.classList.contains("screen-reader-text")||E.classList.add("screen-reader-text");let C=document.getElementById(I.popoverId);if(!C){C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",t(E)&&C.classList.add("aipkit_settings_select_picker_popover--provider"),C.id=I.popoverId,C.setAttribute("aria-hidden","true");let b=document.createElement("div");b.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",b.setAttribute("role","dialog"),b.setAttribute("aria-labelledby",I.titleId);let x=document.createElement("div");x.className="aipkit_model_settings_popover_header";let T=document.createElement("span");T.className="aipkit_model_settings_popover_title",T.id=I.titleId,T.textContent=d(E)||k("Select","gpt3-ai-content-generator");let P=document.createElement("button");P.type="button",P.className="aipkit_model_settings_popover_close",P.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),P.innerHTML='<span class="dashicons dashicons-no-alt"></span>',x.appendChild(T),x.appendChild(P);let H=document.createElement("div");H.className="aipkit_model_settings_popover_body";let O=document.createElement("div");O.className="aipkit_settings_select_picker_search";let F=document.createElement("input");F.type="search",F.id=I.searchId,F.className="aipkit_form-input";let M=d(E),B=M?`Search ${M.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");F.setAttribute("placeholder",B),O.appendChild(F);let V=document.createElement("div");V.className="aipkit_settings_select_picker_list",V.id=I.listId,V.setAttribute("role","listbox"),H.appendChild(O),H.appendChild(V),b.appendChild(x),b.appendChild(H),C.appendChild(b),w.appendChild(C),(t(E)||c(E))&&(O.style.display="none")}return{ids:I,button:A,popover:C,label:document.getElementById(I.labelId),search:document.getElementById(I.searchId),list:document.getElementById(I.listId)}},_=E=>{let I=[];return E&&Array.from(E.children).forEach(A=>{if(A.tagName==="OPTGROUP"){let C=Array.from(A.children).filter(b=>b.tagName==="OPTION").map(b=>({value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}));I.push({groupLabel:A.label||"",options:C})}else A.tagName==="OPTION"&&I.push({groupLabel:"",options:[{value:A.value,label:A.textContent.trim(),disabled:A.disabled,selected:A.selected}]})}),I},f=(E,I,w="")=>{if(!E||!I)return;let A=w.trim().toLowerCase();if(I.innerHTML="",c(E)){let x=Array.from(E.options).map(M=>({value:M.value,label:M.textContent.trim(),disabled:M.disabled,selected:M.selected})),T=M=>M.disabled&&M.value===""&&/^-+$/.test(M.label.replace(/\s+/g,"")),P=x.filter(M=>M.value==="__new__"),H=x.filter(M=>M.value!=="__new__"&&!T(M)),O=A?H.filter(M=>M.label.toLowerCase().includes(A)):H,F=M=>{let B=document.createElement("button");B.type="button",B.className="aipkit_settings_select_picker_item",B.setAttribute("role","option"),B.dataset.value=M.value,B.dataset.label=M.label,M.disabled&&(B.classList.add("is-disabled"),B.setAttribute("aria-disabled","true")),E.value===M.value?(B.classList.add("is-active"),B.setAttribute("aria-selected","true")):B.setAttribute("aria-selected","false");let V=document.createElement("span");V.className="aipkit_settings_select_picker_text",V.textContent=M.label;let L=document.createElement("span");L.className="dashicons dashicons-yes aipkit_settings_select_picker_check",B.appendChild(V),B.appendChild(L),I.appendChild(B)};if(P.forEach(F),O.forEach(F),!P.length&&!O.length){let M=document.createElement("div");M.className="aipkit_settings_select_picker_empty",M.textContent=k(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),I.appendChild(M)}return}let C=_(E),b=!1;if(C.forEach(x=>{let T=x.options.filter(P=>A?P.label.toLowerCase().includes(A):!0);if(T.length){if(x.groupLabel){let P=document.createElement("div");P.className="aipkit_settings_select_picker_group_label",P.textContent=x.groupLabel,I.appendChild(P)}T.forEach(P=>{let H=document.createElement("button");if(H.type="button",H.className="aipkit_settings_select_picker_item",H.setAttribute("role","option"),H.dataset.value=P.value,H.dataset.label=P.label,P.disabled&&(H.classList.add("is-disabled"),H.setAttribute("aria-disabled","true")),E.value===P.value?(H.classList.add("is-active"),H.setAttribute("aria-selected","true")):H.setAttribute("aria-selected","false"),t(E)){H.classList.add("aipkit_settings_select_picker_item--provider");let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),n(M,P.value),H.appendChild(M)}let O=document.createElement("span");O.className="aipkit_settings_select_picker_text",O.textContent=P.label;let F=document.createElement("span");F.className="dashicons dashicons-yes aipkit_settings_select_picker_check",H.appendChild(O),H.appendChild(F),I.appendChild(H),b=!0})}}),!b){let x=document.createElement("div");x.className="aipkit_settings_select_picker_empty",x.textContent=k(A?"No matches found.":"No options available.","gpt3-ai-content-generator"),I.appendChild(x)}},g=(E,I)=>{if(!E||!I)return;let w=a(E);if(I.textContent=w||k("Select","gpt3-ai-content-generator"),t(E)){let A=I.closest("button"),C=A?A.querySelector(".aipkit_settings_select_picker_icon"):null;n(C,E.value)}},m=(E,I)=>{if(!E||!I)return;let w=E.getBoundingClientRect(),A=I.getBoundingClientRect(),C=A.width||320,b=A.height||0,x=window.innerWidth,T=window.innerHeight,P=12,H=w.left;H+C>x-P&&(H=w.right-C),H=Math.max(P,Math.min(H,x-C-P));let O=w.bottom+8;O+b>T-P&&(O=w.top-b-8),O=Math.max(P,Math.min(O,T-b-P)),I.style.left=`${Math.round(H)}px`,I.style.top=`${Math.round(O)}px`},u=()=>{!r||!i||e||(e=!0,window.requestAnimationFrame(()=>{let E=r.querySelector(".aipkit_model_settings_popover_panel");m(i,E),e=!1}))},h=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},v=(E,I,w)=>{if(!E||!I)return;r&&r!==I&&h(),r=I,i=E,I.classList.add("aipkit-active"),I.setAttribute("aria-hidden","false"),E.setAttribute("aria-expanded","true");let A=I.querySelector(".aipkit_settings_select_picker_search input"),C=I.querySelector(".aipkit_settings_select_picker_list");C&&f(w,C,A?A.value:""),A&&A.offsetParent!==null&&(A.focus(),A.select());let b=I.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{m(E,b)})},S=(E,I)=>{if(!E||!I)return;let{button:w,popover:A,list:C,search:b}=I;if(w&&w.dataset.pickerListenerAttached!=="true"&&(w.addEventListener("click",x=>{if(x.preventDefault(),r===A){h();return}v(w,A,E)}),w.dataset.pickerListenerAttached="true"),A&&A.dataset.overlayListenerAttached!=="true"){A.addEventListener("click",T=>{T.target===A&&h()});let x=A.querySelector(".aipkit_model_settings_popover_close");x&&x.addEventListener("click",T=>{T.preventDefault(),h()}),A.dataset.overlayListenerAttached="true"}if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",x=>{let T=x.target.closest(".aipkit_settings_select_picker_item");if(!T||T.classList.contains("is-disabled"))return;let P=T.dataset.value??"";E.value=P,E.dispatchEvent(new Event("change",{bubbles:!0})),g(E,I.label),f(E,C,b?b.value:""),h()}),C.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("input",()=>{f(E,C,b.value)}),b.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("change",()=>{g(E,I.label),f(E,C,b?b.value:""),r===A&&h()}),E.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerObserverAttached!=="true"){let x=!1;new MutationObserver(()=>{x||(x=!0,window.requestAnimationFrame(()=>{g(E,I.label),f(E,C,b?b.value:""),x=!1}))}).observe(E,{childList:!0,subtree:!0}),E.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitChatPickerEscapeBound||(document.addEventListener("keydown",x=>{x.key==="Escape"&&r&&h()}),document.body.dataset.aipkitChatPickerEscapeBound="true"),document.body.dataset.aipkitChatPickerRepositionBound||(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),document.body.dataset.aipkitChatPickerRepositionBound="true")};function q(){let E=document.querySelector(".aipkit_chatbot_builder");if(!E)return;let I=E.querySelectorAll(o);I.length&&I.forEach(w=>{if(!w.id||w.dataset.aipkitPickerInit==="true")return;let A=p(w);A&&(g(w,A.label),f(w,A.list,A.search?A.search.value:""),S(w,A),w.dataset.aipkitPickerInit="true")})}function y(){let E=document.querySelector(".aipkit_chatbot_builder");if(!E)return;E.querySelectorAll(o).forEach(w=>{if(!w.id)return;let A=p(w);A&&(g(w,A.label),f(w,A.list,A.search?A.search.value:""),S(w,A),w.dataset.aipkitPickerInit="true")})}window.aipkit_initChatSelectPickers=q,window.aipkit_refreshChatSelectPickers=y})();(function(){"use strict";let k={OpenAI:"openai",OpenRouter:"openrouter",Google:"google",Azure:"azure",Claude:"claude",DeepSeek:"deepseek",Ollama:"ollama"};function o(i){let e=k[i];if(!e)return!0;let t=window.aipkit_dashboard?.providerStatus?.[e];return typeof t>"u"?!0:!!t}function r(i,e={}){return i?typeof window.aipkit_queueProviderSync!="function"?(console.warn("AIPKit Chatbot Sync: aipkit_queueProviderSync is not available."),!1):o(i)?(window.aipkit_queueProviderSync(i,e),!0):!1:!1}window.aipkit_requestChatbotModelSync=r})();(function(){"use strict";function k(r,i,e){let t=document.getElementById(r);if(!t)return;if(t.innerHTML="",!i||i.length===0){t.appendChild(new Option("(No voices found - Sync again)",""));return}t.appendChild(new Option("-- Select Voice --",""));let c={};i.forEach(n=>{let d=n.languageCodes[0]||"und";c[d]||(c[d]=[]),c[d].push(n)}),Object.keys(c).sort().forEach(n=>{let d=document.createElement("optgroup");try{let a=new Intl.DisplayNames(["en"],{type:"language"}).of(n.split("-")[0]);d.label=`${a} (${n})`}catch{d.label=n}c[n].sort((a,l)=>a.name.localeCompare(l.name)),c[n].forEach(a=>{let l=new Option(a.name,a.id);a.id===e&&(l.selected=!0),d.appendChild(l)}),t.appendChild(d)}),e&&!t.value&&(Array.from(t.options).some(d=>d.value===e)?t.value=e:console.warn(`AIPKit TTS: Saved Google voice ID "${e}" not found in synced list for ${r}.`))}function o(r){let i=r.getAttribute("data-target-select"),e=r.querySelector(".aipkit_spinner"),t=r.closest(".aipkit_popover_audio_flyout"),c=t?t.querySelector(".aipkit_tts_sync_status"):null;if(!c){let a=r.closest(".aipkit_popover_option_row");c=a?a.querySelector(".aipkit_tts_sync_status"):null}if(!c){let a=r.closest(".aipkit_form-group");c=a?a.querySelector(".aipkit_form-help"):null}if(!i){console.error("AIPKit TTS Sync (Google): Missing target select ID from button attribute.");return}if(c||console.error("AIPKit TTS Sync (Google): Could not find message container for button:",r),typeof window.aipkit_showTemporaryMessage!="function"||typeof window.aipkit_apiRequest!="function"){console.error("AIPKit TTS Sync (Google): Missing required UI or API helper functions."),alert("AIPKit Error: Cannot sync voices, required functions missing.");return}let s=c&&c.classList.contains("aipkit_popover_status_inline"),n=(a,l)=>{!c||!s||(c.textContent=a||"",c.classList.remove("success","error","loading"),l&&c.classList.add(l),c.style.display=a?"inline-block":"none")};if(r.disabled=!0,r.classList.add("aipkit_loading"),e&&(e.style.display="inline-block"),c){let a=c.dataset.baseClass||c.className||"aipkit_form-help";c.dataset.baseClass||(c.dataset.baseClass=a),c.textContent="",c.className=a,c.style.display=a.includes("aipkit_popover_status_inline")?"none":""}s&&n("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(a=>{if(a&&a.voices){let l=document.getElementById(i),p=l?l.value:"";k(i,a.voices,p);let _=document.getElementById("aipkit_google_tts_voices_json_main");_&&(_.dataset.voices=JSON.stringify(a.voices)),c&&(s?n(a.message||"Sync successful!","success"):window.aipkit_showTemporaryMessage(c,"success",a.message||"Sync successful!"))}else throw new Error("Invalid response received from voice sync.")}).catch(a=>{console.error("AIPKit TTS Sync Error (Google):",a),c&&(s?n(`Sync failed: ${a.message||"Unknown error"}`,"error"):window.aipkit_showTemporaryMessage(c,"error",`Sync failed: ${a.message||"Unknown error"}`))}).finally(()=>{r.disabled=!1,r.classList.remove("aipkit_loading"),e&&(e.style.display="none")})}window.aipkit_updateGoogleVoiceSelect=k,window.aipkit_handleSyncGoogleVoices=o})();(function(){"use strict";function k(r,i,e){let t=document.getElementById(r);if(!t){console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Select element #${r} not found.`);return}if(t.innerHTML="",!i||i.length===0){if(t.appendChild(new Option("(No voices found - Sync voices to load)","")),e){let s=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(s),t.value=e}return}t.appendChild(new Option("-- Select Voice --","")),i.sort((s,n)=>(s.name||s.id||"").localeCompare(n.name||n.id||""));let c=!1;if(i.forEach(s=>{let n=new Option(s.name,s.id);s.id===e&&(n.selected=!0,c=!0),t.appendChild(n)}),e&&!c){let s=!1;for(let n=0;n<t.options.length;n++)if(t.options[n].value===e){s=!0,t.value=e;break}if(!s){let n=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(n),t.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Voices): Saved voice ID "${e}" not found in synced list for #${r}, added as manual.`)}}else!e&&t.options.length>0&&(t.value="")}function o(r,i,e){let t=document.getElementById(r);if(!t){console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Select element #${r} not found.`);return}if(t.innerHTML="",!i||i.length===0){if(t.appendChild(new Option("(No models found - Sync models to load)","")),e){let s=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(s),t.value=e}return}t.appendChild(new Option("-- Select Model --","")),i.sort((s,n)=>(s.name||s.id||"").localeCompare(n.name||n.id||""));let c=!1;if(i.forEach(s=>{let n=s.id||"",d=s.name||n;if(!n)return;let a=new Option(d,n);n===e&&(a.selected=!0,c=!0),t.appendChild(a)}),e&&!c){let s=!1;for(let n=0;n<t.options.length;n++)if(t.options[n].value===e){s=!0,t.value=e;break}if(!s){let n=new Option(e+" (manual/not synced)",e,!1,!0);t.appendChild(n),t.value=e,console.warn(`AIPKit Chat TTS UI (ElevenLabs Models): Saved model ID "${e}" not found in synced list for #${r}, added as manual.`)}}else!e&&t.options.length>0&&(t.value="")}window.aipkit_chatTts_updateElevenLabsVoiceSelect=k,window.aipkit_chatTts_updateElevenLabsModelsSelect=o})();(function(){"use strict";function k(i,e){let t=i.querySelector(".aipkit_tts_conditional_settings"),c=i.querySelector(".aipkit_tts_auto_play_container");t&&(t.style.display=e?"block":"none"),c&&(c.style.display=e?"block":"none")}function o(i){let e=i.querySelector(".aipkit_tts_provider_select");if(!e)return;let t=e.value;i.querySelectorAll(".aipkit_tts_provider_settings").forEach(s=>{if(s.getAttribute("data-provider")===t){if(s.style.display="block",t==="OpenAI"){let n=s.querySelector('.aipkit_form-group:has(select[name="tts_openai_model_id"])');n&&(n.style.display="block")}}else s.style.display="none"})}function r(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i){console.warn("AIPKit TTS Settings: Main content container not found.");return}let e=typeof window.aipkit_updateGoogleVoiceSelect=="function",t=typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function",c=typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function",s=typeof window.aipkit_handleSyncGoogleVoices=="function";e||console.error("AIPKit TTS Settings: Google voice update function missing."),t||console.error("AIPKit TTS Settings: ElevenLabs CHAT voice update function missing."),c||console.error("AIPKit TTS Settings: ElevenLabs CHAT model update function missing."),s||console.error("AIPKit TTS Settings: Google voice sync handler function missing."),i.addEventListener("change",function(d){let a=d.target.closest(".aipkit_tts_toggle_switch"),l=d.target.closest(".aipkit_tts_provider_select");if(a){let p=a.closest(".aipkit_accordion-content");p&&(k(p,a.checked),a.checked&&o(p))}else if(l){let p=l.closest(".aipkit_accordion-content");p&&o(p)}}),i.addEventListener("click",function(d){let a=d.target.closest(".aipkit_sync_tts_voices_btn");a&&a.getAttribute("data-provider")==="Google"&&s&&window.aipkit_handleSyncGoogleVoices(a)}),i.querySelectorAll('.aipkit_accordion[data-section="tts-settings"] .aipkit_accordion-content').forEach(d=>{let a=d.querySelector(".aipkit_tts_toggle_switch");a&&(k(d,a.checked),a.checked&&o(d));let l=d.querySelector('select[name="tts_google_voice_id"]');l&&!e&&console.error("AIPKit TTS Settings Init (Google): Google voice update function (aipkit_updateGoogleVoiceSelect) is missing, but select element exists."),l&&l.options.length<=1&&(l.innerHTML='<option value="">(Sync voices to load)</option>');let p=d.querySelector('select[name="tts_elevenlabs_voice_id"]');if(p&&t){let g="";if(p&&p.id){let h=p.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_voice_id/);h&&h[1]&&(g=h[1])}let m=g?document.getElementById(`aipkit_elevenlabs_voices_json_${g}`):null,u=m?m.dataset.voices:null;try{let h=u?JSON.parse(u):[],v=p.value||"";window.aipkit_chatTts_updateElevenLabsVoiceSelect(p.id,h,v)}catch(h){console.error("AIPKit TTS Settings Init (ElevenLabs Voices): Failed to parse initial voices JSON.",h),p.options.length<=1&&(p.innerHTML='<option value="">(Sync voices to load)</option>')}}else p&&p.options.length<=1&&(p.innerHTML='<option value="">(Sync voices to load)</option>');let _=d.querySelector('select[name="tts_elevenlabs_model_id"]');if(_&&c){let g="";if(_&&_.id){let h=_.id.match(/aipkit_bot_(\d+)_tts_elevenlabs_model_id/);h&&h[1]&&(g=h[1])}let m=g?document.getElementById(`aipkit_elevenlabs_models_json_${g}`):null,u=m?m.dataset.models:null;try{let h=u?JSON.parse(u):[],v=_.value||"";window.aipkit_chatTts_updateElevenLabsModelsSelect(_.id,h,v)}catch(h){console.error("AIPKit TTS Settings Init (ElevenLabs Models): Failed to parse initial models JSON.",h),_.options.length<=1&&(_.innerHTML='<option value="">(Sync models to load)</option>')}}else _&&_.options.length<=1&&(_.innerHTML='<option value="">(Sync models to load)</option>');let f=d.querySelector('select[name="tts_openai_model_id"]');f&&f.options.length<=1&&(f.innerHTML='<option value="">(Sync models to load)</option>')})}window.aipkit_initTtsSettingsUI=r})();(function(){"use strict";function k(){let o=document.getElementById("chatbot-create-new-content");if(!o)return;let r=o.querySelector("#aipkit_create_new_bot_btn"),i=o.querySelector("#aipkit_new_bot_name"),e=o.querySelector("#aipkit_create_bot_message");if(!r||!i||!e)return;let t=r.querySelector(".aipkit_spinner");r.addEventListener("click",function(){let c=i.value.trim();if(!c){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Please enter a name for the chatbot."):(e.textContent="Please enter a name for the chatbot.",e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),i.focus();return}r.disabled=!0,t&&(t.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(r,"Creating..."):r.textContent="Creating...",e.textContent="",e.className="aipkit_form-help",aipkit_apiRequest("aipkit_create_chatbot",{bot_name:c}).then(s=>{let n=s.message||"Chatbot created!";typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"success",n):(e.textContent=n,e.style.color="green",setTimeout(()=>{e.textContent="",e.style.color=""},4e3)),i.value="";let d=s.bot_id;if(!d){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Creation succeeded but failed to get bot ID. Please reload."):(e.textContent="Creation succeeded but failed to get bot ID. Please reload.",e.style.color="red");return}aipkit_loadModule("chatbot",{force_active_bot_id:d},function(a){if(a){typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error","Bot created, but UI failed to refresh. Please reload."):(e.textContent="Bot created, but UI failed to refresh. Please reload.",e.style.color="red");return}if(typeof window.aipkit_requestChatbotModelSync=="function"){let l=document.querySelector(".aipkit_chatbot_provider_select"),p=l&&l.value||"";p&&window.aipkit_requestChatbotModelSync(p,{silent:!0})}setTimeout(()=>{typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(d)},50)})}).catch(s=>{let n="Error: "+(s.message||"Unknown error during creation.");typeof window.aipkit_showTemporaryMessage=="function"?window.aipkit_showTemporaryMessage(e,"error",n):(e.textContent=n,e.style.color="red",setTimeout(()=>{e.textContent="",e.style.color=""},4e3))}).finally(()=>{r.disabled=!1,t&&(t.style.display="none"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(r,"Start Creating"):(r.textContent="Start Creating",t&&r.appendChild(t))})})}window.aipkit_initCreateNewBot=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!o){console.warn("AIPKit Chat Saver: Main content container (#aipkit_chatbot_main_tab_content_container) not found.");return}o.addEventListener("submit",function(r){let i=r.target.closest(".aipkit_chatbot_settings_form");if(!i)return;r.preventDefault();let e=i.getAttribute("data-bot-id"),t=i.querySelector(".aipkit_save_bot_settings_btn");t||(t=document.getElementById("aipkit_chatbot_header_save_btn"));let c=document.getElementById("aipkit_chatbot_global_save_status_container"),s=i.querySelector(`#aipkit_action_feedback_${e}`);if(!e||!t||!c){console.warn("AIPKit Chat Saver: Missing elements for save (botId, button, or global save status span). Form:",i),c||console.warn("AIPKit Chat Saver: Could not find global save status span with ID 'aipkit_chatbot_global_save_status_container'.");return}s&&(s.innerHTML=""),c.textContent="",c.className="aipkit_save_status_container",t.disabled=!0,t.classList.add("aipkit_loading");let n=t.querySelector(".aipkit_spinner");n||(n=document.createElement("span"),n.className="aipkit_spinner",t.appendChild(n)),n.style.display="inline-block";let d=new FormData(i),a={};for(let[p,_]of d.entries())if(p.endsWith("[]")){let f=p.slice(0,-2);a[f]=d.getAll(p)}else a.hasOwnProperty(p)||(a[p]=_);a.bot_id=e,function(){let _=document.getElementById(`aipkit_bot_${e}_custom_theme_settings_container`);if(!_)return;_.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["], textarea[name^="custom_theme_settings["]').forEach(g=>{let m=g.getAttribute("name");if(!m)return;let u=!0;(g.type==="checkbox"||g.type==="radio")&&(u=g.checked),u?a[m]=g.value:g.type==="checkbox"&&(a[m]="0")})}(),function(){let _=document.getElementById(`aipkit_bot_${e}_ai_params_modal`);if(!_)return;let f=_.querySelector(".aipkit_modal_body")||_;["temperature","max_completion_tokens","reasoning_effort"].forEach(m=>{let u=f.querySelector(`[name="${m}"]`);u&&(a[m]=u.value)})}(),function(){let _=document.getElementById(`aipkit_bot_${e}_web_settings_modal`);if(!_)return;let f=_.querySelector(".aipkit_modal_body")||_,g=m=>f.querySelector(`[name="${m}"]`);["openai_web_search_context_size","openai_web_search_loc_type","openai_web_search_loc_country","openai_web_search_loc_city","openai_web_search_loc_region","openai_web_search_loc_timezone"].forEach(m=>{let u=g(m);u&&(a[m]=u.value)}),["google_grounding_mode","google_grounding_dynamic_threshold"].forEach(m=>{let u=g(m);u&&(a[m]=u.value)}),["claude_web_search_max_uses","claude_web_search_loc_type","claude_web_search_loc_country","claude_web_search_loc_city","claude_web_search_loc_region","claude_web_search_loc_timezone","claude_web_search_allowed_domains","claude_web_search_blocked_domains","claude_web_search_cache_ttl"].forEach(m=>{let u=g(m);u&&(a[m]=u.value)})}(),function(){let _=document.getElementById(`aipkit_bot_${e}_vector_store_modal`);if(!_)return;let f=q=>_.querySelector(q),g=_.querySelector(".aipkit_modal_body")||_,m=g.querySelector('input[name="enable_vector_store"]');m&&(a.enable_vector_store=m.checked?"1":"0");let u=f('select[name="vector_store_provider"]');if(u&&(a.vector_store_provider=u.value),a.vector_store_provider==="openai"){let q=f('select[name="openai_vector_store_ids[]"]');q?a.openai_vector_store_ids=Array.from(q.selectedOptions).map(y=>y.value):a.openai_vector_store_ids=[]}else delete a.openai_vector_store_ids;if(a.vector_store_provider==="pinecone"){let q=f('select[name="pinecone_index_name"]');q&&(a.pinecone_index_name=q.value)}else delete a.pinecone_index_name;if(a.vector_store_provider==="qdrant"){let q=f('select[name="qdrant_collection_names[]"]');if(q){let y=Array.from(q.selectedOptions).map(E=>E.value);a.qdrant_collection_names=y,a.qdrant_collection_name=y[0]||""}else a.qdrant_collection_names=[],a.qdrant_collection_name=""}else delete a.qdrant_collection_names,delete a.qdrant_collection_name;if(a.vector_store_provider==="pinecone"||a.vector_store_provider==="qdrant"){let q=f('select[name="vector_embedding_provider"]'),y=f('select[name="vector_embedding_model"]');q&&(a.vector_embedding_provider=q.value),y&&(a.vector_embedding_model=y.value)}else delete a.vector_embedding_provider,delete a.vector_embedding_model;let h=f('input[name="vector_store_top_k"]');h&&(a.vector_store_top_k=h.value);let v=f('input[name="vector_store_confidence_threshold"]');v&&(a.vector_store_confidence_threshold=v.value);let S=g.querySelector('input[name="content_aware_enabled"]');S&&(a.content_aware_enabled=S.checked?"1":"0")}(),function(){let _=document.getElementById(`aipkit_bot_${e}_conversations_modal`);if(!_)return;let f=_.querySelector(".aipkit_modal_body")||_,g=f.querySelector('input[name="stream_enabled"]');g&&(a.stream_enabled=g.checked?"1":"0");let m=f.querySelector('input[name="openai_conversation_state_enabled"]');m&&(a.openai_conversation_state_enabled=m.checked?"1":"0");let u=f.querySelector('input[name="max_messages"]');u&&(a.max_messages=u.value);let h=f.querySelector('select[name="reasoning_effort"]');h&&(a.reasoning_effort=h.value)}(),function(){let _=document.getElementById(`aipkit_bot_${e}_images_modal`);if(!_)return;let f=_.querySelector(".aipkit_modal_body")||_,g=f.querySelector('select[name="chat_image_model_id"]'),m=f.querySelector('input[name="image_triggers"]');g&&(a.chat_image_model_id=g.value),m&&(a.image_triggers=m.value);let u=f.querySelector('input[name="enable_image_upload"]');u&&(a.enable_image_upload=u.checked?"1":"0")}(),function(){let _=document.getElementById(`aipkit_bot_${e}_audio_settings_modal`);if(!_)return;let f=_.querySelector(".aipkit_modal_body")||_,g=h=>f.querySelector(`[name="${h}"]`);function m(h){let v=g(h);v&&(a[h]=v.checked?"1":"0")}function u(h){let v=g(h);v&&(a[h]=v.value)}m("enable_voice_input"),u("stt_provider"),u("stt_openai_model_id"),m("tts_enabled"),u("tts_provider"),u("tts_google_voice_id"),u("tts_openai_voice_id"),u("tts_openai_model_id"),u("tts_elevenlabs_voice_id"),u("tts_elevenlabs_model_id"),m("tts_auto_play"),m("enable_realtime_voice"),m("direct_voice_mode"),m("input_audio_noise_reduction"),u("realtime_model"),u("realtime_voice"),u("turn_detection"),u("input_audio_format"),u("output_audio_format"),u("speed")}(),function(){let _=document.getElementById(`aipkit_bot_${e}_token_mgmt_modal`);if(!_)return;let f=_.querySelector(".aipkit_modal_body")||_,g=f.querySelector('input[name="token_guest_limit"]'),m=f.querySelector('input[name="token_user_limit"]'),u=f.querySelector('select[name="token_limit_mode"]'),h=f.querySelector('select[name="token_reset_period"]'),v=f.querySelector('input[name="token_limit_message"]');g&&(a.token_guest_limit=g.value),m&&(a.token_user_limit=m.value),u&&(a.token_limit_mode=u.value),h&&(a.token_reset_period=h.value),v&&(a.token_limit_message=v.value),f.querySelectorAll('input[name^="token_role_limits["]').forEach(q=>{let y=q.getAttribute("name");y&&(a[y]=q.value)})}(),function(){let _=document.getElementById("aipkit_starters_flyout");if(!_)return;let f=_.querySelector('textarea[name="conversation_starters"]');f&&(a.conversation_starters=f.value)}(),function(){let _=document.getElementById(`aipkit_bot_${e}_popup_settings_modal`);if(!_)return;let f=_.querySelector(".aipkit_modal_body")||_;function g(ee){return f.querySelector(`[name="${ee}"]`)}function m(ee){return f.querySelector(`[name="${ee}"]:checked`)}function u(ee,ne){typeof ne<"u"&&ne!==null&&(a[ee]=ne)}let h=g("popup_position");h&&u("popup_position",h.value);let v=g("popup_delay");v&&u("popup_delay",v.value);let S=g("site_wide_enabled");S&&u("site_wide_enabled",S.checked?"1":"0");let q=g("popup_icon_style");if(q)u("popup_icon_style",q.value);else{let ee=m("popup_icon_style");ee&&u("popup_icon_style",ee.value)}let y=g("popup_icon_size");y&&u("popup_icon_size",y.value);let E=g("popup_icon_type");if(E)u("popup_icon_type",E.value);else{let ee=m("popup_icon_type");ee&&u("popup_icon_type",ee.value)}let I=m("popup_icon_default");I&&u("popup_icon_default",I.value);let w=g("popup_icon_custom_url");w&&u("popup_icon_custom_url",w.value);let A=g("header_avatar_type");if(A)u("header_avatar_type",A.value);else{let ee=m("header_avatar_type");ee&&u("header_avatar_type",ee.value)}let C=m("header_avatar_default");C&&u("header_avatar_default",C.value);let b=g("header_avatar_url");b&&u("header_avatar_url",b.value);let x=g("header_online_text");x&&u("header_online_text",x.value);let T=g("popup_label_enabled");T&&u("popup_label_enabled",T.checked?"1":"0");let P=g("popup_label_text");P&&u("popup_label_text",P.value);let H=g("popup_label_mode");H&&u("popup_label_mode",H.value);let O=g("popup_label_size");O&&u("popup_label_size",O.value);let F=g("popup_label_delay_seconds");F&&u("popup_label_delay_seconds",F.value);let M=g("popup_label_auto_hide_seconds");M&&u("popup_label_auto_hide_seconds",M.value);let B=g("popup_label_dismissible");B&&u("popup_label_dismissible",B.checked?"1":"0");let V=g("popup_label_show_on_desktop");V&&u("popup_label_show_on_desktop",V.checked?"1":"0");let L=g("popup_label_show_on_mobile");L&&u("popup_label_show_on_mobile",L.checked?"1":"0");let U=g("popup_label_frequency");U&&u("popup_label_frequency",U.value);let W=g("popup_label_version");W&&u("popup_label_version",W.value)}();let l=a.provider;if(l==="OpenAI")a.model=a.openai_model;else if(l==="OpenRouter")a.model=a.openrouter_model;else if(l==="Google")a.model=a.google_model;else if(l==="Azure")a.model=a.azure_deployment;else if(l==="Claude")a.model=a.claude_model;else if(l==="DeepSeek")a.model=a.deepseek_model;else if(l==="Ollama"){let p=i.querySelector('select[name="ollama_model"]'),_=typeof a.ollama_model<"u"?a.ollama_model:p?p.value:"";a.model=_||""}else a.model="";delete a.openai_model,delete a.openrouter_model,delete a.google_model,delete a.azure_deployment,delete a.claude_model,delete a.deepseek_model,delete a.ollama_model,function(){let _=document.getElementById(`aipkit_bot_${e}_vector_store_modal`),f=m=>_?_.querySelector(m):null,g=m=>i.querySelector(m);if(a.vector_store_provider==="openai"){let m=f('select[name="openai_vector_store_ids[]"]')||g('select[name="openai_vector_store_ids[]"]');m?a.openai_vector_store_ids=Array.from(m.selectedOptions).map(u=>u.value):a.openai_vector_store_ids=[]}else a.hasOwnProperty("openai_vector_store_ids")&&delete a.openai_vector_store_ids;if(a.vector_store_provider==="pinecone"||a.vector_store_provider==="qdrant"){if(a.vector_store_provider==="qdrant"){let h=f('select[name="qdrant_collection_names[]"]')||g('select[name="qdrant_collection_names[]"]');if(h){let v=Array.from(h.selectedOptions).map(S=>S.value);a.qdrant_collection_names=v,a.qdrant_collection_name=v[0]||""}else a.qdrant_collection_names=[],a.qdrant_collection_name=""}else if(a.vector_store_provider==="pinecone"){let h=f('select[name="pinecone_index_name"]')||g('select[name="pinecone_index_name"]');h&&(a.pinecone_index_name=h.value)}let m=f('select[name="vector_embedding_provider"]')||g('select[name="vector_embedding_provider"]');m&&(a.vector_embedding_provider=m.value);let u=f('select[name="vector_embedding_model"]')||g('select[name="vector_embedding_model"]');u&&(a.vector_embedding_model=u.value)}else delete a.pinecone_index_name,delete a.qdrant_collection_name,delete a.qdrant_collection_names,delete a.vector_embedding_provider,delete a.vector_embedding_model}(),aipkit_apiRequest("aipkit_save_chatbot_settings",a).then(p=>{c.textContent=p.message||"Settings Saved!",c.classList.add("success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(e)}).catch(p=>{c.textContent="Error: "+p.message,c.classList.add("error")}).finally(()=>{t.disabled=!1,t.classList.remove("aipkit_loading");let p=t.querySelector(".aipkit_spinner");if(p&&(p.style.display="none"),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(t,"Save");else{let _=Array.from(t.childNodes).find(f=>f.nodeType===Node.TEXT_NODE);_?_.textContent="Save":t.insertBefore(document.createTextNode("Save"),t.firstChild),p&&t.appendChild(p)}setTimeout(()=>{c&&(c.textContent="",c.className="aipkit_save_status_container")},3e3)})})}window.aipkit_initSaveBotSettings=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Deleter: Main content container not found."),i&&i.querySelectorAll(".aipkit_delete_bot_btn").forEach(t=>{t.getAttribute("data-is-default")==="1"&&(t.disabled=!0)}),i&&i.addEventListener("click",function(t){let c=t.target.closest(".aipkit_delete_bot_btn");if(!c||c.disabled)return;let s=c.getAttribute("data-bot-id"),n=c.getAttribute("data-bot-name"),d=c.closest(".aipkit_chatbot_settings_form"),l=document.getElementById("aipkit_header_action_feedback")||(d?d.querySelector(`#aipkit_action_feedback_${s}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!s||!l){console.error("AIPKit Chat Deleter: Missing required elements (botId, actionFeedbackArea) for:",c);return}let _=`aipkit_delete_confirmation_${s}`,f=l.querySelector(`#${_}`);f||(f=document.createElement("div"),f.id=_,f.className="aipkit_confirmation_message aipkit_delete_confirmation",f.style.display="none",l.insertBefore(f,l.firstChild));let g=`aipkit_action_status_${s}`,m=l.querySelector(`#${g}`);if(m||(m=document.createElement("div"),m.id=g,m.className="aipkit_action_status_message",l.appendChild(m)),f.style.display!=="none"&&f.innerHTML!=="")return;p&&(p.textContent="",p.className="aipkit_save_status_container");let u=l.querySelector(".aipkit_reset_confirmation");u&&(u.style.display="none"),m.textContent="",m.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let h=f.querySelector(".aipkit_delete_confirm_btn"),v=f.querySelector(".aipkit_delete_cancel_btn"),S=()=>{f.innerHTML="",f.style.display="none",o(c,s,m,p)},q=()=>{f.innerHTML="",f.style.display="none"};h.addEventListener("click",S,{once:!0}),v.addEventListener("click",q,{once:!0})});let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(t){let c=t.target.closest(".aipkit_header_delete_btn");if(!c)return;let s=c.closest(".aipkit_tab_dropdown_menu");s&&(s.style.display="none");let n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),d=n?.dataset?.botId,a=n?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",p=document.getElementById("aipkit_header_action_feedback")||(n?n.querySelector(`#aipkit_action_feedback_${d}`):null),_=document.getElementById("aipkit_chatbot_global_save_status_container");if(!d||!p)return;if(a){p.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{p.innerHTML=""},3e3);return}let f=`aipkit_delete_confirmation_${d}`,g=p.querySelector(`#${f}`);g||(g=document.createElement("div"),g.id=f,g.className="aipkit_confirmation_message aipkit_delete_confirmation",g.style.display="none",p.insertBefore(g,p.firstChild));let m=`aipkit_action_status_${d}`,u=p.querySelector(`#${m}`);u||(u=document.createElement("div"),u.id=m,u.className="aipkit_action_status_message",p.appendChild(u)),_&&(_.textContent="",_.className="aipkit_save_status_container");let h=p.querySelector(".aipkit_reset_confirmation");h&&(h.style.display="none"),u.textContent="",u.className="aipkit_action_status_message",g.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_btn">Confirm</button>
          </div>`,g.style.display="block";let v=g.querySelector(".aipkit_delete_confirm_btn"),S=g.querySelector(".aipkit_delete_cancel_btn");v?.addEventListener("click",()=>{g.innerHTML="",g.style.display="none",o(c,d,u,_)},{once:!0}),S?.addEventListener("click",()=>{g.innerHTML="",g.style.display="none"},{once:!0})})}function o(i,e,t,c){let s=i.querySelector(".aipkit_spinner"),n=document.getElementById("aipkit_chatbot_main_selector_container");c&&(c.textContent="",c.className="aipkit_save_status_container"),t.textContent="",t.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Deleting..."):i.textContent="Deleting...",aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:e}).then(d=>{t.textContent=d.message||"Chatbot deleted successfully.",t.classList.add("success");let a=!1;if(n){let p=n.querySelector(`.aipkit_tab_button[data-bot-id="${e}"]`),_=n.querySelector(`.aipkit_tab_dropdown_item[data-bot-id="${e}"]`);if(p)a=p.classList.contains("aipkit_active"),p.remove();else if(_){a=_.classList.contains("aipkit_active"),_.remove();let f=n.querySelector(".aipkit_tab_dropdown_menu");if(f&&f.querySelectorAll(".aipkit_tab_dropdown_item").length===0){let m=f.closest(".aipkit_tab_dropdown_container");m&&m.remove()}}}let l=document.getElementById(`chatbot-${e}-content`);if(l&&l.remove(),setTimeout(()=>{let p=document.getElementById(`aipkit_action_status_${e}`);p&&(p.textContent="",p.className="aipkit_action_status_message")},4e3),a){let p=n?.querySelector(".aipkit_tab_button_default");if(p)p.click();else{let _=n?.querySelector('.aipkit_tab_button[data-tab-type="bot"]');if(_)_.click();else{let f=n?.querySelector(".aipkit_tab_dropdown_item");if(f)f.click();else{let g=n?.querySelector(".aipkit_create-new-button");if(g)g.click();else{let m=document.getElementById("aipkit_admin_chat_preview_container");m&&(m.innerHTML='<p class="aipkit_preview_placeholder">Chatbot deleted. Select another option.</p>')}}}}}}).catch(d=>{t.textContent="Error: "+(d.message||"Failed to delete chatbot."),t.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Delete"),setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_action_status_message")},5e3)})}function r(i){if(!i)return"";let e=document.createElement("div");return e.textContent=i,e.innerHTML}window.aipkit_initDeleteBot=k})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");i||console.warn("AIPKit Chat Resetter: Main content container not found."),i&&i.addEventListener("click",function(t){let c=t.target.closest(".aipkit_reset_bot_btn");if(!c||c.disabled)return;let s=c.getAttribute("data-bot-id"),n=c.getAttribute("data-bot-name"),d=c.closest(".aipkit_chatbot_settings_form"),l=document.getElementById("aipkit_header_action_feedback")||(d?d.querySelector(`#aipkit_action_feedback_${s}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!s||!l){console.error("AIPKit Chat Resetter: Missing required elements (botId, actionFeedbackArea) for:",c);return}let _=`aipkit_reset_confirmation_${s}`,f=l.querySelector(`#${_}`);f||(f=document.createElement("div"),f.id=_,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",l.insertBefore(f,l.firstChild));let g=`aipkit_action_status_${s}`,m=l.querySelector(`#${g}`);if(m||(m=document.createElement("div"),m.id=g,m.className="aipkit_action_status_message",l.appendChild(m)),f.style.display!=="none"&&f.innerHTML!=="")return;p&&(p.textContent="",p.className="aipkit_save_status_container");let u=l.querySelector(".aipkit_delete_confirmation");u&&(u.style.display="none"),m.textContent="",m.className="aipkit_action_status_message",f.innerHTML=`
                <div class="aipkit_confirmation_message_buttons">
                    <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
                    <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Confirm</button>
                </div>
            `,f.style.display="block";let h=f.querySelector(".aipkit_reset_confirm_btn"),v=f.querySelector(".aipkit_reset_cancel_btn"),S=()=>{f.innerHTML="",f.style.display="none",o(c,s,m,p)},q=()=>{f.innerHTML="",f.style.display="none"};h.addEventListener("click",S,{once:!0}),v.addEventListener("click",q,{once:!0})});let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(t){let c=t.target.closest(".aipkit_header_reset_btn");if(!c)return;let s=c.closest(".aipkit_tab_dropdown_menu");s&&(s.style.display="none");let n=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),d=n?.dataset?.botId,l=document.getElementById("aipkit_header_action_feedback")||(n?n.querySelector(`#aipkit_action_feedback_${d}`):null),p=document.getElementById("aipkit_chatbot_global_save_status_container");if(!d||!l)return;let _=`aipkit_reset_confirmation_${d}`,f=l.querySelector(`#${_}`);f||(f=document.createElement("div"),f.id=_,f.className="aipkit_confirmation_message aipkit_reset_confirmation",f.style.display="none",l.insertBefore(f,l.firstChild));let g=`aipkit_action_status_${d}`,m=l.querySelector(`#${g}`);m||(m=document.createElement("div"),m.id=g,m.className="aipkit_action_status_message",l.appendChild(m)),p&&(p.textContent="",p.className="aipkit_save_status_container");let u=l.querySelector(".aipkit_delete_confirmation");u&&(u.style.display="none"),m.textContent="",m.className="aipkit_action_status_message",f.innerHTML=`
          <div class="aipkit_confirmation_message_buttons">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_btn">Cancel</button>
            <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_btn">Reset</button>
          </div>`,f.style.display="block";let h=f.querySelector(".aipkit_reset_confirm_btn"),v=f.querySelector(".aipkit_reset_cancel_btn");h?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none",o(c,d,m,p)},{once:!0}),v?.addEventListener("click",()=>{f.innerHTML="",f.style.display="none"},{once:!0})})}function o(i,e,t,c){let s=i.querySelector(".aipkit_spinner");c&&(c.textContent="",c.className="aipkit_save_status_container"),t.textContent="",t.className="aipkit_action_status_message",i.disabled=!0,i.classList.add("aipkit_loading"),s&&(s.style.display="inline-block"),typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(i,"Resetting..."):i.textContent="Resetting...",aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:e}).then(n=>{t.textContent=n.message||"Chatbot reset successfully!",t.classList.add("success"),aipkit_loadModule("chatbot",{force_active_bot_id:e},function(d){d&&(console.error("AIPKit Chat Resetter: Error reloading module after reset:",d),t.textContent="Reset OK, but UI refresh failed. Reload page.",t.classList.add("error"))}),setTimeout(()=>{let d=document.getElementById(`aipkit_action_status_${e}`);d&&(d.textContent="",d.className="aipkit_action_status_message")},4e3)}).catch(n=>{t.textContent="Error: "+(n.message||"Failed to reset chatbot."),t.classList.add("error"),i.disabled=!1,i.classList.remove("aipkit_loading"),s&&(s.style.display="none"),typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(i,"Reset"),setTimeout(()=>{t&&(t.textContent="",t.className="aipkit_action_status_message")},5e3)})}function r(i){if(!i)return"";let e=document.createElement("div");return e.textContent=i,e.innerHTML}window.aipkit_initResetBot=k})();(function(){"use strict";function k(i,e=5,t=100){if(typeof window.aipkit_initializeChatInstance=="function")try{window.aipkit_initializeChatInstance(i)}catch(c){console.error("AIPKit Chat Preview: Error during chat initialization.",c),i.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error initializing preview.</p>'}else e>0?(console.warn(`AIPKit Chat Preview: Initializer not ready, retrying in ${t}ms... (${e} retries left)`),setTimeout(()=>{k(i,e-1,t)},t)):(console.error("AIPKit Chat Preview: window.aipkit_initializeChatInstance function not found after retries. Ensure chat-init.js is loaded and executed correctly."),i.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview function.</p>')}function o(){let i=document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_tab_button.aipkit_active, #aipkit_chatbot_main_selector_container .aipkit_tab_dropdown_item.aipkit_active"),e=document.getElementById("aipkit_admin_chat_preview_container"),t=document.querySelector(".aipkit_chatbot-preview-column"),c=window.aipkit_dashboard?.text||{};if(!e||!t){console.warn("AIPKit Chat Preview: Preview container or column not found.");return}if(e.innerHTML="",t.classList.remove("aipkit_loading"),i){let s=i.getAttribute("data-tab-type"),n=i.getAttribute("data-bot-id");s==="bot"&&n?r(n):s==="create"?e.innerHTML=`<p class="aipkit_preview_placeholder">${c.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:s==="settings"?e.innerHTML=`<p class="aipkit_preview_placeholder">${c.previewPlaceholderSettings||"Preview is not applicable for Chat Settings."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${c.previewPlaceholderSelect||"Select a bot to see the preview."}</p>`}else document.querySelector("#aipkit_chatbot_main_selector_container .aipkit_create-new-button")?e.innerHTML=`<p class="aipkit_preview_placeholder">${c.previewPlaceholderCreate||"Configure the new bot and save it to see the preview."}</p>`:e.innerHTML=`<p class="aipkit_preview_placeholder">${c.noBotsPlaceholder||"No chatbots found. Create one to get started!"}</p>`}function r(i){let e=document.getElementById("aipkit_admin_chat_preview_container"),t=document.querySelector(".aipkit_chatbot-preview-column");if(!e||!t){console.warn("AIPKit Chat Preview: Cannot refresh, container or column not found.");return}t.classList.add("aipkit_loading"),e.innerHTML="";let c=new URL(window.aipkit_dashboard.ajaxurl);c.searchParams.append("action","aipkit_get_chatbot_shortcode"),c.searchParams.append("bot_id",i),c.searchParams.append("_ajax_nonce",window.aipkit_dashboard.nonce),fetch(c).then(s=>s.json()).then(s=>{if(s.success&&s.data&&s.data.html){e.innerHTML=s.data.html;let n=e.querySelector(".aipkit_chat_container, .aipkit_popup_wrapper");if(n){e.classList.toggle("aipkit-preview-inline",n.classList.contains("aipkit_chat_container")),e.classList.toggle("aipkit-preview-popup",n.classList.contains("aipkit_popup_wrapper"));let a=window.getComputedStyle(n).getPropertyValue("--aipkit-chat-container-border-radius").trim();a&&a!=="initial"&&a!=="inherit"&&a!=="unset"?e.style.setProperty("--aipkit-chat-container-border-radius",a):e.style.removeProperty("--aipkit-chat-container-border-radius"),k(n)}else console.error(`AIPKit Chat Preview: Shortcode HTML for bot ${i} didn't contain expected wrapper (.aipkit_chat_container or .aipkit_popup_wrapper). HTML:`,s.data.html),e.innerHTML='<p class="aipkit_preview_placeholder" style="color:red">Error loading preview wrapper element.</p>'}else{let n=s.data&&s.data.message?s.data.message:"Invalid response received for shortcode preview.";throw new Error(n)}}).catch(s=>{console.error(`AIPKit Chat Preview: Error refreshing chat preview for bot ${i}:`,s),e.innerHTML=`<p class="aipkit_preview_placeholder" style="color: red;">Failed to load preview: ${s.message}</p>`}).finally(()=>{t.classList.remove("aipkit_loading")})}window.aipkit_loadInitialChatPreview=o,window.aipkit_refreshChatPreview=r})();(function(){"use strict";function k(){let c=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!c)return;let s=function(n){let d=n.target.closest(".aipkit_popup_toggle_switch");if(d){let g=d.closest(".aipkit_chatbot-settings-area");if(g){o(g,d.checked),i(g,d);let m=g.querySelector(".aipkit_popup_config_btn_placeholder");m&&(m.disabled=!d.checked,m.title=d.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let a=n.target.closest('select[name="popup_icon_type"]');if(a){let g=a.closest(".aipkit_chatbot-settings-area");g&&r(g,a.value);return}let l=n.target.closest('input[name="popup_icon_type"]');if(l){let g=l.closest(".aipkit_chatbot-settings-area");g&&r(g,l.value);return}let p=n.target.closest(".aipkit_popup_hint_toggle_switch");if(p){let g=p.closest(".aipkit_chatbot-settings-area");g&&t(g,p.checked);return}let _=n.target.closest(".aipkit_starters_toggle_switch");if(_){let g=_.closest(".aipkit_chatbot-settings-area");if(g){let m=g.querySelector(".aipkit_starters_config_btn");m&&(m.disabled=!_.checked,m.title=_.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}return}let f=n.target.closest(".aipkit_voice_input_toggle_switch");if(f){let g=f.closest(".aipkit_chatbot-settings-area");g&&e(g,f.checked);return}};c.addEventListener("change",s),c.querySelectorAll(".aipkit_chatbot-settings-area").forEach(n=>{let d=n.querySelector(".aipkit_popup_toggle_switch");if(d){o(n,d.checked),i(n,d);let g=n.querySelector(".aipkit_popup_config_btn_placeholder");g&&(g.disabled=!d.checked,g.title=d.checked?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure")}let a=n.querySelector('select[name="popup_icon_type"]');if(a)r(n,a.value);else{let g=n.querySelector('input[name="popup_icon_type"]:checked');g?r(n,g.value):n.querySelector('input[name="popup_icon_type"][value="default"]')&&r(n,"default")}let l=n.querySelector(".aipkit_voice_input_toggle_switch");l&&e(n,l.checked);let p=n.querySelector(".aipkit_popup_hint_toggle_switch");p&&t(n,p.checked);let _=n.querySelector(".aipkit_starters_toggle_switch"),f=n.querySelector(".aipkit_starters_config_btn");if(f){let g=_?_.checked:!1;f.disabled=!g,f.title=g?window.aipkit_dashboard?.text?.configure||"Configure":window.aipkit_dashboard?.text?.enableToConfigure||"Enable to configure"}})}function o(c,s){let n=c.querySelector(".aipkit_popup_settings_accordion");if(n&&(n.style.display=s?"block":"none",!s)){let a=n.querySelector(".aipkit_accordion-header"),l=n.querySelector(".aipkit_accordion-content");a&&a.classList.remove("aipkit_active"),l&&l.classList.remove("aipkit_active")}let d=c.querySelector(".aipkit_popup_icon_options_container");d&&(d.style.display=s?"block":"none")}function r(c,s){let n=c.querySelector(".aipkit_popup_icon_default_selector_container"),d=c.querySelector(".aipkit_popup_icon_custom_input_container");n&&(n.style.display=s==="default"?"block":"none"),d&&(d.style.display=s==="custom"?"block":"none")}function i(c,s){let n=s.checked,d=s.getAttribute("data-sidebar-target"),a=c.querySelector("#"+d);if(!a)return;let l=a.querySelector(".aipkit_sidebar_toggle_switch"),p=a.querySelector("label");if(!l||!p)return;let _=a.getAttribute("data-tooltip-disabled")||"";n?(l.getAttribute("data-original-state")===null&&l.setAttribute("data-original-state",l.checked?"checked":"unchecked"),l.checked=!1,l.disabled=!0,a.setAttribute("title",_),a.classList.add("aipkit-disabled-tooltip"),p.style.opacity="0.6"):(l.disabled=!1,a.removeAttribute("title"),a.classList.remove("aipkit-disabled-tooltip"),p.style.opacity="1",l.getAttribute("data-original-state")==="checked"&&(l.checked=!0),l.removeAttribute("data-original-state"))}function e(c,s){let n=c.querySelector(".aipkit_stt_provider_conditional_row");n&&(n.style.display=s?"block":"none")}function t(c,s){let n=c.querySelector(".aipkit_popup_hint_conditional_row");n&&(n.style.display=s?"block":"none");let d=c.querySelectorAll(".aipkit_popup_hint_extra");d&&d.length&&d.forEach(a=>{a.style.display=s?"":"none"})}window.aipkit_initAppearanceToggles=k,window.aipkit_togglePopupDependentSettingsVisibility=o,window.aipkit_toggleSidebarCheckboxState=i,window.aipkit_togglePopupIconValueInputs=r,window.aipkit_toggleSttSettingsVisibility=e,window.aipkit_togglePopupHintSettingsVisibility=t})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_chatbot_main_tab_content_container");o&&(o.addEventListener("change",function(r){let i=r.target.closest(".aipkit_starters_toggle_switch");if(!i)return;let e=i.closest(".aipkit_chatbot-settings-area");if(!e)return;let t=e.querySelector(".aipkit_starters_conditional_row");t&&(t.style.display=i.checked?"block":"none")}),o.querySelectorAll(".aipkit_chatbot-settings-area").forEach(r=>{let i=r.querySelector(".aipkit_starters_toggle_switch"),e=r.querySelector(".aipkit_starters_conditional_row");i&&e&&(e.style.display=i.checked?"block":"none")}))}window.aipkit_initConversationStartersToggle=k})();(function(){"use strict";let k="aipkit_last_selected_chatbot",o=()=>typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():Date.now();function r(e){let t=document.getElementById("aipkit_admin_chat_preview_container");if(!t)return;t.classList.remove("aipkit-preview-inline","aipkit-preview-popup");let c=document.createElement("p");c.className="aipkit_preview_placeholder",c.textContent=e,t.innerHTML="",t.appendChild(c)}function i(){let e=document.querySelector(".aipkit_chatbot_builder");if(!e||e.dataset.aipkitContext==="sources")return;let t=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:R=>R,c=window.wp&&window.wp.i18n&&window.wp.i18n._n?window.wp.i18n._n:(R,D,N)=>N===1?R:D,s={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0},n=e.getAttribute("data-aipkit-chatbot-layout")||"next",d=e.dataset.openaiApiKeySet==="true",a=e.dataset.pineconeApiKeySet==="true",l=e.dataset.qdrantApiKeySet==="true",p=e.dataset.qdrantUrlSet==="true",_=e.dataset.googleApiKeySet==="true",f=e.dataset.azureApiKeySet==="true",g=e.dataset.claudeApiKeySet==="true",m=e.querySelector("#aipkit_chatbot_builder_bot_select"),u=e.getAttribute("data-active-bot-id")||m&&m.value||"";if(u)try{localStorage.setItem(k,u)}catch{}let h=document.getElementById("aipkit_builder_new_bot_modal"),v=e.querySelector(".aipkit_builder_new_bot_btn"),S=null,q=h?h.querySelector(".aipkit_builder_new_bot_close"):null,y=document.getElementById("aipkit_builder_sheet"),E=y?y.querySelector(".aipkit_builder_sheet_panel"):null,I=document.getElementById("aipkit_model_settings_popover"),w=I?I.querySelector(".aipkit_model_settings_popover_panel"):null,A=I?I.querySelector(".aipkit_model_settings_popover_close"):null,C=I?I.querySelector(".aipkit_model_settings_popover_title"):null,b=I?I.querySelector(".aipkit_model_settings_popover_back"):null,x=I?I.querySelector(".aipkit_model_settings_popover_footer"):null,T=null,P=document.getElementById("aipkit_deploy_settings_popover"),H=P?P.querySelector(".aipkit_deploy_settings_popover_panel"):null,O=P?P.querySelector(".aipkit_deploy_settings_popover_close"):null,F=null,M="root",B=y?y.querySelector(".aipkit_builder_sheet_title"):null,V=y?y.querySelector(".aipkit_builder_sheet_description"):null,L=y?y.querySelector(".aipkit_builder_sheet_body"):null,U=y?y.querySelectorAll(".aipkit_builder_sheet_section"):[],W=y?y.querySelector('.aipkit_builder_sheet_section[data-sheet="placeholder"]'):null,ee=y?y.querySelector(".aipkit_builder_sheet_close"):null,ne=e.querySelector(".aipkit_builder_rename_btn"),z=document.getElementById("aipkit_builder_rename_bot_modal"),ge=z?z.querySelector(".aipkit_builder_rename_bot_close"):null,Ae=z?z.querySelector("#aipkit_rename_bot_name"):null,ot=z?z.querySelector("#aipkit_rename_bot_btn"):null,ze=z?z.querySelector("#aipkit_rename_bot_message"):null,Xe=e.querySelector(".aipkit_bot_name_input"),Ge=e.querySelector('textarea[name="instructions"]'),It=e.querySelector(".aipkit_builder_instructions_expand"),Qe=document.getElementById("aipkit_builder_instructions_modal"),Ce=Qe?Qe.querySelector(".aipkit_builder_instructions_close"):null,St=Qe?Qe.querySelector(".aipkit_builder_instructions_modal_textarea"):null,Rt=Qe?Qe.querySelector(".aipkit_builder_instructions_count"):null,vi=()=>{let R=e.querySelector(".aipkit_chatbot_provider_select");return R?R.value:""},gi=R=>{if(!R)return"";let D=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${R}"]`);if(!D)return"";let N=D.querySelector("select");return N&&N.value||""},ae=R=>{if(!R)return s;let D=window.aipkit_dashboard&&window.aipkit_dashboard.models&&Array.isArray(window.aipkit_dashboard.models.openrouter)?window.aipkit_dashboard.models.openrouter:[],N=String(R).trim().toLowerCase();if(!N)return s;let X=D.find(Z=>(Z&&Z.id?String(Z.id):"").trim().toLowerCase()===N);return!X||!X.capabilities||typeof X.capabilities!="object"?s:{...s,...X.capabilities}},ke=R=>{if(!R||vi()!=="OpenRouter")return!0;let N=gi("OpenRouter");return!!ae(N)[R]},ye=(R,D,N,X)=>{if(!R||!D)return;R.classList.toggle("aipkit_popover_option_row--disabled",N),R.setAttribute("aria-disabled",N?"true":"false"),D.disabled=!!N;let Z=R.querySelector(".aipkit_popover_option_label");Z&&(Z.dataset.defaultTooltip||(Z.dataset.defaultTooltip=Z.getAttribute("data-tooltip")||""),Z.setAttribute("data-tooltip",N&&X||Z.dataset.defaultTooltip))},ve=e.querySelector('.aipkit_builder_tabs[data-aipkit-tabs="training"]'),Re=e.querySelectorAll(".aipkit_builder_tab_panel[data-aipkit-panel]"),Ie=e.querySelector(".aipkit_training_text_input"),at=e.querySelector("#aipkit_training_qa_question"),rt=e.querySelector("#aipkit_training_qa_answer"),Ft=e.querySelector("#aipkit_training_files_input"),_i=e.querySelector(".aipkit_training_files_button"),Lt=e.querySelector(".aipkit_builder_dropzone"),Et=e.querySelectorAll(".aipkit_training_action_btn[data-training-action]"),tt=e.querySelector('.aipkit_training_action_btn[data-training-action="add"]'),De=e.querySelector(".aipkit_training_stop_btn"),Ke=e.querySelector(".aipkit_builder_card--training .aipkit_builder_action_row"),xt=e.querySelector("#aipkit_training_status"),zt=e.querySelector("#aipkit_training_file_list"),wt=new Map,Je=null,ui={page:1,selectedIds:new Set},bi=e.querySelector(".aipkit_training_sources_btn"),Xt=e.querySelector("#aipkit_vs_wp_content_messages_area"),Tt=e.querySelector("#aipkit_vs_wp_content_mode"),Qt=e.querySelector("#aipkit_vs_load_wp_content_btn"),ii=e.querySelector("#aipkit_vs_global_target_select"),Ri=e.querySelector("#aipkit_vs_wp_content_status"),Qi=e.querySelector("#aipkit_vs_wp_content_status_specific"),Ht=e.querySelector("#aipkit_vs_wp_content_list_area"),_e=e.querySelector("#aipkit_vs_wp_content_pagination"),Me=e.querySelectorAll('input[name="aipkit_wp_content_mode"]'),Ee=e.querySelector("#aipkit_wp_content_bulk_panel"),lt=e.querySelector("#aipkit_wp_content_specific_panel"),st=e.querySelector("#aipkit_wp_content_bulk_hint"),jt=e.querySelector("#aipkit_wp_content_specific_types_panel"),Jt=e.querySelector("#aipkit_wp_content_status_wrap_bulk"),$t=e.querySelector("#aipkit_wp_content_status_wrap_specific"),vt=y?y.querySelector('.aipkit_builder_sheet_section[data-sheet="sources"]'):null,Pt=vt?vt.querySelector("#aipkit_sources_table_body"):null,ki=vt?vt.querySelector(".aipkit_sources_search_input"):null,oi=vt?vt.querySelector(".aipkit_sources_filter_select"):null,Be=vt?vt.querySelector(".aipkit_sources_refresh_btn"):null,Mt=vt?vt.querySelector("#aipkit_sources_pagination"):null,ut=vt?vt.querySelector("#aipkit_sources_status"):null,Ci=vt?vt.querySelector("#aipkit_sources_provider_label"):null,tn=vt?vt.querySelector("#aipkit_sources_store_label"):null,Dt=document.getElementById("aipkit_sources_editor_modal"),on=Dt?Dt.querySelector(".aipkit_sources_editor_textarea"):null,Zi=Dt?Dt.querySelector(".aipkit_sources_editor_close"):null,sn=Dt?Dt.querySelector(".aipkit_sources_editor_cancel"):null,En=Dt?Dt.querySelector(".aipkit_sources_editor_save"):null,ni=document.getElementById("aipkit_sources_delete_modal"),Vn=ni?ni.querySelector(".aipkit_sources_delete_close"):null,Cn=ni?ni.querySelector(".aipkit_sources_delete_cancel"):null,cn=ni?ni.querySelector(".aipkit_sources_delete_confirm"):null,ct=document.getElementById("aipkit_image_settings_flyout"),yo=ct?ct.querySelector(".aipkit_popover_flyout_close"):null,Ti=null,Vt=document.getElementById("aipkit_parameters_flyout"),vo=Vt?Vt.querySelector(".aipkit_popover_flyout_close"):null,Bi=null,li=document.getElementById("aipkit_popup_hint_flyout"),bo=li?li.querySelector(".aipkit_popover_flyout_close"):null,an=null,di=document.getElementById("aipkit_security_privacy_flyout"),kn=di?di.querySelector(".aipkit_popover_flyout_close"):null,wn=w?w.querySelector('[data-aipkit-settings-panel="safety"]'):null,Pi=null,fi=document.getElementById("aipkit_starters_flyout"),Un=fi?fi.querySelector(".aipkit_popover_flyout_close"):null,Ji=null,wi=document.getElementById("aipkit_custom_theme_flyout"),Mn=wi?wi.querySelector(".aipkit_popover_flyout_close"):null,Ui=null,Di=null,bt=document.getElementById("aipkit_builder_web_settings_modal"),ln=bt?bt.querySelector(".aipkit_builder_web_settings_close"):null,Ut=document.getElementById("aipkit_builder_context_settings_modal"),So=Ut?Ut.querySelector(".aipkit_builder_context_settings_close"):null,Gn=w?w.querySelector('[data-aipkit-settings-panel="context"]'):null,Wi=null,ti=document.getElementById("aipkit_builder_token_limits_modal"),Eo=ti?ti.querySelector(".aipkit_builder_token_limits_close"):null,Gi=w?w.querySelector('[data-aipkit-settings-panel="limits"]'):null,Mi=null,Ue=document.getElementById("aipkit_builder_audio_settings_modal"),Co=Ue?Ue.querySelector(".aipkit_builder_audio_settings_close"):null,Hi=null,Fi=e.querySelector("#aipkit_builder_popup_settings_panel"),Si=document.getElementById("aipkit_chatbot_global_save_status_container"),Ze=(R,D)=>{if(!Si)return;let N=Si.closest(".aipkit_model_status_slot")?.querySelector(".aipkit_model_sync_status");N&&R&&(N.textContent="",N.classList.remove("success","error","loading")),Si.textContent=R,Si.className="aipkit_save_status_container",D&&Si.classList.add(D)},ai=()=>{Si&&setTimeout(()=>{Si.textContent="",Si.className="aipkit_save_status_container"},2500)},xn=()=>{let R=ct&&ct.querySelector('input[name="replicate_api_key"]')||w&&w.querySelector('input[name="replicate_api_key"]')||y?.querySelector('input[name="replicate_api_key"]');return R?String(R.value||"").trim():""},Kn=R=>{if(!(R!==void 0?String(R||"").trim():xn())||typeof window.aipkit_queueProviderSync!="function")return null;Ze("Syncing models...","loading");let N=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return N&&typeof N.then=="function"&&N.then(()=>{Ze("Models synced!","success"),ai()}).catch(X=>{Ze(`Error: ${X?.message||"Sync failed."}`,"error"),ai()}),N},io=e.dataset.modelSettingsTitle||"Settings",un=R=>{if(!w||!R)return;let D=R.getBoundingClientRect(),N=w.getBoundingClientRect(),X=N.width||420,Z=N.height||0,se=window.innerWidth,re=window.innerHeight,K=12,$=D.right+10;$+X>se-K&&($=D.left-X-10),$=Math.max(K,Math.min($,se-X-K));let J=D.top;J+Z>re-K&&(J=re-Z-K),J=Math.max(K,J),w.style.left=`${Math.round($)}px`,w.style.top=`${Math.round(J)}px`,Vt&&Vt.classList.contains("is-open")&&Bi&&Fn(Bi),ct&&ct.classList.contains("is-open")&&Ti&&fn(Ti),bt&&bt.classList.contains("is-open")&&Di&&jn(Di),Ut&&Ut.classList.contains("is-open")&&Wi&&zn(Wi),ti&&ti.classList.contains("is-open")&&Mi&&Qn(Mi),Ue&&Ue.classList.contains("is-open")&&Hi&&Nn(Hi)},Bn=R=>{if(!H||!R)return;let D=R.getBoundingClientRect(),N=H.getBoundingClientRect(),X=N.width||420,Z=N.height||0,se=window.innerWidth,re=window.innerHeight,K=12,$=D.right+10;$+X>se-K&&($=D.left-X-10),$=Math.max(K,Math.min($,se-X-K));let J=D.top;J+Z>re-K&&(J=re-Z-K),J=Math.max(K,J),H.style.left=`${Math.round($)}px`,H.style.top=`${Math.round(J)}px`},no=R=>{if(!I)return;let D=Array.from(I.querySelectorAll("[data-aipkit-settings-panel]"));if(!D.length)return;let N=R||"root",X=I.querySelector(`[data-aipkit-settings-panel="${N}"]`)||I.querySelector('[data-aipkit-settings-panel="root"]');if(!X)return;let Z=X.dataset.aipkitSettingsPanel||"root";if(Z!==M&&((()=>{Vt&&(Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true")),Bi&&(Bi.setAttribute("aria-expanded","false"),Bi=null),ct&&(ct.classList.remove("is-open"),ct.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),di&&(di.classList.remove("is-open"),di.setAttribute("aria-hidden","true")),Pi&&(Pi.setAttribute("aria-expanded","false"),Pi=null),bt&&(bt.classList.remove("is-open"),bt.setAttribute("aria-hidden","true")),Di&&(Di.setAttribute("aria-expanded","false"),Di=null),Ut&&(Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true")),Wi&&(Wi.setAttribute("aria-expanded","false"),Wi=null),ti&&(ti.classList.remove("is-open"),ti.setAttribute("aria-hidden","true")),Mi&&(Mi.setAttribute("aria-expanded","false"),Mi=null),Ue&&(Ue.classList.remove("is-open"),Ue.setAttribute("aria-hidden","true")),Hi&&(Hi.setAttribute("aria-expanded","false"),Hi=null),fi&&(fi.classList.remove("is-open"),fi.setAttribute("aria-hidden","true")),Ji&&(Ji.setAttribute("aria-expanded","false"),Ji=null),wi&&(wi.classList.remove("is-open"),wi.setAttribute("aria-hidden","true")),Ui&&(Ui.setAttribute("aria-expanded","false"),Ui=null)})(),M=Z),D.forEach(re=>{re.hidden=re!==X}),C){let re={root:I.dataset.titleRoot||"Settings",appearance:I.dataset.titleAppearance||"Appearance",behavior:I.dataset.titleBehavior||"Behavior",context:I.dataset.titleContext||"Context",tools:I.dataset.titleTools||"Tools",safety:I.dataset.titleSafety||"Safety",limits:I.dataset.titleLimits||"Limits"};C.textContent=re[Z]||re.root}b&&(b.hidden=Z==="root"),x&&(x.hidden=Z!=="root"),Z==="behavior"&&j(X),Z==="limits"&&po(),I.classList.contains("aipkit-active")&&T&&window.requestAnimationFrame(()=>{un(T)})},Fn=R=>{if(!Vt||!R)return;let D=R.getBoundingClientRect(),N=w?w.getBoundingClientRect():null,X=N&&N.width>0&&N.height>0,Z=Vt.getBoundingClientRect(),se=Z.width||320,re=Z.height||260,K=window.innerWidth,$=window.innerHeight,J=12,oe=(N?N.right:D.right)+8;oe+se>K-J&&(oe=(N?N.left:D.left)-se-8),oe=Math.max(J,Math.min(oe,K-se-J));let he=N?N.top:D.top-8;he+re>$-J&&(he=$-re-J),he<J&&(he=J),Vt.style.left=`${Math.round(oe)}px`,Vt.style.top=`${Math.round(he)}px`},fn=R=>{if(!ct||!R)return;let D=R.getBoundingClientRect(),N=w?w.getBoundingClientRect():null,X=ct.getBoundingClientRect(),Z=X.width||340,se=X.height||220,re=window.innerWidth,K=window.innerHeight,$=12,J=(N?N.right:D.right)+8;J+Z>re-$&&(J=(N?N.left:D.left)-Z-8),J=Math.max($,Math.min(J,re-Z-$));let oe=N?N.top:D.top-8;oe+se>K-$&&(oe=K-se-$),oe<$&&(oe=$),ct.style.left=`${Math.round(J)}px`,ct.style.top=`${Math.round(oe)}px`},oo=R=>{if(!li||!R)return;let D=R.getBoundingClientRect(),N=H?H.getBoundingClientRect():null,X=li.getBoundingClientRect(),Z=X.width||320,se=X.height||240,re=window.innerWidth,K=window.innerHeight,$=12,J=(usePanelRect?N.right:D.right)+8;J+Z>re-$&&(J=(usePanelRect?N.left:D.left)-Z-8),J=Math.max($,Math.min(J,re-Z-$));let oe=usePanelRect?N.top:D.top-8;oe+se>K-$&&(oe=K-se-$),oe<$&&(oe=$),li.style.left=`${Math.round(J)}px`,li.style.top=`${Math.round(oe)}px`},Wt=R=>{if(!fi||!R)return;let D=R.getBoundingClientRect(),N=w?w.getBoundingClientRect():null,X=fi.getBoundingClientRect(),Z=X.width||400,se=X.height||240,re=window.innerWidth,K=window.innerHeight,$=12,J=(N?N.right:D.right)+8;J+Z>re-$&&(J=(N?N.left:D.left)-Z-8),J=Math.max($,Math.min(J,re-Z-$));let oe=N?N.top:D.top-8;oe+se>K-$&&(oe=K-se-$),oe<$&&(oe=$),fi.style.left=`${Math.round(J)}px`,fi.style.top=`${Math.round(oe)}px`},ao=R=>{if(!di||!R)return;let D=R.getBoundingClientRect(),N=w?w.getBoundingClientRect():null,X=N&&N.width>0&&N.height>0,se=di.getBoundingClientRect().width||400,re=window.innerWidth,K=window.innerHeight,$=12,J=(X?N.right:D.right)+8;J+se>re-$&&(J=(X?N.left:D.left)-se-8),J=Math.max($,Math.min(J,re-se-$));let oe=X?K-N.bottom:K-D.bottom,he=Math.max($,oe);di.style.left=`${Math.round(J)}px`,di.style.top="auto",di.style.bottom=`${Math.round(he)}px`},$n=R=>{if(!wi||!R)return;let D=R.getBoundingClientRect();if(D.width===0&&D.height===0&&e){let Pe=e.querySelector('.aipkit_theme_choice_card input[name="theme"][value="custom"]')?.closest(".aipkit_theme_choice_card");if(Pe){let pt=Pe.getBoundingClientRect();(pt.width>0||pt.height>0)&&(D=pt)}}let N=w?w.getBoundingClientRect():null,X=N&&N.width>0&&N.height>0,Z=wi.getBoundingClientRect(),se=Z.width||400,re=Z.height||260,K=window.innerWidth,$=window.innerHeight,J=12,oe=(X?N.right:D.right)+8;oe+se>K-J&&(oe=(X?N.left:D.left)-se-8),oe=Math.max(J,Math.min(oe,K-se-J));let he=X?N.top:D.top-8;he+re>$-J&&(he=$-re-J),he<J&&(he=J),wi.style.left=`${Math.round(oe)}px`,wi.style.top=`${Math.round(he)}px`},jn=R=>{if(!bt||!R)return;let D=w?w.getBoundingClientRect():null,N=R.getBoundingClientRect(),X=bt.querySelector(".aipkit-modal-content"),Z=X?X.getBoundingClientRect():null,se=Z?Z.width:520,re=window.innerWidth,K=window.innerHeight,$=12,J=(D?D.right:N.right)+8;J+se>re-$&&(J=(D?D.left:N.left)-se-8),J=Math.max($,Math.min(J,re-se-$));let oe=D?K-D.bottom:$,he=Math.max($,oe);bt.style.left=`${Math.round(J)}px`,bt.style.top="auto",bt.style.bottom=`${Math.round(he)}px`},zn=R=>{if(!Ut||!R)return;let D=w?w.getBoundingClientRect():null,N=R.getBoundingClientRect(),X=Ut.querySelector(".aipkit-modal-content"),Z=X?X.getBoundingClientRect():null,se=Z?Z.width:560,re=window.innerWidth,K=12,$=(D?D.right:N.right)+8;$+se>re-K&&($=(D?D.left:N.left)-se-8),$=Math.max(K,Math.min($,re-se-K));let J=D?D.top:K;Ut.style.left=`${Math.round($)}px`,Ut.style.top=`${Math.round(J)}px`},Qn=R=>{if(!ti||!R)return;let D=w?w.getBoundingClientRect():null,N=R.getBoundingClientRect(),X=ti.querySelector(".aipkit-modal-content"),Z=X?X.getBoundingClientRect():null,se=Z?Z.width:620,re=Z?Z.height:400,K=window.innerWidth,$=12,J=(D?D.right:N.right)+8;J+se>K-$&&(J=(D?D.left:N.left)-se-8),J=Math.max($,Math.min(J,K-se-$));let oe=D?D.bottom-re:N.top-12;oe<$&&(oe=$),ti.style.left=`${Math.round(J)}px`,ti.style.top=`${Math.round(oe)}px`},Nn=R=>{if(!Ue||!R)return;let D=w?w.getBoundingClientRect():null,N=R.getBoundingClientRect(),X=Ue.querySelector(".aipkit-modal-content"),Z=X?X.getBoundingClientRect():null,se=Z?Z.width:520,re=window.innerWidth,K=window.innerHeight,$=12,J=(D?D.right:N.right)+8;J+se>re-$&&(J=(D?D.left:N.left)-se-8),J=Math.max($,Math.min(J,re-se-$));let oe=D?K-D.bottom:$,he=Math.max($,oe);Ue.style.left=`${Math.round(J)}px`,Ue.style.top="auto",Ue.style.bottom=`${Math.round(he)}px`},ro=R=>{!I||!w||!R||(y&&y.classList.contains("aipkit-active")&&(y.classList.remove("aipkit-active"),y.setAttribute("aria-hidden","true")),P&&P.classList.contains("aipkit-active")&&An(),no("root"),T=R,I.classList.add("aipkit-active"),I.setAttribute("aria-hidden","false"),R.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_model_settings_popover"),j(w),hn(),Y(),lo(),window.requestAnimationFrame(()=>{un(R)}))},mn=()=>{I&&(no("root"),bt&&(bt.classList.remove("is-open"),bt.setAttribute("aria-hidden","true")),Di&&(Di.setAttribute("aria-expanded","false"),Di=null),Ut&&(Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true")),Wi&&(Wi.setAttribute("aria-expanded","false"),Wi=null),ti&&(ti.classList.remove("is-open"),ti.setAttribute("aria-hidden","true")),Mi&&(Mi.setAttribute("aria-expanded","false"),Mi=null),Ue&&(Ue.classList.remove("is-open"),Ue.setAttribute("aria-hidden","true")),Hi&&(Hi.setAttribute("aria-expanded","false"),Hi=null),Vt&&(Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true")),Bi&&(Bi.setAttribute("aria-expanded","false"),Bi=null),ct&&(ct.classList.remove("is-open"),ct.setAttribute("aria-hidden","true")),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null),di&&(di.classList.remove("is-open"),di.setAttribute("aria-hidden","true")),Pi&&(Pi.setAttribute("aria-expanded","false"),Pi=null),I.classList.remove("aipkit-active"),I.setAttribute("aria-hidden","true"),T&&T.setAttribute("aria-expanded","false"),T=null)},Ho=R=>{!P||!H||!R||(y&&y.classList.contains("aipkit-active")&&(y.classList.remove("aipkit-active"),y.setAttribute("aria-hidden","true")),I&&I.classList.contains("aipkit-active")&&mn(),F=R,P.classList.add("aipkit-active"),P.setAttribute("aria-hidden","false"),R.setAttribute("aria-expanded","true"),window.requestAnimationFrame(()=>{Bn(R)}))},An=()=>{P&&(Dn(),P.classList.remove("aipkit-active"),P.setAttribute("aria-hidden","true"),F&&(F.setAttribute("aria-expanded","false"),F=null))},xo=()=>{if(!w)return;let R=e.querySelector(".aipkit_chatbot_provider_select"),D=R?R.value:"",N=ke("web_search_plugin"),X=w.querySelector(".aipkit_web_search_toggle_openai"),Z=w.querySelector(".aipkit_web_search_toggle_google"),se=w.querySelector(".aipkit_web_search_toggle_claude"),re=w.querySelector(".aipkit_web_search_toggle_openrouter");X&&(X.style.display=D==="OpenAI"?"":"none"),Z&&(Z.style.display=D==="Google"?"":"none"),se&&(se.style.display=D==="Claude"?"":"none"),re&&(re.style.display=D==="OpenRouter"?"":"none");let K=w.querySelector(".aipkit_openai_web_search_enable_toggle"),$=w.querySelector(".aipkit_google_search_grounding_enable_toggle"),J=w.querySelector(".aipkit_claude_web_search_enable_toggle"),oe=w.querySelector(".aipkit_openrouter_web_search_enable_toggle"),he=w.querySelector('.aipkit_web_search_config_btn[data-web-provider="openai"]'),Pe=w.querySelector('.aipkit_web_search_config_btn[data-web-provider="google"]'),pt=w.querySelector('.aipkit_web_search_config_btn[data-web-provider="claude"]'),ri=w.querySelector('.aipkit_web_search_config_btn[data-web-provider="openrouter"]'),Yt=ft=>ft?ft.tagName==="SELECT"?ft.value==="1":ft.type==="checkbox"?ft.checked:ft.value==="1":!1;if(he&&(he.style.display=Yt(K)?"":"none"),Pe&&(Pe.style.display=Yt($)?"":"none"),pt&&(pt.style.display=Yt(J)?"":"none"),ri&&(ri.style.display=N&&Yt(oe)?"":"none"),re&&oe){let ft=D==="OpenRouter"&&!N;ft&&Yt(oe)&&(oe.tagName==="SELECT"?oe.value="0":oe.type==="checkbox"?oe.checked=!1:oe.value="0",oe.dispatchEvent(new Event("change",{bubbles:!0}))),ye(re,oe,ft,t("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"))}},hn=()=>{let R=K=>K?K.tagName==="SELECT"?K.value==="1":K.type==="checkbox"?K.checked:K.value==="1":!1,D=K=>{if(!K)return;let $=w&&w.querySelector(".aipkit_claude_web_search_enable_toggle")||K.querySelector(".aipkit_claude_web_search_enable_toggle"),J=R($),oe=K.querySelector(".aipkit_claude_web_search_conditional_settings");oe&&(oe.style.display=J?"":"none");let he=K.querySelector(".aipkit_claude_web_search_loc_type_select"),Pe=K.querySelector(".aipkit_claude_web_search_location_details");Pe&&(Pe.style.display=J&&he&&he.value==="approximate"?"":"none")},N=(K,$)=>{if(!K)return;let J=w&&w.querySelector(".aipkit_openrouter_web_search_enable_toggle")||K.querySelector(".aipkit_openrouter_web_search_enable_toggle"),oe=$&&R(J);!$&&J&&R(J)&&(J.tagName==="SELECT"?J.value="0":J.type==="checkbox"?J.checked=!1:J.value="0",J.dispatchEvent(new Event("change",{bubbles:!0})));let he=K.querySelector(".aipkit_openrouter_web_search_conditional_settings");he&&(he.style.display=oe?"":"none")},X=e.querySelector(".aipkit_chatbot_provider_select"),Z=X?X.value:"",se=ke("web_search_plugin"),re=bt||y;if(re){let K=re.querySelector(".aipkit_web_modal_section_openai"),$=re.querySelector(".aipkit_web_modal_section_google"),J=re.querySelector(".aipkit_web_modal_section_claude"),oe=re.querySelector(".aipkit_web_modal_section_openrouter");K&&(K.style.display=Z==="OpenAI"?"":"none"),$&&($.style.display=Z==="Google"?"":"none"),J&&(J.style.display=Z==="Claude"?"":"none"),oe&&(oe.style.display=Z==="OpenRouter"&&se?"":"none"),typeof window.aipkit_toggleOpenAIWebSearchSubSettings=="function"&&window.aipkit_toggleOpenAIWebSearchSubSettings(re),typeof window.aipkit_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkit_toggleOpenAIWebSearchLocationDetails(re),typeof window.aipkit_toggleGoogleSearchGroundingSubSettings=="function"&&window.aipkit_toggleGoogleSearchGroundingSubSettings(re),typeof window.aipkit_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkit_toggleGoogleGroundingDynamicThreshold(re),D(re),N(re,se)}xo()},Vo=()=>{let R=w&&w.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");return R?R.tagName==="SELECT"?R.value==="1"?"1":"0":R.checked?"1":"0":"0"},so=()=>{if(!w)return"0";let R=w.querySelector(".aipkit_file_upload_toggle_select");return!R||R.disabled?"0":R.tagName==="SELECT"?R.value==="1"?"1":"0":R.checked?"1":"0"},Vi=()=>Gn||Ut,Ao=()=>Gi||ti,nn=()=>{let R=Vi();return R?{providerSelect:R.querySelector('[name="vector_store_provider"]'),openaiStoresSelect:R.querySelector('select[name="openai_vector_store_ids[]"]'),pineconeIndexSelect:R.querySelector('[name="pinecone_index_name"]'),qdrantCollectionsSelect:R.querySelector('select[name="qdrant_collection_names[]"]'),pineconeKeyInput:R.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:R.querySelector('[name="qdrant_url"]'),qdrantKeyInput:R.querySelector('[name="qdrant_api_key"]')}:{}},qo=R=>R?Array.from(R.options).filter(D=>!D.disabled&&D.value):[],yn=R=>R?(R.selectedOptions?Array.from(R.selectedOptions):[]).some(N=>!N.disabled&&N.value):!1,co=R=>{if(!R)return!1;let D=R.options[R.selectedIndex];if(D&&!D.disabled&&D.value)return!0;let N=qo(R)[0];return N?(R.value=N.value,R.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},On=R=>{if(!R)return!1;if(yn(R))return!0;let D=qo(R)[0];return D?(D.selected=!0,R.dispatchEvent(new Event("change",{bubbles:!0})),!0):!1},qn=R=>{if(!w)return;let D=w.querySelector(".aipkit_vector_store_popover_row .aipkit_popover_warning");if(D){if(!R){D.classList.remove("is-visible"),D.setAttribute("aria-hidden","true"),D.setAttribute("data-tooltip",""),D.removeAttribute("aria-label");return}D.classList.add("is-visible"),D.setAttribute("aria-hidden","false"),D.setAttribute("data-tooltip",R),D.setAttribute("aria-label",R)}},dn=()=>{if(so()!=="1"){qn("");return}let{providerSelect:R,openaiStoresSelect:D,pineconeIndexSelect:N,qdrantCollectionsSelect:X,pineconeKeyInput:Z,qdrantUrlInput:se,qdrantKeyInput:re}=nn(),K=R?R.value:"",$=e.querySelector(".aipkit_chatbot_provider_select"),J=$?$.value:"",oe=!!(Z&&Z.value.trim()),he=!!(se&&se.value.trim()),Pe=!!(re&&re.value.trim()),pt=yn(D),ri=yn(N),Yt=yn(X),ft="";K?K==="openai"?d?pt||(ft="No OpenAI vector stores found. Create a vector store."):ft="Add your OpenAI API key to enable OpenAI vector stores.":K==="pinecone"?oe?ri||(ft="No Pinecone indexes found. Create an index."):ft="Add your Pinecone API key to enable Pinecone.":K==="qdrant"?!he&&!Pe?ft="Add your Qdrant URL and API key to enable Qdrant.":he?Pe?Yt||(ft="No Qdrant collections found. Create a collection."):ft="Add your Qdrant API key to enable Qdrant.":ft="Add your Qdrant URL to enable Qdrant.":K==="claude_files"?J!=="Claude"?ft="Claude Files requires the chatbot provider to be Claude.":g||(ft="Add your Claude API key to enable Claude Files."):ft="Select and configure a vector provider to use file uploads.":ft="Select and configure a vector provider to use file uploads.",qn(ft)},Io=()=>{let R=Vi();if(!w||!R)return;let D=w.querySelector(".aipkit_vector_store_enable_select");D&&!D.checked&&(D.checked=!0,D.dispatchEvent(new Event("change",{bubbles:!0})));let{providerSelect:N,openaiStoresSelect:X,pineconeIndexSelect:Z,qdrantCollectionsSelect:se,pineconeKeyInput:re,qdrantUrlInput:K,qdrantKeyInput:$}=nn(),J=!!(re&&re.value.trim()),oe=!!(K&&K.value.trim()),he=!!($&&$.value.trim()),Pe="";d?Pe="openai":J?Pe="pinecone":(he||oe)&&(Pe="qdrant"),N&&Pe&&N.value!==Pe&&(N.value=Pe,N.dispatchEvent(new Event("change",{bubbles:!0}))),Pe==="openai"?On(X):Pe==="pinecone"?co(Z):Pe==="qdrant"&&On(se),dn()},Lo=()=>{let R=Vi();if(!R)return!1;let D=R.querySelector('[name="vector_store_provider"]');if(!D)return!1;let N=e.querySelector(".aipkit_chatbot_provider_select"),Z=(N?N.value:"")==="Claude",se=Array.from(D.options||[]).find($=>$&&$.value==="claude_files");if(!se)return!1;let re=!Z,K=!1;if(se.disabled!==re&&(se.disabled=re,K=!0),re&&D.value==="claude_files"){let $=Array.from(D.options||[]).find(oe=>oe&&oe.value&&!oe.disabled&&oe.value!=="claude_files"),J=$?$.value:"openai";if(D.value!==J)return D.value=J,D.dispatchEvent(new Event("change",{bubbles:!0})),!0}return K&&typeof window.aipkit_refreshChatSelectPickers=="function"&&window.aipkit_refreshChatSelectPickers(),!1},Jn=()=>{if(!w)return;let R=w.querySelector(".aipkit_file_upload_toggle_select");if(!R)return;let D=R.closest(".aipkit_popover_option_row"),N=D?D.querySelector(".aipkit_popover_option_label"):null,X=R.dataset.isProPlan==="true",Z=X,se=R.dataset.tooltipDefault||"",re=Vi(),K=re?re.querySelector('[name="vector_store_provider"]'):null,$=K?K.value:"",J=e.querySelector(".aipkit_chatbot_provider_select"),oe=J?J.value:"";if(Lo())return;X?$==="claude_files"&&oe!=="Claude"&&(se="Claude Files requires the chatbot provider to be Claude.",Z=!1):(se=R.dataset.tooltipUpgrade||se,Z=!1),D&&D.classList.toggle("aipkit_popover_option_row--disabled",!Z),R.disabled=!Z,N&&N.setAttribute("data-tooltip",se);let he=R.tagName==="SELECT"?R.value==="1":R.checked;!Z&&he&&(R.tagName==="SELECT"?R.value="0":R.checked=!1,R.dispatchEvent(new Event("change",{bubbles:!0})))},rn=()=>{let R=Vi();R&&(typeof window.aipkit_toggleVectorStoreSettingsVisibility=="function"&&window.aipkit_toggleVectorStoreSettingsVisibility(R),typeof window.aipkit_toggleVectorStoreProviderFields=="function"&&window.aipkit_toggleVectorStoreProviderFields(R))},lo=()=>{if(!w)return;let R=Vo()==="1",D=w.querySelector(".aipkit_file_upload_toggle_select");!R&&D&&!D.disabled&&(D.tagName==="SELECT"?D.value==="1":D.checked)&&(D.tagName==="SELECT"?D.value="0":D.checked=!1,D.dispatchEvent(new Event("change",{bubbles:!0}))),rn(),Jn(),dn()},po=()=>{let R=Ao();if(!R)return;let D=R.querySelector(".aipkit_token_limit_mode_select"),N=R.querySelector(".aipkit_token_general_user_limit_field"),X=R.querySelector(".aipkit_token_role_limits_container");if(!D||!N||!X)return;let Z=D.value;N.style.display=Z==="general"?"block":"none",X.style.display=Z==="role_based"?"block":"none"},Yn=()=>{if(!Ue)return;let R=Ue.querySelector(".aipkit_voice_input_toggle_switch"),D=At=>At?At.tagName==="SELECT"?At.value==="1":At.type==="checkbox"?At.checked:At.value==="1":!1,N=Ue.querySelector(".aipkit_stt_provider_conditional_row"),X=Ue.querySelector(".aipkit_stt_provider_row"),Z=X&&X.dataset.sttControlsHidden==="1";if(R){let At=D(R);if(X&&(X.style.display=At&&!Z?"block":"none"),N&&(N.style.display=At&&!Z?"flex":"none"),At&&Z&&X){let Zt=X.dataset.sttDefaultProvider,hi=X.dataset.sttDefaultModel,xi=Ue.querySelector(".aipkit_stt_provider_select"),Ct=Ue.querySelector('[name="stt_openai_model_id"]'),ei=(Bt,pi,Ei)=>{if(!Bt||!pi)return;if(!Array.from(Bt.options).some(qe=>qe.value===pi)){let qe=new Option(Ei||pi,pi,!0,!0);Bt.add(qe)}Bt.value=pi};ei(xi,Zt),ei(Ct,hi,"whisper-1")}}typeof window.aipkit_toggleSttModelFields=="function"&&window.aipkit_toggleSttModelFields(Ue);let se=Ue.querySelector(".aipkit_tts_toggle_switch"),re=Ue.querySelector(".aipkit_tts_conditional_settings"),K=Ue.querySelector(".aipkit_tts_provider_row"),$=Ue.querySelector(".aipkit_tts_auto_play_container"),J=!1;se&&(J=D(se),K&&(K.style.display=J?"block":"none"),re&&(re.style.display=J?"flex":"none"),$&&($.style.display=J?"block":"none"));let oe=Ue.querySelector(".aipkit_tts_provider_select");if(oe){let At=oe.value;Ue.querySelectorAll(".aipkit_tts_field").forEach(Bt=>{let pi=Bt.getAttribute("data-provider");Bt.style.display=J&&pi===At?"block":"none"});let Zt=Ue.querySelector(".aipkit_tts_google_voice_inline"),hi=Ue.querySelector(".aipkit_tts_openai_voice_inline"),xi=Ue.querySelector(".aipkit_tts_openai_model_inline"),Ct=Ue.querySelector(".aipkit_tts_elevenlabs_voice_inline"),ei=Ue.querySelector(".aipkit_tts_elevenlabs_model_inline");Zt&&(Zt.style.display=J&&At==="Google"?"block":"none"),hi&&(hi.style.display=J&&At==="OpenAI"?"block":"none"),xi&&(xi.style.display=J&&At==="OpenAI"?"block":"none"),Ct&&(Ct.style.display=J&&At==="ElevenLabs"?"block":"none"),ei&&(ei.style.display=J&&At==="ElevenLabs"?"block":"none")}else if(J===!1){Ue.querySelectorAll(".aipkit_tts_field").forEach(ei=>{ei.style.display="none"});let At=Ue.querySelector(".aipkit_tts_google_voice_inline");At&&(At.style.display="none");let Zt=Ue.querySelector(".aipkit_tts_openai_voice_inline");Zt&&(Zt.style.display="none");let hi=Ue.querySelector(".aipkit_tts_openai_model_inline");hi&&(hi.style.display="none");let xi=Ue.querySelector(".aipkit_tts_elevenlabs_voice_inline");xi&&(xi.style.display="none");let Ct=Ue.querySelector(".aipkit_tts_elevenlabs_model_inline");Ct&&(Ct.style.display="none")}let he=Ue.querySelector(".aipkit_enable_realtime_voice_toggle"),Pe=Ue.querySelector(".aipkit_realtime_voice_settings_container"),pt=Ue.querySelector(".aipkit_realtime_voice_inline_controls"),ri=Ue.querySelector(".aipkit_realtime_voice_inline_row"),ft=Pe&&Pe.getAttribute("data-force-visible")==="1"||he&&D(he);Pe&&(Pe.style.display=ft?"block":"none"),ri&&(ri.style.display=ft?"block":"none"),pt&&(pt.style.display=ft?"flex":"none"),Ue.querySelectorAll(".aipkit_rt_dependent").forEach(At=>{At.style.display=ft?"":"none"})},Rn=()=>{if(!Fi)return;let R=Fi.querySelector('select[name="popup_icon_type"]');if(R){let K=Fi.querySelector(".aipkit_popup_icon_default_selector_container"),$=Fi.querySelector(".aipkit_popup_icon_custom_input_container");K&&(R.value==="default"?K.removeAttribute("hidden"):K.setAttribute("hidden","")),$&&(R.value==="custom"?$.removeAttribute("hidden"):$.setAttribute("hidden",""));let J=Fi.querySelectorAll('input[name="popup_icon_type"]');J.length&&J.forEach(oe=>{oe.checked=oe.value===R.value})}let D=Fi.querySelector('select[name="header_avatar_type"]');if(D){let K=Fi.querySelector(".aipkit_header_avatar_default_selector_container"),$=Fi.querySelector(".aipkit_header_avatar_custom_input_container");K&&(D.value==="default"?K.removeAttribute("hidden"):K.setAttribute("hidden","")),$&&(D.value==="custom"?$.removeAttribute("hidden"):$.setAttribute("hidden",""));let J=Fi.querySelectorAll('input[name="header_avatar_type"]');J.length&&J.forEach(oe=>{oe.checked=oe.value===D.value})}let N=Fi.querySelector('select[name="popup_icon_style"]');if(N){let K=Fi.querySelectorAll('input[name="popup_icon_style"]');K.length&&K.forEach($=>{$.checked=$.value===N.value})}let X=Fi.querySelector(".aipkit_popup_hint_toggle_switch"),Z=X?X.checked:!1,se=Fi.querySelector(".aipkit_popup_hint_config_btn");se&&(se.style.display=Z?"":"none",Z||se.setAttribute("aria-expanded","false")),!Z&&li&&li.classList.contains("is-open")&&Dn();let re=li||Fi;if(re){re.querySelectorAll(".aipkit_popup_hint_extra").forEach($=>{Z?$.removeAttribute("hidden"):$.setAttribute("hidden","")});let K=re.querySelector(".aipkit_popup_hint_conditional_row");K&&(Z?K.removeAttribute("hidden"):K.setAttribute("hidden",""))}},Dn=()=>{li&&(li.classList.remove("is-open"),li.setAttribute("aria-hidden","true"),an&&(an.setAttribute("aria-expanded","false"),an=null))},Xn=()=>{di&&(di.classList.remove("is-open"),di.setAttribute("aria-hidden","true"),Pi&&(Pi.setAttribute("aria-expanded","false"),Pi=null))},To=()=>{let R=wn||di;if(!R)return;let D=R.querySelector('input[name="enable_consent_compliance"]'),N=D?D.checked:!1;R.querySelectorAll(".aipkit_consent_field_row").forEach(X=>{N?X.removeAttribute("hidden"):X.setAttribute("hidden","")}),I&&I.classList.contains("aipkit-active")&&T&&requestAnimationFrame(()=>{un(T)})},Ki=()=>{let R=wn||di;if(!R)return;let D=R.querySelector('input[name="openai_moderation_enabled"]'),N=D?D.checked:!1;R.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(X=>{N?X.removeAttribute("hidden"):X.setAttribute("hidden","")}),I&&I.classList.contains("aipkit-active")&&T&&requestAnimationFrame(()=>{un(T)})},Uo=()=>{let R=wn||di;if(!R)return;let D=e.querySelector(".aipkit_chatbot_provider_select"),X=(D?D.value:"")==="OpenAI";if(R.querySelectorAll(".aipkit_openai_moderation_row").forEach(se=>{se.style.display=X?"":"none"}),X){Ki();return}R.querySelectorAll(".aipkit_openai_moderation_field_row").forEach(se=>{se.setAttribute("hidden","")})},_o=()=>{fi&&(fi.classList.remove("is-open"),fi.setAttribute("aria-hidden","true"),Ji&&(Ji.setAttribute("aria-expanded","false"),Ji=null))},In=()=>{wi&&(wi.classList.remove("is-open"),wi.setAttribute("aria-hidden","true"),Ui&&(Ui.setAttribute("aria-expanded","false"),Ui=null))},Po=R=>{if(!wi||!R)return;wi.classList.contains("is-open")||(wi.classList.add("is-open"),wi.setAttribute("aria-hidden","false")),Ui&&Ui!==R&&Ui.setAttribute("aria-expanded","false"),R.setAttribute&&R.setAttribute("aria-expanded","true"),Ui=R,window.requestAnimationFrame(()=>{$n(R)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_custom_theme_flyout")},j=R=>{if(!R)return;let D=R.querySelector(".aipkit_reasoning_effort_slider"),N=R.querySelector(".aipkit_reasoning_effort_label"),X=R.querySelector('input[name="reasoning_effort"]');if(!D||!N||!X)return;let Z=()=>{let se=[],re=[];try{D.dataset.reasoningValues&&(se=JSON.parse(D.dataset.reasoningValues)),D.dataset.reasoningLabels&&(re=JSON.parse(D.dataset.reasoningLabels))}catch{se=[],re=[]}(!Array.isArray(se)||se.length===0)&&(se=["none","low","medium","high","xhigh"]),(!Array.isArray(re)||re.length===0)&&(re=se.slice());let K=parseInt(D.value,10),$=Number.isNaN(K)?0:Math.min(se.length-1,Math.max(0,K)),J=se[$]||se[0],oe=re[$]||J;X.value=J,N.textContent=oe};Z(),D.dataset.reasoningBound||(D.addEventListener("input",Z),D.addEventListener("change",Z),D.dataset.reasoningBound="1")},Y=()=>{if(!w)return;let R=e.querySelector(".aipkit_chatbot_provider_select"),D=R?R.value:"",N=D==="OpenAI",X=ke("image_input"),Z=D==="OpenAI"||D==="Claude"||D==="OpenRouter"&&X,se=w.querySelector(".aipkit_stateful_convo_checkbox"),re=w.querySelector(".aipkit_stateful_convo_group");se&&(se.disabled=!N),re&&(re.style.display=N?"":"none",re.removeAttribute("title"));let K=w&&w.querySelector(".aipkit_reasoning_effort_field")||Vt&&Vt.querySelector(".aipkit_reasoning_effort_field");K&&(K.style.display=N?"":"none");let $=w&&w.querySelector(".aipkit_image_analysis_popover_row")||ct&&ct.querySelector(".aipkit_image_analysis_popover_row");if($&&($.style.display=Z?"":"none"),D==="OpenRouter"&&!X){let he=ct&&ct.querySelector(".aipkit_image_analysis_select")||w&&w.querySelector(".aipkit_image_analysis_select")||y.querySelector(".aipkit_image_analysis_select"),Pe=ct&&ct.querySelector(".aipkit_image_analysis_checkbox")||w&&w.querySelector(".aipkit_image_analysis_checkbox")||y.querySelector(".aipkit_image_analysis_checkbox");he&&he.value!=="0"?(he.value="0",he.dispatchEvent(new Event("change",{bubbles:!0}))):Pe&&Pe.checked&&(Pe.checked=!1,Pe.dispatchEvent(new Event("change",{bubbles:!0})))}typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(Vt||w);let J=w.querySelector(".aipkit_model_settings_panel:not([hidden])"),oe=J?J.querySelector(".aipkit_popover_options_list"):w.querySelector(".aipkit_popover_options_list");if(oe){let he=oe.querySelectorAll(".aipkit_popover_option_row");he.forEach(pt=>pt.classList.remove("aipkit_last_visible_row"));let Pe=null;he.forEach(pt=>{pt.style.display!=="none"&&(Pe=pt)}),Pe&&Pe.classList.add("aipkit_last_visible_row")}I&&I.classList.contains("aipkit-active")&&T&&un(T)};if(e.dataset.shortcodeCopyBound||(e.addEventListener("click",R=>{let D=R.target.closest(".aipkit_shortcode_pill");if(!D)return;let N=D.dataset.shortcode||D.querySelector(".aipkit_shortcode_text")?.textContent||"";N&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(N,D)}),e.dataset.shortcodeCopyBound="1"),e.dataset.embedCopyBound||(e.addEventListener("click",R=>{let D=R.target.closest(".aipkit_copy_embed_code_btn");if(!D)return;let N=D.dataset.target;if(!N)return;let X=document.getElementById(N);if(!X)return;let Z=X.value||X.textContent||"";Z&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(Z,D)}),e.dataset.embedCopyBound="1"),I&&e.querySelectorAll(".aipkit_cb_ai_settings_toggle").forEach(D=>{D.classList.add("aipkit_model_settings_popover_trigger"),D.setAttribute("aria-haspopup","dialog"),D.setAttribute("aria-expanded","false"),D.setAttribute("aria-controls","aipkit_model_settings_popover"),D.setAttribute("aria-label",io),D.setAttribute("title",io)}),m){let R=m.value||"";m.addEventListener("change",()=>{let D=m.value;if(D){if(D==="__new__"){typeof S=="function"&&S();let N=R||e.getAttribute("data-active-bot-id")||"";if(N)m.value=N;else{let X=Array.from(m.options).find(Z=>Z.value&&Z.value!=="__new__"&&!Z.disabled);X&&(m.value=X.value,R=X.value)}return}R=D;try{localStorage.setItem(k,D)}catch(N){console.warn("AIPKit Chat Builder: Failed to store selected chatbot:",N)}typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:D,layout:n})}})}if(h&&!h.dataset.bound){let R=h.querySelector("#aipkit_new_bot_name");S=()=>{h.classList.add("aipkit-active"),h.setAttribute("aria-hidden","false"),R&&R.focus()};let D=()=>{h.classList.remove("aipkit-active"),h.setAttribute("aria-hidden","true")};v&&v.addEventListener("click",S),q&&q.addEventListener("click",D),h.addEventListener("click",N=>{N.target===h&&D()}),document.addEventListener("keydown",N=>{N.key==="Escape"&&h.classList.contains("aipkit-active")&&D()}),h.dataset.bound="1"}if(ne&&z&&!z.dataset.bound){let R=()=>{if(ne.disabled)return;let N=m&&m.options[m.selectedIndex]?.text||"";Ae&&(Ae.value=N,Ae.focus(),Ae.select()),ze&&(ze.textContent="",ze.className="aipkit_form-help"),z.classList.add("aipkit-active"),z.setAttribute("aria-hidden","false")},D=()=>{z.classList.remove("aipkit-active"),z.setAttribute("aria-hidden","true")};ne.addEventListener("click",R),ge&&ge.addEventListener("click",D),z.addEventListener("click",N=>{N.target===z&&D()}),document.addEventListener("keydown",N=>{N.key==="Escape"&&z.classList.contains("aipkit-active")&&D()}),ot&&ot.addEventListener("click",()=>{let N=m&&m.value||e.getAttribute("data-active-bot-id"),X=Ae?Ae.value.trim():"";if(!N||!X){ze&&(ze.textContent=X===""?"Please enter a bot name.":"Select a bot to rename.",ze.className="aipkit_form-help aipkit_form-help-error");return}if(typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(ot,"Saving..."),ot.disabled=!0,typeof window.aipkit_apiRequest!="function"){ze&&(ze.textContent="API unavailable.",ze.className="aipkit_form-help aipkit_form-help-error"),ot.disabled=!1;return}window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:N,new_name:X}).then(Z=>{let se=Z.new_name||X;if(m){let re=m.options[m.selectedIndex];re&&(re.text=se)}ze&&(ze.textContent=Z.message||"Renamed successfully.",ze.className="aipkit_form-help aipkit_form-help-success"),D()}).catch(Z=>{ze&&(ze.textContent=Z.message||"Could not rename the bot.",ze.className="aipkit_form-help aipkit_form-help-error")}).finally(()=>{ot.disabled=!1,typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(ot,"Save Name"):ot.textContent="Save Name"})}),z.dataset.bound="1"}if(y&&!e.dataset.sheetBound){let R=N=>{if(!y)return;I&&I.classList.contains("aipkit-active")&&mn(),P&&P.classList.contains("aipkit-active")&&An();let X=N.dataset.sheetTitle||"Sheet",Z=N.dataset.sheetDescription||"Settings will appear here.",se=N.dataset.sheetContent||"placeholder";if(B&&(B.textContent=X),V&&(V.textContent=Z),U.length){let re=!1;U.forEach(K=>{let $=K.dataset.sheet===se;K.hidden=!$,$&&(re=!0)}),!re&&W&&(W.hidden=!1)}if(fe&&(fe.textContent="",fe.classList.remove("success","error","loading"),fe.style.display="none"),se==="triggers"&&typeof window.aipkit_initTriggerBuilderUI=="function"){let re=m&&m.value||e.getAttribute("data-active-bot-id");re&&window.aipkit_initTriggerBuilderUI(re)}y.classList.add("aipkit-active"),y.setAttribute("aria-hidden","false"),ee&&ee.focus(),se==="sources"&&typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_sheet"),hn(),Yn(),Y(),Rn()},D=()=>{y.classList.remove("aipkit-active"),y.setAttribute("aria-hidden","true")};e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_builder_sheet_trigger");X&&(N.preventDefault(),R(X))}),ee&&ee.addEventListener("click",D),y.addEventListener("click",N=>{N.target===y&&D()}),document.addEventListener("keydown",N=>{N.key==="Escape"&&y.classList.contains("aipkit-active")&&D()}),e.dataset.sheetBound="1"}if(I&&!e.dataset.modelPopoverBound){e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_model_settings_popover_trigger");if(X){if(N.preventDefault(),N.stopPropagation(),I.classList.contains("aipkit-active")&&T===X){mn();return}ro(X)}}),e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_deploy_settings_trigger");if(X){if(N.preventDefault(),N.stopPropagation(),P&&P.classList.contains("aipkit-active")&&F===X){An();return}Ho(X)}}),e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_style_settings_trigger");if(!X)return;N.preventDefault(),N.stopPropagation();let Z=X.dataset.aipkitPanelTarget||"appearance";no(Z)}),e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_popover_params_config_btn");if(!X||(N.preventDefault(),!Vt))return;let Z=!Vt.classList.contains("is-open");Vt.classList.toggle("is-open",Z),Vt.setAttribute("aria-hidden",Z?"false":"true"),Bi&&Bi!==X&&Bi.setAttribute("aria-expanded","false"),X.setAttribute("aria-expanded",Z?"true":"false"),Bi=Z?X:null,Z&&(window.requestAnimationFrame(()=>{Fn(X)}),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_parameters_flyout"),j(Vt),typeof window.aipkit_toggleReasoningEffort=="function"&&window.aipkit_toggleReasoningEffort(Vt))}),e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_image_settings_config_btn");if(!X||(N.preventDefault(),!ct))return;let Z=!ct.classList.contains("is-open");ct.classList.toggle("is-open",Z),ct.setAttribute("aria-hidden",Z?"false":"true"),Ti&&Ti!==X&&Ti.setAttribute("aria-expanded","false"),X.setAttribute("aria-expanded",Z?"true":"false"),Ti=Z?X:null,Z&&(window.requestAnimationFrame(()=>{fn(X)}),Kn())}),e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_popup_hint_config_btn");if(!X||(N.preventDefault(),!li))return;let Z=!li.classList.contains("is-open");li.classList.toggle("is-open",Z),li.setAttribute("aria-hidden",Z?"false":"true"),an&&an!==X&&an.setAttribute("aria-expanded","false"),X.setAttribute("aria-expanded",Z?"true":"false"),an=Z?X:null,Z&&window.requestAnimationFrame(()=>{oo(X)})}),e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_starters_config_btn");if(!X||(N.preventDefault(),!fi))return;let Z=!fi.classList.contains("is-open");fi.classList.toggle("is-open",Z),fi.setAttribute("aria-hidden",Z?"false":"true"),Ji&&Ji!==X&&Ji.setAttribute("aria-expanded","false"),X.setAttribute("aria-expanded",Z?"true":"false"),Ji=Z?X:null,Z&&window.requestAnimationFrame(()=>{Wt(X)})}),e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_security_privacy_config_btn");if(!X||(N.preventDefault(),!di))return;let Z=!di.classList.contains("is-open");di.classList.toggle("is-open",Z),di.setAttribute("aria-hidden",Z?"false":"true"),Pi&&Pi!==X&&Pi.setAttribute("aria-expanded","false"),X.setAttribute("aria-expanded",Z?"true":"false"),Pi=Z?X:null,Z&&(window.requestAnimationFrame(()=>{ao(X)}),To(),Uo())}),e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_theme_choice_card");if(!X)return;let Z=X.querySelector('input[name="theme"]');!Z||Z.disabled||Z.value!=="custom"||Po(X)});let R=()=>{ct&&(ct.classList.remove("is-open"),ct.setAttribute("aria-hidden","true"),Ti&&(Ti.setAttribute("aria-expanded","false"),Ti=null))};yo&&yo.addEventListener("click",N=>{N.preventDefault(),R()}),bo&&bo.addEventListener("click",N=>{N.preventDefault(),Dn()}),kn&&kn.addEventListener("click",N=>{N.preventDefault(),Xn()}),Un&&Un.addEventListener("click",N=>{N.preventDefault(),_o()}),Mn&&Mn.addEventListener("click",N=>{N.preventDefault(),In()}),document.addEventListener("click",N=>{!ct||!ct.classList.contains("is-open")||N.target.closest(".aipkit_image_settings_config_btn")||N.target.closest("#aipkit_image_settings_flyout")||R()}),document.addEventListener("click",N=>{!li||!li.classList.contains("is-open")||N.target.closest(".aipkit_popup_hint_config_btn")||N.target.closest("#aipkit_popup_hint_flyout")||Dn()}),document.addEventListener("click",N=>{!di||!di.classList.contains("is-open")||N.target.closest(".aipkit_security_privacy_config_btn")||N.target.closest("#aipkit_security_privacy_flyout")||Xn()}),document.addEventListener("click",N=>{!fi||!fi.classList.contains("is-open")||N.target.closest(".aipkit_starters_config_btn")||N.target.closest("#aipkit_starters_flyout")||_o()}),document.addEventListener("click",N=>{!wi||!wi.classList.contains("is-open")||N.target.closest(".aipkit_theme_choice_group")||N.target.closest("#aipkit_custom_theme_flyout")||In()});let D=()=>{Vt&&(Vt.classList.remove("is-open"),Vt.setAttribute("aria-hidden","true"),Bi&&(Bi.setAttribute("aria-expanded","false"),Bi=null))};if(vo&&vo.addEventListener("click",N=>{N.preventDefault(),D()}),document.addEventListener("click",N=>{!Vt||!Vt.classList.contains("is-open")||N.target.closest(".aipkit_popover_params_config_btn")||N.target.closest("#aipkit_parameters_flyout")||D()}),A&&A.addEventListener("click",mn),b&&b.addEventListener("click",()=>{no("root")}),I.addEventListener("click",N=>{N.target===I&&mn()}),O&&O.addEventListener("click",An),P&&P.addEventListener("click",N=>{N.target===P&&An()}),document.addEventListener("keydown",N=>{N.key==="Escape"&&I.classList.contains("aipkit-active")&&mn(),N.key==="Escape"&&P&&P.classList.contains("aipkit-active")&&An()}),w&&!w.dataset.footerActionsBound){let N=e.getAttribute("data-default-bot-id")||"",X=()=>m&&m.value||e.getAttribute("data-active-bot-id")||"";w.addEventListener("click",Z=>{let se=Z.target.closest(".aipkit_popover_footer_btn");if(!se)return;Z.preventDefault();let re=se.getAttribute("data-action"),K=X();if(!(!re||!K||typeof window.aipkit_apiRequest!="function")){if(re==="delete"){if(se.disabled||K===N)return;Ze("Deleting...",""),window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:K}).then($=>{Ze($.message||"Deleted","success");try{N&&localStorage.setItem(k,N)}catch{}typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:N||K,layout:n}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(N||K),ai()}).catch($=>{Ze(`Error: ${$.message||"Failed to delete."}`,"error"),ai()});return}re==="reset"&&(Ze("Resetting...",""),window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:K}).then($=>{Ze($.message||"Saved","success"),typeof window.aipkit_loadModule=="function"?window.aipkit_loadModule("chatbot",{force_active_bot_id:K,layout:n}):typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(K),ai()}).catch($=>{Ze(`Error: ${$.message||"Failed to reset."}`,"error"),ai()}))}}),w.dataset.footerActionsBound="1"}window.addEventListener("resize",()=>{I.classList.contains("aipkit-active")&&T&&un(T),P&&P.classList.contains("aipkit-active")&&F&&Bn(F),bt&&bt.classList.contains("is-open")&&Di&&jn(Di),Ut&&Ut.classList.contains("is-open")&&Wi&&zn(Wi),ti&&ti.classList.contains("is-open")&&Mi&&Qn(Mi),Ue&&Ue.classList.contains("is-open")&&Hi&&Nn(Hi),ct&&ct.classList.contains("is-open")&&Ti&&fn(Ti),li&&li.classList.contains("is-open")&&an&&oo(an),di&&di.classList.contains("is-open")&&Pi&&ao(Pi),fi&&fi.classList.contains("is-open")&&Ji&&Wt(Ji),wi&&wi.classList.contains("is-open")&&Ui&&$n(Ui)}),window.addEventListener("scroll",()=>{I.classList.contains("aipkit-active")&&T&&un(T),P&&P.classList.contains("aipkit-active")&&F&&Bn(F),bt&&bt.classList.contains("is-open")&&Di&&jn(Di),Ut&&Ut.classList.contains("is-open")&&Wi&&zn(Wi),ti&&ti.classList.contains("is-open")&&Mi&&Qn(Mi),Ue&&Ue.classList.contains("is-open")&&Hi&&Nn(Hi),ct&&ct.classList.contains("is-open")&&Ti&&fn(Ti),li&&li.classList.contains("is-open")&&an&&oo(an),di&&di.classList.contains("is-open")&&Pi&&ao(Pi),fi&&fi.classList.contains("is-open")&&Ji&&Wt(Ji),wi&&wi.classList.contains("is-open")&&Ui&&$n(Ui)},!0),e.dataset.modelPopoverBound="1"}if(Ge&&Si&&!Ge.dataset.autosaveBound){let R=Ge.value,D=!1,N=null,X=$=>{Rt&&(Rt.textContent=`${$.length.toLocaleString()} characters`)},Z=$=>{St&&(St.value=$,X($))},se=$=>{let J=m&&m.value||e.getAttribute("data-active-bot-id");J&&(D=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_instructions",{bot_id:J,instructions:$}).then(oe=>{R=$,Ge.dataset.dirty="0",Ze(oe.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(J),ai()}).catch(oe=>{Ze(`Error: ${oe.message||"Failed to save."}`,"error"),Ge.dataset.dirty="1"}).finally(()=>{if(D=!1,N!==null&&N!==R){let oe=N;N=null,se(oe)}else N=null}))},re=()=>{!Qe||!St||(Z(Ge.value),Qe.classList.add("aipkit-active"),Qe.setAttribute("aria-hidden","false"),setTimeout(()=>St.focus(),0))},K=$=>{if(!Qe||(Qe.classList.remove("aipkit-active"),Qe.setAttribute("aria-hidden","true"),!$||!St))return;let J=St.value;if(J!==Ge.value&&(Ge.value=J,Ge.dataset.dirty="1"),Ge.dataset.dirty==="1"){if(D){N=Ge.value;return}se(Ge.value)}};St&&!St.dataset.bound&&(St.addEventListener("input",()=>{X(St.value),Ge.dataset.dirty="1"}),St.dataset.bound="1"),Qe&&!Qe.dataset.bound&&(It&&It.addEventListener("click",re),Ce&&Ce.addEventListener("click",()=>{K(!0)}),document.addEventListener("keydown",$=>{$.key==="Escape"&&Qe.classList.contains("aipkit-active")&&K(!0)}),Qe.dataset.bound="1"),Ge.addEventListener("input",()=>{Ge.dataset.dirty="1"}),Ge.addEventListener("blur",()=>{let $=Ge.value;if(Ge.dataset.dirty==="1"){if($===R){Ge.dataset.dirty="0";return}if(D){N=$;return}se($)}}),Ge.dataset.autosaveBound="1"}if(ve){let R=ve.querySelectorAll(".aipkit_builder_tab[data-aipkit-tab]"),D=X=>{X&&(R.forEach(Z=>{let se=Z.dataset.aipkitTab===X;Z.classList.toggle("is-active",se),Z.setAttribute("aria-selected",se?"true":"false")}),Re.forEach(Z=>{let se=Z.dataset.aipkitPanel===X;Z.classList.toggle("is-active",se),Z.hidden=!se}),tt&&(tt.style.display=X==="files"?"none":""),Ke&&Ke.classList.toggle("aipkit_builder_action_row--end",X==="files"))},N=ve.querySelector(".aipkit_builder_tab.is-active");N&&D(N.dataset.aipkitTab),R.forEach(X=>{X.addEventListener("click",()=>{D(X.dataset.aipkitTab)})})}let de=y?y.querySelector('textarea[name="triggers_json"]'):null,ue=y?y.querySelector(".aipkit_trigger_builder_container"):null,fe=y?y.querySelector(".aipkit_triggers_status"):null;if((de||ue)&&Si&&!e.dataset.triggersAutosaveBound){let R=de?de.value:"[]",D=!1,N=null,X=null,Z=()=>{let he=m&&m.value||e.getAttribute("data-active-bot-id");if(!he)return null;let Pe="";if(typeof window.aipkit_getTriggerBuilderState=="function"){let pt=window.aipkit_getTriggerBuilderState(he);pt&&Array.isArray(pt.triggers)&&(typeof window.aipkit_updateTriggersJsonForSave=="function"&&window.aipkit_updateTriggersJsonForSave(he,pt.triggers),Pe=de?de.value:JSON.stringify(pt.triggers,null,2))}return!Pe&&de&&(Pe=de.value),Pe||(Pe="[]"),{botId:he,triggersJson:Pe}},se=(he,Pe)=>{fe&&(fe.textContent=he||"",fe.classList.remove("success","error","loading"),Pe&&fe.classList.add(Pe),fe.style.display=he?"inline-block":"none")},re=()=>{fe&&setTimeout(()=>{fe.textContent="",fe.classList.remove("success","error","loading"),fe.style.display="none"},2500)},K=(he,Pe)=>{Pe&&(D=!0,Ze("Auto-saving...",""),se("Saving...","loading"),window.aipkit_apiRequest("aipkit_update_chatbot_triggers",{bot_id:Pe,triggers_json:he}).then(pt=>{R=he,Ze(pt.message||"Saved","success"),se("Saved","success"),ai(),re()}).catch(pt=>{Ze(`Error: ${pt.message||"Failed to save."}`,"error"),se("Error","error"),re()}).finally(()=>{if(D=!1,N!==null&&N!==R){let pt=N;N=null;let ri=Z();ri&&K(pt,ri.botId)}else N=null}))},$=he=>{if(he===R)return;if(D){N=he;return}let Pe=Z();Pe&&K(he,Pe.botId)},J=()=>{X&&clearTimeout(X),X=setTimeout(()=>{let he=Z();he&&$(he.triggersJson)},900)};typeof window.aipkit_requestTriggerAutosave!="function"&&(window.aipkit_requestTriggerAutosave=J);let oe=he=>{he.target&&he.target.closest(".aipkit_trigger_builder_container")&&J()};ue&&(ue.addEventListener("input",oe),ue.addEventListener("change",oe),ue.addEventListener("click",oe)),de&&(de.addEventListener("input",J),de.addEventListener("blur",J)),e.dataset.triggersAutosaveBound="1"}if(bt&&!bt.dataset.bound){let R=N=>{!bt||!N||(bt.classList.add("is-open"),bt.setAttribute("aria-hidden","false"),N.setAttribute("aria-expanded","true"),Di=N,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_web_settings_modal"),hn(),window.requestAnimationFrame(()=>{jn(N)}))},D=()=>{bt.classList.remove("is-open"),bt.setAttribute("aria-hidden","true"),Di&&(Di.setAttribute("aria-expanded","false"),Di=null)};e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_web_search_config_btn");if(X){if(N.preventDefault(),bt.classList.contains("is-open")&&Di===X){D();return}R(X)}}),ln&&ln.addEventListener("click",D),document.addEventListener("click",N=>{bt.classList.contains("is-open")&&(N.target.closest(".aipkit_web_search_config_btn")||N.target.closest("#aipkit_builder_web_settings_modal")||D())}),document.addEventListener("keydown",N=>{N.key==="Escape"&&bt.classList.contains("is-open")&&D()}),bt.dataset.bound="1"}if(Ut&&!Ut.dataset.bound){let R=N=>{!Ut||!N||(Ut.classList.add("is-open"),Ut.setAttribute("aria-hidden","false"),N.setAttribute("aria-expanded","true"),Wi=N,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_context_settings_modal"),rn(),window.requestAnimationFrame(()=>{zn(N)}))},D=()=>{Ut.classList.remove("is-open"),Ut.setAttribute("aria-hidden","true"),Wi&&(Wi.setAttribute("aria-expanded","false"),Wi=null)};e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_vector_store_config_btn");if(X){if(N.preventDefault(),Ut.classList.contains("is-open")&&Wi===X){D();return}R(X)}}),So&&So.addEventListener("click",D),document.addEventListener("click",N=>{Ut.classList.contains("is-open")&&(N.target.closest(".aipkit_vector_store_config_btn")||N.target.closest("#aipkit_builder_context_settings_modal")||D())}),document.addEventListener("keydown",N=>{N.key==="Escape"&&Ut.classList.contains("is-open")&&D()}),Ut.dataset.bound="1"}if(ti&&!ti.dataset.bound){let R=N=>{!ti||!N||(ti.classList.add("is-open"),ti.setAttribute("aria-hidden","false"),N.setAttribute("aria-expanded","true"),Mi=N,po(),window.requestAnimationFrame(()=>{Qn(N)}))},D=()=>{ti.classList.remove("is-open"),ti.setAttribute("aria-hidden","true"),Mi&&(Mi.setAttribute("aria-expanded","false"),Mi=null)};e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_limit_usage_config_btn");if(X){if(N.preventDefault(),ti.classList.contains("is-open")&&Mi===X){D();return}R(X)}}),Eo&&Eo.addEventListener("click",D),document.addEventListener("click",N=>{ti.classList.contains("is-open")&&(N.target.closest(".aipkit_limit_usage_config_btn")||N.target.closest("#aipkit_builder_token_limits_modal")||D())}),document.addEventListener("keydown",N=>{N.key==="Escape"&&ti.classList.contains("is-open")&&D()}),ti.dataset.bound="1"}if(Ue&&!Ue.dataset.bound){let R=N=>{!Ue||!N||(Ue.classList.add("is-open"),Ue.setAttribute("aria-hidden","false"),N.setAttribute("aria-expanded","true"),Hi=N,typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_builder_audio_settings_modal"),Yn(),typeof window.aipkit_syncAudioTtsOnOpen=="function"&&window.aipkit_syncAudioTtsOnOpen().catch(()=>{}),window.requestAnimationFrame(()=>{Nn(N)}))},D=()=>{Ue.classList.remove("is-open"),Ue.setAttribute("aria-hidden","true"),Hi&&(Hi.setAttribute("aria-expanded","false"),Hi=null)};e.addEventListener("click",N=>{let X=N.target.closest(".aipkit_audio_settings_config_btn");if(X){if(N.preventDefault(),Ue.classList.contains("is-open")&&Hi===X){D();return}R(X)}}),Co&&Co.addEventListener("click",D),document.addEventListener("click",N=>{Ue.classList.contains("is-open")&&(N.target.closest(".aipkit_audio_settings_config_btn")||N.target.closest("#aipkit_builder_audio_settings_modal")||D())}),document.addEventListener("keydown",N=>{N.key==="Escape"&&Ue.classList.contains("is-open")&&D()}),Ue.dataset.bound="1"}if(Xe&&Si&&!Xe.dataset.autosaveBound){let R=Xe.value.trim(),D=!1,N=null,X=se=>{if(!m)return;let re=m.options[m.selectedIndex];re&&(re.text=se)},Z=se=>{let re=m&&m.value||e.getAttribute("data-active-bot-id");re&&(D=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_rename_chatbot",{bot_id:re,new_name:se}).then(K=>{let $=(K.new_name||se).trim();R=$,Xe.value=$,X($),Ze("Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(re),ai()}).catch(K=>{Ze(`Error: ${K.message||"Failed to save."}`,"error")}).finally(()=>{if(D=!1,N!==null&&N!==R){let K=N;N=null,Z(K)}else N=null}))};Xe.addEventListener("keydown",se=>{se.key==="Enter"&&(se.preventDefault(),Xe.blur())}),Xe.addEventListener("blur",()=>{let se=Xe.value.trim();if(!se){Xe.value=R,Ze("Name cannot be empty.","error");return}if(se!==R){if(D){N=se;return}Z(se)}}),Xe.dataset.autosaveBound="1"}if(Si&&!e.dataset.modelAutosaveBound){let R=e.querySelector(".aipkit_chatbot_provider_select");if(R){let D=!1,N=null,X=$=>{if(!$)return"";let J=e.querySelector(`.aipkit_chatbot_model_field[data-provider="${$}"]`);if(!J)return"";let oe=J.querySelector("select");return oe?oe.value:""},Z=R.value||"",se=X(Z),re=($,J)=>{let oe=m&&m.value||e.getAttribute("data-active-bot-id");oe&&(D=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_model_settings",{bot_id:oe,provider:$,model:J}).then(he=>{if(Z=$,se=J,Ze(he.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(oe),ai(),typeof window.aipkit_requestChatbotModelSync=="function"){let Pe=R?R.value||"":$,pt=X(Pe);Pe===$&&pt===J&&window.aipkit_requestChatbotModelSync($,{silent:!0})}}).catch(he=>{Ze(`Error: ${he.message||"Failed to save."}`,"error")}).finally(()=>{if(D=!1,N){let{provider:he,model:Pe}=N;N=null,(he!==Z||Pe!==se)&&re(he,Pe)}}))},K=($,J)=>{if(!($===Z&&J===se)){if(D){N={provider:$,model:J};return}re($,J)}};e.addEventListener("change",$=>{let J=$.target;if(!J)return;if(J.matches(".aipkit_chatbot_provider_select")){let he=J.value||"",Pe=X(he);K(he,Pe),I&&I.classList.contains("aipkit-active")&&mn(),hn(),Y(),Uo(),Jn(),dn();return}let oe=J.closest(".aipkit_chatbot_model_field select");if(oe){let he=R.value||"",Pe=oe.value||"";K(he,Pe),hn(),Y()}})}e.dataset.modelAutosaveBound="1"}if(Si&&!e.dataset.deployWizardBound){let R=e.querySelector(".aipkit_deploy_wizard");if(R){let D=Array.from(R.querySelectorAll('input[name="aipkit_deploy_scope"]')),N=Array.from(R.querySelectorAll('input[name="aipkit_deploy_mode"]')),X=Array.from(R.querySelectorAll('input[name="aipkit_deploy_popup_scope"]')),Z=R.querySelector('select[name="aipkit_deploy_scope"]'),se=R.querySelector('select[name="aipkit_deploy_mode"]'),re=R.querySelector('select[name="aipkit_deploy_popup_scope"]'),K=R.querySelector(".aipkit_deploy_row_mode"),$=R.querySelector(".aipkit_deploy_row_popup_scope"),J=Array.from(R.querySelectorAll("[data-deploy-panel]")),oe=R.querySelector("[data-deploy-popup-shortcode]"),he=R.querySelector('textarea[name="embed_allowed_domains"]'),Pe=(He,dt)=>{let it=He.find(Ye=>Ye.checked);return it?it.value:dt},pt=()=>Z?Z.value||"site":Pe(D,"site"),ri=()=>se?se.value||"inline":Pe(N,"inline"),Yt=()=>re?re.value||"page":Pe(X,"page"),ft=He=>{let dt=I||y;if(!dt)return;let it=dt.querySelector(".aipkit_sidebar_toggle_group");if(!it)return;let Ye=it.querySelector(".aipkit_sidebar_toggle_switch"),ht=it.querySelector("label");if(!Ye||!ht)return;let Li=it.getAttribute("data-tooltip-disabled")||"";He?(Ye.getAttribute("data-original-state")===null&&Ye.setAttribute("data-original-state",Ye.checked?"checked":"unchecked"),Ye.checked=!1,Ye.disabled=!0,it.setAttribute("title",Li),it.classList.add("aipkit-disabled-tooltip"),ht.style.opacity="0.6"):(Ye.disabled=!1,it.removeAttribute("title"),it.classList.remove("aipkit-disabled-tooltip"),ht.style.opacity="1",Ye.getAttribute("data-original-state")==="checked"&&(Ye.checked=!0),Ye.removeAttribute("data-original-state"))},At=He=>{let dt=I||y;if(!dt)return;let it=dt.querySelectorAll('[data-popup-only="header-identity"]');it.length&&it.forEach(Ye=>{Ye.hidden=!He})},Zt=()=>{let He=pt(),dt=ri(),it=Yt();K&&(K.hidden=He!=="site"),$&&($.hidden=!(He==="site"&&dt==="popup")),J.forEach(ht=>{let Li=ht.dataset.deployPanel,ji=!1;Li==="external"?ji=He==="external":Li==="inline"?ji=He==="site"&&dt==="inline":Li==="popup"&&(ji=He==="site"&&dt==="popup"),ht.hidden=!ji}),X.forEach(ht=>{ht.disabled=He!=="site"||dt!=="popup"}),re&&(re.disabled=He!=="site"||dt!=="popup"),se&&(se.disabled=He!=="site"),oe&&(oe.hidden=!(He==="site"&&dt==="popup"&&it==="page"));let Ye=He==="site"&&dt==="popup";ft(Ye),At(Ye),F&&window.requestAnimationFrame(()=>{Bn(F)})},hi=pt()==="site"?{popup_enabled:ri()==="popup"?"1":"0",site_wide_enabled:ri()==="popup"&&Yt()==="sitewide"?"1":"0"}:null,xi=!1,Ct=null,ei=()=>{if(pt()!=="site")return null;let He=ri()==="popup"?"1":"0",dt=He==="1"&&Yt()==="sitewide"?"1":"0";return{popup_enabled:He,site_wide_enabled:dt}},Bt=He=>{let dt=m&&m.value||e.getAttribute("data-active-bot-id");!dt||!He||(xi=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",{bot_id:dt,popup_enabled:He.popup_enabled,site_wide_enabled:He.site_wide_enabled}).then(it=>{hi=He,Ze(it.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(dt),ai()}).catch(it=>{Ze(`Error: ${it.message||"Failed to save."}`,"error")}).finally(()=>{if(xi=!1,Ct){let it=Ct;Ct=null,(!hi||JSON.stringify(it)!==JSON.stringify(hi))&&Bt(it)}}))},pi=He=>{if(He&&!(hi&&JSON.stringify(He)===JSON.stringify(hi))){if(xi){Ct=He;return}Bt(He)}},Ei=he?he.value:"",$i=!1,qe=null,xe=He=>{let dt=m&&m.value||e.getAttribute("data-active-bot-id");dt&&($i=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_deploy_settings",{bot_id:dt,embed_allowed_domains:He}).then(it=>{Ei=He,Ze(it.message||"Saved","success"),ai()}).catch(it=>{Ze(`Error: ${it.message||"Failed to save."}`,"error")}).finally(()=>{if($i=!1,qe!==null){let it=qe;qe=null,it!==Ei&&xe(it)}}))},Ve=He=>{if(He!==Ei){if($i){qe=He;return}xe(He)}};R.addEventListener("change",He=>{let dt=He.target;dt&&(dt.matches('input[name="aipkit_deploy_scope"]')||dt.matches('input[name="aipkit_deploy_mode"]')||dt.matches('input[name="aipkit_deploy_popup_scope"]')||dt.matches('select[name="aipkit_deploy_scope"]')||dt.matches('select[name="aipkit_deploy_mode"]')||dt.matches('select[name="aipkit_deploy_popup_scope"]'))&&(Zt(),pi(ei()))}),he&&(he.addEventListener("blur",()=>{Ve(he.value)}),he.addEventListener("change",()=>{Ve(he.value)})),Zt(),e.dataset.deployWizardBound="1"}}if(w&&Si&&!e.dataset.aiParamsAutosaveBound){let R=!1,D=null,N=()=>{let J=pt=>Vt&&Vt.querySelector(pt)||w.querySelector(pt),oe=J('[name="temperature"]'),he=J('[name="max_completion_tokens"]'),Pe=J('[name="max_messages"]');return{temperature:oe?oe.value:"",maxTokens:he?he.value:"",maxMessages:Pe?Pe.value:""}},{temperature:X,maxTokens:Z,maxMessages:se}=N(),re=(J,oe,he)=>{let Pe=m&&m.value||e.getAttribute("data-active-bot-id");!Pe||J===""||oe===""||he===""||(R=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_ai_parameters",{bot_id:Pe,temperature:J,max_completion_tokens:oe,max_messages:he}).then(pt=>{X=J,Z=oe,se=he,Ze(pt.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Pe),ai()}).catch(pt=>{Ze(`Error: ${pt.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D){let{temperature:pt,maxTokens:ri,maxMessages:Yt}=D;D=null,(pt!==X||ri!==Z||Yt!==se)&&re(pt,ri,Yt)}}))},K=(J,oe,he)=>{if(!(J===X&&oe===Z&&he===se)){if(R){D={temperature:J,maxTokens:oe,maxMessages:he};return}re(J,oe,he)}},$=J=>{let oe=J.target;if(oe&&(oe.matches('[name="temperature"]')||oe.matches('[name="max_completion_tokens"]')||oe.matches('[name="max_messages"]'))){let{temperature:he,maxTokens:Pe,maxMessages:pt}=N();K(he,Pe,pt)}};w.addEventListener("change",$),Vt&&Vt.addEventListener("change",$),e.dataset.aiParamsAutosaveBound="1"}if((bt||w)&&Si&&!e.dataset.webSettingsAutosaveBound){let R=!1,D=null,N=()=>{let K=J=>{let oe=bt?bt.querySelector(J):null;return oe?oe.value:""},$=J=>{let oe=w&&w.querySelector(J)||e&&e.querySelector(J)||bt&&bt.querySelector(J);return oe?oe.tagName==="SELECT"?oe.value==="1"?"1":"0":oe.checked?"1":"0":"0"};return{openai_web_search_enabled:$(".aipkit_openai_web_search_enable_toggle"),openai_web_search_context_size:K('[name="openai_web_search_context_size"]'),openai_web_search_loc_type:K('[name="openai_web_search_loc_type"]'),openai_web_search_loc_country:K('[name="openai_web_search_loc_country"]'),openai_web_search_loc_city:K('[name="openai_web_search_loc_city"]'),openai_web_search_loc_region:K('[name="openai_web_search_loc_region"]'),openai_web_search_loc_timezone:K('[name="openai_web_search_loc_timezone"]'),claude_web_search_enabled:$(".aipkit_claude_web_search_enable_toggle"),claude_web_search_max_uses:K('[name="claude_web_search_max_uses"]'),claude_web_search_loc_type:K('[name="claude_web_search_loc_type"]'),claude_web_search_loc_country:K('[name="claude_web_search_loc_country"]'),claude_web_search_loc_city:K('[name="claude_web_search_loc_city"]'),claude_web_search_loc_region:K('[name="claude_web_search_loc_region"]'),claude_web_search_loc_timezone:K('[name="claude_web_search_loc_timezone"]'),claude_web_search_allowed_domains:K('[name="claude_web_search_allowed_domains"]'),claude_web_search_blocked_domains:K('[name="claude_web_search_blocked_domains"]'),claude_web_search_cache_ttl:K('[name="claude_web_search_cache_ttl"]'),openrouter_web_search_enabled:$(".aipkit_openrouter_web_search_enable_toggle"),openrouter_web_search_engine:K('[name="openrouter_web_search_engine"]'),openrouter_web_search_max_results:K('[name="openrouter_web_search_max_results"]'),openrouter_web_search_search_prompt:K('[name="openrouter_web_search_search_prompt"]'),google_search_grounding_enabled:$(".aipkit_google_search_grounding_enable_toggle"),google_grounding_mode:K('[name="google_grounding_mode"]'),google_grounding_dynamic_threshold:K('[name="google_grounding_dynamic_threshold"]')}},X=N(),Z=K=>{let $=m&&m.value||e.getAttribute("data-active-bot-id");$&&(R=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_web_settings",{bot_id:$,...K}).then(J=>{X=K,Ze(J.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview($),ai()}).catch(J=>{Ze(`Error: ${J.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D){let J=D;D=null,JSON.stringify(J)!==JSON.stringify(X)&&Z(J)}}))},se=K=>{if(JSON.stringify(K)!==JSON.stringify(X)){if(R){D=K;return}Z(K)}},re=K=>{let $=K.target;$&&($.matches(".aipkit_openai_web_search_enable_toggle")||$.matches(".aipkit_openai_web_search_loc_type_select")||$.matches('[name="openai_web_search_context_size"]')||$.matches('[name="openai_web_search_loc_country"]')||$.matches('[name="openai_web_search_loc_city"]')||$.matches('[name="openai_web_search_loc_region"]')||$.matches('[name="openai_web_search_loc_timezone"]')||$.matches(".aipkit_claude_web_search_enable_toggle")||$.matches(".aipkit_claude_web_search_loc_type_select")||$.matches('[name="claude_web_search_max_uses"]')||$.matches('[name="claude_web_search_loc_country"]')||$.matches('[name="claude_web_search_loc_city"]')||$.matches('[name="claude_web_search_loc_region"]')||$.matches('[name="claude_web_search_loc_timezone"]')||$.matches('[name="claude_web_search_allowed_domains"]')||$.matches('[name="claude_web_search_blocked_domains"]')||$.matches('[name="claude_web_search_cache_ttl"]')||$.matches(".aipkit_openrouter_web_search_enable_toggle")||$.matches('[name="openrouter_web_search_engine"]')||$.matches('[name="openrouter_web_search_max_results"]')||$.matches('[name="openrouter_web_search_search_prompt"]')||$.matches(".aipkit_google_search_grounding_enable_toggle")||$.matches(".aipkit_google_grounding_mode_select")||$.matches('[name="google_grounding_dynamic_threshold"]'))&&(hn(),se(N()))};w&&w.addEventListener("change",re),bt&&bt.addEventListener("change",re),e.dataset.webSettingsAutosaveBound="1"}if((Ut||w)&&Si&&!e.dataset.contextSettingsAutosaveBound){let R=!1,D=null,N=()=>{let G=ie=>{let le=Vi(),pe=le?le.querySelector(ie):null;return pe?pe.value:""},Q=ie=>{let le=w&&w.querySelector(ie)||e&&e.querySelector(ie)||Ut&&Ut.querySelector(ie);return le?le.tagName==="SELECT"?le.value==="1"?"1":"0":le.checked?"1":"0":"0"},te=ie=>{let le=Vi(),pe=le?le.querySelector(ie):null;return pe?Array.from(pe.selectedOptions).map(me=>me.value).filter(Boolean):[]};return{enable_vector_store:Q(".aipkit_vector_store_enable_select"),vector_store_provider:G('[name="vector_store_provider"]'),openai_vector_store_ids:te('select[name="openai_vector_store_ids[]"]'),pinecone_index_name:G('[name="pinecone_index_name"]'),qdrant_collection_names:te('select[name="qdrant_collection_names[]"]'),vector_embedding_provider:G('[name="vector_embedding_provider"]'),vector_embedding_model:G('[name="vector_embedding_model"]'),vector_store_top_k:G('[name="vector_store_top_k"]'),vector_store_confidence_threshold:G('[name="vector_store_confidence_threshold"]'),content_aware_enabled:Q(".aipkit_content_aware_enable_select")}},X=N(),Z=w&&w.closest(".aipkit_model_settings_popover")?.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline")||Ut&&Ut.querySelector(".aipkit_popover_flyout_header .aipkit_popover_status_inline")||Ut&&Ut.querySelector(".aipkit_popover_status_inline")||w&&w.querySelector(".aipkit_popover_status_inline")||null,se=(G,Q)=>{Z&&(Z.textContent=G||"",Z.classList.remove("success","error","loading"),Q&&Z.classList.add(Q),Z.style.display=G?"inline-block":"none")},re=()=>{Z&&setTimeout(()=>{Z.textContent="",Z.classList.remove("success","error","loading"),Z.style.display="none"},2500)},K=!1,$=null,J={},oe=Vi();oe&&oe.querySelectorAll('[name="pinecone_api_key"], [name="qdrant_url"], [name="qdrant_api_key"]').forEach(G=>{J[G.name]=G.value});let he=()=>{let{pineconeKeyInput:G,qdrantUrlInput:Q,qdrantKeyInput:te}=nn(),ie=!!(G&&G.value.trim()||a),le=!!(Q&&Q.value.trim()||p),pe=!!(te&&te.value.trim()||l);return{pinecone:ie,qdrant:le&&pe}},Pe=0,pt=(G,Q)=>G?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(G,{silent:!0,showErrors:!1,targetSelectId:Q,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,G,{silent:!0,showErrors:!1,targetSelectId:Q,propagateError:!0}):null:null,ri=(G,Q)=>{let te=++Pe;se("Syncing...","loading");let ie=pt(G,Q);if(ie&&typeof ie.then=="function"){ie.then(()=>{Pe===te&&(se("Synced","success"),re())}).catch(le=>{Pe===te&&se(`Error: ${le.message||"Sync failed."}`,"error")});return}re()},Yt=G=>{let Q=he();if(G==="pinecone"&&Q.pinecone){let{pineconeIndexSelect:te}=nn();ri("PineconeIndexes",te?te.id:"")}else if(G==="qdrant"&&Q.qdrant){let{qdrantCollectionsSelect:te}=nn();ri("QdrantCollections",te?te.id:"")}},ft=G=>{!G||!Object.keys(G).length||(K=!0,se("Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",G).then(Q=>{Object.keys(G).forEach(te=>{J[te]=G[te]}),Object.prototype.hasOwnProperty.call(G,"pinecone_api_key")&&Yt("pinecone"),(Object.prototype.hasOwnProperty.call(G,"qdrant_url")||Object.prototype.hasOwnProperty.call(G,"qdrant_api_key"))&&Yt("qdrant"),se(Q.message||"Saved","success"),re()}).catch(Q=>{se(`Error: ${Q.message||"Failed to save."}`,"error")}).finally(()=>{if(K=!1,$){let Q=$;$=null,ft(Q)}}))},At=G=>{if(!G)return;let Q=Object.keys(G).reduce((te,ie)=>(G[ie]!==J[ie]&&(te[ie]=G[ie]),te),{});if(Object.keys(Q).length){if(K){$={...$||{},...Q};return}ft(Q)}},Zt=G=>{let Q=m&&m.value||e.getAttribute("data-active-bot-id");Q&&(R=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_context_settings",{bot_id:Q,...G}).then(te=>{X=G,Ze(te.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(Q),ai()}).catch(te=>{Ze(`Error: ${te.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D){let te=D;D=null,JSON.stringify(te)!==JSON.stringify(X)&&Zt(te)}}))},hi=G=>{if(JSON.stringify(G)!==JSON.stringify(X)){if(R){D=G;return}Zt(G)}},xi=G=>{let Q=G.target;if(Q){if(Q.matches('[name="pinecone_api_key"]')||Q.matches('[name="qdrant_url"]')||Q.matches('[name="qdrant_api_key"]')){let te=Q.value||"";At({[Q.name]:te}),dn(),en(N());return}if(Q.matches(".aipkit_vector_store_enable_select")||Q.matches(".aipkit_vector_store_provider_select")||Q.matches('select[name="openai_vector_store_ids[]"]')||Q.matches('select[name="qdrant_collection_names[]"]')||Q.matches('[name="pinecone_index_name"]')||Q.matches(".aipkit_vector_embedding_select")||Q.matches('[name="vector_embedding_provider"]')||Q.matches('[name="vector_embedding_model"]')||Q.matches('[name="vector_store_top_k"]')||Q.matches('[name="vector_store_confidence_threshold"]')||Q.matches('[name="content_aware_enabled"]')){if(Q.matches(".aipkit_vector_embedding_select")&&Ko(Q),Q.matches(".aipkit_vector_store_enable_select")&&(lo(),Yt(N().vector_store_provider)),Q.matches(".aipkit_vector_store_provider_select")&&(rn(),Yt(Q.value||""),Jn(),dn()),Q.matches('[name="vector_embedding_provider"]')){let ie=Vi();ie&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(ie),wo(ie)}if(Q.matches('[name="vector_embedding_model"]')){let ie=Vi();wo(ie)}let te=N();hi(te),dn(),en(te),pi(te),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet(1)}}};w&&w.addEventListener("change",xi),Ut&&Ut.addEventListener("change",xi);let Ct=(G,Q)=>{xt&&(xt.textContent=G||"",xt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),G&&xt.classList.add("is-visible"),Q&&xt.classList.add(`is-${Q}`))},ei=(G=2500)=>{xt&&setTimeout(()=>{xt.textContent="",xt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading")},G)},Bt=(G,Q="info")=>{if(Xt){if(typeof window.aipkit_showOpenAIVectorStatus=="function"){window.aipkit_showOpenAIVectorStatus(G||"",Q,Xt.id);return}Xt.textContent=G||""}},pi=(G=null)=>{if(!ii)return;let Q=G||N();if(!Q||Q.enable_vector_store!=="1"){ii.innerHTML='<option value=""></option>',ii.value="";return}let te="";Q.vector_store_provider==="openai"?te=(Array.isArray(Q.openai_vector_store_ids)?Q.openai_vector_store_ids.filter(Boolean):[])[0]||"":Q.vector_store_provider==="pinecone"?te=Q.pinecone_index_name||"":Q.vector_store_provider==="qdrant"&&(te=(Array.isArray(Q.qdrant_collection_names)?Q.qdrant_collection_names.filter(Boolean):[])[0]||""),ii.innerHTML=te?`<option value="${te}">${te}</option>`:'<option value=""></option>',ii.value=te,ii.dispatchEvent(new Event("change"))},Ei=()=>Tt&&Tt.value||"bulk",$i=G=>{let Q=G==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",te=document.getElementById(Q);return te?Array.from(te.selectedOptions).map(ie=>ie.value).filter(Boolean):[]},qe=G=>{let Q=G==="specific"?Qi:Ri;return Q&&Q.value||"publish"},xe=()=>{let G=document.getElementById("aipkit_vs_wp_content_list_area");return G?Array.from(G.querySelectorAll('input[name="wp_content_to_index[]"]:checked')).map(Q=>Q.value):[]},Ve=(G,Q,te)=>{if(!Q)return;Q.innerHTML="";let ie=Number(G?.total_posts||0),le=Number(G?.total_pages||0),pe=Number(G?.current_page||1);if(!ie)return;let me=document.createElement("span");if(me.className="aipkit_pagination-count",me.textContent=`${ie.toLocaleString()} ${c("item","items",ie,"gpt3-ai-content-generator")}`,Q.appendChild(me),le<=1)return;let be=document.createElement("span");be.className="aipkit_pagination-links";let Le=document.createElement("button");Le.type="button",Le.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",Le.textContent=t("Prev","gpt3-ai-content-generator"),Le.disabled=pe<=1,Le.addEventListener("click",()=>te(pe-1));let yt=document.createElement("span");yt.className="aipkit_pagination-current",yt.textContent=`${pe}/${le}`;let nt=document.createElement("button");nt.type="button",nt.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",nt.textContent=t("Next","gpt3-ai-content-generator"),nt.disabled=pe>=le,nt.addEventListener("click",()=>te(pe+1)),be.appendChild(Le),be.appendChild(yt),be.appendChild(nt),Q.appendChild(be)},He=(G,Q)=>{if(!Ht)return;if(Ht.innerHTML="",!Array.isArray(G)||!G.length){let me=document.createElement("p");me.className="aipkit_builder_help_text",me.textContent=t("No posts found for selection.","gpt3-ai-content-generator"),Ht.appendChild(me),_e&&(_e.innerHTML="");return}let te=document.createElement("ul"),ie=document.createElement("div");ie.className="aipkit_wp_content_select_all_wrapper";let le=document.createElement("label");le.className="aipkit_training_site_option";let pe=document.createElement("input");pe.type="checkbox",pe.checked=G.every(me=>ui.selectedIds.has(String(me.id))),le.appendChild(pe),le.appendChild(document.createTextNode(t("Select all","gpt3-ai-content-generator"))),ie.appendChild(le),Ht.appendChild(ie),Ht.appendChild(te),G.forEach(me=>{let be=document.createElement("li");be.className="aipkit_wp_content_list_item";let Le=document.createElement("input");Le.type="checkbox",Le.name="wp_content_to_index[]",Le.value=String(me.id),Le.checked=ui.selectedIds.has(String(me.id)),Le.addEventListener("change",()=>{Le.checked?ui.selectedIds.add(String(me.id)):ui.selectedIds.delete(String(me.id)),pe.checked=G.every(yi=>ui.selectedIds.has(String(yi.id)))});let yt=document.createElement("a");yt.className="aipkit_wp_content_title",yt.href=me.edit_link||"#",yt.target="_blank",yt.rel="noopener noreferrer",yt.textContent=me.title||t("Untitled","gpt3-ai-content-generator");let nt=document.createElement("span");nt.className="aipkit_wp_content_type",nt.textContent=me.type_label||"";let Gt=document.createElement("span");Gt.className="aipkit_wp_content_indexed_status",Gt.textContent=me.is_already_indexed?t("Indexed","gpt3-ai-content-generator"):"",be.appendChild(Le),be.appendChild(yt),be.appendChild(nt),be.appendChild(Gt),te.appendChild(be)}),pe.addEventListener("change",()=>{pe.checked?G.forEach(me=>ui.selectedIds.add(String(me.id))):G.forEach(me=>ui.selectedIds.delete(String(me.id))),Ht.querySelectorAll('input[name="wp_content_to_index[]"]').forEach(me=>{me.checked=pe.checked})}),Ve(Q,_e,dt)},dt=async G=>{if(!Ht)return;let Q=Ei(),te=$i(Q);if(!te.length){Ht.innerHTML="",_e&&(_e.innerHTML=""),Bt(t("Select at least one post type.","gpt3-ai-content-generator"),"error");return}let ie=Ii("aipkit_wp_content_fetch_nonce");if(!ie){Bt(t("WP content fetch nonce missing.","gpt3-ai-content-generator"),"error");return}let le=qe(Q),pe=ii&&ii.value||"";try{Bt(t("Loading content...","gpt3-ai-content-generator"),"");let me=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ie,post_types:te,post_status:le,target_store_id:pe,paged:G});ui.page=G,He(me.posts||[],me.pagination||{}),Bt("","")}catch(me){Bt(me&&me.message?me.message:t("Failed to load content.","gpt3-ai-content-generator"),"error")}},it=G=>{Tt&&(Tt.value=G),Ee&&(Ee.hidden=G!=="bulk"),jt&&(jt.hidden=G!=="specific"),lt&&(lt.hidden=G!=="specific"),Jt&&(Jt.hidden=G!=="bulk"),$t&&($t.hidden=G!=="specific"),st&&(st.hidden=G!=="bulk"),G==="specific"&&dt(1)},Ye=()=>{e.querySelectorAll(".aipkit_training_site_dropdown").forEach(Q=>{let te=Q.querySelector(".aipkit_training_site_dropdown_btn"),ie=Q.querySelector(".aipkit_training_site_dropdown_label"),le=Q.querySelector(".aipkit_training_site_dropdown_panel"),me=Q.dataset.aipkitTrainingTypes==="specific"?"aipkit_vs_wp_content_post_types_specific":"aipkit_vs_wp_content_post_types",be=document.getElementById(me);if(!te||!le||!be)return;let Le=()=>{let nt=le.querySelectorAll('input[type="checkbox"]:checked'),Gt=Q.dataset.placeholder||t("Select types","gpt3-ai-content-generator"),yi=Q.dataset.selectedLabel||t("selected","gpt3-ai-content-generator");ie&&(nt.length?ie.textContent=`${nt.length} ${yi}`:ie.textContent=Gt)},yt=()=>{let nt=Array.from(le.querySelectorAll('input[type="checkbox"]:checked')).map(Gt=>Gt.value);Array.from(be.options).forEach(Gt=>{Gt.selected=nt.includes(Gt.value)})};te.addEventListener("click",()=>{let nt=te.getAttribute("aria-expanded")==="true";te.setAttribute("aria-expanded",nt?"false":"true"),le.hidden=nt}),le.addEventListener("change",()=>{yt(),Le(),Ei()==="specific"&&dt(1)}),document.addEventListener("click",nt=>{Q.contains(nt.target)||(te.setAttribute("aria-expanded","false"),le.hidden=!0)}),yt(),Le()})},ht=async(G,Q,te)=>{let ie=Ii("aipkit_wp_content_fetch_nonce");if(!ie||!G.length)return{total:0};let le=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ie,post_types:G,post_status:Q,target_store_id:te||"",paged:1}),pe=parseInt(le?.pagination?.total_posts||0,10);return{total:Number.isNaN(pe)?0:pe,totalPages:parseInt(le?.pagination?.total_pages||1,10)}},Li=async(G,Q,te)=>{let ie=Ii("aipkit_wp_content_fetch_nonce");if(!ie)throw new Error("WP content fetch nonce missing.");let le=[],pe=1,me=1;do{let be=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:ie,post_types:G,post_status:Q,target_store_id:te||"",paged:pe}),Le=Array.isArray(be?.posts)?be.posts:[];Le.length&&(window.aipkit_wpContentTitleMap=window.aipkit_wpContentTitleMap||{},Le.forEach(nt=>{nt&&nt.id&&(window.aipkit_wpContentTitleMap[String(nt.id)]=nt.title||window.aipkit_wpContentTitleMap[String(nt.id)]||"")})),le.push(...Le.map(nt=>String(nt.id)));let yt=parseInt(be?.pagination?.total_pages||1,10);me=Number.isNaN(yt)?1:yt,Bt(`Preparing... collected ${le.length} item(s).`,"info"),pe+=1}while(pe<=me);return le},ji=(G,Q)=>G<=200||Q!=="publish"?Promise.resolve(!1):new Promise(te=>{let ie=document.getElementById("aipkit_background_indexing_confirm"),le=document.getElementById("aipkit_background_indexing_message"),pe=document.getElementById("aipkit_background_indexing_yes"),me=document.getElementById("aipkit_background_indexing_no"),be=document.getElementById("aipkit_wp_content_bulk_hint");if(!ie||!le||!pe||!me){te(window.confirm(`You're about to index ${G} items. Run in the background?`));return}le.textContent=`You're about to index ${G} items. Run in the background?`,be&&(be.hidden=!0),ie.hidden=!1;let Le=()=>{ie.hidden=!0,be&&(be.hidden=!1),pe.removeEventListener("click",yt),me.removeEventListener("click",nt)},yt=()=>{Le(),te(!0)},nt=()=>{Le(),te(!1)};pe.addEventListener("click",yt),me.addEventListener("click",nt)}),gn=async({botId:G,postTypes:Q,provider:te,targetStoreId:ie,embeddingProvider:le,embeddingModel:pe})=>{let me=window.aipkit_chat_config?.automationsNonce||"";if(!me)throw new Error("Automations nonce missing.");let be=`Chatbot ${G} website indexing`,Le={_ajax_nonce:me,task_id:0,task_name:be,task_type:"content_indexing",task_status:"active",task_frequency:"one-time",index_existing_now_flag:"1",only_new_updated_flag:"0",post_types:Q,target_store_provider:te,target_store_id:ie};return(te==="pinecone"||te==="qdrant")&&(Le.embedding_provider=le||"",Le.embedding_model=pe||""),window.aipkit_apiRequest("aipkit_save_automated_task",Le)};if(Tt&&!e.dataset.trainingWebsiteBound){if(typeof window.aipkit_initWpContentModeToggle=="function"&&window.aipkit_initWpContentModeToggle(),Qt&&typeof window.aipkit_fetchWordPressContentForTraining=="function"&&!Qt.dataset.listenerAttached&&(Qt.addEventListener("click",()=>{window.aipkit_fetchWordPressContentForTraining(1)}),Qt.dataset.listenerAttached="true"),typeof window.aipkit_updatePostTypeCounts=="function"&&(window.aipkit_updatePostTypeCounts(),Ri&&!Ri.dataset.listenerAttached&&(Ri.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),Ri.dataset.listenerAttached="true"),ii&&!ii.dataset.listenerAttached&&(ii.addEventListener("change",()=>{window.aipkit_updatePostTypeCounts()}),ii.dataset.listenerAttached="true")),pi(N()),Ye(),Me.length){Me.forEach(Q=>{Q.dataset.listenerAttached||(Q.addEventListener("change",()=>{it(Q.value)}),Q.dataset.listenerAttached="true")});let G=Array.from(Me).find(Q=>Q.checked);it(G?G.value:Ei())}else it(Ei());Qi&&!Qi.dataset.listenerAttached&&(Qi.addEventListener("change",()=>{Ei()==="specific"&&dt(1)}),Qi.dataset.listenerAttached="true"),ii&&!ii.dataset.websiteListenerAttached&&(ii.addEventListener("change",()=>{Ei()==="specific"&&dt(1)}),ii.dataset.websiteListenerAttached="true"),e.dataset.trainingWebsiteBound="1"}let Ai=G=>`${G.name}::${G.size}::${G.lastModified}`,pn=G=>{if(!Number.isFinite(G)||G<=0)return"0 KB";let Q=["B","KB","MB","GB"],te=G,ie=0;for(;te>=1024&&ie<Q.length-1;)te/=1024,ie+=1;let le=ie===0?0:1;return`${te.toFixed(le)} ${Q[ie]}`},vn=()=>zt&&zt.dataset.upgradeUrl||"",Ln=()=>{if(!Lt)return;let G=wt.size>0;Lt.style.display=G?"none":""},Mo=(G=1500)=>{zt&&(Je&&window.clearTimeout(Je),Je=window.setTimeout(()=>{wt.clear(),zt.innerHTML="",Ft&&(Ft.value=""),Ln(),Je=null},G))},Bo=()=>wt.size?Array.from(wt.values()).every(G=>{let Q=G.querySelector(".aipkit_training_file_status");return Q?Q.classList.contains("is-success")||Q.classList.contains("is-error"):!1}):!1,uo=()=>{Je&&!Bo()&&(window.clearTimeout(Je),Je=null),Bo()&&Mo(),Ln()},fo=G=>{if(!zt)return null;let Q=Ai(G);if(wt.has(Q))return wt.get(Q);let te=document.createElement("div");te.className="aipkit_training_file_row",te.dataset.fileKey=Q;let ie=document.createElement("div");ie.className="aipkit_training_file_meta";let le=document.createElement("span");le.className="aipkit_training_file_name",le.textContent=G.name;let pe=document.createElement("span");pe.className="aipkit_training_file_size",pe.textContent=pn(G.size);let me=document.createElement("span");return me.className="aipkit_training_file_status",me.textContent="Queued",ie.appendChild(le),ie.appendChild(pe),te.appendChild(ie),te.appendChild(me),zt.appendChild(te),wt.set(Q,te),te},Ni=(G,Q,te)=>{let ie=fo(G);if(!ie)return;let le=ie.querySelector(".aipkit_training_file_status");if(le){if(le.textContent="",le.classList.remove("is-success","is-error","is-warning","is-loading","is-upgrade"),te&&le.classList.add(`is-${te}`),Q==="Upgrade"&&vn()){le.classList.add("is-upgrade");let pe=document.createElement("a");pe.className="aipkit_training_file_upgrade",pe.href=vn(),pe.textContent=Q,le.appendChild(pe)}else le.textContent=Q;uo()}},Zn=async(G,Q=null)=>{if(!G||!G.name||typeof window.aipkit_apiRequest!="function")return!1;let te=m&&m.value||e.getAttribute("data-active-bot-id");if(!te)return!1;let ie=Q||N();if(!ie||ie.enable_vector_store!=="1")return!1;let le=String(G.name||"").trim();if(!le)return!1;let pe=Gt=>String(Gt||"").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),me=pe(le),be=le.replace(/\.[^/.]+$/,""),Le=[le,me,be&&be!==le?be:""].filter(Boolean),yt=async(Gt,yi)=>{let Oi=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",{bot_id:te,page:1,per_page:yi,search:Gt||"",enable_vector_store:ie.enable_vector_store,vector_store_provider:ie.vector_store_provider,openai_vector_store_ids:ie.openai_vector_store_ids||[],pinecone_index_name:ie.pinecone_index_name,qdrant_collection_names:ie.qdrant_collection_names||[]});return Array.isArray(Oi.logs)?Oi.logs:[]},nt=(Gt,yi)=>{if(!Gt.length)return null;let Oi=yi.map(pe).filter(Boolean);return Gt.find(Xi=>{let Sn=pe(Xi.message),mi=pe(Xi.post_title),je=pe(Xi.file_id);return Oi.some(mt=>Sn&&Sn.includes(mt)||mi&&mi.includes(mt)||je&&je.includes(mt))})||null};try{for(let Oi of Le){let Xi=await yt(Oi,10),Sn=nt(Xi,[Oi,me]);if(Sn){let mi=String(Sn.status||"").toLowerCase();if(mi==="indexed"||mi==="skipped_already_indexed")return Ni(G,"Trained","success"),!0;if(mi==="failed")return Ni(G,"Failed","error"),!0;if(mi==="processing"||mi==="queued")return Ni(G,"Processing","loading"),!0}}let Gt=await yt("",20),yi=nt(Gt,Le);if(yi){let Oi=String(yi.status||"").toLowerCase();if(Oi==="indexed"||Oi==="skipped_already_indexed")return Ni(G,"Trained","success"),!0;if(Oi==="failed")return Ni(G,"Failed","error"),!0;if(Oi==="processing"||Oi==="queued")return Ni(G,"Processing","loading"),!0}}catch{}return!1},Tn=(G,Q,te,ie=0)=>{if(!G||!Q||!te)return;if(ie>=30){Zn(te,N()).then(me=>{me||Ni(te,"Queued","warning")});return}let pe=Ii("aipkit_vector_store_nonce_openai");if(!pe||typeof window.aipkit_apiRequest!="function"){Zn(te,N());return}window.aipkit_apiRequest("aipkit_get_openai_file_batch_status",{store_id:G,batch_id:Q,_ajax_nonce:pe}).then(me=>{let be=(me.status||"").toLowerCase();if(be==="completed"){Ni(te,"Trained","success"),en(N()),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}if(be==="failed"||be==="cancelled"){Ni(te,"Failed","error");return}Ni(te,"Processing","loading"),setTimeout(()=>{Tn(G,Q,te,ie+1)},2500)}).catch(()=>{setTimeout(()=>{Tn(G,Q,te,ie+1)},3e3)})},bn=G=>{if(!bi)return;let Q=bi.dataset.baseLabel||bi.querySelector(".aipkit_training_sources_label")?.textContent.trim()||bi.textContent.replace(/\(\d+\)/,"").trim(),te=Number.isFinite(G)?G:0,ie=bi.querySelector(".aipkit_training_sources_count");ie?(ie.textContent=String(te),bi.setAttribute("aria-label",`${Q} (${te})`)):bi.textContent=`${Q} (${te})`},en=async(G=null)=>{if(!bi||typeof window.aipkit_apiRequest!="function")return;if(G&&G.enable_vector_store!=="1"){bn(0);return}let Q=G?G.vector_store_provider:"";if(Q==="openai"&&!(Array.isArray(G.openai_vector_store_ids)?G.openai_vector_store_ids:[]).length){bn(0);return}if(Q==="pinecone"&&!G.pinecone_index_name){bn(0);return}if(Q==="qdrant"&&!(Array.isArray(G.qdrant_collection_names)?G.qdrant_collection_names:[]).length){bn(0);return}let te=m&&m.value||e.getAttribute("data-active-bot-id");if(!te){bn(0);return}try{let ie={bot_id:te};G&&(ie.enable_vector_store=G.enable_vector_store,ie.vector_store_provider=G.vector_store_provider,ie.openai_vector_store_ids=G.openai_vector_store_ids||[],ie.pinecone_index_name=G.pinecone_index_name,ie.qdrant_collection_names=G.qdrant_collection_names||[]);let le=await window.aipkit_apiRequest("aipkit_get_chatbot_training_source_count",ie),pe=Number(le.count||0);bn(Number.isNaN(pe)?0:pe)}catch{}};window.aipkit_refreshTrainingSourcesCount=()=>{en(N())};let Pn=()=>{if(!bi||e.dataset.trainingAutoSync)return;let G=()=>{document.visibilityState==="visible"&&en(N())},Q=window.setInterval(G,6e4);e.dataset.trainingAutoSync="1",e.dataset.trainingAutoSyncInterval=String(Q),document.addEventListener("visibilitychange",G)},Ii=G=>{let Q=document.getElementById(G);return Q?Q.value:""},Fo=G=>{let Q=String(G),te=window.aipkit_wpContentTitleMap||{};if(te&&te[Q])return te[Q];if(Ht){let ie=Ht.querySelector(`input[name="wp_content_to_index[]"][value="${Q}"]`);if(ie){let le=ie.closest(".aipkit_wp_content_list_item"),pe=le?le.querySelector(".aipkit_wp_content_title"):null,me=pe?pe.textContent.trim():"";if(me)return me}}return`${t("Post","gpt3-ai-content-generator")} ${Q}`},mo=(G,Q,te)=>{let ie=Fo(G);return`${t("Training","gpt3-ai-content-generator")}: ${ie} (${Q+1}/${te})`},$o=async G=>{let Q=Ii("aipkit_wp_content_fetch_nonce");if(!Q)throw new Error("WP content fetch nonce missing.");let te=await window.aipkit_apiRequest("aipkit_fetch_wp_content_for_indexing",{_ajax_nonce:Q,get_content_for_ids:[String(G)]});return(te&&te.posts_content?te.posts_content:{})[String(G)]||null},No=async(G,Q,te)=>{if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let ie=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:G,embedding_provider:Q,embedding_model:te,_ajax_nonce:window.aipkit_dashboard.nonce}),le=ie.embeddings&&ie.embeddings.length?ie.embeddings[0]:null;if(!le)throw new Error("Failed to generate embedding.");return le},Wn=async(G,Q)=>{let te=Array.isArray(G)?G:[];if(te.length)for(let ie=0;ie<te.length;ie+=1){if(window.aipkit_isIndexingStopped){Bt(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let le=te[ie];Bt(mo(le,ie,te.length),"info"),await window.aipkit_apiRequest("aipkit_index_selected_wp_content",{...Q,post_ids:[le]})}},Oo=async(G,Q)=>{let te=Array.isArray(G)?G:[];if(te.length)for(let ie=0;ie<te.length;ie+=1){if(window.aipkit_isIndexingStopped){Bt(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let le=te[ie]||{},pe=le.postId||le.id;if(!pe)continue;Bt(mo(pe,ie,te.length),"info");let me=await $o(pe);if(!me||!me.content)continue;let be=le.metadata&&le.metadata.vector_id||`wp_post_${pe}`,Le={source:"wordpress_post",created_at:new Date().toISOString(),post_id:pe,title:me.title||"",url:me.edit_link||"",vector_id:be},yt=await No(me.content,Q.embedding_provider,Q.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:Q._ajax_nonce,vectors:JSON.stringify([{id:be,values:yt,metadata:Le}]),embedding_provider:Q.embedding_provider,embedding_model:Q.embedding_model,original_text_content:me.content,index_name:Q.index_name})}},Go=async(G,Q)=>{let te=Array.isArray(G)?G:[];if(te.length)for(let ie=0;ie<te.length;ie+=1){if(window.aipkit_isIndexingStopped){Bt(t("Stopped.","gpt3-ai-content-generator"),"warning");return}let le=te[ie]||{},pe=le.postId||le.id;if(!pe)continue;Bt(mo(pe,ie,te.length),"info");let me=await $o(pe);if(!me||!me.content)continue;let be=o(),Le={source:"wordpress_post",created_at:new Date().toISOString(),post_id:pe,title:me.title||"",url:me.edit_link||"",vector_id:be},yt=await No(me.content,Q.embedding_provider,Q.embedding_model);await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",{_ajax_nonce:Q._ajax_nonce,vectors:JSON.stringify([{id:be,vector:yt,payload:Le}]),embedding_provider:Q.embedding_provider,embedding_model:Q.embedding_model,original_text_content:me.content,collection_name:Q.collection_name,source_context:"chatbot_settings_website"})}};typeof window.aipkit_indexOpenAIBatch!="function"&&(window.aipkit_indexOpenAIBatch=Wn),typeof window.aipkit_indexPineconeBatch!="function"&&(window.aipkit_indexPineconeBatch=Oo),typeof window.aipkit_indexQdrantBatch!="function"&&(window.aipkit_indexQdrantBatch=Go);let eo=G=>G?Array.isArray(G)?G.flatMap(Q=>{if(Array.isArray(Q))return Q;if(Q&&typeof Q=="object"){if(Array.isArray(Q.models))return Q.models;if(Array.isArray(Q.items))return Q.items;if(Q.id)return[Q]}return[]}):typeof G=="object"?Object.values(G).flatMap(Q=>Array.isArray(Q)?Q:[]):[]:[],Ro=G=>{let Q=window.aipkit_chat_config||{};return G==="openai"?eo(Q.openaiEmbeddingModels):G==="google"?eo(Q.googleEmbeddingModels):G==="openrouter"?eo(Q.openrouterEmbeddingModels):G==="azure"?eo(Q.azureEmbeddingModels):[]},go=(G,Q)=>!G||!Q?"":`${G}::${Q}`,ko=G=>{let Q=(G||"").split("::"),te=Q.shift()||"",ie=Q.join("::")||"";return{provider:te,model:ie}},wo=G=>{if(!G)return;let Q=G.querySelector(".aipkit_vector_embedding_select");if(!Q)return;let te=G.querySelector('[name="vector_embedding_provider"]'),ie=G.querySelector('[name="vector_embedding_model"]'),le=te?te.value:"",pe=ie?ie.value:"",me=go(le,pe);if(!me||Q.value===me)return;let be=typeof CSS<"u"&&CSS.escape?CSS.escape(me):me.replace(/"/g,'\\"');Q.querySelector(`option[value="${be}"]`)&&(Q.value=me)},Ko=G=>{let Q=Vi();if(!Q||!G)return;let te=Q.querySelector('[name="vector_embedding_provider"]'),ie=Q.querySelector('[name="vector_embedding_model"]'),le=G.selectedOptions[0],pe=ko(G.value||""),me=pe.provider||le&&le.dataset.provider||"",be=pe.model||"";te&&(te.value=me),ie&&(ie.value=be),te&&ie&&me&&typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&(ie.value=be,window.aipkit_populateVectorEmbeddingModelSelect(Q),be&&(ie.value=be))},ho=(G,Q)=>{if(!Q)return null;let ie=Ro(G).find(me=>me&&me.id===Q),le=ie?.dimensions||ie?.dimension||ie?.output_dimensionality||ie?.outputDimensionality||ie?.output_dimension,pe=le?Number(le):NaN;if(Number.isFinite(pe)&&pe>0)return pe;if(ie&&typeof ie.name=="string"){let me=ie.name.match(/\((\d{3,5})\)/);if(me)return Number(me[1])}return G==="google"?768:1536},to=()=>{let{pineconeKeyInput:G,qdrantUrlInput:Q,qdrantKeyInput:te}=nn(),ie=!!(G&&G.value.trim()||a),le=!!(Q&&Q.value.trim()||p),pe=!!(te&&te.value.trim()||l);return{openai:d,pinecone:ie,qdrant:le&&pe}},Do=()=>{let G=to();return G.openai?"openai":G.pinecone?"pinecone":G.qdrant?"qdrant":""},Wo=()=>d?"openai":_?"google":f?"azure":"",ce=()=>{let G=Vi();if(!G)return{provider:"",model:""};let Q=G.querySelector('[name="vector_embedding_provider"]'),te=G.querySelector('[name="vector_embedding_model"]'),ie=Q?Q.value:"";ie||(ie=Wo(),Q&&ie&&(Q.value=ie,typeof window.aipkit_populateVectorEmbeddingModelSelect=="function"&&window.aipkit_populateVectorEmbeddingModelSelect(G)));let le=te?te.value:"";if(!le&&ie){let pe=Ro(ie);le=pe.length?pe[0].id:"",te&&le&&(te.value=le)}return wo(G),{provider:ie,model:le}},we=G=>{if(!G)return"";let te=(G.selectedOptions?Array.from(G.selectedOptions):[]).find(ie=>ie&&ie.value);return te?te.value:""},Se=(G,Q)=>{!G||!Q||Array.from(G.options).forEach(te=>{te.selected=te.value===Q})},Oe=async G=>{let{openaiStoresSelect:Q}=nn(),te=we(Q);if(!te&&Q&&(On(Q),te=we(Q)),!te){let ie=Ii("aipkit_vector_store_nonce_openai");if(!ie)throw new Error("OpenAI vector store nonce missing.");let le=`Chatbot ${G} ${Date.now()}`,pe=await window.aipkit_apiRequest("aipkit_create_vector_store_openai",{_ajax_nonce:ie,name:le,source_type:"chatbot_training_text"}),me=pe.store||pe;if(!me||!me.id)throw new Error("OpenAI vector store creation failed.");if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.openaiVectorStores)||(window.aipkit_chat_config.openaiVectorStores=[]),window.aipkit_chat_config.openaiVectorStores.some(Le=>Le&&Le.id===me.id)||window.aipkit_chat_config.openaiVectorStores.push(me),typeof window.aipkit_populateOpenAIVectorStoresMultiSelect=="function"){let Le=Vi();Le&&window.aipkit_populateOpenAIVectorStoresMultiSelect(Le)}Q&&Se(Q,me.id),te=me.id}return te},_t=async(G,Q)=>{let{pineconeIndexSelect:te}=nn(),ie=te?te.value:"";if(!ie&&te&&(co(te),ie=te.value),!ie){let le=Ii("aipkit_vector_store_pinecone_nonce_management");if(!le)throw new Error("Pinecone nonce missing.");let pe=`chatbot-${G}-${Date.now()}`,me=await window.aipkit_apiRequest("aipkit_create_index_pinecone",{_ajax_nonce:le,name:pe,dimension:Q,metric:"cosine"}),be=me.index||me,Le=be?.name||pe;if(window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.pineconeIndexes)||(window.aipkit_chat_config.pineconeIndexes=[]),window.aipkit_chat_config.pineconeIndexes.some(nt=>nt&&nt.name===Le||nt===Le)||window.aipkit_chat_config.pineconeIndexes.push(be||Le),typeof window.aipkit_populatePineconeIndexSelect=="function"){let nt=Vi();nt&&window.aipkit_populatePineconeIndexSelect(nt)}te&&(te.value=Le),ie=Le}return ie},gt=async(G,Q)=>{let{qdrantCollectionsSelect:te}=nn(),ie=we(te);if(!ie&&te&&(On(te),ie=we(te)),!ie){let le=Ii("aipkit_vector_store_qdrant_nonce_management");if(!le)throw new Error("Qdrant nonce missing.");let pe=`chatbot-${G}-${Date.now()}`;if(await window.aipkit_apiRequest("aipkit_create_collection_qdrant",{_ajax_nonce:le,name:pe,dimension:Q,metric:"Cosine"}),window.aipkit_chat_config||(window.aipkit_chat_config={}),Array.isArray(window.aipkit_chat_config.qdrantCollections)||(window.aipkit_chat_config.qdrantCollections=[]),window.aipkit_chat_config.qdrantCollections.some(be=>be&&be.name===pe||be===pe||be?.id===pe)||window.aipkit_chat_config.qdrantCollections.push({name:pe}),te){if(!Array.from(te.options).some(Le=>Le.value===pe)){let Le=document.createElement("option");Le.value=pe,Le.textContent=pe,te.appendChild(Le)}Se(te,pe)}if(typeof window.aipkit_populateQdrantCollectionsMultiSelect=="function"){let be=Vi();be&&window.aipkit_populateQdrantCollectionsMultiSelect(be)}ie=pe}return ie};if(Et.length&&!e.dataset.trainingTextBound){let G=!1,Q=me=>{!De||!tt||(me?(De.hidden=!1,De.disabled=!1,tt.disabled=!0):(De.hidden=!0,De.disabled=!1,tt.disabled=!1))},te=()=>{let me=ve?ve.querySelector(".aipkit_builder_tab.is-active"):null;return me?me.dataset.aipkitTab:""},ie=()=>{let me=w?w.querySelector(".aipkit_file_upload_toggle_select"):null;return me?me.dataset.isProPlan==="true":window.aipkit_chat_config?.isProPlan===!0||window.aipkit_dashboard?.isProPlan===!0};_i&&Ft&&_i.addEventListener("click",()=>{Ft.click()});let le=async()=>{if(G)return;let me=te(),be="",Le="chatbot_training_text",yt=[],nt=null;if(me==="text"){if(be=Ie?Ie.value.trim():"",!be){Ct("Add text to train.","warning"),ei();return}}else if(me==="qa"){let je=at?at.value.trim():"",mt=rt?rt.value.trim():"";if(!je||!mt){Ct("Add a question and answer to train.","warning"),ei();return}be=`Q: ${je}
A: ${mt}`,Le="chatbot_training_qa"}else if(me==="files"){if(!ie()){Ct("Upgrade to use file uploads.","warning");return}if(yt=Ft?Array.from(Ft.files||[]):[],!yt.length){Ft&&Ft.click(),Ct("Choose files to upload.","warning"),ei();return}Le="chatbot_training_file"}else if(me==="website"){let je=Ei(),mt=qe(je),qt=$i(je),Te=xe();if(je==="specific"){if(!Te.length){Ct("Select content to train.","warning"),ei();return}}else if(!qt.length){Ct("Select at least one post type.","warning"),ei();return}nt={mode:je,statusValue:mt,postTypes:qt,selectedPostIds:Te}}else{Ct("Select a training tab to continue.","warning"),ei();return}let Gt=m&&m.value||e.getAttribute("data-active-bot-id");if(!Gt){Ct("Select a chatbot before training.","error"),ei();return}let yi=nn(),Oi=yi?yi.providerSelect:null,Xi=Oi?Oi.value:"";if(Xi==="claude_files"){Ct("Claude Files is available for frontend chat upload only. Use OpenAI, Pinecone, or Qdrant for training.","warning"),ei();return}let Sn=["openai","pinecone","qdrant"],mi="";if(Xi&&Sn.includes(Xi)?mi=Xi:mi=Do(),!mi){Ct("Add an OpenAI, Pinecone, or Qdrant key to train.","error");return}G=!0,Q(!0),Et.forEach(je=>{je.disabled=!0}),Ct("Preparing training...","loading");try{let je=w&&w.querySelector(".aipkit_vector_store_enable_select")||e.querySelector(".aipkit_vector_store_enable_select");je&&(je.tagName==="SELECT"?je.value="1":je.checked=!0),Oi&&(Oi.value=mi),lo(),rn();let mt="",qt="",Te="",Nt="",si="";if(mi==="openai"){if(!d)throw new Error("OpenAI API key missing.");Te=await Oe(Gt)}else if(mi==="pinecone"){if(!to().pinecone)throw new Error("Pinecone API key missing.");let kt=ce();if(mt=kt.provider,qt=kt.model,!mt||!qt)throw new Error("Select an embedding provider and model.");let et=ho(mt,qt);Nt=await _t(Gt,et)}else if(mi==="qdrant"){if(!to().qdrant)throw new Error("Qdrant URL and API key are required.");let kt=ce();if(mt=kt.provider,qt=kt.model,!mt||!qt)throw new Error("Select an embedding provider and model.");let et=ho(mt,qt);si=await gt(Gt,et)}if(hi(N()),dn(),pi(N()),me==="files"){Ln();for(let Kt=0;Kt<yt.length;Kt+=1){let kt=yt[Kt];Ct(`Uploading ${Kt+1} of ${yt.length}...`,"loading"),Ni(kt,"Uploading","loading");try{let et=new FormData;if(mi==="openai"){let Ot=Ii("aipkit_vector_store_nonce_openai");if(!Ot)throw new Error("OpenAI vector store nonce missing.");et.append("aipkit_vs_global_file_to_submit",kt),et.append("target_store_id",Te),et.append("source_type",Le),et.append("_ajax_nonce",Ot);let ci=await window.aipkit_api_upsertFile(et,"aipkit_upload_and_add_file_to_store_direct_openai");Ni(kt,"Processing","loading");let qi=ci?.batch?.id;Zn(kt,N()).then(Yi=>{if(!Yi){if(qi){Tn(Te,qi,kt);return}Ni(kt,"Queued","warning")}})}else if(mi==="pinecone"){let Ot=Ii("aipkit_vector_store_pinecone_nonce_management");if(!Ot)throw new Error("Pinecone nonce missing.");et.append("file_to_upload",kt),et.append("index_name",Nt),et.append("embedding_provider",mt),et.append("embedding_model",qt),et.append("_ajax_nonce",Ot),await window.aipkit_api_upsertFile(et,"aipkit_upload_file_and_upsert_to_pinecone"),Ni(kt,"Trained","success")}else if(mi==="qdrant"){let Ot=Ii("aipkit_vector_store_qdrant_nonce_management");if(!Ot)throw new Error("Qdrant nonce missing.");et.append("file_to_upload",kt),et.append("target_store_id",si),et.append("embedding_provider",mt),et.append("embedding_model",qt),et.append("source_context","chatbot_settings_file_upload"),et.append("_ajax_nonce",Ot),await window.aipkit_api_upsertFile(et,"aipkit_upload_file_and_upsert_to_qdrant"),Ni(kt,"Trained","success")}}catch(et){throw Ni(kt,"Failed","error"),et}}Ft&&(Ft.value=""),Ln(),Ct("Saved","success"),ei(),en(),G=!1,Q(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet();return}else if(me==="website"&&nt){let{mode:Kt,statusValue:kt,postTypes:et,selectedPostIds:Ot}=nt,ci=Ot,qi=ci.length;if(Kt==="bulk"){if(Ct("Preparing website content...","loading"),qi=(await ht(et,kt,Te)).total,!qi){Bt("No posts found for selection.","error"),Ct("Nothing to train.","warning"),ei();return}if(await ji(qi,kt)){await gn({botId:Gt,postTypes:et,provider:mi,targetStoreId:mi==="openai"?Te:mi==="pinecone"?Nt:si,embeddingProvider:mt,embeddingModel:qt}),Bt("Queued in the background. You can monitor it in the Automate module. You can close this page.","success"),Ct("Queued","success"),ei(),en(N()),G=!1,Q(!1);return}if(qi>200&&kt!=="publish"&&Bt("Background indexing supports published content only.","info"),ci=await Li(et,kt,Te),!ci.length){Bt("No posts found for selection.","error"),Ct("Nothing to train.","warning"),ei();return}}Ct("Training...","loading"),Bt(`Training ${qi||ci.length} item(s)...`,"info"),window.aipkit_isIndexingStopped=!1;let Yi=Xt?Xt.id:"aipkit_training_wp_status";if(mi==="openai"){let zi=Ii("aipkit_wp_content_index_nonce");if(!zi)throw new Error("WP content index nonce missing.");await window.aipkit_indexOpenAIBatch(ci,{_ajax_nonce:zi,target_store_id:Te,provider:"openai",source_type:"wordpress_content"},Yi)}else if(mi==="pinecone"){let zi=Ii("aipkit_vector_store_pinecone_nonce_management");if(!zi)throw new Error("Pinecone nonce missing.");let _n=ci.map(Hn=>({id:`wp_post_${Hn}`,postId:Hn,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${Hn}`}}));await window.aipkit_indexPineconeBatch(_n,{_ajax_nonce:zi,index_name:Nt,embedding_provider:mt,embedding_model:qt,source_type:"wordpress_content"},Yi)}else if(mi==="qdrant"){let zi=Ii("aipkit_vector_store_qdrant_nonce_management");if(!zi)throw new Error("Qdrant nonce missing.");let _n=ci.map(Hn=>({id:typeof window.aipkit_generateUUIDv4=="function"?window.aipkit_generateUUIDv4():`wp_post_${Hn}`,postId:Hn,type:"wp_post",metadata:{source:"wordpress_content",created_at:new Date().toISOString(),vector_id:`wp_post_${Hn}`}}));await window.aipkit_indexQdrantBatch(_n,{_ajax_nonce:zi,collection_name:si,embedding_provider:mt,embedding_model:qt,source_type:"wordpress_content"},Yi)}Ct("Saved","success"),ei(),en(N()),G=!1,Q(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}else{if(Ct("Training...","loading"),mi==="openai"){let Kt=Ii("aipkit_vector_store_nonce_openai");if(!Kt)throw new Error("OpenAI vector store nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:Kt,target_store_id:Te,text_content:be,source_type:Le})}else if(mi==="pinecone"){let Kt=Ii("aipkit_vector_store_pinecone_nonce_management");if(!Kt)throw new Error("Pinecone nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let kt=`text_${Date.now()}`,et={source:Le,created_at:new Date().toISOString(),original_content:be,vector_id:kt},Ot=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:be,embedding_provider:mt,embedding_model:qt,_ajax_nonce:window.aipkit_dashboard.nonce}),ci=Ot.embeddings&&Ot.embeddings.length?Ot.embeddings[0]:null;if(!ci)throw new Error("Failed to generate embedding.");await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:Kt,vectors:JSON.stringify([{id:kt,values:ci,metadata:et}]),embedding_provider:mt,embedding_model:qt,original_text_content:be,index_name:Nt})}else if(mi==="qdrant"){let Kt=Ii("aipkit_vector_store_qdrant_nonce_management");if(!Kt)throw new Error("Qdrant nonce missing.");if(!window.aipkit_dashboard?.nonce)throw new Error("Embedding nonce missing.");let kt=o(),et={source:Le,created_at:new Date().toISOString(),original_content:be,vector_id:kt},Ot=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:be,embedding_provider:mt,embedding_model:qt,_ajax_nonce:window.aipkit_dashboard.nonce}),ci=Ot.embeddings&&Ot.embeddings.length?Ot.embeddings[0]:null;if(!ci)throw new Error("Failed to generate embedding.");let qi={_ajax_nonce:Kt,vectors:JSON.stringify([{id:kt,vector:ci,payload:et}]),embedding_provider:mt,embedding_model:qt,original_text_content:be,collection_name:si,source_context:"chatbot_settings_training"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",qi)}me==="text"&&Ie&&(Ie.value=""),me==="qa"&&(at&&(at.value=""),rt&&(rt.value="")),Ct("Saved","success"),ei(),en(),G=!1,Q(!1),typeof window.aipkit_refreshSourcesSheet=="function"&&window.aipkit_refreshSourcesSheet()}}catch(je){Ct(`Error: ${je.message||"Training failed."}`,"error")}finally{G=!1,Q(!1),Et.forEach(je=>{je.disabled=!1}),Ln()}},pe=()=>{if(!Ft)return;let me=Array.from(Ft.files||[]);if(me.length){if(me.forEach(be=>{fo(be),Ni(be,"Queued")}),Ln(),!ie()){Ct("Upgrade to use file uploads.","warning"),me.forEach(be=>{Ni(be,"Upgrade","warning")});return}le()}};Ft&&Ft.addEventListener("change",pe),Et.forEach(me=>{me.addEventListener("click",le)}),De&&!De.dataset.listenerAttached&&(De.addEventListener("click",()=>{G&&(window.aipkit_isIndexingStopped=!0,De.disabled=!0,Ct("Stopping...","warning"))}),De.dataset.listenerAttached="true"),en(),Pn(),e.dataset.trainingTextBound="1"}if(vt&&!e.dataset.sourcesSheetBound){let G=window.aipkit_escapeHtml||function(je){return je},Q={openai:"OpenAI",pinecone:"Pinecone",qdrant:"Qdrant",claude_files:"Claude Files"},te={page:1,search:"",status:""},ie=null,le=(je,mt)=>{ut&&(ut.textContent=je||"",ut.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),mt==="success"&&ut.classList.add("aipkit_form-help-success"),mt==="error"&&ut.classList.add("aipkit_form-help-error"))},pe=()=>{ut&&setTimeout(()=>{ut.textContent="",ut.classList.remove("aipkit_form-help-success","aipkit_form-help-error")},2500)},me=(je,mt)=>{Ci&&(Ci.textContent=je||"\u2014"),tn&&(tn.textContent=mt||"\u2014")},be=()=>{let je=N(),mt=je.vector_store_provider||"",qt=Q[mt]||"",Te=[],Nt="",si=Vi(),Kt=si?si.querySelector('select[name="openai_vector_store_ids[]"]'):null;if(mt==="openai"){if(Te=Array.isArray(je.openai_vector_store_ids)?je.openai_vector_store_ids.filter(Boolean):[],Kt){let kt=Array.from(Kt.selectedOptions).map(et=>et.textContent.trim()).filter(Boolean);kt.length&&(Nt=kt.join(", "))}Nt||(Nt=Te.join(", "))}else mt==="pinecone"?je.pinecone_index_name&&(Te=[je.pinecone_index_name],Nt=je.pinecone_index_name):mt==="qdrant"&&(Te=Array.isArray(je.qdrant_collection_names)?je.qdrant_collection_names.filter(Boolean):[],Nt=Te.join(", "));return{contextSettings:je,providerKey:mt,providerLabel:qt,storeIds:Te,storeLabel:Nt}},Le=je=>{Pt&&(Pt.innerHTML=`<tr><td colspan="5" class="aipkit_text-center">${G(je)}</td></tr>`,Mt&&(Mt.innerHTML=""))},yt=(je,mt)=>{if(!Pt)return;if(!je.length){Le("No sources found.");return}let qt=je.map(Te=>{let Nt=(Te.provider||mt||"").toLowerCase(),si=typeof window.aipkit_determineContentType=="function"?window.aipkit_determineContentType(Te.message||"",Te.file_id||"",Nt,Te):"N/A",Kt=si==="Text"?"aipkit_type-text":si==="File Upload"?"aipkit_type-file":si==="Site Content"?"aipkit_type-site":"aipkit_type-na",kt=Te.status==="indexed"||Te.status==="skipped_already_indexed"||Te.status==="success"?"aipkit_status-success":Te.status==="failed"?"aipkit_status-warning":"aipkit_status-info",et="\u2014";Te.status&&(et=Te.status==="indexed"||Te.status==="skipped_already_indexed"||Te.status==="success"?"Trained":Te.status.replace(/_/g," "));let Ot=Te.status==="processing"||Te.status==="queued",ci=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(Te.timestamp):typeof window.aipkit_formatUtcDateTime=="function"?window.aipkit_formatUtcDateTime(Te.timestamp):Te.timestamp||"\u2014",qi=Te.indexed_content||"",Yi=Te.post_title||(Te.post_id?`Post #${Te.post_id}`:"")||qi||Te.message||Te.file_id||"\u2014",zi=Yi.length>60?`${Yi.substring(0,60)}...`:Yi,_n=[];return si==="Site Content"&&Te.post_id&&_n.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_retrain"
                    data-provider="${G(Te.provider||mt)}"
                    data-store-id="${G(Te.vector_store_id||"")}"
                    data-vector-id="${G(Te.file_id||"")}"
                    data-log-id="${G(Te.id||"")}"
                    data-post-id="${G(Te.post_id||"")}"
                    data-embedding-provider="${G(Te.embedding_provider||"")}"
                    data-embedding-model="${G(Te.embedding_model||"")}"
                    ${Ot?'disabled aria-disabled="true"':""}
                  >${Ot?"Training...":"Retrain"}</button>`),si==="Text"&&qi&&_n.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_sources_action_edit"
                    data-provider="${G(Te.provider||mt)}"
                    data-store-id="${G(Te.vector_store_id||"")}"
                    data-vector-id="${G(Te.file_id||"")}"
                    data-log-id="${G(Te.id||"")}"
                    data-embedding-provider="${G(Te.embedding_provider||"")}"
                    data-embedding-model="${G(Te.embedding_model||"")}"
                    data-content="${encodeURIComponent(qi)}"
                    ${Ot?'disabled aria-disabled="true"':""}
                  >${Ot?"Training...":"Edit"}</button>`),qi&&_n.push(`<button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_view_snippet_icon"
                    data-file-id="${G(Te.id||"")}"
                    data-snippet="${G(qi)}"
                    ${Te.batch_id?`data-batch-id="${G(Te.batch_id)}" data-store-id="${G(Te.vector_store_id||"")}"`:""}
                    ${Ot?'disabled aria-disabled="true"':""}
                  >View</button>`),Te.file_id&&_n.push(`<button type="button" class="aipkit_btn aipkit_btn-as-link aipkit_sources_action_delete"
                    data-provider="${G(Te.provider||mt)}"
                    data-store-id="${G(Te.vector_store_id||"")}"
                    data-vector-id="${G(Te.file_id||"")}"
                    data-log-id="${G(Te.id||"")}"
                    ${Ot?'disabled aria-disabled="true"':""}
                  >Delete</button>`),`<tr data-log-id="${G(Te.id||"")}">
                <td style="white-space: nowrap;">${G(ci)}</td>
                <td><span class="aipkit_content-type-tag ${Kt}">${G(si)}</span></td>
                <td title="${G(Yi)}">${G(zi)}</td>
                <td style="white-space: nowrap;"><span class="aipkit_status-tag ${kt}">${G(et)}</span></td>
                <td class="aipkit_actions_cell">
                  <div class="aipkit-table-actions-group">${_n.join("")}</div>
                </td>
              </tr>`}).join("");Pt.innerHTML=qt,typeof window.aipkit_attachSnippetModalListeners=="function"&&window.aipkit_attachSnippetModalListeners(Pt,mt)},nt=async(je=1)=>{if(!Pt||typeof window.aipkit_apiRequest!="function")return;let mt=m&&m.value||e.getAttribute("data-active-bot-id");if(!mt){Le("Select a chatbot to view sources.");return}let{contextSettings:qt,providerKey:Te,providerLabel:Nt,storeIds:si,storeLabel:Kt}=be();if(me(Nt,Kt),qt.enable_vector_store!=="1"){Le("Enable a knowledge base to view sources.");return}if(!Te||!si.length){Le("Select a knowledge base store to view sources.");return}Pt.innerHTML='<tr><td colspan="5" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Loading sources...</td></tr>',Mt&&(Mt.innerHTML="");try{let kt={bot_id:mt,page:je,search:te.search,status:te.status,enable_vector_store:qt.enable_vector_store,vector_store_provider:qt.vector_store_provider,openai_vector_store_ids:qt.openai_vector_store_ids||[],pinecone_index_name:qt.pinecone_index_name,qdrant_collection_names:qt.qdrant_collection_names||[]},et=await window.aipkit_apiRequest("aipkit_get_chatbot_training_sources",kt);te.page=je,yt(et.logs||[],Nt),typeof window.aipkit_renderLogsPagination=="function"&&et.pagination&&Mt&&window.aipkit_renderLogsPagination(et.pagination,Mt,Ot=>nt(Ot))}catch(kt){Le(`Error loading sources: ${G(kt.message||"Unknown error")}`)}},Gt=(je=1)=>{!y||!y.classList.contains("aipkit-active")||vt.hidden||nt(je)};window.aipkit_refreshSourcesSheet=Gt;let yi=()=>{Dt&&(Dt.classList.remove("aipkit-active"),Dt.setAttribute("aria-hidden","true"),Dt.dataset.provider="",Dt.dataset.storeId="",Dt.dataset.vectorId="",Dt.dataset.logId="",Dt.dataset.embeddingProvider="",Dt.dataset.embeddingModel="",on&&(on.value=""))},Oi=je=>{!Dt||!on||(Dt.dataset.provider=je.dataset.provider||"",Dt.dataset.storeId=je.dataset.storeId||"",Dt.dataset.vectorId=je.dataset.vectorId||"",Dt.dataset.logId=je.dataset.logId||"",Dt.dataset.embeddingProvider=je.dataset.embeddingProvider||"",Dt.dataset.embeddingModel=je.dataset.embeddingModel||"",on.value=je.dataset.content?decodeURIComponent(je.dataset.content):"",Dt.classList.add("aipkit-active"),Dt.setAttribute("aria-hidden","false"),setTimeout(()=>on.focus(),0))},Xi=()=>{ni&&(ni.classList.remove("aipkit-active"),ni.setAttribute("aria-hidden","true"),ni.dataset.provider="",ni.dataset.storeId="",ni.dataset.vectorId="",ni.dataset.logId="")},Sn=je=>{ni&&(ni.dataset.provider=je.providerLabel||"",ni.dataset.storeId=je.storeId||"",ni.dataset.vectorId=je.vectorId||"",ni.dataset.logId=je.logId||"",ni.classList.add("aipkit-active"),ni.setAttribute("aria-hidden","false"),cn&&(cn.disabled=!1))},mi=async(je,mt,qt,Te,Nt)=>{let si=je.toLowerCase();if(si==="openai"){let et=Ii("aipkit_vector_store_nonce_openai");if(!et)throw new Error("OpenAI nonce missing.");await window.aipkit_apiRequest("aipkit_add_text_to_vector_store_openai",{_ajax_nonce:et,target_store_id:mt,text_content:qt,source_type:"chatbot_training_text"});return}if(!Te||!Nt){let et=N();Te=Te||et.vector_embedding_provider,Nt=Nt||et.vector_embedding_model}if(!Te||!Nt)throw new Error("Select an embedding provider and model.");let Kt=await window.aipkit_apiRequest("aipkit_generate_embedding",{content_to_embed:qt,embedding_provider:Te,embedding_model:Nt}),kt=Kt.embeddings&&Kt.embeddings.length?Kt.embeddings[0]:null;if(!kt)throw new Error("Failed to generate embedding.");if(si==="pinecone"){let et=Ii("aipkit_vector_store_pinecone_nonce_management");if(!et)throw new Error("Pinecone nonce missing.");let Ot=`text_${Date.now()}`;await window.aipkit_apiRequest("aipkit_upsert_to_pinecone_index",{_ajax_nonce:et,vectors:JSON.stringify([{id:Ot,values:kt,metadata:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:qt,vector_id:Ot}}]),embedding_provider:Te,embedding_model:Nt,original_text_content:qt,index_name:mt});return}if(si==="qdrant"){let et=Ii("aipkit_vector_store_qdrant_nonce_management");if(!et)throw new Error("Qdrant nonce missing.");let Ot=o(),ci={_ajax_nonce:et,vectors:JSON.stringify([{id:Ot,vector:kt,payload:{source:"chatbot_training_text",created_at:new Date().toISOString(),original_content:qt,vector_id:Ot}}]),embedding_provider:Te,embedding_model:Nt,original_text_content:qt,collection_name:mt,source_context:"chatbot_settings_sources_sheet"};await window.aipkit_apiRequest("aipkit_upsert_to_qdrant_collection",ci)}};ki&&ki.addEventListener("input",()=>{ie&&window.clearTimeout(ie),ie=window.setTimeout(()=>{te.search=ki.value.trim(),Gt(1)},300)}),oi&&oi.addEventListener("change",()=>{te.status=oi.value,Gt(1)}),Be&&Be.addEventListener("click",()=>{Gt(te.page||1)}),Zi&&Zi.addEventListener("click",yi),sn&&sn.addEventListener("click",yi),Dt&&!Dt.dataset.bound&&(document.addEventListener("keydown",je=>{je.key==="Escape"&&Dt.classList.contains("aipkit-active")&&yi()}),Dt.dataset.bound="1"),En&&En.addEventListener("click",async()=>{if(!Dt||!on)return;let je=on.value.trim();if(!je){le("Text cannot be empty.","error"),pe();return}let mt=Dt.dataset.provider||"",qt=Dt.dataset.storeId||"",Te=Dt.dataset.vectorId||"",Nt=Dt.dataset.logId||"",si=Dt.dataset.embeddingProvider||"",Kt=Dt.dataset.embeddingModel||"";if(!mt||!qt||!Te||!Nt){le("Missing source details.","error"),pe();return}if(yi(),Pt&&Nt){let kt=typeof CSS<"u"&&CSS.escape?CSS.escape(String(Nt)):String(Nt).replace(/[^a-zA-Z0-9_-]/g,"\\$&"),et=Pt.querySelector(`tr[data-log-id="${kt}"]`),Ot=et?et.querySelector(".aipkit_sources_action_edit"):null,ci=et?et.querySelector(".aipkit_view_snippet_icon"):null,qi=et?et.querySelector(".aipkit_sources_action_delete"):null;Ot&&(Ot.disabled=!0,Ot.setAttribute("aria-disabled","true"),Ot.textContent="Training..."),ci&&(ci.disabled=!0,ci.setAttribute("aria-disabled","true")),qi&&(qi.disabled=!0,qi.setAttribute("aria-disabled","true"))}le("Training...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:mt,store_id:qt,vector_id:Te,log_id:Nt}),await mi(mt,qt,je,si,Kt),le("Trained","success"),pe(),yi(),Gt(te.page||1),en(N())}catch(kt){le(`Error: ${kt.message||"Failed to save."}`,"error")}}),Vn&&Vn.addEventListener("click",Xi),Cn&&Cn.addEventListener("click",Xi),cn&&cn.addEventListener("click",async()=>{if(!ni)return;let je=ni.dataset.provider||"",mt=ni.dataset.storeId||"",qt=ni.dataset.vectorId||"",Te=ni.dataset.logId||"";if(!je||!mt||!qt||!Te){le("Missing source details.","error"),pe(),Xi();return}Xi();let Nt=null,si=null,Kt=null,kt=null,et=null;if(Pt&&Te){let Ot=typeof CSS<"u"&&CSS.escape?CSS.escape(String(Te)):String(Te).replace(/[^a-zA-Z0-9_-]/g,"\\$&");Nt=Pt.querySelector(`tr[data-log-id="${Ot}"]`),Nt&&(si=Nt.querySelector(".aipkit_sources_action_edit"),Kt=Nt.querySelector(".aipkit_sources_action_retrain"),kt=Nt.querySelector(".aipkit_view_snippet_icon"),et=Nt.querySelector(".aipkit_sources_action_delete"),[si,Kt,kt,et].forEach(ci=>{ci&&(ci.disabled=!0,ci.setAttribute("aria-disabled","true"))}),et&&(et.textContent="Deleting..."))}cn&&(cn.disabled=!0),le("Deleting...","");try{await window.aipkit_apiRequest("aipkit_delete_vector_data_source_entry",{provider:je,store_id:mt,vector_id:qt,log_id:Te}),le("Deleted","success"),pe(),Gt(te.page||1),en(N())}catch(Ot){le(`Error: ${Ot.message||"Failed to delete."}`,"error"),[si,Kt,kt,et].forEach(ci=>{ci&&(ci.disabled=!1,ci.removeAttribute("aria-disabled"))}),et&&(et.textContent="Delete")}finally{cn&&(cn.disabled=!1)}}),ni&&!ni.dataset.bound&&(document.addEventListener("keydown",je=>{je.key==="Escape"&&ni.classList.contains("aipkit-active")&&Xi()}),ni.dataset.bound="1"),vt.addEventListener("click",async je=>{let mt=je.target.closest(".aipkit_sources_action_edit");if(mt){Oi(mt);return}let qt=je.target.closest(".aipkit_sources_action_delete");if(qt){let Nt=qt.dataset.provider||"",si=qt.dataset.storeId||"",Kt=qt.dataset.vectorId||"",kt=qt.dataset.logId||"";if(!Nt||!si||!Kt||!kt){le("Missing source details.","error"),pe();return}Sn({providerLabel:Nt,storeId:si,vectorId:Kt,logId:kt});return}let Te=je.target.closest(".aipkit_sources_action_retrain");if(Te){let Nt=Te.dataset.provider||"",si=Te.dataset.storeId||"",Kt=Te.dataset.vectorId||"",kt=Te.dataset.logId||"",et=Te.dataset.postId||"",Ot=Te.dataset.embeddingProvider||"",ci=Te.dataset.embeddingModel||"";if(!Nt||!si||!Kt||!kt||!et){le("Missing source details.","error"),pe();return}Te.disabled=!0,Te.setAttribute("aria-disabled","true"),Te.textContent="Training...";let qi=Te.closest("tr"),Yi=qi?qi.querySelector(".aipkit_view_snippet_icon"):null,zi=qi?qi.querySelector(".aipkit_sources_action_delete"):null;Yi&&(Yi.disabled=!0,Yi.setAttribute("aria-disabled","true")),zi&&(zi.disabled=!0,zi.setAttribute("aria-disabled","true")),le("Retraining...","");try{await window.aipkit_apiRequest("aipkit_reindex_vector_data_source_entry",{provider:Nt,store_id:si,vector_id:Kt,log_id:kt,post_id:et,embedding_provider:Ot,embedding_model:ci}),le("Retrained","success"),pe(),Gt(te.page||1),en(N())}catch(_n){le(`Error: ${_n.message||"Failed to retrain."}`,"error"),Te.disabled=!1,Te.removeAttribute("aria-disabled"),Te.textContent="Retrain",Yi&&(Yi.disabled=!1,Yi.removeAttribute("aria-disabled")),zi&&(zi.disabled=!1,zi.removeAttribute("aria-disabled"))}}}),e.dataset.sourcesSheetBound="1"}e.dataset.contextSettingsAutosaveBound="1"}let Fe=Ao();if(Fe&&Si&&!e.dataset.tokenLimitsAutosaveBound){let R=!1,D=null,N=()=>{let K=Fe.querySelectorAll('input[name^="token_role_limits["]'),$={};return K.forEach(J=>{let oe=J.getAttribute("name");oe&&($[oe]=J.value)}),$},X=()=>{let K=$=>{let J=Fe.querySelector($);return J?J.value:""};return{token_guest_limit:K('[name="token_guest_limit"]'),token_user_limit:K('[name="token_user_limit"]'),token_limit_mode:K('[name="token_limit_mode"]'),token_reset_period:K('[name="token_reset_period"]'),token_limit_message:K('[name="token_limit_message"]'),role_limits:N()}},Z=X(),se=K=>{let $=m&&m.value||e.getAttribute("data-active-bot-id");if(!$)return;R=!0,Ze("Auto-saving...","");let J={bot_id:$,token_guest_limit:K.token_guest_limit,token_user_limit:K.token_user_limit,token_limit_mode:K.token_limit_mode,token_reset_period:K.token_reset_period,token_limit_message:K.token_limit_message};Object.entries(K.role_limits).forEach(([oe,he])=>{J[oe]=he}),window.aipkit_apiRequest("aipkit_update_chatbot_token_limits",J).then(oe=>{Z=K,Ze(oe.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview($),ai()}).catch(oe=>{Ze(`Error: ${oe.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D){let oe=D;D=null,JSON.stringify(oe)!==JSON.stringify(Z)&&se(oe)}})},re=K=>{if(JSON.stringify(K)!==JSON.stringify(Z)){if(R){D=K;return}se(K)}};Fe.addEventListener("change",K=>{let $=K.target;if($){if($.matches(".aipkit_token_limit_mode_select")){po(),re(X());return}($.matches('[name="token_guest_limit"]')||$.matches('[name="token_user_limit"]')||$.matches('[name="token_reset_period"]')||$.matches('[name="token_limit_message"]')||$.matches('input[name^="token_role_limits["]'))&&re(X())}}),e.dataset.tokenLimitsAutosaveBound="1"}let $e=I?I.querySelector('[data-aipkit-settings-panel="appearance"]'):null;if($e&&Si&&!e.dataset.styleSettingsAutosaveBound){let R=$e;if(R){let D=!1,N=null,X=()=>{let K={},$=At=>{let Zt=R.querySelector(At);return!Zt||Zt.disabled?null:Zt.value||""},J=R.querySelector('select[name="theme"]');if(J&&!J.disabled)K.theme=J.value||"light";else{let At=R.querySelector('input[name="theme"]:checked');if(At&&!At.disabled)K.theme=At.value||"light";else{let Zt=e.querySelector('input[name="theme"]:checked, select[name="theme"]');Zt&&!Zt.disabled&&(K.theme=Zt.value||"light")}}let oe=$('input[name="greeting"]');oe!==null&&(K.greeting=oe);let he=$('input[name="subgreeting"]');he!==null&&(K.subgreeting=he);let Pe=$('input[name="input_placeholder"]');Pe!==null&&(K.input_placeholder=Pe);let pt=$('input[name="footer_text"]');pt!==null&&(K.footer_text=pt);let ri=$('input[name="custom_typing_text"]');ri!==null&&(K.custom_typing_text=ri);let Yt=At=>{let Zt=R.querySelector(`input[name="${At}"]`);!Zt||Zt.disabled||(K[At]=Zt.checked?"1":"0")};Yt("enable_download"),Yt("enable_copy_button"),Yt("enable_fullscreen"),Yt("enable_feedback"),Yt("enable_conversation_sidebar"),Yt("enable_conversation_starters");let ft=m&&m.value||e.getAttribute("data-active-bot-id");if(ft){let At=document.getElementById(`aipkit_bot_${ft}_enable_consent_compliance`);At&&!At.disabled&&(K.enable_consent_compliance=At.checked?"1":"0");let Zt=document.getElementById(`aipkit_bot_${ft}_enable_ip_anonymization`);Zt&&!Zt.disabled&&(K.enable_ip_anonymization=Zt.checked?"1":"0");let hi=document.getElementById(`aipkit_bot_${ft}_consent_title`);hi&&!hi.disabled&&(K.consent_title=hi.value||"");let xi=document.getElementById(`aipkit_bot_${ft}_consent_message`);xi&&!xi.disabled&&(K.consent_message=xi.value||"");let Ct=document.getElementById(`aipkit_bot_${ft}_consent_button`);Ct&&!Ct.disabled&&(K.consent_button=Ct.value||"");let ei=document.getElementById(`aipkit_bot_${ft}_openai_moderation_enabled`);ei&&!ei.disabled&&(K.openai_moderation_enabled=ei.checked?"1":"0");let Bt=document.getElementById(`aipkit_bot_${ft}_openai_moderation_message`);Bt&&!Bt.disabled&&(K.openai_moderation_message=Bt.value||"");let pi=document.getElementById(`aipkit_bot_${ft}_banned_words`);pi&&!pi.disabled&&(K.banned_words=pi.value||"");let Ei=document.getElementById(`aipkit_bot_${ft}_banned_words_message`);Ei&&!Ei.disabled&&(K.banned_words_message=Ei.value||"");let $i=document.getElementById(`aipkit_bot_${ft}_banned_ips`);$i&&!$i.disabled&&(K.banned_ips=$i.value||"");let qe=document.getElementById(`aipkit_bot_${ft}_banned_ips_message`);qe&&!qe.disabled&&(K.banned_ips_message=qe.value||"");let xe=document.getElementById(`aipkit_bot_${ft}_custom_theme_settings_container`);xe&&xe.querySelectorAll('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]').forEach(He=>{let dt=He.getAttribute("name");dt&&(He.type==="checkbox"?K[dt]=He.checked?"1":"0":He.type==="radio"?He.checked&&(K[dt]=He.value):K[dt]=He.value)});let Ve=document.getElementById(`aipkit_bot_${ft}_conversation_starters`);Ve&&!Ve.disabled&&(K.conversation_starters=Ve.value||"")}return K},Z=X(),se=K=>{let $=m&&m.value||e.getAttribute("data-active-bot-id");$&&(D=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_style_settings",{bot_id:$,...K}).then(J=>{Z=K,Ze(J.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview($),ai()}).catch(J=>{Ze(`Error: ${J.message||"Failed to save."}`,"error")}).finally(()=>{if(D=!1,N){let J=N;N=null,JSON.stringify(J)!==JSON.stringify(Z)&&se(J)}}))},re=K=>{if(JSON.stringify(K)!==JSON.stringify(Z)){if(D){N=K;return}se(K)}};R.addEventListener("change",K=>{let $=K.target;if($&&($.matches('input[name="greeting"]')||$.matches('input[name="subgreeting"]')||$.matches('input[name="input_placeholder"]')||$.matches('input[name="footer_text"]')||$.matches('input[name="custom_typing_text"]')||$.matches('input[name="enable_download"]')||$.matches('input[name="enable_copy_button"]')||$.matches('input[name="enable_fullscreen"]')||$.matches('input[name="enable_feedback"]')||$.matches('input[name="enable_conversation_sidebar"]')||$.matches('input[name="enable_conversation_starters"]')||$.matches('select[name="theme"]')||$.matches('input[name="theme"]'))){if(($.matches('select[name="theme"]')||$.matches('input[name="theme"]'))&&typeof In=="function")if($.value!=="custom")In();else{let J=$.closest(".aipkit_theme_choice_card")||$;Po(J)}re(X())}}),e.addEventListener("change",K=>{let $=K.target;!$||!$.matches||!$.matches('select[name="theme"]')&&!$.matches('input[name="theme"]')||R.contains($)||re(X())}),e.dataset.customThemeAutosaveBound||(document.addEventListener("change",K=>{let $=K.target;$&&$.matches&&$.matches('input[name^="custom_theme_settings["], select[name^="custom_theme_settings["]')&&re(X())}),e.dataset.customThemeAutosaveBound="1"),R.addEventListener("blur",K=>{let $=K.target;$&&($.matches('input[name="greeting"]')||$.matches('input[name="subgreeting"]')||$.matches('input[name="input_placeholder"]')||$.matches('input[name="footer_text"]')||$.matches('input[name="custom_typing_text"]'))&&re(X())},!0),document.addEventListener("change",K=>{let $=K.target;$&&$.matches('textarea[name="conversation_starters"], input[name="enable_consent_compliance"], input[name="enable_ip_anonymization"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_enabled"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&($.matches('input[name="enable_consent_compliance"]')&&To(),$.matches('input[name="openai_moderation_enabled"]')&&Ki(),re(X()))}),document.addEventListener("blur",K=>{let $=K.target;$&&$.matches('textarea[name="conversation_starters"], input[name="consent_title"], textarea[name="consent_message"], input[name="consent_button"], input[name="openai_moderation_message"], textarea[name="banned_words"], input[name="banned_words_message"], textarea[name="banned_ips"], input[name="banned_ips_message"]')&&re(X())},!0),e.dataset.styleSettingsAutosaveBound="1"}}if(y&&Si&&!e.dataset.imageSettingsAutosaveBound){let R=!1,D=null,N=()=>{let K=ct&&ct.querySelector('select[name="chat_image_model_id"]')||w&&w.querySelector('select[name="chat_image_model_id"]')||y.querySelector('select[name="chat_image_model_id"]'),$=ct&&ct.querySelector('input[name="image_triggers"]')||ct&&ct.querySelector('textarea[name="image_triggers"]')||w&&w.querySelector('input[name="image_triggers"]')||w&&w.querySelector('textarea[name="image_triggers"]')||y.querySelector('input[name="image_triggers"]')||y.querySelector('textarea[name="image_triggers"]');if(!K||!$)return null;let J=ct&&ct.querySelector(".aipkit_image_analysis_select")||w&&w.querySelector(".aipkit_image_analysis_select")||y.querySelector(".aipkit_image_analysis_select"),oe=ct&&ct.querySelector(".aipkit_image_analysis_checkbox")||w&&w.querySelector(".aipkit_image_analysis_checkbox")||y.querySelector(".aipkit_image_analysis_checkbox"),he=J&&J.value!==""?J.value:oe&&oe.checked?"1":"0";return{chat_image_model_id:K.value||"",image_triggers:$.value||"",enable_image_upload:he}},X=N()||{},Z=K=>{let $=m&&m.value||e.getAttribute("data-active-bot-id");$&&(R=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_image_settings",{bot_id:$,...K}).then(J=>{X=K,Ze(J.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview($),ai()}).catch(J=>{Ze(`Error: ${J.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D){let J=D;D=null,JSON.stringify(J)!==JSON.stringify(X)&&Z(J)}}))},se=K=>{if(K&&JSON.stringify(K)!==JSON.stringify(X)){if(R){D=K;return}Z(K)}},re=K=>{let $=K.target;$&&($.matches('select[name="chat_image_model_id"]')||$.matches('input[name="image_triggers"]')||$.matches('textarea[name="image_triggers"]')||$.matches(".aipkit_image_analysis_checkbox")||$.matches(".aipkit_image_analysis_select"))&&se(N())};y.addEventListener("change",re),w&&w.addEventListener("change",re),ct&&ct.addEventListener("change",re),e.dataset.imageSettingsAutosaveBound="1"}if(y&&Si&&!e.dataset.replicateKeyAutosaveBound){let D=ct&&ct.querySelector('input[name="replicate_api_key"]')||w&&w.querySelector('input[name="replicate_api_key"]')||y.querySelector('input[name="replicate_api_key"]');if(D){let N=!1,X=null,Z=D.value||"",se=$=>{N=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:$}).then(J=>{Z=$,Ze(J.message||"Saved","success"),ai(),Kn($)}).catch(J=>{Ze(`Error: ${J.message||"Failed to save."}`,"error")}).finally(()=>{if(N=!1,X!==null){let J=X;X=null,J!==Z&&se(J)}})},re=$=>{if($!==Z){if(N){X=$;return}se($)}},K=$=>{let J=$.target;!J||!J.matches('input[name="replicate_api_key"]')||re(J.value||"")};y.addEventListener("change",K),y.addEventListener("blur",K,!0),w&&(w.addEventListener("change",K),w.addEventListener("blur",K,!0)),ct&&(ct.addEventListener("change",K),ct.addEventListener("blur",K,!0)),e.dataset.replicateKeyAutosaveBound="1"}}if(Ue&&Si&&!e.dataset.audioSettingsAutosaveBound){let R=!1,D=null,N=()=>{let qe=Ye=>{let ht=Ue.querySelector(Ye);return ht?ht.value:null},xe=Ye=>{let ht=Ue.querySelector(Ye);return ht?ht.tagName==="SELECT"?ht.value:ht.type==="checkbox"?ht.checked?"1":"0":ht.value?ht.value:"0":null},Ve={},He=xe(".aipkit_voice_input_toggle_switch");if(He!==null){Ve.enable_voice_input=He;let Ye=qe('[name="stt_provider"]');Ye!==null&&(Ve.stt_provider=Ye);let ht=qe('[name="stt_openai_model_id"]');ht!==null&&(Ve.stt_openai_model_id=ht)}let dt=xe(".aipkit_tts_toggle_switch");if(dt!==null){Ve.tts_enabled=dt;let Ye=xe('[name="tts_auto_play"]');Ye!==null&&(Ve.tts_auto_play=Ye);let ht=qe('[name="tts_provider"]');ht!==null&&(Ve.tts_provider=ht);let Li=qe('[name="tts_google_voice_id"]');Li!==null&&(Ve.tts_google_voice_id=Li);let ji=qe('[name="tts_openai_voice_id"]');ji!==null&&(Ve.tts_openai_voice_id=ji);let gn=qe('[name="tts_openai_model_id"]');gn!==null&&(Ve.tts_openai_model_id=gn);let Ai=qe('[name="tts_elevenlabs_voice_id"]');Ai!==null&&(Ve.tts_elevenlabs_voice_id=Ai);let pn=qe('[name="tts_elevenlabs_model_id"]');pn!==null&&(Ve.tts_elevenlabs_model_id=pn)}let it=xe(".aipkit_enable_realtime_voice_toggle");if(it!==null){Ve.enable_realtime_voice=it;let Ye=xe('[name="direct_voice_mode"]');Ye!==null&&(Ve.direct_voice_mode=Ye);let ht=xe('[name="input_audio_noise_reduction"]');ht!==null&&(Ve.input_audio_noise_reduction=ht);let Li=qe('[name="realtime_model"]');Li!==null&&(Ve.realtime_model=Li);let ji=qe('[name="realtime_voice"]');ji!==null&&(Ve.realtime_voice=ji);let gn=qe('[name="turn_detection"]');gn!==null&&(Ve.turn_detection=gn);let Ai=qe('[name="input_audio_format"]');Ai!==null&&(Ve.input_audio_format=Ai);let pn=qe('[name="output_audio_format"]');pn!==null&&(Ve.output_audio_format=pn);let vn=qe('[name="speed"]');vn!==null&&(Ve.speed=vn)}return Ve},X=N(),se=(()=>{let qe=Ue.querySelector('[name="elevenlabs_api_key"]');return qe?qe.value:""})(),re=!1,K=null,$=!1,J=Ue.querySelector(".aipkit_tts_sync_status"),oe=(qe,xe,Ve)=>{J&&(J.textContent=qe||"",J.classList.remove("success","error","loading"),xe&&J.classList.add(xe),Ve?J.setAttribute("title",Ve):J.removeAttribute("title"),J.style.display=qe?"inline-block":"none")},he=(qe=2500)=>{J&&setTimeout(()=>{oe("")},qe)},Pe=()=>{let qe=Ue.querySelector('[name="tts_provider"]');return qe?qe.value:""},pt=()=>{let qe=Ue.querySelector(".aipkit_tts_toggle_switch");return qe?qe.checked:!1},ri=()=>{let qe=Ue.querySelector('select[name="tts_google_voice_id"]');return!qe||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_updateGoogleVoiceSelect!="function"||$?Promise.resolve():($=!0,oe("Syncing...","loading"),window.aipkit_apiRequest("aipkit_sync_google_tts_voices").then(xe=>{if(!xe||!xe.voices)throw new Error("Invalid response received from voice sync.");let Ve=qe.value||"";window.aipkit_updateGoogleVoiceSelect(qe.id,xe.voices,Ve);let He=document.getElementById("aipkit_google_tts_voices_json_main");He&&(He.dataset.voices=JSON.stringify(xe.voices)),oe(xe.message||"Synced","success"),he()}).catch(xe=>{let Ve=xe?.message||"Sync failed.";throw oe(Ve,"error",Ve),he(5e3),xe}).finally(()=>{$=!1}))},Yt=()=>{let qe=Bt();if(!qe||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect!="function"||typeof window.aipkit_chatTts_updateElevenLabsModelsSelect!="function")return Promise.resolve();let xe=Ue.querySelector('select[name="tts_elevenlabs_voice_id"]'),Ve=Ue.querySelector('select[name="tts_elevenlabs_model_id"]');if(!xe&&!Ve||$)return Promise.resolve();$=!0,oe("Syncing...","loading");let He=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabs"}).then(it=>{let Ye=it?.models||[];xe&&window.aipkit_chatTts_updateElevenLabsVoiceSelect(xe.id,Ye,xe.value||"");let ht=document.getElementById(`aipkit_elevenlabs_voices_json_${qe}`);ht&&(ht.dataset.voices=JSON.stringify(Ye))}),dt=window.aipkit_apiRequest("aipkit_sync_models",{provider:"ElevenLabsModels"}).then(it=>{let Ye=it?.models||[];Ve&&window.aipkit_chatTts_updateElevenLabsModelsSelect(Ve.id,Ye,Ve.value||"");let ht=document.getElementById(`aipkit_elevenlabs_models_json_${qe}`);ht&&(ht.dataset.models=JSON.stringify(Ye))});return Promise.allSettled([He,dt]).then(it=>{let Ye=it.find(ht=>ht.status==="rejected");if(Ye){let ht=Ye.reason?.message||"Sync failed.";throw oe(ht,"error",ht),he(5e3),Ye.reason}return oe("Synced","success"),he(),it}).finally(()=>{$=!1})},ft=qe=>{try{let xe=qe?JSON.parse(qe):[];return Array.isArray(xe)&&xe.length>0}catch{return!1}},At=qe=>qe?!!(qe.options&&qe.options.length>1):!1,Zt=()=>{let qe=Ue.querySelector('select[name="tts_google_voice_id"]'),xe=document.getElementById("aipkit_google_tts_voices_json_main");return!ft(xe?.dataset?.voices)||!At(qe)},hi=()=>{let qe=Bt();if(!qe)return!1;let xe=Ue.querySelector('select[name="tts_elevenlabs_voice_id"]'),Ve=Ue.querySelector('select[name="tts_elevenlabs_model_id"]'),He=document.getElementById(`aipkit_elevenlabs_voices_json_${qe}`),dt=document.getElementById(`aipkit_elevenlabs_models_json_${qe}`),it=ft(He?.dataset?.voices),Ye=ft(dt?.dataset?.models);return!it||!Ye||!At(xe)||!At(Ve)},xi=()=>{if(!pt())return Promise.resolve();let qe=Pe();return qe==="Google"?Zt()?ri():Promise.resolve():qe==="ElevenLabs"&&hi()?Yt():Promise.resolve()};window.aipkit_syncAudioTtsOnOpen=xi;let Ct=qe=>{qe!=null&&(re=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_save_ai_settings",{elevenlabs_api_key:qe}).then(xe=>{se=qe,Ze(xe.message||"Saved","success"),ai(),Pe()==="ElevenLabs"&&pt()&&Yt().catch(()=>{})}).catch(xe=>{Ze(`Error: ${xe.message||"Failed to save."}`,"error")}).finally(()=>{if(re=!1,K!==null){let xe=K;K=null,xe!==se&&Ct(xe)}}))},ei=qe=>{if(qe!=null&&qe!==se){if(re){K=qe;return}Ct(qe)}},Bt=()=>m&&m.value||e.getAttribute("data-active-bot-id"),pi=()=>{let qe=Bt();Ue.querySelectorAll(".aipkit_audio_format_combo_select").forEach(it=>{let Ye=it.closest(".aipkit_popover_option_row"),ht=Ye?.querySelector('[name="input_audio_format"]'),Li=Ye?.querySelector('[name="output_audio_format"]'),ji=it.querySelector('option[value="current"]');!ht||!Li||!ji||(ji.textContent=`In: ${ht.value} / Out: ${Li.value}`,it.value="current")});let Ve=Ue.querySelector('select[name="tts_google_voice_id"]');if(Ve&&typeof window.aipkit_updateGoogleVoiceSelect=="function"){let it=document.getElementById("aipkit_google_tts_voices_json_main");try{let Ye=it?.dataset?.voices?JSON.parse(it.dataset.voices):[];window.aipkit_updateGoogleVoiceSelect(Ve.id,Ye,Ve.value||"")}catch(Ye){console.warn("AIPKit Builder: Failed to parse Google TTS voices data.",Ye)}}let He=Ue.querySelector('select[name="tts_elevenlabs_voice_id"]');if(qe&&He&&typeof window.aipkit_chatTts_updateElevenLabsVoiceSelect=="function"){let it=document.getElementById(`aipkit_elevenlabs_voices_json_${qe}`);try{let Ye=it?.dataset?.voices?JSON.parse(it.dataset.voices):[];window.aipkit_chatTts_updateElevenLabsVoiceSelect(He.id,Ye,He.value||"")}catch(Ye){console.warn("AIPKit Builder: Failed to parse ElevenLabs voices data.",Ye)}}let dt=Ue.querySelector('select[name="tts_elevenlabs_model_id"]');if(qe&&dt&&typeof window.aipkit_chatTts_updateElevenLabsModelsSelect=="function"){let it=document.getElementById(`aipkit_elevenlabs_models_json_${qe}`);try{let Ye=it?.dataset?.models?JSON.parse(it.dataset.models):[];window.aipkit_chatTts_updateElevenLabsModelsSelect(dt.id,Ye,dt.value||"")}catch(Ye){console.warn("AIPKit Builder: Failed to parse ElevenLabs models data.",Ye)}}},Ei=qe=>{let xe=Bt();xe&&(R=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_audio_settings",{bot_id:xe,...qe}).then(Ve=>{X=qe,Ze(Ve.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(xe),ai()}).catch(Ve=>{Ze(`Error: ${Ve.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D){let Ve=D;D=null,JSON.stringify(Ve)!==JSON.stringify(X)&&Ei(Ve)}}))},$i=qe=>{if(!(!qe||Object.keys(qe).length===0)&&JSON.stringify(qe)!==JSON.stringify(X)){if(R){D=qe;return}Ei(qe)}};Ue.addEventListener("change",qe=>{let xe=qe.target;if(xe){if(xe.matches(".aipkit_audio_format_combo_select")){let Ve=xe.closest(".aipkit_popover_option_row"),He=Ve?.querySelector('[name="input_audio_format"]'),dt=Ve?.querySelector('[name="output_audio_format"]'),it=xe.querySelector('option[value="current"]'),Ye=xe.value||"";if(!He||!dt||!it||!Ye)return;Ye.startsWith("in:")?He.value=Ye.replace("in:",""):Ye.startsWith("out:")&&(dt.value=Ye.replace("out:","")),it.textContent=`In: ${He.value} / Out: ${dt.value}`,xe.value="current",He.dispatchEvent(new Event("change",{bubbles:!0})),dt.dispatchEvent(new Event("change",{bubbles:!0}));return}if(xe.matches('[name="elevenlabs_api_key"]')){ei(xe.value);return}if((xe.matches(".aipkit_voice_input_toggle_switch")||xe.matches(".aipkit_stt_provider_select")||xe.matches('[name="stt_openai_model_id"]')||xe.matches(".aipkit_tts_toggle_switch")||xe.matches('[name="tts_auto_play"]')||xe.matches(".aipkit_tts_provider_select")||xe.matches('[name="tts_google_voice_id"]')||xe.matches('[name="tts_openai_voice_id"]')||xe.matches('[name="tts_openai_model_id"]')||xe.matches('[name="tts_elevenlabs_voice_id"]')||xe.matches('[name="tts_elevenlabs_model_id"]')||xe.matches(".aipkit_enable_realtime_voice_toggle")||xe.matches('[name="direct_voice_mode"]')||xe.matches('[name="input_audio_noise_reduction"]')||xe.matches('[name="realtime_model"]')||xe.matches('[name="realtime_voice"]')||xe.matches('[name="turn_detection"]')||xe.matches('[name="input_audio_format"]')||xe.matches('[name="output_audio_format"]')||xe.matches('[name="speed"]'))&&(Yn(),$i(N()),xe.matches(".aipkit_tts_provider_select")&&pt())){let Ve=Pe();Ve==="Google"?ri().catch(()=>{}):Ve==="ElevenLabs"&&Yt().catch(()=>{})}}}),Yn(),pi(),e.dataset.audioSettingsAutosaveBound="1"}if(Fi&&Si&&!e.dataset.popupSettingsAutosaveBound){let R=!1,D=null,N=()=>{let K=Ye=>Fi&&Fi.querySelector(Ye)||li&&li.querySelector(Ye),$=Ye=>{let ht=K(Ye);return ht?ht.value:null},J=Ye=>{let ht=K(Ye);return ht?ht.checked?"1":"0":null},oe={},he=$('[name="popup_position"]');he!==null&&(oe.popup_position=he);let Pe=$('[name="popup_delay"]');Pe!==null&&(oe.popup_delay=Pe);let pt=$('[name="popup_icon_style"]');pt!==null&&(oe.popup_icon_style=pt);let ri=$('[name="popup_icon_size"]');ri!==null&&(oe.popup_icon_size=ri);let Yt=$('[name="popup_icon_type"]');Yt!==null&&(oe.popup_icon_type=Yt);let ft=$('[name="popup_icon_default"]:checked');ft!==null&&(oe.popup_icon_default=ft);let At=$('[name="popup_icon_custom_url"]');At!==null&&(oe.popup_icon_custom_url=At);let Zt=$('[name="header_avatar_type"]');Zt!==null&&(oe.header_avatar_type=Zt);let hi=$('[name="header_avatar_default"]:checked');hi!==null&&(oe.header_avatar_default=hi);let xi=$('[name="header_avatar_url"]');xi!==null&&(oe.header_avatar_url=xi);let Ct=$('[name="header_online_text"]');Ct!==null&&(oe.header_online_text=Ct);let ei=J('[name="popup_label_enabled"]');ei!==null&&(oe.popup_label_enabled=ei);let Bt=$('[name="popup_label_text"]');Bt!==null&&(oe.popup_label_text=Bt);let pi=$('[name="popup_label_mode"]');pi!==null&&(oe.popup_label_mode=pi);let Ei=$('[name="popup_label_size"]');Ei!==null&&(oe.popup_label_size=Ei);let $i=$('[name="popup_label_delay_seconds"]');$i!==null&&(oe.popup_label_delay_seconds=$i);let qe=$('[name="popup_label_auto_hide_seconds"]');qe!==null&&(oe.popup_label_auto_hide_seconds=qe);let xe=J('[name="popup_label_dismissible"]');xe!==null&&(oe.popup_label_dismissible=xe);let Ve=J('[name="popup_label_show_on_desktop"]');Ve!==null&&(oe.popup_label_show_on_desktop=Ve);let He=J('[name="popup_label_show_on_mobile"]');He!==null&&(oe.popup_label_show_on_mobile=He);let dt=$('[name="popup_label_frequency"]');dt!==null&&(oe.popup_label_frequency=dt);let it=$('[name="popup_label_version"]');return it!==null&&(oe.popup_label_version=it),oe},X=N(),Z=()=>m&&m.value||e.getAttribute("data-active-bot-id"),se=K=>{let $=Z();$&&(R=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_popup_settings",{bot_id:$,...K}).then(J=>{X=K,Ze(J.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview($),ai()}).catch(J=>{Ze(`Error: ${J.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D){let J=D;D=null,JSON.stringify(J)!==JSON.stringify(X)&&se(J)}}))},re=K=>{if(!(!K||Object.keys(K).length===0)&&JSON.stringify(K)!==JSON.stringify(X)){if(R){D=K;return}se(K)}};Fi.addEventListener("change",K=>{let $=K.target;$&&(($.matches('select[name="popup_icon_type"]')||$.matches('select[name="popup_icon_style"]')||$.matches('select[name="header_avatar_type"]')||$.matches(".aipkit_popup_hint_toggle_switch"))&&Rn(),($.matches('[name="popup_position"]')||$.matches('[name="popup_delay"]')||$.matches('[name="popup_icon_style"]')||$.matches('[name="popup_icon_size"]')||$.matches('[name="popup_icon_type"]')||$.matches('[name="popup_icon_default"]')||$.matches('[name="popup_icon_custom_url"]')||$.matches('[name="header_avatar_type"]')||$.matches('[name="header_avatar_default"]')||$.matches('[name="header_avatar_url"]')||$.matches('[name="header_online_text"]')||$.matches('[name="popup_label_enabled"]')||$.matches('[name="popup_label_text"]')||$.matches('[name="popup_label_mode"]')||$.matches('[name="popup_label_size"]')||$.matches('[name="popup_label_delay_seconds"]')||$.matches('[name="popup_label_auto_hide_seconds"]')||$.matches('[name="popup_label_dismissible"]')||$.matches('[name="popup_label_show_on_desktop"]')||$.matches('[name="popup_label_show_on_mobile"]')||$.matches('[name="popup_label_frequency"]')||$.matches('[name="popup_label_version"]'))&&re(N()))}),li&&li.addEventListener("change",K=>{let $=K.target;$&&($.matches('[name="popup_label_text"]')||$.matches('[name="popup_label_mode"]')||$.matches('[name="popup_label_size"]')||$.matches('[name="popup_label_delay_seconds"]')||$.matches('[name="popup_label_auto_hide_seconds"]')||$.matches('[name="popup_label_dismissible"]')||$.matches('[name="popup_label_show_on_desktop"]')||$.matches('[name="popup_label_show_on_mobile"]')||$.matches('[name="popup_label_frequency"]')||$.matches('[name="popup_label_version"]'))&&re(N())}),Rn(),e.dataset.popupSettingsAutosaveBound="1"}if(w&&Si&&!e.dataset.conversationSettingsAutosaveBound){let R=!1,D=null,N=()=>{let K=J=>{let oe=w&&w.querySelector(J)||Vt&&Vt.querySelector(J);return oe?oe.value:""},$=J=>{let oe=w.querySelector(J);return oe?oe.tagName==="SELECT"?oe.value==="1"?"1":"0":oe.checked?"1":"0":"0"};return{stream_enabled:$(".aipkit_stream_enable_toggle"),openai_conversation_state_enabled:$(".aipkit_stateful_convo_checkbox"),reasoning_effort:K('[name="reasoning_effort"]')}},X=N(),Z=K=>{let $=m&&m.value||e.getAttribute("data-active-bot-id");$&&(R=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_conversation_settings",{bot_id:$,...K}).then(J=>{X=K,Ze(J.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview($),ai()}).catch(J=>{Ze(`Error: ${J.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D){let J=D;D=null,JSON.stringify(J)!==JSON.stringify(X)&&Z(J)}}))},se=K=>{if(JSON.stringify(K)!==JSON.stringify(X)){if(R){D=K;return}Z(K)}},re=K=>{let $=K.target;$&&($.matches(".aipkit_stream_enable_toggle")||$.matches(".aipkit_stateful_convo_checkbox")||$.matches(".aipkit_reasoning_effort_slider")||$.matches('[name="reasoning_effort"]'))&&(Y(),se(N()))};w.addEventListener("change",re),Vt&&Vt.addEventListener("change",re),e.dataset.conversationSettingsAutosaveBound="1"}if(w&&Si&&!e.dataset.fileUploadAutosaveBound){let R=!1,D=null,N=()=>{let re=w.querySelector('[name="enable_file_upload"]');return!re||re.disabled?"":re.tagName==="SELECT"?re.value==="1"?"1":"0":re.checked?"1":"0"},X=N(),Z=re=>{let K=m&&m.value||e.getAttribute("data-active-bot-id");!K||re===""||(R=!0,Ze("Auto-saving...",""),window.aipkit_apiRequest("aipkit_update_chatbot_file_upload_settings",{bot_id:K,enable_file_upload:re}).then($=>{X=re,Ze($.message||"Saved","success"),typeof window.aipkit_refreshChatPreview=="function"&&window.aipkit_refreshChatPreview(K),ai()}).catch($=>{Ze(`Error: ${$.message||"Failed to save."}`,"error")}).finally(()=>{if(R=!1,D!==null&&D!==X){let $=D;D=null,Z($)}else D=null}))},se=re=>{if(!(re===""||re===X)){if(R){D=re;return}Z(re)}};w.addEventListener("change",re=>{let K=re.target;K&&K.matches('[name="enable_file_upload"]')&&(se(N()),so()==="1"?Io():dn())}),e.dataset.fileUploadAutosaveBound="1"}let Ne=m&&m.value||e.getAttribute("data-active-bot-id");if(Ne&&typeof window.aipkit_refreshChatPreview=="function"){window.aipkit_refreshChatPreview(Ne);return}let We=window.aipkit_dashboard?.text?.previewPlaceholderSelect||"Select a bot to see the preview.";r(We)}window.aipkit_initChatbotBuilder=i})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelector(".aipkit_token_limit_mode_select"),e=r.querySelector(".aipkit_token_general_user_limit_field"),t=r.querySelector(".aipkit_token_role_limits_container");if(!i||!e||!t){console.warn("AIPKit Token Management JS: Could not find required elements for toggling limit fields.");return}let c=i.value;e.style.display=c==="general"?"block":"none",t.style.display=c==="role_based"?"block":"none"}function o(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r){console.warn("AIPKit Token Management JS: Main content container not found.");return}r.addEventListener("change",function(e){let t=e.target.closest(".aipkit_token_limit_mode_select");if(!t)return;let c=t.closest(".aipkit_accordion-content");c?k(c):console.warn("AIPKit Token Management JS: Could not find parent accordion content for mode select:",t)}),r.querySelectorAll('.aipkit_accordion[data-section="token-management"]').forEach(e=>{let t=e.querySelector(".aipkit_accordion-content");t&&k(t)})}window.aipkit_initTokenManagementUI=o})();(function(){"use strict";function k(){if(typeof window.aipkit_setButtonText!="function"||typeof window.aipkit_copyShortcode!="function"){console.error("AIPKit Chat Admin Main: Essential NEW utility functions not found (e.g., aipkit_setButtonText, aipkit_copyShortcode). Check utils/");let i=document.querySelector(".aipkit_chatbot_module_container");i&&(i.innerHTML='<p style="color:red; padding:20px;">Critical Error: UI utility scripts failed to load correctly.</p>');return}typeof window.aipkit_escapeHtml!="function"&&console.error("AIPKit Chat Admin Main: Essential log utility functions (like aipkit_escapeHtml) not found. Check utils/html-escaper.js.");let o=document.getElementById("aipkit_chatolia_notice");if(o){let i=o.querySelector(".aipkit_notification_bar__close");i&&i.addEventListener("click",()=>{o.style.display="none"});let e=document.getElementById("aipkit_dismiss_chatolia_notice_btn");e&&e.addEventListener("click",()=>{if(typeof window.aipkit_apiRequest!="function"){alert("Error: API function missing.");return}e.disabled=!0,e.textContent="Dismissing...",window.aipkit_apiRequest("aipkit_dismiss_chatolia_notice").then(()=>{o.style.display="none"}).catch(t=>{alert("Error dismissing notice: "+t.message),e.disabled=!1,e.textContent="Dont Show Again"})})}typeof window.aipkit_initProviderSelectToggles=="function"?window.aipkit_initProviderSelectToggles():console.error("AIPKit Chat Admin Main: aipkit_initProviderSelectToggles function not found."),typeof window.aipkit_initChatSelectPickers=="function"?window.aipkit_initChatSelectPickers():console.error("AIPKit Chat Admin Main: aipkit_initChatSelectPickers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Chat Admin Main: aipkit_initSyncButtons function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles(".aipkit_chatbot_module_container"):console.error("AIPKit Chat Admin Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initChatThemeSettingsToggle=="function"?window.aipkit_initChatThemeSettingsToggle():console.error("AIPKit Chat Admin Main: aipkit_initChatThemeSettingsToggle function not found."),typeof window.aipkit_initCustomThemePresets=="function"?window.aipkit_initCustomThemePresets():console.error("AIPKit Chat Admin Main: aipkit_initCustomThemePresets function not found."),typeof window.aipkit_initCreateNewBot=="function"?window.aipkit_initCreateNewBot():console.error("AIPKit Chat Admin Main: aipkit_initCreateNewBot function not found."),typeof window.aipkit_initSaveBotSettings=="function"?window.aipkit_initSaveBotSettings():console.error("AIPKit Chat Admin Main: aipkit_initSaveBotSettings function not found."),typeof window.aipkit_initDeleteBot=="function"?window.aipkit_initDeleteBot():console.error("AIPKit Chat Admin Main: aipkit_initDeleteBot function not found."),typeof window.aipkit_initResetBot=="function"?window.aipkit_initResetBot():console.error("AIPKit Chat Admin Main: aipkit_initResetBot function not found."),typeof window.aipkit_initAppearanceToggles=="function"?window.aipkit_initAppearanceToggles():console.error("AIPKit Chat Admin Main: aipkit_initAppearanceToggles function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_chatbot_main_tab_content_container"):console.error("AIPKit Chat Admin Main: aipkit_attachRangeValueHandlers function not found."),typeof window.aipkit_initConversationStartersToggle=="function"?window.aipkit_initConversationStartersToggle():console.error("AIPKit Chat Admin Main: aipkit_initConversationStartersToggle function not found."),typeof window.aipkit_initTokenManagementUI=="function"?document.querySelector('.aipkit_accordion[data-section="token-management"]')&&window.aipkit_initTokenManagementUI():console.error("AIPKit Chat Admin Main: aipkit_initTokenManagementUI function not found."),typeof window.aipkit_loadInitialChatPreview=="function"?window.aipkit_loadInitialChatPreview():console.error("AIPKit Chat Admin Main: aipkit_loadInitialChatPreview function not found."),typeof window.aipkit_initChatbotBuilder=="function"&&window.aipkit_initChatbotBuilder(),typeof window.aipkit_initTtsSettingsUI=="function"?document.querySelector('.aipkit_accordion[data-section="tts-settings"]')&&window.aipkit_initTtsSettingsUI():console.error("AIPKit Chat Admin Main: aipkit_initTtsSettingsUI function not found.");let r=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");if(r){let i=r.dataset.botId,e=document.getElementById(`aipkit_trigger_builder_${i}`);i&&e&&typeof window.aipkit_initTriggerBuilderUI=="function"?window.aipkit_initTriggerBuilderUI(i):i&&e&&console.error(`AIPKit Chat Admin Main: aipkit_initTriggerBuilderUI function not found, cannot init Triggers for bot ${i}.`)}typeof window.aipkit_initRealtimeVoiceAgentUI=="function"&&window.aipkit_initRealtimeVoiceAgentUI(),typeof window.aipkit_initEmbedCodeCopy=="function"&&window.aipkit_initEmbedCodeCopy(),function(){let e=document.querySelector(".aipkit_chatbot_module_container");e&&e.addEventListener("click",function(t){if(t.target.closest(".aipkit_header_reset_btn, .aipkit_header_delete_btn, .aipkit_actions_dropdown_container .aipkit_tab_dropdown_trigger"))return;if(t.target.closest("#aipkit_chatbot_header_save_btn")){let d=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form");d&&(typeof d.requestSubmit=="function"?d.requestSubmit():d.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})));return}if(t.target.closest(".aipkit_header_reset_btn")){let d=e.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");d&&(d.style.display="none");let l=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form")?.dataset.botId,p=e.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",_=e.querySelector("#aipkit_header_action_feedback");if(!l||!_)return;_.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_reset_confirmation" id="aipkit_reset_confirmation_${l}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_reset_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_reset_confirm_inline">Confirm</button>
              </div>
            </div>`,_.querySelector(".aipkit_reset_cancel_inline")?.addEventListener("click",()=>{_.innerHTML=""},{once:!0}),_.querySelector(".aipkit_reset_confirm_inline")?.addEventListener("click",()=>{_.innerHTML='<span class="aipkit_action_status_message">Resetting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_reset_chatbot_settings",{bot_id:l}).then(f=>{_.innerHTML=`<span class="aipkit_action_status_message success">${f.message||"Chatbot reset successfully!"}</span>`,typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("chatbot",{force_active_bot_id:l}),setTimeout(()=>{_.innerHTML=""},3e3)}).catch(f=>{_.innerHTML=`<span class="aipkit_action_status_message error">Error: ${f.message||"Failed to reset chatbot."}</span>`,setTimeout(()=>{_.innerHTML=""},4e3)})},{once:!0});return}if(t.target.closest(".aipkit_header_delete_btn")){let d=e.querySelector(".aipkit_actions_dropdown_container .aipkit_tab_dropdown_menu");d&&(d.style.display="none");let a=document.querySelector("#aipkit_chatbot_main_tab_content_container .aipkit_tab-content.aipkit_active form.aipkit_chatbot_settings_form"),l=a?.dataset.botId,p=a?.querySelector(".aipkit_delete_bot_btn")?.getAttribute("data-is-default")==="1",_=e.querySelector(".aipkit_active_bot_name_display")?.textContent?.trim()||"this bot",f=e.querySelector("#aipkit_header_action_feedback");if(!l||!f)return;if(p){f.innerHTML='<span class="aipkit_action_status_message error">Default bot cannot be deleted.</span>',setTimeout(()=>{f.innerHTML=""},3e3);return}f.innerHTML=`
            <div class="aipkit_confirmation_message aipkit_delete_confirmation" id="aipkit_delete_confirmation_${l}">
              <div class="aipkit_confirmation_message_buttons">
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_delete_cancel_inline">Cancel</button>
                <button type="button" class="aipkit_btn aipkit_btn-danger aipkit_delete_confirm_inline">Confirm</button>
              </div>
            </div>`,f.querySelector(".aipkit_delete_cancel_inline")?.addEventListener("click",()=>{f.innerHTML=""},{once:!0}),f.querySelector(".aipkit_delete_confirm_inline")?.addEventListener("click",()=>{f.innerHTML='<span class="aipkit_action_status_message">Deleting...</span>',typeof window.aipkit_apiRequest=="function"&&window.aipkit_apiRequest("aipkit_delete_chatbot",{bot_id:l}).then(g=>{f.innerHTML=`<span class="aipkit_action_status_message success">${g.message||"Chatbot deleted successfully."}</span>`;let m=null,u=document.getElementById("aipkit_chatbot_main_selector_container");if(u){let h=u.querySelector(".aipkit_tab_dropdown_item .dashicons-star-filled"),v=h?h.closest(".aipkit_tab_dropdown_item"):null;if(v)m=v.getAttribute("data-bot-id");else{let S=u.querySelector(`.aipkit_tab_dropdown_item[data-bot-id]:not([data-bot-id="${l}"])`);S&&(m=S.getAttribute("data-bot-id"))}}if(typeof window.aipkit_loadModule=="function"){let h=m?{force_active_bot_id:m}:{};window.aipkit_loadModule("chatbot",h)}setTimeout(()=>{f.innerHTML=""},3e3)}).catch(g=>{f.innerHTML=`<span class="aipkit_action_status_message error">Error: ${g.message||"Failed to delete chatbot."}</span>`,setTimeout(()=>{f.innerHTML=""},4e3)})},{once:!0});return}})}()}window.aipkit_initChatbot=k})();(function(){"use strict";window.aipkitAIFormsState={currentFormId:null,draggedElementType:null,draggedLayoutType:null,draggedElement:null,droppedElementCounter:0,formStructure:[],selectedDesignerElementId:null}})();(function(){"use strict";window.aipkitAIFormsListState={currentPage:1,searchQuery:"",sortColumn:"modified",sortDirection:"desc",isLoading:!1}})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_ai_forms_container"),e=window.aipkit_escapeHtml||(n=>n),t=wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n,c=wp.i18n&&wp.i18n._n?wp.i18n._n:null,s=wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:null;r&&(r.innerHTML="",!(!o||o.length===0)&&o.forEach(n=>{let d=window.aipkit_dashboard?.isProPlan??!1,a=window.aipkit_dashboard?.upgradeUrl||"#",l="",p="";if(d)l=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label">${t("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="pdf_download" value="true">
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`;else{let b=t("This is a Pro feature. Please upgrade.","gpt3-ai-content-generator");l=`
              <div class="aipkit_popover_option_row aipkit_popover_option_row--disabled">
                  <div class="aipkit_popover_option_main">
                      <span class="aipkit_popover_option_label" data-tooltip="${e(b)}">${t("Save as PDF","gpt3-ai-content-generator")}</span>
                      <label class="aipkit_switch">
                          <input type="checkbox" class="aipkit_toggle_switch" disabled>
                          <span class="aipkit_switch_slider"></span>
                      </label>
                  </div>
              </div>`,p=`
              <div class="aipkit_popover_option_row">
                  <div class="aipkit_popover_option_main aipkit_popover_option_main--stacked">
                      <p class="aipkit_form-help">${t("Save as PDF is available on the Pro plan.","gpt3-ai-content-generator")}</p>
                      <a class="aipkit_btn aipkit_btn-primary" href="${e(a)}" target="_blank" rel="noopener noreferrer">
                        ${t("Upgrade to Pro","gpt3-ai-content-generator")}
                      </a>
                  </div>
              </div>`}let _=r.insertRow(),f=_.insertCell();f.classList.add("aipkit_ai_form_title_cell");let g=e(n.title||t("Untitled","gpt3-ai-content-generator")),m=n.updated_at||n.updatedAt||n.updated||"",u="",h="";m&&(typeof window.aipkit_formatRelativeDateTime=="function"?u=window.aipkit_formatRelativeDateTime(m):typeof window.aipkit_formatUtcDateTime=="function"?u=window.aipkit_formatUtcDateTime(m):u=m,typeof window.aipkit_formatUtcDateTime=="function"&&(h=window.aipkit_formatUtcDateTime(m)));let v=n.submissions_count??n.submission_count??n.submissionsCount??0,S=Number.isFinite(Number(v))?Number(v):0,q=[];if(u){let b=s?s(t("Updated %s","gpt3-ai-content-generator"),u):`${t("Updated","gpt3-ai-content-generator")} ${u}`,x=h?` title="${e(h)}"`:"";q.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_updated"${x}>${e(b)}</span>`)}if(S>0){let b=`${S} ${t(S===1?"submission":"submissions","gpt3-ai-content-generator")}`;c&&s&&(b=s(c("%s submission","%s submissions",S,"gpt3-ai-content-generator"),S)),q.push(`<span class="aipkit_ai_form_meta_item aipkit_ai_form_meta_count">${e(b)}</span>`)}let y=q.length?`
          <span class="aipkit_ai_form_meta">
            ${q.join('<span class="aipkit_ai_form_meta_sep" aria-hidden="true">&middot;</span>')}
          </span>
        `:"";f.innerHTML=`
        <span class="aipkit_ai_form_title_text" title="${g}">${g}</span>
        ${y}
      `;let E=_.insertCell();E.classList.add("aipkit_ai_form_model_cell");let I=n.model||t("Default","gpt3-ai-content-generator");E.textContent=I,E.title=I;let w=_.insertCell();w.classList.add("aipkit_shortcode_cell","aipkit_ai_form_shortcode_cell");let A=`aipkit_ai_form_theme_${n.id}`;w.innerHTML=`
        <div class="aipkit_shortcode_display_wrapper">
            <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" id="aif-shortcode-input-${n.id}" readonly value="${e(n.shortcode)}" data-aipkit-shortcode-display="${n.id}">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_aiform_settings_toggle" data-form-id="${n.id}" title="${t("Shortcode settings","gpt3-ai-content-generator")}" aria-label="${t("Shortcode settings","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-shortcode" aria-hidden="true"></span>
              <span class="screen-reader-text">${t("Shortcode settings","gpt3-ai-content-generator")}</span>
            </button>
        </div>
        <div class="aipkit_shortcode_configurator aipkit_model_settings_popover_panel" id="aif-configurator-${n.id}" style="display: none;" role="dialog" aria-modal="false" aria-labelledby="aif-shortcode-title-${n.id}">
            <div class="aipkit_model_settings_popover_header">
                <span class="aipkit_model_settings_popover_title" id="aif-shortcode-title-${n.id}">
                  ${t("Shortcode Settings","gpt3-ai-content-generator")}
                </span>
                <button
                    type="button"
                    class="aipkit_model_settings_popover_close aipkit_aiform_shortcode_close"
                    aria-label="${t("Close","gpt3-ai-content-generator")}"
                >
                    <span class="dashicons dashicons-no-alt"></span>
                </button>
            </div>
            <div class="aipkit_model_settings_popover_body">
                <div class="aipkit_popover_options_list">
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${t("Show Provider Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="show_provider" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${t("Show Model Select","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="show_model" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${t("Copy Button","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="copy_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${t("Save as Post","gpt3-ai-content-generator")}</span>
                            <label class="aipkit_switch">
                                <input type="checkbox" class="aipkit_toggle_switch aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="save_button" value="true">
                                <span class="aipkit_switch_slider"></span>
                            </label>
                        </div>
                    </div>
                    ${l}
                    ${p}
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <label class="aipkit_popover_option_label" for="${A}">
                              ${t("Theme","gpt3-ai-content-generator")}
                            </label>
                            <div class="aipkit_popover_option_actions">
                                <select id="${A}" class="aipkit_popover_option_select aipkit-aiform-config-input" data-form-id="${n.id}" data-attr-name="theme">
                                    <option value="light">${t("Light (default)","gpt3-ai-content-generator")}</option>
                                    <option value="dark">${t("Dark","gpt3-ai-content-generator")}</option>
                                    <option value="custom">${t("Custom","gpt3-ai-content-generator")}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="aipkit_popover_option_row">
                        <div class="aipkit_popover_option_main">
                            <span class="aipkit_popover_option_label">${t("Shortcode","gpt3-ai-content-generator")}</span>
                            <div class="aipkit_popover_option_actions">
                                <input type="text" class="aipkit_form-input aipkit_form_shortcode_input" readonly value="${e(n.shortcode)}" data-aipkit-shortcode-display="${n.id}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="aipkit_popover_flyout_footer">
                <span class="aipkit_popover_flyout_footer_text">
                    ${t("Need help?","gpt3-ai-content-generator")}
                </span>
                <a
                    class="aipkit_popover_flyout_footer_link"
                    href="https://docs.aipower.org/docs/category/ai-forms"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    ${t("Documentation","gpt3-ai-content-generator")}
                </a>
            </div>
        </div>
      `,i&&typeof window.aipkitForms_applyStoredShortcodeConfig=="function"&&window.aipkitForms_applyStoredShortcodeConfig(n.id,i);let C=_.insertCell();C.classList.add("aipkit_form_actions_cell"),C.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button type="button" class="aipkit_btn aipkit_btn-primary aipkit_edit_ai_form_btn" data-form-id="${n.id}" title="${t("Edit","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            ${t("Edit","gpt3-ai-content-generator")}
          </button>
          <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_preview_ai_form_btn" data-form-id="${n.id}" data-form-title="${e(n.title||"")}" title="${t("Preview","gpt3-ai-content-generator")}" aria-label="${t("Preview","gpt3-ai-content-generator")}">
            <span class="dashicons dashicons-visibility" aria-hidden="true"></span>
            <span class="screen-reader-text">${t("Preview","gpt3-ai-content-generator")}</span>
          </button>
          <div class="aipkit_actions_menu">
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-icon aipkit_actions_menu_toggle" title="${t("More actions","gpt3-ai-content-generator")}">
              <span class="dashicons dashicons-ellipsis"></span>
            </button>
            <div class="aipkit_actions_dropdown_menu">
              <button type="button" class="aipkit_dropdown-item-btn aipkit_duplicate_ai_form_btn" data-form-id="${n.id}" title="${t("Duplicate","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-admin-page"></span>
                <span>${t("Duplicate","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_export_ai_form_btn" data-form-id="${n.id}" title="${t("Export","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-download"></span>
                <span>${t("Export","gpt3-ai-content-generator")}</span>
              </button>
              <button type="button" class="aipkit_dropdown-item-btn aipkit_dropdown-item--danger aipkit_delete_ai_form_btn" data-form-id="${n.id}" data-form-title="${e(n.title)}" title="${t("Delete","gpt3-ai-content-generator")}">
                <span class="dashicons dashicons-trash"></span>
                <span>${t("Delete","gpt3-ai-content-generator")}</span>
              </button>
            </div>
          </div>
        </div>
      `}))}window.aipkitForms_renderTable=k})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsListState,i=document.getElementById("aipkit_ai_forms_pagination"),e=document.getElementById("aipkit_ai_forms_count_summary");if(!i||!o||!r)return;let t=wp.i18n&&wp.i18n.__?wp.i18n.__:a=>a,c=wp.i18n&&wp.i18n._n?wp.i18n._n:(a,l,p)=>p===1?a:l;i.innerHTML="";let{total_forms:s,total_pages:n}=o,d=r.currentPage;if(e){let a=c("form","forms",s,"gpt3-ai-content-generator");e.textContent=`${s.toLocaleString()} ${a}`}if(!(s<=0)&&n>1){let a=document.createElement("span");a.className="aipkit_pagination-links";let l=document.createElement("button");l.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_prev",l.innerHTML=`\xAB ${t("Previous","gpt3-ai-content-generator")}`,l.disabled=d<=1,a.appendChild(l);let p=document.createElement("span");p.className="aipkit_pagination-current",p.textContent=`${t("Page","gpt3-ai-content-generator")} ${d} ${t("of","gpt3-ai-content-generator")} ${n}`,a.appendChild(p);let _=document.createElement("button");_.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_pagination_next",_.innerHTML=`${t("Next","gpt3-ai-content-generator")} \xBB`,_.disabled=d>=n,a.appendChild(_),i.appendChild(a)}}window.aipkitForms_renderPagination=k})();(function(){"use strict";function k(){let o=window.aipkitAIFormsListState;if(!o||o.isLoading)return;o.isLoading=!0;let r=document.getElementById("aipkit_ai_forms_list_tbody"),i=document.getElementById("aipkit_no_ai_forms_message"),e=document.getElementById("aipkit_ai_forms_pagination");r&&(r.innerHTML='<tr><td colspan="4" style="text-align:center; padding: 20px;"><span class="aipkit_spinner" style="display:inline-block; width: 20px; height: 20px;"></span> Loading...</td></tr>'),i&&(i.style.display="none"),e&&(e.innerHTML="");let c={_ajax_nonce:(window.aipkit_ai_forms_config||{}).nonce_manage_forms,page:o.currentPage,search:o.searchQuery,sort_by:o.sortColumn,sort_order:o.sortDirection};window.aipkit_apiRequest("aipkit_list_ai_forms",c).then(s=>{if(typeof window.aipkitForms_renderTable=="function"&&window.aipkitForms_renderTable(s.forms||[]),typeof window.aipkitForms_renderPagination=="function"&&window.aipkitForms_renderPagination(s.pagination||{}),i&&(!s.forms||s.forms.length===0)){i.style.display="block";let n=!!o.searchQuery&&o.searchQuery.trim().length>0;i.textContent=n?"No forms found matching your search.":"No AI Forms have been created yet."}}).catch(s=>{r&&(r.innerHTML=`<tr><td colspan="4" style="color:red;text-align:center;">Error loading forms: ${s.message}</td></tr>`)}).finally(()=>{o.isLoading=!1})}window.aipkitForms_fetchForms=k})();(function(){"use strict";let k;function o(){let r=document.getElementById("aipkit_ai_forms_list_container");if(!r||r.dataset.listListenersAttached)return;r.dataset.listListenersAttached="true";let i=window.aipkitAIFormsListState;if(!i){console.error("AI Forms Events: List state object is not available.");return}r.addEventListener("click",function(t){let c=t.target,s=c.closest(".aipkit-sortable-col");if(s){let n=s.dataset.sortKey;i.sortColumn===n?i.sortDirection=i.sortDirection==="asc"?"desc":"asc":(i.sortColumn=n,i.sortDirection="asc"),i.currentPage=1,r.querySelectorAll(".aipkit-sortable-col").forEach(d=>d.removeAttribute("data-sort-direction")),s.setAttribute("data-sort-direction",i.sortDirection),window.aipkitForms_fetchForms();return}if(c.matches(".aipkit_pagination_prev")){i.currentPage>1&&(i.currentPage--,window.aipkitForms_fetchForms());return}if(c.matches(".aipkit_pagination_next")){i.currentPage++,window.aipkitForms_fetchForms();return}});let e=r.querySelector("#aipkit_ai_forms_search_input");e&&e.addEventListener("input",function(){clearTimeout(k),k=setTimeout(()=>{i.searchQuery=this.value,i.currentPage=1,window.aipkitForms_fetchForms()},400)})}window.aipkitForms_attachListEventListeners=o})();(function(){"use strict";function k(){typeof window.aipkitForms_attachListEventListeners!="function"||typeof window.aipkitForms_fetchForms!="function"||(window.aipkitForms_attachListEventListeners(),window.aipkitForms_fetchForms())}window.aipkitForms_initListView=k})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=o.querySelector("#aipkit_ai_form_elements_palette"),e=o.querySelector("#aipkit_ai_form_designer_area"),t=o.querySelector("#aipkit_form_designer_placeholder");if(!i||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(s=>{s.dataset.dragStartListenerAttached!=="true"&&(s.addEventListener("dragstart",n=>{r.draggedElementType=n.target.dataset.elementType,n.dataTransfer.setData("text/plain",r.draggedElementType),n.dataTransfer.effectAllowed="copy",n.target.classList.add("aipkit-dragging"),r.draggedElement=null}),s.addEventListener("dragend",n=>{n.target.classList.remove("aipkit-dragging"),r.draggedElementType=null}),s.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",s=>{s.target.classList.contains("aipkit_dropped_element")&&(r.draggedElement=s.target,s.dataTransfer.setData("text/element-id",s.target.id),s.dataTransfer.effectAllowed="move",setTimeout(()=>{r.draggedElement&&(r.draggedElement.style.opacity="0.5")},0),r.draggedElementType=null)}),e.addEventListener("dragend",s=>{r.draggedElement&&(r.draggedElement.style.opacity="1",r.draggedElement=null)}),e.addEventListener("dragover",s=>{s.preventDefault();let n=s.target.closest(".aipkit_dropped_element");e.classList.add("aipkit-drag-over"),r.draggedElement&&n&&r.draggedElement!==n?s.dataTransfer.dropEffect="move":s.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",s=>{e.contains(s.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",s=>{s.preventDefault(),e.classList.remove("aipkit-drag-over");let n=s.dataTransfer.getData("text/element-id");if(r.draggedElement&&n===r.draggedElement.id){let d=s.target.closest(".aipkit_dropped_element"),a=null;if(d&&d!==r.draggedElement){let l=d.getBoundingClientRect();a=s.clientY>l.top+l.height/2?d.nextSibling:d}e.insertBefore(r.draggedElement,a),r.draggedElement.style.opacity="1",typeof window.aipkitForms_updateFormStructureOrder=="function"&&window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){if(t&&t.style.display!=="none"&&(t.style.display="none"),typeof window.aipkitForms_createNewFormElementData!="function"||typeof window.aipkitForms_renderDroppedElement!="function"){console.error("AI Forms Drag&Drop: Helper functions for creating/rendering element not found.");return}let d=window.aipkitForms_createNewFormElementData(r.draggedElementType);r.formStructure.push(d),window.aipkitForms_renderDroppedElement(e,d,null)}r.draggedElementType=null,r.draggedElement=null}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initDragAndDrop=k})();(function(){"use strict";function k(){let o=window.aipkitAIFormsState,r=document.getElementById("aipkit_ai_form_designer_area");if(!r)return;let i=[];r.querySelectorAll(".aipkit_layout_row").forEach(t=>{let c=t.id,s=o.formStructure.find(a=>a.internalId===c);if(!s)return;let n={internalId:c,type:"layout-row",columns:[]};t.querySelectorAll(".aipkit_layout_column").forEach(a=>{let l=a.id,p=s.columns.find(g=>g.internalId===l);if(!p)return;let _={internalId:l,width:p.width,elements:[]};a.querySelectorAll(".aipkit_dropped_element").forEach(g=>{let m=g.id,u=null;o.formStructure.forEach(h=>{h.columns.forEach(v=>{let S=v.elements.find(q=>q.internalId===m);S&&(u=S)})}),u&&_.elements.push(u)}),n.columns.push(_)}),i.push(n)}),o.formStructure=i}window.aipkitForms_updateFormStructureOrder=k})();(function(){"use strict";function k(r){let i=window.aipkitAIFormsState;i.droppedElementCounter++;let e=`field_${r.replace(/-/g,"_")}_${i.droppedElementCounter}`;switch(r){case"text-input":case"textarea":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:r,label:`New ${r.replace(/-/g," ").replace(/\b\w/g,s=>s.toUpperCase())}`,placeholder:"Enter placeholder...",fieldId:e,required:!1,helpText:""};case"checkbox":case"select":case"radio-button":let t,c;return r==="select"?(t="New Dropdown",c="select"):r==="radio-button"?(t="New Radio Buttons",c="radio"):(t="New Checkbox Group",c="checkbox"),{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:r,label:t,fieldId:`${c}_${i.droppedElementCounter}`,required:!1,options:[{value:"option1",text:"Option 1"},{value:"option2",text:"Option 2"}],helpText:""};case"file-upload":return{internalId:`el-${Date.now()}-${i.droppedElementCounter}`,type:"file-upload",label:"File Upload",fieldId:`file_upload_${i.droppedElementCounter}`,required:!1,helpText:"Upload a file (txt, pdf)."};default:return null}}function o(r){let i=Date.now(),e=[];switch(r){case"1-col":e=[{internalId:`col-${i}-1`,width:"100%",elements:[]}];break;case"2-col-50-50":e=[{internalId:`col-${i}-1`,width:"50%",elements:[]},{internalId:`col-${i}-2`,width:"50%",elements:[]}];break;case"3-col-33-33-33":e=[{internalId:`col-${i}-1`,width:"33.33%",elements:[]},{internalId:`col-${i}-2`,width:"33.33%",elements:[]},{internalId:`col-${i}-3`,width:"33.33%",elements:[]}];break;case"2-col-30-70":e=[{internalId:`col-${i}-1`,width:"30%",elements:[]},{internalId:`col-${i}-2`,width:"70%",elements:[]}];break;case"2-col-70-30":e=[{internalId:`col-${i}-1`,width:"70%",elements:[]},{internalId:`col-${i}-2`,width:"30%",elements:[]}];break;default:e=[{internalId:`col-${i}-1`,width:"100%",elements:[]}]}return{internalId:`row-${i}`,type:"layout-row",columns:e}}window.aipkitForms_createNewFormElementData=k,window.aipkitForms_createNewLayoutData=o})();(function(){"use strict";function k(o,r,i=null){let e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_,t=window.aipkit_escapeHtml||function(_){return _},c=document.createElement("div");c.className="aipkit_dropped_element",c.id=r.internalId,c.dataset.elementType=r.type;let s=`<span class="aipkit_dropped_element_drag_handle dashicons dashicons-move" draggable="true" title="${e("Drag to reorder","gpt3-ai-content-generator")}"></span>`,n="",d=`${r.internalId}-field`,a="";switch(r.helpText&&(a=`<p class="aipkit_dropped_element_help_text">${t(r.helpText)}</p>`),r.type){case"text-input":n=`<label class="aipkit_dropped_element_label" for="${d}">${t(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="text" id="${d}" class="aipkit_form-input aipkit_dropped_element_field" placeholder="${t(r.placeholder)}" readonly>
                    ${a}`;break;case"textarea":n=`<label class="aipkit_dropped_element_label" for="${d}">${t(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <textarea id="${d}" class="aipkit_form-input aipkit_dropped_element_field" rows="2" placeholder="${t(r.placeholder)}" readonly></textarea>
                    ${a}`;break;case"select":let _="";r.options&&r.options.length>0?r.options.forEach(m=>{_+=`<option value="${t(m.value)}">${t(m.text)}</option>`}):_=`<option>${e("No options configured","gpt3-ai-content-generator")}</option>`,n=`<label class="aipkit_dropped_element_label" for="${d}">${t(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <select id="${d}" class="aipkit_form-input aipkit_dropped_element_field" disabled>${_}</select>
                    ${a}`;break;case"radio-button":let f="";r.options&&r.options.length>0?r.options.forEach((m,u)=>{let h=`${d}-${u}`;f+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="radio" id="${h}" class="aipkit_dropped_element_field" name="preview-${r.internalId}" disabled>
                                    <label for="${h}">${t(m.text)}</label>
                                </div>`}):f=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,n=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${t(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${f}
                    </fieldset>
                    ${a}`;break;case"checkbox":let g="";r.options&&r.options.length>0?r.options.forEach((m,u)=>{let h=`${d}-${u}`;g+=`<div class="aipkit_dropped_element_radio_item">
                                    <input type="checkbox" id="${h}" class="aipkit_dropped_element_field" name="preview-${r.internalId}-${u}" disabled>
                                    <label for="${h}">${t(m.text)}</label>
                                </div>`}):g=`<p class="aipkit-no-options-note">${e("No options configured","gpt3-ai-content-generator")}</p>`,n=`<fieldset class="aipkit_dropped_element_fieldset">
                        <legend class="aipkit_dropped_element_label">${t(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</legend>
                        ${g}
                    </fieldset>
                    ${a}`;break;case"file-upload":n=`<label class="aipkit_dropped_element_label" for="${d}">${t(r.label)} ${r.required?'<span class="aipkit-required-indicator">*</span>':""}</label>
                     <input type="file" id="${d}" class="aipkit_form-input aipkit_dropped_element_field" disabled>
                    ${a}`;break;default:n=`<p>${t(r.label)}</p>${a}`}let l=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_settings_btn" title="${e("Settings","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-admin-generic"></span>
                            </button>`,p=`<button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_dropped_element_delete_btn" title="${e("Delete","gpt3-ai-content-generator")}">
                                <span class="dashicons dashicons-trash"></span>
                            </button>`;c.innerHTML=`
        <div class="aipkit_dropped_element_content">
            ${n}
        </div>
        <div class="aipkit_dropped_element_actions_hover">
            ${s}
            ${l}
            ${p}
        </div>
    `,i?o.insertBefore(c,i):o.appendChild(c)}window.aipkitForms_renderFieldInColumn=k,window.aipkitForms_renderDroppedElement=k})();(function(){"use strict";function k(o,r){let i=window.aipkitAIFormsState,e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s;if(!r){console.error("AI Forms deleteDroppedElement: formsContainerElement not provided.");return}let t=r.querySelector("#aipkit_ai_form_designer_area");if(!t){console.warn("AI Forms deleteDroppedElement: Designer area not found in provided container.");return}let c=t.querySelector(`#${CSS.escape(o)}`);if(c&&(c.remove(),i.formStructure.forEach(s=>{s.columns.forEach(n=>{n.elements=n.elements.filter(d=>d.internalId!==o)})}),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r),i.selectedDesignerElementId===o&&(typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(r):console.error("AI Forms deleteDroppedElement: hideSettingsPanel function missing.")),t.querySelectorAll(".aipkit_dropped_element").length===0&&t.querySelectorAll(".aipkit_layout_row").length===0)){let s=t.querySelector("#aipkit_form_designer_placeholder");s||(s=document.createElement("div"),s.className="aipkit_form_designer_placeholder",s.id="aipkit_form_designer_placeholder",s.innerHTML=`<span class="dashicons dashicons-layout"></span>${e("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,t.appendChild(s)),s.style.display="flex"}}window.aipkitForms_deleteDroppedElement=k})();(function(){"use strict";function k(){let o=window.aipkitAIFormsState,r=wp.i18n&&wp.i18n.__?wp.i18n.__:g=>g,i=document.getElementById("aipkit_form_editor_container");if(!i)return;let e=i.querySelector("#aipkit_ai_form_prompt_template"),t=i.querySelector("#aipkit_prompt_validation_results");if(!e||!t)return;let c=e.value,s=[],n=[],d=new Set;o.formStructure.forEach(g=>{g.columns.forEach(m=>{m.elements.forEach(u=>{u.fieldId&&d.add(u.fieldId)})})});let a=/{[a-zA-Z0-9_]+}/g,l=(c.match(a)||[]).map(g=>g.slice(1,-1)),p=new Set(l);l.forEach(g=>{d.has(g)||s.push(`Variable <code>{${g}}</code> is used in the prompt but not defined as a form field.`)}),d.forEach(g=>{p.has(g)||n.push(`Field <code>{${g}}</code> is defined but not used in the prompt.`)});let _=c;if(l.forEach(g=>{let m=new RegExp(`\\{${g}\\}`,"g");_=_.replace(m,"")}),/[{}]/.test(_)&&s.push("Malformed variable detected. Check for mismatched or empty curly braces like '{}', or lone '{' or '}'."),t.className="aipkit_form-help",t.innerHTML="",s.length>0){t.classList.add("aipkit-validation-error");let g=`<strong>${r("Validation Issues Found:","gpt3-ai-content-generator")}</strong><ul>`;s.forEach(m=>{g+=`<li>${m}</li>`}),g+="</ul>",t.innerHTML=g}else{t.classList.add("aipkit-validation-success");let g=`<strong>${r("Validation Passed!","gpt3-ai-content-generator")}</strong> (${l.length} of ${d.size} fields used).`;n.length>0&&(g+=`<br><strong>${r("Suggestions:","gpt3-ai-content-generator")}</strong><ul>`,n.forEach(m=>{g+=`<li>${m}</li>`}),g+="</ul>"),t.innerHTML=g}t.style.display="block",t.dismissTimer&&clearTimeout(t.dismissTimer);let f=s.length>0?8e3:5e3;t.dismissTimer=setTimeout(()=>{t.style.display="none",t.innerHTML=""},f)}window.aipkitForms_validatePrompt=k})();(function(){"use strict";function k(o,r){let i=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_,c=window.aipkit_escapeHtml||function(_){return _};if(!r){console.error("AI Forms showSettingsPanel: formsContainerElement not provided.");return}r.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(_=>_.classList.remove("aipkit-element-selected"));let s=r.querySelector(`#${CSS.escape(o)}`);s&&s.classList.add("aipkit-element-selected"),i.selectedDesignerElementId=o;let n=null;for(let _ of i.formStructure){for(let f of _.columns){let g=f.elements.find(m=>m.internalId===o);if(g){n=g;break}}if(n)break}if(!n){console.error(`showSettingsPanel: Could not find element data for ID ${o} in state.`,i.formStructure);return}let d=r.querySelector("#aipkit_ai_form_elements_palette"),a=r.querySelector("#aipkit_ai_form_element_settings_panel"),l=a?a.querySelector("#aipkit_settings_panel_fields"):null,p=a?a.querySelector("#aipkit_settings_panel_element_type"):null;if(!d||!a||!l||!p){console.warn("AI Forms showSettingsPanel: Palette, settings panel, fields container, or type display not found in formsContainerElement.");return}if(p.textContent=`(${n.type.replace(/-/g," ").replace(/\b\w/g,_=>_.toUpperCase())})`,l.innerHTML="",l.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-label-${n.internalId}">${t(e.text.settingsLabel||"Label Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-label-${n.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="label" value="${c(n.label)}">
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-field-id-${n.internalId}">${t(e.text.settingsFieldId||"Field Variable Name (for prompt)","gpt3-ai-content-generator")}</label>
                <input type="text" id="setting-field-id-${n.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="fieldId" value="${c(n.fieldId)}" pattern="[a-zA-Z0-9_]+" title="${t("Only letters, numbers, and underscores allowed. No spaces.","gpt3-ai-content-generator")}">
                <p class="aipkit_form-help">${t(e.text.settingsFieldIdHelp||"Use as {your_variable_name} in the Prompt Template. Must be unique and contain only letters, numbers, underscores.","gpt3-ai-content-generator")}</p>
            </div>
        `,(n.type==="text-input"||n.type==="textarea")&&(l.innerHTML+=`
                <div class="aipkit_form-group">
                    <label class="aipkit_form-label" for="setting-placeholder-${n.internalId}">${t(e.text.settingsPlaceholder||"Placeholder Text","gpt3-ai-content-generator")}</label>
                    <input type="text" id="setting-placeholder-${n.internalId}" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="placeholder" value="${c(n.placeholder||"")}">
                </div>`),l.innerHTML+=`
            <div class="aipkit_form-group">
                <label class="aipkit_form-label aipkit_checkbox-label" for="setting-required-${n.internalId}">
                    <input type="checkbox" id="setting-required-${n.internalId}" class="aipkit-setting-field" data-setting="required" ${n.required?"checked":""}>
                    ${t(e.text.settingsRequired||"Required Field","gpt3-ai-content-generator")}
                </label>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="setting-help-text-${n.internalId}">${t("Help Text (Optional)","gpt3-ai-content-generator")}</label>
                <textarea id="setting-help-text-${n.internalId}" class="aipkit_form-input aipkit_builder_textarea aipkit-setting-field" data-setting="helpText" rows="3" placeholder="${c(t("This text will appear under the field.","gpt3-ai-content-generator"))}">${c(n.helpText||"")}</textarea>
            </div>
        `,n.type==="select"||n.type==="radio-button"||n.type==="checkbox"){let _=`<hr class="aipkit_hr"><div class="aipkit_form-group"><label class="aipkit_form-label">${t(e.text.settingsSelectOptions||"Options (Value|Text)","gpt3-ai-content-generator")}</label><div id="aipkit_select_options_container">`;(n.options||[]).forEach((f,g)=>{_+=`
                    <div class="aipkit_select_option_row">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-value" data-option-index="${g}" value="${c(f.value)}" placeholder="${t(e.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
                        <input type="text" class="aipkit_form-input aipkit_builder_input aipkit-setting-field" data-setting="option-text" data-option-index="${g}" value="${c(f.text)}" placeholder="${t(e.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
                        <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${t(e.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
                    </div>`}),_+=`</div><button type="button" id="aipkit_add_select_option_btn" class="aipkit_btn aipkit_btn-small aipkit_btn-secondary">${t(e.text.settingsAddOption||"Add Option","gpt3-ai-content-generator")}</button></div>`,l.innerHTML+=_}d.style.display="none",a.style.display="block"}window.aipkitForms_showSettingsPanel=k})();(function(){"use strict";function k(o){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n;if(!o){console.error("AI Forms addSelectOptionRow: formsContainerElement not provided.");return}let e=o.querySelector("#aipkit_ai_form_element_settings_panel");if(!e){console.warn("AI Forms addSelectOptionRow: Settings panel not found in provided container.");return}let t=e.querySelector("#aipkit_select_options_container");if(!t){console.warn("AI Forms addSelectOptionRow: Options container not found in settings panel.");return}let c=t.querySelectorAll(".aipkit_select_option_row").length,s=document.createElement("div");s.className="aipkit_select_option_row",s.innerHTML=`
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-value" data-option-index="${c}" placeholder="${i(r.text.settingsSelectOptionValue||"Value","gpt3-ai-content-generator")}">
            <input type="text" class="aipkit_form-input aipkit-setting-field" data-setting="option-text" data-option-index="${c}" placeholder="${i(r.text.settingsSelectOptionText||"Display Text","gpt3-ai-content-generator")}">
            <button type="button" class="aipkit_btn aipkit_btn-small aipkit_btn-icon aipkit_remove_option_btn" title="${i(r.text.settingsRemoveOption||"Remove Option","gpt3-ai-content-generator")}"><span class="dashicons dashicons-trash"></span></button>
        `,t.appendChild(s)}window.aipkitForms_addSelectOptionRow=k})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms hideSettingsPanel: formsContainerElement not provided.");return}o.querySelectorAll(".aipkit_dropped_element.aipkit-element-selected").forEach(t=>t.classList.remove("aipkit-element-selected")),r.selectedDesignerElementId=null;let i=o.querySelector("#aipkit_ai_form_elements_palette"),e=o.querySelector("#aipkit_ai_form_element_settings_panel");i&&(i.style.display="block"),e&&(e.style.display="none")}window.aipkitForms_hideSettingsPanel=k})();(function(){"use strict";function k(o,r){let i=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:f=>f;if(!r){console.error("AI Forms updateElementFromSettingsPanel: formsContainerElement not provided.");return}let c=null;for(let f of i.formStructure){for(let g of f.columns){let m=g.elements.find(u=>u.internalId===o);if(m){c=m;break}}if(c)break}if(!c){console.error(`updateElementFromSettingsPanel: Element data for ID ${o} not found.`);return}let s=r.querySelector("#aipkit_ai_form_element_settings_panel");if(!s){console.warn("AI Forms updateElementFromSettingsPanel: Settings panel not found in provided container.");return}let n=s.querySelector('input[data-setting="label"]');n&&(c.label=n.value);let d=s.querySelector('input[data-setting="fieldId"]');if(d){let f=d.value.trim().replace(/[^a-zA-Z0-9_]/g,"");if(!f){let m=c.label.toLowerCase().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");m||(m=c.type.replace(/-/g,"_")),f=`${m}_${o.split("-").pop()}`}let g=!0;e:for(let m of i.formStructure)for(let u of m.columns)if(u.elements.some(h=>h.internalId!==o&&h.fieldId===f)){g=!1;break e}g&&f.length>0?(c.fieldId=f,d.value=f,d.classList.remove("aipkit_input_error")):f.length>0&&d.classList.add("aipkit_input_error")}let a=s.querySelector('input[data-setting="required"]');a&&(c.required=a.checked);let l=s.querySelector('textarea[data-setting="helpText"]');if(l&&(c.helpText=l.value),c.type==="text-input"||c.type==="textarea"){let f=s.querySelector('input[data-setting="placeholder"]');f&&(c.placeholder=f.value)}(c.type==="select"||c.type==="radio-button"||c.type==="checkbox")&&(c.options=[],s.querySelectorAll(".aipkit_select_option_row").forEach(g=>{let m=g.querySelector('input[data-setting="option-value"]'),u=g.querySelector('input[data-setting="option-text"]');m&&u&&m.value.trim()!==""?c.options.push({value:m.value,text:u.value}):m&&u&&m.value.trim()===""&&u.value.trim()!==""&&c.options.push({value:u.value,text:u.value})}));let p=r.querySelector("#aipkit_ai_form_designer_area"),_=p?p.querySelector(`#${CSS.escape(o)}`):null;if(_&&p){let f=_.parentElement,g=p.scrollTop,m=_.classList.contains("aipkit-element-selected"),u=_.nextElementSibling;if(_.remove(),typeof window.aipkitForms_renderFieldInColumn=="function"?window.aipkitForms_renderFieldInColumn(f,c,u):console.error("AI Forms updateElement: renderFieldInColumn function missing."),m){let h=p.querySelector(`#${CSS.escape(o)}`);h&&h.classList.add("aipkit-element-selected")}p.scrollTop=g}else console.warn("AI Forms updateElement: Designer element or area not found in provided container for re-render.");typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(r)}window.aipkitForms_updateElementFromSettingsPanel=k})();(function(){"use strict";function k(e){let t=window.aipkitAIFormsState;if(!e)return;let c=e.querySelector("#aipkit_prompt_snippets_container");if(!c)return;c.innerHTML="";let s=new Set;if(t.formStructure.forEach(n=>{n.columns.forEach(d=>{d.elements.forEach(a=>{a.fieldId&&s.add(a.fieldId)})})}),s.size>0){let n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:d=>d;s.forEach(d=>{let a=document.createElement("button");a.type="button",a.className="aipkit_prompt_snippet",a.dataset.fieldId=d,a.title=n("Click to copy","gpt3-ai-content-generator"),a.innerHTML=`<span class="dashicons dashicons-clipboard"></span> {${d}}`,c.appendChild(a)})}}function o(e){if(!e)return;let t=e.querySelector("#aipkit_form_editor_container");if(!t){console.warn("AI Forms: Editor container not found for prompt snippets init.");return}let c=t.querySelector("#aipkit_prompt_snippets_container");if(!c){console.warn("AI Forms: Prompt snippets container not found for init.");return}c.dataset.listenerAttached!=="true"&&(c.addEventListener("click",function(s){let n=s.target.closest(".aipkit_prompt_snippet");if(!n)return;let d=n.dataset.fieldId;d&&typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(`{${d}}`,n)}),c.dataset.listenerAttached="true")}function r(e,t){if(!e)return;let c=e.querySelector("#aipkit_ai_form_ai_provider");c&&(c.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(t?c.dataset.aipkitProviderNoticeArmed="true":delete c.dataset.aipkitProviderNoticeArmed),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(e))}function i(e=null,t){let c=window.aipkitAIFormsState,s=window.aipkit_ai_forms_config||{text:{}},n=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:g=>g,d=window.aipkit_escapeHtml||function(g){return g};if(!t){console.error("AI Forms Admin (showFormEditor): formsContainerElement not provided.");return}c.currentFormId=e,c.droppedElementCounter=0,c.formStructure=[],c.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(t):console.error("AI Forms showFormEditor: hideSettingsPanel function missing.");let a=t.querySelector("#aipkit_form_editor_container"),l=t.querySelector("#aipkit_ai_forms_list_container"),p=t.querySelector("#aipkit_ai_forms_editor_actions"),_=t.querySelector("#aipkit_create_new_ai_form_btn"),f=t.querySelector("#aipkit_ai_forms_settings_trigger");l.style.display="none",a.style.display="block",p&&(p.style.display="flex"),_&&(_.style.display="none"),f&&(f.style.display="none"),requestAnimationFrame(()=>{let g=()=>{typeof window.aipkitForms_refreshSelectPickers=="function"&&window.aipkitForms_refreshSelectPickers(t)},m=t.querySelector("#aipkit_ai_form_title"),u=a.querySelector("#aipkit_ai_form_prompt_template"),h=a.querySelector("#aipkit_ai_form_id"),v=a.querySelector("#aipkit_ai_form_designer_area"),S=a.querySelector("#aipkit_ai_form_ai_provider"),q=a.querySelector("#aipkit_ai_form_ai_model"),y=a.querySelector("#aipkit_ai_form_temperature"),E=a.querySelector("#aipkit_ai_form_temperature_value"),I=a.querySelector("#aipkit_ai_form_max_tokens"),w=a.querySelector("#aipkit_ai_form_max_tokens_value"),A=a.querySelector("#aipkit_ai_form_top_p"),C=a.querySelector("#aipkit_ai_form_top_p_value"),b=a.querySelector("#aipkit_ai_form_frequency_penalty"),x=a.querySelector("#aipkit_ai_form_frequency_penalty_value"),T=a.querySelector("#aipkit_ai_form_presence_penalty"),P=a.querySelector("#aipkit_ai_form_presence_penalty_value"),H=t.querySelector("#aipkit_preview_ai_form_btn"),O=()=>{let z=document.createElement("div");return z.className="aipkit_form_designer_placeholder",z.id="aipkit_form_designer_placeholder",z.innerHTML=`<span class="dashicons dashicons-layout"></span>${n("Drag a Layout Here to Start","gpt3-ai-content-generator")}`,z};if(!a||!l||!m||!u||!h||!v||!S||!q||!y||!I||!H||!E||!w||!A||!C||!b||!x||!T||!P){console.error("AI Forms Admin (showFormEditor): One or more editor child elements not found within the provided container.",{containerHTML:t.innerHTML.substring(0,500)});return}let F=t.querySelector("#aipkit_ai_forms_header_title_default"),M=t.querySelector("#aipkit_ai_forms_header_title_editor"),B=t.querySelector("#aipkit_ai_forms_title_display"),V=t.querySelector("#aipkit_ai_forms_title_text"),L=n("New Form","gpt3-ai-content-generator"),U=()=>{if(!V||!B||!m)return;let ge=m.value.trim()||L;V.textContent=ge,B.setAttribute("title",ge)},W=()=>{!B||!m||(B.style.display="none",m.style.display="inline-block",m.focus(),m.select())},ee=()=>{!B||!m||(m.style.display="none",B.style.display="inline-flex",U())};F&&(F.style.display="none"),M&&(M.style.display="flex"),M&&M.dataset.inlineTitleBound!=="true"&&B&&m&&(B.addEventListener("click",W),m.addEventListener("blur",ee),m.addEventListener("keydown",z=>{z.key==="Enter"&&(z.preventDefault(),m.blur())}),m.addEventListener("input",U),M.dataset.inlineTitleBound="true"),m.value="",u.value="",h.value="",v.innerHTML="",v.appendChild(O()),ee(),k(t);let ne={generate_button:"Generate",stop_button:"Stop",download_button:"Download",save_button:"Save",copy_button:"Copy",provider_label:"Engine",model_label:"Model"};if(a.querySelectorAll('input[name^="labels["]').forEach(z=>{let ge=z.name.match(/labels\[(.+)\]/),Ae=ge?ge[1]:null;Ae&&ne[Ae]!==void 0?z.value=ne[Ae]:z.value=""}),!e){if(S.value="OpenAI",y&&E){let z=window.aipkit_dashboard?.ai_params?.temperature||1;y.value=z,E.textContent=z}if(I&&w){let z=window.aipkit_dashboard?.ai_params?.max_completion_tokens||2e3;I.value=z,w.textContent=z}if(A&&C){let z=window.aipkit_dashboard?.ai_params?.top_p||1;A.value=z,C.textContent=z}if(b&&x){let z=window.aipkit_dashboard?.ai_params?.frequency_penalty||0;b.value=z,x.textContent=z}if(T&&P){let z=window.aipkit_dashboard?.ai_params?.presence_penalty||0;T.value=z,P.textContent=z}typeof window.aipkitForms_populateAiModels=="function"&&(window.aipkitForms_populateAiModels("OpenAI","gpt-4o-mini"),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(a)),typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(S.value,a),g(),r(a,!0)}e?(H.disabled=!1,h.value=e,v.innerHTML=`<p style="text-align:center; padding:20px;"><span class="aipkit_spinner" style="display:inline-block; width:16px; height:16px;"></span> ${n("Loading form details...","gpt3-ai-content-generator")}</p>`,window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:e,_ajax_nonce:s.nonce_manage_forms}).then(z=>{if(z.form){m.value=z.form.title||"",ee(),u.value=z.form.prompt_template||"",S.value=z.form.ai_provider||"OpenAI",y&&E&&(y.value=z.form.temperature,E.textContent=z.form.temperature),I&&w&&(I.value=z.form.max_tokens,w.textContent=z.form.max_tokens),A&&C&&(A.value=z.form.top_p,C.textContent=z.form.top_p),b&&x&&(b.value=z.form.frequency_penalty,x.textContent=z.form.frequency_penalty),T&&P&&(T.value=z.form.presence_penalty,P.textContent=z.form.presence_penalty);let ge=z.form.labels||{};["generate_button","stop_button","download_button","save_button","copy_button","provider_label","model_label"].forEach(wt=>{let Je=a.querySelector(`input[name="labels[${wt}]"]`);Je&&(Je.value=ge[wt]||"")}),typeof window.aipkitForms_populateAiModels=="function"&&window.aipkitForms_populateAiModels(S.value,z.form.ai_model);let ot=a.querySelector("#aipkit_ai_form_reasoning_effort");ot&&(ot.value=z.form.reasoning_effort||""),typeof window.aipkitForms_toggleReasoningEffort=="function"&&window.aipkitForms_toggleReasoningEffort(a);let ze=a.querySelector('input[name="enable_vector_store"]'),Xe=ze?ze.closest('[data-aipkit-settings-panel="context"]'):null;if(Xe){let wt=Xe.querySelector('select[name="vector_store_provider"]'),Je=Xe.querySelector('select[name="openai_vector_store_ids[]"]'),ui=Xe.querySelector('select[name="pinecone_index_name"]'),bi=Xe.querySelector('select[name="qdrant_collection_name"]'),Xt=Xe.querySelector(".aipkit_vector_embedding_select"),Tt=Xe.querySelector('select[name="vector_embedding_provider"]'),Qt=Xe.querySelector('select[name="vector_embedding_model"]'),ii=Xe.querySelector('input[name="vector_store_top_k"]'),Ri=Xe.querySelector("#aipkit_ai_form_vector_store_top_k_value"),Qi=Xe.querySelector('input[name="vector_store_confidence_threshold"]'),Ht=Xe.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");if(ze.checked=z.form.enable_vector_store==="1",wt&&(wt.value=z.form.vector_store_provider||"openai"),ui&&(ui.value=z.form.pinecone_index_name||""),ui&&z.form.pinecone_index_name&&!Array.from(ui.options).some(_e=>_e.value===z.form.pinecone_index_name)){let _e=new Option(`${z.form.pinecone_index_name} (Manual)`,z.form.pinecone_index_name,!1,!0);ui.appendChild(_e),ui.value=z.form.pinecone_index_name}if(bi){let _e=Array.isArray(z.form.qdrant_collection_names)?z.form.qdrant_collection_names[0]:z.form.qdrant_collection_name||"";if(_e&&!Array.from(bi.options).some(Me=>Me.value===_e)){let Me=new Option(`${_e} (Manual)`,_e,!1,!0);bi.appendChild(Me)}_e&&(bi.value=_e)}if(Tt&&(Tt.value=z.form.vector_embedding_provider||"openai"),ii&&Ri){let _e=z.form.vector_store_top_k||3;ii.value=_e,Ri.textContent=_e}if(Qi&&Ht){let _e=z.form.vector_store_confidence_threshold||20;Qi.value=_e,Ht.textContent=_e+"%"}if(Je&&z.form.openai_vector_store_ids&&Array.isArray(z.form.openai_vector_store_ids)){let _e=new Set(Array.from(Je.options).map(Me=>Me.value));z.form.openai_vector_store_ids.forEach((Me,Ee)=>{if(Me&&!_e.has(Me)){let lt=new Option(`Manual store ${Ee+1}`,Me,!1,!0);Je.appendChild(lt),_e.add(Me)}}),Array.from(Je.options).forEach(Me=>{Me.selected=z.form.openai_vector_store_ids.includes(Me.value)})}typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(Xe),Qt&&(Qt.value=z.form.vector_embedding_model||""),typeof window.aipkitForms_syncEmbeddingSelectFromInputs=="function"&&window.aipkitForms_syncEmbeddingSelectFromInputs(Xe,Xt),ze.dispatchEvent(new Event("change",{bubbles:!0}))}let Ge=a.querySelector('input[name="openai_web_search_enabled"]'),It=a.querySelector('input[name="claude_web_search_enabled"]'),Qe=a.querySelector('input[name="openrouter_web_search_enabled"]'),Ce=a.querySelector('input[name="google_search_grounding_enabled"]');Ge&&(Ge.checked=z.form.openai_web_search_enabled==="1"),It&&(It.checked=z.form.claude_web_search_enabled==="1"),Qe&&(Qe.checked=z.form.openrouter_web_search_enabled==="1"),Ce&&(Ce.checked=z.form.google_search_grounding_enabled==="1");let St=a.querySelector('select[name="openai_web_search_context_size"]'),Rt=a.querySelector('select[name="openai_web_search_loc_type"]'),vi=a.querySelector('input[name="openai_web_search_loc_country"]'),gi=a.querySelector('input[name="openai_web_search_loc_city"]'),ae=a.querySelector('input[name="openai_web_search_loc_region"]'),ke=a.querySelector('input[name="openai_web_search_loc_timezone"]');St&&(St.value=z.form.openai_web_search_context_size||"medium"),Rt&&(Rt.value=z.form.openai_web_search_loc_type||"none"),vi&&(vi.value=z.form.openai_web_search_loc_country||""),gi&&(gi.value=z.form.openai_web_search_loc_city||""),ae&&(ae.value=z.form.openai_web_search_loc_region||""),ke&&(ke.value=z.form.openai_web_search_loc_timezone||"");let ye=a.querySelector('input[name="claude_web_search_max_uses"]'),ve=a.querySelector('select[name="claude_web_search_loc_type"]'),Re=a.querySelector('input[name="claude_web_search_loc_country"]'),Ie=a.querySelector('input[name="claude_web_search_loc_city"]'),at=a.querySelector('input[name="claude_web_search_loc_region"]'),rt=a.querySelector('input[name="claude_web_search_loc_timezone"]'),Ft=a.querySelector('input[name="claude_web_search_allowed_domains"]'),_i=a.querySelector('input[name="claude_web_search_blocked_domains"]'),Lt=a.querySelector('select[name="claude_web_search_cache_ttl"]');ye&&(ye.value=z.form.claude_web_search_max_uses||"5"),ve&&(ve.value=z.form.claude_web_search_loc_type||"none"),Re&&(Re.value=z.form.claude_web_search_loc_country||""),Ie&&(Ie.value=z.form.claude_web_search_loc_city||""),at&&(at.value=z.form.claude_web_search_loc_region||""),rt&&(rt.value=z.form.claude_web_search_loc_timezone||""),Ft&&(Ft.value=z.form.claude_web_search_allowed_domains||""),_i&&(_i.value=z.form.claude_web_search_blocked_domains||""),Lt&&(Lt.value=z.form.claude_web_search_cache_ttl||"none");let Et=a.querySelector('select[name="openrouter_web_search_engine"]'),tt=a.querySelector('input[name="openrouter_web_search_max_results"]'),De=a.querySelector('input[name="openrouter_web_search_search_prompt"]');Et&&(Et.value=z.form.openrouter_web_search_engine||"auto"),tt&&(tt.value=z.form.openrouter_web_search_max_results||"5"),De&&(De.value=z.form.openrouter_web_search_search_prompt||"");let Ke=a.querySelector('select[name="google_grounding_mode"]'),xt=a.querySelector('input[name="google_grounding_dynamic_threshold"]'),zt=a.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");if(Ke&&(Ke.value=z.form.google_grounding_mode||"DEFAULT_MODE"),xt){let wt=z.form.google_grounding_dynamic_threshold||.3;xt.value=wt,zt&&(zt.textContent=wt)}if(typeof window.aipkitForms_updateWebSearchVisibility=="function"&&window.aipkitForms_updateWebSearchVisibility(S.value,a),Ge&&Ge.dispatchEvent(new Event("change",{bubbles:!0})),It&&It.dispatchEvent(new Event("change",{bubbles:!0})),Qe&&Qe.dispatchEvent(new Event("change",{bubbles:!0})),Ce&&Ce.dispatchEvent(new Event("change",{bubbles:!0})),z.form.structure&&Array.isArray(z.form.structure))if(c.formStructure=z.form.structure,v.innerHTML="",c.formStructure.length===0)v.appendChild(O());else{c.formStructure.forEach(Je=>{window.aipkitForms_renderLayoutRow(v,Je,null,t)});let wt=0;c.formStructure.forEach(Je=>{Je.columns.forEach(ui=>{ui.elements.forEach(bi=>{let Xt=bi.internalId.split("-"),Tt=parseInt(Xt[Xt.length-1],10)||0;Tt>wt&&(wt=Tt)})})}),c.droppedElementCounter=wt}else v.innerHTML="",v.appendChild(O());g(),r(a,!0),k(t)}else throw new Error(z.message||n("Could not load form data.","gpt3-ai-content-generator"))}).catch(z=>{typeof window.aipkitForms_displayMessage=="function"?window.aipkitForms_displayMessage(t,"error",z.message):console.error("AI Forms showFormEditor: displayMessage function missing."),typeof window.aipkitForms_hideFormEditor=="function"?window.aipkitForms_hideFormEditor(t):console.error("AI Forms showFormEditor: hideFormEditor function missing.")})):(H.disabled=!0,ee())})}window.aipkitForms_showFormEditor=i,window.aipkitForms_updatePromptSnippets=k,window.aipkitForms_initPromptSnippets=o})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState,i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:_=>_;if(!o){console.error("AI Forms hideFormEditor: formsContainerElement not provided.");return}r.currentFormId=null,r.selectedDesignerElementId=null,typeof window.aipkitForms_hideSettingsPanel=="function"?window.aipkitForms_hideSettingsPanel(o):console.error("AI Forms hideFormEditor: hideSettingsPanel function missing.");let e=o.querySelector("#aipkit_form_editor_container"),t=o.querySelector("#aipkit_ai_forms_list_container"),c=o.querySelector("#aipkit_ai_forms_editor_actions"),s=o.querySelector("#aipkit_create_new_ai_form_btn"),n=o.querySelector("#aipkit_ai_forms_settings_trigger"),d=o.querySelector("#aipkit_ai_forms_header_title_default"),a=o.querySelector("#aipkit_ai_forms_header_title_editor");if(e&&(e.style.display="none"),t&&(t.style.display="block"),c&&(c.style.display="none"),s&&(s.style.display=""),n&&(n.style.display=""),d&&(d.style.display=""),a&&(a.style.display="none"),typeof window.aipkitForms_closePreviewSheet=="function"&&window.aipkitForms_closePreviewSheet(o),e){let _=e.querySelector("#aipkit_ai_form_ai_provider");_&&delete _.dataset.aipkitProviderNoticeArmed}let l=document.getElementById("aipkit_provider_notice_ai_forms");if(l&&l.classList.add("aipkit_provider_notice--hidden"),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(o),e){let _=e.querySelector("#aipkit_ai_form_preview_container");_&&(_.style.display="none",_.innerHTML="");let f=o.querySelector("#aipkit_preview_ai_form_btn");if(f&&f.classList.contains("aipkit-preview-active")){f.classList.remove("aipkit-preview-active");let g=f.querySelector(".aipkit_btn-text");g&&(g.textContent=i("Preview","gpt3-ai-content-generator"))}}let p=o.querySelector("#aipkit_ai_forms_messages");p&&(p.innerHTML="")}window.aipkitForms_hideFormEditor=k})();(function(){"use strict";function k(o,r){let i=window.aipkitAIFormsState,e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:Lt=>Lt,c={value:null},s=()=>r.querySelector("#aipkit_ai_forms_status"),n=(Lt,Et)=>{let tt=s();if(!tt)return;let De=tt.classList.contains("aipkit_training_status");if(tt.textContent=Lt||"",De){tt.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),Lt&&tt.classList.add("is-visible"),Et&&tt.classList.add(`is-${Et}`);return}tt.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),Et==="success"?tt.classList.add("aipkit_form-help-success"):Et==="error"&&tt.classList.add("aipkit_form-help-error")},d=(Lt=2500)=>{c.value&&window.clearTimeout(c.value),c.value=window.setTimeout(()=>{n("","")},Lt)};if(!r){console.error("AI Forms saveForm: formsContainerElement not provided.");return}let a=r.querySelector("#aipkit_form_editor_container");if(!a){console.error("AI Forms saveForm: editorContainer not found in provided formsContainerElement.");return}let l=r.querySelector("#aipkit_ai_form_title"),p=a.querySelector("#aipkit_ai_form_prompt_template"),_=a.querySelector("#aipkit_ai_form_id"),f=a.querySelector("#aipkit_ai_form_ai_provider"),g=a.querySelector("#aipkit_ai_form_ai_model"),m=a.querySelector("#aipkit_ai_form_temperature"),u=a.querySelector("#aipkit_ai_form_max_tokens"),h=a.querySelector("#aipkit_ai_form_top_p"),v=a.querySelector("#aipkit_ai_form_frequency_penalty"),S=a.querySelector("#aipkit_ai_form_presence_penalty"),q=a.querySelector("#aipkit_ai_form_reasoning_effort"),y=a.querySelector('input[name="enable_vector_store"]'),E=a.querySelector('select[name="vector_store_provider"]'),I=a.querySelector('select[name="openai_vector_store_ids[]"]'),w=a.querySelector('select[name="pinecone_index_name"]'),A=a.querySelector('select[name="qdrant_collection_name"]'),C=a.querySelector('select[name="vector_embedding_provider"]'),b=a.querySelector('select[name="vector_embedding_model"]'),x=a.querySelector('input[name="vector_store_top_k"]'),T=a.querySelector('input[name="vector_store_confidence_threshold"]'),P=a.querySelector('input[name="openai_web_search_enabled"]'),H=a.querySelector('input[name="claude_web_search_enabled"]'),O=a.querySelector('input[name="openrouter_web_search_enabled"]'),F=a.querySelector('input[name="google_search_grounding_enabled"]'),M=a.querySelector('select[name="openai_web_search_context_size"]'),B=a.querySelector('select[name="openai_web_search_loc_type"]'),V=a.querySelector('input[name="openai_web_search_loc_country"]'),L=a.querySelector('input[name="openai_web_search_loc_city"]'),U=a.querySelector('input[name="openai_web_search_loc_region"]'),W=a.querySelector('input[name="openai_web_search_loc_timezone"]'),ee=a.querySelector('input[name="claude_web_search_max_uses"]'),ne=a.querySelector('select[name="claude_web_search_loc_type"]'),z=a.querySelector('input[name="claude_web_search_loc_country"]'),ge=a.querySelector('input[name="claude_web_search_loc_city"]'),Ae=a.querySelector('input[name="claude_web_search_loc_region"]'),ot=a.querySelector('input[name="claude_web_search_loc_timezone"]'),ze=a.querySelector('input[name="claude_web_search_allowed_domains"]'),Xe=a.querySelector('input[name="claude_web_search_blocked_domains"]'),Ge=a.querySelector('select[name="claude_web_search_cache_ttl"]'),It=a.querySelector('select[name="openrouter_web_search_engine"]'),Qe=a.querySelector('input[name="openrouter_web_search_max_results"]'),Ce=a.querySelector('input[name="openrouter_web_search_search_prompt"]'),St=a.querySelector('select[name="google_grounding_mode"]'),Rt=a.querySelector('input[name="google_grounding_dynamic_threshold"]');if(!l||!p||!_||!f||!g||!m||!u||!h||!v||!S){console.error("AI Forms saveForm: One or more critical form editor inputs not found in editorContainer.");return}let vi=l.value.trim(),gi=p.value.trim(),ae=_.value;if(vi||(vi=t("New Form","gpt3-ai-content-generator"),l.value=vi,l.dispatchEvent(new Event("input",{bubbles:!0}))),!gi){alert(t(e.text.promptTemplateRequired||"Prompt template is required.","gpt3-ai-content-generator"));return}let ke=new Set,ye=!0;e:for(let Lt of i.formStructure)for(let Et of Lt.columns)for(let tt of Et.elements){if(!tt.fieldId||!/^[a-zA-Z0-9_]+$/.test(tt.fieldId)){alert(t(`Invalid Field Variable Name: "${tt.fieldId||""}" for element "${tt.label}". Only letters, numbers, and underscores allowed, and it cannot be empty.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(tt.internalId,r);let De=a.querySelector(`#setting-field-id-${tt.internalId}`);De&&De.focus(),ye=!1;break e}if(ke.has(tt.fieldId)){alert(t(`Duplicate Field Variable Name: "${tt.fieldId}". Each field variable name must be unique.`,"gpt3-ai-content-generator")),typeof window.aipkitForms_showSettingsPanel=="function"&&window.aipkitForms_showSettingsPanel(tt.internalId,r);let De=a.querySelector(`#setting-field-id-${tt.internalId}`);De&&De.focus(),ye=!1;break e}ke.add(tt.fieldId)}if(!ye)return;let ve=I?Array.from(I.selectedOptions).map(Lt=>Lt.value):[],Re=a.querySelectorAll('input[name^="labels["]'),Ie={};Re.forEach(Lt=>{let Et=Lt.name.match(/\[(.*?)\]/);if(Et&&Et[1]){let tt=Et[1];Ie[tt]=Lt.value}});let at=JSON.stringify(Ie),rt={_ajax_nonce:e.nonce_manage_forms,form_id:ae||null,title:vi,prompt_template:gi,form_structure:JSON.stringify(i.formStructure),ai_provider:f.value,ai_model:g.value,temperature:m.value,max_tokens:u.value,top_p:h.value,frequency_penalty:v.value,presence_penalty:S.value,reasoning_effort:q?.value,enable_vector_store:y?.checked?"1":"0",vector_store_provider:E?.value,openai_vector_store_ids:ve,pinecone_index_name:w?.value||"",qdrant_collection_name:A?.value||"",vector_embedding_provider:C?.value,vector_embedding_model:b?.value||"",vector_store_top_k:x?.value||3,vector_store_confidence_threshold:T?.value||20,openai_web_search_enabled:P?.checked?"1":"0",claude_web_search_enabled:H?.checked?"1":"0",openrouter_web_search_enabled:O?.checked?"1":"0",google_search_grounding_enabled:F?.checked?"1":"0",openai_web_search_context_size:M?.value||"medium",openai_web_search_loc_type:B?.value||"none",openai_web_search_loc_country:V?.value||"",openai_web_search_loc_city:L?.value||"",openai_web_search_loc_region:U?.value||"",openai_web_search_loc_timezone:W?.value||"",claude_web_search_max_uses:ee?.value||"5",claude_web_search_loc_type:ne?.value||"none",claude_web_search_loc_country:z?.value||"",claude_web_search_loc_city:ge?.value||"",claude_web_search_loc_region:Ae?.value||"",claude_web_search_loc_timezone:ot?.value||"",claude_web_search_allowed_domains:ze?.value||"",claude_web_search_blocked_domains:Xe?.value||"",claude_web_search_cache_ttl:Ge?.value||"none",openrouter_web_search_engine:It?.value||"auto",openrouter_web_search_max_results:Qe?.value||"5",openrouter_web_search_search_prompt:Ce?.value||"",google_grounding_mode:St?.value||"DEFAULT_MODE",google_grounding_dynamic_threshold:Rt?.value||"0.30",labels:at},Ft=o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent:o.textContent,_i=o.querySelector(".aipkit_spinner");o.disabled=!0,_i&&(_i.style.display="inline-block"),o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent=t(e.text.savingForm||"Saving...","gpt3-ai-content-generator"):o.firstChild.textContent=t(e.text.savingForm||"Saving...","gpt3-ai-content-generator")+" ",n(t("Saving...","gpt3-ai-content-generator"),"loading"),window.aipkit_apiRequest("aipkit_save_ai_form",rt).then(Lt=>{if(!ae&&Lt.form_id){_&&(_.value=Lt.form_id),i.currentFormId=Lt.form_id;let Et=r.querySelector("#aipkit_preview_ai_form_btn");Et&&(Et.disabled=!1)}n(Lt.message||t(e.text.formSaved||"Form saved!","gpt3-ai-content-generator"),"success"),d(),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(Lt=>{n(Lt.message||t(e.text.errorSavingForm||"Error saving form.","gpt3-ai-content-generator"),"error"),d(4e3)}).finally(()=>{o.disabled=!1,_i&&(_i.style.display="none"),o.querySelector(".aipkit_btn-text")?o.querySelector(".aipkit_btn-text").textContent=Ft:o.firstChild.textContent=Ft})}window.aipkitForms_saveForm=k})();(function(){"use strict";function k(o,r,i){let e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n;if(!i){console.error("AI Forms deleteForm: formsContainerElement not provided.");return}let c={_ajax_nonce:e.nonce_manage_forms,form_id:o},s=r.textContent;r.disabled=!0,r.textContent=t(e.text.deletingForm||"Deleting...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_delete_ai_form",c).then(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",n.message||t(e.text.formDeleted||"Form deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",n.message||t(e.text.errorDeletingForm||"Error deleting form.","gpt3-ai-content-generator"));let d=i.querySelector(`.aipkit_delete_ai_form_btn[data-form-id="${o}"]`);d&&(d.disabled=!1,d.textContent=s)})}window.aipkitForms_deleteForm=k})();(function(){"use strict";function k(o,r){let i=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n;if(!r){console.error("AI Forms deleteAllForms: formsContainerElement not provided.");return}let t={_ajax_nonce:i.nonce_manage_forms},c=o.querySelector(".aipkit_btn-text")?.textContent||e("Delete All Forms","gpt3-ai-content-generator"),s=o.querySelector(".aipkit_spinner");o.disabled=!0,o.querySelector(".aipkit_btn-text")&&(o.querySelector(".aipkit_btn-text").innerHTML=`<span class="aipkit_spinner" style="display:inline-block; margin-right: 5px;"></span> ${e(i.text.deletingAllForms||"Deleting...","gpt3-ai-content-generator")}`),window.aipkit_apiRequest("aipkit_delete_all_ai_forms",t).then(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"success",n.message||e(i.text.allFormsDeleted||"All forms deleted.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(r,"error",n.message||e(i.text.errorDeletingAllForms||"Error deleting all forms.","gpt3-ai-content-generator"))}).finally(()=>{o.querySelector(".aipkit_btn-text")&&(o.querySelector(".aipkit_btn-text").textContent=c),s&&(s.style.display="none"),o.disabled=!1})}window.aipkitForms_deleteAllForms=k})();(function(){"use strict";function k(o,r,i){let e=window.aipkit_ai_forms_config||{text:{}},t=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:n=>n;if(!i){console.error("AI Forms duplicateForm: formsContainerElement not provided.");return}let c={_ajax_nonce:e.nonce_manage_forms,form_id:o},s=r.textContent;r.disabled=!0,r.textContent=t(e.text.duplicatingForm||"Duplicating...","gpt3-ai-content-generator"),window.aipkit_apiRequest("aipkit_duplicate_ai_form",c).then(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"success",n.message||t("Form duplicated successfully.","gpt3-ai-content-generator")),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}).catch(n=>{typeof window.aipkitForms_displayMessage=="function"&&window.aipkitForms_displayMessage(i,"error",n.message||t(e.text.errorDuplicatingForm||"Error duplicating form.","gpt3-ai-content-generator"))}).finally(()=>{let n=i.querySelector(`.aipkit_duplicate_ai_form_btn[data-form-id="${o}"]`);n&&(n.disabled=!1,n.textContent=s)})}window.aipkitForms_duplicateForm=k})();(function(){"use strict";async function k(o){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:t=>t,e=o.textContent;o.disabled=!0,o.textContent=i("Exporting...","gpt3-ai-content-generator");try{let t=await window.aipkit_apiRequest("aipkit_export_all_ai_forms",{_ajax_nonce:r.nonce_manage_forms});if(t.forms&&Array.isArray(t.forms)&&t.forms.length>0){let c=t.forms.map(_=>(delete _.id,delete _.status,_)),n=`aipkit-forms-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,d=JSON.stringify(c,null,2),a=new Blob([d],{type:"application/json"}),l=URL.createObjectURL(a),p=document.createElement("a");p.href=l,p.download=n,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(l)}else throw new Error(i("No forms to export or data not found in response.","gpt3-ai-content-generator"))}catch(t){alert(i("Error exporting forms: ","gpt3-ai-content-generator")+t.message)}finally{o.disabled=!1,o.textContent=e}}window.aipkitForms_exportAllForms=k})();(function(){"use strict";async function k(o,r){let i=window.aipkit_ai_forms_config||{text:{}},e=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:c=>c,t=r.textContent;r.disabled=!0,r.textContent=e("Exporting...","gpt3-ai-content-generator");try{let c=await window.aipkit_apiRequest("aipkit_get_ai_form",{form_id:o,_ajax_nonce:i.nonce_manage_forms});if(c.form){let s=c.form,n=s.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),d=`aipkit-form-${o}-${n}.json`;delete s.id,delete s.status;let a=JSON.stringify(s,null,2),l=new Blob([a],{type:"application/json"}),p=URL.createObjectURL(l),_=document.createElement("a");_.href=p,_.download=d,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(p)}else throw new Error(e("Form data not found in response.","gpt3-ai-content-generator"))}catch(c){alert(e("Error exporting form: ","gpt3-ai-content-generator")+c.message)}finally{r.disabled=!1,r.textContent=t}}window.aipkitForms_exportForm=k})();(function(){"use strict";let k=document.getElementById("aipkit_ai_forms_import_messages"),o;function r(t,c){if(!k)return;let s=window.aipkit_escapeHtml||(n=>n);k.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${t}">${s(c)}</div>`,o&&clearTimeout(o),o=setTimeout(()=>{k.innerHTML=""},8e3)}function i(){k&&(k.innerHTML=""),o&&clearTimeout(o)}async function e(t){let c=window.aipkit_ai_forms_config||{text:{}},s=window.wp?.i18n?.__||(l=>l),n=t.files;if(!n.length)return;let d=n[0];i(),r("info",s("Reading file...","gpt3-ai-content-generator"));let a=new FileReader;a.onload=async function(l){try{let p=l.target.result,_=JSON.parse(p);if(typeof _=="object"&&_!==null&&!Array.isArray(_)&&(_=[_]),!Array.isArray(_))throw new Error(s("Import file is not a valid JSON array.","gpt3-ai-content-generator"));if(_.length===0){r("warning",s("File contains no forms to import.","gpt3-ai-content-generator"));return}r("info",s("Importing...","gpt3-ai-content-generator"));let f=await window.aipkit_apiRequest("aipkit_import_ai_forms",{_ajax_nonce:c.nonce_manage_forms,forms_json:JSON.stringify(_)});r(f.failed_count>0?"warning":"success",f.message),typeof window.aipkitForms_fetchForms=="function"&&window.aipkitForms_fetchForms()}catch(p){r("error",s("Error processing import file: ","gpt3-ai-content-generator")+p.message)}},a.onerror=function(){r("error",s("Error reading the selected file.","gpt3-ai-content-generator"))},a.readAsText(d)}window.aipkitForms_importForms=e})();(function(){"use strict";let k="aipkit_ai_forms_status",o=!1,r=null,i=null,e=null;function t(){return document.getElementById(k)}function c(h,v){let S=t();if(!S)return;let q=S.classList.contains("aipkit_training_status");if(S.textContent=h||"",q){S.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),h&&S.classList.add("is-visible"),v&&S.classList.add(`is-${v}`);return}S.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),v==="success"?S.classList.add("aipkit_form-help-success"):v==="error"&&S.classList.add("aipkit_form-help-error")}function s(h=2500){e&&window.clearTimeout(e),e=window.setTimeout(()=>{c("","")},h)}function n(){return document.getElementById("aipkit_ai_forms_settings_form")}function d(){let h=n();if(!h)return console.error("AI Forms Save Settings: Settings form not found."),null;let v=new FormData(h),S={};return v.forEach((q,y)=>{S[y]=q}),S}function a(h){if(!h)return"";let v={};return Object.keys(h).sort().forEach(S=>{v[S]=h[S]}),JSON.stringify(v)}function l(h){i=a(h)}function p(h){return a(h)!==i}async function _(h,v){let S=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:E=>E;if(typeof window.aipkit_apiRequest!="function"){console.error("AI Forms Save Settings: aipkit_apiRequest not found.");return}c(S("Saving...","gpt3-ai-content-generator"),"loading");let q="",y=null;v&&(q=v.querySelector(".aipkit_btn-text")?.textContent||S("Save AI Forms Settings","gpt3-ai-content-generator"),y=v.querySelector(".aipkit_spinner"),v.disabled=!0,y&&(y.style.display="inline-block"),v.querySelector(".aipkit_btn-text")&&(v.querySelector(".aipkit_btn-text").textContent=S("Saving...","gpt3-ai-content-generator")));try{let E=await window.aipkit_apiRequest("aipkit_save_ai_forms_settings",h);return c(E.message||S("Settings saved!","gpt3-ai-content-generator"),"success"),s(),l(h),E}catch(E){throw c(E.message||S("Failed to save settings.","gpt3-ai-content-generator"),"error"),s(4e3),console.error("AI Forms Save Settings Error:",E),E}finally{v&&(v.disabled=!1,y&&(y.style.display="none"),v.querySelector(".aipkit_btn-text")&&(v.querySelector(".aipkit_btn-text").textContent=q))}}function f(h,v){if(h){if(o){r=h;return}o=!0,_(h,v).catch(()=>{}).finally(()=>{if(o=!1,r){let S=r;r=null,p(S)&&f(S,null)}})}}function g(h){let v=d();f(v,h)}function m(){let h=d();!h||!p(h)||f(h,null)}function u(){let h=d();h&&l(h)}window.aipkitForms_saveAiFormsSettings=g,window.aipkitForms_handleSettingsAutosave=m,window.aipkitForms_updateSettingsAutosaveBaseline=u})();(function(){"use strict";function k(o,r,i){let e=window.aipkit_escapeHtml||function(c){return c};if(!o){console.error("AI Forms displayMessage: formsContainerElement not provided.");return}let t=o.querySelector("#aipkit_ai_forms_messages");t?(t.innerHTML=`<div class="aipkit_settings_message aipkit_settings_message-${r}">${e(i)}</div>`,setTimeout(()=>{t.innerHTML=""},5e3)):console.warn("AI Forms displayMessage: Message container #aipkit_ai_forms_messages not found in provided container.")}window.aipkitForms_displayMessage=k})();(function(){"use strict";function k(r){if(!r){console.warn("AI Forms Token UI: Settings container not provided for toggling fields.");return}let i=r.querySelector(".aipkit_token_limit_mode_select"),e=r.querySelector(".aipkit_token_general_user_limit_field"),t=r.querySelector(".aipkit_token_role_limits_container");if(!i||!e||!t){console.warn("AI Forms Token UI: Could not find required elements for toggling limit fields.");return}let c=i.value;e.hidden=c!=="general",t.hidden=c!=="role_based"}function o(r){if(!r){console.error("AI Forms Token UI: Initialization failed, settings container not provided.");return}let i="data-token-listener-attached";r.getAttribute(i)!=="true"&&(r.addEventListener("change",function(e){e.target.closest(".aipkit_token_limit_mode_select")&&k(r)}),k(r),r.setAttribute(i,"true"))}window.aipkit_initAIFormsTokenManagementUI=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_ai_forms_container");return o||(console.error("[AI Forms Init] CRITICAL: Main container (#aipkit_ai_forms_container) not found. Initialization aborted."),null)}window.aipkitForms_validateContainer=k})();(function(){"use strict";function k(o){let r=window.aipkit_ai_forms_config||{text:{}},i=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:e=>e;o.dataset.clickListenerAttached!=="true"&&(o.addEventListener("click",function(e){let t=e.target,c=n=>t.closest(n),s=o.querySelector("#aipkit_form_editor_container");if(t.matches("#aipkit_create_new_ai_form_btn")||c("#aipkit_create_new_ai_form_btn"))e.preventDefault(),typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(null,o);else if(c(".aipkit_actions_menu_toggle")){e.preventDefault(),e.stopPropagation();let n=t.closest(".aipkit_actions_menu");if(!n)return;let d=n.querySelector(".aipkit_actions_dropdown_menu");if(!d)return;let a=d.style.display==="block";if(document.querySelectorAll(".aipkit_actions_dropdown_menu").forEach(l=>{l!==d&&(l.style.display="none")}),d.style.display=a?"none":"block",!a){let l=p=>{n.contains(p.target)||(d.style.display="none")};document.addEventListener("click",l,{once:!0,capture:!0})}}else if(c("#aipkit_import_ai_forms_btn")){e.preventDefault();let n=o.querySelector("#aipkit_ai_forms_import_file_input");n&&n.click()}else if(t.matches(".aipkit_edit_ai_form_btn")||c(".aipkit_edit_ai_form_btn")){e.preventDefault();let d=c(".aipkit_edit_ai_form_btn").dataset.formId;typeof aipkitForms_showFormEditor=="function"&&aipkitForms_showFormEditor(d,o)}else if(c(".aipkit_preview_ai_form_btn")){e.preventDefault();let n=c(".aipkit_preview_ai_form_btn"),d=n.dataset.formId,a=n.dataset.formTitle||"";typeof window.aipkitForms_openPreviewSheet=="function"&&window.aipkitForms_openPreviewSheet(d,a,o)}else if(t.matches(".aipkit_duplicate_ai_form_btn")||c(".aipkit_duplicate_ai_form_btn")){e.preventDefault();let n=c(".aipkit_duplicate_ai_form_btn"),d=n.dataset.formId;typeof aipkitForms_duplicateForm=="function"&&aipkitForms_duplicateForm(d,n,o)}else if(t.matches("#aipkit_export_all_ai_forms_btn")||c("#aipkit_export_all_ai_forms_btn")){e.preventDefault();let n=c("#aipkit_export_all_ai_forms_btn");typeof window.aipkitForms_exportAllForms=="function"&&window.aipkitForms_exportAllForms(n)}else if(t.matches(".aipkit_export_ai_form_btn")||c(".aipkit_export_ai_form_btn")){e.preventDefault();let n=c(".aipkit_export_ai_form_btn"),d=n.dataset.formId;typeof window.aipkitForms_exportForm=="function"&&window.aipkitForms_exportForm(d,n)}else if(t.matches(".aipkit_delete_ai_form_btn")||c(".aipkit_delete_ai_form_btn")){e.preventDefault();let n=c(".aipkit_delete_ai_form_btn"),d=n.dataset.formId,a=n.dataset.formTitle||`Form ID ${d}`,p=`${i(r.text.confirmDeleteForm||"Are you sure you want to delete this form? This action cannot be undone.","gpt3-ai-content-generator")}

${a}`,_=()=>{typeof aipkitForms_deleteForm=="function"&&aipkitForms_deleteForm(d,n,o)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(p,{title:i("Confirm","gpt3-ai-content-generator"),confirmText:i("Delete","gpt3-ai-content-generator"),cancelText:i("Cancel","gpt3-ai-content-generator"),onConfirm:_});return}confirm(p)&&_()}else if(t.matches("#aipkit_delete_all_ai_forms_btn")||c("#aipkit_delete_all_ai_forms_btn")){e.preventDefault();let n=c("#aipkit_delete_all_ai_forms_btn"),d=i(r.text.confirmDeleteAllForms||"Are you sure you want to delete ALL forms? This action cannot be undone.","gpt3-ai-content-generator"),a=()=>{typeof window.aipkitForms_deleteAllForms=="function"&&window.aipkitForms_deleteAllForms(n,o)};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(d,{title:i("Confirm","gpt3-ai-content-generator"),confirmText:i("Delete","gpt3-ai-content-generator"),cancelText:i("Cancel","gpt3-ai-content-generator"),onConfirm:a});return}confirm(d)&&a()}else if(t.matches(".aipkit_form_shortcode_input"))e.preventDefault(),typeof window.aipkit_copyShortcode=="function"&&window.aipkit_copyShortcode(t.value,t);else if(c(".aipkit_aiform_settings_toggle")){e.preventDefault();let n=c(".aipkit_aiform_settings_toggle"),d=n.dataset.formId,a=o.querySelector(`#aif-configurator-${d}`);if(!a)return;let l=a.closest("tr"),p=()=>{let g=n.getBoundingClientRect(),m=a.getBoundingClientRect(),u=m.width||400,h=m.height||0,v=window.innerWidth,S=window.innerHeight,q=12,y=g.left;y+u>v-q&&(y=g.right-u),y=Math.max(q,Math.min(y,v-u-q));let E=g.bottom+8;E+h>S-q&&(E=g.top-h-8),E=Math.max(q,Math.min(E,S-h-q)),a.style.left=`${Math.round(y)}px`,a.style.top=`${Math.round(E)}px`};o.querySelectorAll(".aipkit_shortcode_configurator").forEach(g=>{g!==a&&(g.style.display="none");let m=g.closest("tr");m&&m.classList.remove("aipkit_shortcode_row_open")});let f=a.style.display==="flex";if(a.style.display=f?"none":"flex",l&&l.classList.toggle("aipkit_shortcode_row_open",!f),!f){p();let g=m=>{!a.contains(m.target)&&!n.contains(m.target)&&(a.style.display="none",l&&l.classList.remove("aipkit_shortcode_row_open"),document.removeEventListener("click",g,!0))};setTimeout(()=>{document.addEventListener("click",g,{capture:!0,once:!0})},0)}}else if(c(".aipkit_aiform_shortcode_close")){e.preventDefault();let d=c(".aipkit_aiform_shortcode_close").closest(".aipkit_shortcode_configurator");if(d){d.style.display="none";let a=d.closest("tr");a&&a.classList.remove("aipkit_shortcode_row_open")}}else if(t.matches("#aipkit_validate_prompt_btn")||c("#aipkit_validate_prompt_btn"))e.preventDefault(),typeof window.aipkitForms_validatePrompt=="function"&&window.aipkitForms_validatePrompt();else if(t.matches("#aipkit_save_ai_form_btn")||c("#aipkit_save_ai_form_btn")){e.preventDefault();let n=c("#aipkit_save_ai_form_btn");typeof aipkitForms_saveForm=="function"&&aipkitForms_saveForm(n,o)}else if(t.matches("#aipkit_cancel_edit_ai_form_btn")||c("#aipkit_cancel_edit_ai_form_btn"))e.preventDefault(),typeof aipkitForms_hideFormEditor=="function"&&aipkitForms_hideFormEditor(o);else if(t.matches("#aipkit_preview_ai_form_btn")||c("#aipkit_preview_ai_form_btn")){e.preventDefault();let n=s.querySelector("#aipkit_ai_form_id").value;if(!n){alert(i("You must save the form before you can preview it.","gpt3-ai-content-generator"));return}let d=o.querySelector("#aipkit_ai_form_title"),a=d?d.value:"";typeof window.aipkitForms_openPreviewSheet=="function"?window.aipkitForms_openPreviewSheet(n,a,o):console.error("AI Forms Preview: Preview sheet helper not available.")}else if(c(".aipkit_dropped_element_settings_btn")){e.preventDefault();let n=c(".aipkit_dropped_element");n&&typeof aipkitForms_showSettingsPanel=="function"&&aipkitForms_showSettingsPanel(n.id,o)}else if(c(".aipkit_dropped_element_delete_btn")){e.preventDefault();let n=c(".aipkit_dropped_element");n&&confirm(i(r.text.confirmDeleteElement||"Are you sure you want to delete this form element?","gpt3-ai-content-generator"))&&typeof aipkitForms_deleteDroppedElement=="function"&&aipkitForms_deleteDroppedElement(n.id,o)}else if(c(".aipkit_layout_row_delete_btn")){if(e.preventDefault(),confirm(i("Are you sure you want to delete this row and all elements inside it?","gpt3-ai-content-generator"))){let n=c(".aipkit_layout_row");n&&(Array.from(n.querySelectorAll(".aipkit_dropped_element")).map(a=>a.id).includes(window.aipkitAIFormsState.selectedDesignerElementId)&&aipkitForms_hideSettingsPanel(o),n.remove(),window.aipkitForms_updateFormStructureOrder(),window.aipkitForms_updatePromptSnippets(o))}}else if(c("#aipkit_settings_panel_close_btn"))e.preventDefault(),typeof aipkitForms_hideSettingsPanel=="function"&&aipkitForms_hideSettingsPanel(o);else if(c(".aipkit_remove_option_btn")){e.preventDefault();let n=c(".aipkit_select_option_row");n&&(n.remove(),window.aipkitAIFormsState.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(window.aipkitAIFormsState.selectedDesignerElementId,o))}else c("#aipkit_add_select_option_btn")&&(e.preventDefault(),typeof aipkitForms_addSelectOptionRow=="function"&&aipkitForms_addSelectOptionRow(o))}),o.dataset.clickListenerAttached="true")}window.aipkitForms_attachClickEventListeners=k})();(function(){"use strict";let k="aipkit_ai_forms_shortcode_config_v1_";function o(c){if(!c||!window.localStorage)return null;try{let s=window.localStorage.getItem(`${k}${c}`);if(!s)return null;let n=JSON.parse(s);return n&&typeof n=="object"?n:null}catch{return null}}function r(c,s){if(!(!c||!window.localStorage))try{window.localStorage.setItem(`${k}${c}`,JSON.stringify(s))}catch{}}function i(c,s){if(!c)return;let n=s.querySelector(`#aif-configurator-${c}`),d=s.querySelector(`#aif-shortcode-input-${c}`);if(!n||!d)return;let a=n.querySelectorAll(".aipkit-aiform-config-input"),l=[],p={};a.forEach(g=>{let m=g.dataset.attrName;m&&(g.type==="checkbox"?(p[m]=!!g.checked,g.checked&&l.push(`${m}="true"`)):g.type==="select-one"&&(p[m]=g.value,g.value&&g.value!=="light"&&l.push(`${m}="${g.value}"`)))});let _=`[aipkit_ai_form id=${c}`;l.length>0&&(_+=" "+l.join(" ")),_+="]",d.value=_,s.querySelectorAll(`[data-aipkit-shortcode-display="${c}"]`).forEach(g=>{g&&"value"in g&&(g.value=_)}),r(c,p)}function e(c,s){if(!c||!s)return;let n=o(c);if(!n)return;let d=s.querySelector(`#aif-configurator-${c}`);if(!d)return;d.querySelectorAll(".aipkit-aiform-config-input").forEach(l=>{let p=l.dataset.attrName;p&&(l.type==="checkbox"?Object.prototype.hasOwnProperty.call(n,p)&&(l.checked=!!n[p]):l.type==="select-one"&&typeof n[p]=="string"&&(l.value=n[p]))}),i(c,s)}function t(c){c.dataset.changeListenerAttached!=="true"&&(c.addEventListener("change",function(s){let n=s.target;if(n.matches(".aipkit-aiform-config-input")){let d=n.dataset.formId;i(d,c)}else n.id==="aipkit_ai_forms_import_file_input"&&(typeof window.aipkitForms_importForms=="function"&&window.aipkitForms_importForms(n),n.value="")}),c.dataset.changeListenerAttached="true")}window.aipkitForms_attachChangeEventListeners=t,window.aipkitForms_applyStoredShortcodeConfig=e})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState,i=o.querySelector("#aipkit_ai_form_element_settings_panel");if(!i){console.warn("AI Forms Init: Settings panel not found, cannot attach listeners.");return}if(i.dataset.inputListenerAttached==="true")return;let e=()=>{r.selectedDesignerElementId&&typeof aipkitForms_updateElementFromSettingsPanel=="function"&&aipkitForms_updateElementFromSettingsPanel(r.selectedDesignerElementId,o)};i.addEventListener("input",t=>{t.target.matches(".aipkit-setting-field")&&e()}),i.addEventListener("change",t=>{t.target.matches('.aipkit-setting-field[type="checkbox"]')&&e()}),i.dataset.inputListenerAttached="true"}window.aipkitForms_attachSettingsPanelListeners=k})();(function(){"use strict";function k(o){let r=window.aipkitAIFormsState;if(!o){console.error("AI Forms Drag&Drop: formsContainerElement not provided.");return}let i=o.querySelector("#aipkit_ai_form_elements_palette"),e=o.querySelector("#aipkit_ai_form_designer_area");if(!i||!e){console.warn("AI Forms Admin: Drag and drop palette or designer area not found for initDragAndDrop within provided container.");return}if(i.dataset.dragListenersAttached==="true"&&e.dataset.dragListenersAttached==="true")return;i.querySelectorAll(".aipkit_form_element_item").forEach(c=>{c.dataset.dragStartListenerAttached!=="true"&&(c.addEventListener("dragstart",s=>{s.target.classList.add("aipkit-dragging"),r.draggedElement=null,s.target.dataset.layoutType?(r.draggedLayoutType=s.target.dataset.layoutType,r.draggedElementType=null,s.dataTransfer.setData("text/plain",r.draggedLayoutType),s.dataTransfer.effectAllowed="copy"):(r.draggedElementType=s.target.dataset.elementType,r.draggedLayoutType=null,s.dataTransfer.setData("text/plain",r.draggedElementType),s.dataTransfer.effectAllowed="copy")}),c.addEventListener("dragend",s=>{s.target.classList.remove("aipkit-dragging"),r.draggedElementType=null,r.draggedLayoutType=null}),c.dataset.dragStartListenerAttached="true")}),i.dataset.dragListenersAttached="true",e.dataset.dragListenersAttached!=="true"&&(e.addEventListener("dragstart",c=>{let s=c.target.closest(".aipkit_layout_row"),n=c.target.closest(".aipkit_dropped_element");if(s&&c.target.classList.contains("aipkit_layout_row_drag_handle"))r.draggedElement=s,c.dataTransfer.setData("text/row-id",s.id),c.dataTransfer.effectAllowed="move";else if(n&&c.target.classList.contains("aipkit_dropped_element_drag_handle"))r.draggedElement=n,c.dataTransfer.setData("text/element-id",n.id),c.dataTransfer.effectAllowed="move";else return;r.draggedElementType=null,r.draggedLayoutType=null,setTimeout(()=>{r.draggedElement&&r.draggedElement.classList.add("aipkit-row-dragging-source")},0)}),e.addEventListener("dragend",c=>{r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null)}),e.addEventListener("dragover",c=>{c.preventDefault(),e.classList.add("aipkit-drag-over"),r.draggedElement?c.dataTransfer.dropEffect="move":c.dataTransfer.dropEffect="copy"}),e.addEventListener("dragleave",c=>{e.contains(c.relatedTarget)||e.classList.remove("aipkit-drag-over")}),e.addEventListener("drop",c=>{c.preventDefault(),c.stopPropagation(),e.classList.remove("aipkit-drag-over");let s=e.querySelector("#aipkit_form_designer_placeholder");if(r.draggedLayoutType){s&&(s.style.display="none");let n=window.aipkitForms_createNewLayoutData(r.draggedLayoutType);r.formStructure.push(n),window.aipkitForms_renderLayoutRow(e,n,null,o),r.draggedLayoutType=null}else if(r.draggedElement&&r.draggedElement.classList.contains("aipkit_layout_row")){let n=c.target.closest(".aipkit_layout_row");if(n&&n!==r.draggedElement){let d=n.getBoundingClientRect(),l=c.clientY>d.top+d.height/2?n.nextSibling:n;e.insertBefore(r.draggedElement,l)}window.aipkitForms_updateFormStructureOrder()}else if(r.draggedElementType){s&&(s.style.display="none");let n=window.aipkitForms_createNewLayoutData("1-col"),d=window.aipkitForms_createNewFormElementData(r.draggedElementType);n.columns[0].elements.push(d),r.formStructure.push(n),window.aipkitForms_renderLayoutRow(e,n,null,o),r.draggedElementType=null}r.draggedElement&&(r.draggedElement.classList.remove("aipkit-row-dragging-source"),r.draggedElement=null),typeof window.aipkitForms_updatePromptSnippets=="function"&&window.aipkitForms_updatePromptSnippets(o)}),e.dataset.dragListenersAttached="true")}window.aipkitForms_initializeDragAndDrop=k})();(function(){"use strict";function k(o){let r=o.querySelector("#aipkit_ai_forms_settings_form");r&&typeof window.aipkit_initAIFormsTokenManagementUI=="function"?window.aipkit_initAIFormsTokenManagementUI(r):console.error("AI Forms Init: Could not initialize token management UI for settings popover.")}window.aipkitForms_initializeTokenUI=k})();(function(){"use strict";function k(o){let r=(o||document).querySelector("#aipkit_ai_forms_settings_form");if(!r)return;let i="data-aipkit-aiforms-autosave-attached";if(r.getAttribute(i)==="true")return;let e=()=>{typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};r.addEventListener("change",t=>{let c=t.target;if(!c||!c.matches(".aipkit_autosave_trigger"))return;(c.tagName.toLowerCase()==="select"||c.type==="checkbox"||c.type==="range")&&e()}),r.addEventListener("blur",t=>{let c=t.target;if(!c||!c.matches(".aipkit_autosave_trigger"))return;let s=c.tagName.toLowerCase();(s==="input"||s==="textarea")&&c.type!=="range"&&c.type!=="checkbox"&&e()},!0),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),r.setAttribute(i,"true")}window.aipkitForms_initSettingsAutosave=k})();(function(){"use strict";function k(o){if(!o)return;let r="data-accordion-listener-attached";o.getAttribute(r)!=="true"&&(o.addEventListener("click",function(i){let e=i.target.closest(".aipkit_accordion-header");if(!e||!e.closest(".aipkit_ai_forms_container"))return;i.preventDefault();let t=e.closest(".aipkit_accordion-group"),c=e.dataset.aipkitContextAccordion==="1";if(t&&!e.classList.contains("aipkit_active")){let n=t.querySelector(".aipkit_accordion-header.aipkit_active");if(n){n.classList.remove("aipkit_active");let d=n.nextElementSibling;d&&d.classList.remove("aipkit_active")}}let s=e.nextElementSibling;s&&(e.classList.toggle("aipkit_active"),s.classList.toggle("aipkit_active"),c&&s.classList.contains("aipkit_active")&&typeof window.aipkitForms_refreshOpenaiStores=="function"&&window.aipkitForms_refreshOpenaiStores(s))}),o.setAttribute(r,"true"))}window.aipkitForms_initializeAccordions=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(p){return p},o={chat:!0,stream:!0,tools:!0,web_search_plugin:!0,image_input:!0,image_output:!0,image_generation:!0,embeddings:!0};function r(p){if(!p)return o;let _=Array.isArray(window.aipkit_dashboard?.models?.openrouter)?window.aipkit_dashboard.models.openrouter:[],f=String(p).trim().toLowerCase(),g=_.find(m=>(m?.id?String(m.id).trim().toLowerCase():"")===f);return!g||typeof g.capabilities!="object"?o:{...o,...g.capabilities}}function i(p,_,f){return p!=="OpenRouter"||!f?!0:!!r(_)[f]}function e(p,_,f,g){if(!p||!_)return;p.classList.toggle("aipkit_popover_option_row--disabled",f),p.setAttribute("aria-disabled",f?"true":"false"),_.disabled=!!f;let m=p.querySelector(".aipkit_popover_option_label");m&&(m.dataset.defaultTooltip||(m.dataset.defaultTooltip=m.getAttribute("data-tooltip")||""),m.setAttribute("data-tooltip",f&&g||m.dataset.defaultTooltip))}function t(p,_=""){let f=document.getElementById("aipkit_ai_form_ai_model"),g=window.aipkit_dashboard?.models||{};if(!f||!g)return;let m=p.toLowerCase(),u=g[m];(typeof u>"u"||u===null)&&(u=m==="openai"?{}:[]),f.innerHTML="",f.disabled=!1;let h=window.aipkit_dashboard?.recommendedModels?.[m]||[],v=Array.isArray(h)?h:[],S=new Set(v.map(y=>y?.id).filter(Boolean));if(!u||Array.isArray(u)&&u.length===0||!Array.isArray(u)&&Object.keys(u).length===0){let y=new Option("No models found. Sync in main settings.","");f.appendChild(y),f.disabled=!0;return}let q=!1;if(Array.isArray(u)){if(v.length>0){let E=document.createElement("optgroup");E.label=k("Recommended","gpt3-ai-content-generator"),v.forEach(I=>{if(I&&I.id){let w=new Option(I.name||I.id,I.id);I.id===_&&(w.selected=!0,q=!0),E.appendChild(w)}}),E.children.length>0&&f.appendChild(E)}let y=v.length>0?document.createElement("optgroup"):null;y&&(y.label=k("All models","gpt3-ai-content-generator")),u.forEach(E=>{if(E&&E.id&&S.has(E.id))return;let I=new Option(E.name,E.id);E.id===_&&(I.selected=!0,q=!0),y?y.appendChild(I):f.appendChild(I)}),y&&y.children.length>0&&f.appendChild(y)}else{if(v.length>0){let y=document.createElement("optgroup");y.label=k("Recommended","gpt3-ai-content-generator"),v.forEach(E=>{if(E&&E.id){let I=new Option(E.name||E.id,E.id);E.id===_&&(I.selected=!0,q=!0),y.appendChild(I)}}),y.children.length>0&&f.appendChild(y)}Object.keys(u).forEach(y=>{let E=document.createElement("optgroup");E.label=y,u[y].forEach(I=>{if(I&&I.id&&S.has(I.id))return;let w=new Option(I.name,I.id);I.id===_&&(w.selected=!0,q=!0),E.appendChild(w)}),E.children.length>0&&f.appendChild(E)})}if(!q&&_){let y=new Option(`${_} (Manual/Not Synced)`,_,!1,!0);f.insertBefore(y,f.firstChild),y.selected=!0}f.selectedIndex===-1&&f.options.length>0&&(f.options[0].selected=!0),f.options.length||(f.disabled=!0)}function c(p,_){let f=_||document,g=f.querySelector("#aipkit_ai_form_ai_model"),m=g&&g.value||"",u=i(p,m,"web_search_plugin"),h=f.querySelector('input[name="openai_web_search_enabled"]'),v=f.querySelector('input[name="claude_web_search_enabled"]'),S=f.querySelector('input[name="openrouter_web_search_enabled"]'),q=f.querySelector('input[name="google_search_grounding_enabled"]'),y=f.querySelector(".aipkit_ai_form_web_search_row--openai"),E=f.querySelector(".aipkit_ai_form_web_search_row--claude"),I=f.querySelector(".aipkit_ai_form_web_search_row--openrouter"),w=f.querySelector(".aipkit_ai_form_web_search_row--google"),A=f.querySelector(".aipkit_ai_form_openai_web_search_settings"),C=f.querySelector(".aipkit_ai_form_claude_web_search_settings"),b=f.querySelector(".aipkit_ai_form_openrouter_web_search_settings"),x=f.querySelector(".aipkit_ai_form_google_search_grounding_settings"),T=f.querySelector(".aipkit_ai_form_openai_web_search_location_details"),P=f.querySelector(".aipkit_ai_form_claude_web_search_location_details"),H=f.querySelector(".aipkit_ai_form_web_search_empty_state"),O=p==="OpenAI";y&&(y.style.display=O?"block":"none"),!O&&h&&(h.checked=!1);let F=O&&h&&h.checked;A&&(A.style.display=F?"block":"none"),!F&&T?T.style.display="none":F&&typeof window.aipkitForms_toggleOpenAIWebSearchLocationDetails=="function"&&window.aipkitForms_toggleOpenAIWebSearchLocationDetails(f);let M=p==="Claude";E&&(E.style.display=M?"block":"none"),!M&&v&&(v.checked=!1);let B=M&&v&&v.checked;C&&(C.style.display=B?"block":"none"),!B&&P?P.style.display="none":B&&typeof window.aipkitForms_toggleClaudeWebSearchLocationDetails=="function"&&window.aipkitForms_toggleClaudeWebSearchLocationDetails(f);let V=p==="OpenRouter";I&&(I.style.display=V?"block":"none"),!V&&S&&(S.checked=!1);let L=V&&!u;S&&L&&(S.checked=!1),e(I,S,L,k("Selected OpenRouter model does not support web search.","gpt3-ai-content-generator"));let U=V&&u&&S&&S.checked;b&&(b.style.display=U?"block":"none");let W=p==="Google";w&&(w.style.display=W?"block":"none"),!W&&q&&(q.checked=!1);let ee=W&&q&&q.checked;x&&(x.style.display=ee?"block":"none"),ee&&typeof window.aipkitForms_toggleGoogleGroundingDynamicThreshold=="function"&&window.aipkitForms_toggleGoogleGroundingDynamicThreshold(f),H&&(H.style.display=!O&&!M&&!V&&!W?"block":"none")}function s(p){let _=p.querySelector("#aipkit_ai_form_ai_provider"),f=p.querySelector("#aipkit_ai_form_ai_model"),g=p.querySelector(".aipkit_ai_form_reasoning_effort_field"),m=p.querySelector("#aipkit_ai_form_reasoning_effort");if(!_||!f||!g||!m){g&&(g.style.display="none");return}let u=_.value,v=(f.value||"").toLowerCase(),S=v.startsWith("o1")||v.startsWith("o3")||v.startsWith("o4"),q=v.includes("gpt-5");if(!(u==="OpenAI"&&(S||q))){g.style.display="none";return}g.style.display="block";let y=n(v),E=new Set(y.allowed),I=m.value||"";I==="minimal"&&(I="low"),Array.from(m.options).forEach(w=>{let A=E.has(w.value);w.hidden=!A,w.disabled=!A}),E.has(I)||(I=y.defaultValue),E.has(I)||(I=y.allowed[0]||""),I&&(m.value=I)}function n(p){return a(p)?{allowed:["high"],defaultValue:"high"}:p.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:d(p)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function d(p){let _=p.match(/gpt-5\.(\d+)/);if(_)return Number.parseInt(_[1],10)>=2;let f=p.match(/gpt-(\d+)/);return f?Number.parseInt(f[1],10)>=6:!1}function a(p){return/gpt-5(\.\d+)?-pro/.test(p)}function l(p){let _=p.querySelector("#aipkit_ai_form_ai_provider"),f=p.querySelector("#aipkit_ai_form_ai_model");!_||!f||(_.dataset.modelListenerAttached!=="true"&&(_.addEventListener("change",function(){t(this.value),c(this.value,p),s(p)}),_.dataset.modelListenerAttached="true"),f.dataset.reasoningListenerAttached!=="true"&&(f.addEventListener("change",function(){s(p),c(_.value,p)}),f.dataset.reasoningListenerAttached="true"),t(_.value),c(_.value,p),s(p))}window.aipkitForms_initAiConfig=l,window.aipkitForms_populateAiModels=t,window.aipkitForms_updateWebSearchVisibility=c,window.aipkitForms_toggleReasoningEffort=s})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(F){return F},o={loaded:!1,loading:!1},r={saving:!1,queued:null,last:{pinecone_api_key:"",qdrant_url:"",qdrant_api_key:""}},i=()=>{let F=window.wp&&window.wp.i18n?window.wp.i18n:null;return{__:F&&typeof F.__=="function"?F.__:B=>B}},e=()=>{let F=window.aipkit_ai_forms_config||{},M=F.vectorStores?F.vectorStores.openai:[];return Array.isArray(M)?M:[]},t=F=>{window.aipkit_ai_forms_config||(window.aipkit_ai_forms_config={}),window.aipkit_ai_forms_config.vectorStores||(window.aipkit_ai_forms_config.vectorStores={}),window.aipkit_ai_forms_config.vectorStores.openai=F},c=F=>F?F.querySelector('select[name="openai_vector_store_ids[]"]'):null,s=F=>F?Array.from(F.options).some(M=>M.value&&!M.disabled):!1,n=(F,M)=>{let B=F.id||F.vector_store_id||"",L=F.name||F.vector_store_name||""||`Untitled store ${M}`,U=F.file_counts?F.file_counts.total:null,W=" (Files: N/A)";return typeof U=="number"&&(W=` (${U} ${U===1?"File":"Files"})`),{id:B,label:`${L}${W}`}},d=(F,M,B={})=>{if(!F)return;let{__:V}=i(),U=B.preserveSelection===!0?new Set(Array.from(F.selectedOptions||[]).map(ne=>ne.value)):new Set;F.innerHTML="";let W=Array.isArray(M)?M:[],ee=1;if(W.forEach(ne=>{if(!ne||typeof ne!="object")return;let{id:z,label:ge}=n(ne,ee);if(!z)return;let Ae=new Option(k(ge),z);U.has(z)&&(Ae.selected=!0),F.appendChild(Ae),ee+=1}),!F.options.length){let ne=new Option(V("No stores found.","gpt3-ai-content-generator"),"");ne.disabled=!0,F.appendChild(ne)}},a=F=>{F&&typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(F)},l=async(F,M={})=>{let B=c(F);if(!B)return;let{__:V}=i(),L=M.force===!0,U=e();if(U.length&&(!L||!o.loaded)){d(B,U,{preserveSelection:!0}),a(F),o.loaded=!0;return}if(!L&&o.loaded&&s(B)||o.loading)return;let W=document.getElementById("aipkit_vector_store_nonce_openai"),ee=W?W.value:"";if(!ee||typeof window.aipkit_apiRequest!="function")return;o.loading=!0,B.innerHTML="";let ne=new Option(V("Loading vector stores...","gpt3-ai-content-generator"),"");ne.disabled=!0,B.appendChild(ne);try{let z=await window.aipkit_apiRequest("aipkit_list_vector_stores_openai",{_ajax_nonce:ee,limit:100,order:"desc"}),ge=Array.isArray(z.stores)?z.stores:[];t(ge),d(B,ge,{preserveSelection:!0}),a(F),o.loaded=!0}catch(z){let ge=z&&z.message?z.message:V("Unable to load stores.","gpt3-ai-content-generator");B.innerHTML="";let Ae=new Option(ge,"");Ae.disabled=!0,B.appendChild(Ae)}finally{o.loading=!1}},p=F=>{F&&l(F,{force:!0})},_=F=>{if(!F)return null;let M=F.closest(".aipkit_model_settings_popover");return M?M.querySelector(".aipkit_model_settings_popover_header .aipkit_popover_status_inline"):null},f=(F,M,B)=>{let V=_(F);V&&(V.textContent=M||"",V.classList.remove("success","error","loading"),B&&V.classList.add(B),V.style.display=M?"inline-block":"none")},g=(F,M=2500)=>{window.setTimeout(()=>{f(F,"","")},M)},m=F=>F?{pineconeKeyInput:F.querySelector('[name="pinecone_api_key"]'),qdrantUrlInput:F.querySelector('[name="qdrant_url"]'),qdrantKeyInput:F.querySelector('[name="qdrant_api_key"]')}:{},u=F=>{let M=F?.closest("#aipkit_ai_forms_container"),B=M?M.dataset:{},{pineconeKeyInput:V,qdrantUrlInput:L,qdrantKeyInput:U}=m(F),W=V?.value.trim(),ee=L?.value.trim(),ne=U?.value.trim(),z=!!(W||B?.pineconeApiKeySet==="true"),ge=!!(ee||B?.qdrantUrlSet==="true")&&!!(ne||B?.qdrantApiKeySet==="true");return{pinecone:z,qdrant:ge}},h=(F,M)=>F?typeof window.aipkit_queueProviderSync=="function"?window.aipkit_queueProviderSync(F,{silent:!0,showErrors:!1,targetSelectId:M,propagateError:!0}):typeof window.aipkit_syncModels=="function"?window.aipkit_syncModels(null,F,{silent:!0,showErrors:!1,targetSelectId:M,propagateError:!0}):null:null,v=(F,M,B)=>{if(!M)return;f(F,"Syncing...","loading");let V=h(M,B);if(V&&typeof V.then=="function"){V.then(()=>{f(F,"Synced","success"),g(F)}).catch(L=>{f(F,`Error: ${L?.message||"Sync failed."}`,"error")});return}g(F)},S=(F,M)=>{if(!F||!M)return;if(M==="openai"){l(F);return}let B=u(F);M==="pinecone"&&B.pinecone?v(F,"PineconeIndexes","aipkit_ai_form_pinecone_index_name"):M==="qdrant"&&B.qdrant&&v(F,"QdrantCollections","aipkit_ai_form_qdrant_collection_name")},q=(F,M)=>{!M||!Object.keys(M).length||typeof window.aipkit_apiRequest=="function"&&(r.saving=!0,f(F,"Saving...","loading"),window.aipkit_apiRequest("aipkit_save_ai_settings",M).then(B=>{Object.keys(M).forEach(L=>{r.last[L]=M[L]});let V=F.closest("#aipkit_ai_forms_container");V&&(Object.prototype.hasOwnProperty.call(M,"pinecone_api_key")&&(V.dataset.pineconeApiKeySet=M.pinecone_api_key?"true":"false"),Object.prototype.hasOwnProperty.call(M,"qdrant_url")&&(V.dataset.qdrantUrlSet=M.qdrant_url?"true":"false"),Object.prototype.hasOwnProperty.call(M,"qdrant_api_key")&&(V.dataset.qdrantApiKeySet=M.qdrant_api_key?"true":"false")),Object.prototype.hasOwnProperty.call(M,"pinecone_api_key")&&S(F,"pinecone"),(Object.prototype.hasOwnProperty.call(M,"qdrant_url")||Object.prototype.hasOwnProperty.call(M,"qdrant_api_key"))&&S(F,"qdrant"),f(F,B.message||"Saved","success"),g(F)}).catch(B=>{f(F,`Error: ${B?.message||"Failed to save."}`,"error")}).finally(()=>{if(r.saving=!1,r.queued){let B=r.queued;r.queued=null,q(F,B)}}))},y=(F,M)=>{if(!M)return;let B=Object.keys(M).reduce((V,L)=>(M[L]!==r.last[L]&&(V[L]=M[L]),V),{});if(Object.keys(B).length){if(r.saving){r.queued={...r.queued||{},...B};return}q(F,B)}},E=F=>{if(!F)return;let M=F.querySelector(".aipkit_vector_store_enable_select"),B=F.querySelector(".aipkit_vector_store_settings_conditional_row"),V=F.querySelector(".aipkit_vector_store_provider_select"),L=F.querySelector(".aipkit_vector_store_openai_field"),U=F.querySelector(".aipkit_vector_store_pinecone_field"),W=F.querySelector(".aipkit_vector_store_pinecone_key_field"),ee=F.querySelector(".aipkit_vector_store_qdrant_field"),ne=F.querySelector(".aipkit_vector_store_qdrant_url_field"),z=F.querySelector(".aipkit_vector_store_qdrant_key_field"),ge=F.querySelector(".aipkit_vector_store_embedding_config_row");if(!M||!B||!V)return;let Ae=M.tagName==="SELECT"?M.value==="1":M.checked;if(B.style.display=Ae?"block":"none",!Ae){[L,U,W,ee,ne,z,ge].forEach(ze=>{ze&&(ze.style.display="none")});return}let ot=V.value||"openai";L&&(L.style.display=ot==="openai"?"block":"none"),U&&(U.style.display=ot==="pinecone"?"block":"none"),W&&(W.style.display=ot==="pinecone"?"block":"none"),ee&&(ee.style.display=ot==="qdrant"?"block":"none"),ne&&(ne.style.display=ot==="qdrant"?"block":"none"),z&&(z.style.display=ot==="qdrant"?"block":"none"),ge&&(ge.style.display=ot==="pinecone"||ot==="qdrant"?"block":"none"),ot==="openai"&&(l(F),a(F))},I=F=>{let M=(F||"").split("::"),B=M.shift()||"",V=M.join("::")||"";return{provider:B,model:V}},w=(F,M)=>!F||!M?"":`${F}::${M}`,A=(F,M,B)=>{if(!F||!M||!B)return;let V=w(M,B);if(!V)return;let L=typeof CSS<"u"&&CSS.escape?CSS.escape(V):V.replace(/"/g,'\\"');if(F.querySelector(`option[value="${L}"]`))return;let U=document.createElement("option");U.value=V,U.dataset.provider=M,U.textContent=`${B} (Manual)`,F.appendChild(U)},C=(F,M)=>{if(!F)return;let B=M||F.querySelector(".aipkit_vector_embedding_select");if(!B)return;let V=F.querySelector('select[name="vector_embedding_provider"]'),L=F.querySelector('select[name="vector_embedding_model"]'),U=V?V.value:"",W=L?L.value:"",ee=w(U,W);if(ee){A(B,U,W),B.value=ee;return}B.value=""},b=(F,M)=>{if(!M||!F)return;let B=M.querySelector('select[name="vector_embedding_provider"]'),V=M.querySelector('select[name="vector_embedding_model"]'),{provider:L,model:U}=I(F.value);B&&(B.value=L),B&&V&&typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(M),V&&(V.value=U)};function x(F){let M=F.querySelector(".aipkit_vector_embedding_provider_select"),B=F.querySelector(".aipkit_vector_embedding_model_select"),L=(window.aipkit_ai_forms_config||{}).embeddingModels||{};if(!M||!B||!L)return;let W=M.value.toLowerCase(),ee=L[W]||[];B.innerHTML="",B.appendChild(new Option(`-- Select ${M.options[M.selectedIndex]?.text||""} Model --`,"")),ee&&Array.isArray(ee)&&ee.length>0?(ee.forEach(ne=>{B.appendChild(new Option(k(ne.name),ne.id))}),B.disabled=!1):(B.appendChild(new Option("(No models found - Sync in Settings)","")),B.disabled=!0)}function T(F){let M=F||document,B=M.querySelector(".aipkit_ai_form_openai_web_search_loc_type_select"),V=M.querySelector(".aipkit_ai_form_openai_web_search_location_details");if(!B||!V)return;let L=B.value==="approximate";V.style.display=L?"block":"none"}function P(F){let M=F||document,B=M.querySelector(".aipkit_ai_form_claude_web_search_loc_type_select"),V=M.querySelector(".aipkit_ai_form_claude_web_search_location_details");if(!B||!V)return;let L=B.value==="approximate";V.style.display=L?"block":"none"}function H(F){let M=F||document,B=M.querySelector(".aipkit_ai_form_google_grounding_mode_select"),V=M.querySelector(".aipkit_ai_form_google_grounding_dynamic_threshold_container");if(!B||!V)return;let L=B.value==="MODE_DYNAMIC";V.style.display=L?"block":"none"}function O(F){let M=F.querySelector("#aipkit_form_editor_container");if(!M)return;let B=M.querySelector("#aipkit_ai_form_settings_popover");if(!B)return;let V=B.querySelector('[data-aipkit-settings-panel="context"]'),L=B.querySelector('[data-aipkit-settings-panel="tools"]');if(!V)return;let U=M.querySelector("#aipkit_ai_form_ai_provider"),W=m(V);r.last={pinecone_api_key:W.pineconeKeyInput?.value||"",qdrant_url:W.qdrantUrlInput?.value||"",qdrant_api_key:W.qdrantKeyInput?.value||""};let ee="data-vector-config-listener-attached";if(V.getAttribute(ee)!=="true"&&(V.addEventListener("change",ne=>{let z=ne.target;if(z){if(z.matches('[name="pinecone_api_key"]')||z.matches('[name="qdrant_url"]')||z.matches('[name="qdrant_api_key"]')){y(V,{[z.name]:z.value||""});return}if(z.matches(".aipkit_vector_store_enable_select")||z.matches(".aipkit_vector_store_provider_select")){E(V);let ge=V.querySelector(".aipkit_vector_store_provider_select"),Ae=ge?ge.value:"";S(V,Ae);return}if(z.matches(".aipkit_vector_embedding_select")){b(z,V);return}if(z.matches(".aipkit_vector_embedding_provider_select")||z.matches(".aipkit_vector_embedding_model_select")){typeof window.aipkitForms_populateVectorEmbeddingModels=="function"&&window.aipkitForms_populateVectorEmbeddingModels(V),C(V);return}z.matches('select[name="openai_vector_store_ids[]"]')&&a(V)}}),V.addEventListener("input",ne=>{let z=ne.target;if(z){if(z.matches("#aipkit_ai_form_vector_store_top_k")){let ge=V.querySelector("#aipkit_ai_form_vector_store_top_k_value");ge&&(ge.textContent=z.value)}else if(z.matches("#aipkit_ai_form_vector_store_confidence_threshold")){let ge=V.querySelector("#aipkit_ai_form_vector_store_confidence_threshold_value");ge&&(ge.textContent=z.value+"%")}}}),V.setAttribute(ee,"true")),L){let ne="data-tools-config-listener-attached";L.getAttribute(ne)!=="true"&&(L.addEventListener("change",z=>{let ge=z.target;if(ge.matches(".aipkit_ai_form_openai_web_search_toggle")||ge.matches(".aipkit_ai_form_claude_web_search_toggle")||ge.matches(".aipkit_ai_form_openrouter_web_search_toggle")||ge.matches(".aipkit_ai_form_google_search_grounding_toggle")){if(typeof window.aipkitForms_updateWebSearchVisibility=="function"){let Ae=U?U.value:"";window.aipkitForms_updateWebSearchVisibility(Ae,M)}}else ge.matches(".aipkit_ai_form_openai_web_search_loc_type_select")?T(L):ge.matches(".aipkit_ai_form_claude_web_search_loc_type_select")?P(L):ge.matches(".aipkit_ai_form_google_grounding_mode_select")&&H(L)}),L.addEventListener("input",z=>{let ge=z.target;if(ge.matches("#aipkit_ai_form_google_grounding_dynamic_threshold")){let Ae=L.querySelector("#aipkit_ai_form_google_grounding_dynamic_threshold_value");Ae&&(Ae.textContent=parseFloat(ge.value).toFixed(2))}}),L.setAttribute(ne,"true"))}typeof window.aipkitForms_updateWebSearchVisibility=="function"&&U&&window.aipkitForms_updateWebSearchVisibility(U.value,M),E(V),x(V),C(V),a(V)}window.aipkitForms_initVectorConfig=O,window.aipkitForms_populateVectorEmbeddingModels=x,window.aipkitForms_toggleOpenAIWebSearchLocationDetails=T,window.aipkitForms_toggleClaudeWebSearchLocationDetails=P,window.aipkitForms_toggleGoogleGroundingDynamicThreshold=H,window.aipkitForms_refreshOpenaiStores=p,window.aipkitForms_syncEmbeddingSelectFromInputs=C})();(function(){"use strict";function k(r,i,e,t){let c=window.aipkitAIFormsState,s=document.createElement("div");s.className="aipkit_layout_row",s.id=i.internalId;let n=`
            <div class="aipkit_layout_row_controls">
                <span class="dashicons dashicons-move aipkit_layout_row_drag_handle" title="Drag to re-order row" draggable="true"></span>
                <span class="dashicons dashicons-trash aipkit_layout_row_delete_btn" title="Delete row"></span>
            </div>
        `,d=document.createElement("div");d.className="aipkit_layout_row_columns_container",i.columns.forEach(a=>{let l=document.createElement("div");l.className="aipkit_layout_column",l.id=a.internalId,l.style.flexBasis=a.width,o(l,t),a.elements.forEach(p=>{window.aipkitForms_renderFieldInColumn(l,p)}),d.appendChild(l)}),s.innerHTML=n,s.appendChild(d),e?r.insertBefore(s,e):r.appendChild(s)}function o(r,i){let e=window.aipkitAIFormsState;r.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),r.classList.add("aipkit-drag-over"),(e.draggedElement||e.draggedElementType)&&(t.dataTransfer.dropEffect=e.draggedElement?"move":"copy")}),r.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation(),r.classList.remove("aipkit-drag-over")}),r.addEventListener("drop",t=>{if(t.preventDefault(),r.classList.remove("aipkit-drag-over"),e.draggedElementType||e.draggedElement&&e.draggedElement.classList.contains("aipkit_dropped_element")){t.stopPropagation();let c=r.id;if(e.draggedElementType){let s=window.aipkitForms_createNewFormElementData(e.draggedElementType);e.formStructure.forEach(n=>{let d=n.columns.find(a=>a.internalId===c);d&&d.elements.push(s)}),window.aipkitForms_renderFieldInColumn(r,s,null,i)}else e.draggedElement&&(r.appendChild(e.draggedElement),window.aipkitForms_updateFormStructureOrder());e.draggedElementType=null,e.draggedElement&&(e.draggedElement.classList.remove("aipkit-row-dragging-source"),e.draggedElement=null)}})}window.aipkitForms_renderLayoutRow=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_ai_form_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),t=r.querySelector(".aipkit_model_settings_popover_back"),c=o.querySelector("#aipkit_ai_form_settings_trigger"),s={root:r.dataset.titleRoot||"Settings",parameters:r.dataset.titleParameters||"Parameters",context:r.dataset.titleContext||"Context",tools:r.dataset.titleTools||"Tools"},n=null,d=a=>{let l=a||"root",p=r.querySelector(`[data-aipkit-settings-panel="${l}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!p)return;let _=p.dataset.aipkitSettingsPanel||"root";_!==n&&(i.forEach(f=>{f.hidden=f!==p}),e&&(e.textContent=s[_]||s.root),t&&(t.hidden=_==="root"),n=_,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",a=>{let l=a.target.closest("[data-aipkit-panel-target]");if(!l)return;a.preventDefault();let p=l.dataset.aipkitPanelTarget;d(p)}),t&&t.addEventListener("click",a=>{a.preventDefault(),d("root")}),c&&c.addEventListener("click",()=>{d("root")}),d("root"),r.dataset.panelsBound="true"}window.aipkitForms_initEditorSettingsPopover=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_form_editor_container");if(!r)return;let i=r.querySelector("#aipkit_ai_form_prompt_template"),e=r.querySelector(".aipkit_ai_form_prompt_expand"),t=document.getElementById("aipkit_ai_form_prompt_modal");if(!i||!e||!t)return;let c=t.querySelector(".aipkit_ai_form_prompt_modal_textarea"),s=t.querySelector(".aipkit_ai_form_prompt_count"),n=t.querySelector(".aipkit_ai_form_prompt_modal_close");if(t.dataset.bound==="1")return;let d=_=>{s&&(s.textContent=`${_.length.toLocaleString()} characters`)},a=_=>{c&&(c.value=_,d(_))},l=()=>{c&&(a(i.value||""),t.classList.add("aipkit-active"),t.setAttribute("aria-hidden","false"),setTimeout(()=>c.focus(),0))},p=_=>{if(t.classList.remove("aipkit-active"),t.setAttribute("aria-hidden","true"),!_||!c)return;let f=c.value;f!==i.value&&(i.value=f,i.dispatchEvent(new Event("input",{bubbles:!0})))};e.addEventListener("click",_=>{_.preventDefault(),l()}),n&&n.addEventListener("click",()=>{p(!0)}),document.addEventListener("keydown",_=>{_.key==="Escape"&&t.classList.contains("aipkit-active")&&p(!0)}),c&&c.dataset.bound!=="1"&&(c.addEventListener("input",()=>{d(c.value)}),c.dataset.bound="1"),t.dataset.bound="1"}window.aipkitForms_initPromptModal=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.querySelector("#aipkit_ai_forms_settings_popover");if(!r)return;let i=Array.from(r.querySelectorAll("[data-aipkit-settings-panel]"));if(!i.length||r.dataset.panelsBound==="true")return;let e=r.querySelector(".aipkit_model_settings_popover_title"),t=r.querySelector(".aipkit_model_settings_popover_back"),c=r.querySelector(".aipkit_model_settings_popover_footer"),s=o.querySelector("#aipkit_ai_forms_settings_trigger"),n={root:r.dataset.titleRoot||"Settings",limits:r.dataset.titleLimits||"Limits","custom-css":r.dataset.titleCustomCss||"Custom CSS","provider-filtering":r.dataset.titleProviderFiltering||"Provider Filtering"},d=null,a=l=>{let p=l||"root",_=r.querySelector(`[data-aipkit-settings-panel="${p}"]`)||r.querySelector('[data-aipkit-settings-panel="root"]');if(!_)return;let f=_.dataset.aipkitSettingsPanel||"root";f!==d&&(i.forEach(g=>{g.hidden=g!==_}),e&&(e.textContent=n[f]||n.root),t&&(t.hidden=f==="root"),c&&(c.hidden=f==="root"),f==="limits"&&typeof window.aipkitForms_initializeTokenUI=="function"&&window.aipkitForms_initializeTokenUI(o),d=f,r.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))};r.addEventListener("click",l=>{let p=l.target.closest("[data-aipkit-panel-target]");if(!p)return;l.preventDefault();let _=p.dataset.aipkitPanelTarget;a(_)}),t&&t.addEventListener("click",l=>{l.preventDefault(),a("root")}),s&&s.addEventListener("click",()=>{a("root")}),a("root"),r.dataset.panelsBound="true"}window.aipkitForms_initSettingsPopoverPanels=k})();(function(){"use strict";let k=[{key:"openai",label:"OpenAI"},{key:"google",label:"Google"},{key:"claude",label:"Claude"},{key:"openrouter",label:"OpenRouter"},{key:"azure",label:"Azure",keepWhenEmpty:!0,emptyMessage:"No Azure deployments found. Sync Azure models in main settings first."},{key:"ollama",label:"Ollama",requiresPro:!0},{key:"deepseek",label:"DeepSeek"}],o=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:s=>s,r=()=>typeof wp<"u"&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(s,n)=>s.replace("%d",n),i=s=>{if(!s)return null;if(typeof s=="string")return{id:s,name:s};if(typeof s=="object"){let n=s.id||s.name||"";return n?{id:n,name:s.name||s.id||n}:null}return null},e=s=>{if(!s)return null;if(Array.isArray(s))return s.map(i).filter(Boolean);if(typeof s=="object"){let n={};return Object.keys(s).forEach(d=>{let l=(Array.isArray(s[d])?s[d]:[]).map(i).filter(Boolean);l.length&&(n[d]=l)}),n}return null},t=s=>s?Array.isArray(s)?s.length>0:Object.keys(s).length>0:!1;function c(s){let n=s||document,d=n.querySelector("#aipkit_ai_forms_models_selector");if(!d||d.dataset.enhanced==="true")return;let a=n.querySelector("#aipkit_aiforms_frontend_models"),l=n.querySelector("#aipkit_aiforms_frontend_providers");if(!a||!l)return;let p=o(),_=r(),g=(d.dataset.initialValue||a.value||"").split(",").map(w=>w.trim()).filter(Boolean),m=new Set(g),u=window.aipkit_dashboard||{},h=u.models||{},v=!!u.isProPlan,S=k.filter(w=>!w.requiresPro||v).map(w=>({...w,models:e(h[w.key])})).filter(w=>w.keepWhenEmpty||t(w.models));d.innerHTML="",d.classList.add("aipkit_models_selector--ready");let q=document.createElement("input");q.type="search",q.placeholder=p("Filter models...","gpt3-ai-content-generator"),q.className="aipkit_models_selector-search",d.appendChild(q);let y=document.createElement("div");y.className="aipkit_models_selector-summary",d.appendChild(y);let E=document.createElement("div");E.className="aipkit_models_selector-providers",d.appendChild(E);let I=w=>{let A=Array.from(d.querySelectorAll('.aipkit_models_selector-item input[type="checkbox"]:checked')),C=A.map(T=>T.value.trim()).filter(Boolean),b=new Set;A.forEach(T=>{T.dataset.providerName&&b.add(T.dataset.providerName)});let x=C.length?S.map(T=>T.label).filter(T=>b.has(T)).join(", "):"";a.value=C.join(", "),l.value=x,C.length===0?y.textContent=p("Showing all models (none selected)","gpt3-ai-content-generator"):C.length===1?y.textContent=p("1 model selected","gpt3-ai-content-generator"):y.textContent=_(p("%d models selected","gpt3-ai-content-generator"),C.length),w&&typeof window.aipkitForms_handleSettingsAutosave=="function"&&window.aipkitForms_handleSettingsAutosave()};S.forEach(w=>{let A=document.createElement("div");A.className="aipkit_models_selector-provider",A.dataset.provider=w.key;let C=document.createElement("div");C.className="aipkit_models_selector-provider-header",C.innerHTML=`<strong>${w.label}</strong>`;let b=document.createElement("div");b.className="aipkit_models_selector-provider-actions";let x=document.createElement("button");x.type="button",x.className="aipkit_btn aipkit_btn-xs",x.textContent=p("All","gpt3-ai-content-generator");let T=document.createElement("button");T.type="button",T.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",T.textContent=p("None","gpt3-ai-content-generator"),b.appendChild(x),b.appendChild(T),C.appendChild(b),A.appendChild(C);let P=document.createElement("div");P.className="aipkit_models_selector-models";let H=O=>{if(!O||!O.id)return;let F=document.createElement("label");F.className="aipkit_models_selector-item",F.title=O.id;let M=document.createElement("input");M.type="checkbox",M.value=O.id,M.checked=m.has(O.id),M.dataset.providerName=w.label,M.addEventListener("change",()=>I(!0));let B=document.createElement("span");B.textContent=O.name||O.id,F.appendChild(M),F.appendChild(B),P.appendChild(F)};if(Array.isArray(w.models)?w.models.forEach(O=>H(O)):w.models&&typeof w.models=="object"&&Object.keys(w.models).forEach(O=>{let F=w.models[O]||[];if(!F.length)return;let M=document.createElement("div");M.className="aipkit_models_selector-subgroup",M.textContent=O.charAt(0).toUpperCase()+O.slice(1),P.appendChild(M),F.forEach(B=>H(B))}),!t(w.models)){let O=document.createElement("div");O.className="aipkit_models_selector-empty",O.textContent=p(w.emptyMessage||"No models found.","gpt3-ai-content-generator"),P.appendChild(O)}x.addEventListener("click",()=>{P.querySelectorAll('input[type="checkbox"]').forEach(O=>{O.checked=!0}),I(!0)}),T.addEventListener("click",()=>{P.querySelectorAll('input[type="checkbox"]').forEach(O=>{O.checked=!1}),I(!0)}),A.appendChild(P),E.appendChild(A)}),q.addEventListener("input",()=>{let w=q.value.toLowerCase();E.querySelectorAll(".aipkit_models_selector-provider").forEach(A=>{let C=!1;A.querySelectorAll(".aipkit_models_selector-item").forEach(b=>{let T=b.textContent.toLowerCase().includes(w);b.style.display=T?"":"none",T&&(C=!0)}),A.style.display=C||w===""?"":"none"})}),I(!1),typeof window.aipkitForms_updateSettingsAutosaveBaseline=="function"&&window.aipkitForms_updateSettingsAutosaveBaseline(),d.dataset.enhanced="true"}window.aipkitForms_initAllowedModelsSelector=c})();(function(){"use strict";let k=window.wp?.i18n?.__||function(E){return E},o="#aipkit_ai_forms_container #aipkit_ai_form_ai_provider, #aipkit_ai_forms_container #aipkit_ai_form_ai_model, #aipkit_ai_forms_container #aipkit_ai_form_vector_store_provider",r=null,i=null,e=!1,t=E=>!!(E&&(E.id==="aipkit_ai_form_ai_provider"||E.id==="aipkit_ai_form_vector_store_provider")),c=E=>!!(E&&t(E)),s=(E,I)=>{if(!E)return!1;let w=n(I);return w?["openai","openrouter","google","azure","claude","deepseek","ollama","pinecone","qdrant"].includes(w):!1},n=E=>String(E||"").trim().toLowerCase(),d=(E,I,w)=>{if(!E)return;let A="aipkit_settings_select_picker_icon--";E.classList.forEach(x=>{x.startsWith(A)&&E.classList.remove(x)});let C=n(w),b=s(I,C);E.hidden=!b,b&&E.classList.add(`${A}${C}`)},a=E=>{if(!E)return"";let I=E.getAttribute("data-aipkit-picker-title");if(I)return I;let w=E.id&&document.querySelector(`label[for="${E.id}"]`)||E.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return w?w.textContent.trim():""},l=E=>{if(!E)return"";let I=E.selectedOptions&&E.selectedOptions.length?E.selectedOptions[0]:E.querySelector("option[selected]");if(I)return I.textContent.trim();let w=E.querySelector("option");return w?w.textContent.trim():""},p=E=>({buttonId:`${E}_picker_btn`,labelId:`${E}_picker_label`,popoverId:`${E}_picker_popover`,titleId:`${E}_picker_title`,searchId:`${E}_picker_search`,listId:`${E}_picker_list`}),_=(E,I)=>{if(!E||!E.id||!I)return null;let w=p(E.id),A=document.getElementById(w.buttonId);if(!A){if(A=document.createElement("button"),A.type="button",A.id=w.buttonId,A.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",A.setAttribute("data-aipkit-popover-target",w.popoverId),A.setAttribute("aria-controls",w.popoverId),A.setAttribute("aria-expanded","false"),A.dataset.aipkitPopoverPlacement="bottom",t(E)){A.classList.add("aipkit_settings_select_picker_btn--provider");let T=document.createElement("span");T.className="aipkit_settings_select_picker_icon",T.setAttribute("aria-hidden","true"),d(T,E,E.value),A.appendChild(T)}let b=document.createElement("span");b.className="aipkit_settings_select_picker_label",b.id=w.labelId,b.textContent=l(E)||k("Select","gpt3-ai-content-generator");let x=document.createElement("span");x.className="dashicons dashicons-arrow-down-alt2",x.setAttribute("aria-hidden","true"),A.appendChild(b),A.appendChild(x),E.insertAdjacentElement("beforebegin",A)}E.classList.contains("screen-reader-text")||E.classList.add("screen-reader-text");let C=document.getElementById(w.popoverId);if(!C){C=document.createElement("div"),C.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",C.id=w.popoverId,C.setAttribute("aria-hidden","true"),t(E)&&C.classList.add("aipkit_settings_select_picker_popover--provider");let b=document.createElement("div");b.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",b.setAttribute("role","dialog"),b.setAttribute("aria-labelledby",w.titleId);let x=document.createElement("div");x.className="aipkit_model_settings_popover_header";let T=document.createElement("span");T.className="aipkit_model_settings_popover_title",T.id=w.titleId,T.textContent=a(E)||k("Select","gpt3-ai-content-generator");let P=document.createElement("button");P.type="button",P.className="aipkit_model_settings_popover_close",P.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),P.innerHTML='<span class="dashicons dashicons-no-alt"></span>',x.appendChild(T),x.appendChild(P);let H=document.createElement("div");H.className="aipkit_model_settings_popover_body";let O=document.createElement("div");O.className="aipkit_settings_select_picker_search";let F=document.createElement("input");F.type="search",F.id=w.searchId,F.className="aipkit_form-input";let M=a(E),B=M?`Search ${M.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");F.setAttribute("placeholder",B),O.appendChild(F);let V=document.createElement("div");V.className="aipkit_settings_select_picker_list",V.id=w.listId,V.setAttribute("role","listbox"),H.appendChild(O),H.appendChild(V),b.appendChild(x),b.appendChild(H),C.appendChild(b),I.appendChild(C),c(E)&&(O.style.display="none")}return{ids:w,button:A,popover:C,label:document.getElementById(w.labelId),search:document.getElementById(w.searchId),list:document.getElementById(w.listId)}},f=E=>{let I=[];return E&&Array.from(E.children).forEach(A=>{if(A.tagName==="OPTGROUP"){let C=Array.from(A.children).filter(b=>b.tagName==="OPTION").map(b=>({value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}));I.push({label:A.label,options:C})}else A.tagName==="OPTION"&&I.push({label:"",options:[{value:A.value,label:A.textContent.trim(),disabled:A.disabled,selected:A.selected}]})}),I},g=(E,I,w="")=>{if(!E||!I)return;I.innerHTML="";let A=f(E),C=w.trim().toLowerCase(),b=!1;if(A.forEach(x=>{let T=x.options.filter(P=>C?P.label.toLowerCase().includes(C):!0);if(T.length){if(x.label){let P=document.createElement("div");P.className="aipkit_settings_select_picker_group_label",P.textContent=x.label,I.appendChild(P)}T.forEach(P=>{let H=document.createElement("button");if(H.type="button",H.className="aipkit_settings_select_picker_item",P.disabled&&H.classList.add("is-disabled"),P.selected&&H.classList.add("is-active"),H.dataset.value=P.value,t(E)&&s(E,P.value)){let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),d(M,E,P.value),H.appendChild(M)}let O=document.createElement("span");O.className="aipkit_settings_select_picker_text",O.textContent=P.label||P.value;let F=document.createElement("span");F.className="dashicons dashicons-yes aipkit_settings_select_picker_check",F.setAttribute("aria-hidden","true"),H.appendChild(O),H.appendChild(F),I.appendChild(H),b=!0})}}),!b){let x=document.createElement("div");x.className="aipkit_settings_select_picker_empty",x.textContent=k(C?"No matches found.":"No options available.","gpt3-ai-content-generator"),I.appendChild(x)}},m=(E,I)=>{if(!E||!I)return;let w=l(E);if(I.textContent=w||k("Select","gpt3-ai-content-generator"),t(E)){let A=I.closest("button"),C=A?A.querySelector(".aipkit_settings_select_picker_icon"):null;d(C,E,E.value)}},u=(E,I)=>{if(!E||!I)return;let w=E.getBoundingClientRect(),A=I.getBoundingClientRect(),C=A.width||320,b=A.height||0,x=window.innerWidth,T=window.innerHeight,P=12;if(E.dataset.aipkitPopoverPlacement==="bottom"){let F=w.left;F+C>x-P&&(F=w.right-C),F=Math.max(P,Math.min(F,x-C-P));let M=w.bottom+8;M+b>T-P&&(M=w.top-b-8),M=Math.max(P,Math.min(M,T-b-P)),I.style.left=`${Math.round(F)}px`,I.style.top=`${Math.round(M)}px`;return}let H=w.right+10;H+C>x-P&&(H=w.left-C-10),H=Math.max(P,Math.min(H,x-C-P));let O=w.top;O+b>T-P&&(O=T-b-P),O=Math.max(P,O),I.style.left=`${Math.round(H)}px`,I.style.top=`${Math.round(O)}px`},h=()=>{!r||!i||e||(e=!0,window.requestAnimationFrame(()=>{let E=r.querySelector(".aipkit_model_settings_popover_panel");u(i,E),e=!1}))},v=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},S=(E,I,w)=>{if(!E||!I)return;r&&r!==I&&v(),r=I,i=E,I.classList.add("aipkit-active"),I.setAttribute("aria-hidden","false"),E.setAttribute("aria-expanded","true");let A=I.querySelector(".aipkit_settings_select_picker_search input"),C=I.querySelector(".aipkit_settings_select_picker_list");C&&g(w,C,A?A.value:""),A&&A.offsetParent!==null&&(A.focus(),A.select());let b=I.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(E,b)})},q=(E,I)=>{if(!E||!I)return;let{button:w,popover:A,list:C,search:b}=I;if(w&&w.dataset.pickerListenerAttached!=="true"&&(w.addEventListener("click",x=>{if(x.preventDefault(),r===A){v();return}S(w,A,E)}),w.dataset.pickerListenerAttached="true"),A&&A.dataset.overlayListenerAttached!=="true"){A.addEventListener("click",T=>{T.target===A&&v()});let x=A.querySelector(".aipkit_model_settings_popover_close");x&&x.addEventListener("click",T=>{T.preventDefault(),v()}),A.dataset.overlayListenerAttached="true"}if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",x=>{let T=x.target.closest(".aipkit_settings_select_picker_item");if(!T||T.classList.contains("is-disabled"))return;let P=T.dataset.value??"";E.value=P,E.dispatchEvent(new Event("change",{bubbles:!0})),m(E,I.label),g(E,C,b?b.value:""),v()}),C.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("input",()=>{g(E,C,b.value)}),b.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerListenerAttached!=="true"&&(E.addEventListener("change",()=>{m(E,I.label),g(E,C,b?b.value:"")}),E.dataset.pickerListenerAttached="true"),E&&E.dataset.pickerObserverAttached!=="true"){let x=!1;new MutationObserver(()=>{x||(x=!0,window.requestAnimationFrame(()=>{m(E,I.label),g(E,C,b?b.value:""),x=!1}))}).observe(E,{childList:!0,subtree:!0}),E.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitAiFormsPickerEscapeBound||(document.addEventListener("keydown",x=>{x.key==="Escape"&&r&&v()}),document.body.dataset.aipkitAiFormsPickerEscapeBound="true"),document.body.dataset.aipkitAiFormsPickerRepositionBound||(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),document.body.dataset.aipkitAiFormsPickerRepositionBound="true")};function y(E){let I=E||document.getElementById("aipkit_ai_forms_container");if(!I)return;let w=I.querySelectorAll(o);w.length&&w.forEach(A=>{if(!A.id||A.dataset.aipkitPickerInit==="true")return;let C=_(A,I);C&&(m(A,C.label),g(A,C.list,C.search?C.search.value:""),q(A,C),A.dataset.aipkitPickerInit="true")})}window.aipkitForms_initSelectPickers=y,window.aipkitForms_refreshSelectPickers=function(E){let I=E||document.getElementById("aipkit_ai_forms_container");if(!I)return;let w=I.querySelectorAll(o);w.length&&w.forEach(A=>{if(!A.id)return;let C=_(A,I);C&&(m(A,C.label),g(A,C.list,C.search?C.search.value:""),q(A,C),A.dataset.aipkitPickerInit="true")})}})();(function(){"use strict";let k={css:new Set,js:new Set},o=()=>{let l=typeof wp<"u"&&wp.i18n?wp.i18n:null;return{__:l&&typeof l.__=="function"?l.__:p=>p}},r=window.aipkit_escapeHtml||(l=>l),i=l=>{if(!l||k.css.has(l))return;if(document.querySelector(`link[href="${l}"]`)){k.css.add(l);return}let p=document.createElement("link");p.rel="stylesheet",p.href=l,document.head.appendChild(p),k.css.add(l)},e=l=>!l||k.js.has(l)?Promise.resolve():new Promise((p,_)=>{if(document.querySelector(`script[src="${l}"]`)){k.js.add(l),p();return}let f=document.createElement("script");f.src=l,f.async=!0,f.onload=()=>{k.js.add(l),p()},f.onerror=()=>_(new Error(`Failed to load script: ${l}`)),document.body.appendChild(f)}),t=(l,p,_="info")=>{if(!l)return;let f=_==="error"?"aipkit_ai_forms_preview_message aipkit_ai_forms_preview_message--error":"aipkit_ai_forms_preview_message",g=_==="error"?"":'<span class="aipkit_spinner" aria-hidden="true"></span>';l.innerHTML=`
      <div class="${f}">
        ${g}
        <span>${r(p)}</span>
      </div>
    `},c=(l,p,_={})=>{let{__:f}=o(),g=window.aipkit_ai_forms_config||{},m=_.loadingText||f("Loading preview...","gpt3-ai-content-generator");return p?l?typeof window.aipkit_apiRequest!="function"?(t(p,f("Preview loader is unavailable.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("API request helper missing."))):(t(p,m),window.aipkit_apiRequest("aipkit_get_form_preview",{form_id:l,_ajax_nonce:g.nonce_manage_forms}).then(u=>(u.config&&(window.aipkit_ai_forms_public_config=u.config),u.models&&(window.aipkit_ai_forms_models=u.models),u.assets&&u.assets.css&&Object.values(u.assets.css).forEach(i),p.innerHTML=u.html||"",u.assets&&u.assets.js?Promise.all(Object.values(u.assets.js).map(e)):null)).then(()=>{typeof window.aipkit_initAIFormsPublic=="function"&&window.aipkit_initAIFormsPublic()}).catch(u=>{let h=u&&u.message?u.message:"Unknown error.";throw t(p,`${f("Preview failed:","gpt3-ai-content-generator")} ${h}`,"error"),u})):(t(p,f("Missing form ID for preview.","gpt3-ai-content-generator"),"error"),Promise.reject(new Error("Form ID missing."))):Promise.reject(new Error("Preview container not found."))},s=l=>{let p=l||document.getElementById("aipkit_ai_forms_container");if(!p)return null;let _=p.querySelector("#aipkit_ai_forms_preview_sheet");return _?{container:p,overlay:_,panel:_.querySelector(".aipkit_builder_sheet_panel"),closeButton:_.querySelector("#aipkit_ai_forms_preview_sheet_close"),title:_.querySelector("#aipkit_ai_forms_preview_sheet_title"),description:_.querySelector("#aipkit_ai_forms_preview_sheet_description"),previewFrame:_.querySelector("#aipkit_ai_forms_preview_frame")}:null},n=(l,p,_)=>{let{__:f}=o(),g=s(_);if(!g)return;let m=p&&String(p).trim()||f("Untitled","gpt3-ai-content-generator");g.title&&(g.title.textContent=f("Preview","gpt3-ai-content-generator")),g.description&&(g.description.textContent="",g.description.removeAttribute("title"),g.description.setAttribute("hidden","true")),g.overlay.classList.add("aipkit-active"),g.overlay.setAttribute("aria-hidden","false"),g.previewFrame&&c(l,g.previewFrame).catch(()=>{}),g.closeButton&&g.closeButton.focus()},d=l=>{let p=s(l);p&&(p.overlay.classList.remove("aipkit-active"),p.overlay.setAttribute("aria-hidden","true"),p.previewFrame&&(p.previewFrame.innerHTML=""))},a=l=>{let p=s(l);!p||p.overlay.dataset.previewSheetInitialized==="true"||(p.closeButton&&p.closeButton.addEventListener("click",_=>{_.preventDefault(),d(p.container)}),p.overlay.addEventListener("click",_=>{_.target===p.overlay&&d(p.container)}),document.addEventListener("keydown",_=>{_.key==="Escape"&&p.overlay.classList.contains("aipkit-active")&&d(p.container)}),p.overlay.dataset.previewSheetInitialized="true")};window.aipkitForms_loadFormPreview=c,window.aipkitForms_openPreviewSheet=n,window.aipkitForms_closePreviewSheet=d,window.aipkitForms_initPreviewSheet=a})();(function(){"use strict";function k(){let o=window.aipkitForms_validateContainer();if(!o)return;let r=()=>{typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(o):console.error("AI Forms Init: aipkit_initContentWriterPopovers function not found.")};if(o.dataset.aipkitInitialized==="true"){r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"&&window.aipkitForms_initSettingsPopoverPanels(o),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(o),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(o),typeof window.aipkitForms_initSettingsAutosave=="function"&&window.aipkitForms_initSettingsAutosave(o),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(o),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(o),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(o),window.aipkitForms_initializeDragAndDrop(o),window.aipkitForms_initListView(),window.aipkitForms_initializeAccordions(o),window.aipkitForms_initializeTokenUI(o);return}r(),typeof window.aipkit_initApiKeyToggles=="function"&&window.aipkit_initApiKeyToggles("#aipkit_ai_forms_container"),typeof window.aipkitForms_initSettingsPopoverPanels=="function"?window.aipkitForms_initSettingsPopoverPanels(o):console.error("AI Forms Init: aipkitForms_initSettingsPopoverPanels function not found."),typeof window.aipkitForms_initEditorSettingsPopover=="function"&&window.aipkitForms_initEditorSettingsPopover(o),typeof window.aipkitForms_initPromptModal=="function"&&window.aipkitForms_initPromptModal(o),typeof window.aipkitForms_initSettingsAutosave=="function"?window.aipkitForms_initSettingsAutosave(o):console.error("AI Forms Init: aipkitForms_initSettingsAutosave function not found."),typeof window.aipkitForms_initAllowedModelsSelector=="function"&&window.aipkitForms_initAllowedModelsSelector(o),typeof window.aipkitForms_initSelectPickers=="function"&&window.aipkitForms_initSelectPickers(o),typeof window.aipkitForms_initPreviewSheet=="function"&&window.aipkitForms_initPreviewSheet(o),window.aipkitForms_attachClickEventListeners(o),window.aipkitForms_attachChangeEventListeners(o),window.aipkitForms_attachSettingsPanelListeners(o),window.aipkitForms_initializeAccordions(o),typeof window.aipkitForms_initPromptSnippets=="function"?window.aipkitForms_initPromptSnippets(o):console.error("AI Forms Init: aipkitForms_initPromptSnippets function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"?window.aipkit_attachRangeValueHandlers("#aipkit_form_editor_container"):console.error("AI Forms Init: aipkit_attachRangeValueHandlers function not found."),window.aipkitForms_initializeDragAndDrop(o),window.aipkitForms_initListView(),window.aipkitForms_initializeTokenUI(o),typeof window.aipkitForms_initAiConfig=="function"?window.aipkitForms_initAiConfig(o):console.error("AI Forms Init: aipkitForms_initAiConfig function not found."),typeof window.aipkitForms_initVectorConfig=="function"?window.aipkitForms_initVectorConfig(o):console.error("AI Forms Init: aipkitForms_initVectorConfig function not found."),o.dataset.aipkitInitialized="true"}window.aipkit_initAiForms=k})();(function(){"use strict";let k="",o={content_indexing:{steps:[{id:"setup",label:"Content Selection"},{id:"finish_ci",label:"Vector Selection"}],contentMap:{setup:"task_form_setup",status:"task_config_status",finish_ci:"task_config_content_indexing"}},content_writing:{steps:[{id:"setup",label:"Setup"},{id:"prompts",label:"AI & Prompts"},{id:"finish_cw",label:"Post Settings"}],contentMap:{setup:"task_form_setup",status:"task_config_status",prompts:"task_config_ai",finish_cw:"task_config_content_writing"}},enhance_existing_content:{steps:[{id:"setup",label:"Setup"},{id:"ai_and_prompts",label:"AI & Prompts"}],contentMap:{setup:"task_form_setup",status:"task_config_status",ai_and_prompts:"task_config_enhancement_ai_and_prompts"}},community_reply_comments:{steps:[{id:"setup",label:"Setup"},{id:"filters",label:"Filters"},{id:"prompt",label:"AI & Prompt"}],contentMap:{setup:"task_form_setup",status:"task_config_status",filters:"task_config_comment_reply",prompt:"task_config_comment_reply_ai"}}};function r(){let c=document.getElementById("aipkit_automated_task_form"),s=document.getElementById("aipkit_provider_notice_autogpt");if(!c||!s)return;c.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"][data-aipkit-provider-notice-defer="1"]').forEach(p=>{delete p.dataset.aipkitProviderNoticeArmed});let d=Array.from(c.querySelectorAll('select[data-aipkit-provider-notice-target="aipkit_provider_notice_autogpt"]')),a=p=>p&&(p.offsetParent!==null||p.getClientRects().length>0),l=d.filter(a);if(!l.length){s.classList.add("aipkit_provider_notice--hidden");return}l.forEach(p=>{p.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(p.dataset.aipkitProviderNoticeArmed="true")}),typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(c)}function i(c){if(!c)return null;let s="content_writing";return c==="content_indexing"?s="content_indexing":c==="community_reply_comments"?s="community_reply_comments":c==="enhance_existing_content"&&(s="enhance_existing_content"),window.aipkit_wizardConfig[s]||null}function e(c){let s=document.querySelector(".aipkit_wizard_content_container"),n=document.getElementById("aipkit_save_task_btn");if(!s)return;let d=i(c);if(!d){s.querySelectorAll(".aipkit_wizard_content_step").forEach(l=>{l.style.display="none",l.classList.remove("aipkit_active")}),n&&(n.style.display="none"),r();return}let a=new Set(Object.values(d.contentMap));s.querySelectorAll(".aipkit_wizard_content_step").forEach(l=>{let p=l.dataset.contentId||"";a.has(p)?(l.style.display="block",l.classList.add("aipkit_active")):(l.style.display="none",l.classList.remove("aipkit_active"))}),n&&(n.style.display="inline-flex"),r()}function t(c){k=c,e(c)}window.aipkit_renderWizard=t,window.aipkit_initWizardNavigation=()=>{},window.aipkit_resetWizard=()=>{k="",e("")},window.aipkit_wizardConfig=o})();(function(){"use strict";function k(o){let r=window.aipkit_automated_tasks_config||{},i=r.text||{},e=window.aipkit_escapeHtml||function(n){return n},t=document.getElementById("aipkit_task_content_indexing_target_store_id");if(!t)return Promise.resolve();t.innerHTML=`<option value="">${e(i.loading_stores||"Loading...")}</option>`,t.disabled=!0;let c=[],s=i.select_target_store||"-- Select Target Store --";return o==="openai"&&r.openai_vector_stores?c=r.openai_vector_stores:o==="pinecone"&&r.pinecone_indexes?(c=r.pinecone_indexes,s=i.select_target_index||"-- Select Target Index --"):o==="qdrant"&&r.qdrant_collections&&(c=r.qdrant_collections,s=i.select_target_collection||"-- Select Target Collection --"),t.innerHTML=`<option value="">${e(s)}</option>`,c&&Array.isArray(c)&&c.length>0?(c.forEach(n=>{let d=n.id||n.name,a=n.name||n.id,l=e(a);o==="openai"&&n.file_counts?.total!==void 0?l+=` (Files: ${n.file_counts.total})`:o==="pinecone"&&n.dimension!==void 0&&(l+=` (Dim: ${n.dimension})`),t.appendChild(new Option(l,d))}),t.disabled=!1):(t.appendChild(new Option(e(i.no_targets_found_configure||`No ${o} targets found. Configure in AI Training.`),"")),t.disabled=!0),Promise.resolve()}window.aipkit_populateTargetStoreSelectForContentIndexing=k})();(function(){"use strict";function k(){let o=window.aipkit_automated_tasks_config||{},r=o.text||{},i=window.aipkit_escapeHtml||function(p){return p},e=document.getElementById("aipkit_task_content_indexing_embedding_model"),t=window.aipkit_automated_tasks_form_state||{},c=t.pendingEmbeddingModelSelection;if(!e)return Promise.resolve();e.innerHTML=`<option value="">${i(r.select_embedding_model||"-- Select Model --")}</option>`;let s=o.openai_embedding_models||[],n=o.google_embedding_models||[],d=o.openrouter_embedding_models||[],a=o.azure_embedding_models||[],l=(p,_,f)=>{let g=document.createElement("optgroup");return g.label=i(p),_&&_.length>0&&_.forEach(m=>{let u=`${f}:${m.id}`;g.appendChild(new Option(i(m.name||m.id),u))}),g};if(e.appendChild(l("OpenAI",s,"openai")),e.appendChild(l("Google",n,"google")),e.appendChild(l("OpenRouter",d,"openrouter")),e.appendChild(l("Azure",a,"azure")),e.disabled=s.length===0&&n.length===0&&d.length===0&&a.length===0,e.disabled&&(e.innerHTML=`<option value="">${i(r.no_embedding_models_sync||"No models found - Sync in AI Settings")}</option>`),c&&e.querySelector(`option[value="${CSS.escape(c)}"]`))e.value=c,t.pendingEmbeddingModelSelection=null;else if(e.options.length>1){let p=e.querySelector("optgroup");p&&p.options.length>0&&(e.value=p.options[0].value)}}window.aipkit_populateEmbeddingModelSelectForContentIndexing=k})();(function(){"use strict";function k(o){let r=o.target.value,i=document.getElementById("aipkit_task_content_indexing_embedding_model_group"),e=document.getElementById("aipkit_task_content_indexing_embedding_model_divider");if(typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"?window.aipkit_populateTargetStoreSelectForContentIndexing(r):console.error("Target Store Provider Change Handler: populateTargetStoreSelectForContentIndexing function not found."),i){let t=r==="pinecone"||r==="qdrant";i.style.display=t?"block":"none",e&&(e.style.display=t?"flex":"none"),t&&typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()}}window.aipkit_handleTargetStoreProviderChange=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_autogpt_container");if(!o)return;let r=o.querySelector("#aipkit_task_content_indexing_target_store_provider");if(r){if(r.dataset.listenerAttached==="true")return;typeof window.aipkit_handleTargetStoreProviderChange=="function"?(r.addEventListener("change",window.aipkit_handleTargetStoreProviderChange),window.aipkit_handleTargetStoreProviderChange({target:r}),r.dataset.listenerAttached="true"):console.error("Content Indexing UI Init: aipkit_handleTargetStoreProviderChange function not found.")}}window.aipkit_initContentIndexingTaskFormUI=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},o=window.wp?.i18n?.__||function(i){return i};function r(i,e){let t=i.value,c=t?t.toLowerCase():"",s=window.aipkit_dashboard?.models,n=window.aipkit_automated_tasks_form_state||{};if(!e)return;if(!s){e.innerHTML=`<option value="">${k("Error: Model data object not found")}</option>`,e.disabled=!0;return}let d=s[c];(typeof d>"u"||d===null)&&(console.warn(`AutoGPT Model Populator: No model data for provider '${c}'.`),d=c==="openai"?{}:[]);let a=n.pendingModelSelection||e.value;e.innerHTML="";let l=window.aipkit_dashboard?.recommendedModels?.[c]||[],p=Array.isArray(l)?l:[],_=new Set(p.map(f=>f?.id).filter(Boolean));if(c==="openai"&&typeof d=="object"&&!Array.isArray(d)){if(p.length>0){let f=document.createElement("optgroup");f.label=k(o("Recommended","gpt3-ai-content-generator")),p.forEach(g=>{g&&typeof g=="object"&&g.id&&f.appendChild(new Option(k(g.name||g.id),g.id))}),f.children.length>0&&e.appendChild(f)}Object.keys(d).forEach(f=>{let g=document.createElement("optgroup");g.label=k(f),Array.isArray(d[f])&&d[f].forEach(m=>{if(m&&m.id){if(_.has(m.id))return;g.appendChild(new Option(k(m.name||m.id),m.id))}}),e.appendChild(g)})}else if(Array.isArray(d)){if(p.length>0){let g=document.createElement("optgroup");g.label=k(o("Recommended","gpt3-ai-content-generator")),p.forEach(m=>{m&&typeof m=="object"&&m.id&&g.appendChild(new Option(k(m.name||m.id),m.id))}),g.children.length>0&&e.appendChild(g)}let f=p.length>0?document.createElement("optgroup"):null;f&&(f.label=k(o("All models","gpt3-ai-content-generator"))),d.forEach(g=>{if(g&&g.id){if(_.has(g.id))return;let m=new Option(k(g.name||g.id),g.id);f?f.appendChild(m):e.appendChild(m)}}),f&&f.children.length>0&&e.appendChild(f)}else console.warn(`AutoGPT Model Populator: Unexpected format for provider '${c}'.`),e.appendChild(new Option(k(`No models for ${t} (Format Error)`),""));if(e.options.length===0)e.appendChild(new Option(k(`No models for ${t}`),"")),e.disabled=!0;else{e.disabled=!1;let f=!1;if(a&&e.querySelector(`option[value="${CSS.escape(a)}"]`)&&(e.value=a,f=!0),!f&&e.options.length>0){let g=e.querySelector('option:not([value=""])');g&&(e.value=g.value)}}n&&(n.pendingModelSelection=null),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort(),e&&e.dispatchEvent(new Event("change",{bubbles:!0}))}window.aipkit_task_cw_populateModels=r})();(function(){"use strict";function k(o){if(!o)return;let r=o.closest(".aipkit_slider_wrapper"),i=null;if(r&&(i=r.querySelector(".aipkit_slider_value")),!i){let e=o.closest(".aipkit_ai_temperature_control");e&&(i=e.querySelector(".aipkit_ai_behavior_value"))}i&&(i.textContent=o.value,o.dataset.listenerAttached||(o.addEventListener("input",()=>i.textContent=o.value),o.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleTemperatureSlider=k})();(function(){"use strict";function k(o){if(!o)return;let r=o.closest(".aipkit_slider_wrapper"),i=r?r.querySelector(".aipkit_slider_value"):null;i&&(i.textContent=o.value,o.dataset.listenerAttached||(o.addEventListener("input",()=>i.textContent=o.value),o.dataset.listenerAttached="true"))}window.aipkit_task_cw_handleMaxTokensSlider=k})();(function(){"use strict";function k(o){let r=o.target,i=r.closest(".aipkit_post_settings_redesigned")||r.closest(".aipkit_wizard_content_step")||document,e=i.querySelector("#aipkit_task_cw_schedule_options_wrapper"),t=i.querySelector("#aipkit_task_cw_smart_schedule_fields"),c=i.querySelector(".aipkit_task_schedule_from_input_option"),s=c?c.querySelector(".aipkit_post_schedule_radio_text"):null,n=c?c.querySelector(".aipkit_popover_warning[data-tooltip]"):null;if(!e)return;let d=r.value==="publish";e.style.display=d?"block":"none";let a=document.getElementById("aipkit_automated_task_type"),l=new Set(["content_writing_bulk","content_writing_csv","content_writing_gsheets"]),p=`Accepted formats: YYYY-MM-DD HH:MM[:SS], YYYY/MM/DD HH:MM, MM/DD/YYYY HH:MM, DD/MM/YYYY HH:MM, or ISO 8601.

Times use the site timezone unless an offset/Z is provided.`,_={content_writing_bulk:{label:"Use Dates from List",tooltip:`Use when your list includes a publish date on each line.

`+p},content_writing_csv:{label:"Use Dates from CSV",tooltip:`Use when your CSV includes a publish date column.

`+p},content_writing_gsheets:{label:"Use Dates from Sheets",tooltip:`Use when your Google Sheets includes a publish date column.

`+p}},f={label:"Use Dates from Input",tooltip:`Use when your input includes a publish date.

`+p},g=()=>{if(!a)return;let v=_[a.value]||f;s&&(s.textContent=v.label),n&&n.setAttribute("data-tooltip",v.tooltip)},m=a&&l.has(a.value);if(c&&(g(),c.style.display=m?"inline-flex":"none",!m)){let v=c.querySelector('input[name="schedule_mode"][value="from_input"]');if(v&&v.checked){let S=i.querySelector('input[name="schedule_mode"][value="immediate"]');S&&(S.checked=!0,S.dispatchEvent(new Event("change",{bubbles:!0})))}}a&&!a.dataset.fromInputCopyListener&&(a.addEventListener("change",()=>{g()}),a.dataset.fromInputCopyListener="true"),i.querySelectorAll('input[name="schedule_mode"]').forEach(v=>{v.dataset.listenerAttached||(v.addEventListener("change",function(){let S=a&&l.has(a.value);t&&(t.style.display=this.value==="smart"?"block":"none")}),v.dataset.listenerAttached="true")});let h=i.querySelector('input[name="schedule_mode"]:checked');h&&t&&(t.style.display=h.value==="smart"?"block":"none")}window.aipkit_toggleTaskCwScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||(d=>d);function o(d){if(!d)return;let a=d.querySelector(".aipkit_task_cw_vector_store_toggle"),l=d.querySelectorAll(".aipkit_task_cw_vector_store_settings_container");if(!a||!l.length)return;let p=a.checked;l.forEach(_=>{_.style.display=p?"block":"none"}),p&&r(d)}function r(d){if(!d)return;let a=d.querySelector(".aipkit_task_cw_vector_store_provider_select");if(!a)return;let l=a.value,p=d.querySelector(".aipkit_task_cw_vector_openai_field"),_=d.querySelector(".aipkit_task_cw_vector_pinecone_field"),f=d.querySelector(".aipkit_task_cw_vector_qdrant_field"),g=d.querySelector(".aipkit_task_cw_vector_embedding_config_row"),m=(u,h)=>{u&&(u.style.display=h?"block":"none")};if(m(p,l==="openai"),m(_,l==="pinecone"),m(f,l==="qdrant"),g){let u=l==="pinecone"||l==="qdrant";g.style.display=u?"block":"none",u&&i(d)}}function i(d){let a=d.querySelector("#aipkit_task_cw_vector_embedding_model");if(!a)return;let l=d.querySelector("#aipkit_task_cw_vector_embedding_provider"),p=l?l.value:"openai",_=window.aipkit_automated_tasks_config||{},f=window.aipkit_automated_tasks_form_state||{},g=[];if(p==="google"?g=_.google_embedding_models||[]:p==="openrouter"?g=_.openrouter_embedding_models||[]:p==="azure"?g=_.azure_embedding_models||[]:g=_.openai_embedding_models||[],a.innerHTML="",g.length>0){a.add(new Option("-- Select Model --","")),g.forEach(u=>{a.add(new Option(k(u.name||u.id),u.id))}),a.disabled=!1;let m=f.pendingEmbeddingModelSelection;m&&Array.from(a.options).find(h=>h.value===m)&&(a.value=m,f.pendingEmbeddingModelSelection=null)}else a.add(new Option("No models found","")),a.disabled=!0}function e(d){if(!d)return;let a=d.getAttribute("aria-expanded")==="true",l=d.getAttribute("aria-controls"),p=document.getElementById(l);p&&(d.setAttribute("aria-expanded",(!a).toString()),p.setAttribute("aria-hidden",a?"true":"false"))}function t(d){if(!d)return;let a=document.getElementById(d.id+"_value");a&&(a.textContent=d.value)}function c(d){d&&(d.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(a=>{a.querySelector(".aipkit_task_cw_vector_store_toggle")&&(o(a),a.querySelectorAll(".aipkit_vector_slider").forEach(l=>{t(l)}))}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect(d))}function s(){let d=document.getElementById("aipkit_autogpt_container");!d||d.dataset.kbListenerAttached==="true"||(d.addEventListener("change",a=>{let l=a.target;if(l.matches(".aipkit_task_cw_vector_store_toggle")){let p=l.closest(".aipkit_vector_settings_redesigned");o(p)}else if(l.matches(".aipkit_task_cw_vector_store_provider_select")){let p=l.closest(".aipkit_vector_settings_redesigned");r(p)}else if(l.matches(".aipkit_task_cw_vector_embedding_provider_select")){let p=l.closest(".aipkit_vector_settings_redesigned");i(p)}}),d.addEventListener("input",a=>{let l=a.target;l.matches(".aipkit_vector_slider")&&t(l)}),d.addEventListener("click",a=>{let l=a.target.closest(".aipkit_vector_settings_chunk_header--collapsible");if(!l)return;let p=l.closest(".aipkit_vector_settings_redesigned");!p||!p.querySelector(".aipkit_task_cw_vector_store_toggle")||(a.preventDefault(),e(l))}),c(d),d.dataset.kbListenerAttached="true")}function n(){let d=document.getElementById("aipkit_autogpt_container");d&&(s(),d.querySelectorAll(".aipkit_vector_settings_redesigned").forEach(a=>{a.querySelector(".aipkit_task_cw_vector_store_toggle")&&(o(a),r(a),i(a))}))}window.aipkit_initCwKnowledgeBaseUI=s,window.aipkit_cw_task_populateEmbeddingModelSelect=i,window.aipkit_updateCwKnowledgeBaseUI=n})();(function(){"use strict";function k(){let i=document.getElementById("aipkit_automated_task_form");if(!i){console.warn("Content Writing UI Init: Could not find main form element.");return}let e=i.querySelector("#aipkit_task_cw_ai_provider"),t=i.querySelector("#aipkit_task_cw_ai_model");e&&t&&typeof window.aipkit_task_cw_populateModels=="function"&&(e.dataset.cwProviderListenerAttached||(e.addEventListener("change",()=>window.aipkit_task_cw_populateModels(e,t)),e.dataset.cwProviderListenerAttached="true"),t.dataset.cwModelListenerAttached||(t.addEventListener("change",()=>{typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort()}),t.dataset.cwModelListenerAttached="true"),window.aipkit_dashboard?.models&&window.aipkit_task_cw_populateModels(e,t),typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cw_toggleReasoningEffort());let c=i.querySelector("#aipkit_task_cw_ai_temperature");c&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(c);let s=i.querySelector("#aipkit_task_cw_post_status");s&&typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&(s.dataset.cwStatusListenerAttached||(s.addEventListener("change",window.aipkit_toggleTaskCwScheduleFields),s.dataset.cwStatusListenerAttached="true"),window.aipkit_toggleTaskCwScheduleFields({target:s})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect(i),typeof window.aipkit_initTaskCsvUploadHandler=="function"&&window.aipkit_initTaskCsvUploadHandler(),window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan&&(typeof window.aipkit_initTaskRssInputHandler=="function"?window.aipkit_initTaskRssInputHandler():typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():console.warn("AutoGPT CW UI: GSheets verification handler not found."),typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():console.warn("AutoGPT CW UI: URL Scrape handler not found."));let d=i.querySelector(".aipkit_task_cw_image_enable_toggle");d&&(d.dataset.cwImgListenerAttached||(d.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),d.dataset.cwImgListenerAttached="true"));let a=i.querySelector("#aipkit_task_cw_image_provider");a&&(a.dataset.cwImgListenerAttached||(a.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),a.dataset.cwImgListenerAttached="true"));let l=i.querySelector("#aipkit_task_cw_generate_featured_image");l&&(l.dataset.cwImgListenerAttached||(l.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),l.dataset.cwImgListenerAttached="true"));let p=i.querySelector(".aipkit_task_cw_image_placement_select");p&&(p.dataset.cwImgListenerAttached||(p.addEventListener("change",function(){typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI()}),p.dataset.cwImgListenerAttached="true")),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{window.aipkit_updateTaskImageSettingsUI()},100));let _=i.querySelector(".aipkit_image_settings_redesigned");_&&_.dataset.imageChunkListenerAttached!=="true"&&(_.addEventListener("click",S=>{let q=S.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!q)return;S.preventDefault();let y=q.getAttribute("aria-expanded")==="true",E=q.getAttribute("aria-controls");if(!E)return;let I=document.getElementById(E);q.setAttribute("aria-expanded",(!y).toString()),I&&I.setAttribute("aria-hidden",y?"true":"false")}),_.dataset.imageChunkListenerAttached="true");let f=async S=>{if(!S||!S.name)return;let q=S.value.trim(),y=S.dataset.apiKeyBaseline||"";if(q===y||S.dataset.apiKeySaving==="true"||typeof window.aipkit_apiRequest!="function")return;let E=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,I=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,w=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;S.dataset.apiKeySaving="true",S.dataset.apiKeyBaseline=q,E&&E("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[S.name]:q}),I&&I("Updated")}catch(A){S.dataset.apiKeyBaseline=y,w&&w(`Error: ${A.message||"Failed to save."}`)}finally{S.dataset.apiKeySaving="false"}};i.querySelectorAll(".aipkit_task_cw_stock_api_key, #aipkit_task_cw_replicate_api_key").forEach(S=>{if(S.dataset.apiKeyListenerAttached==="true")return;S.dataset.apiKeyBaseline=S.value.trim();let q=()=>{f(S)};S.addEventListener("change",q),S.addEventListener("blur",q),S.dataset.apiKeyListenerAttached="true"}),typeof window.aipkit_initCwKnowledgeBaseUI=="function"&&window.aipkit_initCwKnowledgeBaseUI();let m=i.querySelector("#aipkit_task_cw_ai_settings_toggle"),u=i.querySelector("#aipkit_task_cw_ai_parameters_row");m&&u&&(m.dataset.cwAiSettingsListenerAttached||(m.addEventListener("click",()=>{let S=u.style.display==="none"||u.style.display==="";u.style.display=S?"block":"none",m.classList.toggle("aipkit_active",S),m.setAttribute("aria-expanded",S)}),m.dataset.cwAiSettingsListenerAttached="true"));let h=i.querySelector("#aipkit_task_config_ai");h&&(h.dataset.cwPromptListenerAttached||(h.addEventListener("click",S=>{let q=S.target.closest(".aipkit_textarea_toggle");if(!q)return;let y=q.dataset.target,E=document.getElementById(y),I=q.querySelector(".dashicons");if(!E||!I)return;E.classList.toggle("aipkit_collapsed")?(I.classList.remove("dashicons-minus"),I.classList.add("dashicons-plus-alt2"),q.title="Expand"):(I.classList.remove("dashicons-plus-alt2"),I.classList.add("dashicons-minus"),q.title="Collapse")}),h.dataset.cwPromptListenerAttached="true"));let v=i.querySelector("#aipkit_task_config_seo");v&&(v.dataset.cwSeoPromptListenerAttached||(v.addEventListener("click",S=>{let q=S.target.closest(".aipkit_textarea_toggle");if(!q)return;let y=q.dataset.target,E=document.getElementById(y),I=q.querySelector(".dashicons");if(!E||!I)return;E.classList.toggle("aipkit_collapsed")?(I.classList.remove("dashicons-minus"),I.classList.add("dashicons-plus-alt2"),q.title="Expand"):(I.classList.remove("dashicons-plus-alt2"),I.classList.add("dashicons-minus"),q.title="Collapse")}),v.dataset.cwSeoPromptListenerAttached="true"))}function o(){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let e=window.aipkit_debug||!1,t=i.querySelector(".aipkit_task_cw_image_enable_toggle"),c=i.querySelector("#aipkit_task_cw_generate_featured_image"),s=i.querySelector(".aipkit_task_cw_image_settings_container"),n=i.querySelector("#aipkit_task_cw_image_provider");if(!t||!c||!s||!n)return;let d=t.checked,a=c.checked,l=d||a,p=n.value,_=p==="pexels"||p==="pixabay";if(s.style.display=l?"block":"none",l){let f=["#aipkit_task_cw_image_count","#aipkit_task_cw_image_placement","#aipkit_task_cw_image_size","#aipkit_task_cw_image_alignment"],g=i.querySelector(".aipkit_task_cw_image_placement_select"),m=i.querySelector(".aipkit_task_cw_image_placement_x_field"),u=i.querySelector("#aipkit_task_cw_pexels_options"),h=i.querySelector("#aipkit_task_cw_pixabay_options"),v=i.querySelector("#aipkit_task_cw_replicate_options"),S=i.querySelector(".aipkit_task_cw_image_display_chunk"),q=i.querySelector("#aipkit_task_cw_image_model_group"),y=i.querySelector("#aipkit_task_cw_image_model_divider");if(f.forEach(E=>{let I=i.querySelector(E);if(I){let w=I.closest(".aipkit_form-group");w&&(w.style.display=d?"block":"none")}}),S&&(S.style.display=d?"":"none"),g&&m){let E=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(g.value);m.style.display=d&&E?"block":"none"}u&&(u.style.display=l&&_&&p==="pexels"?"block":"none"),h&&(h.style.display=l&&_&&p==="pixabay"?"block":"none"),v&&(v.style.display=l&&p==="replicate"?"block":"none"),q&&(q.style.display=l&&!_?"":"none"),y&&(y.style.display=l&&!_?"":"none"),l&&!_&&typeof r=="function"&&r(p)}}function r(i){let e=document.getElementById("aipkit_task_cw_image_model");if(!e)return;let t=e.value,s=window.aipkit_dashboard?.imageGeneratorModels?.[i.toLowerCase()]||[],n=window.aipkit_escapeHtml||function(a){return a},d=window.aipkit_automated_tasks_form_state?.pendingImageModelSelection||e.value;if(e.innerHTML="",s.length>0?(s.forEach(a=>{e.appendChild(new Option(n(a.name),a.id))}),e.querySelector(`option[value="${CSS.escape(d)}"]`)&&(e.value=d)):e.appendChild(new Option("No models available","")),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=null),typeof window.aipkit_updateAutogptAiSummaries=="function"&&e.value!==t){let a=document.getElementById("aipkit_autogpt_container");window.aipkit_updateAutogptAiSummaries(a)}}window.aipkit_initContentWritingTaskFormUI=k,window.aipkit_updateTaskImageSettingsUI=o,window.aipkit_populateTaskImageModels=r})();(function(){"use strict";function k(){let o=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_comment_reply_ai"]');if(!o)return;let r=o.querySelector("#aipkit_task_cc_ai_provider"),i=o.querySelector("#aipkit_task_cc_ai_model");r&&i&&typeof window.aipkit_task_cw_populateModels=="function"&&(r.dataset.ccProviderListenerAttached||(r.addEventListener("change",()=>{window.aipkit_task_cw_populateModels(r,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),r.dataset.ccProviderListenerAttached="true"),i.dataset.ccModelListenerAttached||(i.addEventListener("change",()=>{typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort()}),i.dataset.ccModelListenerAttached="true"),window.aipkit_task_cw_populateModels(r,i),typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&window.aipkit_autogpt_cc_toggleReasoningEffort());let e=o.querySelector("#aipkit_task_cc_ai_temperature");e&&typeof window.aipkit_task_cw_handleTemperatureSlider=="function"&&window.aipkit_task_cw_handleTemperatureSlider(e);let t=o.querySelector("#aipkit_task_cc_content_max_tokens");t&&typeof window.aipkit_task_cw_handleMaxTokensSlider=="function"&&window.aipkit_task_cw_handleMaxTokensSlider(t);let c=o.querySelector("#aipkit_task_cc_ai_settings_toggle"),s=o.querySelector("#aipkit_task_cc_ai_parameters_row");c&&s&&(c.dataset.ccAiSettingsListenerAttached||(c.addEventListener("click",()=>{let n=s.style.display==="none"||s.style.display==="";s.style.display=n?"block":"none",c.classList.toggle("aipkit_active",n),c.setAttribute("aria-expanded",n)}),c.dataset.ccAiSettingsListenerAttached="true"))}window.aipkit_initCommentReplyTaskFormUI=k})();(function(){"use strict";function k(r){if(!r)return;let i=r.querySelectorAll("[data-aipkit-popover-target]");if(!i.length)return;let e=null,t=null,c=!1,s=p=>p?r.querySelector(`#${p}`):null,n=(p,_)=>{if(!p||!_)return;let f=p.getBoundingClientRect(),g=_.getBoundingClientRect(),m=g.width||400,u=g.height||0,h=window.innerWidth,v=window.innerHeight,S=12;if(p.dataset.aipkitPopoverPlacement==="bottom"){let E=f.left;E+m>h-S&&(E=f.right-m),E=Math.max(S,Math.min(E,h-m-S));let I=f.bottom+8;I+u>v-S&&(I=f.top-u-8),I=Math.max(S,Math.min(I,v-u-S)),_.style.left=`${Math.round(E)}px`,_.style.top=`${Math.round(I)}px`;return}if(p.dataset.aipkitPopoverPlacement==="left"){let E=f.left-m-10;E<S&&(E=f.right+10),E=Math.max(S,Math.min(E,h-m-S));let I=f.top;I+u>v-S&&(I=v-u-S),I=Math.max(S,I),_.style.left=`${Math.round(E)}px`,_.style.top=`${Math.round(I)}px`;return}let q=f.right+10;q+m>h-S&&(q=f.right-m-10),q=Math.max(S,Math.min(q,h-m-S));let y=f.top;y+u>v-S&&(y=v-u-S),y=Math.max(S,y),_.style.left=`${Math.round(q)}px`,_.style.top=`${Math.round(y)}px`},d=()=>{!t||!e||c||(c=!0,window.requestAnimationFrame(()=>{let p=e.querySelector(".aipkit_model_settings_popover_panel");n(t,p),c=!1}))},a=()=>{e&&(e.classList.remove("aipkit-active"),e.setAttribute("aria-hidden","true"),t&&t.setAttribute("aria-expanded","false"),e=null,t=null)},l=p=>{if(!p)return;let _=p.getAttribute("data-aipkit-popover-target"),f=s(_);if(!f)return;e&&e!==f&&a(),e=f,t=p,f.classList.add("aipkit-active"),f.setAttribute("aria-hidden","false"),p.setAttribute("aria-expanded","true"),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers(`#${_}`),typeof window.aipkit_initAutogptPromptFlyouts=="function"&&window.aipkit_initAutogptPromptFlyouts(r);let g=f.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{n(p,g)})};i.forEach(p=>{p.dataset.popoverListenerAttached!=="true"&&(p.addEventListener("click",_=>{if(_.preventDefault(),!(p.dataset.aipkitPopoverKeepOpen==="true")&&e&&t===p&&e.classList.contains("aipkit-active")){a();return}l(p)}),p.dataset.popoverListenerAttached="true")}),r.querySelectorAll(".aipkit_model_settings_popover").forEach(p=>{p.dataset.overlayListenerAttached!=="true"&&(p.addEventListener("click",f=>{f.target===p&&a()}),p.dataset.overlayListenerAttached="true");let _=p.querySelector(".aipkit_model_settings_popover_close");_&&_.dataset.popoverListenerAttached!=="true"&&(_.addEventListener("click",f=>{f.preventDefault(),a()}),_.dataset.popoverListenerAttached="true"),p.querySelectorAll("[data-aipkit-popover-close]").forEach(f=>{f.dataset.popoverListenerAttached!=="true"&&(f.addEventListener("click",g=>{g.preventDefault(),a()}),f.dataset.popoverListenerAttached="true")})}),r.dataset.escapeListenerAttached!=="true"&&(document.addEventListener("keydown",p=>{p.key==="Escape"&&e&&a()}),r.dataset.escapeListenerAttached="true"),r.dataset.repositionListenersAttached!=="true"&&(window.addEventListener("resize",d),window.addEventListener("scroll",d,!0),r.dataset.repositionListenersAttached="true")}function o(){let r=document.getElementById("aipkit_autogpt_container");r&&k(r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o(),window.aipkit_initAutogptPopovers=k})();(function(){"use strict";let k=n=>{if(!n)return"";let d=n.options?n.options[n.selectedIndex]:null;return d?d.textContent.trim():""},o=n=>n?Array.from(n.selectedOptions||[]).map(d=>d.textContent.trim()).filter(Boolean):[],r=(n,d)=>{let a=n.filter(Boolean);return a.length?a.join(", "):d||""},i=(n,d)=>{if(!n)return;n.textContent=d,n.title=d;let a=n.dataset.aipkitPlaceholder||"",l="active";a&&d===a&&(l="placeholder"),n.dataset.aipkitSummaryState=l},e=(n,d)=>{if(!n)return;let a=d||document,l=n.dataset.aipkitAutogptSummary||"",p=n.dataset.aipkitAutogptProvider||"",_=n.dataset.aipkitAutogptModel||"",f=_?a.querySelector(_):null,g=k(f),m=n.dataset.aipkitPlaceholder||"Select";if(l==="images"){let u=n.dataset.aipkitDisabledLabel||m,h=n.dataset.aipkitAutogptToggle||"",v=n.dataset.aipkitAutogptFeaturedToggle||"",S=h?a.querySelector(h):null,q=v?a.querySelector(v):null;if(!(S&&S.checked||q&&q.checked)){i(n,u);return}let E=p?a.querySelector(p):null,I=E?E.value:"",w=k(E);if(["pexels","pixabay"].includes(I)){i(n,w||m);return}i(n,g||w||m);return}if(l==="vector"){let u=n.dataset.aipkitDisabledLabel||m,h=n.dataset.aipkitAutogptToggle||"",v=h?a.querySelector(h):null;if(!(v?v.checked:!0)){i(n,u);return}let q=p?a.querySelector(p):null,y=q?q.value:"",E=k(q),I=n.dataset.aipkitAutogptStore||"",w=n.dataset.aipkitAutogptOpenaiStore||"",A=n.dataset.aipkitAutogptPineconeStore||"",C=n.dataset.aipkitAutogptQdrantStore||"",b="";if(y==="openai"&&w){let x=a.querySelector(w);b=o(x).join(", ")}else y==="pinecone"&&A?b=k(a.querySelector(A)):y==="qdrant"&&C?b=k(a.querySelector(C)):I&&(b=k(a.querySelector(I)));i(n,r([b,E],m));return}i(n,g||m)},t=(n,d)=>{if(!n||n.dataset.aipkitAutogptSummaryBound==="true")return;let a=d||document,l=n.dataset.aipkitAutogptProvider||"",p=n.dataset.aipkitAutogptModel||"",_=n.dataset.aipkitAutogptToggle||"",f=n.dataset.aipkitAutogptFeaturedToggle||"",g=[n.dataset.aipkitAutogptStore||"",n.dataset.aipkitAutogptOpenaiStore||"",n.dataset.aipkitAutogptPineconeStore||"",n.dataset.aipkitAutogptQdrantStore||""].filter(Boolean),m=l?a.querySelector(l):null,u=p?a.querySelector(p):null,h=_?a.querySelector(_):null,v=f?a.querySelector(f):null,S=()=>e(n,a);m&&m.addEventListener("change",S),u&&u.addEventListener("change",S),h&&h.addEventListener("change",S),v&&v.addEventListener("change",S),g.forEach(q=>{let y=a.querySelector(q);y&&y.addEventListener("change",S)}),n.dataset.aipkitAutogptSummaryBound="true",e(n,a)};function c(n){let d=n||document.getElementById("aipkit_autogpt_container");if(!d)return;d.querySelectorAll("[data-aipkit-autogpt-summary]").forEach(l=>{t(l,d),e(l,d)})}function s(){let n=document.getElementById("aipkit_autogpt_container");n&&c(n)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s(),window.aipkit_updateAutogptAiSummaries=c})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"]},o={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},r=a=>String(a??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),i=()=>{let a=document.getElementById("aipkit_automated_task_type"),l=a?a.value:"";return l==="content_writing"?"bulk":l&&l.startsWith("content_writing_")&&l.replace("content_writing_","")||"bulk"},e=(a,l)=>{let p=k[a]||[],_=o[l]||[],f=[...p,..._];return f.filter((g,m)=>f.indexOf(g)===m)},t=(a,l)=>{if(!a)return;let p=a.dataset.label||"Variables:",_=a.dataset.copyTitle||"Click to copy";a.innerHTML=`${r(p)} `,l.forEach((f,g)=>{let m=document.createElement("code");m.className="aipkit-placeholder",m.title=_,m.textContent=f,a.appendChild(m),g<l.length-1&&a.appendChild(document.createTextNode(" "))})},c=a=>{let l=a||document.getElementById("aipkit_autogpt_container");if(!l)return;let p=i(),_=l.querySelectorAll(".aipkit_cw_prompt_editor_placeholders[data-prompt-type]");_.length&&_.forEach(f=>{let g=f.dataset.promptType||"",m=e(g,p);m.length&&t(f,m)})};function s(a){let l=a.querySelectorAll(".aipkit_cw_prompt_library_select");l.length&&l.forEach(p=>{p.dataset.promptLibraryAttached!=="true"&&(p.addEventListener("change",()=>{let _=p.getAttribute("data-aipkit-prompt-target");if(!_||!p.value)return;let f=a.querySelector(`#${_}`);f&&(f.value=p.value,f.dispatchEvent(new Event("input",{bubbles:!0})))}),p.dataset.promptLibraryAttached="true")})}function n(a){if(!a)return;let l=a.querySelectorAll("[data-aipkit-flyout-target]");if(!l.length)return;let p=null,_=null,f=!1,g=S=>S?a.querySelector(`#${S}`):null,m=(S,q,y)=>{if(!S||!q||!p)return;let E=S.getBoundingClientRect(),I=y?y.getBoundingClientRect():E,w=q.getBoundingClientRect(),A=w.width||580,C=w.height||420,b=window.innerWidth,x=window.innerHeight,T=12,P=I.left-A-10;P<T&&(P=I.right+10),P=Math.max(T,Math.min(P,b-A-T));let H=I.top;H+C>x-T&&(H=x-C-T),H=Math.max(T,H),p.style.left=`${Math.round(P)}px`,p.style.top=`${Math.round(H)}px`},u=()=>{!p||!_||f||(f=!0,window.requestAnimationFrame(()=>{let S=p.querySelector(".aipkit_cw_prompt_panel"),q=_.closest(".aipkit_model_settings_popover_panel");m(_,S,q),f=!1}))},h=()=>{p&&(p.classList.remove("is-open"),p.setAttribute("aria-hidden","true"),_&&_.setAttribute("aria-expanded","false"),p=null,_=null)},v=S=>{let q=S.getAttribute("data-aipkit-flyout-target"),y=g(q);y&&(p&&p!==y&&h(),p=y,_=S,y.classList.add("is-open"),y.setAttribute("aria-hidden","false"),S.setAttribute("aria-expanded","true"),c(y),window.requestAnimationFrame(()=>{let E=y.querySelector(".aipkit_cw_prompt_panel"),I=S.closest(".aipkit_model_settings_popover_panel");m(S,E,I)}))};l.forEach(S=>{S.dataset.promptFlyoutListenerAttached!=="true"&&(S.addEventListener("click",q=>{if(q.preventDefault(),p&&_===S&&p.classList.contains("is-open")){h();return}v(S)}),S.dataset.promptFlyoutListenerAttached="true")}),a.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(S=>{S.dataset.overlayListenerAttached!=="true"&&(S.addEventListener("click",q=>{q.target===S&&h()}),S.dataset.overlayListenerAttached="true")}),a.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",S=>{S.key==="Escape"&&p&&h()}),a.dataset.promptFlyoutEscapeAttached="true"),a.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",S=>{if(!p)return;let q=S.target;q.closest(".aipkit_cw_prompt_flyout")||q.closest("[data-aipkit-flyout-target]")||h()}),a.dataset.promptFlyoutClickAttached="true"),a.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),a.dataset.promptFlyoutRepositionAttached="true")}function d(a){let l=a||document.getElementById("aipkit_autogpt_container");l&&(s(l),n(l),c(l))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>d()):d(),window.aipkit_initAutogptPromptFlyouts=d,window.aipkit_updateAutogptPromptPlaceholders=()=>{c()}})();(function(){"use strict";function k(){let t=document.querySelector("#aipkit_task_cw_ai_provider"),c=document.querySelector("#aipkit_task_cw_ai_model"),s=document.querySelector(".aipkit_task_cw_reasoning_effort_field"),n=s?s.closest(".aipkit_ai_settings_redesigned"):null;if(!t||!c||!s){s&&(s.style.display="none");return}let d=(t.value||"").toLowerCase(),l=(c.value||"").toLowerCase(),p=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),_=l.includes("gpt-5");d==="openai"&&(p||_)?(s.style.display="block",n&&o(n,l)):s.style.display="none"}function o(t,c){let s=t.querySelector("[data-aipkit-reasoning-select]"),n=t.querySelectorAll(".aipkit_ai_reasoning_option");if(!s||!n.length)return;let d=r(c),a=new Set(d.allowed);n.forEach(f=>{let g=f.querySelector(".aipkit_ai_reasoning_input");if(!g)return;let m=g.value==="minimal"?"low":g.value,u=a.has(m);f.style.display=u?"":"none",u||(g.checked=!1)});let l=s.value||"";l==="minimal"&&(l="low"),a.has(l)||(l=d.defaultValue),a.has(l)||(l=d.allowed[0]||"");let p=s.value;l&&(s.value=l);let _=t.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(_){_.checked=!0,t.querySelectorAll(".aipkit_ai_reasoning_option").forEach(g=>g.classList.remove("aipkit_ai_reasoning_option--selected"));let f=_.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}p!==s.value&&s.dispatchEvent(new Event("change",{bubbles:!0}))}function r(t){return e(t)?{allowed:["high"],defaultValue:"high"}:t.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(t)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(t){let c=t.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let s=t.match(/gpt-(\d+)/);return s?Number.parseInt(s[1],10)>=6:!1}function e(t){return/gpt-5(\.\d+)?-pro/.test(t)}window.aipkit_autogpt_cw_toggleReasoningEffort=k})();(function(){"use strict";function k(){let t=document.querySelector("#aipkit_task_cc_ai_provider"),c=document.querySelector("#aipkit_task_cc_ai_model"),s=document.querySelector(".aipkit_task_cc_reasoning_effort_field"),n=s?s.closest(".aipkit_ai_settings_redesigned"):null;if(!t||!c||!s){s&&(s.style.display="none");return}let d=(t.value||"").toLowerCase(),l=(c.value||"").toLowerCase(),p=l.startsWith("o1")||l.startsWith("o3")||l.startsWith("o4"),_=l.includes("gpt-5");d==="openai"&&(p||_)?(s.style.display="block",n&&o(n,l)):s.style.display="none"}function o(t,c){let s=t.querySelector("[data-aipkit-reasoning-select]"),n=t.querySelectorAll(".aipkit_ai_reasoning_option");if(!s||!n.length)return;let d=r(c),a=new Set(d.allowed);n.forEach(f=>{let g=f.querySelector(".aipkit_ai_reasoning_input");if(!g)return;let m=g.value==="minimal"?"low":g.value,u=a.has(m);f.style.display=u?"":"none",u||(g.checked=!1)});let l=s.value||"";l==="minimal"&&(l="low"),a.has(l)||(l=d.defaultValue),a.has(l)||(l=d.allowed[0]||"");let p=s.value;l&&(s.value=l);let _=t.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(_){_.checked=!0,t.querySelectorAll(".aipkit_ai_reasoning_option").forEach(g=>g.classList.remove("aipkit_ai_reasoning_option--selected"));let f=_.closest(".aipkit_ai_reasoning_option");f&&f.classList.add("aipkit_ai_reasoning_option--selected")}p!==s.value&&s.dispatchEvent(new Event("change",{bubbles:!0}))}function r(t){return e(t)?{allowed:["high"],defaultValue:"high"}:t.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(t)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(t){let c=t.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let s=t.match(/gpt-(\d+)/);return s?Number.parseInt(s[1],10)>=6:!1}function e(t){return/gpt-5(\.\d+)?-pro/.test(t)}window.aipkit_autogpt_cc_toggleReasoningEffort=k})();(function(){"use strict";function k(o,r){let i=document.getElementById("aipkit_save_task_btn"),e=i?i.querySelector(".aipkit_btn-text"):null,t=o.elements.task_id,c=o.elements.task_name,s=o.elements.task_type,n=o.elements.task_status,d=document.getElementById("aipkit_cancel_edit_task_btn"),l=(window.aipkit_automated_tasks_config||{}).text||{},p=document.getElementById("aipkit_autogpt_header_title_default"),_=document.getElementById("aipkit_autogpt_header_title_editor"),f=document.getElementById("aipkit_autogpt_title_display"),g=document.getElementById("aipkit_autogpt_title_text"),m=document.getElementById("aipkit_autogpt_task_title_input"),u=g&&g.dataset.defaultLabel||m&&m.placeholder||"New Task",h=()=>{let y=(m?m.value.trim():"")||u;g&&(g.textContent=y),f&&f.setAttribute("title",y),c&&(c.value=y)},v=()=>{!f||!m||(f.style.display="none",m.style.display="inline-block",m.focus(),m.select())},S=()=>{!f||!m||(m.style.display="none",f.style.display="inline-flex",h())};p&&(p.style.display="none"),_&&(_.style.display="flex"),_&&_.dataset.inlineTitleBound!=="true"&&f&&m&&(f.addEventListener("click",v),m.addEventListener("blur",S),m.addEventListener("keydown",q=>{q.key==="Enter"&&(q.preventDefault(),m.blur())}),m.addEventListener("input",h),_.dataset.inlineTitleBound="true"),r?(e&&(e.textContent=l.save_task_button||"Save Task"),t&&(t.value=r.id||""),m&&(m.value=r.task_name||u),h(),s&&(s.value=r.task_type||"content_indexing"),n&&(n.value=r.status||"active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),d&&(d.style.display="inline-flex")):(e&&(e.textContent=l.save_task_button||"Save Task"),t&&(t.value=""),m&&(m.value=u),h(),s&&(s.value="content_indexing"),n&&(n.value="active"),typeof window.aipkit_syncTaskStatusToggle=="function"&&window.aipkit_syncTaskStatusToggle(),d&&(d.style.display="inline-flex"))}window.aipkit_form_populateCommonFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(r){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let e=i.elements["post_types[]"];e&&(Array.from(e.options).forEach(c=>c.selected=!1),(r.post_types||[]).forEach(c=>{let s=e.querySelector(`option[value="${k(c)}"]`);s&&(s.selected=!0)}));let t=i.elements.target_store_provider;t&&(t.value=r.target_store_provider||"openai",t.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_populateTargetStoreSelectForContentIndexing=="function"&&window.aipkit_populateTargetStoreSelectForContentIndexing(r.target_store_provider||"openai").then(()=>{let c=i.elements.target_store_id;c&&(c.value=r.target_store_id||"")}),i.elements.index_existing_now_flag&&(i.elements.index_existing_now_flag.checked=r.index_existing_now_flag==="1"),i.elements.only_new_updated_flag&&(i.elements.only_new_updated_flag.checked=r.only_new_updated_flag==="1"),(r.target_store_provider==="pinecone"||r.target_store_provider==="qdrant")&&(window.aipkit_automated_tasks_form_state&&r.embedding_provider&&r.embedding_model&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=`${r.embedding_provider}:${r.embedding_model}`),typeof window.aipkit_populateEmbeddingModelSelectForContentIndexing=="function"&&window.aipkit_populateEmbeddingModelSelectForContentIndexing()),i.elements.task_frequency&&(i.elements.task_frequency.value=r.indexing_frequency||"daily")}window.aipkit_form_populateContentIndexingFields=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(r){let i=document.getElementById("aipkit_automated_task_form");if(!i)return;let e=r.cw_generation_mode||"bulk";if(e==="bulk"||e==="single"||e==="task"){let q=i.elements.content_title_bulk;q&&(q.value=r.content_title||"")}else if(e==="csv"){let q=i.elements.content_title;q&&(q.value=r.content_title||"")}else if(e==="rss"){i.elements.rss_feeds&&(i.elements.rss_feeds.value=r.rss_feeds||""),i.elements.rss_include_keywords&&(i.elements.rss_include_keywords.value=r.rss_include_keywords||""),i.elements.rss_exclude_keywords&&(i.elements.rss_exclude_keywords.value=r.rss_exclude_keywords||"");let q=i.elements.rss_feeds;q&&(typeof window.aipkit_initTaskRssInputHandler=="function"&&window.aipkit_initTaskRssInputHandler(),q.dispatchEvent(new Event("input",{bubbles:!0})))}else if(e==="url")i.elements.url_list&&(i.elements.url_list.value=r.url_list||"");else if(e==="gsheets"){let q=i.elements.gsheets_credentials;if(q){let y=r.gsheets_credentials,E=q.closest(".aipkit_gsheets_section_container");typeof y=="object"&&y!==null?q.value=JSON.stringify(y,null,2):q.value=y||"",q.value?(q.dataset.filename="credentials.json",E&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(E),100)):(delete q.dataset.filename,E&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(E,"clear"))}i.elements.gsheets_sheet_id&&(i.elements.gsheets_sheet_id.value=r.gsheets_sheet_id||"")}i.elements.custom_title_prompt&&(i.elements.custom_title_prompt.value=r.custom_title_prompt||""),i.elements.custom_content_prompt&&(i.elements.custom_content_prompt.value=r.custom_content_prompt||"");let t=document.getElementById("aipkit_task_cw_ai_provider"),c=document.getElementById("aipkit_task_cw_ai_model");t&&(t.value=r.ai_provider?r.ai_provider.toLowerCase():"openai",r.ai_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=r.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&c&&window.aipkit_task_cw_populateModels(t,c));let s=document.getElementById("aipkit_task_cw_ai_temperature");if(s){s.value=r.ai_temperature||"1.0";let q=document.getElementById("aipkit_task_cw_ai_temperature_value");q&&(q.textContent=s.value)}let n=document.getElementById("aipkit_task_cw_content_length");n&&(n.value=r.content_length||"medium",n.dispatchEvent(new Event("change",{bubbles:!0})));let d=i.elements.reasoning_effort;if(d){let q=r.reasoning_effort||"";q&&(d.value=q==="minimal"?"low":q,d.dispatchEvent(new Event("change",{bubbles:!0})))}c&&typeof window.aipkit_autogpt_cw_toggleReasoningEffort=="function"&&setTimeout(()=>c.dispatchEvent(new Event("change",{bubbles:!0})),100),i.elements.generate_meta_description&&(i.elements.generate_meta_description.checked=r.generate_meta_description==="1"),i.elements.custom_meta_prompt&&(i.elements.custom_meta_prompt.value=r.custom_meta_prompt||""),i.elements.generate_focus_keyword&&(i.elements.generate_focus_keyword.checked=r.generate_focus_keyword==="1"),i.elements.custom_keyword_prompt&&(i.elements.custom_keyword_prompt.value=r.custom_keyword_prompt||""),i.elements.generate_excerpt&&(i.elements.generate_excerpt.checked=r.generate_excerpt==="1"),i.elements.custom_excerpt_prompt&&(i.elements.custom_excerpt_prompt.value=r.custom_excerpt_prompt||""),i.elements.generate_tags&&(i.elements.generate_tags.checked=r.generate_tags==="1"),i.elements.custom_tags_prompt&&(i.elements.custom_tags_prompt.value=r.custom_tags_prompt||""),i.elements.generate_toc&&(i.elements.generate_toc.checked=r.generate_toc==="1"),i.elements.generate_seo_slug&&(i.elements.generate_seo_slug.checked=r.generate_seo_slug==="1"),i.elements.post_type&&(i.elements.post_type.value=r.post_type||"post");let a=i.elements.post_author;a&&(a.value=r.post_author||window.aipkit_dashboard?.currentUserId||"1");let l=document.getElementById("aipkit_task_cw_post_status");l&&(l.value=r.post_status||"draft");let p=r.schedule_mode||"immediate",_=i.querySelector(`input[name="schedule_mode"][value="${p}"]`);_&&(_.checked=!0),i.elements.smart_schedule_start_datetime&&(i.elements.smart_schedule_start_datetime.value=r.smart_schedule_start_datetime||""),i.elements.smart_schedule_interval_value&&(i.elements.smart_schedule_interval_value.value=r.smart_schedule_interval_value||"1"),i.elements.smart_schedule_interval_unit&&(i.elements.smart_schedule_interval_unit.value=r.smart_schedule_interval_unit||"hours"),typeof window.aipkit_toggleTaskCwScheduleFields=="function"&&window.aipkit_toggleTaskCwScheduleFields({target:l});let f=document.getElementById("aipkit_task_cw_post_categories");f&&f.options&&(Array.from(f.options).forEach(y=>y.selected=!1),(Array.isArray(r.post_categories)?r.post_categories.map(String):[]).forEach(y=>{let E=f.querySelector(`option[value="${k(y)}"]`);E&&(E.selected=!0)}),f.dispatchEvent(new Event("change",{bubbles:!0}))),i.elements.generate_images_enabled&&(i.elements.generate_images_enabled.checked=r.generate_images_enabled==="1"),i.elements.image_provider&&(i.elements.image_provider.value=(r.image_provider||"openai").toLowerCase()),i.elements.image_model&&window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingImageModelSelection=r.image_model),i.elements.image_prompt&&(i.elements.image_prompt.value=r.image_prompt||""),i.elements.image_count&&(i.elements.image_count.value=r.image_count||"1"),i.elements.image_placement&&(i.elements.image_placement.value=r.image_placement||"after_first_h2"),i.elements.image_placement_param_x&&(i.elements.image_placement_param_x.value=r.image_placement_param_x||"2"),i.elements.image_size&&(i.elements.image_size.value=r.image_size||"large"),i.elements.image_alignment&&(i.elements.image_alignment.value=r.image_alignment||"none"),i.elements.generate_featured_image&&(i.elements.generate_featured_image.checked=r.generate_featured_image==="1"),i.elements.featured_image_prompt&&(i.elements.featured_image_prompt.value=r.featured_image_prompt||""),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&window.aipkit_updateTaskImageSettingsUI();let g=i.querySelector('input[name="enable_vector_store"]');g&&(g.checked=r.enable_vector_store==="1",g.dispatchEvent(new Event("change",{bubbles:!0})));let m=i.querySelector("#aipkit_task_cw_vector_store_provider");m&&(m.value=r.vector_store_provider||"openai",m.dispatchEvent(new Event("change",{bubbles:!0})));let u=i.querySelector("#aipkit_task_cw_vector_store_top_k");if(u){u.value=r.vector_store_top_k||"3";let q=i.querySelector("#aipkit_task_cw_vector_store_top_k_value");q&&(q.textContent=u.value)}let h=document.getElementById("aipkit_task_cw_openai_vector_store_ids");if(h&&h.options){let q=Array.isArray(r.openai_vector_store_ids)?r.openai_vector_store_ids.map(String):[];Array.from(h.options).forEach(y=>{y.selected=q.includes(y.value)}),h.dispatchEvent(new Event("change",{bubbles:!0}))}let v=document.getElementById("aipkit_task_cw_pinecone_index_name");v&&(v.value=r.pinecone_index_name||"");let S=document.getElementById("aipkit_task_cw_qdrant_collection_name");if(S&&(S.value=r.qdrant_collection_name||""),r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant"){let q=document.getElementById("aipkit_task_cw_vector_embedding_provider");q&&(q.value=r.vector_embedding_provider||"openai",q.dispatchEvent(new Event("change",{bubbles:!0})))}typeof window.aipkit_updateCwKnowledgeBaseUI=="function"&&window.aipkit_updateCwKnowledgeBaseUI(),r.vector_store_provider&&(r.vector_store_provider==="pinecone"||r.vector_store_provider==="qdrant")&&r.vector_embedding_model&&setTimeout(()=>{window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingEmbeddingModelSelection=r.vector_embedding_model);let q=i.querySelector("#aipkit_autogpt_cw_vector_settings_popover")||i;q&&typeof window.aipkit_cw_task_populateEmbeddingModelSelect=="function"&&window.aipkit_cw_task_populateEmbeddingModelSelect(q)},150),i.elements.task_frequency&&(i.elements.task_frequency.value=r.task_frequency||"daily")}window.aipkit_form_populateContentWritingFields=o})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_task_form");if(!r)return;let i=document.getElementById("aipkit_task_cc_ai_provider"),e=document.getElementById("aipkit_task_cc_ai_model");i&&e&&(i.value=o.ai_provider?o.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&o.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=o.ai_model),typeof window.aipkit_task_cw_populateModels=="function"&&window.aipkit_task_cw_populateModels(i,e));let t=document.getElementById("aipkit_task_cc_ai_temperature");if(t){t.value=o.ai_temperature||1;let f=document.getElementById(t.id+"_value");f&&(f.textContent=t.value)}let c=document.getElementById("aipkit_task_cc_content_max_tokens");if(c){c.value=o.content_max_tokens||4e3;let f=document.getElementById(c.id+"_value");f&&(f.textContent=c.value),c.dispatchEvent(new Event("change",{bubbles:!0}))}let s=r.elements.cc_reasoning_effort;if(s){let f=o.reasoning_effort||"";f&&(s.value=f==="minimal"?"low":f,s.dispatchEvent(new Event("change",{bubbles:!0})))}e&&typeof window.aipkit_autogpt_cc_toggleReasoningEffort=="function"&&setTimeout(()=>e.dispatchEvent(new Event("change",{bubbles:!0})),100);let n=document.getElementById("aipkit_task_cc_custom_content_prompt");n&&(n.value=o.custom_content_prompt||"");let d=document.getElementById("aipkit_task_comment_reply_include_keywords");d&&(d.value=o.include_keywords||"");let a=document.getElementById("aipkit_task_comment_reply_exclude_keywords");a&&(a.value=o.exclude_keywords||"");let l=r.elements["post_types_for_comments[]"];l&&(Array.from(l.options).forEach(f=>f.selected=!1),(o.post_types_for_comments||[]).forEach(f=>{let g=l.querySelector(`option[value="${f}"]`);g&&(g.selected=!0)}));let p=r.elements.reply_action;p&&(p.value=o.reply_action||"approve");let _=r.elements.no_reply_to_replies;_&&(_.checked=o.no_reply_to_replies==="1"),r.elements.task_frequency&&(r.elements.task_frequency.value=o.task_frequency||"hourly")}window.aipkit_form_populateCommentReplyFields=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_automated_tasks_config||{},i=window.aipkit_dashboard||{},e=r.default_cw_prompts||{};if(!o)return;o.elements.custom_title_prompt&&(o.elements.custom_title_prompt.value=e.title||""),o.elements.custom_content_prompt&&(o.elements.custom_content_prompt.value=e.content||""),o.elements.custom_meta_prompt&&(o.elements.custom_meta_prompt.value=e.meta||""),o.elements.custom_keyword_prompt&&(o.elements.custom_keyword_prompt.value=e.keyword||""),o.elements.image_prompt&&(o.elements.image_prompt.value=e.image||""),o.elements.featured_image_prompt&&(o.elements.featured_image_prompt.value=e.featured_image||"");let t=document.getElementById("aipkit_task_cw_ai_provider"),c=document.getElementById("aipkit_task_cw_ai_model");if(t&&c){let n=(i.main_provider||"openai").toLowerCase();if(t.value=n,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(t,c);let d="",a=i?.models?.[n];switch(n){case"openai":d="gpt-4.1-mini";break;case"google":d="gemini-1.5-flash-latest";break;case"openrouter":d="moonshotai/kimi-k2.5";break;case"claude":d="claude-opus-4-6",Array.isArray(a)&&a.length>0&&(a.some(p=>p&&p.id==="claude-opus-4-6")||(d=a[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(a)&&a.length>0&&(d=a[0].id||"");break}c.querySelector(`option[value="${CSS.escape(d)}"]`)?c.value=d:console.warn(`Default model ${d} not found for provider ${n}.`)}}let s=document.getElementById("aipkit_task_cw_content_length");s&&(s.value="medium",s.dispatchEvent(new Event("change",{bubbles:!0}))),o.elements.generate_images_enabled&&(o.elements.generate_images_enabled.checked=!1),o.elements.image_provider&&(o.elements.image_provider.value="openai"),typeof window.aipkit_updateTaskImageSettingsUI=="function"&&(window.aipkit_updateTaskImageSettingsUI(),setTimeout(()=>{o.elements.image_model&&(o.elements.image_model.value="gpt-image-1")},0)),o.elements.image_count&&(o.elements.image_count.value="1"),o.elements.image_placement&&(o.elements.image_placement.value="after_first_h2"),o.elements.generate_featured_image&&(o.elements.generate_featured_image.checked=!1)}window.aipkit_form_setContentWritingDefaults=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_dashboard||{};if(!o)return;let i=document.getElementById("aipkit_task_cc_custom_content_prompt");i&&(i.value=`Write a helpful and friendly reply to this comment on my blog post titled '{post_title}'.

Comment: {comment_content}`);let e=document.getElementById("aipkit_task_cc_ai_provider"),t=document.getElementById("aipkit_task_cc_ai_model");if(e&&t){let s=(r.main_provider||"openai").toLowerCase();if(e.value=s,typeof window.aipkit_task_cw_populateModels=="function"){window.aipkit_task_cw_populateModels(e,t);let n="",d=(r.models||{})[s]||{};switch(s){case"openai":n="gpt-4o-mini";break;case"google":n="gemini-1.5-flash-latest";break;case"openrouter":n="moonshotai/kimi-k2.5";break;case"claude":n="claude-opus-4-6",Array.isArray(d)&&d.length>0&&(d.some(l=>l&&l.id==="claude-opus-4-6")||(n=d[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(d)&&d.length>0&&(n=d[0].id||"");break}t.querySelector(`option[value="${CSS.escape(n)}"]`)&&(t.value=n)}}let c=document.getElementById("aipkit_task_cc_content_max_tokens");c&&(c.value="4000",c.dispatchEvent(new Event("change",{bubbles:!0})))}window.aipkit_form_setCommentReplyDefaults=k})();(function(){"use strict";function k(o,r,i,e=null){let t=document.getElementById("aipkit_automated_task_form"),c=document.getElementById("aipkit_automated_task_queue_wrapper");if(!t){console.error("Show Task Form: Core form element not found.");return}if(typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard(),t.reset(),t.elements.task_id&&(t.elements.task_id.value=""),window.aipkit_automated_tasks_form_state&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=null),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus("","info"),e){let l=((window.aipkit_automated_tasks_config||{}).task_types||{})[e.task_type];if(l){let p=t.elements.task_category;if(p){p.value=l.category;let _=new Event("change",{bubbles:!0});p.dispatchEvent(_)}}}else{let a=t.elements.task_category,l=t.elements.task_type;a&&l&&(a.value="content_creation",a.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{l.value="content_writing_bulk",l.dispatchEvent(new Event("change",{bubbles:!0}))},0))}typeof window.aipkit_form_populateCommonFields=="function"?window.aipkit_form_populateCommonFields(t,e):console.error("Show Task Form: aipkit_form_populateCommonFields function is missing.");let s=t.elements.task_type;if(s&&typeof window.aipkit_form_handleTaskTypeChange=="function"&&window.aipkit_form_handleTaskTypeChange({target:s}),e){let a=JSON.parse(e.task_config||"{}");e.task_type==="content_indexing"?typeof window.aipkit_form_populateContentIndexingFields=="function"?window.aipkit_form_populateContentIndexingFields(a):console.error("Show Task Form: aipkit_form_populateContentIndexingFields function is missing."):e.task_type.startsWith("content_writing")?typeof window.aipkit_form_populateContentWritingFields=="function"?window.aipkit_form_populateContentWritingFields(a):console.error("Show Task Form: aipkit_form_populateContentWritingFields function is missing."):e.task_type==="community_reply_comments"?typeof window.aipkit_form_populateCommentReplyFields=="function"?window.aipkit_form_populateCommentReplyFields(a):console.error("Show Task Form: aipkit_form_populateCommentReplyFields function is missing."):e.task_type==="enhance_existing_content"&&(typeof window.aipkit_form_populateContentEnhancementFields=="function"?window.aipkit_form_populateContentEnhancementFields(a):console.error("Show Task Form: aipkit_form_populateContentEnhancementFields function is missing."))}o&&(o.style.display="block"),r&&(r.style.display="none"),c&&(c.style.display="none"),i&&(i.style.display="none");let n=document.getElementById("aipkit_autogpt_editor_actions");n&&(n.style.display="flex");let d=document.getElementById("aipkit_autogpt_cron_info");d&&(d.style.display="none"),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers()}window.aipkit_form_showAutomatedTaskForm=k})();(function(){"use strict";function k(o,r,i){let e=document.getElementById("aipkit_automated_task_queue_wrapper");o&&(o.style.display="none"),r&&(r.style.display="block"),e&&(e.style.display="block"),i&&(i.style.display="inline-flex");let t=document.getElementById("aipkit_autogpt_editor_actions");t&&(t.style.display="none");let c=document.getElementById("aipkit_autogpt_cron_info");c&&(c.style.display="inline-flex");let s=document.getElementById("aipkit_automated_task_form"),n=document.getElementById("aipkit_automated_task_id"),d=document.getElementById("aipkit_automated_task_category"),a=document.getElementById("aipkit_autogpt_header_title_default"),l=document.getElementById("aipkit_autogpt_header_title_editor"),p=document.getElementById("aipkit_autogpt_title_display"),_=document.getElementById("aipkit_autogpt_task_title_input");s&&s.reset(),n&&(n.value=""),a&&(a.style.display="block"),l&&(l.style.display="none"),p&&(p.style.display="inline-flex"),_&&(_.style.display="none"),d&&(d.value="",d.dispatchEvent(new Event("change",{bubbles:!0}))),typeof window.aipkit_resetWizard=="function"&&window.aipkit_resetWizard()}window.aipkit_form_hideAutomatedTaskForm=k})();(function(){"use strict";let k=()=>{typeof window.aipkit_updateAutogptPromptPlaceholders=="function"&&window.aipkit_updateAutogptPromptPlaceholders()};function o(t,c,s,n){if(!t||!c)return;t.innerHTML="";let d={content_writing_bulk:{icon:"dashicons-edit"},content_writing_csv:{icon:"dashicons-media-spreadsheet"},content_writing_rss:{icon:"dashicons-rss"},content_writing_url:{icon:"dashicons-admin-links"},content_writing_gsheets:{icon:"dashicons-analytics"}};s.forEach(([a,l])=>{let p=document.createElement("label");p.className="aipkit_cw_mode_card aipkit_autogpt_task_type_card",p.classList.toggle("is-active",a===n);let _=document.createElement("input");_.type="radio",_.name="aipkit_task_type_radio",_.value=a,_.checked=a===n,_.disabled=!!l.disabled,_.className="aipkit_task_type_input",_.addEventListener("change",()=>{_.checked&&(c.value=a,c.dispatchEvent(new Event("change",{bubbles:!0})),t.querySelectorAll(".aipkit_cw_mode_card").forEach(h=>h.classList.remove("is-active")),p.classList.add("is-active"))});let f=d[a]||{},g=document.createElement("span");g.className="aipkit_cw_mode_icon",g.innerHTML=`<span class="dashicons ${f.icon||"dashicons-admin-generic"}"></span>`;let m=document.createElement("span");m.className="aipkit_cw_mode_text";let u=document.createElement("span");u.className="aipkit_cw_mode_title",u.textContent=l.label,m.appendChild(u),l.disabled&&(p.classList.add("is-disabled"),p.setAttribute("aria-disabled","true")),p.appendChild(_),p.appendChild(g),p.appendChild(m),t.appendChild(p)})}function r(t,c){t&&t.querySelectorAll('input[name="aipkit_task_type_radio"]').forEach(s=>{let n=s.value===c;s.checked=n;let d=s.closest(".aipkit_cw_mode_card");d&&d.classList.toggle("is-active",n)})}function i(t){let c=t.target.value,s=document.querySelector(".aipkit_autogpt_form_right"),n=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;if(s){let v=!n&&c==="content_enhancement";s.style.display=v?"none":""}let d=document.getElementById("aipkit_automated_task_type"),a=document.getElementById("aipkit_automated_task_type_group"),l=document.getElementById("aipkit_automated_task_type_radios"),p=(window.aipkit_automated_tasks_config||{}).task_types||{},_=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),f=_.lastTaskTypeByCategory||{};_.lastTaskTypeByCategory=f;let g=window.aipkit_escapeHtml||function(v){return v};d.innerHTML="",d.disabled=!0,a&&(a.style.display="none"),l&&(l.innerHTML="");let m=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(m&&m.querySelectorAll(".aipkit_task_config_section").forEach(v=>{v.id==="aipkit_task_cw_input_modes_wrapper"&&v.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(S=>{S.style.display="none"}),v.style.display="none"}),!c){d.appendChild(new Option(g("-- Select a category first --"),"")),d.dispatchEvent(new Event("change",{bubbles:!0}));return}let u=Object.entries(p).filter(([v,S])=>S.category===c);if(u.length===0)d.appendChild(new Option(g("-- No tasks in this category --"),""));else if(u.length===1){let[v,S]=u[0],q=new Option(g(S.label),v);S.disabled&&(q.disabled=!0),d.appendChild(q),d.value=v,d.disabled=!0,a&&(a.style.display="none")}else d.appendChild(new Option(g("-- Select a Task Type --"),"")),u.forEach(([v,S])=>{let q=new Option(g(S.label),v);S.disabled&&(q.disabled=!0),d.appendChild(q)}),d.disabled=!1;if(u.length>1){let v=f[c];!v&&c==="content_creation"&&(v="content_writing_bulk"),!v&&u.length>0&&d.options.length&&(v=u[0][0]),v&&(d.value=v)}let h=!!l&&u.length>1&&c==="content_creation";a&&(a.style.display=h?"":"none"),l&&(h?o(l,d,u,d.value):l.innerHTML=""),d.dispatchEvent(new Event("change",{bubbles:!0}))}function e(t){let c=t.target.value,s=document.getElementById("aipkit_automated_task_type_radios");r(s,c);let n=document.getElementById("aipkit_automated_task_id"),d=!n||!n.value,a=document.getElementById("aipkit_wizard_next_btn"),l=a?a.querySelector(".aipkit_btn-text"):null,p=document.getElementById("aipkit_save_task_btn"),_=p?p.querySelector(".aipkit_btn-text"):null,f=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,m=((window.aipkit_automated_tasks_config||{}).task_types||{})[c],u=m&&m.pro===!0,h=(window.aipkit_automated_tasks_config||{}).text||{};if(m){let C=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={}),b=C.lastTaskTypeByCategory||{};b[m.category]=c,C.lastTaskTypeByCategory=b}typeof window.aipkit_renderWizard=="function"?window.aipkit_renderWizard(c):console.error("Task Type Change: aipkit_renderWizard function is missing.");let v=document.querySelector(".aipkit_task_schedule_frequency"),S=document.getElementById("aipkit_automated_task_frequency");if(v&&S){let C=window.aipkit_automated_tasks_form_state||(window.aipkit_automated_tasks_form_state={});c==="content_writing_bulk"||c==="content_writing_csv"?(!C.lastVisibleFrequency&&S.value&&(C.lastVisibleFrequency=S.value),S.value="one-time",v.style.display="none"):(v.style.display="",C.lastVisibleFrequency&&S.value==="one-time"&&(S.value=C.lastVisibleFrequency),C.lastVisibleFrequency=S.value)}let q=document.querySelectorAll("[data-aipkit-task-publishing]");if(q.length){let C=c&&c.startsWith("content_writing");q.forEach(b=>{b.style.display=C?"":"none"})}u&&!f?(l&&a&&(a.dataset.action="next",l.textContent=h.wizard_next_button||"Next",a.style.display="none"),_&&p&&(p.dataset.action="save",_.textContent=h.save_task_button||"Save Task",p.style.display="none")):(l&&a&&(a.dataset.action="next",l.textContent=h.wizard_next_button||"Next",a.style.display=""),_&&p&&(p.dataset.action="save",_.textContent=h.save_task_button||"Save Task",p.style.display=""));let y=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]');if(!y){console.error("Task Type Change: Could not find setup pane.");return}let E=y.querySelector("#aipkit_task_ci_source_wrapper"),I=y.querySelector("#aipkit_task_cw_input_modes_wrapper"),w=y.querySelector("#aipkit_task_cc_source_wrapper"),A=y.querySelector("#aipkit_task_ce_content_selection_wrapper");if(E&&(E.style.display="none"),I&&(I.style.display="none"),w&&(w.style.display="none"),A&&(A.style.display="none"),!!c){if(c==="content_indexing")E&&(E.style.display="block");else if(c.startsWith("content_writing")){if(k(),I){I.style.display="block";let C=c.replace("content_writing_",""),b=C==="content_writing"?"bulk":C,x=document.getElementById("aipkit_task_cw_generation_mode");x&&(x.value=b),I.querySelectorAll(".aipkit_task_cw_input_mode_section").forEach(T=>{T.id===`aipkit_task_cw_input_mode_${b}`?T.style.display="block":T.style.display="none"})}}else if(c==="community_reply_comments")w&&(w.style.display="block");else if(c==="enhance_existing_content"){A&&(A.style.display="block");let C=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),b=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(C&&b){let x=C.querySelector("#aipkit_task_ce_post_types");if(x&&!x.dataset.placeholderListenerAttached){let T=()=>{let H=Array.from(x.selectedOptions).map(F=>F.value).includes("product");b.querySelectorAll(".aipkit-product-placeholders").forEach(F=>{F.style.display=H?"inline":"none"})};x.addEventListener("change",T),x.dataset.placeholderListenerAttached="true",T()}}}d&&(c.startsWith("content_writing")?typeof window.aipkit_form_setContentWritingDefaults=="function"&&window.aipkit_form_setContentWritingDefaults():c==="community_reply_comments"?typeof window.aipkit_form_setCommentReplyDefaults=="function"&&window.aipkit_form_setCommentReplyDefaults():c==="enhance_existing_content"&&typeof window.aipkit_form_setContentEnhancementDefaults=="function"&&window.aipkit_form_setContentEnhancementDefaults()),c==="content_indexing"?typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI():c.startsWith("content_writing")?typeof window.aipkit_initContentWritingTaskFormUI=="function"&&window.aipkit_initContentWritingTaskFormUI():c==="community_reply_comments"?typeof window.aipkit_initCommentReplyTaskFormUI=="function"&&window.aipkit_initCommentReplyTaskFormUI():c==="enhance_existing_content"&&(typeof window.aipkit_initContentEnhancementTaskFormUI=="function"?setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0):console.error("[handleTaskTypeChange] aipkit_initContentEnhancementTaskFormUI not found!"))}}window.aipkit_form_handleCategoryChange=i,window.aipkit_form_handleTaskTypeChange=e})();(function(){"use strict";function k(o,r="info"){let i=document.getElementById("aipkit_automated_task_form_status");if(!i)return;let e=i.classList.contains("aipkit_training_status");if(!o){i.textContent="",e?i.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):i.className="aipkit_form-help";return}if(i.textContent=o,e){let t=r==="info"?"loading":r;i.classList.remove("is-success","is-error","is-warning","is-loading"),i.classList.add("is-visible"),t&&i.classList.add(`is-${t}`)}else i.className=`aipkit_form-help aipkit_settings_message-${r}`;setTimeout(()=>{i.textContent===o&&(i.textContent="",e?i.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"):i.className="aipkit_form-help")},5e3)}window.aipkit_form_showAutomatedTaskFormStatus=k})();(function(){"use strict";function k(o){let r=new FormData(o),i=Object.fromEntries(r.entries());return i.task_type=document.getElementById("aipkit_automated_task_type").value,{formData:r,data:i}}window.aipkit_save_task_extractBaseData=k})();(function(){"use strict";function k(o,r){if(o.task_type==="content_indexing"){if(o.post_types=r.getAll("post_types[]"),o.target_store_provider=r.get("target_store_provider")||"openai",o.target_store_id=r.get("target_store_id")||"",o.target_store_provider==="pinecone"||o.target_store_provider==="qdrant"){let e=r.get("embedding_model")||"";if(e&&e.includes(":")){let[t,c]=e.split(":",2);o.embedding_provider=t,o.embedding_model=c}else o.embedding_provider="",o.embedding_model=e}else delete o.embedding_provider,delete o.embedding_model;["ai_provider","ai_model","content_title_bulk","content_keywords","ai_temperature","content_max_tokens","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","enable_vector_store","vector_store_provider","openai_vector_store_ids","openai_vector_store_ids[]","pinecone_index_name","qdrant_collection_name","vector_store_top_k","csv_file_input","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete o[e])}else delete o.post_types,delete o["post_types[]"],delete o.target_store_provider,delete o.target_store_id,delete o.index_existing_now_flag,delete o.only_new_updated_flag,delete o.embedding_model,delete o.embedding_provider;return o}window.aipkit_save_task_handleContentIndexing=k})();(function(){"use strict";function k(o,r){return o.task_type.startsWith("content_writing")?(o.post_categories=r.getAll("post_categories[]"),o.openai_vector_store_ids=r.getAll("openai_vector_store_ids[]"),delete o["post_categories[]"],delete o["openai_vector_store_ids[]"],["post_types","post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","ce_post_types","ce_post_types[]","ce_post_categories","ce_post_categories[]","ce_post_authors","ce_post_authors[]","ce_post_statuses","ce_post_statuses[]","ce_update_title","ce_update_excerpt","ce_update_content","ce_update_meta","ce_title_prompt","ce_excerpt_prompt","ce_content_prompt","ce_meta_prompt","ce_ai_provider","ce_ai_model","ce_ai_temperature","ce_content_max_tokens","ce_enable_vector_store","ce_vector_store_provider","ce_openai_vector_store_ids","ce_openai_vector_store_ids[]","ce_pinecone_index_name","ce_qdrant_collection_name","ce_vector_embedding_provider","ce_vector_embedding_model","ce_vector_store_top_k","ce_enhance_existing_now_flag"].forEach(e=>delete o[e]),delete o.replicate_api_key,delete o.pexels_api_key,delete o.pixabay_api_key):(delete o.content_title,delete o.content_title_bulk,delete o.content_keywords,delete o.content_length,delete o.ai_temperature,delete o.post_type,delete o.post_author,delete o.post_status,delete o["post_categories[]"],delete o.post_categories,delete o.prompt_mode,delete o.custom_title_prompt,delete o.custom_content_prompt,delete o.generate_meta_description,delete o.custom_meta_prompt,delete o.generate_focus_keyword,delete o.custom_keyword_prompt,delete o.cw_generation_mode,delete o.rss_feeds,delete o.gsheets_sheet_id,delete o.gsheets_credentials,delete o.url_list,delete o.generate_toc,delete o.generate_images_enabled,delete o.image_provider,delete o.image_model,delete o.image_prompt,delete o.image_count,delete o.image_placement,delete o.image_placement_param_x,delete o.image_alignment,delete o.image_size,delete o.generate_featured_image,delete o.featured_image_prompt,delete o.pexels_orientation,delete o.pexels_size,delete o.pexels_color,delete o.pexels_api_key,delete o.pixabay_orientation,delete o.pixabay_image_type,delete o.pixabay_category,delete o.pixabay_api_key,delete o.replicate_api_key,delete o.enable_vector_store,delete o.vector_store_provider,delete o["openai_vector_store_ids[]"],delete o.openai_vector_store_ids,delete o.pinecone_index_name,delete o.qdrant_collection_name,delete o.vector_embedding_provider,delete o.vector_embedding_model,delete o.vector_store_top_k,delete o.rss_include_keywords,delete o.rss_exclude_keywords),o}window.aipkit_save_task_handleContentWriting=k})();(function(){"use strict";function k(o){let i=(window.aipkit_automated_tasks_config||{}).text||{};if(!o.task_name)return i.task_name_required||"Task name is required.";if(!o.task_category)return i.task_category_required||"Task category is required.";if(!o.task_type)return i.task_type_required||"Task type is required.";if(o.task_type==="content_indexing"){if(!o.target_store_id)return i.target_store_required||"A target vector store/index must be selected.";if(!o.post_types||o.post_types.length===0)return i.content_type_required||"Please select content types for indexing.";if(o.target_store_provider==="pinecone"||o.target_store_provider==="qdrant"){if(!o.embedding_provider)return i.embedding_provider_required||"Embedding provider is required for this vector provider.";if(!o.embedding_model)return i.embedding_model_required||"Embedding model is required for this vector provider."}}if(o.task_type.startsWith("content_writing")){let e=o.cw_generation_mode||"bulk";if(e==="bulk"){if(!o.content_title_bulk?.trim())return i.content_title_required_cw_task||"At least one topic is required for Bulk mode."}else if(e==="csv"){if(!o.content_title?.trim())return i.csv_required_cw_task||"Please upload a CSV file."}else{if(e==="rss"&&!o.rss_feeds?.trim())return i.rss_required_cw_task||"Please add at least one RSS feed.";if(e==="url"&&!o.url_list?.trim())return i.url_required_cw_task||"Please add at least one URL.";if(e==="gsheets"){if(!o.gsheets_sheet_id?.trim())return i.gsheets_id_required_cw_task||"Please add a Google Sheet ID.";if(!o.gsheets_credentials?.trim())return i.gsheets_credentials_required_cw_task||"Please add Google Sheets credentials."}else if(e==="single"&&!o.content_title?.trim())return i.content_title_required_cw_task||"Please add a topic."}if(!o.custom_content_prompt?.trim())return"The Content Prompt cannot be empty.";if(!o.ai_provider||!o.ai_model)return i.ai_config_required_cw_task||"AI Provider and Model are required for Content Writing task."}if(o.task_type==="enhance_existing_content"){if(!o.post_types||o.post_types.length===0)return"Please select at least one post type to update.";if(o.update_title!=="1"&&o.update_excerpt!=="1"&&o.update_content!=="1"&&o.update_meta!=="1")return"Please select at least one field to update (Title, Excerpt, Content, or Meta Description)."}return!0}window.aipkit_save_task_validateData=k})();(function(){"use strict";async function k(o){let r=window.aipkit_automated_tasks_config||{},i={...o,_ajax_nonce:r.nonce_manage_tasks};return typeof window.aipkit_apiRequest!="function"?Promise.reject(new Error("API request function is missing.")):await window.aipkit_apiRequest("aipkit_save_automated_task",i)}window.aipkit_save_task_submitRequest=k})();(function(){"use strict";function k(){typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_form_hideAutomatedTaskForm=="function"&&window.aipkit_form_hideAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"))}window.aipkit_save_task_finalizeSuccess=k})();(function(){"use strict";async function k(o){if(o.preventDefault(),window.aipkit_automated_tasks_form_state.isSubmitting)return;let r=o.target,i=document.getElementById("aipkit_save_task_btn");if(i&&i.dataset.action==="upgrade"){let c=window.aipkit_dashboard?.upgradeUrl;c?window.open(c,"_blank"):console.error("Upgrade URL not found.");return}window.aipkit_automated_tasks_form_state.isSubmitting=!0;let e=(window.aipkit_automated_tasks_config||{}).text||{},t=e.save_task_button||"Save Task";try{let{formData:c,data:s}=window.aipkit_save_task_extractBaseData(r),n;s.task_type==="content_indexing"?n=window.aipkit_save_task_handleContentIndexing(s,c):s.task_type.startsWith("content_writing")?n=window.aipkit_save_task_handleContentWriting(s,c):s.task_type==="enhance_existing_content"?n=window.aipkit_save_task_handleContentEnhancement(s,c):n=s;let d=window.aipkit_save_task_validateData(n);if(d!==!0)throw typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(d,"error"),new Error("Validation failed: "+d);typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,t,e.saving_task||"Saving..."),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(e.saving_task||"Saving task...","info");let a=await window.aipkit_save_task_submitRequest(n);typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&window.aipkit_form_showAutomatedTaskFormStatus(a.message||"Task saved successfully!","success"),typeof window.aipkit_save_task_finalizeSuccess=="function"&&window.aipkit_save_task_finalizeSuccess()}catch(c){console.error("Save Task Error:",c),typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"&&c.message.indexOf("Validation failed:")===-1&&window.aipkit_form_showAutomatedTaskFormStatus(`Error: ${c.message||"Failed to save task."}`,"error")}finally{window.aipkit_automated_tasks_form_state.isSubmitting=!1,typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,t)}}window.aipkit_form_handleSaveTask=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_form"),r=document.getElementById("aipkit_autogpt_task_status_toggle"),i=document.getElementById("aipkit_autogpt_task_status_input"),e=document.getElementById("aipkit_autogpt_task_status_label"),t=document.getElementById("aipkit_autogpt_task_status_card"),c=document.getElementById("aipkit_automated_task_category"),s=document.querySelector("[data-aipkit-autogpt-category-selector]"),n=s?Array.from(s.querySelectorAll(".aipkit_cw_mode_card")):[],d=document.getElementById("aipkit_automated_task_type"),a=document.getElementById("aipkit_cancel_edit_task_btn"),l=document.getElementById("aipkit_automated_task_form_wrapper"),p=document.getElementById("aipkit_automated_task_list_wrapper"),_=document.getElementById("aipkit_add_new_task_btn");typeof window.aipkit_initWizardNavigation=="function"?window.aipkit_initWizardNavigation():console.error("Automated Task Form Init: Wizard Navigation function not found."),o&&typeof window.aipkit_form_handleSaveTask=="function"?o.addEventListener("submit",window.aipkit_form_handleSaveTask):o&&console.error("Automated Task Form Init: handleSaveTask function not found."),c&&typeof window.aipkit_form_handleCategoryChange=="function"?c.addEventListener("change",window.aipkit_form_handleCategoryChange):c&&console.error("Automated Task Form Init: handleCategoryChange function not found.");let f=m=>{n.length&&n.forEach(u=>{let h=u.dataset.category===m;u.classList.toggle("is-active",h),u.setAttribute("aria-pressed",h?"true":"false")})};c&&n.length&&(n.forEach(m=>{m.addEventListener("click",()=>{let u=m.dataset.category||"";!u||u===c.value||(c.value=u,c.dispatchEvent(new Event("change",{bubbles:!0})))})}),c.addEventListener("change",()=>{f(c.value)}),f(c.value||"")),d&&typeof window.aipkit_form_handleTaskTypeChange=="function"?(d.addEventListener("change",window.aipkit_form_handleTaskTypeChange),window.aipkit_form_handleTaskTypeChange({target:d})):d&&console.error("Automated Task Form Init: handleTaskTypeChange function not found."),a&&typeof window.aipkit_form_hideAutomatedTaskForm=="function"?a.addEventListener("click",()=>{window.aipkit_form_hideAutomatedTaskForm(l,p,_)}):a&&console.error("Automated Task Form Init: hideAutomatedTaskForm function not found."),typeof window.aipkit_initContentIndexingTaskFormUI=="function"&&window.aipkit_initContentIndexingTaskFormUI();let g=()=>{if(!r||!i||!e)return;let m=(i.value||"active")==="active";r.checked=m,e.textContent=m?"Active":"Paused",t&&(t.dataset.status=m?"active":"paused")};window.aipkit_syncTaskStatusToggle=g,r&&i&&e&&(r.dataset.statusListenerAttached||(r.addEventListener("change",()=>{i.value=r.checked?"active":"paused",g()}),r.dataset.statusListenerAttached="true"),g())}window.aipkit_form_initAutomatedTaskForm=k})();(function(){"use strict";let k=!1,o=null,r=null;window.aipkit_automated_tasks_form_state={get isSubmitting(){return k},set isSubmitting(e){k=e},get pendingModelSelection(){return o},set pendingModelSelection(e){o=e},get pendingEmbeddingModelSelection(){return r},set pendingEmbeddingModelSelection(e){r=e}};function i(){typeof window.aipkit_form_initAutomatedTaskForm=="function"?window.aipkit_form_initAutomatedTaskForm():console.error("Automated Tasks Form Handler: aipkit_form_initAutomatedTaskForm function not found.")}window.aipkit_initAutomatedTaskForm=i})();(function(){"use strict";function k(o,r){o&&(o.classList.toggle("aipkit_loading",!!r),o.disabled=!!r)}window.aipkit_setAutogptActionButtonLoading=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_config||{},e=i.text||{},t=window.aipkit_escapeHtml||function(a){return a},c=window.aipkit_ucfirst||function(a){return a?a.charAt(0).toUpperCase()+a.slice(1):""},s=i.frequencies||{},n=window.aipkit_automated_tasks_list_state;if(document.querySelectorAll("#aipkit_automated_task_list_wrapper th.aipkit-sortable-col").forEach(a=>{a.removeAttribute("data-sort-direction"),n&&a.dataset.sortBy===n.sortBy&&a.setAttribute("data-sort-direction",n.sortOrder.toLowerCase())}),!r){console.warn("Render Tasks Table: Table body not found.");return}if(r.innerHTML="",!o||o.length===0){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${e.no_tasks_configured||"No automated tasks configured yet."}</td></tr>`;return}o.forEach(a=>{let l=JSON.parse(a.task_config||"{}"),p=r.insertRow(),_=p.insertCell();_.textContent=t(a.task_name);let f=p.insertCell(),m=(i.task_types?.[a.task_type]||{}).label||c(a.task_type.replace(/_/g," "));f.innerHTML=`<span class="aipkit_task_type_badge" data-type="${t(a.task_type)}">${t(m)}</span>`;let u=l.indexing_frequency||l.task_frequency||"N/A",h=s[u]||c(u.replace(/_/g," "));p.insertCell().textContent=t(h);let v=p.insertCell();v.innerHTML=`<span class="aipkit_job_status_${t(a.status)}">${t(c(a.status))}</span>`;let S=p.insertCell(),q=a.last_run_time?new Date(a.last_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.never_run||"Never",y=a.next_run_time&&typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(a.next_run_time):a.next_run_time?new Date(a.next_run_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.not_scheduled||"Not Scheduled";S.innerHTML=`
        <div class="aipkit_task_timing">
          <div class="aipkit_task_timing_last">
            <span class="aipkit_task_timing_label">${e.last_label||"Last"}</span>
            <span class="aipkit_task_timing_value${a.last_run_time?"":" aipkit_never"}">${t(q)}</span>
          </div>
          <div class="aipkit_task_timing_next">
            <span class="aipkit_task_timing_label">${e.next_label||"Next"}</span>
            <span class="aipkit_task_timing_value">${t(y)}</span>
          </div>
        </div>
      `;let E=p.insertCell();E.className="aipkit_actions_cell",E.innerHTML=`
        <div class="aipkit-table-actions-group">
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="edit" data-task-id="${a.id}" title="${e.edit_button||"Edit"}">
            <span class="dashicons dashicons-edit" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${e.edit_button||"Edit"}</span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="${a.status==="active"?"pause":"resume"}" data-task-id="${a.id}" title="${a.status==="active"?e.pause_button||"Pause":e.resume_button||"Resume"}">
            <span class="dashicons ${a.status==="active"?"dashicons-controls-pause":"dashicons-controls-play"}" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${a.status==="active"?e.pause_button||"Pause":e.resume_button||"Resume"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled aipkit_btn-spinner-only" data-action="run_now" data-task-id="${a.id}" ${a.status!=="active"?"disabled":""} title="${a.status!=="active"?e.task_not_active_run_title||"Task must be active to run":e.run_now_button||"Run Now"}">
            <span class="dashicons dashicons-controls-skipforward" aria-hidden="true"></span>
            <span class="aipkit_btn_label">${e.run_now_button||"Run"}</span>
            <span class="aipkit_spinner" aria-hidden="true"></span>
          </button>
          <button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete" data-task-id="${a.id}" title="${e.delete_button||"Delete"}">
            <span class="dashicons dashicons-trash" aria-hidden="true"></span>
          </button>
        </div>
      `})}window.aipkit_list_renderTasksTable=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_task_list_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render List Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:t,total_pages:c,current_page:s}=o||{};if(!c||c<=1){t>0&&(r.innerHTML=`<span class="aipkit_pagination-count">${Number(t).toLocaleString()} ${Number(t)===1?e.task_singular||"task":e.task_plural||"tasks"}</span>`);return}let n=document.createElement("span");n.className="aipkit_pagination-count",n.textContent=`${Number(t).toLocaleString()} ${Number(t)===1?e.task_singular||"task":e.task_plural||"tasks"}`,r.appendChild(n);let d=document.createElement("span");d.className="aipkit_pagination-links";let a=document.createElement("button");a.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",a.innerHTML=`\xAB ${e.previous_button||"Previous"}`,a.disabled=Number(s)<=1,a.disabled||(a.dataset.page=Number(s)-1),d.appendChild(a);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`${e.page_label||"Page"} ${Number(s)} ${e.of_label||"of"} ${Number(c)}`,d.appendChild(l);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",p.innerHTML=`${e.next_button||"Next"} \xBB`,p.disabled=Number(s)>=Number(c),p.disabled||(p.dataset.page=Number(s)+1),d.appendChild(p),r.appendChild(d)}window.aipkit_list_renderListPagination=k})();(function(){"use strict";async function k(o=1){let r=document.getElementById("aipkit_automated_tasks_tbody"),i=window.aipkit_automated_tasks_list_state,e=window.aipkit_automated_tasks_config||{},t=e.text||{};if(!r){console.warn("Fetch Tasks: Table body not found.");return}r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${t.loading_tasks||"Loading tasks..."}</td></tr>`,i&&(i.page=o);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let c={page:o,search:i?i.search:"",orderby:i?i.sortBy:"created_at",order:i?i.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},s=await window.aipkit_apiRequest("aipkit_get_automated_tasks",c);window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks=s.tasks||[]:console.warn("Fetch Tasks: List state object not available to store tasks."),typeof window.aipkit_list_renderTasksTable=="function"?window.aipkit_list_renderTasksTable(s.tasks||[]):console.error("Fetch Tasks: renderTasksTable function not found."),typeof window.aipkit_list_renderListPagination=="function"?window.aipkit_list_renderListPagination(s.pagination||{}):console.error("Fetch Tasks: renderListPagination function not found.")}catch(c){console.error("Fetch Tasks Error:",c),r.innerHTML=`<tr><td colspan="7" class="aipkit_text-center aipkit_text-danger">${t.error_loading_tasks||"Error loading tasks:"} ${c.message||"Unknown error"}</td></tr>`}}window.aipkit_list_fetchTasks=k})();(function(){"use strict";function k(o){if(!o){console.error("Edit Task Action: Task data is missing.");return}typeof window.aipkit_form_showAutomatedTaskForm=="function"?window.aipkit_form_showAutomatedTaskForm(document.getElementById("aipkit_automated_task_form_wrapper"),document.getElementById("aipkit_automated_task_list_wrapper"),document.getElementById("aipkit_add_new_task_btn"),o):(console.error("Edit Task Action: showAutomatedTaskForm function is not available."),alert("Error: Cannot open the edit form."))}window.aipkit_handleEditTaskAction=k})();(function(){"use strict";async function k(o,r){let i=window.aipkit_automated_tasks_config||{},e=i.text||{},t=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!0,e.delete_button||"Delete",e.deleting_task||"Deleting...");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task",{task_id:r,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_deleted_success||"Task deleted successfully.","success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(s){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_deleting_task||"Error deleting task:"} ${s.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(o,!1,e.delete_button||"Delete")}},c=e.confirm_delete_task||"Are you sure you want to delete this task?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(c,{title:e.confirm_title||"Confirm",confirmText:e.delete_button||"Delete",cancelText:e.cancel_button||"Cancel",onConfirm:()=>{t()}});return}confirm(c)&&await t()}window.aipkit_handleDeleteTaskAction=k})();(function(){"use strict";async function k(o,r,i){let e=window.aipkit_automated_tasks_config||{},t=e.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!0):(o.classList.add("aipkit_loading"),o.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_update_automated_task_status",{task_id:r,status:i,_ajax_nonce:e.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${t.task_status_updated||"Task status updated to"} ${i}.`,"success"),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks()}catch(c){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${t.error_updating_status||"Error updating task status:"} ${c.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!1):(o.classList.remove("aipkit_loading"),o.disabled=!1)}}window.aipkit_handleToggleTaskStatusAction=k})();(function(){"use strict";async function k(o,r){let i=window.aipkit_automated_tasks_config||{},e=i.text||{};typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!0):(o.classList.add("aipkit_loading"),o.disabled=!0);try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");await window.aipkit_apiRequest("aipkit_run_automated_task_now",{task_id:r,_ajax_nonce:i.nonce_manage_tasks}),typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(e.task_run_initiated||"Task run initiated. Check queue below for progress.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(t){typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(`${e.error_initiating_run||"Error initiating task run:"} ${t.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setAutogptActionButtonLoading=="function"?window.aipkit_setAutogptActionButtonLoading(o,!1):(o.classList.remove("aipkit_loading"),o.disabled=!1)}}window.aipkit_handleRunNowTaskAction=k})();(function(){"use strict";async function k(o){let r=o.target.closest("button[data-action]");if(!r)return;let i=r.dataset.action,e=r.dataset.taskId;if(!e)return;let c=(window.aipkit_automated_tasks_list_state?window.aipkit_automated_tasks_list_state.tasks:[]).find(s=>s.id.toString()===e.toString());switch(i){case"edit":typeof window.aipkit_handleEditTaskAction=="function"&&window.aipkit_handleEditTaskAction(c);break;case"delete":typeof window.aipkit_handleDeleteTaskAction=="function"&&window.aipkit_handleDeleteTaskAction(r,e);break;case"pause":case"resume":if(typeof window.aipkit_handleToggleTaskStatusAction=="function"){let s=i==="pause"?"paused":"active";window.aipkit_handleToggleTaskStatusAction(r,e,s)}break;case"run_now":typeof window.aipkit_handleRunNowTaskAction=="function"&&window.aipkit_handleRunNowTaskAction(r,e);break;default:console.warn(`Unknown task action: ${i}`);break}}window.aipkit_list_handleTaskActionClick=k})();(function(){"use strict";function k(o){let r=o.target.closest("button[data-page]");if(r&&!r.disabled){let i=parseInt(r.dataset.page,10);typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks(i):console.error("List Pagination Click: aipkit_list_fetchTasks function not found.")}}window.aipkit_list_handleListPaginationClick=k})();(function(){"use strict";function k(o,r="info"){if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(o,r);return}let i=document.getElementById("aipkit_automated_task_form_status");i&&(i.textContent=o,i.className=`aipkit_form-help aipkit_settings_message-${r}`,setTimeout(()=>{i.textContent===o&&(i.textContent="",i.className="aipkit_form-help")},5e3))}window.aipkit_list_showAutomatedTaskStatus=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_list_wrapper"),r=document.getElementById("aipkit_automated_tasks_tbody"),i=document.getElementById("aipkit_add_new_task_btn"),e=document.getElementById("aipkit_automated_task_form_wrapper"),t=document.getElementById("aipkit_automated_task_list_pagination"),c=document.getElementById("aipkit_task_list_search_input"),s=o?o.querySelector(".aipkit_data-table"):null;if(i&&e&&o&&typeof window.aipkit_form_showAutomatedTaskForm=="function"&&i.addEventListener("click",()=>{window.aipkit_form_showAutomatedTaskForm(e,o,i)}),r&&typeof window.aipkit_list_handleTaskActionClick=="function"&&r.addEventListener("click",window.aipkit_list_handleTaskActionClick),t&&typeof window.aipkit_list_handleListPaginationClick=="function"&&t.addEventListener("click",window.aipkit_list_handleListPaginationClick),c){let n;c.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{let d=window.aipkit_automated_tasks_list_state;d&&(d.search=c.value.trim()),typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)},500)})}s&&s.addEventListener("click",n=>{let d=n.target.closest("th.aipkit-sortable-col");if(!d)return;let a=d.dataset.sortBy,l=window.aipkit_automated_tasks_list_state;if(!l)return;let p="DESC";l.sortBy===a&&(p=l.sortOrder==="DESC"?"ASC":"DESC"),l.sortBy=a,l.sortOrder=p,typeof window.aipkit_list_fetchTasks=="function"&&window.aipkit_list_fetchTasks(1)}),typeof window.aipkit_list_fetchTasks=="function"?window.aipkit_list_fetchTasks():console.error("Automated Task List Init: fetchTasks function not found.")}window.aipkit_list_initAutomatedTaskList=k})();(function(){"use strict";let k=[],o=1,r="",i="created_at",e="DESC";window.aipkit_automated_tasks_list_state={get tasks(){return[...k]},set tasks(c){k=Array.isArray(c)?c:[]},get page(){return o},set page(c){o=c},get search(){return r},set search(c){r=c},get sortBy(){return i},set sortBy(c){i=c},get sortOrder(){return e},set sortOrder(c){e=c}};function t(){typeof window.aipkit_list_initAutomatedTaskList=="function"?window.aipkit_list_initAutomatedTaskList():console.error("Automated Tasks List Handler: aipkit_list_initAutomatedTaskList function not found.")}window.aipkit_initAutomatedTaskList=t})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_task_queue_tbody"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),e=window.aipkit_automated_tasks_config||{},t=e.text||{},c=window.aipkit_escapeHtml||function(l){return l},s=window.aipkit_ucfirst||function(l){return l?l.charAt(0).toUpperCase()+l.slice(1):""},n=window.aipkit_automated_tasks_queue_state;if(document.querySelectorAll("#aipkit_automated_task_queue_viewer_area th.aipkit-sortable-col").forEach(l=>{l.removeAttribute("data-sort-direction"),n&&l.dataset.sortBy===n.sortBy&&l.setAttribute("data-sort-direction",n.sortOrder.toLowerCase())}),!r){console.warn("Render Queue Table: Table body not found.");return}r.innerHTML="";let a=Array.isArray(o)&&o.length>0;if(i&&(i.disabled=!a,i.setAttribute("aria-disabled",a?"false":"true"),a?i.title=t.delete_filtered_title||"Delete filtered items":i.title=t.queue_empty_delete||"No queue items available to delete."),!a){r.innerHTML=`<tr><td colspan="6" class="aipkit_text-center">${t.queue_empty||"Task queue is currently empty."}</td></tr>`;return}o.forEach(l=>{let p=r.insertRow(),_=p.insertCell(),f=document.createElement("textarea");f.innerHTML=l.target_title||`${t.target_id_prefix||"ID:"} ${l.target_identifier}`;let g=f.value,m=l.task_type.startsWith("content_writing"),u=l.task_type==="enhance_existing_content",h=null;m&&l.status==="completed"&&l.generated_post_id?h=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${l.generated_post_id}&action=edit`:u&&!isNaN(parseInt(l.target_identifier,10))&&(h=`${window.aipkit_dashboard&&window.aipkit_dashboard.adminUrl||"/wp-admin/"}post.php?post=${l.target_identifier}&action=edit`),h?_.innerHTML=`<a href="${h}" target="_blank" title="${c(t.edit_generated_post_title||"View post")}">${c(g)}</a>`:_.textContent=g,p.insertCell().textContent=c(l.task_name||`${t.task_id_prefix||"Task"} ${l.task_id}`);let v=p.insertCell(),S=e.task_types&&e.task_types[l.task_type]?e.task_types[l.task_type].label:s(l.task_type.replace(/_/g," "));v.innerHTML=`<span class="aipkit_task_type_badge" data-type="${c(l.task_type)}">${c(S)}</span>`;let q=p.insertCell(),y=`<span class="aipkit_job_status_${c(l.status)}">${c(s(l.status))}`;l.status==="failed"&&l.attempts>1&&(y+=` <small>(${l.attempts}x)</small>`),y+="</span>",l.status==="failed"&&l.error_message&&(y+=`<span class="aipkit_queue_error_message" title="${c(l.error_message)}">${c(l.error_message)}</span>`),q.innerHTML=y;let E=p.insertCell();if(l.added_at){let A=new Date(l.added_at.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),C=typeof window.aipkit_formatRelativeDateTime=="function"?window.aipkit_formatRelativeDateTime(l.added_at):A,b=`<div class="aipkit_queue_time_entry aipkit_queue_time_added" title="${c(A)}">${c(C)}</div>`;if(l.scheduled_gmt_time){let x=new Date(l.scheduled_gmt_time.replace(" ","T")+"Z").toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),T=typeof window.aipkit_formatFriendlyFutureDate=="function"?window.aipkit_formatFriendlyFutureDate(l.scheduled_gmt_time):x;b+=`<div class="aipkit_queue_time_entry aipkit_queue_time_scheduled" title="${c(x)}">${c(t.scheduled_for_label||"\u2192")} ${c(T)}</div>`}E.innerHTML=b}else E.textContent=t.not_applicable||"\u2014";let I=p.insertCell();I.className="aipkit_actions_cell";let w='<div class="aipkit-table-actions-group">';l.status==="failed"&&(w+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-labeled" data-action="retry_queue_item" data-item-id="${l.id}" title="${t.retry_button||"Retry"}"><span class="dashicons dashicons-controls-repeat" aria-hidden="true"></span><span class="aipkit_btn_label">${t.retry_button||"Retry"}</span></button>`),w+=`<button class="aipkit_btn aipkit_btn-small aipkit_btn-icon-only" data-action="delete_queue_item" data-item-id="${l.id}" title="${t.delete_button||"Delete"}"><span class="dashicons dashicons-trash" aria-hidden="true"></span></button>`,w+="</div>",I.innerHTML=w})}window.aipkit_queue_renderQueueTable=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_automated_task_queue_pagination"),e=(window.aipkit_automated_tasks_config||{}).text||{};if(!r){console.warn("Render Queue Pagination: Pagination container not found.");return}r.innerHTML="";let{total_items:t,total_pages:c,current_page:s}=o||{};if(!t||t<=0)return;let n=document.createElement("span");if(n.className="aipkit_pagination-count",n.textContent=`${Number(t).toLocaleString()} ${Number(t)===1?e.item_singular||"item":e.item_plural||"items"}`,r.appendChild(n),c>1){let d=document.createElement("span");d.className="aipkit_pagination-links";let a=document.createElement("button");a.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",a.innerHTML=`\xAB ${e.previous_button||"Previous"}`,a.disabled=Number(s)<=1,a.disabled||(a.dataset.page=Number(s)-1),d.appendChild(a);let l=document.createElement("span");l.className="aipkit_pagination-current",l.textContent=`${e.page_label||"Page"} ${Number(s)} ${e.of_label||"of"} ${Number(c)}`,d.appendChild(l);let p=document.createElement("button");p.className="aipkit_btn aipkit_btn-secondary aipkit_btn-small",p.innerHTML=`${e.next_button||"Next"} \xBB`,p.disabled=Number(s)>=Number(c),p.disabled||(p.dataset.page=Number(s)+1),d.appendChild(p),r.appendChild(d)}}window.aipkit_queue_renderQueuePagination=k})();(function(){"use strict";async function k(o=1){let r=window.aipkit_automated_tasks_queue_state;r?r.page=o:console.warn("Fetch/Render Queue: Queue state object not available.");let i=document.getElementById("aipkit_automated_task_queue_tbody"),e=window.aipkit_automated_tasks_config||{},t=e.text||{};if(!i){console.warn("Fetch/Render Queue: Table body not found.");return}i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> ${t.loading_queue||"Loading queue items..."}</td></tr>`;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");let c={page:o,search:r?r.search:"",status_filter:r?r.status:"all",orderby:r?r.sortBy:"q.added_at",order:r?r.sortOrder:"DESC",_ajax_nonce:e.nonce_manage_tasks},s=await window.aipkit_apiRequest("aipkit_get_automated_task_queue_items",c);typeof window.aipkit_queue_renderQueueTable=="function"?window.aipkit_queue_renderQueueTable(s.items||[]):console.error("Fetch/Render Queue: renderQueueTable function not found."),typeof window.aipkit_queue_renderQueuePagination=="function"?window.aipkit_queue_renderQueuePagination(s.pagination||{}):console.error("Fetch/Render Queue: renderQueuePagination function not found.")}catch(c){console.error("Fetch/Render Queue Error:",c),i.innerHTML=`<tr><td colspan="8" class="aipkit_text-center aipkit_text-danger">${t.error_loading_queue||"Error loading queue:"} ${c.message||"Unknown error"}</td></tr>`}}window.aipkit_queue_fetchAndRenderQueueItems=k})();(function(){"use strict";async function k(o){let r=o.target.closest("button[data-action]");if(!r)return;let i=r.dataset.action,e=r.dataset.itemId;if(!e)return;let t=window.aipkit_automated_tasks_config||{},c=t.text||{},s=window.aipkit_automated_tasks_queue_state?window.aipkit_automated_tasks_queue_state.page:1,n=(d,a)=>{if(typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"){window.aipkit_form_showAutomatedTaskFormStatus(d,a);return}typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(d,a)};if(i==="delete_queue_item"){let d=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,c.delete_button||"Delete");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_item",{item_id:e,_ajax_nonce:t.nonce_manage_tasks}),n(c.queue_item_deleted||"Queue item deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(s)}catch(l){n(`${c.error_deleting_queue_item||"Error deleting item:"} ${l.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,c.delete_button||"Delete")}},a=c.confirm_delete_queue_item||"Are you sure you want to remove this item from the queue?";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(a,{title:c.confirm_title||"Confirm",confirmText:c.delete_button||"Delete",cancelText:c.cancel_button||"Cancel",onConfirm:()=>{d()}});return}if(!confirm(a))return;await d()}else if(i==="retry_queue_item"){typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!0,c.retry_button||"Retry");try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function missing.");await window.aipkit_apiRequest("aipkit_retry_automated_task_queue_item",{item_id:e,_ajax_nonce:t.nonce_manage_tasks}),n(c.item_marked_retry||"Item marked for retry. Queue processing will pick it up.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(s)}catch(d){n(`${c.error_retrying_item||"Error retrying item:"} ${d.message||"Unknown error"}`,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(r,!1,c.retry_button||"Retry")}}}window.aipkit_queue_handleQueueItemActionClick=k})();(function(){"use strict";async function k(){let o=document.getElementById("aipkit_delete_queue_by_status_btn"),r=document.getElementById("aipkit_task_queue_status_filter");if(!o||!r){console.error("Delete by status button or filter dropdown not found.");return}let i=r.value,e=r.options[r.selectedIndex].text.toLowerCase(),t=window.aipkit_automated_tasks_config||{},c=t.text||{},s=i==="all"?c.confirmDeleteQueueAll||"Are you sure you want to delete ALL items from the queue? This cannot be undone.":(c.confirmDeleteQueueByStatus||"Are you sure you want to delete all %s items from the queue? This cannot be undone.").replace("%s",e),n=async()=>{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(o,!0,c.delete_button||"Delete",c.deleting_task||"Deleting..."):o.disabled=!0;try{if(typeof window.aipkit_apiRequest!="function")throw new Error("API request function is missing.");let d=await window.aipkit_apiRequest("aipkit_delete_automated_task_queue_items_by_status",{status:i,_ajax_nonce:t.nonce_manage_tasks});typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(d.message||"Queue items deleted.","success"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(d.message||"Queue items deleted.","success"),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}catch(d){let a=`${c.errorDeletingAllItems||"Error deleting items:"} ${d.message||"Unknown error"}`;typeof window.aipkit_form_showAutomatedTaskFormStatus=="function"?window.aipkit_form_showAutomatedTaskFormStatus(a,"error"):typeof window.aipkit_list_showAutomatedTaskStatus=="function"&&window.aipkit_list_showAutomatedTaskStatus(a,"error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(o,!1,c.delete_button||"Delete"):o.disabled=!1}};if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(s,{title:c.confirm_title||"Confirm",confirmText:c.delete_button||"Delete",cancelText:c.cancel_button||"Cancel",onConfirm:()=>{n()}});return}confirm(s)&&await n()}window.aipkit_handleDeleteQueueByStatus=k})();(function(){"use strict";function k(o){let r=o.target.closest("button[data-page]");if(r&&!r.disabled){let i=parseInt(r.dataset.page,10);typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems(i):console.error("Queue Pagination Click: fetchAndRenderQueueItems function not found.")}}window.aipkit_queue_handleQueuePaginationClick=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_automated_task_queue_tbody"),r=document.getElementById("aipkit_refresh_task_queue_btn"),i=document.getElementById("aipkit_delete_queue_by_status_btn"),e=document.getElementById("aipkit_automated_task_queue_pagination"),t=document.getElementById("aipkit_task_queue_search_input"),c=document.getElementById("aipkit_task_queue_status_filter"),s=document.querySelector("#aipkit_automated_task_queue_viewer_area table");if(r&&typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&r.addEventListener("click",()=>window.aipkit_queue_fetchAndRenderQueueItems(1)),i&&typeof window.aipkit_handleDeleteQueueByStatus=="function"&&i.addEventListener("click",window.aipkit_handleDeleteQueueByStatus),t){let n;t.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{let d=window.aipkit_automated_tasks_queue_state;d&&(d.search=t.value.trim()),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)},500)})}c&&c.addEventListener("change",()=>{let n=window.aipkit_automated_tasks_queue_state;n&&(n.status=c.value),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),s&&s.addEventListener("click",n=>{let d=n.target.closest("th.aipkit-sortable-col");if(!d)return;let a=d.dataset.sortBy,l=window.aipkit_automated_tasks_queue_state;if(!l)return;let p="DESC";l.sortBy===a&&(p=l.sortOrder==="DESC"?"ASC":"DESC"),l.sortBy=a,l.sortOrder=p,typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"&&window.aipkit_queue_fetchAndRenderQueueItems(1)}),o&&typeof window.aipkit_queue_handleQueueItemActionClick=="function"&&o.addEventListener("click",window.aipkit_queue_handleQueueItemActionClick),e&&typeof window.aipkit_queue_handleQueuePaginationClick=="function"&&e.addEventListener("click",window.aipkit_queue_handleQueuePaginationClick),typeof window.aipkit_queue_fetchAndRenderQueueItems=="function"?window.aipkit_queue_fetchAndRenderQueueItems():console.error("Automated Task Queue Init: fetchAndRenderQueueItems function not found for initial fetch.")}window.aipkit_queue_initAutomatedTaskQueue=k})();(function(){"use strict";let k=1,o="",r="all",i="q.added_at",e="DESC";window.aipkit_automated_tasks_queue_state={get page(){return k},set page(c){k=c},get search(){return o},set search(c){o=c},get status(){return r},set status(c){r=c},get sortBy(){return i},set sortBy(c){i=c},get sortOrder(){return e},set sortOrder(c){e=c}};function t(){typeof window.aipkit_queue_initAutomatedTaskQueue=="function"?window.aipkit_queue_initAutomatedTaskQueue():console.error("Automated Tasks Queue Handler: aipkit_queue_initAutomatedTaskQueue function not found.")}window.aipkit_initAutomatedTaskQueue=t})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_autogpt_container");if(o&&typeof window.aipkit_initializeTabs=="function"?window.aipkit_initializeTabs():o&&console.warn("AIPKit AutoGPT: Tab initializer function missing, but autogpt container found."),(()=>{if(!o)return;let i=o.querySelector("#aipkit_autogpt_cron_status [data-aipkit-cron-timestamp]");if(!i)return;let e=i.dataset.aipkitCronTimestamp,t=e?parseInt(e,10):0;if(!t||Number.isNaN(t))return;let c=new Date(t*1e3),s=c.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});i.textContent=s,i.title=c.toLocaleString()})(),typeof window.aipkit_initContentIndexingTaskFormUI=="function")try{window.aipkit_initContentIndexingTaskFormUI()}catch(i){console.error("AIPKit AutoGPT: Error initializing Content Indexing Task Form UI:",i)}else console.warn("AIPKit AutoGPT: Content Indexing Task Form UI initializer (aipkit_initContentIndexingTaskFormUI) not found.");if(typeof window.aipkit_initAutomatedTaskForm=="function")try{window.aipkit_initAutomatedTaskForm()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Form Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Form Handler initializer (aipkit_initAutomatedTaskForm) not found.");if(typeof window.aipkit_initAutomatedTaskList=="function")try{window.aipkit_initAutomatedTaskList()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks List Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks List Handler initializer (aipkit_initAutomatedTaskList) not found.");if(typeof window.aipkit_initAutomatedTaskQueue=="function")try{window.aipkit_initAutomatedTaskQueue()}catch(i){console.error("AIPKit AutoGPT: Error initializing Automated Tasks Queue Handler:",i)}else console.warn("AIPKit AutoGPT: Automated Tasks Queue Handler initializer (aipkit_initAutomatedTaskQueue) not found.");if(typeof window.aipkit_initAutogptPopovers=="function")try{window.aipkit_initAutogptPopovers(o)}catch(i){console.error("AIPKit AutoGPT: Error initializing settings popovers:",i)}if(typeof window.aipkit_updateAutogptAiSummaries=="function")try{window.aipkit_updateAutogptAiSummaries(o)}catch(i){console.error("AIPKit AutoGPT: Error updating AI summaries:",i)}if(typeof window.aipkit_initAutogptAiSettingsRedesigned=="function")try{window.aipkit_initAutogptAiSettingsRedesigned(o)}catch(i){console.error("AIPKit AutoGPT: Error initializing AI settings UI:",i)}if(typeof window.aipkit_initAutogptPromptFlyouts=="function")try{window.aipkit_initAutogptPromptFlyouts(o)}catch(i){console.error("AIPKit AutoGPT: Error initializing prompt flyouts:",i)}typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_autogpt_container"):console.warn("AIPKit AutoGPT: aipkit_initApiKeyToggles not found.")}window.aipkit_initAutogpt=k})();(function(){"use strict";let k=null;function o(s,n="",d=0){let a=document.getElementById("aipkit_content_writer_form_status");if(!a)return;k&&(clearTimeout(k),k=null);let l="aipkit_cw_status_badge",p=(_="")=>{a.className=_?`${l} ${_}`:l};switch(p(),s){case"progress":a.textContent=n,p("aipkit_settings_message-info");break;case"info":a.textContent=n,p("aipkit_settings_message-info");break;case"success":a.textContent=n,p("aipkit_settings_message-success");break;case"error":a.textContent=n,p("aipkit_settings_message-error");break;case"clear":default:a.textContent="",p();return}d&&(k=setTimeout(()=>{a.textContent===n&&r()},d))}function r(){o("clear")}function i(s){o("progress",s)}function e(s,n=3e3){o("info",s,n)}function t(s){o("success",s,3e3)}function c(s){o("error",s)}window.aipkit_updateGeneralStatus=o,window.aipkit_clearGeneralStatus=r,window.aipkit_showProgress=i,window.aipkit_showInfo=e,window.aipkit_showSuccess=t,window.aipkit_showError=c})();(function(){"use strict";window.aipkit_cw_isAutosaving=!1,window.aipkit_cw_lastSavedData=null;function k(){let e=window.aipkit_cw_template_state,t=e?.currentTemplateId;if(!t)return null;let c="";if(Array.isArray(e?.currentTemplates)){let n=e.currentTemplates.find(d=>String(d.id)===String(t));n?.template_name&&(c=n.template_name)}if(!c){let n=document.getElementById("aipkit_cw_template_select");n?.selectedOptions?.length&&(c=n.selectedOptions[0].textContent.trim())}let s=parseInt(t,10);return!c||Number.isNaN(s)?null:{id:s,name:c}}function o(){if(typeof window.aipkit_getContentWriterFormConfig!="function")return null;let e=document.getElementById("aipkit_content_writer_form");return e?window.aipkit_getContentWriterFormConfig(e):null}async function r(){if(window.aipkit_cw_autosave_suspended||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getContentWriterFormConfig!="function"||window.aipkit_cw_isAutosaving)return;let e=window.aipkit_cw_template_state;if(e?.isSavingOrDeleting)return;let t=o();if(!t)return;let c=window.aipkit_cw_lastSavedData||{};if(JSON.stringify(t)===JSON.stringify(c))return;let s=k();if(!s)return;let n=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,d=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,a=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_isAutosaving=!0,n&&n("Saving...");try{let l=document.getElementById("aipkit_content_writer_template_nonce_field");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:s.id,template_name:s.name,template_type:"content_writer",config:JSON.stringify(t),_ajax_nonce:l?l.value:""}),window.aipkit_cw_lastSavedData=t,e&&(e.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(t)),e.currentTemplateModified=!1),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(String(s.id)),d&&d("Updated")}catch(l){a&&a(`Error: ${l.message||"Failed to save."}`),console.error("Content Writer Auto-Save Error:",l)}finally{window.aipkit_cw_isAutosaving=!1}}function i(){let e=o();e&&(window.aipkit_cw_lastSavedData=e)}window.aipkit_handleContentWriterAutoSave=r,window.aipkit_updateContentWriterAutosaveBaseline=i})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_form");if(!o)return;let r="data-aipkit-cw-autosave-attached";o.getAttribute(r)||(o.addEventListener("change",i=>{let e=i.target;if(!e||!e.matches(".aipkit_autosave_trigger"))return;(e.tagName.toLowerCase()==="select"||e.type==="checkbox"||e.type==="range")&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()}),o.addEventListener("blur",i=>{let e=i.target;if(!e||!e.matches(".aipkit_autosave_trigger"))return;let t=e.tagName.toLowerCase();(t==="input"||t==="textarea")&&e.type!=="range"&&e.type!=="checkbox"&&typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave()},!0),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline(),o.setAttribute(r,"true"))}window.aipkit_initContentWriterAutosave=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.warn("Content Writer Accordions: Main container not found.");return}o.dataset.accordionListenerAttached!=="true"&&(o.addEventListener("click",function(r){let i=r.target.closest(".aipkit_accordion-header");if(!i)return;let e=i.closest(".aipkit_accordion");if(!e)return;let t=i.nextElementSibling;if(!t||!t.classList.contains("aipkit_accordion-content"))return;let c=e.closest(".aipkit_accordion-group");if(c&&!i.classList.contains("aipkit_active")){let s=c.querySelector(".aipkit_accordion-header.aipkit_active");if(s){s.classList.remove("aipkit_active");let n=s.nextElementSibling;n&&n.classList.remove("aipkit_active")}}i.classList.toggle("aipkit_active"),t.classList.toggle("aipkit_active")}),o.dataset.accordionListenerAttached="true")}window.aipkit_initContentWriterAccordions=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(s){return s},o=null,r={title:"Title",content:"Content",image:"Image",meta:"Meta",keyword:"Keyword",tags:"Tags",excerpt:"Excerpt"},i=null;function e(s,n=""){if(o||(o=document.getElementById("aipkit_content_writer_form_status")),!o)return;i&&(clearTimeout(i),i=null),o.textContent=s;let d="aipkit_cw_status_badge";o.className=n?`${d} ${n}`:d}function t(s,n,d=""){let a=r[s]||"Step",l=d?k(d):"";switch(n){case"pending":break;case"generating":e(l||`Generating ${a}...`,"aipkit_settings_message-info");break;case"success":e(`${a} complete`,"aipkit_settings_message-success"),i=setTimeout(()=>{e("")},1400);break;case"error":e(`Error ${a}${l?": "+l:""}`,"aipkit_settings_message-error");break;case"skipped":l&&(e(`${a} skipped: ${l}`,"aipkit_settings_message-info"),i=setTimeout(()=>{e("")},1400));break}let p=document.getElementById(`aipkit_cw_status_${s}_generation`),_=p?p.querySelector(".aipkit_cw_status_icon"):null,f=p?p.querySelector(".status-text"):null;if(!(!p||!_||!f))switch(p.classList.remove("status-pending","status-generating","status-success","status-error","status-skipped"),p.classList.add(`status-${n}`),n){case"pending":{f.textContent="Pending";let g="dashicons-text-page";s==="content"&&(g="dashicons-admin-post"),s==="image"&&(g="dashicons-format-image"),s==="excerpt"&&(g="dashicons-editor-quote"),s==="tags"&&(g="dashicons-tag"),s==="meta"&&(g="dashicons-search"),s==="keyword"&&(g="dashicons-flag"),_.className=`dashicons ${g} aipkit_cw_status_icon`;break}case"generating":f.textContent=l||"Generating...",_.className="aipkit_spinner aipkit_inline_spinner aipkit_cw_status_icon";break;case"success":f.textContent="Complete",_.className="dashicons dashicons-yes-alt aipkit_cw_status_icon";break;case"error":f.textContent=`Error ${l?": "+l:""}`,_.className="dashicons dashicons-warning aipkit_cw_status_icon";break;case"skipped":f.textContent="Skipped",_.className="dashicons dashicons-minus aipkit_cw_status_icon";break}}function c(){e(""),["title","content","image","meta","keyword","excerpt","tags"].forEach(s=>{t(s,"pending")})}window.aipkit_updateCwGenerationStatus=t,window.aipkit_resetAllGenerationStatuses=c})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_form_status");o&&(o.textContent="",o.className="aipkit_cw_status_badge"),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","pending"),window.aipkit_updateCwGenerationStatus("content","pending"),window.aipkit_updateCwGenerationStatus("excerpt","pending"),window.aipkit_updateCwGenerationStatus("tags","pending"),window.aipkit_updateCwGenerationStatus("image","pending"),window.aipkit_updateCwGenerationStatus("meta","pending"),window.aipkit_updateCwGenerationStatus("keyword","pending"))}window.aipkit_resetGenerationStatusIndicators=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(l){return l},o=window.aipkit_escapeHtml||function(l){return l},r=(l,p)=>(l?.elements?.[p]?.value||"").trim(),i=l=>String(l||"").split(/\r?\n/).map(p=>p.trim()).filter(Boolean),e=l=>l.map(p=>p.split("|")[0].trim()).filter(Boolean),t=l=>{try{let p=new URL(l);return p.protocol==="http:"||p.protocol==="https:"}catch{return!1}},c=l=>{let p=l?.querySelector(".aipkit_gsheets_indicator");return p?p.classList.contains("aipkit_gsheets_indicator--success"):!0};function s(l,p){l&&(l.textContent=p||k("Please review your input.","gpt3-ai-content-generator"),l.id==="aipkit_cw_action_validation"?l.className="aipkit_cw_action_validation":l.className="aipkit_cw_status_badge aipkit_settings_message-error")}function n(l){l&&(l.textContent="",l.id==="aipkit_cw_action_validation"?l.className="aipkit_cw_action_validation":l.className="aipkit_cw_status_badge")}function d(l,p){let _=p||document.getElementById("aipkit_cw_mode_select")?.value||"task";if(_==="single"&&(_="task"),_==="task")return e(i(r(l,"content_title_bulk"))).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one topic.","gpt3-ai-content-generator")};if(_==="csv"){let f=document.getElementById("aipkit_cw_csv_data_holder");return(f?f.value.trim():"")?{isValid:!0}:{isValid:!1,message:k("Please upload and parse a CSV file first.","gpt3-ai-content-generator")}}if(_==="rss")return i(r(l,"rss_feeds")).filter(t).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid RSS feed URL.","gpt3-ai-content-generator")};if(_==="url")return i(r(l,"url_list")).filter(t).length?{isValid:!0}:{isValid:!1,message:k("Please enter at least one valid website URL.","gpt3-ai-content-generator")};if(_==="gsheets"){let f=r(l,"gsheets_sheet_id"),g=r(l,"gsheets_credentials");return!f||!g?{isValid:!1,message:k("Please provide a Google Sheet ID and credentials.","gpt3-ai-content-generator")}:c(l)?{isValid:!0}:{isValid:!1,message:k("Verify access before generating.","gpt3-ai-content-generator")}}return{isValid:!0}}async function a(l,p,_){let f=new FormData(l),g=Object.fromEntries(f.entries()),m=l.elements["openai_vector_store_ids[]"];g.openai_vector_store_ids=m?Array.from(m.selectedOptions).map(I=>I.value):[],delete g["openai_vector_store_ids[]"];let u=window.aipkit_dashboard?.text||{},h=document.getElementById("aipkit_cw_mode_select"),v=h?h.value:"task";v==="single"&&(v="task"),g.cw_generation_mode=v;let S=document.getElementById("aipkit_cw_action_validation"),q=d(l,v);if(!q.isValid){let I=_||S;s(I,q.message),I!==S&&n(S);return}if(n(_),n(S),v==="csv"){let I=document.getElementById("aipkit_cw_csv_data_holder");g.content_title=I?I.value:""}else v==="url"?(g.url_list=l.elements.url_list?.value||"",g.content_title=g.url_list):v==="task"&&(g.content_title=l.elements.content_title_bulk?l.elements.content_title_bulk.value:"");delete g.content_title_bulk,delete g.content_title_csv;let y=document.getElementById("aipkit_cw_template_select"),E="";if(y&&y.selectedIndex>0){let I=y.options[y.selectedIndex];I&&(E=I.text)}if(E&&E.trim()!=="")g.task_name=E.trim();else{let I=(g.content_title||g.rss_feeds||g.gsheets_sheet_id||g.url_list||"").split(`
`)[0].trim();g.task_name=I||"Automated Content Writing Task"}typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(p,!0,"Create Task","Creating Task..."):(p.disabled=!0,p.textContent="Creating Task..."),_&&(_.textContent="Creating automated task...",_.className="aipkit_cw_status_badge aipkit_settings_message-info");try{let I=document.getElementById("aipkit_content_writer_nonce");if(g._ajax_nonce=I?I.value:"",!g._ajax_nonce)throw new Error("Security token missing for task creation.");let w=await window.aipkit_apiRequest("aipkit_content_writer_create_task",g);_&&(_.textContent="",_.className="aipkit_cw_status_badge"),typeof window.aipkit_loadModule=="function"&&window.aipkit_loadModule("autogpt")}catch(I){console.error("Content Writer Create Task Error:",I),_&&(_.textContent=`Error creating task: ${o(I.message||"Unknown error")}`,_.className="aipkit_cw_status_badge aipkit_settings_message-error")}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(p,!1,"Create Task"):(p.disabled=!1,p.textContent="Create Task")}}window.aipkit_createContentWriterTask=a,window.aipkit_validateContentWriterInputs=d,window.aipkit_showContentWriterValidationError=s,window.aipkit_clearContentWriterValidationMessage=n})();(function(){"use strict";let k=()=>{let _=document.getElementById("aipkit_cw_mode_select"),f=_?_.value:"task";return f==="single"?"task":f},o=()=>{let _=k();return _==="task"||_==="csv"},r=_=>{!_?.frequencySelect||!_.frequencySelect.querySelector('option[value="one-time"]')||_.frequencySelect.value!=="one-time"&&(_.frequencySelect.value="one-time",_.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})))},i=()=>{let _=document.getElementById("aipkit_content_writer_container");if(!_)return null;let f=_.querySelector(".aipkit_cw_generate_split");if(!f)return null;let g=f.querySelector("#aipkit_content_writer_generate_btn"),m=f.querySelector(".aipkit_cw_generate_toggle"),u=f.querySelector(".aipkit_cw_generate_menu"),h=u?u.querySelector('[data-menu-panel="actions"]'):null,v=u?u.querySelector('[data-menu-panel="intervals"]'):null,S=h?Array.from(h.querySelectorAll("[data-action]")):[],q=v?Array.from(v.querySelectorAll("[data-interval]")):[],y=v?v.querySelector("[data-menu-back]"):null,E=_.querySelector("#aipkit_cw_task_frequency");return{container:_,split:f,generateBtn:g,toggleBtn:m,menu:u,menuActions:h,menuIntervals:v,actionItems:S,intervalItems:q,backBtn:y,frequencySelect:E}},e=_=>{!_?.menu||!_?.toggleBtn||(_.menu.hidden=!0,_.toggleBtn.setAttribute("aria-expanded","false"))},t=_=>{if(!_?.menu||!_?.split)return;let f=_.menu,g=_.split.getBoundingClientRect(),m=window.innerWidth,u=12;f.style.position="fixed",f.style.right="auto",f.style.bottom="auto",f.style.zIndex="100000",f.style.visibility="hidden";let h=f.getBoundingClientRect(),v=g.right-h.width;v=Math.max(u,Math.min(v,m-h.width-u));let S=g.bottom+6;f.style.left=`${Math.round(v)}px`,f.style.top=`${Math.round(S)}px`,f.style.visibility="visible"},c=_=>{!_?.menu||!_?.toggleBtn||(_.menu.hidden=!1,t(_),_.toggleBtn.setAttribute("aria-expanded","true"))},s=(_,f)=>{if(!_?.menuActions||!_?.menuIntervals)return;let g=f==="intervals";_.menuActions.hidden=g,_.menuIntervals.hidden=!g},n=(_,f)=>{_&&(_.split.dataset.aipkitCwAction=f||"generate",_.actionItems.forEach(g=>{let m=g.dataset.action===f;g.classList.toggle("is-active",m),g.setAttribute("aria-checked",m?"true":"false")}))},d=_=>{if(!_?.frequencySelect)return;let f=_.frequencySelect.value||_.frequencySelect.options[0]?.value||"";_.intervalItems.forEach(g=>{let m=g.dataset.interval===f;g.classList.toggle("is-active",m),g.setAttribute("aria-checked",m?"true":"false")})},a=(_,f)=>{_?.frequencySelect&&(_.frequencySelect.value=f,_.frequencySelect.dispatchEvent(new Event("change",{bubbles:!0})),d(_),e(_),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState())},l=_=>{let f=i();if(!f)return;let g=_||"generate",m=g==="create_task"&&o();if(m&&r(f),n(f,g),typeof window.aipkit_updateContentWriterActionState=="function"&&(f.menu&&g==="create_task"&&!m&&(f.menu.dataset.keepOpen="true"),window.aipkit_updateContentWriterActionState()),g==="create_task"&&f.menuIntervals&&!m){s(f,"intervals"),d(f),c(f);return}s(f,"actions"),e(f),m&&g==="create_task"&&f.generateBtn&&setTimeout(()=>{f.generateBtn.click()},0)},p=()=>{let _=i();_&&_.split.dataset.listenerAttached!=="true"&&(_.split.dataset.aipkitCwAction||(_.split.dataset.aipkitCwAction="generate"),n(_,_.split.dataset.aipkitCwAction),d(_),_.toggleBtn&&_.toggleBtn.addEventListener("click",f=>{if(f.preventDefault(),_.toggleBtn.disabled)return;(_.split.dataset.aipkitCwAction||"generate")==="create_task"&&!o()?(s(_,"intervals"),d(_)):s(_,"actions"),_.menu&&_.menu.hidden?c(_):e(_)}),_.actionItems.forEach(f=>{f.addEventListener("click",g=>{g.preventDefault(),!f.disabled&&l(f.dataset.action||"generate")})}),_.intervalItems.forEach(f=>{f.addEventListener("click",g=>{g.preventDefault(),!f.disabled&&a(_,f.dataset.interval||"")})}),_.backBtn&&_.backBtn.addEventListener("click",f=>{f.preventDefault(),s(_,"actions"),c(_)}),document.addEventListener("click",f=>{let g=f.target;!_.menu||_.menu.hidden||_.split.contains(g)||e(_)}),document.addEventListener("keydown",f=>{f.key==="Escape"&&(!_.menu||_.menu.hidden||e(_))}),_.split.dataset.listenerAttached="true")};window.aipkit_initContentWriterGenerateMenu=p,window.aipkit_setCwGenerateAction=l,window.aipkit_getCwGenerateAction=()=>i()?.split?.dataset.aipkitCwAction||"generate"})();(function(){"use strict";let k=window.wp?.i18n?.__||function(L){return L},o=100,r=[{key:"write",label:k("Writing","gpt3-ai-content-generator"),steps:["title","content"],isEnabled:()=>!0},{key:"optimize",label:k("Optimizing","gpt3-ai-content-generator"),steps:["meta","focus","excerpt","tags"],isEnabled:L=>L.generateMeta||L.generateFocus||L.generateExcerpt||L.generateTags},{key:"publish",label:k("Publishing","gpt3-ai-content-generator"),steps:["image","featured","save"],isEnabled:()=>!0}],i={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Running","gpt3-ai-content-generator"),done:k("Done","gpt3-ai-content-generator"),skipped:k("Skipped","gpt3-ai-content-generator"),error:k("Error","gpt3-ai-content-generator")},e=[{key:"title",label:k("Title","gpt3-ai-content-generator"),isEnabled:L=>!!L.customTitlePrompt},{key:"content",label:k("Content","gpt3-ai-content-generator"),isEnabled:()=>!0},{key:"meta",label:k("Meta","gpt3-ai-content-generator"),isEnabled:L=>L.generateMeta},{key:"focus",label:k("Focus","gpt3-ai-content-generator"),isEnabled:L=>L.generateFocus},{key:"excerpt",label:k("Excerpt","gpt3-ai-content-generator"),isEnabled:L=>L.generateExcerpt},{key:"tags",label:k("Tags","gpt3-ai-content-generator"),isEnabled:L=>L.generateTags},{key:"image",label:k("Image","gpt3-ai-content-generator"),isEnabled:L=>L.generateImages},{key:"featured",label:k("Featured","gpt3-ai-content-generator"),isEnabled:L=>L.generateFeatured},{key:"save",label:k("Save","gpt3-ai-content-generator"),isEnabled:()=>!0}],t={active:!1,stopRequested:!1,items:[],rows:[],totals:{processed:0,completed:0,failed:0}},c=(L,U)=>({customTitlePrompt:String(L.custom_title_prompt||"").trim(),generateMeta:L.generate_meta_description==="1",generateFocus:L.generate_focus_keyword==="1",generateExcerpt:L.generate_excerpt==="1",generateTags:L.generate_tags==="1",generateImages:U.generate_images_enabled==="1",generateFeatured:U.generate_featured_image==="1"}),s=L=>{let U={};return e.forEach(W=>{U[W.key]=W.isEnabled(L)?"waiting":"skipped"}),U},n=(L,U)=>{let W=document.createElement("span");W.className=`aipkit_cw_batch_step aipkit_cw_batch_step--${U}`,W.dataset.step=L.key,W.dataset.status=U;let ee=document.createElement("span");ee.className="aipkit_cw_batch_step_label",ee.textContent=L.label;let ne=document.createElement("span");return ne.className="aipkit_cw_batch_step_status",ne.textContent=i[U]||U,W.appendChild(ee),W.appendChild(ne),{wrapper:W,status:ne}},d=(L,U,W)=>{S(L,U,W)},a=L=>{L?.phases&&Object.keys(L.phases).forEach(U=>{let W=L.phases[U],ee=W.dataset.status;ee==="done"||ee==="skipped"||(W.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",W.dataset.status="error")})},l=()=>{let L=document.getElementById("aipkit_content_writer_container");if(!L)return null;let U=L.querySelector("#aipkit_cw_batch_queue"),W=U?U.querySelector(".aipkit_cw_batch_list"):null,ee=U?U.querySelector(".aipkit_cw_batch_count"):null,ne=U?U.querySelector(".aipkit_cw_batch_progress"):null,z=U?U.querySelector(".aipkit_cw_batch_progress_bar"):null,ge=L.querySelector("#aipkit_content_writer_form_status"),Ae=L.querySelector("#aipkit_content_writer_generate_btn"),ot=L.querySelector(".aipkit_cw_generate_toggle"),ze=L.querySelector(".aipkit_cw_generate_menu"),Xe=ze?Array.from(ze.querySelectorAll(".aipkit_cw_generate_menu_item")):[],Ge=L.querySelector("#aipkit_content_writer_stop_btn");return{container:L,queue:U,list:W,count:ee,progress:ne,progressBar:z,status:ge,generateBtn:Ae,generateToggle:ot,generateMenu:ze,generateMenuItems:Xe,stopBtn:Ge}},p=()=>{t.totals.processed=0,t.totals.completed=0,t.totals.failed=0},_=()=>{let L=l();if(!L||!L.count||!L.progressBar||!L.progress)return;let U=t.items.length,W=t.totals.completed;L.count.textContent=`${W}/${U}`;let ee=U>0?Math.round(W/U*100):0;L.progressBar.style.width=`${ee}%`,L.progress.setAttribute("aria-valuenow",String(ee))},f=(L,U)=>{let W=l();!W||!W.status||(W.status.textContent=L||"",W.status.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),U&&W.status.classList.add(`aipkit_settings_message-${U}`))},g=()=>{let L=l();!L||!L.list||(L.list.innerHTML="",t.rows=[],t.items=[],p(),_())},m=()=>{let L=l();L?.queue&&(L.queue.hidden=!1)},u=()=>{let L=l();L?.queue&&(L.queue.hidden=!0)},h=(L,U)=>{let W=document.createElement("div");W.className="aipkit_cw_batch_row";let ee=document.createElement("div");ee.className="aipkit_cw_batch_row_content";let ne=document.createElement("span");ne.className="aipkit_cw_batch_topic",ne.textContent=L.topic||"";let z=document.createElement("div");z.className="aipkit_cw_batch_phases";let ge={},Ae=s(U),ot={};r.forEach(Qe=>{let Ce=Qe.steps.some(Rt=>{let vi=e.find(gi=>gi.key===Rt);return vi&&vi.isEnabled(U)});if(!Qe.isEnabled(U)&&!Ce)return;let St=document.createElement("span");St.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--waiting",St.dataset.phase=Qe.key,St.dataset.status="waiting",St.setAttribute("title",Qe.label),St.setAttribute("aria-label",Qe.label),z.appendChild(St),ge[Qe.key]=St,Qe.steps.forEach(Rt=>{ot[Rt]={wrapper:St,phaseKey:Qe.key,status:{textContent:""}}})});let ze=document.createElement("span");ze.className="aipkit_cw_batch_status aipkit_cw_batch_status--waiting",ze.textContent=k("Waiting","gpt3-ai-content-generator");let Xe=document.createElement("span");Xe.className="aipkit_cw_batch_error",Xe.hidden=!0;let Ge=document.createElement("a");Ge.className="aipkit_cw_batch_view",Ge.textContent=k("View","gpt3-ai-content-generator"),Ge.target="_blank",Ge.rel="noopener noreferrer",Ge.hidden=!0;let It=document.createElement("span");return It.className="aipkit_cw_batch_summary_text",ee.appendChild(ne),ee.appendChild(z),ee.appendChild(ze),ee.appendChild(Xe),ee.appendChild(Ge),W.appendChild(ee),{row:W,topic:ne,summary:It,status:ze,error:Xe,view:Ge,phases:ge,steps:ot}},v=L=>{let U=e.find(W=>W.key===L);return U?U.label:L},S=(L,U,W)=>{if(!L?.phases)return;let ee=r.find(z=>z.steps.includes(U));if(!ee)return;let ne=L.phases[ee.key];ne&&(W==="running"?(ne.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--running",ne.dataset.status="running",L.status&&(L.status.textContent=`${ee.label} \xB7 ${v(U)}`)):W==="done"?(ne.dataset.status==="running"||U===ee.steps[ee.steps.length-1])&&(ne.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",ne.dataset.status="done"):W==="error"&&(ne.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--error",ne.dataset.status="error"))},q=(L,U)=>{let W=l();!W||!W.list||(W.list.innerHTML="",t.rows=L.map(ee=>{let ne=h(ee,U);return W.list.appendChild(ne.row),ne}))},y=(L,U,W={})=>{if(!L)return;L.row.classList.toggle("is-active",U==="running"),L.status.className=`aipkit_cw_batch_status aipkit_cw_batch_status--${U}`;let ee={waiting:k("Waiting","gpt3-ai-content-generator"),running:k("Generating","gpt3-ai-content-generator"),success:k("Done","gpt3-ai-content-generator"),error:k("Failed","gpt3-ai-content-generator"),stopped:k("Stopped","gpt3-ai-content-generator")};if(L.status.textContent=ee[U]||U,L.error&&(L.error.hidden=!0,L.error.textContent="",L.error.removeAttribute("title")),U==="success"&&L.phases&&Object.keys(L.phases).forEach(ne=>{let z=L.phases[ne];z.className="aipkit_cw_batch_phase aipkit_cw_batch_phase--done",z.dataset.status="done"}),W.summary!==void 0&&(L.summary.textContent=W.summary||""),W.viewLink?(L.view.href=W.viewLink,L.view.hidden=!1):U!=="success"&&(L.view.hidden=!0),U==="error"&&L.error){let ne=I(W.summary);ne&&(L.error.textContent=ne,L.error.title=E(W.summary),L.error.hidden=!1)}},E=L=>String(L||"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),I=L=>{let U=E(L);return U?U.length>140?`${U.slice(0,137)}\u2026`:U:""},w=(L,U)=>{let W=E(U||L);return W?W.length>140?`${W.slice(0,140)}\u2026`:W:""},A=L=>{let U=new FormData(L),W=Object.fromEntries(U.entries()),ee=L.elements["openai_vector_store_ids[]"];W.openai_vector_store_ids=ee?Array.from(ee.selectedOptions).map(z=>z.value):[],delete W["openai_vector_store_ids[]"];let ne=document.getElementById("aipkit_content_writer_nonce");return ne&&ne.value&&(W._ajax_nonce=ne.value),W},C=L=>{let U=L.elements["post_categories[]"],W=U?Array.from(U.selectedOptions).map(ne=>ne.value):[],ee=L.querySelector('input[name="schedule_mode"]:checked')?.value||"immediate";return{ai_provider:L.elements.ai_provider?.value||"",ai_model:L.elements.ai_model?.value||"",ai_temperature:L.elements.ai_temperature?.value||"",reasoning_effort:L.elements.reasoning_effort?.value||"",cw_generation_mode:L.elements.cw_generation_mode?.value||"",post_type:L.elements.post_type?.value||"post",post_author:L.elements.post_author?.value||"",post_status:L.elements.post_status?.value||"draft",post_schedule_date:L.elements.post_schedule_date?.value||"",post_schedule_time:L.elements.post_schedule_time?.value||"",schedule_mode:ee,smart_schedule_start_datetime:L.elements.smart_schedule_start_datetime?.value||"",smart_schedule_interval_value:L.elements.smart_schedule_interval_value?.value||"",smart_schedule_interval_unit:L.elements.smart_schedule_interval_unit?.value||"",post_categories:W,generate_toc:L.elements.generate_toc?.checked?"1":"0",generate_seo_slug:L.elements.generate_seo_slug?.checked?"1":"0",generate_images_enabled:L.elements.generate_images_enabled?.checked?"1":"0",generate_featured_image:L.elements.generate_featured_image?.checked?"1":"0",image_provider:L.elements.image_provider?.value||"",image_model:L.elements.image_model?.value||"",image_prompt:L.elements.image_prompt?.value||"",featured_image_prompt:L.elements.featured_image_prompt?.value||"",image_count:L.elements.image_count?.value||"1",image_placement:L.elements.image_placement?.value||"after_first_h2",image_placement_param_x:L.elements.image_placement_param_x?.value||"",image_alignment:L.elements.image_alignment?.value||"none",image_size:L.elements.image_size?.value||"large",pexels_orientation:L.elements.pexels_orientation?.value||"",pexels_size:L.elements.pexels_size?.value||"",pexels_color:L.elements.pexels_color?.value||"",pixabay_orientation:L.elements.pixabay_orientation?.value||"",pixabay_image_type:L.elements.pixabay_image_type?.value||"",pixabay_category:L.elements.pixabay_category?.value||"",generate_image_title:L.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:L.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:L.elements.generate_image_caption?.checked?"1":"0",generate_image_description:L.elements.generate_image_description?.checked?"1":"0",image_title_prompt:L.elements.image_title_prompt?.value||"",image_alt_text_prompt:L.elements.image_alt_text_prompt?.value||"",image_caption_prompt:L.elements.image_caption_prompt?.value||"",image_description_prompt:L.elements.image_description_prompt?.value||""}},b=(L,U)=>{let W=U.content_title||U.topic||"",ee=U.inline_keywords||U.keywords||"",ne=ee?`${W} | ${ee}`:W,z={...L,content_title:ne};return U.rss_description&&(z.rss_description=U.rss_description),U.source_url&&(z.source_url=U.source_url),U.url_content_context&&(z.url_content_context=U.url_content_context),{data:z,topic:W,keywords:ee}},x=(L,U,W,ee,ne,z,ge)=>({original_topic:U,final_title:W,post_title:W,keywords:ee,excerpt:ne||"",image_provider:L.image_provider,image_model:L.image_model,image_prompt:L.image_prompt,image_alignment:L.image_alignment,image_size:L.image_size,featured_image_prompt:L.featured_image_prompt,pexels_orientation:L.pexels_orientation,pexels_size:L.pexels_size,pexels_color:L.pexels_color,pixabay_orientation:L.pixabay_orientation,pixabay_image_type:L.pixabay_image_type,pixabay_category:L.pixabay_category,generate_image_title:L.generate_image_title,generate_image_alt_text:L.generate_image_alt_text,generate_image_caption:L.generate_image_caption,generate_image_description:L.generate_image_description,image_title_prompt:L.image_title_prompt,image_alt_text_prompt:L.image_alt_text_prompt,image_caption_prompt:L.image_caption_prompt,image_description_prompt:L.image_description_prompt,ai_provider:L.ai_provider,ai_model:L.ai_model,ai_temperature:L.ai_temperature,reasoning_effort:L.reasoning_effort,cw_generation_mode:L.cw_generation_mode,_ajax_nonce:z,generate_images_enabled:L.generate_images_enabled,image_count:L.image_count,generate_featured_image:L.generate_featured_image,image_placement:L.image_placement,image_placement_param_x:L.image_placement_param_x,conversation_uuid:ge}),T=(L,U,W,ee,ne,z,ge)=>{let Ae=window.aipkit_getMarkdownRenderer?window.aipkit_getMarkdownRenderer():null,ot=Ae?Ae.render(ee):ee,ze=Array.isArray(U.post_categories)&&U.post_categories.length?U.post_categories:L.post_categories;return{post_title:W,post_content:ot,generated_excerpt:ne.excerpt||"",generated_tags:ne.tags||"",meta_description:ne.meta_description||"",focus_keyword:ne.focus_keyword||"",post_type:U.post_type||L.post_type,post_author:U.post_author||L.post_author,post_status:L.post_status,post_schedule_date:U.post_schedule_date||L.post_schedule_date,post_schedule_time:U.post_schedule_time||L.post_schedule_time,post_categories:ze,generate_toc:L.generate_toc,generate_seo_slug:L.generate_seo_slug,image_data:z?JSON.stringify(z):"",image_alignment:L.image_alignment,image_size:L.image_size,_ajax_nonce:ge}},P=async(L,U,W,ee,ne)=>{let z=L.item_config||{},{data:ge,topic:Ae,keywords:ot}=b(U,z),ze=Ae,Xe=ge.conversation_uuid||void 0;if(!!String(ge.custom_title_prompt||"").trim()){d(ee,"title","running");let gi=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",{...ge,conversation_uuid:Xe});if(!gi?.new_title)throw new Error(k("Title generation failed","gpt3-ai-content-generator"));ze=gi.new_title,Xe=gi.conversation_uuid||Xe,d(ee,"title","done")}else d(ee,"title","skipped");d(ee,"content","running");let Qe=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",{...ge,conversation_uuid:Xe});if(!Qe?.content)throw new Error(k("Content generation failed","gpt3-ai-content-generator"));d(ee,"content","done"),Xe=Qe.conversation_uuid||Xe||void 0,d(ee,"meta",ne.generateMeta?"done":"skipped"),d(ee,"focus",ne.generateFocus?"done":"skipped"),d(ee,"excerpt",ne.generateExcerpt?"done":"skipped"),d(ee,"tags",ne.generateTags?"done":"skipped");let Ce=null;if(W.generate_images_enabled==="1"||W.generate_featured_image==="1"){ne.generateImages&&d(ee,"image","running"),ne.generateFeatured&&d(ee,"featured","running");let gi=Qe.focus_keyword||ot||U.content_keywords||"",ae=x(W,Ae,ze,gi,Qe.excerpt||"",U._ajax_nonce,Xe),ke=W.generate_images_enabled==="1",ye=W.generate_featured_image==="1",ve=ke&&ye,Re=async(Ie={})=>{let at=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...ae,...Ie});if(!at?.image_data)throw new Error(k("Image generation failed","gpt3-ai-content-generator"));return at.image_data};if(ve){let Ie=null,at=rt=>{Ie||(Ie={...rt,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(ke){let rt=await Re({generate_featured_image:"0"});at(rt),Array.isArray(rt.in_content_images)&&Ie.in_content_images.push(...rt.in_content_images),ne.generateImages&&d(ee,"image","done")}if(ye){let rt=await Re({generate_images_enabled:"0",image_count:0});at(rt),rt.featured_image_id&&(Ie.featured_image_id=rt.featured_image_id),rt.featured_image_url&&(Ie.featured_image_url=rt.featured_image_url),ne.generateFeatured&&d(ee,"featured","done")}Ce=Ie}else Ce=await Re(),ne.generateImages&&d(ee,"image","done"),ne.generateFeatured&&d(ee,"featured","done")}else d(ee,"image","skipped"),d(ee,"featured","skipped");d(ee,"save","running");let Rt=T(W,z,ze,Qe.content,Qe,Ce,U._ajax_nonce),vi=await window.aipkit_apiRequest("aipkit_content_writer_save_post",Rt);return d(ee,"save","done"),{summary:w(Qe.content,Qe.excerpt),viewLink:vi.view_link||vi.edit_link}},H=()=>{let L=l();t.active=!1,t.stopRequested=!1,L?.generateBtn&&(typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():L.generateBtn.disabled=!1,L.generateBtn.removeAttribute("aria-disabled")),L?.generateToggle&&(L.generateToggle.disabled=!1,L.generateToggle.removeAttribute("aria-disabled")),L?.generateMenuItems?.length&&L.generateMenuItems.forEach(U=>{U.disabled=!1,U.removeAttribute("aria-disabled")}),L?.stopBtn&&(L.stopBtn.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()},O=()=>{t.active&&(t.stopRequested=!0,f(k("Stopping...","gpt3-ai-content-generator"),"info"))},F=L=>{t.items.slice(L).forEach((U,W)=>{let ee=t.rows[L+W];y(ee,"stopped")})},M=async()=>{for(let W=0;W<t.items.length;W+=1){if(t.stopRequested){F(W);break}let ee=t.rows[W];y(ee,"running");try{let ne=await P(t.items[W],t.baseData,t.postConfig,ee,t.stepContext);y(ee,"success",ne),t.totals.completed+=1}catch(ne){a(ee),y(ee,"error",{summary:ne?.message||k("Failed","gpt3-ai-content-generator")}),t.totals.failed+=1}t.totals.processed+=1,_()}let L=t.items.length,U=t.totals.completed;t.stopRequested?f(k("Generation stopped.","gpt3-ai-content-generator"),"error"):f(`${U}/${L} ${k("completed","gpt3-ai-content-generator")}`,"success"),H()},B=async(L,U)=>{if(!L||!U)return;if(!window.aipkit_apiRequest){console.error("Batch generation: aipkit_apiRequest not available.");return}let W=l();if(!W?.generateBtn)return;if(t.active){f(k("Generation already in progress.","gpt3-ai-content-generator"),"info");return}let ee=A(L),ne=C(L),z=c(ee,ne);try{t.active=!0,t.stopRequested=!1,p(),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(W.generateBtn,!0,k("Generate","gpt3-ai-content-generator"),k("Preparing\u2026","gpt3-ai-content-generator")):W.generateBtn.disabled=!0,W.queue&&(W.queue.dataset.cwMode=U),f(k("Preparing items\u2026","gpt3-ai-content-generator"),"info");let ge=await window.aipkit_apiRequest("aipkit_content_writer_prepare_batch",{...ee,cw_generation_mode:U}),Ae=Array.isArray(ge.items)?ge.items:[];if(!Ae.length){f(k("No items found to generate.","gpt3-ai-content-generator"),"error"),H();return}g(),t.items=Ae.slice(0,o),t.baseData=ee,t.postConfig=ne,t.stepContext=z,q(t.items,z),m(),_(),f(k("Generating content\u2026","gpt3-ai-content-generator"),"info"),await M()}catch(ge){f(ge?.message||k("Batch generation failed.","gpt3-ai-content-generator"),"error"),H()}},V=()=>{t.active=!1,t.stopRequested=!1,g(),u()};window.aipkit_cw_handleBatchGeneration=B,window.aipkit_cw_resetBatchQueue=V,window.aipkit_cw_requestBatchStop=O,window.aipkit_cw_isBatchActive=()=>t.active===!0})();(function(){"use strict";window.aipkit_cw_template_state={currentTemplates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,pendingModelSelection:null,pendingImageModelSelection:null,isSavingOrDeleting:!1}})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},o=window.wp?.i18n?.__||function(i){return i};function r(i,e){let t=i.value,c=t?t.toLowerCase():"",s=window.aipkit_dashboard?.models;if(!e){console.error("Content Writer Model Populator: modelSelect element is null or undefined.");return}if(!s){console.error("Content Writer Model Populator: window.aipkit_dashboard.models is NOT available."),e.innerHTML='<option value="">'+k("Error: Model data object not found")+"</option>",e.disabled=!0;return}let n=s[c];(typeof n>"u"||n===null)&&(console.warn(`Content Writer Model Populator: No model data found in allModelsData for provider key '${c}'. Defaulting to empty.`),n=c==="openai"?{}:[]),e.innerHTML="";let d=window.aipkit_dashboard?.recommendedModels?.[c]||[],a=Array.isArray(d)?d:[],l=new Set(a.map(p=>p?.id).filter(Boolean));if(c==="openai"&&typeof n=="object"&&!Array.isArray(n)){if(a.length>0){let p=document.createElement("optgroup");p.label=k(o("Recommended","gpt3-ai-content-generator")),a.forEach(_=>{if(_&&typeof _=="object"&&_.id){let f=new Option(k(_.name||_.id),_.id);p.appendChild(f)}}),p.children.length>0&&e.appendChild(p)}Object.keys(n).forEach(p=>{let _=document.createElement("optgroup");_.label=k(p);let f=n[p];Array.isArray(f)?f.forEach(g=>{if(!(g&&typeof g=="object"&&g.id&&l.has(g.id)))if(g&&typeof g=="object"&&g.id){let m=new Option(k(g.name||g.id),g.id);_.appendChild(m)}else console.warn(`Content Writer Model Populator (OpenAI): Skipping invalid model item in group '${p}':`,g)}):console.warn(`Content Writer Model Populator: Items for group '${p}' under '${c}' is not an array.`),_.children.length>0&&e.appendChild(_)})}else if(Array.isArray(n)){if(a.length>0){let _=document.createElement("optgroup");_.label=k(o("Recommended","gpt3-ai-content-generator")),a.forEach(f=>{if(f&&typeof f=="object"&&f.id){let g=new Option(k(f.name||f.id),f.id);_.appendChild(g)}}),_.children.length>0&&e.appendChild(_)}let p=a.length>0?document.createElement("optgroup"):null;p&&(p.label=k(o("All models","gpt3-ai-content-generator"))),n.forEach(_=>{if(!(_&&typeof _=="object"&&_.id&&l.has(_.id)))if(_&&typeof _=="object"&&_.id){let f=new Option(k(_.name||_.id),_.id);p?p.appendChild(f):e.appendChild(f)}else console.warn(`Content Writer Model Populator (Array): Skipping invalid model item for provider '${c}':`,_)}),p&&p.children.length>0&&e.appendChild(p)}else console.warn(`Content Writer Model Populator: Data for provider '${c}' is not in expected format. Actual type: ${typeof n}`),e.appendChild(new Option(k(`No models for ${t} (Format Error)`),""));if(!e.options||typeof e.options.length>"u")console.error("Content Writer Model Populator: modelSelect.options is invalid after attempting to populate."),e.appendChild(new Option(k("Error loading models"),"")),e.disabled=!0;else if(e.options.length===0)e.appendChild(new Option(k(`No models for ${t} (Sync in settings)`),"")),e.disabled=!0;else{e.disabled=!1;let p=null;if(window.aipkit_cw_template_state&&window.aipkit_cw_template_state.pendingModelSelection){let _=window.aipkit_cw_template_state.pendingModelSelection;e.querySelector(`option[value="${CSS.escape(_)}"]`)?p=_:console.warn(`Content Writer Model Populator: Pending model '${_}' not found in new list for provider '${t}'.`),window.aipkit_cw_template_state.pendingModelSelection=null}if(p===null){let _=e.querySelector("optgroup");_&&_.options&&_.options.length>0&&_.options[0].value?p=_.options[0].value:e.options&&e.options.length>0&&e.options[0].value?p=e.options[0].value:p=""}e.value=p}if(typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications(),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let p=document.getElementById("aipkit_content_writer_container");p&&window.aipkit_cw_toggleReasoningEffort(p)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}window.aipkit_populateModelsForContentWriter=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(l){return l},o=l=>l&&l!=="single"?l:"task",r=l=>typeof l=="string"&&l.startsWith("existing"),i=l=>l==="existing"?"existing-content":l,e={"existing-images":{title:{label:"Image Title",desc:"Optimize attachment title"},content:{label:"Description",desc:"Update image description"},excerpt:{label:"Caption",desc:"Short image caption"},keyword:{label:"Alt Text",desc:"Describe the image for accessibility"}},"existing-products":{title:{label:"Product Title",desc:"Generate product headline"},content:{label:"Product Description",desc:"Generate main product description"},meta:{label:"Meta Description",desc:"SEO meta for product pages"},keyword:{label:"Focus Keyword",desc:"Primary keyword for product SEO"},excerpt:{label:"Short Description",desc:"Short summary of the product"},tags:{label:"Tags",desc:"Auto-generate product tags"}}},t=l=>{let p=document.getElementById("aipkit_content_writer_container");if(!p)return;let _=p.querySelectorAll(".aipkit_prompt_toggle_card[data-prompt-key]");if(!_.length)return;let f=e[l]||null;_.forEach(g=>{let m=g.dataset.promptKey,u=g.querySelector(".aipkit_prompt_toggle_label"),h=g.querySelector(".aipkit_prompt_toggle_desc");if(!u||!h)return;g.dataset.defaultLabel||(g.dataset.defaultLabel=u.textContent||""),g.dataset.defaultDesc||(g.dataset.defaultDesc=h.textContent||"");let v=f&&m?f[m]:null;v?(u.textContent=v.label,h.textContent=v.desc):(u.textContent=g.dataset.defaultLabel,h.textContent=g.dataset.defaultDesc)})},c=l=>{let p=document.querySelectorAll(".aipkit_cw_prompt_flyout");if(!p.length)return;let _=l==="existing-images",f=l==="existing-products";p.forEach(g=>{let m=g.querySelector(".aipkit_cw_prompt_panel"),u=g.querySelector(".aipkit_cw_prompt_editor_title");if(!m||!u)return;if(!g.dataset.defaultTitle){let v=u.textContent||m.getAttribute("aria-label")||"";g.dataset.defaultTitle=v}let h=g.dataset.defaultTitle||"";_&&g.dataset.existingImagesTitle?h=g.dataset.existingImagesTitle:f&&g.dataset.existingProductsTitle&&(h=g.dataset.existingProductsTitle),h&&(u.textContent=h,m.setAttribute("aria-label",h))})};function s(l){if(!document.getElementById("aipkit_content_writer_form"))return;let _=o(l),f=i(_),g=document.getElementById("aipkit_cw_single_output_wrapper");g&&f!=="task"&&(g.style.display="none");let m=document.getElementById("aipkit_cw_output_card");if(m){let v=g&&g.style.display!=="none";m.style.display=f==="task"&&v?"block":"none"}let u=document.getElementById("aipkit_cw_content_prompt_placeholders");if(u){let v="Use placeholders: {topic}, {keywords}",S=r(f);f==="rss"?v+=", {description}, {source_url}":f==="url"&&(v+=", {url_content}"),v+=".";let q=v.replace(/(\{[a-zA-Z0-9_]+\})/g,y=>`<code class="aipkit-placeholder" title="Click to copy">${k(y)}</code>`);u.innerHTML=q,u.hidden=S}typeof window.aipkit_setContentWriterPromptMode=="function"&&window.aipkit_setContentWriterPromptMode(f),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState(f);let h=document.getElementById("aipkit_cw_batch_queue");if(h){let v=h.querySelector(".aipkit_cw_batch_list"),S=v?v.children.length>0:!1,q=typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive();h.hidden=!(q||S)}typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),f.startsWith("existing")&&typeof window.aipkit_fetchContentWriterExistingPosts=="function"&&window.aipkit_fetchContentWriterExistingPosts(1)}function n(l){let p=document.getElementById("aipkit_content_writer_form");if(!p)return;let _=document.getElementById("aipkit_content_writer_generate_btn"),f=_?_.querySelector(".aipkit_btn-text"):null,g=_?_.querySelector(".aipkit_cw_task_suffix"):null,m=document.querySelector(".aipkit_cw_post_summary_trigger"),u=document.querySelector(".aipkit_cw_generate_split"),h=u?u.querySelector(".aipkit_cw_generate_toggle"):null,v=u?u.querySelector(".aipkit_cw_generate_menu"):null,S=p.querySelector("#aipkit_cw_task_frequency"),q=v?Array.from(v.querySelectorAll(".aipkit_cw_generate_menu_item[data-action]")):[],y=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,E=new Set(["task","csv","rss","gsheets","url"]),I=new Set(["rss","gsheets","url"]),w=o(l||document.getElementById("aipkit_cw_mode_select")?.value||"task");w=i(w);let A=r(w),C=w==="existing-images",b=w==="existing-products",x=w==="existing-content",T=E.has(w),P=I.has(w),H=T&&(!P||y),O=w==="task"||w==="csv";p.classList.toggle("aipkit_cw_mode_existing",A),p.classList.toggle("aipkit_cw_mode_existing_images",C),p.classList.toggle("aipkit_cw_mode_existing_products",b),p.classList.toggle("aipkit_cw_mode_existing_content",x),p.querySelectorAll(".aipkit_model_settings_popover.aipkit-active").forEach(W=>{W.classList.remove("aipkit-active"),W.setAttribute("aria-hidden","true")}),p.querySelectorAll(".aipkit_cw_popover_trigger[aria-expanded='true']").forEach(W=>W.setAttribute("aria-expanded","false")),p.querySelectorAll("[data-aipkit-cw-mode-only]").forEach(W=>{let ne=W.dataset.aipkitCwModeOnly===w;W.hidden=!ne,W.setAttribute("aria-hidden",ne?"false":"true"),!ne&&W.classList.contains("aipkit_model_settings_popover")&&(W.classList.remove("aipkit-active"),W.setAttribute("aria-hidden","true")),!ne&&W.classList.contains("aipkit_cw_popover_trigger")&&W.setAttribute("aria-expanded","false")}),t(w),c(w),typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI(),(()=>{if(!r)return;let W=window.aipkit_cw_template_state;if(!W)return;let ne=(Array.isArray(W.currentTemplates)?W.currentTemplates.find(z=>String(z.id)===String(W.currentTemplateId||"")):null)?.config||W.initialConfigForSelectedTemplate;!ne||typeof ne!="object"||["generate_title","generate_content"].forEach(z=>{if(!Object.prototype.hasOwnProperty.call(ne,z))return;let ge=p.elements[z];if(!ge)return;let Ae=ne[z];ge.checked=Ae==="1"||Ae===1||Ae===!0})})(),S&&O&&Array.from(S.options).some(ee=>ee.value==="one-time")&&S.value!=="one-time"&&(S.value="one-time");let M=!1;if(w==="rss"){let W=document.getElementById("aipkit_cw_rss_items_count");M=W&&parseInt(W.value,10)>0}let B=u?.dataset?.aipkitCwAction||"generate";if(A?B=!y&&b?"upgrade":"update":(T||(B="generate"),!H&&P&&(B="upgrade")),!A&&w==="rss"&&H?M?B==="fetch_feeds"&&(B="generate"):B="fetch_feeds":B==="fetch_feeds"&&(B="generate"),!A&&B==="create_task"&&!H&&(B="generate"),!A&&H&&B!=="generate"&&B!=="create_task"&&B!=="fetch_feeds"&&(B="generate"),u&&(u.dataset.aipkitCwAction=B),q.forEach(W=>{let ee=W.dataset.action||"generate",ne=!T||P&&!y||A;ee==="create_task"&&(W.hidden=ne);let z=ee===B;W.classList.toggle("is-active",z),W.setAttribute("aria-checked",z?"true":"false")}),h){let W=H&&!A&&!(w==="rss"&&!M);h.style.display=W?"":"none",h.disabled=!W}v&&(v.dataset.keepOpen==="true"||(v.hidden=!0),v.dataset.keepOpen="false"),u&&u.classList.toggle("is-single",!H||w==="rss"&&!M);let L={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",fetch_feeds:"Fetch Feeds",update:"Update"}[B]||"Generate";if(f?f.textContent=L:_&&(typeof window.aipkit_setButtonText=="function"?window.aipkit_setButtonText(_,L):_.textContent=L),_&&(_.dataset.action=B,A||(_.removeAttribute("aria-disabled"),_.dataset.aipkitExistingDisabled&&(_.disabled=!1,delete _.dataset.aipkitExistingDisabled))),g)if(B==="create_task"&&S&&!O){let W=S.options[S.selectedIndex],ee=W?W.text:"";ee?(g.textContent=` / ${ee}`,g.hidden=!1):(g.textContent="",g.hidden=!0)}else g.textContent="",g.hidden=!0;if(m&&(m.hidden=A,m.setAttribute("aria-hidden",A?"true":"false"),A&&m.setAttribute("aria-expanded","false")),typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0);return}_?.dataset?.aipkitStopMode==="true"&&typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),typeof window.aipkit_cw_resetBatchQueue=="function"&&(B!=="generate"||!T)&&window.aipkit_cw_resetBatchQueue()}let d={task:{label:"Manual Entry",icon:"dashicons-edit"},csv:{label:"Import CSV",icon:"dashicons-media-spreadsheet"},rss:{label:"RSS Feed",icon:"dashicons-rss"},url:{label:"Website URL",icon:"dashicons-admin-links"},gsheets:{label:"Google Sheets",icon:"dashicons-analytics"},existing:{label:"Update Content",icon:"dashicons-update"},"existing-content":{label:"Update Content",icon:"dashicons-update"},"existing-images":{label:"Optimize Images",icon:"dashicons-format-image"},"existing-products":{label:"Optimize Products",icon:"dashicons-cart"}};function a(l){if(!l){console.error("Content Writer Mode: Scope element not provided for initialization.");return}let p=l.querySelector("#aipkit_cw_mode_select"),_=Array.from(l.querySelectorAll(".aipkit_cw_mode_card")),f=Array.from(l.querySelectorAll(".aipkit_cw_bulk_source_tab")),g=Array.from(l.querySelectorAll("[data-aipkit-bulk-source-panel]")),m=l.querySelector(".aipkit_cw_tab_content_container"),u=l.querySelector("[data-aipkit-source-selector]"),h=u?.querySelector("[data-aipkit-source-trigger]"),v=u?.querySelector(".aipkit_cw_source_menu"),S=v?Array.from(v.querySelectorAll(".aipkit_cw_source_option")):[],q=h?.querySelector("[data-source-label]"),y=h?.querySelector("[data-source-icon]");if(!p||!m){console.warn("Content Writer Mode: Mode selector or content container not found within the provided scope.");return}let E=x=>{_.length&&_.forEach(T=>{let P=T.dataset.mode===x;T.classList.toggle("is-active",P),T.setAttribute("aria-pressed",P?"true":"false")})},I=x=>{!f.length||!g.length||(f.forEach(T=>{let P=T.dataset.source===x;T.classList.toggle("is-active",P),T.setAttribute("aria-pressed",P?"true":"false")}),g.forEach(T=>{let P=T.dataset.aipkitBulkSourcePanel===x;T.classList.toggle("is-hidden",!P),T.hidden=!P,T.setAttribute("aria-hidden",P?"false":"true")}))},w=x=>{if(!S.length)return;let T=i(x),P=r(T);S.forEach(O=>{let F=O.dataset.source===T;O.classList.toggle("is-active",F),O.setAttribute("aria-selected",F?"true":"false")});let H=d[T]||d.task;if(q&&(q.dataset.defaultLabel||(q.dataset.defaultLabel=q.textContent||""),q.textContent=P?H.label:q.dataset.defaultLabel),y){let O=y.querySelector(".dashicons");if(O&&!y.dataset.defaultIcon){let F=O.className.split(" ").find(M=>M!=="dashicons");y.dataset.defaultIcon=F||"dashicons-plus-alt2"}if(O){let F=P?H.icon:y.dataset.defaultIcon||"dashicons-plus-alt2";O.className="dashicons "+F}y.dataset.sourceIcon=P?T:"more"}h&&h.classList.toggle("is-active",P)},A=(x=!1)=>{if(!v||!h)return;let T=h.getAttribute("aria-expanded")==="true",P=x||T;h.setAttribute("aria-expanded",P?"false":"true"),v.hidden=P},C=x=>{let T=o(x),P=i(T),H=P.startsWith("existing")?"existing":P;p.value!==T&&(p.value=T),m.querySelectorAll(".aipkit_cw_tab_content").forEach(O=>{O.classList.toggle("aipkit_active",O.dataset.pane===H)}),E(P),I(T==="csv"?"csv":"task"),w(P),s(P)};p.addEventListener("change",function(x){C(x.target.value)}),h&&h.addEventListener("click",x=>{x.stopPropagation(),A()}),S.length&&S.forEach(x=>{x.addEventListener("click",()=>{let T=x.dataset.source||"task";p.value!==T&&(p.value=T,p.dispatchEvent(new Event("change",{bubbles:!0}))),A(!0)})}),document.addEventListener("click",x=>{u&&!u.contains(x.target)&&A(!0)}),document.addEventListener("keydown",x=>{x.key==="Escape"&&v&&!v.hidden&&(A(!0),h?.focus())}),_.length&&_.forEach(x=>{x.dataset.listenerAttached||(x.addEventListener("click",()=>{let T=x.dataset.mode||"task";p.value!==T&&(p.value=T,p.dispatchEvent(new Event("change",{bubbles:!0})))}),x.dataset.listenerAttached="true")}),f.length&&f.forEach(x=>{x.dataset.listenerAttached||(x.addEventListener("click",()=>{let P=(x.dataset.source||"task")==="csv"?"csv":"task";p.value!==P&&(p.value=P,p.dispatchEvent(new Event("change",{bubbles:!0})))}),x.dataset.listenerAttached="true")});let b=p.value||"task";C(b==="single"?"task":b)}window.aipkit_initContentWriterTabs=a,window.aipkit_updateContentWriterActionState=n})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(m){return String(m||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},o=["keyword","title","excerpt","content","meta","tags"],r={keyword:"Focus keyword",title:"Title",excerpt:"Excerpt",content:"Content",meta:"Meta description",tags:"Tags",slug:"URL"},e={"existing-content":{fieldOrder:o,fieldLabels:r,postTypeOverride:"",allowMeta:!0,allowTags:!0,allowSlug:!0},"existing-images":{fieldOrder:["keyword","title","excerpt","content"],fieldLabels:{keyword:"Alt text",title:"Image title",excerpt:"Caption",content:"Description"},postTypeOverride:"attachment",allowMeta:!1,allowTags:!1,allowSlug:!1,useImageMetadataPrompts:!0},"existing-products":{fieldOrder:o,fieldLabels:r,postTypeOverride:"product",allowMeta:!0,allowTags:!0,allowSlug:!0}},t=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}"],c=["{price}","{regular_price}","{sale_price}","{sku}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{product_categories}"],s={title:["{original_title}"],content:["{original_content}","{short_description}"],meta:["{original_title}","{short_description}","{original_content}"],keyword:["{original_title}","{original_content}"],excerpt:["{short_description}","{original_content}","{original_excerpt}"],tags:["{original_content}","{attributes}","{product_categories}"]},n=["{file_name}","{original_title}","{original_alt}","{original_caption}","{original_description}"],d=["Generate product titles, descriptions, and SEO fields.","Use product data like price, SKU, and attributes.","Bulk optimize selected products."],a={short:2e3,medium:4e3,long:6e3},l=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan,p=window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.aipkit_dashboard.upgradeUrl:"",_=2400;function f(m=1){if(typeof window.aipkit_cw_existing_handleFetch=="function"){window.aipkit_cw_existing_handleFetch(m);return}window.aipkit_cw_existing_pendingFetch=m}function g(m){if(!m)return;let u=m.querySelector("[data-aipkit-existing-panel]");if(!u||u.dataset.init==="true")return;let h=u.querySelector("#aipkit_cw_existing_post_type"),v=u.querySelector("#aipkit_cw_existing_post_status"),S=u.querySelector("#aipkit_cw_existing_media_filter"),q=u.querySelector("#aipkit_cw_existing_search"),y=u.querySelector("#aipkit_cw_existing_refresh"),E=u.querySelector("#aipkit_cw_existing_select_all"),I=u.querySelector("#aipkit_cw_existing_posts_body"),w=u.querySelector("#aipkit_cw_existing_page_status"),A=u.querySelector("#aipkit_cw_existing_page_prev"),C=u.querySelector("#aipkit_cw_existing_page_next"),b=u.querySelector("#aipkit_cw_existing_selected_count"),x=document.getElementById("aipkit_content_writer_generate_btn")||u.querySelector("#aipkit_cw_existing_open_assistant"),T=document.getElementById("aipkit_cw_mode_select");if(!I)return;let P=document.getElementById("aipkit_content_writer_nonce"),H=10,O=1,F=1,M=null,B=!1,V=!1,L=!1,U=[],W=new Set,ee=new Map,ne=h?h.value:"",z=!1,ge=x?x.querySelector(".aipkit_btn-text"):null,Ae=x&&x.dataset.action||"generate",ot=_e=>_e?_e==="existing"?"existing-content":_e.indexOf("existing-")===0?_e:"":"",ze=()=>ot(T?T.value:""),Xe=()=>e[ze()]||e["existing-content"],Ge=()=>!!ze(),It=document.getElementById("aipkit_content_writer_form_status"),Qe="",Ce=null,St=()=>{Ce&&(clearTimeout(Ce),Ce=null)},Rt=(_e,Me)=>{It&&(St(),It.textContent=_e||"",It.className="aipkit_cw_status_badge",Me==="info"?It.classList.add("aipkit_settings_message-info"):Me==="error"?It.classList.add("aipkit_settings_message-error"):Me==="success"&&It.classList.add("aipkit_settings_message-success"),_e?It.dataset.cwUpdateStatus="1":delete It.dataset.cwUpdateStatus)},vi=()=>{V&&(L=!0,Rt("Stopping...","info"))},gi=()=>{It&&(St(),Ce=setTimeout(()=>{It.dataset.cwUpdateStatus==="1"&&Rt("","")},4e3))},ae=_e=>{if(!It){Qe="";return}if(!_e){It.dataset.cwProNotice==="1"&&(!Qe||It.textContent.startsWith(Qe))&&(It.textContent="",It.className="aipkit_cw_status_badge"),delete It.dataset.cwProNotice,Qe="";return}let Me=p?` <a class="aipkit_popover_upgrade_link" href="${k(p)}" target="_blank" rel="noopener noreferrer">Upgrade</a>`:"";Qe=_e,It.dataset.cwProNotice="1",It.className="aipkit_cw_status_badge aipkit_settings_message-info",It.innerHTML=`${k(_e)}${Me}`};if(h&&!l){let _e=h.querySelector('option[value="product"]');_e&&!_e.dataset.proLabel&&(_e.dataset.proLabel=_e.textContent||"Products")}let ke=_e=>{z=!!_e,x&&(x.dataset.action=z?"upgrade":Ae,ge&&Ge()&&(ge.textContent=z?"Upgrade":"Update"))},ye=_e=>{let Me=[],Ee=[];return _e.forEach(lt=>{let st=U.find(jt=>Number(jt.id)===lt);st&&st.type==="product"?Me.push(lt):Ee.push(lt)}),{productIds:Me,otherIds:Ee}},ve=()=>{if(!Ge()||ze()!=="existing-content"){ke(!1),ae("");return}if(l){ke(!1),ae("");return}let _e=Array.from(W),{productIds:Me,otherIds:Ee}=ye(_e);if(h&&h.value==="product"){ke(!0);return}if(Me.length&&!Ee.length){ke(!0);return}if(Me.length&&Ee.length){ke(!1);return}ke(!1),ae("")},Re=_e=>{I&&(I.innerHTML=`
        <tr class="aipkit_cw_existing_empty">
          <td colspan="7">${k(_e)}</td>
        </tr>
      `,Ie())},Ie=()=>{let _e=W.size;if(ve(),b&&(b.textContent=`${_e} selected`),x&&Ge()){let Me=z?V:_e===0||V;x.disabled=Me,x.setAttribute("aria-disabled",Me?"true":"false"),Me?x.dataset.aipkitExistingDisabled="true":delete x.dataset.aipkitExistingDisabled}if(E){let Me=U.length>0&&U.every(Ee=>W.has(Ee.id));E.checked=Me}},at=()=>{w&&(w.textContent=`Page ${O} of ${F}`),A&&(A.disabled=O<=1),C&&(C.disabled=O>=F)},rt=(_e,Me)=>{if(U=Array.isArray(_e)?_e:[],O=Me?.page||1,F=Me?.total_pages||1,!U.length){Re("No posts found."),at(),Ie();return}let Ee=ze()==="existing-images",lt=U.map(st=>{let jt=Number(st.id),Jt=k(st.title||"(Untitled)"),$t=k(st.edit_link||"#"),vt=k(st.type_label||""),Pt=k(st.status_label||""),ki=Ee?k(st.alt_text||""):"",oi=Ee?k(st.caption||""):"",Be=Ee?k(st.description||""):"",Mt=Ee?k(st.thumb_url||""):"",ut=W.has(jt)?"checked":"",Ci=k(st.type||"post"),tn=Jt?` title="${Jt}"`:"",Dt=ki?` title="${ki}"`:"",on=oi?` title="${oi}"`:"",Zi=Be?` title="${Be}"`:"",sn=Mt?`<span class="aipkit_cw_existing_thumb"><img src="${Mt}" alt="" loading="lazy"></span>`:'<span class="aipkit_cw_existing_thumb aipkit_cw_existing_thumb--empty" aria-hidden="true"></span>',En=Ee?`
                <div class="aipkit_cw_existing_title_stack">
                  ${sn}
                  <div class="aipkit_cw_existing_title_meta">
                    <a class="row-title aipkit_cw_existing_truncate" href="${$t}" target="_blank" rel="noopener noreferrer"${tn}>${Jt}</a>
                    <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                  </div>
                </div>
              `:`
                <div class="aipkit_cw_existing_title_inline">
                  <a class="row-title aipkit_cw_existing_truncate" href="${$t}" target="_blank" rel="noopener noreferrer"${tn}>${Jt}</a>
                  <span class="aipkit_cw_existing_status" aria-live="polite"></span>
                </div>
              `;return`
            <tr id="post-${jt}" data-post-type="${Ci}">
              <td class="aipkit_cw_existing_col_check">
                <input type="checkbox" class="aipkit_cw_existing_row_checkbox" value="${jt}" ${ut}>
              </td>
              <td class="aipkit_cw_existing_title">
                ${En}
              </td>
              <td class="aipkit_cw_existing_col_type">${vt}</td>
              <td class="aipkit_cw_existing_col_status">${Pt}</td>
              <td class="aipkit_cw_existing_col_alt"><span class="aipkit_cw_existing_truncate"${Dt}>${ki}</span></td>
              <td class="aipkit_cw_existing_col_caption"><span class="aipkit_cw_existing_truncate"${on}>${oi}</span></td>
              <td class="aipkit_cw_existing_col_description"><span class="aipkit_cw_existing_truncate"${Zi}>${Be}</span></td>
            </tr>
          `}).join("");I.innerHTML=lt,at(),Ie()},Ft=_e=>{let Me=String(_e||"").trim();return Me||"(Untitled)"},_i=(_e,Me)=>{let Ee=u.querySelector(`#post-${_e}`);if(!Ee)return;let lt=Ee.querySelector(".row-title");if(!lt)return;let st=Ft(Me);lt.textContent=st,lt.setAttribute("title",st);let jt=U.find(Jt=>Number(Jt.id)===_e);jt&&(jt.title=st)},Lt=(_e,Me,Ee)=>{let lt=u.querySelector(`#post-${_e}`);if(!lt)return;let st="",jt="";if(Me==="keyword")st=".aipkit_cw_existing_col_alt .aipkit_cw_existing_truncate",jt="alt_text";else if(Me==="excerpt")st=".aipkit_cw_existing_col_caption .aipkit_cw_existing_truncate",jt="caption";else if(Me==="content")st=".aipkit_cw_existing_col_description .aipkit_cw_existing_truncate",jt="description";else return;let Jt=lt.querySelector(st);if(!Jt)return;let $t=String(Ee||"").trim();Jt.textContent=$t,$t?Jt.setAttribute("title",$t):Jt.removeAttribute("title");let vt=U.find(Pt=>Number(Pt.id)===_e);vt&&jt&&(vt[jt]=$t)},Et=_e=>{let Me=ee.get(_e);Me&&(clearTimeout(Me),ee.delete(_e))},tt=(_e,Me,Ee)=>{let lt=u.querySelector(`#post-${_e}`);if(!lt)return;let st=lt.querySelector(".aipkit_cw_existing_status");if(st){if(Et(_e),st.classList.remove("is-visible","is-error","is-success","is-processing","is-queued"),!Ee){st.textContent="";return}st.textContent=Ee,st.classList.add("is-visible"),Me==="error"&&st.classList.add("is-error"),Me==="success"&&st.classList.add("is-success"),Me==="processing"&&st.classList.add("is-processing"),Me==="queued"&&st.classList.add("is-queued")}},De=_e=>tt(_e,"",""),Ke=_e=>{Et(_e);let Me=setTimeout(()=>De(_e),_);ee.set(_e,Me)},xt=_e=>{if(V=_e,x&&Ge()){let Me=x.dataset&&x.dataset.aipkitStopMode==="true",Ee=z?_e:W.size===0||_e&&!Me;x.disabled=Ee,x.setAttribute("aria-disabled",Ee?"true":"false"),Ee?x.dataset.aipkitExistingDisabled="true":delete x.dataset.aipkitExistingDisabled}if(y&&(y.disabled=_e),h){let Me=Xe();h.disabled=_e||!!Me.postTypeOverride}v&&(v.disabled=_e),q&&(q.disabled=_e),A&&(A.disabled=_e||O<=1),C&&(C.disabled=_e||O>=F),E&&(E.disabled=_e),I.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Me=>{Me.disabled=_e})},zt=()=>{let _e=Xe();h&&(_e.postTypeOverride?(h.value=_e.postTypeOverride,h.disabled=!0):(h.disabled=!1,h.value=ne||"")),v&&_e.postTypeOverride==="attachment"&&(v.value="")},wt=_e=>{!x||!Ge()||x.dataset&&x.dataset.aipkitStopMode==="true"||(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(x,_e,"Update","Updating..."):x.disabled=_e)},Je=(_e,Me)=>{let Ee=`${Me}_update`,lt=_e&&_e[Ee]||_e&&_e[Me]||"";return String(lt||"").trim()},ui=_e=>{let Me=document.getElementById("aipkit_content_writer_form");if(!Me||typeof window.aipkit_getContentWriterFormConfig!="function")return{error:"Content Writer form is not ready yet."};let Ee=window.aipkit_getContentWriterFormConfig(Me),lt=!!_e.useImageMetadataPrompts;if(!l&&_e.postTypeOverride==="product")return{error:"Optimize Products is a Pro feature. Upgrade to continue."};let st=ut=>lt?ut==="title"?Ee.generate_image_title==="1":ut==="keyword"?Ee.generate_image_alt_text==="1":ut==="excerpt"?Ee.generate_image_caption==="1":ut==="content"?Ee.generate_image_description==="1":!1:ut==="meta"&&!_e.allowMeta||ut==="tags"&&!_e.allowTags?!1:ut==="title"?Ee.generate_title!=="0":ut==="content"?Ee.generate_content!=="0":ut==="meta"?Ee.generate_meta_description==="1":ut==="keyword"?Ee.generate_focus_keyword==="1":ut==="excerpt"?Ee.generate_excerpt==="1":ut==="tags"?Ee.generate_tags==="1":!1,jt=lt?{title:st("title")?Je(Ee,"image_title_prompt"):"",content:st("content")?Je(Ee,"image_description_prompt"):"",meta:"",keyword:st("keyword")?Je(Ee,"image_alt_text_prompt"):"",excerpt:st("excerpt")?Je(Ee,"image_caption_prompt"):"",tags:""}:{title:st("title")?Je(Ee,"custom_title_prompt"):"",content:st("content")?Je(Ee,"custom_content_prompt"):"",meta:st("meta")?Je(Ee,"custom_meta_prompt"):"",keyword:st("keyword")?Je(Ee,"custom_keyword_prompt"):"",excerpt:st("excerpt")?Je(Ee,"custom_excerpt_prompt"):"",tags:st("tags")?Je(Ee,"custom_tags_prompt"):""},Jt=[],$t=ut=>_e.fieldLabels?.[ut]||r[ut]||ut;if(st("title")&&!jt.title&&Jt.push(`${$t("title")} prompt is required.`),st("content")&&!jt.content&&Jt.push(`${$t("content")} prompt is required.`),st("meta")&&!jt.meta&&Jt.push(`${$t("meta")} prompt is required.`),st("keyword")&&!jt.keyword&&Jt.push(`${$t("keyword")} prompt is required.`),st("excerpt")&&!jt.excerpt&&Jt.push(`${$t("excerpt")} prompt is required.`),st("tags")&&!jt.tags&&Jt.push(`${$t("tags")} prompt is required.`),Jt.length)return{error:Jt.join(" ")};let vt=[],Pt=(ut,Ci)=>Ci.some(tn=>ut.includes(tn)),ki=ut=>lt?n:_e.postTypeOverride==="product"&&s[ut]||t;if(_e.fieldOrder.forEach(ut=>{let Ci=jt[ut];if(!Ci)return;let tn=ki(ut);Pt(Ci,tn)||vt.push(`${$t(ut)} prompt: add one of ${tn.join(", ")}.`)}),vt.length)return{error:`${lt?"Image optimization":_e.postTypeOverride==="product"?"Product update":"Update"} works best when prompts include source placeholders.

${vt.join(`
`)}`};let oi=String(Ee.content_length||"medium"),Be=a[oi]||a.medium,Mt={ai_provider:Ee.ai_provider||"openai",ai_model:Ee.ai_model||"",temperature:parseFloat(Ee.ai_temperature||"1"),max_tokens:Be,reasoning_effort:Ee.reasoning_effort||"",generate_seo_slug:_e.allowSlug&&Ee.generate_seo_slug||"0",enable_vector_store:Ee.enable_vector_store||"0",vector_store_provider:Ee.vector_store_provider||"openai",vector_store_top_k:Ee.vector_store_top_k||"3",openai_vector_store_ids:Ee.openai_vector_store_ids||[],pinecone_index_name:Ee.pinecone_index_name||"",qdrant_collection_name:Ee.qdrant_collection_name||"",vector_embedding_provider:Ee.vector_embedding_provider||"",vector_embedding_model:Ee.vector_embedding_model||""};return{prompts:jt,baseConfig:Mt}},bi=(_e,Me,Ee)=>({[_e]:{prompt:Me},ai_provider:Ee.ai_provider,ai_model:Ee.ai_model,temperature:Ee.temperature,max_tokens:Ee.max_tokens,reasoning_effort:Ee.reasoning_effort,enable_vector_store:Ee.enable_vector_store,vector_store_provider:Ee.vector_store_provider,vector_store_top_k:Ee.vector_store_top_k,openai_vector_store_ids:Ee.openai_vector_store_ids,pinecone_index_name:Ee.pinecone_index_name,qdrant_collection_name:Ee.qdrant_collection_name,vector_embedding_provider:Ee.vector_embedding_provider,vector_embedding_model:Ee.vector_embedding_model}),Xt=async(_e=1)=>{if(!B){if(typeof window.aipkit_apiRequest!="function"){console.error("Content Writer Existing: aipkit_apiRequest not found.");return}B=!0,Re("Loading posts...");try{let Ee=Xe().postTypeOverride||(h?h.value:""),lt=await window.aipkit_apiRequest("aipkit_content_writer_fetch_existing_posts",{_ajax_nonce:P?P.value:"",post_type:Ee,post_status:v?v.value:"",media_filter:S?S.value:"",search:q?q.value.trim():"",paged:_e,per_page:H});rt(lt.posts||[],lt.pagination||{})}catch(Me){console.error("Content Writer Existing: fetch failed",Me),Re("Unable to load posts. Please try again.")}finally{B=!1}}},Tt=()=>{W.clear(),Ie()};I.addEventListener("change",_e=>{let Me=_e.target;if(!Me||!Me.classList.contains("aipkit_cw_existing_row_checkbox"))return;let Ee=Number(Me.value||0);Ee&&(Me.checked?W.add(Ee):W.delete(Ee),Ie())}),E&&E.addEventListener("change",()=>{let _e=E.checked;U.forEach(Ee=>{_e?W.add(Number(Ee.id)):W.delete(Number(Ee.id))}),I.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(Ee=>{Ee.checked=_e}),Ie()}),A&&A.addEventListener("click",()=>{O>1&&Xt(O-1)}),C&&C.addEventListener("click",()=>{O<F&&Xt(O+1)}),y&&y.addEventListener("click",()=>{Tt(),Xt(1)}),h&&h.addEventListener("change",()=>{Xe().postTypeOverride||(ne=h.value),Tt(),Xt(1)}),v&&v.addEventListener("change",()=>{Tt(),Xt(1)}),S&&S.addEventListener("change",()=>{Tt(),Xt(1)}),q&&q.addEventListener("input",()=>{M&&clearTimeout(M),M=setTimeout(()=>{Tt(),Xt(1)},300)});let Qt=_e=>{typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(_e,{title:"Update existing"}):alert(_e)},ii=()=>{let _e="Bulk image optimization is available on Pro. Select one image or upgrade.";if(typeof window.aipkit_showAlertModal=="function"){let Me=[];p&&Me.push({label:"Upgrade to Pro",href:p,className:"aipkit_btn aipkit_btn-primary"}),Me.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(_e,{title:"Optimize Images",actions:Me})}else alert(_e)},Ri=()=>{let _e="Optimize Products is a Pro feature.";if(typeof window.aipkit_showAlertModal=="function"){let Me=[];p&&Me.push({label:"Upgrade to Pro",href:p,className:"aipkit_btn aipkit_btn-primary"}),Me.push({label:"Close",className:"aipkit_btn aipkit_btn-secondary"}),window.aipkit_showAlertModal(_e,{title:"Optimize Products",bullets:d,actions:Me})}else alert(_e)},Qi=async(_e,Me,Ee,lt,st)=>{let jt=`cw-existing-${_e}-${Date.now()}`,Jt=!1;if(L)return tt(_e,"","Stopped"),Ke(_e),{success:!1,stopped:!0};for(let $t of st.fieldOrder){let vt=Me[$t];if(!vt)continue;if(L)return tt(_e,"","Stopped"),Ke(_e),{success:!1,stopped:!0};tt(_e,"processing",`Updating ${st.fieldLabels[$t]||$t}...`);let Pt=bi($t,vt,Ee),ki={_ajax_nonce:lt,post_id:_e,field:$t,enhancements:JSON.stringify(Pt),conversation_uuid:jt};try{let oi=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",ki,{timeout:18e4});oi&&Object.prototype.hasOwnProperty.call(oi,"updated_value")&&($t==="title"?_i(_e,oi.updated_value):Lt(_e,$t,oi.updated_value)),Jt=!0}catch(oi){let Be=oi&&oi.message||"Update failed. Please try again.";return tt(_e,"error",Be),{success:!1}}}if(L)return tt(_e,"","Stopped"),Ke(_e),{success:!1,stopped:!0};if(Ee.generate_seo_slug==="1"&&Jt){tt(_e,"processing","Updating URL...");try{await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",{_ajax_nonce:lt,post_id:_e,action_type:"update_slug"},{timeout:3e4})}catch{return tt(_e,"error","URL update failed."),{success:!1}}}return Jt?(tt(_e,"success","Updated"),Ke(_e),{success:!0}):(tt(_e,"error","No prompts selected."),{success:!1})},Ht=async()=>{if(V||!Ge())return;let _e=Array.from(W);if(!_e.length)return;if(!l&&ze()==="existing-content"){let{productIds:Be,otherIds:Mt}=ye(_e);if(Be.length&&!Mt.length){Ri(),Ie();return}Be.length&&Mt.length&&(Be.forEach(ut=>{tt(ut,"error","Skipped (Pro)"),Ke(ut)}),_e=Mt)}if(!_e.length){Ie();return}if(!l&&ze()==="existing-images"&&_e.length>1){ii();return}if(typeof window.aipkit_apiRequest!="function"){Qt("Update service is not available yet.");return}let Me=window.aipkit_post_enhancer?.nonce_generate_title;if(!Me){Qt("Update permission is missing. Please reload the page.");return}let Ee=Xe(),{prompts:lt,baseConfig:st,error:jt}=ui(Ee);if(jt){!l&&Ee.postTypeOverride==="product"?Ri():Qt(jt);return}if(!Ee.fieldOrder.some(Be=>!!lt[Be])){Qt("No prompts selected for update.");return}L=!1,_e.forEach(Be=>{tt(Be,"queued","Queued")});let $t=0,vt=0,Pt=_e.length,ki=null,oi=()=>{let Be=[];return Be.push(`Updating ${Pt} item${Pt===1?"":"s"}...`),$t&&Be.push(`${$t} done`),vt&&Be.push(`${vt} error${vt===1?"":"s"}`),Be.join(" ")};Rt(oi(),"info"),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):wt(!0),xt(!0);for(let Be=0;Be<_e.length;Be+=1){let Mt=_e[Be];if(L){ki=Be;break}let ut=await Qi(Mt,lt,st,Me,Ee);if(ut&&ut.stopped){L=!0,ki=Be+1;break}ut&&ut.success?$t+=1:vt+=1,Rt(oi(),"info")}if(xt(!1),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():wt(!1),L){(ki!==null?_e.slice(ki):[]).forEach(ut=>{tt(ut,"","Stopped"),Ke(ut)});let Mt=[`Update stopped: ${$t} done`];vt&&Mt.push(`${vt} error${vt===1?"":"s"}`),Rt(Mt.join(", ")+".","info")}else vt?Rt(`Update complete: ${$t} done, ${vt} error${vt===1?"":"s"}.`,"error"):Rt(`Update complete: ${$t} done.`,"success");gi(),Ie()};u.dataset.init="true",window.aipkit_cw_existing_handleFetch=Xt,window.aipkit_runContentWriterExistingUpdate=Ht,window.aipkit_cw_isExistingUpdateActive=()=>V,window.aipkit_cw_requestExistingUpdateStop=vi,T&&!T.dataset.aipkitExistingListener&&(T.addEventListener("change",()=>{S&&(S.value=""),zt(),Tt()},!0),T.dataset.aipkitExistingListener="true"),zt(),window.aipkit_cw_existing_pendingFetch&&(Xt(window.aipkit_cw_existing_pendingFetch),window.aipkit_cw_existing_pendingFetch=null)}window.aipkit_initContentWriterExistingContent=g,window.aipkit_fetchContentWriterExistingPosts=f})();(function(){"use strict";let k=[{key:"custom_title_prompt",textareaId:"aipkit_cw_custom_title_prompt",updateInputId:"aipkit_cw_custom_title_prompt_update"},{key:"custom_content_prompt",textareaId:"aipkit_cw_custom_content_prompt",updateInputId:"aipkit_cw_custom_content_prompt_update"},{key:"custom_meta_prompt",textareaId:"aipkit_cw_custom_meta_prompt",updateInputId:"aipkit_cw_custom_meta_prompt_update"},{key:"custom_keyword_prompt",textareaId:"aipkit_cw_custom_keyword_prompt",updateInputId:"aipkit_cw_custom_keyword_prompt_update"},{key:"custom_excerpt_prompt",textareaId:"aipkit_cw_custom_excerpt_prompt",updateInputId:"aipkit_cw_custom_excerpt_prompt_update"},{key:"custom_tags_prompt",textareaId:"aipkit_cw_custom_tags_prompt",updateInputId:"aipkit_cw_custom_tags_prompt_update"},{key:"image_prompt",textareaId:"aipkit_cw_image_prompt",updateInputId:"aipkit_cw_image_prompt_update"},{key:"featured_image_prompt",textareaId:"aipkit_cw_featured_image_prompt",updateInputId:"aipkit_cw_featured_image_prompt_update"},{key:"image_title_prompt",textareaId:"aipkit_cw_image_title_prompt",updateInputId:"aipkit_cw_image_title_prompt_update"},{key:"image_alt_text_prompt",textareaId:"aipkit_cw_image_alt_text_prompt",updateInputId:"aipkit_cw_image_alt_text_prompt_update"},{key:"image_caption_prompt",textareaId:"aipkit_cw_image_caption_prompt",updateInputId:"aipkit_cw_image_caption_prompt_update"},{key:"image_description_prompt",textareaId:"aipkit_cw_image_description_prompt",updateInputId:"aipkit_cw_image_description_prompt_update"}],o={create:{},update:{}},r={},i=[],e="create",t=!1,c=m=>m&&m!=="single"?m:"task",s=()=>{let m=document.getElementById("aipkit_cw_mode_select");return c(m?.value||"task")},n=m=>m&&m.indexOf("existing")===0?"update":"create",d=(m,u,h)=>{if(h)return String(m||"");let v=String(m||"").trim()?m:u||"";return String(v||"")},a=()=>{if(t)return;let m=e==="update";i.forEach(({key:u,textarea:h,updateInput:v})=>{if(!h)return;let S=h.value||"";if(!m){o.create[u]=S;return}r[u]&&(o.update[u]=S,v&&(v.value=S))})},l=()=>{t=!0;let m=e==="update";i.forEach(({key:u,textarea:h,updateInput:v})=>{if(!h)return;let S=o.create[u]||"",q=o.update[u]||"",y=!!r[u],E=m?d(q,S,y):S;h.value=E||"",m&&v&&(v.value=y?q:"")}),t=!1},p=m=>{let u=n(c(m));u!==e&&(a(),e=u,l())},_=m=>{!m||m.dataset.aipkitPromptModeInit==="true"||(i=k.map(u=>{let h=m.querySelector(`#${u.textareaId}`)||document.getElementById(u.textareaId),v=m.querySelector(`#${u.updateInputId}`)||document.getElementById(u.updateInputId);return{...u,textarea:h,updateInput:v}}),i.some(u=>u.textarea)&&(i.forEach(u=>{let h=u.textarea&&u.textarea.value||"";o.create[u.key]=h;let v=u.updateInput&&u.updateInput.value||"";o.update[u.key]=v,r[u.key]=!!v,u.textarea&&!u.textarea.dataset.aipkitPromptModeListener&&(u.textarea.addEventListener("input",()=>{if(t)return;let S=u.textarea.value||"";e==="update"?(o.update[u.key]=S,r[u.key]=!0,u.updateInput&&(u.updateInput.value=S)):o.create[u.key]=S}),u.textarea.dataset.aipkitPromptModeListener="true")}),m.dataset.aipkitPromptModeInit="true",p(s())))},f=m=>{if(!m||typeof m!="object")return;let u=h=>Object.prototype.hasOwnProperty.call(m,h);i.forEach(h=>{let v=h.key,S=`${v}_update`;if(u(v)&&(o.create[v]=m[v]||""),u(S)){let q=m[S]||"";o.update[v]=q,r[v]=!!q,h.updateInput&&(h.updateInput.value=r[v]?q:"")}}),l()},g=()=>({create:{...o.create},update:{...o.update}});window.aipkit_initContentWriterPromptModeManager=_,window.aipkit_setContentWriterPromptMode=p,window.aipkit_applyContentWriterPromptSets=f,window.aipkit_getContentWriterPromptSets=g})();(function(){"use strict";let k={title:["{topic}","{keywords}"],content:["{topic}","{keywords}"],meta:["{topic}","{content_summary}","{keywords}"],keyword:["{topic}","{content_summary}"],excerpt:["{topic}","{keywords}","{content_summary}"],tags:["{topic}","{keywords}","{content_summary}"],image:["{topic}","{keywords}","{excerpt}","{post_title}"],featured_image:["{topic}","{post_title}","{excerpt}","{keywords}"],image_title:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_alt_text:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_caption:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"],image_description:["{topic}","{keywords}","{post_title}","{excerpt}","{file_name}"]},o=["{original_title}","{original_content}","{original_excerpt}","{original_meta_description}","{original_focus_keyword}","{original_tags}","{categories}","{price}","{regular_price}","{sale_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{short_description}","{purchase_note}","{total_sales}","{product_categories}"],r={rss:["{description}","{source_url}"],url:["{url_content}","{source_url}"]},i={existing:{title:["{original_title}","{original_content}","{original_focus_keyword}"],content:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],meta:["{original_title}","{original_content}","{original_focus_keyword}","{original_tags}","{categories}"],keyword:["{original_title}","{original_content}"],excerpt:["{original_title}","{original_content}","{original_excerpt}"],tags:["{original_title}","{original_content}","{original_tags}","{categories}"],image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],featured_image:["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"]},"existing-images":{title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],content:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],excerpt:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],keyword:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_title:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_alt_text:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_caption:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image_description:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"],featured_image:["{original_title}","{original_caption}","{original_description}","{original_alt}","{file_name}"]},"existing-products":{title:o,content:o,meta:o,keyword:o,excerpt:o,tags:o}},e={aipkit_cw_image_title_prompt:"image_title",aipkit_cw_image_alt_text_prompt:"image_alt_text",aipkit_cw_image_caption_prompt:"image_caption",aipkit_cw_image_description_prompt:"image_description"},t=p=>String(p??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),c=()=>{let _=document.getElementById("aipkit_cw_mode_select")?.value||"task";return _==="single"&&(_="task"),_},s=(p,_)=>{let f=window.aipkit_content_writer_config?.default_prompts||{};if(_==="existing-images"){let g=`${p}_update`;if(f[g])return f[g]}return f[p]||""},n=(p,_)=>{let f=i[_]||(_.indexOf("existing")===0?i.existing:null);if(f&&f[p])return f[p];let g=k[p]||[],m=r[_]||[],u=[...g,...m];return u.filter((h,v)=>u.indexOf(h)===v)},d=(p,_)=>{if(!p)return;let f=p.dataset.label||"Variables:",g=p.dataset.copyTitle||"Click to copy";p.innerHTML=`${t(f)} `,_.forEach((m,u)=>{let h=document.createElement("code");h.className="aipkit-placeholder",h.title=g,h.textContent=m,p.appendChild(h),u<_.length-1&&p.appendChild(document.createTextNode(" "))})},a=p=>{let _=p?.querySelector(".aipkit_cw_prompt_editor_placeholders");if(!_)return;let f=_.dataset.promptType||"",g=c(),m=n(f,g);d(_,m)};function l(p){if(!p)return;let _=p.querySelectorAll("[data-aipkit-flyout-target]");if(!_.length)return;let f=p.querySelectorAll(".aipkit_cw_prompt_library_select"),g=w=>{f.length&&f.forEach(A=>{let C=A.getAttribute("data-aipkit-prompt-target"),b=e[C];if(!b)return;let x=A.options?A.options[0]:null;if(!x)return;if(Array.from(A.options).forEach((P,H)=>{let O=P.dataset.aipkitMode||"both",F=!0;H!==0&&(w==="existing-images"?F=O!=="create":F=O!=="update"),P.hidden=!F}),A.dataset.aipkitDefaultCreate||(A.dataset.aipkitDefaultCreate=x.value||""),w==="existing-images"){let P=s(b,w);P&&(A.dataset.aipkitDefaultUpdate=P,x.value=P)}else x.value=A.dataset.aipkitDefaultCreate||x.value||"";A.selectedOptions.length&&A.selectedOptions[0].hidden&&(A.selectedIndex=0)})},m=null,u=null,h=!1,v=w=>w?p.querySelector(`#${w}`):null,S=(w,A,C)=>{if(!w||!A)return;let b=w.getBoundingClientRect(),x=C?C.getBoundingClientRect():b,T=A.getBoundingClientRect(),P=T.width||440,H=T.height||0,O=window.innerWidth,F=window.innerHeight,M=12,B=x.left-P-10;B<M&&(B=x.right+10),B=Math.max(M,Math.min(B,O-P-M));let V=x.top;V+H>F-M&&(V=F-H-M),V=Math.max(M,V),m.style.left=`${Math.round(B)}px`,m.style.top=`${Math.round(V)}px`},q=()=>{!u||!m||h||(h=!0,window.requestAnimationFrame(()=>{let w=m.querySelector(".aipkit_cw_prompt_panel"),A=u.closest(".aipkit_model_settings_popover_panel");S(u,w,A),h=!1}))},y=()=>{m&&(m.classList.remove("is-open"),m.setAttribute("aria-hidden","true"),u&&u.setAttribute("aria-expanded","false"),m=null,u=null)},E=w=>{let A=w.getAttribute("data-aipkit-flyout-target"),C=v(A);if(!C)return;m&&m!==C&&y(),m=C,u=w,C.classList.add("is-open"),C.setAttribute("aria-hidden","false"),w.setAttribute("aria-expanded","true"),a(C);let b=C.querySelector(".aipkit_cw_prompt_panel"),x=w.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{S(w,b,x)})};_.forEach(w=>{w.dataset.flyoutListenerAttached!=="true"&&(w.addEventListener("click",A=>{if(A.preventDefault(),m&&u===w&&m.classList.contains("is-open")){y();return}E(w)}),w.dataset.flyoutListenerAttached="true")});let I=c();if(g(I),f.forEach(w=>{let A=w.getAttribute("data-aipkit-prompt-target"),C=A?p.querySelector(`#${A}`):null;C&&typeof C.value=="string"&&C.value.trim()===""&&w.value&&(C.value=w.value),w.dataset.promptLibraryAttached!=="true"&&(w.addEventListener("change",()=>{let b=w.value;if(!b)return;let x=w.getAttribute("data-aipkit-prompt-target"),T=x?p.querySelector(`#${x}`):null;if(!T)return;T.value=b,T.dispatchEvent(new Event("input",{bubbles:!0})),typeof window.aipkit_handleContentWriterAutoSave=="function"&&window.aipkit_handleContentWriterAutoSave();let P=w.options?w.options[0]:null;P&&P.value===""&&(w.value="",w.selectedIndex=0)}),w.dataset.promptLibraryAttached="true")}),p.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(w=>{w.dataset.overlayListenerAttached!=="true"&&(w.addEventListener("click",C=>{C.target===w&&y()}),w.dataset.overlayListenerAttached="true");let A=w.querySelector(".aipkit_popover_flyout_close");A&&A.dataset.flyoutListenerAttached!=="true"&&(A.addEventListener("click",C=>{C.preventDefault(),y()}),A.dataset.flyoutListenerAttached="true")}),p.dataset.promptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",w=>{w.key==="Escape"&&m&&y()}),p.dataset.promptFlyoutEscapeAttached="true"),p.dataset.promptFlyoutClickAttached!=="true"&&(document.addEventListener("click",w=>{if(!m)return;let A=w.target;A.closest(".aipkit_cw_prompt_flyout")||A.closest("[data-aipkit-flyout-target]")||y()}),p.dataset.promptFlyoutClickAttached="true"),p.dataset.promptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",q),window.addEventListener("scroll",q,!0),p.dataset.promptFlyoutRepositionAttached="true"),p.dataset.promptFlyoutModeAttached!=="true"){let w=document.getElementById("aipkit_cw_mode_select");w&&w.addEventListener("change",()=>{g(c()),m&&a(m)}),p.dataset.promptFlyoutModeAttached="true"}window.aipkit_closeContentWriterPromptFlyout=y}window.aipkit_initContentWriterPromptFlyouts=l})();(function(){"use strict";let r=c=>String(c||"").replace(/\|/g," ").replace(/\r?\n/g," ").trim(),i=c=>{let s=String(c||"").trim();if(!s)return{value:"",raw:""};let n=s.match(/^(\d{4}-\d{2}-\d{2})(?:[T\s])(\d{2}:\d{2})(?::\d{2})?$/);return n?{value:`${n[1]}T${n[2]}`,raw:""}:{value:"",raw:s}},e=c=>c?c.replace("T"," ").trim():"";function t(c){let s=c||document.getElementById("aipkit_content_writer_container");if(!s)return;let n=s.querySelector("[data-aipkit-bulk-editor]");if(!n||n.dataset.bulkEditorAttached==="true")return;let d=n.querySelector("[data-aipkit-bulk-rows]"),a=n.querySelector("#aipkit_cw_bulk_row_template"),l=n.querySelector("#aipkit_cw_bulk_topics"),p=n.querySelector(".aipkit_cw_bulk_add_row"),_=n.querySelector(".aipkit_cw_bulk_toggle_raw"),f=n.querySelector("#aipkit_cw_bulk_raw"),g=n.querySelector(".aipkit_cw_bulk_grid"),m=n.querySelector(".aipkit_cw_bulk_toggle_details");if(!d||!a||!l)return;let u=!1,h,v=(P,H)=>P?P.querySelector(`[data-bulk-field="${H}"]`):null,S=()=>{Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")).forEach((H,O)=>{let F=H.querySelector(".aipkit_cw_bulk_row_number");F&&(F.textContent=O+1)})},q=P=>{let H=r(v(P,"topic")?.value||""),O=r(v(P,"keywords")?.value||""),F=r(v(P,"category")?.value||""),M=r(v(P,"author")?.value||""),B=r(v(P,"type")?.value||""),V=v(P,"schedule")?.value||"";return V?(V=e(V),P.dataset.rawSchedule=""):P.dataset.rawSchedule&&(V=P.dataset.rawSchedule),{topic:H,keywords:O,category:F,author:M,type:B,schedule:V}},y=(P,H)=>{if(!P||!H)return;let O=(M,B)=>{let V=v(P,M);V&&(V.value=B||"")};O("topic",H.topic||""),O("keywords",H.keywords||""),O("category",H.category||""),O("author",H.author||""),O("type",H.type||"");let F=v(P,"schedule");if(F){let M=i(H.schedule||"");F.value=M.value,P.dataset.rawSchedule=M.raw||""}},E=()=>{let P=Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")),H=[];return P.forEach(O=>{let{topic:F,keywords:M,category:B,author:V,type:L,schedule:U}=q(O);if(!F)return;let W=[F,M,B,V,L,U],ee=-1;W.forEach((ne,z)=>{ne&&(ee=z)}),ee!==-1&&H.push(W.slice(0,ee+1).join(" | "))}),H.join(`
`)},I=()=>{l&&(u=!0,l.value=E(),l.dispatchEvent(new Event("change",{bubbles:!0})),u=!1)},w=P=>{n.classList.toggle("is-details-open",P),m&&m.setAttribute("aria-expanded",P?"true":"false")},A=P=>{if(f){if(n.classList.toggle("is-raw-open",P),f.hidden=!P,_){_.setAttribute("aria-expanded",P?"true":"false");let H=P?_.dataset.labelGrid:_.dataset.labelRaw;if(H){let O=_.querySelector(".aipkit_cw_toggle_label");O?O.textContent=H:_.textContent=H}}g&&(g.hidden=P),p&&(p.hidden=P,p.disabled=P),m&&(m.hidden=P,P&&m.setAttribute("aria-expanded","false"))}},C=P=>{let O=document.importNode(a.content,!0).querySelector("[data-aipkit-bulk-row]");return O?(y(O,P||{}),O):null},b=()=>{let P=d.querySelectorAll("[data-aipkit-bulk-row]");if(P.length>=1)return;let H=1-P.length;for(let O=0;O<H;O++){let F=C();F&&d.appendChild(F)}},x=()=>{let P=Array.from(d.querySelectorAll("[data-aipkit-bulk-row]")),H=P[P.length-1];if(!H)return;let O=q(H);if(Object.values(O).some(M=>M)&&P.length<100){let M=C();M&&(d.appendChild(M),S())}},T=()=>{let H=(l.value||"").split(/\r?\n/).filter(F=>F.trim()!=="");d.innerHTML="";let O=[];if(H.slice(0,100).forEach(F=>{let M=F.split("|").map(L=>L.trim()),B={topic:M[0]||"",keywords:M[1]||"",category:M[2]||"",author:M[3]||"",type:M[4]||"",schedule:M[5]||""},V=C(B);V&&O.push(V)}),!O.length){b(),S(),I();return}O.forEach(F=>d.appendChild(F)),b(),S()};l.value.trim()?T():(b(),S(),I()),A(!f.hidden),m&&!m.dataset.listenerAttached&&(m.addEventListener("click",P=>{P.preventDefault();let H=n.classList.contains("is-details-open");w(!H)}),m.dataset.listenerAttached="true",w(!1)),d.addEventListener("input",P=>{let H=P.target;!H||!H.closest("[data-aipkit-bulk-row]")||(I(),x())}),d.addEventListener("change",P=>{let H=P.target;!H||!H.closest("[data-aipkit-bulk-row]")||(I(),x())}),d.addEventListener("click",P=>{let H=P.target.closest(".aipkit_cw_bulk_remove_row");if(!H)return;let O=H.closest("[data-aipkit-bulk-row]");if(!O)return;d.querySelectorAll("[data-aipkit-bulk-row]").length<=1?O.querySelectorAll("input, select").forEach(M=>{M.value=""}):O.remove(),I(),S(),x()}),p&&p.addEventListener("click",P=>{if(P.preventDefault(),d.querySelectorAll("[data-aipkit-bulk-row]").length>=100)return;let O=C();O&&d.appendChild(O),S()}),_&&f&&_.addEventListener("click",P=>{P.preventDefault();let H=!f.hidden;A(!H)}),l.addEventListener("input",()=>{u||(clearTimeout(h),h=setTimeout(()=>{T()},250))}),n.dataset.bulkEditorAttached="true"}window.aipkit_initContentWriterBulkEditor=t})();(function(){"use strict";let k=null,o=0;function r(){if(!k)return;let t=k;k=null,t.classList.remove("aipkit-active"),t.__aipkitAlertKeydown&&(document.removeEventListener("keydown",t.__aipkitAlertKeydown),t.__aipkitAlertKeydown=null);let c=()=>{t.parentNode&&t.parentNode.removeChild(t)};t.addEventListener("transitionend",c,{once:!0}),window.setTimeout(c,250)}function i(t,c={}){let s=c.title||"Notice",n=c.okText||"OK",d=c.okClass||"aipkit_btn-primary",a=Array.isArray(c.actions)?c.actions:null,l=Array.isArray(c.bullets)?c.bullets:null;k&&r();let p=document.createElement("div");p.className="aipkit-modal-overlay",p.addEventListener("click",E=>{E.target===p&&r()});let _=`aipkit_cw_alert_${Date.now()}_${o++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${_}_title`);let g=document.createElement("div");g.className="aipkit-modal-header";let m=document.createElement("h3");m.className="aipkit-modal-title",m.id=`${_}_title`,m.textContent=s;let u=document.createElement("button");u.type="button",u.className="aipkit-modal-close-btn",u.setAttribute("aria-label","Close"),u.textContent="\xD7",g.appendChild(m),g.appendChild(u);let h=document.createElement("div");h.className="aipkit-modal-body";let v=document.createElement("p");if(v.className="aipkit_cw_alert_modal_message",v.textContent=t||"",l&&l.length){let E=document.createElement("ul");E.className="aipkit_cw_alert_modal_list",l.forEach(I=>{let w=document.createElement("li");w.textContent=I,E.appendChild(w)}),h.appendChild(v),h.appendChild(E)}else h.appendChild(v);let S=document.createElement("div");S.className="aipkit_cw_alert_modal_actions";let q=null;if(a&&a.length)a.forEach((E,I)=>{let w=!!(E&&E.href),A=E?.label||(I===0?n:"Close"),C=E?.className||(I===0?"aipkit_btn aipkit_btn-primary":"aipkit_btn aipkit_btn-secondary"),b=document.createElement(w?"a":"button");b.className=C,b.textContent=A,w?(b.href=E.href,b.target=E.target||"_blank",b.rel=E.rel||"noopener noreferrer"):b.type="button";let x=()=>{typeof E?.onClick=="function"&&E.onClick(),E?.closeOnClick!==!1&&r()};b.addEventListener("click",x),S.appendChild(b),q||(q=b)});else{let E=document.createElement("button");E.type="button",E.className=`aipkit_btn ${d}`,E.textContent=n,E.addEventListener("click",r),S.appendChild(E),q=E}h.appendChild(S),f.appendChild(g),f.appendChild(h),p.appendChild(f),document.body.appendChild(p);let y=E=>{E.key==="Escape"&&r()};p.__aipkitAlertKeydown=y,document.addEventListener("keydown",y),u.addEventListener("click",r),window.requestAnimationFrame(()=>{p.classList.add("aipkit-active"),q&&q.focus()}),k=p}function e(t,c={}){let s=c.title||"Confirm",n=c.confirmText||"Confirm",d=c.cancelText||"Cancel",a=typeof c.onConfirm=="function"?c.onConfirm:null,l=typeof c.onCancel=="function"?c.onCancel:null;k&&r();let p=document.createElement("div");p.className="aipkit-modal-overlay",p.addEventListener("click",I=>{I.target===p&&(r(),l&&l())});let _=`aipkit_cw_confirm_${Date.now()}_${o++}`,f=document.createElement("div");f.className="aipkit-modal-content aipkit_cw_alert_modal_content",f.setAttribute("role","dialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby",`${_}_title`);let g=document.createElement("div");g.className="aipkit-modal-header";let m=document.createElement("h3");m.className="aipkit-modal-title",m.id=`${_}_title`,m.textContent=s;let u=document.createElement("button");u.type="button",u.className="aipkit-modal-close-btn",u.setAttribute("aria-label","Close"),u.textContent="\xD7",g.appendChild(m),g.appendChild(u);let h=document.createElement("div");h.className="aipkit-modal-body";let v=document.createElement("p");v.className="aipkit_cw_alert_modal_message",v.textContent=t||"";let S=document.createElement("div");S.className="aipkit_cw_alert_modal_actions";let q=document.createElement("button");q.type="button",q.className="aipkit_btn aipkit_btn-secondary",q.textContent=d;let y=document.createElement("button");y.type="button",y.className="aipkit_btn aipkit_btn-primary",y.textContent=n,S.appendChild(q),S.appendChild(y),h.appendChild(v),h.appendChild(S),f.appendChild(g),f.appendChild(h),p.appendChild(f),document.body.appendChild(p);let E=I=>{I.key==="Escape"&&(r(),l&&l())};p.__aipkitAlertKeydown=E,document.addEventListener("keydown",E),u.addEventListener("click",()=>{r(),l&&l()}),q.addEventListener("click",()=>{r(),l&&l()}),y.addEventListener("click",()=>{r(),a&&a()}),window.requestAnimationFrame(()=>{p.classList.add("aipkit-active"),y.focus()}),k=p}window.aipkit_showAlertModal=i,window.aipkit_showConfirmModal=e,window.aipkit_closeAlertModal=r})();(function(){"use strict";function k(o,r){if(!o||!r||typeof window.aipkit_populateModelsForContentWriter!="function"){console.error("Provider/Model Dropdown Handler: Missing providerSelect, modelSelect, or populateModelsForContentWriter function.");return}if(o.addEventListener("change",()=>{window.aipkit_populateModelsForContentWriter(o,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),window.aipkit_dashboard&&window.aipkit_dashboard.models)window.aipkit_populateModelsForContentWriter(o,r),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary();else{console.warn("Content Writer UI: aipkit_dashboard.models not available for initial population. Will try on provider change.");let i=window.aipkit_escapeHtml||function(e){return e};r.innerHTML='<option value="">'+i("Models unavailable (Data Object Missing)")+"</option>",r.disabled=!0}}window.aipkit_handleProviderModelDropdowns=k})();(function(){"use strict";function k(o){if(!o){console.error("Temperature Slider Handler: Slider element was not passed or not found.");return}let r=document.getElementById("aipkit_content_writer_temperature_value");r?o.dataset.listenerAttached||(o.addEventListener("input",()=>r.textContent=o.value),o.dataset.listenerAttached="true"):console.error("Temperature Slider Handler: Value Span #aipkit_content_writer_temperature_value NOT FOUND.")}window.aipkit_handleTemperatureSlider=k})();(function(){"use strict";function k(o){if(!o){console.warn("Copy Button Handler: Button element not provided.");return}o.dataset.listenerAttached||(o.addEventListener("click",()=>{let r=document.getElementById("aipkit_cw_generated_title_display"),i=document.getElementById("aipkit_cw_generated_content_area"),e="";r&&r.style.display!=="none"&&(e+=r.textContent+`

`),i&&(e+=i.innerText),e.trim()&&navigator.clipboard.writeText(e.trim()).then(()=>{let t=o.querySelector(".dashicons");if(t){let c=t.className;t.className="dashicons dashicons-yes",setTimeout(()=>{t.className=c},1500)}}).catch(t=>console.error("Failed to copy: ",t))}),o.dataset.listenerAttached="true")}window.aipkit_handleCopyButton=k})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_cw_single_output_wrapper"),i=document.getElementById("aipkit_cw_output_card"),e=document.getElementById("aipkit_content_writer_output_display"),t=document.getElementById("aipkit_cw_generated_content_area"),c=document.querySelector(".aipkit_content_writer_output_actions"),s=document.getElementById("aipkit_cw_status_display_container"),n=document.getElementById("aipkit_cw_generated_title_display"),d=document.getElementById("aipkit_cw_meta_chunk"),a=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),l=document.getElementById("aipkit_cw_generated_meta_desc"),p=document.getElementById("aipkit_cw_focus_keyword_output_wrapper"),_=document.getElementById("aipkit_cw_generated_focus_keyword"),f=document.getElementById("aipkit_cw_excerpt_output_wrapper"),g=document.getElementById("aipkit_cw_generated_excerpt"),m=document.getElementById("aipkit_cw_tags_output_wrapper"),u=document.getElementById("aipkit_cw_generated_tags"),h=document.getElementById("aipkit_cw_image_data_holder"),v=document.getElementById("aipkit_content_writer_copy_btn"),S=document.getElementById("aipkit_content_writer_clear_btn");if(r&&(r.style.display="none"),i&&(i.style.display="none"),e&&t){t.classList.remove("is-streaming");let q=t.closest(".aipkit_cw_output_chunk--primary");q&&q.classList.remove("has-overflow"),t.innerHTML="",e.scrollTop=0,c&&(c.style.display="none"),v&&(v.disabled=!0),S&&(S.disabled=!0),typeof window.aipkit_resetContentWriterRawHtml=="function"&&window.aipkit_resetContentWriterRawHtml(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction();let y=document.getElementById("aipkit_content_writer_form_status");y&&(y.textContent=""),s&&typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():s&&(s.style.display="none"),n&&(n.style.display="none",n.textContent=""),d&&(d.style.display="none"),a&&(a.style.display="none"),l&&(l.value=""),p&&(p.style.display="none"),_&&(_.value=""),f&&(f.style.display="none"),g&&(g.value=""),m&&(m.style.display="none"),u&&(u.value=""),h&&(h.value=""),typeof window.aipkit_updateMetaCountBadge=="function"&&window.aipkit_updateMetaCountBadge(),typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_resetContentWriterPreviewCounter=="function"&&window.aipkit_resetContentWriterPreviewCounter()}}function o(r,i){if(!r){console.warn("Clear Button Handler: Button element not provided.");return}r.dataset.listenerAttached||(r.addEventListener("click",()=>{typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput()}),r.dataset.listenerAttached="true")}window.aipkit_handleClearButton=o,window.aipkit_clearContentWriterOutput=k})();(function(){"use strict";function k(){return document.getElementById("aipkit_cw_expand_preview_btn")}function o(d){return d?d.closest(".aipkit_cw_output_chunk--primary"):document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_chunk--primary")}function r(d,a,l){return d?a==="restore"?d.dataset.labelRestore||l:d.dataset.labelExpand||l:l}function i(d,a){if(!d)return;let l=d.querySelector(".aipkit_cw_expand_label"),p=d.querySelector(".dashicons"),_=a?r(d,"restore","Restore preview"):r(d,"expand","Expand preview");l&&(l.textContent=_),d.setAttribute("title",_),d.setAttribute("aria-pressed",a?"true":"false"),p&&(p.classList.toggle("dashicons-fullscreen-alt",!a),p.classList.toggle("dashicons-fullscreen-exit-alt",a))}function e(d){let a=document.getElementById("aipkit_content_writer_output_display");!a||!d||(a.scrollHeight>a.clientHeight?d.classList.add("has-overflow"):d.classList.remove("has-overflow"))}function t(d){let a=k(),l=o(a);!a||!l||(d?l.classList.add("is-expanded"):l.classList.remove("is-expanded"),i(a,d),requestAnimationFrame(()=>e(l)))}function c(d){let a=k();a&&(a.disabled=!d,a.setAttribute("aria-disabled",d?"false":"true"),d||t(!1))}function s(){t(!1)}function n(){document.body?.dataset?.aipkitPreviewToggleAttached!=="true"&&(document.addEventListener("click",d=>{let a=d.target.closest("#aipkit_cw_expand_preview_btn");if(!a||a.disabled)return;let l=o(a);if(!l)return;let p=l.classList.contains("is-expanded");t(!p)}),document.body&&(document.body.dataset.aipkitPreviewToggleAttached="true"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n(),window.aipkit_resetContentWriterPreviewSize=s,window.aipkit_setContentWriterPreviewExpandEnabled=c})();(function(){"use strict";let k=u=>!u||typeof u!="object"?"":u.media_library_url||u.url||u.src||u.image_url||u.preview_url||"",o=u=>u==null?"":String(u).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=()=>{if(typeof window.aipkit_getContentWriterRawHtml=="function")return window.aipkit_getContentWriterRawHtml()||"";let u=document.getElementById("aipkit_cw_generated_content_area");return u?u.innerHTML:""},i=()=>{let u=document.getElementById("aipkit_cw_generated_content_area");if(!u)return;let h=r();h&&(u.innerHTML=h)},e=()=>({preview:document.getElementById("aipkit_cw_image_preview"),featuredWrap:document.getElementById("aipkit_cw_featured_image"),featuredImg:document.getElementById("aipkit_cw_featured_image_img"),inlineToggle:document.getElementById("aipkit_cw_inline_images_toggle"),inlineCount:document.getElementById("aipkit_cw_inline_images_count"),inlineGrid:document.getElementById("aipkit_cw_inline_images_grid")}),t=(u,h,v="")=>{u&&(u.hidden=!h,h?u.style.display=v||"":u.style.display="none")},c=u=>{u&&(u.innerHTML="",t(u,!1,"grid"))},s=()=>{let u=e();u.preview&&(u.featuredImg&&u.featuredImg.removeAttribute("src"),t(u.featuredWrap,!1,"flex"),u.inlineToggle&&(u.inlineToggle.setAttribute("aria-expanded","false"),u.inlineToggle.classList.remove("is-open")),u.inlineCount&&(u.inlineCount.textContent="0"),c(u.inlineGrid),t(u.inlineToggle,!1,"inline-flex"),t(u.preview,!1,"flex"),i())},n=u=>{!u.inlineToggle||!u.inlineGrid||u.inlineToggle.dataset.listenerAttached!=="true"&&(u.inlineToggle.addEventListener("click",()=>{let h=u.inlineToggle.getAttribute("aria-expanded")==="true";u.inlineToggle.setAttribute("aria-expanded",h?"false":"true"),u.inlineToggle.classList.toggle("is-open",!h),t(u.inlineGrid,!h,"grid")}),u.inlineToggle.dataset.listenerAttached="true")},d=(u,h)=>{if(!u.inlineToggle||!u.inlineGrid||!h.length)return!1;c(u.inlineGrid);let v=document.createDocumentFragment();return h.forEach((S,q)=>{let y=document.createElement("div");y.className="aipkit_cw_inline_image";let E=document.createElement("img");E.src=S,E.alt=`Generated image ${q+1}`,E.loading="lazy",E.decoding="async",y.appendChild(E),v.appendChild(y)}),u.inlineGrid.appendChild(v),t(u.inlineGrid,!1,"grid"),t(u.inlineToggle,!0,"inline-flex"),u.inlineToggle.setAttribute("aria-expanded","false"),u.inlineToggle.classList.remove("is-open"),u.inlineCount&&(u.inlineCount.textContent=String(h.length)),n(u),!0},a=(u,h,v)=>{let S=k(u);if(!S)return"";let q=u.alt||u.revised_prompt||u.caption||"Image",y=[];return["left","right","center","none"].includes(h)&&y.push(`align${h}`),y.push(`size-${v||"large"}`),`<img class="${o(y.join(" "))}" src="${o(S)}" alt="${o(q)}" loading="lazy" decoding="async" />`},l=(u,h)=>h.length?`${u}

${h.join(`

`)}`:u,p=(u,h,v)=>{if(!h.length)return u;let S=h.shift(),q=u.toLowerCase(),y=`</${v}>`,E=q.indexOf(y);return E!==-1?u=u.slice(0,E+y.length)+`

${S}

`+u.slice(E+y.length):u+=`

${S}`,l(u,h)},_=(u,h,v,S)=>{if(!h.length)return u;if(!S||S<=0)return l(u,h);let q=u.split(new RegExp(`(</${v}>)`,"ig")),y="",E=0,I=0;for(let w=0;w<q.length;w+=1)y+=q[w],w%2===1&&(E+=1,E%S===0&&I<h.length&&(y+=`

${h[I]}

`,I+=1));for(;I<h.length;)y+=`

${h[I]}`,I+=1;return y},f=u=>{let h=document.getElementById("aipkit_cw_generated_content_area");if(!h)return;let v=Array.isArray(u?.in_content_images)?u.in_content_images:[];if(!v.length){i();return}let S=r();if(S||(S=h.innerHTML),!S)return;let q=document.getElementById("aipkit_content_writer_form"),y=u?.placement_settings?.placement||q?.elements.image_placement?.value||"after_first_h2",E=u?.placement_settings?.param_x||q?.elements.image_placement_param_x?.value||2,I=parseInt(E,10)||2,w=q?.elements.image_alignment?.value||"none",A=q?.elements.image_size?.value||"large",C=v.map(x=>a(x,w,A)).filter(Boolean);if(!C.length){i();return}let b=S;switch(y){case"after_first_h2":b=p(b,C,"h2");break;case"after_first_h3":b=p(b,C,"h3");break;case"after_every_x_h2":b=_(b,C,"h2",I);break;case"after_every_x_h3":b=_(b,C,"h3",I);break;case"after_every_x_p":b=_(b,C,"p",I);break;case"at_end":default:b=l(b,C);break}h.innerHTML=b,typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()},g=(u,h)=>!u.featuredWrap||!u.featuredImg||!h?!1:(u.featuredImg.src=h,t(u.featuredWrap,!0,"flex"),!0),m=u=>{let h=e();if(!h.preview)return;s();let v=u;if(typeof u=="string")try{v=JSON.parse(u)}catch{return}if(!v||typeof v!="object")return;let q=(Array.isArray(v.in_content_images)?v.in_content_images:[]).map(k).filter(Boolean),y=v.featured_image_url||k(v.featured_image)||k(v.featured_image_data),E=g(h,y),I=d(h,q);f(v),(E||I)&&t(h.preview,!0,"flex")};window.aipkit_renderContentWriterImagePreview=m,window.aipkit_clearContentWriterImagePreview=s})();(function(){"use strict";function k(){let r=document.getElementById("aipkit_content_writer_form");if(!r)return;let i=r.elements.generate_meta_description,e=r.elements.generate_focus_keyword,t=r.elements.generate_excerpt,c=r.elements.generate_tags,s=r.querySelector(".aipkit_cw_prompt_row--meta"),n=r.querySelector(".aipkit_cw_prompt_row--keyword"),d=r.querySelector(".aipkit_cw_prompt_row--excerpt"),a=r.querySelector(".aipkit_cw_prompt_row--tags"),l=!!(i&&i.checked),p=!!(e&&e.checked),_=!!(t&&t.checked),f=!!(c&&c.checked),g=(u,h)=>{if(!u)return;u.classList.toggle("aipkit_popover_option_row--disabled",!h);let v=u.querySelector(".aipkit_cw_prompt_trigger");v&&(v.disabled=!h,v.setAttribute("aria-disabled",h?"false":"true"))};g(s,l),g(n,p),g(d,_),g(a,f);let m=r.querySelector(".aipkit_cw_prompt_flyout.is-open");if(m){let u=[];l||u.push("aipkit_cw_meta_prompt_flyout"),p||u.push("aipkit_cw_keyword_prompt_flyout"),_||u.push("aipkit_cw_excerpt_prompt_flyout"),f||u.push("aipkit_cw_tags_prompt_flyout"),u.includes(m.id)&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout()}}function o(){let r=document.getElementById("aipkit_content_writer_form");if(!r||r.dataset.optionToggleListenerAttached)return;let i=r.elements.generate_meta_description,e=r.elements.generate_focus_keyword,t=r.elements.generate_excerpt,c=r.elements.generate_tags;i&&i.addEventListener("change",k),e&&e.addEventListener("change",k),t&&t.addEventListener("change",k),c&&c.addEventListener("change",k),r.dataset.optionToggleListenerAttached="true",k()}window.aipkit_cw_toggleCustomOptionPrompts=k,window.aipkit_cw_initOptionPromptToggles=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.warn("Prompt Toggle Handler: Content writer container not found.");return}o.querySelectorAll(".aipkit_textarea_toggle").forEach(e=>{let t=e.dataset.target;if(!t)return;let c=`aipkit-cw-prompt-${t}-state`,s=localStorage.getItem(c),n=document.getElementById(t),d=e.querySelector(".dashicons");n&&d&&(s==="expanded"?(n.classList.remove("aipkit_collapsed"),d.classList.remove("dashicons-plus-alt2"),d.classList.add("dashicons-minus"),e.title="Collapse"):(n.classList.add("aipkit_collapsed"),d.classList.remove("dashicons-minus"),d.classList.add("dashicons-plus-alt2"),e.title="Expand"))});let i="data-prompt-toggle-listener-attached";o.getAttribute(i)||(o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_textarea_toggle");if(!t)return;let c=t.dataset.target,s=document.getElementById(c),n=t.querySelector(".dashicons");if(!s||!n){console.error("Prompt Toggle Handler: Target element or icon not found for toggle button.",t);return}let d=s.classList.toggle("aipkit_collapsed");d?(n.classList.remove("dashicons-minus"),n.classList.add("dashicons-plus-alt2"),t.title="Expand"):(n.classList.remove("dashicons-plus-alt2"),n.classList.add("dashicons-minus"),t.title="Collapse");let a=`aipkit-cw-prompt-${c}-state`;localStorage.setItem(a,d?"collapsed":"expanded")}),o.setAttribute(i,"true"))}window.aipkit_initPromptToggles=k})();(function(){"use strict";let k="";function o(p){k=typeof p=="string"?p:""}function r(){return k||""}function i(){k=""}function e(){let p=document.getElementById("aipkit_cw_meta_chunk");if(!p)return;let _=!1;p.querySelectorAll(".aipkit_cw_meta_field").forEach(g=>{window.getComputedStyle(g).display!=="none"&&(_=!0)}),p.style.display=_?"block":"none"}function t(){let p=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");p&&(p.style.display="flex")}function c(){let p=document.querySelector("#aipkit_content_writer_container .aipkit_cw_output_primary_action");p&&(p.style.display="none")}function s(){let p=document.getElementById("aipkit_cw_article_counter"),_=document.getElementById("aipkit_cw_generated_content_area");if(!p||!_)return;if(_.querySelector(".aipkit_spinner")){p.textContent="",p.hidden=!0;return}let g=(_.textContent||"").trim(),m=g?g.split(/\s+/).length:0;if(!m){p.textContent="",p.hidden=!0;return}let u=m===1?"word":"words";p.textContent=`${m} ${u}`,p.hidden=!1}function n(){let p=document.getElementById("aipkit_cw_generated_content_area");if(!p)return;let _=!1,f=()=>{_||(_=!0,window.requestAnimationFrame(()=>{_=!1,s()}))};new MutationObserver(()=>{f()}).observe(p,{childList:!0,subtree:!0,characterData:!0}),f()}function d(){let p=document.getElementById("aipkit_cw_generated_meta_desc"),_=document.querySelector("#aipkit_content_writer_container .aipkit_cw_meta_char_count");if(!p||!_)return;function f(){let g=p.value.length,m=g>=120&&g<=160;_.textContent=`${g}/160`,_.style.color=m?"#16a34a":g>160?"#dc2626":"#94a3b8"}p.addEventListener("input",f),f()}function a(){if(!document.getElementById("aipkit_cw_meta_chunk"))return;let _=new MutationObserver(function(g){g.forEach(function(m){m.type==="attributes"&&m.attributeName==="style"&&e()})});["aipkit_cw_excerpt_output_wrapper","aipkit_cw_tags_output_wrapper","aipkit_cw_focus_keyword_output_wrapper","aipkit_cw_meta_desc_output_wrapper"].forEach(g=>{let m=document.getElementById(g);m&&_.observe(m,{attributes:!0,attributeFilter:["style"]})})}function l(){d(),a(),n()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l(),window.aipkit_updateMetaChunkVisibility=e,window.aipkit_showPrimaryAction=t,window.aipkit_hidePrimaryAction=c,window.aipkit_updateContentWriterPreviewCounter=s,window.aipkit_setContentWriterRawHtml=o,window.aipkit_getContentWriterRawHtml=r,window.aipkit_resetContentWriterRawHtml=i,window.aipkit_resetContentWriterPreviewCounter=function(){let p=document.getElementById("aipkit_cw_article_counter");p&&(p.textContent="",p.hidden=!0)}})();(function(){"use strict";function k(t){if(!t)return;let c=t.querySelector("#aipkit_content_writer_provider"),s=t.querySelector("#aipkit_content_writer_model"),n=t.querySelector(".aipkit_cw_reasoning_effort_field"),d=t.querySelector("#aipkit_content_writer_reasoning_effort");if(!c||!s||!n||!d){n&&(n.style.display="none");return}let a=(c.value||"").toLowerCase(),p=(s.value||"").toLowerCase(),_=p.startsWith("o1")||p.startsWith("o3")||p.startsWith("o4"),f=p.includes("gpt-5");a==="openai"&&(_||f)?(n.classList.contains("aipkit_popover_option_row")||n.classList.contains("aipkit_ai_behavior_control")?n.style.display="flex":n.style.display="block",o(t,p)):n.style.display="none"}function o(t,c){let s=t.querySelector("#aipkit_content_writer_reasoning_effort"),n=t.querySelectorAll(".aipkit_ai_reasoning_option");if(!s||!n.length)return;let d=r(c),a=new Set(d.allowed);n.forEach(g=>{let m=g.querySelector(".aipkit_ai_reasoning_input");if(!m)return;let u=m.value==="minimal"?"low":m.value,h=a.has(u);g.style.display=h?"":"none",h||(m.checked=!1)});let l=s.value||"";l==="minimal"&&(l="low");let p=t.querySelector(".aipkit_ai_reasoning_input:checked");!a.has(l)&&p&&(l=p.value),a.has(l)||(l=d.defaultValue),a.has(l)||(l=d.allowed[0]||"");let _=s.value;l&&(s.value=l);let f=t.querySelector(`.aipkit_ai_reasoning_input[value="${l}"]`);if(f){f.checked=!0,t.querySelectorAll(".aipkit_ai_reasoning_option").forEach(m=>m.classList.remove("aipkit_ai_reasoning_option--selected"));let g=f.closest(".aipkit_ai_reasoning_option");g&&g.classList.add("aipkit_ai_reasoning_option--selected")}_!==s.value&&s.dispatchEvent(new Event("change",{bubbles:!0}))}function r(t){return e(t)?{allowed:["high"],defaultValue:"high"}:t.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(t)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(t){let c=t.match(/gpt-5\.(\d+)/);if(c)return Number.parseInt(c[1],10)>=2;let s=t.match(/gpt-(\d+)/);return s?Number.parseInt(s[1],10)>=6:!1}function e(t){return/gpt-5(\.\d+)?-pro/.test(t)}window.aipkit_cw_toggleReasoningEffort=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(m){return m},o=["pexels_api_key","pixabay_api_key"],r={},i={},e="",t=!1,c=!1,s="";function n(m){o.forEach(u=>{let h=m.querySelector(`.aipkit_cw_stock_api_key[name="${CSS.escape(u)}"]`);r[u]=h?h.value.trim():"",i[u]=!1})}function d(m){let u=m.querySelector("#aipkit_cw_replicate_api_key");e=u?u.value.trim():"",t=!1}async function a(m){if(!m||!m.name)return;let u=m.name;if(!o.includes(u))return;let h=m.value.trim(),v=r[u]||"";if(h===v||i[u]||typeof window.aipkit_apiRequest!="function")return;let S=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,q=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,y=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;i[u]=!0,r[u]=h,S&&S("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{[u]:h}),q&&q("Updated")}catch(E){r[u]=v,y&&y(`Error: ${E.message||"Failed to save."}`),console.error("Content Writer Stock Image Key Save Error:",E)}finally{i[u]=!1}}async function l(m){if(!m)return;let u=m.value.trim(),h=e||"";if(u===h||t||typeof window.aipkit_apiRequest!="function")return;let v=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,S=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,q=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;t=!0,e=u,v&&v("Saving...");try{await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:u}),S&&S("Updated"),p(u,!0)}catch(y){e=h,q&&q(`Error: ${y.message||"Failed to save."}`),console.error("Content Writer Replicate Key Save Error:",y)}finally{t=!1}}function p(m,u=!1){let h=(m||"").trim();if(!h||c||!u&&h===s||typeof window.aipkit_queueProviderSync!="function")return;let v=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,S=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,q=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;c=!0,v&&v("Syncing models..."),window.aipkit_queueProviderSync("Replicate",{silent:!0,targetSelectId:"aipkit_cw_image_model",propagateError:!0}).then(()=>{s=h,S&&S("Models synced!")}).catch(y=>{q&&q(`Error: ${y.message||"Sync failed."}`),console.error("Content Writer Replicate Sync Error:",y)}).finally(()=>{c=!1})}function _(m){let u=document.getElementById("aipkit_cw_image_model");if(!u)return;let h=window.aipkit_dashboard?.imageGeneratorModels;if(!h){console.error("Image models data not found in aipkit_dashboard object."),u.innerHTML='<option value="">Error: Models not loaded</option>';return}let v=h[m.toLowerCase()]||[],S=window.aipkit_cw_template_state?.pendingImageModelSelection,q=u.value,y=S||q;u.innerHTML="",v.length>0?(v.forEach(E=>{u.appendChild(new Option(E.name,E.id))}),u.querySelector(`option[value="${CSS.escape(y)}"]`)?u.value=y:u.options.length>0&&(u.selectedIndex=0)):u.appendChild(new Option("No models available","")),window.aipkit_cw_template_state&&(window.aipkit_cw_template_state.pendingImageModelSelection=null)}function f(){let m=document.getElementById("aipkit_content_writer_container");if(!m)return;let u=m.querySelector(".aipkit_cw_image_enable_toggle"),h=m.querySelector("#aipkit_cw_generate_featured_image"),v=m.querySelector("#aipkit_cw_image_placement"),S=m.querySelector("#aipkit_cw_image_provider"),q=document.getElementById("aipkit_content_writer_form"),y=q?q.classList.contains("aipkit_cw_mode_existing_images"):!1,E=m.querySelectorAll(".aipkit_cw_image_settings_container"),I=m.querySelector(".aipkit_cw_prompt_row--image"),w=m.querySelector(".aipkit_cw_prompt_row--featured"),A=m.querySelector(".aipkit_cw_image_metadata_chunk"),C=Array.from(m.querySelectorAll(".aipkit_cw_image_metadata_subtoggle")).map(z=>{let ge=z.closest(".aipkit_image_toggle_card");return{toggle:z,button:ge?ge.querySelector(".aipkit_cw_image_metadata_prompt_btn"):null}});if(!u||!h)return;let b=z=>z?z.closest(".aipkit_popover_option_row")||z.closest(".aipkit_form-group"):null,x=(z,ge)=>{z&&(ge?z.style.display=z.classList.contains("aipkit_popover_option_row")?"flex":"block":z.style.display="none")},T=u.checked,P=h.checked,H=T||P||y,O=S?S.value:"",F=O==="pexels"||O==="pixabay";E.forEach(z=>{z.style.display=H?"block":"none"});let M=T&&!F,B=P&&!F,V=(z,ge)=>{if(!z)return;z.style.display="",z.classList.toggle("aipkit_popover_option_row--disabled",!ge);let Ae=z.querySelector(".aipkit_cw_prompt_trigger");Ae&&(Ae.disabled=!ge,Ae.setAttribute("aria-disabled",ge?"false":"true"))};V(I,M),V(w,B);let L=y||H;if(A&&(A.style.display=L?"block":"none"),A){let z=A.querySelector(".aipkit_image_settings_chunk_header--collapsible"),ge=A.querySelector(".aipkit_image_settings_chunk_body--collapsible");if(z&&ge){let Ae=y;z.setAttribute("aria-expanded",Ae?"true":"false"),ge.setAttribute("aria-hidden",Ae?"false":"true")}}C.length>0&&C.forEach(({toggle:z,button:ge})=>{let Ae=L&&z.checked;ge&&(ge.disabled=!Ae,ge.setAttribute("aria-disabled",Ae?"false":"true"))});let U=m.querySelector(".aipkit_cw_prompt_flyout.is-open"),W=U?m.querySelector(`.aipkit_cw_image_metadata_prompt_btn[data-aipkit-flyout-target="${CSS.escape(U.id)}"]`):null,ee=W?W.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_cw_image_metadata_subtoggle"):null,ne=ee&&L?ee.checked:!1;if(U&&(U.id==="aipkit_cw_image_prompt_flyout"&&!M||U.id==="aipkit_cw_featured_image_prompt_flyout"&&!B||ee&&!ne&&["aipkit_cw_image_title_prompt_flyout","aipkit_cw_image_alt_text_prompt_flyout","aipkit_cw_image_caption_prompt_flyout","aipkit_cw_image_description_prompt_flyout"].includes(U.id))&&typeof window.aipkit_closeContentWriterPromptFlyout=="function"&&window.aipkit_closeContentWriterPromptFlyout(),H){let z=["#aipkit_cw_image_count","#aipkit_cw_image_placement","#aipkit_cw_image_size","#aipkit_cw_image_alignment"],ge=m.querySelector("#aipkit_cw_replicate_options"),Ae=m.querySelector("#aipkit_cw_pexels_options"),ot=m.querySelector("#aipkit_cw_pixabay_options"),ze=m.querySelector("#aipkit_cw_image_model_group");if(z.forEach(Ge=>{let It=m.querySelector(Ge),Qe=b(It);x(Qe,T)}),v){let Ge=m.querySelector(".aipkit_cw_image_placement_x_field");if(Ge){let It=["after_every_x_h2","after_every_x_h3","after_every_x_p"].includes(v.value);x(Ge,T&&It)}}ge&&(ge.style.display=O==="replicate"?"block":"none"),Ae&&(Ae.style.display=F&&O==="pexels"?"block":"none"),ot&&(ot.style.display=F&&O==="pixabay"?"block":"none"),ze&&(ze.style.display=F?"none":"");let Xe=m.querySelector("#aipkit_cw_image_model_wrapper");if(Xe&&(Xe.style.display=F?"none":""),!F&&O&&_(O),O==="replicate"){let Ge=m.querySelector("#aipkit_cw_replicate_api_key");p(Ge?Ge.value:"",!1)}}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}function g(){let m=document.getElementById("aipkit_content_writer_container");m&&(m.dataset.imageHandlerAttached||(n(m),d(m),m.addEventListener("change",function(u){let h=u.target;if(h&&h.matches(".aipkit_cw_stock_api_key")){a(h);return}if(h&&h.matches(".aipkit_cw_replicate_api_key")){l(h);return}h.matches(".aipkit_cw_image_enable_toggle, #aipkit_cw_generate_featured_image, #aipkit_cw_image_placement, #aipkit_cw_image_provider, .aipkit_cw_image_metadata_subtoggle")&&f()}),m.addEventListener("click",function(u){let h=u.target.closest(".aipkit_image_settings_chunk_header--collapsible");if(!h)return;let v=h.getAttribute("aria-expanded")==="true",S=h.getAttribute("aria-controls"),q=S?document.getElementById(S):null;h.setAttribute("aria-expanded",v?"false":"true"),q&&q.setAttribute("aria-hidden",v?"true":"false")}),f(),m.dataset.imageHandlerAttached="true"))}window.aipkit_initImageSettingsHandler=g,window.aipkit_updateImageSettingsUI=f})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(s){return s};function o(s){if(!s)return;let n=s.querySelector(".aipkit_cw_vector_store_toggle"),d=s.querySelectorAll(".aipkit_cw_vector_store_settings_container");if(n&&d.length>0){let a=n.checked;d.forEach(l=>{l.style.display=a?"block":"none"}),a&&r(s)}}function r(s){if(!s)return;let n=s.querySelector(".aipkit_cw_vector_store_provider_select");if(!n)return;let d=n.value,a=s.querySelector(".aipkit_cw_vector_openai_field"),l=s.querySelector(".aipkit_cw_vector_pinecone_field"),p=s.querySelector(".aipkit_cw_vector_qdrant_field"),_=s.querySelector(".aipkit_cw_vector_embedding_config_row"),f=(g,m)=>{g&&(g.style.display=m?"block":"none")};if(f(a,d==="openai"),f(l,d==="pinecone"),f(p,d==="qdrant"),_){let g=d==="pinecone"||d==="qdrant";if(_.style.display=g?"block":"none",g){let m=_.querySelector(".aipkit_cw_vector_embedding_provider_select");m&&i(m.value)}}}function i(s){let n=document.getElementById("aipkit_cw_vector_embedding_model");if(!n)return;let a=(window.aipkit_dashboard?.embeddingModels||{})[s.toLowerCase()]||[],l=window.aipkit_cw_template_state?.initialConfigForSelectedTemplate?.vector_embedding_model||"";n.innerHTML=`<option value="">${k("-- Select Model --")}</option>`,a.length>0?(a.forEach(p=>{if(p&&p.id){let _=new Option(k(p.name||p.id),p.id);p.id===l&&(_.selected=!0),n.appendChild(_)}}),n.disabled=!1):(n.disabled=!0,n.innerHTML=`<option value="">${k("-- No models found --")}</option>`)}function e(s){if(!s)return;let n=s.getAttribute("aria-expanded")==="true",d=s.getAttribute("aria-controls"),a=document.getElementById(d);a&&(s.setAttribute("aria-expanded",!n),a.setAttribute("aria-hidden",n))}function t(s){if(!s)return;let n=document.getElementById(s.id+"_value");if(!n)return;let d=s.value;s.id==="aipkit_cw_vector_store_confidence_threshold"&&(d=d+"%"),n.textContent=d}function c(){let s=document.getElementById("aipkit_content_writer_container");if(!s||s.dataset.vectorSettingsHandlerAttached)return;s.addEventListener("change",function(d){let a=d.target;if(a.matches(".aipkit_cw_vector_store_toggle")){let l=a.closest(".aipkit_vector_settings_redesigned")||a.closest(".aipkit_popover_options_list")||s;o(l)}else if(a.matches(".aipkit_cw_vector_store_provider_select")){let l=a.closest(".aipkit_vector_settings_redesigned")||a.closest(".aipkit_cw_vector_store_settings_container")||s;r(l)}else a.matches(".aipkit_cw_vector_embedding_provider_select")&&i(a.value);typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary()}),s.addEventListener("input",function(d){let a=d.target;a.matches(".aipkit_vector_slider")&&t(a)}),s.addEventListener("click",function(d){let l=d.target.closest(".aipkit_vector_settings_chunk_header--collapsible");l&&(d.preventDefault(),e(l))}),s.querySelectorAll(".aipkit_vector_settings_redesigned, .aipkit_popover_options_list").forEach(d=>{d.querySelector(".aipkit_cw_vector_store_toggle")&&o(d)}),s.querySelectorAll(".aipkit_vector_slider").forEach(d=>{t(d)}),typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),s.dataset.vectorSettingsHandlerAttached="true"}window.aipkit_initContentWriterVectorSettings=c,window.aipkit_cw_toggleVectorSettingsContainer=o,window.aipkit_cw_toggleProviderSpecificFields=r,window.aipkit_cw_populateEmbeddingModelSelect=i})();(function(){"use strict";function k(s){if(!s)return;let n=s.querySelector("#aipkit_content_writer_post_status"),d=s.querySelector(".aipkit_post_smart_schedule_container");if(!n)return;let a=n.value==="publish";d&&(d.style.display=a?"block":"none"),a&&o(s)}function o(s){if(!s)return;let n=s.querySelector('input[name="schedule_mode"]:checked'),d=s.querySelector(".aipkit_post_smart_schedule_fields");if(!d)return;let a=n&&n.value==="smart";d.style.display=a?"flex":"none"}function r(s){if(!s)return;let n=s.getAttribute("aria-expanded")==="true",d=s.getAttribute("aria-controls"),a=document.getElementById(d);a&&(s.setAttribute("aria-expanded",!n),a.setAttribute("aria-hidden",n))}function i(s){if(!s)return;let n=s.querySelector("#aipkit_content_writer_post_status");n&&(n.addEventListener("change",()=>{k(s)}),k(s)),s.querySelectorAll('input[name="schedule_mode"]').forEach(a=>{a.addEventListener("change",()=>{o(s)})}),o(s)}function e(){document.addEventListener("click",s=>{let n=s.target.closest(".aipkit_post_settings_chunk_header--collapsible");if(n){s.preventDefault(),r(n);return}}),document.addEventListener("keydown",s=>{if(s.key!=="Enter"&&s.key!==" ")return;let n=s.target.closest(".aipkit_post_settings_chunk_header--collapsible");n&&(s.preventDefault(),r(n))})}function t(s){let n=s.target;if(!n||!n.id||n.id!=="aipkit_cw_post_settings_popover")return;let d=n.querySelector(".aipkit_post_settings_redesigned");d&&!d.dataset.postSettingsInitialized&&(i(d),d.dataset.postSettingsInitialized="true")}function c(){e(),document.addEventListener("aipkit:popover:opened",t),document.querySelectorAll(".aipkit_post_settings_redesigned").forEach(d=>{d.dataset.postSettingsInitialized||(i(d),d.dataset.postSettingsInitialized="true")}),new MutationObserver(d=>{d.forEach(a=>{if(a.type==="attributes"&&a.attributeName==="aria-hidden"){let l=a.target.closest("#aipkit_cw_post_settings_popover");if(l&&a.target.getAttribute("aria-hidden")==="false"){let p=l.querySelector(".aipkit_post_settings_redesigned");p&&!p.dataset.postSettingsInitialized&&(i(p),p.dataset.postSettingsInitialized="true")}}})}).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["aria-hidden"]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.aipkit_initPostSettingsHandler=i})();(function(){"use strict";function k(o){let r=o||document.getElementById("aipkit_content_writer_container");if(!r)return;let i=r.querySelectorAll("[data-aipkit-vector-stores-dropdown]");i.length&&i.forEach(e=>{let t=e.closest(".aipkit_popover_option_main"),c=e.closest(".aipkit_cw_vector_openai_field"),s=t||c,n=s?s.querySelector(".aipkit_popover_multiselect_select"):null;if(!n)return;let d=e.querySelector(".aipkit_popover_multiselect_btn"),a=e.querySelector(".aipkit_popover_multiselect_label"),l=e.querySelector(".aipkit_popover_multiselect_panel"),p=e.querySelector(".aipkit_popover_multiselect_options"),_=e.dataset.placeholder||"Select stores",f=e.dataset.selectedLabel||"selected",g=()=>{if(!a)return;let S=Array.from(n.options).filter(y=>y.selected&&y.value);if(!S.length){a.textContent=_;return}let q=S.map(y=>y.textContent.trim()).filter(Boolean);if(q.length<=2){a.textContent=q.join(", ");return}a.textContent=`${q.length} ${f}`},m=()=>{if(!p)return;p.innerHTML="";let S=Array.from(n.options),q=S.filter(y=>y.value);if(!q.length){let y=document.createElement("div");y.className="aipkit_popover_multiselect_empty",y.textContent=S[0]?.textContent||"-- No Stores Found --",p.appendChild(y),g();return}q.forEach(y=>{let E=document.createElement("label");E.className="aipkit_popover_multiselect_item";let I=document.createElement("input");I.type="checkbox",I.value=y.value,I.checked=y.selected,I.disabled=y.disabled;let w=document.createElement("span");w.className="aipkit_popover_multiselect_text",w.textContent=y.textContent,E.appendChild(I),E.appendChild(w),p.appendChild(E)}),g()},u=()=>{if(!p){g();return}let S=new Set(Array.from(n.options).filter(q=>q.selected).map(q=>q.value));p.querySelectorAll('input[type="checkbox"]').forEach(q=>{q.checked=S.has(q.value)}),g()},h=S=>{if(!p)return;let q=Array.from(p.querySelectorAll('input[type="checkbox"]:checked'));if(q.length>2){let E=S&&S.target;if(E&&E.checked)E.checked=!1;else{let I=q[q.length-1];I&&(I.checked=!1)}}let y=Array.from(p.querySelectorAll('input[type="checkbox"]:checked')).map(E=>E.value);Array.from(n.options).forEach(E=>{E.selected=y.includes(E.value)}),n.dispatchEvent(new Event("change",{bubbles:!0})),g()},v=S=>{!e||!d||(e.classList.toggle("is-open",S),d.setAttribute("aria-expanded",S?"true":"false"),l&&(l.hidden=!S))};m(),u(),e.dataset.vectorStoreMultiselectAttached||(d&&(d.addEventListener("click",S=>{S.preventDefault(),v(!e.classList.contains("is-open"))}),d.addEventListener("keydown",S=>{S.key==="Escape"&&v(!1)})),document.addEventListener("click",S=>{e.classList.contains("is-open")&&(e.contains(S.target)||v(!1))}),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",h),p.dataset.listenerAttached="true"),n.dataset.listenerAttached||(n.addEventListener("change",u),n.dataset.listenerAttached="true"),e.dataset.vectorStoreMultiselectAttached="true")})}window.aipkit_initContentWriterVectorStoreMultiSelect=k})();(function(){"use strict";function k(o){let r=o||document.getElementById("aipkit_content_writer_container");if(!r)return;let i=r.querySelectorAll("[data-aipkit-categories-dropdown]");i.length&&i.forEach(e=>{let t=e.closest(".aipkit_popover_option_main"),c=e.closest(".aipkit_post_taxonomy_row"),s=t||c,n=s?s.querySelector('select[name="post_categories[]"]'):null;if(!n)return;let d=e.querySelector(".aipkit_popover_multiselect_btn"),a=e.querySelector(".aipkit_popover_multiselect_label"),l=e.querySelector(".aipkit_popover_multiselect_panel"),p=e.querySelector(".aipkit_popover_multiselect_options"),_=e.dataset.placeholder||"Select categories",f=e.dataset.selectedLabel||"selected",g=()=>{if(!a)return;let S=Array.from(n.options).filter(y=>y.selected&&y.value);if(!S.length){a.textContent=_;return}let q=S.map(y=>y.textContent.trim()).filter(Boolean);if(q.length<=2){a.textContent=q.join(", ");return}a.textContent=`${q.length} ${f}`},m=()=>{if(!p)return;p.innerHTML="";let S=Array.from(n.options),q=S.filter(y=>y.value);if(!q.length){let y=document.createElement("div");y.className="aipkit_popover_multiselect_empty",y.textContent=S[0]?.textContent||"-- No Categories --",p.appendChild(y),g();return}q.forEach(y=>{let E=document.createElement("label");E.className="aipkit_popover_multiselect_item";let I=document.createElement("input");I.type="checkbox",I.value=y.value,I.checked=y.selected,I.disabled=y.disabled;let w=document.createElement("span");w.className="aipkit_popover_multiselect_text",w.textContent=y.textContent,E.appendChild(I),E.appendChild(w),p.appendChild(E)}),g()},u=()=>{if(!p){g();return}let S=new Set(Array.from(n.options).filter(q=>q.selected).map(q=>q.value));p.querySelectorAll('input[type="checkbox"]').forEach(q=>{q.checked=S.has(q.value)}),g()},h=()=>{if(!p)return;let S=Array.from(p.querySelectorAll('input[type="checkbox"]:checked')).map(q=>q.value);Array.from(n.options).forEach(q=>{q.selected=S.includes(q.value)}),n.dispatchEvent(new Event("change",{bubbles:!0})),g()},v=S=>{!e||!d||(e.classList.toggle("is-open",S),d.setAttribute("aria-expanded",S?"true":"false"),l&&(l.hidden=!S))};m(),u(),e.dataset.categoriesMultiselectAttached||(d&&(d.addEventListener("click",S=>{S.preventDefault(),v(!e.classList.contains("is-open"))}),d.addEventListener("keydown",S=>{S.key==="Escape"&&v(!1)})),document.addEventListener("click",S=>{e.classList.contains("is-open")&&(e.contains(S.target)||v(!1))}),p&&!p.dataset.listenerAttached&&(p.addEventListener("change",h),p.dataset.listenerAttached="true"),n.dataset.listenerAttached||(n.addEventListener("change",u),n.dataset.listenerAttached="true"),e.dataset.categoriesMultiselectAttached="true")})}window.aipkit_initContentWriterCategoriesMultiSelect=k})();(function(){"use strict";let k=" \xB7 ",o=d=>{if(!d)return"";let a=d.options?d.options[d.selectedIndex]:null;return a?a.textContent.trim():""},r=d=>!d||!d.options?[]:Array.from(d.options).filter(a=>a.selected&&a.value).map(a=>a.textContent.trim()).filter(Boolean),i=(d,a)=>{let l=d.filter(Boolean);return l.length?l.join(k):a},e=(d,a)=>{if(!d)return;d.textContent=a,d.title=a;let l=d.closest(".aipkit_cw_settings_summary_text");l&&(l.title=a);let p=d.dataset.aipkitPlaceholder,_=d.dataset.aipkitDisabledLabel,f="active";_&&a===_?f="disabled":p&&a===p&&(f="placeholder"),d.dataset.aipkitSummaryState=f},t=d=>String(d||"").trim().toLowerCase(),c=(d,a,l=null)=>{if(!d)return;let p="aipkit_settings_select_picker_icon--";d.classList.forEach(m=>{m.startsWith(p)&&d.classList.remove(m)});let _=t(a),f=!l||l.includes(_),g=!!(_&&f);d.hidden=!g,g&&d.classList.add(`${p}${_}`)},s=d=>{if(!d)return;let a=document.getElementById("aipkit_content_writer_form"),l=a?a.classList.contains("aipkit_cw_mode_existing_images"):!1,p=d.querySelector('[data-aipkit-cw-summary="ai"]');if(p){let m=p.dataset.aipkitPlaceholder||"Not set",u=o(d.querySelector("#aipkit_content_writer_provider")),h=o(d.querySelector("#aipkit_content_writer_model"));e(p,i([h],m));let v=d.querySelector("#aipkit_content_writer_provider")?.value,S=p.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon");c(S,v)}let _=d.querySelector('[data-aipkit-cw-summary="images"]');if(_){let m=_.dataset.aipkitPlaceholder||"Not set",u=_.dataset.aipkitDisabledLabel||"Disabled",h=["#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description"],v=d.querySelector("#aipkit_cw_generate_images_enabled"),S=d.querySelector("#aipkit_cw_generate_featured_image"),q=v&&v.checked||S&&S.checked,y=d.querySelector("#aipkit_cw_image_provider"),E=y?y.value:"",I=o(y),w=o(d.querySelector("#aipkit_cw_image_model")),A=_.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_settings_select_picker_icon"),C=["openai","google","azure","replicate"];if(c(A,E,C),l){c(A,"",C);let b=h.map(x=>{let T=d.querySelector(x);if(!T||!T.checked)return"";let P=T.closest(".aipkit_image_toggle_card")?.querySelector(".aipkit_image_toggle_label");return P?P.textContent.trim():""}).filter(Boolean);e(_,i(b,u||m))}else q?C.includes(E)?e(_,i([w],m)):["pexels","pixabay"].includes(E)?e(_,i([I],m)):e(_,i([I,w],m)):(c(A,"",C),e(_,u))}let f=d.querySelector('[data-aipkit-cw-summary="vector"]');if(f){let m=f.dataset.aipkitPlaceholder||"Not set",u=f.dataset.aipkitDisabledLabel||"Disabled",h=d.querySelector("#aipkit_cw_enable_vector_store"),v=f.closest(".aipkit_cw_settings_summary_text")?.querySelector(".aipkit_cw_settings_summary_provider_icon"),S=["openai","pinecone","qdrant"];if(h&&!h.checked)c(v,"",S),e(f,u);else{let q=d.querySelector("#aipkit_cw_vector_store_provider"),y=q?q.value:"",E="";if(y==="openai"){let I=d.querySelector("#aipkit_cw_openai_vector_store_ids");E=r(I).join(", ")}else y==="pinecone"?E=o(d.querySelector("#aipkit_cw_pinecone_index_name")):y==="qdrant"&&(E=o(d.querySelector("#aipkit_cw_qdrant_collection_name")));c(v,y,S),e(f,i([E],m))}}let g=d.querySelector('[data-aipkit-cw-summary="post"]');if(g){let m=g.dataset.aipkitPlaceholder||"Not set",u=o(d.querySelector("#aipkit_content_writer_post_status"));e(g,i([u],m))}};function n(d){let a=d||document.getElementById("aipkit_content_writer_container");if(!a||a.dataset.cwSummaryAttached==="true")return;let l=["#aipkit_content_writer_provider","#aipkit_content_writer_model","#aipkit_cw_generate_images_enabled","#aipkit_cw_generate_featured_image","#aipkit_cw_generate_image_title","#aipkit_cw_generate_image_alt_text","#aipkit_cw_generate_image_caption","#aipkit_cw_generate_image_description","#aipkit_cw_image_provider","#aipkit_cw_image_model","#aipkit_cw_enable_vector_store","#aipkit_cw_vector_store_provider","#aipkit_cw_openai_vector_store_ids","#aipkit_cw_pinecone_index_name","#aipkit_cw_qdrant_collection_name","#aipkit_content_writer_categories","#aipkit_content_writer_post_author","#aipkit_content_writer_post_status"],p=_=>l.some(f=>_.matches(f));a.addEventListener("change",_=>{let f=_.target;!f||!p(f)||s(a)}),s(a),a.dataset.cwSummaryAttached="true"}window.aipkit_initContentWriterSettingsSummary=n,window.aipkit_updateContentWriterSettingsSummary=function(){let d=document.getElementById("aipkit_content_writer_container");s(d)}})();(function(){"use strict";let k=window.wp?.i18n?.__||function(b){return b},o="#aipkit_content_writer_provider, #aipkit_content_writer_model, #aipkit_cw_image_provider, #aipkit_cw_image_model, #aipkit_task_cw_image_provider, #aipkit_task_cw_image_model, #aipkit_cw_vector_store_provider, #aipkit_cw_vector_embedding_provider, #aipkit_task_cw_vector_store_provider, #aipkit_task_ce_vector_store_provider, #aipkit_task_cw_vector_embedding_provider, #aipkit_task_ce_vector_embedding_provider, #aipkit_task_content_indexing_target_store_provider, #aipkit_enhancer_insert_position_default, #aipkit_cw_pinecone_index_name, #aipkit_cw_qdrant_collection_name, #aipkit_cw_vector_embedding_model, #aipkit_task_cw_ai_provider, #aipkit_task_cw_ai_model, #aipkit_task_cc_ai_provider, #aipkit_task_cc_ai_model, #aipkit_task_ce_ai_provider, #aipkit_task_ce_ai_model",r=null,i=null,e=!1,t=new Set(["aipkit_content_writer_provider","aipkit_cw_image_provider","aipkit_cw_vector_store_provider","aipkit_cw_vector_embedding_provider","aipkit_task_cw_image_provider","aipkit_task_cw_vector_store_provider","aipkit_task_ce_vector_store_provider","aipkit_task_cw_vector_embedding_provider","aipkit_task_ce_vector_embedding_provider","aipkit_task_content_indexing_target_store_provider","aipkit_task_cw_ai_provider","aipkit_task_cc_ai_provider","aipkit_task_ce_ai_provider"]),c=b=>!!(b&&b.id&&t.has(b.id)),s=b=>!!(b&&b.dataset?.aipkitPickerIcons==="assistant-position"),n=b=>!!(b&&(c(b)||s(b)||b.id==="aipkit_cw_pinecone_index_name"||b.id==="aipkit_cw_qdrant_collection_name"||b.id==="aipkit_cw_vector_embedding_model")),d=(b,x)=>{if(!b)return!1;let T=a(x);return T?b.id==="aipkit_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(T):b.id==="aipkit_task_cw_image_provider"?["openai","google","openrouter","azure","replicate"].includes(T):b.id==="aipkit_cw_vector_store_provider"?["openai","pinecone","qdrant"].includes(T):b.id==="aipkit_task_cw_vector_store_provider"||b.id==="aipkit_task_ce_vector_store_provider"||b.id==="aipkit_task_content_indexing_target_store_provider"?["openai","pinecone","qdrant"].includes(T):b.id==="aipkit_cw_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(T):b.id==="aipkit_task_cw_vector_embedding_provider"||b.id==="aipkit_task_ce_vector_embedding_provider"?["openai","google","azure","openrouter"].includes(T):["openai","openrouter","claude","google","azure","deepseek","ollama"].includes(T):!1},a=b=>String(b||"").trim().toLowerCase(),l=(b,x,T)=>{if(!b)return;let P="aipkit_settings_select_picker_icon--";b.classList.forEach(F=>{F.startsWith(P)&&b.classList.remove(F)});let H=a(T),O=d(x,H);b.hidden=!O,O&&b.classList.add(`${P}${H}`)},p=(b,x)=>{if(!b)return;let T="aipkit_settings_select_picker_icon--assistant-";b.classList.forEach(H=>{H.startsWith(T)&&b.classList.remove(H)});let P=String(x||"").trim().toLowerCase();b.hidden=!P,P&&b.classList.add(`${T}${P}`)},_=b=>b&&(b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]"))?.dataset?.icon||"",f=b=>{if(!b)return"";let x=b.getAttribute("data-aipkit-picker-title");if(x)return x;let T=b.id&&document.querySelector(`label[for="${b.id}"]`)||b.closest(".aipkit_popover_option_main")?.querySelector(".aipkit_popover_option_label");return T?T.textContent.trim():""},g=b=>{if(!b)return"";let x=b.selectedOptions&&b.selectedOptions.length?b.selectedOptions[0]:b.querySelector("option[selected]");if(x)return x.textContent.trim();let T=b.querySelector("option");return T?T.textContent.trim():""},m=b=>({buttonId:`${b}_picker_btn`,labelId:`${b}_picker_label`,popoverId:`${b}_picker_popover`,titleId:`${b}_picker_title`,searchId:`${b}_picker_search`,listId:`${b}_picker_list`}),u=b=>b?b.closest("#aipkit_cw_builder_sheet")||b.closest("#aipkit_content_writer_container")||b.closest("#aipkit_autogpt_container")||b.closest("#aipkit_ai_forms_container"):null,h=b=>{if(!b||!b.id)return null;let x=m(b.id),T=u(b);if(!T)return null;let P=document.getElementById(x.buttonId);if(!P){if(P=document.createElement("button"),P.type="button",P.id=x.buttonId,P.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",P.setAttribute("data-aipkit-popover-target",x.popoverId),P.setAttribute("aria-controls",x.popoverId),P.setAttribute("aria-expanded","false"),P.dataset.aipkitPopoverPlacement="bottom",c(b)){P.classList.add("aipkit_settings_select_picker_btn--provider");let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),l(M,b,b.value),P.appendChild(M)}else if(s(b)){let M=document.createElement("span");M.className="aipkit_settings_select_picker_icon",M.setAttribute("aria-hidden","true"),p(M,_(b)),P.appendChild(M)}let O=document.createElement("span");O.className="aipkit_settings_select_picker_label",O.id=x.labelId,O.textContent=g(b)||k("Select","gpt3-ai-content-generator");let F=document.createElement("span");F.className="dashicons dashicons-arrow-down-alt2",F.setAttribute("aria-hidden","true"),P.appendChild(O),P.appendChild(F),b.insertAdjacentElement("beforebegin",P)}b.classList.contains("screen-reader-text")||b.classList.add("screen-reader-text");let H=document.getElementById(x.popoverId);if(!H){H=document.createElement("div"),H.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",H.id=x.popoverId,H.setAttribute("aria-hidden","true"),c(b)&&H.classList.add("aipkit_settings_select_picker_popover--provider");let O=document.createElement("div");O.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",O.setAttribute("role","dialog"),O.setAttribute("aria-labelledby",x.titleId);let F=document.createElement("div");F.className="aipkit_model_settings_popover_header";let M=document.createElement("span");M.className="aipkit_model_settings_popover_title",M.id=x.titleId,M.textContent=f(b)||k("Select","gpt3-ai-content-generator");let B=document.createElement("button");B.type="button",B.className="aipkit_model_settings_popover_close",B.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),B.innerHTML='<span class="dashicons dashicons-no-alt"></span>',F.appendChild(M),F.appendChild(B);let V=document.createElement("div");V.className="aipkit_model_settings_popover_body";let L=document.createElement("div");L.className="aipkit_settings_select_picker_search";let U=document.createElement("input");U.type="search",U.id=x.searchId,U.className="aipkit_form-input";let W=f(b),ee=W?`Search ${W.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");U.setAttribute("placeholder",ee),L.appendChild(U);let ne=document.createElement("div");ne.className="aipkit_settings_select_picker_list",ne.id=x.listId,ne.setAttribute("role","listbox"),V.appendChild(L),V.appendChild(ne),O.appendChild(F),O.appendChild(V),H.appendChild(O),T.appendChild(H),n(b)&&(L.style.display="none")}return{ids:x,button:P,popover:H,label:document.getElementById(x.labelId),search:document.getElementById(x.searchId),list:document.getElementById(x.listId)}},v=b=>{let x=[];return b&&Array.from(b.children).forEach(P=>{if(P.tagName==="OPTGROUP"){let H=Array.from(P.children).filter(O=>O.tagName==="OPTION").map(O=>({value:O.value,label:O.textContent.trim(),disabled:O.disabled,selected:O.selected,icon:O.dataset?.icon||""}));x.push({label:P.label,options:H})}else P.tagName==="OPTION"&&x.push({label:"",options:[{value:P.value,label:P.textContent.trim(),disabled:P.disabled,selected:P.selected,icon:P.dataset?.icon||""}]})}),x},S=(b,x,T="")=>{if(!b||!x)return;x.innerHTML="";let P=v(b),H=T.trim().toLowerCase(),O=!1;if(P.forEach(F=>{let M=F.options.filter(B=>H?B.label.toLowerCase().includes(H):!0);if(M.length){if(F.label){let B=document.createElement("div");B.className="aipkit_settings_select_picker_group_label",B.textContent=F.label,x.appendChild(B)}M.forEach(B=>{let V=document.createElement("button");if(V.type="button",V.className="aipkit_settings_select_picker_item",B.disabled&&V.classList.add("is-disabled"),B.selected&&V.classList.add("is-active"),V.dataset.value=B.value,c(b)&&d(b,B.value)){let W=document.createElement("span");W.className="aipkit_settings_select_picker_icon",W.setAttribute("aria-hidden","true"),l(W,b,B.value),V.appendChild(W)}else if(s(b)&&B.icon){let W=document.createElement("span");W.className="aipkit_settings_select_picker_icon",W.setAttribute("aria-hidden","true"),p(W,B.icon),V.appendChild(W)}let L=document.createElement("span");L.className="aipkit_settings_select_picker_text",L.textContent=B.label||B.value;let U=document.createElement("span");U.className="dashicons dashicons-yes aipkit_settings_select_picker_check",U.setAttribute("aria-hidden","true"),V.appendChild(L),V.appendChild(U),x.appendChild(V),O=!0})}}),!O){let F=document.createElement("div");F.className="aipkit_settings_select_picker_empty",F.textContent=k(H?"No matches found.":"No options available.","gpt3-ai-content-generator"),x.appendChild(F)}},q=(b,x)=>{if(!b||!x)return;let T=g(b);if(x.textContent=T||k("Select","gpt3-ai-content-generator"),c(b)){let P=x.closest("button"),H=P?P.querySelector(".aipkit_settings_select_picker_icon"):null;l(H,b,b.value)}else if(s(b)){let P=x.closest("button"),H=P?P.querySelector(".aipkit_settings_select_picker_icon"):null;p(H,_(b))}},y=(b,x)=>{if(!b||!x)return;let T=b.getBoundingClientRect(),P=x.getBoundingClientRect(),H=P.width||320,O=P.height||0,F=window.innerWidth,M=window.innerHeight,B=12;if(b.dataset.aipkitPopoverPlacement==="bottom"){let U=T.left;U+H>F-B&&(U=T.right-H),U=Math.max(B,Math.min(U,F-H-B));let W=T.bottom+8;W+O>M-B&&(W=T.top-O-8),W=Math.max(B,Math.min(W,M-O-B)),x.style.left=`${Math.round(U)}px`,x.style.top=`${Math.round(W)}px`;return}let V=T.right+10;V+H>F-B&&(V=T.left-H-10),V=Math.max(B,Math.min(V,F-H-B));let L=T.top;L+O>M-B&&(L=M-O-B),L=Math.max(B,L),x.style.left=`${Math.round(V)}px`,x.style.top=`${Math.round(L)}px`},E=()=>{!r||!i||e||(e=!0,window.requestAnimationFrame(()=>{let b=r.querySelector(".aipkit_model_settings_popover_panel");y(i,b),e=!1}))},I=()=>{r&&(r.classList.remove("aipkit-active"),r.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-expanded","false"),r=null,i=null)},w=(b,x,T)=>{if(!b||!x)return;r&&r!==x&&I(),r=x,i=b,x.classList.add("aipkit-active"),x.setAttribute("aria-hidden","false"),b.setAttribute("aria-expanded","true");let P=x.querySelector(".aipkit_settings_select_picker_search input"),H=x.querySelector(".aipkit_settings_select_picker_list");H&&S(T,H,P?P.value:""),P&&P.offsetParent!==null&&(P.focus(),P.select());let O=x.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{y(b,O)})},A=(b,x)=>{if(!b||!x)return;let{button:T,popover:P,list:H,search:O}=x;if(T&&T.dataset.pickerListenerAttached!=="true"&&(T.addEventListener("click",F=>{if(F.preventDefault(),r===P){I();return}w(T,P,b)}),T.dataset.pickerListenerAttached="true"),P&&P.dataset.overlayListenerAttached!=="true"){P.addEventListener("click",M=>{M.target===P&&I()});let F=P.querySelector(".aipkit_model_settings_popover_close");F&&F.addEventListener("click",M=>{M.preventDefault(),I()}),P.dataset.overlayListenerAttached="true"}if(H&&H.dataset.pickerListenerAttached!=="true"&&(H.addEventListener("click",F=>{let M=F.target.closest(".aipkit_settings_select_picker_item");if(!M||M.classList.contains("is-disabled"))return;let B=M.dataset.value??"";b.value=B,b.dispatchEvent(new Event("change",{bubbles:!0})),q(b,x.label),S(b,H,O?O.value:""),I()}),H.dataset.pickerListenerAttached="true"),O&&O.dataset.pickerListenerAttached!=="true"&&(O.addEventListener("input",()=>{S(b,H,O.value)}),O.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerListenerAttached!=="true"&&(b.addEventListener("change",()=>{q(b,x.label),S(b,H,O?O.value:"")}),b.dataset.pickerListenerAttached="true"),b&&b.dataset.pickerObserverAttached!=="true"){let F=!1;new MutationObserver(()=>{F||(F=!0,window.requestAnimationFrame(()=>{q(b,x.label),S(b,H,O?O.value:""),F=!1}))}).observe(b,{childList:!0,subtree:!0}),b.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitContentWriterPickerEscapeBound||(document.addEventListener("keydown",F=>{F.key==="Escape"&&r&&I()}),document.body.dataset.aipkitContentWriterPickerEscapeBound="true"),document.body.dataset.aipkitContentWriterPickerRepositionBound||(window.addEventListener("resize",E),window.addEventListener("scroll",E,!0),document.body.dataset.aipkitContentWriterPickerRepositionBound="true")};function C(){let b=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);b.length&&b.forEach(x=>{let T=x.querySelectorAll(o);T.length&&T.forEach(P=>{if(!P.id||P.dataset.aipkitPickerInit==="true")return;let H=h(P);H&&(q(P,H.label),S(P,H.list,H.search?H.search.value:""),A(P,H),P.dataset.aipkitPickerInit="true")})})}window.aipkit_initContentWriterSelectPickers=C,window.aipkit_refreshContentWriterSelectPickers=function(){let b=[document.getElementById("aipkit_content_writer_container"),document.getElementById("aipkit_autogpt_container"),document.getElementById("aipkit_cw_builder_sheet")].filter(Boolean);b.length&&b.forEach(x=>{let T=x.querySelectorAll(o);T.length&&T.forEach(P=>{if(!P.id)return;let H=h(P);H&&(q(P,H.label),S(P,H.list,H.search?H.search.value:""),A(P,H),P.dataset.aipkitPickerInit="true")})})}})();(function(){"use strict";function k(s){s||(s=document.getElementById("aipkit_content_writer_container")),s&&(o(s),i(s),e(s))}function o(s){let n=s.querySelectorAll(".aipkit_ai_reasoning_input"),d=s.querySelector("#aipkit_content_writer_reasoning_effort");!n.length||!d||(n.forEach(a=>{a.addEventListener("change",function(){if(this.checked){d.value=this.value,s.querySelectorAll(".aipkit_ai_reasoning_option").forEach(_=>{_.classList.remove("aipkit_ai_reasoning_option--selected")});let l=this.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected");let p=new Event("change",{bubbles:!0});d.dispatchEvent(p)}})}),r(s))}function r(s){let n=s.querySelector("#aipkit_content_writer_reasoning_effort");if(!n)return;let d=n.value||"medium";d==="minimal"&&(d="low");let a=s.querySelector(`.aipkit_ai_reasoning_input[value="${d}"]`);if(a&&!a.checked){a.checked=!0,s.querySelectorAll(".aipkit_ai_reasoning_option").forEach(p=>{p.classList.remove("aipkit_ai_reasoning_option--selected")});let l=a.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected")}}function i(s){let n=s.querySelector("#aipkit_content_writer_temperature"),d=s.querySelector("#aipkit_content_writer_temperature_value");!n||!d||n.dataset.enhancedListenerAttached!=="true"&&(n.addEventListener("input",function(){d.textContent=this.value}),n.dataset.enhancedListenerAttached="true")}function e(s){let n=s.querySelector("#aipkit_content_writer_content_length_slider"),d=s.querySelector("#aipkit_content_writer_content_length_value"),a=s.querySelector("#aipkit_content_writer_content_length_hint"),l=s.querySelector("#aipkit_content_writer_content_length");if(!n||!d||!a||!l||n.dataset.enhancedListenerAttached==="true")return;let p=[{key:"short",label:"Short",words:"600-800"},{key:"medium",label:"Medium",words:"1200-1600"},{key:"long",label:"Long",words:"2000-2500"}],_="medium",f=u=>{let h=p.findIndex(v=>v.key===u);return h===-1?p.findIndex(v=>v.key===_):h},g=u=>{let h=f(u),v=p[h];d.textContent=v.label,a.textContent=`Approx. ${v.words} words`,n.value=String(h+1)},m=(u,h=!1)=>{let v=p.some(S=>S.key===u)?u:_;l.value!==v&&(l.value=v),g(v),h&&l.dispatchEvent(new Event("change",{bubbles:!0}))};n.addEventListener("input",function(){let u=Math.max(1,Math.min(3,parseInt(this.value,10)))-1,h=p[u]?.key||_;m(h,!0)}),l.addEventListener("change",function(){m(this.value,!1)}),m(l.value||_,!1),n.dataset.enhancedListenerAttached="true"}function t(s,n){if(!s||!n)return;let d=s.querySelector("#aipkit_content_writer_reasoning_effort");d&&(d.value=n==="minimal"?"low":n);let a=s.querySelector(`.aipkit_ai_reasoning_input[value="${n==="minimal"?"low":n}"]`);if(a){a.checked=!0,s.querySelectorAll(".aipkit_ai_reasoning_option").forEach(p=>{p.classList.remove("aipkit_ai_reasoning_option--selected")});let l=a.closest(".aipkit_ai_reasoning_option");l&&l.classList.add("aipkit_ai_reasoning_option--selected")}}function c(s){if(!s)return"medium";let n=s.querySelector(".aipkit_ai_reasoning_input:checked");if(n)return n.value;let d=s.querySelector("#aipkit_content_writer_reasoning_effort");return d?d.value:"medium"}window.aipkit_initAiSettingsRedesigned=k,window.aipkit_setReasoningEffort=t,window.aipkit_getReasoningEffort=c})();(function(){"use strict";function k(o,r,i,e,t,c){if(typeof window.aipkit_handleProviderModelDropdowns=="function"?window.aipkit_handleProviderModelDropdowns(o,r):console.error("Content Writer UI: handleProviderModelDropdowns function not found."),typeof window.aipkit_handleTemperatureSlider=="function"?window.aipkit_handleTemperatureSlider(i):console.error("Content Writer UI: handleTemperatureSlider function not found."),typeof window.aipkit_handleCopyButton=="function"?window.aipkit_handleCopyButton(t):console.error("Content Writer UI: handleCopyButton function not found."),typeof window.aipkit_handleClearButton=="function"?window.aipkit_handleClearButton(c,t):console.error("Content Writer UI: handleClearButton function not found."),typeof window.aipkit_initContentWriterSettingsSummary=="function"?window.aipkit_initContentWriterSettingsSummary():console.error("Content Writer UI: initContentWriterSettingsSummary function not found."),typeof window.aipkit_initContentWriterSelectPickers=="function"?window.aipkit_initContentWriterSelectPickers():console.error("Content Writer UI: initContentWriterSelectPickers function not found."),typeof window.aipkit_initAiSettingsRedesigned=="function"){let s=document.getElementById("aipkit_content_writer_container");window.aipkit_initAiSettingsRedesigned(s)}}window.aipkit_initContentWriterUI=k})();(function(){"use strict";let k={intervalId:null,startTime:null};function o(s){let n=Math.floor(s/1e3),d=Math.floor(n/60),a=n%60;return`${d}:${String(a).padStart(2,"0")}`}function r(s){if(!s)return null;let n=s.querySelector(".aipkit_cw_btn_timer");if(n)return n;n=document.createElement("span"),n.className="aipkit_cw_btn_timer",n.setAttribute("aria-hidden","true"),n.hidden=!0;let d=s.querySelector(".aipkit_btn-text");return d?s.insertBefore(n,d):s.insertBefore(n,s.firstChild),n}function i(s){if(!s||k.intervalId)return;let n=r(s);if(!n)return;k.startTime=Date.now();let d=()=>{let a=Date.now()-k.startTime;n.textContent=o(a),n.hidden=!1};d(),k.intervalId=window.setInterval(d,1e3)}function e(s){k.intervalId&&(clearInterval(k.intervalId),k.intervalId=null),k.startTime=null;let n=r(s);n&&(n.hidden=!0,n.textContent="")}function t(s){let n=document.getElementById("aipkit_content_writer_generate_btn");if(!n)return;let d=n.closest(".aipkit_cw_generate_split"),a=d?d.querySelector(".aipkit_cw_generate_toggle"):null,l=d?d.querySelector(".aipkit_cw_generate_menu"):null,p=l?Array.from(l.querySelectorAll(".aipkit_cw_generate_menu_item")):[],_=document.getElementById("aipkit_content_writer_stop_btn");if(s){if(n.dataset.aipkitStopMode="true",d&&d.classList.add("is-single"),i(n),typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(n,"Stop");else{let f=n.querySelector(".aipkit_btn-text");f?f.textContent="Stop":n.textContent="Stop"}n.disabled=!1,n.removeAttribute("aria-disabled"),n.style.display="inline-flex",a&&(a.style.display="none",a.disabled=!0),l&&(l.hidden=!0),p.length&&p.forEach(f=>{f.disabled=!0,f.setAttribute("aria-disabled","true")}),_&&(_.style.display="none");return}n.dataset.aipkitStopMode&&delete n.dataset.aipkitStopMode,e(n),d&&d.classList.remove("is-single"),a&&(a.style.display="",a.disabled=!1,a.removeAttribute("aria-disabled")),p.length&&p.forEach(f=>{f.disabled=!1,f.removeAttribute("aria-disabled")}),_&&(_.style.display="none")}function c(){let s=document.getElementById("aipkit_content_writer_generate_btn"),n=document.getElementById("aipkit_content_writer_stop_btn"),d=s?.dataset?.action||"generate",l={generate:"Generate",create_task:"Create Task",upgrade:"Upgrade to Pro",update:"Update"}[d]||"Generate";s&&(e(s),s.dataset.aipkitStopMode&&delete s.dataset.aipkitStopMode,typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(s,!1,l):(s.disabled=!1,s.textContent=l),s.style.display="inline-flex"),n&&(n.style.display="none"),typeof window.aipkit_updateContentWriterActionState=="function"&&window.aipkit_updateContentWriterActionState()}window.aipkit_setContentWriterStopMode=t,window.aipkit_resetContentWriterButtons=c})();(function(){"use strict";function k(o){o.current&&(o.current.close(),o.current=null),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():console.error("Content Writer Finalize Stream: resetButtons function not found.");let r=document.getElementById("aipkit_cw_generated_content_area"),i=document.getElementById("aipkit_content_writer_output_display"),e=document.querySelector(".aipkit_content_writer_output_actions"),t=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn");r&&(r.textContent.trim().length>0||!!r.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))&&(!i||!i.classList.contains("aipkit_content_writer_output_error"))?(e&&(e.style.display="flex"),t&&(t.disabled=!1),c&&(c.disabled=!1),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_showPrimaryAction=="function"&&window.aipkit_showPrimaryAction(),typeof window.aipkit_updateMetaChunkVisibility=="function"&&window.aipkit_updateMetaChunkVisibility(),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton()):(e&&(e.style.display="none"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction(),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton())}window.aipkit_finalizeStream=k})();(function(){"use strict";function k(c,s,n,d){let a=c.querySelector("[data-csv-upload-zone]"),l=c.querySelector("[data-csv-status]"),p=c.querySelector("[data-csv-status-card]"),_=c.querySelector("[data-csv-status-icon]"),f=c.querySelector("[data-csv-file-name]"),g=c.querySelector("[data-csv-message]");if(!(!l||!p)){if(s==="idle"){a&&a.classList.remove("is-hidden"),l.hidden=!0;return}if(a&&a.classList.add("is-hidden"),l.hidden=!1,p.dataset.status=s,_){let m="dashicons-yes-alt";s==="loading"&&(m="dashicons-update"),s==="error"&&(m="dashicons-warning"),_.innerHTML=`<span class="dashicons ${m}" aria-hidden="true"></span>`;let u=_.querySelector(".dashicons");u&&s==="loading"&&(u.style.animation="aipkit_csv_spin 1s linear infinite")}f&&d?f.textContent=d:f&&(f.textContent=""),g&&(g.textContent=n||"")}}async function o(c){let s=c.target,n=s.closest(".aipkit_csv_import_container")||s.closest(".aipkit_form-group");if(!n)return;let d=n.querySelector("[data-csv-status]")!==null,a=n.querySelector(".aipkit_csv_analysis_results"),l=n.querySelector(".aipkit_csv_data_holder"),p=document.getElementById("aipkit_content_writer_nonce"),_=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,f=p?p.value:_;if(!l||!f){console.error("CSV Handler: Missing data holder or nonce field."),d?k(n,"error","Error: A required component is missing.",null):a&&(a.textContent="Error: A required UI component or security token is missing.",a.className="aipkit_form-help aipkit_settings_message-error");return}let g=s.files[0];if(!g){d?k(n,"idle",null,null):a&&(a.textContent="Please select a CSV file first.",a.className="aipkit_form-help aipkit_settings_message-error");return}if(!g.name.toLowerCase().endsWith(".csv")){d?k(n,"error","Invalid file type. Please upload a .csv file.",g.name):a&&(a.textContent="Invalid file type. Please upload a .csv file.",a.className="aipkit_form-help aipkit_settings_message-error");return}d?k(n,"loading","Parsing CSV...",g.name):a&&(a.textContent="Parsing CSV...",a.className="aipkit_form-help aipkit_settings_message-info");let m=new FormData;m.append("file",g),m.append("_ajax_nonce",f),m.append("action","aipkit_content_writer_parse_csv");try{let u=await fetch(window.aipkit_dashboard.ajaxurl,{method:"POST",body:m,credentials:"same-origin"});if(!u.ok){let S=`Server returned status ${u.status}`;try{let q=await u.json();q&&q.data&&q.data.message&&(S=q.data.message)}catch{}throw new Error(S)}let h=await u.json();if(!h.success)throw new Error(h.data?.message||"Unknown server error.");let v=h.data;if(v.tasks_found>0){l.value=v.formatted_data;let q=s.id==="aipkit_task_cw_csv_file_input"||!!s.closest("#aipkit_autogpt_container")?`Found ${v.tasks_found} ${v.tasks_found===1?"topic":"topics"}. Ready to save the task.`:`Found ${v.tasks_found} ${v.tasks_found===1?"topic":"topics"}. Hit Generate to proceed.`;d?k(n,"success",q,g.name):a&&(a.textContent=`Success! Found ${v.tasks_found} topics in the CSV file. Ready.`,a.className="aipkit_form-help aipkit_settings_message-success")}else{l.value="";let S="No valid topics found in the CSV file.";d?k(n,"error",S,g.name):a&&(a.textContent=S,a.className="aipkit_form-help aipkit_settings_message-error")}}catch(u){l.value="";let h=u.message||"Failed to parse CSV file.";d?k(n,"error",h,g.name):a&&(a.textContent=`Error: ${h}`,a.className="aipkit_form-help aipkit_settings_message-error"),console.error("CSV Parse Error:",u)}}function r(c){let s=c.target.closest("[data-csv-clear]");if(!s)return;let n=s.closest(".aipkit_csv_import_container");if(!n)return;let d=n.querySelector("input[type='file']"),a=n.querySelector(".aipkit_csv_data_holder");d&&(d.value=""),a&&(a.value=""),k(n,"idle",null,null)}function i(c){if(!c||c.dataset.dragDropAttached==="true")return;let s=l=>{l.preventDefault(),l.stopPropagation()},n=()=>c.classList.add("is-dragover"),d=()=>c.classList.remove("is-dragover"),a=l=>{s(l),d();let _=l.dataTransfer.files;if(_.length>0){let f=c.querySelector("input[type='file']");if(f){let g=new DataTransfer;g.items.add(_[0]),f.files=g.files,f.dispatchEvent(new Event("change",{bubbles:!0}))}}};["dragenter","dragover","dragleave","drop"].forEach(l=>{c.addEventListener(l,s,!1)}),["dragenter","dragover"].forEach(l=>{c.addEventListener(l,n,!1)}),["dragleave","drop"].forEach(l=>{c.addEventListener(l,d,!1)}),c.addEventListener("drop",a,!1),c.dataset.dragDropAttached="true"}function e(){let c=document.getElementById("aipkit_cw_csv_file_input");if(!c||c.dataset.listenerAttached==="true")return;c.addEventListener("change",o),c.dataset.listenerAttached="true";let s=c.closest(".aipkit_csv_import_container");if(s){let n=s.querySelector(".aipkit_csv_dropzone");i(n);let d=s.querySelector("[data-csv-clear]");d&&d.dataset.listenerAttached!=="true"&&(d.addEventListener("click",r),d.dataset.listenerAttached="true")}}function t(){let c=document.getElementById("aipkit_task_cw_csv_file_input");if(!c||c.dataset.listenerAttached==="true")return;c.addEventListener("change",o),c.dataset.listenerAttached="true";let s=c.closest(".aipkit_csv_import_container");if(s){let n=s.querySelector(".aipkit_csv_dropzone");i(n);let d=s.querySelector("[data-csv-clear]");d&&d.dataset.listenerAttached!=="true"&&(d.addEventListener("click",r),d.dataset.listenerAttached="true")}}window.aipkit_initCsvUploadHandler=e,window.aipkit_initTaskCsvUploadHandler=t})();(function(){"use strict";function k(o,r){let i=document.getElementById("aipkit_content_writer_frontend_stream_nonce");if(!i||!i.value)throw new Error("Security token missing for stream. Please reload.");let e=new URL(window.aipkit_dashboard.ajaxurl);e.searchParams.append("action","aipkit_frontend_chat_stream"),e.searchParams.append("cache_key",o),e.searchParams.append("_ajax_nonce",i.value),r.current&&r.current.close();try{let t=new EventSource(e.toString());return t.userStopped=!1,t}catch(t){throw console.error("EventSource Connection Setup: EventSource creation error:",t),new Error("Could not connect to stream. "+t.message)}}window.aipkit_stream_setupEventSourceConnection=k})();(function(){"use strict";function k(r){let i=r.parentElement,e=i?.closest(".aipkit_cw_output_chunk--primary");e&&(i.scrollHeight>i.clientHeight?e.classList.add("has-overflow"):e.classList.remove("has-overflow"))}function o(r,i,e,t){if(r.data)try{let c=JSON.parse(r.data);if(c.delta){if(i.fullContent+=c.delta,e.classList.contains("is-streaming")||e.classList.add("is-streaming"),!t&&typeof window.aipkit_getMarkdownRenderer=="function"&&(t=window.aipkit_getMarkdownRenderer()),t)e.innerHTML=t.render(i.fullContent);else{let n=e.textContent||"";e.textContent=n+c.delta}typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(e.innerHTML);let s=e.parentElement;s&&s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),k(e),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter()}}catch(c){console.error("Stream Message Handler: Error parsing event data.",c)}}window.aipkit_stream_handleMessage=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};async function o(r,i,e,t,c,s){if(i.isDone)return;i.isDone=!0,s&&s.current&&(s.current.close(),s.current=null),e.classList.contains("is-streaming")&&e.classList.remove("is-streaming"),!t&&typeof window.aipkit_getMarkdownRenderer=="function"&&(t=window.aipkit_getMarkdownRenderer()),t&&(e.innerHTML=t.render(i.fullContent)),typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(e.innerHTML),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success");let n=document.getElementById("aipkit_content_writer_form"),d=n?n.elements.generate_meta_description:null,a=n?n.elements.generate_focus_keyword:null,l=n?n.elements.generate_excerpt:null,p=n?n.elements.generate_tags:null,_=document.getElementById("aipkit_content_writer_nonce")?.value,f=n.elements.ai_provider?.value,g=n.elements.ai_model?.value,m=n.querySelector('input[name="prompt_mode"]:checked')?.value||"custom",u=document.getElementById("aipkit_cw_generated_title_display"),h=u?u.textContent:n.elements.content_title?.value.split("|")[0].trim()||"Untitled",v=n.elements.content_keywords?.value.trim()||"",S="",q=document.getElementById("aipkit_content_writer_title");if(q){let C=q.value.split("|")||[];C.length>1&&(S=C[1].trim())}let y=S||v,E=y;if(a?.checked&&!y&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","generating");try{let C=n.elements.enable_vector_store,b=C&&C.checked?"1":"0",x=n.elements.vector_store_provider?.value,T=n.elements["openai_vector_store_ids[]"],P=T?Array.from(T.selectedOptions).map(L=>L.value):[],H=n.elements.pinecone_index_name?.value,O=n.elements.qdrant_collection_name?.value,F=n.elements.vector_store_top_k?.value,M=n.elements.vector_store_confidence_threshold?.value,B={generated_content:i.fullContent,final_title:h,provider:f,model:g,prompt_mode:m,custom_keyword_prompt:n.elements.custom_keyword_prompt.value,enable_vector_store:b,vector_store_provider:x,openai_vector_store_ids:P,pinecone_index_name:H,qdrant_collection_name:O,vector_store_top_k:F,vector_store_confidence_threshold:M,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_},V=await window.aipkit_apiRequest("aipkit_content_writer_generate_focus_keyword",B);if(V&&V.focus_keyword){E=V.focus_keyword;let L=document.getElementById("aipkit_cw_generated_focus_keyword"),U=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");L&&U&&(L.value=E,U.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else throw new Error("AI did not return a focus keyword.")}catch(C){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error",C.message||"Failed")}}else if(y){let C=document.getElementById("aipkit_cw_generated_focus_keyword"),b=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");C&&b&&(C.value=y.split(",")[0].trim(),b.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","skipped");let I=n?n.elements.generate_images_enabled:null,w=n?n.elements.generate_featured_image:null;if((I?.checked||w?.checked)&&i.fullContent.trim()!==""){let C=I?.checked,b=w?.checked,x=String(n.elements.image_provider?.value||"").toLowerCase(),T=String(n.elements.image_model?.value||"").toLowerCase(),P=x==="openai"&&T.startsWith("gpt-image-1"),H=C?parseInt(n.elements.image_count?.value,10)||1:0,O=document.getElementById("aipkit_cw_generated_excerpt"),F=H+(b?1:0),M=C&&b?H>1?`Generating ${H} content images and 1 featured image...`:"Generating 1 content image and 1 featured image...":b?"Generating featured image...":C?H>1?`Generating ${H} content images...`:"Generating content image...":F>1?`Generating ${F} images...`:F===1?"Generating 1 image...":"Generating images...",B={original_topic:q?q.value.split("|")[0].trim():h,final_title:h,post_title:h,keywords:E,excerpt:O?O.value:"",ai_provider:n.elements.ai_provider?.value,ai_model:n.elements.ai_model?.value,ai_temperature:n.elements.ai_temperature?.value,reasoning_effort:n.elements.reasoning_effort?.value,image_provider:n.elements.image_provider?.value,image_model:n.elements.image_model?.value,image_prompt:n.elements.image_prompt?.value,image_alignment:n.elements.image_alignment?.value,image_size:n.elements.image_size?.value,featured_image_prompt:n.elements.featured_image_prompt?.value,generate_image_title:n.elements.generate_image_title?.checked?"1":"0",generate_image_alt_text:n.elements.generate_image_alt_text?.checked?"1":"0",generate_image_caption:n.elements.generate_image_caption?.checked?"1":"0",generate_image_description:n.elements.generate_image_description?.checked?"1":"0",image_title_prompt:n.elements.image_title_prompt?.value,image_alt_text_prompt:n.elements.image_alt_text_prompt?.value,image_caption_prompt:n.elements.image_caption_prompt?.value,image_description_prompt:n.elements.image_description_prompt?.value,pexels_orientation:n.elements.pexels_orientation?.value,pexels_size:n.elements.pexels_size?.value,pexels_color:n.elements.pexels_color?.value,pixabay_orientation:n.elements.pixabay_orientation?.value,pixabay_image_type:n.elements.pixabay_image_type?.value,pixabay_category:n.elements.pixabay_category?.value,_ajax_nonce:_,generate_images_enabled:C?"1":"0",image_count:H,generate_featured_image:b?"1":"0",image_placement:n.elements.image_placement?.value,image_placement_param_x:n.elements.image_placement_param_x?.value,cw_generation_mode:n.elements.cw_generation_mode?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0},V=U=>{let W=document.getElementById("aipkit_cw_image_data_holder");W&&(W.value=JSON.stringify(U)),typeof window.aipkit_renderContentWriterImagePreview=="function"&&window.aipkit_renderContentWriterImagePreview(U)},L=async(U={},W="")=>{typeof window.aipkit_updateCwGenerationStatus=="function"&&W&&window.aipkit_updateCwGenerationStatus("image","generating",W);let ee=await window.aipkit_apiRequest("aipkit_content_writer_generate_images",{...B,...U});if(!ee?.image_data)throw new Error("Image generation failed or returned no data.");return ee.image_data};try{let U=C&&b,W=P&&C&&H>1,ee=null,ne=z=>{ee||(ee={...z,in_content_images:[],featured_image_id:null,featured_image_url:null})};if(U){if(C&&H>0)if(W&&H>1)for(let z=0;z<H;z++){let ge=await L({generate_featured_image:"0",image_count:1,image_start_index:z+1},`Generating content image ${z+1} of ${H}...`);ne(ge),Array.isArray(ge.in_content_images)&&ee.in_content_images.push(...ge.in_content_images),V(ee)}else{let z=await L({generate_featured_image:"0"},H>1?`Generating ${H} content images...`:"Generating content image...");ne(z),ee.in_content_images=z.in_content_images||[],V(ee)}if(b){let z=await L({generate_images_enabled:"0",image_count:0},"Generating featured image...");ne(z),ee.featured_image_id=z.featured_image_id||null,ee.featured_image_url=z.featured_image_url||null}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","generating",M),ee=await L();if(ee)V(ee),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","success");else throw new Error("Image generation failed or returned no data.")}catch(U){typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","error",U.message||"Failed")}}else typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview(),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped");if(l?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let C=n.elements.enable_vector_store,b=C&&C.checked?"1":"0",x=n.elements.vector_store_provider?.value,T=n.elements["openai_vector_store_ids[]"],P=T?Array.from(T.selectedOptions).map(L=>L.value):[],H=n.elements.pinecone_index_name?.value,O=n.elements.qdrant_collection_name?.value,F=n.elements.vector_store_top_k?.value,M=n.elements.vector_store_confidence_threshold?.value,B={generated_content:i.fullContent,final_title:h,keywords:E,provider:f,model:g,prompt_mode:m,custom_excerpt_prompt:n.elements.custom_excerpt_prompt.value,enable_vector_store:b,vector_store_provider:x,openai_vector_store_ids:P,pinecone_index_name:H,qdrant_collection_name:O,vector_store_top_k:F,vector_store_confidence_threshold:M,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_},V=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",B);if(V&&V.excerpt){let L=document.getElementById("aipkit_cw_generated_excerpt"),U=document.getElementById("aipkit_cw_excerpt_output_wrapper");L&&U&&(L.value=V.excerpt,U.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("AI did not return an excerpt.")}catch(C){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",C.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","skipped");if(p?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let C=n.elements.enable_vector_store,b=C&&C.checked?"1":"0",x=n.elements.vector_store_provider?.value,T=n.elements["openai_vector_store_ids[]"],P=T?Array.from(T.selectedOptions).map(L=>L.value):[],H=n.elements.pinecone_index_name?.value,O=n.elements.qdrant_collection_name?.value,F=n.elements.vector_store_top_k?.value,M=n.elements.vector_store_confidence_threshold?.value,B={generated_content:i.fullContent,final_title:h,keywords:E,provider:f,model:g,prompt_mode:m,custom_tags_prompt:n.elements.custom_tags_prompt.value,enable_vector_store:b,vector_store_provider:x,openai_vector_store_ids:P,pinecone_index_name:H,qdrant_collection_name:O,vector_store_top_k:F,vector_store_confidence_threshold:M,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_},V=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",B);if(V&&V.tags){let L=document.getElementById("aipkit_cw_generated_tags"),U=document.getElementById("aipkit_cw_tags_output_wrapper");L&&U&&(L.value=V.tags,U.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("AI did not return any tags.")}catch(C){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",C.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","skipped");if(d?.checked&&i.fullContent.trim()!==""){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","generating");try{let C=n.elements.enable_vector_store,b=C&&C.checked?"1":"0",x=n.elements.vector_store_provider?.value,T=n.elements["openai_vector_store_ids[]"],P=T?Array.from(T.selectedOptions).map(L=>L.value):[],H=n.elements.pinecone_index_name?.value,O=n.elements.qdrant_collection_name?.value,F=n.elements.vector_store_top_k?.value,M=n.elements.vector_store_confidence_threshold?.value,B={generated_content:i.fullContent,final_title:h,keywords:E,provider:f,model:g,prompt_mode:m,custom_meta_prompt:n.elements.custom_meta_prompt.value,enable_vector_store:b,vector_store_provider:x,openai_vector_store_ids:P,pinecone_index_name:H,qdrant_collection_name:O,vector_store_top_k:F,vector_store_confidence_threshold:M,vector_embedding_provider:n.elements.vector_embedding_provider?.value,vector_embedding_model:n.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:_},V=await window.aipkit_apiRequest("aipkit_content_writer_generate_meta_desc",B);if(V&&V.meta_description){let L=document.getElementById("aipkit_cw_generated_meta_desc"),U=document.getElementById("aipkit_cw_meta_desc_output_wrapper");L&&U&&(L.value=V.meta_description,U.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else throw new Error("AI did not return a meta description.")}catch(C){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error",C.message||"Failed")}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","skipped");typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(s)}window.aipkit_stream_handleDone=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(r,i,e,t,c){if(i.isDone)return;if(c.current&&c.current.userStopped===!0){typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c);return}let s="Error during streaming.";if(r.data)try{s=JSON.parse(r.data).error||s}catch{}console.error("Stream Error Handler: Error event received:",r),e&&(e.textContent="",e.className="aipkit_cw_status_badge"),t&&t.classList.add("aipkit_content_writer_output_error"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error",s),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),typeof window.aipkit_finalizeStream=="function"&&window.aipkit_finalizeStream(c)}window.aipkit_stream_handleError=o})();(function(){"use strict";let k={current:null};function o(r,i){let e=document.getElementById("aipkit_content_writer_output_display"),t=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_form_status");if(!e||!t||!c){console.error("EventSource Orchestrator: Missing UI elements for streaming.");return}let s=["aipkit_getMarkdownRenderer","aipkit_stream_setupEventSourceConnection","aipkit_stream_handleMessage","aipkit_stream_handleDone","aipkit_stream_handleError","aipkit_finalizeStream","aipkit_updateCwGenerationStatus"];for(let d of s)if(typeof window[d]!="function"){console.error(`EventSource Orchestrator: Missing required function: ${d}`),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let n={fullContent:"",isDone:!1};t.innerHTML="",e.classList.remove("aipkit_content_writer_output_error"),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),window.aipkit_updateCwGenerationStatus("content","generating");try{i.current=window.aipkit_stream_setupEventSourceConnection(r,i);let d=window.aipkit_getMarkdownRenderer();i.current.onopen=function(){window.aipkit_updateCwGenerationStatus("content","generating")},i.current.onmessage=function(a){window.aipkit_stream_handleMessage(a,n,t,d)},i.current.addEventListener("done",function(a){window.aipkit_stream_handleDone(a,n,t,d,c,i)}),i.current.addEventListener("error",function(a){window.aipkit_stream_handleError(a,n,c,e,i)})}catch(d){console.error("EventSource Orchestrator: Error during setup:",d),c&&(c.textContent="",c.className="aipkit_cw_status_badge"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons(),window.aipkit_updateCwGenerationStatus("content","error","Connection Failed")}}window.aipkit_handleContentWriterEventSource=o,window.aipkit_contentWriterEventSourceInstanceRef=k})();(function(){"use strict";function k(o){o&&o.current&&o.current.close()}window.aipkit_stopContentWriterEventSource=k})();(function(){"use strict";async function k(o){let r=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_form_status"),t=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_copy_btn"),s=document.getElementById("aipkit_content_writer_clear_btn"),n=document.querySelector(".aipkit_content_writer_progress_bar_container"),d=document.querySelector(".aipkit_content_writer_output_actions"),a=function(g){if(!g)return"Error";let m=g.message||"Error",u=g.details||g.data?.details,h=u?.provider,v=u?.model;return h||v?`${m} (${[h,v].filter(Boolean).join(" \xB7 ")})`:m};if(!r||!i||!e||!t||!c||!s||!d){console.error("Handle SSE: Missing UI elements.");return}let l=new FormData(r),p=Object.fromEntries(l.entries()),_=r.elements["openai_vector_store_ids[]"];if(p.openai_vector_store_ids=_?Array.from(_.selectedOptions).map(g=>g.value):[],delete p["openai_vector_store_ids[]"],!p.conversation_uuid){let g=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();g&&(p.conversation_uuid=g)}if(!p.content_title){e.textContent="",e.className="aipkit_cw_status_badge";return}let f=document.getElementById("aipkit_content_writer_nonce");if(f&&f.value)p._ajax_nonce=f.value;else{e.textContent="",e.className="aipkit_cw_status_badge";return}typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!0),n&&(n.style.display="none"),d.style.display="none",t&&(t.innerHTML='<p class="aipkit_text-center"><span class="aipkit_spinner" style="display:inline-block;"></span> Preparing to generate content...</p>'),c.disabled=!0,s.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),e.textContent="",e.className="aipkit_cw_status_badge";try{p.content_title=document.getElementById("aipkit_content_writer_title").value;let g=await window.aipkit_apiRequest("aipkit_content_writer_init_stream",p);if(!g.cache_key)throw new Error(g.message||"Failed to initialize stream.");if(document.getElementById("aipkit_content_writer_stream_cache_key").value=g.cache_key,g.conversation_uuid){window.aipkit_current_conversation_uuid=g.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",g.conversation_uuid)}catch{}}if(typeof window.aipkit_handleContentWriterEventSource=="function")window.aipkit_handleContentWriterEventSource(g.cache_key,o);else throw new Error("Stream orchestrator function (aipkit_handleContentWriterEventSource) not found.")}catch(g){console.error("Content Writer Init Stream Error:",g),e&&(e.textContent=a(g),e.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),window.aipkit_setLoadingStateOpenAI(i,!1,"Generate"),typeof window.aipkit_setContentWriterStopMode=="function"&&window.aipkit_setContentWriterStopMode(!1),t&&(t.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error initializing content generation.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Stream Init Failed")}}window.aipkit_handleGenerateContentSSE=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i},o=function(i){if(!i)return"Error";let e=i.message||"Error",t=i.details||i.data?.details,c=t?.provider,s=t?.model;return c||s?`${e} (${[c,s].filter(Boolean).join(" \xB7 ")})`:e};async function r(){let i=document.getElementById("aipkit_content_writer_form"),e=document.getElementById("aipkit_content_writer_generate_btn"),t=document.getElementById("aipkit_content_writer_stop_btn"),c=document.getElementById("aipkit_content_writer_form_status"),s=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_content_writer_copy_btn"),d=document.getElementById("aipkit_content_writer_clear_btn"),a=document.querySelector(".aipkit_content_writer_progress_bar_container"),l=a?a.querySelector(".aipkit_content_writer_progress_bar"):null,p=document.querySelector(".aipkit_content_writer_output_actions"),_=document.getElementById("aipkit_cw_status_display_container");if(!i||!e||!t||!c||!s||!n||!d){console.error("Handle AJAX: Missing UI elements.");return}if(typeof window.aipkit_setLoadingStateOpenAI!="function"||typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_getMarkdownRenderer!="function"){console.error("Handle AJAX: Missing core helper functions."),c.textContent="",c.className="aipkit_cw_status_badge";return}let f=new FormData(i),g=Object.fromEntries(f.entries()),m=i.elements["openai_vector_store_ids[]"];if(g.openai_vector_store_ids=m?Array.from(m.selectedOptions).map(y=>y.value):[],delete g["openai_vector_store_ids[]"],!g.conversation_uuid){let y=window.aipkit_current_conversation_uuid||function(){try{return sessionStorage.getItem("aipkit_current_conversation_uuid")}catch{return null}}();y&&(g.conversation_uuid=y)}if(!g.content_title){c.textContent="",c.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Missing title");return}let u=document.getElementById("aipkit_content_writer_nonce");if(u&&u.value)g._ajax_nonce=u.value;else{c.textContent="",c.className="aipkit_cw_status_badge",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","error","Token Missing");return}_&&(_.style.display="block");let h=document.getElementById("aipkit_cw_generate_meta_desc"),v=document.getElementById("aipkit_cw_generate_focus_keyword"),S=document.getElementById("aipkit_cw_generate_excerpt"),q=document.getElementById("aipkit_cw_generate_tags");typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","skipped"),window.aipkit_updateCwGenerationStatus("excerpt",S?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("tags",q?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("meta",h?.checked?"pending":"skipped"),window.aipkit_updateCwGenerationStatus("keyword",v?.checked?"pending":"skipped")),window.aipkit_setLoadingStateOpenAI(e,!0,"Generate","Generating..."),t.style.display="none",p&&(p.style.display="none"),s&&(s.innerHTML=""),n.disabled=!0,d.disabled=!0,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),c.textContent="Generating content, please wait...",c.className="aipkit_cw_status_badge aipkit_settings_message-info",typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","generating"),a&&l&&(a.style.display="block",l.style.width="0%",l.classList.add("aipkit_indeterminate"));try{let y=await window.aipkit_apiRequest("aipkit_content_writer_generate_standard",g);if(y.content){if(y.conversation_uuid){window.aipkit_current_conversation_uuid=y.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",y.conversation_uuid)}catch{}}let E=window.aipkit_getMarkdownRenderer();if(s&&(E?s.innerHTML=E.render(y.content):s.textContent=y.content,typeof window.aipkit_setContentWriterRawHtml=="function"&&window.aipkit_setContentWriterRawHtml(s.innerHTML)),typeof window.aipkit_updateContentWriterPreviewCounter=="function"&&window.aipkit_updateContentWriterPreviewCounter(),p&&(p.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","success"),n.disabled=!1,d.disabled=!1,typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!0),typeof window.aipkit_enableSaveAsPostButton=="function"&&window.aipkit_enableSaveAsPostButton(),y.content&&S?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","generating");try{let I=i.elements.enable_vector_store,w=I&&I.checked?"1":"0",A=i.elements.vector_store_provider?.value,C=i.elements["openai_vector_store_ids[]"],b=C?Array.from(C.selectedOptions).map(M=>M.value):[],x=i.elements.pinecone_index_name?.value,T=i.elements.qdrant_collection_name?.value,P=i.elements.vector_store_top_k?.value,H=i.elements.vector_store_confidence_threshold?.value,O={generated_content:y.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||g.content_title,provider:g.ai_provider,model:g.ai_model,prompt_mode:g.prompt_mode,custom_excerpt_prompt:g.custom_excerpt_prompt,enable_vector_store:w,vector_store_provider:A,openai_vector_store_ids:b,pinecone_index_name:x,qdrant_collection_name:T,vector_store_top_k:P,vector_store_confidence_threshold:H,vector_embedding_provider:i.elements.vector_embedding_provider?.value,vector_embedding_model:i.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:g._ajax_nonce},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_excerpt",O);if(F&&F.excerpt){let M=document.getElementById("aipkit_cw_generated_excerpt"),B=document.getElementById("aipkit_cw_excerpt_output_wrapper");M&&B&&(M.value=F.excerpt,B.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","success")}else throw new Error("Not returned")}catch(I){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("excerpt","error",I.message||"Not returned")}}if(y.content&&q?.checked){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","generating");try{let I=i.elements.enable_vector_store,w=I&&I.checked?"1":"0",A=i.elements.vector_store_provider?.value,C=i.elements["openai_vector_store_ids[]"],b=C?Array.from(C.selectedOptions).map(M=>M.value):[],x=i.elements.pinecone_index_name?.value,T=i.elements.qdrant_collection_name?.value,P=i.elements.vector_store_top_k?.value,H=i.elements.vector_store_confidence_threshold?.value,O={generated_content:y.content,final_title:document.getElementById("aipkit_cw_generated_title_display")?.textContent||g.content_title,provider:g.ai_provider,model:g.ai_model,prompt_mode:g.prompt_mode,custom_tags_prompt:g.custom_tags_prompt,enable_vector_store:w,vector_store_provider:A,openai_vector_store_ids:b,pinecone_index_name:x,qdrant_collection_name:T,vector_store_top_k:P,vector_store_confidence_threshold:H,vector_embedding_provider:i.elements.vector_embedding_provider?.value,vector_embedding_model:i.elements.vector_embedding_model?.value,conversation_uuid:window.aipkit_current_conversation_uuid||void 0,_ajax_nonce:g._ajax_nonce},F=await window.aipkit_apiRequest("aipkit_content_writer_generate_tags",O);if(F&&F.tags){let M=document.getElementById("aipkit_cw_generated_tags"),B=document.getElementById("aipkit_cw_tags_output_wrapper");M&&B&&(M.value=F.tags,B.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","success")}else throw new Error("Not returned")}catch(I){typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("tags","error",I.message||"Not returned")}}if(y.meta_description){let I=document.getElementById("aipkit_cw_generated_meta_desc"),w=document.getElementById("aipkit_cw_meta_desc_output_wrapper");I&&w&&(I.value=y.meta_description,w.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","success")}else h?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("meta","error","Not returned");if(y.focus_keyword){let I=document.getElementById("aipkit_cw_generated_focus_keyword"),w=document.getElementById("aipkit_cw_focus_keyword_output_wrapper");I&&w&&(I.value=y.focus_keyword,w.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","success")}else v?.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("keyword","error","Not returned")}else throw new Error(y.message||"No content received.")}catch(y){console.error("Content Writer AJAX Error:",y),c&&(c.textContent=o(y),c.className="aipkit_cw_status_badge aipkit_settings_message-error"),s&&(s.innerHTML='<p class="aipkit_text-secondary aipkit_text-center" style="padding: 20px 0;">Error generating content.</p>'),typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("content","error",y.message),S?.checked&&window.aipkit_updateCwGenerationStatus("excerpt","error","Not Generated"),q?.checked&&window.aipkit_updateCwGenerationStatus("tags","error","Not Generated"),h?.checked&&window.aipkit_updateCwGenerationStatus("meta","error","Not Generated"),v?.checked&&window.aipkit_updateCwGenerationStatus("keyword","error","Not Generated")),typeof window.aipkit_disableSaveAsPostButton=="function"&&window.aipkit_disableSaveAsPostButton(),p&&(p.style.display="none")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Generate"),a&&(a.style.display="none"),l&&l.classList.remove("aipkit_indeterminate")}}window.aipkit_handleGenerateContentAjax=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(r){return r};function o(r){let i=document.getElementById("aipkit_content_writer_generate_btn"),e=()=>{if(i){if(typeof window.aipkit_setButtonText=="function")window.aipkit_setButtonText(i,k("Stopping...","gpt3-ai-content-generator"));else{let c=i.querySelector(".aipkit_btn-text");c?c.textContent=k("Stopping...","gpt3-ai-content-generator"):i.textContent=k("Stopping...","gpt3-ai-content-generator")}i.disabled=!0,i.setAttribute("aria-disabled","true")}};if(typeof window.aipkit_cw_isBatchActive=="function"&&window.aipkit_cw_isBatchActive()){e(),typeof window.aipkit_cw_requestBatchStop=="function"&&window.aipkit_cw_requestBatchStop();return}if(typeof window.aipkit_cw_isExistingUpdateActive=="function"&&window.aipkit_cw_isExistingUpdateActive()){e(),typeof window.aipkit_cw_requestExistingUpdateStop=="function"&&window.aipkit_cw_requestExistingUpdateStop();return}if(!r||!r.current){typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}let t=document.getElementById("aipkit_content_writer_form_status");t&&(t.textContent=k("Stopping...","gpt3-ai-content-generator"),t.classList.remove("aipkit_settings_message-success","aipkit_settings_message-error","aipkit_settings_message-info"),t.classList.add("aipkit_settings_message-info")),e(),r.current.userStopped=!0,typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("content","skipped","Stopped"),typeof window.aipkit_stopContentWriterEventSource=="function"?window.aipkit_stopContentWriterEventSource(r):console.error("Handle Stop Generation: stopContentWriterEventSource function not found."),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons()}window.aipkit_handleStopGeneration=o})();(function(){"use strict";let k={rss:["{description}"],url:["{url_content}"]},o=new Set(["task","csv","gsheets"]),r="{topic}",i=l=>{if(!l)return"Error";let p=l.message||"Error",_=l.details||l.data?.details,f=_?.provider,g=_?.model;return f||g?`${p} (${[f,g].filter(Boolean).join(" \xB7 ")})`:p},e=(l,p)=>{let _=l.querySelector(p);return _?String(_.value||""):""},t=(l,p)=>p.filter(_=>!l.includes(_)),c=(l,p,_)=>{let f=[],g=l==="rss"?"RSS":"URL";return p.length&&f.push(`Title prompt: missing ${p.join(", ")}.`),_.length&&f.push(`Content prompt: missing ${_.join(", ")}.`),f.length?`${g} mode works best when your prompts include the source placeholders.

${f.join(`
`)}

Please update your prompts and try again.`:""},s=(l,p)=>{let _=k[p];if(!_)return{shouldWarn:!1,message:""};let f=e(l,"#aipkit_cw_custom_title_prompt").trim(),g=e(l,"#aipkit_cw_custom_content_prompt").trim(),m=f?t(f,_):[],u=g?t(g,_):_.slice(),h=c(p,m,u);return{shouldWarn:!!h,message:h}},n=(l,p)=>p.length?`${l} mode requires ${r} in your prompts.

${p.join(`
`)}

Please update your prompts and try again.`:"",d=(l,p)=>{if(!o.has(p))return{shouldWarn:!1,message:""};let f={task:"Manual entry",csv:"CSV",gsheets:"Google Sheets"}[p]||"This",g=[{selector:"#aipkit_cw_custom_title_prompt",label:"Title prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_content_prompt",label:"Content prompt",enabled:()=>!0},{selector:"#aipkit_cw_custom_meta_prompt",label:"Meta description prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_meta_desc")?.checked},{selector:"#aipkit_cw_custom_keyword_prompt",label:"Focus keyword prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_focus_keyword")?.checked},{selector:"#aipkit_cw_custom_excerpt_prompt",label:"Excerpt prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_excerpt")?.checked},{selector:"#aipkit_cw_custom_tags_prompt",label:"Tags prompt",enabled:()=>!!l.querySelector("#aipkit_cw_generate_tags")?.checked}],m=[];g.forEach(h=>{if(!h.enabled())return;let v=e(l,h.selector).trim();(v?t(v,[r]):[r]).length&&m.push(`${h.label}: missing ${r}.`)});let u=n(f,m);return{shouldWarn:!!u,message:u}};function a(l,p,_,f){l&&(l.dataset.listenerAttached||(l.addEventListener("click",async()=>{if(l.dataset.aipkitStopMode==="true"){typeof window.aipkit_handleStopGeneration=="function"&&window.aipkit_handleStopGeneration(f);return}try{delete window.aipkit_current_conversation_uuid,sessionStorage.removeItem("aipkit_current_conversation_uuid")}catch{}typeof window.aipkit_clearContentWriterImagePreview=="function"&&window.aipkit_clearContentWriterImagePreview();let g=document.getElementById("aipkit_cw_image_data_holder");if(g&&(g.value=""),typeof window.aipkit_resetContentWriterPreviewSize=="function"&&window.aipkit_resetContentWriterPreviewSize(),typeof window.aipkit_setContentWriterPreviewExpandEnabled=="function"&&window.aipkit_setContentWriterPreviewExpandEnabled(!1),l.dataset.action==="upgrade"){window.aipkit_dashboard&&window.aipkit_dashboard.upgradeUrl?window.open(window.aipkit_dashboard.upgradeUrl,"_blank"):typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Upgrade URL not found. Please visit our website.",{title:"Upgrade"}):alert("Upgrade URL not found. Please visit our website.");return}if(l.dataset.action==="fetch_feeds"){typeof window.aipkit_handleRssFetchFromGenerateButton=="function"?window.aipkit_handleRssFetchFromGenerateButton(l):console.error("Fetch Feeds: Handler function not found.");return}let m=document.getElementById("aipkit_content_writer_form_status"),u=document.getElementById("aipkit_cw_action_validation"),h=l.dataset.action||"generate",v=h==="generate_single"?"generate":h,S=document.getElementById("aipkit_cw_mode_select"),q=S?S.value:"task";if(q==="single"&&(q="task"),q==="existing"||q.indexOf("existing-")===0){if(typeof window.aipkit_runContentWriterExistingUpdate=="function")window.aipkit_runContentWriterExistingUpdate();else{let W="Update panel is not ready yet. Please refresh the page and try again.";typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(W,{title:"Update existing"}):alert(W)}return}let y=W=>String(W||"").split(/\r?\n/).map(ee=>ee.trim()).filter(Boolean),E=W=>{let ee=String(W||"").split("|").map(ne=>ne.trim());return{topic:ee[0]||"",keywords:ee[1]||"",category:ee[2]||"",authorLogin:ee[3]||"",type:ee[4]||"",schedule:ee[5]||""}},I=()=>{let W=Array.from(p.querySelectorAll("[data-aipkit-bulk-row]"));for(let ee of W){let ne=ee.querySelector('[data-bulk-field="topic"]'),z=ne?ne.value.trim():"";if(!z)continue;let ge=ee.querySelector('[data-bulk-field="keywords"]')?.value.trim()||"",Ae=ee.querySelector('[data-bulk-field="category"]')?.value.trim()||"",ot=ee.querySelector('[data-bulk-field="author"]'),ze=ot?ot.value.trim():"",Xe=ot?.selectedOptions?.[0]?.dataset?.userId||"",Ge=ee.querySelector('[data-bulk-field="type"]')?.value.trim()||"",It=ee.querySelector('[data-bulk-field="schedule"]')?.value.trim()||"";return{topic:z,keywords:ge,category:Ae,authorLogin:ze,authorId:Xe,type:Ge,schedule:It}}return null},w=W=>{if(!W||!W.topic)return;let ee=document.getElementById("aipkit_content_writer_title"),ne=W.keywords?`${W.topic} | ${W.keywords}`:W.topic;ee&&(ee.value=ne,ee.dispatchEvent(new Event("change",{bubbles:!0})));let z=p.elements.post_type;z&&W.type&&(z.value=W.type,z.dispatchEvent(new Event("change",{bubbles:!0})));let ge=p.elements["post_categories[]"];ge&&W.category&&(Array.from(ge.options).forEach(ot=>{ot.selected=ot.value===W.category}),ge.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect());let Ae=p.elements.post_author;if(Ae){let ot=W.authorId||"";if(!ot&&W.authorLogin){let ze=Array.from(Ae.options).find(Xe=>Xe.dataset.login===W.authorLogin||Xe.value===W.authorLogin);ze&&(ot=ze.value)}ot&&(Ae.value=ot,Ae.dispatchEvent(new Event("change",{bubbles:!0})))}};if(v!=="upgrade"){let W=typeof window.aipkit_validateContentWriterInputs=="function"?window.aipkit_validateContentWriterInputs(p,q):{isValid:!0};if(!W.isValid){typeof window.aipkit_showContentWriterValidationError=="function"?window.aipkit_showContentWriterValidationError(m||u,W.message):m&&(m.textContent=W.message||"",m.className="aipkit_cw_status_badge aipkit_settings_message-error");return}}if(typeof window.aipkit_clearContentWriterValidationMessage=="function"?(window.aipkit_clearContentWriterValidationMessage(m),window.aipkit_clearContentWriterValidationMessage(u)):u&&(u.textContent=""),v==="generate"||v==="create_task"){let{shouldWarn:W,message:ee}=s(p,q);if(W){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(ee,{title:"Update prompts",okText:"Review prompts"}):alert(ee);return}let ne=d(p,q);if(ne.shouldWarn){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(ne.message,{title:"Update prompts",okText:"Review prompts"}):alert(ne.message);return}}typeof window.aipkit_clearContentWriterOutput=="function"&&window.aipkit_clearContentWriterOutput();let A=document.getElementById("aipkit_cw_status_display_container"),C=document.getElementById("aipkit_cw_generated_title_display"),b=document.getElementById("aipkit_content_writer_title");if(v==="create_task"){A&&(A.style.display="block"),typeof window.aipkit_createContentWriterTask=="function"?window.aipkit_createContentWriterTask(p,l,m):(console.error("Generate Button Listener: aipkit_createContentWriterTask function not found."),m&&(m.textContent="",m.className="aipkit_cw_status_badge"));return}let x=p.elements.content_title_bulk,T=y(x?x.value:""),P=v==="generate"&&q==="task"&&T.length===1;if(P){let W=I()||E(T[0]);w(W),typeof window.aipkit_cw_resetBatchQueue=="function"&&window.aipkit_cw_resetBatchQueue()}if(v==="generate"&&!P){typeof window.aipkit_cw_handleBatchGeneration=="function"?window.aipkit_cw_handleBatchGeneration(p,q):console.error("Generate Button Listener: aipkit_cw_handleBatchGeneration function not found.");return}let H=document.getElementById("aipkit_cw_single_output_wrapper"),O=document.getElementById("aipkit_cw_output_card");H&&(H.style.display="block"),O&&(O.style.display="block"),A&&(A.style.display="block");let F=document.getElementById("aipkit_content_writer_stream_mode"),B=p.querySelector("#aipkit_cw_custom_title_prompt")?.value.trim()!=="";typeof window.aipkit_resetGenerationStatusIndicators=="function"&&window.aipkit_resetGenerationStatusIndicators(),_&&(_.style.display="flex");let V={meta:"aipkit_cw_generate_meta_desc",keyword:"aipkit_cw_generate_focus_keyword",excerpt:"aipkit_cw_generate_excerpt",tags:"aipkit_cw_generate_tags"};for(let[W,ee]of Object.entries(V)){let ne=document.getElementById(ee);ne&&!ne.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus(W,"skipped")}let L=document.getElementById("aipkit_cw_generate_images_enabled"),U=document.getElementById("aipkit_cw_generate_featured_image");if(L&&U&&!L.checked&&!U.checked&&typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("image","skipped"),B){typeof window.aipkit_updateCwGenerationStatus=="function"&&(window.aipkit_updateCwGenerationStatus("title","generating"),window.aipkit_updateCwGenerationStatus("content","pending"),C&&(C.style.display="none"));try{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(l,!0,"Generate","Generating...");let W=new FormData(p),ee=Object.fromEntries(W.entries()),ne=p.elements["openai_vector_store_ids[]"];ee.openai_vector_store_ids=ne?Array.from(ne.selectedOptions).map(Ae=>Ae.value):[],delete ee["openai_vector_store_ids[]"];let z=document.getElementById("aipkit_content_writer_nonce");ee._ajax_nonce=z?z.value:"",window.aipkit_current_conversation_uuid&&(ee.conversation_uuid=window.aipkit_current_conversation_uuid);let ge=await window.aipkit_apiRequest("aipkit_content_writer_generate_title",ee);if(ge&&ge.new_title){if(ge.conversation_uuid){window.aipkit_current_conversation_uuid=ge.conversation_uuid;try{sessionStorage.setItem("aipkit_current_conversation_uuid",ge.conversation_uuid)}catch{}}C&&(C.textContent=ge.new_title,C.style.display="block"),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","success")}else throw new Error(ge.message||"Failed to generate new title.")}catch(W){console.error("Title Generation Error:",W),typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","error",W.message),m&&(m.textContent=i(W),m.className="aipkit_cw_status_badge aipkit_settings_message-error"),typeof window.aipkit_resetContentWriterButtons=="function"&&window.aipkit_resetContentWriterButtons();return}}else typeof window.aipkit_updateCwGenerationStatus=="function"&&window.aipkit_updateCwGenerationStatus("title","skipped"),C&&b&&(C.textContent=b.value.split("|")[0].trim(),C.style.display="block");!F||F.checked?typeof window.aipkit_handleGenerateContentSSE=="function"&&window.aipkit_handleGenerateContentSSE(f):typeof window.aipkit_handleGenerateContentAjax=="function"&&window.aipkit_handleGenerateContentAjax()}),l.dataset.listenerAttached="true"))}window.aipkit_attachGenerateButtonListener=a})();(function(){"use strict";function k(o,r){o&&(o.dataset.listenerAttached||(o.addEventListener("click",()=>{typeof window.aipkit_handleStopGeneration=="function"?window.aipkit_handleStopGeneration(r):console.error("Stop Button Listener: aipkit_handleStopGeneration function not found.")}),o.dataset.listenerAttached="true"))}window.aipkit_attachStopButtonListener=k})();(function(){"use strict";function k(o,r){if(o===r)return!0;if(o==null||typeof o!="object"||r==null||typeof r!="object")return!1;let i=Object.keys(o),e=Object.keys(r);if(i.length!==e.length)return!1;for(let t of i)if(!e.includes(t)||!k(o[t],r[t]))return!1;return!0}window.aipkit_deepEqual=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_provider"),r=document.getElementById("aipkit_content_writer_temperature"),i=document.getElementById("aipkit_content_writer_post_author"),e=i?i.value:window.aipkit_dashboard?.currentUserId||"1",c=(o&&o.options.length>0?o.options[0].value:(window.aipkit_dashboard?.models?.openai,"OpenAI")).toLowerCase(),s=o?o.value.toLowerCase():c,n="",d=window.aipkit_dashboard?.models?.[s];switch(s){case"openai":n="gpt-4.1-mini";break;case"google":n="gemini-2.5-flash";break;case"openrouter":n="moonshotai/kimi-k2.5";break;case"claude":n="claude-opus-4-6",Array.isArray(d)&&d.length>0&&(d.some(_=>_&&_.id==="claude-opus-4-6")||(n=d[0].id||""));break;case"azure":case"deepseek":case"ollama":Array.isArray(d)&&d.length>0?n=d[0].id||"":n="";break;default:n=""}let a=r&&r.defaultValue||"1.0",l=window.aipkit_content_writer_config?.default_prompts||{};return{ai_provider:s,ai_model:n,content_title:"",content_title_bulk:"",content_keywords:"",ai_temperature:a,reasoning_effort:"medium",post_type:"post",post_author:e,post_status:"draft",post_schedule_date:"",post_schedule_time:"",post_categories:[],prompt_mode:"custom",custom_title_prompt:l.title,custom_content_prompt:l.content,generate_title:"1",generate_content:"1",generate_meta_description:"1",custom_meta_prompt:l.meta,generate_focus_keyword:"1",custom_keyword_prompt:l.keyword,generate_excerpt:"1",custom_excerpt_prompt:l.excerpt,generate_tags:"1",custom_tags_prompt:l.tags,custom_title_prompt_update:"",custom_content_prompt_update:"",custom_meta_prompt_update:"",custom_keyword_prompt_update:"",custom_excerpt_prompt_update:"",custom_tags_prompt_update:"",cw_generation_mode:"task",rss_feeds:"",gsheets_sheet_id:"",gsheets_credentials:"",url_list:"",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",image_provider:"openai",image_model:"dall-e-3",image_prompt:l.image||"A high-quality, relevant image for an article about: {topic}",image_prompt_update:"",image_count:"1",image_placement:"after_first_h2",image_placement_param_x:"2",image_alignment:"none",image_size:"large",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",image_title_prompt:l.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt:l.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt:l.image_caption||"Write a short image caption based on: {topic}",image_description_prompt:l.image_description||"Write a brief image description based on: {topic}",image_title_prompt_update:l.image_title_update||l.image_title||"Write a concise image title based on: {topic}",image_alt_text_prompt_update:l.image_alt_text_update||l.image_alt_text||"Write clear alt text for the image based on: {topic}",image_caption_prompt_update:l.image_caption_update||l.image_caption||"Write a short image caption based on: {topic}",image_description_prompt_update:l.image_description_update||l.image_description||"Write a brief image description based on: {topic}",generate_featured_image:"0",featured_image_prompt:l.featured_image||"An eye-catching, high-quality featured image for a blog post about: {topic}. Keywords: {keywords}.",featured_image_prompt_update:"",pexels_orientation:"none",pexels_size:"none",pexels_color:"",pixabay_orientation:"all",pixabay_image_type:"all",pixabay_category:"",enable_vector_store:"0",vector_store_provider:"openai",openai_vector_store_ids:[],pinecone_index_name:"",qdrant_collection_name:"",vector_embedding_provider:"openai",vector_embedding_model:"text-embedding-3-small",vector_store_top_k:"3",vector_store_confidence_threshold:"20",rss_include_keywords:"",rss_exclude_keywords:""}}window.aipkit_getDefaultContentWriterTemplateConfig=k})();(function(){"use strict";function k(o){let r={};if(!o)return r;["ai_provider","ai_model","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","prompt_mode","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","custom_title_prompt_update","custom_content_prompt_update","custom_meta_prompt_update","custom_keyword_prompt_update","custom_excerpt_prompt_update","custom_tags_prompt_update","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_model","image_prompt","image_prompt_update","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","image_title_prompt_update","image_alt_text_prompt_update","image_caption_prompt_update","image_description_prompt_update","featured_image_prompt","featured_image_prompt_update","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_embedding_model","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(y=>{o.elements[y]&&(r[y]=o.elements[y].value)});let e=o.elements.generate_meta_description;e?r.generate_meta_description=e.checked?"1":"0":r.generate_meta_description="0";let t=o.elements.generate_focus_keyword;t?r.generate_focus_keyword=t.checked?"1":"0":r.generate_focus_keyword="0";let c=o.elements.generate_excerpt;c?r.generate_excerpt=c.checked?"1":"0":r.generate_excerpt="0";let s=o.elements.generate_tags;s?r.generate_tags=s.checked?"1":"0":r.generate_tags="0";let n=o.elements.generate_title;n?r.generate_title=n.checked?"1":"0":r.generate_title="1";let d=o.elements.generate_content;d?r.generate_content=d.checked?"1":"0":r.generate_content="1";let a=o.elements.generate_toc;a?r.generate_toc=a.checked?"1":"0":r.generate_toc="0";let l=o.elements.generate_seo_slug;l?r.generate_seo_slug=l.checked?"1":"0":r.generate_seo_slug="0";let p=o.elements.generate_images_enabled;p?r.generate_images_enabled=p.checked?"1":"0":r.generate_images_enabled="0";let _=o.elements.generate_featured_image;_?r.generate_featured_image=_.checked?"1":"0":r.generate_featured_image="0",["generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(y=>{let E=o.elements[y];E?r[y]=E.checked?"1":"0":r[y]="1"});let f=o.elements.enable_vector_store;f?r.enable_vector_store=f.checked?"1":"0":r.enable_vector_store="0";let g=o.elements["openai_vector_store_ids[]"];g?r.openai_vector_store_ids=Array.from(g.selectedOptions).map(y=>y.value):r.openai_vector_store_ids=[];let m=o.querySelector("#aipkit_cw_prompt_mode_hidden_input");m?r.prompt_mode=m.value:r.prompt_mode="custom";let u=o.querySelector("#aipkit_cw_mode_select"),h=u?u.value:"task";r.cw_generation_mode=h==="single"?"task":h;let v=o.elements["post_categories[]"];v?r.post_categories=Array.from(v.selectedOptions).map(y=>y.value):r.post_categories=[];let S=["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt"],q=typeof window.aipkit_getContentWriterPromptSets=="function"?window.aipkit_getContentWriterPromptSets():null;return q&&q.create&&S.forEach(y=>{Object.prototype.hasOwnProperty.call(q.create,y)&&(r[y]=q.create[y])}),q&&q.update&&S.forEach(y=>{let E=`${y}_update`;Object.prototype.hasOwnProperty.call(q.update,y)&&(r[E]=q.update[y])}),r}window.aipkit_getContentWriterFormConfig=k})();(function(){"use strict";function k(o){if(!o||!o.value)return!1;let r=o.value,i=window.aipkit_cw_template_state.currentTemplates.find(e=>String(e.id)===String(r));return i&&String(i.is_default)==="1"}window.aipkit_isDefaultTemplateSelected=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_post_status"),r=document.getElementById("aipkit_cw_schedule_options_wrapper"),i=document.getElementById("aipkit_cw_smart_schedule_fields"),e=document.querySelector(".aipkit_schedule_from_input_help"),t=document.querySelector(".aipkit_schedule_from_input_option");if(!o||!r)return;let c=o.value==="publish";r.style.display=c?"block":"none";let s=document.getElementById("aipkit_cw_mode_select"),n=s?s.value:"task",d=new Set(["task","csv","gsheets"]),a=d.has(n);if(t){t.style.display=a?"inline-flex":"none";let _=t.querySelector('input[name="schedule_mode"]');if(!a&&_&&_.checked){let f=document.querySelector('input[name="schedule_mode"][value="immediate"]');f&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))}}document.querySelectorAll('input[name="schedule_mode"]').forEach(_=>{_.dataset.listenerAttached||(_.addEventListener("change",function(){let f=document.getElementById("aipkit_cw_mode_select"),g=f?f.value:"task",m=d.has(g);i&&(i.style.display=this.value==="smart"?"block":"none"),e&&(e.style.display=this.value==="from_input"&&m?"block":"none")}),_.dataset.listenerAttached="true")});let p=document.querySelector('input[name="schedule_mode"]:checked');p&&i&&(i.style.display=p.value==="smart"?"block":"none"),p&&e&&(e.style.display=p.value==="from_input"&&a?"block":"none")}window.aipkit_toggleContentWriterScheduleFields=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(t){return t},o={image_title_prompt:"aipkit_cw_image_title_prompt",image_alt_text_prompt:"aipkit_cw_image_alt_text_prompt",image_caption_prompt:"aipkit_cw_image_caption_prompt",image_description_prompt:"aipkit_cw_image_description_prompt"};function r(t){if(!t)return"";let c=document.querySelector(`.aipkit_cw_prompt_library_select[data-aipkit-prompt-target="${CSS.escape(t)}"]`);if(!c)return"";let s=c.querySelector("option");return s?s.value:""}function i(){let t=document.getElementById("aipkit_cw_single_output_wrapper"),c=document.getElementById("aipkit_cw_generated_title_display"),s=document.getElementById("aipkit_cw_generated_content_area"),n=document.getElementById("aipkit_cw_meta_chunk"),d=document.getElementById("aipkit_cw_meta_desc_output_wrapper"),a=document.querySelector(".aipkit_content_writer_output_actions");t&&(t.style.display="none"),c&&(c.style.display="none",c.textContent=""),s&&(s.innerHTML=""),n&&(n.style.display="none"),d&&(d.style.display="none"),a&&(a.style.display="none"),typeof window.aipkit_hidePrimaryAction=="function"&&window.aipkit_hidePrimaryAction()}function e(t,c=!1){let s=window.aipkit_cw_autosave_suspended===!0;window.aipkit_cw_autosave_suspended=!0;try{let n=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,d=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.currentTemplateId=t,t?sessionStorage.setItem("aipkit_cw_last_template_id",t):sessionStorage.removeItem("aipkit_cw_last_template_id");let a=window.aipkit_cw_template_state.currentTemplates.find(f=>String(f.id)===String(t)),l;if(a)l=JSON.parse(JSON.stringify(a.config));else{if(typeof window.aipkit_getDefaultContentWriterTemplateConfig!="function"){console.error("Apply Template: getDefaultContentWriterTemplateConfig function is missing."),d&&!c&&d("Error: Cannot load default template.");return}l=window.aipkit_getDefaultContentWriterTemplateConfig()}let p=l&&l.template_scope==="prompts_only";p||(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(l)),window.aipkit_cw_template_state.currentTemplateModified=!1),i();let _=document.getElementById("aipkit_content_writer_form");if(!_){console.error("Apply Template: Content writer form not found.");return}if(!p&&l.ai_model&&_.elements.ai_model?window.aipkit_cw_template_state.pendingModelSelection=l.ai_model:window.aipkit_cw_template_state.pendingModelSelection=null,l.image_model&&_.elements.image_model?window.aipkit_cw_template_state.pendingImageModelSelection=l.image_model:window.aipkit_cw_template_state.pendingImageModelSelection=null,p){let f=document.getElementById("aipkit_cw_prompt_mode_hidden_input");f&&(f.value=l.prompt_mode||"custom"),["custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","image_prompt","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt"].forEach(y=>{let E=Object.prototype.hasOwnProperty.call(l,y),I=_.elements[y];if(!I)return;let w=l[y]===null||typeof l[y]>"u"?"":l[y],A=!!o[y],C=typeof w=="string"?w.trim()==="":w==="";if((!E||C)&&A){I.value=r(o[y]);return}E&&(I.value=w)}),["generate_images_enabled","generate_featured_image","generate_image_title","generate_image_alt_text","generate_image_caption","generate_image_description"].forEach(y=>{if(!Object.prototype.hasOwnProperty.call(l,y))return;let E=_.elements[y];if(!E)return;let I=l[y];E.checked=I==="1"||I===1||I===!0}),["generate_title","generate_content","generate_meta_description","generate_focus_keyword","generate_excerpt","generate_tags"].forEach(y=>{if(!Object.prototype.hasOwnProperty.call(l,y))return;let E=_.elements[y];if(!E)return;let I=l[y];E.checked=I==="1"||I===1||I===!0});let h=_.elements.content_length;h&&Object.prototype.hasOwnProperty.call(l,"content_length")&&(h.value=l.content_length||"medium",h.dispatchEvent(new Event("change",{bubbles:!0})));let v=_.elements.image_provider;v&&Object.prototype.hasOwnProperty.call(l,"image_provider")&&(v.value=l.image_provider||"",v.dispatchEvent(new Event("change",{bubbles:!0}))),["image_count","image_size","image_alignment","image_placement"].forEach(y=>{if(!Object.prototype.hasOwnProperty.call(l,y))return;let E=_.elements[y];if(!E)return;let I=l[y]===null||typeof l[y]>"u"?"":l[y];E.type==="checkbox"?E.checked=I==="1"||I===1||I===!0:E.value=I});let q=_.elements.image_model;if(q&&Object.prototype.hasOwnProperty.call(l,"image_model")){let y=l.image_model||"";y&&q.querySelector(`option[value="${CSS.escape(y)}"]`)&&(q.value=y)}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI()}else{["ai_provider","content_title","content_keywords","ai_temperature","content_length","reasoning_effort","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","custom_title_prompt","custom_content_prompt","custom_meta_prompt","custom_keyword_prompt","custom_excerpt_prompt","custom_tags_prompt","rss_feeds","gsheets_sheet_id","gsheets_credentials","url_list","image_provider","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","featured_image_prompt","image_title_prompt","image_alt_text_prompt","image_caption_prompt","image_description_prompt","generate_featured_image","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","vector_store_provider","pinecone_index_name","qdrant_collection_name","vector_embedding_provider","vector_store_top_k","vector_store_confidence_threshold","rss_include_keywords","rss_exclude_keywords"].forEach(A=>{let C=_.elements[A];if(C){let b=Object.prototype.hasOwnProperty.call(l,A),x=l[A]===null||typeof l[A]>"u"?"":l[A],T=!!o[A],P=typeof x=="string"?x.trim()==="":x==="";if((!b||P)&&T){C.value=r(o[A]);return}if(A==="gsheets_credentials"&&typeof x=="object"&&x!==null)C.value=JSON.stringify(x,null,2);else if((A==="ai_temperature"||A==="vector_store_top_k"||A==="vector_store_confidence_threshold")&&C.type==="range"){C.value=x||(A==="ai_temperature"?"1.0":A==="vector_store_top_k"?"3":A==="vector_store_confidence_threshold"?"20":"");let H=document.getElementById(C.id+"_value");H&&(H.textContent=A==="vector_store_confidence_threshold"?C.value+"%":C.value)}else C.type==="checkbox"?C.checked=x==="1":C.value=x;A==="post_status"&&typeof window.aipkit_toggleContentWriterScheduleFields=="function"&&window.aipkit_toggleContentWriterScheduleFields(),A==="content_length"&&C.dispatchEvent(new Event("change",{bubbles:!0}))}});let g=_.elements.gsheets_credentials;if(g){let A=l.gsheets_credentials,C=g.closest(".aipkit_gsheets_section_container");g.value=typeof A=="object"&&A!==null?JSON.stringify(A,null,2):A||"",g.value?(g.dataset.filename="credentials.json",C&&typeof window.aipkit_verifyGSheetsCredentials=="function"&&setTimeout(()=>window.aipkit_verifyGSheetsCredentials(C),100)):(delete g.dataset.filename,C&&typeof window.aipkit_setGsheetsIndicator=="function"&&window.aipkit_setGsheetsIndicator(C,"clear"))}let m={generate_meta_description:"1",generate_focus_keyword:"1",generate_excerpt:"0",generate_tags:"0",generate_toc:"0",generate_seo_slug:"0",generate_images_enabled:"0",generate_featured_image:"0",generate_image_title:"1",generate_image_alt_text:"1",generate_image_caption:"1",generate_image_description:"1",enable_vector_store:"0"};for(let[A,C]of Object.entries(m)){let b=_.elements[A];if(b){let x=Object.prototype.hasOwnProperty.call(l,A)?l[A]:C;b.checked=x==="1"||x===1||x===!0}}let u=document.getElementById("aipkit_cw_prompt_mode_hidden_input");u&&(u.value=l.prompt_mode||"custom");let h=_.querySelector("#aipkit_cw_mode_select"),v=l.cw_generation_mode||"task",S=v==="single"?"task":v;h&&(h.value=S,h.dispatchEvent(new Event("change",{bubbles:!0})));let q=_.elements["post_categories[]"];if(q){let A=Array.isArray(l.post_categories)?l.post_categories.map(C=>String(C)):[];Array.from(q.options).forEach(C=>{C.selected=A.includes(C.value)}),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"&&window.aipkit_initContentWriterCategoriesMultiSelect()}let y=_.elements["openai_vector_store_ids[]"];if(y){let A=Array.isArray(l.openai_vector_store_ids)?l.openai_vector_store_ids.map(String):[];Array.from(y.options).forEach(C=>{C.selected=A.includes(C.value)}),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"&&window.aipkit_initContentWriterVectorStoreMultiSelect()}typeof window.aipkit_updateImageSettingsUI=="function"&&window.aipkit_updateImageSettingsUI();let E=_.elements.enable_vector_store;E&&typeof window.aipkit_cw_toggleVectorSettingsContainer=="function"&&window.aipkit_cw_toggleVectorSettingsContainer(E.closest(".aipkit_popover_options_list")||E.closest(".aipkit_cw_settings_popover_body")||document.getElementById("aipkit_content_writer_container"));let I=_.elements.vector_store_provider;I&&typeof window.aipkit_cw_toggleProviderSpecificFields=="function"&&(I.value=l.vector_store_provider||"openai",I.dispatchEvent(new Event("change",{bubbles:!0})));let w=_.elements.ai_provider;if(w){let A=w.value,C=(window.aipkit_dashboard?.models?.openai,"OpenAI").toLowerCase(),b=(l.ai_provider||C).toLowerCase();if(A!==b)w.value=b,w.dispatchEvent(new Event("change",{bubbles:!0}));else{let x=_.elements.ai_model;x&&typeof window.aipkit_populateModelsForContentWriter=="function"?window.aipkit_populateModelsForContentWriter(w,x):typeof window.aipkit_checkFormForModifications=="function"&&window.aipkit_checkFormForModifications()}w.getAttribute("data-aipkit-provider-notice-defer")==="1"&&(t?w.dataset.aipkitProviderNoticeArmed="true":delete w.dataset.aipkitProviderNoticeArmed,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(_))}}if(typeof window.aipkit_cw_toggleCustomOptionPrompts=="function"&&window.aipkit_cw_toggleCustomOptionPrompts(),typeof window.aipkit_applyContentWriterPromptSets=="function"&&window.aipkit_applyContentWriterPromptSets(l),p&&(typeof window.aipkit_getContentWriterFormConfig=="function"&&(window.aipkit_cw_template_state.initialConfigForSelectedTemplate=window.aipkit_getContentWriterFormConfig(_)),window.aipkit_cw_template_state.currentTemplateModified=!1),!c&&n&&n("Updated"),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(t),typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(t),typeof window.aipkit_cw_toggleReasoningEffort=="function"){let f=document.getElementById("aipkit_content_writer_container");f&&window.aipkit_cw_toggleReasoningEffort(f)}typeof window.aipkit_updateContentWriterSettingsSummary=="function"&&window.aipkit_updateContentWriterSettingsSummary(),typeof window.aipkit_refreshContentWriterSelectPickers=="function"&&window.aipkit_refreshContentWriterSelectPickers(),typeof window.aipkit_refreshUrlCounter=="function"&&window.aipkit_refreshUrlCounter(),typeof window.aipkit_refreshRssCounter=="function"&&window.aipkit_refreshRssCounter()}finally{s||(window.aipkit_cw_autosave_suspended=!1),typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline()}}window.aipkit_applyContentWriterTemplate=e})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};async function o(r){if(!r){console.error("Fetch & Populate Templates: Select element is missing.");return}let i=document.getElementById("aipkit_content_writer_template_nonce_field"),e=typeof window.aipkit_clearGeneralStatus=="function"?window.aipkit_clearGeneralStatus:null,t=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;r.innerHTML=`<option value="">${k("Loading templates...")}</option>`,r.disabled=!0,e&&e();try{let c=await window.aipkit_apiRequest("aipkit_list_cw_templates",{_ajax_nonce:i?i.value:""});window.aipkit_cw_template_state.currentTemplates=c.templates||[],r.innerHTML="";let s=new Option(k("-- Select Template --"),"");r.appendChild(s);let n=window.aipkit_cw_template_state.currentTemplates||[],d=window.aipkit_dashboard?.currentUserId?.toString(),a=null,l=[],p=[],_={};n.forEach(u=>{if(String(u.is_default)==="1"&&u.user_id.toString()===d&&(a=u.id),u.user_id.toString()===d)String(u.is_starter)==="1"||u.is_starter===!0?l.push(u):p.push(u);else{let h=u.display_name||`User ID: ${u.user_id}`;_[h]||(_[h]=[]),_[h].push(u)}});let f=u=>{if(u&&u.starter_order!==void 0&&u.starter_order!==null&&u.starter_order!==""){let q=Number(u.starter_order);if(Number.isFinite(q))return q}let v=(u&&u.template_name?String(u.template_name):"").match(/(\d[\d,]*)/);if(!v)return null;let S=parseInt(v[1].replace(/,/g,""),10);return Number.isFinite(S)?S:null};if(p.sort((u,h)=>u.is_default==="1"?-1:h.is_default==="1"?1:u.template_name.localeCompare(h.template_name)),l.sort((u,h)=>{let v=f(u),S=f(h);return v!==null&&S!==null?v-S:v!==null?-1:S!==null?1:u.template_name.localeCompare(h.template_name)}),l.length>0){let u=document.createElement("optgroup");u.label=k("Starter Templates"),l.forEach(h=>{u.appendChild(new Option(k(h.template_name),h.id))}),r.appendChild(u)}if(p.length>0){let u=document.createElement("optgroup");u.label=k("My Templates"),p.forEach(h=>{u.appendChild(new Option(k(h.template_name),h.id))}),r.appendChild(u)}Object.keys(_).sort().forEach(u=>{let h=document.createElement("optgroup");h.label=k(u),_[u].forEach(v=>{h.appendChild(new Option(k(v.template_name),v.id))}),r.appendChild(h)}),r.disabled=!1;let m=sessionStorage.getItem("aipkit_cw_last_template_id");m&&r.querySelector(`option[value="${CSS.escape(m)}"]`)?(r.value=m,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(m,!0)):a?(r.value=a,typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate(a,!0)):typeof window.aipkit_applyContentWriterTemplate=="function"&&window.aipkit_applyContentWriterTemplate("",!0),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}catch(c){console.error("Error fetching templates:",c),r.innerHTML=`<option value="">${k("Error loading templates")}</option>`,t&&t(`Error: ${c.message||"Failed to load templates."}`),typeof window.aipkit_renderTemplatePicker=="function"&&window.aipkit_renderTemplatePicker(r)}}window.aipkit_fetchAndPopulateTemplates=o})();(function(){"use strict";async function k(o,r,i){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;window.aipkit_cw_template_state.isSavingOrDeleting=!0;let e=document.getElementById("aipkit_content_writer_template_nonce_field"),t=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,c=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,s=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;t&&t("Updating...");try{let n=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:o,template_name:r,config:JSON.stringify(i),_ajax_nonce:e?e.value:""});c&&c("Updated"),window.aipkit_cw_template_state.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(n.template_config||i)),window.aipkit_cw_template_state.currentTemplateModified=!1,typeof window.aipkit_updateContentWriterAutosaveBaseline=="function"&&window.aipkit_updateContentWriterAutosaveBaseline();let d=document.getElementById("aipkit_cw_template_select"),a=n.template_id?String(n.template_id):"";a&&(window.aipkit_cw_template_state.currentTemplateId=a,sessionStorage.setItem("aipkit_cw_last_template_id",a)),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&d&&(await window.aipkit_fetchAndPopulateTemplates(d),a&&(d.value=a,typeof window.aipkit_updateTemplatePickerSelection=="function"&&window.aipkit_updateTemplatePickerSelection(a))),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(a||window.aipkit_cw_template_state.currentTemplateId)}catch(n){console.error("Error saving template:",n),s&&s(`Error: ${n.message||"Failed to save template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}window.aipkit_saveContentWriterTemplate=k})();(function(){"use strict";function k(o){let r=document.getElementById("aipkit_cw_rename_template_btn"),i=document.getElementById("aipkit_cw_delete_template_btn"),e=window.aipkit_dashboard||{},t=e.isAdmin||!1,c=e.currentUserId?String(e.currentUserId):"0",s=window.aipkit_cw_template_state.currentTemplates.find(l=>String(l.id)===String(o));if(!s){r&&(r.disabled=!0),i&&(i.disabled=!0);return}let n=String(s.user_id)===c,d=n||t,a=n||t;r&&(r.disabled=!d),i&&(i.disabled=!a)}window.aipkit_updateTemplateActionButtonsState=k})();(function(){"use strict";function k(){if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_deepEqual!="function"||!window.aipkit_cw_template_state){console.error("checkFormForModifications: Missing required dependencies (getFormConfig, deepEqual, or state object).");return}let o=document.getElementById("aipkit_content_writer_form");if(!o)return;let r=window.aipkit_getContentWriterFormConfig(o),i=window.aipkit_cw_template_state.initialConfigForSelectedTemplate;window.aipkit_cw_template_state.currentTemplateModified=!window.aipkit_deepEqual(r,i),typeof window.aipkit_updateTemplateActionButtonsState=="function"&&window.aipkit_updateTemplateActionButtonsState(window.aipkit_cw_template_state.currentTemplateId)}window.aipkit_checkFormForModifications=k})();(function(){"use strict";function k(){if(!window.aipkit_cw_template_state.isSavingOrDeleting){if(typeof window.aipkit_showTemplateNameForm!="function"){console.error("Save As Template: aipkit_showTemplateNameForm function not found."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("new")}}window.aipkit_handleSaveAsContentWriterTemplate=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),i=r.value,e=r.options[r.selectedIndex],t=e?e.text:"";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateNameForm!="function"){console.error("Rename Template: aipkit_isDefaultTemplateSelected or aipkit_showTemplateNameForm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("An error occurred. Please refresh the page.",{title:"Template"}):alert("An error occurred. Please refresh the page."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(e)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot rename the default template or no template is selected.",{title:"Template"}):alert("Cannot rename the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateNameForm("rename",t)}window.aipkit_handleRenameContentWriterTemplate=o})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(r){return r};function o(){if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let r=document.getElementById("aipkit_cw_template_select"),i=r.value,e=r.options[r.selectedIndex],t=e?e.text:"this template";if(typeof window.aipkit_isDefaultTemplateSelected!="function"||typeof window.aipkit_showTemplateDeleteConfirm!="function"){console.error("Delete Template: isDefaultTemplateSelected or showTemplateDeleteConfirm function missing."),typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete: core function missing.",{title:"Template"}):alert("Cannot delete: core function missing."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}if(!i||i===""||window.aipkit_isDefaultTemplateSelected(e)){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Cannot delete the default template or no template is selected.",{title:"Template"}):alert("Cannot delete the default template or no template is selected."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover();return}window.aipkit_showTemplateDeleteConfirm(t)}window.aipkit_handleDeleteContentWriterTemplate=o})();(function(){"use strict";let k=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,o=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,r=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;async function i(){if(!window.aipkit_cw_template_state||window.aipkit_cw_template_state.isSavingOrDeleting)return;let t=document.getElementById("aipkit_content_writer_template_nonce_field"),c=document.getElementById("aipkit_cw_template_select");window.aipkit_cw_template_state.isSavingOrDeleting=!0,k&&k("Resetting starter templates...");try{await window.aipkit_apiRequest("aipkit_reset_cw_starter_templates",{_ajax_nonce:t?t.value:""}),sessionStorage.removeItem("aipkit_cw_last_template_id"),c&&typeof window.aipkit_fetchAndPopulateTemplates=="function"&&await window.aipkit_fetchAndPopulateTemplates(c),o&&o("Starter templates reset."),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover()}catch(s){console.error("Error resetting starter templates:",s),r&&r(`Error: ${s.message||"Failed to reset starter templates."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1}}function e(){let t="Reset starter templates to their original defaults?",c="Starter Templates";if(typeof window.aipkit_showConfirmModal=="function"){window.aipkit_showConfirmModal(t,{title:c,confirmText:"Reset",cancelText:"Cancel",onConfirm:i});return}window.confirm(t)&&i()}window.aipkit_handleResetStarterTemplates=e})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(_){return _},o={short:"Quick reads, ideal for news or updates",medium:"Standard blog posts with good depth",long:"In-depth guides and pillar content"};function r(_){let f=_.toLowerCase();return f.includes("short")?o.short:f.includes("medium")?o.medium:f.includes("long")?o.long:/\b600\b/.test(f)?o.short:/\b1200\b/.test(f)?o.medium:/\b2000\b/.test(f)?o.long:""}function i(_,f){if(f){let g=_.template_name.toLowerCase();return g.includes("short")?"dashicons-text-page":g.includes("medium")?"dashicons-text":g.includes("long")?"dashicons-media-document":"dashicons-star-filled"}return _.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function e(){return{select:document.getElementById("aipkit_cw_template_select"),button:document.getElementById("aipkit_cw_template_picker_btn"),label:document.getElementById("aipkit_cw_template_picker_label"),list:document.getElementById("aipkit_cw_template_picker_list"),search:document.getElementById("aipkit_cw_template_picker_search"),searchClear:document.getElementById("aipkit_cw_template_picker_search_clear")}}function t(_,f){let g=[],m=[],u={};_.forEach(S=>{if(S.user_id.toString()===f)String(S.is_starter)==="1"||S.is_starter===!0?g.push(S):m.push(S);else{let q=S.display_name||`User ID: ${S.user_id}`;u[q]||(u[q]=[]),u[q].push(S)}});let h=S=>{if(S&&S.starter_order!==void 0&&S.starter_order!==null&&S.starter_order!==""){let I=Number(S.starter_order);if(Number.isFinite(I))return I}let y=(S&&S.template_name?String(S.template_name):"").match(/(\d[\d,]*)/);if(!y)return null;let E=parseInt(y[1].replace(/,/g,""),10);return Number.isFinite(E)?E:null};g.sort((S,q)=>{let y=h(S),E=h(q);return y!==null&&E!==null?y-E:y!==null?-1:E!==null?1:S.template_name.localeCompare(q.template_name)}),m.sort((S,q)=>S.is_default==="1"?-1:q.is_default==="1"?1:S.template_name.localeCompare(q.template_name));let v={};return Object.keys(u).sort().forEach(S=>{v[S]=u[S].sort((q,y)=>q.template_name.localeCompare(y.template_name))}),{starterTemplates:g,myTemplates:m,otherUsersTemplates:v}}function c(_){let{label:f,button:g}=e();if(!f||!g||!_)return;let m=_.options[_.selectedIndex],u=m?m.text:k("Select template");f.textContent=u||k("Select template")}function s(_,f){if(!_)return;let g=String(f||"");_.querySelectorAll(".aipkit_cw_template_list_item").forEach(m=>{let h=(m.dataset.templateId||"")===g;m.classList.toggle("is-active",h),m.setAttribute("aria-selected",h?"true":"false")})}function n(_,f=""){let{list:g}=e();if(!g||!_)return;let m=window.aipkit_cw_template_state?.currentTemplates||[],u=window.aipkit_dashboard?.currentUserId?.toString();if(g.innerHTML="",!m.length){let w=_.disabled&&_.options.length&&_.options[0].text.toLowerCase().includes("loading"),A=document.createElement("div");A.className="aipkit_cw_template_picker_empty",A.textContent=k(w?"Loading templates...":"No templates found."),g.appendChild(A),c(_);return}let h=t(m,u),v=document.createDocumentFragment(),S=f.toLowerCase().trim(),q=(w,A)=>{let C=document.createElement("div");if(C.className="aipkit_cw_template_group_label",A){let x=document.createElement("span");x.className=`dashicons ${A}`,x.setAttribute("aria-hidden","true"),C.appendChild(x)}let b=document.createElement("span");return b.textContent=k(w),C.appendChild(b),C},y=(w,A)=>{let C=document.createElement("button");C.type="button",C.className="aipkit_cw_template_list_item",A&&C.classList.add("is-starter"),w.is_default==="1"&&C.classList.add("is-default"),C.dataset.templateId=String(w.id),C.dataset.templateLabel=w.template_name.toLowerCase(),C.setAttribute("role","option"),C.setAttribute("aria-selected","false");let b=i(w,A),x=document.createElement("span");x.className=`aipkit_cw_template_list_icon dashicons ${b}`,x.setAttribute("aria-hidden","true");let T=document.createElement("span");T.className="aipkit_cw_template_list_content";let P=document.createElement("span");if(P.className="aipkit_cw_template_list_name",P.textContent=k(w.template_name),T.appendChild(P),A){let O=r(w.template_name);if(O){let F=document.createElement("span");F.className="aipkit_cw_template_list_desc",F.textContent=k(O),T.appendChild(F)}}let H=document.createElement("span");return H.className="aipkit_cw_template_list_check dashicons dashicons-yes",H.setAttribute("aria-hidden","true"),C.appendChild(x),C.appendChild(T),C.appendChild(H),C},E=(w,A,C,b=!1)=>{let x=S?A.filter(P=>P.template_name.toLowerCase().includes(S)):A;if(!x.length)return 0;let T=document.createElement("div");return T.className="aipkit_cw_template_group",b&&T.classList.add("is-starter-group"),T.appendChild(q(w,C)),x.forEach(P=>{T.appendChild(y(P,b))}),v.appendChild(T),x.length},I=0;if(I+=E("Starter Templates",h.starterTemplates,"dashicons-star-filled",!0),I+=E("My Templates",h.myTemplates,"dashicons-admin-users",!1),Object.keys(h.otherUsersTemplates).forEach(w=>{I+=E(w,h.otherUsersTemplates[w],"dashicons-groups",!1)}),I===0){let w=document.createElement("div");w.className="aipkit_cw_template_picker_empty",w.textContent=k(S?"No templates match your search.":"No templates found."),g.appendChild(w)}else g.appendChild(v);c(_),s(g,_.value)}function d(_){let{select:f}=e();f&&n(f,_)}function a(){let{search:_,searchClear:f}=e();if(!_)return;let g=null;_.addEventListener("input",u=>{let h=u.target.value;f&&(f.style.display=h?"flex":"none"),clearTimeout(g),g=setTimeout(()=>{d(h)},150)}),f&&f.addEventListener("click",()=>{_.value="",f.style.display="none",d(""),_.focus()});let m=document.getElementById("aipkit_cw_template_picker_popover");m&&new MutationObserver(h=>{h.forEach(v=>{v.attributeName==="aria-hidden"&&m.getAttribute("aria-hidden")==="true"&&_.value&&(_.value="",f&&(f.style.display="none"),d(""))})}).observe(m,{attributes:!0})}function l(){let{select:_,list:f,button:g}=e();!_||!f||(a(),f.dataset.listenerAttached||(f.addEventListener("click",m=>{let u=m.target.closest(".aipkit_cw_template_list_item");if(!u||!_)return;let h=u.dataset.templateId||"";_.value=h,_.dispatchEvent(new Event("change",{bubbles:!0})),s(f,h),g&&g.click()}),f.dataset.listenerAttached="true"),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",()=>{c(_),s(f,_.value)}),_.dataset.listenerAttached="true"),n(_))}function p(_){let{select:f,list:g}=e();f&&(_!==void 0&&(f.value=_),c(f),s(g,f.value))}window.aipkit_initTemplatePicker=l,window.aipkit_renderTemplatePicker=n,window.aipkit_updateTemplatePickerSelection=p})();(function(){"use strict";function k(){let e=document.getElementById("aipkit_cw_template_action_list"),t=document.getElementById("aipkit_cw_template_inline_form"),c=document.getElementById("aipkit_cw_template_inline_delete_confirm"),s=document.getElementById("aipkit_cw_template_name_input");e&&(e.style.display=""),t&&(t.style.display="none",delete t.dataset.mode),c&&(c.style.display="none"),s&&(s.value="")}function o(){k()}function r(e,t=""){let c=document.getElementById("aipkit_cw_template_inline_form"),s=document.getElementById("aipkit_cw_template_name_input"),n=document.getElementById("aipkit_cw_template_action_list");!c||!s||(n&&(n.style.display="none"),c.style.display="flex",c.dataset.mode=e,s.value=t,s.focus())}function i(){let e=document.getElementById("aipkit_cw_template_inline_form"),t=document.getElementById("aipkit_cw_template_name_input");!e||!t||o()}window.aipkit_showTemplateNameForm=r,window.aipkit_hideTemplateNameForm=i,window.aipkit_closeTemplateActionsPopover=o,window.aipkit_resetTemplateActionsPanel=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(i){let e=document.getElementById("aipkit_cw_template_inline_form"),t=document.getElementById("aipkit_cw_template_inline_delete_confirm"),c=document.getElementById("aipkit_cw_template_delete_confirm_text"),s=document.getElementById("aipkit_cw_template_action_list");!e||!t||!c||(e.style.display="none",s&&(s.style.display="none"),t.style.display="flex",c.innerHTML=`Delete "<strong>${k(i)}</strong>"?`)}function r(){let i=document.getElementById("aipkit_cw_template_inline_delete_confirm"),e=document.getElementById("aipkit_cw_template_action_list");i&&(i.style.display="none",e&&(e.style.display=""),typeof window.aipkit_closeTemplateActionsPopover=="function"&&window.aipkit_closeTemplateActionsPopover())}window.aipkit_showTemplateDeleteConfirm=o,window.aipkit_hideTemplateDeleteConfirm=r})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_template_save_inline_btn"),r=document.getElementById("aipkit_cw_template_cancel_inline_btn"),i=document.getElementById("aipkit_cw_template_inline_form"),e=document.getElementById("aipkit_cw_template_name_input");if(!o||!r||!i||!e){console.warn("bindInlineFormButtons: One or more inline form elements are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()}),o.addEventListener("click",async()=>{let t=i.dataset.mode,c=e.value.trim();if(!c){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}let s=document.getElementById("aipkit_content_writer_form"),n=document.getElementById("aipkit_cw_template_select");if(typeof window.aipkit_getContentWriterFormConfig!="function"||typeof window.aipkit_saveContentWriterTemplate!="function"){console.error("Inline Save: Missing required helper functions.");return}let d=window.aipkit_getContentWriterFormConfig(s);if(t==="new")await window.aipkit_saveContentWriterTemplate(0,c,d);else if(t==="rename"){let a=n.value;a&&await window.aipkit_saveContentWriterTemplate(parseInt(a),c,d)}typeof window.aipkit_hideTemplateNameForm=="function"&&window.aipkit_hideTemplateNameForm()})}window.aipkit_bindInlineFormButtons=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_template_confirm_delete_btn"),r=document.getElementById("aipkit_cw_template_cancel_delete_btn");if(!o||!r){console.warn("bindInlineDeleteButtons: One or more inline delete buttons are missing.");return}r.addEventListener("click",()=>{typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}),o.addEventListener("click",async()=>{if(window.aipkit_cw_template_state.isSavingOrDeleting)return;let i=document.getElementById("aipkit_cw_template_select"),e=i.value,t=document.getElementById("aipkit_content_writer_template_nonce_field"),c=typeof window.aipkit_showProgress=="function"?window.aipkit_showProgress:null,s=typeof window.aipkit_showSuccess=="function"?window.aipkit_showSuccess:null,n=typeof window.aipkit_showError=="function"?window.aipkit_showError:null;window.aipkit_cw_template_state.isSavingOrDeleting=!0,c&&c("Updating...");try{await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:e,_ajax_nonce:t?t.value:""}),s&&s("Updated"),typeof window.aipkit_fetchAndPopulateTemplates=="function"&&window.aipkit_fetchAndPopulateTemplates(i)}catch(d){console.error("Error deleting template:",d),n&&n(`Error: ${d.message||"Failed to delete template."}`)}finally{window.aipkit_cw_template_state.isSavingOrDeleting=!1,typeof window.aipkit_hideTemplateDeleteConfirm=="function"&&window.aipkit_hideTemplateDeleteConfirm()}})}window.aipkit_bindInlineDeleteButtons=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_template_select");if(!o){console.warn("initTemplateSelect: Template select element not found.");return}typeof window.aipkit_fetchAndPopulateTemplates=="function"?window.aipkit_fetchAndPopulateTemplates(o):console.error("initTemplateSelect: fetchAndPopulateTemplates function missing."),typeof window.aipkit_applyContentWriterTemplate=="function"?o.addEventListener("change",r=>window.aipkit_applyContentWriterTemplate(r.target.value)):console.error("initTemplateSelect: applyContentWriterTemplate function missing.")}window.aipkit_initTemplateSelect=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_save_as_template_btn");if(!o){console.warn("bindSaveAsTemplateBtn: Button not found.");return}typeof window.aipkit_handleSaveAsContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleSaveAsContentWriterTemplate):console.error("bindSaveAsTemplateBtn: handleSaveAsContentWriterTemplate function missing.")}window.aipkit_bindSaveAsTemplateBtn=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_rename_template_btn");if(!o){console.warn("bindRenameTemplateBtn: Button not found.");return}typeof window.aipkit_handleRenameContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleRenameContentWriterTemplate):console.error("bindRenameTemplateBtn: handleRenameContentWriterTemplate function missing.")}window.aipkit_bindRenameTemplateBtn=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_delete_template_btn");if(!o){console.warn("bindDeleteTemplateBtn: Button not found.");return}typeof window.aipkit_handleDeleteContentWriterTemplate=="function"?o.addEventListener("click",window.aipkit_handleDeleteContentWriterTemplate):console.error("bindDeleteTemplateBtn: handleDeleteContentWriterTemplate function missing.")}window.aipkit_bindDeleteTemplateBtn=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_cw_reset_starter_templates_btn");if(!o){console.warn("bindResetStarterTemplatesBtn: Button not found.");return}typeof window.aipkit_handleResetStarterTemplates=="function"?o.addEventListener("click",window.aipkit_handleResetStarterTemplates):console.error("bindResetStarterTemplatesBtn: handleResetStarterTemplates function missing.")}window.aipkit_bindResetStarterTemplatesBtn=k})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_post_status");if(!o){console.warn("bindPostStatusHandler: Post status select not found.");return}typeof window.aipkit_toggleContentWriterScheduleFields=="function"?(o.addEventListener("change",window.aipkit_toggleContentWriterScheduleFields),window.aipkit_toggleContentWriterScheduleFields()):console.error("bindPostStatusHandler: aipkit_toggleContentWriterScheduleFields function missing.")}window.aipkit_bindPostStatusHandler=k})();(function(){"use strict";function k(){let o=document.querySelector(".aipkit_content_writer_inputs");if(!o){console.warn("bindFormChangeListeners: Form inputs wrapper not found for change detection.");return}typeof window.aipkit_checkFormForModifications=="function"?(o.addEventListener("input",window.aipkit_checkFormForModifications),o.addEventListener("change",window.aipkit_checkFormForModifications)):console.error("bindFormChangeListeners: aipkit_checkFormForModifications function is missing.")}window.aipkit_bindFormChangeListeners=k})();(function(){"use strict";function k(){let o=["aipkit_initTemplateSelect","aipkit_initTemplatePicker","aipkit_bindSaveAsTemplateBtn","aipkit_bindRenameTemplateBtn","aipkit_bindDeleteTemplateBtn","aipkit_bindResetStarterTemplatesBtn","aipkit_bindPostStatusHandler","aipkit_bindFormChangeListeners","aipkit_bindInlineFormButtons","aipkit_bindInlineDeleteButtons"];for(let i of o)if(typeof window[i]!="function"){console.error(`Content Writer Template Handler Init: Missing required function: ${i}`);return}window.aipkit_initTemplateSelect(),window.aipkit_initTemplatePicker(),window.aipkit_bindSaveAsTemplateBtn(),window.aipkit_bindRenameTemplateBtn(),window.aipkit_bindDeleteTemplateBtn(),window.aipkit_bindResetStarterTemplatesBtn(),window.aipkit_bindPostStatusHandler(),window.aipkit_bindFormChangeListeners(),window.aipkit_bindInlineFormButtons(),window.aipkit_bindInlineDeleteButtons();let r=document.getElementById("aipkit_cw_template_select");r&&typeof window.aipkit_updateTemplateActionButtonsState=="function"?window.aipkit_updateTemplateActionButtonsState(r.value):r&&console.error("Content Writer Template Handler Init: updateTemplateActionButtonsState function missing for initial state set.")}window.aipkit_initContentWriterTemplateHandler=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){let i=document.getElementById("aipkit_cw_save_as_post_btn");if(!i){console.warn("Save as Post Handler: Button not found.");return}i.addEventListener("click",r)}async function r(){let i=document.getElementById("aipkit_content_writer_form"),e=document.getElementById("aipkit_cw_save_as_post_btn"),t=document.getElementById("aipkit_cw_generated_content_area"),c=document.getElementById("aipkit_content_writer_output_display"),s=document.getElementById("aipkit_cw_save_post_status");if(!i||!e||!t||!c||!s){console.error("Save as Post: Missing required UI elements.");return}let d=(typeof window.aipkit_getContentWriterRawHtml=="function"?window.aipkit_getContentWriterRawHtml():"")||t.innerHTML;if(!(t.textContent.trim().length>0||!!t.querySelector("img, h1, h2, h3, h4, h5, h6, p, ul, ol, li, blockquote, pre, table, figure"))){s&&(s.textContent="Nothing to save. Please generate content first.",s.className="aipkit_cw_save_status aipkit_settings_message-error");return}let l=document.getElementById("aipkit_cw_generated_title_display"),p={post_title:l?l.textContent:"Untitled AI Post",post_content:d,generated_excerpt:i.elements.generated_excerpt?.value||"",generated_tags:i.elements.generated_tags?.value||"",meta_description:i.elements.meta_description?i.elements.meta_description.value:"",focus_keyword:i.elements.focus_keyword?i.elements.focus_keyword.value:"",post_type:i.elements.post_type?i.elements.post_type.value:"post",post_author:i.elements.post_author?i.elements.post_author.value:1,post_status:i.elements.post_status?i.elements.post_status.value:"draft",post_schedule_date:i.elements.post_schedule_date?i.elements.post_schedule_date.value:"",post_schedule_time:i.elements.post_schedule_time?i.elements.post_schedule_time.value:"",post_categories:i.elements["post_categories[]"]?Array.from(i.elements["post_categories[]"].selectedOptions).map(_=>_.value):[],generate_toc:i.elements.generate_toc?.checked?"1":"0",image_data:document.getElementById("aipkit_cw_image_data_holder")?.value,image_alignment:i.elements.image_alignment?i.elements.image_alignment.value:"none",image_size:i.elements.image_size?i.elements.image_size.value:"large",_ajax_nonce:document.getElementById("aipkit_content_writer_nonce")?document.getElementById("aipkit_content_writer_nonce").value:""};s&&(s.textContent="Saving post...",s.className="aipkit_cw_save_status aipkit_settings_message-info"),window.aipkit_setLoadingStateOpenAI(e,!0,"Save","Saving...");try{let _=await window.aipkit_apiRequest("aipkit_content_writer_save_post",p);s&&(s.textContent=_.message||"Post saved successfully!",s.className="aipkit_cw_save_status aipkit_settings_message-success",_.edit_link&&(s.innerHTML+=` <a href="${k(_.edit_link)}" target="_blank">Edit Post</a>`))}catch(_){console.error("Error saving post:",_),s&&(s.textContent=`Error: ${_.message||"Failed to save post."}`,s.className="aipkit_cw_save_status aipkit_settings_message-error")}finally{window.aipkit_setLoadingStateOpenAI(e,!1,"Save as Post"),setTimeout(()=>{s&&(s.textContent="",s.className="aipkit_cw_save_status")},5e3)}}window.aipkit_initSaveAsPostButton=o})();(function(){"use strict";function k(){let o=document.getElementById("aipkit_content_writer_container");if(!o){console.error("Content Writer Main: Could not find the main container (#aipkit_content_writer_container). Aborting initialization.");return}let r=document.getElementById("aipkit_content_writer_form"),i=document.getElementById("aipkit_content_writer_generate_btn"),e=document.getElementById("aipkit_content_writer_stop_btn"),t=document.getElementById("aipkit_content_writer_copy_btn"),c=document.getElementById("aipkit_content_writer_clear_btn"),s=document.getElementById("aipkit_content_writer_provider"),n=document.getElementById("aipkit_content_writer_model"),d=document.getElementById("aipkit_content_writer_temperature"),a=document.getElementById("aipkit_cw_save_as_post_btn"),l=document.querySelector(".aipkit_cw_generation_status_indicators");if(!r||!i||!e||!t||!c||!s||!n||!d||!a){console.error("Content Writer Main: Missing one or more required UI elements.");return}typeof window.aipkit_initContentWriterAccordions=="function"?window.aipkit_initContentWriterAccordions():console.error("Content Writer Main: aipkit_initContentWriterAccordions function not found."),typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(o):console.error("Content Writer Main: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initContentWriterAssistantSheet=="function"&&window.aipkit_initContentWriterAssistantSheet(o),typeof window.aipkit_initContentWriterPromptFlyouts=="function"?window.aipkit_initContentWriterPromptFlyouts(o):console.error("Content Writer Main: aipkit_initContentWriterPromptFlyouts function not found."),typeof window.aipkit_initContentWriterPromptModeManager=="function"?window.aipkit_initContentWriterPromptModeManager(o):console.error("Content Writer Main: aipkit_initContentWriterPromptModeManager function not found."),typeof window.aipkit_initContentWriterBulkEditor=="function"?window.aipkit_initContentWriterBulkEditor(o):console.error("Content Writer Main: aipkit_initContentWriterBulkEditor function not found."),typeof window.aipkit_initContentWriterGenerateMenu=="function"?window.aipkit_initContentWriterGenerateMenu():console.error("Content Writer Main: aipkit_initContentWriterGenerateMenu function not found."),typeof window.aipkit_attachRangeValueHandlers=="function"&&window.aipkit_attachRangeValueHandlers("#aipkit_content_writer_container"),typeof window.aipkit_initContentWriterTabs=="function"?window.aipkit_initContentWriterTabs(o):console.error("Content Writer Main: aipkit_initContentWriterTabs function not found."),typeof window.aipkit_initContentWriterExistingContent=="function"?window.aipkit_initContentWriterExistingContent(o):console.error("Content Writer Main: aipkit_initContentWriterExistingContent function not found."),typeof window.aipkit_cw_initOptionPromptToggles=="function"?window.aipkit_cw_initOptionPromptToggles():console.error("Content Writer Main: aipkit_cw_initOptionPromptToggles function not found."),typeof window.aipkit_initPromptToggles=="function"?window.aipkit_initPromptToggles():console.error("Content Writer Main: aipkit_initPromptToggles function not found."),typeof window.aipkit_cw_toggleReasoningEffort=="function"?(s.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(o)}),n.addEventListener("change",function(){window.aipkit_cw_toggleReasoningEffort(o)}),window.aipkit_cw_toggleReasoningEffort(o)):console.error("Content Writer Main: aipkit_cw_toggleReasoningEffort function not found."),typeof window.aipkit_initImageSettingsHandler=="function"?window.aipkit_initImageSettingsHandler():console.error("Content Writer Main: aipkit_initImageSettingsHandler function not found."),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_content_writer_container"):console.error("Content Writer Main: aipkit_initApiKeyToggles function not found."),typeof window.aipkit_initContentWriterVectorSettings=="function"?window.aipkit_initContentWriterVectorSettings():console.error("Content Writer Main: aipkit_initContentWriterVectorSettings function not found."),typeof window.aipkit_initContentWriterVectorStoreMultiSelect=="function"?window.aipkit_initContentWriterVectorStoreMultiSelect(o):console.error("Content Writer Main: aipkit_initContentWriterVectorStoreMultiSelect function not found."),typeof window.aipkit_initContentWriterCategoriesMultiSelect=="function"?window.aipkit_initContentWriterCategoriesMultiSelect(o):console.error("Content Writer Main: aipkit_initContentWriterCategoriesMultiSelect function not found."),typeof window.aipkit_resetGenerationStatusIndicators=="function"?window.aipkit_resetGenerationStatusIndicators():console.error("Content Writer Main: resetGenerationStatusIndicators function not found."),typeof window.aipkit_initContentWriterUI=="function"?window.aipkit_initContentWriterUI(s,n,d,i,t,c):console.error("Content Writer Main: aipkit_initContentWriterUI function not found."),typeof window.aipkit_initContentWriterTemplateHandler=="function"?window.aipkit_initContentWriterTemplateHandler():console.error("Content Writer Main: aipkit_initContentWriterTemplateHandler function not found."),typeof window.aipkit_initContentWriterAutosave=="function"?window.aipkit_initContentWriterAutosave():console.error("Content Writer Main: aipkit_initContentWriterAutosave function not found."),typeof window.aipkit_initSaveAsPostButton=="function"?window.aipkit_initSaveAsPostButton():console.error("Content Writer Main: aipkit_initSaveAsPostButton function not found."),typeof window.aipkit_initCsvUploadHandler=="function"?window.aipkit_initCsvUploadHandler():console.error("Content Writer Main: aipkit_initCsvUploadHandler function not found.");let p=window.aipkit_dashboard&&window.aipkit_dashboard.isProPlan;p&&typeof window.aipkit_initRssInputHandler=="function"&&window.aipkit_initRssInputHandler(),p&&typeof window.aipkit_initGsheetsVerification=="function"?window.aipkit_initGsheetsVerification():p&&console.error("Content Writer Main: aipkit_initGsheetsVerification function not found."),p&&typeof window.aipkit_initUrlScrapeHandler=="function"?window.aipkit_initUrlScrapeHandler():p&&console.error("Content Writer Main: aipkit_initUrlScrapeHandler function not found."),typeof window.aipkit_attachGenerateButtonListener=="function"?window.aipkit_attachGenerateButtonListener(i,r,l,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachGenerateButtonListener function not found."),typeof window.aipkit_attachStopButtonListener=="function"?window.aipkit_attachStopButtonListener(e,window.aipkit_contentWriterEventSourceInstanceRef):console.error("Content Writer Main: aipkit_attachStopButtonListener function not found."),window.aipkit_enableSaveAsPostButton=function(){a&&(a.disabled=!1)},window.aipkit_disableSaveAsPostButton=function(){a&&(a.disabled=!0)},window.aipkit_disableSaveAsPostButton()}window.aipkit_initContentWriter=k})();(function(){"use strict";let k=!1,o=null,r=null,i=null,e=!1,t=null,c="aipkit_image_generator_status",s="aipkit_image_gen_preview_theme",n=["dark","light"];function d(){let B=document.getElementById("aipkit_image_generator_container");if(!B){console.error("AIPKit Image Generator: Main container #aipkit_image_generator_container not found.");return}if(B.querySelector("#aipkit_public_image_generator"))if(typeof window.aipkit_initPublicImageGenerator=="function")try{window.aipkit_initPublicImageGenerator()}catch(L){console.error("AIPKit Image Generator: Error calling public UI initializer:",L);let U=document.getElementById("aipkit_public_image_results");U&&(U.innerHTML='<p style="color:red">Error initializing preview scripts.</p>')}else{console.error("AIPKit Image Generator: Public UI initializer function not found!");let L=document.getElementById("aipkit_public_image_results");L&&(L.innerHTML='<p style="color:red">Error: Preview script not loaded.</p>')}F(B),H(B),C(B),typeof window.aipkit_initApiKeyToggles=="function"?window.aipkit_initApiKeyToggles("#aipkit_image_generator_container"):console.error("AIPKit Image Generator: aipkit_initApiKeyToggles function not found.")}function a(){return document.getElementById(c)}function l(B,V){let L=a();if(!L)return;let U=L.classList.contains("aipkit_training_status");if(L.textContent=B||"",U){L.classList.remove("is-visible","is-success","is-error","is-warning","is-loading"),B&&L.classList.add("is-visible"),V&&L.classList.add(`is-${V}`);return}L.classList.remove("aipkit_form-help-success","aipkit_form-help-error"),V==="success"?L.classList.add("aipkit_form-help-success"):V==="error"&&L.classList.add("aipkit_form-help-error")}function p(B=2500){i&&window.clearTimeout(i),i=window.setTimeout(()=>{l("","")},B)}function _(B){window.aipkit_dashboard||(window.aipkit_dashboard={});let V=window.aipkit_dashboard.providerStatus||{};V.replicate=!!String(B||"").trim(),window.aipkit_dashboard.providerStatus=V,typeof window.aipkit_initProviderKeyNotices=="function"&&window.aipkit_initProviderKeyNotices(document)}function f(){return document.getElementById("aipkit_image_generator_settings_form")}function g(){let B=f();if(!B)return console.error("AIPKit Image Settings: Settings form not found."),null;let V=new FormData(B);if(V.has("frontend_models")){let U=B.querySelector("#aipkit_image_gen_frontend_models");U&&U.value===""&&V.set("frontend_models","")}else{let U=B.querySelector("#aipkit_image_gen_frontend_models");U&&V.append("frontend_models",U.value||"")}let L={};return V.forEach((U,W)=>{L[W]=U}),Object.prototype.hasOwnProperty.call(L,"replicate_api_key")&&delete L.replicate_api_key,L}function m(B){if(!B)return"";let V={};return Object.keys(B).sort().forEach(L=>{V[L]=B[L]}),JSON.stringify(V)}function u(B){r=m(B)}function h(B){return m(B)!==r}function v(B){if(!(B||"").trim()||typeof window.aipkit_queueProviderSync!="function")return null;let L=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:W=>W;l(L("Syncing models...","gpt3-ai-content-generator"),"loading");let U=window.aipkit_queueProviderSync("Replicate",{silent:!0,propagateError:!0});return U&&typeof U.then=="function"&&U.then(()=>{l(L("Models synced!","gpt3-ai-content-generator"),"success"),p()}).catch(W=>{l(W?.message||L("Sync failed.","gpt3-ai-content-generator"),"error"),p(4e3)}),U}async function S(B){let V=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:L=>L;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Settings: aipkit_apiRequest not found.");return}l(V("Saving...","gpt3-ai-content-generator"),"loading");try{let L=await window.aipkit_apiRequest("aipkit_save_image_settings",B);return l(L.message||V("Settings saved!","gpt3-ai-content-generator"),"success"),p(),u(B),L}catch(L){throw l(L.message||V("Failed to save settings.","gpt3-ai-content-generator"),"error"),p(4e3),console.error("AIPKit Image Settings Save Error:",L),L}}async function q(B){let V=typeof wp<"u"&&wp.i18n&&wp.i18n.__?wp.i18n.__:L=>L;if(typeof window.aipkit_apiRequest!="function"){console.error("AIPKit Image Generator: aipkit_apiRequest not found.");return}l(V("Saving...","gpt3-ai-content-generator"),"loading");try{let L=await window.aipkit_apiRequest("aipkit_save_ai_settings",{replicate_api_key:B});return _(B),l(L.message||V("Replicate key saved!","gpt3-ai-content-generator"),"success"),p(),v(B),L}catch(L){throw l(L.message||V("Failed to save Replicate key.","gpt3-ai-content-generator"),"error"),p(4e3),console.error("AIPKit Replicate Key Save Error:",L),L}}function y(B){if(B){if(k){o=B;return}k=!0,S(B).catch(()=>{}).finally(()=>{if(k=!1,o){let V=o;o=null,h(V)&&y(V)}})}}function E(){let B=g();!B||!h(B)||y(B)}function I(){let B=g();B&&u(B)}function w(B){if(!B)return;let V="data-aipkit-image-autosave-attached";if(B.hasAttribute(V))return;let L=()=>{E()};B.addEventListener("change",U=>{let W=U.target;!W||!W.matches(".aipkit_autosave_trigger")||L()}),B.addEventListener("blur",U=>{let W=U.target;!W||!W.matches(".aipkit_autosave_trigger")||L()},!0),B.setAttribute(V,"true"),I()}function A(B){let V=B.querySelector("#aipkit_replicate_api_key");if(!V)return;let L="data-replicate-autosave-attached";if(V.hasAttribute(L))return;t=V.value||"",_(t);let U=()=>{let W=V.value||"";W===t||e||(e=!0,q(W).then(()=>{t=W}).catch(()=>{}).finally(()=>{e=!1;let ee=g();ee&&u(ee)}))};V.addEventListener("change",U),V.addEventListener("blur",U),V.setAttribute(L,"true")}function C(B){let V=B.querySelector("#aipkit_image_generator_settings_popover");if(!V)return;typeof window.aipkit_initContentWriterPopovers=="function"?window.aipkit_initContentWriterPopovers(B):console.error("AIPKit Image Generator: aipkit_initContentWriterPopovers function not found."),typeof window.aipkit_initSyncButtons=="function"?window.aipkit_initSyncButtons():console.error("AIPKit Image Generator: aipkit_initSyncButtons function not found."),b(V);let L="data-token-listener-attached";V.hasAttribute(L)||(V.addEventListener("change",function(U){U.target.closest(".aipkit_token_limit_mode_select")&&x(V)}),V.setAttribute(L,"true")),x(V);try{T(V)}catch(U){console.error("AIPKit Image Settings: Failed to init model selector",U)}w(V),A(V)}function b(B){let V=B.querySelector("#aipkit_image_generator_settings_panel");if(!V)return;let L=Array.from(V.querySelectorAll("[data-aipkit-settings-panel]"));if(!L.length||V.dataset.panelsBound==="true")return;let U=B.querySelector(".aipkit_model_settings_popover_title"),W=B.querySelector(".aipkit_model_settings_popover_back"),ee=document.getElementById("aipkit_image_generator_settings_trigger"),ne={root:V.dataset.titleRoot||"Settings","token-management":V.dataset.titleTokenManagement||"Token Management",replicate:V.dataset.titleReplicate||"Replicate","custom-css":V.dataset.titleCustomCss||"Custom CSS","provider-filtering":V.dataset.titleProviderFiltering||"Provider Filtering"},z=null,ge=Ae=>{let ot=Ae||"root",ze=V.querySelector(`[data-aipkit-settings-panel="${ot}"]`)||V.querySelector('[data-aipkit-settings-panel="root"]');if(!ze)return;let Xe=ze.dataset.aipkitSettingsPanel||"root";if(Xe!==z){if(L.forEach(Ge=>{Ge.hidden=Ge!==ze}),U&&(U.textContent=ne[Xe]||ne.root),W&&(W.hidden=Xe==="root"),Xe==="token-management"&&x(B),Xe==="replicate"){let Ge=B.querySelector("#aipkit_replicate_api_key");v(Ge?Ge.value:"")}z=Xe,B.classList.contains("aipkit-active")&&window.requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))})}};V.addEventListener("click",Ae=>{let ot=Ae.target.closest("[data-aipkit-panel-target]");ot&&(Ae.preventDefault(),ge(ot.dataset.aipkitPanelTarget))}),W&&W.addEventListener("click",Ae=>{Ae.preventDefault(),ge("root")}),ee&&ee.addEventListener("click",()=>{ge("root")}),ge("root"),V.dataset.panelsBound="true"}function x(B){if(!B)return;let V=B.querySelector(".aipkit_token_limit_mode_select"),L=B.querySelector(".aipkit_token_general_user_limit_field"),U=B.querySelector(".aipkit_token_role_limits_container");if(!V||!L||!U)return;let W=V.value;L&&(L.hidden=W!=="general"),U&&(U.hidden=W!=="role_based")}function T(B){let V=B.querySelector("#aipkit_image_gen_models_selector");if(!V||V.getAttribute("data-enhanced")==="true")return;let L=B.querySelector("#aipkit_image_gen_frontend_models"),U=V.dataset.initialValue||"",ee=!0&&U===""?[]:U.split(",").map(Ce=>Ce.trim()).filter(Boolean),ne=new Set(ee),z=window.aipkit_image_generator_config_public||{},ge=Ce=>{if(!Ce||typeof Ce!="object")return!1;let St={image_output:!0,image_generation:!0};if(!Ce.capabilities||typeof Ce.capabilities!="object")return!0;let Rt={...St,...Ce.capabilities};return!!(Rt.image_output||Rt.image_generation)},Ae=z.azure_models||[];if((!Ae||Ae.length===0)&&window.aipkit_dashboard_providers)try{Array.isArray(window.aipkit_dashboard_providers.AzureImage)&&(Ae=window.aipkit_dashboard_providers.AzureImage.map(Ce=>typeof Ce=="string"?{id:Ce,name:Ce}:Ce))}catch{}let ot=[{key:"openai",label:"OpenAI",type:"flat",models:(z.openai_models||[]).map(Ce=>({id:Ce.id,name:Ce.name}))},{key:"openrouter",label:"OpenRouter",type:"flat",models:(z.openrouter_image_models||[]).filter(Ce=>ge(Ce)).map(Ce=>({id:Ce.id||Ce.name||Ce,name:Ce.name||Ce.id||Ce}))},{key:"azure",label:"Azure",type:"flat",models:Ae.map(Ce=>Ce.id?Ce:{id:Ce.id||Ce.name||Ce,name:Ce.name||Ce.id||Ce})},{key:"google",label:"Google",type:"grouped",models:z.google_models||{}},{key:"replicate",label:"Replicate",type:"flat",models:(z.replicate_models||[]).map(Ce=>Ce.id?Ce:{id:Ce.id||Ce.name||Ce,name:Ce.name||Ce.id||Ce})}].filter(Ce=>Ce.key==="azure"||Ce.key==="openrouter"?!0:Ce.models&&(Array.isArray(Ce.models)?Ce.models.length:Object.keys(Ce.models).length));V.innerHTML="",V.classList.add("aipkit_models_selector--ready");let ze=document.createElement("input");ze.type="search",ze.placeholder="Filter models...",ze.className="aipkit_models_selector-search",V.appendChild(ze);let Xe=document.createElement("div");Xe.className="aipkit_models_selector-summary",V.appendChild(Xe);let Ge=document.createElement("div");Ge.className="aipkit_models_selector-providers",V.appendChild(Ge),ot.forEach(Ce=>{let St=document.createElement("div");St.className="aipkit_models_selector-provider",St.dataset.provider=Ce.key;let Rt=document.createElement("div");Rt.className="aipkit_models_selector-provider-header",Rt.innerHTML=`<strong>${Ce.label}</strong>`;let vi=document.createElement("div");vi.className="aipkit_models_selector-provider-actions";let gi=document.createElement("button");gi.type="button",gi.className="aipkit_btn aipkit_btn-xs",gi.textContent="All";let ae=document.createElement("button");ae.type="button",ae.className="aipkit_btn aipkit_btn-xs aipkit_btn-secondary",ae.textContent="None",vi.appendChild(gi),vi.appendChild(ae),Rt.appendChild(vi),St.appendChild(Rt);let ke=document.createElement("div");ke.className="aipkit_models_selector-models";let ye=ve=>{if(!ve||!ve.id)return;let Re=ve.id,Ie=document.createElement("label");Ie.className="aipkit_models_selector-item",Ie.title=Re;let at=document.createElement("input");at.type="checkbox",at.value=Re,at.checked=ne.has(Re),at.dataset.modelId=Re,at.addEventListener("change",()=>{Qe(!0)});let rt=document.createElement("span");rt.textContent=ve.name||Re,Ie.appendChild(at),Ie.appendChild(rt),ke.appendChild(Ie)};if(Ce.type==="grouped"?Object.keys(Ce.models).forEach(ve=>{let Re=Ce.models[ve];if(!Array.isArray(Re))return;let Ie=document.createElement("div");Ie.className="aipkit_models_selector-subgroup",Ie.textContent=ve.charAt(0).toUpperCase()+ve.slice(1),ke.appendChild(Ie),Re.forEach(at=>ye(at))}):Ce.models.forEach(ve=>ye(ve)),Ce.key==="azure"&&Ce.models.length===0){let ve=document.createElement("div");ve.className="aipkit_models_selector-empty",ve.textContent="No Azure image models found. Sync Azure Image models in the main Models settings first.",ke.appendChild(ve)}if(Ce.key==="openrouter"&&Ce.models.length===0){let ve=document.createElement("div");ve.className="aipkit_models_selector-empty",ve.textContent="No image-capable OpenRouter models found. Sync OpenRouter models in the main Models settings first.",ke.appendChild(ve)}gi.addEventListener("click",()=>{ke.querySelectorAll('input[type="checkbox"]').forEach(ve=>{ve.checked=!0}),Qe(!0)}),ae.addEventListener("click",()=>{ke.querySelectorAll('input[type="checkbox"]').forEach(ve=>{ve.checked=!1}),Qe(!0)}),St.appendChild(ke),Ge.appendChild(St)}),ze.addEventListener("input",()=>{let Ce=ze.value.toLowerCase();Ge.querySelectorAll(".aipkit_models_selector-item").forEach(St=>{let Rt=St.textContent.toLowerCase();St.style.display=Rt.includes(Ce)?"":"none"})}),V.setAttribute("data-enhanced","true"),It();function It(){let Ce=Array.from(V.querySelectorAll(".aipkit_models_selector-item input:checked")).map(St=>St.value);Ce.length===0?Xe.textContent="Showing all models (none selected)":Xe.textContent=`${Ce.length} model${Ce.length>1?"s":""} selected`}function Qe(Ce=!1){let St=Array.from(V.querySelectorAll(".aipkit_models_selector-item input:checked")).map(Rt=>Rt.value.trim()).filter(Boolean);L&&(L.value=St.join(", ")),It(),Ce&&E()}window.aipkit_syncAllowedModelsHiddenField=Qe}function P(B=!1){typeof window.aipkit_syncAllowedModelsHiddenField=="function"&&window.aipkit_syncAllowedModelsHiddenField(B)}function H(B){let V=B.querySelector("#aipkit_theme_switcher_toggle_btn"),L=B.querySelector(".aipkit_image_generator_admin_preview_wrapper");if(!V||!L){console.warn("AIPKit Image Gen Admin: Theme toggle or preview wrapper not found in scope:",B);return}let U=n.indexOf(localStorage.getItem(s)||"dark");U===-1&&(U=n.indexOf("dark")),O(n[U],L,V),V.hasAttribute("data-listener-attached")||(V.addEventListener("click",function(){U=(U+1)%n.length;let W=n[U];O(W,L,V),localStorage.setItem(s,W)}),V.setAttribute("data-listener-attached","true"))}function O(B,V,L){let U=V.querySelector(".aipkit_shortcode_container.aipkit_image_generator_public_wrapper");U&&(n.forEach(ne=>U.classList.remove(`aipkit-theme-${ne}`)),U.classList.add(`aipkit-theme-${B}`));let W=B.charAt(0).toUpperCase()+B.slice(1),ee="Toggle Preview Theme";L.title=`${ee} (Current: ${W})`}function F(B){let V=B.querySelector("#aipkit_image_generator_shortcode_snippet"),L=B.querySelector("#aipkit_image_generator_shortcode_settings_toggle"),U=B.querySelector("#aipkit_image_generator_shortcode_configurator"),W=B.querySelector("#aipkit_image_generator_shortcode_configurator .aipkit_model_settings_popover_close"),ee=B.querySelectorAll("#aipkit_image_generator_shortcode_configurator .aipkit_config_input");if(!V||!L||!U||ee.length===0){console.warn("AIPKit Image Gen Admin: Shortcode configurator elements not found in scope:",B);return}L.hasAttribute("data-listener-attached")||(L.addEventListener("click",()=>{let ne=U.style.display==="none"||!U.style.display;U.style.display=ne?"flex":"none",L.classList.toggle("aipkit_active",ne),L.setAttribute("aria-expanded",ne.toString())}),W&&W.addEventListener("click",()=>{U.style.display="none",L.classList.remove("aipkit_active"),L.setAttribute("aria-expanded","false")}),ee.forEach(ne=>ne.addEventListener("change",()=>M(B))),V.addEventListener("click",()=>{typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(V.textContent,V):console.error("AIPKit Image Generator: aipkit_copyShortcode function not found.")}),M(B),L.setAttribute("data-listener-attached","true"))}function M(B){let V=B.querySelector("#aipkit_image_generator_shortcode_snippet"),L=B.querySelector("#aipkit_image_generator_shortcode_configurator");if(!V||!L)return;let U=L.querySelector('input[name="cfg_show_provider"]').checked,W=L.querySelector('input[name="cfg_show_model"]').checked,ee=L.querySelector('input[name="cfg_show_history"]').checked,ne=L.querySelector('select[name="cfg_theme"]'),z=L.querySelector('input[name="cfg_theme"]:checked'),ge=ne?ne.value:z?z.value:"dark",Ae="[aipkit_image_generator";U||(Ae+=' show_provider="false"'),W||(Ae+=' show_model="false"'),ee&&(Ae+=' history="true"'),ge!=="dark"&&(Ae+=` theme="${ge}"`),Ae+="]",V.textContent=Ae}window.aipkit_initImageGenerator=d})();(function(){"use strict";function k(o,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Title Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_title,c=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Title): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let s={_ajax_nonce:t,post_id:o};window.aipkit_apiRequest("aipkit_generate_title_suggestions",s).then(n=>{if(!n?.suggestions||n.suggestions.length===0)throw new Error(c.no_suggestions_title||"No title suggestions generated.");typeof r=="function"&&r(null,n.suggestions,i)}).catch(n=>{console.error("AIPKit Post Enhancer Fetcher (Title):",n),typeof r=="function"&&r(n,null,i)})}window.aipkit_fetchTitleSuggestions=k})();(function(){"use strict";let k=null;function o(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTitleUpdateFlag=="function"&&window.aipkit_resetTitleUpdateFlag()}function r(t,c,s){k&&o();let n=window.aipkit_escapeHtml||function(u){return u},d=window.aipkit_escapeAttribute||n,a=s?.default_ai_provider||"N/A",l=s?.default_ai_model||"N/A",p=s?.default_ai_params||{},_=p.temperature!==void 0?parseFloat(p.temperature).toFixed(1):"N/A",g=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${n(a)}</strong>`).replace("%2$s",`<strong>${n(l)}</strong>`).replace("%3$s",n(_));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",u=>{u.target===k&&o()});let m=document.createElement("div");return m.className="aipkit-modal-content",m.dataset.postId=t,m.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${n(c.modal_title_title||"Title Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content"> <?php // Wrapper for loading state ?>
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${n(c.loading_title||"Generating Titles...")} <?php // Use title text ?>
                    </div>
                    <p class="aipkit_modal-loading-info">${g}</p> <?php // Display AI info ?>
                </div>
            </div>
        `,k.appendChild(m),document.body.appendChild(k),m.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(t,c){if(!k)return;let s=k.querySelector(".aipkit-modal-body");if(!s)return;let n=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||n;s.innerHTML=`
            <p>${n(c.select_title||"Click a title to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(l=>`<li data-new-title="${d(l)}">${n(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div> <?php // Empty status div for potential update messages ?>
        `;let a=s.querySelector(".aipkit-suggestions-list");a&&typeof window.aipkit_attachSuggestionClickListener=="function"?window.aipkit_attachSuggestionClickListener(a):console.error("Post Title Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,c){if(!k)return;let s=k.querySelector(".aipkit-modal-body");if(!s)return;let n=window.aipkit_escapeHtml||function(d){return d};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${n(c.error_loading_title||"Error loading title suggestions.")}</p>
                 <p><small>${n(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingModal=r,window.aipkit_updateModalWithSuggestions=i,window.aipkit_updateModalWithError=e,window.aipkit_closePostTitleModal=o})();(function(){"use strict";let k=!1;function o(){k=!1}function r(t){if(k)return;k=!0;let c=t.currentTarget,s=c.closest(".aipkit-modal-content"),n=s?.dataset.postId,d=c.dataset.newTitle,a=s?.querySelector(".aipkit-modal-status"),l=s?.querySelectorAll(".aipkit-suggestions-list li"),p=window.aipkit_post_enhancer?.text||{};if(!n||!d||!a||!l){console.error("AIPKit Post Enhancer Updater: Missing data for title update."),a&&(a.innerHTML='<span style="color: red;">Error: Cannot update title.</span>'),k=!1;return}l.forEach(_=>_.classList.add("aipkit-disabled")),a.innerHTML=`<span class="aipkit_spinner"></span> ${p.updating_title||"Updating Title..."}`,a.style.color="",i(n,d,a,l,p)}function i(t,c,s,n,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTitleModal!="function"){console.error("Post Title Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',n.forEach(p=>p.classList.remove("aipkit-disabled")),k=!1;return}let a=window.aipkit_post_enhancer?.nonce_update_title;if(!a){console.error("AIPKit Post Enhancer Updater (Title): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',n.forEach(p=>p.classList.remove("aipkit-disabled")),k=!1;return}let l={_ajax_nonce:a,post_id:t,new_value:c};window.aipkit_apiRequest("aipkit_update_post_title",l).then(p=>{let _=document.querySelector(`#post-${t} .row-title`);_?_.textContent=c:console.warn(`AIPKit Post Enhancer Updater: Could not find visible title element for post ${t}.`);let f=document.getElementById(`post-${t}`);if(f){let g=f.querySelector(`#inline_${t}`);if(g){let m=g.querySelector(".post_title");m?m.textContent=c:console.warn(`AIPKit Post Enhancer Updater: Quick Edit div not found for post ${t}.`)}else console.warn(`AIPKit Post Enhancer Updater: Inline data container not found for post ${t}.`)}window.aipkit_closePostTitleModal()}).catch(p=>{console.error("AIPKit Post Enhancer Update Error (Title):",p),s.innerHTML=`<span class="error">${p.message||d.error_updating_title||"Error updating title."}</span>`,n.forEach(_=>_.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function e(t){t&&t.addEventListener("click",function(c){let s=c.target.closest("li[data-new-title]");s&&r({currentTarget:s})})}window.aipkit_attachSuggestionClickListener=e,window.aipkit_resetTitleUpdateFlag=o})();(function(){"use strict";function k(o,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Excerpt Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_excerpt,c=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Excerpt): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let s={_ajax_nonce:t,post_id:o};window.aipkit_apiRequest("aipkit_generate_excerpt_suggestions",s).then(n=>{if(!n?.suggestions||n.suggestions.length===0)throw new Error(c.no_suggestions_excerpt||"No excerpt suggestions generated.");typeof r=="function"&&r(null,n.suggestions,i)}).catch(n=>{console.error("AIPKit Post Enhancer Fetcher (Excerpt):",n),typeof r=="function"&&r(n,null,i)})}window.aipkit_fetchExcerptSuggestions=k})();(function(){"use strict";let k=null;function o(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetExcerptUpdateFlag=="function"&&window.aipkit_resetExcerptUpdateFlag()}function r(t,c,s){k&&o();let n=window.aipkit_escapeHtml||function(u){return u},d=window.aipkit_escapeAttribute||n,a=s?.default_ai_provider||"N/A",l=s?.default_ai_model||"N/A",p=s?.default_ai_params||{},_=p.temperature!==void 0?parseFloat(p.temperature).toFixed(1):"N/A",g=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${n(a)}</strong>`).replace("%2$s",`<strong>${n(l)}</strong>`).replace("%3$s",n(_));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",u=>{u.target===k&&o()});let m=document.createElement("div");return m.className="aipkit-modal-content",m.dataset.postId=t,m.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${n(c.modal_title_excerpt||"Excerpt Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${n(c.loading_excerpt||"Generating Excerpts...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${g}</p>
                </div>
            </div>
        `,k.appendChild(m),document.body.appendChild(k),m.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(t,c){if(!k)return;let s=k.querySelector(".aipkit-modal-body");if(!s)return;let n=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||n;s.innerHTML=`
            <p>${n(c.select_excerpt||"Click an excerpt to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(l=>`<li data-new-excerpt="${d(l)}">${n(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let a=s.querySelector(".aipkit-suggestions-list");a&&typeof window.aipkit_attachExcerptSuggestionClickListener=="function"?window.aipkit_attachExcerptSuggestionClickListener(a):console.error("Post Excerpt Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,c){if(!k)return;let s=k.querySelector(".aipkit-modal-body");if(!s)return;let n=window.aipkit_escapeHtml||function(d){return d};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${n(c.error_loading_excerpt||"Error loading excerpt suggestions.")}</p>
                 <p><small>${n(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingExcerptModal=r,window.aipkit_updateModalWithExcerptSuggestions=i,window.aipkit_updateModalWithErrorExcerpt=e,window.aipkit_closePostExcerptModal=o})();(function(){"use strict";let k=!1;function o(){k=!1}function r(t){if(k)return;k=!0;let c=t.currentTarget,s=c.closest(".aipkit-modal-content"),n=s?.dataset.postId,d=c.dataset.newExcerpt,a=s?.querySelector(".aipkit-modal-status"),l=s?.querySelectorAll(".aipkit-suggestions-list li"),p=window.aipkit_post_enhancer?.text||{};if(!n||d===void 0||!a||!l){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing data for excerpt update.",{postId:n,newExcerpt:d,statusDiv:a,listItems:l}),a&&(a.innerHTML='<span style="color: red;">Error: Cannot update excerpt.</span>'),k=!1;return}l.forEach(_=>_.classList.add("aipkit-disabled")),a.innerHTML=`<span class="aipkit_spinner"></span> ${p.updating_excerpt||"Updating Excerpt..."}`,a.style.color="",i(n,d,a,l,p)}function i(t,c,s,n,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostExcerptModal!="function"){console.error("Post Excerpt Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',n.forEach(p=>p.classList.remove("aipkit-disabled")),k=!1;return}let a=window.aipkit_post_enhancer?.nonce_update_excerpt;if(!a){console.error("AIPKit Post Enhancer Updater (Excerpt): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',n.forEach(p=>p.classList.remove("aipkit-disabled")),k=!1;return}let l={_ajax_nonce:a,post_id:t,new_value:c};window.aipkit_apiRequest("aipkit_update_post_excerpt",l).then(p=>{window.aipkit_closePostExcerptModal()}).catch(p=>{console.error("AIPKit Post Enhancer Update Error (Excerpt):",p),s.innerHTML=`<span class="error">${p.message||d.error_updating_excerpt||"Error updating excerpt."}</span>`,n.forEach(_=>_.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function e(t){t&&t.addEventListener("click",function(c){let s=c.target.closest("li[data-new-excerpt]");s&&r({currentTarget:s})})}window.aipkit_attachExcerptSuggestionClickListener=e,window.aipkit_resetExcerptUpdateFlag=o})();(function(){"use strict";function k(o,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Post Meta Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_meta,c=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Meta): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let s={_ajax_nonce:t,post_id:o};window.aipkit_apiRequest("aipkit_generate_meta_suggestions",s).then(n=>{if(!n?.suggestions||n.suggestions.length===0)throw new Error(c.no_suggestions_meta||"No meta description suggestions generated.");typeof r=="function"&&r(null,n.suggestions,i)}).catch(n=>{console.error("AIPKit Post Enhancer Fetcher (Meta):",n),typeof r=="function"&&r(n,null,i)})}window.aipkit_fetchMetaSuggestions=k})();(function(){"use strict";let k=null;function o(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetMetaUpdateFlag=="function"&&window.aipkit_resetMetaUpdateFlag()}function r(t,c,s){k&&o();let n=window.aipkit_escapeHtml||function(u){return u},d=window.aipkit_escapeAttribute||n,a=s?.default_ai_provider||"N/A",l=s?.default_ai_model||"N/A",p=s?.default_ai_params||{},_=p.temperature!==void 0?parseFloat(p.temperature).toFixed(1):"N/A",g=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${n(a)}</strong>`).replace("%2$s",`<strong>${n(l)}</strong>`).replace("%3$s",n(_));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",u=>{u.target===k&&o()});let m=document.createElement("div");return m.className="aipkit-modal-content",m.dataset.postId=t,m.innerHTML=`
            <div class="aipkit-modal-header">
                <h3 class="aipkit-modal-title">${n(c.modal_title_meta||"Meta Description Suggestions")}</h3>
                <button type="button" class="aipkit-modal-close-btn" aria-label="${d(c.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body">
                <div class="aipkit-modal-loading-content">
                    <div class="aipkit-modal-status" style="text-align: center;">
                        <span class="aipkit_spinner"></span> ${n(c.loading_meta||"Generating Meta Descriptions...")}
                    </div>
                    <p class="aipkit_modal-loading-info">${g}</p>
                </div>
            </div>
        `,k.appendChild(m),document.body.appendChild(k),m.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>{k.classList.add("aipkit-active")}),k}function i(t,c){if(!k)return;let s=k.querySelector(".aipkit-modal-body");if(!s)return;let n=window.aipkit_escapeHtml||function(l){return l},d=window.aipkit_escapeAttribute||n;s.innerHTML=`
            <p>${n(c.select_meta||"Click a meta description to apply:")}</p>
            <ul class="aipkit-suggestions-list">
                ${t.map(l=>`<li data-new-meta="${d(l)}">${n(l)}</li>`).join("")}
            </ul>
             <div class="aipkit-modal-status"></div>
        `;let a=s.querySelector(".aipkit-suggestions-list");a&&typeof window.aipkit_attachMetaSuggestionClickListener=="function"?window.aipkit_attachMetaSuggestionClickListener(a):console.error("Post Meta Modal: Suggestion list or click handler attachment function missing after update.")}function e(t,c){if(!k)return;let s=k.querySelector(".aipkit-modal-body");if(!s)return;let n=window.aipkit_escapeHtml||function(d){return d};s.innerHTML=`
            <div class="aipkit-modal-error">
                 <p>${n(c.error_loading_meta||"Error loading meta description suggestions.")}</p>
                 <p><small>${n(t)}</small></p>
            </div>
        `}window.aipkit_showLoadingMetaModal=r,window.aipkit_updateModalWithMetaSuggestions=i,window.aipkit_updateModalWithErrorMeta=e,window.aipkit_closePostMetaModal=o})();(function(){"use strict";let k=!1;function o(){k=!1}function r(t){if(k)return;k=!0;let c=t.currentTarget,s=c.closest(".aipkit-modal-content"),n=s?.dataset.postId,d=c.dataset.newMeta,a=s?.querySelector(".aipkit-modal-status"),l=s?.querySelectorAll(".aipkit-suggestions-list li"),p=window.aipkit_post_enhancer?.text||{};if(!n||d===void 0||!a||!l){console.error("AIPKit Post Enhancer Updater (Meta): Missing data for meta description update.",{postId:n,newMetaDesc:d,statusDiv:a,listItems:l}),a&&(a.innerHTML='<span style="color: red;">Error: Cannot update meta description.</span>'),k=!1;return}l.forEach(_=>_.classList.add("aipkit-disabled")),a.innerHTML=`<span class="aipkit_spinner"></span> ${p.updating_meta||"Updating Meta Desc..."}`,a.style.color="",i(n,d,a,l,p)}function i(t,c,s,n,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostMetaModal!="function"||typeof window.aipkit_escapeHtml!="function"){console.error("Post Meta Updater: Missing required API, modal close, or escaper functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',n.forEach(p=>p.classList.remove("aipkit-disabled")),k=!1;return}let a=window.aipkit_post_enhancer?.nonce_update_meta;if(!a){console.error("AIPKit Post Enhancer Updater (Meta): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',n.forEach(p=>p.classList.remove("aipkit-disabled")),k=!1;return}let l={_ajax_nonce:a,post_id:t,new_value:c};window.aipkit_apiRequest("aipkit_update_post_meta_desc",l).then(p=>{try{let g=`${`#post-${t}`} .column-wpseo-metadesc`,m=document.querySelector(g);m&&(m.textContent=window.aipkit_escapeHtml(c),m.style.transition="background-color 0.1s ease-out",m.style.backgroundColor="#f0f7ff",setTimeout(()=>{m.style.backgroundColor=""},300))}catch(_){console.error("AIPKit Post Enhancer UI Update: Error updating Yoast column.",_)}window.aipkit_closePostMetaModal()}).catch(p=>{console.error("AIPKit Post Enhancer Update Error (Meta):",p),s.innerHTML=`<span class="error">${p.message||d.error_updating_meta||"Error updating meta description."}</span>`,n.forEach(_=>_.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function e(t){t&&t.addEventListener("click",function(c){let s=c.target.closest("li[data-new-meta]");s&&r({currentTarget:s})})}window.aipkit_attachMetaSuggestionClickListener=e,window.aipkit_resetMetaUpdateFlag=o})();(function(){"use strict";function k(o,r,i){if(typeof window.aipkit_apiRequest!="function"){console.error("Tags Fetcher: Missing required API function."),typeof r=="function"&&r(new Error("API function missing."),null,i);return}let e=window.aipkit_post_enhancer,t=e?.nonce_generate_tags,c=e?.text||{};if(!t){console.error("AIPKit Post Enhancer Fetcher (Tags): Missing nonce."),typeof r=="function"&&r(new Error("Configuration missing (nonce)."),null,i);return}let s={_ajax_nonce:t,post_id:o};window.aipkit_apiRequest("aipkit_generate_tags_suggestions",s).then(n=>{if(!n?.suggestions||n.suggestions.length===0)throw new Error(c.no_suggestions_tags||"No tag suggestions generated.");typeof r=="function"&&r(null,n.suggestions,i)}).catch(n=>{console.error("AIPKit Post Enhancer Fetcher (Tags):",n),typeof r=="function"&&r(n,null,i)})}window.aipkit_fetchTagsSuggestions=k})();(function(){"use strict";let k=null;function o(){k&&(k.classList.remove("aipkit-active"),k.addEventListener("transitionend",()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},{once:!0}),setTimeout(()=>{k?.parentNode&&k.parentNode.removeChild(k),k=null},500)),typeof window.aipkit_resetTagsUpdateFlag=="function"&&window.aipkit_resetTagsUpdateFlag()}function r(t,c,s){k&&o();let n=window.aipkit_escapeHtml||(u=>u),d=window.aipkit_escapeAttribute||n,a=s?.default_ai_provider||"N/A",l=s?.default_ai_model||"N/A",p=s?.default_ai_params||{},_=p.temperature!==void 0?parseFloat(p.temperature).toFixed(1):"N/A",g=(c.loading_info_template||"Using <strong>%1$s</strong> (Model: <strong>%2$s</strong>, Temp: %3$s)").replace("%1$s",`<strong>${n(a)}</strong>`).replace("%2$s",`<strong>${n(l)}</strong>`).replace("%3$s",n(_));k=document.createElement("div"),k.className="aipkit-modal-overlay",k.addEventListener("click",u=>{u.target===k&&o()});let m=document.createElement("div");return m.className="aipkit-modal-content",m.dataset.postId=t,m.innerHTML=`
        <div class="aipkit-modal-header">
            <h3 class="aipkit-modal-title">${n(c.modal_title_tags||"Tag Suggestions")}</h3>
            <button type="button" class="aipkit-modal-close-btn" aria-label="${d(c.close||"Close")}">\xD7</button>
        </div>
        <div class="aipkit-modal-body">
            <div class="aipkit-modal-loading-content">
                <div class="aipkit-modal-status" style="text-align: center;">
                    <span class="aipkit_spinner"></span> ${n(c.loading_tags||"Generating Tags...")}
                </div>
                <p class="aipkit_modal-loading-info">${g}</p>
            </div>
        </div>
    `,k.appendChild(m),document.body.appendChild(k),m.querySelector(".aipkit-modal-close-btn").addEventListener("click",o),requestAnimationFrame(()=>k.classList.add("aipkit-active")),k}function i(t,c){if(!k)return;let s=k.querySelector(".aipkit-modal-body");if(!s)return;let n=window.aipkit_escapeHtml||(l=>l),d=window.aipkit_escapeAttribute||n;s.innerHTML=`
        <p>${n(c.select_tags||"Click a tag set to apply:")}</p>
        <ul class="aipkit-suggestions-list">
            ${t.map(l=>`<li data-new-tags="${d(l)}">${n(l)}</li>`).join("")}
        </ul>
        <div class="aipkit-modal-status"></div>
    `;let a=s.querySelector(".aipkit-suggestions-list");a&&typeof window.aipkit_attachTagsSuggestionClickListener=="function"?window.aipkit_attachTagsSuggestionClickListener(a):console.error("Post Tags Modal: Suggestion list or click handler attachment function missing.")}function e(t,c){if(!k)return;let s=k.querySelector(".aipkit-modal-body");if(!s)return;let n=window.aipkit_escapeHtml||(d=>d);s.innerHTML=`
        <div class="aipkit-modal-error">
             <p>${n(c.error_loading_tags||"Error loading tag suggestions.")}</p>
             <p><small>${n(t)}</small></p>
        </div>
    `}window.aipkit_showLoadingTagsModal=r,window.aipkit_updateModalWithTagsSuggestions=i,window.aipkit_updateModalWithErrorTags=e,window.aipkit_closePostTagsModal=o})();(function(){"use strict";let k=!1;function o(){k=!1}function r(t){if(k)return;k=!0;let c=t.currentTarget,s=c.closest(".aipkit-modal-content"),n=s?.dataset.postId,d=c.dataset.newTags,a=s?.querySelector(".aipkit-modal-status"),l=s?.querySelectorAll(".aipkit-suggestions-list li"),p=window.aipkit_post_enhancer?.text||{};if(!n||d===void 0||!a||!l){console.error("AIPKit Post Enhancer Updater (Tags): Missing data for tags update.",{postId:n,newTags:d,statusDiv:a,listItems:l}),a&&(a.innerHTML='<span style="color: red;">Error: Cannot update tags.</span>'),k=!1;return}l.forEach(_=>_.classList.add("aipkit-disabled")),a.innerHTML=`<span class="aipkit_spinner"></span> ${p.updating_tags||"Updating Tags..."}`,a.style.color="",i(n,d,a,l,p)}function i(t,c,s,n,d){if(typeof window.aipkit_apiRequest!="function"||typeof window.aipkit_closePostTagsModal!="function"){console.error("Post Tags Updater: Missing required API or modal close functions."),s.innerHTML='<span class="error">Error: Configuration missing.</span>',n.forEach(p=>p.classList.remove("aipkit-disabled")),k=!1;return}let a=window.aipkit_post_enhancer?.nonce_update_tags;if(!a){console.error("AIPKit Post Enhancer Updater (Tags): Missing nonce for update."),s.innerHTML='<span class="error">Error: Configuration missing (nonce).</span>',n.forEach(p=>p.classList.remove("aipkit-disabled")),k=!1;return}let l={_ajax_nonce:a,post_id:t,new_value:c};window.aipkit_apiRequest("aipkit_update_post_tags",l).then(p=>{let _=document.getElementById(`post-${t}`);if(_){let f=_.querySelector(".column-tags");f&&(f.textContent=c.split(",").join(", "))}window.aipkit_closePostTagsModal()}).catch(p=>{console.error("AIPKit Post Enhancer Update Error (Tags):",p),s.innerHTML=`<span class="error">${p.message||d.error_updating_tags||"Error updating tags."}</span>`,n.forEach(_=>_.classList.remove("aipkit-disabled"))}).finally(()=>{k=!1})}function e(t){t&&t.addEventListener("click",function(c){let s=c.target.closest("li[data-new-tags]");s&&r({currentTarget:s})})}window.aipkit_attachTagsSuggestionClickListener=e,window.aipkit_resetTagsUpdateFlag=o})();(function(){"use strict";function k(o,r,i){let t=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorTags(o.message||t.error_loading_tags,t):r?window.aipkit_updateModalWithTagsSuggestions(r,t):window.aipkit_updateModalWithErrorTags(t.error_loading_tags||"Unknown error occurred.",t)}window.aipkit_handleTagsSuggestionsResult=k})();(function(){"use strict";window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}})();(function(){"use strict";function k(n,d=60){return n.length<=d?n:n.substring(0,d-3)+"..."}function o(n,d="info"){let a=document.getElementById("aipkit-enhancer-bulk-status-log");if(a){let l=document.createElement("div");l.className=`aipkit_enhancer_bulk_log-entry aipkit_enhancer_bulk_log--${d}`,l.textContent=n,a.appendChild(l),a.scrollTop=a.scrollHeight}}function r(){let n=document.getElementById("aipkit-enhancer-bulk-progress-bar"),d=document.getElementById("aipkit-enhancer-progress-text"),a=document.getElementById("aipkit-enhancer-progress-stats");if(n&&window.aipkit_enhancer_bulkState.total>0){let l=window.aipkit_enhancer_bulkState.completed,p=window.aipkit_enhancer_bulkState.failed,_=window.aipkit_enhancer_bulkState.total,f=l+p,g=Math.round(f/_*100);n.style.width=`${g}%`,d&&(f===_?d.textContent="Update complete!":d.textContent=`Processing ${f+1} of ${_}...`),a&&(p>0?a.innerHTML=`${g}% \u2022 <span style="color: #28a745;">${l} successful</span> \u2022 <span style="color: #dc3545;">${p} failed</span>`:a.textContent=`${g}%`)}}function i(n){let d=document.getElementById("aipkit-enhancer-bulk-status-log");if(!d)return;let l=(window.aipkit_enhancer_postTitles||{})[n]||`Post #${n}`;l=k(l,60);let p=document.createElement("div");p.className="aipkit_enhancer_post_steps",p.id=`aipkit_enhancer_post_${n}_steps`;let _=document.createElement("div");_.className="aipkit_enhancer_post_header",_.innerHTML=`<strong>${l}</strong>`;let f=document.createElement("div");f.className="aipkit_enhancer_steps_container",f.id=`aipkit_enhancer_steps_${n}`,p.appendChild(_),p.appendChild(f),d.appendChild(p),d.scrollTop=d.scrollHeight;let g=[],m=window.aipkit_enhancer_bulkState?.enhancementsConfig||{};["keyword","title","excerpt","content","meta","tags"].forEach(u=>{m[u]&&m[u].prompt&&g.push({field:u,display_name:u.charAt(0).toUpperCase()+u.slice(1).replace("_"," ")})}),m.generate_seo_slug==="1"&&g.push({field:"slug",display_name:"URL"}),g.forEach(u=>{let h=document.createElement("div");h.className="aipkit_enhancer_step aipkit_enhancer_step--pending",h.id=`aipkit_enhancer_step_${n}_${u.field}`,h.innerHTML=`
        <span class="aipkit_enhancer_step_icon">\u23F3</span>
        <span class="aipkit_enhancer_step_name">${u.display_name}</span>
        <span class="aipkit_enhancer_step_status">Pending</span>
      `,f.appendChild(h)})}function e(n,d,a,l=""){let p=document.getElementById(`aipkit_enhancer_step_${n}_${d}`);if(!p)return;p.className=`aipkit_enhancer_step aipkit_enhancer_step--${a}`;let _="\u23F3",f="Pending";switch(a){case"processing":_="\u{1F504}",f="Processing...";break;case"completed":_="\u2705",f="Completed";break;case"error":_="\u274C",f="Failed";break;case"pending":_="\u23F3",f="Pending";break}p.querySelector(".aipkit_enhancer_step_icon").textContent=_,p.querySelector(".aipkit_enhancer_step_status").textContent=f,l&&(p.title=l);let g=document.getElementById("aipkit-enhancer-bulk-status-log");g&&(g.scrollTop=g.scrollHeight)}function t(n,d,a){let l=document.getElementById(`aipkit_enhancer_steps_${n}`);if(!l||a.length===0)return;let p=d.length+a.length,_=document.createElement("div");_.className="aipkit_enhancer_completion_message",d.length===0?_.innerHTML=`<strong style="color: #dc3545;">\u274C All ${p} enhancement steps failed!</strong>`:_.innerHTML=`<strong style="color: #ff8c00;">\u26A0\uFE0F Completed ${d.length} of ${p} steps. ${a.length} failed.</strong>`,l.appendChild(_);let f=document.getElementById("aipkit-enhancer-bulk-status-log");f&&(f.scrollTop=f.scrollHeight)}function c(n,d){let a=document.getElementById(`aipkit_enhancer_steps_${n}`);if(!a)return;d.forEach(f=>{let g=document.getElementById(`aipkit_enhancer_step_${n}_${f.field}`);if(g){g.className=`aipkit_enhancer_step aipkit_enhancer_step--${f.status}`;let m="\u23F3";switch(f.status){case"completed":m="\u2705";break;case"error":m="\u274C";break;case"processing":m="\u{1F504}";break;case"pending":m="\u23F3";break}g.querySelector(".aipkit_enhancer_step_icon").textContent=m,g.querySelector(".aipkit_enhancer_step_status").textContent=f.status.charAt(0).toUpperCase()+f.status.slice(1),f.message&&(g.title=f.message)}});let l=d.filter(f=>f.status==="completed").length,p=d.length;if(l!==p){let f=document.createElement("div");f.className="aipkit_enhancer_completion_message";let g=d.filter(m=>m.status==="error").length;f.innerHTML=`<strong style="color: #dc3545;">\u26A0\uFE0F Completed ${l} of ${p} steps. ${g} failed.</strong>`,a.appendChild(f)}let _=document.getElementById("aipkit-enhancer-bulk-status-log");_&&(_.scrollTop=_.scrollHeight)}function s(n,d){let a=document.getElementById(`aipkit_enhancer_steps_${n}`);if(!a)return;a.querySelectorAll(".aipkit_enhancer_step").forEach(f=>{f.classList.contains("aipkit_enhancer_step--completed")||(f.className="aipkit_enhancer_step aipkit_enhancer_step--error",f.querySelector(".aipkit_enhancer_step_icon").textContent="\u274C",f.querySelector(".aipkit_enhancer_step_status").textContent="Failed",f.title=d)});let p=document.createElement("div");p.className="aipkit_enhancer_completion_message",p.innerHTML=`<strong style="color: #dc3545;">\u274C Enhancement failed: ${d}</strong>`,a.appendChild(p);let _=document.getElementById("aipkit-enhancer-bulk-status-log");_&&(_.scrollTop=_.scrollHeight)}window.aipkit_enhancer_logToModal=o,window.aipkit_enhancer_updateProgressBar=r,window.aipkit_enhancer_initStepProgress=i,window.aipkit_enhancer_updateFieldStatus=e,window.aipkit_enhancer_showPostCompletion=t,window.aipkit_enhancer_displayStepResults=c,window.aipkit_enhancer_showStepError=s,window.aipkit_enhancer_truncateTitle=k})();(function(){"use strict";function k(r="user"){if(!window.aipkit_enhancer_bulkState.isRunning)return;window.aipkit_enhancer_bulkState.isRunning=!1;let i=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!i)return;r==="user"&&typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal("Processing stopped by user.","info");let e=i.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");e&&(e.textContent="Start");let t=i.querySelector("#aipkit_bulk_enhancer_start_btn");t&&(t.disabled=!1,t.hidden=!0),i.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let c=i.querySelector("#aipkit_bulk_enhancer_cancel_btn");c&&(c.hidden=!1),i.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!1}function o(){let r=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!r)return;window.aipkit_enhancer_bulkState.isRunning&&k("user"),r.querySelector("#aipkit-enhancer-bulk-config").hidden=!1,r.querySelector("#aipkit-enhancer-bulk-progress").hidden=!0;let i=r.querySelector("#aipkit_bulk_enhancer_start_btn");i&&(i.disabled=!1,i.hidden=!1);let e=r.querySelector("#aipkit_bulk_enhancer_start_btn .aipkit_btn-text");e&&(e.textContent="Start"),r.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!0;let t=r.querySelector("#aipkit_bulk_enhancer_cancel_btn");t&&(t.hidden=!1),r.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0;let c=r.querySelector("#aipkit-enhancer-bulk-status-log");c&&(c.innerHTML="");let s=r.querySelector("#aipkit-enhancer-bulk-progress-bar");s&&(s.style.width="0%");let n=r.querySelector("#aipkit-enhancer-progress-text");n&&(n.textContent="Processing posts...");let d=r.querySelector("#aipkit-enhancer-progress-stats");d&&(d.textContent="0 of 0 (0%)"),window.aipkit_enhancer_bulkState={queue:[],isRunning:!1,completed:0,failed:0,total:0,enhancementsConfig:{}}}window.aipkit_enhancer_stopBulkProcess=k,window.aipkit_enhancer_returnToSettings=o})();(function(){"use strict";function k(c){let s=c.querySelector("#aipkit_bulk_ai_provider"),n=c.querySelector("#aipkit_bulk_ai_model"),d=c.querySelector(".aipkit_enhancer_reasoning_effort_field"),a=c.querySelector("#aipkit_bulk_reasoning_effort");if(!s||!n||!d||!a){d&&(d.style.display="none");return}let l=(s.value||"").toLowerCase(),_=(n.value||"").toLowerCase(),f=_.startsWith("o1")||_.startsWith("o3")||_.startsWith("o4"),g=_.includes("gpt-5");if(!(l==="openai"&&(f||g))){d.style.display="none";return}d.style.display="block",o(c,_)}function o(c,s){let n=c.querySelector("#aipkit_bulk_reasoning_effort");if(!n)return;let d=r(s),a=new Set(d.allowed),l=n.value||"";l==="minimal"&&(l="low"),Array.from(n.options).forEach(p=>{let _=a.has(p.value);p.hidden=!_,p.disabled=!_}),a.has(l)||(l=d.defaultValue),a.has(l)||(l=d.allowed[0]||""),l&&(n.value=l)}function r(c){return e(c)?{allowed:["high"],defaultValue:"high"}:c.includes("gpt-5.1")?{allowed:["none","low","medium","high"],defaultValue:"none"}:i(c)?{allowed:["none","low","medium","high","xhigh"],defaultValue:"medium"}:{allowed:["low","medium","high"],defaultValue:"medium"}}function i(c){let s=c.match(/gpt-5\.(\d+)/);if(s)return Number.parseInt(s[1],10)>=2;let n=c.match(/gpt-(\d+)/);return n?Number.parseInt(n[1],10)>=6:!1}function e(c){return/gpt-5(\.\d+)?-pro/.test(c)}function t(c,s){let n=c.value.toLowerCase(),a=(window.aipkit_dashboard?.models||{})[n]||[],l=window.aipkit_escapeHtml||(u=>u),p=window.wp?.i18n?.__||(u=>u),_=window.aipkit_dashboard?.recommendedModels?.[n]||[],f=Array.isArray(_)?_:[],g=new Set(f.map(u=>u?.id).filter(Boolean));if(s.innerHTML="",f.length>0){let u=document.createElement("optgroup");u.label=l(p("Recommended","gpt3-ai-content-generator")),f.forEach(h=>{h&&h.id&&u.appendChild(new Option(l(h.name||h.id),h.id))}),u.children.length>0&&s.appendChild(u)}if(n==="openai"&&typeof a=="object"&&!Array.isArray(a))Object.keys(a).forEach(u=>{let h=document.createElement("optgroup");h.label=l(u),Array.isArray(a[u])&&a[u].forEach(v=>{v&&v.id&&g.has(v.id)||v&&v.id&&h.appendChild(new Option(l(v.name||v.id),v.id))}),h.children.length>0&&s.appendChild(h)});else if(Array.isArray(a)){let u=f.length?document.createElement("optgroup"):null;u&&(u.label=l(p("All models","gpt3-ai-content-generator"))),a.forEach(h=>{if(!(h&&h.id&&g.has(h.id))&&h&&h.id){let v=new Option(l(h.name||h.id),h.id);u?u.appendChild(v):s.appendChild(v)}}),u&&u.children.length>0&&s.appendChild(u)}if(s.options.length===0)s.appendChild(new Option(l(`No models for ${c.value}`),"")),s.disabled=!0;else{s.disabled=!1;let u;switch(n){case"openai":u="gpt-4o-mini";break;case"google":u="gemini-1.5-flash-latest";break;case"openrouter":u="moonshotai/kimi-k2.5";break;case"claude":u="claude-opus-4-6",Array.isArray(a)&&a.length>0&&(a.some(v=>v&&v.id==="claude-opus-4-6")||(u=a[0].id||null));break;case"azure":case"deepseek":case"ollama":Array.isArray(a)&&a.length>0?u=a[0].id||null:u=null;break;default:u=null;break}u&&s.querySelector(`option[value="${CSS.escape(u)}"]`)?s.value=u:s.selectedIndex=0}let m=c.closest(".aipkit-enhancer-bulk-modal-overlay");m&&k(m)}window.aipkit_enhancer_populateBulkModels=t,window.aipkit_enhancer_toggleReasoningEffort=k})();(function(){"use strict";let k=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],o=t=>{let c=parseInt(t,10);if(Number.isFinite(c)){if(c>=1&&c<=k.length)return k[c-1];let s=k.find(n=>n.tokens===c);if(s)return s}return k[1]};async function r(){if(!window.aipkit_enhancer_bulkState.isRunning||window.aipkit_enhancer_bulkState.queue.length===0){typeof window.aipkit_enhancer_logToModal=="function"&&window.aipkit_enhancer_logToModal(`Update complete. Processed ${window.aipkit_enhancer_bulkState.total} posts. Success: ${window.aipkit_enhancer_bulkState.completed}, Failed: ${window.aipkit_enhancer_bulkState.failed}.`,"success"),typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess("complete");return}let t=window.aipkit_enhancer_bulkState.queue.shift();await i(t),typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),setTimeout(r,200)}async function i(t){try{let c=`enhancer-bulk-${t}-${Date.now()}`;typeof window.aipkit_enhancer_initStepProgress=="function"&&window.aipkit_enhancer_initStepProgress(t);let s=window.aipkit_post_enhancer?.nonce_generate_title;if(!s)throw new Error("Security nonce not found.");let n=window.aipkit_enhancer_bulkState.enhancementsConfig,d=["keyword","title","excerpt","content","meta","tags"],a=[];d.forEach(_=>{n[_]&&n[_].prompt&&a.push(_)});let l=[],p=[];for(let _ of a){if(!window.aipkit_enhancer_bulkState.isRunning)break;try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(t,_,"processing");let f={_ajax_nonce:s,post_id:t,field:_,enhancer_source:"post_enhancer",enhancements:JSON.stringify({[_]:n[_],ai_provider:n.ai_provider,ai_model:n.ai_model,temperature:n.temperature,max_tokens:n.max_tokens,reasoning_effort:n.reasoning_effort,enable_vector_store:n.enable_vector_store,vector_store_provider:n.vector_store_provider,vector_store_top_k:n.vector_store_top_k,openai_vector_store_ids:n.openai_vector_store_ids,pinecone_index_name:n.pinecone_index_name,qdrant_collection_name:n.qdrant_collection_name,vector_embedding_provider:n.vector_embedding_provider,vector_embedding_model:n.vector_embedding_model}),conversation_uuid:c},g=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",f,{timeout:18e4});typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(t,_,"completed",g.message),l.push(_)}catch(f){typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(t,_,"error",f.message||"Processing failed"),p.push(_),console.error(`Failed to process field ${_} for post ${t}:`,f)}}if(n.generate_seo_slug==="1"&&l.length>0)try{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(t,"slug","processing");let _={_ajax_nonce:s,post_id:t,action_type:"update_slug",enhancer_source:"post_enhancer"};await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",_,{timeout:3e4}),typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(t,"slug","completed","URL updated")}catch{typeof window.aipkit_enhancer_updateFieldStatus=="function"&&window.aipkit_enhancer_updateFieldStatus(t,"slug","error","URL update failed")}if(typeof window.aipkit_enhancer_showPostCompletion=="function"&&window.aipkit_enhancer_showPostCompletion(t,l,p),l.length>0)window.aipkit_enhancer_bulkState.completed++;else if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_logToModal=="function"){let f=(window.aipkit_enhancer_postTitles||{})[t]||`Post #${t}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(f=window.aipkit_enhancer_truncateTitle(f,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${f}". No fields were processed successfully.`,"error")}}catch(c){if(window.aipkit_enhancer_bulkState.failed++,typeof window.aipkit_enhancer_showStepError=="function"&&window.aipkit_enhancer_showStepError(t,c.message||"Unknown error"),typeof window.aipkit_enhancer_logToModal=="function"){let n=(window.aipkit_enhancer_postTitles||{})[t]||`Post #${t}`;typeof window.aipkit_enhancer_truncateTitle=="function"&&(n=window.aipkit_enhancer_truncateTitle(n,50)),window.aipkit_enhancer_logToModal(`Failed to enhance "${n}": ${c.message||"Unknown error"}`,"error")}}}function e(t){let c=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");if(!c)return;let s={},n=c.querySelectorAll('input[name="bulk_enhance_fields"]:checked');if(n.length===0){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select at least one field to update.","error");return}n.forEach(v=>{let S=v.value,q=c.querySelector(`#aipkit_bulk_prompt_${S}`);q&&(s[S]={prompt:q.value})});let d=c.querySelector("#aipkit_bulk_ai_provider").value,a=c.querySelector("#aipkit_bulk_ai_model").value,l=c.querySelector("#aipkit_bulk_ai_temperature").value,p=c.querySelector("#aipkit_bulk_content_max_tokens"),_=o(p?p.value:""),f=c.querySelector("#aipkit_bulk_reasoning_effort").value;if(!d||!a){typeof window.aipkit_enhancer_setHeaderStatus=="function"&&window.aipkit_enhancer_setHeaderStatus("Please select an AI Provider and Model.","error");return}s.ai_provider=d,s.ai_model=a,s.temperature=l,s.max_tokens=_.tokens,s.reasoning_effort=f;let g=c.querySelector("#aipkit_bulk_generate_seo_slug");g&&(s.generate_seo_slug=g.checked?"1":"0");let m=c.querySelector('input[name="enable_vector_store"]');if(m&&m.checked){if(s.enable_vector_store="1",s.vector_store_provider=c.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",s.vector_store_top_k=c.querySelector("#aipkit_bulk_vector_store_top_k")?.value||3,s.vector_store_provider==="openai"){let v=c.querySelector("#aipkit_bulk_openai_vector_store_ids");v&&(s.openai_vector_store_ids=Array.from(v.selectedOptions).map(S=>S.value))}else s.vector_store_provider==="pinecone"?s.pinecone_index_name=c.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":s.vector_store_provider==="qdrant"&&(s.qdrant_collection_name=c.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(s.vector_store_provider==="pinecone"||s.vector_store_provider==="qdrant")&&(s.vector_embedding_provider=c.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",s.vector_embedding_model=c.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else s.enable_vector_store="0";window.aipkit_enhancer_bulkState={queue:[...t],isRunning:!0,completed:0,failed:0,total:t.length,enhancementsConfig:s},c.querySelector("#aipkit-enhancer-bulk-config").hidden=!0,c.querySelector("#aipkit-enhancer-bulk-progress").hidden=!1;let u=c.querySelector("#aipkit_bulk_enhancer_start_btn");u&&(u.disabled=!0,u.hidden=!0),c.querySelector("#aipkit_bulk_enhancer_stop_btn").hidden=!1;let h=c.querySelector("#aipkit_bulk_enhancer_cancel_btn");h&&(h.hidden=!0),c.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").hidden=!0,typeof window.aipkit_enhancer_updateProgressBar=="function"&&window.aipkit_enhancer_updateProgressBar(),r()}window.aipkit_enhancer_startBulkProcess=e})();(function(){"use strict";let k={templates:[],currentTemplateId:null,initialConfigForSelectedTemplate:null,currentTemplateModified:!1,isSavingOrDeleting:!1,isAutosaving:!1,autosaveSuspended:!1,autosaveTimer:null,autosaveDelay:800,lastSavedConfig:null,headerStatusTimeout:null,modalElement:null},o="aipkit_bulk_enhancer_selected_template",r=window.aipkit_escapeHtml||function(C){return C},i=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],e=()=>String(window.aipkit_post_enhancer?.default_ai_provider||"").trim().toLowerCase(),t=C=>{let b=parseInt(C,10);if(Number.isFinite(b)){if(b>=1&&b<=i.length)return i[b-1];let x=i.find(T=>T.tokens===b);if(x)return x}return i[1]},c=C=>{let b=C?.content_max_tokens??C?.max_tokens??C?.max_completion_tokens??"",x=parseInt(b,10);if(Number.isFinite(x)){let O=x>=1&&x<=i.length,F=i.some(M=>M.tokens===x);return O||F?t(x):x<=i[0].tokens?i[0]:x<=i[1].tokens?i[1]:i[2]}let T=String(C?.content_length||"").trim().toLowerCase(),P=i.find(O=>O.key===T);if(P)return P;let H=parseInt(window.aipkit_post_enhancer?.default_ai_params?.max_completion_tokens??window.aipkit_post_enhancer?.default_ai_params?.max_tokens??"",10);return Number.isFinite(H)?H<=i[0].tokens?i[0]:H<=i[1].tokens?i[1]:i[2]:i[1]};function s(C){try{C&&String(C)!==""?localStorage.setItem(o,String(C)):localStorage.removeItem(o)}catch(b){console.warn("Failed to save template to localStorage:",b)}}function n(){try{return localStorage.getItem(o)}catch(C){return console.warn("Failed to load template from localStorage:",C),null}}function d(){let C=k.modalElement;if(!C)return{};let b={};["title","excerpt","content","meta","keyword","tags"].forEach(O=>{let F=C.querySelector(`#aipkit_bulk_enhance_${O}`),M=C.querySelector(`#aipkit_bulk_prompt_${O}`);F&&M&&(b[O]={enabled:F.checked?"1":"0",prompt:M.value})}),b.ai_provider=C.querySelector("#aipkit_bulk_ai_provider")?.value||"openai",b.ai_model=C.querySelector("#aipkit_bulk_ai_model")?.value||"",b.ai_temperature=C.querySelector("#aipkit_bulk_ai_temperature")?.value;let T=C.querySelector("#aipkit_bulk_content_max_tokens"),P=t(T?T.value:"");b.content_max_tokens=String(P.tokens),b.reasoning_effort=C.querySelector("#aipkit_bulk_reasoning_effort")?.value||"",b.generate_seo_slug=C.querySelector("#aipkit_bulk_generate_seo_slug")?.checked?"1":"0";let H=C.querySelector('input[name="enable_vector_store"]');if(H&&H.checked){if(b.enable_vector_store="1",b.vector_store_provider=C.querySelector("#aipkit_bulk_vector_store_provider")?.value||"openai",b.vector_store_top_k=C.querySelector("#aipkit_bulk_vector_store_top_k")?.value||"3",b.vector_store_provider==="openai"){let O=C.querySelector("#aipkit_bulk_openai_vector_store_ids");O&&(b.openai_vector_store_ids=Array.from(O.selectedOptions).map(F=>F.value))}else b.vector_store_provider==="pinecone"?b.pinecone_index_name=C.querySelector("#aipkit_bulk_pinecone_index_name")?.value||"":b.vector_store_provider==="qdrant"&&(b.qdrant_collection_name=C.querySelector("#aipkit_bulk_qdrant_collection_name")?.value||"");(b.vector_store_provider==="pinecone"||b.vector_store_provider==="qdrant")&&(b.vector_embedding_provider=C.querySelector("#aipkit_bulk_vector_embedding_provider")?.value||"openai",b.vector_embedding_model=C.querySelector("#aipkit_bulk_vector_embedding_model")?.value||"")}else b.enable_vector_store="0";return b}function a(C){k.autosaveSuspended=!0,k.currentTemplateId=C,s(C),window.aipkit_bulk_template_state&&(window.aipkit_bulk_template_state.currentTemplateId=C),typeof window.aipkit_updateBulkTemplatePickerSelection=="function"&&window.aipkit_updateBulkTemplatePickerSelection(C,k.modalElement);let b=k.templates.find(W=>String(W.id)===String(C)),x=b?JSON.parse(JSON.stringify(b.config)):{};if(!x.content_max_tokens&&x.content_length){let W=i.find(ee=>ee.key===String(x.content_length).toLowerCase());x.content_max_tokens=String(W?.tokens||i[1].tokens)}Object.prototype.hasOwnProperty.call(x,"content_length")&&delete x.content_length,k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(x));let T=k.modalElement;if(!T)return;let P=T.querySelector("#aipkit_bulk_ai_provider"),H=T.querySelector("#aipkit_bulk_ai_model"),O=T.querySelector("#aipkit_bulk_ai_temperature"),F=T.querySelector("#aipkit_bulk_ai_temperature_value"),M=T.querySelector("#aipkit_bulk_content_max_tokens"),B=T.querySelector("#aipkit_bulk_content_max_tokens_value"),V=T.querySelector("#aipkit_bulk_reasoning_effort");if(P){let W=e();P.value=x.ai_provider||W||"openai",P.dispatchEvent(new Event("change",{bubbles:!0}))}if(H&&x.ai_model&&setTimeout(()=>{H.querySelector(`option[value="${CSS.escape(x.ai_model)}"]`)&&(H.value=x.ai_model,H.dispatchEvent(new Event("change")))},150),O&&(O.value=x.ai_temperature||"1.0"),F&&(F.textContent=x.ai_temperature||"1.0"),M){let W=c(x),ee=Math.max(0,i.findIndex(ne=>ne.key===W.key));M.value=String(ee+1),B&&(B.textContent=`${W.words} words`)}V&&(V.value=x.reasoning_effort==="minimal"?"low":x.reasoning_effort||"",typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&window.aipkit_enhancer_toggleReasoningEffort(T)),["title","excerpt","content","meta","keyword","tags"].forEach(W=>{let ee=T.querySelector(`#aipkit_bulk_enhance_${W}`),ne=T.querySelector(`#aipkit_bulk_prompt_${W}`);if(ee&&ne){let z=x[W]?.enabled==="1";ee.checked!==z&&(ee.checked=z,ee.dispatchEvent(new Event("change"))),ne.value=x[W]?.prompt||ne.defaultValue}});let L=T.querySelector("#aipkit_bulk_generate_seo_slug");if(L){let W=x.generate_seo_slug==="1";L.checked!==W&&(L.checked=W,L.dispatchEvent(new Event("change")))}let U=T.querySelector('input[name="enable_vector_store"]');if(U&&(U.checked=x.enable_vector_store==="1",U.dispatchEvent(new Event("change"))),x.enable_vector_store==="1"){let W=T.querySelector("#aipkit_bulk_vector_store_provider");W&&(W.value=x.vector_store_provider||"openai",W.dispatchEvent(new Event("change",{bubbles:!0})));let ee=T.querySelector("#aipkit_bulk_vector_store_top_k");if(ee){ee.value=x.vector_store_top_k||"3";let ne=T.querySelector("#aipkit_bulk_vector_store_top_k_value");ne&&(ne.textContent=ee.value)}setTimeout(()=>{if(x.vector_store_provider==="openai"){let ne=T.querySelector("#aipkit_bulk_openai_vector_store_ids");ne&&Array.isArray(x.openai_vector_store_ids)&&Array.from(ne.options).forEach(z=>{z.selected=x.openai_vector_store_ids.includes(z.value)})}else if(x.vector_store_provider==="pinecone"){let ne=T.querySelector("#aipkit_bulk_pinecone_index_name");ne&&(ne.value=x.pinecone_index_name||"",ne.dispatchEvent(new Event("change",{bubbles:!0})))}else if(x.vector_store_provider==="qdrant"){let ne=T.querySelector("#aipkit_bulk_qdrant_collection_name");ne&&(ne.value=x.qdrant_collection_name||"",ne.dispatchEvent(new Event("change",{bubbles:!0})))}if(x.vector_store_provider==="pinecone"||x.vector_store_provider==="qdrant"){let ne=T.querySelector("#aipkit_bulk_vector_embedding_provider"),z=T.querySelector("#aipkit_bulk_vector_embedding_model");ne&&(ne.value=x.vector_embedding_provider||"openai",ne.dispatchEvent(new Event("change"))),z&&x.vector_embedding_model&&setTimeout(()=>{z.value=x.vector_embedding_model,z.dispatchEvent(new Event("change",{bubbles:!0}))},150)}},100)}k.currentTemplateModified=!1,p(),window.clearTimeout(k.autosaveTimer),k.autosaveTimer=null,window.setTimeout(()=>{k.lastSavedConfig=d(),k.autosaveSuspended=!1},200)}function l(){let C=d();k.currentTemplateModified=!window.aipkit_deepEqual(C,k.initialConfigForSelectedTemplate),p(),y()}function p(){let C=k.modalElement;if(!C)return;let b=C.querySelector("#aipkit_enhancer_template_select").value,x=b&&String(b)!=="";C.querySelector("#aipkit_enhancer_rename_template_btn").disabled=!x,C.querySelector("#aipkit_enhancer_delete_template_btn").disabled=!x}function _(){let C=k.modalElement;if(!C)return;let b=C.querySelector("#aipkit_enhancer_template_action_list"),x=C.querySelector("#aipkit_enhancer_template_inline_form"),T=C.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),P=C.querySelector("#aipkit_enhancer_template_name_input");b&&(b.style.display=""),x&&(x.style.display="none",delete x.dataset.mode),T&&(T.style.display="none"),P&&(P.value="")}function f(C,b=""){let x=k.modalElement;if(!x)return;let T=x.querySelector("#aipkit_enhancer_template_inline_form"),P=x.querySelector("#aipkit_enhancer_template_name_input"),H=x.querySelector("#aipkit_enhancer_template_action_list"),O=x.querySelector("#aipkit_enhancer_template_inline_delete_confirm");!T||!P||(H&&(H.style.display="none"),O&&(O.style.display="none"),T.style.display="flex",T.dataset.mode=C,P.value=b,P.focus())}function g(){_()}function m(C){let b=k.modalElement;if(!b)return;let x=b.querySelector("#aipkit_enhancer_template_inline_form"),T=b.querySelector("#aipkit_enhancer_template_inline_delete_confirm"),P=b.querySelector("#aipkit_enhancer_template_delete_confirm_text"),H=b.querySelector("#aipkit_enhancer_template_action_list");!T||!P||(x&&(x.style.display="none"),H&&(H.style.display="none"),T.style.display="flex",P.innerHTML=`Delete "<strong>${r(C)}</strong>"?`)}function u(){_()}function h(C,b="info"){v(C,b)}function v(C,b="info"){let x=k.modalElement?.querySelector("#aipkit_bulk_autosave_status");if(x){if(k.headerStatusTimeout&&(clearTimeout(k.headerStatusTimeout),k.headerStatusTimeout=null),!C){x.textContent="",x.className="aipkit_cw_save_status aipkit_enhancer_modal_status";return}x.textContent=r(C),x.className=`aipkit_cw_save_status aipkit_enhancer_modal_status aipkit_settings_message-${b}`,b==="success"&&(k.headerStatusTimeout=setTimeout(()=>{x.textContent="",x.className="aipkit_cw_save_status aipkit_enhancer_modal_status"},2500))}}function S(){let C=k.currentTemplateId;if(!C)return null;let b="",x=k.templates.find(P=>String(P.id)===String(C));if(x?.template_name&&(b=x.template_name),!b){let P=k.modalElement?.querySelector("#aipkit_enhancer_template_select");P?.selectedOptions?.length&&(b=P.selectedOptions[0].textContent.trim())}let T=parseInt(C,10);return!b||Number.isNaN(T)?null:{id:T,name:b}}async function q(){if(k.autosaveSuspended||k.isSavingOrDeleting||k.isAutosaving)return;let C=d();if(!C||k.lastSavedConfig&&window.aipkit_deepEqual(C,k.lastSavedConfig))return;let b=S();if(b){k.isAutosaving=!0,v("Saving...","info");try{let x=window.aipkit_post_enhancer?.nonce_manage_templates;if(!x)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:b.id,template_name:b.name,config:JSON.stringify(C),template_type:"enhancer",_ajax_nonce:x}),k.lastSavedConfig=JSON.parse(JSON.stringify(C)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(C)),k.currentTemplateModified=!1,p(),v("Saved","success")}catch(x){v(`Error: ${x.message||"Failed to save."}`,"error"),console.error("Bulk Enhancer Auto-Save Error:",x)}finally{k.isAutosaving=!1}}}function y(){k.autosaveSuspended||k.isSavingOrDeleting||k.currentTemplateId&&(k.autosaveTimer&&clearTimeout(k.autosaveTimer),k.autosaveTimer=setTimeout(()=>{k.autosaveTimer=null,q()},k.autosaveDelay))}async function E(){let C=k.modalElement.querySelector("#aipkit_enhancer_template_select");C.innerHTML='<option value="">Loading...</option>',C.disabled=!0;try{let b=window.aipkit_post_enhancer?.nonce_manage_templates;if(!b)throw new Error("Security nonce for templates not found.");let x=await window.aipkit_apiRequest("aipkit_list_cw_templates",{template_type:"enhancer",_ajax_nonce:b});k.templates=x.templates||[],C.innerHTML='<option value="">-- Select Template --</option>',k.templates.forEach(P=>{C.appendChild(new Option(r(P.template_name),P.id))}),C.disabled=!1;let T=n();T&&(k.templates.some(H=>String(H.id)===String(T))?(C.value=T,a(T)):s(null)),window.aipkit_bulk_template_state={templates:k.templates,currentTemplateId:k.currentTemplateId},typeof window.aipkit_renderBulkTemplatePicker=="function"&&window.aipkit_renderBulkTemplatePicker(k.modalElement)}catch(b){h("Error loading templates: "+b.message,"error")}}async function I(C,b){if(!k.isSavingOrDeleting){k.isSavingOrDeleting=!0,h("Saving template...","info");try{let x=d(),T=window.aipkit_post_enhancer?.nonce_manage_templates;if(!T)throw new Error("Security nonce for templates not found.");let P=await window.aipkit_apiRequest("aipkit_save_cw_template",{template_id:C,template_name:b,config:JSON.stringify(x),template_type:"enhancer",_ajax_nonce:T});h(P.message,"success"),await E(),k.modalElement.querySelector("#aipkit_enhancer_template_select").value=P.template_id,k.currentTemplateId=P.template_id,s(P.template_id),k.currentTemplateModified=!1,k.lastSavedConfig=JSON.parse(JSON.stringify(x)),k.initialConfigForSelectedTemplate=JSON.parse(JSON.stringify(x)),v("Saved","success"),p()}catch(x){h("Error saving: "+x.message,"error")}finally{k.isSavingOrDeleting=!1}}}async function w(){let C=k.modalElement.querySelector("#aipkit_enhancer_template_select").value;if(!(!C||k.isSavingOrDeleting)){k.isSavingOrDeleting=!0,h("Deleting...","info");try{let b=window.aipkit_post_enhancer?.nonce_manage_templates;if(!b)throw new Error("Security nonce for templates not found.");await window.aipkit_apiRequest("aipkit_delete_cw_template",{template_id:C,_ajax_nonce:b}),h("Template deleted.","success"),await E(),k.currentTemplateId=null;let x=n();x&&String(x)===String(C)&&s(null),k.lastSavedConfig=null,v("Template deleted","success"),p()}catch(b){h("Error deleting: "+b.message,"error")}finally{k.isSavingOrDeleting=!1}}}function A(C){k.modalElement=C;let b=C.querySelector("#aipkit_enhancer_template_select");b.addEventListener("change",B=>{v(""),_(),a(B.target.value)}),C.querySelector("#aipkit_enhancer_save_as_template_btn").addEventListener("click",()=>{f("new")}),C.querySelector("#aipkit_enhancer_rename_template_btn").addEventListener("click",()=>{let B=b.options[b.selectedIndex];k.currentTemplateId&&B&&f("rename",B.text)}),C.querySelector("#aipkit_enhancer_delete_template_btn").addEventListener("click",()=>{let B=b.options[b.selectedIndex];B&&m(B.text)});let x=C.querySelector("#aipkit_enhancer_template_inline_form"),T=C.querySelector("#aipkit_enhancer_template_save_inline_btn"),P=C.querySelector("#aipkit_enhancer_template_cancel_inline_btn"),H=C.querySelector("#aipkit_enhancer_template_name_input");T&&P&&x&&H&&(P.addEventListener("click",g),T.addEventListener("click",async()=>{let B=x.dataset.mode,V=H.value.trim();if(!V){typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal("Please enter a template name.",{title:"Template"}):alert("Please enter a template name.");return}if(B==="new")await I(0,V);else if(B==="rename"){let L=b.value;L&&await I(parseInt(L,10),V)}g()}));let O=C.querySelector("#aipkit_enhancer_template_confirm_delete_btn"),F=C.querySelector("#aipkit_enhancer_template_cancel_delete_btn");O&&F&&(F.addEventListener("click",u),O.addEventListener("click",async()=>{await w(),u()})),E(),typeof window.aipkit_initBulkTemplatePicker=="function"&&window.aipkit_initBulkTemplatePicker(C);let M=B=>{B.target?.id!=="aipkit_enhancer_template_select"&&l()};C.addEventListener("input",M),C.addEventListener("change",M)}window.aipkit_enhancer_initTemplateControls=A,window.aipkit_enhancer_setHeaderStatus=v})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(p){return p},o=p=>p||document.querySelector(".aipkit_enhancer_bulk_modal");function r(p){let _=o(p);return{root:_,select:_?.querySelector("#aipkit_enhancer_template_select")||null,button:_?.querySelector("#aipkit_enhancer_template_picker_btn")||null,label:_?.querySelector("#aipkit_enhancer_template_picker_label")||null,list:_?.querySelector("#aipkit_enhancer_template_picker_list")||null,search:_?.querySelector("#aipkit_enhancer_template_picker_search")||null,searchClear:_?.querySelector("#aipkit_enhancer_template_picker_search_clear")||null,popover:_?.querySelector("#aipkit_enhancer_template_picker_popover")||null}}function i(p,_){let f=[],g={};p.forEach(u=>{if(!(String(u.is_starter)==="1"||u.is_starter===!0))if(_&&u.user_id?.toString()===_)f.push(u);else{let v=u.display_name||`User ID: ${u.user_id}`;g[v]||(g[v]=[]),g[v].push(u)}}),f.sort((u,h)=>u.is_default==="1"?-1:h.is_default==="1"?1:u.template_name.localeCompare(h.template_name));let m={};return Object.keys(g).sort().forEach(u=>{m[u]=g[u].sort((h,v)=>h.template_name.localeCompare(v.template_name))}),{myTemplates:f,otherUsersTemplates:m}}function e(p){return p.is_default==="1"?"dashicons-star-filled":"dashicons-media-text"}function t(p,_){let{label:f}=r(_);if(!f||!p)return;let g=p.options[p.selectedIndex],m=g?g.text:k("Select template");f.textContent=m||k("Select template")}function c(p,_){if(!p)return;let f=String(_||"");p.querySelectorAll(".aipkit_cw_template_list_item").forEach(g=>{let u=(g.dataset.templateId||"")===f;g.classList.toggle("is-active",u),g.setAttribute("aria-selected",u?"true":"false")})}function s(p,_=""){let{select:f,list:g}=r(p);if(!f||!g)return;let m=window.aipkit_bulk_template_state?.templates||[],u=window.aipkit_dashboard?.currentUserId?.toString();if(g.innerHTML="",!m.length){let w=f.disabled&&f.options.length&&f.options[0].text.toLowerCase().includes("loading"),A=document.createElement("div");A.className="aipkit_cw_template_picker_empty",A.textContent=k(w?"Loading templates...":"No templates found."),g.appendChild(A),t(f,p);return}let h=i(m,u),v=document.createDocumentFragment(),S=_.toLowerCase().trim(),q=(w,A)=>{let C=document.createElement("div");if(C.className="aipkit_cw_template_group_label",A){let x=document.createElement("span");x.className=`dashicons ${A}`,x.setAttribute("aria-hidden","true"),C.appendChild(x)}let b=document.createElement("span");return b.textContent=k(w),C.appendChild(b),C},y=w=>{let A=document.createElement("button");A.type="button",A.className="aipkit_cw_template_list_item",w.is_default==="1"&&A.classList.add("is-default"),A.dataset.templateId=String(w.id),A.dataset.templateLabel=w.template_name.toLowerCase(),A.setAttribute("role","option"),A.setAttribute("aria-selected","false");let C=e(w),b=document.createElement("span");b.className=`aipkit_cw_template_list_icon dashicons ${C}`,b.setAttribute("aria-hidden","true");let x=document.createElement("span");x.className="aipkit_cw_template_list_content";let T=document.createElement("span");T.className="aipkit_cw_template_list_name",T.textContent=k(w.template_name),x.appendChild(T);let P=document.createElement("span");return P.className="aipkit_cw_template_list_check dashicons dashicons-yes",P.setAttribute("aria-hidden","true"),A.appendChild(b),A.appendChild(x),A.appendChild(P),A},E=(w,A,C)=>{let b=S?A.filter(T=>T.template_name.toLowerCase().includes(S)):A;if(!b.length)return 0;let x=document.createElement("div");return x.className="aipkit_cw_template_group",x.appendChild(q(w,C)),b.forEach(T=>{x.appendChild(y(T))}),v.appendChild(x),b.length},I=0;if(I+=E("My Templates",h.myTemplates,"dashicons-admin-users"),Object.keys(h.otherUsersTemplates).forEach(w=>{I+=E(w,h.otherUsersTemplates[w],"dashicons-groups")}),I===0){let w=document.createElement("div");w.className="aipkit_cw_template_picker_empty",w.textContent=k(S?"No templates match your search.":"No templates found."),g.appendChild(w)}else g.appendChild(v);t(f,p),c(g,f.value)}function n(p,_){s(p,_)}function d(p){let{search:_,searchClear:f,popover:g}=r(p);if(!_)return;let m=null;_.addEventListener("input",u=>{let h=u.target.value;f&&(f.style.display=h?"flex":"none"),clearTimeout(m),m=setTimeout(()=>{n(p,h)},150)}),f&&f.addEventListener("click",()=>{_.value="",f.style.display="none",n(p,""),_.focus()}),g&&new MutationObserver(h=>{h.forEach(v=>{v.attributeName==="aria-hidden"&&g.getAttribute("aria-hidden")==="true"&&_.value&&(_.value="",f&&(f.style.display="none"),n(p,""))})}).observe(g,{attributes:!0})}function a(p){let{select:_,list:f,button:g}=r(p);!_||!f||(d(p),f.dataset.listenerAttached||(f.addEventListener("click",m=>{let u=m.target.closest(".aipkit_cw_template_list_item");if(!u||!_)return;let h=u.dataset.templateId||"";_.value=h,_.dispatchEvent(new Event("change",{bubbles:!0})),c(f,h),g&&g.click()}),f.dataset.listenerAttached="true"),_&&!_.dataset.listenerAttached&&(_.addEventListener("change",()=>{t(_,p),c(f,_.value)}),_.dataset.listenerAttached="true"),s(p))}function l(p,_){let{select:f,list:g}=r(_);f&&(p!==void 0&&(f.value=p),t(f,_),c(g,f.value))}window.aipkit_initBulkTemplatePicker=a,window.aipkit_renderBulkTemplatePicker=s,window.aipkit_updateBulkTemplatePickerSelection=l})();(function(){"use strict";function k(o){let{postCount:r,providerOptions:i,defaultPrompts:e,promptLibrary:t,postType:c}=o,s=v=>String(v??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=v=>s(v).replace(/"/g,"&quot;").replace(/'/g,"&#39;"),d=(v=[])=>v.map(S=>!S?.label||!S?.prompt?"":`<option value="${n(S.prompt)}">${s(S.label)}</option>`).join(""),a=t||{},l=`<option value="${n(e.title||"")}">Default</option>${d(a.title)}`,p=`<option value="${n(e.content||"")}">Default</option>${d(a.content)}`,_=`<option value="${n(e.meta||"")}">Default</option>${d(a.meta)}`,f=`<option value="${n(e.keyword||"")}">Default</option>${d(a.keyword)}`,g=`<option value="${n(e.excerpt||"")}">Default</option>${d(a.excerpt)}`,m=`<option value="${n(e.tags||"")}">Default</option>${d(a.tags)}`,u="Placeholders: {original_title}, {original_content}, {original_excerpt}, {original_focus_keyword}, {original_tags}, {categories}.";c==="product"&&(u+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),u=u.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>');let h="Placeholders: {original_title}, {original_content}, {original_focus_keyword}, {original_meta_description}, {original_tags}, {categories}.";return c==="product"&&(h+=" For products: {price}, {regular_price}, {sku}, {attributes}, {stock_quantity}, {stock_status}, {weight}, {length}, {width}, {height}, {purchase_note}, {product_categories}."),h=h.replace(/(\{[a-zA-Z0-9_]+\})/g,'<code class="aipkit-placeholder" title="Click to copy">$1</code>'),`
      <div class="aipkit-modal-overlay aipkit-enhancer-bulk-modal-overlay">
        <div id="aipkit_enhancer_bulk_modal" class="aipkit-modal-content aipkit-enhancer-bulk-modal-content aipkit_enhancer_bulk_modal" data-post-type="${n(c)}">
          <div class="aipkit-modal-header aipkit_enhancer_modal_header">
            <div class="aipkit_enhancer_header_left">
              <span class="aipkit_enhancer_header_icon" aria-hidden="true">
                <span class="dashicons dashicons-edit-large"></span>
              </span>
              <div class="aipkit_enhancer_header_text">
                <h3 class="aipkit-modal-title">Content Assistant</h3>
                <span class="aipkit_enhancer_modal_subtitle">Bulk content update</span>
              </div>
            </div>
            <div class="aipkit_enhancer_header_center">
              <div
                id="aipkit_bulk_autosave_status"
                class="aipkit_cw_save_status aipkit_enhancer_modal_status"
                aria-live="polite"
              ></div>
            </div>
            <div class="aipkit_enhancer_header_right">
              <button type="button" class="aipkit-modal-close-btn aipkit_enhancer_close_btn" aria-label="Close">\xD7</button>
            </div>
          </div>
          <div class="aipkit-modal-body">
            <div id="aipkit-enhancer-bulk-config">
              <div class="aipkit_enhancer_section aipkit_enhancer_engine_card">
                <div class="aipkit_enhancer_engine_fields">
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Template</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <button
                          type="button"
                          id="aipkit_enhancer_template_picker_btn"
                          class="aipkit_popover_option_btn aipkit_settings_select_picker_btn"
                          data-aipkit-popover-target="aipkit_enhancer_template_picker_popover"
                          data-aipkit-popover-placement="bottom"
                          data-aipkit-bulk-popover="templates"
                          aria-controls="aipkit_enhancer_template_picker_popover"
                          aria-expanded="false"
                        >
                          <span class="aipkit_settings_select_picker_label" id="aipkit_enhancer_template_picker_label">Select template</span>
                          <span class="dashicons dashicons-arrow-down-alt2" aria-hidden="true"></span>
                        </button>
                        <select id="aipkit_enhancer_template_select" name="enhancer_template_id" class="aipkit_enhancer_engine_select screen-reader-text">
                        <option value="">-- Select Template --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Provider</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_provider" class="aipkit_enhancer_engine_select">${i}</select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field">
                    <div class="aipkit_enhancer_engine_field_content">
                      <span class="aipkit_enhancer_engine_field_label">Model</span>
                      <div class="aipkit_enhancer_engine_select_wrap">
                        <select id="aipkit_bulk_ai_model" class="aipkit_enhancer_engine_select">
                          <option value="">-- Select Provider --</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_enhancer_engine_field aipkit_enhancer_engine_field--action">
                    <button
                      type="button"
                      class="aipkit_enhancer_settings_btn"
                      data-aipkit-popover-target="aipkit_bulk_settings_popover"
                      data-aipkit-popover-placement="bottom"
                      data-aipkit-bulk-popover="settings"
                      aria-controls="aipkit_bulk_settings_popover"
                      aria-expanded="false"
                      title="Advanced settings"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="aipkit_enhancer_section aipkit_enhancer_prompt_section"
                id="aipkit_bulk_prompt_section"
              >
                <div class="aipkit_enhancer_section_header">
                  <h4>What to update</h4>
                </div>
                <div class="aipkit_prompts_redesigned">
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="title">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Title</span>
                        <span class="aipkit_prompt_toggle_desc">Post title</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_title" name="bulk_enhance_fields" value="title">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_title_prompt_flyout"
                          aria-controls="aipkit_bulk_title_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="content">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Content</span>
                        <span class="aipkit_prompt_toggle_desc">Rewrite the main body</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_content" name="bulk_enhance_fields" value="content">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_content_prompt_flyout"
                          aria-controls="aipkit_bulk_content_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="meta">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Meta Description</span>
                        <span class="aipkit_prompt_toggle_desc">SEO snippet for search</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_meta" name="bulk_enhance_fields" value="meta">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_meta_prompt_flyout"
                          aria-controls="aipkit_bulk_meta_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="keyword">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Focus Keyword</span>
                        <span class="aipkit_prompt_toggle_desc">Primary SEO keyword</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_keyword" name="bulk_enhance_fields" value="keyword">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_keyword_prompt_flyout"
                          aria-controls="aipkit_bulk_keyword_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="excerpt">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Excerpt</span>
                        <span class="aipkit_prompt_toggle_desc">Short summary text</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_excerpt" name="bulk_enhance_fields" value="excerpt">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_excerpt_prompt_flyout"
                          aria-controls="aipkit_bulk_excerpt_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="tags">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Tags</span>
                        <span class="aipkit_prompt_toggle_desc">Suggested tags list</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_enhance_tags" name="bulk_enhance_fields" value="tags">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                        <button
                          type="button"
                          class="aipkit_prompt_edit_btn"
                          data-aipkit-flyout-target="aipkit_bulk_tags_prompt_flyout"
                          aria-controls="aipkit_bulk_tags_prompt_flyout"
                          aria-expanded="false"
                          title="Edit prompt"
                        >
                          <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="aipkit_prompt_toggle_card" data-prompt-key="seo_slug">
                    <div class="aipkit_prompt_toggle_row">
                      <div class="aipkit_prompt_toggle_info">
                        <span class="aipkit_prompt_toggle_label">Optimize URL</span>
                        <span class="aipkit_prompt_toggle_desc">Generate a new slug</span>
                      </div>
                      <div class="aipkit_prompt_toggle_controls">
                        <label class="aipkit_switch">
                          <input type="checkbox" id="aipkit_bulk_generate_seo_slug" name="generate_seo_slug" value="1" class="aipkit_toggle_switch">
                          <span class="aipkit_switch_slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_bulk_settings_popover" data-aipkit-bulk-popover="settings" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_model_settings_popover_panel--wide aipkit_model_settings_popover_panel--allow-overflow aipkit_cw_settings_popover_panel" role="dialog" aria-label="Settings">
                <div class="aipkit_model_settings_popover_header">
                  <span class="aipkit_model_settings_popover_title">Settings</span>
                  <button type="button" class="aipkit_model_settings_popover_close" aria-label="Close">
                    <span class="dashicons dashicons-no-alt"></span>
                  </button>
                </div>
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_enhancer_settings_popover">
                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <!-- Sliders Row (2 columns) -->
                        <div class="aipkit_enhancer_sliders_row">
                          <!-- Temperature Slider (Creativity) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_temperature_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_ai_temperature">Creativity</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_ai_temperature_value">1.0</span>
                            </div>
                            <div class="aipkit_enhancer_temperature_slider_wrapper">
                              <div class="aipkit_enhancer_temperature_labels">
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--low">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                  Focused
                                </span>
                                <span class="aipkit_enhancer_temperature_label aipkit_enhancer_temperature_label--high">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                  Creative
                                </span>
                              </div>
                              <input type="range" id="aipkit_bulk_ai_temperature" class="aipkit_enhancer_temperature_slider" min="0" max="2" step="0.1" value="1.0">
                            </div>
                          </div>

                          <!-- Max Tokens Slider (Content Length) -->
                          <div class="aipkit_enhancer_behavior_control aipkit_enhancer_tokens_control">
                            <div class="aipkit_enhancer_behavior_header">
                              <label class="aipkit_enhancer_behavior_label" for="aipkit_bulk_content_max_tokens">Content Length</label>
                              <span class="aipkit_enhancer_behavior_value" id="aipkit_bulk_content_max_tokens_value">1200-1600 words</span>
                            </div>
                            <div class="aipkit_enhancer_tokens_slider_wrapper">
                              <div class="aipkit_enhancer_tokens_labels">
                                <span class="aipkit_enhancer_tokens_label">Short</span>
                                <span class="aipkit_enhancer_tokens_label">Medium</span>
                                <span class="aipkit_enhancer_tokens_label">Long</span>
                              </div>
                              <input type="range" id="aipkit_bulk_content_max_tokens" class="aipkit_enhancer_tokens_slider" min="1" max="3" step="1" value="2">
                            </div>
                          </div>
                        </div>

                        <div class="aipkit_popover_option_row aipkit_enhancer_reasoning_effort_field">
                          <div class="aipkit_popover_option_main">
                            <div class="aipkit_popover_option_text">
                              <label class="aipkit_popover_option_label" for="aipkit_bulk_reasoning_effort">Reasoning</label>
                              <span class="aipkit_popover_option_helper">Controls thinking effort for supported models.</span>
                            </div>
                            <div class="aipkit_popover_option_actions">
                              <select id="aipkit_bulk_reasoning_effort" name="reasoning_effort" class="aipkit_popover_option_select">
                                <option value="none">None</option>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="xhigh">XHigh</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="aipkit_enhancer_section aipkit_enhancer_settings_card">
                      <div class="aipkit_enhancer_settings_card_body">
                        <div class="aipkit_enhancer_vector_settings">
                      <!-- Enable Toggle -->
                      <div class="aipkit_enhancer_vector_toggle_card">
                        <div class="aipkit_enhancer_vector_toggle_row">
                          <div class="aipkit_enhancer_vector_toggle_info">
                            <span class="aipkit_enhancer_vector_toggle_label">Knowledge Base</span>
                            <span class="aipkit_enhancer_vector_toggle_desc">Use your vector stores for RAG-enhanced content</span>
                          </div>
                          <div class="aipkit_enhancer_vector_toggle_controls">
                            <label class="aipkit_switch">
                              <input type="checkbox" name="enable_vector_store" value="1" class="aipkit_toggle_switch">
                              <span class="aipkit_switch_slider"></span>
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Source Selector (shown when enabled) -->
                      <div class="aipkit_cw_vector_store_settings_container aipkit_enhancer_vector_source_container" hidden>
                        <div class="aipkit_enhancer_vector_source_selector">
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_store_provider">Provider</label>
                            <select id="aipkit_bulk_vector_store_provider" name="vector_store_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="pinecone">Pinecone</option>
                              <option value="qdrant">Qdrant</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <!-- OpenAI Stores (Multiselect) -->
                            <div class="aipkit_cw_vector_openai_field">
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_openai_vector_store_ids">Vector Store</label>
                              <div
                                class="aipkit_popover_multiselect aipkit_vector_multiselect aipkit_enhancer_vector_multiselect"
                                data-aipkit-vector-stores-dropdown
                                data-placeholder="Select stores"
                                data-selected-label="selected"
                              >
                                <button
                                  type="button"
                                  class="aipkit_popover_multiselect_btn aipkit_vector_multiselect_btn aipkit_enhancer_vector_multiselect_btn"
                                  aria-expanded="false"
                                  aria-controls="aipkit_bulk_openai_vector_store_panel"
                                >
                                  <span class="aipkit_popover_multiselect_label">Select stores</span>
                                </button>
                                <div
                                  id="aipkit_bulk_openai_vector_store_panel"
                                  class="aipkit_popover_multiselect_panel aipkit_enhancer_vector_multiselect_panel"
                                  role="menu"
                                  hidden
                                >
                                  <div class="aipkit_popover_multiselect_options"></div>
                                </div>
                              </div>
                              <select
                                id="aipkit_bulk_openai_vector_store_ids"
                                name="openai_vector_store_ids[]"
                                class="aipkit_popover_multiselect_select"
                                multiple
                                size="3"
                                hidden
                                aria-hidden="true"
                                tabindex="-1"
                              ></select>
                            </div>
                            
                            <!-- Pinecone Index -->
                            <div class="aipkit_cw_vector_pinecone_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_pinecone_index_name">Index</label>
                              <select id="aipkit_bulk_pinecone_index_name" name="pinecone_index_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                            
                            <!-- Qdrant Collection -->
                            <div class="aipkit_cw_vector_qdrant_field" hidden>
                              <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_qdrant_collection_name">Collection</label>
                              <select id="aipkit_bulk_qdrant_collection_name" name="qdrant_collection_name" class="aipkit_enhancer_vector_settings_select"></select>
                            </div>
                          </div>
                        </div>

                        <!-- Embedding Config (for Pinecone/Qdrant) -->
                        <div class="aipkit_cw_vector_embedding_config_row aipkit_enhancer_vector_embedding_selector" hidden>
                          <div class="aipkit_enhancer_vector_source_row">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_provider">Embedding</label>
                            <select id="aipkit_bulk_vector_embedding_provider" name="vector_embedding_provider" class="aipkit_enhancer_vector_settings_select">
                              <option value="openai" selected>OpenAI</option>
                              <option value="google">Google</option>
                              <option value="azure">Azure</option>
                              <option value="openrouter">OpenRouter</option>
                            </select>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_divider">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                          </div>
                          
                          <div class="aipkit_enhancer_vector_source_row aipkit_enhancer_vector_source_row--store">
                            <label class="aipkit_enhancer_vector_settings_label" for="aipkit_bulk_vector_embedding_model">Model</label>
                            <select id="aipkit_bulk_vector_embedding_model" name="vector_embedding_model" class="aipkit_enhancer_vector_settings_select"></select>
                          </div>
                        </div>

                        <!-- Results Limit Slider -->
                        <div class="aipkit_vector_slider_group">
                          <div class="aipkit_vector_slider_header">
                            <label class="aipkit_vector_settings_label" for="aipkit_bulk_vector_store_top_k">Results Limit</label>
                            <span class="aipkit_vector_slider_value" id="aipkit_bulk_vector_store_top_k_value">3</span>
                          </div>
                          <div class="aipkit_vector_slider_wrapper">
                            <div class="aipkit_vector_slider_labels">
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--min">
                                <span class="dashicons dashicons-minus" aria-hidden="true"></span>
                                Fewer
                              </span>
                              <span class="aipkit_vector_slider_label aipkit_vector_slider_label--max">
                                More
                                <span class="dashicons dashicons-plus" aria-hidden="true"></span>
                              </span>
                            </div>
                            <input type="range" id="aipkit_bulk_vector_store_top_k" name="vector_store_top_k" class="aipkit_vector_slider" value="3" min="1" max="20" step="1">
                          </div>
                          <p class="aipkit_vector_slider_hint">Number of matching chunks to retrieve</p>
                        </div>
                      </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_model_settings_popover aipkit_cw_settings_popover" id="aipkit_enhancer_template_picker_popover" data-aipkit-bulk-popover="templates" aria-hidden="true">
              <div class="aipkit_model_settings_popover_panel aipkit_cw_settings_popover_panel aipkit_cw_template_picker_popover_panel" role="dialog" aria-label="Templates">
                <div class="aipkit_model_settings_popover_body aipkit_cw_settings_popover_body">
                  <div class="aipkit_cw_template_picker_search_wrap">
                    <span class="dashicons dashicons-search aipkit_cw_template_picker_search_icon" aria-hidden="true"></span>
                    <input
                      type="text"
                      id="aipkit_enhancer_template_picker_search"
                      class="aipkit_cw_template_picker_search"
                      placeholder="Search templates..."
                      autocomplete="off"
                    >
                    <button
                      type="button"
                      id="aipkit_enhancer_template_picker_search_clear"
                      class="aipkit_cw_template_picker_search_clear"
                      aria-label="Clear search"
                      style="display: none;"
                    >
                      <span class="dashicons dashicons-no-alt" aria-hidden="true"></span>
                    </button>
                  </div>
                  <div class="aipkit_cw_template_picker_list" id="aipkit_enhancer_template_picker_list" role="listbox" aria-label="Template list">
                    <div class="aipkit_cw_template_picker_empty">
                      Loading templates...
                    </div>
                  </div>
                  <div class="aipkit_cw_template_picker_actions">
                    <div class="aipkit_cw_template_action_list" id="aipkit_enhancer_template_action_list">
                      <button type="button" id="aipkit_enhancer_save_as_template_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">
                        <span class="dashicons dashicons-plus-alt2" aria-hidden="true"></span>
                        New
                      </button>
                      <button type="button" id="aipkit_enhancer_rename_template_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-edit" aria-hidden="true"></span>
                        Rename
                      </button>
                      <button type="button" id="aipkit_enhancer_delete_template_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small" disabled>
                        <span class="dashicons dashicons-trash" aria-hidden="true"></span>
                        Delete
                      </button>
                    </div>
                    <div id="aipkit_enhancer_template_inline_form" class="aipkit_cw_template_inline_form" style="display: none;">
                      <input type="text" id="aipkit_enhancer_template_name_input" class="aipkit_form-input" placeholder="Enter template name...">
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_save_inline_btn" class="aipkit_btn aipkit_btn-primary aipkit_btn-small">Save</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_inline_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                    <div id="aipkit_enhancer_template_inline_delete_confirm" class="aipkit_cw_template_inline_delete_confirm" style="display: none;">
                      <span id="aipkit_enhancer_template_delete_confirm_text"></span>
                      <div class="aipkit_cw_template_inline_form_actions">
                        <button type="button" id="aipkit_enhancer_template_confirm_delete_btn" class="aipkit_btn aipkit_btn-danger aipkit_btn-small">Confirm</button>
                        <button type="button" id="aipkit_enhancer_template_cancel_delete_btn" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small">Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_title_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Title Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Title Prompt</span>
                    <select id="aipkit_bulk_title_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_title" title="Load template">
                      ${l}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_title" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.title||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="title" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_content_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Content Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Content Prompt</span>
                    <select id="aipkit_bulk_content_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_content" title="Load template">
                      ${p}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_content" class="aipkit_cw_prompt_editor_textarea" rows="10">${s(e.content||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="content" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_meta_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Meta Description Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Meta Description Prompt</span>
                    <select id="aipkit_bulk_meta_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_meta" title="Load template">
                      ${_}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_meta" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.meta||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="meta" data-label="Placeholders:" data-copy-title="Click to copy">${h}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_keyword_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Focus Keyword Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Focus Keyword Prompt</span>
                    <select id="aipkit_bulk_keyword_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_keyword" title="Load template">
                      ${f}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_keyword" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.keyword||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="keyword" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_excerpt_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Excerpt Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Excerpt Prompt</span>
                    <select id="aipkit_bulk_excerpt_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_excerpt" title="Load template">
                      ${g}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_excerpt" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.excerpt||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="excerpt" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="aipkit_cw_prompt_flyout" id="aipkit_bulk_tags_prompt_flyout" aria-hidden="true">
              <div class="aipkit_cw_prompt_panel aipkit_cw_prompt_panel--tall" role="dialog" aria-label="Tags Prompt">
                <div class="aipkit_cw_prompt_editor">
                  <div class="aipkit_cw_prompt_editor_toolbar">
                    <span class="aipkit_cw_prompt_editor_title">Tags Prompt</span>
                    <select id="aipkit_bulk_tags_prompt_library" class="aipkit_cw_prompt_template_select aipkit_cw_prompt_library_select" data-aipkit-prompt-target="aipkit_bulk_prompt_tags" title="Load template">
                      ${m}
                    </select>
                  </div>
                  <textarea id="aipkit_bulk_prompt_tags" class="aipkit_cw_prompt_editor_textarea" rows="8">${s(e.tags||"")}</textarea>
                  <div class="aipkit_cw_prompt_editor_footer">
                    <span class="aipkit_cw_prompt_editor_placeholders aipkit_bulk_prompt_placeholders" data-prompt-type="tags" data-label="Placeholders:" data-copy-title="Click to copy">${u}</span>
                  </div>
                </div>
              </div>
            </div>

            <div id="aipkit-enhancer-bulk-progress" hidden>
              <div class="aipkit_enhancer_progress_header">
                <div id="aipkit-enhancer-progress-text" class="aipkit_enhancer_progress_text">Processing posts...</div>
                <div id="aipkit-enhancer-progress-stats" class="aipkit_enhancer_progress_stats">0 of 0 (0%)</div>
              </div>
              <div class="aipkit_progress_bar_container">
                <div id="aipkit-enhancer-bulk-progress-bar" class="aipkit_progress_bar_filled"></div>
              </div>
              <div id="aipkit-enhancer-bulk-status-log" class="aipkit_enhancer_bulk_log"></div>
            </div>

          </div>
          <div class="aipkit-modal-footer">
            <div class="aipkit_enhancer_footer_info">
              <div class="aipkit_enhancer_selection_badge">
                <span class="aipkit_enhancer_selection_count">${r}</span>
                <span class="aipkit_enhancer_selection_label">item${r===1?"":"s"} selected</span>
              </div>
            </div>
            <div class="aipkit_enhancer_footer_actions">
              <button type="button" id="aipkit_bulk_enhancer_back_to_settings_btn" class="aipkit_btn aipkit_btn-ghost" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span>Back</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_stop_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                <span>Stop</span>
              </button>
              <button type="button" id="aipkit_bulk_enhancer_start_btn" class="aipkit_btn aipkit_btn-success">
                <svg class="aipkit_btn_icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                <span class="aipkit_btn-text">Start Processing</span>
                <span class="aipkit_spinner" hidden></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    `}window.aipkit_enhancer_getBulkModalHtml=k})();(function(){"use strict";function k(o,r){if(typeof window.aipkit_enhancer_getBulkModalHtml!="function"){console.error("Bulk Modal UI: aipkit_enhancer_getBulkModalHtml function is not available."),alert("Error: Could not load modal interface.");return}let i={};o.forEach(f=>{let g=document.querySelector(`tr#post-${f}`);if(g){let m=g.querySelector(".row-title")||g.querySelector("strong a")||g.querySelector(".title a")||g.querySelector("a.row-title")||g.querySelector(".column-title strong a")||g.querySelector(".column-title .row-title");m&&(i[f]=m.textContent.trim())}i[f]||(i[f]=`Post #${f}`)}),window.aipkit_enhancer_postTitles=i;let e=window.aipkit_post_enhancer?.default_prompts||{title:"Generate a new title for: {original_title}",excerpt:"Generate a new excerpt for: {original_title}",content:"Rewrite the content for: {original_title}",meta:"Generate a meta description for: {original_title}",keyword:"Generate a focus keyword for: {original_title}"},t=window.aipkit_post_enhancer?.prompt_library||{},c=window.aipkit_dashboard?.models?Object.keys(window.aipkit_dashboard.models):["openai"],s=window.aipkit_post_enhancer?.default_ai_provider||"",n=String(s||"").trim().toLowerCase(),d={openai:"OpenAI",openrouter:"OpenRouter",google:"Google",azure:"Azure",claude:"Claude",deepseek:"DeepSeek",ollama:"Ollama"},a=c.map(f=>{let g=f.toLowerCase();return`<option value="${g}" ${n&&g===n?"selected":""}>${d[g]||f.toUpperCase()}</option>`}).join(""),l=window.aipkit_enhancer_getBulkModalHtml({postCount:o.length,providerOptions:a,defaultPrompts:e,promptLibrary:t,postType:r});document.body.insertAdjacentHTML("beforeend",l);let p=document.querySelector(".aipkit-enhancer-bulk-modal-overlay");typeof window.aipkit_enhancer_attachBulkModalListeners=="function"?window.aipkit_enhancer_attachBulkModalListeners(p,o):console.error("Bulk Modal UI: aipkit_enhancer_attachBulkModalListeners function is not available.");let _=p.querySelector("#aipkit_bulk_ai_provider");_&&n&&Array.from(_.options).some(g=>g.value===n)&&(_.value=n,_.dispatchEvent(new Event("change",{bubbles:!0}))),requestAnimationFrame(()=>{p.classList.add("aipkit-active")})}window.aipkit_enhancer_createAndShowBulkModal=k})();(function(){"use strict";let k=window.wp?.i18n?.__||function(w){return w},o=".aipkit_enhancer_bulk_modal",r=["#aipkit_bulk_ai_provider","#aipkit_bulk_ai_model","#aipkit_bulk_vector_store_provider","#aipkit_bulk_vector_embedding_provider","#aipkit_bulk_pinecone_index_name","#aipkit_bulk_qdrant_collection_name","#aipkit_bulk_vector_embedding_model"].join(", "),i=null,e=null,t=!1,c=new Set(["aipkit_bulk_ai_provider","aipkit_bulk_vector_store_provider","aipkit_bulk_vector_embedding_provider"]),s=w=>!!(w&&w.id&&c.has(w.id)),n=w=>String(w||"").trim().toLowerCase(),d=(w,A)=>{if(!w)return;let C="aipkit_settings_select_picker_icon--";w.classList.forEach(x=>{x.startsWith(C)&&w.classList.remove(x)}),w.classList.remove("is-hidden");let b=n(A);if(!b){w.classList.add("is-hidden");return}w.classList.add(`${C}${b}`)},a=w=>{if(!w)return"";let A=w.getAttribute("data-aipkit-picker-title");if(A)return A;let C=w.id&&document.querySelector(`label[for="${w.id}"]`)||w.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return C?C.textContent.trim():""},l=w=>{if(!w)return"";let A=w.selectedOptions&&w.selectedOptions.length?w.selectedOptions[0]:w.querySelector("option[selected]");if(A)return A.textContent.trim();let C=w.querySelector("option");return C?C.textContent.trim():""},p=w=>({buttonId:`${w}_picker_btn`,labelId:`${w}_picker_label`,popoverId:`${w}_picker_popover`,titleId:`${w}_picker_title`,searchId:`${w}_picker_search`,listId:`${w}_picker_list`}),_=(w,A)=>{if(!w||!w.id||!A)return null;let C=p(w.id),b=A.querySelector(`#${C.buttonId}`);if(!b){if(b=document.createElement("button"),b.type="button",b.id=C.buttonId,b.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",b.setAttribute("data-aipkit-popover-target",C.popoverId),b.setAttribute("aria-controls",C.popoverId),b.setAttribute("aria-expanded","false"),b.dataset.aipkitPopoverPlacement="bottom",s(w)){b.classList.add("aipkit_settings_select_picker_btn--provider");let H=document.createElement("span");H.className="aipkit_settings_select_picker_icon",H.setAttribute("aria-hidden","true"),d(H,w.value),b.appendChild(H)}let T=document.createElement("span");T.className="aipkit_settings_select_picker_label",T.id=C.labelId,T.textContent=l(w)||k("Select","gpt3-ai-content-generator");let P=document.createElement("span");P.className="dashicons dashicons-arrow-down-alt2",P.setAttribute("aria-hidden","true"),b.appendChild(T),b.appendChild(P),w.insertAdjacentElement("beforebegin",b)}w.classList.contains("screen-reader-text")||w.classList.add("screen-reader-text");let x=A.querySelector(`#${C.popoverId}`);if(!x){x=document.createElement("div"),x.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",s(w)&&x.classList.add("aipkit_settings_select_picker_popover--provider"),x.id=C.popoverId,x.setAttribute("aria-hidden","true");let T=document.createElement("div");T.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",T.setAttribute("role","dialog"),T.setAttribute("aria-labelledby",C.titleId);let P=document.createElement("div");P.className="aipkit_model_settings_popover_header";let H=document.createElement("span");H.className="aipkit_model_settings_popover_title",H.id=C.titleId,H.textContent=a(w)||k("Select","gpt3-ai-content-generator");let O=document.createElement("button");O.type="button",O.className="aipkit_model_settings_popover_close",O.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),O.innerHTML='<span class="dashicons dashicons-no-alt"></span>',P.appendChild(H),P.appendChild(O);let F=document.createElement("div");F.className="aipkit_model_settings_popover_body";let M=document.createElement("div");M.className="aipkit_settings_select_picker_search";let B=document.createElement("input");B.type="search",B.id=C.searchId,B.className="aipkit_form-input";let V=a(w),L=V?`Search ${V.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");B.setAttribute("placeholder",L),M.appendChild(B);let U=document.createElement("div");U.className="aipkit_settings_select_picker_list",U.id=C.listId,U.setAttribute("role","listbox"),F.appendChild(M),F.appendChild(U),T.appendChild(P),T.appendChild(F),x.appendChild(T),A.appendChild(x),s(w)&&(M.style.display="none")}return{ids:C,button:b,popover:x,label:A.querySelector(`#${C.labelId}`),search:A.querySelector(`#${C.searchId}`),list:A.querySelector(`#${C.listId}`)}},f=w=>{let A=[];return w&&Array.from(w.children).forEach(b=>{if(b.tagName==="OPTGROUP"){let x=Array.from(b.children).filter(T=>T.tagName==="OPTION").map(T=>({value:T.value,label:T.textContent.trim(),disabled:T.disabled,selected:T.selected}));A.push({groupLabel:b.label||"",options:x})}else b.tagName==="OPTION"&&A.push({groupLabel:"",options:[{value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}]})}),A},g=(w,A,C="")=>{if(!w||!A)return;let b=C.trim().toLowerCase();A.innerHTML="";let x=f(w),T=!1;if(x.forEach(P=>{let H=P.options.filter(O=>b?O.label.toLowerCase().includes(b):!0);if(H.length){if(P.groupLabel){let O=document.createElement("div");O.className="aipkit_settings_select_picker_group_label",O.textContent=P.groupLabel,A.appendChild(O)}H.forEach(O=>{let F=document.createElement("button");if(F.type="button",F.className="aipkit_settings_select_picker_item",F.setAttribute("role","option"),F.dataset.value=O.value,F.dataset.label=O.label,O.disabled&&(F.classList.add("is-disabled"),F.setAttribute("aria-disabled","true")),w.value===O.value?(F.classList.add("is-active"),F.setAttribute("aria-selected","true")):F.setAttribute("aria-selected","false"),s(w)){F.classList.add("aipkit_settings_select_picker_item--provider");let V=document.createElement("span");V.className="aipkit_settings_select_picker_icon",V.setAttribute("aria-hidden","true"),d(V,O.value),F.appendChild(V)}let M=document.createElement("span");M.className="aipkit_settings_select_picker_text",M.textContent=O.label;let B=document.createElement("span");B.className="dashicons dashicons-yes aipkit_settings_select_picker_check",F.appendChild(M),F.appendChild(B),A.appendChild(F),T=!0})}}),!T){let P=document.createElement("div");P.className="aipkit_settings_select_picker_empty",P.textContent=k(b?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild(P)}},m=(w,A)=>{if(!w||!A)return;let C=l(w);if(A.textContent=C||k("Select","gpt3-ai-content-generator"),s(w)){let b=A.closest("button"),x=b?b.querySelector(".aipkit_settings_select_picker_icon"):null;d(x,w.value)}},u=(w,A)=>{if(!w||!A)return;let C=w.getBoundingClientRect(),b=A.getBoundingClientRect(),x=b.width||320,T=b.height||0,P=window.innerWidth,H=window.innerHeight,O=12,F=C.left;F+x>P-O&&(F=C.right-x),F=Math.max(O,Math.min(F,P-x-O));let M=C.bottom+8;M+T>H-O&&(M=C.top-T-8),M=Math.max(O,Math.min(M,H-T-O)),A.style.left=`${Math.round(F)}px`,A.style.top=`${Math.round(M)}px`},h=()=>{!i||!e||t||(t=!0,window.requestAnimationFrame(()=>{let w=i.querySelector(".aipkit_model_settings_popover_panel");u(e,w),t=!1}))},v=()=>{i&&(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),i=null,e=null)},S=(w,A,C)=>{if(!w||!A)return;i&&i!==A&&v(),i=A,e=w,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),w.setAttribute("aria-expanded","true");let b=A.querySelector(".aipkit_settings_select_picker_search input"),x=A.querySelector(".aipkit_settings_select_picker_list");x&&g(C,x,b?b.value:""),b&&b.offsetParent!==null&&(b.focus(),b.select());let T=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(w,T)})},q=(w,A)=>{if(!w||!A)return;let{button:C,popover:b,list:x,search:T}=A;if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",P=>{if(P.preventDefault(),i===b){v();return}S(C,b,w)}),C.dataset.pickerListenerAttached="true"),b&&b.dataset.overlayListenerAttached!=="true"){b.addEventListener("click",H=>{H.target===b&&v()});let P=b.querySelector(".aipkit_model_settings_popover_close");P&&P.addEventListener("click",H=>{H.preventDefault(),v()}),b.dataset.overlayListenerAttached="true"}if(x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("click",P=>{let H=P.target.closest(".aipkit_settings_select_picker_item");if(!H||H.classList.contains("is-disabled"))return;let O=H.dataset.value??"";w.value=O,w.dispatchEvent(new Event("change",{bubbles:!0})),m(w,A.label),g(w,x,T?T.value:""),v()}),x.dataset.pickerListenerAttached="true"),T&&T.dataset.pickerListenerAttached!=="true"&&(T.addEventListener("input",()=>{g(w,x,T.value)}),T.dataset.pickerListenerAttached="true"),w&&w.dataset.pickerListenerAttached!=="true"&&(w.addEventListener("change",()=>{m(w,A.label),g(w,x,T?T.value:""),i===b&&v()}),w.dataset.pickerListenerAttached="true"),w&&w.dataset.pickerObserverAttached!=="true"){let P=!1;new MutationObserver(()=>{P||(P=!0,window.requestAnimationFrame(()=>{m(w,A.label),g(w,x,T?T.value:""),P=!1}))}).observe(w,{childList:!0,subtree:!0}),w.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitBulkPickerEscapeBound||(document.addEventListener("keydown",P=>{P.key==="Escape"&&i&&v()}),document.body.dataset.aipkitBulkPickerEscapeBound="true"),document.body.dataset.aipkitBulkPickerRepositionBound||(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),document.body.dataset.aipkitBulkPickerRepositionBound="true")};function y(w){if(!w||w.dataset.aipkitBulkPickerInit==="true")return;let A=w.querySelectorAll(r);A.length&&(A.forEach(C=>{if(!C.id||C.dataset.aipkitPickerInit==="true")return;let b=_(C,w);b&&(m(C,b.label),g(C,b.list,b.search?b.search.value:""),q(C,b),C.dataset.aipkitPickerInit="true")}),w.dataset.aipkitBulkPickerInit="true")}function E(){document.querySelectorAll(o).forEach(y)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E(),new MutationObserver(E).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initBulkEnhancerSelectPickers=y})();(function(){"use strict";let k=window.aipkit_escapeHtml||(a=>String(a??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")),o=["{original_title}","{original_content}","{original_excerpt}","{original_focus_keyword}","{original_tags}","{categories}"],r=["{original_title}","{original_content}","{original_focus_keyword}","{original_meta_description}","{original_tags}","{categories}"],i=["{price}","{regular_price}","{sku}","{attributes}","{stock_quantity}","{stock_status}","{weight}","{length}","{width}","{height}","{purchase_note}","{product_categories}"],e=a=>a?.querySelector(".aipkit_enhancer_bulk_modal")?.dataset?.postType||"",t=(a,l)=>{let _=[...a==="meta"?r:o];return l==="product"&&_.push(...i),_.filter((f,g)=>_.indexOf(f)===g)},c=(a,l)=>{if(!a)return;let p=a.dataset.label||"Placeholders:",_=a.dataset.copyTitle||"Click to copy";a.innerHTML=`${k(p)} `,l.forEach((f,g)=>{let m=document.createElement("code");m.className="aipkit-placeholder",m.title=_,m.textContent=f,a.appendChild(m),g<l.length-1&&a.appendChild(document.createTextNode(" "))})},s=(a,l)=>{if(!a)return;let p=a.querySelector(".aipkit_bulk_prompt_placeholders");if(!p)return;let _=p.dataset.promptType||"",f=t(_,l);c(p,f)};function n(a){if(!a)return;let l=a.querySelectorAll("[data-aipkit-bulk-popover]");if(!l.length)return;let p=null,_=null,f=!1,g=S=>S?a.querySelector(`#${S}`):null,m=(S,q)=>{if(!S||!q)return;let y=S.getBoundingClientRect(),E=q.getBoundingClientRect(),I=E.width||400,w=E.height||0,A=window.innerWidth,C=window.innerHeight,b=12,x=y.left;x+I>A-b&&(x=y.right-I),x=Math.max(b,Math.min(x,A-I-b));let T=y.bottom+8;T+w>C-b&&(T=y.top-w-8),T=Math.max(b,Math.min(T,C-w-b)),q.style.left=`${Math.round(x)}px`,q.style.top=`${Math.round(T)}px`},u=()=>{!_||!p||f||(f=!0,window.requestAnimationFrame(()=>{let S=p.querySelector(".aipkit_model_settings_popover_panel");m(_,S),f=!1}))},h=()=>{p&&(p.classList.remove("aipkit-active"),p.setAttribute("aria-hidden","true"),_&&_.setAttribute("aria-expanded","false"),p?.dataset?.aipkitBulkPopover==="prompts"&&typeof window.aipkit_enhancer_closeBulkPromptFlyout=="function"&&window.aipkit_enhancer_closeBulkPromptFlyout(),p=null,_=null)},v=S=>{if(!S)return;let q=S.getAttribute("data-aipkit-popover-target"),y=g(q);if(!y)return;p&&p!==y&&h(),p=y,_=S,y.classList.add("aipkit-active"),y.setAttribute("aria-hidden","false"),S.setAttribute("aria-expanded","true");let E=y.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{m(S,E)})};l.forEach(S=>{S.dataset.popoverListenerAttached!=="true"&&(S.addEventListener("click",q=>{if(q.preventDefault(),p&&_===S){h();return}v(S)}),S.dataset.popoverListenerAttached="true")}),a.querySelectorAll(".aipkit_model_settings_popover[data-aipkit-bulk-popover]").forEach(S=>{S.dataset.overlayListenerAttached!=="true"&&(S.addEventListener("click",y=>{y.target===S&&h()}),S.dataset.overlayListenerAttached="true");let q=S.querySelector(".aipkit_model_settings_popover_close");q&&q.dataset.popoverListenerAttached!=="true"&&(q.addEventListener("click",y=>{y.preventDefault(),h()}),q.dataset.popoverListenerAttached="true")}),a.dataset.bulkPromptPopoverEscapeAttached!=="true"&&(document.addEventListener("keydown",S=>{S.key==="Escape"&&p&&h()}),a.dataset.bulkPromptPopoverEscapeAttached="true"),a.dataset.bulkPromptPopoverRepositionAttached!=="true"&&(window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),a.dataset.bulkPromptPopoverRepositionAttached="true")}function d(a){if(!a)return;let l=a.querySelectorAll(".aipkit_prompt_edit_btn");if(!l.length)return;let p=e(a),_=null,f=null,g=!1,m=y=>y?a.querySelector(`#${y}`):null,u=(y,E,I)=>{if(!y||!E)return;let w=y.getBoundingClientRect(),A=E.getBoundingClientRect(),C=I?I.getBoundingClientRect():w,b=A.width||580,x=A.height||0,T=window.innerWidth,P=window.innerHeight,H=12,O=C.left-b-12;O<H&&(O=C.right+12),O=Math.max(H,Math.min(O,T-b-H));let F=C.top;F+x>P-H&&(F=P-x-H),F=Math.max(H,F),_.style.left=`${Math.round(O)}px`,_.style.top=`${Math.round(F)}px`},h=()=>{!f||!_||g||(g=!0,window.requestAnimationFrame(()=>{let y=_.querySelector(".aipkit_cw_prompt_panel"),E=f.closest(".aipkit_model_settings_popover_panel");u(f,y,E),g=!1}))},v=()=>{_&&(_.classList.remove("is-open"),_.setAttribute("aria-hidden","true"),f&&f.setAttribute("aria-expanded","false"),_=null,f=null)},S=y=>{let E=y.getAttribute("data-aipkit-flyout-target"),I=m(E);if(!I)return;_&&_!==I&&v(),_=I,f=y,I.classList.add("is-open"),I.setAttribute("aria-hidden","false"),y.setAttribute("aria-expanded","true"),s(I,p);let w=I.querySelector(".aipkit_cw_prompt_panel"),A=y.closest(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(y,w,A)})};l.forEach(y=>{y.dataset.flyoutListenerAttached!=="true"&&(y.addEventListener("click",E=>{if(E.preventDefault(),_&&f===y){v();return}S(y)}),y.dataset.flyoutListenerAttached="true")}),a.querySelectorAll(".aipkit_cw_prompt_library_select").forEach(y=>{let E=y.getAttribute("data-aipkit-prompt-target"),I=E?a.querySelector(`#${E}`):null;I&&I.value.trim()===""&&y.value&&(I.value=y.value),y.dataset.promptLibraryAttached!=="true"&&(y.addEventListener("change",()=>{if(!y.value)return;let w=y.getAttribute("data-aipkit-prompt-target"),A=w?a.querySelector(`#${w}`):null;A&&(A.value=y.value,A.dispatchEvent(new Event("input",{bubbles:!0})))}),y.dataset.promptLibraryAttached="true")}),a.querySelectorAll(".aipkit_cw_prompt_flyout").forEach(y=>{y.dataset.overlayListenerAttached!=="true"&&(y.addEventListener("click",E=>{E.target===y&&v()}),y.dataset.overlayListenerAttached="true")}),a.dataset.bulkPromptFlyoutEscapeAttached!=="true"&&(document.addEventListener("keydown",y=>{y.key==="Escape"&&_&&v()}),a.dataset.bulkPromptFlyoutEscapeAttached="true"),a.dataset.bulkPromptFlyoutClickAttached!=="true"&&(document.addEventListener("click",y=>{if(!_)return;let E=y.target;E.closest(".aipkit_cw_prompt_flyout")||E.closest("[data-aipkit-flyout-target]")||v()}),a.dataset.bulkPromptFlyoutClickAttached="true"),a.dataset.bulkPromptFlyoutRepositionAttached!=="true"&&(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),a.dataset.bulkPromptFlyoutRepositionAttached="true"),window.aipkit_enhancer_closeBulkPromptFlyout=v}window.aipkit_enhancer_initBulkPromptPopovers=n,window.aipkit_enhancer_initBulkPromptFlyouts=d})();(function(){"use strict";let k=window.aipkit_escapeHtml||(a=>a||""),o=[{key:"short",label:"Short",words:"600-800",tokens:2e3},{key:"medium",label:"Medium",words:"1200-1600",tokens:4e3},{key:"long",label:"Long",words:"2000-2500",tokens:6e3}],r=a=>{let l=parseInt(a,10);if(Number.isFinite(l)){if(l>=1&&l<=o.length)return o[l-1];let p=o.find(_=>_.tokens===l);if(p)return p}return o[1]};function i(a,l){let p=window.aipkit_post_enhancer||{},_,f,g,m,u;a==="openai"?(_=l.querySelector("#aipkit_bulk_openai_vector_store_ids"),f=p.openai_vector_stores||[],g="id",m="name",u="No OpenAI stores found."):a==="pinecone"?(_=l.querySelector("#aipkit_bulk_pinecone_index_name"),f=p.pinecone_indexes||[],g="name",m="name",u="No Pinecone indexes found."):a==="qdrant"&&(_=l.querySelector("#aipkit_bulk_qdrant_collection_name"),f=p.qdrant_collections||[],g="name",m="name",u="No Qdrant collections found."),_&&(_.innerHTML="",f.length>0?_.multiple?f.forEach(h=>{_.add(new Option(k(h[m]),h[g]))}):(_.add(new Option("-- Select --","")),f.forEach(h=>{_.add(new Option(k(h[m]),h[g]))})):(_.add(new Option(u,"")),_.disabled=!0),a==="openai"&&e(l))}function e(a){let l=a.querySelector("[data-aipkit-vector-stores-dropdown]");if(!l)return;let p=l.closest(".aipkit_cw_vector_openai_field"),_=p?p.querySelector(".aipkit_popover_multiselect_select"):null;if(!_)return;let f=l.querySelector(".aipkit_popover_multiselect_btn"),g=l.querySelector(".aipkit_popover_multiselect_label"),m=l.querySelector(".aipkit_popover_multiselect_panel"),u=l.querySelector(".aipkit_popover_multiselect_options"),h=l.dataset.placeholder||"Select stores",v=l.dataset.selectedLabel||"selected",S=()=>{if(!g)return;let w=Array.from(_.options).filter(C=>C.selected&&C.value);if(!w.length){g.textContent=h;return}let A=w.map(C=>C.textContent.trim()).filter(Boolean);if(A.length<=2){g.textContent=A.join(", ");return}g.textContent=`${A.length} ${v}`},q=()=>{if(!u)return;u.innerHTML="";let w=Array.from(_.options),A=w.filter(C=>C.value);if(!A.length){let C=document.createElement("div");C.className="aipkit_popover_multiselect_empty",C.textContent=w[0]?.textContent||"-- No Stores Found --",u.appendChild(C),S();return}A.forEach(C=>{let b=document.createElement("label");b.className="aipkit_popover_multiselect_item";let x=document.createElement("input");x.type="checkbox",x.value=C.value,x.checked=C.selected,x.disabled=C.disabled;let T=document.createElement("span");T.className="aipkit_popover_multiselect_text",T.textContent=C.textContent,b.appendChild(x),b.appendChild(T),u.appendChild(b)}),S()},y=()=>{if(!u){S();return}let w=new Set(Array.from(_.options).filter(A=>A.selected).map(A=>A.value));u.querySelectorAll('input[type="checkbox"]').forEach(A=>{A.checked=w.has(A.value)}),S()},E=w=>{if(!u)return;let A=Array.from(u.querySelectorAll('input[type="checkbox"]:checked'));if(A.length>2){let b=w&&w.target;if(b&&b.checked)b.checked=!1;else{let x=A[A.length-1];x&&(x.checked=!1)}}let C=Array.from(u.querySelectorAll('input[type="checkbox"]:checked')).map(b=>b.value);Array.from(_.options).forEach(b=>{b.selected=C.includes(b.value)}),_.dispatchEvent(new Event("change",{bubbles:!0})),S()},I=w=>{!l||!f||(l.classList.toggle("is-open",w),f.setAttribute("aria-expanded",w?"true":"false"),m&&(m.hidden=!w))};q(),y(),l.dataset.vectorStoreMultiselectAttached||(f&&(f.addEventListener("click",w=>{w.preventDefault(),w.stopPropagation(),I(!l.classList.contains("is-open"))}),f.addEventListener("keydown",w=>{w.key==="Escape"&&I(!1)})),document.addEventListener("click",w=>{l.classList.contains("is-open")&&(l.contains(w.target)||I(!1))}),u&&!u.dataset.listenerAttached&&(u.addEventListener("change",E),u.dataset.listenerAttached="true"),_.dataset.listenerAttached||(_.addEventListener("change",y),_.dataset.listenerAttached="true"),l.dataset.vectorStoreMultiselectAttached="true")}function t(a,l){let p=l.querySelector("#aipkit_bulk_vector_embedding_model");if(!p)return;let _=window.aipkit_post_enhancer||{},f=[];a==="google"?f=_.googleEmbeddingModels||[]:a==="openrouter"?f=_.openrouterEmbeddingModels||[]:a==="azure"?f=_.azureEmbeddingModels||[]:f=_.openaiEmbeddingModels||[],p.innerHTML="",f.length>0?(p.add(new Option("-- Select Model --","")),f.forEach(g=>{p.add(new Option(k(g.name||g.id),g.id))}),p.disabled=!1):(p.add(new Option("No models found","")),p.disabled=!0)}function c(a){let l=a.querySelector("#aipkit_bulk_vector_store_provider").value,p=a.querySelector(".aipkit_cw_vector_openai_field"),_=a.querySelector(".aipkit_cw_vector_pinecone_field"),f=a.querySelector(".aipkit_cw_vector_qdrant_field"),g=a.querySelector(".aipkit_cw_vector_embedding_config_row");p&&(p.hidden=!0),_&&(_.hidden=!0),f&&(f.hidden=!0),g&&(g.hidden=!0),l==="openai"?(p&&(p.hidden=!1),i("openai",a)):l==="pinecone"?(_&&(_.hidden=!1),g&&(g.hidden=!1),i("pinecone",a),t("openai",a)):l==="qdrant"&&(f&&(f.hidden=!1),g&&(g.hidden=!1),i("qdrant",a),t("openai",a))}function s(a){let l=a.querySelector('input[name="enable_vector_store"]'),p=a.querySelector(".aipkit_cw_vector_store_settings_container"),_=a.querySelector("#aipkit_bulk_vector_store_provider"),f=a.querySelector("#aipkit_bulk_vector_embedding_provider"),g=a.querySelector("#aipkit_bulk_vector_store_top_k"),m=a.querySelector("#aipkit_bulk_vector_store_top_k_value");if(!(!l||!p||!_)){if(l.addEventListener("change",()=>{p.hidden=!l.checked}),_.addEventListener("change",()=>c(a)),f&&f.addEventListener("change",u=>t(u.target.value,a)),g&&m){let u=()=>{m.textContent=g.value};g.addEventListener("input",u),u()}p.hidden=!l.checked,c(a)}}function n(a){let l=a.querySelectorAll(".aipkit_prompt_toggle_card, .aipkit_enhancer_prompt_card");l.length&&l.forEach(p=>{let _=p.querySelector('input[name="bulk_enhance_fields"], input[name="generate_seo_slug"]');if(!_)return;let f=()=>{p.classList.toggle("is-disabled",!_.checked)};f(),_.addEventListener("change",f),p.dataset.promptToggleAttached!=="true"&&(p.addEventListener("click",g=>{g.target.closest(".aipkit_prompt_edit_btn")||g.target.closest("a")||_.disabled||(g.target.closest(".aipkit_switch")&&g.preventDefault(),_.checked=!_.checked,_.dispatchEvent(new Event("change",{bubbles:!0})))}),p.dataset.promptToggleAttached="true")})}function d(a,l){if(!a)return;let p=a.querySelector("#aipkit-enhancer-bulk-config"),_=a.querySelector("#aipkit-enhancer-bulk-progress"),f=a.querySelector("#aipkit_bulk_enhancer_start_btn"),g=a.querySelector("#aipkit_bulk_enhancer_stop_btn"),m=a.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn");if(p&&(p.hidden=!1),_&&(_.hidden=!0),f){f.disabled=!1;let A=f.querySelector(".aipkit_btn-text");A&&(A.textContent="Start")}g&&(g.hidden=!0),m&&(m.hidden=!0);let u=a.querySelectorAll(".aipkit_enhancer_advanced_details");u.length&&u.forEach(A=>{if(A.dataset.toggleListenerAttached==="true")return;let C=A.querySelector("summary");C&&(C.addEventListener("click",b=>{b.preventDefault(),A.hasAttribute("open")?A.removeAttribute("open"):A.setAttribute("open","")}),A.dataset.toggleListenerAttached="true")});let h=a.querySelector(".aipkit_enhancer_settings_popover");h&&h.dataset.checkboxDelegateAttached!=="true"&&(h.addEventListener("click",A=>{let C=A.target?.closest?.(".aipkit_switch");if(C&&h.contains(C)){let T=C.querySelector('input[type="checkbox"]');if(!T||T.disabled)return;A.preventDefault(),T.checked=!T.checked,T.dispatchEvent(new Event("change",{bubbles:!0}));return}let b=A.target.closest(".aipkit_checkbox-label");if(!b||!h.contains(b))return;let x=b.querySelector('input[type="checkbox"]');!x||x.disabled||A.target!==x&&(A.preventDefault(),x.checked=!x.checked,x.dispatchEvent(new Event("change",{bubbles:!0})))}),h.dataset.checkboxDelegateAttached="true");function v(){typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess(),a&&(a.classList.remove("aipkit-active"),a.addEventListener("transitionend",()=>a.remove(),{once:!0}),setTimeout(()=>a?.remove(),500))}a.querySelector(".aipkit-modal-close-btn").addEventListener("click",v);let S=a.querySelector("#aipkit_bulk_ai_provider"),q=a.querySelector("#aipkit_bulk_ai_model"),y=a.querySelector("#aipkit_bulk_ai_temperature"),E=a.querySelector("#aipkit_bulk_ai_temperature_value"),I=a.querySelector("#aipkit_bulk_content_max_tokens"),w=a.querySelector("#aipkit_bulk_content_max_tokens_value");if(S&&q&&typeof window.aipkit_enhancer_populateBulkModels=="function"&&(S.addEventListener("change",()=>window.aipkit_enhancer_populateBulkModels(S,q)),window.aipkit_enhancer_populateBulkModels(S,q)),q&&typeof window.aipkit_enhancer_toggleReasoningEffort=="function"&&q.addEventListener("change",()=>window.aipkit_enhancer_toggleReasoningEffort(a)),y&&E&&y.addEventListener("input",()=>E.textContent=y.value),I&&w){let A=()=>{let C=r(I.value);w.textContent=`${C.words} words`};I.addEventListener("input",A),A()}typeof window.aipkit_enhancer_initTemplateControls=="function"&&window.aipkit_enhancer_initTemplateControls(a),n(a),typeof window.aipkit_enhancer_initBulkPromptPopovers=="function"&&window.aipkit_enhancer_initBulkPromptPopovers(a),typeof window.aipkit_enhancer_initBulkPromptFlyouts=="function"&&window.aipkit_enhancer_initBulkPromptFlyouts(a),a.querySelector("#aipkit_bulk_enhancer_start_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_startBulkProcess=="function"&&window.aipkit_enhancer_startBulkProcess(l)}),a.querySelector("#aipkit_bulk_enhancer_stop_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_stopBulkProcess=="function"&&window.aipkit_enhancer_stopBulkProcess()}),a.querySelector("#aipkit_bulk_enhancer_back_to_settings_btn").addEventListener("click",()=>{typeof window.aipkit_enhancer_returnToSettings=="function"&&window.aipkit_enhancer_returnToSettings()}),s(a)}window.aipkit_enhancer_attachBulkModalListeners=d})();(function(){"use strict"})();(function(){"use strict";function k(o,r,i){let t=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithError(o.message||t.error_loading_title,t):r?window.aipkit_updateModalWithSuggestions(r,t):window.aipkit_updateModalWithError(t.error_loading_title||"Unknown error occurred.",t)}window.aipkit_handleTitleSuggestionsResult=k})();(function(){"use strict";function k(o,r,i){let t=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorExcerpt(o.message||t.error_loading_excerpt,t):r?window.aipkit_updateModalWithExcerptSuggestions(r,t):window.aipkit_updateModalWithErrorExcerpt(t.error_loading_excerpt||"Unknown error occurred.",t)}window.aipkit_handleExcerptSuggestionsResult=k})();(function(){"use strict";function k(o,r,i){let t=(window.aipkit_post_enhancer||{}).text||{};o?window.aipkit_updateModalWithErrorMeta(o.message||t.error_loading_meta,t):r?window.aipkit_updateModalWithMetaSuggestions(r,t):window.aipkit_updateModalWithErrorMeta(t.error_loading_meta||"Unknown error occurred.",t)}window.aipkit_handleMetaSuggestionsResult=k})();(function(){"use strict";function k(){}function o(){document.getElementById("aipkit_bulk_enhance_btn")}window.aipkit_initBulkEnhancerButton=o})();(function(){"use strict";function k(r){let i=r.target.closest(".aipkit_enhancer_item"),e=r.target.closest("#aipkit_bulk_enhance_btn");if(i){if(i.classList.contains("aipkit_enhancer_placeholder")){r.target.tagName==="A"&&r.preventDefault();return}r.preventDefault();let t=i.getAttribute("data-post-id"),c=i.getAttribute("data-action-type");if(!t||!c)return;let s=window.aipkit_post_enhancer||{},n=s.text||{};switch(c){case"title":window.aipkit_showLoadingModal(t,n,s),window.aipkit_fetchTitleSuggestions(t,window.aipkit_handleTitleSuggestionsResult,i);break;case"excerpt":window.aipkit_showLoadingExcerptModal(t,n,s),window.aipkit_fetchExcerptSuggestions(t,window.aipkit_handleExcerptSuggestionsResult,i);break;case"meta":window.aipkit_showLoadingMetaModal(t,n,s),window.aipkit_fetchMetaSuggestions(t,window.aipkit_handleMetaSuggestionsResult,i);break;case"tags":window.aipkit_showLoadingTagsModal(t,n,s),window.aipkit_fetchTagsSuggestions(t,window.aipkit_handleTagsSuggestionsResult,i);break;default:console.warn(`AIPKit Post Enhancer Events: Unhandled action type '${c}'.`);break}}else if(e){r.preventDefault();let t=document.querySelectorAll('input[name="post[]"]:checked');if(t.length===0){alert("Please select at least one post.");return}let c=Array.from(t).map(n=>n.value),s=window.typenow||"post";typeof window.aipkit_enhancer_createAndShowBulkModal=="function"?window.aipkit_enhancer_createAndShowBulkModal(c,s):alert("Error: Bulk processing feature is not available.")}}function o(){let r=document;if(!r)return;let i="data-post-enhancer-listener";document.body.getAttribute(i)||(r.addEventListener("click",k),document.body.setAttribute(i,"true"))}window.aipkit_initEnhancerEventListeners=o})();(function(){"use strict";function k(){if(!["aipkit_handleTitleSuggestionsResult","aipkit_handleExcerptSuggestionsResult","aipkit_handleMetaSuggestionsResult","aipkit_handleTagsSuggestionsResult","aipkit_initEnhancerEventListeners","aipkit_initBulkEnhancerButton"].every(r=>typeof window[r]=="function")){console.error("AIPKit Post Enhancer Init: One or more required modular functions are missing.");return}window.aipkit_initEnhancerEventListeners(),window.aipkit_initBulkEnhancerButton(),function(){let i=new WeakMap;function e(d){c(d),d.classList.add("aipkit-open")}function t(d){c(d);let a=setTimeout(()=>{d.classList.remove("aipkit-open")},180);i.set(d,a)}function c(d){let a=i.get(d);a&&(clearTimeout(a),i.delete(d))}function s(d){if(!d||d.dataset.aipkitHoverBound==="1")return;d.dataset.aipkitHoverBound="1",d.addEventListener("mouseenter",()=>e(d)),d.addEventListener("mouseleave",()=>t(d));let a=d.querySelector(".aipkit_enhancer_popover");a&&(a.addEventListener("mouseenter",()=>e(d)),a.addEventListener("mouseleave",()=>t(d)))}function n(){document.querySelectorAll(".aipkit_enhancer_action").forEach(s),new MutationObserver(l=>{for(let p of l)p.addedNodes&&p.addedNodes.length&&p.addedNodes.forEach(_=>{_.nodeType===1&&(_.matches&&_.matches(".aipkit_enhancer_action")&&s(_),_.querySelectorAll&&_.querySelectorAll(".aipkit_enhancer_action").forEach(s))})}).observe(document.body,{childList:!0,subtree:!0})}n()}()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.aipkit_initPostEnhancer=k})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){r()}function r(){let i=document.getElementById("aipkit_vpp_embedding_model_select");if(!i){console.error("VPP Embedding Util: Embedding model select not found.");return}let e=window.aipkit_vpp_config||{},t=e.text||{};i.innerHTML=`<option value="">${k(t.select_model||"-- Select Model --")}</option>`;let c=[{key:"openai",label:"OpenAI",models:e.openaiEmbeddingModels||[]},{key:"google",label:"Google",models:e.googleEmbeddingModels||[]},{key:"openrouter",label:"OpenRouter",models:e.openrouterEmbeddingModels||[]},{key:"azure",label:"Azure",models:e.azureEmbeddingModels||[]}],s=!1;c.forEach(n=>{if(!n.models||n.models.length===0)return;s=!0;let d=document.createElement("optgroup");d.label=n.label,n.models.forEach(a=>{if(a&&a.id){let l=document.createElement("option");l.value=a.id,l.textContent=k(a.name||a.id),l.dataset.provider=n.key,d.appendChild(l)}}),d.children.length&&i.appendChild(d)}),s?(i.disabled=!1,i.options.length>1&&(i.selectedIndex=1)):(i.appendChild(new Option(k(t.no_embedding_models||"(No embedding models - Sync in AI Settings)"),"")),i.disabled=!0)}window.aipkit_vpp_populateEmbeddingConfigSelects=o,window.aipkit_vpp_populateEmbeddingModelSelect=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){let i=document.getElementById("aipkit_vpp_openai_vector_store_id"),e=document.getElementById("aipkit_vpp_openai_store_status"),t=window.aipkit_vpp_config||{},c=t.text||{},s=t.openai_vector_stores||[];if(!i){console.error("VPP OpenAI Provider: Store select not found.");return}i.innerHTML="",e&&(e.textContent=""),s.length>0?(i.appendChild(new Option(`-- ${k(c.select_store||"Select Existing Store")} --`,"")),s.forEach(n=>{let d="(Files: N/A)";n.file_counts&&typeof n.file_counts.total=="number"?d=`(${n.file_counts.total} ${n.file_counts.total===1?"File":"Files"})`:n.file_counts&&(d="(Files: ?)");let a=`${k(n.name||n.id)} ${d}`,l=new Option(a,n.id);i.appendChild(l)})):i.appendChild(new Option(k(c.no_stores_found||"No stores found. Create one in AI Training > Knowledge Base."),"")),i.disabled=s.length===0}async function r(i,e,t,c){let s=window.aipkit_vpp_config||{},n=s.text||{},d=i.length,a=0,l=0,p=0,_=[];try{let f=s.nonce_index_posts;if(!f)throw new Error("Nonce for indexing posts is missing in config.");for(let m of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}a++;let u=document.querySelector(`#post-${m}`),h=u?u.querySelector(".title .row-title"):null,v=h?h.textContent.trim():`Post #${m}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(m,"processing","",v),typeof window.aipkit_vpp_updateProgress=="function"){let q=a/d*100,y=(n.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",a).replace("%2$d",d)+` "${k(v)}"`;window.aipkit_vpp_updateProgress(q,y)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let S={_ajax_nonce:f,post_ids:[m],post_type:c,target_store_id:e,new_store_name_openai:t||"",provider:"openai"};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",S),l++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(m,"success","",v)}catch(q){if(p++,_.push({id:m,title:v,error:q.message}),console.error(`VPP OpenAI Provider: Failed to index Post ID ${m}:`,q),typeof window.aipkit_vpp_updateProgressItem=="function"){let y=q?.message||n.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(m,"error",y,v)}}}let g=`Indexing complete. ${l} successful, ${p} failed.`;window.aipkit_isIndexingStopped&&a<d?g=`Indexing stopped. ${l} successful, ${p} failed.`:p>0&&console.error("Failed Posts:",_),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g,p>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${l}/${d}`)}catch(f){console.error("VPP OpenAI Provider: Indexing setup error:",f),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,n.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(f.message||"Failed to start indexing.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),p>0?5e3:2e3)}}window.aipkit_vpp_populateOpenAIStoresSelect=o,window.aipkit_vpp_startIndexingOpenAI=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){let i=document.getElementById("aipkit_vpp_pinecone_target_index_select"),e=document.getElementById("aipkit_vpp_pinecone_index_status"),t=window.aipkit_vpp_config||{},c=t.text||{},s=t.pinecone_indexes||[];if(!i){console.error("VPP Pinecone Provider: Index select not found.");return}i.innerHTML="",e&&(e.textContent=""),s.length>0?(i.appendChild(new Option(`-- ${k(c.select_pinecone_index||"Select Pinecone Index")} --`,"")),s.forEach(n=>{let d=n.name||n.id;if(d){let a=`${k(d)} (${n.dimension||"?"})`;i.appendChild(new Option(a,d))}})):i.appendChild(new Option(k(c.no_pinecone_indexes_found||"No Pinecone indexes found. Create one in AI Training or via Pinecone console."),"")),i.disabled=s.length===0}async function r(i,e,t,c,s){let n=window.aipkit_vpp_config||{},d=n.text||{},a=i.length,l=0,p=0,_=0,f=[];try{let g=n.nonce_index_posts;if(!g)throw new Error("Nonce for indexing posts is missing in config.");for(let u of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}l++;let h=document.querySelector(`#post-${u}`),v=h?h.querySelector(".title .row-title"):null,S=v?v.textContent.trim():`Post #${u}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"processing","",S),typeof window.aipkit_vpp_updateProgress=="function"){let y=l/a*100,E=(d.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",l).replace("%2$d",a)+` "${k(S)}"`;window.aipkit_vpp_updateProgress(y,E)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let q={_ajax_nonce:g,post_ids:[u],post_type:s,target_index_id:e,provider:"pinecone",embedding_provider:t,embedding_model:c};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",q),p++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"success","",S)}catch(y){if(_++,f.push({id:u,title:S,error:y.message}),console.error(`VPP Pinecone Provider: Failed to index Post ID ${u}:`,y),typeof window.aipkit_vpp_updateProgressItem=="function"){let E=y?.message||d.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(u,"error",E,S)}}}let m=`Indexing complete. ${p} successful, ${_} failed.`;window.aipkit_isIndexingStopped&&l<a?m=`Indexing stopped. ${p} successful, ${_} failed.`:_>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,_>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${p}/${a}`)}catch(g){console.error("VPP Pinecone Provider: Indexing error:",g),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,d.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g.message||"Failed to index content to Pinecone.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),_>0?5e3:2e3)}}window.aipkit_vpp_populatePineconeIndexesSelect=o,window.aipkit_vpp_startIndexingPinecone=r})();(function(){"use strict";let k=window.aipkit_escapeHtml||function(i){return i};function o(){let i=document.getElementById("aipkit_vpp_qdrant_target_collection_select"),e=document.getElementById("aipkit_vpp_qdrant_collection_status"),t=window.aipkit_vpp_config||{},c=t.text||{},s=t.qdrant_collections||[];if(!i){console.error("VPP Qdrant Provider: Collection select not found.");return}i.innerHTML="",e&&(e.textContent=""),s.length>0?(i.appendChild(new Option(`-- ${k(c.select_qdrant_collection||"Select Qdrant Collection")} --`,"")),s.forEach(n=>{let d=n.name||n.id;d&&i.appendChild(new Option(k(d),d))})):i.appendChild(new Option(k(c.no_qdrant_collections_found||"No Qdrant collections found. Create one in AI Training."),"")),i.disabled=s.length===0}async function r(i,e,t,c,s){let n=window.aipkit_vpp_config||{},d=n.text||{},a=i.length,l=0,p=0,_=0,f=[];try{let g=n.nonce_index_posts;if(!g)throw new Error("Nonce for indexing posts is missing in config.");for(let u of i){if(window.aipkit_isIndexingStopped){window.aipkit_vpp_updateStatus("Indexing stopped by user.","warning");break}l++;let h=document.querySelector(`#post-${u}`),v=h?h.querySelector(".title .row-title"):null,S=v?v.textContent.trim():`Post #${u}`;if(typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"processing","",S),typeof window.aipkit_vpp_updateProgress=="function"){let y=l/a*100,E=(d.indexing_progress||"Processing: %1$d/%2$d").replace("%1$d",l).replace("%2$d",a)+` "${k(S)}"`;window.aipkit_vpp_updateProgress(y,E)}typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus("","info");let q={_ajax_nonce:g,post_ids:[u],post_type:s,target_collection_name:e,provider:"qdrant",embedding_provider:t,embedding_model:c};try{await window.aipkit_apiRequest("aipkit_index_posts_to_vector_store",q),p++,typeof window.aipkit_vpp_updateProgressItem=="function"&&window.aipkit_vpp_updateProgressItem(u,"success","",S)}catch(y){if(_++,f.push({id:u,title:S,error:y.message}),console.error(`VPP Qdrant Provider: Failed to index Post ID ${u}:`,y),typeof window.aipkit_vpp_updateProgressItem=="function"){let E=y?.message||d.status_error||"An error occurred.";window.aipkit_vpp_updateProgressItem(u,"error",E,S)}}}let m=`Indexing complete. ${p} successful, ${_} failed.`;window.aipkit_isIndexingStopped&&l<a?m=`Indexing stopped. ${p} successful, ${_} failed.`:_>0&&console.error("Failed Posts:",f),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(m,_>0||window.aipkit_isIndexingStopped?"warning":"success"),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,`Complete: ${p}/${a}`)}catch(g){console.error("VPP Qdrant Provider: Indexing error:",g),typeof window.aipkit_vpp_updateProgress=="function"&&window.aipkit_vpp_updateProgress(100,d.status_error||"An error occurred."),typeof window.aipkit_vpp_updateStatus=="function"&&window.aipkit_vpp_updateStatus(g.message||"Failed to index content to Qdrant.","error")}finally{typeof window.aipkit_vpp_resetModalAfterProcessing=="function"&&setTimeout(()=>window.aipkit_vpp_resetModalAfterProcessing(),_>0?5e3:2e3)}}window.aipkit_vpp_populateQdrantCollectionsSelect=o,window.aipkit_vpp_startIndexingQdrant=r})();(function(){"use strict";let k=window.wp?.i18n?.__||function(w){return w},o="#aipkit_vpp_modal",r=["#aipkit_vpp_vector_store_provider","#aipkit_vpp_openai_vector_store_id","#aipkit_vpp_pinecone_target_index_select","#aipkit_vpp_qdrant_target_collection_select","#aipkit_vpp_embedding_model_select"].join(", "),i=null,e=null,t=!1,c=new Set(["aipkit_vpp_vector_store_provider"]),s=w=>!!(w&&w.id&&c.has(w.id)),n=w=>String(w||"").trim().toLowerCase(),d=(w,A)=>{if(!w)return;let C="aipkit_settings_select_picker_icon--";w.classList.forEach(x=>{x.startsWith(C)&&w.classList.remove(x)}),w.classList.remove("is-hidden");let b=n(A);if(!b){w.classList.add("is-hidden");return}w.classList.add(`${C}${b}`)},a=w=>{if(!w)return"";let A=w.getAttribute("data-aipkit-picker-title");if(A)return A;let C=w.id&&document.querySelector(`label[for="${w.id}"]`)||w.closest(".aipkit_form-group")?.querySelector(".aipkit_form-label");return C?C.textContent.trim():""},l=w=>{if(!w)return"";let A=w.selectedOptions&&w.selectedOptions.length?w.selectedOptions[0]:w.querySelector("option[selected]");if(A)return A.textContent.trim();let C=w.querySelector("option");return C?C.textContent.trim():""},p=w=>({buttonId:`${w}_picker_btn`,labelId:`${w}_picker_label`,popoverId:`${w}_picker_popover`,titleId:`${w}_picker_title`,searchId:`${w}_picker_search`,listId:`${w}_picker_list`}),_=(w,A)=>{if(!w||!w.id||!A)return null;let C=p(w.id),b=A.querySelector(`#${C.buttonId}`);if(!b){if(b=document.createElement("button"),b.type="button",b.id=C.buttonId,b.className="aipkit_popover_option_btn aipkit_settings_select_picker_btn",b.setAttribute("data-aipkit-popover-target",C.popoverId),b.setAttribute("aria-controls",C.popoverId),b.setAttribute("aria-expanded","false"),b.dataset.aipkitPopoverPlacement="bottom",s(w)){b.classList.add("aipkit_settings_select_picker_btn--provider");let H=document.createElement("span");H.className="aipkit_settings_select_picker_icon",H.setAttribute("aria-hidden","true"),d(H,w.value),b.appendChild(H)}let T=document.createElement("span");T.className="aipkit_settings_select_picker_label",T.id=C.labelId,T.textContent=l(w)||k("Select","gpt3-ai-content-generator");let P=document.createElement("span");P.className="dashicons dashicons-arrow-down-alt2",P.setAttribute("aria-hidden","true"),b.appendChild(T),b.appendChild(P),w.insertAdjacentElement("beforebegin",b)}b.disabled=w.disabled,w.classList.contains("screen-reader-text")||w.classList.add("screen-reader-text");let x=A.querySelector(`#${C.popoverId}`);if(!x){x=document.createElement("div"),x.className="aipkit_model_settings_popover aipkit_settings_select_picker_popover",s(w)&&x.classList.add("aipkit_settings_select_picker_popover--provider"),x.id=C.popoverId,x.setAttribute("aria-hidden","true");let T=document.createElement("div");T.className="aipkit_model_settings_popover_panel aipkit_settings_select_picker_popover_panel",T.setAttribute("role","dialog"),T.setAttribute("aria-labelledby",C.titleId);let P=document.createElement("div");P.className="aipkit_model_settings_popover_header";let H=document.createElement("span");H.className="aipkit_model_settings_popover_title",H.id=C.titleId,H.textContent=a(w)||k("Select","gpt3-ai-content-generator");let O=document.createElement("button");O.type="button",O.className="aipkit_model_settings_popover_close",O.setAttribute("aria-label",k("Close","gpt3-ai-content-generator")),O.innerHTML='<span class="dashicons dashicons-no-alt"></span>',P.appendChild(H),P.appendChild(O);let F=document.createElement("div");F.className="aipkit_model_settings_popover_body";let M=document.createElement("div");M.className="aipkit_settings_select_picker_search";let B=document.createElement("input");B.type="search",B.id=C.searchId,B.className="aipkit_form-input";let V=a(w),L=V?`Search ${V.toLowerCase()}...`:k("Search...","gpt3-ai-content-generator");B.setAttribute("placeholder",L),M.appendChild(B);let U=document.createElement("div");U.className="aipkit_settings_select_picker_list",U.id=C.listId,U.setAttribute("role","listbox"),F.appendChild(M),F.appendChild(U),T.appendChild(P),T.appendChild(F),x.appendChild(T),A.appendChild(x),(s(w)||w.dataset.aipkitPickerSearch==="false")&&(M.style.display="none")}return{ids:C,button:b,popover:x,label:A.querySelector(`#${C.labelId}`),search:A.querySelector(`#${C.searchId}`),list:A.querySelector(`#${C.listId}`)}},f=w=>{let A=[];return w&&Array.from(w.children).forEach(b=>{if(b.tagName==="OPTGROUP"){let x=Array.from(b.children).filter(T=>T.tagName==="OPTION").map(T=>({value:T.value,label:T.textContent.trim(),disabled:T.disabled,selected:T.selected}));A.push({groupLabel:b.label||"",options:x})}else b.tagName==="OPTION"&&A.push({groupLabel:"",options:[{value:b.value,label:b.textContent.trim(),disabled:b.disabled,selected:b.selected}]})}),A},g=(w,A,C="")=>{if(!w||!A)return;let b=C.trim().toLowerCase();A.innerHTML="";let x=f(w),T=!1;if(x.forEach(P=>{let H=P.options.filter(O=>b?O.label.toLowerCase().includes(b):!0);if(H.length){if(P.groupLabel){let O=document.createElement("div");O.className="aipkit_settings_select_picker_group_label",O.textContent=P.groupLabel,A.appendChild(O)}H.forEach(O=>{let F=document.createElement("button");if(F.type="button",F.className="aipkit_settings_select_picker_item",F.setAttribute("role","option"),F.dataset.value=O.value,F.dataset.label=O.label,O.disabled&&(F.classList.add("is-disabled"),F.setAttribute("aria-disabled","true")),w.value===O.value?(F.classList.add("is-active"),F.setAttribute("aria-selected","true")):F.setAttribute("aria-selected","false"),s(w)){F.classList.add("aipkit_settings_select_picker_item--provider");let V=document.createElement("span");V.className="aipkit_settings_select_picker_icon",V.setAttribute("aria-hidden","true"),d(V,O.value),F.appendChild(V)}let M=document.createElement("span");M.className="aipkit_settings_select_picker_text",M.textContent=O.label;let B=document.createElement("span");B.className="dashicons dashicons-yes aipkit_settings_select_picker_check",F.appendChild(M),F.appendChild(B),A.appendChild(F),T=!0})}}),!T){let P=document.createElement("div");P.className="aipkit_settings_select_picker_empty",P.textContent=k(b?"No matches found.":"No options available.","gpt3-ai-content-generator"),A.appendChild(P)}},m=(w,A,C)=>{if(!w||!A)return;let b=l(w);if(A.textContent=b||k("Select","gpt3-ai-content-generator"),C&&(C.disabled=w.disabled),s(w)){let x=C?C.querySelector(".aipkit_settings_select_picker_icon"):null;d(x,w.value)}},u=(w,A)=>{if(!w||!A)return;let C=w.getBoundingClientRect(),b=A.getBoundingClientRect(),x=b.width||320,T=b.height||0,P=window.innerWidth,H=window.innerHeight,O=12,F=C.left;F+x>P-O&&(F=C.right-x),F=Math.max(O,Math.min(F,P-x-O));let M=C.bottom+8;M+T>H-O&&(M=C.top-T-8),M=Math.max(O,Math.min(M,H-T-O)),A.style.left=`${Math.round(F)}px`,A.style.top=`${Math.round(M)}px`},h=()=>{!i||!e||t||(t=!0,window.requestAnimationFrame(()=>{let w=i.querySelector(".aipkit_model_settings_popover_panel");u(e,w),t=!1}))},v=()=>{i&&(i.classList.remove("aipkit-active"),i.setAttribute("aria-hidden","true"),e&&e.setAttribute("aria-expanded","false"),i=null,e=null)},S=(w,A,C)=>{if(!w||!A)return;i&&i!==A&&v(),i=A,e=w,A.classList.add("aipkit-active"),A.setAttribute("aria-hidden","false"),w.setAttribute("aria-expanded","true");let b=A.querySelector(".aipkit_settings_select_picker_search input"),x=A.querySelector(".aipkit_settings_select_picker_list");x&&g(C,x,b?b.value:""),b&&b.offsetParent!==null&&(b.focus(),b.select());let T=A.querySelector(".aipkit_model_settings_popover_panel");window.requestAnimationFrame(()=>{u(w,T)})},q=(w,A)=>{if(!w||!A)return;let{button:C,popover:b,list:x,search:T,label:P}=A;if(C&&C.dataset.pickerListenerAttached!=="true"&&(C.addEventListener("click",H=>{if(H.preventDefault(),!C.disabled){if(i===b){v();return}S(C,b,w)}}),C.dataset.pickerListenerAttached="true"),b&&b.dataset.overlayListenerAttached!=="true"){b.addEventListener("click",O=>{O.target===b&&v()});let H=b.querySelector(".aipkit_model_settings_popover_close");H&&H.addEventListener("click",O=>{O.preventDefault(),v()}),b.dataset.overlayListenerAttached="true"}if(x&&x.dataset.pickerListenerAttached!=="true"&&(x.addEventListener("click",H=>{let O=H.target.closest(".aipkit_settings_select_picker_item");if(!O||O.classList.contains("is-disabled"))return;let F=O.dataset.value??"";w.value=F,w.dispatchEvent(new Event("change",{bubbles:!0})),m(w,P,C),g(w,x,T?T.value:""),v()}),x.dataset.pickerListenerAttached="true"),T&&T.dataset.pickerListenerAttached!=="true"&&(T.addEventListener("input",()=>{g(w,x,T.value)}),T.dataset.pickerListenerAttached="true"),w&&w.dataset.pickerListenerAttached!=="true"&&(w.addEventListener("change",()=>{m(w,P,C),g(w,x,T?T.value:""),i===b&&v()}),w.dataset.pickerListenerAttached="true"),w&&w.dataset.pickerObserverAttached!=="true"){let H=!1;new MutationObserver(()=>{H||(H=!0,window.requestAnimationFrame(()=>{m(w,P,C),g(w,x,T?T.value:""),H=!1}))}).observe(w,{childList:!0,subtree:!0}),w.dataset.pickerObserverAttached="true"}document.body.dataset.aipkitVppPickerEscapeBound||(document.addEventListener("keydown",H=>{H.key==="Escape"&&i&&v()}),document.body.dataset.aipkitVppPickerEscapeBound="true"),document.body.dataset.aipkitVppPickerRepositionBound||(window.addEventListener("resize",h),window.addEventListener("scroll",h,!0),document.body.dataset.aipkitVppPickerRepositionBound="true")};function y(w){if(!w||w.dataset.aipkitVppPickerInit==="true")return;let A=w.querySelectorAll(r);A.length&&(A.forEach(C=>{if(!C.id||C.dataset.aipkitPickerInit==="true")return;let b=_(C,w);b&&(m(C,b.label,b.button),g(C,b.list,b.search?b.search.value:""),q(C,b),C.dataset.aipkitPickerInit="true")}),w.dataset.aipkitVppPickerInit="true")}function E(){document.querySelectorAll(o).forEach(y)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E(),new MutationObserver(E).observe(document.body,{childList:!0,subtree:!0}),window.aipkit_initVppSelectPickers=y})();(function(){"use strict";let k="aipkit_vpp_modal",o=window.aipkit_escapeHtml||function(v){return v},r=window.aipkit_escapeAttribute||o,i=[],e="",t=!1,c=v=>{if(!v)return"Post";let S=window.aipkit_vpp_postTitles||{};if(S[v])return S[v];let q=document.querySelector(`#post-${v}`),y=q?q.querySelector(".title .row-title")||q.querySelector("strong a")||q.querySelector(".title a")||q.querySelector("a.row-title")||q.querySelector(".column-title strong a")||q.querySelector(".column-title .row-title"):null,E=y?y.textContent.trim():`Post #${v}`;return S[v]=E,window.aipkit_vpp_postTitles=S,E},s=v=>{let S=window.aipkit_vpp_config?.text||{};return{pending:S.status_pending||"Pending",processing:S.status_processing||"Processing",success:S.status_completed||"Completed",error:S.status_failed||"Failed",stopped:S.status_stopped||"Stopped"}[v]||v},n=(v,S)=>{let q=document.createElement("div");q.className="aipkit_vpp_progress_item aipkit_vpp_progress_item--pending",q.dataset.postId=v;let y=document.createElement("div");y.className="aipkit_vpp_progress_item_main";let E=document.createElement("div");E.className="aipkit_vpp_progress_item_title",E.textContent=S;let I=document.createElement("div");I.className="aipkit_vpp_progress_item_message",I.textContent="",I.style.display="none";let w=document.createElement("div");return w.className="aipkit_vpp_progress_item_status",w.textContent=s("pending"),y.appendChild(E),y.appendChild(I),q.appendChild(y),q.appendChild(w),q};function d(v,S){if(document.getElementById(k)){console.warn("VPP Modal UI: Modal already exists.");return}i=v,e=S,t=!1;let y=(window.aipkit_vpp_config||{}).text||{},E="",I=v.length;I===1?E=o(y.items_selected_singular||"You have selected %d item to index.").replace("%d",`<strong>${I}</strong>`):E=o(y.items_selected_plural||"You have selected %d items to index.").replace("%d",`<strong>${I}</strong>`);let w=document.createElement("div");w.id=k,w.className="aipkit-modal-overlay aipkit-active";let A=document.createElement("div");A.className="aipkit-modal-content aipkit_vpp_modal_content",A.innerHTML=`
            <div class="aipkit-modal-header aipkit_vpp_modal_header">
                <div class="aipkit_vpp_header_left">
                    <span class="aipkit_vpp_header_icon" aria-hidden="true">
                        <span class="dashicons dashicons-database"></span>
                    </span>
                    <div class="aipkit_vpp_header_text">
                        <h3 class="aipkit-modal-title">${o(y.modal_title||"Add Content to Vector Store")}</h3>
                        <span class="aipkit_vpp_header_subtitle">${o(y.modal_subtitle||"Index selected content for retrieval")}</span>
                    </div>
                </div>
                <button type="button" class="aipkit-modal-close-btn aipkit_vpp_close_btn" aria-label="${r(y.close||"Close")}">\xD7</button>
            </div>
            <div class="aipkit-modal-body aipkit_vpp_modal_body">
                <div id="aipkit_vpp_status_message" class="aipkit_vpp_status_message" aria-live="polite"></div>

                <div class="aipkit_vpp_selection_card">
                    <span class="aipkit_vpp_selection_text">${E}</span>
                </div>

                <div class="aipkit_vpp_engine_card">
                    <div class="aipkit_enhancer_engine_card">
                        <div class="aipkit_enhancer_engine_fields">
                            <div class="aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_vector_store_provider">${o(y.provider_label||"Provider")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_vector_store_provider" class="aipkit_enhancer_engine_select">
                                            <option value="openai" selected>OpenAI</option>
                                            <option value="pinecone">Pinecone</option>
                                            <option value="qdrant">Qdrant</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_openai_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field">
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_openai_vector_store_id">${o(y.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_openai_vector_store_id" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(y.loading_stores||"Loading stores...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_pinecone_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_pinecone_target_index_select">${o(y.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_pinecone_target_index_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(y.loading_indexes||"Loading indexes...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_qdrant_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_qdrant_target_collection_select">${o(y.target_label||"Target")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_qdrant_target_collection_select" class="aipkit_enhancer_engine_select">
                                            <option value="">${o(y.loading_indexes||"Loading collections...")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div id="aipkit_vpp_embedding_options" class="aipkit_vpp_provider_panel aipkit_enhancer_engine_field" hidden>
                                <div class="aipkit_enhancer_engine_field_content">
                                    <label class="aipkit_enhancer_engine_field_label" for="aipkit_vpp_embedding_model_select">${o(y.embedding_label||"Embedding")}</label>
                                    <div class="aipkit_enhancer_engine_select_wrap">
                                        <select id="aipkit_vpp_embedding_model_select" class="aipkit_enhancer_engine_select" data-aipkit-picker-search="false">
                                            <option value="">${o(y.select_model||"-- Select Model --")}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="aipkit_vpp_progress_area" class="aipkit_vpp_section aipkit_vpp_section--progress" hidden>
                    <div class="aipkit_vpp_section_header">
                        <span class="aipkit_vpp_section_title">${o(y.section_progress_title||"Progress")}</span>
                    </div>
                    <div class="aipkit_vpp_progress_bar_container">
                        <div class="aipkit_vpp_progress_bar"></div>
                    </div>
                    <div id="aipkit_vpp_progress_text" class="aipkit_vpp_progress_text"></div>
                    <div id="aipkit_vpp_progress_log" class="aipkit_vpp_progress_log" role="list"></div>
                </div>
            </div>
            <div class="aipkit-modal-footer aipkit_vpp_modal_footer">
                <button type="button" id="aipkit_vpp_start_indexing_btn" class="aipkit_btn aipkit_btn-primary">
                     <span class="aipkit_btn-text">${o(y.start_indexing||"Start Indexing")}</span>
                     <span class="aipkit_spinner" hidden></span>
                </button>
                <button type="button" id="aipkit_vpp_stop_indexing_btn" class="aipkit_btn aipkit_btn-danger" hidden>
                     <span class="aipkit_btn-text">${o(y.stop||"Stop")}</span>
                </button>
            </div>
        `,w.appendChild(A),document.body.appendChild(w),A.addEventListener("click",b=>{let x=b.target;x.closest(".aipkit-modal-close-btn")||x.closest(".aipkit_vpp_modal_close_btn")?l():x.closest("#aipkit_vpp_start_indexing_btn")?h():x.closest("#aipkit_vpp_stop_indexing_btn")&&a()}),w.addEventListener("click",b=>{b.target===w&&l()});let C=document.getElementById("aipkit_vpp_vector_store_provider");C&&(C.addEventListener("change",u),u({target:C}))}function a(){window.aipkit_isIndexingStopped=!0;let v=document.getElementById("aipkit_vpp_stop_indexing_btn"),S=window.aipkit_vpp_config?.text||{};if(v){v.disabled=!0;let q=v.querySelector(".aipkit_btn-text");q&&(q.textContent=S.stopping||"Stopping...")}}function l(){window.aipkit_isIndexingStopped=!0;let v=document.getElementById(k);v&&(v.classList.remove("aipkit-active"),setTimeout(()=>{v.parentNode&&v.parentNode.removeChild(v)},300))}function p(v,S){let q=document.querySelector(`#${k} .aipkit_vpp_progress_bar`),y=document.getElementById("aipkit_vpp_progress_text");q&&(q.style.width=`${Math.max(0,Math.min(100,v))}%`),y&&(y.textContent=S)}function _(v){let S=document.getElementById("aipkit_vpp_progress_log");if(!S)return;S.innerHTML="";let q=document.createDocumentFragment();(v||[]).forEach(y=>{let E=c(y);q.appendChild(n(y,E))}),S.appendChild(q),S.scrollTop=0}function f(v,S,q="",y=""){let E=document.getElementById("aipkit_vpp_progress_log");if(!E)return;let I=`.aipkit_vpp_progress_item[data-post-id="${v}"]`,w=E.querySelector(I);if(!w){let b=y||c(v);w=n(v,b),E.appendChild(w)}w.className=`aipkit_vpp_progress_item aipkit_vpp_progress_item--${S}`;let A=w.querySelector(".aipkit_vpp_progress_item_status"),C=w.querySelector(".aipkit_vpp_progress_item_message");A&&(A.textContent=s(S)),C&&(C.textContent=q||"",C.style.display=q?"":"none"),E.scrollTop=E.scrollHeight}function g(v,S="info"){let q=document.getElementById("aipkit_vpp_status_message");q&&(q.textContent=v,q.className=`aipkit_vpp_status_message aipkit_message-${S}`)}function m(){t=!1;let v=document.getElementById("aipkit_vpp_start_indexing_btn"),S=document.getElementById("aipkit_vpp_stop_indexing_btn"),q=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`),y=window.aipkit_vpp_config?.text||{};if(v){typeof window.aipkit_setButtonText=="function"&&window.aipkit_setButtonText(v,y.start_indexing||"Start Indexing"),v.disabled=!1,v.hidden=!1;let I=v.querySelector(".aipkit_spinner");I&&(I.hidden=!0)}if(S){S.hidden=!0,S.disabled=!1;let I=S.querySelector(".aipkit_btn-text");I&&(I.textContent=y.stop||"Stop")}q.forEach(I=>I.disabled=!1);let E=document.getElementById("aipkit_vpp_progress_area");E&&(E.hidden=!1)}function u(v){let S=v.target.value,q=document.getElementById("aipkit_vpp_openai_options"),y=document.getElementById("aipkit_vpp_pinecone_options"),E=document.getElementById("aipkit_vpp_qdrant_options"),I=document.getElementById("aipkit_vpp_embedding_options");q&&(q.hidden=!0),y&&(y.hidden=!0),E&&(E.hidden=!0),I&&(I.hidden=!0),S==="openai"?(q&&(q.hidden=!1),typeof window.aipkit_vpp_populateOpenAIStoresSelect=="function"&&window.aipkit_vpp_populateOpenAIStoresSelect()):S==="pinecone"?(y&&(y.hidden=!1),I&&(I.hidden=!1),typeof window.aipkit_vpp_populatePineconeIndexesSelect=="function"&&window.aipkit_vpp_populatePineconeIndexesSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects()):S==="qdrant"&&(E&&(E.hidden=!1),I&&(I.hidden=!1),typeof window.aipkit_vpp_populateQdrantCollectionsSelect=="function"&&window.aipkit_vpp_populateQdrantCollectionsSelect(),typeof window.aipkit_vpp_populateEmbeddingConfigSelects=="function"&&window.aipkit_vpp_populateEmbeddingConfigSelects())}function h(){if(t)return;window.aipkit_isIndexingStopped=!1;let v=document.getElementById("aipkit_vpp_vector_store_provider").value,S=window.aipkit_vpp_config?.text||{},q="",y={post_ids:i,post_type:e,provider:v};if(v==="openai"){if(q=document.getElementById("aipkit_vpp_openai_vector_store_id").value,!q){g(S.error_no_store_selected_vpp||"Please select an existing OpenAI store.","error");return}y.target_store_id=q}else if(v==="pinecone"){if(q=document.getElementById("aipkit_vpp_pinecone_target_index_select").value,!q){g(S.error_no_pinecone_index_selected||"Please select a Pinecone index.","error");return}y.target_index_id=q;let C=document.getElementById("aipkit_vpp_embedding_model_select"),b=C?.selectedOptions&&C.selectedOptions.length?C.selectedOptions[0]:null;if(y.embedding_model=C?C.value:"",y.embedding_provider=b&&b.dataset.provider||"",!y.embedding_provider||!y.embedding_model){g(S.error_no_embedding_config||"Please select an embedding model for Pinecone.","error");return}}else if(v==="qdrant"){if(q=document.getElementById("aipkit_vpp_qdrant_target_collection_select").value,!q){g(S.error_no_qdrant_collection_selected||"Please select a Qdrant collection.","error");return}y.target_collection_name=q;let C=document.getElementById("aipkit_vpp_embedding_model_select"),b=C?.selectedOptions&&C.selectedOptions.length?C.selectedOptions[0]:null;if(y.embedding_model=C?C.value:"",y.embedding_provider=b&&b.dataset.provider||"",!y.embedding_provider||!y.embedding_model){g(S.error_no_embedding_config||"Please select an embedding model for Qdrant.","error");return}}else{g(`Provider ${v} not yet supported for indexing.`,"error");return}t=!0;let E=document.getElementById("aipkit_vpp_start_indexing_btn"),I=document.getElementById("aipkit_vpp_stop_indexing_btn"),w=document.querySelectorAll(`#${k} .aipkit-modal-close-btn, #${k} .aipkit_vpp_modal_close_btn`);if(E&&(E.hidden=!0),I){I.hidden=!1,I.disabled=!1;let C=I.querySelector(".aipkit_btn-text");C&&(C.textContent=S.stop||"Stop")}let A=document.getElementById("aipkit_vpp_progress_area");A&&(A.hidden=!1),typeof window.aipkit_vpp_initProgressLog=="function"&&window.aipkit_vpp_initProgressLog(i),p(0,S.status_preparing||"Preparing..."),v==="openai"&&typeof window.aipkit_vpp_startIndexingOpenAI=="function"?window.aipkit_vpp_startIndexingOpenAI(i,q,null,e):v==="pinecone"&&typeof window.aipkit_vpp_startIndexingPinecone=="function"?window.aipkit_vpp_startIndexingPinecone(i,q,y.embedding_provider,y.embedding_model,e):v==="qdrant"&&typeof window.aipkit_vpp_startIndexingQdrant=="function"&&window.aipkit_vpp_startIndexingQdrant(i,q,y.embedding_provider,y.embedding_model,e)}window.aipkit_vpp_showModal=d,window.aipkit_vpp_closeModal=l,window.aipkit_vpp_updateProgress=p,window.aipkit_vpp_initProgressLog=_,window.aipkit_vpp_updateProgressItem=f,window.aipkit_vpp_updateStatus=g,window.aipkit_vpp_resetModalAfterProcessing=m})();(function(){"use strict";let k="aipkit_add_to_vector_store_btn";function r(){let t=document.querySelectorAll('#the-list input[type="checkbox"][name="post[]"]:checked');if(t.length===0){alert(window.aipkit_vpp_config.text.error_no_posts_selected||"Please select at least one post.");return}let c=Array.from(t).map(s=>s.value);typeof window.aipkit_vpp_showModal=="function"?window.aipkit_vpp_showModal(c,window.aipkit_vpp_config.post_type):(console.error("Vector Post Processor Main: Modal show function (aipkit_vpp_showModal) not found."),alert("Error: UI component for vector store selection is not available."))}function i(){let t=document.getElementById(k);return t&&!t.dataset.vppBound?(t.addEventListener("click",r),t.dataset.vppBound="1",!0):!!(t&&t.dataset.vppBound)}function e(){if(i())return;let t=document.querySelector("#wpbody-content")||document.body,c=Date.now();if(!t)return;let s=new MutationObserver(()=>{(i()||Date.now()-c>15e3)&&s.disconnect()});s.observe(t,{childList:!0,subtree:!0});let n=setInterval(()=>{(i()||Date.now()-c>15e3)&&clearInterval(n)},300)}document.readyState==="loading"||document.readyState==="interactive"?document.addEventListener("DOMContentLoaded",e):e()})();})();
