(()=>{(function(){"use strict";function d(i,r=[],n={}){return{botId:i,triggers:JSON.parse(JSON.stringify(r)),schemas:n,isDirty:!1,editingTriggerId:null}}window.aipkit_initTriggerBuilderState=d})();(function(){"use strict";function d(i){let r=document.getElementById(`aipkit_trigger_builder_${i}`),n=r?r.querySelector(".aipkit_trigger_raw_data_source"):null;if(!n)return console.warn(`AIPKit Trigger Data: Raw data source input for bot ${i} not found.`),[];let o=n.value;try{let e=JSON.parse(o);return Array.isArray(e)?e:[]}catch(e){return console.error(`AIPKit Trigger Data: Failed to parse initial triggers JSON for bot ${i}. Error:`,e,"Raw JSON:",o),[]}}window.aipkit_loadInitialTriggers=d})();(function(){"use strict";function d(i){let r=document.getElementById(`aipkit_trigger_builder_${i}`),n=r?r.querySelector(".aipkit_trigger_schemas_source"):null;if(!n)return console.warn(`AIPKit Trigger Data: Schemas source input for bot ${i} not found.`),{};let o=n.getAttribute("data-schemas");try{let e=JSON.parse(o);return typeof e=="object"&&e!==null?e:{}}catch(e){return console.error(`AIPKit Trigger Data: Failed to parse trigger schemas JSON for bot ${i}. Error:`,e),{}}}window.aipkit_loadTriggerSchemas=d})();(function(){"use strict";function d(i,r){let n=document.getElementById(`aipkit_bot_${i}_triggers_json`);if(!n)return console.error(`AIPKit Trigger Data: Main hidden textarea for triggers JSON (bot ID: ${i}) not found.`),!1;try{return n.value=JSON.stringify(r,null,2),!0}catch(o){return console.error(`AIPKit Trigger Data: Failed to stringify triggers array for bot ${i}.`,o),n.value="[]",!1}}window.aipkit_updateTriggersJsonForSave=d})();(function(){"use strict";let d=null;function i(n){d=n}function r(){return d}window.aipkit_setTriggerBuilderState=i,window.aipkit_getUIBuilderState=r})();(function(){"use strict";function d(i,r){let n=window.aipkit_escapeHtml||function(a){return a},o=[],e=r?.ConditionSchema?.properties?.field;if(!e||!e.description)return console.warn("GetConditionFields: Field schema or description missing."),o;let t=e.description.match(/Examples: (.*)\./);return t&&t[1]&&t[1].split(",").forEach(s=>{let l=s.trim().replace(/"/g,"");i==="user_context"&&(l.includes("user_")||l.includes("logged_in"))?o.push({value:l,label:n(l.replace(/_/g," "))}):i==="text_content"&&l.includes("message_text")?o.push({value:l,label:n(l.replace(/_/g," "))}):i==="conversation_state"&&l.includes("message_count")?o.push({value:l,label:n(l.replace(/_/g," "))}):i==="ai_model_context"&&(l.includes("provider")||l.includes("model"))?o.push({value:l,label:n(l.replace(/_/g," "))}):i==="error_context"&&(l.includes("error_")||l.includes("failed_"))?o.push({value:l,label:n(l.replace(/_/g," "))}):i==="http_context"&&(l.includes("http_")||l.includes("user_agent")||l.includes("referer"))?o.push({value:l,label:n(l.replace(/_/g," "))}):i==="post_context"&&l.includes("post_")&&o.push({value:l,label:n(l.replace(/_/g," "))})}),o.length===0&&e.enum&&e.enum.forEach(a=>o.push({value:a,label:n(a.replace(/_/g," "))})),o.length===0&&o.push({value:"custom_field",label:"Custom Field (Advanced)"}),o.sort((a,s)=>a.label.localeCompare(s.label))}window.aipkit_getConditionFieldsForType=d})();(function(){"use strict";function d(i,r,n){let o=window.aipkit_escapeHtml||function(s){return s},e=n?.ConditionSchema?.properties?.operator?.enum||[],t=[],a="string";return r==="is_logged_in"?a="boolean":r==="message_count"||r==="post_id"||r==="priority"?a="numeric":r==="user_role"&&(a="array_string"),e.forEach(s=>{let l=o(s.replace(/_/g," "));a==="boolean"&&["is_true","is_false"].includes(s)?t.push({value:s,label:l}):a==="string"&&["equals","not_equals","contains","not_contains","starts_with","ends_with","matches_regex","is_empty","is_not_empty","is_one_of","is_not_one_of","equals_ignore_case"].includes(s)?t.push({value:s,label:l}):a==="numeric"&&["greater_than","less_than","equals_numeric","not_equals_numeric","greater_than_or_equals","less_than_or_equals"].includes(s)?t.push({value:s,label:l}):a==="array_string"&&["is_one_of","is_not_one_of","contains","not_contains"].includes(s)&&t.push({value:s,label:l})}),t.length===0&&e.forEach(s=>t.push({value:s,label:o(s.replace(/_/g," "))})),t.sort((s,l)=>s.label.localeCompare(l.label))}window.aipkit_getConditionOperatorsForField=d})();(function(){"use strict";function d(i,r,n=null){if(!window.aipkit_getUIBuilderState()||!i||!r)return;let e=window.aipkit_escapeHtml||function(s){return s},t=i.value;if(["is_true","is_false","is_empty","is_not_empty"].includes(t))r.style.display="none",r.value="";else{r.style.display="",r.type="text",r.placeholder=e("Value");let c=i.closest(".aipkit_condition_row").querySelector(".aipkit_condition_field_select").value;(c==="message_count"||c==="priority")&&(r.type="number",r.step="1"),n&&n.value!==void 0?Array.isArray(n.value)&&(t==="is_one_of"||t==="is_not_one_of")?r.value=n.value.join(", "):r.value=String(n.value):r.value=""}}window.aipkit_updateConditionValueInput=d})();(function(){"use strict";function d(i,r,n,o=null){let e=window.aipkit_getUIBuilderState();if(!e||!i||!r||!n)return;let t=window.aipkit_escapeHtml||function(c){return c},a=i.closest(".aipkit_condition_row").querySelector(".aipkit_condition_type_select").value,s=i.value;if(r.innerHTML="",typeof window.aipkit_getConditionOperatorsForField!="function"){console.error("UpdateConditionOperators: aipkit_getConditionOperatorsForField function not found.");return}let l=window.aipkit_getConditionOperatorsForField(a,s,e.schemas);l.forEach(c=>{r.appendChild(new Option(t(c.label),t(c.value)))}),o&&o.operator?r.value=o.operator:l.length>0&&(r.value=l[0].value),typeof window.aipkit_updateConditionValueInput=="function"&&window.aipkit_updateConditionValueInput(r,n,o)}window.aipkit_updateConditionOperators=d})();(function(){"use strict";function d(i,r,n,o,e=null){let t=window.aipkit_getUIBuilderState();if(!t||!i||!r||!n||!o)return;let a=window.aipkit_escapeHtml||function(c){return c},s=i.value;if(r.innerHTML="",typeof window.aipkit_getConditionFieldsForType!="function"){console.error("UpdateConditionFields: aipkit_getConditionFieldsForType function not found.");return}let l=window.aipkit_getConditionFieldsForType(s,t.schemas);l.forEach(c=>{r.appendChild(new Option(a(c.label),a(c.value)))}),e&&e.field?r.value=e.field:l.length>0&&(r.value=l[0].value),typeof window.aipkit_updateConditionOperators=="function"&&window.aipkit_updateConditionOperators(r,n,o,e)}window.aipkit_updateConditionFields=d})();(function(){"use strict";function d(i,r=null){let n=window.aipkit_getUIBuilderState();if(!n||!i)return;let o=window.aipkit_escapeHtml||function(p){return p},e=document.querySelector(".aipkit_condition_row_template");if(!e){console.error("RenderConditionRow: Condition row template not found.");return}let a=e.content.cloneNode(!0).querySelector(".aipkit_condition_row"),s=a.querySelector(".aipkit_condition_type_select"),l=a.querySelector(".aipkit_condition_field_select"),c=a.querySelector(".aipkit_condition_operator_select"),_=a.querySelector(".aipkit_condition_value_input");(n.schemas?.ConditionSchema?.properties?.type?.enum||[]).forEach(p=>{s.appendChild(new Option(o(p.replace(/_/g," ")),o(p)))}),r?(s.value=r.type||"",typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(s,l,c,_,r)):(s.options.length>0&&(s.value=s.options[0].value),typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(s,l,c,_)),i.appendChild(a)}window.aipkit_renderConditionRow=d})();(function(){"use strict";function d(i,r=[]){if(!window.aipkit_getUIBuilderState()||!i)return;let o=window.aipkit_escapeHtml||function(a){return a},e=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:a=>a,t=i.querySelector(".aipkit_options_list");t&&(t.innerHTML="",(r||[]).forEach((a,s)=>{let l=document.createElement("div");l.className="aipkit_form_element_option_row",l.dataset.optionIndex=s;let c=document.createElement("input");c.type="text",c.className="aipkit_form-input aipkit_element_option_value aipkit_form_element_prop_change",c.placeholder=e("Value (e.g., option1)","gpt3-ai-content-generator"),c.value=o(a.value||""),c.dataset.property=`options[${s}].value`;let _=document.createElement("input");_.type="text",_.className="aipkit_form-input aipkit_element_option_text aipkit_form_element_prop_change",_.placeholder=e("Display Text (e.g., Option One)","gpt3-ai-content-generator"),_.value=o(a.text||""),_.dataset.property=`options[${s}].text`;let p=document.createElement("button");p.type="button",p.className="aipkit_btn aipkit_btn-icon aipkit_form_option_remove_btn",p.title=e("Remove Option","gpt3-ai-content-generator"),p.innerHTML='<span class="dashicons dashicons-no-alt"></span>',l.appendChild(c),l.appendChild(_),l.appendChild(p),t.appendChild(l)}))}window.aipkit_updateFormElementOptionControls=d})();(function(){"use strict";function d(i,r,n){if(!window.aipkit_getUIBuilderState())return console.error("RenderFormElementEditorItem: UI Builder state not initialized."),null;let e=window.aipkit_escapeHtml||function(k){return k},t=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:k=>k,a=`${n}_${i.id||`el_${Date.now()}_${r}`}`,s=document.createElement("div");s.className="aipkit_form_element_editor_item",s.dataset.elementIndex=r,s.dataset.elementId=i.id||"";let l=document.createElement("div");l.className="aipkit_form_element_editor_header";let c=document.createElement("span");c.className="aipkit_form_element_editor_title",c.innerHTML=`${e(i.label||i.id||t("New Element","gpt3-ai-content-generator"))} <span class="aipkit_element_type_badge">${e(i.type||"text_input")}</span> <span class="aipkit_element_id_badge">${i.id?e(i.id):""}</span>`;let _=document.createElement("div");_.className="aipkit_form_element_editor_actions";let p=document.createElement("button");p.type="button",p.className="aipkit_btn aipkit_btn-icon aipkit_form_element_remove_btn",p.title=t("Remove Element","gpt3-ai-content-generator"),p.innerHTML='<span class="dashicons dashicons-trash"></span>',_.appendChild(p),l.appendChild(c),l.appendChild(_),s.appendChild(l);let u=document.createElement("div");u.className="aipkit_form_element_editor_content";let f='<div class="aipkit_form-row">';f+=`<div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_type_${e(a)}">${t("Element Type","gpt3-ai-content-generator")}</label>
            <select id="fe_type_${e(a)}" data-property="type" class="aipkit_form-input aipkit_form_element_prop_change">
                ${["text_input","textarea","dropdown","checkbox_group","radio_group","label","heading"].map(k=>`<option value="${e(k)}" ${i.type===k?"selected":""}>${e(k.replace(/_/g," ").replace(/\b\w/g,T=>T.toUpperCase()))}</option>`).join("")}
            </select>
        </div>`,f+=`<div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_id_${e(a)}">${t("Field ID / Variable","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_id_${e(a)}" data-property="id" class="aipkit_form-input aipkit_form_element_prop_change" value="${e(i.id||"")}" placeholder="${t("e.g., product_name","gpt3-ai-content-generator")}">
        </div></div>`,f+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_label_${e(a)}">${i.type==="label"||i.type==="heading"?t("Text Content","gpt3-ai-content-generator"):t("Display Label","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_label_${e(a)}" data-property="label" class="aipkit_form-input aipkit_form_element_prop_change" value="${e(i.label||"")}">
        </div></div>`,["text_input","textarea"].includes(i.type)&&(f+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_form-label" for="fe_placeholder_${e(a)}">${t("Placeholder Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="fe_placeholder_${e(a)}" data-property="placeholder" class="aipkit_form-input aipkit_form_element_prop_change" value="${e(i.placeholder||"")}">
            </div></div>`);let b="";if(["label","heading"].includes(i.type)||(b+=`<div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_checkbox-label" for="fe_required_${e(a)}">
                    <input type="checkbox" id="fe_required_${e(a)}" data-property="required" class="aipkit_toggle_switch aipkit_form_element_prop_change" ${i.required?"checked":""}>
                    ${t("Required Field","gpt3-ai-content-generator")}
                </label>
            </div>`,b+=`<div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_form-label" for="fe_default_value_${e(a)}">${t("Default Value","gpt3-ai-content-generator")}</label>
                <input type="text" id="fe_default_value_${e(a)}" data-property="default_value" class="aipkit_form-input aipkit_form_element_prop_change" value="${e(String(i.default_value||""))}">
                <p class="aipkit_form-help">${i.type==="checkbox_group"?t("For checkboxes, separate multiple default values with a comma (e.g., val1,val2).","gpt3-ai-content-generator"):""}</p>
            </div>`),b&&(f+=`<div class="aipkit_form-row">${b}</div>`),f+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_help_text_${e(a)}">${t("Help Text (Optional)","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_help_text_${e(a)}" data-property="help_text" class="aipkit_form-input aipkit_form_element_prop_change" value="${e(i.help_text||"")}">
        </div></div>`,["dropdown","checkbox_group","radio_group"].includes(i.type)&&(f+=`<div class="aipkit_form_element_options_editor" data-element-type="${e(i.type)}"><h6>${t("Options","gpt3-ai-content-generator")}</h6><div class="aipkit_options_list"></div>
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_form_add_option_btn"><span class="dashicons dashicons-plus-alt"></span> ${t("Add Option","gpt3-ai-content-generator")}</button>
            <p class="aipkit_form-help">${t("Format: actual_value|Display Text. e.g., blue_val|Blue Sky","gpt3-ai-content-generator")}</p></div>`),u.innerHTML=f,s.appendChild(u),["dropdown","checkbox_group","radio_group"].includes(i.type)){let k=s.querySelector(".aipkit_form_element_options_editor");k&&typeof window.aipkit_updateFormElementOptionControls=="function"&&window.aipkit_updateFormElementOptionControls(k,i.options||[])}return l.addEventListener("click",()=>{let k=u.style.display==="block";u.style.display=k?"none":"block",u.classList.toggle("aipkit_expanded",!k)}),i.id||(u.style.display="block",u.classList.add("aipkit_expanded")),s}window.aipkit_renderFormElementEditorItem=d})();(function(){"use strict";function d(i,r,n={},o=null){let e=window.aipkit_getUIBuilderState();if(!e||!i)return;let t=window.aipkit_escapeHtml||function(p){return p},a=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:p=>p,s=e.schemas||{};i.innerHTML="";let l=s.ActionSchema?.properties?.payload?.properties||{},c="";function _(p,u,f,b="action.payload."){let k='<div class="aipkit_form-group">';k+=`<label class="aipkit_form-label" for="action_payload_${t(p)}_${e.editingTriggerId||""}">${t(u.description||p.replace(/_/g," "))}</label>`;let T=`${b}${p}`;return u.type==="boolean"?k+=`<input type="checkbox" id="action_payload_${t(p)}_${e.editingTriggerId||""}" data-field="${t(T)}" class="aipkit_form-input aipkit_trigger_field" ${f===!0?"checked":""}>`:u.enum?(k+=`<select id="action_payload_${t(p)}_${e.editingTriggerId||""}" data-field="${t(T)}" class="aipkit_form-input aipkit_trigger_field">`,u.enum.forEach(x=>{k+=`<option value="${t(x)}" ${f===x?"selected":""}>${t(x.replace(/_/g," "))}</option>`}),k+="</select>"):u.type==="integer"||u.type==="number"?(k+=`<input type="number" id="action_payload_${t(p)}_${e.editingTriggerId||""}" data-field="${t(T)}" class="aipkit_form-input aipkit_trigger_field" value="${t(String(f||u.default||""))}"`,u.minimum!==void 0&&(k+=` min="${t(String(u.minimum))}"`),u.maximum!==void 0&&(k+=` max="${t(String(u.maximum))}"`),k+=">"):u.type==="object"?(k+=`<textarea id="action_payload_${t(p)}_${e.editingTriggerId||""}" data-field="${t(T)}" class="aipkit_form-input aipkit_trigger_field" rows="3" placeholder="${t('e.g., {"X-My-Header": "Value"}')}">${t(JSON.stringify(f||{},null,2))}</textarea>`,k+=`<div class="aipkit_form-help">${t("Enter as a valid JSON object.")}</div>`):p==="message"||p==="content"||p==="body_template"||p==="reason"||p==="log_message_format"?k+=`<textarea id="action_payload_${t(p)}_${e.editingTriggerId||""}" data-field="${t(T)}" class="aipkit_form-input aipkit_trigger_field" rows="3">${t(f||u.default||"")}</textarea>`:k+=`<input type="text" id="action_payload_${t(p)}_${e.editingTriggerId||""}" data-field="${t(T)}" class="aipkit_form-input aipkit_trigger_field" value="${t(f||"")}">`,k+="</div>",k}if(Object.keys(l).forEach(p=>{let u=l[p],f=!0;r==="bot_reply"&&!["message","stop_processing_ai"].includes(p)&&(f=!1),r==="inject_context"&&!["placement","content"].includes(p)&&(f=!1),r==="block_message"&&!["reason"].includes(p)&&(f=!1),r==="call_webhook"&&!["endpoint_url","http_method","headers","body_template","timeout_seconds"].includes(p)&&(f=!1),r==="set_variable"&&!["scope","key"].includes(p)&&(f=!1),r==="display_form"&&!["form_id","title","elements","submit_button_text"].includes(p)&&(f=!1),r==="store_form_submission"&&!["log_message_format"].includes(p)&&(f=!1),f&&(r==="display_form"&&p==="elements"||(c+=_(p,u,n[p])))}),r==="set_variable"){let p=s.ActionSchema?.properties?.value||{type:"string",description:"Value"};c+=_("value",p,o,"action.")}if(r==="display_form"&&(c+=`<div class="aipkit_form_elements_editor_container">
                <h6>${a("Form Elements","gpt3-ai-content-generator")}</h6>
                <div class="aipkit_form_elements_list"></div>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_form_add_element_btn">
                    <span class="dashicons dashicons-plus"></span> ${a("Add Form Element","gpt3-ai-content-generator")}
                </button>
            </div>`),i.innerHTML=c,r==="display_form"){let p=i.querySelector(".aipkit_form_elements_list");p&&n&&Array.isArray(n.elements)&&n.elements.forEach((u,f)=>{if(typeof window.aipkit_renderFormElementEditorItem=="function"){let b=window.aipkit_renderFormElementEditorItem(u,f,n.form_id);b&&p.appendChild(b)}})}}window.aipkit_renderActionPayloadFields=d})();(function(){"use strict";function d(i,r){let n=window.aipkit_getUIBuilderState();if(!n||!i||!r){console.error("AIPKit RenderTriggerEditorForm: Missing state, content element, or trigger data.");return}let o=window.aipkit_escapeHtml||function(c){return c},e=n.schemas||{},t=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:c=>c,a=`
            <div class="aipkit_form-row">
                <div class="aipkit_form-group aipkit_form-col">
                    <label class="aipkit_form-label" for="trigger_name_${r.id}">${o(t("Trigger Name","gpt3-ai-content-generator"))}</label>
                    <input type="text" id="trigger_name_${r.id}" data-field="name" class="aipkit_form-input aipkit_trigger_field" value="${o(r.name||"")}">
                </div>
                <div class="aipkit_form-group aipkit_form-col">
                    <label class="aipkit_form-label" for="trigger_event_${r.id}">${o(t("Event","gpt3-ai-content-generator"))}</label>
                    <select id="trigger_event_${r.id}" data-field="event_name" class="aipkit_form-input aipkit_trigger_field">
                        ${(e.EventSchema?.properties?.name?.enum||[]).map(c=>`<option value="${o(c)}" ${r.event_name===c?"selected":""}>${o(c.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase()))}</option>`).join("")}
                    </select>
                </div>
                <div class="aipkit_form-group aipkit_form-col" style="max-width: 120px;">
                    <label class="aipkit_form-label" for="trigger_priority_${r.id}">${o(t("Priority","gpt3-ai-content-generator"))}</label>
                    <input type="number" id="trigger_priority_${r.id}" data-field="priority" class="aipkit_form-input aipkit_trigger_field" value="${o(String(r.priority||10))}" min="0" step="1">
                </div>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="trigger_description_${r.id}">${o(t("Description (Optional)","gpt3-ai-content-generator"))}</label>
                <textarea id="trigger_description_${r.id}" data-field="description" class="aipkit_form-input aipkit_trigger_field" rows="2">${o(r.description||"")}</textarea>
            </div>
        `;a+=`<div class="aipkit_conditions_container"><h6>${o(t("Conditions (All must be met)","gpt3-ai-content-generator"))}</h6><div class="aipkit_condition_rows_list">`,r.conditions&&r.conditions.length>0||(a+=`<p class="aipkit_form-help">${o(t("No conditions defined. This trigger will run if the event occurs.","gpt3-ai-content-generator"))}</p>`),a+=`</div><button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_trigger_add_condition_btn" style="margin-top:10px;"><span class="dashicons dashicons-plus"></span> ${o(t("Add Condition","gpt3-ai-content-generator"))}</button></div>`,a+=`<div class="aipkit_action_container"><h6>${o(t("Action","gpt3-ai-content-generator"))}</h6>`,a+=`<div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="action_type_${r.id}">${o(t("Action Type","gpt3-ai-content-generator"))}</label>
                        <select id="action_type_${r.id}" data-field="action.type" class="aipkit_form-input aipkit_trigger_field aipkit_trigger_action_type_select">
                            ${(e.ActionSchema?.properties?.type?.enum||[]).map(c=>`<option value="${o(c)}" ${r.action?.type===c?"selected":""}>${o(c.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase()))}</option>`).join("")}
                        </select>
                     </div>`,a+='<div class="aipkit_action_payload_container"></div>',a+="</div>",i.innerHTML=a;let s=i.querySelector(".aipkit_condition_rows_list");s&&r.conditions&&r.conditions.length>0&&(s.innerHTML="",r.conditions.forEach(c=>{typeof window.aipkit_renderConditionRow=="function"&&window.aipkit_renderConditionRow(s,c)}));let l=i.querySelector(".aipkit_action_payload_container");l&&r.action?.type&&typeof window.aipkit_renderActionPayloadFields=="function"&&window.aipkit_renderActionPayloadFields(l,r.action.type,r.action.payload,r.action.value)}window.aipkit_renderTriggerEditorForm=d})();(function(){"use strict";function d(i){if(!window.aipkit_getUIBuilderState())return console.error("AIPKit RenderSingleTriggerItem: UI Builder state not initialized."),null;let n=window.aipkit_escapeHtml||function(_){return _},o=document.querySelector(".aipkit_trigger_editor_template");if(!o)return console.error("AIPKit RenderSingleTriggerItem: Trigger editor template not found."),null;let t=o.content.cloneNode(!0).querySelector(".aipkit_trigger_item"),a=t.querySelector(".aipkit_trigger_item_name_display"),s=t.querySelector(".aipkit_trigger_item_id_display"),l=t.querySelector(".aipkit_trigger_is_active_checkbox"),c=t.querySelector(".aipkit_trigger_item_content");return t.dataset.triggerId=i.id,a&&(a.textContent=n(i.name||"Unnamed Trigger")),s&&(s.textContent=`(ID: ${n(i.id)})`),l&&(l.checked=i.is_active===!0),c?c.innerHTML="":console.error("AIPKit RenderSingleTriggerItem: .aipkit_trigger_item_content missing in template for trigger:",i.id),t}window.aipkit_renderSingleTriggerItem=d})();(function(){"use strict";function d(){let i=window.aipkit_getUIBuilderState();if(!i){console.error("RenderTriggerList: UI Builder state not initialized.");return}let r=document.getElementById(`aipkit_trigger_list_for_${i.botId}`),n=r?r.querySelector(".aipkit_trigger_list_empty_message"):null;if(!r){console.error(`RenderTriggerList: List container for bot ${i.botId} not found.`);return}r.querySelectorAll(".aipkit_trigger_item").forEach(o=>o.remove()),i.triggers&&i.triggers.length>0?(n&&(n.style.display="none"),i.triggers.forEach(o=>{if(typeof window.aipkit_renderSingleTriggerItem=="function"){let e=window.aipkit_renderSingleTriggerItem(o);e&&r.appendChild(e)}else console.error("RenderTriggerList: aipkit_renderSingleTriggerItem function not found.")})):n&&(n.style.display="block")}window.aipkit_renderTriggerList=d})();(function(){"use strict";let d=null;function i(n){d=n}function r(){return d}window.aipkit_setTriggerEventManagerState=i,window.aipkit_getTriggerEventManagerState=r})();(function(){"use strict";function d(i,r,n){let o=r.split("."),e=i;for(let t=0;t<o.length-1;t++)(!e[o[t]]||typeof e[o[t]]!="object")&&(e[o[t]]={}),e=e[o[t]];e[o[o.length-1]]=n}window.aipkit_setNestedValue=d})();(function(){"use strict";function d(i,r,n){let o=window.aipkit_getTriggerEventManagerState();if(!o)return;let e=o.triggers.findIndex(t=>t.id===i);if(e===-1){console.warn(`UpdateTriggerData: Trigger ID ${i} not found in state for bot ${o.botId}.`);return}window.aipkit_setNestedValue(o.triggers[e],r,n),o.isDirty=!0}window.aipkit_updateTriggerData=d})();(function(){"use strict";function d(i,r){let n=window.aipkit_getTriggerEventManagerState();if(!n||!r)return console.error("SaveTriggerFromForm: State or triggerItemElement missing."),!1;let o=n.triggers.findIndex(s=>s.id===i);if(o===-1)return console.warn(`SaveTriggerFromForm: Trigger ID ${i} not found in state for bot ${n.botId}.`),!1;let e=r.querySelector(".aipkit_trigger_item_content");if(!e||e.style.display==="none")return!0;let t=JSON.parse(JSON.stringify(n.triggers[o]));e.querySelectorAll(".aipkit_trigger_field[data-field]").forEach(s=>{let l=s.dataset.field,c=s.type==="checkbox"?s.checked:s.type==="number"?parseFloat(s.value)||0:s.value;window.aipkit_setNestedValue(t,l,c)}),t.conditions=[],e.querySelectorAll(".aipkit_condition_row").forEach(s=>{let l=s.querySelector(".aipkit_condition_type_select")?.value,c=s.querySelector(".aipkit_condition_field_select")?.value,_=s.querySelector(".aipkit_condition_operator_select")?.value,p=s.querySelector(".aipkit_condition_value_input"),u=p?.value;if(p?.type==="number"?u=parseFloat(u)||0:p?.type==="text"&&(_==="is_one_of"||_==="is_not_one_of")&&(u=u.split(",").map(f=>f.trim()).filter(f=>f!=="")),p?.style.display==="none"&&(u=void 0),l&&c&&_){let f={type:l,field:c,operator:_};u!==void 0&&(f.value=u),t.conditions.push(f)}});let a=e.querySelector(".aipkit_trigger_action_type_select");if(a&&(t.action.type=a.value),t.action&&t.action.type){t.action.payload={},e.querySelectorAll('.aipkit_action_payload_container .aipkit_trigger_field[data-field^="action.payload."').forEach(l=>{let c=l.dataset.field.substring(15),_=l.type==="checkbox"?l.checked:l.value;if(c==="headers"&&typeof _=="string")try{_=JSON.parse(_||"{}")}catch{_={}}(t.action.type==="store_form_submission"&&c==="log_message_format"||c&&c!=="elements")&&(t.action.payload[c]=_)}),t.action.type==="display_form"&&(t.action.payload.elements=[],e.querySelectorAll(".aipkit_form_element_editor_item").forEach(l=>{let c={};l.querySelectorAll(".aipkit_form_element_prop_change").forEach(_=>{let p=_.dataset.property,u=_.type==="checkbox"?_.checked:_.value;c[p]=u}),["dropdown","checkbox_group","radio_group"].includes(c.type)&&(c.options=[],l.querySelectorAll(".aipkit_form_element_option_row").forEach(_=>{let p=_.querySelector(".aipkit_element_option_value")?.value,u=_.querySelector(".aipkit_element_option_text")?.value;p!==void 0&&u!==void 0&&c.options.push({value:p,text:u})})),t.action.payload.elements.push(c)}));let s=e.querySelector('.aipkit_action_payload_container .aipkit_trigger_field[data-field="action.value"]');s?t.action.value=s.value:delete t.action.value}return n.triggers[o]=t,n.isDirty=!0,!0}window.aipkit_saveTriggerFromForm=d})();(function(){"use strict";let d;function i(r,n){clearTimeout(d),d=setTimeout(()=>{typeof window.aipkit_saveTriggerFromForm=="function"?window.aipkit_saveTriggerFromForm(r,n):console.error("DebouncedSave: aipkit_saveTriggerFromForm function not found.")},750)}window.aipkit_debouncedSave=i})();(function(){"use strict";function d(){let i=window.aipkit_getTriggerEventManagerState();if(!i){console.error("AIPKit AddNewTrigger: State not found.");return}let r=`trigger_${Date.now()}_${Math.random().toString(36).substring(2,7)}`,n=i.schemas?.EventSchema?.properties?.name?.enum[0]||"user_message_received",o=i.schemas?.ActionSchema?.properties?.type?.enum[0]||"bot_reply",e={id:r,name:"New Trigger",event_name:n,conditions:[],action:{type:o,payload:{}},priority:10,is_active:!0,description:""};i.triggers.push(e),i.isDirty=!0;let t=document.getElementById(`aipkit_trigger_list_for_${i.botId}`);if(!t){console.error("AIPKit AddNewTrigger: List container not found.");return}let a=t.querySelector(".aipkit_trigger_list_empty_message");if(a&&(a.style.display="none"),typeof window.aipkit_renderSingleTriggerItem=="function"){let s=window.aipkit_renderSingleTriggerItem(e);if(s)if(t.appendChild(s),typeof window.aipkit_toggleTriggerItemContent=="function"){window.aipkit_toggleTriggerItemContent(s,r,!0);let l=s.querySelector('input[data-field="name"]');l?l.focus():console.warn("AIPKit AddNewTrigger: Name input not found after expanding.")}else console.error("AIPKit AddNewTrigger: aipkit_toggleTriggerItemContent function not found.");else console.error("AIPKit AddNewTrigger: aipkit_renderSingleTriggerItem returned null.")}else console.error("AIPKit AddNewTrigger: aipkit_renderSingleTriggerItem function not found.")}window.aipkit_handleAddNewTrigger=d})();(function(){"use strict";function d(i,r,n=!1){let o=window.aipkit_getUIBuilderState(),e=window.aipkit_getTriggerEventManagerState();if(!o||!e){console.error("AIPKit ToggleContent: UI Builder or Event Manager State not found.");return}let t=i.querySelector(".aipkit_trigger_item_content"),a=i.querySelector(".aipkit_trigger_item_header");if(!t||!a){console.error("AIPKit ToggleContent: Content or header element not found.");return}let s=t.style.display==="block";if(n&&s&&e.editingTriggerId===r){let l=o.triggers.find(c=>c.id===r);l&&typeof window.aipkit_renderTriggerEditorForm=="function"&&window.aipkit_renderTriggerEditorForm(t,l);return}if(s&&!n)t.style.display="none",t.classList.remove("aipkit_expanded"),a.classList.remove("aipkit_expanded"),e.editingTriggerId===r&&(typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(r,i),e.editingTriggerId=null);else{let l=document.querySelector(`#aipkit_trigger_list_for_${o.botId} .aipkit_trigger_item_content.aipkit_expanded`);if(l&&l!==t){let c=l.closest(".aipkit_trigger_item");c&&c.dataset.triggerId&&(typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(c.dataset.triggerId,c),l.style.display="none",l.classList.remove("aipkit_expanded"),l.previousElementSibling?.classList.remove("aipkit_expanded"))}if(t.style.display="block",t.classList.add("aipkit_expanded"),a.classList.add("aipkit_expanded"),e.editingTriggerId=r,t.innerHTML.trim()===""||n){let c=o.triggers.find(_=>_.id===r);c&&typeof window.aipkit_renderTriggerEditorForm=="function"?window.aipkit_renderTriggerEditorForm(t,c):console.error("AIPKit ToggleContent: Trigger data or render function not found for form rendering.")}}}window.aipkit_toggleTriggerItemContent=d})();(function(){"use strict";function d(i){let r=window.aipkit_getTriggerEventManagerState();if(!r)return;let o=(window.aipkit_trigger_builder_config?.text||{}).confirmDeleteTrigger||`Are you sure you want to delete trigger ID: ${i}?`;if(!confirm(o))return;r.triggers=r.triggers.filter(a=>a.id!==i),r.isDirty=!0;let e=document.querySelector(`.aipkit_trigger_item[data-trigger-id="${i}"]`);e&&e.remove();let t=document.getElementById(`aipkit_trigger_list_for_${r.botId}`);if(t){let a=t.querySelector(".aipkit_trigger_list_empty_message");r.triggers.length===0&&a&&(a.style.display="block")}}window.aipkit_handleDeleteTrigger=d})();(function(){"use strict";function d(i){let r=window.aipkit_getTriggerEventManagerState();if(!r||!i)return;let n=i.querySelector(".aipkit_condition_rows_list");n&&typeof window.aipkit_renderConditionRow=="function"?(window.aipkit_renderConditionRow(n),r.isDirty=!0,typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(i.dataset.triggerId,i)):console.error("HandleAddCondition: Condition rows list or render function not found.")}window.aipkit_handleAddCondition=d})();(function(){"use strict";function d(i){let r=window.aipkit_getTriggerEventManagerState();if(!r||!i||!i.parentNode)return;let n=i.closest(".aipkit_trigger_item");i.remove(),r.isDirty=!0,n&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(n.dataset.triggerId,n)}window.aipkit_handleRemoveCondition=d})();(function(){"use strict";function d(i){let r=window.aipkit_getTriggerEventManagerState();if(!r||!i)return;let n=i.dataset.triggerId,o=r.triggers.findIndex(c=>c.id===n);if(o===-1)return;let e=r.triggers[o];if(e.action.type!=="display_form")return;(!e.action.payload.elements||!Array.isArray(e.action.payload.elements))&&(e.action.payload.elements=[]);let t=e.action.payload.elements.length,s={id:`field_${Date.now()}_${t}`,type:"text_input",label:"New Field",placeholder:"",required:!1,default_value:"",help_text:""};e.action.payload.elements.push(s),r.isDirty=!0;let l=i.querySelector(".aipkit_form_elements_list");if(l&&typeof window.aipkit_renderFormElementEditorItem=="function"){let c=window.aipkit_renderFormElementEditorItem(s,t,e.action.payload.form_id);if(c){l.appendChild(c);let _=c.querySelector(".aipkit_form_element_editor_content");_&&(_.style.display="block",_.classList.add("aipkit_expanded"));let p=c.querySelector('input[data-property="id"]');p&&p.focus()}typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(n,i)}}window.aipkit_handleAddFormElement=d})();(function(){"use strict";function d(i){let r=window.aipkit_getTriggerEventManagerState();if(!r||!i||!i.parentNode)return;let n=i.closest(".aipkit_trigger_item");if(!n)return;let o=n.dataset.triggerId,e=r.triggers.findIndex(s=>s.id===o);if(e===-1)return;let t=parseInt(i.dataset.elementIndex,10);if(isNaN(t))return;let a=r.triggers[e];if(a.action.type==="display_form"&&a.action.payload.elements&&t>=0&&t<a.action.payload.elements.length){a.action.payload.elements.splice(t,1),r.isDirty=!0,i.remove();let s=n.querySelector(".aipkit_form_elements_list");s&&s.querySelectorAll(".aipkit_form_element_editor_item").forEach((l,c)=>{l.dataset.elementIndex=c,l.querySelectorAll(".aipkit_element_option_value, .aipkit_element_option_text").forEach(_=>{let p=_.dataset.prop.split(".")[1];_.dataset.property=`options[${optionRow.dataset.optionIndex}].${p}`})}),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(o,n)}}window.aipkit_handleRemoveFormElement=d})();(function(){"use strict";function d(i){let r=window.aipkit_getTriggerEventManagerState();if(!r)return;let n=i.target,o=n.dataset.property;if(!o)return;let e=n.closest(".aipkit_form_element_editor_item"),t=n.closest(".aipkit_trigger_item");if(!e||!t)return;let a=t.dataset.triggerId,s=parseInt(e.dataset.elementIndex,10);if(isNaN(s))return;let l=r.triggers.findIndex(f=>f.id===a);if(l===-1)return;let c=r.triggers[l];if(c.action.type!=="display_form"||!c.action.payload.elements||s<0||s>=c.action.payload.elements.length)return;let _=c.action.payload.elements[s],p=n.type==="checkbox"?n.checked:n.value,u=o.match(/^options\[(\d+)\]\.(value|text)$/);if(u){let f=parseInt(u[1],10),b=u[2];_.options||(_.options=[]),_.options[f]||(_.options[f]={}),_.options[f][b]=p}else _[o]=p;if(r.isDirty=!0,o==="type"){let f=e.querySelector(".aipkit_element_type_badge").textContent.toLowerCase().replace(" ","_");if(t.querySelector(".aipkit_action_payload_container")&&typeof window.aipkit_renderActionPayloadFields=="function"){let k=window.aipkit_renderFormElementEditorItem(_,s,c.action.payload.form_id);if(k&&e.parentNode){e.parentNode.replaceChild(k,e);let T=k.querySelector(".aipkit_form_element_editor_content");T&&(T.style.display="block",T.classList.add("aipkit_expanded"))}}}else if(o==="label"||o==="id"){let f=e.querySelector(".aipkit_form_element_editor_title");f&&(f.innerHTML=`${window.aipkit_escapeHtml(_.label||_.id||"New Element")} <span class="aipkit_element_type_badge">${window.aipkit_escapeHtml(_.type||"text_input")}</span> <span class="aipkit_element_id_badge">${_.id?window.aipkit_escapeHtml(_.id):""}</span>`)}typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(a,t)}window.aipkit_handleFormElementPropertyChange=d})();(function(){"use strict";function d(i){if(!window.aipkit_getTriggerEventManagerState())return;let n=i.target,o=n.closest(".aipkit_trigger_item");if(!o)return;let e=o.dataset.triggerId;e&&(n.closest(".aipkit_trigger_item_header")&&!n.closest(".aipkit_trigger_item_actions button, .aipkit_trigger_is_active_toggle input")?typeof window.aipkit_toggleTriggerItemContent=="function"&&window.aipkit_toggleTriggerItemContent(o,e):n.closest(".aipkit_trigger_edit_btn")?typeof window.aipkit_toggleTriggerItemContent=="function"&&window.aipkit_toggleTriggerItemContent(o,e,!0):n.closest(".aipkit_trigger_delete_btn")?typeof window.aipkit_handleDeleteTrigger=="function"&&window.aipkit_handleDeleteTrigger(e):n.closest(".aipkit_trigger_add_condition_btn")?typeof window.aipkit_handleAddCondition=="function"&&window.aipkit_handleAddCondition(o):n.closest(".aipkit_condition_remove_btn")&&typeof window.aipkit_handleRemoveCondition=="function"&&window.aipkit_handleRemoveCondition(n.closest(".aipkit_condition_row")))}window.aipkit_handleListContainerClick=d})();(function(){"use strict";function d(i){let r=window.aipkit_getTriggerEventManagerState();if(!r)return;let n=i.target,o=n.closest(".aipkit_trigger_item");if(!o)return;let e=o.dataset.triggerId;if(e)if(n.matches(".aipkit_trigger_is_active_checkbox"))typeof window.aipkit_updateTriggerData=="function"&&window.aipkit_updateTriggerData(e,"is_active",n.checked);else if(n.matches(".aipkit_condition_type_select")){let t=n.closest(".aipkit_condition_row");t&&typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(n,t.querySelector(".aipkit_condition_field_select"),t.querySelector(".aipkit_condition_operator_select"),t.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(e,o)}else if(n.matches(".aipkit_condition_field_select")){let t=n.closest(".aipkit_condition_row");t&&typeof window.aipkit_updateConditionOperators=="function"&&window.aipkit_updateConditionOperators(n,t.querySelector(".aipkit_condition_operator_select"),t.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(e,o)}else if(n.matches(".aipkit_condition_operator_select")){let t=n.closest(".aipkit_condition_row");t&&typeof window.aipkit_updateConditionValueInput=="function"&&window.aipkit_updateConditionValueInput(n,t.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(e,o)}else if(n.matches(".aipkit_trigger_action_type_select")){let t=o.querySelector(".aipkit_action_payload_container"),a=r.triggers.find(s=>s.id===e);t&&typeof window.aipkit_renderActionPayloadFields=="function"&&window.aipkit_renderActionPayloadFields(t,n.value,a?.action?.payload,a?.action?.value),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(e,o)}else n.matches(".aipkit_trigger_field")&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(e,o)}window.aipkit_handleListContainerChange=d})();(function(){"use strict";function d(i){if(!window.aipkit_getTriggerEventManagerState())return;let n=i.target,o=n.closest(".aipkit_trigger_item");if(!o)return;let e=o.dataset.triggerId;if(e)if(n.matches('input[data-field="name"]')){let t=o.querySelector(".aipkit_trigger_item_name_display");t&&(t.textContent=n.value||"Unnamed Trigger"),typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(e,o)}else n.matches(".aipkit_trigger_field")&&typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(e,o)}window.aipkit_handleListContainerInput=d})();(function(){"use strict";function d(i){let r=document.getElementById(`aipkit_trigger_builder_${i}`);if(!r){console.warn(`InitEventListeners: Builder container for bot ${i} not found.`);return}if(r.dataset.eventManagerInitialized==="true")return;let n=r.querySelector(".aipkit_trigger_add_new_btn");n&&typeof window.aipkit_handleAddNewTrigger=="function"?n.addEventListener("click",window.aipkit_handleAddNewTrigger):n&&console.error("InitEventListeners: aipkit_handleAddNewTrigger function not found.");let o=r.querySelector(".aipkit_trigger_list_container");o?(typeof window.aipkit_handleListContainerClick=="function"?o.addEventListener("click",window.aipkit_handleListContainerClick):console.error("InitEventListeners: aipkit_handleListContainerClick function not found."),typeof window.aipkit_handleListContainerChange=="function"?o.addEventListener("change",window.aipkit_handleListContainerChange):console.error("InitEventListeners: aipkit_handleListContainerChange function not found."),typeof window.aipkit_handleListContainerInput=="function"?o.addEventListener("input",window.aipkit_handleListContainerInput):console.error("InitEventListeners: aipkit_handleListContainerInput function not found."),o.addEventListener("click",function(e){let t=e.target.closest(".aipkit_form_add_element_btn"),a=e.target.closest(".aipkit_form_element_remove_btn"),s=e.target.closest(".aipkit_form_add_option_btn"),l=e.target.closest(".aipkit_form_option_remove_btn");if(t){let c=t.closest(".aipkit_trigger_item");c&&typeof window.aipkit_handleAddFormElement=="function"&&window.aipkit_handleAddFormElement(c)}else if(a){let c=a.closest(".aipkit_form_element_editor_item");c&&typeof window.aipkit_handleRemoveFormElement=="function"&&window.aipkit_handleRemoveFormElement(c)}else if(s){let c=s.closest(".aipkit_form_element_options_editor"),_=c.closest(".aipkit_trigger_item"),p=c.closest(".aipkit_form_element_editor_item");if(c&&_&&p&&typeof window.aipkit_saveTriggerFromForm=="function"&&typeof window.aipkit_updateFormElementOptionControls=="function"){let u=window.aipkit_getTriggerEventManagerState(),f=_.dataset.triggerId,b=parseInt(p.dataset.elementIndex,10),k=u.triggers.find(T=>T.id===f);k&&k.action.payload.elements[b]&&(k.action.payload.elements[b].options||(k.action.payload.elements[b].options=[]),k.action.payload.elements[b].options.push({value:"",text:""}),u.isDirty=!0,window.aipkit_updateFormElementOptionControls(c,k.action.payload.elements[b].options),window.aipkit_saveTriggerFromForm(f,_))}}else if(l){let c=l.closest(".aipkit_form_element_option_row"),_=l.closest(".aipkit_form_element_options_editor"),p=_.closest(".aipkit_trigger_item"),u=_.closest(".aipkit_form_element_editor_item");if(c&&_&&p&&u&&typeof window.aipkit_saveTriggerFromForm=="function"&&typeof window.aipkit_updateFormElementOptionControls=="function"){let f=parseInt(c.dataset.optionIndex,10),b=window.aipkit_getTriggerEventManagerState(),k=p.dataset.triggerId,T=parseInt(u.dataset.elementIndex,10),x=b.triggers.find($=>$.id===k);x&&x.action.payload.elements[T]&&x.action.payload.elements[T].options[f]!==void 0&&(x.action.payload.elements[T].options.splice(f,1),b.isDirty=!0,window.aipkit_updateFormElementOptionControls(_,x.action.payload.elements[T].options),window.aipkit_saveTriggerFromForm(k,p))}}}),o.addEventListener("change",function(e){let t=e.target;t.matches&&(t.matches(".aipkit_form_element_prop_change")||t.closest(".aipkit_form_element_option_row input"))&&typeof window.aipkit_handleFormElementPropertyChange=="function"&&window.aipkit_handleFormElementPropertyChange(e)}),o.addEventListener("input",function(e){let t=e.target;t.matches&&(t.matches(".aipkit_form_element_prop_change")||t.closest(".aipkit_form_element_option_row input"))&&typeof window.aipkit_handleFormElementPropertyChange=="function"&&(clearTimeout(t.aipkitDebounceTimeout),t.aipkitDebounceTimeout=setTimeout(()=>{window.aipkit_handleFormElementPropertyChange(e)},500))})):console.warn(`InitEventListeners: List container not found for bot ${i}.`),r.dataset.eventManagerInitialized="true"}window.aipkit_initTriggerBuilderEventListeners=d})();(function(){"use strict";let d={};function i(n){if(!n){console.error("AIPKit Trigger Main: Bot ID is required to initialize UI.");return}let o=document.getElementById(`aipkit_trigger_builder_${n}`);if(!o){console.error(`AIPKit Trigger Main: Builder container for bot ${n} not found.`);return}if(o.dataset.triggerUiInitialized==="true")return;let e=["aipkit_loadInitialTriggers","aipkit_loadTriggerSchemas","aipkit_initTriggerBuilderState","aipkit_setTriggerBuilderState","aipkit_setTriggerEventManagerState","aipkit_renderTriggerList","aipkit_initTriggerBuilderEventListeners","aipkit_renderFormElementEditorItem","aipkit_updateFormElementOptionControls","aipkit_handleAddFormElement","aipkit_handleRemoveFormElement","aipkit_handleFormElementPropertyChange"],t=!1;if(e.forEach(_=>{typeof window[_]!="function"&&(console.error(`AIPKit Trigger Main: CRITICAL DEPENDENCY MISSING -> ${_}. Check script loading and function names.`),t=!0)}),t){o.innerHTML='<p style="color:red;">Error: Trigger UI components failed to load. Check console for details.</p>';return}let a=window.aipkit_loadInitialTriggers(n),s=window.aipkit_loadTriggerSchemas(n);(!s||Object.keys(s).length===0)&&console.error(`AIPKit Trigger Main: Trigger schemas not loaded for bot ${n}.`);let l=window.aipkit_initTriggerBuilderState(n,a,s);d[n]=l,window.aipkit_setTriggerBuilderState(l),window.aipkit_setTriggerEventManagerState(l),window.aipkit_renderTriggerList(),window.aipkit_initTriggerBuilderEventListeners(n),o.dataset.triggerUiInitialized="true";let c=o.closest("form.aipkit_chatbot_settings_form");c?c.dataset.triggerSaveListenerAttached||(c.addEventListener("submit",function(_){let p=window.aipkit_getTriggerBuilderState(n);if(p){let u=window.aipkit_getTriggerEventManagerState();if(u&&u.editingTriggerId){let f=document.querySelector(`.aipkit_trigger_item[data-trigger-id="${u.editingTriggerId}"]`);f&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(u.editingTriggerId,f)}typeof window.aipkit_updateTriggersJsonForSave=="function"?window.aipkit_updateTriggersJsonForSave(n,p.triggers):console.error("AIPKit Trigger Main: aipkit_updateTriggersJsonForSave is not defined. Triggers JSON might not be saved correctly.")}}),c.dataset.triggerSaveListenerAttached="true"):console.warn(`AIPKit Trigger Main: Could not find parent form for bot ${n} to attach pre-save hook.`)}function r(n){return d[n]||null}window.aipkit_initTriggerBuilderUI=i,window.aipkit_getTriggerBuilderState=r})();(function(){"use strict";function d(n){if(!n)return;let o=n.querySelector(".aipkit_enable_realtime_voice_toggle"),e=n.querySelector(".aipkit_realtime_voice_settings_container");if(!o||!e)return;let t=o.checked;e.style.display=t?"block":"none",typeof i=="function"&&i(n)}function i(n){if(!n)return;let o=n.querySelector(".aipkit_enable_realtime_voice_toggle"),e=n.querySelector('input[name="direct_voice_mode"]'),t=e?e.closest(".aipkit_form-group"):null,a=n.closest(".aipkit_chatbot-settings-area"),s=a?a.querySelector('input[name="popup_enabled"]'):null;if(!o||!e||!t||!s)return;let l=o.checked,c=s.checked,_=l&&c,p=t.getAttribute("data-tooltip-disabled")||"";_?(e.disabled=!1,t.removeAttribute("title"),t.classList.remove("aipkit-disabled-tooltip")):(e.checked&&(e.checked=!1,e.dispatchEvent(new Event("change",{bubbles:!0}))),e.disabled=!0,t.setAttribute("title",p),t.classList.add("aipkit-disabled-tooltip"))}function r(){let n=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!n)return;let o="data-realtime-voice-ui-listener-attached";n.getAttribute(o)||(n.addEventListener("change",function(e){let t=e.target,a=t.closest(".aipkit_chatbot-settings-area");if(a){if(t.matches&&t.matches(".aipkit_enable_realtime_voice_toggle")){let s=t.closest(".aipkit_accordion-content");s&&d(s)}else if(t.matches&&t.matches('input[name="popup_enabled"]')){let s=a.querySelector('.aipkit_accordion[data-section="voice-agent"] .aipkit_accordion-content');s&&i(s)}}}),n.setAttribute(o,"true"),n.querySelectorAll('.aipkit_accordion[data-section="voice-agent"] .aipkit_accordion-content').forEach(e=>{d(e)}))}window.aipkit_initRealtimeVoiceAgentUI=r,window.aipkit_updateDirectVoiceModeState=i})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let r="data-embed-copy-listener-attached";i.getAttribute(r)||(i.setAttribute(r,"true"),i.addEventListener("click",function(n){let o=n.target.closest(".aipkit_copy_embed_code_btn");if(!o)return;let e=o.dataset.target;if(!e)return;let t=document.getElementById(e);if(t){let a=t.value;typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(a,o):(console.error("AIPKit Embed: copyShortcode utility not found."),alert("Could not copy code."))}}))}window.aipkit_initEmbedCodeCopy=d})();(function(){"use strict";let d,i=window.aipkit_escapeHtml||function(e){return e};function r(e,t,a="",s="",l=""){if(!e)return;let c=e.querySelector(".aipkit_gsheets_indicator"),_=e.querySelector(".aipkit_gsheets_file_display"),p=e.querySelector(".aipkit_gsheets_shortcut_link_wrapper"),u=e.querySelector(".aipkit_gsheets_shortcut_link");if(!c||!_)return;let f=(window.aipkit_cw_pro_config||{}).gsheets_text||{};switch(c.innerHTML="",c.className="aipkit_gsheets_indicator",p&&(p.style.display="none"),_.style.display="none",t){case"verifying":c.innerHTML=`<span class="aipkit_spinner" style="display:inline-block; width:14px; height:14px; border-width:2px; vertical-align:middle; margin-right:4px;"></span> ${f.verifying||"Verifying..."}`,c.classList.add("aipkit_gsheets_indicator--verifying");break;case"success":c.innerHTML=`<span class="dashicons dashicons-yes-alt" style="color:green;"></span> ${f.accessible||"Accessible"}`,c.classList.add("aipkit_gsheets_indicator--success"),_&&l&&(_.innerHTML=`<span>${i(l)}</span> <span class="dashicons dashicons-yes-alt"></span>`,_.style.display="inline-block"),p&&u&&s&&(u.href=`https://docs.google.com/spreadsheets/d/${encodeURIComponent(s)}/edit`,p.style.display="block");break;case"loaded":c.innerHTML="",_&&l&&(_.innerHTML=`<span>${i(l)}</span> <span class="dashicons dashicons-yes-alt"></span>`,_.style.display="inline-block");break;case"error":c.innerHTML=`<span class="dashicons dashicons-warning" style="color:red;"></span> ${f.error_prefix||"Error:"} ${i(a)}`,c.classList.add("aipkit_gsheets_indicator--error");break;case"clear":default:c.innerHTML="",_.innerHTML="",_.style.display="none";break}}async function n(e){if(!e)return;let t=e.querySelector(".aipkit_gsheets_sheet_id_input"),a=e.querySelector(".aipkit_gsheets_credentials_hidden_input"),s=(window.aipkit_cw_pro_config||{}).gsheets_text||{},l=t?t.value.trim():"",c=a?a.value.trim():"";if(!l||!c){r(e,"clear");return}let _=a.dataset.filename||"credentials.json";r(e,"verifying");try{let p=document.getElementById("aipkit_content_writer_nonce"),u=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,f=p?p.value:u;if(!f)throw new Error("Security token could not be found.");await window.aipkit_apiRequest("aipkit_content_writer_verify_gsheets",{gsheets_sheet_id:l,gsheets_credentials:c,_ajax_nonce:f}),r(e,"success","Connection successful.",l,_)}catch(p){r(e,"error",p.message||s.invalid_creds||"Invalid credentials or sheet not shared.")}}function o(){if(!window.aipkit_dashboard||!window.aipkit_dashboard.isProPlan)return;let e=document.getElementById("aipkit_module-container");if(!e)return;let t="data-gsheets-listener-attached";e.getAttribute(t)||(e.addEventListener("input",a=>{if(a.target.matches(".aipkit_gsheets_sheet_id_input")){clearTimeout(d);let s=a.target.closest(".aipkit_gsheets_section_container");d=setTimeout(()=>n(s),1e3)}}),e.addEventListener("change",a=>{if(a.target.matches(".aipkit_gsheets_credentials_file_input")){let s=a.target,l=s.closest(".aipkit_gsheets_section_container");if(!l)return;let c=l.querySelector(".aipkit_gsheets_credentials_hidden_input");if(!c)return;let _=s.files[0];if(!_){c.value="",delete c.dataset.filename,r(l,"clear");return}let p=new FileReader;p.onload=function(u){c.value=u.target.result,c.dataset.filename=_.name,clearTimeout(d),n(l)},p.onerror=function(){console.error("Error reading file."),r(l,"error","Could not read the selected file.")},p.readAsText(_)}}),e.setAttribute(t,"true"),document.querySelectorAll(".aipkit_gsheets_section_container").forEach(a=>{let s=a.querySelector(".aipkit_gsheets_credentials_hidden_input");s&&s.value.trim()!==""&&(s.dataset.filename="credentials.json",n(a))}))}window.aipkit_initGsheetsVerification=o,window.aipkit_verifyGSheetsCredentials=n,window.aipkit_setGsheetsIndicator=r})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_cw_test_scrape_btn"),r=document.getElementById("aipkit_cw_url_list"),n=document.getElementById("aipkit_cw_scrape_results_wrapper"),o=document.getElementById("aipkit_cw_scrape_results");!i||!r||!n||!o||i.addEventListener("click",async()=>{let e=r.value.trim().split(`
`),t=e[0]?e[0].trim():"";if(!t){n.style.display="block",o.textContent="Please enter at least one URL to test.";return}n.style.display="block",o.textContent="Scraping...",typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,"Test Scrape","Scraping...");try{let a=document.getElementById("aipkit_content_writer_nonce"),s=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,l=a?a.value:s;if(!l)throw new Error("Security token could not be found.");let c=await window.aipkit_apiRequest("aipkit_content_writer_scrape_url",{url:t,_ajax_nonce:l});o.textContent=c.scraped_text||"No text could be extracted."}catch(a){o.textContent=`Error: ${a.message||"Failed to scrape URL."}`,console.error("URL Scrape Error:",a)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,"Test First URL")}})}window.aipkit_initUrlScrapeHandler=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||(o=>o);function i(o,e){let t=window.aipkit_automated_tasks_config||{},a,s,l,c,_;o==="openai"?(a=e.querySelector("#aipkit_task_ce_openai_vector_store_ids"),s=t.openai_vector_stores||[],l="id",c="name",_="No OpenAI stores found."):o==="pinecone"?(a=e.querySelector("#aipkit_task_ce_pinecone_index_name"),s=t.pinecone_indexes||[],l="name",c="name",_="No Pinecone indexes found."):o==="qdrant"&&(a=e.querySelector("#aipkit_task_ce_qdrant_collection_name"),s=t.qdrant_collections||[],l="name",c="name",_="No Qdrant collections found."),a&&(a.innerHTML="",s.length>0?(a.multiple?s.forEach(p=>{a.add(new Option(d(p[c]),p[l]))}):(a.add(new Option("-- Select --","")),s.forEach(p=>{a.add(new Option(d(p[c]),p[l]))})),a.disabled=!1):(a.add(new Option(_,"")),a.disabled=!0))}function r(o,e){let t=e.querySelector("#aipkit_task_ce_vector_embedding_model");if(!t)return;let a=window.aipkit_automated_tasks_config||{},s=o==="google"?a.google_embedding_models||[]:o==="azure"?a.azure_embedding_models||[]:a.openai_embedding_models||[];t.innerHTML="",s.length>0?(t.add(new Option("-- Select Model --","")),s.forEach(l=>{t.add(new Option(d(l.name||l.id),l.id))}),t.disabled=!1):(t.add(new Option("No models found","")),t.disabled=!0)}function n(o){let e=document.getElementById("aipkit_automated_task_form");if(!e)return;let t=document.getElementById("aipkit_task_ce_post_types");t&&(Array.from(t.options).forEach(m=>m.selected=!1),(o.post_types||[]).forEach(m=>{let y=t.querySelector(`option[value="${m}"]`);y&&(y.selected=!0)}));let a=document.getElementById("aipkit_task_ce_post_categories");a&&(Array.from(a.options).forEach(m=>m.selected=!1),(o.post_categories||[]).forEach(m=>{let y=a.querySelector(`option[value="${m}"]`);y&&(y.selected=!0)}));let s=document.getElementById("aipkit_task_ce_post_authors");s&&(Array.from(s.options).forEach(m=>m.selected=!1),(o.post_authors||[]).forEach(m=>{let y=s.querySelector(`option[value="${m}"]`);y&&(y.selected=!0)}));let l=document.getElementById("aipkit_task_ce_post_status");l&&(Array.from(l.options).forEach(m=>m.selected=!1),(o.post_statuses||["publish"]).forEach(m=>{let y=l.querySelector(`option[value="${m}"]`);y&&(y.selected=!0)}));let c=document.getElementById("aipkit_task_ce_update_title");c&&(c.checked=o.update_title==="1");let _=document.getElementById("aipkit_task_ce_update_excerpt");_&&(_.checked=o.update_excerpt==="1");let p=document.getElementById("aipkit_task_ce_update_content");p&&(p.checked=o.update_content==="1");let u=document.getElementById("aipkit_task_ce_update_meta");u&&(u.checked=o.update_meta==="1");let f=document.getElementById("aipkit_task_ce_enhance_existing_now_flag");f&&(f.checked=o.enhance_existing_now_flag==="1"),typeof window.aipkit_initContentEnhancementTaskFormUI=="function"&&setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0);let b=document.getElementById("aipkit_task_ce_title_prompt");b&&(b.value=o.title_prompt||"");let k=document.getElementById("aipkit_task_ce_excerpt_prompt");k&&(k.value=o.excerpt_prompt||"");let T=document.getElementById("aipkit_task_ce_content_prompt");T&&(T.value=o.content_prompt||"");let x=document.getElementById("aipkit_task_ce_meta_prompt");x&&(x.value=o.meta_prompt||"");let $=document.getElementById("aipkit_task_ce_ai_provider"),g=document.getElementById("aipkit_task_ce_ai_model");$&&g&&($.value=o.ai_provider?o.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&o.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=o.ai_model),typeof window.aipkit_task_ce_populateModels=="function"&&window.aipkit_task_ce_populateModels($,g));let h=document.getElementById("aipkit_task_ce_ai_temperature");if(h){h.value=o.ai_temperature||1;let m=document.getElementById(h.id+"_value");m&&(m.textContent=h.value)}let w=document.getElementById("aipkit_task_ce_content_max_tokens");if(w){w.value=o.content_max_tokens||4e3;let m=document.getElementById(w.id+"_value");m&&(m.textContent=w.value)}let S=e.elements.ce_reasoning_effort;S&&(S.value=o.reasoning_effort||"low"),g&&typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&setTimeout(()=>g.dispatchEvent(new Event("change",{bubbles:!0})),100),e.elements.task_frequency&&(e.elements.task_frequency.value=o.task_frequency||"daily");let v=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_knowledge_base"]');if(v){let m=v.querySelector("#aipkit_task_ce_enable_vector_store"),y=v.querySelector(".aipkit_task_ce_vector_store_settings_container");if(m&&y){let E=o.enable_vector_store==="1";m.checked=E,m.dispatchEvent(new Event("change",{bubbles:!0}))}if(o.enable_vector_store==="1"){let E=o.vector_store_provider||"openai",F=v.querySelector("#aipkit_task_ce_vector_store_provider");F&&(F.value=E,F.dispatchEvent(new Event("change",{bubbles:!0})));let q=v.querySelector("#aipkit_task_ce_vector_store_top_k");if(q&&(q.value=o.vector_store_top_k||"3"),E==="openai"){let I=v.querySelector("#aipkit_task_ce_openai_vector_store_ids");I&&Array.isArray(o.openai_vector_store_ids)&&Array.from(I.options).forEach(C=>{C.selected=o.openai_vector_store_ids.includes(C.value)})}else if(E==="pinecone"){let I=v.querySelector("#aipkit_task_ce_pinecone_index_name");I&&(I.value=o.pinecone_index_name||"")}else if(E==="qdrant"){let I=v.querySelector("#aipkit_task_ce_qdrant_collection_name");I&&(I.value=o.qdrant_collection_name||"")}if(E==="pinecone"||E==="qdrant"){let I=o.vector_embedding_provider||"openai",C=v.querySelector("#aipkit_task_ce_vector_embedding_provider"),A=v.querySelector("#aipkit_task_ce_vector_embedding_model");C&&(C.value=I,C.dispatchEvent(new Event("change",{bubbles:!0}))),A&&o.vector_embedding_model&&setTimeout(()=>{A.value=o.vector_embedding_model},50)}}}}window.aipkit_form_populateContentEnhancementFields=n})();(function(){"use strict";function d(){let i=document.getElementById("aipkit_automated_task_form"),r=window.aipkit_dashboard||{};if(!i)return;let n=document.getElementById("aipkit_task_ce_ai_provider"),o=document.getElementById("aipkit_task_ce_ai_model"),e=i.elements.ce_reasoning_effort;if(n&&o){let s=(r.main_provider||"openai").toLowerCase();if(n.value=s,typeof window.aipkit_task_ce_populateModels=="function"){window.aipkit_task_ce_populateModels(n,o);let l="",c=r?.models?.[s];switch(s){case"openai":l="gpt-4o-mini";break;case"google":l="gemini-1.5-flash-latest";break;case"openrouter":l="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":Array.isArray(c)&&c.length>0&&(l=c[0].id||"");break}o.querySelector(`option[value="${CSS.escape(l)}"]`)?o.value=l:console.warn(`Default model ${l} not found for provider ${s}.`),o.dispatchEvent(new Event("change",{bubbles:!0}))}}e&&(e.value="low");let t=i.querySelector("#aipkit_task_ce_content_max_tokens"),a=i.querySelector("#aipkit_task_ce_content_max_tokens_value");if(t&&a){let s="4000";t.value=s,a.textContent=s}}window.aipkit_form_setContentEnhancementDefaults=d})();(function(){"use strict";function d(i,r){if(i.task_type==="enhance_existing_content"){let n={ce_ai_provider:"ai_provider",ce_ai_model:"ai_model",ce_ai_temperature:"ai_temperature",ce_content_max_tokens:"content_max_tokens",ce_reasoning_effort:"reasoning_effort",ce_title_prompt:"title_prompt",ce_excerpt_prompt:"excerpt_prompt",ce_content_prompt:"content_prompt",ce_meta_prompt:"meta_prompt",ce_vector_store_provider:"vector_store_provider",ce_vector_store_top_k:"vector_store_top_k",ce_pinecone_index_name:"pinecone_index_name",ce_qdrant_collection_name:"qdrant_collection_name",ce_vector_embedding_provider:"vector_embedding_provider",ce_vector_embedding_model:"vector_embedding_model"};for(let[e,t]of Object.entries(n))i[e]!==void 0&&(i[t]=i[e],delete i[e]);i.post_types=r.getAll("ce_post_types[]"),i.post_categories=r.getAll("ce_post_categories[]"),i.post_authors=r.getAll("ce_post_authors[]"),i.post_statuses=r.getAll("ce_post_statuses[]"),i.openai_vector_store_ids=r.getAll("ce_openai_vector_store_ids[]"),i.update_title=r.has("ce_update_title")?"1":"0",i.update_excerpt=r.has("ce_update_excerpt")?"1":"0",i.update_content=r.has("ce_update_content")?"1":"0",i.update_meta=r.has("ce_update_meta")?"1":"0",i.enhance_existing_now_flag=r.has("ce_enhance_existing_now_flag")?"1":"0",i.enable_vector_store=r.has("ce_enable_vector_store")?"1":"0",delete i["ce_post_types[]"],delete i["ce_post_categories[]"],delete i["ce_post_authors[]"],delete i["ce_post_statuses[]"],delete i["ce_openai_vector_store_ids[]"],delete i.ce_update_title,delete i.ce_update_excerpt,delete i.ce_update_content,delete i.ce_update_meta,delete i.ce_enhance_existing_now_flag,delete i.ce_enable_vector_store,["post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","content_title_bulk","content_keywords","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","openai_vector_store_ids[]","csv_file_input"].forEach(e=>delete i[e])}return i}window.aipkit_save_task_handleContentEnhancement=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||(e=>e);function i(e,t){let a=window.aipkit_automated_tasks_config||{},s,l,c,_,p;e==="openai"?(s=t.querySelector("#aipkit_task_ce_openai_vector_store_ids"),l=a.openai_vector_stores||[],c="id",_="name",p="No OpenAI stores found."):e==="pinecone"?(s=t.querySelector("#aipkit_task_ce_pinecone_index_name"),l=a.pinecone_indexes||[],c="name",_="name",p="No Pinecone indexes found."):e==="qdrant"&&(s=t.querySelector("#aipkit_task_ce_qdrant_collection_name"),l=a.qdrant_collections||[],c="name",_="name",p="No Qdrant collections found."),s&&(s.innerHTML="",l.length>0?(s.multiple?l.forEach(u=>{s.add(new Option(d(u[_]),u[c]))}):(s.add(new Option("-- Select --","")),l.forEach(u=>{s.add(new Option(d(u[_]),u[c]))})),s.disabled=!1):(s.add(new Option(p,"")),s.disabled=!0))}function r(e,t){let a=t.querySelector("#aipkit_task_ce_vector_embedding_model");if(!a)return;let s=window.aipkit_automated_tasks_config||{},l=[];e==="google"?l=s.google_embedding_models||[]:e==="azure"?l=s.azure_embedding_models||[]:l=s.openai_embedding_models||[],a.innerHTML="",l.length>0?(a.add(new Option("-- Select Model --","")),l.forEach(c=>{a.add(new Option(d(c.name||c.id),c.id))}),a.disabled=!1):(a.add(new Option("No models found","")),a.disabled=!0)}function n(e,t){let a=t.querySelector(".aipkit_task_ce_vector_openai_field"),s=t.querySelector(".aipkit_task_ce_vector_pinecone_field"),l=t.querySelector(".aipkit_task_ce_vector_qdrant_field"),c=t.querySelector(".aipkit_task_ce_vector_embedding_config_row");a&&(a.style.display="none"),s&&(s.style.display="none"),l&&(l.style.display="none"),c&&(c.style.display="none"),e==="openai"&&a?(a.style.display="block",i("openai",t)):e==="pinecone"&&s&&c?(s.style.display="block",c.style.display="block",i("pinecone",t),r(t.querySelector("#aipkit_task_ce_vector_embedding_provider").value,t)):e==="qdrant"&&l&&c&&(l.style.display="block",c.style.display="block",i("qdrant",t),r(t.querySelector("#aipkit_task_ce_vector_embedding_provider").value,t))}function o(){let e=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_knowledge_base"]');if(!e||e.dataset.kbListenerAttached)return;let t=e.querySelector(".aipkit_task_ce_vector_store_toggle"),a=e.querySelector(".aipkit_task_ce_vector_store_settings_container"),s=e.querySelector(".aipkit_task_ce_vector_store_provider_select"),l=e.querySelector(".aipkit_task_ce_vector_embedding_provider_select");t&&a&&t.addEventListener("change",()=>{a.style.display=t.checked?"block":"none"}),s&&a&&s.addEventListener("change",()=>n(s.value,a)),l&&a&&l.addEventListener("change",()=>{r(l.value,a)}),a&&s&&n(s.value,a),e.dataset.kbListenerAttached="true"}window.aipkit_initCeKnowledgeBaseUI=o})();(function(){"use strict";function d(){let i=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),r=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(!i||!r)return;["title","excerpt","content","meta"].forEach(_=>{let p=i.querySelector(`#aipkit_task_ce_update_${_}`),u=r.querySelector(`#aipkit_task_ce_${_}_prompt_section`);if(p&&u){let f=()=>{u.style.display=p.checked?"block":"none"};p.dataset.enhancerListenerAttached||(p.addEventListener("change",f),p.dataset.enhancerListenerAttached="true"),f()}});let o=r.querySelector("#aipkit_task_ce_ai_provider"),e=r.querySelector("#aipkit_task_ce_ai_model");o&&e&&typeof window.aipkit_task_ce_populateModels=="function"&&(o.dataset.ceProviderListenerAttached||(o.addEventListener("change",()=>window.aipkit_task_ce_populateModels(o,e)),o.dataset.ceProviderListenerAttached="true"),e.dataset.ceModelListenerAttached||(e.addEventListener("change",()=>{typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&window.aipkit_autogpt_ce_toggleReasoningEffort()}),e.dataset.ceModelListenerAttached="true"),window.aipkit_task_ce_populateModels(o,e));let t=r.querySelector("#aipkit_task_ce_ai_temperature");t&&typeof window.aipkit_task_ce_handleTemperatureSlider=="function"&&window.aipkit_task_ce_handleTemperatureSlider(t);let a=r.querySelector("#aipkit_task_ce_content_max_tokens");a&&typeof window.aipkit_task_ce_handleMaxTokensSlider=="function"&&window.aipkit_task_ce_handleMaxTokensSlider(a);let s=r.querySelector("#aipkit_task_ce_ai_settings_toggle"),l=r.querySelector("#aipkit_task_ce_ai_parameters_row");s&&l&&(s.dataset.ceAiSettingsListenerAttached||(s.addEventListener("click",()=>{let _=l.style.display==="none"||l.style.display==="";l.style.display=_?"block":"none",s.classList.toggle("aipkit_active",_),s.setAttribute("aria-expanded",_)}),s.dataset.ceAiSettingsListenerAttached="true"));let c=r.querySelector("#aipkit_task_config_enhancement_ai_and_prompts_main");c&&(c.dataset.cePromptListenerAttached||(c.addEventListener("click",_=>{let p=_.target.closest(".aipkit_textarea_toggle");if(!p)return;let u=p.dataset.target,f=document.getElementById(u),b=p.querySelector(".dashicons");if(!f||!b)return;f.classList.toggle("aipkit_collapsed")?(b.classList.remove("dashicons-minus"),b.classList.add("dashicons-plus-alt2"),p.title="Expand"):(b.classList.remove("dashicons-plus-alt2"),b.classList.add("dashicons-minus"),p.title="Collapse")}),c.dataset.cePromptListenerAttached="true")),typeof window.aipkit_initCeKnowledgeBaseUI=="function"?window.aipkit_initCeKnowledgeBaseUI():console.error("AIPKit CE UI: Knowledge base UI initializer not found.")}window.aipkit_initContentEnhancementTaskFormUI=d})();(function(){"use strict";function d(i){if(!i)return;let r=i.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");r&&(r.textContent=i.value,i.dataset.listenerAttached||(i.addEventListener("input",()=>r.textContent=i.value),i.dataset.listenerAttached="true"))}window.aipkit_task_ce_handleMaxTokensSlider=d})();(function(){"use strict";let d=window.aipkit_escapeHtml||function(r){return r};function i(r,n){let o=r.value,e=o?o.toLowerCase():"",t=window.aipkit_dashboard?.models,a=window.aipkit_automated_tasks_form_state||{};if(!n)return;if(!t){n.innerHTML=`<option value="">${d("Error: Model data object not found")}</option>`,n.disabled=!0;return}let s=t[e],l=a.pendingModelSelection||n.value;if(n.innerHTML="",e==="openai"&&typeof s=="object"&&!Array.isArray(s)?Object.keys(s).forEach(c=>{let _=document.createElement("optgroup");_.label=d(c),Array.isArray(s[c])&&s[c].forEach(p=>{p&&p.id&&_.appendChild(new Option(d(p.name||p.id),p.id))}),n.appendChild(_)}):Array.isArray(s)&&s.forEach(c=>{c&&c.id&&n.appendChild(new Option(d(c.name||c.id),c.id))}),n.options.length===0)n.appendChild(new Option(d(`No models for ${o}`),"")),n.disabled=!0;else{n.disabled=!1;let c=!1;if(l&&n.querySelector(`option[value="${CSS.escape(l)}"]`)&&(n.value=l,c=!0),!c&&n.options.length>0){let _=n.querySelector('option:not([value=""])');_&&(n.value=_.value)}}a&&(a.pendingModelSelection=null),typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&window.aipkit_autogpt_ce_toggleReasoningEffort()}window.aipkit_task_ce_populateModels=i})();(function(){"use strict";function d(i){if(!i)return;let r=i.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");r&&(r.textContent=i.value,i.dataset.listenerAttached||(i.addEventListener("input",()=>r.textContent=i.value),i.dataset.listenerAttached="true"))}window.aipkit_task_ce_handleTemperatureSlider=d})();(function(){"use strict";function d(){let i=document.querySelector("#aipkit_task_ce_ai_provider"),r=document.querySelector("#aipkit_task_ce_ai_model"),n=document.querySelector(".aipkit_task_ce_reasoning_effort_field");if(!i||!r||!n){n&&(n.style.display="none");return}let o=i.value,t=(r.value||"").toLowerCase(),a=t.startsWith("o1")||t.startsWith("o3")||t.startsWith("o4"),s=t.includes("gpt-5");o.toLowerCase()==="openai"&&(a||s)?n.style.display="block":n.style.display="none"}window.aipkit_autogpt_ce_toggleReasoningEffort=d})();(function(){"use strict";let d={files:[],uploading:!1,currentXhr:null,cancelled:!1,totals:{loaded:0,size:0}};function i(){let g=window.aipkit_dashboard?.isProPlan;return g===!0||g===1||g==="1"}function r(g){return document.getElementById(g)}function n(){let g=r("aipkit_vs_global_file_queue");if(!g)return;if(!d.files.length){g.innerHTML="";return}let h=d.files.map((w,S)=>{let v=Math.round(w.size/1048576*10)/10,m=(typeof Intl<"u"?new Intl.NumberFormat(void 0,{minimumFractionDigits:1,maximumFractionDigits:1}):{format:y=>y.toFixed(1)}).format(v);return`<div class="aipkit_queue_item" data-idx="${S}" data-status="pending" style="display:flex;align-items:center;gap:8px;margin:4px 0;">
        <span class="aipkit_queue_item_icon" title="Pending" aria-label="Pending" style="font-size:14px;line-height:1;width:18px;text-align:center;">\u23F3</span>
        <div class="aipkit_queue_item_meta" style="flex:1 1 auto;min-width:0;">
          <div style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="${o(w.name)}">${o(w.name)}</div>
          <div class="aipkit_queue_item_progress" style="height:4px;background:#eee;border-radius:2px;overflow:hidden;margin-top:4px;">
            <div class="aipkit_queue_item_bar" style="width:0%;height:100%;background:#007cba;transition:width .2s;"></div>
          </div>
        </div>
  <div class="aipkit_queue_item_size" style="font-size:11px;color:#666;min-width:64px;text-align:right;">${m} MB</div>
        <button type="button" class="aipkit_queue_remove_btn aipkit_btn_icon" aria-label="Remove file" title="Remove" style="border:none;background:transparent;cursor:pointer;">
          <span class="dashicons dashicons-no"></span>
        </button>
      </div>`}).join("");g.innerHTML=h,g.querySelectorAll(".aipkit_queue_remove_btn").forEach(w=>{w.addEventListener("click",S=>{let v=S.currentTarget.closest(".aipkit_queue_item");if(!v)return;let m=parseInt(v.dataset.idx,10);isNaN(m)||(d.files.splice(m,1),n())})})}function o(g){let h=document.createElement("div");return h.textContent=String(g??""),h.innerHTML}function e(g,h){typeof window.aipkit_showOpenAIVectorStatus=="function"&&window.aipkit_showOpenAIVectorStatus(g,h||"info","aipkit_knowledge_base_global_status")}let t=["text/plain","application/pdf","application/x-pdf","text/html","application/xhtml+xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];function a(){let g=window.aipkit_uploadLimits?.allowed_mime_types;return Array.isArray(g)&&g.length?g:t}function s(g){let h=Number(window.aipkit_effectiveUploadLimitBytes||0);return(!Number.isFinite(h)||h<=0)&&(h=10*1024*1024),g==="openai"&&(h=Math.min(h,10*1024*1024)),h}function l(g,h){let w=a(),S=s(h),v=[];return g.size>S&&v.push(`Too large: ${g.name} (${c(g.size)}). Max ${c(S)}.`),g.type&&!w.map(m=>m.toLowerCase()).includes(String(g.type).toLowerCase())&&v.push(`Unsupported type: ${g.name} (${g.type}).`),v}function c(g){if(!Number.isFinite(g))return`${g}`;let h=["B","KB","MB","GB"],w=0,S=g;for(;S>=1024&&w<h.length-1;)S/=1024,w++;return`${(typeof Intl<"u"?new Intl.NumberFormat(void 0,{maximumFractionDigits:1}):{format:m=>m.toFixed(1)}).format(S)} ${h[w]}`}function _(g,h){let w=r("aipkit_vs_global_file_queue");if(!w)return;let S=w.querySelector(`.aipkit_queue_item[data-idx="${g}"]`);if(!S)return;let v=S.querySelector(".aipkit_queue_item_bar");v&&(v.style.width=Math.max(0,Math.min(100,h))+"%")}function p(g,h){let w=r("aipkit_vs_global_file_queue");if(!w)return;let S=w.querySelector(`.aipkit_queue_item[data-idx="${g}"]`);if(!S)return;let v=S.querySelector(".aipkit_queue_item_icon"),{icon:m,label:y}=u(h);v&&(v.textContent=m,v.title=y,v.setAttribute("aria-label",y)),S.dataset.status=h}function u(g){switch(g){case"completed":return{icon:"\u2705",label:"Completed"};case"error":return{icon:"\u274C",label:"Error"};case"processing":return{icon:"\u{1F504}",label:"Processing"};case"pending":default:return{icon:"\u23F3",label:"Pending"}}}function f(g){}function b(g,h){let w=new FormData,S=g.vectorStoreProvider;if(w.append("provider",S),w.append("source_type","file_upload"),g.embeddingProvider&&w.append("embedding_provider",g.embeddingProvider),g.embeddingModel&&w.append("embedding_model",g.embeddingModel),S==="openai"){let v=g.targetStoreId.startsWith("_create_new_")?"":g.targetStoreId;w.append("target_store_id",v),w.append("new_store_name_openai",g.newStoreNameOpenAI||"")}else if(S==="pinecone"){let v=g.targetStoreId.startsWith("_create_new_")?"":g.targetStoreId;w.append("index_name",v),w.append("target_store_id",g.targetStoreId)}else if(S==="qdrant"){let v=g.targetStoreId.startsWith("_create_new_")?"":g.targetStoreId;w.append("collection_name",v),w.append("target_store_id",g.targetStoreId)}return h&&w.append("_ajax_nonce",h),w}function k(g,h,w){return new Promise((S,v)=>{let m=new XMLHttpRequest;d.currentXhr=m,m.open("POST",g,!0),m.withCredentials=!0,m.upload.onprogress=y=>{if(y.lengthComputable&&typeof w=="function"){let E=y.loaded/y.total*100;w(E)}},m.onreadystatechange=function(){if(m.readyState===4){d.currentXhr=null;try{let y=JSON.parse(m.responseText||"{}");if(m.status>=200&&m.status<300&&y.success)S(y.data);else{let E=new Error(y?.data?.message||`Upload failed (${m.status})`);E.server=y,v(E)}}catch{v(new Error(`Upload error: invalid JSON (${m.status})`))}}},m.onerror=()=>{d.currentXhr=null,v(new Error("Network error"))},m.send(h)})}async function T(g){if(!i()||!d.files.length||!window.aipkit_dashboard?.ajaxurl)return!1;let h=g.vectorStoreProvider,w="";if(h==="openai"?w="aipkit_upload_and_add_file_to_store_direct_openai":h==="pinecone"?w="aipkit_upload_file_and_upsert_to_pinecone":h==="qdrant"&&(w="aipkit_upload_file_and_upsert_to_qdrant"),!w)return!1;let m=r(h==="openai"?"aipkit_vector_store_nonce_openai":h==="pinecone"?"aipkit_vector_store_pinecone_nonce_management":"aipkit_vector_store_qdrant_nonce_management")?.value||"";e("Uploading files...","info"),d.uploading=!0,d.cancelled=!1,d.totals.size=d.files.reduce((y,E)=>y+(E?.size||0),0),d.totals.loaded=0;for(let y=0;y<d.files.length;y++){let E=d.files[y];if(d.cancelled)break;let F=l(E,h);if(F.length){p(y,"error"),F.forEach(C=>e(C,"warning")),_(y,100),d.totals.loaded+=E.size,d.totals.loaded/Math.max(1,d.totals.size)*100;continue}p(y,"processing");let q=b(g,m),I=h==="openai"?"aipkit_vs_global_file_to_submit":"file_to_upload";q.append("action",w),q.append(I,E);try{let C=await k(window.aipkit_dashboard.ajaxurl,q,A=>{_(y,A)});_(y,100),p(y,"completed"),e(C?.message||`${E.name} uploaded`,"success"),d.totals.loaded+=E.size,d.totals.loaded/Math.max(1,d.totals.size)*100}catch(C){if(d.cancelled){e("Upload cancelled.","warning"),p(y,"error");break}p(y,"error"),e(C.message||`Failed to upload ${E.name}`,"error"),d.totals.loaded+=E.size,d.totals.loaded/Math.max(1,d.totals.size)*100}}return d.uploading=!1,d.files=[],n(),!0}function x(){let g=r("aipkit_vs_global_file_to_submit");g&&(g.dataset.queueBound||(g.addEventListener("change",()=>{if(!g.files||!g.files.length){d.files=[],n();return}let h=document.getElementById("aipkit_vs_global_provider_select")?.value||"openai",w=Array.from(g.files),S=a(),v=s(h),m=[],y=0;w.forEach(E=>{let F=l(E,h);F.length?(y++,F.forEach(q=>e(q,"warning"))):m.push(E)}),d.files=m,n(),y>0&&e(`Some files were skipped. Allowed types: ${S.join(", ")}. Max per file: ${c(v)}.`,"info")}),g.dataset.queueBound="1"))}function $(){i()&&(x(),n())}window.aipkit_initUploadQueue=$,window.aipkit_runUploadQueue=T})();(function(){"use strict";function d(){let n=window.aipkit_dashboard?.isProPlan;return n===!0||n===1||n==="1"}function i(n){return document.getElementById(n)}function r(){if(!d())return;let n=i("aipkit_vs_global_dropzone"),o=i("aipkit_vs_global_file_to_submit"),e=typeof window.aipkit_initUploadQueue=="function";if(!n||!o||n.dataset.ddBound)return;function t(a){n.style.background=a?"#f6f7f7":"#fff",n.style.borderColor=a?"#2271b1":"#c3c4c7"}n.addEventListener("click",()=>o.click()),n.addEventListener("keydown",a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),o.click())}),n.addEventListener("dragover",a=>{a.preventDefault(),a.stopPropagation(),t(!0)}),n.addEventListener("dragleave",a=>{a.preventDefault(),a.stopPropagation(),t(!1)}),n.addEventListener("drop",a=>{a.preventDefault(),a.stopPropagation(),t(!1);let s=a.dataTransfer?.files;if(!s||!s.length)return;try{let c=new DataTransfer;Array.from(s).forEach(_=>c.items.add(_)),o.files=c.files}catch{}let l=new Event("change",{bubbles:!0});o.dispatchEvent(l),e&&window.aipkit_initUploadQueue()}),n.dataset.ddBound="1"}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r(),window.aipkit_initUploadDragDrop=r})();})();
