(()=>{(function(){"use strict";function _(i,o=[],r={}){return{botId:i,triggers:JSON.parse(JSON.stringify(o)),schemas:r,isDirty:!1,editingTriggerId:null}}window.aipkit_initTriggerBuilderState=_})();(function(){"use strict";function _(i){let o=document.getElementById(`aipkit_trigger_builder_${i}`),r=o?o.querySelector(".aipkit_trigger_raw_data_source"):null;if(!r)return console.warn(`AIPKit Trigger Data: Raw data source input for bot ${i} not found.`),[];let n=r.value;try{let t=JSON.parse(n);return Array.isArray(t)?t:[]}catch(t){return console.error(`AIPKit Trigger Data: Failed to parse initial triggers JSON for bot ${i}. Error:`,t,"Raw JSON:",n),[]}}window.aipkit_loadInitialTriggers=_})();(function(){"use strict";function _(i){let o=document.getElementById(`aipkit_trigger_builder_${i}`),r=o?o.querySelector(".aipkit_trigger_schemas_source"):null;if(!r)return console.warn(`AIPKit Trigger Data: Schemas source input for bot ${i} not found.`),{};let n=r.getAttribute("data-schemas");try{let t=JSON.parse(n);return typeof t=="object"&&t!==null?t:{}}catch(t){return console.error(`AIPKit Trigger Data: Failed to parse trigger schemas JSON for bot ${i}. Error:`,t),{}}}window.aipkit_loadTriggerSchemas=_})();(function(){"use strict";function _(i,o){let r=document.getElementById(`aipkit_bot_${i}_triggers_json`);if(!r)return console.error(`AIPKit Trigger Data: Main hidden textarea for triggers JSON (bot ID: ${i}) not found.`),!1;try{return r.value=JSON.stringify(o,null,2),!0}catch(n){return console.error(`AIPKit Trigger Data: Failed to stringify triggers array for bot ${i}.`,n),r.value="[]",!1}}window.aipkit_updateTriggersJsonForSave=_})();(function(){"use strict";let _=null;function i(r){_=r}function o(){return _}window.aipkit_setTriggerBuilderState=i,window.aipkit_getUIBuilderState=o})();(function(){"use strict";function _(i,o){let r=window.aipkit_escapeHtml||function(c){return c},n=[],t=o?.ConditionSchema?.properties?.field;if(!t||!t.description)return console.warn("GetConditionFields: Field schema or description missing."),n;let e=t.description.match(/Examples: (.*)\./);return e&&e[1]&&e[1].split(",").forEach(a=>{let l=a.trim().replace(/"/g,"");i==="user_context"&&(l.includes("user_")||l.includes("logged_in"))?n.push({value:l,label:r(l.replace(/_/g," "))}):i==="text_content"&&l.includes("message_text")?n.push({value:l,label:r(l.replace(/_/g," "))}):i==="conversation_state"&&l.includes("message_count")?n.push({value:l,label:r(l.replace(/_/g," "))}):i==="ai_model_context"&&(l.includes("provider")||l.includes("model"))?n.push({value:l,label:r(l.replace(/_/g," "))}):i==="error_context"&&(l.includes("error_")||l.includes("failed_"))?n.push({value:l,label:r(l.replace(/_/g," "))}):i==="http_context"&&(l.includes("http_")||l.includes("user_agent")||l.includes("referer"))?n.push({value:l,label:r(l.replace(/_/g," "))}):i==="post_context"&&l.includes("post_")&&n.push({value:l,label:r(l.replace(/_/g," "))})}),n.length===0&&t.enum&&t.enum.forEach(c=>n.push({value:c,label:r(c.replace(/_/g," "))})),n.length===0&&n.push({value:"custom_field",label:"Custom Field (Advanced)"}),n.sort((c,a)=>c.label.localeCompare(a.label))}window.aipkit_getConditionFieldsForType=_})();(function(){"use strict";function _(i,o,r){let n=window.aipkit_escapeHtml||function(a){return a},t=r?.ConditionSchema?.properties?.operator?.enum||[],e=[],c="string";return o==="is_logged_in"?c="boolean":o==="message_count"||o==="post_id"||o==="priority"?c="numeric":o==="user_role"&&(c="array_string"),t.forEach(a=>{let l=n(a.replace(/_/g," "));c==="boolean"&&["is_true","is_false"].includes(a)?e.push({value:a,label:l}):c==="string"&&["equals","not_equals","contains","not_contains","starts_with","ends_with","matches_regex","is_empty","is_not_empty","is_one_of","is_not_one_of","equals_ignore_case"].includes(a)?e.push({value:a,label:l}):c==="numeric"&&["greater_than","less_than","equals_numeric","not_equals_numeric","greater_than_or_equals","less_than_or_equals"].includes(a)?e.push({value:a,label:l}):c==="array_string"&&["is_one_of","is_not_one_of","contains","not_contains"].includes(a)&&e.push({value:a,label:l})}),e.length===0&&t.forEach(a=>e.push({value:a,label:n(a.replace(/_/g," "))})),e.sort((a,l)=>a.label.localeCompare(l.label))}window.aipkit_getConditionOperatorsForField=_})();(function(){"use strict";function _(i,o,r=null){if(!window.aipkit_getUIBuilderState()||!i||!o)return;let t=window.aipkit_escapeHtml||function(a){return a},e=i.value;if(["is_true","is_false","is_empty","is_not_empty"].includes(e))o.style.display="none",o.value="";else{o.style.display="",o.type="text",o.placeholder=t("Value");let s=i.closest(".aipkit_condition_row").querySelector(".aipkit_condition_field_select").value;(s==="message_count"||s==="priority")&&(o.type="number",o.step="1"),r&&r.value!==void 0?Array.isArray(r.value)&&(e==="is_one_of"||e==="is_not_one_of")?o.value=r.value.join(", "):o.value=String(r.value):o.value=""}}window.aipkit_updateConditionValueInput=_})();(function(){"use strict";function _(i,o,r,n=null){let t=window.aipkit_getUIBuilderState();if(!t||!i||!o||!r)return;let e=window.aipkit_escapeHtml||function(s){return s},c=i.closest(".aipkit_condition_row").querySelector(".aipkit_condition_type_select").value,a=i.value;if(o.innerHTML="",typeof window.aipkit_getConditionOperatorsForField!="function"){console.error("UpdateConditionOperators: aipkit_getConditionOperatorsForField function not found.");return}let l=window.aipkit_getConditionOperatorsForField(c,a,t.schemas);l.forEach(s=>{o.appendChild(new Option(e(s.label),e(s.value)))}),n&&n.operator?o.value=n.operator:l.length>0&&(o.value=l[0].value),typeof window.aipkit_updateConditionValueInput=="function"&&window.aipkit_updateConditionValueInput(o,r,n)}window.aipkit_updateConditionOperators=_})();(function(){"use strict";function _(i,o,r,n,t=null){let e=window.aipkit_getUIBuilderState();if(!e||!i||!o||!r||!n)return;let c=window.aipkit_escapeHtml||function(s){return s},a=i.value;if(o.innerHTML="",typeof window.aipkit_getConditionFieldsForType!="function"){console.error("UpdateConditionFields: aipkit_getConditionFieldsForType function not found.");return}let l=window.aipkit_getConditionFieldsForType(a,e.schemas);l.forEach(s=>{o.appendChild(new Option(c(s.label),c(s.value)))}),t&&t.field?o.value=t.field:l.length>0&&(o.value=l[0].value),typeof window.aipkit_updateConditionOperators=="function"&&window.aipkit_updateConditionOperators(o,r,n,t)}window.aipkit_updateConditionFields=_})();(function(){"use strict";function _(i,o=null){let r=window.aipkit_getUIBuilderState();if(!r||!i)return;let n=window.aipkit_escapeHtml||function(d){return d},t=document.querySelector(".aipkit_condition_row_template");if(!t){console.error("RenderConditionRow: Condition row template not found.");return}let c=t.content.cloneNode(!0).querySelector(".aipkit_condition_row"),a=c.querySelector(".aipkit_condition_type_select"),l=c.querySelector(".aipkit_condition_field_select"),s=c.querySelector(".aipkit_condition_operator_select"),p=c.querySelector(".aipkit_condition_value_input");(r.schemas?.ConditionSchema?.properties?.type?.enum||[]).forEach(d=>{a.appendChild(new Option(n(d.replace(/_/g," ")),n(d)))}),o?(a.value=o.type||"",typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(a,l,s,p,o)):(a.options.length>0&&(a.value=a.options[0].value),typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(a,l,s,p)),i.appendChild(c)}window.aipkit_renderConditionRow=_})();(function(){"use strict";function _(i,o=[]){if(!window.aipkit_getUIBuilderState()||!i)return;let n=window.aipkit_escapeHtml||function(c){return c},t=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:c=>c,e=i.querySelector(".aipkit_options_list");e&&(e.innerHTML="",(o||[]).forEach((c,a)=>{let l=document.createElement("div");l.className="aipkit_form_element_option_row",l.dataset.optionIndex=a;let s=document.createElement("input");s.type="text",s.className="aipkit_form-input aipkit_element_option_value aipkit_form_element_prop_change",s.placeholder=t("Value (e.g., option1)","gpt3-ai-content-generator"),s.value=n(c.value||""),s.dataset.property=`options[${a}].value`;let p=document.createElement("input");p.type="text",p.className="aipkit_form-input aipkit_element_option_text aipkit_form_element_prop_change",p.placeholder=t("Display Text (e.g., Option One)","gpt3-ai-content-generator"),p.value=n(c.text||""),p.dataset.property=`options[${a}].text`;let d=document.createElement("button");d.type="button",d.className="aipkit_btn aipkit_btn-icon aipkit_form_option_remove_btn",d.title=t("Remove Option","gpt3-ai-content-generator"),d.innerHTML='<span class="dashicons dashicons-no-alt"></span>',l.appendChild(s),l.appendChild(p),l.appendChild(d),e.appendChild(l)}))}window.aipkit_updateFormElementOptionControls=_})();(function(){"use strict";function _(i,o,r){if(!window.aipkit_getUIBuilderState())return console.error("RenderFormElementEditorItem: UI Builder state not initialized."),null;let t=window.aipkit_escapeHtml||function(f){return f},e=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:f=>f,c=`${r}_${i.id||`el_${Date.now()}_${o}`}`,a=document.createElement("div");a.className="aipkit_form_element_editor_item",a.dataset.elementIndex=o,a.dataset.elementId=i.id||"";let l=document.createElement("div");l.className="aipkit_form_element_editor_header";let s=document.createElement("span");s.className="aipkit_form_element_editor_title",s.innerHTML=`${t(i.label||i.id||e("New Element","gpt3-ai-content-generator"))} <span class="aipkit_element_type_badge">${t(i.type||"text_input")}</span> <span class="aipkit_element_id_badge">${i.id?t(i.id):""}</span>`;let p=document.createElement("div");p.className="aipkit_form_element_editor_actions";let d=document.createElement("button");d.type="button",d.className="aipkit_btn aipkit_btn-icon aipkit_form_element_remove_btn",d.title=e("Remove Element","gpt3-ai-content-generator"),d.innerHTML='<span class="dashicons dashicons-trash"></span>',p.appendChild(d),l.appendChild(s),l.appendChild(p),a.appendChild(l);let u=document.createElement("div");u.className="aipkit_form_element_editor_content";let g='<div class="aipkit_form-row">';g+=`<div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_type_${t(c)}">${e("Element Type","gpt3-ai-content-generator")}</label>
            <select id="fe_type_${t(c)}" data-property="type" class="aipkit_form-input aipkit_form_element_prop_change">
                ${["text_input","textarea","dropdown","checkbox_group","radio_group","label","heading"].map(f=>`<option value="${t(f)}" ${i.type===f?"selected":""}>${t(f.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase()))}</option>`).join("")}
            </select>
        </div>`,g+=`<div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_id_${t(c)}">${e("Field ID / Variable","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_id_${t(c)}" data-property="id" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(i.id||"")}" placeholder="${e("e.g., product_name","gpt3-ai-content-generator")}">
        </div></div>`,g+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_label_${t(c)}">${i.type==="label"||i.type==="heading"?e("Text Content","gpt3-ai-content-generator"):e("Display Label","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_label_${t(c)}" data-property="label" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(i.label||"")}">
        </div></div>`,["text_input","textarea"].includes(i.type)&&(g+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_form-label" for="fe_placeholder_${t(c)}">${e("Placeholder Text","gpt3-ai-content-generator")}</label>
                <input type="text" id="fe_placeholder_${t(c)}" data-property="placeholder" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(i.placeholder||"")}">
            </div></div>`);let m="";if(["label","heading"].includes(i.type)||(m+=`<div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_checkbox-label" for="fe_required_${t(c)}">
                    <input type="checkbox" id="fe_required_${t(c)}" data-property="required" class="aipkit_toggle_switch aipkit_form_element_prop_change" ${i.required?"checked":""}>
                    ${e("Required Field","gpt3-ai-content-generator")}
                </label>
            </div>`,m+=`<div class="aipkit_form-group aipkit_form-col">
                <label class="aipkit_form-label" for="fe_default_value_${t(c)}">${e("Default Value","gpt3-ai-content-generator")}</label>
                <input type="text" id="fe_default_value_${t(c)}" data-property="default_value" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(String(i.default_value||""))}">
                <p class="aipkit_form-help">${i.type==="checkbox_group"?e("For checkboxes, separate multiple default values with a comma (e.g., val1,val2).","gpt3-ai-content-generator"):""}</p>
            </div>`),m&&(g+=`<div class="aipkit_form-row">${m}</div>`),g+=`<div class="aipkit_form-row"><div class="aipkit_form-group aipkit_form-col">
            <label class="aipkit_form-label" for="fe_help_text_${t(c)}">${e("Help Text (Optional)","gpt3-ai-content-generator")}</label>
            <input type="text" id="fe_help_text_${t(c)}" data-property="help_text" class="aipkit_form-input aipkit_form_element_prop_change" value="${t(i.help_text||"")}">
        </div></div>`,["dropdown","checkbox_group","radio_group"].includes(i.type)&&(g+=`<div class="aipkit_form_element_options_editor" data-element-type="${t(i.type)}"><h6>${e("Options","gpt3-ai-content-generator")}</h6><div class="aipkit_options_list"></div>
            <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_form_add_option_btn"><span class="dashicons dashicons-plus-alt"></span> ${e("Add Option","gpt3-ai-content-generator")}</button>
            <p class="aipkit_form-help">${e("Format: actual_value|Display Text. e.g., blue_val|Blue Sky","gpt3-ai-content-generator")}</p></div>`),u.innerHTML=g,a.appendChild(u),["dropdown","checkbox_group","radio_group"].includes(i.type)){let f=a.querySelector(".aipkit_form_element_options_editor");f&&typeof window.aipkit_updateFormElementOptionControls=="function"&&window.aipkit_updateFormElementOptionControls(f,i.options||[])}return l.addEventListener("click",()=>{let f=u.style.display==="block";u.style.display=f?"none":"block",u.classList.toggle("aipkit_expanded",!f)}),i.id||(u.style.display="block",u.classList.add("aipkit_expanded")),a}window.aipkit_renderFormElementEditorItem=_})();(function(){"use strict";function _(i,o,r={},n=null){let t=window.aipkit_getUIBuilderState();if(!t||!i)return;let e=window.aipkit_escapeHtml||function(d){return d},c=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:d=>d,a=t.schemas||{};i.innerHTML="";let l=a.ActionSchema?.properties?.payload?.properties||{},s="";function p(d,u,g,m="action.payload."){let f='<div class="aipkit_form-group">';f+=`<label class="aipkit_form-label" for="action_payload_${e(d)}_${t.editingTriggerId||""}">${e(u.description||d.replace(/_/g," "))}</label>`;let w=`${m}${d}`;return u.type==="boolean"?f+=`<input type="checkbox" id="action_payload_${e(d)}_${t.editingTriggerId||""}" data-field="${e(w)}" class="aipkit_form-input aipkit_trigger_field" ${g===!0?"checked":""}>`:u.enum?(f+=`<select id="action_payload_${e(d)}_${t.editingTriggerId||""}" data-field="${e(w)}" class="aipkit_form-input aipkit_trigger_field">`,u.enum.forEach(b=>{f+=`<option value="${e(b)}" ${g===b?"selected":""}>${e(b.replace(/_/g," "))}</option>`}),f+="</select>"):u.type==="integer"||u.type==="number"?(f+=`<input type="number" id="action_payload_${e(d)}_${t.editingTriggerId||""}" data-field="${e(w)}" class="aipkit_form-input aipkit_trigger_field" value="${e(String(g||u.default||""))}"`,u.minimum!==void 0&&(f+=` min="${e(String(u.minimum))}"`),u.maximum!==void 0&&(f+=` max="${e(String(u.maximum))}"`),f+=">"):u.type==="object"?(f+=`<textarea id="action_payload_${e(d)}_${t.editingTriggerId||""}" data-field="${e(w)}" class="aipkit_form-input aipkit_trigger_field" rows="3" placeholder="${e('e.g., {"X-My-Header": "Value"}')}">${e(JSON.stringify(g||{},null,2))}</textarea>`,f+=`<div class="aipkit_form-help">${e("Enter as a valid JSON object.")}</div>`):d==="message"||d==="content"||d==="body_template"||d==="reason"||d==="log_message_format"?f+=`<textarea id="action_payload_${e(d)}_${t.editingTriggerId||""}" data-field="${e(w)}" class="aipkit_form-input aipkit_trigger_field" rows="3">${e(g||u.default||"")}</textarea>`:f+=`<input type="text" id="action_payload_${e(d)}_${t.editingTriggerId||""}" data-field="${e(w)}" class="aipkit_form-input aipkit_trigger_field" value="${e(g||"")}">`,f+="</div>",f}if(Object.keys(l).forEach(d=>{let u=l[d],g=!0;o==="bot_reply"&&!["message","stop_processing_ai"].includes(d)&&(g=!1),o==="inject_context"&&!["placement","content"].includes(d)&&(g=!1),o==="block_message"&&!["reason"].includes(d)&&(g=!1),o==="call_webhook"&&!["endpoint_url","http_method","headers","body_template","timeout_seconds"].includes(d)&&(g=!1),o==="set_variable"&&!["scope","key"].includes(d)&&(g=!1),o==="display_form"&&!["form_id","title","elements","submit_button_text"].includes(d)&&(g=!1),o==="store_form_submission"&&!["log_message_format"].includes(d)&&(g=!1),g&&(o==="display_form"&&d==="elements"||(s+=p(d,u,r[d])))}),o==="set_variable"){let d=a.ActionSchema?.properties?.value||{type:"string",description:"Value"};s+=p("value",d,n,"action.")}if(o==="display_form"&&(s+=`<div class="aipkit_form_elements_editor_container">
                <h6>${c("Form Elements","gpt3-ai-content-generator")}</h6>
                <div class="aipkit_form_elements_list"></div>
                <button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_form_add_element_btn">
                    <span class="dashicons dashicons-plus"></span> ${c("Add Form Element","gpt3-ai-content-generator")}
                </button>
            </div>`),i.innerHTML=s,o==="display_form"){let d=i.querySelector(".aipkit_form_elements_list");d&&r&&Array.isArray(r.elements)&&r.elements.forEach((u,g)=>{if(typeof window.aipkit_renderFormElementEditorItem=="function"){let m=window.aipkit_renderFormElementEditorItem(u,g,r.form_id);m&&d.appendChild(m)}})}}window.aipkit_renderActionPayloadFields=_})();(function(){"use strict";function _(i,o){let r=window.aipkit_getUIBuilderState();if(!r||!i||!o){console.error("AIPKit RenderTriggerEditorForm: Missing state, content element, or trigger data.");return}let n=window.aipkit_escapeHtml||function(s){return s},t=r.schemas||{},e=window.wp&&window.wp.i18n&&window.wp.i18n.__?window.wp.i18n.__:s=>s,c=`
            <div class="aipkit_form-row">
                <div class="aipkit_form-group aipkit_form-col">
                    <label class="aipkit_form-label" for="trigger_name_${o.id}">${n(e("Trigger Name","gpt3-ai-content-generator"))}</label>
                    <input type="text" id="trigger_name_${o.id}" data-field="name" class="aipkit_form-input aipkit_trigger_field" value="${n(o.name||"")}">
                </div>
                <div class="aipkit_form-group aipkit_form-col">
                    <label class="aipkit_form-label" for="trigger_event_${o.id}">${n(e("Event","gpt3-ai-content-generator"))}</label>
                    <select id="trigger_event_${o.id}" data-field="event_name" class="aipkit_form-input aipkit_trigger_field">
                        ${(t.EventSchema?.properties?.name?.enum||[]).map(s=>`<option value="${n(s)}" ${o.event_name===s?"selected":""}>${n(s.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase()))}</option>`).join("")}
                    </select>
                </div>
                <div class="aipkit_form-group aipkit_form-col" style="max-width: 120px;">
                    <label class="aipkit_form-label" for="trigger_priority_${o.id}">${n(e("Priority","gpt3-ai-content-generator"))}</label>
                    <input type="number" id="trigger_priority_${o.id}" data-field="priority" class="aipkit_form-input aipkit_trigger_field" value="${n(String(o.priority||10))}" min="0" step="1">
                </div>
            </div>
            <div class="aipkit_form-group">
                <label class="aipkit_form-label" for="trigger_description_${o.id}">${n(e("Description (Optional)","gpt3-ai-content-generator"))}</label>
                <textarea id="trigger_description_${o.id}" data-field="description" class="aipkit_form-input aipkit_trigger_field" rows="2">${n(o.description||"")}</textarea>
            </div>
        `;c+=`<div class="aipkit_conditions_container"><h6>${n(e("Conditions (All must be met)","gpt3-ai-content-generator"))}</h6><div class="aipkit_condition_rows_list">`,o.conditions&&o.conditions.length>0||(c+=`<p class="aipkit_form-help">${n(e("No conditions defined. This trigger will run if the event occurs.","gpt3-ai-content-generator"))}</p>`),c+=`</div><button type="button" class="aipkit_btn aipkit_btn-secondary aipkit_btn-small aipkit_trigger_add_condition_btn" style="margin-top:10px;"><span class="dashicons dashicons-plus"></span> ${n(e("Add Condition","gpt3-ai-content-generator"))}</button></div>`,c+=`<div class="aipkit_action_container"><h6>${n(e("Action","gpt3-ai-content-generator"))}</h6>`,c+=`<div class="aipkit_form-group">
                        <label class="aipkit_form-label" for="action_type_${o.id}">${n(e("Action Type","gpt3-ai-content-generator"))}</label>
                        <select id="action_type_${o.id}" data-field="action.type" class="aipkit_form-input aipkit_trigger_field aipkit_trigger_action_type_select">
                            ${(t.ActionSchema?.properties?.type?.enum||[]).map(s=>`<option value="${n(s)}" ${o.action?.type===s?"selected":""}>${n(s.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase()))}</option>`).join("")}
                        </select>
                     </div>`,c+='<div class="aipkit_action_payload_container"></div>',c+="</div>",i.innerHTML=c;let a=i.querySelector(".aipkit_condition_rows_list");a&&o.conditions&&o.conditions.length>0&&(a.innerHTML="",o.conditions.forEach(s=>{typeof window.aipkit_renderConditionRow=="function"&&window.aipkit_renderConditionRow(a,s)}));let l=i.querySelector(".aipkit_action_payload_container");l&&o.action?.type&&typeof window.aipkit_renderActionPayloadFields=="function"&&window.aipkit_renderActionPayloadFields(l,o.action.type,o.action.payload,o.action.value)}window.aipkit_renderTriggerEditorForm=_})();(function(){"use strict";function _(i){if(!window.aipkit_getUIBuilderState())return console.error("AIPKit RenderSingleTriggerItem: UI Builder state not initialized."),null;let r=window.aipkit_escapeHtml||function(p){return p},n=document.querySelector(".aipkit_trigger_editor_template");if(!n)return console.error("AIPKit RenderSingleTriggerItem: Trigger editor template not found."),null;let e=n.content.cloneNode(!0).querySelector(".aipkit_trigger_item"),c=e.querySelector(".aipkit_trigger_item_name_display"),a=e.querySelector(".aipkit_trigger_item_id_display"),l=e.querySelector(".aipkit_trigger_is_active_checkbox"),s=e.querySelector(".aipkit_trigger_item_content");return e.dataset.triggerId=i.id,c&&(c.textContent=r(i.name||"Unnamed Trigger")),a&&(a.textContent=`(ID: ${r(i.id)})`),l&&(l.checked=i.is_active===!0),s?s.innerHTML="":console.error("AIPKit RenderSingleTriggerItem: .aipkit_trigger_item_content missing in template for trigger:",i.id),e}window.aipkit_renderSingleTriggerItem=_})();(function(){"use strict";function _(){let i=window.aipkit_getUIBuilderState();if(!i){console.error("RenderTriggerList: UI Builder state not initialized.");return}let o=document.getElementById(`aipkit_trigger_list_for_${i.botId}`),r=o?o.querySelector(".aipkit_trigger_list_empty_message"):null;if(!o){console.error(`RenderTriggerList: List container for bot ${i.botId} not found.`);return}o.querySelectorAll(".aipkit_trigger_item").forEach(n=>n.remove()),i.triggers&&i.triggers.length>0?(r&&(r.style.display="none"),i.triggers.forEach(n=>{if(typeof window.aipkit_renderSingleTriggerItem=="function"){let t=window.aipkit_renderSingleTriggerItem(n);t&&o.appendChild(t)}else console.error("RenderTriggerList: aipkit_renderSingleTriggerItem function not found.")})):r&&(r.style.display="block")}window.aipkit_renderTriggerList=_})();(function(){"use strict";let _=null;function i(r){_=r}function o(){return _}window.aipkit_setTriggerEventManagerState=i,window.aipkit_getTriggerEventManagerState=o})();(function(){"use strict";function _(i,o,r){let n=o.split("."),t=i;for(let e=0;e<n.length-1;e++)(!t[n[e]]||typeof t[n[e]]!="object")&&(t[n[e]]={}),t=t[n[e]];t[n[n.length-1]]=r}window.aipkit_setNestedValue=_})();(function(){"use strict";function _(i,o,r){let n=window.aipkit_getTriggerEventManagerState();if(!n)return;let t=n.triggers.findIndex(e=>e.id===i);if(t===-1){console.warn(`UpdateTriggerData: Trigger ID ${i} not found in state for bot ${n.botId}.`);return}window.aipkit_setNestedValue(n.triggers[t],o,r),n.isDirty=!0}window.aipkit_updateTriggerData=_})();(function(){"use strict";function _(i,o){let r=window.aipkit_getTriggerEventManagerState();if(!r||!o)return console.error("SaveTriggerFromForm: State or triggerItemElement missing."),!1;let n=r.triggers.findIndex(a=>a.id===i);if(n===-1)return console.warn(`SaveTriggerFromForm: Trigger ID ${i} not found in state for bot ${r.botId}.`),!1;let t=o.querySelector(".aipkit_trigger_item_content");if(!t||t.style.display==="none")return!0;let e=JSON.parse(JSON.stringify(r.triggers[n]));t.querySelectorAll(".aipkit_trigger_field[data-field]").forEach(a=>{let l=a.dataset.field,s=a.type==="checkbox"?a.checked:a.type==="number"?parseFloat(a.value)||0:a.value;window.aipkit_setNestedValue(e,l,s)}),e.conditions=[],t.querySelectorAll(".aipkit_condition_row").forEach(a=>{let l=a.querySelector(".aipkit_condition_type_select")?.value,s=a.querySelector(".aipkit_condition_field_select")?.value,p=a.querySelector(".aipkit_condition_operator_select")?.value,d=a.querySelector(".aipkit_condition_value_input"),u=d?.value;if(d?.type==="number"?u=parseFloat(u)||0:d?.type==="text"&&(p==="is_one_of"||p==="is_not_one_of")&&(u=u.split(",").map(g=>g.trim()).filter(g=>g!=="")),d?.style.display==="none"&&(u=void 0),l&&s&&p){let g={type:l,field:s,operator:p};u!==void 0&&(g.value=u),e.conditions.push(g)}});let c=t.querySelector(".aipkit_trigger_action_type_select");if(c&&(e.action.type=c.value),e.action&&e.action.type){e.action.payload={},t.querySelectorAll('.aipkit_action_payload_container .aipkit_trigger_field[data-field^="action.payload."').forEach(l=>{let s=l.dataset.field.substring(15),p=l.type==="checkbox"?l.checked:l.value;if(s==="headers"&&typeof p=="string")try{p=JSON.parse(p||"{}")}catch{p={}}(e.action.type==="store_form_submission"&&s==="log_message_format"||s&&s!=="elements")&&(e.action.payload[s]=p)}),e.action.type==="display_form"&&(e.action.payload.elements=[],t.querySelectorAll(".aipkit_form_element_editor_item").forEach(l=>{let s={};l.querySelectorAll(".aipkit_form_element_prop_change").forEach(p=>{let d=p.dataset.property,u=p.type==="checkbox"?p.checked:p.value;s[d]=u}),["dropdown","checkbox_group","radio_group"].includes(s.type)&&(s.options=[],l.querySelectorAll(".aipkit_form_element_option_row").forEach(p=>{let d=p.querySelector(".aipkit_element_option_value")?.value,u=p.querySelector(".aipkit_element_option_text")?.value;d!==void 0&&u!==void 0&&s.options.push({value:d,text:u})})),e.action.payload.elements.push(s)}));let a=t.querySelector('.aipkit_action_payload_container .aipkit_trigger_field[data-field="action.value"]');a?e.action.value=a.value:delete e.action.value}return r.triggers[n]=e,r.isDirty=!0,!0}window.aipkit_saveTriggerFromForm=_})();(function(){"use strict";let _;function i(o,r){clearTimeout(_),_=setTimeout(()=>{typeof window.aipkit_saveTriggerFromForm=="function"?window.aipkit_saveTriggerFromForm(o,r):console.error("DebouncedSave: aipkit_saveTriggerFromForm function not found.")},750)}window.aipkit_debouncedSave=i})();(function(){"use strict";function _(){let i=window.aipkit_getTriggerEventManagerState();if(!i){console.error("AIPKit AddNewTrigger: State not found.");return}let o=`trigger_${Date.now()}_${Math.random().toString(36).substring(2,7)}`,r=i.schemas?.EventSchema?.properties?.name?.enum[0]||"user_message_received",n=i.schemas?.ActionSchema?.properties?.type?.enum[0]||"bot_reply",t={id:o,name:"New Trigger",event_name:r,conditions:[],action:{type:n,payload:{}},priority:10,is_active:!0,description:""};i.triggers.push(t),i.isDirty=!0;let e=document.getElementById(`aipkit_trigger_list_for_${i.botId}`);if(!e){console.error("AIPKit AddNewTrigger: List container not found.");return}let c=e.querySelector(".aipkit_trigger_list_empty_message");if(c&&(c.style.display="none"),typeof window.aipkit_renderSingleTriggerItem=="function"){let a=window.aipkit_renderSingleTriggerItem(t);if(a)if(e.appendChild(a),typeof window.aipkit_toggleTriggerItemContent=="function"){window.aipkit_toggleTriggerItemContent(a,o,!0);let l=a.querySelector('input[data-field="name"]');l?l.focus():console.warn("AIPKit AddNewTrigger: Name input not found after expanding.")}else console.error("AIPKit AddNewTrigger: aipkit_toggleTriggerItemContent function not found.");else console.error("AIPKit AddNewTrigger: aipkit_renderSingleTriggerItem returned null.")}else console.error("AIPKit AddNewTrigger: aipkit_renderSingleTriggerItem function not found.")}window.aipkit_handleAddNewTrigger=_})();(function(){"use strict";function _(i,o,r=!1){let n=window.aipkit_getUIBuilderState(),t=window.aipkit_getTriggerEventManagerState();if(!n||!t){console.error("AIPKit ToggleContent: UI Builder or Event Manager State not found.");return}let e=i.querySelector(".aipkit_trigger_item_content"),c=i.querySelector(".aipkit_trigger_item_header");if(!e||!c){console.error("AIPKit ToggleContent: Content or header element not found.");return}let a=e.style.display==="block";if(r&&a&&t.editingTriggerId===o){let l=n.triggers.find(s=>s.id===o);l&&typeof window.aipkit_renderTriggerEditorForm=="function"&&window.aipkit_renderTriggerEditorForm(e,l);return}if(a&&!r)e.style.display="none",e.classList.remove("aipkit_expanded"),c.classList.remove("aipkit_expanded"),t.editingTriggerId===o&&(typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(o,i),t.editingTriggerId=null);else{let l=document.querySelector(`#aipkit_trigger_list_for_${n.botId} .aipkit_trigger_item_content.aipkit_expanded`);if(l&&l!==e){let s=l.closest(".aipkit_trigger_item");s&&s.dataset.triggerId&&(typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(s.dataset.triggerId,s),l.style.display="none",l.classList.remove("aipkit_expanded"),l.previousElementSibling?.classList.remove("aipkit_expanded"))}if(e.style.display="block",e.classList.add("aipkit_expanded"),c.classList.add("aipkit_expanded"),t.editingTriggerId=o,e.innerHTML.trim()===""||r){let s=n.triggers.find(p=>p.id===o);s&&typeof window.aipkit_renderTriggerEditorForm=="function"?window.aipkit_renderTriggerEditorForm(e,s):console.error("AIPKit ToggleContent: Trigger data or render function not found for form rendering.")}}}window.aipkit_toggleTriggerItemContent=_})();(function(){"use strict";function _(i){let o=window.aipkit_getTriggerEventManagerState();if(!o)return;let n=(window.aipkit_trigger_builder_config?.text||{}).confirmDeleteTrigger||`Are you sure you want to delete trigger ID: ${i}?`;if(!confirm(n))return;o.triggers=o.triggers.filter(c=>c.id!==i),o.isDirty=!0;let t=document.querySelector(`.aipkit_trigger_item[data-trigger-id="${i}"]`);t&&t.remove();let e=document.getElementById(`aipkit_trigger_list_for_${o.botId}`);if(e){let c=e.querySelector(".aipkit_trigger_list_empty_message");o.triggers.length===0&&c&&(c.style.display="block")}}window.aipkit_handleDeleteTrigger=_})();(function(){"use strict";function _(i){let o=window.aipkit_getTriggerEventManagerState();if(!o||!i)return;let r=i.querySelector(".aipkit_condition_rows_list");r&&typeof window.aipkit_renderConditionRow=="function"?(window.aipkit_renderConditionRow(r),o.isDirty=!0,typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(i.dataset.triggerId,i)):console.error("HandleAddCondition: Condition rows list or render function not found.")}window.aipkit_handleAddCondition=_})();(function(){"use strict";function _(i){let o=window.aipkit_getTriggerEventManagerState();if(!o||!i||!i.parentNode)return;let r=i.closest(".aipkit_trigger_item");i.remove(),o.isDirty=!0,r&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(r.dataset.triggerId,r)}window.aipkit_handleRemoveCondition=_})();(function(){"use strict";function _(i){let o=window.aipkit_getTriggerEventManagerState();if(!o||!i)return;let r=i.dataset.triggerId,n=o.triggers.findIndex(s=>s.id===r);if(n===-1)return;let t=o.triggers[n];if(t.action.type!=="display_form")return;(!t.action.payload.elements||!Array.isArray(t.action.payload.elements))&&(t.action.payload.elements=[]);let e=t.action.payload.elements.length,a={id:`field_${Date.now()}_${e}`,type:"text_input",label:"New Field",placeholder:"",required:!1,default_value:"",help_text:""};t.action.payload.elements.push(a),o.isDirty=!0;let l=i.querySelector(".aipkit_form_elements_list");if(l&&typeof window.aipkit_renderFormElementEditorItem=="function"){let s=window.aipkit_renderFormElementEditorItem(a,e,t.action.payload.form_id);if(s){l.appendChild(s);let p=s.querySelector(".aipkit_form_element_editor_content");p&&(p.style.display="block",p.classList.add("aipkit_expanded"));let d=s.querySelector('input[data-property="id"]');d&&d.focus()}typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(r,i)}}window.aipkit_handleAddFormElement=_})();(function(){"use strict";function _(i){let o=window.aipkit_getTriggerEventManagerState();if(!o||!i||!i.parentNode)return;let r=i.closest(".aipkit_trigger_item");if(!r)return;let n=r.dataset.triggerId,t=o.triggers.findIndex(a=>a.id===n);if(t===-1)return;let e=parseInt(i.dataset.elementIndex,10);if(isNaN(e))return;let c=o.triggers[t];if(c.action.type==="display_form"&&c.action.payload.elements&&e>=0&&e<c.action.payload.elements.length){c.action.payload.elements.splice(e,1),o.isDirty=!0,i.remove();let a=r.querySelector(".aipkit_form_elements_list");a&&a.querySelectorAll(".aipkit_form_element_editor_item").forEach((l,s)=>{l.dataset.elementIndex=s,l.querySelectorAll(".aipkit_element_option_value, .aipkit_element_option_text").forEach(p=>{let d=p.dataset.prop.split(".")[1];p.dataset.property=`options[${optionRow.dataset.optionIndex}].${d}`})}),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(n,r)}}window.aipkit_handleRemoveFormElement=_})();(function(){"use strict";function _(i){let o=window.aipkit_getTriggerEventManagerState();if(!o)return;let r=i.target,n=r.dataset.property;if(!n)return;let t=r.closest(".aipkit_form_element_editor_item"),e=r.closest(".aipkit_trigger_item");if(!t||!e)return;let c=e.dataset.triggerId,a=parseInt(t.dataset.elementIndex,10);if(isNaN(a))return;let l=o.triggers.findIndex(g=>g.id===c);if(l===-1)return;let s=o.triggers[l];if(s.action.type!=="display_form"||!s.action.payload.elements||a<0||a>=s.action.payload.elements.length)return;let p=s.action.payload.elements[a],d=r.type==="checkbox"?r.checked:r.value,u=n.match(/^options\[(\d+)\]\.(value|text)$/);if(u){let g=parseInt(u[1],10),m=u[2];p.options||(p.options=[]),p.options[g]||(p.options[g]={}),p.options[g][m]=d}else p[n]=d;if(o.isDirty=!0,n==="type"){let g=t.querySelector(".aipkit_element_type_badge").textContent.toLowerCase().replace(" ","_");if(e.querySelector(".aipkit_action_payload_container")&&typeof window.aipkit_renderActionPayloadFields=="function"){let f=window.aipkit_renderFormElementEditorItem(p,a,s.action.payload.form_id);if(f&&t.parentNode){t.parentNode.replaceChild(f,t);let w=f.querySelector(".aipkit_form_element_editor_content");w&&(w.style.display="block",w.classList.add("aipkit_expanded"))}}}else if(n==="label"||n==="id"){let g=t.querySelector(".aipkit_form_element_editor_title");g&&(g.innerHTML=`${window.aipkit_escapeHtml(p.label||p.id||"New Element")} <span class="aipkit_element_type_badge">${window.aipkit_escapeHtml(p.type||"text_input")}</span> <span class="aipkit_element_id_badge">${p.id?window.aipkit_escapeHtml(p.id):""}</span>`)}typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(c,e)}window.aipkit_handleFormElementPropertyChange=_})();(function(){"use strict";function _(i){if(!window.aipkit_getTriggerEventManagerState())return;let r=i.target,n=r.closest(".aipkit_trigger_item");if(!n)return;let t=n.dataset.triggerId;t&&(r.closest(".aipkit_trigger_item_header")&&!r.closest(".aipkit_trigger_item_actions button, .aipkit_trigger_is_active_toggle input")?typeof window.aipkit_toggleTriggerItemContent=="function"&&window.aipkit_toggleTriggerItemContent(n,t):r.closest(".aipkit_trigger_edit_btn")?typeof window.aipkit_toggleTriggerItemContent=="function"&&window.aipkit_toggleTriggerItemContent(n,t,!0):r.closest(".aipkit_trigger_delete_btn")?typeof window.aipkit_handleDeleteTrigger=="function"&&window.aipkit_handleDeleteTrigger(t):r.closest(".aipkit_trigger_add_condition_btn")?typeof window.aipkit_handleAddCondition=="function"&&window.aipkit_handleAddCondition(n):r.closest(".aipkit_condition_remove_btn")&&typeof window.aipkit_handleRemoveCondition=="function"&&window.aipkit_handleRemoveCondition(r.closest(".aipkit_condition_row")))}window.aipkit_handleListContainerClick=_})();(function(){"use strict";function _(i){let o=window.aipkit_getTriggerEventManagerState();if(!o)return;let r=i.target,n=r.closest(".aipkit_trigger_item");if(!n)return;let t=n.dataset.triggerId;if(t)if(r.matches(".aipkit_trigger_is_active_checkbox"))typeof window.aipkit_updateTriggerData=="function"&&window.aipkit_updateTriggerData(t,"is_active",r.checked);else if(r.matches(".aipkit_condition_type_select")){let e=r.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionFields=="function"&&window.aipkit_updateConditionFields(r,e.querySelector(".aipkit_condition_field_select"),e.querySelector(".aipkit_condition_operator_select"),e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,n)}else if(r.matches(".aipkit_condition_field_select")){let e=r.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionOperators=="function"&&window.aipkit_updateConditionOperators(r,e.querySelector(".aipkit_condition_operator_select"),e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,n)}else if(r.matches(".aipkit_condition_operator_select")){let e=r.closest(".aipkit_condition_row");e&&typeof window.aipkit_updateConditionValueInput=="function"&&window.aipkit_updateConditionValueInput(r,e.querySelector(".aipkit_condition_value_input")),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,n)}else if(r.matches(".aipkit_trigger_action_type_select")){let e=n.querySelector(".aipkit_action_payload_container"),c=o.triggers.find(a=>a.id===t);e&&typeof window.aipkit_renderActionPayloadFields=="function"&&window.aipkit_renderActionPayloadFields(e,r.value,c?.action?.payload,c?.action?.value),typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,n)}else r.matches(".aipkit_trigger_field")&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(t,n)}window.aipkit_handleListContainerChange=_})();(function(){"use strict";function _(i){if(!window.aipkit_getTriggerEventManagerState())return;let r=i.target,n=r.closest(".aipkit_trigger_item");if(!n)return;let t=n.dataset.triggerId;if(t)if(r.matches('input[data-field="name"]')){let e=n.querySelector(".aipkit_trigger_item_name_display");e&&(e.textContent=r.value||"Unnamed Trigger"),typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(t,n)}else r.matches(".aipkit_trigger_field")&&typeof window.aipkit_debouncedSave=="function"&&window.aipkit_debouncedSave(t,n)}window.aipkit_handleListContainerInput=_})();(function(){"use strict";function _(i){let o=document.getElementById(`aipkit_trigger_builder_${i}`);if(!o){console.warn(`InitEventListeners: Builder container for bot ${i} not found.`);return}if(o.dataset.eventManagerInitialized==="true")return;let r=o.querySelector(".aipkit_trigger_add_new_btn");r&&typeof window.aipkit_handleAddNewTrigger=="function"?r.addEventListener("click",window.aipkit_handleAddNewTrigger):r&&console.error("InitEventListeners: aipkit_handleAddNewTrigger function not found.");let n=o.querySelector(".aipkit_trigger_list_container");n?(typeof window.aipkit_handleListContainerClick=="function"?n.addEventListener("click",window.aipkit_handleListContainerClick):console.error("InitEventListeners: aipkit_handleListContainerClick function not found."),typeof window.aipkit_handleListContainerChange=="function"?n.addEventListener("change",window.aipkit_handleListContainerChange):console.error("InitEventListeners: aipkit_handleListContainerChange function not found."),typeof window.aipkit_handleListContainerInput=="function"?n.addEventListener("input",window.aipkit_handleListContainerInput):console.error("InitEventListeners: aipkit_handleListContainerInput function not found."),n.addEventListener("click",function(t){let e=t.target.closest(".aipkit_form_add_element_btn"),c=t.target.closest(".aipkit_form_element_remove_btn"),a=t.target.closest(".aipkit_form_add_option_btn"),l=t.target.closest(".aipkit_form_option_remove_btn");if(e){let s=e.closest(".aipkit_trigger_item");s&&typeof window.aipkit_handleAddFormElement=="function"&&window.aipkit_handleAddFormElement(s)}else if(c){let s=c.closest(".aipkit_form_element_editor_item");s&&typeof window.aipkit_handleRemoveFormElement=="function"&&window.aipkit_handleRemoveFormElement(s)}else if(a){let s=a.closest(".aipkit_form_element_options_editor"),p=s.closest(".aipkit_trigger_item"),d=s.closest(".aipkit_form_element_editor_item");if(s&&p&&d&&typeof window.aipkit_saveTriggerFromForm=="function"&&typeof window.aipkit_updateFormElementOptionControls=="function"){let u=window.aipkit_getTriggerEventManagerState(),g=p.dataset.triggerId,m=parseInt(d.dataset.elementIndex,10),f=u.triggers.find(w=>w.id===g);f&&f.action.payload.elements[m]&&(f.action.payload.elements[m].options||(f.action.payload.elements[m].options=[]),f.action.payload.elements[m].options.push({value:"",text:""}),u.isDirty=!0,window.aipkit_updateFormElementOptionControls(s,f.action.payload.elements[m].options),window.aipkit_saveTriggerFromForm(g,p))}}else if(l){let s=l.closest(".aipkit_form_element_option_row"),p=l.closest(".aipkit_form_element_options_editor"),d=p.closest(".aipkit_trigger_item"),u=p.closest(".aipkit_form_element_editor_item");if(s&&p&&d&&u&&typeof window.aipkit_saveTriggerFromForm=="function"&&typeof window.aipkit_updateFormElementOptionControls=="function"){let g=parseInt(s.dataset.optionIndex,10),m=window.aipkit_getTriggerEventManagerState(),f=d.dataset.triggerId,w=parseInt(u.dataset.elementIndex,10),b=m.triggers.find(E=>E.id===f);b&&b.action.payload.elements[w]&&b.action.payload.elements[w].options[g]!==void 0&&(b.action.payload.elements[w].options.splice(g,1),m.isDirty=!0,window.aipkit_updateFormElementOptionControls(p,b.action.payload.elements[w].options),window.aipkit_saveTriggerFromForm(f,d))}}}),n.addEventListener("change",function(t){let e=t.target;e.matches&&(e.matches(".aipkit_form_element_prop_change")||e.closest(".aipkit_form_element_option_row input"))&&typeof window.aipkit_handleFormElementPropertyChange=="function"&&window.aipkit_handleFormElementPropertyChange(t)}),n.addEventListener("input",function(t){let e=t.target;e.matches&&(e.matches(".aipkit_form_element_prop_change")||e.closest(".aipkit_form_element_option_row input"))&&typeof window.aipkit_handleFormElementPropertyChange=="function"&&(clearTimeout(e.aipkitDebounceTimeout),e.aipkitDebounceTimeout=setTimeout(()=>{window.aipkit_handleFormElementPropertyChange(t)},500))})):console.warn(`InitEventListeners: List container not found for bot ${i}.`),o.dataset.eventManagerInitialized="true"}window.aipkit_initTriggerBuilderEventListeners=_})();(function(){"use strict";let _={};function i(r){if(!r){console.error("AIPKit Trigger Main: Bot ID is required to initialize UI.");return}let n=document.getElementById(`aipkit_trigger_builder_${r}`);if(!n){console.error(`AIPKit Trigger Main: Builder container for bot ${r} not found.`);return}if(n.dataset.triggerUiInitialized==="true")return;let t=["aipkit_loadInitialTriggers","aipkit_loadTriggerSchemas","aipkit_initTriggerBuilderState","aipkit_setTriggerBuilderState","aipkit_setTriggerEventManagerState","aipkit_renderTriggerList","aipkit_initTriggerBuilderEventListeners","aipkit_renderFormElementEditorItem","aipkit_updateFormElementOptionControls","aipkit_handleAddFormElement","aipkit_handleRemoveFormElement","aipkit_handleFormElementPropertyChange"],e=!1;if(t.forEach(p=>{typeof window[p]!="function"&&(console.error(`AIPKit Trigger Main: CRITICAL DEPENDENCY MISSING -> ${p}. Check script loading and function names.`),e=!0)}),e){n.innerHTML='<p style="color:red;">Error: Trigger UI components failed to load. Check console for details.</p>';return}let c=window.aipkit_loadInitialTriggers(r),a=window.aipkit_loadTriggerSchemas(r);(!a||Object.keys(a).length===0)&&console.error(`AIPKit Trigger Main: Trigger schemas not loaded for bot ${r}.`);let l=window.aipkit_initTriggerBuilderState(r,c,a);_[r]=l,window.aipkit_setTriggerBuilderState(l),window.aipkit_setTriggerEventManagerState(l),window.aipkit_renderTriggerList(),window.aipkit_initTriggerBuilderEventListeners(r),n.dataset.triggerUiInitialized="true";let s=n.closest("form.aipkit_chatbot_settings_form");s?s.dataset.triggerSaveListenerAttached||(s.addEventListener("submit",function(p){let d=window.aipkit_getTriggerBuilderState(r);if(d){let u=window.aipkit_getTriggerEventManagerState();if(u&&u.editingTriggerId){let g=document.querySelector(`.aipkit_trigger_item[data-trigger-id="${u.editingTriggerId}"]`);g&&typeof window.aipkit_saveTriggerFromForm=="function"&&window.aipkit_saveTriggerFromForm(u.editingTriggerId,g)}typeof window.aipkit_updateTriggersJsonForSave=="function"?window.aipkit_updateTriggersJsonForSave(r,d.triggers):console.error("AIPKit Trigger Main: aipkit_updateTriggersJsonForSave is not defined. Triggers JSON might not be saved correctly.")}}),s.dataset.triggerSaveListenerAttached="true"):console.warn(`AIPKit Trigger Main: Could not find parent form for bot ${r} to attach pre-save hook.`)}function o(r){return _[r]||null}window.aipkit_initTriggerBuilderUI=i,window.aipkit_getTriggerBuilderState=o})();(function(){"use strict";function _(r){if(!r)return;let n=r.querySelector(".aipkit_enable_realtime_voice_toggle"),t=r.querySelector(".aipkit_realtime_voice_settings_container");if(!n||!t)return;let e=n.checked;t.style.display=e?"block":"none",typeof i=="function"&&i(r)}function i(r){if(!r)return;let n=r.querySelector(".aipkit_enable_realtime_voice_toggle"),t=r.querySelector('input[name="direct_voice_mode"]'),e=t?t.closest(".aipkit_form-group"):null,c=r.closest(".aipkit_chatbot-settings-area"),a=c?c.querySelector('input[name="popup_enabled"]'):null;if(!n||!t||!e||!a)return;let l=n.checked,s=a.checked,p=l&&s,d=e.getAttribute("data-tooltip-disabled")||"";p?(t.disabled=!1,e.removeAttribute("title"),e.classList.remove("aipkit-disabled-tooltip")):(t.checked&&(t.checked=!1,t.dispatchEvent(new Event("change",{bubbles:!0}))),t.disabled=!0,e.setAttribute("title",d),e.classList.add("aipkit-disabled-tooltip"))}function o(){let r=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!r)return;let n="data-realtime-voice-ui-listener-attached";r.getAttribute(n)||(r.addEventListener("change",function(t){let e=t.target,c=e.closest(".aipkit_chatbot-settings-area");if(c){if(e.matches&&e.matches(".aipkit_enable_realtime_voice_toggle")){let a=e.closest(".aipkit_accordion-content");a&&_(a)}else if(e.matches&&e.matches('input[name="popup_enabled"]')){let a=c.querySelector('.aipkit_accordion[data-section="voice-agent"] .aipkit_accordion-content');a&&i(a)}}}),r.setAttribute(n,"true"),r.querySelectorAll('.aipkit_accordion[data-section="voice-agent"] .aipkit_accordion-content').forEach(t=>{_(t)}))}window.aipkit_initRealtimeVoiceAgentUI=o,window.aipkit_updateDirectVoiceModeState=i})();(function(){"use strict";function _(){let i=document.getElementById("aipkit_chatbot_main_tab_content_container");if(!i)return;let o="data-embed-copy-listener-attached";i.getAttribute(o)||(i.setAttribute(o,"true"),i.addEventListener("click",function(r){let n=r.target.closest(".aipkit_copy_embed_code_btn");if(!n)return;let t=n.dataset.target;if(!t)return;let e=document.getElementById(t);if(e){let c=e.value;typeof window.aipkit_copyShortcode=="function"?window.aipkit_copyShortcode(c,n):(console.error("AIPKit Embed: copyShortcode utility not found."),alert("Could not copy code."))}}))}window.aipkit_initEmbedCodeCopy=_})();(function(){"use strict";let _,i=window.aipkit_escapeHtml||function(t){return t};function o(t,e,c="",a="",l=""){if(!t)return;let s=t.querySelector(".aipkit_gsheets_indicator"),p=t.querySelector(".aipkit_gsheets_file_display"),d=t.querySelector(".aipkit_gsheets_shortcut_link_wrapper"),u=t.querySelector(".aipkit_gsheets_shortcut_link");if(!s||!p)return;let g=(window.aipkit_cw_pro_config||{}).gsheets_text||{};switch(s.innerHTML="",s.className="aipkit_gsheets_indicator",d&&(d.style.display="none"),p.style.display="none",e){case"verifying":s.innerHTML=`<span class="aipkit_spinner" style="display:inline-block; width:14px; height:14px; border-width:2px; vertical-align:middle; margin-right:4px;"></span> ${g.verifying||"Verifying..."}`,s.classList.add("aipkit_gsheets_indicator--verifying");break;case"success":s.innerHTML=`<span class="dashicons dashicons-yes-alt" style="color:green;"></span> ${g.accessible||"Accessible"}`,s.classList.add("aipkit_gsheets_indicator--success"),p&&l&&(p.innerHTML=`<span>${i(l)}</span> <span class="dashicons dashicons-yes-alt"></span>`,p.style.display="inline-block"),d&&u&&a&&(u.href=`https://docs.google.com/spreadsheets/d/${encodeURIComponent(a)}/edit`,d.style.display="block");break;case"loaded":s.innerHTML="",p&&l&&(p.innerHTML=`<span>${i(l)}</span> <span class="dashicons dashicons-yes-alt"></span>`,p.style.display="inline-block");break;case"error":s.innerHTML=`<span class="dashicons dashicons-warning" style="color:red;"></span> ${g.error_prefix||"Error:"} ${i(c)}`,s.classList.add("aipkit_gsheets_indicator--error");break;case"clear":default:s.innerHTML="",p.innerHTML="",p.style.display="none";break}}async function r(t){if(!t)return;let e=t.querySelector(".aipkit_gsheets_sheet_id_input"),c=t.querySelector(".aipkit_gsheets_credentials_hidden_input"),a=(window.aipkit_cw_pro_config||{}).gsheets_text||{},l=e?e.value.trim():"",s=c?c.value.trim():"";if(!l||!s){o(t,"clear");return}let p=c.dataset.filename||"credentials.json";o(t,"verifying");try{let d=document.getElementById("aipkit_content_writer_nonce"),u=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,g=d?d.value:u;if(!g)throw new Error("Security token could not be found.");await window.aipkit_apiRequest("aipkit_content_writer_verify_gsheets",{gsheets_sheet_id:l,gsheets_credentials:s,_ajax_nonce:g}),o(t,"success","Connection successful.",l,p)}catch(d){o(t,"error",d.message||a.invalid_creds||"Invalid credentials or sheet not shared.")}}function n(){if(!window.aipkit_dashboard||!window.aipkit_dashboard.isProPlan)return;let t=document.getElementById("aipkit_module-container");if(!t)return;let e="data-gsheets-listener-attached";t.getAttribute(e)||(t.addEventListener("input",c=>{if(c.target.matches(".aipkit_gsheets_sheet_id_input")){clearTimeout(_);let a=c.target.closest(".aipkit_gsheets_section_container");_=setTimeout(()=>r(a),1e3)}}),t.addEventListener("change",c=>{if(c.target.matches(".aipkit_gsheets_credentials_file_input")){let a=c.target,l=a.closest(".aipkit_gsheets_section_container");if(!l)return;let s=l.querySelector(".aipkit_gsheets_credentials_hidden_input");if(!s)return;let p=a.files[0];if(!p){s.value="",delete s.dataset.filename,o(l,"clear");return}let d=new FileReader;d.onload=function(u){s.value=u.target.result,s.dataset.filename=p.name,clearTimeout(_),r(l)},d.onerror=function(){console.error("Error reading file."),o(l,"error","Could not read the selected file.")},d.readAsText(p)}}),t.setAttribute(e,"true"),document.querySelectorAll(".aipkit_gsheets_section_container").forEach(c=>{let a=c.querySelector(".aipkit_gsheets_credentials_hidden_input");a&&a.value.trim()!==""&&(a.dataset.filename="credentials.json",r(c))}))}window.aipkit_initGsheetsVerification=n,window.aipkit_verifyGSheetsCredentials=r,window.aipkit_setGsheetsIndicator=o})();(function(){"use strict";function _(){let i=document.getElementById("aipkit_cw_test_scrape_btn"),o=document.getElementById("aipkit_cw_url_list"),r=document.getElementById("aipkit_cw_scrape_results_wrapper"),n=document.getElementById("aipkit_cw_scrape_results");!i||!o||!r||!n||i.addEventListener("click",async()=>{let t=o.value.trim().split(`
`),e=t[0]?t[0].trim():"";if(!e){r.style.display="block",n.textContent="Please enter at least one URL to test.";return}r.style.display="block",n.textContent="Scraping...",typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!0,"Test Scrape","Scraping...");try{let c=document.getElementById("aipkit_content_writer_nonce"),a=(window.aipkit_automated_tasks_config||{}).nonce_manage_tasks,l=c?c.value:a;if(!l)throw new Error("Security token could not be found.");let s=await window.aipkit_apiRequest("aipkit_content_writer_scrape_url",{url:e,_ajax_nonce:l});n.textContent=s.scraped_text||"No text could be extracted."}catch(c){n.textContent=`Error: ${c.message||"Failed to scrape URL."}`,console.error("URL Scrape Error:",c)}finally{typeof window.aipkit_setLoadingStateOpenAI=="function"&&window.aipkit_setLoadingStateOpenAI(i,!1,"Test First URL")}})}window.aipkit_initUrlScrapeHandler=_})();(function(){"use strict";let _=window.aipkit_escapeHtml||(n=>n);function i(n,t){let e=window.aipkit_automated_tasks_config||{},c,a,l,s,p;n==="openai"?(c=t.querySelector("#aipkit_task_ce_openai_vector_store_ids"),a=e.openai_vector_stores||[],l="id",s="name",p="No OpenAI stores found."):n==="pinecone"?(c=t.querySelector("#aipkit_task_ce_pinecone_index_name"),a=e.pinecone_indexes||[],l="name",s="name",p="No Pinecone indexes found."):n==="qdrant"&&(c=t.querySelector("#aipkit_task_ce_qdrant_collection_name"),a=e.qdrant_collections||[],l="name",s="name",p="No Qdrant collections found."),c&&(c.innerHTML="",a.length>0?(c.multiple?a.forEach(d=>{c.add(new Option(_(d[s]),d[l]))}):(c.add(new Option("-- Select --","")),a.forEach(d=>{c.add(new Option(_(d[s]),d[l]))})),c.disabled=!1):(c.add(new Option(p,"")),c.disabled=!0))}function o(n,t){let e=t.querySelector("#aipkit_task_ce_vector_embedding_model");if(!e)return;let c=window.aipkit_automated_tasks_config||{},a=n==="google"?c.google_embedding_models||[]:c.openai_embedding_models||[];e.innerHTML="",a.length>0?(e.add(new Option("-- Select Model --","")),a.forEach(l=>{e.add(new Option(_(l.name||l.id),l.id))}),e.disabled=!1):(e.add(new Option("No models found","")),e.disabled=!0)}function r(n){let t=document.getElementById("aipkit_automated_task_form");if(!t)return;let e=document.getElementById("aipkit_task_ce_post_types");e&&(Array.from(e.options).forEach(k=>k.selected=!1),(n.post_types||[]).forEach(k=>{let v=e.querySelector(`option[value="${k}"]`);v&&(v.selected=!0)}));let c=document.getElementById("aipkit_task_ce_post_categories");c&&(Array.from(c.options).forEach(k=>k.selected=!1),(n.post_categories||[]).forEach(k=>{let v=c.querySelector(`option[value="${k}"]`);v&&(v.selected=!0)}));let a=document.getElementById("aipkit_task_ce_post_authors");a&&(Array.from(a.options).forEach(k=>k.selected=!1),(n.post_authors||[]).forEach(k=>{let v=a.querySelector(`option[value="${k}"]`);v&&(v.selected=!0)}));let l=document.getElementById("aipkit_task_ce_post_status");l&&(Array.from(l.options).forEach(k=>k.selected=!1),(n.post_statuses||["publish"]).forEach(k=>{let v=l.querySelector(`option[value="${k}"]`);v&&(v.selected=!0)}));let s=document.getElementById("aipkit_task_ce_update_title");s&&(s.checked=n.update_title==="1");let p=document.getElementById("aipkit_task_ce_update_excerpt");p&&(p.checked=n.update_excerpt==="1");let d=document.getElementById("aipkit_task_ce_update_content");d&&(d.checked=n.update_content==="1");let u=document.getElementById("aipkit_task_ce_update_meta");u&&(u.checked=n.update_meta==="1");let g=document.getElementById("aipkit_task_ce_enhance_existing_now_flag");g&&(g.checked=n.enhance_existing_now_flag==="1"),typeof window.aipkit_initContentEnhancementTaskFormUI=="function"&&setTimeout(()=>window.aipkit_initContentEnhancementTaskFormUI(),0);let m=document.getElementById("aipkit_task_ce_title_prompt");m&&(m.value=n.title_prompt||"");let f=document.getElementById("aipkit_task_ce_excerpt_prompt");f&&(f.value=n.excerpt_prompt||"");let w=document.getElementById("aipkit_task_ce_content_prompt");w&&(w.value=n.content_prompt||"");let b=document.getElementById("aipkit_task_ce_meta_prompt");b&&(b.value=n.meta_prompt||"");let E=document.getElementById("aipkit_task_ce_ai_provider"),I=document.getElementById("aipkit_task_ce_ai_model");E&&I&&(E.value=n.ai_provider?n.ai_provider.toLowerCase():"openai",window.aipkit_automated_tasks_form_state&&n.ai_model&&(window.aipkit_automated_tasks_form_state.pendingModelSelection=n.ai_model),typeof window.aipkit_task_ce_populateModels=="function"&&window.aipkit_task_ce_populateModels(E,I));let x=document.getElementById("aipkit_task_ce_ai_temperature");if(x){x.value=n.ai_temperature||1;let k=document.getElementById(x.id+"_value");k&&(k.textContent=x.value)}let C=document.getElementById("aipkit_task_ce_content_max_tokens");if(C){C.value=n.content_max_tokens||4e3;let k=document.getElementById(C.id+"_value");k&&(k.textContent=C.value)}let F=t.elements.ce_reasoning_effort;F&&(F.value=n.reasoning_effort||"low"),I&&typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&setTimeout(()=>I.dispatchEvent(new Event("change",{bubbles:!0})),100),t.elements.task_frequency&&(t.elements.task_frequency.value=n.task_frequency||"daily");let y=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_knowledge_base"]');if(y){let k=y.querySelector("#aipkit_task_ce_enable_vector_store"),v=y.querySelector(".aipkit_task_ce_vector_store_settings_container");if(k&&v){let h=n.enable_vector_store==="1";k.checked=h,v.style.display=h?"block":"none"}if(n.enable_vector_store==="1"){let h=n.vector_store_provider||"openai",q=y.querySelector("#aipkit_task_ce_vector_store_provider");q&&(q.value=h);let $=y.querySelector("#aipkit_task_ce_vector_store_top_k");$&&($.value=n.vector_store_top_k||"3");let A=y.querySelector(".aipkit_task_ce_vector_openai_field"),L=y.querySelector(".aipkit_task_ce_vector_pinecone_field"),M=y.querySelector(".aipkit_task_ce_vector_qdrant_field"),B=y.querySelector(".aipkit_task_ce_vector_embedding_config_row");if(A&&(A.style.display=h==="openai"?"block":"none"),L&&(L.style.display=h==="pinecone"?"block":"none"),M&&(M.style.display=h==="qdrant"?"block":"none"),B&&(B.style.display=h==="pinecone"||h==="qdrant"?"block":"none"),i(h,y),h==="openai"){let S=y.querySelector("#aipkit_task_ce_openai_vector_store_ids");S&&Array.isArray(n.openai_vector_store_ids)&&Array.from(S.options).forEach(T=>{T.selected=n.openai_vector_store_ids.includes(T.value)})}else if(h==="pinecone"){let S=y.querySelector("#aipkit_task_ce_pinecone_index_name");S&&(S.value=n.pinecone_index_name||"")}else if(h==="qdrant"){let S=y.querySelector("#aipkit_task_ce_qdrant_collection_name");S&&(S.value=n.qdrant_collection_name||"")}if(h==="pinecone"||h==="qdrant"){let S=n.vector_embedding_provider||"openai",T=y.querySelector("#aipkit_task_ce_vector_embedding_provider"),P=y.querySelector("#aipkit_task_ce_vector_embedding_model");T&&(T.value=S),o(S,y),P&&n.vector_embedding_model&&(P.value=n.vector_embedding_model)}}}}window.aipkit_form_populateContentEnhancementFields=r})();(function(){"use strict";function _(){let i=document.getElementById("aipkit_automated_task_form"),o=window.aipkit_dashboard||{};if(!i)return;let r=document.getElementById("aipkit_task_ce_ai_provider"),n=document.getElementById("aipkit_task_ce_ai_model"),t=i.elements.ce_reasoning_effort;if(r&&n){let a=(o.main_provider||"openai").toLowerCase();if(r.value=a,typeof window.aipkit_task_ce_populateModels=="function"){window.aipkit_task_ce_populateModels(r,n);let l="",s=o?.models?.[a];switch(a){case"openai":l="gpt-4o-mini";break;case"google":l="gemini-1.5-flash-latest";break;case"openrouter":l="anthropic/claude-3.5-sonnet";break;case"azure":case"deepseek":Array.isArray(s)&&s.length>0&&(l=s[0].id||"");break}n.querySelector(`option[value="${CSS.escape(l)}"]`)?n.value=l:console.warn(`Default model ${l} not found for provider ${a}.`),n.dispatchEvent(new Event("change",{bubbles:!0}))}}t&&(t.value="low");let e=i.querySelector("#aipkit_task_ce_content_max_tokens"),c=i.querySelector("#aipkit_task_ce_content_max_tokens_value");if(e&&c){let a="4000";e.value=a,c.textContent=a}}window.aipkit_form_setContentEnhancementDefaults=_})();(function(){"use strict";function _(i,o){if(i.task_type==="enhance_existing_content"){let r={ce_ai_provider:"ai_provider",ce_ai_model:"ai_model",ce_ai_temperature:"ai_temperature",ce_content_max_tokens:"content_max_tokens",ce_reasoning_effort:"reasoning_effort",ce_title_prompt:"title_prompt",ce_excerpt_prompt:"excerpt_prompt",ce_content_prompt:"content_prompt",ce_meta_prompt:"meta_prompt",ce_vector_store_provider:"vector_store_provider",ce_vector_store_top_k:"vector_store_top_k",ce_pinecone_index_name:"pinecone_index_name",ce_qdrant_collection_name:"qdrant_collection_name",ce_vector_embedding_provider:"vector_embedding_provider",ce_vector_embedding_model:"vector_embedding_model"};for(let[t,e]of Object.entries(r))i[t]!==void 0&&(i[e]=i[t],delete i[t]);i.post_types=o.getAll("ce_post_types[]"),i.post_categories=o.getAll("ce_post_categories[]"),i.post_authors=o.getAll("ce_post_authors[]"),i.post_statuses=o.getAll("ce_post_statuses[]"),i.openai_vector_store_ids=o.getAll("ce_openai_vector_store_ids[]"),i.update_title=o.has("ce_update_title")?"1":"0",i.update_excerpt=o.has("ce_update_excerpt")?"1":"0",i.update_content=o.has("ce_update_content")?"1":"0",i.update_meta=o.has("ce_update_meta")?"1":"0",i.enhance_existing_now_flag=o.has("ce_enhance_existing_now_flag")?"1":"0",i.enable_vector_store=o.has("ce_enable_vector_store")?"1":"0",delete i["ce_post_types[]"],delete i["ce_post_categories[]"],delete i["ce_post_authors[]"],delete i["ce_post_statuses[]"],delete i["ce_openai_vector_store_ids[]"],delete i.ce_update_title,delete i.ce_update_excerpt,delete i.ce_update_content,delete i.ce_update_meta,delete i.ce_enhance_existing_now_flag,delete i.ce_enable_vector_store,["post_types[]","index_existing_now_flag","only_new_updated_flag","target_store_provider","target_store_id","embedding_provider","embedding_model","content_title_bulk","content_keywords","post_type","post_author","post_status","post_schedule_date","post_schedule_time","post_categories","post_categories[]","prompt_mode","custom_title_prompt","custom_content_prompt","generate_meta_description","custom_meta_prompt","generate_focus_keyword","custom_keyword_prompt","cw_generation_mode","rss_feeds","rss_include_keywords","rss_exclude_keywords","gsheets_sheet_id","gsheets_credentials","url_list","content_title","generate_toc","generate_images_enabled","image_provider","image_model","image_prompt","image_count","image_placement","image_placement_param_x","image_alignment","image_size","generate_featured_image","featured_image_prompt","pexels_orientation","pexels_size","pexels_color","pixabay_orientation","pixabay_image_type","pixabay_category","openai_vector_store_ids[]","csv_file_input"].forEach(t=>delete i[t])}return i}window.aipkit_save_task_handleContentEnhancement=_})();(function(){"use strict";let _=window.aipkit_escapeHtml||(t=>t);function i(t,e){let c=window.aipkit_automated_tasks_config||{},a,l,s,p,d;t==="openai"?(a=e.querySelector("#aipkit_task_ce_openai_vector_store_ids"),l=c.openai_vector_stores||[],s="id",p="name",d="No OpenAI stores found."):t==="pinecone"?(a=e.querySelector("#aipkit_task_ce_pinecone_index_name"),l=c.pinecone_indexes||[],s="name",p="name",d="No Pinecone indexes found."):t==="qdrant"&&(a=e.querySelector("#aipkit_task_ce_qdrant_collection_name"),l=c.qdrant_collections||[],s="name",p="name",d="No Qdrant collections found."),a&&(a.innerHTML="",l.length>0?(a.multiple?l.forEach(u=>{a.add(new Option(_(u[p]),u[s]))}):(a.add(new Option("-- Select --","")),l.forEach(u=>{a.add(new Option(_(u[p]),u[s]))})),a.disabled=!1):(a.add(new Option(d,"")),a.disabled=!0))}function o(t,e){let c=e.querySelector("#aipkit_task_ce_vector_embedding_model");if(!c)return;let a=window.aipkit_automated_tasks_config||{},l=t==="google"?a.google_embedding_models||[]:a.openai_embedding_models||[];c.innerHTML="",l.length>0?(c.add(new Option("-- Select Model --","")),l.forEach(s=>{c.add(new Option(_(s.name||s.id),s.id))}),c.disabled=!1):(c.add(new Option("No models found","")),c.disabled=!0)}function r(t,e){let c=e.querySelector(".aipkit_task_ce_vector_openai_field"),a=e.querySelector(".aipkit_task_ce_vector_pinecone_field"),l=e.querySelector(".aipkit_task_ce_vector_qdrant_field"),s=e.querySelector(".aipkit_task_ce_vector_embedding_config_row");c&&(c.style.display="none"),a&&(a.style.display="none"),l&&(l.style.display="none"),s&&(s.style.display="none"),t==="openai"&&c?(c.style.display="block",i("openai",e)):t==="pinecone"&&a&&s?(a.style.display="block",s.style.display="block",i("pinecone",e),o(e.querySelector("#aipkit_task_ce_vector_embedding_provider").value,e)):t==="qdrant"&&l&&s&&(l.style.display="block",s.style.display="block",i("qdrant",e),o(e.querySelector("#aipkit_task_ce_vector_embedding_provider").value,e))}function n(){let t=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_knowledge_base"]');if(!t||t.dataset.kbListenerAttached)return;let e=t.querySelector(".aipkit_task_ce_vector_store_toggle"),c=t.querySelector(".aipkit_task_ce_vector_store_settings_container"),a=t.querySelector(".aipkit_task_ce_vector_store_provider_select"),l=t.querySelector(".aipkit_task_ce_vector_embedding_provider_select");e&&c&&e.addEventListener("change",()=>{c.style.display=e.checked?"block":"none"}),a&&c&&a.addEventListener("change",()=>r(a.value,c)),l&&c&&l.addEventListener("change",()=>{o(l.value,c)}),t.dataset.kbListenerAttached="true"}window.aipkit_initCeKnowledgeBaseUI=n})();(function(){"use strict";function _(){let i=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_form_setup"]'),o=document.querySelector('.aipkit_wizard_content_step[data-content-id="task_config_enhancement_ai_and_prompts"]');if(!i||!o)return;["title","excerpt","content","meta"].forEach(p=>{let d=i.querySelector(`#aipkit_task_ce_update_${p}`),u=o.querySelector(`#aipkit_task_ce_${p}_prompt_section`);if(d&&u){let g=()=>{u.style.display=d.checked?"block":"none"};d.dataset.enhancerListenerAttached||(d.addEventListener("change",g),d.dataset.enhancerListenerAttached="true"),g()}});let n=o.querySelector("#aipkit_task_ce_ai_provider"),t=o.querySelector("#aipkit_task_ce_ai_model");n&&t&&typeof window.aipkit_task_ce_populateModels=="function"&&(n.dataset.ceProviderListenerAttached||(n.addEventListener("change",()=>window.aipkit_task_ce_populateModels(n,t)),n.dataset.ceProviderListenerAttached="true"),t.dataset.ceModelListenerAttached||(t.addEventListener("change",()=>{typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&window.aipkit_autogpt_ce_toggleReasoningEffort()}),t.dataset.ceModelListenerAttached="true"),window.aipkit_task_ce_populateModels(n,t));let e=o.querySelector("#aipkit_task_ce_ai_temperature");e&&typeof window.aipkit_task_ce_handleTemperatureSlider=="function"&&window.aipkit_task_ce_handleTemperatureSlider(e);let c=o.querySelector("#aipkit_task_ce_content_max_tokens");c&&typeof window.aipkit_task_ce_handleMaxTokensSlider=="function"&&window.aipkit_task_ce_handleMaxTokensSlider(c);let a=o.querySelector("#aipkit_task_ce_ai_settings_toggle"),l=o.querySelector("#aipkit_task_ce_ai_parameters_row");a&&l&&(a.dataset.ceAiSettingsListenerAttached||(a.addEventListener("click",()=>{let p=l.style.display==="none"||l.style.display==="";l.style.display=p?"block":"none",a.classList.toggle("aipkit_active",p),a.setAttribute("aria-expanded",p)}),a.dataset.ceAiSettingsListenerAttached="true"));let s=o.querySelector("#aipkit_task_config_enhancement_ai_and_prompts_main");s&&(s.dataset.cePromptListenerAttached||(s.addEventListener("click",p=>{let d=p.target.closest(".aipkit_textarea_toggle");if(!d)return;let u=d.dataset.target,g=document.getElementById(u),m=d.querySelector(".dashicons");if(!g||!m)return;g.classList.toggle("aipkit_collapsed")?(m.classList.remove("dashicons-minus"),m.classList.add("dashicons-plus-alt2"),d.title="Expand"):(m.classList.remove("dashicons-plus-alt2"),m.classList.add("dashicons-minus"),d.title="Collapse")}),s.dataset.cePromptListenerAttached="true")),typeof window.aipkit_initCeKnowledgeBaseUI=="function"?window.aipkit_initCeKnowledgeBaseUI():console.error("AIPKit CE UI: Knowledge base UI initializer not found.")}window.aipkit_initContentEnhancementTaskFormUI=_})();(function(){"use strict";function _(i){if(!i)return;let o=i.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");o&&(o.textContent=i.value,i.dataset.listenerAttached||(i.addEventListener("input",()=>o.textContent=i.value),i.dataset.listenerAttached="true"))}window.aipkit_task_ce_handleMaxTokensSlider=_})();(function(){"use strict";let _=window.aipkit_escapeHtml||function(o){return o};function i(o,r){let n=o.value,t=n?n.toLowerCase():"",e=window.aipkit_dashboard?.models,c=window.aipkit_automated_tasks_form_state||{};if(!r)return;if(!e){r.innerHTML=`<option value="">${_("Error: Model data object not found")}</option>`,r.disabled=!0;return}let a=e[t],l=c.pendingModelSelection||r.value;if(r.innerHTML="",t==="openai"&&typeof a=="object"&&!Array.isArray(a)?Object.keys(a).forEach(s=>{let p=document.createElement("optgroup");p.label=_(s),Array.isArray(a[s])&&a[s].forEach(d=>{d&&d.id&&p.appendChild(new Option(_(d.name||d.id),d.id))}),r.appendChild(p)}):Array.isArray(a)&&a.forEach(s=>{s&&s.id&&r.appendChild(new Option(_(s.name||s.id),s.id))}),r.options.length===0)r.appendChild(new Option(_(`No models for ${n}`),"")),r.disabled=!0;else{r.disabled=!1;let s=!1;if(l&&r.querySelector(`option[value="${CSS.escape(l)}"]`)&&(r.value=l,s=!0),!s&&r.options.length>0){let p=r.querySelector('option:not([value=""])');p&&(r.value=p.value)}}c&&(c.pendingModelSelection=null),typeof window.aipkit_autogpt_ce_toggleReasoningEffort=="function"&&window.aipkit_autogpt_ce_toggleReasoningEffort()}window.aipkit_task_ce_populateModels=i})();(function(){"use strict";function _(i){if(!i)return;let o=i.closest(".aipkit_slider_wrapper").querySelector(".aipkit_slider_value");o&&(o.textContent=i.value,i.dataset.listenerAttached||(i.addEventListener("input",()=>o.textContent=i.value),i.dataset.listenerAttached="true"))}window.aipkit_task_ce_handleTemperatureSlider=_})();(function(){"use strict";function _(){let i=document.querySelector("#aipkit_task_ce_ai_provider"),o=document.querySelector("#aipkit_task_ce_ai_model"),r=document.querySelector(".aipkit_task_ce_reasoning_effort_field");if(!i||!o||!r){r&&(r.style.display="none");return}let n=i.value,e=(o.value||"").toLowerCase(),c=e.startsWith("o1")||e.startsWith("o3")||e.startsWith("o4"),a=e.includes("gpt-5");n.toLowerCase()==="openai"&&(c||a)?r.style.display="block":r.style.display="none"}window.aipkit_autogpt_ce_toggleReasoningEffort=_})();})();
