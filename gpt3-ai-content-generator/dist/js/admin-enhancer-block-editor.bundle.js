(()=>{(function(){"use strict";let e=window.wp;if(!e||!e.richText||!e.components||!e.element||!e.i18n||!e.blockEditor||!e.data){console.error("AIPKit Block Editor Enhancer: One or more required WordPress script dependencies are missing.");return}let{registerFormatType:g,insert:u,getTextContent:p,slice:d}=e.richText,{ToolbarGroup:h,ToolbarDropdownMenu:_}=e.components,{BlockControls:f}=e.blockEditor,{__:t}=e.i18n,{createElement:i,Fragment:k}=e.element;async function w(o,l,m){let s=p(d(o));if(!s){e.data.dispatch("core/notices").createNotice("warning",t("Please select some text to process.","gpt3-ai-content-generator"),{isDismissible:!0});return}let c="aipkit-enhancer-processing";e.data.dispatch("core/notices").createNotice("info",t("Processing...","gpt3-ai-content-generator"),{id:c,isDismissible:!1});let a=window.aipkit_post_enhancer?.nonce_process_text;if(!a){e.data.dispatch("core/notices").removeNotice(c),e.data.dispatch("core/notices").createNotice("error",t("An error occurred: Security token missing.","gpt3-ai-content-generator"),{isDismissible:!0});return}let n=m.replace("%s",s);try{let r=await window.aipkit_apiRequest("aipkit_process_enhancer_text",{_ajax_nonce:a,text_to_process:s,final_prompt:n});if(r.text)l(u(o,r.text)),e.data.dispatch("core/notices").createNotice("success",t("Text enhanced successfully!","gpt3-ai-content-generator"),{isDismissible:!0});else throw new Error("AI did not return any text.")}catch(r){console.error("AIPKit Block Editor Enhancer Error:",r),e.data.dispatch("core/notices").createNotice("error",t("An error occurred:","gpt3-ai-content-generator")+" "+r.message,{isDismissible:!0})}finally{e.data.dispatch("core/notices").removeNotice(c)}}g("aipkit/assistant-format",{title:t("Content Assistant","gpt3-ai-content-generator"),tagName:"span",className:"aipkit-assistant-placeholder-format",edit:({value:o,onChange:l,isActive:m})=>{let a=((window.aipkit_post_enhancer||{}).actions||[]).filter(n=>n.label&&n.prompt).map(n=>({title:t(n.label,"gpt3-ai-content-generator"),onClick:()=>{w(o,l,n.prompt)}}));return i(k,null,i(f,null,i(h,null,i(_,{icon:"admin-generic",label:t("Content Assistant","gpt3-ai-content-generator"),controls:a,isDisabled:!p(d(o))}))))}})})();})();
